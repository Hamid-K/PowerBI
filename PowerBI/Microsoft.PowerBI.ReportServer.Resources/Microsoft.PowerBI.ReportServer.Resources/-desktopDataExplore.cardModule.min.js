"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["cardModule"],{68193:function(St,Q,a){a.d(Q,{V:function(){return Z}});var S=a(14599),rt=a(53197),v=a(90120),N=a(38400),C=a(79154),ot=a(62458),W=a(32041),P=a(64329),Y=a(10389),M=a(72489),Z=function(){function d(i){this.defaultTitleColor="#333333",this._animatedTextOptions={},this.mainText=(0,C.CH)("mainText"),this.name=i,this.visualConfiguration={maxFontSize:60}}return d.prototype.getMetaDataColumn=function(i){if(i&&i.metadata&&i.metadata.columns)for(var s=0,h=i.metadata.columns.length;s<h;s++){var f=i.metadata.columns[s];if(f.isMeasure){this.metaDataColumn=f;break}}},d.prototype.getAdjustedFontHeight=function(i,s,h){var f,T,D,y,x={fontFamily:null===(f=this._animatedTextOptions.textProperties)||void 0===f?void 0:f.fontFamily,fontWeight:null===(T=this._animatedTextOptions.textProperties)||void 0===T?void 0:T.fontWeight,fontStyle:null===(D=this._animatedTextOptions.textProperties)||void 0===D?void 0:D.fontStyle,textDecoration:null===(y=this._animatedTextOptions.textProperties)||void 0===y?void 0:y.textDecoration,text:s};return this.getAdjustedFontHeightCore(x,i,h,0)},d.prototype.getAdjustedFontHeightCore=function(i,s,h,f){return f>10?h:(i.fontSize=P.FP.toString(h),W.b.measureSvgTextWidth(i)<s?h:this.getAdjustedFontHeightCore(i,s,.9*h,f+1))},d.prototype.clear=function(){this.svg.select(this.mainText.selector).text("")},d.prototype.doValueTransition=function(i,s,h,f,T,D,y,x){var b,F,E,U;if(D||i!==s||null==s){i||(i=0),x||(x=this.getDefaultDatumTransform());var J=this.svg,$=this.currentViewport,k=$.height,j=$.width,q=this.getSeedFontHeight(j,k),st=this.getTranslateX(j),tt=this.getTranslateY(q),p=this.metaDataColumn;y||(y=(0,M.Ue)({format:this.getFormatString(this.dataPointObjects,p),value:s,displayUnitSystemType:h,formatSingleValues:!0,allowFormatBeautification:!0,columnType:p?p.type:void 0}));var r=String(i),t=String(s);(_.isEmpty(s)||"string"!=typeof s)&&(t=y.format(s)),(_.isEmpty(i)||"string"!=typeof i)&&(r=y.format(i)),J.classed(this.name,!0);var e=[x.getDatum(s,t)],o=J.selectAll("text").data(e),n=o.enter().append("text").classed(this.mainText.class,!0).merge(o),l=this.getAdjustedFontHeight(j,t,q);if(tt=this.getTranslateY(l+(k-l)/2),n.text(r).attr("text-anchor",this.getTextAnchor()).attr("font-size",l).attr("transform",(0,Y.Iu)(st,tt)).style("font-style",null===(b=this._animatedTextOptions.textProperties)||void 0===b?void 0:b.fontStyle).style("text-decoration",null===(F=this._animatedTextOptions.textProperties)||void 0===F?void 0:F.textDecoration).style("font-weight",null===(E=this._animatedTextOptions.textProperties)||void 0===E?void 0:E.fontWeight).style("font-family",null===(U=this._animatedTextOptions.textProperties)||void 0===U?void 0:U.fontFamily).style("fill",this.getTextColor()).call(N.Q,[r]),null==s||p&&(0,rt.v9)(p.type)||"string"==typeof s||"string"==typeof i)n.text(t).call(N.Q,[t]);else{var c=i;n.transition().duration(T).tween("text",function(m){var g=x.getValue(m),L=d3.interpolate(c,g);return function(A){var I=L(A);this.textContent=y.format(I)}})}return(0,Y.bL)(f,n),n}},d.prototype.getDefaultDatumTransform=function(){return{getDatum:function(s,h){return{value:s}},getValue:function(s){return s.value}}},Object.defineProperty(d.prototype,"animatedTextOptions",{get:function(){return this._animatedTextOptions},set:function(s){this._animatedTextOptions=s},enumerable:!1,configurable:!0}),d.prototype.getTextColor=function(){var i,s=this.style&&v.v.getThemeColor(this.style,"foreground");return(null===(i=this._animatedTextOptions)||void 0===i?void 0:i.titleColor)||s||this.defaultTitleColor},d.prototype.getSeedFontHeight=function(i,s){var h=Math.floor(.75*Math.min(i,s)),f=this.visualConfiguration.maxFontSize;return f?Math.min(f,h):h},d.prototype.getTranslateX=function(i){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return 0;case"right":return i}return i/2},d.prototype.getTranslateY=function(i){return i},d.prototype.getTextAnchor=function(){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return"start";case"right":return"end"}return"middle"},d.prototype.getFormatString=function(i,s){return ot.fF.assertAnyValue(s,"column"),(0,M.eU)(i,s,S.e0.formatString)},d}()},26101:function(St,Q,a){a.r(Q),a.d(Q,{createCard:function(){return tt}});var S=a(81337),rt=a(94478),v=a(16891),N=a(53197),C=a(11856),ot=a(90120),W=a(56707),P=a(21181),Y=a(70188),M=a(18664),Z=a(91358),d=a(80065),i=a(52287),s=a(86900),h=a(44977),f=a(38400),T=a(40739),D=a(79154),y=a(62458),x=a(32041),b=a(56578),F=a(10389),E=a(46135),U=a(58098),J=a(82755),$=a(72489),k=a(26543),st=function(p){function r(t){var e=p.call(this,r.cardClassName)||this;return e.isScrollable=!1,e.displayUnitSystemType=U.V.WholeUnits,t&&(e.tooltipsEnabled=t.tooltipsEnabled,e.isScrollable=!!t.isScrollable,e.interactivityEnabled=t.interactivityEnabled,t.animator&&(e.animator=t.animator),null!=t.displayUnitSystemType&&(e.displayUnitSystemType=t.displayUnitSystemType),t.cardSmallViewportProperties&&(e.cardSmallViewportProperties=t.cardSmallViewportProperties),e.featureSwitches=t.featureSwitches||{}),e}return(0,S.__extends)(r,p),r.prototype.init=function(t){var o,e=this;y.fF.assertValue(t,"options"),this.animationOptions=t.animation;var l=t.element.get(0);this.tooltipsEnabled&&(this.tooltipService=(0,T.r)(t.host)),this.kpiImage=d3.select(l).append("div").classed(r.KPIImage.class,!0);var u=this.svg=d3.select(l).append("svg");if(this.graphicsContext=u.append("g"),this.currentViewport=t.viewport,this.hostServices=t.host,this.style=t.style,this.updateViewportProperties(),this.isScrollable&&(u.attr("class",r.cardClassName),this.labelContext=u.append("g")),this.interactivityEnabled&&u.attr("tabindex",0).attr("focusable",!0),this.featureSwitches.onObject){var m=(null===(o=this.hostServices)||void 0===o?void 0:o.getSubSelectionService())??s.D.createWithDefaultHost();this.subSelectionHelper=i.O5.createHtmlSubselectionHelper({hostElement:l,hostServices:this.hostServices,renderer:m,targetSource:"format",scale:function(){return e.currentViewport.scale}})}},r.prototype.onDataChanged=function(t){y.fF.assertValue(t,"options"),this.featureSwitches.onObject&&t.formatMode?this.removeContextmenuHandler():this.attachContextmenuHandler();var o,n,e=t.dataViews&&t.dataViews[0];if(e){this.getMetaDataColumn(e),e.single&&(o=e.single.value,n=e.single.objects,e.single.column&&(this.selector={metadata:[e.single.column.queryName]})),this.cardFormatSetting=this.getDefaultFormatSettings(this.style);var l=e.metadata;if(l){var u=l.objects;if(u){var c=this.cardFormatSetting.labelSettings,m=u.labels;m&&c&&(0,P.ww)(m,c,void 0,this.style),c.precision!==W.NZ&&c.precision<0&&(c.precision=0);var g=u.categoryLabels,L=this.cardFormatSetting.categoryLabelSetting;g&&L&&(0,P.ww)(g,L,void 0,this.style),this.cardFormatSetting.wordWrap=(0,J.NA)(u,v.d.wordWrap.show,this.cardFormatSetting.wordWrap)}}}this.featureSwitches.onObject&&t.formatMode!==this.formatMode&&(this.formatMode=t.formatMode,this.subSelectionHelper.setFormatMode(t.formatMode)),this.updateInternal(o,n,!0,!0);var I=t.type&E.EP.FormattingSubSelectionChange;if(this.subSelectionHelper&&(t.type&E.EP.Data||t.type&E.EP.Resize||t.type&E.EP.FormattingSubSelectionChange)&&(this.subSelectionHelper.updateOutlinesFromSubSelections(t.subSelections,!0),this.hostServices.alertScreenReader&&I)){var V=this.subSelectionHelper.getLabelsFromSubSelections(t.subSelections,["aria-label"]),K=V?.length&&V.join(" ");K&&this.hostServices.alertScreenReader(K)}},r.prototype.onResizing=function(t){this.currentViewport=t,this.updateViewportProperties(),this.updateInternal(this.value,this.dataPointObjects,!0,!0)},r.prototype.attachContextmenuHandler=function(){var t=this;this.svg.on("contextmenu",function(){var e=d3.event;t.hostServices.onContextMenu({data:[t.selector],position:{x:e.clientX,y:e.clientY}}),e.preventDefault(),e.stopPropagation()})},r.prototype.removeContextmenuHandler=function(){this.svg.on("contextmenu",null)},r.prototype.updateViewportProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},r.prototype.setTextProperties=function(t,e){r.cardTextProperties=(0,M.qk)(e,t)},r.prototype.isSmallViewport=function(){return!!(this.cardSmallViewportProperties&&this.currentViewport.width<=this.cardSmallViewportProperties.cardSmallViewportWidth)},r.prototype.getCardPrecision=function(t){return void 0===t&&(t=!1),t?W.NZ:this.cardFormatSetting.labelSettings.precision},r.prototype.getCardDisplayUnits=function(t){return void 0===t&&(t=!1),t||this.metaDataColumn&&this.metaDataColumn.type&&!this.metaDataColumn.type.numeric?0:this.cardFormatSetting.labelSettings.displayUnits},r.prototype.getAdjustedFontHeight=function(t,e,o){var n=p.prototype.getAdjustedFontHeight.call(this,t,e,o);return Math.min(n,C.D.card.maxFontSize)},r.prototype.clear=function(t){void 0===t&&(t=!1),this.svg.select(r.Value.selector).text(""),t||this.svg.select(r.Label.selector).text(""),p.prototype.clear.call(this)},r.prototype.updateInternal=function(t,e,o,n){void 0===n&&(n=!1);var l=this.value,u=(0,rt.Mb)(this.animator,o);if(void 0!==t){var c=this.metaDataColumn,m=this.cardFormatSetting.labelSettings,g=this.cardFormatSetting.categoryLabelSetting,L=this.isSmallViewport(),A=this.getCardPrecision(L),I=this.getCardDisplayUnits(L),V=0===I,K=this.getFormatString(e,c),ft=(0,$.Ue)({format:K,value:V?t:I,precision:(0,Y.h1)(A,K),displayUnitSystemType:V&&A===W.NZ?this.displayUnitSystemType:U.V.WholeUnits,formatSingleValues:!!V,allowFormatBeautification:!0,columnType:c?c.type:void 0}),vt=this.cardFormatSetting,O=m.fontProperties.size.px;this.setTextProperties(t,this.cardFormatSetting.categoryLabelSetting.fontProperties);var et=(g.show?x.b.estimateSvgTextHeight(r.cardTextProperties):0)+C.D.label.paddingTop,B=this.currentViewport.width,it=this.currentViewport.height,G=this.getTranslateX(B),H=(it-et-O)/2,at=c&&c.displayName,X=(0,Z.jz)(c)&&(0,Z.zl)(c,t,1);if(this.isScrollable){if(!n&&l===t)return;if(X)this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(X,t,G,H,O);else{var nt;nt=_.isEmpty(t)||"string"!=typeof t?ft.format(t):t;var xt=[{displayName:at,value:nt}];this.kpiImage.selectAll("div").remove();var lt=this.getTranslateY(O+H),w=(R=this.graphicsContext.attr("transform",(0,F.Iu)(G,lt)).selectAll("text").data(xt)).enter().append("text").attr("class",r.Value.class).merge(R);if(w.text(function(dt){return dt.value}).style("text-anchor",this.getTextAnchor()).styles((0,M.E_)(m.fontProperties)),w.style("white-space",m.preserveWhitespace?"pre":"normal"),this.featureSwitches.onObject&&w.classed(i.cy,!0).attr(i.CP,!0).attr(i.Ez,"callout-value").attr(i.CK,"Visual_Gauge_CalloutValue").attr(i.QZ,2),vt.wordWrap){var pt=w.node();(0,h.lM)(pt,B,it-et,void 0,!0,m.preserveWhitespace);var mt=pt.childElementCount;mt>1&&(lt=this.getTranslateY(O+(H=(it-et-(O*=mt))/2)),this.graphicsContext.attr("transform",(0,F.Iu)(G,lt)))}else w.call(N.oq,B,x.b.svgEllipsis);this.addTooltip(w),R.exit().remove()}if(g.show&&at){var Dt=[at],gt=this.getTranslateY(O+et+H),ut=this.labelContext.attr("transform",(0,F.Iu)(G,gt)).selectAll("text").data(Dt),z=ut.enter().append("text").attr("class",r.Label.class).merge(ut);z.text(function(dt){return dt}).styles((0,M.E_)(g.fontProperties)).style("text-anchor",this.getTextAnchor()),z.style("white-space",g.preserveWhitespace?"pre":"normal"),this.featureSwitches.onObject&&z.classed(i.cy,!0).attr(i.CP,!0).attr(i.Ez,"category-labels").attr(i.CK,"Visual_CategoryLabel").attr(i.QZ,1);var yt=z.node();yt&&(vt.wordWrap?(0,h.lM)(yt,B,it-gt,void 0,!0,g.preserveWhitespace):z.call(N.oq,B,x.b.svgEllipsis)),ut.exit().remove()}else this.labelContext.selectAll("text").remove()}else if(X)this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(X,t,G,H,O);else{var R;this.kpiImage.selectAll("div").remove(),(R=this.doValueTransition(l,t,this.displayUnitSystemType,this.animationOptions,u,n,ft,{getDatum:function(ht,Ft){return{displayName:at,value:Ft,unformattedValue:ht}},getValue:function(ht){return ht.unformattedValue}})).classed("value",!0),this.addTooltip(R),this.graphicsContext.call(f.Q,[t])}if(this.interactivityEnabled){var ct;ct=X?this.kpiImage.selectAll("div").datum():this.graphicsContext.selectAll("text").datum(),this.svg.attr("aria-label",(0,f.X)([ct]))}this.value=t,this.dataPointObjects=e}else void 0!==l&&this.clear()},r.prototype.displayStatusGraphic=function(t,e,o,n,l){this.graphicsContext.selectAll("text").remove();var u=this.kpiImage.select("div");(!u||u.empty())&&(u=this.kpiImage.append("div")),u.attr("class",["value",t.class].join(" ")).style("position","absolute").style("font-size",l+"px");var c=u.node().offsetWidth,m=u.node().offsetHeight;u.style("transform",(0,F.O7)(o-c/2,this.getTranslateY(l+n)-m)),u.datum({displayName:this.metaDataColumn&&this.metaDataColumn.displayName,kpiValue:{value:e,metadata:this.metaDataColumn.kpi}}),this.addTooltip(u)},r.prototype.getDefaultFormatSettings=function(t){var e=function(n){return ot.v.getThemeColor(t,n)};return{labelSettings:(0,P.bT)({show:!0,labelColor:e(C.D.value.colorName),fontSize:C.D.value.textSize,fontFamily:C.D.value.fontFamily,preserveWhitespace:!0,style:t,textClassName:"callout"}),categoryLabelSetting:(0,P.bT)({show:!0,labelColor:e(C.D.label.colorName),fontSize:C.D.label.textSize,fontFamily:C.D.label.fontFamily,preserveWhitespace:!0,style:t,textClassName:"largeLightLabel"}),wordWrap:!1}},r.prototype.getDataLabelSettingsOptionsWithWordWrap=function(t,e,o){return e.wordWrap=this.cardFormatSetting.wordWrap,{enumeration:t,dataLabelsSettings:e,show:!0,displayUnits:o,precision:o,fontSize:!0,fontFamily:!0,style:this.style,preserveWhitespace:!0,wordWrap:!0,bold:!0,italic:!0,underline:!0}},r.prototype.getFormattingModel=function(){var e,t=this;return null!==(e=this.cardFormatSetting)&&void 0!==e||(this.cardFormatSetting=this.getDefaultFormatSettings(this.style)),new b.Nq(function(){return t.getCalloutValueCard()},function(){return(0,P.Zu)({cardName:"Visual_CategoryLabel",dataLabelSettings:t.cardFormatSetting.categoryLabelSetting,isShowCategory:!1,localize:function(n){return t.hostServices.getLocalizedString(n)},props:(0,S.__assign)((0,S.__assign)({},v.d.categoryLabels),{color:(0,S.__assign)((0,S.__assign)({},v.d.categoryLabels.color),{instanceKind:3})}),revertToDefaultProps:v.d.categoryLabels,showBackground:!1,showValueColor:!0,style:t.style})}).build()},r.prototype.getCalloutValueCard=function(){var t=this,e=(0,S.__assign)((0,S.__assign)({},v.d.labels),{precision:v.d.labels.labelPrecision,displayUnits:v.d.labels.labelDisplayUnits,wordWrap:v.d.wordWrap.show});return(0,P.XQ)({cardBuilder:new b.CQ(new b.lg("labels"),"Visual_Gauge_CalloutValue",e,function(o){return t.hostServices.getLocalizedString(o)}),dataLabelsProps:e,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:this.getDataLabelSettingsOptionsWithWordWrap(void 0,this.cardFormatSetting.labelSettings,!0),omitGroupDisplayNames:!0,instanceKind:3})},r.prototype.addTooltip=function(t){var e=this,o=this.hostServices.tooltips();this.tooltipsEnabled&&o&&o.enabled()&&this.tooltipService.addTooltip(t,function(n){var l=n.data;return function(p){return!!p.kpiValue}(l)?[{displayName:l.displayName,kpiValue:l.kpiValue}]:[{displayName:l.displayName,value:l.value}]},function(){return e.getTooltipIdentity()&&[e.getTooltipIdentity()]})},r.prototype.getTooltipIdentity=function(){return this.metaDataColumn&&k.l0.createWithMeasure(this.metaDataColumn.queryName)},r.prototype.getSubSelectionStyles=function(t){var e=(0,d.dF)(t);if(e)switch(e.objectName){case"callout-value":var o=v.d.labels;return(0,d.xs)(this.hostServices,{fontFamilyReference:o.fontFamily,fontSizeReference:o.fontSize,boldReference:o.bold,italicReference:o.italic,underlineReference:o.underline,fontColorReference:o.color,displayUnitsReference:o.labelDisplayUnits,precisionReference:o.labelPrecision,wordWrapReference:v.d.wordWrap.show});case"category-labels":var n=v.d.categoryLabels;return(0,d.un)(this.hostServices,{fontFamilyReference:n.fontFamily,fontSizeReference:n.fontSize,boldReference:n.bold,italicReference:n.italic,underlineReference:n.underline,fontColorReference:n.color});default:return}},r.prototype.getSubSelectionShortcuts=function(t){var e=(0,d.dF)(t);if(e){var o="".concat("Visual","-").concat("labels"),n="".concat("labels","-").concat("values"),l="".concat("Visual","-").concat("categoryLabels"),u="".concat("categoryLabels","-").concat("values");switch(e.objectName){case"callout-value":return[{type:0,excludedResetFormattingIds:[v.d.categoryLabels.show]},(0,S.__assign)((0,S.__assign)({type:2},v.d.categoryLabels.show),{enabledLabel:this.hostServices.getLocalizedString("Format_AddCategoryLabel")}),{type:1,destinationInfo:{cardUid:o,groupUid:n},label:this.hostServices.getLocalizedString("Format_Callout_Value")}];case"category-labels":return[{type:0},{type:1,destinationInfo:{cardUid:l,groupUid:u},label:this.hostServices.getLocalizedString("Format_Category_Label")}];default:return}}},r.cardClassName="card",r.Label=(0,D.CH)("label"),r.Value=(0,D.CH)("value"),r.KPIImage=(0,D.CH)("caption"),r.cardTextProperties={fontSize:null,text:null,fontFamily:W.bL.family},r}(a(68193).V);function tt(p){return new st(p)}}}]);