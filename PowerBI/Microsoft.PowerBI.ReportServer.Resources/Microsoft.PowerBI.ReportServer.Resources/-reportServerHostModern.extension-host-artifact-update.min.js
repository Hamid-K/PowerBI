"use strict";(self.webpackChunkreportServerHostModern=self.webpackChunkreportServerHostModern||[]).push([["extension-host-artifact-update"],{73582:function(et,T,a){a.r(T),a.d(T,{ExtensionHostArtifactUpdateModule:function(){return Q}});var W=a(77476),u=a(60756),s=a(85732),S=a(14172),$=a(77526),D=a(6663),R=a(17653),V=a(11105),h=a(73471),k=a(60397),x=a(17899),B=a(82618),H=(0,s.PH)("[Extension Host Artifact Update] Subscribe Artifact Update",(0,s.Ky)()),O=(0,s.PH)("[Extension Host Artifact Update] Unsubscribe Artifact Update",(0,s.Ky)()),G=a(8894),F="extensionHostArtifactUpdate",l=(0,G.H)({selectId:function(d){return d.subscriptionId}}),K={artifactUpdateSubscriptions:l.getInitialState()},N=(0,s.ZF)(F),X=(0,s.P1)(N,function(e){return l.getSelectors().selectAll(e.artifactUpdateSubscriptions)}),p=a(50423),Z=function(){function e(d,r,f){var o=this;this.actions$=d,this.messageBroker=r,this.store=f,this.onSubscribeArtifactUpdateReceived$=(0,x.Av)(this.actions$,this.messageBroker,h.Vm.subscribeArtifactUpdate,function(n){var i=n.iframeId,y=n.workspaceObjectId,j=(0,V.Z)();return o.store.dispatch(H({subscriptionId:j,iframeId:i,workspaceObjectId:y})),h.Vm.subscribeArtifactUpdate.resolve({subscriptionId:j})}),this.onUnsubscribeArtifactUpdateReceived$=(0,u.GW)(function(){return o.actions$.pipe((0,x.pR)(h.Vm.unsubscribeArtifactUpdate),(0,S.U)(function(n){return O({subscriptionId:n.subscriptionId})}))}),this.pushArtifactUpdate$=(0,u.GW)(function(){return o.store.select(B.Fe).pipe((0,$.x)(),(0,D.G)(),(0,u.IC)(function(){return o.store.select(X)}),(0,S.U)(function(n){for(var i=n[0],y=i[0],j=i[1],C=[],z=function(_,tt,b){var v=[],m=y[b],g=j[b];m&&g&&(g.forEach(function(t){var c=m.find(function(I){return I.objectId===t.objectId});t.objectId&&t.artifactType&&!c&&v.push({changeType:"add",workspaceObjectId:b,artifactObjectId:t.objectId,artifactType:t.artifactType})}),m.forEach(function(t){var c=g.find(function(I){return I.objectId===t.objectId});t.objectId&&t.artifactType&&!c&&v.push({changeType:"remove",workspaceObjectId:b,artifactObjectId:t.objectId,artifactType:t.artifactType})}),g.forEach(function(t){var c=m.find(function(I){return I.objectId===t.objectId});t.objectId&&t.artifactType&&t.lastUpdatedDate&&c&&c.objectId&&c.artifactType&&c.lastUpdatedDate&&c.lastUpdatedDate.getTime()!==t.lastUpdatedDate.getTime()&&v.push({changeType:"edit",workspaceObjectId:b,artifactObjectId:t.objectId,artifactType:t.artifactType})})),v.length>0&&C.push(h.Vm.onArtifactUpdate({subscriptionId:_,changes:v})(tt))},E=0,P=n[1];E<P.length;E++){var A=P[E];z(A.subscriptionId,A.iframeId,A.workspaceObjectId)}return C}),(0,R.b)(function(n){n.forEach(function(i){o.messageBroker.send(i)})}))},{dispatch:!1})}return e.\u0275fac=function(r){return new(r||e)(p.\u0275\u0275inject(u.eX),p.\u0275\u0275inject(k.u),p.\u0275\u0275inject(s.yh))},e.\u0275prov=p.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e}(),M=a(36012);function L(e,d){return(0,s.Lq)(K,(0,M.P)(H,function(r,f){r.artifactUpdateSubscriptions=l.upsertOne({subscriptionId:f.subscriptionId,iframeId:f.iframeId,workspaceObjectId:f.workspaceObjectId},r.artifactUpdateSubscriptions)}),(0,M.P)(O,function(r,f){r.artifactUpdateSubscriptions=l.removeOne(f.subscriptionId,r.artifactUpdateSubscriptions)}))(e,d)}var Q=function(){function e(){}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=p.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=p.\u0275\u0275defineInjector({imports:[W.CommonModule,s.Aw.forFeature(F,L),u.sQ.forFeature([Z])]}),e}()}}]);