"use strict";(self.webpackChunkdesktopDaxQueryView=self.webpackChunkdesktopDaxQueryView||[]).push([["textbox"],{29946:function($e,wt,T){T.r(wt),T.d(wt,{AlwaysUseSmallViewport:function(){return ze},ColorPicker:function(){return Y},DefaultAlignment:function(){return Ot},DefaultLinkInputValue:function(){return Gt},FontSizePrecision:function(){return Lt},FontSizes:function(){return Ct},Fonts:function(){return gt},FormattingSettings:function(){return pe},LegacyDefaultFont:function(){return Ht},LegacyDefaultFontProperties:function(){return yt},LegacyFontSize:function(){return Rt},LinkInput:function(){return Bt},LinkPreview:function(){return Qt},MiniToolbarLargeButton:function(){return ve},ModelKeyName:function(){return ut},QuillPlaceholder:function(){return nt},QuillWrapper:function(){return B},SmartNarrativesEditor:function(){return fe},TextAlignments:function(){return Wt},TextIndent:function(){return Ut},TextListTypes:function(){return lt},TextRunElement:function(){return bt},TextScriptTypes:function(){return st},Textbox:function(){return jt},Toolbar:function(){return re},ViewModelAdapter:function(){return Dt},applyTooltip:function(){return rt},buildToolbarLinkInputTemplate:function(){return ae},button:function(){return ce},convertDeltaToParagraphs:function(){return Kt},convertFormatAttributesToTextStyle:function(){return ct},convertIndentToPadding:function(){return Zt},convertParagraphsToHtml:function(){return Jt},convertParagraphsToOps:function(){return Yt},div:function(){return W},formatButton:function(){return D},formatGroup:function(){return q},formattingSettingsClass:function(){return At},formattingSettingsGroup:function(){return le},getAtMentionTextRun:function(){return Xt},getBlockStyle:function(){return te},getCSSFromFont:function(){return Z},getCssFontFamily:function(){return ie},getCssFontSize:function(){return ne},getCustomQuillFormatValue:function(){return dt},getFontFromCSS:function(){return St},getTextRunFromSmartNarrativesInsert:function(){return _t},getTooltip:function(){return L},getVerticalDivider:function(){return Nt},isValidLinkUrl:function(){return it},linkTooltipTemplateGenerator:function(){return oe},mentionDefaultMaxSearchLength:function(){return Mt},options:function(){return Tt},picker:function(){return xt},removeQuotes:function(){return ee},selector:function(){return de},smartNarrativesEditor:function(){return se},smartNarrativesEditorClass:function(){return Et},span:function(){return ue},toggleGroup:function(){return ht},updatePicker:function(){return Ft},updateSelector:function(){return he}});var S=T(81337),ft=T(65302),Pt=T(11034),Ce=T(57470),M=T(57869),X=T(90120),tt=T(18664),ye=T(67064),Q=T(32105),kt=T(64067),Se=T(44783),w=T(79154),v=T(62458),O=T(65195),R=T(38265),be=T(57419),xe=T(59107),ot=T(9795),zt=T(98094),at=T(48066),$t=T(38078),Fe=T(66001),G=T(38830),Te=T(7490),Ne=T(82755),Ee=T(76045),Ae=T(72489),Be=T(80777);function Vt(e,t){for(var n=[],r=0,o=e;r<o.length;r++){var l=qt(o[r].value,t);l&&n.push(l)}return n.join("")}function pt(e,t){var i;if((0,G.U)(e.expression)){var n=e.expression.selector.id,r=t?.[n];i=r?.value}else i=e.expression;return(0,Te.A)(e,i).textRuns}function qt(e,t){return(0,G.U)(e)?vt(e.selector.id,t):e}function vt(e,t){var i=t?.[e];return i?.formattedValue}function et(e){var t=e;return v.fF.assertValue(t,"textRun"),_.isString(t.value)||(0,G.U)(t.value)}function It(e){return!_.isNil(e.mentionEmail)}function K(e){var t=e;return v.fF.assertValue(t,"textRunConditional"),_.isArray(t.cases)&&!!t.defaultCase&&_.isArray(t.defaultCase.textRuns)&&((0,G.U)(t.expression)||_.isString(t.expression)||_.isNumber(t.expression)||_.isBoolean(t.expression)||_.isDate(t.expression))}function Pe(e){return _.isDate(e)?7:_.isInteger(e)?4:_.isNumber(e)?3:_.isBoolean(e)?5:_.isString(e)?1:(v.fF.assert(function(){return!e},"Unsupported primitive value"),0)}var Mt=48,mt=(0,w.CH)("textboxFocusElement"),ke={linkTooltip:(0,w.CH)("ql-link-tooltip"),toolbarUrlInput:(0,w.CH)("toolbar-url-input")},gt=["Arial","Arial Black","Arial Unicode MS","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","DIN","DIN Light","Georgia","Lucida Sans Unicode","Segoe (Bold)","Segoe UI","Segoe UI Light","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Wingdings"],Lt=1,Ct=[8,9,10,10.5,11,12,14,16,18,20,24,28,32,36,40,42,44,54,60,66,72,80,88,96],Ht=R.Wn.light.family,Rt=Q.B.createFromPx(14),yt={family:Ht,size:Rt},Wt=["Left","Center","Right"],Ut=["-1","+1"],Ot="Left",st=function(e){return e.Super="Super",e.Sub="Sub",e}({}),lt=function(e){return e.Bullet="bullet",e.Numbered="ordered",e}({});function Z(e){var t=R.bw[e];return t?t.family:e}function St(e){return _.findKey(R.bw,function(i){return i.family===e||i.family.indexOf(e)>0})||e}var jt=function(){function e(t){var i=this;this.asyncSerializer=new be.W,t&&(this.supportsNarrativeExpressions=!1!==t.supportsNarrativeExpressions,this.supportsAtMention=!!t.supportsAtMention,this.textChangeThrottle=t.textChangeThrottle,this.placeholderText=t.placeholderText,this.supportsFormattingChangeIndicationOptions=!!t.supportsFormattingChangeIndication,this.hierarchicalTabbing=!!t.hierarchicalTabbing,v.fF.assert(function(){return!(t.textChangeThrottle&&i.supportsNarrativeExpressions)},"textChangeThrottle cannot be used with supportsNarrativeExpressions"),this.fontFamilies=(0,S.__spreadArray)([],t.allowedFonts||gt||[],!0),this.fontSizes=(0,S.__spreadArray)([],t.allowedFontSizes||Ct||[],!0),this.restrictFontSizes=_.some(t.allowedFontSizes),t.viewModelAdapter&&(this.viewModelAdapter=t.viewModelAdapter),this.disableScrollingInViewMode=t.disableScrollingInViewMode,this.featureSwitches=t.featureSwitches)}return e.prototype.init=function(t){this.element=t.element,this.host=t.host,this.viewport=t.viewport,this.style=t.style,this.readOnly=0===this.host.getViewMode(),this.paragraphs=[],this.defaultFont=(0,S.__assign)({},yt),this.fontFamilies=(0,S.__spreadArray)([],this.fontFamilies||gt||[],!0),this.fontSizes=(0,S.__spreadArray)([],this.fontSizes||Ct||[],!0),this.evaluatedValues={},this.quillEditorIsReady=this.host.promiseFactory().defer(),this.featureSwitches=t.featureSwitches,this.configureMentions(),this.refreshView()},e.prototype.onResizing=function(t){var i=this.viewport;this.viewport=t,this.updateSize(),this.viewModelAdapter&&this.viewModelAdapter.onResizing(this.element,this.viewport,i,this.defaultFont)},e.prototype.onDataChanged=function(t){v.fF.assertValue(t,"options");var i=t.dataViews;this.evaluatedValues={},this.paragraphs=[];var n=this.editor&&this.editor.isDirty;if(n&&(this.paragraphs=this.getContents()),i&&i.length>0){var r=i[0].metadata.objects;r&&r.general&&!n&&(this.paragraphs=r.general.paragraphs),function(e,t,i){v.fF.assertValue(t,"evaluatedValues must be defined");var n=M.RL.values.expr.objectName;v.fF.assert(function(){return n===M.RL.values.formatString.objectName},"Format strings are expected in the same object as evaluated values");var r=(0,Ne.AO)(e,n);if(!_.isEmpty(r)){for(var o in r){var a=(0,Ee.N)(r[o],M.RL.values.expr.propertyName),s=new Ae.g({column:{displayName:"",objects:r,type:Be.Ge.fromPrimitiveTypeAndCategory(Pe(a))},formatStringPropId:{objectName:o,propertyName:M.RL.values.formatString.propertyName},nullsAreBlank:!1});t[o]={value:a,formattedValue:s.format(a)}}i&&i.trace(2,"TextboxWithSmartNarrativeValuesDataChanged")}}(r,this.evaluatedValues,this.host.telemetry());var o=X.v.create(this.style);this.defaultFont=(0,tt.Zi)(r&&r.text,{family:"fontFamily",size:"fontSize",color:"color"},o,this.style,"foreground","label",yt)}this.mergeParagraphFontsWithStandardFonts(),this.refreshView()},e.prototype.getTelemetryInformation=function(){for(var t,i,o=!1,a=[],s=0,l=this.paragraphs;s<l.length;s++)for(var d=0,h=l[s].textRuns;d<h.length;d++){var c=h[d];if(K(c)){if(o=!0,!_.isEmpty(c.cases)){var m=_.first(c.cases);a.push(_.round(m.pattern,-2))}}else et(c)?(0,G.U)(c.value)&&(o=!0):v.fF.assertNever(c)}return o&&((t={}).SmartNarratives=!0,t.SummarizationTemplateIds=a.join(","),i=t),i},e.prototype.mergeParagraphFontsWithStandardFonts=function(){var t=(0,S.__spreadArray)((0,S.__spreadArray)([],_.map(this.fontSizes,function(p){return Q.B.createFromPt(p)}),!0),[this.defaultFont.size],!1),i=_.chain(t).map(function(p){return p.pt}).uniqBy(function(p){return p}).sortBy(function(p){return p}).value(),n=St(this.defaultFont.family),r=(0,S.__spreadArray)((0,S.__spreadArray)([],this.fontFamilies,!0),[n],!1),o=this.paragraphs;if(o)for(var a=0,s=o;a<s.length;a++){var l=s[a];if(l.textRuns)for(var u=0,d=l.textRuns;u<d.length;u++){var h=d[u],c=h&&et(h)&&h.textStyle;if(c){if(c.fontSize){var m=Q.B.createFromCSS(c.fontSize,Lt);if(m)if(this.restrictFontSizes){var f=_.sortedIndex(i,m.pt);c.fontSize=i[Math.min(f,i.length-1)]+"pt"}else t.push(m)}c.fontFamily&&r.push(c.fontFamily)}}}this.fontSizes=_.chain(t).map(function(p){return p.pt}).sortBy(function(p){return p}).uniqBy(function(p){return p}).value(),this.fontFamilies=_.chain(r).sortBy(function(p){return p}).uniqBy(function(p){return p}).value()},e.prototype.destroy=function(){this.editor&&(this.editor.destroy(),this.editor=void 0),this.isDisposed=!0},e.prototype.focus=function(){if(this.editor)return this.editor.focus(),!0},e.prototype.onViewModeChanged=function(t){this.readOnly=0===t,this.refreshView()},e.prototype.setSelection=function(t,i){v.fF.assertValue(this.editor,"editor"),this.editor&&this.editor.setSelection(t,i)},e.prototype.getSelection=function(){return this.editor.getSelection()},e.prototype.ensureFocusableElement=function(){var t=this,i=this.element;if(!i.find(mt.selector).length){var n=$("<div>").width(0).height(0).attr("tabindex",0).addClass(mt.class);i.append(n),n.on(Pt.BZ,function(){t.focus()})}},e.prototype.removeFocusableElement=function(){this.element.find(mt.selector).remove()},e.prototype.refreshView=function(){return(0,S.__awaiter)(this,void 0,void 0,function(){var t=this;return(0,S.__generator)(this,function(i){switch(i.label){case 0:return[4,this.asyncSerializer.enqueue(function(){return(0,S.__awaiter)(t,void 0,void 0,function(){var n,r,o,a,s,l,u,d,h=this;return(0,S.__generator)(this,function(c){switch(c.label){case 0:return this.isDisposed?[2]:this.readOnly?(this.editor&&(this.editor.isDirty&&this.saveContents(),this.editor.destroy(),this.editor=null),this.element.empty(),n=Jt(this.paragraphs,this.defaultFont,this.evaluatedValues,this.$mentionsHoverContainer,this.personCardComponent),r=$("<div>").addClass(e.ClassAndSelector.class).css((0,tt.wB)(this.defaultFont)).append(n),this.supportsAtMention&&r.append(this.$mentionsHoverContainer),this.viewModelAdapter&&this.viewModelAdapter.onDataChanged(r,this.viewport,this.defaultFont),o=void 0,this.disableScrollingInViewMode?(o=r,this.element.append(r)):(o=this.$scrollableDiv=$("<div></div>").addClass(e.ScrollWrapperClassAndSelector.class).css({height:"".concat(this.viewport.height,"px"),"overflow-y":"auto","overflow-x":"hidden"}).append(r),this.element.append(this.$scrollableDiv)),this.removeFocusableElement(),o.attr("tabindex",0).attr("role","document").attr(Pt.Qt,"Browser").on("keydown",function(m){27===m.keyCode&&(ft.IK.focus(Ce.M.getParentFocusElement(document.activeElement)),m.stopPropagation())}),[3,5]):[3,1];case 1:return a={defaultFont:this.defaultFont,evaluatedValues:this.evaluatedValues,fontFamilies:this.fontFamilies,fontSizes:this.fontSizes,supportsNarrativeExpressions:this.supportsNarrativeExpressions,textChangeThrottle:this.textChangeThrottle,onEscape:function(){return h.focus()},featureSwitches:this.featureSwitches,supportsFormattingChangeIndication:this.supportsFormattingChangeIndicationOptions,onRenderTooltip:function(f,p){return h.getTooltipsComponent(f,p)},hierarchicalTabbing:this.hierarchicalTabbing},s=this.supportsFormattingChangeIndicationOptions&&!this.readOnly,this.editor?[3,3]:(this.editor=new B(this.readOnly,this.host,this.style,a,this.supportsAtMention,this.$mentionsHoverContainer,this.personCardComponent,this.placeholderText,s,this.hierarchicalTabbing),this.editor.textChanged=function(){return h.saveContents()},this.element.empty(),this.ensureFocusableElement(),(l=this.editor.getElement()).addClass(e.ClassAndSelector.class),this.element.append(l),[4,this.editor.init()]);case 2:return c.sent(),[3,4];case 3:this.editor.updateOptions(a),c.label=4;case 4:if(!this.editor)return[2];this.editor.getElement().css((0,tt.wB)(this.defaultFont)),this.quillEditorIsReady.resolve(),this.restrictFontSizes&&(this.editor.onPaste=function(){h.mergeParagraphFontsWithStandardFonts(),h.refreshView()}),u=this.editor.getSelection(),d=Yt(this.paragraphs,this.evaluatedValues,this.editor,this.style,this.$mentionsHoverContainer,this.personCardComponent),this.editor.setContents(d),u&&this.editor.setSelection(u.index,u.length),c.label=5;case 5:return this.updateSize(),[2]}})})})];case 1:return i.sent(),[2]}})})},e.prototype.getContents=function(){if(this.editor){var t=this.editor.getContents();if(t){var i=Kt(t,this.supportsNarrativeExpressions,this.evaluatedValues);if(!(i.length<1))return i}}},e.prototype.saveContents=function(){var t=this.getContents();t&&(this.paragraphs=t,this.host.persistProperties([{objectName:"general",properties:{paragraphs:this.paragraphs},selector:null}]),this.editor&&this.editor.isDirty&&(this.editor.isDirty=!1))},e.prototype.updateSize=function(){this.editor?this.editor.resize(this.viewport):this.$scrollableDiv&&this.$scrollableDiv.css("height","".concat(this.viewport.height,"px"))},e.prototype.configureMentions=function(){if(this.supportsAtMention){this.$mentionsHoverContainer=$("<span>").addClass(e.MentionsHoverClassAndSelector.class).hide();var t=this.host.getUIComponentFactory();v.fF.assertValue(t,"uiComponentFactory"),this.personCardComponent=t.createPersonCard(this.$mentionsHoverContainer.get(0))}},e.prototype.onTextEditorReady=function(){return this.quillEditorIsReady.promise},e.prototype.getTooltipsComponent=function(t,i){return this.tooltip&&this.tooltip.close(),this.tooltip=this.host.getUIComponentFactory().createTooltip(t,i),this.tooltip},e.ClassAndSelector=(0,w.CH)("textbox"),e.MentionsHoverClassAndSelector=(0,w.CH)("mentions-hover"),e.ScrollWrapperClassAndSelector=(0,w.CH)("scrollWrapper"),e}(),Gt="https://",Dt=function(){function e(t){this.smallViewportProperties=t}return e.prototype.onResizing=function(t,i,n,r){var o=this.isSmallViewport(n),a=this.isSmallViewport(i);o!==a&&this.applyScaleOnElement(t,a,r)},e.prototype.onDataChanged=function(t,i,n){this.isSmallViewport(i)&&this.applyScaleOnElement(t,!0,n)},e.prototype.isSmallViewport=function(t){return!!t&&!!this.smallViewportProperties&&(t.height<=this.smallViewportProperties.minHeightToScaleFontSize||t.width<=this.smallViewportProperties.minWidthToScaleFontSize)},e.prototype.applyScaleOnElement=function(t,i,n){i&&(n=(0,S.__assign)((0,S.__assign)({},n),{size:e.scale(n.size)})),t.find(jt.ClassAndSelector.selector).css((0,tt.wB)(n)),t.find(bt.selector).each(function(r,o){var a;if(i){var l,s=$(o).css("font-size");l=s?Q.B.createFromCSS(s):n.size,a=e.scale(l)}else{var u=$(o).data(ut),d=u.textStyle&&u.textStyle.fontSize;d&&(a=Q.B.createFromCSS(d))}var h=n;a&&(h=(0,S.__assign)((0,S.__assign)({},n),{size:a})),(0,tt.JZ)(h,o)})},e.scale=function(t){var i=t.px;return Q.B.createFromPx(i>66?32:i>42?28:i>26?24:i>16?20:i>11?14:12)},e}(),ze=function(e){function t(){return e.call(this,{minHeightToScaleFontSize:1/0,minWidthToScaleFontSize:1/0})||this}return(0,S.__extends)(t,e),t}(Dt),Qt=function(){function e(){}return e.format=function(t){return/^\S+@\S+\.\S+$/.test(t)?"mailto:"+t:/^https?:\/\//i.test(t)?t:Gt+t},e}(),ut="ModelObject",bt=(0,w.CH)("textRun");function Kt(e,t,i){for(var n=[],r={textRuns:[]},o=!1,a=function(h,c){var m=e.ops[h];v.fF.assertValue(m,"operation should be an insert");var f=m.attributes,p=m.insert;if(void 0===p)return"continue";if(_.isString(p)){var g=p;o=!1,f&&f.align&&(v.fF.assert(function(){return void 0===r.horizontalTextAlignment||r.horizontalTextAlignment===f.align},"paragraph should not have more than one horizontal alignment"),r.horizontalTextAlignment=f.align),f&&f.indent&&(r.indent=f.indent),f&&f.list&&(r.listType=f.list);var N=0,F=0,P=void 0;do{if((F=g.indexOf(M.mj,N))<0?(P=!1,F=g.length):P=!0,F-N>0){var C={value:g.substring(N,F)};if(f){void 0!==f.link&&it(f.link)&&(C.url=f.link);var b=ct(f);b&&(C.textStyle=b)}r.textRuns.push(C)}P&&(0===r.textRuns.length&&r.textRuns.push({value:""}),n.push(r),r={textRuns:[]}),N=F+1}while(N<g.length)}else if(_.isNumber(p))v.fF.assertFail("embeds not supported");else{var y=Xt(f,p);if(y)r.textRuns.push(y);else if(t){if(!(C=_t(f,p)))return"continue";if(K(C)){var x=Vt(pt(C,i),i);if((x===M.mj||x===M.d$)&&!o)return 0===r.textRuns.length&&r.textRuns.push({value:""}),n.push(r),r={textRuns:[]},o=!1,"continue";o=!0}r.textRuns.push(C)}}},s=0,l=e.ops.length;s<l;s++)a(s);if(r.textRuns.length>0){var u=_.first(r.textRuns);et(u)&&_.isString(u.value)&&u.value.length>0&&n.push(r)}return n}function Jt(e,t,i,n,r){for(var o=$(),a=0,s=$(),l=0,u=e.length;l<u;++l){var d=e[l],h=!0;d.listType===lt.Numbered?a++:(a=0,s=void 0);var c=$("<p>").data(ut,d);d.horizontalTextAlignment&&c.css("text-align",d.horizontalTextAlignment),d.indent&&c.css("padding","0px 0px 0px "+Zt(d.indent)+"px");for(var m=function(P,I){var b,A,C=d.textRuns[P],y=void 0,z=void 0,x=void 0;if(et(C))y=C.value,z=C.textStyle,x=C.url,It(C)&&(y="@".concat(y),(z=z||{}).color="#1453b3",A=C.mentionEmail);else{if(!K(C))return v.fF.assertNever(C),"continue";var k=pt(C,i);if((y=Vt(k,i))===M.d$)return"continue";_.isEmpty(k)||(z=k[0].textStyle,x=k[0].url)}_.isEmpty(y)||(h=!1),b=void 0!==x&&it(x)?$("<a>").attr("href",x).attr("rel","noopener noreferrer").attr("target","_blank"):$("<span>");var H=qt(y,i);b.text(H).addClass(bt.class).data(ut,C);var E=z;if(E){var V={};if(E.fontFamily&&(V["font-family"]=ie(E.fontFamily,t)),E.fontSize){var me=Q.B.createFromCSS(E.fontSize);V["font-size"]=ne(me,t)}E.fontStyle&&(V["font-style"]=E.fontStyle),E.fontWeight&&(V["font-weight"]=E.fontWeight),E.color&&(V.color=E.color),E.textDecoration&&(V["text-decoration"]=E.textDecoration),E.scriptType&&(V.lineHeight="0"===E.lineHeight?"Normal":E.lineHeight,V.position=E.position,V.verticalAlign=E.verticalAlign,E.scriptType===st.Sub.toLowerCase()?V.bottom=E.bottom:V.top=E.top),b.css(V)}A&&b.on(O.Wo,function(){r.showUser(A);var j=b.get(0),U=j.getBoundingClientRect();n.stop(!0,!0).css({left:j.offsetLeft,top:j.offsetTop-U.height-32}).delay(200).queue(function(J){b.is(":hover")&&n.fadeIn("fast"),J()})}).on(O.xw,function(){n.delay(500).queue(function(j){!function J(ge){n.is(":hover")?setTimeout(function(){return J(ge)},500):ge()}(j)}).fadeOut("fast")}),c.append(b)},f=0,p=d.textRuns.length;f<p;++f)m(f);if(d.listType===lt.Bullet&&(c.css("display","inline"),(c=c.wrap("<ul><li></li></ul>").parent().parent()).css("text-align",d.horizontalTextAlignment)),d.listType===lt.Numbered){var g="list-style-type: decimal !important; list-style-position: inside !important;";c.css("display","inline"),1===a?((s=c=c.wrap("<ol><li></li></ol>").parent().parent()).children().attr("style",g),o=o.add(s)):a>1&&((c=c.wrap("<li></li>").parent()).attr("style",g),s.append(c)),c.css("text-align",d.horizontalTextAlignment)}else h&&c.append($("<br>")),o=o.add(c)}return o}function Zt(e){var t;return(t=Number(e))>=0&&t<=9?40*t:0}function Yt(e,t,i,n,r,o){for(var a,s,l,u=[],d=0,h=0,c=e.length;h<c;++h){for(var m=e[h],f=0,p=m.textRuns.length;f<p;++f){var g=m.textRuns[f],N=void 0,F=void 0,P=void 0;if(et(g))N=g.textStyle,F=g.url,P=g.value;else{if(!K(g)){v.fF.assertNever(g);continue}if(!_.isEmpty(g.cases)){var I=_.first(g.cases);_.isEmpty(I.textRuns)||(N=_.first(I.textRuns).textStyle,F=_.first(I.textRuns).url)}}var C={},b=N;b&&(b.fontFamily&&(C.font=(0,R._b)(Z(ee(b.fontFamily)))),b.fontSize&&(C.size=b.fontSize),b.color&&(C.color=b.color),C.italic="italic"===b.fontStyle||void 0,C.bold="bold"===b.fontWeight||void 0,C.underline="underline"===b.textDecoration||void 0,b.scriptType&&(C.script=b.scriptType));var y=P;F&&it(F)&&(C.link=F);var z=void 0;if((0,G.U)(y))z={attributes:C,insert:(a={},a[B.smartNarrativesBlotClass.class]={definition:g,destroyEditorActions:i.destroyEditorActions,evaluatedValues:t,localizationProvider:i.localizationProvider,objRef:x=y.selector.id,onSelectSmartNarrativesBlot:function(j){var U;null===(U=i?.smartNarrativesEditorContainer)||void 0===U||U.getSmartNarrativesEditor().onSelectEditableObject(j)},style:n},a)};else if(K(g)){var x=(0,G.U)(g.expression)?g.expression.selector.id:void 0,k={conditionalIndex:d,definition:g,destroyEditorActions:i.destroyEditorActions,evaluatedValues:t,localizationProvider:i.localizationProvider,objRef:x,onSelectSmartNarrativesBlot:function(U){var J;null===(J=i?.smartNarrativesEditorContainer)||void 0===J||J.getSmartNarrativesEditor().onSelectEditableObject(U)},onSelectSmartNarrativesConditionalBlot:function(U){setTimeout(function(){i?.setSelectionOfConditional(U)})},style:n};d++,z={attributes:C,insert:(s={},s[B.smartNarrativesConditionalBlotClass.class]=k,s)}}else z=It(g)?{attributes:C,insert:(l={},l[B.atMentionBlotClass.class]={email:g.mentionEmail,displayName:y,hoverContainer:r,personCardComponent:o},l)}:{attributes:C,insert:y};u.push(z)}var E={insert:"\n"};v.fF.assert(function(){return!_.endsWith(_.last(u).insert,"\n")},"paragraphs should not end in a new line");var V=te(m);V&&(E.attributes=V),u.push(E)}return u}function Xt(e,t){var i,n,r;if(e&&(r=ct(e)),t[B.atMentionBlotClass.class]&&!0!==t[B.atMentionBlotClass.class]){var o=t[B.atMentionBlotClass.class];n={mentionEmail:o.email,value:null!==(i=o.displayName)&&void 0!==i?i:o.email},r&&(n.textStyle=r)}return n}function _t(e,t){var i,n,r;if(e){var o=ct(e);o&&(n=o),void 0!==e.link&&it(e.link)&&(r=e.link)}if(t[B.smartNarrativesBlotClass.class]&&!0!==t[B.smartNarrativesBlotClass.class]){var s=t[B.smartNarrativesBlotClass.class].objRef;if(!s)return void v.fF.assertFail("Invalid narrative blot retrieved from QuillJS");if(s===nt)return;i={textStyle:n,url:r,value:{propertyIdentifier:M.RL.values.expr,selector:{id:s}}}}else if(t[B.smartNarrativesConditionalBlotClass.class]&&!0!==t[B.smartNarrativesConditionalBlotClass.class]){var l=t[B.smartNarrativesConditionalBlotClass.class];if(!K(l.definition))return void v.fF.assertFail("Invalid conditional retrieved from QuillJS");for(var u=0,d=(i=l.definition).cases;u<d.length;u++)for(var c=0,m=d[u].textRuns;c<m.length;c++)(f=m[c]).textStyle=n,f.url=r;for(var p=0,g=i.defaultCase.textRuns;p<g.length;p++){var f;(f=g[p]).textStyle=n,f.url=r}}return i}function it(e){if(_.isEmpty(e))return!1;switch((0,at.MN)(e)){case at.av.http:case at.av.https:case at.av.mailto:return!0;default:return!1}}function te(e){var t={};return e.horizontalTextAlignment&&(t.align=e.horizontalTextAlignment),e.listType&&(t.list=e.listType),e.indent&&(t.indent=e.indent),!_.isEmpty(t)&&t}function ct(e){var t={};if(e.bold&&(t.fontWeight="bold"),e.font){var i=(0,R._b)(_.unescape(e.font),!1);i=St(i),t.fontFamily=i}return e.italic&&(t.fontStyle="italic"),e.size&&(t.fontSize=e.size),e.underline&&(t.textDecoration="underline"),e.color&&(t.color=e.color),e.script&&(t.lineHeight="0",t.position="relative",t.verticalAlign="baseline",t.scriptType=e.script,e.script===st.Sub.toLowerCase()?t.bottom="-0.25em":t.top="-0.25em",e.indent&&(t.indent=e.indent)),t}function ee(e){return!_.startsWith(e,"'")||(0,$t.ms)(e,",")?e:(v.fF.assert(function(){return _.endsWith(e,"'")},"mismatched quotes"),e.slice(1,e.length-1))}function ie(e,t){var i=Z(e);return i!==t.family?i:void 0}function ne(e,t){return null==e||e.equals(t.size)?"":"".concat(e.pt,"pt")}var nt="__Placeholder__";function dt(e,t){var i;return void 0!==e&&!_.isString(e.insert)&&!_.isNumber(e.insert)&&void 0!==e.insert&&(i=e.insert[t]),i}var B=function(){function e(t,i,n,r,o,a,s,l,u,d){var h=this;this.readOnly=t,this.host=i,this.style=n,this.options=r,this.supportsAtMention=o,this.$mentionsHoverContainer=a,this.personCardComponent=s,this.placeholderText=l,this.supportsFormattingChangeIndication=u,this.hierarchicalTabbing=d,this.textChanged=_.noop,this.isDirty=!1,this.$container=$("<div>"),this.localizationProvider={get:function(m){return h.host.getLocalizedString(m)},getOptional:function(m){return h.host.getLocalizedString(m)},format:function(m){for(var f=[],p=1;p<arguments.length;p++)f[p-1]=arguments[p];return h.host.getLocalizedString(m,f)}}}return e.prototype.init=function(){return(0,S.__awaiter)(this,void 0,void 0,function(){var t;return(0,S.__generator)(this,function(i){switch(i.label){case 0:return(0,ye.mR)()?(this.initialized=!1,[4,this.host.loader().require({javascript:"quill",css:["quill.core"]})]):[3,3];case 1:return t=i.sent(),this.$container?[4,this.initializeQuill(t)]:[2];case 2:return i.sent(),[3,5];case 3:return[4,this.initializeQuill(window.Quill)];case 4:i.sent(),i.label=5;case 5:return[2]}})})},e.getFormatPath=function(t){return"".concat(e.quillFormatsPath,"/").concat(t)},e.prototype.updateOptions=function(t){if(v.fF.assertValue(t,"options"),this.initialized){this.options=t;var i=this.toolbar;i&&i.updateOptions(t),this.smartNarrativesEditorContainer&&this.smartNarrativesEditorContainer.updateOptions(t)}},e.prototype.initializeQuill=function(t){return(0,S.__awaiter)(this,void 0,void 0,function(){return(0,S.__generator)(this,function(i){switch(i.label){case 0:return this.quillStatic=t,[4,this.rebuildQuillEditor()];case 1:return i.sent(),this.initialized=!0,this.quillStatic.debug("error"),[2]}})})},e.prototype.getElement=function(){return this.$container},e.prototype.getContents=function(){if(this.initialized)return this.editor.getContents()},e.prototype.setContents=function(t){var i=this;v.fF.assert(function(){return i.initialized},"initialized"),this.editor&&this.editor.setContents(t)},e.prototype.resize=function(t){this.$container.width(t.width),this.$container.height(t.height),this.updateToolbar()},e.prototype.setSelection=function(t,i){this.editor&&this.editor.setSelection(t,i)},e.prototype.getSelection=function(t){if(this.editor)return this.editor.getSelection(t)},e.prototype.focus=function(){this.editor&&0===$(document.activeElement).closest(this.$container).length&&this.editor.focus()},e.prototype.destroy=function(){this.host.setToolbar(null),this.toolbar=null,this.$container.remove(),this.$container=null,this.destroyEditor()},e.prototype.destroyEditor=function(){this.editor&&(_.isEmpty(this.destroyEditorActions)||(_.forEach(this.destroyEditorActions,function(t){return t()}),this.destroyEditorActions=void 0),this.editor=null)},e.prototype.getSelectionAtCursor=function(){var t=this.getTextWithoutTrailingBreak(),i=this.getSelection(!0);if(i&&0===i.length){var n=(0,Fe.sE)(i.index,t);return{index:n.start,length:n.end-n.start}}return i},e.prototype.getWord=function(){var t=this.getSelectionAtCursor();return this.getTextWithoutTrailingBreak().slice(t.index,t.index+t.length)},e.prototype.getEditorContainer=function(){if(this.editor)return $(this.editor.container)},e.prototype.setSelectionOfConditional=function(t){var i=this.getContents();if(i)for(var n=0,r=0,o=i.ops;r<o.length;r++){var s=o[r];if(!s)return void v.fF.assertFail("ops should not be undefined");if(_.isString(s.insert))n+=s.insert.length;else if(_.isNumber(s.insert))n+=1;else{n+=1;var l=dt(s,e.smartNarrativesConditionalBlotClass.class);if(l?.conditionalIndex===t){this.setSelection(n,0);break}}}},e.computeTransparentSmartNarrativesColor=function(t){var i=(0,kt.WV)(t);return i.A=e.smartNarrativesPlaceholderOpacity,(0,kt.U8)(i)},e.prototype.getTextWithoutTrailingBreak=function(){return this.editor.getText().slice(0,-1)},e.prototype.rebuildQuillEditor=function(){var t;return(0,S.__awaiter)(this,void 0,void 0,function(){var i,n,r,o,a,s,l,u,h,c,m,f,p,g,N,F,P,C,b,y=this;return(0,S.__generator)(this,function(z){switch(z.label){case 0:return i=null,n=this.options.supportsNarrativeExpressions,this.editor&&(i=this.editor.getContents()),this.$container.empty(),this.$container.keydown(function(x){var A=x.which;x.ctrlKey&&(0,ot.iZ)(A)&&x.stopPropagation(),((0,ot.Wl)(A)||(0,ot.SF)(A))&&x.stopPropagation(),(0,ot.rH)(A)&&x.stopPropagation(),xe.M.isCtrlOrMeta(x)&&117===x.keyCode&&(y.focusToolbar(),x.stopPropagation())}),r=$("<div>"),a={readOnly:this.readOnly,formats:["bold","italic","underline","font","size","link","align","color","indent","script","list"],modules:{history:{userOnly:!0},keyboard:{bindings:{}}},placeholder:this.placeholderText},s=this.host.getUIComponentFactory(),l=[],this.supportsAtMention?(this.setupAtMentionFormat(),o=$("<div>"),l.push({mentionCharacter:"@",blotName:e.atMentionBlotClass.class,initialize:function(A,k){o.addClass(e.atMentionContainerClass.class).hide(),y.userSuggestionsComponent=A.createUserSuggestions(o.get(0),function(V){k({displayName:V.displayName,email:V.email,hoverContainer:y.$mentionsHoverContainer,personCardComponent:y.personCardComponent})})},hideSuggestions:function(){return o.hide(),y.userSuggestionsComponent.hideSuggestions()},renderSuggestions:function(A,k,H){o.css({left:k,top:H}).show(),y.userSuggestionsComponent.showSuggestions(A)},pickSuggestion:function(){return y.userSuggestionsComponent.pickSuggestion()},navigateSuggestions:function(A){return y.userSuggestionsComponent.navigateSuggestions(A)}}),a.formats.push(e.atMentionBlotClass.class),a.modules.keyboard.bindings.enter={handler:u=function(){for(var A=!0,k=0,H=l;k<H.length;k++)A=H[k].pickSuggestion();return A},key:13},a.modules.keyboard.bindings.tab={handler:u,key:9}):this.hierarchicalTabbing&&(a.modules.keyboard.bindings.tab={handler:function(){return!0},key:9}),_.isEmpty(l)||(a.modules.mention={save:function(){return y.saveState()},mentions:l,maxSearchLength:Mt,componentFactory:s},this.registerMentionModule()),n&&(a.formats.push(e.smartNarrativesBlotClass.class),a.formats.push(e.smartNarrativesConditionalBlotClass.class),a.formats.push(e.smartNarrativesFocusFormatAttributeName)),h=ae(this.localizationProvider),c=Bt.buildNode(h),this.readOnly?[3,4]:(m=this.toolbar,this.toolbar?[3,2]:(f=this,[4,re.createToolbar(this.host,this,this.localizationProvider,c,this.options)]));case 1:return m=f.toolbar=z.sent(),(F=m.getElement()).addClass("unselectable"),F.toggleClass("high-contrast",this.style.isHighContrast),a.modules.toolbar={container:F.get(0)},[3,3];case 2:m.updateOptions(this.options),z.label=3;case 3:r.attr("drag-resize-disabled","true"),z.label=4;case 4:return this.destroyEditor(),this.destroyEditorActions=[],n&&(this.setUpSmartNarrativesFormat(),this.setUpSmartNarrativesConditionalFormat(),this.setUpSmartNarrativesFocusFormat()),this.editor=new this.quillStatic(r.get(0),a),this.readOnly||(p=new Bt(c,this.editor,this.quillStatic,this.toolbar,this.options.featureSwitches),g=function(A){A?(y.editor.setSelection(y.getSelectionAtCursor()),p.open()):p.remove()},e.setUpFontFormat(this.quillStatic),(N=this.editor.getModule("toolbar")).addHandler("link",g),s&&(F=this.toolbar.getElement(),P=new Y({quill:this.editor,uiComponentFactory:s,$colorSwatch:F.find(Y.colorSwatchGlyphClassAndSelector.selector),$colorPickerButton:F.find(Y.pickerButtonClassAndSelector.selector),$colorPickerButtonWrapper:F.find(Y.pickerButtonWrapperClassAndSelector.selector),defaultColor:X.v.getThemeColor(this.style,Se.fA),format:"color"}),N.addHandler("color",function(){return P.applyFormat(P.getColor())})),this.destroyEditorActions.push(function(){N.addHandler("link",void 0),N.addHandler("color",void 0)}),n&&s&&(this.smartNarrativesEditorContainer=new fe({container:this.toolbar.getElement(),destroyEditorActions:this.destroyEditorActions,evaluatedValues:this.options.evaluatedValues,hostServices:this.host,localizationProvider:this.localizationProvider,onEditSmartNarrativePersist:this.textChanged,quill:this.editor,style:this.style,toolbar:this.toolbar}),this.smartNarrativesEditorContainer.getSmartNarrativesEditor()),this.supportsFormattingChangeIndication&&(this.formattingSettingsContainer=new pe({container:this.toolbar.getElement(),hostServices:this.host}),this.formattingSettingsContainer.getTextboxFormattingSettings()),this.updateToolbar()),this.$container?(this.$container.append(r),this.$mentionsHoverContainer&&this.$container.append(this.$mentionsHoverContainer),o&&this.$container.append(o),i&&this.setContents(i),n||this.supportsFormattingChangeIndication?(this.editor.keyboard.addBinding({key:83,shiftKey:!0,shortKey:!0},void 0,function(){y.saveState()}),this.editor.on("text-change",C=function(A,k,H){"api"!==H&&(y.isDirty=!0)}),this.destroyEditorActions.push(function(){y.editor.off("text-change",C),C=void 0})):this.throttleTextChanged(),this.supportsFormattingChangeIndication&&!(null===(t=this.formattingSettingsContainer.getTextboxFormattingSettings())||void 0===t)&&t.shouldListenToTextChanged()&&this.throttleTextChanged(),this.editor.root.addEventListener("blur",b=function(A){var k=A.relatedTarget||document.activeElement;k&&(y.targetIsInToolbar(k,n)||((n||y.supportsFormattingChangeIndication)&&y.saveState(),e.willBrowserHandleFocus(k)))||y.setSelection(null,null)},!1),this.destroyEditorActions.push(function(){y.editor.root.removeEventListener("blur",b,!1)}),[2]):[2]}})})},e.prototype.throttleTextChanged=function(){var i,t=this,n=_.debounce(function(){return t.onTextChanged()},null!==(i=this.options.textChangeThrottle)&&void 0!==i?i:e.textChangeThrottle),r=function(a,s,l){if("api"!==l){t.isDirty=!0;for(var u=0,d=a.ops;u<d.length;u++){var h=d[u];if(e.isInsertOp(h)){var c=h.insert;if(c&&(0,$t.Oi)(c))return t.onTextChanged(),void n.cancel()}}n()}};this.editor.on("text-change",r),this.destroyEditorActions.push(function(){t.editor.off("text-change",r),n.cancel(),n=void 0}),this.onPaste&&this.$container.on("paste",function(){return setTimeout(function(){return t.onPaste()},0)})},e.setUpFontFormat=function(t){var i=t.import("parchment"),n=t.import(e.getFormatPath("font"));n.value=function(r){var o=e.camelize(n.keyName);return _.escape((0,R._b)(r.style[o]))},n.canAdd=function(r,o){return null!=i.query(r,i.Scope.BLOT&(n.scope|i.Scope.TYPE))&&(null==n.whitelist||n.whitelist.indexOf((0,R._b)(_.unescape(o)))>-1)},n.add=function(r,o){if(!n.canAdd(r,o))return!1;var a=e.camelize(n.keyName),s=(0,R._b)(_.unescape(o));return r.style[a]=s,!0}},e.prototype.isFormatRegisteredWithQuill=function(t){v.fF.assertValue(this.quillStatic,"quillStatic");var i=this.quillStatic.imports;return!_.isEmpty(i)&&!!i[e.getFormatPath(t)]},e.prototype.setUpSmartNarrativesFormat=function(){if(!this.isFormatRegisteredWithQuill(e.smartNarrativesBlotClass.class)){var i=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return(0,S.__extends)(r,n),r.create=function(o){v.fF.assertValue(o,"options");var l,a=n.create.call(this,o.objRef),s=X.v.getDataColorByIndex(o.style,0);if(o.objRef===nt){l=this.placeholderText;var u=e.computeTransparentSmartNarrativesColor(s);$(a).addClass(e.smartNarrativesPlaceholderClass.class).css("background-color",u)}else{l=vt(o.objRef,o.evaluatedValues)||"";var d="".concat(O.NN).concat(e.smartNarrativesBlotClass.selector);o.destroyEditorActions&&($(a).on(d,function(){o.onSelectSmartNarrativesBlot(o.objRef)}),o.destroyEditorActions.push(function(){$(a).off(d)}))}return $(a).attr(e.smartNarrativesBlotClass.class,o.objRef).attr(O.bd,"false").css("border-bottom","1px solid ".concat(s)).data(e.smartNarrativesBlotClass.class,o),l?$(a).text(l):e.appendHiddenSmartNarrativesDisplay(a,o.localizationProvider.get("Visual_SmartNarratives_TextBox_Hidden")),a},r.value=function(o){return $(o).data(e.smartNarrativesBlotClass.class)},r.blotName=e.smartNarrativesBlotClass.class,r.className=e.smartNarrativesBlotClass.class,r.placeholderText="                ",r.tagName="span",r}(this.quillStatic.import("blots/embed"));this.quillStatic.register(i)}},e.prototype.setUpSmartNarrativesConditionalFormat=function(){if(!this.isFormatRegisteredWithQuill(e.smartNarrativesConditionalBlotClass.class)){var i=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return(0,S.__extends)(r,n),r.create=function(o){if(v.fF.assertValue(o,"options"),K(o.definition)){var a=n.create.call(this,o.objRef),s="".concat(O.NN).concat(e.smartNarrativesConditionalBlotClass.selector);$(a).attr(e.smartNarrativesConditionalBlotClass.class,o.objRef).attr(O.bd,"false").data(e.smartNarrativesConditionalBlotClass.class,o);for(var l=!1,u=pt(o.definition,o.evaluatedValues),d=X.v.getDataColorByIndex(o.style,0),h=function(g){var N=$("<span>");if((0,G.U)(g.value)){var F=g.value.selector.id,P=vt(F,o.evaluatedValues);if(!P)return"continue";var I=P;N.addClass(e.smartNarrativesBlotClass.class).css("border-bottom","1px solid ".concat(d)).text(I),o.destroyEditorActions&&(N.on(s,function(){o.onSelectSmartNarrativesBlot(F)}),o.destroyEditorActions.push(function(){N.off(s)}))}else g.value===M.d$?(N.text(M.mj),l=!0):N.text(g.value);$(a).append(N)},c=0,m=u;c<m.length;c++)h(m[c]);return 0===a.childElementCount?e.appendHiddenSmartNarrativesDisplay(a,o.localizationProvider.get("Visual_SmartNarratives_TextBox_Hidden")):a.innerText===M.mj&&($(a).addClass(e.smartNarrativesNewlineClass.class).attr(O.bd,"true").empty().text(M.mj),l&&$(a).addClass(e.smartNarrativesHiddenClass.class)),o.destroyEditorActions&&($(a).on(s,function(){o.onSelectSmartNarrativesConditionalBlot(o.conditionalIndex)}),o.destroyEditorActions.push(function(){$(a).off(s)})),a}},r.value=function(o){return $(o).data(e.smartNarrativesConditionalBlotClass.class)},r.blotName=e.smartNarrativesConditionalBlotClass.class,r.className=e.smartNarrativesConditionalBlotClass.class,r.tagName="span",r}(this.quillStatic.import("blots/embed"));this.quillStatic.register(i)}},e.prototype.setUpSmartNarrativesFocusFormat=function(){var t,i=e.getFormatPath(e.smartNarrativesFocusFormatAttributeName);if(!this.isFormatRegisteredWithQuill(i)){var n=this.quillStatic.import(e.getFormatPath("background"));n.attrName=e.smartNarrativesFocusFormatAttributeName,this.quillStatic.register(((t={})[i]=n,t))}},e.prototype.setupAtMentionFormat=function(){if(!this.isFormatRegisteredWithQuill(e.atMentionBlotClass.class)){var i=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return(0,S.__extends)(r,n),r.create=function(o){var a;v.fF.assertValue(o,"options");var s=n.create.call(this,o.email);return $(s).attr(e.atMentionBlotClass.class,o.email).attr(O.bd,"false").data(e.atMentionBlotClass.class,o).on(O.Wo,function(){o.personCardComponent.showUser(o.email);var l=s.getBoundingClientRect();o.hoverContainer.stop(!0,!0).css({left:s.offsetLeft,top:s.offsetTop-l.height-r.topPaddingOffset}).delay(200).queue(function(u){$(s).is(":hover")&&o.hoverContainer.fadeIn("fast"),u()})}).on(O.xw,function(){o.hoverContainer.delay(500).queue(function(l){!function d(h){o.hoverContainer.is(":hover")?setTimeout(function(){return d(h)},500):h()}(l)}).fadeOut("fast")}).css("color","#1453b3").text(null!==(a="@"+o.displayName)&&void 0!==a?a:o.email),s},r.value=function(o){return $(o).data(e.atMentionBlotClass.class)},r.blotName=e.atMentionBlotClass.class,r.className=e.atMentionBlotClass.class,r.tagName="span",r.topPaddingOffset=24,r}(this.quillStatic.import("blots/embed"));this.quillStatic.register(i)}},e.prototype.registerMentionModule=function(){this.quillStatic.imports["modules/mention"]||this.quillStatic.register("modules/mention",function(){function i(n,r){var o=this;this.options=r,this.quill=n,v.fF.assert(function(){return!_.isEmpty(r.mentions)},"No mention configuration"),n.on("text-change",function(d,h,c){return o.onTextChange(d,h,c)});for(var a=function(h){v.fF.assert(function(){return 1===h.mentionCharacter.length},"Expected single mention character"),h.initialize(r.componentFactory,function(c){return o.insertBlot(h.blotName,c)})},s=0,l=r.mentions;s<l.length;s++)a(l[s]);this.addKeyBindings()}return i.prototype.addKeyBindings=function(){var n=this,r=function(s){for(var l=!0,u=0,d=n.options.mentions;u<d.length;u++)l=d[u].navigateSuggestions(s);return l};this.quill.keyboard.addBinding({key:40},void 0,function(){return r(0)}),this.quill.keyboard.addBinding({key:38},void 0,function(){return r(1)}),this.quill.keyboard.addBinding({key:27},void 0,function(){return function(){for(var s=!0,l=0,u=n.options.mentions;l<u.length;l++)s=u[l].hideSuggestions();return s}()})},i.prototype.onTextChange=function(n,r,o){var a;if("user"===o){this.insertPosition=void 0,this.currentPosition=void 0;var s=this.quill.getSelection();if(s){this.currentPosition=s.index;var l=Math.max(0,this.currentPosition-this.options.maxSearchLength),u=this.quill.getText(l,this.currentPosition-l),d=(a=this.getMentionConfig(u)).mentionConfig,h=a.mentionCharacterPosition;if(!d)return void this.hideAllSuggestions();for(var c=u.substring(h+1),m=0,f=this.options.mentions;m<f.length;m++){var p=f[m];p!==d&&p.hideSuggestions()}this.insertPosition=this.currentPosition-c.length-1;var g=this.quill.getBounds(this.insertPosition),N=this.quill.root.getBoundingClientRect(),F=Math.min(g.left,N.width-i.SuggestionWidth);d.renderSuggestions(c,F,g.height+g.bottom)}}},i.prototype.getMentionConfig=function(n){for(var r=0,o=this.options.mentions;r<o.length;r++){var a=o[r],s=n.lastIndexOf(a.mentionCharacter);if(-1!==s)return{mentionConfig:a,mentionCharacterPosition:s}}return{mentionConfig:void 0,mentionCharacterPosition:-1}},i.prototype.insertBlot=function(n,r){this.hideAllSuggestions(),!_.isNil(this.insertPosition)&&!_.isNil(this.currentPosition)&&(this.quill.deleteText(this.insertPosition,this.currentPosition-this.insertPosition,"api"),this.quill.insertEmbed(this.insertPosition,n,r,"api"),this.quill.setSelection(this.insertPosition+1,0,"api"),this.options.save())},i.prototype.hideAllSuggestions=function(){for(var n=0,r=this.options.mentions;n<r.length;n++)r[n].hideSuggestions()},i.SuggestionWidth=200,i}())},e.willBrowserHandleFocus=function(t){return"SELECT"===t.tagName||"INPUT"===t.tagName||!!t.getAttribute("contentEditable")},e.prototype.targetIsInToolbar=function(t,i){if(!this.toolbar)return!1;if("A"===t.tagName||"BUTTON"===t.tagName||i){var n=$(t),r=this.toolbar.getElement();return r.is(":visible")&&(n.is(r)||n.closest(r).length>0)}return!1},e.prototype.onTextChanged=function(){var t;this.textChanged(),this.supportsFormattingChangeIndication&&(null===(t=this.formattingSettingsContainer.getTextboxFormattingSettings())||void 0===t||t.onTextChanged())},e.prototype.saveState=function(){var t,i;null===(i=null===(t=this.editor)||void 0===t?void 0:t.history)||void 0===i||i.clear(),this.onTextChanged()},e.isInsertOp=function(t){return null!=t.insert},e.camelize=function(t){var i=t.split("-"),n=_.map(i.slice(1),function(r){return r[0].toUpperCase()+r.slice(1)}).join("");return i[0]+n},e.prototype.focusToolbar=function(){if(!this.editor||!this.toolbar)return!1;ft.IK.focusChildInGroup(this.toolbar.getElement().get(0))},e.appendHiddenSmartNarrativesDisplay=function(t,i){var n=$("<span>"),r=$("<span>"),o=$("<span>");n.text("["),r.addClass("glyphicon glyph-mini pbi-glyph-hide3"),o.text("]"),$(t).addClass(e.smartNarrativesHiddenClass.class).append(n,r,o).attr("title",i)},e.prototype.updateToolbar=function(){var t;if(this.toolbar){var i=null===(t=this.options)||void 0===t?void 0:t.supportsNarrativeExpressions;this.host.setToolbar(this.toolbar.getElement(),{preferHorizontalLayout:i,theme:i?"neutralGrayTheme":"darkTheme"})}},e.quillFormatsPath="formats",e.atMentionBlotClass=(0,w.CH)("at-mention"),e.atMentionContainerClass=(0,w.CH)("mentions-container"),e.smartNarrativesBlotClass=(0,w.CH)("smart-narratives-blot"),e.smartNarrativesConditionalBlotClass=(0,w.CH)("smart-narratives-conditional-blot"),e.smartNarrativesFocusFormatAttributeName="smartNarrativesFocus",e.smartNarrativesHiddenClass=(0,w.CH)("smart-narratives-hidden"),e.smartNarrativesNewlineClass=(0,w.CH)("smart-narratives-newline"),e.smartNarrativesPlaceholderClass=(0,w.CH)("placeholder"),e.smartNarrativesPlaceholderOpacity=.2,e.textChangeThrottle=600,e}(),re=function(){function e(t,i,n,r,o){this.host=t,this.quillWrapper=i,this.localizationProvider=n,this.linkInput=r}return e.createToolbar=function(t,i,n,r,o){return(0,S.__awaiter)(this,void 0,void 0,function(){var a;return(0,S.__generator)(this,function(s){switch(s.label){case 0:return[4,(a=new e(t,i,n,r,o)).init(n,o)];case 1:return s.sent(),[2,zt.J.resolve(a)]}})})},e.prototype.init=function(t,i){return(0,S.__awaiter)(this,void 0,void 0,function(){var n,r,o,a,s,l,u,d,h,c,m,f,p,g,N,F,P,I,C;return(0,S.__generator)(this,function(b){switch(b.label){case 0:return this.featureSwitches=i.featureSwitches,this.updateOptions(i),n=i.hierarchicalTabbing?"Hierarchy":"Group",r=Y.buildFontColorButtons(t.get("Visual_FontColor"),t.get("Visual_FontColor_Picker"),i.onRenderTooltip),o=this.container=W().addClass("toolbar").addClass("themeableElement").attr("aria-label",L("FontControl",t)).attr("focus-nav-mode",n),a=q(),_.size(this.fontFamilies)>1&&a.append(this.fontFamilyPicker),_.size(this.fontSizes)>1&&a.append(this.fontSizePicker),s=D(i.onRenderTooltip,L("Bold",t),"bold",void 0,void 0,void 0),l=D(i.onRenderTooltip,L("Italic",t),"italic",null,"italic",!0),u=D(i.onRenderTooltip,L("Underline",t),"underline",void 0,void 0,void 0),d=D(i.onRenderTooltip,L("BulletedList",t),"list","bullet","bulletedlist",!0),h=D(i.onRenderTooltip,L("NumberedList",t),"list","ordered","numberedlist",!0),c=L("Link",t),m=D(i.onRenderTooltip,c,"link",void 0,void 0,void 0),f=W().addClass("toolbar-content"),this.featureSwitches&&this.featureSwitches.onObject?(o.addClass("on-object"),f.addClass("on-object"),p=W().append(a),g=W().append(q().append(s).append(l).append(u)).append(q().append(this.textAlignmentGroup)).append(r),this.featureSwitches.textboxSuperSubScriptBulletedList&&(p.append(q().append(d)).append(q().append(h)),g.append(q().append(this.textScriptGroup))),p.append(q().append(this.textIndentGroup)),N=W().append(p).append(g),f.append(N).append(Nt()),F=this.host.getUIComponentFactory(),(I=F)?[4,this.getAddLinkContainer(c,F)]:[3,2]):[3,3];case 1:I=b.sent(),b.label=2;case 2:return(P=I)&&f.append(P).append(Nt()),[3,4];case 3:a.append(r),f.append(a).append(q().append(s).append(l).append(u)).append(q().append(this.textAlignmentGroup)).append(q().append(this.textIndentGroup)).append(q().append(m).append(this.linkInput)),this.featureSwitches&&this.featureSwitches.textboxSuperSubScriptBulletedList&&(f.append(q().append(this.textScriptGroup)).append(q().append(d)).append(q().append(h)),f.css("width",this.getWidth()+"px")),b.label=4;case 4:return o.append(f),i.supportsNarrativeExpressions&&(f.addClass("fixed-size"),o.append(se())),i.supportsFormattingChangeIndication&&!this.quillWrapper.readOnly&&o.append(le()),(C=this.onEscape)&&o.on("keydown",function(y){27===y.keyCode&&(y.stopPropagation(),y.preventDefault(),C())}),[2]}})})},e.prototype.getAddLinkContainer=function(t,i){return(0,S.__awaiter)(this,void 0,void 0,function(){var n;return(0,S.__generator)(this,function(s){switch(s.label){case 0:return n=q(),[4,new ve({inputArgs:{disabled:!1,iconName:"WebGetLink_16",iconColors:[""],label:t,title:t},outputArgs:{clicked:function(){},ready:function(){}},uiComponentFactory:i}).attach(n)];case 1:return s.sent(),n.find("button").addClass("ql-link"),n.append(this.linkInput),[2,zt.J.resolve(n)]}})})},e.prototype.getElement=function(){return this.container},e.prototype.updateOptions=function(t){v.fF.assertValue(t,"options");var i=t.defaultFont;this.onEscape=t.onEscape,this.updateFontFamilyUI(i,t.fontFamilies,t.onRenderTooltip),this.updateFontSizeUI(i,t.fontSizes,t.onRenderTooltip),this.updateTextAlignmentUI(t.onRenderTooltip),this.updateTextIndent(t.onRenderTooltip),this.featureSwitches&&this.featureSwitches.textboxSuperSubScriptBulletedList&&this.updateTextScriptUI(t.onRenderTooltip)},e.prototype.updateFontSizeUI=function(t,i,n){var r="size",o=B.getFormatPath(r);this.updateStyleAllowList(this.quillWrapper.quillStatic,r,null,o,!0),this.fontSizes=_.map(i,function(a){return{label:"".concat(a),value:"".concat(a,"pt")}}),this.defaultFontSize="".concat(t.size.pt,"pt"),this.fontSizePicker?Ft(this.fontSizePicker,this.fontSizes,this.defaultFontSize):this.fontSizePicker=xt(L("Size",this.localizationProvider),this.fontSizes,"size",this.defaultFontSize,n)},e.prototype.updateFontFamilyUI=function(t,i,n){var r="font",o=i.map(function(s){return(0,R._b)(Z(s))}),a=B.getFormatPath(r);this.updateStyleAllowList(this.quillWrapper.quillStatic,r,o,a,!0),this.fontFamilies=_.map(i,function(s){return{label:s,value:_.escape((0,R._b)(Z(s)))}}),this.defaultFontFamily=_.escape((0,R._b)(Z(t.family))),this.fontFamilyPicker?Ft(this.fontFamilyPicker,this.fontFamilies,this.defaultFontFamily):this.fontFamilyPicker=xt(L("Font",this.localizationProvider),this.fontFamilies,"font",this.defaultFontFamily,n,function(s,l){return s.css("font-family",l.value),s})},e.prototype.updateTextAlignmentUI=function(t){var n=this.defaultTextAlignment=Ot;this.textAlignments=_.map(Wt,function(s){var l=s.toLowerCase();return{label:s,value:s===n?"":l,glyph:"align".concat(l)}});var o=_.map(this.textAlignments,function(s){return s.value}),a=B.getFormatPath("align");this.updateAllowList(this.quillWrapper.quillStatic,a,o),this.textAlignmentGroup||(this.textAlignmentGroup=ht(0,this.textAlignments,"align",0,this.localizationProvider,!1,t))},e.prototype.updateTextIndent=function(t){this.textIndent=_.map(Ut,function(n){return{label:"".concat("+1"===n?"Increase":"Decrease","Indent"),value:n,glyph:"+1"===n?"increaseindent":"decreaseindent"}}),this.textIndentGroup||(this.textIndentGroup=ht(0,this.textIndent,"indent",0,this.localizationProvider,!0,t))},e.prototype.updateTextScriptUI=function(t){this.textScripts=_.map(st,function(a){var s=a.toLowerCase();return{label:a,value:s,glyph:s+"script"}});var r=_.map(this.textScripts,function(a){return a.value}),o=B.getFormatPath("script");this.updateAllowList(this.quillWrapper.quillStatic,o,r),this.textScriptGroup||(this.textScriptGroup=ht(0,this.textScripts,"script",0,this.localizationProvider,!0,t))},e.prototype.updateStyleAllowList=function(t,i,n,r,o){void 0===o&&(o=!1),this.updateAllowList(t,"attributors/style/"+i,n,r,o)},e.prototype.updateAllowList=function(t,i,n,r,o){void 0===o&&(o=!1);var a=t.import(i);v.fF.assertValue(a,'No attributor was found in the path "'+i+'"'),a.whitelist=n,t.register(r||i,a,o)},e.prototype.getWidth=function(){return 750},e}();function oe(e,t,i,n){return $('\n                        <a href="#" class="ql-preview" target="_blank"></a>\n                        <input class="input" type="text" aria-label="'.concat(n,'">\n                        <span class="bar">&nbsp;|&nbsp;</span>\n                        <button class="ql-action ql-save">').concat(t,'</button>\n                        <button class="ql-action ql-edit">').concat(i,'</button>\n                        <button class="ql-remove">').concat(e,"</button>\n                    "))}function ae(e){var t=W(),i=e.get("RichTextbox_Link_Done"),n=e.get("RichTextbox_Link_Remove"),r=e.get("RichTextbox_Link_Edit"),o=L("Link",e);return t.append(oe(n,i,r,o)),t.html()}function q(){return ue().addClass("ql-formats")}function se(){return W().addClass(Et.class)}function le(){return W().addClass(At.class)}function W(){return $("<div>")}function ue(){return $("<span>")}function ce(){return $("<button>")}function ht(e,t,i,n,r,o,a){return t.map(function(l){var u=null!=l.glyph?l.glyph:i+l.value;return D(a,L(l.label,r),i,l.value,u,o)})}function xt(e,t,i,n,r,o){return de(e,t,r,n,o).addClass("ql-"+i+" ql-picker")}function Ft(e,t,i,n){return he(e,t,i,n)}function de(e,t,i,n,r){var o=$("<select>").attr("aria-label",e).addClass("themeableElementCustom").append(Tt(t,n,r));return rt(o,e,i),o}function he(e,t,i,n){return e.empty().append(Tt(t,i,n))}function Tt(e,t,i){return _.map(e,function(n){var r=$("<option>").text(n.label);return n.value===t?r.attr("selected","selected"):r.attr("value",n.value),void 0!==i&&(r=i(r,n)),r})}function rt(e,t,i){var n;e.on("focus mouseenter",function(r){n=i(e.get(0),t)}),e.on("blur mouseleave",function(r){n&&n.close(),n=null}),e.on("keydown",function(r){n&&27===r.keyCode&&(event.stopPropagation(),event.preventDefault(),n.close(),n=null)})}function D(e,t,i,n,r,o){var a=ce();return a.attr("aria-label",t),rt(a,t,e),a.on("click",function(s){s.target.setAttribute("aria-pressed",a.hasClass("ql-active")?"false":"true")}),null!=i&&a.addClass("ql-"+i),null!=n&&a.attr("value",n),null==r&&(null!=i&&(r=i),null!=n&&(r=(r||"")+n)),a.addClass("themeableElementCustom"),null!=r&&o?(a.addClass("pbi-glyph-"+r),a.addClass(i),a.css("font-family","PowrMDL2")):a.addClass("powervisuals-glyph "+r),a}function L(e,t){return t.get("RichTextbox_"+e+"_ToolTip")}function Nt(){return W().addClass("vertical-divider")}var Et=(0,w.CH)("smart-narratives-editor"),At=(0,w.CH)("formatting-settings"),Bt=function(){function e(t,i,n,r,o){var a=this;v.fF.assertValue(t,"container must have a value"),v.fF.assertValue(i,"quill must have a value"),v.fF.assertValue(n,"quillStatic"),this.$container=t,this.quill=i,this.quillStatic=n,this.$preview=this.$container.find("a.ql-preview"),this.$textbox=this.$container.find("input[type=text]"),this.textbox=this.$textbox[0],this.$action=this.$container.find(".ql-action"),this.toolbar=r,this.hide(),this.featureSwitches=o,this.$textbox.on("keydown",function(s){13===s.keyCode?a.onSave(s):27===s.keyCode&&a.onHide(s)}),["click","touchstart"].forEach(function(s){a.$action.on(s,function(l){a.$container.hasClass(e.editingClass)?a.onSave(l):a.onEdit(l)}),a.$container.find(".ql-remove").on(s,function(l){return a.onRemove(l)})}),i.on("selection-change",function(s){var l;if(null!=s||!a.isEditing){if(a.toolbar.getElement().find(".toolbar-content > .ql-formats > button").each(function(c,m){$(m).attr("aria-pressed",$(m).hasClass("ql-active")?"true":"false")}),null!=s&&0===s.length){if(l=i.scroll.descendant(a.quillStatic.import(B.getFormatPath("link")),s.index),a.link=l[0],null!=a.link){var d={index:s.index-l[1],length:a.link.length()};return void(_.isEqual(a.range,d)||(a.range=d,a.show(),a.updateToolbarWidth()))}s.index>0&&i.scroll.descendant(a.quillStatic.import(B.getFormatPath("link")),s.index-1)[0]&&setTimeout(function(){return a.quill.format("link",!1)})}a.hide(),a.updateToolbarWidth()}})}return e.buildNode=function(t){return W().addClass(ke.toolbarUrlInput.class).append($(t))},e.prototype.onHide=function(t){this.hide(),this.stopEvent(t),this.updateToolbarWidth()},e.prototype.onSave=function(t){this.save(),this.stopEvent(t),this.updateToolbarWidth()},e.prototype.onEdit=function(t){this.edit(),this.stopEvent(t),this.updateToolbarWidth()},e.prototype.onRemove=function(t){this.remove(),this.stopEvent(t),this.updateToolbarWidth()},e.prototype.stopEvent=function(t){t.stopPropagation(),t.preventDefault()},e.prototype.edit=function(){this.isEditing=!0,this.$container.addClass(e.editingClass),this.$textbox.focus(),this.textbox.setSelectionRange(0,this.textbox.value.length)},e.prototype.open=function(){this.range=this.quill.getSelection(),this.show(),this.edit(),this.updateToolbarWidth()},e.prototype.hide=function(){this.range=this.link=null,this.$container.hide(),this.isEditing=!1},e.prototype.remove=function(){this.range=this.range||this.quill.getSelection(),this.quill.formatText(this.range,"link",!1,"user"),this.quill.setSelection(this.range,"silent"),this.hide(),this.updateToolbarWidth()},e.prototype.save=function(){var t=this.range,i=this.textbox.value;0===t.length&&(this.quill.insertText(this.range.index,i),this.quill.setSelection(this.range.index,i.length),t=this.range=this.quill.getSelection()),this.quill.formatText(t.index,t.length,"link",i,"user"),this.quill.setSelection(t,"silent"),this.link=this.quill.scroll.descendant(this.quillStatic.import(B.getFormatPath("link")),t.index)[0],this.show()},e.prototype.show=function(){this.isEditing=!1,this.$container.removeClass(e.editingClass),this.$container.show();var t,i=this.range=this.range||this.quill.getSelection();null!=this.link?t=this.link.formats().link:(t=this.quill.getText(i.index,i.length),t=Qt.format(t)),this.$textbox.val(t),this.$preview.text(t),this.$preview.attr("href",t)},e.prototype.updateToolbarWidth=function(){this.featureSwitches&&!this.featureSwitches.onObject&&this.toolbar.getElement().find(".toolbar-content").css("width",this.toolbar.getWidth()+this.getWidth()+"px")},e.prototype.getWidth=function(){return this.$container.get(0).offsetWidth},e.editingClass="ql-editing",e}(),Y=function(){function e(t){var i=this;v.fF.assertValue(t,"options"),this.quill=t.quill,this.uiComponentFactory=t.uiComponentFactory,this.$colorSwatch=t.$colorSwatch,this.$colorPickerButtonWrapper=t.$colorPickerButtonWrapper,this.defaultColor=t.defaultColor,this.format=t.format,this.currentColor=t.defaultColor,this.setSwatch(this.currentColor),t.$colorPickerButton.on("click",function(n){n.stopPropagation(),i.toggle()})}return e.buildFontColorButtons=function(t,i,n){var r=$("<span></span>").addClass("powervisuals-glyph themeableElementCustom").addClass(e.colorGlyphClassAndSelector.class),o=$("<span></span>").addClass("powervisuals-glyph themeableElementCustom").addClass(e.colorSwatchGlyphClassAndSelector.class),a=$("<button>").addClass("ql-color themeableElementCustom").addClass(e.colorButtonClassAndSelector.class).attr("aria-label",t).val("false").append(r).append(o),s=$("<button>").addClass("colorpicker powervisuals-glyph chevrondown themeableElementCustom").addClass(e.pickerButtonClassAndSelector.class).attr("aria-label",i).val("false");return rt(a,t,n),rt(s,i,n),[a,$("<div>").addClass(e.pickerButtonWrapperClassAndSelector.class).append(s)]},e.prototype.onColorChange=function(t){this.currentColor.toUpperCase()!==t.toUpperCase()&&(this.setSwatch(t||this.defaultColor),this.applyFormat(t||null,this.range),this.currentColor=t)},e.prototype.onClose=function(){var t=this.ensureRange();this.quill.setSelection(t.index,t.length),this.quill.format(this.format,!!this.color&&this.color,"user")},e.prototype.getColor=function(){return this.currentColor},e.prototype.applyFormat=function(t,i){var n=this.ensureRange(i);this.color=t,t&&t!==this.defaultColor?(this.quill.formatText(n.index,n.length,this.format,t,"user"),this.quill.format(this.format,this.color,"user")):(this.quill.formatText(n.index,n.length,this.format,!1,"user"),this.quill.format(this.format,!1,"user"))},e.prototype.toggle=function(){this.range=this.ensureRange(),this.getColorPicker().toggle()},e.prototype.getColorPicker=function(){var t=this,i=this.$colorPickerButtonWrapper.get(0);return this.colorPicker=this.uiComponentFactory.createColorPicker(i.firstChild,{value:this.getRangeColor()},function(n){return t.onColorChange(n&&n.value)},function(){return t.onClose()}),this.colorPicker},e.prototype.getRangeColor=function(){var t=this.quill.getSelection();if(!t)return this.defaultColor;var i=this.quill.getFormat(t.index,t.length);return"string"==typeof i?.color?i.color:this.defaultColor},e.prototype.setSwatch=function(t){this.$colorSwatch.get(0).style.setProperty("color",t,"important")},e.prototype.ensureRange=function(t){return this.quill.focus(),t||this.quill.getSelection()||{index:0,length:0}},e.colorGlyphClassAndSelector=(0,w.CH)("fontcolor"),e.colorSwatchGlyphClassAndSelector=(0,w.CH)("fontcolorswatch"),e.colorButtonClassAndSelector=(0,w.CH)("fontcolorbutton"),e.pickerButtonClassAndSelector=(0,w.CH)("fontcolorpicker"),e.pickerButtonWrapperClassAndSelector=(0,w.CH)("fontcolorbutton-wrapper"),e}(),fe=function(){function e(t){this.container=t.container,this.destroyEditorActions=t.destroyEditorActions,this.evaluatedValues=t.evaluatedValues,this.hostServices=t.hostServices,this.localizationProvider=t.localizationProvider,this.onEditSmartNarrativePersist=t.onEditSmartNarrativePersist,this.quill=t.quill,this.style=t.style,this.toolbar=t.toolbar,v.fF.assertValue(this.container,"container"),v.fF.assertValue(this.destroyEditorActions,"destroyEditorActions"),v.fF.assertValue(this.evaluatedValues,"evaluatedValues"),v.fF.assertValue(this.hostServices,"hostServices"),v.fF.assertValue(this.localizationProvider,"localizationProvider"),v.fF.assertValue(this.onEditSmartNarrativePersist,"onEditSmartNarrativePersist"),v.fF.assertValue(this.quill,"quill"),v.fF.assertValue(this.style,"style"),v.fF.assertValue(this.toolbar,"toolbar");var i=X.v.getDataColorByIndex(t.style,0);this.focusColor=B.computeTransparentSmartNarrativesColor(i)}return e.prototype.getSmartNarrativesEditor=function(){var t=this;return this.component=this.component||this.hostServices.getUIComponentFactory().createSmartNarrativesEditor(this.container.find(Et.selector).get(0),M.RL.values.expr,{onEditSmartNarrativeCancel:function(){return t.onEditSmartNarrativeCancel()},onEditSmartNarrativeFinish:function(n,r){return t.onEditSmartNarrativeFinish(n,r)},onEditSmartNarrativeStart:function(){return t.onEditSmartNarrativeStart()},onSmartNarrativeFocusChange:function(n,r){return t.onSmartNarrativeFocusChange(n,r)},onUpdateToolbar:function(n){return t.onUpdateToolbar(n)},onEscape:function(){return t.focusOnToolbar()}}),this.component},e.prototype.onGetSmartNarrativesBlot=function(t){var i={index:-1,op:void 0},n=this.quill.getContents();return n&&(i.op=_.find(n.ops,function(r){if(r){if(_.isString(r.insert))return i.index+=r.insert.length,!1;if(_.isNumber(r.insert))return i.index+=1,!1;var o=dt(r,B.smartNarrativesBlotClass.class);return i.index+=1,o?.objRef===t}return v.fF.assertFail("ops should not be undefined"),!1})),i},e.prototype.onEditSmartNarrativeCancel=function(){var t=-1,i=this.onGetSmartNarrativesBlot(nt);return i&&i.index>=0&&i.op&&(this.quill.removeFormat(i.index,1),this.quill.setSelection(t=i.index,0,"api")),t},e.prototype.onEditSmartNarrativeFinish=function(t,i){var n=this;v.fF.assertValue(t,"objRef");var r=this.onEditSmartNarrativeCancel();i?this.applyObjRefUpdate(i,function(s){var l=n.quill.getFormat(s);n.quill.removeFormat(s,1),n.insertSmartNarrativesBlot(t,s),n.quill.formatText(s,1,l,"api")}):(r<0&&(r=this.getInsertionIndex()),this.insertSmartNarrativesBlot(t,r)),this.onEditSmartNarrativePersist()},e.prototype.onEditSmartNarrativeStart=function(){this.onEditSmartNarrativeCancel();var t=this.getInsertionIndex();this.insertSmartNarrativesBlot(nt,t)},e.prototype.onSmartNarrativeFocusChange=function(t,i){var n=this;this.applyObjRefUpdate(t,function(a){var s=n.quill.getFormat(a,1);s.smartNarrativesFocus=i?n.focusColor:void 0,n.quill.formatText(a,1,s,"api")})},e.prototype.updateOptions=function(t){this.evaluatedValues=t.evaluatedValues},e.prototype.applyObjRefUpdate=function(t,i){var n=this.quill.getContents();if(n)for(var r=-1,o=0,a=n.ops;o<a.length;o++){var l=a[o];if(!l)return void v.fF.assertFail("ops should not be undefined");if(_.isString(l.insert))r+=l.insert.length;else if(_.isNumber(l.insert))r+=1;else{r+=1;var u=dt(l,B.smartNarrativesBlotClass.class);u?.objRef===t&&i(r)}}},e.prototype.getInsertionIndex=function(){var t=this.quill.getSelection(!0);return t?t.index:0},e.prototype.insertSmartNarrativesBlot=function(t,i){var n=this;this.quill.insertEmbed(i,B.smartNarrativesBlotClass.class,{destroyEditorActions:this.destroyEditorActions,evaluatedValues:this.evaluatedValues,localizationProvider:this.localizationProvider,objRef:t,onSelectSmartNarrativesBlot:function(a){n.getSmartNarrativesEditor().onSelectEditableObject(a)},style:this.style},"api"),this.quill.setSelection(i+1,0,"api")},e.prototype.onUpdateToolbar=function(t){this.hostServices.setToolbar(this.toolbar.getElement(),{preferHorizontalLayout:!0,theme:"neutralGrayTheme",dropdownOptions:t})},e.prototype.focusOnToolbar=function(){this.toolbar&&ft.IK.focusChildInGroup(this.toolbar.getElement().get(0))},e}(),pe=function(){function e(t){this.container=t.container,this.hostServices=t.hostServices,v.fF.assertValue(this.container,"container"),v.fF.assertValue(this.hostServices,"hostServices")}return e.prototype.getTextboxFormattingSettings=function(){var t;return this.component=this.component||(null===(t=this.hostServices.getUIComponentFactory())||void 0===t?void 0:t.createTextboxFormattingSettings(this.container.find(At.selector).get(0))),this.component},e}(),ve=function(){function e(t){this.uiComponentFactory=t.uiComponentFactory,this.inputArgs=t.inputArgs,this.outputArgs=t.outputArgs,v.fF.assertValue(this.inputArgs,"inputArgs"),v.fF.assertValue(this.outputArgs,"outputArgs"),v.fF.assertValue(this.uiComponentFactory,"uiComponentFactory")}return e.prototype.attach=function(t){return(0,S.__awaiter)(this,void 0,void 0,function(){return(0,S.__generator)(this,function(i){switch(i.label){case 0:return[4,this.uiComponentFactory.createMiniToolbarLargeButton(t.get(0),this.inputArgs,this.outputArgs)];case 1:return i.sent(),[2]}})})},e}()}}]);