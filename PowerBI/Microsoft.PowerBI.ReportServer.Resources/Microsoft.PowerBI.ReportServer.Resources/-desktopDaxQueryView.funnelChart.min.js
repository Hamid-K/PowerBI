"use strict";(self.webpackChunkdesktopDaxQueryView=self.webpackChunkdesktopDaxQueryView||[]).push([["funnelChart"],{10182:function(ze,de,b){b.r(de),b.d(de,{FunnelChart:function(){return pt},FunnelWebBehavior:function(){return yt},WebFunnelAnimator:function(){return dt}});var j=b(81337),z=b(57622),ue=b(11305),Be=b(45296),S=b(72902),n=b(44783),u=b(59107),h=b(90120),y=b(21181),P=b(51129),L=b(40739),T=b(80708),d=b(51650),f=b(62458),x=b(60066),O=b(46769),I=b(5381),ie=b(32554),Y=b(72489),E=b(54522),k=b(56578),ce=b(28326),$=b(38400),m=b(99653),Pe=b(80065),Je=b(52083),it=b(33777),nt=b(41640),K=b(51660),qe=b(39681),we=b(382),Se=b(32041),st=b(63972),je=b(26543),_e=b(34021),lt=b(86900),ot=b(23465),Le=b(18664),ae=b(10389),et=b(46135),ut=b(53197),ye=b(79154);function Oe(i,e,t){var r=d3.range(0,e.categoryLabels.length),s=d3.scaleBand().domain(r).range([e.rangeStart,e.rangeEnd]).paddingInner(e.barToSpaceRatio).paddingOuter(t?e.barToSpaceRatio:.75),a=d3.axisRight(s).tickPadding(0).tickSizeInner(0).ticks(r.length).tickValues(r).tickFormat(function(c){return e.categoryLabels[c]});i.attr("class","axis hideLinesOnAxis").attr("transform",(0,ae.Iu)(0,e.margin.top)).call(a).select("path").attr("stroke",null),i.selectAll(".tick").call($.Q,e.categoryLabels);var l=e.margin.left-6;i.selectAll(".tick text").call(ut.oq,l,Se.b.svgEllipsis).styles((0,Le.E_)(e.labelFontProperties))}function re(i,e){return void 0===e&&(e=!1),e?i.highlight?i.originalHighlightValue:i.originalValue:i.highlight?i.highlightValue:i.value}var D={funnel:{bars:(0,ye.CH)("funnelBar"),highlights:(0,ye.CH)("highlight"),interactors:(0,ye.CH)("funnelBarInteractor")},percentBar:{root:(0,ye.CH)("percentBars"),mainLine:(0,ye.CH)("mainLine"),leftTick:(0,ye.CH)("leftTick"),rightTick:(0,ye.CH)("rightTick"),text:(0,ye.CH)("value")}},ke=[D.funnel.bars.class,D.funnel.highlights.class].join(" "),ne=b(56707),ft=b(96915),dt=function(i){function e(t){return i.call(this,t)||this}return(0,j.__extends)(e,i),e.prototype.animate=function(t){var r={failed:!0,shapes:null,dataLabels:null},s=t.viewModel,a=this.previousViewModel;return a&&(s.hasHighlights&&!a.hasHighlights?r=this.animateNormalToHighlighted(t):s.hasHighlights&&a.hasHighlights?r=this.animateHighlightedToHighlighted(t):!s.hasHighlights&&a.hasHighlights&&(r=this.animateHighlightedToNormal(t))),this.previousViewModel=s,r},e.prototype.animateNormalToHighlighted=function(t){var r=t.viewModel,s=t.layout,a=!0,l=t.interactivityService&&t.interactivityService.hasSelection();Oe(t.axisGraphicsContext,t.axisOptions,t.isHidingPercentBars);var c=t.shapeGraphicsContext.selectAll(D.funnel.bars.selector).data(r.dataPoints,function(p){return p.key}),o=c.enter().append("rect").attr("class",function(p){return p.highlight?ke:D.funnel.bars.class}).attrs(s.shapeLayoutWithoutHighlights).merge(c);o.style("fill",function(p){return p.color}).style("fill-opacity",function(p){return(0,x.eR)(p.selected,p.highlight,l,a)}).style("stroke-opacity",function(p){return(0,x.eR)(p.selected,p.highlight,l,a)}).transition().duration(this.animationDuration).attrs(s.shapeLayout),c.exit().remove(),this.animatePercentBars(t);var g=(0,I.Xc)(t.labelGraphicsContext,t.labelLayout,this.animationDuration);return(0,ae.bL)(t.visualInitOptions,o),{failed:!1,shapes:o,dataLabels:g}},e.prototype.animateHighlightedToHighlighted=function(t){Oe(t.axisGraphicsContext,t.axisOptions,t.isHidingPercentBars);var r=this.animateDefaultShapes(t);return this.animatePercentBars(t),{failed:!1,shapes:r,dataLabels:(0,I.Xc)(t.labelGraphicsContext,t.labelLayout,this.animationDuration)}},e.prototype.animateHighlightedToNormal=function(t){var r=t.viewModel,s=t.layout,a=!!t.interactivityService&&t.interactivityService.hasSelection();Oe(t.axisGraphicsContext,t.axisOptions,t.isHidingPercentBars);var l=t.shapeGraphicsContext.selectAll(D.funnel.bars.selector).data(r.dataPoints,function(g){return g.key}),c=l.enter().append("rect").attr("class",function(g){return g.highlight?ke:D.funnel.bars.class}).merge(l);c.style("fill",function(g){return g.color}).style("fill-opacity",function(g){return(0,x.eR)(g.selected,g.highlight,a,!g.selected)}).style("stroke-opacity",function(g){return(0,x.eR)(g.selected,g.highlight,a,!g.selected)}).transition().duration(this.animationDuration).attrs(s.shapeLayoutWithoutHighlights).transition().duration(0).delay(0).style("fill-opacity",function(g){return(0,x.eR)(g.selected,g.highlight,a,!1)}).style("stroke-opacity",function(g){return(0,x.eR)(g.selected,g.highlight,a,!1)}),l.exit().transition().duration(this.animationDuration).attrs(a?s.zeroShapeLayout:s.shapeLayoutWithoutHighlights).remove(),this.animatePercentBars(t);var o=(0,I.Xc)(t.labelGraphicsContext,t.labelLayout,this.animationDuration);return(0,ae.bL)(t.visualInitOptions,c,l.exit()),{failed:!1,shapes:c,dataLabels:o}},e.prototype.animateDefaultShapes=function(t){var r=t.viewModel,s=r.dataPoints,a=t.layout,l=r.hasHighlights,c=!!t.interactivityService&&t.interactivityService.hasSelection(),o=t.shapeGraphicsContext.selectAll(D.funnel.bars.selector).data(s,function(p){return p.key}),g=o.enter().append("rect").attr("class",function(p){return p.highlight?ke:D.funnel.bars.class}).merge(o);return g.style("fill",function(p){return p.color}).style("fill-opacity",function(p){return(0,x.eR)(p.selected,p.highlight,c,l)}).style("stroke-opacity",function(p){return(0,x.eR)(p.selected,p.highlight,c,l)}).transition().duration(this.animationDuration).attrs(a.shapeLayout),o.exit().remove(),(0,ae.bL)(t.visualInitOptions,g),g},e.prototype.animatePercentBars=function(t){var r=t.viewModel;if(t.isHidingPercentBars||!r.dataPoints||(r.hasHighlights?r.dataPoints.length/2:r.dataPoints.length)<2)this.animatePercentBarComponents([],t);else{var a=[r.dataPoints[r.hasHighlights?1:0],r.dataPoints[r.dataPoints.length-1]],l=re(a[0]);if(l<=0)this.animatePercentBarComponents([],t);else{var c=a.map(function(o,g){return{value:re(o),percent:0===g?1:re(o)/l,isTop:0===g}});this.animatePercentBarComponents(c,t)}}},e.prototype.animateToFunnelPercent=function(t,r,s){return t.data(r).transition().duration(this.animationDuration).attrs(s)},e.prototype.animatePercentBarComponents=function(t,r){var s=r.percentGraphicsContext,a=r.layout,l=[{percent:0,value:0,isTop:!0},{percent:0,value:0,isTop:!1}],c=s.selectAll(D.percentBar.mainLine.selector).data(t);this.animateToFunnelPercent(c.exit(),l,a.percentBarLayout.mainLine).remove();var o=c.enter().append("line").classed(D.percentBar.mainLine.class,!0).data(l).attrs(a.percentBarLayout.mainLine).merge(c);this.animateToFunnelPercent(o,t,a.percentBarLayout.mainLine);var g=s.selectAll(D.percentBar.leftTick.selector).data(t);this.animateToFunnelPercent(g.exit(),l,a.percentBarLayout.leftTick).remove();var p=g.enter().append("line").classed(D.percentBar.leftTick.class,!0).data(l).attrs(a.percentBarLayout.leftTick).merge(g);this.animateToFunnelPercent(p,t,a.percentBarLayout.leftTick);var V=s.selectAll(D.percentBar.rightTick.selector).data(t);this.animateToFunnelPercent(V.exit(),l,a.percentBarLayout.rightTick).remove();var M=V.enter().append("line").classed(D.percentBar.rightTick.class,!0).data(l).attrs(a.percentBarLayout.rightTick).merge(V);this.animateToFunnelPercent(M,t,a.percentBarLayout.rightTick);var N=s.selectAll(D.percentBar.text.selector).data(t);this.animateToFunnelPercent(N.exit(),l,a.percentBarLayout.text.attr).remove();var w=N.enter().append("text").classed(D.percentBar.text.class,!0).data(l).attrs(a.percentBarLayout.text.attr).styles(a.percentBarLayout.text.style).merge(N);this.animateToFunnelPercent(w,t,a.percentBarLayout.text.attr).text(function(Z){return ce.dx.formatValue(Z.percent,(0,Y.Z)("Percentage1"))}),(0,ae.bL)(r.visualInitOptions,o,c.exit(),p,g.exit(),M,V.exit(),w)},e}(b(94478).r5),pe=b(30237),yt=function(){function i(){}return i.prototype.bindEvents=function(e,t,r,s){var a=this.bars=e.bars,l=e.interactors,c=e.clearCatcher,o=e.root;if(this.hasHighlights=e.hasHighlights,s?((0,pe.FO)(a),(0,pe.FO)(l),(0,pe.to)(o)):((0,pe.a0)(a,t),(0,pe.a0)(l,t),(0,pe.lt)(o,t)),r){var g=r.dataPointNavigationManager,p=r.pointSourceKey;g.isEmpty(p)||((0,pe.W3)(o,g,p),(0,pe.I8)(o,g,p))}c.on("click",function(){u.M.isCtrlOrMeta(d3.event)||t.handleClearSelection()})},i.prototype.renderSelection=function(e){var t=this.hasHighlights;this.bars.attr("aria-selected",function(r){return r.selected}).style("fill-opacity",function(r){return(0,x.eR)(r.selected,r.highlight,e,t)}).style("stroke-opacity",function(r){return(0,x.eR)(r.selected,r.highlight,e,t)})},i.prototype.renderFocus=function(e){e&&u.M.focus(e)},i}(),pt=function(){function i(e){this.labelPositionObjects=[we.h.outsideEnd,we.h.insideCenter],e&&(this.tooltipsEnabled=e.tooltipsEnabled,e.funnelSmallViewPortProperties&&(this.funnelSmallViewPortProperties=e.funnelSmallViewPortProperties),e.animator&&(this.animator=e.animator),e.behavior&&(this.behavior=e.behavior))}return i.converter=function(e,t,r,s){var a;void 0===s&&(s=!0);for(var l=m.jP.general.formatString,c=(0,P.G)(e,{staticSeriesRoleNames:["Y"],colorOptions:{valueRole:"Y",visualStyle:t},formatStringProp:l}),o=c.data,g=c.columns,p=[],V=e.categorical,M=o.hasHighlights(),N=[],w=0,Z=o.getSeriesCount();w<Z;w++)N.push(g.getValueMetadataColumn("Y",w));var F,he,se,J,G=!1,W=!1,C=!1,v=[],H=this.getDefaultLabelSettings(t),Q=this.getDefaultPercentLabelSettings(t),X=this.getDefaultCategoryLabelSettings(t),Ce=(0,Je.Rr)(V),A=!1;if(e&&e.metadata&&e.metadata.objects){var Te=e.metadata.objects.labels;Te&&(0,y.ww)(Te,H,void 0,t);var Ee=e.metadata.objects.percentBarLabel;Ee&&(0,y.ww)(Ee,Q,void 0,t);var Ne=e.metadata.objects.categoryAxis;Ne&&(0,y.ww)(Ne,X,void 0,t)}if(!o.hasValues("Y"))return{allValuesAreNegative:C,canShowDataLabels:!0,categoryAxisSettings:X,categoryCount:0,categoryLabels:v,dataLabelsSettings:H,dataPoints:p,hasCategories:A,hasHighlights:M,hasNegativeValues:W,highlightsOverflow:G,percentBarLabelSettings:Q,valuesMetadata:N};F=o.getValue("Y",0,0),M&&(he=o.getHighlight("Y",0,0));var Ae=(0,Y.Z)("Percentage"),ge=H.fontProperties.color;if(o.hasCategories()){A=!0;for(var B=0,Ie=o.getCategoryCount();B<Ie;B++){var fe=g.getCategoryColumn("Category"),We=o.getCategoryValue("Category",B),q=g.getValueMetadataColumn("Y"),le=je.dw.builder().withCategory([fe],B,null===(a=fe?.source)||void 0===a?void 0:a.queryName,!0).withMeasure(q.queryName,g.getValueColumn("Y"),B).createSelectionId(),R=o.getValue("Y",B),oe=o.getFormatString("Y",B),ve=(0,E.xq)(We,fe.source,l),be=void 0,me=void 0,ee=void 0,He=void 0;M?(ee=o.getHighlight("Y",B),He=o.getHighlightFormatString("Y",B),be=he?ee/he:null,me=J?ee/J:null):(be=F?R/F:null,me=se?R/se:null);var U=void 0;if(s){(U=[]).push({displayName:fe.source.displayName,value:ve}),null!=R&&U.push({displayName:q.displayName,value:(0,E.xq)(R,q,l,!1,oe)}),null!=ee&&U.push({displayName:ue.I6.localizationOptions.highlightedValueDisplayName,value:(0,E.xq)(ee,q,l,!1,He)});var Ue=Ce?Ce.source:void 0;Ue&&Ue!==q&&null!=Ce.values[B]&&U.push({displayName:Ue.displayName,value:(0,E.xq)(o.getValue("Gradient",B),Ue,l,!1,o.getFormatString("Gradient",B))}),i.addFunnelPercentsToTooltip(Ae,U,r,be,me,M),(0,ue.VT)(c,U,B,void 0,l)}var xe=(0,O.t$)({defaultColor:ge,categoricalDataReader:c,categoryIndex:B}),Ye=(0,O.B8)(xe)?xe.color:ge;H.fontProperties=(0,O.Vv)(Ye,H.fontProperties);var Fe=c.colors.createBySeries(0,B);if(p.push({label:ve,value:R,formatString:oe,originalValue:R,percentOfFirst:be,percentOfPrevious:me,categoryIndex:B,seriesIndex:null,identity:le,selected:!1,key:le.getKey(),tooltipInfo:U,formattedTooltip:(0,$.X)(U),color:Fe,labelFill:xe.color}),M){var Ve=je.l0.createWithHighlight(le),Ge=o.getHighlight("Y",B),bt=o.getHighlightFormatString("Y",B);p.push({label:ve,value:R,formatString:oe,originalValue:R,percentOfFirst:be,percentOfPrevious:me,categoryIndex:B,seriesIndex:null,identity:Ve,selected:!1,key:Ve.getKey(),highlight:!0,highlightValue:Ge,highlightFormatString:bt,originalHighlightValue:Ge,tooltipInfo:U,formattedTooltip:(0,$.X)(U),color:Fe}),J=Ge}se=R}}else for(A=!1,B=0,w=0,Z=o.getSeriesCount();w<Z;w++){R=o.getValue("Y",B,w),oe=o.getFormatString("Y",B,w),q=g.getValueMetadataColumn("Y",w),le=je.l0.createWithMeasure(q.queryName),Fe=c.colors.createByValue(w),xe=(0,O.t$)({seriesColor:H?.fontProperties.color,defaultColor:ge,categoricalDataReader:c,categoryIndex:B,seriesIndex:w}),Ye=(0,O.B8)(xe)?xe.color:ge,H.fontProperties=(0,O.Vv)(Ye,H.fontProperties);var De=void 0,Me=void 0;if(ee=void 0,He=void 0,M?(ee=o.getHighlight("Y",B,w),He=o.getHighlightFormatString("Y",B,w),De=he?ee/he:null,Me=J?ee/J:null):(De=F?R/F:null,Me=se?R/se:null),U=void 0,s&&(U=[],null!=R&&U.push({displayName:q.displayName,value:(0,E.xq)(R,q,l,!1,oe)}),null!=ee&&U.push({displayName:ue.I6.localizationOptions.highlightedValueDisplayName,value:(0,E.xq)(ee,q,l,!1,He)}),i.addFunnelPercentsToTooltip(Ae,U,r,De,Me,M),(0,ue.VT)(c,U,B,void 0,l)),p.push({label:q.displayName,value:R,formatString:oe,originalValue:R,percentOfFirst:De,percentOfPrevious:Me,categoryIndex:w,seriesIndex:null,identity:le,selected:!1,key:le.getKey(),tooltipInfo:U,formattedTooltip:(0,$.X)(U),color:Fe,labelFill:xe.color}),M){Ve=je.l0.createWithHighlight(le);var Qe=o.getHighlight("Y",B,w),mt=o.getHighlightFormatString("Y",B,w);p.push({label:q.displayName,value:R,formatString:oe,originalValue:R,percentOfFirst:De,percentOfPrevious:Me,categoryIndex:w,seriesIndex:null,identity:Ve,key:Ve.getKey(),selected:!1,highlight:!0,originalHighlightValue:Qe,highlightValue:Qe,highlightFormatString:mt,tooltipInfo:U,formattedTooltip:(0,$.X)(U),color:Fe}),J=Qe}se=R}for(var Xe=0;Xe<p.length;Xe+=M?2:1)v.push((te=p[Xe]).label);C=p.length>0&&_.every(p,function($e){return(!$e.highlight||$e.highlightValue<=0)&&$e.value<0});for(var Ke=0,at=p;Ke<at.length;Ke++){var te=at[Ke];if(C)te.value=Math.abs(te.value),te.highlight&&(te.highlightValue=Math.abs(te.highlightValue));else{var rt=(R=te.value)<0;rt&&(te.value=0);var Ze=!1;te.highlight&&(te.highlightValue=(Ze=(ee=te.highlightValue)<0)?0:ee),W||(W=rt||Ze)}(0,nt.aP)(te.highlightValue,te.value)&&(G=!0)}return{allValuesAreNegative:C,canShowDataLabels:!0,categoryAxisSettings:X,categoryCount:v.length,categoryLabels:v,dataLabelsSettings:H,dataPoints:p,hasCategories:A,hasHighlights:M,hasNegativeValues:W,highlightsOverflow:G,percentBarLabelSettings:Q,strokeSettings:(0,_e.kG)(t),valuesMetadata:N}},i.prototype.getFormattingModel=function(){var e=this;return new k.Nq(function(){return e.getColorsCard()},function(){return e.getDataLabelsCard()},function(){return e.getCategoryLabelsCard()},function(){return e.getConversionRateLabelsCard()}).build()},i.prototype.hasGradientCategorical=function(){var e;return(0,Je.Q1)(null===(e=_.first(this.dataViews))||void 0===e?void 0:e.categorical)},i.prototype.getColorsCard=function(){var e=this.data;if(e&&this.dataViews&&this.dataViews.length&&!this.hasGradientCategorical())return(0,ie.k2)({dataView:this.dataViews[0],categories:_.map(e.dataPoints,function(t){return{color:t.color,displayName:t.label,identity:t.identity}}),style:this.style,fillInstanceKind:3},this.featureSwitches,this.hostServices)},i.prototype.getDataLabelsCard=function(){var e=this,t=this.data;if(t&&this.dataViews&&this.dataViews.length){var r=i.getLabelSettingsOptions(void 0,this.data.dataLabelsSettings||i.getDefaultLabelSettings(this.style),!0,this.style,this.labelPositionObjects);r.funnelLabelStyle=!0,f.fF.assertValue(r,"options");var s=r.dataLabelsSettings;s.position&&this.labelPositionObjects.indexOf(s.position)<0&&(s.position=we.h.outsideEnd);var a="labels",l=(0,y.kL)(a);l.labelStyle=m.jP.labels.funnelLabelStyle,l.enableBackground=m.jP.labels.enableBackground,l.backgroundColor=m.jP.labels.backgroundColor,l.backgroundTransparency=m.jP.labels.backgroundTransparency;var o={cardBuilder:new k.CQ(new k.lg(a),"Visual_DataPointsLabels",l,function(g){return e.hostServices.getLocalizedString(g)}),dataLabelsProps:l,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:r,instanceKind:t.hasCategories?void 0:3,individualSelector:(0,y.WD)({featureSwitches:this.featureSwitches,hasCategories:t.hasCategories,hasDynamicSeries:!1,hasSeriesSelector:!1})};return(0,y.XQ)(o)}},i.prototype.getCategoryLabelsCard=function(){var e=this;if(this.data&&this.dataViews&&this.dataViews.length){var r=i.getLabelSettingsOptions(void 0,this.data.categoryAxisSettings||i.getDefaultCategoryLabelSettings(this.style),!0,this.style,void 0),s={color:m.jP.categoryAxis.color,fontFamily:m.jP.categoryAxis.fontFamily,fontSize:m.jP.categoryAxis.fontSize,show:m.jP.categoryAxis.show,bold:m.jP.categoryAxis.bold,italic:m.jP.categoryAxis.italic,underline:m.jP.categoryAxis.underline},a=new k.CQ(new k.lg("categoryAxis"),"Visual_CategoryLabels",s,function(c){return e.hostServices.getLocalizedString(c)});return(0,y.XQ)({cardBuilder:a,dataLabelsProps:s,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:r,customDescription:"Visual_CategoryLabelOptionsDescription",instanceKind:3})}},i.prototype.getConversionRateLabelsCard=function(){var e=this;if(this.data&&this.dataViews&&this.dataViews.length){var r=i.getLabelSettingsOptions(void 0,this.data.percentBarLabelSettings||i.getDefaultPercentLabelSettings(this.style),!1,this.style,void 0),s={color:m.jP.percentBarLabel.color,fontFamily:m.jP.percentBarLabel.fontFamily,fontSize:m.jP.percentBarLabel.fontSize,show:m.jP.percentBarLabel.show,bold:m.jP.percentBarLabel.bold,italic:m.jP.percentBarLabel.italic,underline:m.jP.percentBarLabel.underline},a=new k.CQ(new k.lg("percentBarLabel"),"Visual_PercentBarLabel",s,function(c){return e.hostServices.getLocalizedString(c)});return(0,y.XQ)({cardBuilder:a,dataLabelsProps:s,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:r,customDescription:"Visual_PercentBarLabelDescription",instanceKind:3})}},i.getLabelSettingsOptions=function(e,t,r,s,a){var l=t&&t.enableBackground;return{enumeration:e,dataLabelsSettings:t,show:!0,displayUnits:r,precision:r,percentagePrecision:r,position:r,positionObject:a,enableBackground:l,backgroundColor:l?t.backgroundColor:void 0,backgroundTransparency:l?t.backgroundTransparency:void 0,fontSize:!0,fontFamily:!0,style:s,bold:!0,italic:!0,underline:!0}},i.prototype.init=function(e){var r,t=this;this.options=e,this.featureSwitches=e.featureSwitches;var a=this.svg=d3.select(e.element.get(0)).append("svg").classed(i.VisualClassName,!0);if(this.tooltipService=(0,L.r)(e.host),this.behavior&&(this.clearCatcher=(0,S.EX)(this.svg)),this.currentViewport=e.viewport,this.margin=(0,qe.ED)(i.DefaultMargin),this.style=e.style,this.hostServices=e.host,this.behavior){this.interactivityService=(0,S.ub)(this.hostServices,this.featureSwitches);var l=u.M.isInternetExplorerOrEdge();this.svg.attr("tabindex",0).attr("focusable",!0).attr("role","listbox").attr("aria-multiselectable",!0).attr("aria-label",this.hostServices.getLocalizedString("Visual_Plot")).classed(x.Pg,!l)}if(this.featureSwitches.onObject){var o=(null===(r=this.hostServices)||void 0===r?void 0:r.getSubSelectionService())??lt.D.createWithDefaultHost();this.subSelectionHelper=K.O5.createHtmlSubselectionHelper({hostElement:e.element.get(0),hostServices:this.hostServices,renderer:o,targetSource:"format",scale:function(){return t.currentViewport.scale}}),this.interactivityService.setSubSelectionHelper(this.subSelectionHelper)}this.percentGraphicsContext=a.append("g").classed(D.percentBar.root.class,!0),this.funnelGraphicsContext=a.append("g"),this.axisGraphicsContext=a.append("g"),this.labelBackgroundContext=a.append("g").classed(ne.u9.class,!0),this.labelGraphicsContext=a.append("g").classed(ne.ZL.class,!0),this.updateViewportProperties()},i.prototype.getSubSelectionShortcuts=function(e,t){var s={key:"Delete",nextValue:!1};switch((0,Pe.dF)(e).objectName){case"bars":return[{type:0},(0,j.__assign)((0,j.__assign)({type:2},m.jP.labels.show),{enabledLabel:this.hostServices.getLocalizedString("Format_AddDataLabels")}),(0,j.__assign)((0,j.__assign)({type:2},m.jP.categoryAxis.show),{enabledLabel:this.hostServices.getLocalizedString("Visual_Add_CategoryLabel")}),(0,j.__assign)((0,j.__assign)({type:2},m.jP.percentBarLabel.show),{enabledLabel:this.hostServices.getLocalizedString("Visual_PercentBarLabel_Add")}),{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("colors"),groupUid:"".concat("colors","-").concat("colors")},label:this.hostServices.getLocalizedString("Format")}];case"category-labels":return[(0,j.__assign)((0,j.__assign)({type:2},m.jP.categoryAxis.show),{disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[s]}),{type:0,excludedResetFormattingIds:[m.jP.categoryAxis.show]},{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("categoryAxis"),groupUid:"".concat("categoryAxis","-").concat("values")},label:this.hostServices.getLocalizedString("Format_Category_Labels")}];case"data-labels":return[(0,j.__assign)((0,j.__assign)({type:2},m.jP.labels.show),{disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[s]}),{type:0,excludedResetFormattingIds:[m.jP.labels.show]},{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("labels")},label:this.hostServices.getLocalizedString("Format_Data_Labels")}];case"percents":return[(0,j.__assign)((0,j.__assign)({type:2},m.jP.percentBarLabel.show),{disabledLabel:this.hostServices.getLocalizedString("Delete"),keyboardShortcuts:[s]}),{type:0,excludedResetFormattingIds:[m.jP.percentBarLabel.show]},{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("percentBarLabel")},label:this.hostServices.getLocalizedString("Format_Conversion_Rate")}];default:return}},i.prototype.getSubSelectionStyles=function(e){var a,r=_.first(e).visualObjects,s=(0,Pe.dF)(e);if(r.length>0)switch(a={data:[(0,ft.Ue)(1)]},s.objectName){case"bars":return(0,Pe.w3)(this.hostServices,void 0,(0,j.__assign)((0,j.__assign)({},m.jP.dataPoint.fill),{selector:a}));case"data-labels":return 0===this.data.dataPoints.length?void 0:(0,Pe.Jf)({hostServices:this.hostServices,omitSelectorForSingleSeries:!0,individualSelector:!0,selector:a,repetitionSelector:void 0},{fontFamilyReference:m.jP.labels.fontFamily,fontSizeReference:m.jP.labels.fontSize,boldReference:m.jP.labels.bold,italicReference:m.jP.labels.italic,underlineReference:m.jP.labels.underline,fontColorReference:m.jP.labels.color,backgroundReference:m.jP.labels.backgroundColor});case"category-labels":return(0,Pe.un)(this.hostServices,{fontFamilyReference:m.jP.categoryAxis.fontFamily,fontSizeReference:m.jP.categoryAxis.fontSize,boldReference:m.jP.categoryAxis.bold,italicReference:m.jP.categoryAxis.italic,underlineReference:m.jP.categoryAxis.underline,fontColorReference:m.jP.categoryAxis.color});case"percents":return(0,Pe.un)(this.hostServices,{fontFamilyReference:m.jP.percentBarLabel.fontFamily,fontSizeReference:m.jP.percentBarLabel.fontSize,boldReference:m.jP.percentBarLabel.bold,italicReference:m.jP.percentBarLabel.italic,underlineReference:m.jP.percentBarLabel.underline,fontColorReference:m.jP.percentBarLabel.color});default:return}},i.prototype.getNextSubSelectable=function(e,t){return this.subSelectionHelper.getNextSubSelectable(e,t)},i.prototype.getSubSelectables=function(e){return this.subSelectionHelper.getAllSubSelectables(e)},i.prototype.onDataViewObjectChanged=function(e,t){return this.featureSwitches.onObject&&1===t?d.o.applyDataViewObjectsBehaviorChanges(e,this.getDataViewObjectLayerChanges(e)):e},i.prototype.getDataViewObjectLayerChanges=function(e){if(!this.featureSwitches.onObject)return[];var s=[ot.$.create({objectName:"labels",propertyName:"backgroundColor"},this.data.dataLabelsSettings.enableBackground).onToggleEnabled(z.W.createBooleanDataViewObjectChange({objectName:"labels",propertyName:"enableBackground"},!0))];return d.o.getDataViewObjectsBehaviorChanges(e,s)},i.prototype.updateViewportProperties=function(){var e=this.currentViewport;this.svg.attr("width",e.width).attr("height",e.height)},i.prototype.update=function(e){f.fF.assertValue(e,"options"),this.data={dataPoints:[],categoryLabels:[],valuesMetadata:[],hasHighlights:!1,highlightsOverflow:!1,canShowDataLabels:!0,dataLabelsSettings:i.getDefaultLabelSettings(this.style),hasNegativeValues:!1,allValuesAreNegative:!1,percentBarLabelSettings:i.getDefaultPercentLabelSettings(this.style),categoryAxisSettings:i.getDefaultCategoryLabelSettings(this.style),categoryCount:0,hasCategories:!1};var t=this.dataViews=e.dataViews;if(this.currentViewport=e.viewport,this.featureSwitches.onObject&&e.formatMode!==this.formatMode&&(this.subSelectionHelper.setFormatMode(e.formatMode),this.interactivityService.setFormatMode(e.formatMode),this.formatMode=e.formatMode),t&&t.length>0){var r=t[0];r.categorical&&(this.data=i.converter(r,this.style,this.hostServices,this.tooltipsEnabled),this.interactivityService&&this.interactivityService.applySelectionStateToData(this.data.dataPoints));var s=(0,it.b)(t,!1,!1,!1,["Tooltips"]);this.data.allValuesAreNegative?s.push(new Be.fi):this.data.hasNegativeValues&&s.push(new Be.v3),this.hostServices.setWarnings(s)}var l=this.subSelectionHelper&&(e.type&et.EP.Data||e.type&et.EP.FormattingSubSelectionChange)?e.subSelections:null;this.updateViewportProperties(),this.updateInternal(e.suppressAnimations,l)},i.prototype.onDataChanged=function(e){this.update({dataViews:e.dataViews,suppressAnimations:e.suppressAnimations,viewport:this.currentViewport})},i.prototype.onResizing=function(e){this.currentViewport=e,this.update({dataViews:this.dataViews,suppressAnimations:!0,viewport:this.currentViewport})},i.prototype.getMaxLabelLength=function(e,t){for(var r=0,s=Se.b.measureSvgTextWidth,a=0,l=e.length;a<l;a++)t.text=e[a],r=Math.max(r,s(t));return r+6},i.prototype.updateInternal=function(e,t){var r;if(null!=this.data){var s=this.data,a=s.dataPoints,l=a.filter(function(F){return!F.highlight}),c=this.isHidingPercentBars(),o=this.setUpAxis(),g=o.margin,p=this.funnelGraphicsContext.attr("transform",(0,ae.Iu)(g.left,g.top)),V=this.labelBackgroundContext.attr("transform",(0,ae.Iu)(g.left,g.top)),M=this.labelGraphicsContext.attr("transform",(0,ae.Iu)(g.left,g.top));this.percentGraphicsContext.attr("transform",(0,ae.Iu)(g.left,g.top)),this.svg.style("font-family",ne.Pq);var Z,G,W,N=i.getFunnelLayout(s,o),w=this.getLabels(N,g);if(this.animator&&!e&&(W=(G=this.animator.animate({viewModel:s,interactivityService:this.interactivityService,layout:N,axisGraphicsContext:this.axisGraphicsContext,shapeGraphicsContext:p,percentGraphicsContext:this.percentGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,axisOptions:o,dataPointsWithoutHighlights:l,labelLayout:w,isHidingPercentBars:c,visualInitOptions:this.options})).shapes),(!this.animator||e||G.failed)&&(Oe(this.axisGraphicsContext,o,c),W=i.drawDefaultShapes(s,a,p,N,this.interactivityService,this.featureSwitches.onObject),i.drawPercentBars(s,this.percentGraphicsContext,N,c,this.style),Z=(0,I.gm)({labelContext:M,dataLabels:w,formatMode:!1,onObject:null===(r=this.featureSwitches)||void 0===r?void 0:r.onObject,backgroundContext:V})),t&&this.subSelectionHelper.updateOutlinesFromSubSelections(t,!0),this.interactivityService){var v=i.drawInteractorShapes(a,p,N);this.interactivityService.bind(a,this.behavior,{root:this.svg,bars:W,interactors:v,clearCatcher:this.clearCatcher,hasHighlights:s.hasHighlights},{navigationOptions:{helper:this,navigationStrategy:S.jN.CategoryOnly},pointSourceKey:"funnel"}),this.tooltipsEnabled&&this.tooltipService.addTooltip(v,function(F){return F.data&&F.data.tooltipInfo},function(F){return F.data&&F.data.identity&&[F.data.identity]})}if(this.featureSwitches.onObject){var X=w.every(function(F){return F.hasBackground});(function(i){i.selectAll(".tick text").classed(K.cy,!0).attr(K.Ez,"category-labels").attr(K.QZ,1).attr(K.CK,"Visual_CategoryLabels").style("pointer-events","bounding-box")})(this.axisGraphicsContext),X||function(i){i.classed(K.cy,!0).attr(K.Ez,"data-labels").attr(K.QZ,1).attr(K.CK,"Visual_DataPointsLabels").style("pointer-events","bounding-box")}(Z),function(i){i.selectAll(D.percentBar.text.selector).classed(K.cy,!0).attr(K.Ez,"percents").attr(K.QZ,1).attr(K.CK,"Visual_PercentBarLabel").style("pointer-events","bounding-box")}(this.percentGraphicsContext)}this.tooltipsEnabled&&this.tooltipService.addTooltip(W,function(F){return F.data&&F.data.tooltipInfo},function(F){return F.data&&F.data.identity&&[F.data.identity]})}},i.prototype.getFirstElement=function(){return{element:this.getHTMLElementFromCategoryIndex(0)}},i.prototype.getNextDataPoint=function(e,t,r){var s=this.data.categoryCount,a=e;do{switch(r){case S.x0.NextCategory:(e+=1)>=s&&(e=0);break;case S.x0.PreviousCategory:(e-=1)<0&&(e=s-1);break;case S.x0.NextSeries:case S.x0.PreviousSeries:break;default:f.fF.assertNever(r)}}while(0===this.data.dataPoints[e].value&&e!==a);return{element:this.getHTMLElementFromCategoryIndex(e)}},i.prototype.getHTMLElementFromCategoryIndex=function(e){return this.svg.selectAll(D.funnel.bars.selector).filter(function(t){return t.categoryIndex===e}).node()},i.prototype.getUsableVerticalSpace=function(){var e=this.margin;return this.currentViewport.height-(e.top+e.bottom)-i.MinBarThickness*this.data.categoryCount},i.prototype.isHidingPercentBars=function(){if(this.data.percentBarLabelSettings.show){var t=this.getPercentBarTextHeight();return this.getUsableVerticalSpace()-2*i.MinBarThickness*.75-2*t<=0}return!0},i.prototype.isSparklines=function(){return this.getUsableVerticalSpace()<=0},i.prototype.setUpAxis=function(){var e=this.data,t=e.dataPoints,r=e.categoryLabels,s=this.currentViewport,a=(0,qe.ED)(i.DefaultMargin),l=this.isSparklines(),c=this.isHidingPercentBars(),o=c?0:this.getPercentBarTextHeight(),g=s.height-(a.top+a.bottom)-2*o,p=i.MaxMarginFactor,V=e.categoryAxisSettings.fontProperties;if(r.length>0&&l)r=[],e.canShowDataLabels=!1;else if(this.showCategoryLabels()){var M=(0,Le.qk)(V),N=this.getMaxLabelLength(r,M),Z=Math.min(N,s.width*p);a.left=Z+i.YAxisPadding}else r=[];var G=s.width-(a.left+a.right),W=i.BarToSpaceRatio,C=d3.max(t.map(function(J){return J.value}));if(e.hasHighlights){var v=d3.max(t.map(function(J){return J.highlightValue}));C=d3.max([C,v])}var F,Q=0,X=g;return F=c?g-e.categoryCount*i.MaxBarHeight:g-e.categoryCount*i.MaxBarHeight-2*i.MaxBarHeight*.75,e.categoryCount>0&&F>0&&(Q=Math.ceil(F/2),X=Math.ceil(g-F/2)),c||(Q+=o,X+=o),{margin:a,valueScale:d3.scaleLinear().domain([0,C]).range([G,0]),categoryScale:d3.scaleBand().domain(d3.range(0,e.categoryCount)).range([Q,X]).paddingInner(W).paddingOuter(c?W:.75),maxScore:C,maxWidth:G,rangeStart:Q,rangeEnd:X,barToSpaceRatio:W,categoryLabels:r,labelFontProperties:V}},i.prototype.getPercentBarTextHeight=function(){var e=(0,Le.qk)(this.data.percentBarLabelSettings.fontProperties);return Se.b.estimateSvgTextHeight(e)},i.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},i.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},i.getFunnelLayout=function(e,t){var r=e.highlightsOverflow,s=t.categoryScale,a=t.valueScale,l=t.maxScore,c=s.bandwidth(),o=Math.ceil(c/2),g=c*i.OverflowingHighlightWidthRatio,p=g/2,V=e.categoryCount-1,M=Math.abs(a(l)-a(0)),N=function(v){return(M-Math.abs(a(v)-a(0)))/2},w=function(v){return Math.max(i.MinimumInteractorSize,Math.abs(a(v)-a(0)))},Z=(0,Le.qk)(e.percentBarLabelSettings.fontProperties),G=Se.b.estimateSvgTextBaselineDelta(Z),W=Se.b.estimateSvgTextHeight(Z)-G;return{percentBarLayout:{mainLine:{x2:function(v){return Math.abs(a(v.value)-a(0))},transform:function(v){var H=a(v.value)-N(v.value),Q=v.isTop?s(0)-o:s(V)+c+o;return(0,ae.Iu)(H,Q)}},leftTick:{y2:function(v){return o},transform:function(v){var H=a(v.value)-N(v.value),Q=v.isTop?s(0)-o-o/2:s(V)+c+o-o/2;return(0,ae.Iu)(H,Q)}},rightTick:{y2:function(v){return o},transform:function(v){var X=a(v.value)-N(v.value)+Math.abs(a(v.value)-a(0)),F=v.isTop?s(0)-o-o/2:s(V)+c+o-o/2;return(0,ae.Iu)(X,F)}},text:{attr:{x:function(v){return Math.ceil(Math.abs(a(l)-a(0))/2)},y:function(v){return v.isTop?-o/2-G:W+o/2},transform:function(v){var H=v.isTop?s(0)-o:s(V)+c+o;return(0,ae.Iu)(0,H)}},style:(0,Le.E_)(e.percentBarLabelSettings.fontProperties),maxWidth:M}},shapeLayout:{height:function(v){return v.highlight&&r?g:c},width:function(v){return Math.abs(a(re(v))-a(0))},y:function(v){return s(v.categoryIndex)+(v.highlight&&r?p:0)},x:function(v){var H=re(v);return a(H)-N(H)}},shapeLayoutWithoutHighlights:{height:function(v){return c},width:function(v){return Math.abs(a(v.value)-a(0))},y:function(v){return s(v.categoryIndex)+0},x:function(v){return a(v.value)-N(v.value)}},zeroShapeLayout:{height:function(v){return v.highlight&&r?g:c},width:function(v){return 0},y:function(v){return s(v.categoryIndex)+(v.highlight&&r?p:0)},x:function(v){return a((a.domain()[0]+a.domain()[1])/2)}},interactorLayout:{height:function(v){return v.highlight&&r?g:c},width:function(v){return w(re(v))},y:function(v){return s(v.categoryIndex)+(v.highlight&&r?p:0)},x:function(v){var H=w(re(v));return(M-H)/2}}}},i.drawDefaultShapes=function(e,t,r,s,a,l){(0,_e.H4)(r,e.strokeSettings);var c=e.hasHighlights,o=u.M.isInternetExplorerOrEdge(),g=a&&a.hasSelection(),p=r.selectAll(D.funnel.bars.selector).data(t,function(V){return V.key}).join(function(V){return V.append("rect").attr("role","option").attr("aria-label",function(M){return M.formattedTooltip}).attr("aria-selected",function(M){return M.selected}).attr("class",function(M){return M.highlight?ke:D.funnel.bars.class})}).style("fill",function(V){return V.color}).style("fill-opacity",function(V){return(0,x.eR)(V.selected,V.highlight,g,c)}).attrs(s.shapeLayout);return a&&p.attr("tabindex",0).attr("focusable",!0).classed(x.Pg,!o),l&&p.classed(K.cy,!0).attr(K.Ez,"bars").attr(K.QZ,3).attr(K.CK,"MiniToolbar_All_Bars"),p},i.getFormatStringFromDataPoint=function(e){return null!=e.highlight?e.highlightFormatString:e.formatString},i.drawInteractorShapes=function(e,t,r){var s=e.filter(function(c){return!c.highlight&&r.interactorLayout.width(c)===i.MinimumInteractorSize}),a=t.selectAll(D.funnel.interactors.selector).data(s,function(c){return c.key}),l=a.enter().append("rect").attr("class",D.funnel.interactors.class).merge(a);return l.style("fill-opacity",0).attrs(r.interactorLayout),a.exit().remove(),l},i.drawPercentBarComponents=function(e,t,r,s,a){e.style("stroke",h.v.getThemeColor(a,i.DefaultPercentBarStrokeColorName));var l=e.selectAll(D.percentBar.mainLine.selector).data(t);l.exit().remove(),l.enter().append("line").classed(D.percentBar.mainLine.class,!0).merge(l).attrs(r.percentBarLayout.mainLine);var c=e.selectAll(D.percentBar.leftTick.selector).data(t);c.exit().remove(),c.enter().append("line").classed(D.percentBar.leftTick.class,!0).merge(c).attrs(r.percentBarLayout.leftTick);var o=e.selectAll(D.percentBar.rightTick.selector).data(t);o.exit().remove(),o.enter().append("line").classed(D.percentBar.rightTick.class,!0).merge(o).attrs(r.percentBarLayout.rightTick);var g=e.selectAll(D.percentBar.text.selector).data(t),p=(0,Y.Z)("Percentage1");g.exit().remove(),g.enter().append("text").classed(D.percentBar.text.class,!0).merge(g).attrs(r.percentBarLayout.text.attr).styles(r.percentBarLayout.text.style).text(function(V){return(0,y.Gv)({label:V.percent,format:p,fontProperties:s.fontProperties,maxWidth:r.percentBarLayout.text.maxWidth})}).append("title").text(function(V){return ce.dx.formatValue(V.percent,p)})},i.drawPercentBars=function(e,t,r,s,a){if(s||!e.dataPoints||e.categoryCount<2)i.drawPercentBarComponents(t,[],r,e.percentBarLabelSettings,a);else{var l=[e.dataPoints[e.hasHighlights?1:0],e.dataPoints[e.dataPoints.length-1]],c=re(l[0]);if(c<=0)i.drawPercentBarComponents(t,[],r,e.percentBarLabelSettings,a);else{var o=[{value:re(l[0]),percent:1,isTop:!0},{value:re(l[1]),percent:re(l[1])/c,isTop:!1}];i.drawPercentBarComponents(t,o,r,e.percentBarLabelSettings,a)}}},i.prototype.showCategoryLabels=function(){return!(this.funnelSmallViewPortProperties&&this.funnelSmallViewPortProperties.hideFunnelCategoryLabelsOnSmallViewPort&&this.currentViewport.height<this.funnelSmallViewPortProperties.minHeightFunnelCategoryLabelsVisible)&&this.data&&this.data.categoryAxisSettings&&this.data.categoryAxisSettings.show},i.addFunnelPercentsToTooltip=function(e,t,r,s,a,l){null!=s&&t.push({displayName:r.getLocalizedString("Funnel_PercentOfFirst"+(l?"_Highlight":"")),value:(0,Y.WU)(s,e)}),null!=a&&t.push({displayName:r.getLocalizedString("Funnel_PercentOfPrevious"+(l?"_Highlight":"")),value:(0,Y.WU)(a,e)})},i.getDefaultLabelSettings=function(e){return{show:!0,position:we.h.insideCenter,displayUnits:0,fontProperties:(0,y.bT)({style:e,textClassName:"lightLabel",noColor:!0}).fontProperties,labelStyle:T.aT,enableBackground:!1,backgroundColor:h.v.getThemeColor(e,n.U),backgroundTransparency:.5,percentagePrecision:ne.Qc,bold:!1,italic:!1,underline:!1}},i.getDefaultPercentLabelSettings=function(e){return{show:!0,position:0,displayUnits:0,fontProperties:(0,y.bT)({labelColor:h.v.getThemeColor(e,ne.uQ),style:e,textClassName:"lightLabel"}).fontProperties,bold:!1,italic:!1,underline:!1}},i.getDefaultCategoryLabelSettings=function(e){return{show:!0,fontProperties:(0,y.bT)({labelColor:h.v.getThemeColor(e,ne.uQ),style:e,textClassName:"lightLabel"}).fontProperties,bold:!1,italic:!1,underline:!1}},i.prototype.getLabels=function(e,t){var r=[];if(this.data.dataLabelsSettings.show&&this.data.canShowDataLabels){var s=this.createLabelDataPoints(e.shapeLayout,this.data.dataLabelsSettings);r=new st.nu({maximumOffset:ne.wh,startingOffset:ne.ki}).layout([{labelDataPoints:s,maxNumberOfLabels:s.length}],{width:this.currentViewport.width-t.left,height:this.currentViewport.height-t.top})}return r},i.prototype.createLabelDataPoints=function(e,t){var r,s,a=this.data,l=a.dataPoints;if(_.isEmpty(l))return[];var c=new Array,o=l[0],g=i.LabelInsidePosition,p=e.height(o);t.position&&t.position===we.h.outsideEnd&&(g=i.LabelOutsidePosition);var V=null;0===t.displayUnits&&(V=a.dataPoints.reduce(function(be,me){return Math.abs(be.value)>Math.abs(me.value)?be:me}).value);var M=(0,Y.EO)(a.valuesMetadata[0],m.jP.general.formatString),N=(0,y.fI)(),w=a.dataLabelsSettings,Z=w.labelStyle,G=w.fontProperties;_.isEmpty(G)&&(G=ne.bL);var X,W=(0,Le.qk)(G),C=(0,Y.Z)("Percentage"),v=(0,y.fI)(),H=_.clone(w),Q=H.percentagePrecision;H.displayUnits=0,_.isFinite(Q)&&(X=v.getOrCreate(C,H,null,H.percentagePrecision));for(var F=h.v.getThemeColor(this.style,ne.uQ),he=h.v.getThemeColor(this.style,ne.pl),se=!0,J=0,Ce=l;J<Ce.length;J++){var A=Ce[J],Te=re(A,!0),Ee=i.getFormatStringFromDataPoint(A);if(null!=Te&&(!a.hasHighlights||A.highlight)){var ge=N.getOrCreate(Ee||M||o.labelFormatString,t,V).format(Te),B=void 0;if(se)B=ge,se=!1;else{var Ie=X?X.format(A.percentOfFirst):(0,Y.WU)(A.percentOfFirst,C),fe=X?X.format(A.percentOfPrevious):(0,Y.WU)(A.percentOfPrevious,C);switch(Z){case T.oN:B=Ie;break;case T.r2:B=fe;break;case T.MS:B=ge+" ("+Ie+")";break;case T.mN:B=ge+" ("+fe+")";break;default:B=ge}}W.text=B;var We=Se.b.measureSvgTextWidth(W),q=Se.b.estimateSvgTextHeight(W),le=1,R={rect:{left:e.x(A),top:e.y(A),width:e.width(A),height:e.height(A)},orientation:i.LabelOrientation,validPositions:g},oe=w.enableBackground,ve={isPreferred:!0,text:B,textSize:{width:We,height:q},fontProperties:G,parentType:le,parentShape:R,insideFill:null!==(r=A.labelFill)&&void 0!==r?r:he,outsideFill:null!==(s=A.labelFill)&&void 0!==s?s:F,identity:A.identity,backgroundColor:oe?w.backgroundColor:void 0,backgroundTransparency:oe?w.backgroundTransparency:void 0,hasBackground:oe};0===A.value&&(R={validPositions:[256],point:{x:e.x(A),y:e.y(A)+p/2}},le=0,ve.parentShape=R,ve.parentType=le,ve.insideFill=ve.outsideFill),c.push(ve)}}return c},i.LabelInsidePosition=[1,16],i.LabelOutsidePosition=[16,4],i.LabelOrientation=3,i.DefaultPercentBarStrokeColorName="foregroundNeutralTertiary",i.DefaultBarOpacity=1,i.DimmedBarOpacity=.4,i.MinimumInteractorSize=15,i.InnerTextClassName="labelSeries",i.YAxisPadding=10,i.VisualClassName="funnelChart",i.BarToSpaceRatio=.1,i.MaxBarHeight=60,i.MinBarThickness=12,i.OverflowingHighlightWidthRatio=.5,i.MaxMarginFactor=.25,i.DefaultMargin={left:5,right:5,top:0,bottom:0},i}()},79476:function(ze,de,b){b.d(de,{ao:function(){return T},fS:function(){return ue},oY:function(){return L}});var j=b(19377);function ue(d,f){return null!=d&&null!=f&&d.x===f.x&&d.y===f.y}function L(d,f,x){var O=(f.y-d.y)*(x.x-f.x)-(f.x-d.x)*(x.y-f.y);return 0===O?j.i.Colinear:O>0?j.i.Clockwise:j.i.Counterclockwise}function T(d,f,x){return x.x<=Math.max(d.x,f.x)&&x.x>=Math.min(d.x,f.x)&&x.y<=Math.max(d.y,f.y)&&x.y>=Math.min(d.y,f.y)}},92379:function(ze,de,b){b.d(de,{m:function(){return Be}});var j=b(19377),z=b(79476),ue=b(80758),Be=function(){function S(n){n&&(this.polygonPoints=this.convertArrayPathToPoints(n))}return S.fromPolygonPoints=function(n){var u=new S(null);return u.polygonPoints=n,u},S.prototype.absoluteCentroid=function(){return null==this._absoluteCentroid&&(this._absoluteCentroid=this.calculatePolygonCentroid()),this._absoluteCentroid},S.prototype.absoluteBoundingRect=function(){return null==this._absoluteBoundingRect&&(this._absoluteBoundingRect=this.calculateBoundingRect()),this._absoluteBoundingRect},S.prototype.contains=function(n){var h={x:n.left+n.width,y:n.top},y={x:n.left,y:n.top+n.height},P={x:n.left+n.width,y:n.top+n.height};return this.inside({x:n.left,y:n.top})&&this.inside(h)&&this.inside(y)&&this.inside(P)},S.prototype.conflicts=function(n){if(!this.isConflictWithBoundingBox(n))return!1;var h={x:n.left+n.width/2,y:n.top},y={x:n.left+n.width,y:n.top},P={x:n.left,y:n.top+n.height},L={x:n.left+n.width/2,y:n.top+n.height},T={x:n.left+n.width,y:n.top+n.height},d={x:n.left,y:n.top+n.height/2},f={x:n.left+n.width,y:n.top+n.height/2};return this.inside({x:n.left,y:n.top})||this.inside(h)||this.inside(y)||this.inside(P)||this.inside(L)||this.inside(T)||this.inside(d)||this.inside(f)},S.prototype.lineIntersectionPoint=function(n,u){for(var h=0;h<this.polygonPoints.length;h++){var L=this.getLineIntersection(n,u,this.polygonPoints[h],h===this.polygonPoints.length-1?this.polygonPoints[0]:this.polygonPoints[h+1]);if(null!==L)return L}return null},S.calculateAbsolutePolygonArea=function(n){var u,h=1,y=0;for(u=0;u<n.length;u++)y+=n[u].x*n[h].y-n[h].x*n[u].y,h=(h+1)%n.length;return.5*y},S.prototype.overlapPath=function(n){if(this.inside({x:n[0],y:n[1]}))return!0;var u=new S(n);if(u.inside(this.polygonPoints[0]))return!0;for(var h=0;h<this.polygonPoints.length;h++)if(u.lineIntersectionPoint(this.polygonPoints[h],this.polygonPoints[(h+1)%this.polygonPoints.length]))return!0;return!1},S.prototype.inside=function(n){for(var u=n.x,h=n.y,y=!1,P=0,L=this.polygonPoints.length-1;P<this.polygonPoints.length;L=P++){var T=this.polygonPoints[P].x,d=this.polygonPoints[P].y,x=this.polygonPoints[L].y;d>h!=x>h&&u<(this.polygonPoints[L].x-T)*(h-d)/(x-d)+T&&(y=!y)}return y},S.translateX=function(n,u){for(var h=new Float64Array(2*n.polygonPoints.length),y=0;y<n.polygonPoints.length;y++)h[2*y]=n.polygonPoints[y].x+u,h[2*y+1]=n.polygonPoints[y].y;return new S(h)},S.polygonBoundsOverlap=function(n,u){var h=(0,ue.WN)(S.getPolyBoundLeft(n),S.getPolyBoundRight(n),S.getPolyBoundLeft(u),S.getPolyBoundRight(u)),y=(0,ue.WN)(S.getPolyBoundLower(n),S.getPolyBoundUpper(n),S.getPolyBoundLower(u),S.getPolyBoundUpper(u));return h&&y},S.circleRectangleOverlap=function(n,u,h){var y=Math.max(n.left,Math.min(u.x,n.right)),P=Math.min(n.bottom,Math.max(u.y,n.top)),L=y-u.x,T=P-u.y;return L*L+T*T<=h*h},S.linesIntersect=function(n,u,h,y,P){void 0===P&&(P=!0);var L=(0,z.oY)(n,u,h),T=(0,z.oY)(n,u,y),d=(0,z.oY)(h,y,n),f=(0,z.oY)(h,y,u);return L!==T&&d!==f||!!P&&!!(L===j.i.Colinear&&(0,z.ao)(n,u,h)||T===j.i.Colinear&&(0,z.ao)(n,u,y)||d===j.i.Colinear&&(0,z.ao)(h,y,n)||f===j.i.Colinear&&(0,z.ao)(h,y,u))},S.resize=function(n,u){if(0===u)return n;for(var h=S.calculateAbsolutePolygonArea(n.polygonPoints)>0,P=_.clone(u>0&&!0===h||u<0&&!1===h?n.polygonPoints.reverse():n.polygonPoints),L=n.absoluteCentroid(),T=[],d=0;d<P.length;d++){var f=P[d],x=P[(d+1)%P.length],O=x.y-f.y,I=void 0;0!==O&&(I=-(x.x-f.x)/O);var ie=0;_.isUndefined(I)||(ie=(f.y<x.y?-1:1)*Math.sqrt(u*u/(1+I*I)));var Y=0;0===ie?Y=(f.x>x.x?-1:1)*u:_.isUndefined(I)||(Y=I*ie);var E={x:f.x+ie,y:f.y+Y},k={x:0,y:0};0===I?(k.x=E.x,k.y=E.y+10):_.isUndefined(I)||(k.x=E.x+10,k.y=E.y-10/I);var ce=(E.x-k.x)*(L.y-f.y)-(E.y-k.y)*(L.x-f.x);if(0!==ce){var $={x:((E.x*k.y-E.y*k.x)*(L.x-f.x)-(E.x-k.x)*(L.x*f.y-L.y*f.x))/ce,y:((E.x*k.y-E.y*k.x)*(L.y-f.y)-(E.y-k.y)*(L.x*f.y-L.y*f.x))/ce};isFinite($.x)&&isFinite($.y)&&T.push($)}}return S.fromPolygonPoints(T)},S.getPolyBoundLeft=function(n){var u;return null===(u=_.minBy(n.polygonPoints,function(h){return h.x}))||void 0===u?void 0:u.x},S.getPolyBoundRight=function(n){var u;return null===(u=_.maxBy(n.polygonPoints,function(h){return h.x}))||void 0===u?void 0:u.x},S.getPolyBoundUpper=function(n){var u;return null===(u=_.maxBy(n.polygonPoints,function(h){return h.y}))||void 0===u?void 0:u.y},S.getPolyBoundLower=function(n){var u;return null===(u=_.minBy(n.polygonPoints,function(h){return h.y}))||void 0===u?void 0:u.y},S.prototype.isConflictWithBoundingBox=function(n){return(0,ue.HL)(this.absoluteBoundingRect(),n)},S.prototype.calculatePolygonCentroid=function(){var n,u,h,y,P,L;for(n=S.calculateAbsolutePolygonArea(this.polygonPoints),h=y=0,L=1,P=0;P<this.polygonPoints.length;P++)h+=(this.polygonPoints[P].x+this.polygonPoints[L].x)*(u=this.polygonPoints[P].x*this.polygonPoints[L].y-this.polygonPoints[L].x*this.polygonPoints[P].y),y+=(this.polygonPoints[P].y+this.polygonPoints[L].y)*u,L=(L+1)%this.polygonPoints.length;return{x:h/=6*n,y:y/=6*n}},S.prototype.calculateBoundingRect=function(){for(var n=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,y=Number.NEGATIVE_INFINITY,P=0,L=this.polygonPoints;P<L.length;P++){var T=L[P];T.x<n?n=T.x:T.x>h&&(h=T.x),T.y<u?u=T.y:T.y>y&&(y=T.y)}return{left:n,top:u,width:h-n,height:y-u}},S.prototype.getLineIntersection=function(n,u,h,y){var P=n.x,L=n.y,f=h.x,x=h.y,ie=u.x-P,Y=u.y-L,E=y.x-f,k=y.y-x,ce=(-Y*(P-f)+ie*(L-x))/(-E*Y+ie*k),$=(E*(L-x)-k*(P-f))/(-E*Y+ie*k);return ce>=0&&ce<=1&&$>=0&&$<=1?{x:P+$*ie,y:L+$*Y}:null},S.prototype.convertArrayPathToPoints=function(n){for(var u=[],h=0;h<n.length;h+=2)u.push({x:n[h],y:n[h+1]});return u},S}()},19377:function(ze,de,b){b.d(de,{i:function(){return j}});var j=function(z){return z[z.Clockwise=0]="Clockwise",z[z.Counterclockwise=1]="Counterclockwise",z[z.Colinear=2]="Colinear",z}({})}}]);