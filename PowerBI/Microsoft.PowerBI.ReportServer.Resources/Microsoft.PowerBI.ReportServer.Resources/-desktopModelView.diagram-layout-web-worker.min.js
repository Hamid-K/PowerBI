"use strict";var Qv=Object.defineProperty,Xv=(qr,Ye,ie)=>Ye in qr?Qv(qr,Ye,{enumerable:!0,configurable:!0,writable:!0,value:ie}):qr[Ye]=ie,$n=(qr,Ye,ie)=>(Xv(qr,"symbol"!=typeof Ye?Ye+"":Ye,ie),ie);const window=self;!function(){var Tt,Nt,ft,Dt,qr={32878:function(Tt){function Nt(Dt,Ot){for(var Gt=0;Gt<Ot.length;Gt++){var kt=Ot[Gt];kt.enumerable=kt.enumerable||!1,kt.configurable=!0,"value"in kt&&(kt.writable=!0),Object.defineProperty(Dt,kt.key,kt)}}Tt.exports=function(Dt,Ot,Gt){return Ot&&Nt(Dt.prototype,Ot),Gt&&Nt(Dt,Gt),Dt},Tt.exports.default=Tt.exports,Tt.exports.__esModule=!0},12864:function(Tt,Nt,ft){var Dt=ft(74);Tt.exports=function(Gt,kt){Gt.prototype=Object.create(kt.prototype),Gt.prototype.constructor=Gt,Dt(Gt,kt)},Tt.exports.default=Tt.exports,Tt.exports.__esModule=!0},74:function(Tt){function Nt(ft,Dt){return Tt.exports=Nt=Object.setPrototypeOf||function(Gt,kt){return Gt.__proto__=kt,Gt},Tt.exports.default=Tt.exports,Tt.exports.__esModule=!0,Nt(ft,Dt)}Tt.exports=Nt,Tt.exports.default=Tt.exports,Tt.exports.__esModule=!0},41708:function(Tt,Nt){Nt.HT=Nt.Ld=void 0;const st=class st{static IsNullOrWhiteSpace(tt){return st.isNullOrWhiteSpace(tt)}static Join(tt,...$){return st.join(tt,...$)}static Format(tt,...$){return st.format(tt,...$)}static isNullOrWhiteSpace(tt){try{return null==tt||"undefined"==tt||tt.toString().replace(/\s/g,"").length<1}catch($){return!1}}static join(tt,...$){try{var ot=$[0];if(Array.isArray(ot)||ot instanceof Array){let pt=st.empty;for(let zt=0;zt<ot.length;zt++){var wt=ot[zt];pt+=zt<ot.length-1?wt+tt:wt}return pt}if("object"==typeof ot){let pt=st.empty;const zt=ot;return Object.keys(ot).forEach(Jn=>{pt+=zt[Jn]+tt}),pt=pt.slice(0,pt.length-tt.length)}return st.joinString(tt,...$)}catch(pt){return st.empty}}static format(tt,...$){try{return tt.match(st.regexNumber)?st.formatString(st.regexNumber,tt,$):tt.match(st.regexObject)?st.formatString(st.regexObject,tt,$,!0):tt}catch(ot){return st.empty}}static formatString(tt,$,ot,wt=!1){return $.replace(tt,function(bt,pt){const zt=bt.split(":");let oe;return 1<zt.length&&(pt=zt[0].replace("{",""),bt=zt[1].replace("}","")),null==(oe=(wt?ot[0]:ot)[pt])||null==oe||bt.match(/{\d+}/)||void 0!==(oe=st.parsePattern(bt,oe))&&null!=oe?oe:st.empty})}static parsePattern(tt,$){switch(tt){case"L":return $.toLocaleLowerCase();case"U":return $.toLocaleUpperCase();case"d":if("string"==typeof $)return st.getDisplayDateFromString($);if($ instanceof Date)return st.format("{0:00}.{1:00}.{2:0000}",$.getDate(),$.getMonth(),$.getFullYear());break;case"s":if("string"==typeof $)return st.getSortableDateFromString($);if($ instanceof Date)return st.format("{0:0000}-{1:00}-{2:00}",$.getFullYear(),$.getMonth(),$.getDate());break;case"n":{const bt=($="string"!=typeof $?$.toString():$).replace(/,/g,".");if(isNaN(parseFloat(bt))||bt.length<=3)break;const pt=bt.split(/\D+/g);let zt=pt;const oe=(zt=1<pt.length?[st.joinString("",...pt.splice(0,pt.length-1)),pt[pt.length-1]]:zt)[0];var ot=0<(wt=oe.length%3)?oe.substring(0,wt):st.empty,wt=oe.substring(wt).match(/.{3}/g);return ot+"."+st.join(".",wt)+(1<zt.length?","+zt[1]:"")}case"x":return this.decimalToHexString($);case"X":return this.decimalToHexString($,!0)}return"number"!=typeof $&&isNaN($)||isNaN(+tt)||st.isNullOrWhiteSpace($)?$:st.formatNumber($,tt)}static decimalToHexString(tt,$=!1){const wt=parseFloat(tt).toString(16);return $?wt.toLocaleUpperCase():wt}static getDisplayDateFromString(tt){var $=tt.split("-");if($.length<=1)return tt;let ot=$[$.length-1];return tt=$[$.length-2],$=$[$.length-3],(ot=(ot=ot.split("T")[0]).split(" ")[0])+`.${tt}.`+$}static getSortableDateFromString(tt){const $=tt.replace(",","").split(".");if($.length<=1)return tt;tt=$[$.length-1].split(" ");let ot=st.empty,wt=(1<tt.length&&(ot=tt[tt.length-1]),$[$.length-1].split(" ")[0]+`-${$[$.length-2]}-`+$[$.length-3]);return!st.isNullOrWhiteSpace(ot)&&1<ot.length?wt+="T"+ot:wt+="T00:00:00",wt}static formatNumber(wt,ot){return(ot=ot.length)<=(wt=wt.toString()).length?wt:(ot-=wt.length,++ot,new Array(ot).join("0")+wt)}static joinString(tt,...$){let ot=st.empty;for(let bt=0;bt<$.length;bt++)if(!("string"==typeof $[bt]&&st.isNullOrWhiteSpace($[bt])||"number"!=typeof $[bt]&&"string"!=typeof $[bt])){ot+=""+$[bt];for(let pt=bt+1;pt<$.length;pt++)if(!st.isNullOrWhiteSpace($[pt])){ot+=tt,bt=pt-1;break}}return ot}};$n(st,"regexNumber",/{(\d+(:\w*)?)}/g),$n(st,"regexObject",/{(\w+(:\w*)?)}/g),$n(st,"empty",""),$n(st,"Empty","");let Pt=st;Nt.Ld=Pt,Nt.HT=class{constructor(tt=""){$n(this,"Values"),this.Values=[],Pt.isNullOrWhiteSpace(tt)||(this.Values=new Array(tt))}toString(){return this.Values.join(Pt.empty)}ToString(){return this.toString()}append(tt){this.Values.push(tt)}Append(tt){this.append(tt)}appendLine(tt){this.Values.push("\r\n"+tt)}AppendLine(tt){this.appendLine(tt)}appendFormat(tt,...$){this.Values.push(Pt.format(tt,...$))}AppendFormat(tt,...$){this.appendFormat(tt,...$)}appendLineFormat(tt,...$){this.Values.push("\r\n"+Pt.format(tt,...$))}AppendLineFormat(tt,...$){return this.appendLineFormat(tt,...$)}clear(){this.Values=[]}Clear(){this.clear()}}},72147:function(Tt,Nt,ft){var Dt=ft(32878).default;function Ot(){Ot=function(){return Et};var Pt,Et={},st=Object.prototype,St=st.hasOwnProperty,tt=Object.defineProperty||function(X,et,rt){X[et]=rt.value},$="function"==typeof Symbol?Symbol:{},ot=$.iterator||"@@iterator",wt=$.asyncIterator||"@@asyncIterator",bt=$.toStringTag||"@@toStringTag";function pt(X,et,rt){return Object.defineProperty(X,et,{value:rt,enumerable:!0,configurable:!0,writable:!0}),X[et]}try{pt({},"")}catch{pt=function(rt,ct,yt){return rt[ct]=yt}}function zt(X,et,rt,ct){var at=Object.create((et&&et.prototype instanceof Wi?et:Wi).prototype),Rt=new Q(ct||[]);return tt(at,"_invoke",{value:Hi(X,rt,Rt)}),at}function oe(X,et,rt){try{return{type:"normal",arg:X.call(et,rt)}}catch(ct){return{type:"throw",arg:ct}}}Et.wrap=zt;var Jn="suspendedStart",bs="suspendedYield",ji="executing",Zn="completed",Me={};function Wi(){}function Kn(){}function ae(){}var er={};pt(er,ot,function(){return this});var Er=Object.getPrototypeOf,Cr=Er&&Er(Er(Ur([])));Cr&&Cr!==st&&St.call(Cr,ot)&&(er=Cr);var rr=ae.prototype=Wi.prototype=Object.create(er);function ti(X){["next","throw","return"].forEach(function(et){pt(X,et,function(rt){return this._invoke(et,rt)})})}function Ln(X,et){function rt(yt,at,Rt,q){var se=oe(X[yt],X,at);if("throw"!==se.type){var It=se.arg,be=It.value;return be&&"object"==typeof be&&St.call(be,"__await")?et.resolve(be.__await).then(function(Lr){rt("next",Lr,Rt,q)},function(Lr){rt("throw",Lr,Rt,q)}):et.resolve(be).then(function(Lr){It.value=Lr,Rt(It)},function(Lr){return rt("throw",Lr,Rt,q)})}q(se.arg)}var ct;tt(this,"_invoke",{value:function(at,Rt){function q(){return new et(function(se,It){rt(at,Rt,se,It)})}return ct=ct?ct.then(q,q):q()}})}function Hi(X,et,rt){var ct=Jn;return function(yt,at){if(ct===ji)throw new Error("Generator is already running");if(ct===Zn){if("throw"===yt)throw at;return{value:Pt,done:!0}}for(rt.method=yt,rt.arg=at;;){var Rt=rt.delegate;if(Rt){var q=_i(Rt,rt);if(q){if(q===Me)continue;return q}}if("next"===rt.method)rt.sent=rt._sent=rt.arg;else if("throw"===rt.method){if(ct===Jn)throw ct=Zn,rt.arg;rt.dispatchException(rt.arg)}else"return"===rt.method&&rt.abrupt("return",rt.arg);ct=ji;var se=oe(X,et,rt);if("normal"===se.type){if(ct=rt.done?Zn:bs,se.arg===Me)continue;return{value:se.arg,done:rt.done}}"throw"===se.type&&(ct=Zn,rt.method="throw",rt.arg=se.arg)}}}function _i(X,et){var rt=et.method,ct=X.iterator[rt];if(ct===Pt)return et.delegate=null,"throw"===rt&&X.iterator.return&&(et.method="return",et.arg=Pt,_i(X,et),"throw"===et.method)||"return"!==rt&&(et.method="throw",et.arg=new TypeError("The iterator does not provide a '"+rt+"' method")),Me;var yt=oe(ct,X.iterator,et.arg);if("throw"===yt.type)return et.method="throw",et.arg=yt.arg,et.delegate=null,Me;var at=yt.arg;return at?at.done?(et[X.resultName]=at.value,et.next=X.nextLoc,"return"!==et.method&&(et.method="next",et.arg=Pt),et.delegate=null,Me):at:(et.method="throw",et.arg=new TypeError("iterator result is not an object"),et.delegate=null,Me)}function C(X){var et={tryLoc:X[0]};1 in X&&(et.catchLoc=X[1]),2 in X&&(et.finallyLoc=X[2],et.afterLoc=X[3]),this.tryEntries.push(et)}function In(X){var et=X.completion||{};et.type="normal",delete et.arg,X.completion=et}function Q(X){this.tryEntries=[{tryLoc:"root"}],X.forEach(C,this),this.reset(!0)}function Ur(X){if(X||""===X){var et=X[ot];if(et)return et.call(X);if("function"==typeof X.next)return X;if(!isNaN(X.length)){var rt=-1,ct=function yt(){for(;++rt<X.length;)if(St.call(X,rt))return yt.value=X[rt],yt.done=!1,yt;return yt.value=Pt,yt.done=!0,yt};return ct.next=ct}}throw new TypeError(typeof X+" is not iterable")}return Kn.prototype=ae,tt(rr,"constructor",{value:ae,configurable:!0}),tt(ae,"constructor",{value:Kn,configurable:!0}),Kn.displayName=pt(ae,bt,"GeneratorFunction"),Et.isGeneratorFunction=function(X){var et="function"==typeof X&&X.constructor;return!!et&&(et===Kn||"GeneratorFunction"===(et.displayName||et.name))},Et.mark=function(X){return Object.setPrototypeOf?Object.setPrototypeOf(X,ae):(X.__proto__=ae,pt(X,bt,"GeneratorFunction")),X.prototype=Object.create(rr),X},Et.awrap=function(X){return{__await:X}},ti(Ln.prototype),pt(Ln.prototype,wt,function(){return this}),Et.AsyncIterator=Ln,Et.async=function(X,et,rt,ct,yt){void 0===yt&&(yt=Promise);var at=new Ln(zt(X,et,rt,ct),yt);return Et.isGeneratorFunction(et)?at:at.next().then(function(Rt){return Rt.done?Rt.value:at.next()})},ti(rr),pt(rr,bt,"Generator"),pt(rr,ot,function(){return this}),pt(rr,"toString",function(){return"[object Generator]"}),Et.keys=function(X){var et=Object(X),rt=[];for(var ct in et)rt.push(ct);return rt.reverse(),function yt(){for(;rt.length;){var at=rt.pop();if(at in et)return yt.value=at,yt.done=!1,yt}return yt.done=!0,yt}},Et.values=Ur,Q.prototype={constructor:Q,reset:function(et){if(this.prev=0,this.next=0,this.sent=this._sent=Pt,this.done=!1,this.delegate=null,this.method="next",this.arg=Pt,this.tryEntries.forEach(In),!et)for(var rt in this)"t"===rt.charAt(0)&&St.call(this,rt)&&!isNaN(+rt.slice(1))&&(this[rt]=Pt)},stop:function(){this.done=!0;var et=this.tryEntries[0].completion;if("throw"===et.type)throw et.arg;return this.rval},dispatchException:function(et){if(this.done)throw et;var rt=this;function ct(It,be){return Rt.type="throw",Rt.arg=et,rt.next=It,be&&(rt.method="next",rt.arg=Pt),!!be}for(var yt=this.tryEntries.length-1;yt>=0;--yt){var at=this.tryEntries[yt],Rt=at.completion;if("root"===at.tryLoc)return ct("end");if(at.tryLoc<=this.prev){var q=St.call(at,"catchLoc"),se=St.call(at,"finallyLoc");if(q&&se){if(this.prev<at.catchLoc)return ct(at.catchLoc,!0);if(this.prev<at.finallyLoc)return ct(at.finallyLoc)}else if(q){if(this.prev<at.catchLoc)return ct(at.catchLoc,!0)}else{if(!se)throw new Error("try statement without catch or finally");if(this.prev<at.finallyLoc)return ct(at.finallyLoc)}}}},abrupt:function(et,rt){for(var ct=this.tryEntries.length-1;ct>=0;--ct){var yt=this.tryEntries[ct];if(yt.tryLoc<=this.prev&&St.call(yt,"finallyLoc")&&this.prev<yt.finallyLoc){var at=yt;break}}at&&("break"===et||"continue"===et)&&at.tryLoc<=rt&&rt<=at.finallyLoc&&(at=null);var Rt=at?at.completion:{};return Rt.type=et,Rt.arg=rt,at?(this.method="next",this.next=at.finallyLoc,Me):this.complete(Rt)},complete:function(et,rt){if("throw"===et.type)throw et.arg;return"break"===et.type||"continue"===et.type?this.next=et.arg:"return"===et.type?(this.rval=this.arg=et.arg,this.method="return",this.next="end"):"normal"===et.type&&rt&&(this.next=rt),Me},finish:function(et){for(var rt=this.tryEntries.length-1;rt>=0;--rt){var ct=this.tryEntries[rt];if(ct.finallyLoc===et)return this.complete(ct.completion,ct.afterLoc),In(ct),Me}},catch:function(et){for(var rt=this.tryEntries.length-1;rt>=0;--rt){var ct=this.tryEntries[rt];if(ct.tryLoc===et){var yt=ct.completion;if("throw"===yt.type){var at=yt.arg;In(ct)}return at}}throw new Error("illegal catch attempt")},delegateYield:function(et,rt,ct){return this.delegate={iterator:Ur(et),resultName:rt,nextLoc:ct},"next"===this.method&&(this.arg=Pt),Me}},Et}Object.defineProperty(Nt,"__esModule",{value:!0});var Gt=function(Pt){function Et(){var St=this;this._head=this._tail=null,this._length=0;for(var tt=arguments.length,$=new Array(tt),ot=0;ot<tt;ot++)$[ot]=arguments[ot];$.length>0&&$.forEach(function(wt){St.append(wt)})}var st=Et.prototype;return st.iterator=Ot().mark(function St(){var tt;return Ot().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:tt=this._head;case 1:if(!tt){ot.next=7;break}return ot.next=4,tt.value;case 4:tt=tt.next,ot.next=1;break;case 7:case"end":return ot.stop()}},St,this)}),st[Pt]=function(){return this.iterator()},st.insert=function(tt,$,ot){if(void 0===ot&&(ot=!1),ot&&this.isDuplicate(tt))return!1;var wt=new kt(tt),bt=this._head;if(!bt)return!1;for(;;){if(bt.value===$)return wt.next=bt.next,wt.prev=bt,bt.next=wt,wt.next?wt.next.prev=wt:this._tail=wt,this._length++,!0;if(!bt.next)return!1;bt=bt.next}},st.append=function(tt,$){if(void 0===$&&($=!1),$&&this.isDuplicate(tt))return!1;var ot=new kt(tt);return this._tail?(this._tail.next=ot,ot.prev=this._tail,this._tail=ot):this._head=this._tail=ot,this._length++,!0},st.prepend=function(tt,$){if(void 0===$&&($=!1),$&&this.isDuplicate(tt))return!1;var ot=new kt(tt);return this._head?(ot.next=this._head,this._head.prev=ot,this._head=ot):this._head=this._tail=ot,this._length++,!0},st.remove=function(tt){var $=this._head;if($){if($.value===tt)return this._head=$.next,this._head.prev=null,$.next=$.prev=null,this._length--,$.value;for(;;){if($.value===tt)return $.next?($.prev.next=$.next,$.next.prev=$.prev,$.next=$.prev=null):($.prev.next=null,this._tail=$.prev,$.next=$.prev=null),this._length--,$.value;if(!$.next)return;$=$.next}}},st.removeHead=function(){var tt=this._head;if(tt)return this._head.next?(this._head.next.prev=null,this._head=this._head.next,tt.next=tt.prev=null):(this._head=null,this._tail=null),this._length--,tt.value},st.removeTail=function(){var tt=this._tail;if(tt)return this._tail.prev?(this._tail.prev.next=null,this._tail=this._tail.prev,tt.next=tt.prev=null):(this._head=null,this._tail=null),this._length--,tt.value},st.first=function(tt){for(var $=this.iterator(),ot=[],wt=Math.min(tt,this.length),bt=0;bt<wt;bt++){var pt=$.next();ot.push(pt.value)}return ot},st.toArray=function(){return[].concat(this)},st.isDuplicate=function(tt){return new Set(this.toArray()).has(tt)},Dt(Et,[{key:"head",get:function(){return this._head?this._head.value:null}},{key:"tail",get:function(){return this._tail?this._tail.value:null}},{key:"length",get:function(){return this._length}}]),Et}(Symbol.iterator);Nt.LinkedList=Gt;var kt=function(Et){this.value=Et,this.next=null,this.prev=null};Nt.LinkedListItem=kt},92985:function(Tt,Nt,ft){var Ot=ft(32878).default,Gt=ft(12864).default,Pt=function(Et){function st(){for(var tt=arguments.length,$=new Array(tt),ot=0;ot<tt;ot++)$[ot]=arguments[ot];return Et.call.apply(Et,[this].concat($))||this}Gt(st,Et);var St=st.prototype;return St.enqueue=function($){this.append($)},St.dequeue=function(){return this.removeHead()},Ot(st,[{key:"front",get:function(){return this.head}}]),st}(ft(72147).LinkedList);Nt.c=Pt},73903:function(Tt,Nt,ft){var Ot=ft(32878).default,Gt=ft(12864).default,Pt=function(Et){function st(){for(var tt=arguments.length,$=new Array(tt),ot=0;ot<tt;ot++)$[ot]=arguments[ot];return Et.call.apply(Et,[this].concat($))||this}Gt(st,Et);var St=st.prototype;return St.push=function($){this.prepend($)},St.pop=function(){return this.removeHead()},Ot(st,[{key:"top",get:function(){return this.head}},{key:"size",get:function(){return this.length}}]),st}(ft(72147).LinkedList);Nt.K=Pt}},Ye={};function ie(Tt){var Nt=Ye[Tt];if(void 0!==Nt)return Nt.exports;var ft=Ye[Tt]={exports:{}};return qr[Tt](ft,ft.exports,ie),ft.exports}Tt=ie.u,Nt=ie.e,ft=new Map,Dt=new Map,ie.u=function(Ot){return Tt(Ot)+(ft.has(Ot)?"?"+ft.get(Ot):"")},ie.e=function(Ot){return Nt(Ot).catch(function(kt){var Pt=Dt.has(Ot)?Dt.get(Ot):5;if(Pt<1){var Et=Tt(Ot);throw kt.message="Loading chunk "+Ot+" failed after 5 retries.\n("+Et+")",kt.request=Et,kt}return new Promise(function(st){setTimeout(function(){var $=Date.now();ft.set(Ot,$),Dt.set(Ot,Pt-1),st(ie.e(Ot))},3e3)})})},function(){var ft=function(){return ft=Object.assign||function(s){for(var o,t=1,e=arguments.length;t<e;t++)for(var r in o=arguments[t])Object.prototype.hasOwnProperty.call(o,r)&&(s[r]=o[r]);return s},ft.apply(this,arguments)};function Pt(l,s,o,t){return new(o||(o=Promise))(function(r,i){function h(p){try{f(t.next(p))}catch(y){i(y)}}function c(p){try{f(t.throw(p))}catch(y){i(y)}}function f(p){p.done?r(p.value):function(r){return r instanceof o?r:new o(function(i){i(r)})}(p.value).then(h,c)}f((t=t.apply(l,s||[])).next())})}function Et(l,s){var t,e,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function h(f){return function(p){return function(f){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,e&&(r=2&f[0]?e.return:f[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,f[1])).done)return r;switch(e=0,r&&(f=[2&f[0],r.value]),f[0]){case 0:case 1:r=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,e=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===f[0]||2===f[0])){o=0;continue}if(3===f[0]&&(!r||f[1]>r[0]&&f[1]<r[3])){o.label=f[1];break}if(6===f[0]&&o.label<r[1]){o.label=r[1],r=f;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(f);break}r[2]&&o.ops.pop(),o.trys.pop();continue}f=s.call(l,o)}catch(p){f=[6,p],e=0}finally{t=r=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,p])}}}function bt(l,s,o){if(o||2===arguments.length)for(var r,t=0,e=s.length;t<e;t++)(r||!(t in s))&&(r||(r=Array.prototype.slice.call(s,0,t)),r[t]=s[t]);return l.concat(r||s)}var ae=function(l){return l[l.Ping=0]="Ping",l[l.PerformLayout=1]="PerformLayout",l}({}),er=function(l){return l[l.Success=0]="Success",l[l.Failure=1]="Failure",l}({});function Er(l){for(var s,o,t=-1,e=-1,r=-1,i=-1,h=0,c=l.nodes;h<c.length;h++){var f=c[h];if(f){var p=null!==(s=f.left)&&void 0!==s?s:0,y=null!==(o=f.top)&&void 0!==o?o:0;(-1===t||y<t)&&(t=y);var m=y+f.height;(-1===e||m>e)&&(e=m),(-1===r||p<r)&&(r=p);var P=p+f.width;(-1===i||P>i)&&(i=P)}}return{left:r,top:t,width:i-r,height:e-t}}function Cr(l){for(var s=-1,o=-1,t=-1,e=-1,r=0,i=l.nodes;r<i.length;r++){var h=i[r],c=h.y+h.height,f=h.x+h.width;(-1===s||h.x<s)&&(s=h.x),(-1===o||h.y<o)&&(o=h.y),(-1===t||c>t)&&(t=c),(-1===e||f>e)&&(e=f)}return{x:s,y:o,width:e-s,height:t-o}}function rr(l){return null!=l}function ti(l,s){var o=Er({nodes:l});return l.filter(function(t){return!!t&&(s||rr(t.left)&&rr(t.top))}).map(function(t){var e,r,i=null!==(e=t.top)&&void 0!==e?e:0;return{x:null!==(r=t.left)&&void 0!==r?r:0,height:t.height,width:t.width,y:o.height-i-t.height,sourceIndex:t.sourceIndex}})}function Ln(l){var s=Cr({nodes:l});return l.map(function(o){return{left:o.x,height:o.height,width:o.width,top:s.height-o.height-o.y,sourceIndex:o.sourceIndex}})}function Hi(l,s){(null==s||s>l.length)&&(s=l.length);for(var o=0,t=new Array(s);o<s;o++)t[o]=l[o];return t}function C(l,s){var o=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(o)return(o=o.call(l)).next.bind(o);if(Array.isArray(l)||(o=function(l,s){if(l){if("string"==typeof l)return Hi(l,s);var o=Object.prototype.toString.call(l).slice(8,-1);if("Object"===o&&l.constructor&&(o=l.constructor.name),"Map"===o||"Set"===o)return Array.from(l);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Hi(l,s)}}(l))||s&&l&&"number"==typeof l.length){o&&(l=o);var t=0;return function(){return t>=l.length?{done:!0}:{done:!1,value:l[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function In(l,s){for(var o=0;o<s.length;o++){var t=s[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(l,t.key,t)}}function Q(l,s,o){return s&&In(l.prototype,s),o&&In(l,o),l}function Ur(l,s){return(Ur=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(l,s)}function X(l,s){l.prototype=Object.create(s.prototype),l.prototype.constructor=l,Ur(l,s)}var et=function(){function l(o,t){this.entity=o,this.bind(t)}return l.prototype.bind=function(t){this.entity&&this.entity.setAttr(t,this)},l}(),rt=function(){};function ct(){ct=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}rt.GeomObjectIndex=0,rt.DrawingObjectIndex=1,rt.AlgorithmDataIndex=2,rt.ViewerIndex=3;var at=function(l){function s(t){return l.call(this,t,rt.GeomObjectIndex)||this}X(s,l),s.getGeom=function(e){return e.getAttr(rt.GeomObjectIndex)};var o=s.prototype;return o.rebind=function(e){this.entity=e,this.bind(rt.GeomObjectIndex)},o.getAncestors=ct().mark(function t(){var e;return ct().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=this.parent;case 1:if(null==e){i.next=7;break}return i.next=4,e;case 4:e=e.parent,i.next=1;break;case 7:case"end":return i.stop()}},t,this)}),Q(s,[{key:"parent",get:function(){var e=this.entity.parent;return e?s.getGeom(e):null}}]),s}(et),Rt=function(){function l(){}return l.solve=function(o,t,e,r,i,h){var c=o*i-r*t;if(!(Math.abs(c)<l.eps))return{x:(e*i-h*t)/c,y:(o*h-r*e)/c}},l}();Rt.eps=1e-8;var it,l,q=function(){};function It(l,s){var o=l-s;return o<0?-1:0===o?0:1}function be(l,s){return It(l.y,s.y)||It(l.x,s.x)}function dt(l,s){var o=l-s;return-q.distanceEpsilon<=o&&o<=q.distanceEpsilon}function xo(l,s){return ei(l,s)>0}function ei(l,s){var o=l-s;return o<=-q.distanceEpsilon?-1:o>=q.distanceEpsilon?1:0}function At(l,s){return l.sub(s).length}q.distanceEpsilonPrecision=6,q.mult=Math.pow(10,6),q.defaultLeafBoxesOffset=.5,q.lineSegmentThreshold=.05,q.intersectionEpsilon=1e-4,q.distanceEpsilon=Math.pow(10,-q.distanceEpsilonPrecision),q.squareOfDistanceEpsilon=Math.pow(10,2*-q.distanceEpsilonPrecision),q.tolerance=1e-8,(l=it||(it={}))[l.Clockwise=0]="Clockwise",l[l.Counterclockwise=1]="Counterclockwise",l[l.Collinear=2]="Collinear";var R=function(){function l(o,t){this.x_=o,this.y_=t}l.RoundPoint=function(t){return new l(l.RoundDouble(t.x),l.RoundDouble(t.y))},l.RoundDouble=function(t){return Math.round(t*q.mult)/q.mult};var s=l.prototype;return s.toJSON=function(){return{x:this.x,y:this.y}},l.fromJSON=function(t){return new l(t.x,t.y)},l.ProjectionToLine=function(t,e,r){var i=e.sub(t),h=i.length;if(h<q.distanceEpsilon)return t;i=i.div(h);var c=r.sub(t).dot(i);return t.add(i.mul(c))},l.RayIntersectsRayInteriors=function(t,e,r,i){var h=l.lineLineIntersection(t,t.add(e),r,r.add(i));if(h&&h.sub(t).dot(e.div(e.l1))>q.distanceEpsilon&&h.sub(r).dot(i.div(i.l1))>q.distanceEpsilon)return h},l.IntervalIntersectsRay=function(t,e,r,i){var h=l.lineLineIntersection(t,e,r,r.add(i));if(h){var c=t.sub(h),f=h.sub(e);if(!(c.dot(f)<=0)&&!(h.sub(r).dot(i)<0)&&c.dot(c)>q.squareOfDistanceEpsilon&&f.dot(f)>=q.squareOfDistanceEpsilon)return h}},l.PointToTheLeftOfLineOrOnLine=function(t,e,r){return l.signedDoubledTriangleArea(t,e,r)>=0},l.PointToTheLeftOfLine=function(t,e,r){return l.signedDoubledTriangleArea(t,e,r)>0},l.PointIsInsideCone=function(t,e,r,i){return l.PointToTheRightOfLineOrOnLine(t,e,r)&&l.PointToTheLeftOfLineOrOnLine(t,e,i)},l.PointToTheRightOfLineOrOnLine=function(t,e,r){return l.signedDoubledTriangleArea(e,r,t)<=0},l.PointToTheRightOfLine=function(t,e,r){return l.signedDoubledTriangleArea(e,r,t)<0},l.closeIntersections=function(t,e){return l.close(t,e,q.intersectionEpsilon)},s.dot=function(t){return this.x*t.x+this.y*t.y},s.compareTo=function(t){var e=It(this.x,t.x);return 0!==e?e:It(this.y,t.y)},s.toString=function(){return"("+this.x+","+this.y+")"},l.close=function(t,e,r){return t.sub(e).length<=r},l.closeSquare=function(t,e,r){var i=e.sub(t);return i.dot(i)<=r},l.closeDistEps=function(t,e,r){return void 0===r&&(r=q.distanceEpsilon),t.sub(e).length<=r},s.normalize=function(){var t=this.length;return new l(this.x/t,this.y/t)},l.middle=function(t,e){return t.add(e).div(2)},s.scale=function(t,e){return new l(this.x*t,this.y*e)},s.add=function(t){return new l(this.x+t.x,this.y+t.y)},s.sub=function(t){return new l(this.x-t.x,this.y-t.y)},s.mul=function(t){return new l(this.x*t,this.y*t)},s.div=function(t){return new l(this.x/t,this.y/t)},s.equal=function(t){return t.x===this.x&&t.y===this.y},s.neg=function(){return new l(-this.x,-this.y)},l.lineLineIntersection=function(t,e,r,i){var h=e.sub(t),c=r.sub(i),f=r.sub(t),p=Rt.solve(h.x,c.x,f.x,h.y,c.y,f.y);if(void 0!==p)return t.add(h.mul(p.x))},l.segSegIntersection=function(t,e,r,i){var h=e.sub(t),c=r.sub(i),f=r.sub(t),p=q.tolerance,y=Rt.solve(h.x,c.x,f.x,h.y,c.y,f.y);if(void 0!==y&&y.x>-p&&y.x<1+p&&y.y>-p&&y.y<1+p)return t.add(h.mul(y.x))},l.parallelWithinEpsilon=function(t,e,r){var i=t.length,h=e.length;return i<r||h<r||(t=t.div(i),e=e.div(h),Math.abs(-t.x*e.y+t.y*e.x)<r)},l.crossProduct=function(t,e){return t.x*e.y-t.y*e.x},l.dot=function(t,e){return t.x*e.x+t.y*e.y},l.add=function(t,e){return t.add(e)},s.rotate90Ccw=function(){return new l(-this.y,this.x)},s.rotate90Cw=function(){return new l(this.y,-this.x)},s.clone=function(){return new l(this.x,this.y)},s.rotate=function(t){var e=Math.cos(t),r=Math.sin(t);return new l(e*this.x-r*this.y,r*this.x+e*this.y)},l.mkPoint=function(t,e,r,i){return e.mul(t).add(i.mul(r))},l.convSum=function(t,e,r){return e.add(r.sub(e).mul(t))},l.anglePCP=function(t,e,r){return l.angle(t.sub(e),r.sub(e))},l.angle=function(t,e){var r=t.x,i=t.y,h=e.x,c=e.y,f=r*c-i*h,p=r*h+i*c;if(Math.abs(p)<q.tolerance)return Math.abs(f)<q.tolerance?0:f<-q.tolerance?3*Math.PI/2:Math.PI/2;if(Math.abs(f)<q.tolerance)return p<-q.tolerance?Math.PI:0;var y=Math.atan2(f,p);return f>=-q.tolerance?y:2*Math.PI+y},l.signedDoubledTriangleArea=function(t,e,r){return(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)},l.getTriangleOrientation=function(t,e,r){var i=l.signedDoubledTriangleArea(t,e,r);return i>q.distanceEpsilon?it.Counterclockwise:i<-q.distanceEpsilon?it.Clockwise:it.Collinear},l.getTriangleOrientationWithIntersectionEpsilon=function(t,e,r){var i=l.signedDoubledTriangleArea(t,e,r);return i>q.intersectionEpsilon?it.Counterclockwise:i<-q.intersectionEpsilon?it.Clockwise:it.Collinear},l.ClosestPointAtLineSegment=function(t,e,r){var i=r.sub(e),h=t.sub(e),c=i.dot(h),f=i.dot(i);return c<=0+q.tolerance?e:f<=c+q.tolerance?r:e.add(i.mul(c/f))},l.pointToTheLeftOfLineOrOnLine=function(t,e,r){return l.signedDoubledTriangleArea(t,e,r)>=0},l.pointToTheLeftOfLine=function(t,e,r){return l.signedDoubledTriangleArea(t,e,r)>0},l.pointToTheRightOfLineOrOnLine=function(t,e,r){return l.signedDoubledTriangleArea(e,r,t)<=0},l.pointToTheRightOfLine=function(t,e,r){return l.signedDoubledTriangleArea(e,r,t)<0},l.canProject=function(t,e,r){var i=r.sub(e);return!(t.sub(e).dot(i)<0||t.sub(r).dot(i)>0)},l.distToLineSegment=function(t,e,r){var c,f,i=r.sub(e),h=t.sub(e);if((c=i.dot(h))<=q.tolerance)return{par:0,dist:h.length};if((f=i.dot(i))<=c+q.tolerance)return{par:1,dist:t.sub(r).length};var p=c/f;return{par:p,dist:e.add(i.mul(p)).length}},Q(l,[{key:"l1",get:function(){return Math.abs(this.x_)+Math.abs(this.y_)}},{key:"x",get:function(){return this.x_}},{key:"y",get:function(){return this.y_}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthSquared",get:function(){return this.x*this.x+this.y*this.y}}]),l}(),nr=function(){function l(){this._next=null,this.prev=null}var s=l.prototype;return s.getNext=function(){return this.next},s.setNext=function(t){this.next=t,null!=this.polyline&&this.polyline.setInitIsRequired()},s.getPrev=function(){return this.prev},s.setPrev=function(t){this.prev=t,null!=this.polyline&&this.polyline.setInitIsRequired()},l.mkFromPoint=function(t){var e=new l;return e.point=t,e},Q(l,[{key:"point",get:function(){return this._point},set:function(t){this._point=t}},{key:"next",get:function(){return this._next},set:function(t){this._next=t}},{key:"nextOnPolyline",get:function(){return this.polyline.next(this)}},{key:"prevOnPolyline",get:function(){return this.polyline.prev(this)}}]),l}();function To(){To=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var ir,_l=To().mark(Es);!function(l){l[l.Corner=0]="Corner",l[l.VertexA=1]="VertexA",l[l.otherCorner=2]="otherCorner",l[l.VertexB=3]="VertexB"}(ir||(ir={}));var Ut=function(){function l(){}var s=l.prototype;return s.contains=function(t){var e=t.sub(this.corner),r=q.distanceEpsilon,i=e.dot(this.bRot);if(i>this.abRot+r||i<-r)return!1;var h=e.dot(this.aRot);return h<=this.baRot+r&&h>=-r},s.vertex=function(t){switch(t){case ir.Corner:return this.corner;case ir.VertexA:return this.aPlusCorner;case ir.otherCorner:return this.otherCorner;case ir.VertexB:return this.bPlusCorner;default:return}},l.parallelogramOfTwo=function(t,e){var r=new l,i=t.corner,h={minx:i.x,maxx:i.x,miny:i.y,maxy:i.y};return l.pumpMinMax(h,t.aPlusCorner),l.pumpMinMax(h,t.otherCorner),l.pumpMinMax(h,t.bPlusCorner),l.pumpMinMax(h,e.corner),l.pumpMinMax(h,e.aPlusCorner),l.pumpMinMax(h,e.otherCorner),l.pumpMinMax(h,e.bPlusCorner),r.corner=new R(h.minx,h.miny),r.a=new R(0,h.maxy-h.miny),r.b=new R(h.maxx-h.minx,0),r.aPlusCorner=r.a.add(r.corner),r.otherCorner=r.b.add(r.aPlusCorner),r.bPlusCorner=r.b.add(r.corner),r.aRot=new R(-r.a.y,r.a.x),r.aRot.length>.5&&(r.aRot=r.aRot.normalize()),r.bRot=new R(-r.b.y,r.b.x),r.bRot.length>.5&&(r.bRot=r.bRot.normalize()),r.abRot=r.a.dot(r.bRot),r.baRot=r.b.dot(r.aRot),r.abRot<0&&(r.abRot=-r.abRot,r.bRot=r.bRot.neg()),r.baRot<0&&(r.baRot=-r.baRot,r.aRot=r.aRot.neg()),r.isSeg=r.a.sub(r.b).length<q.distanceEpsilon,r},l.pumpMinMax=function(t,e){e.x<t.minx?t.minx=e.x:e.x>t.maxx&&(t.maxx=e.x),e.y<t.miny?t.miny=e.y:e.y>t.maxy&&(t.maxy=e.y)},l.intersect=function(t,e){return!1!=!(l.separByA(t,e)||l.separByA(e,t)||l.separByB(t,e)||l.separByB(e,t))&&(!(t.isSeg&&e.isSeg&&R.parallelWithinEpsilon(t.otherCorner.sub(t.corner),e.otherCorner.sub(e.corner),1e-5))||l.ParallelSegsIntersect(e,t))},l.ParallelSegsIntersect=function(t,e){var r=t.corner,h=e.corner,c=e.otherCorner,f=t.otherCorner.sub(r),y=f.dot(f),m=h.sub(r).dot(f),P=c.sub(r).dot(f);if(m>P){var L=m;m=P,P=L}return!(P<0-q.distanceEpsilon||m>y+q.distanceEpsilon)},l.separByB=function(t,e){var r=q.distanceEpsilon,i=e.vertex(0).sub(t.corner).dot(t.bRot),h=[ir.VertexA,ir.otherCorner,ir.VertexB];if(i>t.abRot+r){for(var f,c=C(h);!(f=c()).done;)if(e.vertex(f.value).sub(t.corner).dot(t.bRot)<=t.abRot+r)return!1;return!0}if(i<-r){for(var m,y=C(h);!(m=y()).done;)if(e.vertex(m.value).sub(t.corner).dot(t.bRot)>=-r)return!1;return!0}return!1},l.separByA=function(t,e){var r=q.distanceEpsilon,i=e.corner.sub(t.corner),h=R.dot(i,t.aRot);return h>t.baRot+r?(i=e.aPlusCorner.sub(t.corner),!(R.dot(i,t.aRot)<=t.baRot+r||(i=e.bPlusCorner.sub(t.corner),R.dot(i,t.aRot)<=t.baRot+r)||(i=e.otherCorner.sub(t.corner),R.dot(i,t.aRot)<=t.baRot+r))):h<-r&&(i=e.aPlusCorner.sub(t.corner),!(R.dot(i,t.aRot)>=-r||(i=e.bPlusCorner.sub(t.corner),R.dot(i,t.aRot)>=-r)||(i=e.otherCorner.sub(t.corner),R.dot(i,t.aRot)>=-r)))},l.parallelogramByCornerSideSide=function(t,e,r){var i=new l;return i.corner=t,i.a=e,i.b=r,i.aRot=new R(-e.y,e.x),i.aRot.length>.5&&(i.aRot=i.aRot.normalize()),i.bRot=new R(-r.y,r.x),i.bRot.length>.5&&(i.bRot=i.bRot.normalize()),i.abRot=i.bRot.dot(e),i.baRot=r.dot(i.aRot),i.abRot<0&&(i.abRot=-i.abRot,i.bRot=i.bRot.neg()),i.baRot<0&&(i.baRot=-i.baRot,i.aRot=i.aRot.neg()),i.isSeg=e.sub(r).length<q.distanceEpsilon,i.aPlusCorner=e.add(t),i.otherCorner=r.add(i.aPlusCorner),i.bPlusCorner=r.add(t),i},l.getParallelogramOfAGroup=function(t){for(var p,e=0,r=0,i=0,h=0,c=!0,f=C(t);!(p=f()).done;)for(var L,P=C(Es(p.value));!(L=P()).done;){var E=L.value,S=E.x,T=E.y;c?(c=!1,e=r=S,i=h=T):(S<e?e=S:S>r&&(r=S),T<i?i=T:T>h&&(h=T))}return l.parallelogramByCornerSideSide(new R(e,i),new R(0,h-i),new R(r-e,0))},Q(l,[{key:"area",get:function(){return Math.abs(this.a.x*this.b.y-this.a.y*this.b.x)}}]),l}();function Es(l){return To().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,l.corner;case 2:return o.next=4,l.aPlusCorner;case 4:return o.next=6,l.otherCorner;case 6:return o.next=8,l.bPlusCorner;case 8:case"end":return o.stop()}},_l)}var Z=function(){function l(o,t,e,r){this.parStart=0,this.parEnd=1,this.start=new R(o,t),this.end=new R(e,r)}l.fromJSON=function(t){return l.mkPP(R.fromJSON(t.start),R.fromJSON(t.end))};var s=l.prototype;return s.toJSON=function(){return{start:this.start.toJSON(),end:this.end.toJSON()}},s.offsetCurve=function(t,e){return null},s.trim=function(t,e){if((t=Math.max(this.parStart,t))>(e=Math.min(this.parEnd,e)))throw"wrong params in trimming";var r=this.value(t),i=this.value(e);return R.close(r,i,q.distanceEpsilon)?null:l.mkPP(r,i)},s.value=function(t){return this.start.add(this.end.sub(this.start).mul(t))},s.trimWithWrap=function(t,e){return null},s.pNodeOverICurve=function(){var t=this.end.sub(this.start).mul(.5);return{parallelogram:Ut.parallelogramByCornerSideSide(this.start,t,t),seg:this,leafBoxesOffset:0,node:{low:0,high:1,chord:this}}},s.normal=function(){var t=this.start.sub(this.end);return t=t.div(t.length),new R(-t.y,t.x)},l.mkPP=function(t,e){return new l(t.x,t.y,e.x,e.y)},l.mkLinePXY=function(t,e,r){return new l(t.x,t.y,e,r)},s.derivative=function(t){return this.end.sub(this.start)},s.secondDerivative=function(t){return new R(0,0)},s.thirdDerivative=function(t){return new R(0,0)},s.reverse=function(){return l.mkPP(this.end,this.start)},s.translate=function(t){this.start=this.start.add(t),this.end=this.end.add(t)},s.scaleFromOrigin=function(t,e){return l.mkPP(this.start.scale(t,e),this.end.scale(t,e))},s.getParameterAtLength=function(t){var e=this.end.sub(this.start).length;if(e<q.tolerance)return 0;var r=t/e;return r>1?1:r<0?0:r},s.transform=function(t){return l.mkPP(t.multiplyPoint(this.start),t.multiplyPoint(this.end))},s.closestParameterWithinBounds=function(t,e,r){var i=this.closestParameter(t);return i<e&&(i=e),i>r&&(i=r),i},s.lengthPartial=function(t,e){return this.value(e).sub(this.value(t)).length},s.clone=function(){return l.mkPP(this.start.clone(),this.end.clone())},l.closestParameterOnLineSegment=function(t,e,r){var i=r.sub(e),h=t.sub(e),c=i.dot(h);if(c<=0+q.tolerance)return 0;var f=i.dot(i);return f<=c+q.tolerance?1:c/f},s.closestParameter=function(t){return l.closestParameterOnLineSegment(t,this.start,this.end)},s.leftDerivative=function(t){return this.derivative(t)},s.rightDerivative=function(t){return this.derivative(t)},l.IntersectPPPP=function(t,e,r,i){var h=R.lineLineIntersection(t,e,r,i);if(null!=h&&xn(h,t,e)&&xn(h,r,i))return h},s.curvature=function(t){return 0},s.curvatureDerivative=function(t){return 0},s.curvatureSecondDerivative=function(t){return 0},l.minDistBetweenLineSegments=function(t,e,r,i){var S,T,h=e.sub(t),c=i.sub(r),f=t.sub(r),p=R.crossProduct(h,c),y=h.dot(h),m=h.dot(c),P=c.dot(c),L=h.dot(f),E=c.dot(f),O=Math.abs(p),x=O,B=O;O<q.tolerance?(S=0,x=1,T=E,B=P):(S=R.crossProduct(c,f),T=R.crossProduct(h,f),p<0&&(S=-S,T=-T),S<0?(S=0,T=E,B=P):S>x&&(S=x=1,T=E+m,B=P)),T<0?(T=0,-L<0?S=0:-L>y?S=x:(S=-L,x=y)):T>B&&(T=B=1,-L+m<0?S=0:-L+m>y?S=x:(S=-L+m,x=y));var M=Math.abs(S)<q.tolerance?0:S/x,F=Math.abs(T)<q.tolerance?0:T/B;return{parab:M,parcd:F,dist:f.add(h.mul(M).sub(c.mul(F))).length}},Q(l,[{key:"length",get:function(){return this.start.sub(this.end).length}},{key:"boundingBox",get:function(){return lt.mkPP(this.start,this.end)}}]),l}();function xn(l,s,o){return l.x>=Math.min(s.x,o.x)-q.distanceEpsilon&&l.y>=Math.min(s.y,o.y)-q.distanceEpsilon&&l.x<=Math.max(s.x,o.x)+q.distanceEpsilon&&l.y<=Math.max(s.y,o.y)+q.distanceEpsilon}function Cs(l,s,o,t){var e=R.getTriangleOrientation(l,s,o),r=R.getTriangleOrientation(l,s,t),i=R.getTriangleOrientation(o,t,l),h=R.getTriangleOrientation(o,t,s);return!!(e!=r&&i!=h||e==it.Collinear&&xn(o,l,s)||r==it.Collinear&&xn(t,l,s)||i==it.Collinear&&xn(l,o,t)||h==it.Collinear&&xn(s,o,t))}var ht,Qe=function(){function l(){}return l.distToSegm=function(o,t,e){var r=e.sub(t);if(r.length<q.intersectionEpsilon)return o.sub(t.add(e).div(2)).length;var i=new R(-r.y,r.x);return i=i.mul(1/i.length),Math.abs(o.sub(t).dot(i))},l.createParallelogramOnSubSeg=function(o,t,e){var r=e.derivative(o),i=e.derivative(t),h=new R(-i.y,i.x),c=e.value(o),f=e.value(t),y=f.sub(c).dot(h),m=r.dot(h),P=Math.abs(y)<q.distanceEpsilon;if(P||!(Math.abs(m)<q.distanceEpsilon))return r=r.mul(P?0:y/m),Ut.parallelogramByCornerSideSide(c,r,f.sub(c).sub(r))},l.createParallelogramNodeForCurveSeg=function(o,t,e,r){if(o===e.parStart&&t===e.parEnd&&R.close(e.start,e.end,q.distanceEpsilon))return l.createNodeWithSegmentSplit(o,t,e,r);var h=e.value(o),c=e.value(t),f=c.sub(h),p=e.value((o+t)/2);if(l.distToSegm(p,h,c)<=q.intersectionEpsilon&&f.dot(f)<q.lineSegmentThreshold*q.lineSegmentThreshold&&t-o<q.lineSegmentThreshold){var y=Z.mkPP(h,c),m=y.pNodeOverICurve();m.seg=e;var P=m.node;return P.low=o,P.high=t,P.chord=y,m}if(l.WithinEpsilon(e,o,t,r)){var L=l.createParallelogramOnSubSeg(o,t,e);if(void 0!==L)return function(l,s,o,t,e){return{parallelogram:o,seg:t,leafBoxesOffset:e,node:{low:l,high:s,chord:null}}}(o,t,L,e,r)}return l.createNodeWithSegmentSplit(o,t,e,r)},l.WithinEpsilon=function(o,t,e,r){var h=(e-t)/3,c=o.value(t),f=o.value(e);return!(l.distToSegm(o.value(t+h),c,f)>r)&&l.distToSegm(o.value(t+2*h),c,f)<=r},l.createParallelogramNodeForCurveSegDefaultOffset=function(o){return l.createParallelogramNodeForCurveSeg(o.parStart,o.parEnd,o,q.defaultLeafBoxesOffset)},l.createNodeWithSegmentSplit=function(o,t,e,r){var i={parallelogram:null,seg:e,leafBoxesOffset:1,node:{children:[]}},h=i.node;return h.children.push(l.createParallelogramNodeForCurveSeg(o,.5*(o+t),e,r)),h.children.push(l.createParallelogramNodeForCurveSeg(.5*(o+t),t,e,r)),i.parallelogram=Ut.parallelogramOfTwo(h.children[0].parallelogram,h.children[1].parallelogram),i},l}(),Ir=function(s,o,t,e,r){this.par0=s,this.par1=o,this.x=t,this.seg0=e,this.seg1=r},zi=function(){function l(){}return l.closestPoint=function(o,t,e,r,i){var m,f=e,p=0,y=0,P=!1;do{var L=o.value(f),E=o.derivative(f),S=o.secondDerivative(f),T=E.dot(E)+L.sub(t).dot(S);if(Math.abs(T)<q.tolerance)return f;(f-=m=L.sub(t).dot(E.div(T)))>i+q.tolerance?(f=i,y++):f<r-q.tolerance&&(f=r,y++),p++}while(Math.abs(m)>q.tolerance&&!(P=p>=5||y>=5));return P&&o.value(e).sub(t).length<q.distanceEpsilon&&(f=e),f},l}(),Wt=function(){function l(o,t,e,r,i){for(this.parStart=o,this.parEnd=t,this.aAxis=e,this.bAxis=r,this.center=i,this.pNode=null,this.setBoundingBox();this.parStart<0;)this.parStart+=2*Math.PI,this.parEnd+=2*Math.PI}var s=l.prototype;return s.isFullEllipse=function(){return this.parEnd===2*Math.PI&&0===this.parStart},l.fromJSON=function(t){return new l(t.parStart,t.parEnd,R.fromJSON(t.axis0),R.fromJSON(t.axis1),R.fromJSON(t.center))},s.toJSON=function(){return{parStart:this.parStart,parEnd:this.parEnd,axis0:this.aAxis.toJSON(),axis1:this.bAxis.toJSON(),center:this.center.toJSON()}},s.offsetCurve=function(t,e){var r=e.sub(this.center),i=R.angle(this.aAxis,r);if(this.aAxis.mul(Math.cos(i)).add(this.bAxis.mul(Math.sin(i))).length<r.length){var c=this.aAxis.length,f=this.bAxis.length;return l.mkEllipsePPP(this.aAxis.normalize().mul(c+t),this.bAxis.normalize().mul(f+t),this.center)}var p=this.aAxis.length,y=this.bAxis.length;return l.mkEllipsePPP(this.aAxis.normalize().mul(p-t),this.bAxis.normalize().mul(y-t),this.center)},s.reverse=function(){return null},l.mkEllipsePPP=function(t,e,r){return new l(0,2*Math.PI,t,e,r)},s.trim=function(t,e){return new l(Math.max(t,this.parStart),Math.min(e,this.parEnd),this.aAxis,this.bAxis,this.center)},s.trimWithWrap=function(t,e){return null},s.value=function(t){return this.center.add(R.mkPoint(Math.cos(t),this.aAxis,Math.sin(t),this.bAxis))},s.derivative=function(t){return R.mkPoint(-Math.sin(t),this.aAxis,Math.cos(t),this.bAxis)},s.secondDerivative=function(t){return R.mkPoint(-Math.cos(t),this.aAxis,-Math.sin(t),this.bAxis)},s.thirdDerivative=function(t){return R.mkPoint(Math.sin(t),this.aAxis,-Math.cos(t),this.bAxis)},s.pNodeOverICurve=function(){return null!=this.pNode?this.pNode:this.pNode=Qe.createParallelogramNodeForCurveSegDefaultOffset(this)},s.setBoundingBox=function(){if(dt(this.parStart,0)&&dt(this.parEnd,2*Math.PI))this.box=this.fullBox();else{this.box=lt.mkPP(this.start,this.end);for(var t,e=Math.ceil(this.parStart/(Math.PI/2));(t=e*Math.PI/2)<this.parEnd;e++)t>this.parStart&&this.box.add(this.value(t))}},l.mkEllipse=function(t,e,r,i,h,c){return new l(t,e,r,i,new R(h,c))},l.mkFullEllipsePPP=function(t,e,r){return new l(0,2*Math.PI,t,e,r)},l.mkFullEllipseNNP=function(t,e,r){return new l(0,2*Math.PI,new R(t,0),new R(0,e),r)},l.mkCircle=function(t,e){return l.mkFullEllipseNNP(t,t,e)},s.translate=function(t){this.center=this.center.add(t),this.box.center=this.box.center.add(t),this.pNode=null},s.scaleFromOrigin=function(t,e){return new l(this.parStart,this.parEnd,this.aAxis.mul(t),this.bAxis.mul(e),this.center.scale(t,e))},s.getParameterAtLength=function(t){for(var r=this.parStart,i=this.parEnd,h=t+.001,c=t-.001;i-r>q.distanceEpsilon;){var f=.5*(i+r),p=this.lengthPartial(this.parStart,f);if(p>h)i=f;else{if(!(p<c))return f;r=f}}return(i+r)/2},s.transform=function(t){if(null!=t){var e=t.multiplyPoint(this.aAxis).sub(t.offset()),r=t.multiplyPoint(this.bAxis).sub(t.offset());return new l(this.parStart,this.parEnd,e,r,t.multiplyPoint(this.center))}return this.clone()},s.closestParameterWithinBounds=function(t,e,r){for(var h=(r-e)/9,c=e,f=Number.MAX_VALUE,p=0;p<=8;p++){var y=e+p*h,m=t.sub(this.value(y)),P=m.dot(m);P<f&&(f=P,c=y)}0===c&&r===2*Math.PI&&(e=-Math.PI);var L=zi.closestPoint(this,t,c,e,r);return L<0&&(L+=2*Math.PI),L},s.lengthPartial=function(t,e){return K.lengthWithInterpolationAndThreshold(this.trim(t,e),q.lineSegmentThreshold/100)},s.clone=function(){return new l(this.parStart,this.parEnd,this.aAxis.clone(),this.bAxis.clone(),this.center.clone())},s.closestParameter=function(t){for(var e=0,i=(this.parEnd-this.parStart)/9,h=this.parStart,c=Number.MAX_VALUE,f=0;f<=8;f++){var p=this.parStart+f*i,y=t.sub(this.value(p)),m=y.dot(y);m<c&&(c=m,h=p)}var P=!1;0===h&&this.parEnd===2*Math.PI&&(P=!0,e=this.parStart,this.parStart=-Math.PI);var L=zi.closestPoint(this,t,h,this.parStart,this.parEnd);return L<0&&(L+=2*Math.PI),P&&(this.parStart=e),L},s.leftDerivative=function(t){return this.derivative(t)},s.rightDerivative=function(t){return this.derivative(t)},s.curvature=function(t){throw"NotImplementedException()"},s.curvatureDerivative=function(t){throw"NotImplementedException();"},s.curvatureSecondDerivative=function(t){throw"NotImplementedException()"},s.orientedCounterclockwise=function(){return R.crossProduct(this.aAxis,this.bAxis)>0},s.fullBox=function(){var t=this.aAxis.add(this.bAxis);return lt.mkPP(this.center.add(t),this.center.sub(t))},s.isArc=function(){return Math.abs(this.aAxis.dot(this.bAxis))<q.tolerance&&Math.abs(this.aAxis.length-this.bAxis.length)<q.tolerance&&R.closeDistEps(this.aAxis.rotate90Ccw(),this.bAxis)},Q(l,[{key:"start",get:function(){return this.value(this.parStart)}},{key:"end",get:function(){return this.value(this.parEnd)}},{key:"boundingBox",get:function(){return this.box}},{key:"length",get:function(){return(this.aAxis.length+this.bAxis.length)*Math.abs(this.parEnd-this.parStart)/2}}]),l}(),ql=function(){function l(o,t,e,r,i,h,c,f){this.curveA=o,this.curveB=t,this.aMin=e,this.bMin=i,this.aMax=r,this.bMax=h,this.aGuess=c,this.bGuess=f,this.si=c,this.ti=f}var s=l.prototype;return s.initValues=function(){this.a=this.curveA.value(this.si),this.b=this.curveB.value(this.ti),this.a_b=this.a.sub(this.b),this.ad=this.curveA.derivative(this.si),this.add=this.curveA.secondDerivative(this.si),this.bd=this.curveB.derivative(this.ti),this.bdd=this.curveB.secondDerivative(this.ti)},s.Fs=function(){return this.a_b.dot(this.ad)},s.Fss=function(){return this.a_b.dot(this.add)+this.ad.dot(this.ad)},s.Fst=function(){return-this.bd.dot(this.ad)},s.Ftt=function(){return-this.a_b.dot(this.bdd)+this.bd.dot(this.bd)},s.Ft=function(){return-this.a_b.dot(this.bd)},s.delta=function(t,e,r,i){return t*i-r*e},s.solve=function(){var y,t=0,r=0,h=!1;if(this.initValues(),this.curveA instanceof Z&&this.curveB instanceof Z){var c=this.curveB.derivative(0);c=c.div(c.length);var f=this.curveA.normal(),p=Math.abs(f.dot(c));if(Math.abs(p)<q.distanceEpsilon||this.delta(this.Fss(),this.Fst(),this.Fst(),this.Ftt())<q.tolerance)return this.success=!0,void this.parallelLineSegLineSegMinDist()}do{var m=this.delta(this.Fss(),this.Fst(),this.Fst(),this.Ftt());if(Math.abs(m)<q.tolerance){this.success=!1,h=!0;break}y={s:this.delta(-this.Fs(),this.Fst(),-this.Ft(),this.Ftt())/m,t:this.delta(this.Fss(),-this.Fs(),this.Fst(),-this.Ft())/m};var P=this.si+y.s,L=this.ti+y.t,E=void 0;P>this.aMax+q.distanceEpsilon||P<this.aMin-q.distanceEpsilon||L>this.bMax+q.distanceEpsilon||L<this.bMin-q.distanceEpsilon?(t++,this.chopDsDt(y),this.si+=y.s,this.ti+=y.t,E=!0):(E=!1,this.si=P,this.ti=L,this.si>this.aMax?this.si=this.aMax:this.si<this.aMin&&(this.si=this.aMin),this.ti>this.bMax?this.ti=this.bMax:this.ti<this.bMin&&(this.ti=this.bMin)),this.initValues(),r++,h=t>=10||r>=100||0===y.s&&0===y.t&&E}while((Math.abs(y.s)>=q.tolerance||Math.abs(y.t)>=q.tolerance)&&!h);if(h){var S=this.curveA.value(this.aGuess).sub(this.curveB.value(this.bGuess));if(S.dot(S)<q.distanceEpsilon*q.distanceEpsilon)return this.aSolution=this.aGuess,this.bSolution=this.bGuess,this.aPoint=this.curveA.value(this.aGuess),this.bPoint=this.curveB.value(this.bGuess),void(this.success=!0)}this.aSolution=this.si,this.bSolution=this.ti,this.aPoint=this.a,this.bPoint=this.b,this.success=!h},s.chopDsDt=function(t){if(0!==t.s&&0!==t.t){var e=1;this.si+t.s>this.aMax?e=(this.aMax-this.si)/t.s:this.si+t.s<this.aMin&&(e=(this.aMin-this.si)/t.s);var r=1;this.ti+t.t>this.bMax?r=(this.bMax-this.ti)/t.t:this.ti+t.t<this.bMin&&(r=(this.bMin-this.ti)/t.t);var i=Math.min(e,r);t.s*=i,t.t*=i}else 0===t.s?this.ti+t.t>this.bMax?t.t=this.bMax-this.ti:this.ti+t.t<this.bMin&&(t.t=this.bMin-this.ti):this.si+t.s>this.aMax?t.s=this.aMax-this.si:this.si+t.s<this.aMin&&(t.s=this.aMin-this.si)},s.parallelLineSegLineSegMinDist=function(){var m,P,L,t=this.curveA,e=this.curveB,r=t.start,i=t.end,h=e.start,c=e.end,f=i.sub(r),p=f.length,y=0;if(p>q.distanceEpsilon){m=(f=f.div(p)).dot(i.sub(r));var E=!1;if((P=f.dot(h.sub(r)))>(L=f.dot(c.sub(r)))){E=!0;var S=P;P=L,L=S}if(L<y)this.aSolution=0,this.bSolution=E?0:1;else if(P>m)this.aSolution=1,this.bSolution=E?1:0;else{var T=Math.min(m,L);this.aSolution=T/(m-y),this.bSolution=(T-P)/(L-P),E&&(this.bSolution=1-this.bSolution)}}else{var O=c.sub(h),x=O.length;if(x>q.distanceEpsilon)if(y=0,m=(O=O.div(x)).dot(c.sub(h)),(P=O.dot(r.sub(h)))<y)this.bSolution=0,this.aSolution=1;else if(P>m)this.bSolution=1,this.aSolution=0;else{var B=Math.min(m,P);this.bSolution=B/(m-y),this.aSolution=0}else this.aSolution=0,this.bSolution=0}this.aPoint=this.curveA.value(this.aSolution),this.bPoint=this.curveB.value(this.bSolution)},l}(),or=function(){function l(o,t,e,r){this.b=new Array(4),this.parStart=0,this.parEnd=1,this.b[0]=o,this.b[1]=t,this.b[2]=e,this.b[3]=r,this.c=this.b[1].sub(this.b[0]).mul(3),this.e=this.b[2].sub(this.b[1]).mul(3).sub(this.c),this.l=this.b[3].sub(this.b[0]).sub(this.c).sub(this.e)}var s=l.prototype;return s.toJSON=function(){return{b:this.b.map(function(t){return t.toJSON()})}},l.fromJSON=function(t){return l.mkBezier(t.b.map(R.fromJSON))},s.leftDerivative=function(t){return this.derivative(t)},s.rightDerivative=function(t){return this.derivative(t)},s.B=function(t){return this.b[t]},s.pNodeOverICurve=function(){return null!=this.pBoxNode?this.pBoxNode:this.pBoxNode=Qe.createParallelogramNodeForCurveSegDefaultOffset(this)},s.value=function(t){var e=t*t;return this.l.mul(e*t).add(this.e.mul(e).add(this.c.mul(t)).add(this.b[0]))},l.adjustParamTo01=function(t){return t>1?1:t<0?0:t},s.trim=function(t,e){if((t=l.adjustParamTo01(t))>(e=l.adjustParamTo01(e)))return this.trim(e,t);if(t>1-q.tolerance)return new l(this.b[3],this.b[3],this.b[3],this.b[3]);var r=new Array(3),i=new Array(2),c=new l(this.casteljau(t,r,i),i[1],r[2],this.b[3]),f=c.casteljau((e-t)/(1-t),r,i);return new l(c.b[0],r[0],i[0],f)},s.trimWithWrap=function(t,e){throw"NotImplementedException()"},s.casteljau=function(t,e,r){for(var i=1-t,h=0;h<3;h++)e[h]=R.mkPoint(i,this.b[h],t,this.b[h+1]);for(var c=0;c<2;c++)r[c]=R.mkPoint(i,e[c],t,e[c+1]);return R.mkPoint(i,r[0],t,r[1])},s.derivative=function(t){return this.l.mul(3*t*t).add(this.e.mul(2*t)).add(this.c)},s.secondDerivative=function(t){return R.mkPoint(6*t,this.l,2,this.e)},s.thirdDerivative=function(t){return this.l.mul(6)},s.reverse=function(){return new l(this.b[3],this.b[2],this.b[1],this.b[0])},s.translate=function(t){this.b[0]=this.b[0].add(t),this.b[1]=this.b[1].add(t),this.b[2]=this.b[2].add(t),this.b[3]=this.b[3].add(t),this.c=this.b[1].sub(this.b[0]).mul(3),this.e=this.b[2].sub(this.b[1]).mul(3).sub(this.c),this.l=this.b[3].sub(this.b[0]).sub(this.c).sub(this.e),this.bbox&&(this.bbox=lt.translate(this.bbox,t)),this.pBoxNode=null},s.scaleFromOrigin=function(t,e){return new l(this.b[0].scale(t,e),this.b[1].scale(t,e),this.b[2].scale(t,e),this.b[3].scale(t,e))},s.offsetCurve=function(t,e){return null},s.lengthPartial=function(t,e){return this.trim(t,e).length},l.lengthOnControlPolygon=function(t,e,r,i){var h=i.sub(t).length,c=e.sub(t).length+r.sub(e).length+i.sub(r).length;if(c-h>q.lineSegmentThreshold){var f=R.middle(t,e),p=R.middle(e,r),y=R.middle(r,i),m=R.middle(f,p),P=R.middle(y,p),L=R.middle(m,P);return l.lengthOnControlPolygon(t,f,m,L)+l.lengthOnControlPolygon(L,P,y,i)}return(c+h)/2},s.transform=function(t){return new l(t.multiplyPoint(this.b[0]),t.multiplyPoint(this.b[1]),t.multiplyPoint(this.b[2]),t.multiplyPoint(this.b[3]))},s.closestParameterWithinBounds=function(t,e,r){for(var i=(r-e)/8,h=0,c=Number.MAX_VALUE,f=0;f<9;f++){var p=t.sub(this.value(f*i+e)),y=p.dot(p);y<c&&(c=y,h=f*i+e)}return zi.closestPoint(this,t,h,e,r)},s.clone=function(){return new l(this.b[0],this.b[1],this.b[2],this.b[3])},l.mkBezier=function(t){return new l(t[0],t[1],t[2],t[3])},s.curvature=function(t){var e=this.G(t);return this.F(t)/e},s.F=function(t){return this.Xp(t)*this.Ypp(t)-this.Yp(t)*this.Xpp(t)},s.G=function(t){var e=this.Xp(t),r=this.Yp(t),i=e*e+r*r;return Math.sqrt(i*i*i)},s.Xp=function(t){return 3*this.l.x*t*t+2*this.e.x*t+this.c.x},s.Ypp=function(t){return 6*this.l.y*t+2*this.e.y},s.Yp=function(t){return 3*this.l.y*t*t+2*this.e.y*t+this.c.y},s.Xpp=function(t){return 6*this.l.x*t+2*this.e.x},s.Xppp=function(t){return 6*this.l.x},s.Yppp=function(t){return 6*this.l.y},s.curvatureDerivative=function(t){var e=this.G(t);return(this.Fp(t)*e-this.Gp(t)*this.F(t))/(e*e)},s.Fp=function(t){return this.Xp(t)*this.Yppp(t)-this.Yp(t)*this.Xppp(t)},s.Fpp=function(t){return this.Xpp(t)*this.Yppp(t)-this.Ypp(t)*this.Xppp(t)},s.closestParameter=function(t){for(var r=0,i=Number.MAX_VALUE,h=0;h<9;h++){var c=t.sub(this.value(.125*h)),f=c.dot(c);f<i&&(i=f,r=.125*h)}return zi.closestPoint(this,t,r,0,1)},s.curvatureSecondDerivative=function(t){var e=this.G(t);return(this.Qp(t)*e-2*this.Q(t)*this.Gp(t))/(e*e*e)},s.Q=function(t){return this.Fp(t)*this.G(t)-this.Gp(t)*this.F(t)},s.Qp=function(t){return this.Fpp(t)*this.G(t)-this.Gpp(t)*this.F(t)},s.Gpp=function(t){var e=this.Xp(t),r=this.Yp(t),i=this.Xpp(t),h=this.Ypp(t),c=this.Xppp(t),f=this.Yppp(t),p=Math.sqrt(e*e+r*r),y=e*i+r*h;return 3*(y*y/p+p*(i*i+e*c+h*h+r*f))},s.Gp=function(t){var e=this.Xp(t),r=this.Yp(t),i=this.Xpp(t),h=this.Ypp(t);return 3*Math.sqrt(e*e+r*r)*(e*i+r*h)},s.getParameterAtLength=function(t){for(var e=0,r=1;r-e>q.tolerance;){var i=(r+e)/2,h=this.evaluateError(t,i);if(h>0)r=i;else{if(!(h<0))return i;e=i}}return(e+r)/2},s.evaluateError=function(t,e){var r=1-e,i=R.mkPoint(r,this.b[0],e,this.b[1]),h=R.mkPoint(r,this.b[1],e,this.b[2]),c=R.mkPoint(r,this.b[2],e,this.b[3]),f=R.mkPoint(r,i,e,h),p=R.mkPoint(r,h,e,c),y=R.mkPoint(r,f,e,p),m=l.lengthOnControlPolygon(this.b[0],i,f,y);return m>t+q.distanceEpsilon?1:m<t-q.distanceEpsilon?-1:0},Q(l,[{key:"start",get:function(){return this.b[0]}},{key:"end",get:function(){return this.b[3]}},{key:"length",get:function(){return l.lengthOnControlPolygon(this.b[0],this.b[1],this.b[2],this.b[3])}},{key:"boundingBox",get:function(){return this.bbox?this.bbox:this.bbox=lt.mkOnPoints(this.b)}}]),l}();function ri(){ri=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}!function(l){l[l.Outside=0]="Outside",l[l.Boundary=1]="Boundary",l[l.Inside=2]="Inside"}(ht||(ht={}));var K=function(){function l(){this.segs=[],this.parEnd_=0}l.fromJSON=function(t){for(var i,e=new l,r=C(t.segs);!(i=r()).done;){var h=i.value;switch(h.tag){case"bezier":e.addSegment(or.fromJSON(h.segData));break;case"ellipse":e.addSegment(Wt.fromJSON(h.segData));break;case"lineSegment":e.addSegment(Z.fromJSON(h.segData));break;default:throw new Error("not implemented")}}return e};var s=l.prototype;return s.toJSON=function(){return{segs:this.segs.map(function(t){return function(l){if(l instanceof Wt)return{tag:"ellipse",segData:l.toJSON()};if(l instanceof Z)return{tag:"lineSegment",segData:l.toJSON()};if(l instanceof or)return{tag:"bezier",segData:l.toJSON()};throw new Error("not implemented")}(t)})}},l.CurvesIntersect=function(t,e){return t===e||null!=l.intersectionOne(t,e,!1)},l.lengthWithInterpolationAndThreshold=function(t,e){throw new Error("not implemented")},l.lengthWithInterpolation=function(t){throw"not implemented"},s.lengthPartial=function(t,e){this.adjustStartEndEndParametersToDomain({start:t,end:e});var i=this.getSegIndexParam(t),h=this.getSegIndexParam(e);if(i.segIndex<h.segIndex){for(var c=this.segs[i.segIndex],f=c.lengthPartial(i.par,c.parEnd),p=i.segIndex+1;p<h.segIndex;p++)f+=this.segs[p].length;return f+(c=this.segs[h.segIndex]).lengthPartial(c.parStart,h.par)}throw new Error("not implemented.")},s.reverse=function(){for(var t=new l,e=this.segs.length-1;e>=0;e--)t.addSegment(this.segs[e].reverse());return t},s.mkCurveWithSegs=function(t){this.segs=t;for(var r,e=C(t);!(r=e()).done;)this.parEnd_+=l.paramSpan(r.value)},s.scaleFromOrigin=function(t,e){for(var h,r=new l,i=C(this.segs);!(h=i()).done;)r.addSegment(h.value.scaleFromOrigin(t,e));return r},s.trim=function(t,e){var r={start:t,end:e};this.adjustStartEndEndParametersToDomain(r);var i=this.getSegIndexParam(r.start),h=this.getSegIndexParam(r.end);if(i.segIndex===h.segIndex)return this.segs[i.segIndex].trim(i.par,h.par);var c=new l;i.par<this.segs[i.segIndex].parEnd&&(c=c.addSegment(this.segs[i.segIndex].trim(i.par,this.segs[i.segIndex].parEnd)));for(var f=i.segIndex+1;f<h.segIndex;f++)c=c.addSegment(this.segs[f]);return this.segs[h.segIndex].parStart<h.par&&(c=c.addSegment(this.segs[h.segIndex].trim(this.segs[h.segIndex].parStart,h.par))),c},s.translate=function(t){for(var r,e=C(this.segs);!(r=e()).done;)r.value.translate(t);this.boundingBox_&&(this.boundingBox_=lt.translate(this.boundingBox_,t)),this.pBNode=null},s.adjustStartEndEndParametersToDomain=function(t){if(t.start>t.end){var e=t.start;t.start=t.end,t.end=e}t.start<this.parStart&&(t.start=this.parStart),t.end>this.parEnd&&(t.end=this.parEnd)},s.trimWithWrap=function(t,e){if(t<e)return this.trim(t,e);var r=new l;return r.addSegment(this.trim(t,this.parEnd)),r.addSegment(this.trim(this.parStart,e)),r},s.addSegs=function(t){for(var r,e=C(t);!(r=e()).done;)this.addSegment(r.value);return this},s.addSegment=function(t){if(null==t)return this;if(this.boundingBox_=null,t instanceof l)for(var r,e=C(t.segs);!(r=e()).done;){var i=r.value;this.segs.push(i),this.parEnd_+=l.paramSpan(i)}else this.segs.push(t),this.parEnd_+=l.paramSpan(t);return this},s.pNodeOverICurve=function(){if(null!=this.pBNode)return this.pBNode;for(var i,t=[],e=[],r=C(this.segs);!(i=r()).done;){var c=i.value.pNodeOverICurve();t.push(c.parallelogram),e.push(c)}return this.pBNode={parallelogram:Ut.getParallelogramOfAGroup(t),seg:this,leafBoxesOffset:q.defaultLeafBoxesOffset,node:{children:e}},this.pBNode},l.intersectionOne=function(t,e,r){var i=l.curveCurveXWithParallelogramNodesOne(t.pNodeOverICurve(),e.pNodeOverICurve());return r&&null!=i&&(i=l.liftIntersectionToCurves(t,e,i)),i},l.getAllIntersections=function(t,e,r){return t instanceof Z?l.getAllIntersectionsOfLineAndICurve(t,e,r):l.getAllIntersectionsInternal(t,e,r)},l.getAllIntersectionsInternal=function(t,e,r){var i=[];if(l.curveCurveXWithParallelogramNodes(t.pNodeOverICurve(),e.pNodeOverICurve(),i),r)for(var h=0;h<i.length;h++)i[h]=l.liftIntersectionToCurves(t,e,i[h]);return i},l.getAllIntersectionsOfLineAndICurve=function(t,e,r){return e instanceof vt?l.getAllIntersectionsOfLineAndPolyline(t,e):e instanceof l?l.getAllIntersectionsOfLineAndCurve(t,e,r):e instanceof Wt&&e.isArc()?l.getAllIntersectionsOfLineAndArc(t,e):l.getAllIntersectionsInternal(t,e,r)},l.getAllIntersectionsOfLineAndCurve=function(t,e,r){var i=[],h=t.pNodeOverICurve(),c=e.pNodeOverICurve();if(!1===Ut.intersect(h.parallelogram,c.parallelogram))return i;for(var y,f=0,p=C(e.segs);!(y=p()).done;){var m=y.value,P=l.getAllIntersections(t,m,!1);if(r){for(var E,L=C(P);!(E=L()).done;){var S=E.value;S.par1+=f-m.parStart,S.seg1=e}f+=m.parEnd-m.parStart}for(var O,T=C(P);!(O=T()).done;){var x=O.value;l.alreadyInside(i,x)||i.push(x)}}return i},l.closeIntersections=function(t,e){return R.close(t.x,e.x,q.intersectionEpsilon)},l.closeIntersectionPoints=function(t,e){return R.close(t,e,q.intersectionEpsilon)},l.alreadyInside=function(t,e){for(var r=0;r<t.length;r++)if(l.closeIntersections(t[r],e))return!0;return!1},l.getAllIntersectionsOfLineAndArc=function(t,e){var r=t.end.sub(t.start),i=[],h=r.length;if(h<q.distanceEpsilon){var c=t.start.sub(e.center);if(dt(c.length,e.aAxis.length)){var f=R.angle(e.aAxis,c);e.parStart-q.tolerance<=f&&(f=Math.max(f,e.parStart))<=e.parEnd+q.tolerance&&(f=Math.min(e.parEnd,f),i.push(new Ir(0,f,t.start,t,e)))}return i}var p=r.rotate90Ccw().div(h),y=t.start.sub(e.center).dot(p),m=e.center.add(p.mul(y)),P=e.aAxis.length,L=Math.abs(y);if(P<L-q.distanceEpsilon)return i;if(r=p.rotate90Cw(),dt(P,L))l.tryToAddPointToLineCircleCrossing(t,e,i,m,h,r);else{var E=Math.sqrt(P*P-y*y),S=r.mul(E);l.tryToAddPointToLineCircleCrossing(t,e,i,m.add(S),h,r),l.tryToAddPointToLineCircleCrossing(t,e,i,m.sub(S),h,r)}return i},l.tryToAddPointToLineCircleCrossing=function(t,e,r,i,h,c){var p=i.sub(t.start).dot(c);if(!(p<-q.distanceEpsilon||(p=Math.max(p,0),p>h+q.distanceEpsilon))){p=Math.min(p,h),p/=h;var y=R.angle(e.aAxis,i.sub(e.center));e.parStart-q.tolerance<=y&&(y=Math.max(y,e.parStart))<=e.parEnd+q.tolerance&&(y=Math.min(e.parEnd,y),r.push(new Ir(p,y,i,t,e)))}},l.getAllIntersectionsOfLineAndPolyline=function(t,e){for(var r=[],i=0,h=e.startPoint;null!=h&&null!=h.getNext();h=h.getNext()){var c=l.crossTwoLineSegs(t.start,t.end,h.point,h.getNext().point,0,1,0,1);c&&(l.adjustSolution(t.start,t.end,h.point,h.getNext().point,c),l.oldIntersection(r,c.x)||r.push(new Ir(c.aSol,i+c.bSol,c.x,t,e))),i++}if(e.closed){var f=l.crossTwoLineSegs(t.start,t.end,h.point,e.start,0,1,0,1);f&&(l.adjustSolution(t.start,t.end,h.point,e.start,f),l.oldIntersection(r,f.x)||r.push(new Ir(f.aSol,i+f.bSol,f.x,t,e)))}return r},l.adjustSolution=function(t,e,r,i,h){l.closeIntersectionPoints(h.x,t)?(h.x=t,h.aSol=0):l.closeIntersectionPoints(h.x,e)&&(h.x=e,h.aSol=1),l.closeIntersectionPoints(h.x,r)?(h.x=r,h.bSol=Math.floor(h.bSol)):l.closeIntersectionPoints(h.x,i)&&(h.x=i,h.bSol=Math.ceil(h.bSol))},l.curveCurveXWithParallelogramNodesOne=function(t,e){if(!Ut.intersect(t.parallelogram,e.parallelogram))return null;var r=t.node,i=e.node,h=r.hasOwnProperty("children"),c=i.hasOwnProperty("children");if(h&&c)for(var p,f=C(r.children);!(p=f()).done;)for(var P,y=p.value,m=C(i.children);!(P=m()).done;){var E=l.curveCurveXWithParallelogramNodesOne(y,P.value);if(null!=E)return E}else if(c)for(var T,S=C(i.children);!(T=S()).done;){var x=l.curveCurveXWithParallelogramNodesOne(t,T.value);if(null!=x)return x}else{if(!h)return l.crossOverIntervalsOne(t,e);for(var M,B=C(r.children);!(M=B()).done;){var A=l.curveCurveXWithParallelogramNodesOne(M.value,e);if(null!=A)return A}}return null},l.curveCurveXWithParallelogramNodes=function(t,e,r){if(Ut.intersect(t.parallelogram,e.parallelogram)){var i=t.node.hasOwnProperty("children"),h=e.node.hasOwnProperty("children");if(i&&h)for(var f,c=C(t.node.children);!(f=c()).done;)for(var m,p=f.value,y=C(e.node.children);!(m=y()).done;)l.curveCurveXWithParallelogramNodes(p,m.value,r);else if(h)for(var E,L=C(e.node.children);!(E=L()).done;)l.curveCurveXWithParallelogramNodes(t,E.value,r);else if(i)for(var O,T=C(t.node.children);!(O=T()).done;)l.curveCurveXWithParallelogramNodes(O.value,e,r);else r=l.crossOverLeaves(t,e,r)}},l.crossOverIntervalsOne=function(t,e){for(var r=t.node,i=e.node,h=(r.high-r.low)/2,c=(i.high-i.low)/2,f=1;f<2;f++)for(var p=f*h+r.low,y=1;y<2;y++){var m=y*c+i.low,P=void 0;if(null==r.chord&&null==i.chord?P=l.crossWithinIntervalsWithGuess(t.seg,e.seg,r.low,r.high,i.low,i.high,p,m):null!=r.chord&&null==i.chord?P=l.crossWithinIntervalsWithGuess(r.chord,e.seg,0,1,i.low,i.high,.5*f,m):null==r.chord?(P=l.crossWithinIntervalsWithGuess(t.seg,i.chord,r.low,r.high,0,1,p,.5*y))&&(P.bSol=i.low+P.bSol*(i.high-i.low)):(P=l.crossWithinIntervalsWithGuess(r.chord,i.chord,0,1,0,1,.5*f,.5*y))&&(P.aSol=r.low+P.aSol*(r.high-r.low),P.bSol=i.low+P.bSol*(i.high-i.low)),P)return l.createIntersectionOne(t,e,P.aSol,P.bSol,P.x)}return l.goDeeperOne(t,e)},l.crossOverLeaves=function(t,e,r){var y,i=t.node,h=e.node,c=!1,f=(i.high-i.low)/2+i.low,p=(h.high-h.low)/2+h.low;return null==i.chord&&null==h.chord?y=l.crossWithinIntervalsWithGuess(t.seg,e.seg,i.low,i.high,h.low,h.high,f,p):null!=i.chord&&null==h.chord?(y=l.crossWithinIntervalsWithGuess(i.chord,e.seg,0,1,h.low,h.high,.5,p))&&(y.aSol=i.low+y.aSol*(i.high-i.low)):null==i.chord?(y=l.crossWithinIntervalsWithGuess(t.seg,h.chord,i.low,i.high,0,1,f,.5))&&(y.bSol=h.low+y.bSol*(h.high-h.low)):(y=l.crossWithinIntervalsWithGuess(i.chord,h.chord,0,1,0,1,.5,.5))&&(y.bSol=h.low+y.bSol*(h.high-h.low),y.aSol=i.low+y.aSol*(i.high-i.low)),y&&(l.addIntersection(t,e,r,y),c=!0),c||l.goDeeper(r,t,e),r},l.addIntersection=function(t,e,r,i){var h=t.node;l.closeIntersectionPoints(i.x,t.seg.value(h.low))?(i.x=t.seg.value(h.low),i.aSol=h.low):l.closeIntersectionPoints(i.x,t.seg.value(h.high))&&(i.x=t.seg.value(h.high),i.aSol=h.high);var c=e.node;if(l.closeIntersectionPoints(i.x,e.seg.value(c.low))?(i.x=e.seg.value(c.low),i.bSol=c.low):l.closeIntersectionPoints(i.x,e.seg.value(c.high))&&(i.x=e.seg.value(c.high),i.bSol=c.high),!l.oldIntersection(r,i.x)){var p=new Ir(i.aSol,i.bSol,i.x,t.seg,e.seg);r.push(p)}},l.oldIntersection=function(t,e){for(var i,r=C(t);!(i=r()).done;)if(e.sub(i.value.x).length<100*q.distanceEpsilon)return!0;return!1},l.createIntersectionOne=function(t,e,r,i,h){var c=t.node,f=e.node;return l.closeIntersectionPoints(h,t.seg.value(c.low))?(h=t.seg.value(c.low),r=c.low):l.closeIntersectionPoints(h,t.seg.value(c.high))&&(h=t.seg.value(c.high),r=c.high),l.closeIntersectionPoints(h,e.seg.value(f.low))?(h=e.seg.value(f.low),i=f.low):l.closeIntersectionPoints(h,e.seg.value(f.high))&&(h=e.seg.value(f.high),i=f.high),new Ir(r,i,h,t.seg,e.seg)},l.liftIntersectionToCurves_=function(t,e,r,i,h,c,f){var p=t instanceof l?l.liftParameterToCurve(t,r-c.parStart,c):r,y=e instanceof l?l.liftParameterToCurve(e,i-f.parStart,f):i;return new Ir(p,y,h,t,e)},l.DropIntersectionToSegs=function(t){var e,r,h,c;if(t.seg0 instanceof l){var i=t.seg0.getSegParam(t.par0);e=i.seg,r=i.par}else r=t.par0,e=t.seg0;if(t.seg1 instanceof l){var f=t.seg1.getSegParam(t.par1);c=f.par,h=f.seg}else c=t.par1,h=t.seg1;return new Ir(r,c,t.x,e,h)},l.liftIntersectionToCurves=function(t,e,r){return l.liftIntersectionToCurves_(t,e,r.par0,r.par1,r.x,r.seg0,r.seg1)},l.liftParameterToCurve=function(t,e,r){if(t===r)return e;if(t.hasOwnProperty("segs")){for(var f,h=0,c=C(t.segs);!(f=c()).done;){var p=f.value;if(p===r)return e+h;h+=l.paramSpan(p)}throw"bug in liftParameterToCurve"}},l.paramSpan=function(t){return t.parEnd-t.parStart},l.goDeeperOne=function(t,e){var r=t.node,i=e.node;if(t.leafBoxesOffset>q.distanceEpsilon&&e.leafBoxesOffset>q.distanceEpsilon){var h=Qe.createParallelogramNodeForCurveSeg(r.low,r.high,t.seg,t.leafBoxesOffset/2),c=Qe.createParallelogramNodeForCurveSeg(i.low,i.high,e.seg,e.leafBoxesOffset/2);return l.curveCurveXWithParallelogramNodesOne(h,c)}if(t.leafBoxesOffset>q.distanceEpsilon){var f=Qe.createParallelogramNodeForCurveSeg(r.low,r.high,t.seg,t.leafBoxesOffset/2);return l.curveCurveXWithParallelogramNodesOne(f,e)}if(e.leafBoxesOffset>q.distanceEpsilon){var p=Qe.createParallelogramNodeForCurveSeg(i.low,i.high,e.seg,e.leafBoxesOffset/2);return l.curveCurveXWithParallelogramNodesOne(t,p)}var y=t.seg.value(r.low),m=t.seg.value(r.high);if(!R.closeDistEps(y,m)){var P=e.seg.value(i.low),L=e.seg.value(i.high);if(!R.closeDistEps(P,L)){var E=t.seg instanceof Z?t.seg:Z.mkPP(y,m),S=e.seg instanceof Z?e.seg:Z.mkPP(P,L),T=l.crossWithinIntervalsWithGuess(E,S,0,1,0,1,.5,.5);if(T)return l.adjustParameters(t,E,e,S,T),l.createIntersectionOne(t,e,T.aSol,T.bSol,T.x)}}return null},l.goDeeper=function(t,e,r){var i=e.node,h=r.node,c=e.leafBoxesOffset>q.distanceEpsilon,f=r.leafBoxesOffset>q.distanceEpsilon;if(c&&f){var p=Qe.createParallelogramNodeForCurveSeg(i.low,i.high,e.seg,e.leafBoxesOffset/2),y=Qe.createParallelogramNodeForCurveSeg(h.low,h.high,r.seg,r.leafBoxesOffset/2);l.curveCurveXWithParallelogramNodes(p,y,t)}else if(c){var m=Qe.createParallelogramNodeForCurveSeg(i.low,i.high,e.seg,e.leafBoxesOffset/2);l.curveCurveXWithParallelogramNodes(m,r,t)}else if(f){var P=Qe.createParallelogramNodeForCurveSeg(h.low,h.high,r.seg,r.leafBoxesOffset/2);l.curveCurveXWithParallelogramNodes(e,P,t)}else{var L=e.seg.value(i.low),E=e.seg.value(i.high);if(!R.closeDistEps(L,E)){var S=r.seg.value(h.low),T=r.seg.value(h.high);if(!R.closeDistEps(S,T)){var O=e.seg instanceof Z?e.seg:Z.mkPP(L,E),x=r.seg instanceof Z?r.seg:Z.mkPP(S,T),B=l.crossWithinIntervalsWithGuess(O,x,0,1,0,1,.5,.5);B&&(l.adjustParameters(e,O,r,x,B),l.addIntersection(e,r,t,B))}}}},l.adjustParameters=function(t,e,r,i,h){if(e===t.seg||t.seg instanceof vt){var c=t.node;h.aSol=c.low+h.aSol*(c.high-c.low)}else h.aSol=t.seg.closestParameter(h.x);if(i===r.seg||r.seg instanceof vt){var f=r.node;h.bSol=f.low+h.bSol*(f.high-f.low)}else h.bSol=r.seg.closestParameter(h.x)},s.getSegParam=function(t){for(var i,e=this.parStart,r=C(this.segs);!(i=r()).done;){var h=i.value,c=e+h.parEnd-h.parStart;if(t>=e&&t<=c)return{par:t-e+h.parStart,seg:h};e=c}var f=this.segs[this.segs.length-1];return{seg:f,par:f.parEnd}},s.getSegIndexParam=function(t){for(var e=0,r=this.segs.length,i=0;i<r;i++){var h=this.segs[i],c=e+h.parEnd-h.parStart;if(t>=e&&t<=c)return{segIndex:i,par:t-e+h.parStart};e=c}return{segIndex:r-1,par:this.segs[r-1].parEnd}},s.value=function(t){return function(l){return l.seg.value(l.par)}(this.getSegParam(t))},s.derivative=function(t){return function(l){return l.seg.derivative(l.par)}(this.getSegParam(t))},s.secondDerivative=function(t){return function(l){return l.seg.secondDerivative(l.par)}(this.getSegParam(t))},s.thirdDerivative=function(t){return function(l){return l.seg.thirdDerivative(l.par)}(this.getSegParam(t))},l.crossWithinIntervalsWithGuess=function(t,e,r,i,h,c,f,p){if(t instanceof Z&&e instanceof Z){var y=l.crossTwoLineSegs(t.start,t.end,e.start,e.end,r,i,h,c);if(void 0!==y)return y}var m=l.minDistWithinIntervals(t,e,r,i,h,c,f,p);if(null!=m){var P=m.aX.sub(m.bX);return P.dot(P)>=q.distanceEpsilon?void 0:{aSol:m.aSol,bSol:m.bSol,x:R.middle(m.aX,m.bX)}}},l.crossTwoLineSegs=function(t,e,r,i,h,c,f,p){var y=e.sub(t),m=r.sub(i),P=r.sub(t),L=Rt.solve(y.x,m.x,P.x,y.y,m.y,P.y);if(null!=L){var E=L.x,S=L.y,T=t.add(y.mul(E));if(!(E<h-q.tolerance||(E=Math.max(E,h),E>c+q.tolerance||(E=Math.min(E,c),S<f-q.tolerance||(S=Math.max(S,f),S>p+q.tolerance)))))return{aSol:E,bSol:S=Math.min(S,p),x:T}}},l.PointRelativeToCurveLocation=function(t,e){if(!e.boundingBox.contains(t))return ht.Outside;for(var r=2*e.boundingBox.diagonal,i=Math.PI/180,h=0,c=13;c<360;c+=13){var f=new R(Math.cos(c*i),Math.sin(c*i)),p=Z.mkPP(t,t.add(f.mul(r))),y=this.getAllIntersectionsOfLineAndICurve(p,e,!0);if(l.AllIntersectionsAreGood(y,e)){for(var P,m=C(y);!(P=m()).done;)if(R.closeDistEps(P.value.x,t))return ht.Boundary;if(y.length%2==1?h++:h--,h>=2)return ht.Inside;if(h<=-2)return ht.Outside}}return ht.Boundary},l.AllIntersectionsAreGood=function(t,e){var i=null;if(e.hasOwnProperty("segs")||e instanceof vt&&(i=e.toCurve()),i)for(var f,c=C(t);!(f=c()).done;)if(!l.RealCut(l.DropIntersectionToSegs(f.value),i,!1))return!1;return!0},l.RealCut=function(t,e,r){var h=t.seg1,f=t.par1,p=t.x,y=t.seg0.derivative(t.par0).normalize(),m=h.derivative(f).normalize().rotate(Math.PI/2);if(R.closeDistEps(p,h.end)){for(var P=null,L=0;L<e.segs.length-1;L++)if(e.segs[L]===h){P=e.segs[L+1];break}if(null==P)return!1;var E=y.rotate(Math.PI/2);return!(E.dot(h.derivative(h.parEnd))*E.dot(P.derivative(P.parStart))<q.tolerance)}if(R.closeDistEps(p,h.start)){for(var T=null,O=e.segs.length-1;O>0;O--)if(e.segs[O]===h){T=e.segs[O-1];break}if(null==T)return!1;var x=y.rotate(Math.PI/2);return!(x.dot(h.derivative(h.parStart))*x.dot(T.derivative(T.parEnd))<q.tolerance)}var M=y.dot(m);return r?M>q.distanceEpsilon:Math.abs(M)>q.distanceEpsilon},l.realCutWithClosedCurve=function(t,e,r){var h=t.seg1,f=t.par1,p=t.x,y=t.seg0.derivative(t.par0).normalize(),m=h.derivative(f).normalize().rotate(Math.PI/2);if(R.closeDistEps(p,h.end)){for(var P=null,L=0;L<e.segs.length;L++)if(e.segs[L]===h){P=e.segs[(L+1)%e.segs.length];break}if(null==P)throw new Error;var E=y.rotate(Math.PI/2);return!(E.dot(h.derivative(h.parEnd))*E.dot(P.derivative(P.parStart))<q.tolerance)}if(R.closeDistEps(p,h.start)){for(var T=null,O=0;O<e.segs.length;O++)if(e.segs[O]===h){T=e.segs[O>0?O-1:e.segs.length-1];break}var x=y.rotate(Math.PI/2);return!(x.dot(h.derivative(h.parStart))*x.dot(T.derivative(T.parEnd))<q.tolerance)}var M=y.dot(m);return r?M>q.distanceEpsilon:Math.abs(M)>q.distanceEpsilon},l.minDistWithinIntervals=function(t,e,r,i,h,c,f,p){var y=new ql(t,e,r,i,h,c,f,p);return y.solve(),y.success?{aSol:y.aSolution,bSol:y.bSolution,aX:y.aPoint,bX:y.bPoint}:void 0},s.offsetCurve=function(t,e){throw new Error("Method not implemented.")},s.clone=function(){for(var r,t=new l,e=C(this.segs);!(r=e()).done;)t.addSegment(r.value.clone());return null!=this.boundingBox_&&(t.boundingBox_=this.boundingBox_.clone()),t},s.getParameterAtLength=function(t){for(var i,e=0,r=C(this.segs);!(i=r()).done;){var h=i.value,c=h.length;if(c>=t)return e+h.getParameterAtLength(t);t-=c,e+=h.parEnd-h.parStart}return this.parEnd},s.transform=function(t){for(var i,e=new l,r=C(this.segs);!(i=r()).done;)e.addSegment(i.value.transform(t));return this.boundingBox_&&(e.boundingBox_=this.boundingBox_.transform(t)),e},s.closestParameterWithinBounds=function(t,e,r){for(var p,i=0,h=Number.MAX_VALUE,c=0,f=C(this.segs);!(p=f()).done;){var y=p.value;if(c>r)break;var m=l.paramSpan(y);if(c+m>=e){var L=Math.max(y.parStart,y.parStart+(e-c)),E=Math.min(y.parEnd,y.parStart+(r-c)),S=y.closestParameterWithinBounds(t,L,E),T=t.sub(y.value(S)),O=T.dot(T);O<h&&(i=c+S-y.parStart,h=O)}c+=m}return i},s.closestParameter=function(t){for(var c,e=0,r=Number.MAX_VALUE,i=0,h=C(this.segs);!(c=h()).done;){var f=c.value,p=f.closestParameter(t),y=t.sub(f.value(p)),m=y.dot(y);if(m<r){if(e=i+p-f.parStart,0===m)break;r=m}i+=l.paramSpan(f)}return e},l.addLineSegment=function(t,e,r){return t.addSegment(Z.mkPP(e,r))},l.addLineSegmentCNNP=function(t,e,r,i){return l.addLineSegment(t,new R(e,r),i)},l.addLineSegmentCNNNN=function(t,e,r,i,h){l.addLineSegment(t,new R(e,r),new R(i,h))},l.continueWithLineSegmentNN=function(t,e,r){l.addLineSegment(t,t.end,new R(e,r))},l.continueWithLineSegmentP=function(t,e){l.addLineSegment(t,t.end,e)},l.closeCurve=function(t){return l.continueWithLineSegmentP(t,t.start),t},s.leftDerivative=function(t){var e=this.tryToGetLeftSegment(t);return null!=e?e.derivative(e.parEnd):this.derivative(t)},s.rightDerivative=function(t){var e=this.tryToGetRightSegment(t);return null!=e?e.derivative(e.parStart):this.derivative(t)},s.tryToGetLeftSegment=function(t){if(Math.abs(t-this.parStart)<q.tolerance)return this.start.equal(this.end)?this.segs[this.segs.length-1]:null;for(var r,e=C(this.segs);!(r=e()).done;){var i=r.value;if(t-=l.paramSpan(i),Math.abs(t)<q.tolerance)return i}return null},s.tryToGetRightSegment=function(t){if(Math.abs(t-this.parEnd)<q.tolerance)return this.start===this.end?this.segs[0]:null;for(var r,e=C(this.segs);!(r=e()).done;){var i=r.value;if(Math.abs(t)<q.tolerance)return i;t-=l.paramSpan(i)}return null},l.ClosestPoint=function(t,e){return t.value(t.closestParameter(e))},l.CurveIsInsideOther=function(t,e){if(!e.boundingBox.containsRect(t.boundingBox))return!1;var r=l.getAllIntersections(t,e,!0);if(0===r.length)return l.NonIntersectingCurveIsInsideOther(t,e);if(1===r.length)return t.start.equal(r[0].x)?l.PointRelativeToCurveLocation(t.value((t.parStart+t.parEnd)/2),e)==ht.Inside:l.PointRelativeToCurveLocation(t.start,e)===ht.Inside;for(var h,i=C(l.PointsBetweenIntersections(t,r));!(h=i()).done;)if(l.PointRelativeToCurveLocation(h.value,e)===ht.Outside)return!1;return!0},l.PointsBetweenIntersections=ri().mark(function o(t,e){var r,i,f;return ri().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e.sort(function(m,P){return m.par0-P.par0}),r=0;case 2:if(!(r<e.length-1)){y.next=8;break}return y.next=5,t.value((e[r].par0+e[r+1].par0)/2);case 5:r++,y.next=2;break;case 8:return(f=(i=e[e.length-1].par0)+(t.parEnd-i+(e[0].par0-t.parStart))/2)>t.parEnd&&(f=t.parStart+(f-t.parEnd)),y.next=15,t.value(f);case 15:case"end":return y.stop()}},o)}),l.NonIntersectingCurveIsInsideOther=function(t,e){for(var r=t.parStart;r<t.parEnd;r+=.5){var i=l.PointRelativeToCurveLocation(t.value(r),e);if(ht.Boundary!==i)return ht.Inside===i}return ht.Outside!==l.PointRelativeToCurveLocation(t.end,e)},l.ClosedCurveInteriorsIntersect=function(t,e){if(!e.boundingBox.intersects(t.boundingBox))return!1;var r=l.getAllIntersections(t,e,!0);if(0===r.length)return l.NonIntersectingCurveIsInsideOther(t,e)||l.NonIntersectingCurveIsInsideOther(e,t);if(1===r.length)return t.start.equal(r[0].x)?l.PointRelativeToCurveLocation(t.value((t.parStart+t.parEnd)/2),e)!==ht.Inside&&e.start.equal(r[0].x)?l.PointRelativeToCurveLocation(e.value((e.parStart+e.parEnd)/2),t)===ht.Inside:l.PointRelativeToCurveLocation(e.start,t)===ht.Inside:l.PointRelativeToCurveLocation(t.start,e)===ht.Inside;for(var h,i=C(l.PointsBetweenIntersections(t,r));!(h=i()).done;)if(l.PointRelativeToCurveLocation(h.value,e)===ht.Inside)return!0;return!0},s.curvature=function(t){var e=this.getSegParam(t);return e.seg.curvature(e.par)},s.curvatureDerivative=function(t){throw new Error("Not implemente")},s.curvatureSecondDerivative=function(t){throw new Error("Not implemented")},l.createBezierSeg=function(t,e,r,i,h){var c=R.mkPoint(t,r.point,1-t,i.point),f=R.mkPoint(e,h.point,1-e,i.point),p=i.point.mul(2/3);return new or(c,c.div(3).add(p),p.add(f.div(3)),f)},l.createBezierSegN=function(t,e,r,i){var h=r.mul(i);return new or(t,t.add(h),e.add(h),e)},l.findCorner=function(t){var e=t.next;if(null!=e.next){var r=e.next;if(null!=r)return{b:e,c:r}}},l.trimEdgeSplineWithNodeBoundaries=function(t,e,r,i){var h=r.parStart,c=r.parEnd;null!=t&&(h=l.findNewStart(r,h,t,i)),null!=e&&(c=l.findNewEnd(r,e,i,c));var f=Math.min(h,c),p=Math.max(h,c);return f<p?r.trim(f,p):r},l.findNewEnd=function(t,e,r,i){var h=l.getAllIntersections(t,e,!0);if(0===h.length)return t.parEnd;if(r){i=t.parEnd;for(var f,c=C(h);!(f=c()).done;){var p=f.value;p.par0<i&&(i=p.par0)}}else{i=t.parStart;for(var m,y=C(h);!(m=y()).done;){var P=m.value;P.par0>i&&(i=P.par0)}}return i},l.findNewStart=function(t,e,r,i){var h=l.getAllIntersections(t,r,!0);if(0!==h.length){if(i){e=t.parStart;for(var f,c=C(h);!(f=c()).done;){var p=f.value;p.par0>e&&(e=p.par0)}}else{e=t.parEnd;for(var m,y=C(h);!(m=y()).done;){var P=m.value;P.par0<e&&(e=P.par0)}}return e}e=t.parStart},l.polylineAroundClosedCurve=function(t){if(t instanceof Wt)return l.refineEllipse(t);if(t instanceof vt)return t;if(t instanceof l&&l.allSegsAreLines(t)){for(var i,e=new vt,r=C(t.segs);!(i=r()).done;)e.addPoint(i.value.start);if(e.closed=!0,!e.isClockwise())return e.reverse()}return t.boundingBox.perimeter()},l.allSegsAreLines=function(t){for(var r,e=C(t.segs);!(r=e()).done;)if(!(r.value instanceof Z))return!1;return!0},l.refineEllipse=function(t){for(var e=t.boundingBox.perimeter(),r=Math.PI/4,i=t.boundingBox.width,h=t.boundingBox.height,c=Math.sqrt(i*i+h*h),f=[],p=0;p<4;p++)for(var S,y=r+p*Math.PI/2,m=t.value(y),P=t.derivative(y).normalize().mul(c),L=Z.mkPP(m.sub(P),m.add(P)),E=C(l.getAllIntersections(e,L,!0));!(S=E()).done;)f.push(S.value);f.sort(function(x,B){return x.par0<B.par0?-1:x.par0>B.par0?1:0});var O=new vt;return f.forEach(function(x){return O.addPoint(x.x)}),O.closed=!0,O},l.polyFromBox=function(t){var e=new vt;return e.addPoint(t.leftTop),e.addPoint(t.rightTop),e.addPoint(t.rightBottom),e.addPoint(t.leftBottom),e.closed=!0,e},Q(l,[{key:"parStart",get:function(){return 0}},{key:"parEnd",get:function(){return this.parEnd_}},{key:"start",get:function(){return this.segs[0].start}},{key:"end",get:function(){return this.segs[this.segs.length-1].end}},{key:"boundingBox",get:function(){if(this.boundingBox_)return this.boundingBox_;if(0!==this.segs.length){for(var t=this.segs[0].boundingBox.clone(),e=1;e<this.segs.length;e++)t.addRecSelf(this.segs[e].boundingBox);return this.boundingBox_=t}this.boundingBox_=lt.mkEmpty()}},{key:"length",get:function(){for(var r,t=0,e=C(this.segs);!(r=e()).done;)t+=r.value.length;return t}}]),l}();function Yr(){Yr=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var vt=function(l){function s(){this.initIsRequired=!0,this.isClosed_=!1}var o=s.prototype;return o.toJSON=function(){return{points:Array.from(this).map(function(e){return e.toJSON()})}},s.fromJSON=function(e){return s.mkFromPoints(e.points.map(function(r){return R.fromJSON(r)}))},o.RemoveStartPoint=function(){var e=this.startPoint.next;e.prev=null,this.startPoint=e,this.setInitIsRequired()},o.RemoveEndPoint=function(){var e=this.endPoint.prev;e.next=null,this.endPoint=e,this.setInitIsRequired()},o.setInitIsRequired=function(){this.initIsRequired=!0},o.addPointXY=function(e,r){this.addPoint(new R(e,r))},o.isClockwise=function(){return R.getTriangleOrientation(this.startPoint.point,this.startPoint.next.point,this.startPoint.next.next.point)==it.Clockwise},o.addPoint=function(e){var r=new nr;r.polyline=this,r.point=e.clone(),null!=this.endPoint?(this.endPoint.next=r,r.prev=this.endPoint,this.endPoint=r):this.startPoint=this.endPoint=r,this.setInitIsRequired()},o.PrependPoint=function(e){var r=nr.mkFromPoint(e);r.polyline=this,null!=this.startPoint?R.closeDistEps(e,this.startPoint.point)||(this.startPoint.prev=r,r.next=this.startPoint,this.startPoint=r):(this.endPoint=r,this.startPoint=r),this.setInitIsRequired()},o[l]=Yr().mark(function t(){var e;return Yr().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=this.startPoint;case 1:if(null==e){i.next=7;break}return i.next=4,e.point;case 4:e=e.next,i.next=1;break;case 7:case"end":return i.stop()}},t,this)}),o.polylinePoints=Yr().mark(function t(){var e;return Yr().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=this.startPoint;case 1:if(null==e){i.next=7;break}return i.next=4,e;case 4:e=e.next,i.next=1;break;case 7:case"end":return i.stop()}},t,this)}),o.skip=Yr().mark(function t(e){var r;return Yr().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:r=this.startPoint;case 1:if(null==r){h.next=11;break}if(!(e>0)){h.next=6;break}e--,h.next=8;break;case 6:return h.next=8,r;case 8:r=r.next,h.next=1;break;case 11:case"end":return h.stop()}},t,this)}),s.parallelogramOfLineSeg=function(e,r){var i=r.sub(e).div(2);return Ut.parallelogramByCornerSideSide(e,i,i)},s.mkFromPoints=function(e){for(var h,r=new s,i=C(e);!(h=i()).done;)r.addPoint(h.value);return r},s.mkClosedFromPoints=function(e){var r=s.mkFromPoints(e);return r.closed=!0,r},o.calculatePbNode=function(){for(var e=[],r=[],i=this.startPoint,h=0;null!=i.next;){var c=s.parallelogramOfLineSeg(i.point,i.next.point);e.push(c),r.push({parallelogram:c,seg:this,leafBoxesOffset:0,node:{low:h,high:h+1,chord:Z.mkPP(i.point,i.next.point)}}),i=i.next,h++}if(this.isClosed_){var f=s.parallelogramOfLineSeg(this.endPoint.point,this.startPoint.point);e.push(f),r.push({parallelogram:f,seg:this,leafBoxesOffset:0,node:{low:h,high:h+1,chord:Z.mkPP(this.endPoint.point,this.startPoint.point)}})}this.pBNode={parallelogram:Ut.getParallelogramOfAGroup(e),seg:this,leafBoxesOffset:0,node:{children:r}}},o.init=function(){this.bBox=lt.rectangleOnPoint(this.startPoint.point);for(var r,e=C(this.skip(1));!(r=e()).done;)this.bBox.add(r.value.point);this.updateCount(),this.calculatePbNode(),this.initIsRequired=!1},o.updateCount=function(){this.count_=0;for(var e=this.startPoint;null!=e;e=e.next)this.count_++},o.value=function(e){this.initIsRequired&&this.init();var r=this.getAdjustedParamAndStartEndPoints(e);return R.convSum(r.t,r.a,r.b)},o.getAdjustedParamAndStartEndPoints=function(e){for(var r=this.startPoint;null!=r.next;){if(e<=1)return{a:r.point,b:r.next.point,t:e};r=r.next,e-=1}if(this.closed&&e<=1)return{a:this.endPoint.point,b:this.startPoint.point,t:e};throw new Error("out of the parameter domain")},o.derivative=function(e){var r=this.getAdjustedParamAndStartEndPoints(e);return r.b.sub(r.a)},o.secondDerivative=function(e){return new R(0,0)},o.thirdDerivative=function(e){return new R(0,0)},o.pNodeOverICurve=function(){return this.initIsRequired&&this.init(),this.pBNode},s.polylineFromCurve=function(e){var r=new s;r.addPoint(e.start);for(var h,i=C(e.segs);!(h=i()).done;)r.addPoint(h.value.end);return r.closed=e.start===e.end,r},o.trim=function(e,r){var i=this.toCurve();return(i=i.trim(e,r))instanceof K?s.polylineFromCurve(i):s.mkFromPoints([i.start,i.end])},o.trimWithWrap=function(e,r){throw new Error("Method not implemented.")},o.translate=function(e){for(var r=this.startPoint;r.point=r.point.add(e),r!==this.endPoint;)r=r.getNext();this.setInitIsRequired()},o.scaleFromOrigin=function(e,r){throw new Error("Method not implemented.")},o.reverse=function(){var e=new s;e.closed=this.closed;for(var r=this.endPoint;e.addPoint(r.point),r!==this.startPoint;)r=r.getPrev();return e},o.offsetCurve=function(e,r){throw new Error("Method not implemented.")},o.lengthPartial=function(e,r){throw new Error("Method not implemented.")},o.getParameterAtLength=function(e){throw new Error("Method not implemented.")},o.transform=function(e){for(var h,r=new s,i=C(this.polylinePoints());!(h=i()).done;)r.addPoint(e.multiplyPoint(h.value.point));return r.closed=this.closed,r},o.closestParameterWithinBounds=function(e,r,i){throw new Error("Method not implemented.")},o.closestParameter=function(e){for(var r=0,i=Number.MAX_VALUE,h=0,c=this.startPoint;null!=c.next;){var f=Z.mkPP(c.point,c.next.point),p=f.closestParameter(e),y=f.value(p).sub(e),m=y.dot(y);m<i&&(i=m,r=p+h),c=c.next,h++}if(this.closed){var P=Z.mkPP(this.endPoint.point,this.startPoint.point),L=P.closestParameter(e),E=P.value(L).sub(e);E.dot(E)<i&&(r=L+h)}return r},o.clone=function(){var e=new s;e.closed=this.closed;for(var r=this.startPoint;e.addPoint(r.point),r!==this.endPoint;)r=r.getNext();return e},o.leftDerivative=function(e){throw new Error("Method not implemented.")},o.rightDerivative=function(e){throw new Error("Method not implemented.")},o.curvature=function(e){throw new Error("Method not implemented.")},o.curvatureDerivative=function(e){throw new Error("Method not implemented.")},o.curvatureSecondDerivative=function(e){throw new Error("Method not implemented.")},o.next=function(e){var r;return null!==(r=e.next)&&void 0!==r?r:this.closed?this.startPoint:null},o.prev=function(e){var r;return null!==(r=e.prev)&&void 0!==r?r:this.closed?this.endPoint:null},o.toCurve=function(){var e=new K;K.addLineSegment(e,this.startPoint.point,this.startPoint.next.point);for(var r=this.startPoint.next;null!=(r=r.next);)K.continueWithLineSegmentP(e,r.point);return this.closed&&K.continueWithLineSegmentP(e,this.startPoint.point),e},o.RemoveCollinearVertices=function(){for(var e=this.startPoint.next;null!=e.next;e=e.next)R.getTriangleOrientation(e.prev.point,e.point,e.next.point)===it.Collinear&&(e.prev.next=e.next,e.next.prev=e.prev);return this.setInitIsRequired(),this},Q(s,[{key:"count",get:function(){return this.initIsRequired&&this.init(),this.count_}},{key:"closed",get:function(){return this.isClosed_},set:function(e){this.isClosed_=e}},{key:"boundingBox",get:function(){return this.initIsRequired&&this.init(),this.bBox}},{key:"parStart",get:function(){return 0}},{key:"parEnd",get:function(){return this.initIsRequired&&this.init(),this.closed?this.count_:this.count_-1}},{key:"start",get:function(){return this.startPoint.point}},{key:"end",get:function(){return this.endPoint.point}},{key:"length",get:function(){throw new Error("Method not implemented.")}}]),s}(Symbol.iterator),ar=function(){function l(o,t){void 0===t&&(t=o),this.width=o,this.height=t}return l.prototype.pad=function(t){this.width+=2*t},l}(),lt=function(){function l(o){this.left_=o.left,this.right_=o.right,this.top_=o.top,this.bottom=o.bottom}var s=l.prototype;return s.transform=function(t){return l.mkPP(t.multiplyPoint(this.leftTop),t.multiplyPoint(this.rightBottom))},s.translate=function(t){return l.mkSizeCenter(this.size,this.center.add(t))},s.equal=function(t){return this.left_===t.left&&this.right_===t.right&&this.top_===t.top&&this.bottom_===t.bottom},s.equalEps=function(t){return dt(this.left_,t.left)&&dt(this.right_,t.right)&&dt(this.top_,t.top)&&dt(this.bottom_,t.bottom)},l.mkSizeCenter=function(t,e){var r=t.width/2,i=t.height/2;return new l({left:e.x-r,right:e.x+r,bottom:e.y-i,top:e.y+i})},s.add_rect=function(t){return this.addRec(t)},s.contains_point=function(t){return this.contains(t)},s.contains_rect=function(t){return this.containsRect(t)},s.intersection_rect=function(t){return this.intersection(t)},s.intersects_rect=function(t){return this.intersects(t)},s.unite=function(t){return l.rectangleOfTwo(this,t)},s.contains_point_radius=function(t,e){return this.containsWithPadding(t,e)},s.intersects=function(t){return this.intersectsOnX(t)&&this.intersectsOnY(t)},s.intersection=function(t){if(!this.intersects(t)){var e=l.mkEmpty();return e.setToEmpty(),e}var r=Math.max(this.left,t.left),i=Math.min(this.right,t.right);return new l({left:r,bottom:Math.max(this.bottom,t.bottom),right:i,top:Math.min(this.top,t.top)})},s.intersectsOnY=function(t){return!(t.bottom_>this.top_+q.distanceEpsilon||t.top_<this.bottom_-q.distanceEpsilon)},s.intersectsOnX=function(t){return!(t.left>this.right_+q.distanceEpsilon||t.right<this.left_-q.distanceEpsilon)},l.mkEmpty=function(){return new l({left:0,right:-1,bottom:0,top:-1})},s.onUpdated=function(){},l.mkPP=function(t,e){var r=new l({left:t.x,right:t.x,top:t.y,bottom:t.y});return r.add(e),r},l.rectangleOnPoint=function(t){return new l({left:t.x,right:t.x,top:t.y,bottom:t.y})},l.mkLeftBottomSize=function(t,e,r){return new l({left:t,right:t+r.width,top:e+r.height,bottom:e})},l.getRectangleOnCoords=function(t,e,r,i){var h=new l({left:t,bottom:e,right:t,top:e});return h.add(new R(r,i)),h},l.mkOnPoints=function(t){for(var i,e=l.mkEmpty(),r=C(t);!(i=r()).done;)e.add(i.value);return e},l.mkOnRectangles=function(t){for(var i,e=l.mkEmpty(),r=C(t);!(i=r()).done;)e.addRecSelf(i.value);return e},s.isEmpty=function(){return this.right<this.left},s.setToEmpty=function(){this.left=0,this.right=-1},l.rectangleOfTwo=function(t,e){var r=new l({left:t.left_,right:t.right_,top:t.top_,bottom:t.bottom_});return r.addRecSelf(e),r},s.containsWithPadding=function(t,e){return this.left_-e-q.distanceEpsilon<=t.x&&t.x<=this.right_+e+q.distanceEpsilon&&this.bottom_-e-q.distanceEpsilon<=t.y&&t.y<=this.top_+e+q.distanceEpsilon},s.add=function(t){this.isEmpty()?(this.left_=this.right_=t.x,this.top_=this.bottom=t.y):(this.left_>t.x&&(this.left_=t.x),this.top_<t.y&&(this.top_=t.y),this.right_<t.x&&(this.right_=t.x),this.bottom_>t.y&&(this.bottom=t.y))},s.addRecSelf=function(t){this.add(t.leftTop),this.add(t.rightBottom)},s.addRec=function(t){var e=this.clone();return e.add(t.leftTop),e.add(t.rightBottom),e},l.translate=function(t,e){var r=t.clone();return r.center=t.center.add(e),r},l.transform=function(t,e){return l.mkPP(e.multiplyPoint(t.leftTop),e.multiplyPoint(t.rightBottom))},s.contains=function(t){return this.containsWithPadding(t,0)},s.containsRect=function(t){return this.contains(t.leftTop)&&this.contains(t.rightBottom)},s.containsRectWithPadding=function(t,e){return this.containsWithPadding(t.leftTop,e)&&this.containsWithPadding(t.rightBottom,e)},s.padWidth=function(t){this.left-=t,this.right+=t},s.padHeight=function(t){this.top+=t,this.bottom-=t},s.pad=function(t){t<-this.width/2&&(t=-this.width/2),t<-this.height/2&&(t=-this.height/2),this.padWidth(t),this.padHeight(t)},s.padEverywhere=function(t){this.left-=t.left,this.right+=t.right,this.bottom-=t.bottom,this.top+=t.top},l.intersect=function(t,e){return t.intersects(e)?l.mkPP(new R(Math.max(t.left,e.left),Math.max(t.bottom,e.bottom)),new R(Math.min(t.right,e.right),Math.min(t.top,e.top))):l.mkEmpty()},s.perimeter=function(){var t=new vt;return t.addPoint(this.leftTop),t.addPoint(this.rightTop),t.addPoint(this.rightBottom),t.addPoint(this.leftBottom),t.closed=!0,t},s.scaleAroundCenter=function(t){this.width=this.width*t,this.height=this.height*t},s.clone=function(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})},l.creatRectangleWithSize=function(t,e){var r=t.width/2,c=t.height/2;return new l({left:e.x-r,right:e.x+r,top:e.y+c,bottom:e.y-c})},s.addPointWithSize=function(t,e){var r=t.width/2,i=t.height/2;this.add(new R(e.x-r,e.y-i)),this.add(new R(e.x+r,e.y-i)),this.add(new R(e.x-r,e.y+i)),this.add(new R(e.x+r,e.y+i))},Q(l,[{key:"center",get:function(){return this.leftTop.add(this.rightBottom).mul(.5)},set:function(t){var e=this.leftTop.add(this.rightBottom).mul(.5),r=t.sub(e);this.leftTop=this.leftTop.add(r),this.rightBottom=this.rightBottom.add(r)}},{key:"left",get:function(){return this.left_},set:function(t){this.left_=t,this.onUpdated()}},{key:"right",get:function(){return this.right_},set:function(t){this.right_=t,this.onUpdated()}},{key:"top",get:function(){return this.top_},set:function(t){this.top_=t,this.onUpdated()}},{key:"bottom",get:function(){return this.bottom_},set:function(t){this.bottom_=t,this.onUpdated()}},{key:"leftBottom",get:function(){return new R(this.left_,this.bottom_)},set:function(t){this.left_=t.x,this.bottom=t.y}},{key:"rightTop",get:function(){return new R(this.right_,this.top_)},set:function(t){this.right_=t.x,this.top_=t.y}},{key:"leftTop",get:function(){return new R(this.left_,this.top_)},set:function(t){this.left_=t.x,this.top_=t.y}},{key:"rightBottom",get:function(){return new R(this.right_,this.bottom_)},set:function(t){this.right_=t.x,this.bottom=t.y}},{key:"width",get:function(){return this.right_-this.left_},set:function(t){var e=t/2,r=(this.left_+this.right_)/2;this.left_=r-e,this.right_=r+e}},{key:"height",get:function(){return this.top_-this.bottom_},set:function(t){var e=t/2,r=(this.top_+this.bottom_)/2;this.top_=r+e,this.bottom=r-e}},{key:"area",get:function(){return(this.right_-this.left_)*(this.top_-this.bottom_)}},{key:"diagonal",get:function(){return Math.sqrt(this.width*this.width+this.height*this.height)}},{key:"size",get:function(){return new ar(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}}]),l}(),Yt=function(){function l(){this.previouisBezierCoefficient=.5,this.nextBezierCoefficient=.5,this.previousTangentCoefficient=1/3,this.nextTangentCoefficient=1/3}return l.mkSiteP=function(t){var e=new l;return e.point=t,e},l.mkSiteSP=function(t,e){var r=new l;return r.point=e,r.prev=t,t.next=r,r},l.mkSiteSPS=function(t,e,r){var i=new l;return i.prev=t,i.point=e,i.next=r,t.next=i,r.prev=i,i},l.prototype.clone=function(){var t=new l;return t.previouisBezierCoefficient=this.previouisBezierCoefficient,t.point=this.point,t},Q(l,[{key:"turn",get:function(){return null==this.next||null==this.prev?0:R.getTriangleOrientation(this.prev.point,this.point,this.next.point)}}]),l}();function Ao(){Ao=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var U,ce=function(l){function s(t){this.headSite=t}s.mkFromPoints=function(e){for(var c,r=null,i=null,h=C(e);!(c=h()).done;){var f=c.value;if(null==i)r=new s(i=Yt.mkSiteP(f));else{var p=Yt.mkSiteP(f);p.prev=i,i.next=p,i=p}}return r};var o=s.prototype;return o.clone=function(){for(var i,e=this.headSite,r=null,h=null;null!=e;)(i=e.clone()).prev=r,null!=r?r.next=i:h=i,e=e.next,r=i;return new s(h)},o[l]=Ao().mark(function t(){var e;return Ao().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=this.headSite;case 1:if(null==e){i.next=7;break}return i.next=4,e.point;case 4:e=e.next,i.next=1;break;case 7:case"end":return i.stop()}},t,this)}),o.createCurve=function(){for(var e=new K,r=this.headSite;;){var h=K.findCorner(r);if(null==h)break;var c=s.createBezierSegOnSite(h.b);0===e.segs.length?R.closeDistEps(r.point,c.start)||K.addLineSegment(e,r.point,c.start):R.closeDistEps(e.end,c.start)||K.continueWithLineSegmentP(e,c.start),e.addSegment(c),r=h.b}return 0===e.segs.length?R.closeDistEps(r.point,r.next.point)?e.segs.push(new or(r.point,r.point.add(new R(5,5)),r.point.add(new R(-5,5)),(void 0).point)):K.addLineSegment(e,r.point,r.next.point):R.closeDistEps(e.end,r.next.point)||K.continueWithLineSegmentP(e,r.next.point),e},s.createBezierSegOnSite=function(e){var r=e.previouisBezierCoefficient,i=e.nextBezierCoefficient,c=e.next,f=e.prev.point.mul(r).add(e.point.mul(1-r)),p=c.point.mul(i).add(e.point.mul(1-i)),y=f.mul(e.previousTangentCoefficient).add(e.point.mul(1-e.previousTangentCoefficient)),m=p.mul(e.nextTangentCoefficient).add(e.point.mul(1-e.nextTangentCoefficient));return or.mkBezier([f,y,m,p])},Q(s,[{key:"lastSite",get:function(){for(var e=this.headSite;null!=e.next;)e=e.next;return e}}]),s}(Symbol.iterator),Ve=function(){function l(o,t,e,r,i,h){this.elements=[[o,t,e],[r,i,h]]}var s=l.prototype;return s.getElem=function(t,e){return this.elements[t][e]},s.setElem=function(t,e,r){this.elements[t][e]=r},l.Divide=function(t,e){return t.multiply(e.inverse())},s.isIdentity=function(){return dt(this.elements[0][0],1)&&dt(this.elements[0][1],0)&&dt(this.elements[0][2],0)&&dt(this.elements[1][0],0)&&dt(this.elements[1][1],1)&&dt(this.elements[1][2],0)},s.offset=function(){return new R(this.getElem(0,2),this.getElem(1,2))},l.getIdentity=function(){return new l(1,0,0,0,1,0)},l.rotation=function(t){var e=Math.cos(t),r=Math.sin(t);return new l(e,-r,0,r,e,0)},l.scaleAroundCenterTransformation=function(t,e,r){return new l(t,0,(1-t)*r.x,0,e,(1-e)*r.y)},s.multiplyPoint=function(t){return new R(this.getElem(0,0)*t.x+this.getElem(0,1)*t.y+this.getElem(0,2),this.getElem(1,0)*t.x+this.getElem(1,1)*t.y+this.getElem(1,2))},s.multiply=function(t){return null!=t?new l(this.getElem(0,0)*t.getElem(0,0)+this.getElem(0,1)*t.getElem(1,0),this.getElem(0,0)*t.getElem(0,1)+this.getElem(0,1)*t.getElem(1,1),this.getElem(0,0)*t.getElem(0,2)+this.getElem(0,1)*t.getElem(1,2)+this.getElem(0,2),this.getElem(1,0)*t.getElem(0,0)+this.getElem(1,1)*t.getElem(1,0),this.getElem(1,0)*t.getElem(0,1)+this.getElem(1,1)*t.getElem(1,1),this.getElem(1,0)*t.getElem(0,2)+this.getElem(1,1)*t.getElem(1,2)+this.getElem(1,2)):null},s.inverse=function(){var t=this.getElem(0,0)*this.getElem(1,1)-this.getElem(1,0)*this.getElem(0,1),e=this.getElem(1,1)/t,r=-this.getElem(0,1)/t,i=-this.getElem(1,0)/t,h=this.getElem(0,0)/t;return new l(e,r,-e*this.getElem(0,2)-r*this.getElem(1,2),i,h,-i*this.getElem(0,2)-h*this.getElem(1,2))},Q(l,[{key:"Elements",get:function(){return this.elements}}]),l}(),te=function(){function l(){}return l.mkEllipse=function(o,t,e){return Wt.mkFullEllipseNNP(o,t,e)},l.createParallelogram=function(o,t,e){var r=t/2,i=o/2,h=e.x,c=e.y,f=80*Math.PI/180,p=r/Math.tan(f);return vt.mkClosedFromPoints([new R(-i-p+h,-r+c),new R(i+h,-r+c),new R(i+h+p,r+c),new R(-i+h,r+c)])},l.createHexagon=function(o,t,e){var r=t/2,i=o/2,h=e.x,c=e.y;return vt.mkClosedFromPoints([new R(-i+h,-r+c),new R(i+h,-r+c),new R(i+(r+h),0+c),new R(i+h,r+c),new R(-i+h,r+c),new R(-(i-r)+h,0+c)])},l.createOctagon=function(o,t,e){var r=o/2,i=t/2,h=new Array(8);h[0]=new R(r+l.octagonPad*r,i-i*l.octagonPad),h[3]=new R(-1*h[0].x,h[0].y),h[4]=new R(h[3].x,-1*h[3].y),h[7]=new R(h[0].x,-1*h[0].y),h[1]=new R(r-r*l.octagonPad,i+i*l.octagonPad),h[2]=new R(-1*h[1].x,h[1].y),h[6]=new R(h[1].x,-1*h[1].y),h[5]=new R(h[2].x,-1*h[2].y);for(var c=0;c<8;c++)h[c]=h[c].add(e);return vt.mkClosedFromPoints(h)},l.createInvertedHouse=function(o,t,e){var r=l.createHouse(o,t,e);return l.rotateCurveAroundCenterByDegree(r,e,180)},l.createHouse=function(o,t,e){var r=o/2,i=t/2,h=e.x,c=e.y,f=new K;return K.addLineSegmentCNNNN(f,h-r,c-i,h+r,c-i),K.continueWithLineSegmentNN(f,h+r,c+i),K.continueWithLineSegmentNN(f,h,c+2*i),K.continueWithLineSegmentNN(f,h-r,c+i),K.closeCurve(f)},l.mkDiamond=function(o,t,e){var r=o,i=t,h=e.x,c=e.y,f=new K,p=[new R(h,c-i),new R(h+r,c),new R(h,c+i),new R(h-r,c)];return f.addSegs([Z.mkPP(p[0],p[1]),Z.mkPP(p[1],p[2]),Z.mkPP(p[2],p[3]),Z.mkPP(p[3],p[0])]),f},l.rotateCurveAroundCenterByDegree=function(o,t,e){return l.rotateCurveAroundCenterByRadian(o,t,e*Math.PI/180)},l.rotateCurveAroundCenterByRadian=function(o,t,e){var r=Math.cos(e),i=Math.sin(e),h=new Ve(1,0,t.x,0,1,t.y).multiply(new Ve(r,-i,0,i,r,0)).multiply(new Ve(1,0,-t.x,0,1,-t.y));return o.transform(h)},l.mkCircle=function(o,t){return Wt.mkCircle(o,t)},l.createRectangle=function(o,t,e){var r=o/2,i=t/2,h=e.x,c=e.y,f=new K,p=[new R(h-r,c-i),new R(h+r,c-i),new R(h+r,c+i),new R(h-r,c+i)];return f.addSegs([Z.mkPP(p[0],p[1]),Z.mkPP(p[1],p[2]),Z.mkPP(p[2],p[3]),Z.mkPP(p[3],p[0])]),f},l.isRoundedRect=function(o){if(o instanceof K){var t=o.segs;if(8===t.length||4===t.length){for(var r,i,e=8===t.length,h=0;h<4;h++){var c=e?2*h+1:h;if(0===h){if(!(t[c]instanceof Wt))return;var f=t[c];r=f.aAxis.length,i=f.bAxis.length}else{if(!(t[c]instanceof Wt))return;var p=t[c];if(r!==p.aAxis.length||i!==p.bAxis.length)return}}return{radX:r,radY:i}}}},l.mkRectangleWithRoundedCorners=function(o,t,e,r,i){if(void 0===i&&(i=new R(0,0)),0===e||0===r)return l.createRectangle(o,t,i);var h=new K,c=o/2;e>c/2&&(e=c/2);var f=t/2;r>f/2&&(r=f/2);var p=i.x,y=i.y,m=c-e,P=f-r,L=y+f,E=y-f,S=p-c,T=p+c,O=new R(e,0),x=new R(0,r);return m>0&&h.addSegment(Z.mkPP(new R(p-m,E),new R(p+m,E))),h.addSegment(Wt.mkEllipse(1.5*Math.PI,2*Math.PI,O,x,p+m,y-P)),P>0&&h.addSegment(Z.mkPP(new R(T,y-P),new R(T,y+P))),h.addSegment(Wt.mkEllipse(0,.5*Math.PI,O,x,p+m,y+P)),m>0&&h.addSegment(Z.mkPP(new R(p+m,L),new R(p-m,L))),h.addSegment(Wt.mkEllipse(.5*Math.PI,Math.PI,O,x,p-m,y+P)),P>0&&h.addSegment(Z.mkPP(new R(S,y+P),new R(S,y-P))),h.addSegment(Wt.mkEllipse(Math.PI,1.5*Math.PI,O,x,p-m,y-P)),h},l}();function xr(l){return l.parEnd-l.parStart}te.octagonPad=1/4,function(l){l[l.None=0]="None",l[l.North=1]="North",l[l.East=2]="East",l[l.South=4]="South",l[l.West=8]="West"}(U||(U={}));var J=function(){function l(){}return l.EqualPP=function(o,t){return l.Equal(o.x,t.x)&&l.Equal(o.y,t.y)},l.Equal=function(o,t){return 0===l.Compare(o,t)},l.Compare=function(o,t){var e=0;return o+l.DifferenceEpsilon<t?e=-1:t+l.DifferenceEpsilon<o&&(e=1),e},l.ComparePP=function(o,t){var e=l.Compare(o.x,t.x);return 0===e&&(e=l.Compare(o.y,t.y)),e},l.LessOrEqual=function(o,t){var e=l.Compare(o,t);return e<0||0===e},l.Less=function(o,t){return l.Compare(o,t)<0},l.GetDirections=function(o,t){return nt.DirectionFromPointToPoint(o,t)},l.IsPureDirection=function(o,t){return nt.IsPureDirection(l.GetDirections(o,t))},l.IsPureDirectionD=function(o){return nt.IsPureDirection(o)},l.IsPureLower=function(o,t){var e=l.GetDirections(o,t);return U.East===e||U.North===e},l.GetPureDirectionVV=function(o,t){return l.GetDirections(o.point,t.point)},Q(l,null,[{key:"DifferenceEpsilon",get:function(){return l.differenceEpsilon}}]),l}();J.differenceEpsilon=q.distanceEpsilon/2;var nt=function(){function l(o){this.Dir=o}return l.RotateRight=function(t){switch(t){case U.North:return U.East;case U.East:return U.South;case U.South:return U.West;case U.West:return U.North;default:throw new Error}},l.RotateLeft=function(t){switch(t){case U.North:return U.West;case U.West:return U.South;case U.South:return U.East;case U.East:return U.North;default:throw new Error}},l.ToIndex=function(t){switch(t){case U.North:return 0;case U.East:return 1;case U.South:return 2;case U.West:return 3;default:throw new Error}},l.VectorDirection=function(t){var e=U.None;return t.x>J.DifferenceEpsilon?e=U.East:t.x<-J.DifferenceEpsilon&&(e=U.West),t.y>J.DifferenceEpsilon?e|=U.North:t.y<-J.DifferenceEpsilon&&(e|=U.South),e},l.VectorDirectionPP=function(t,e){var r=U.None,i=e.x-t.x,h=e.y-t.y;return i>J.DifferenceEpsilon?r=U.East:-i>J.DifferenceEpsilon&&(r=U.West),h>J.DifferenceEpsilon?r|=U.North:-h>J.DifferenceEpsilon&&(r|=U.South),r},l.DirectionFromPointToPoint=function(t,e){return l.VectorDirectionPP(t,e)},l.OppositeDir=function(t){switch(t){case U.North:return U.South;case U.West:return U.East;case U.South:return U.North;case U.East:return U.West;default:return U.None}},l.IsPureDirection=function(t){switch(t){case U.North:case U.East:case U.South:case U.West:return!0;default:return!1}},l.IsPureDirectionPP=function(t,e){return l.IsPureDirection(l.DirectionFromPointToPoint(t,e))},l.DirectionsAreParallel=function(t,e){return t===e||t===l.OppositeDir(e)},l.prototype.ToPoint=function(){var t=0,e=0;return(this.Dir&U.East)===U.East&&t++,(this.Dir&U.North)===U.North&&e++,(this.Dir&U.West)===U.West&&t--,(this.Dir&U.South)===U.South&&e--,new R(t,e)},l.toPoint=function(t){return new l(t).ToPoint()},l.negate=function(t){return new l(l.OppositeDir(t.Dir))},Q(l,[{key:"Right",get:function(){return new l(l.RotateRight(this.Dir))}}]),l}(),eh=function(l){function s(t,e){var r;return(r=l.call(this,t)||this)._isPositioned=!1,e&&(r.boundingBox=lt.mkPP(new R(0,0),new R(e.width,e.height))),r}X(s,l);var o=s.prototype;return o.clone=function(){var e=new s(null,null);return e.isPositioned=this.isPositioned,e._boundingBox=this._boundingBox.clone(),e.attachmentSegmentEnd=this.attachmentSegmentEnd,e.attachmentSegmentStart=this.attachmentSegmentStart,e},o.setBoundingBox=function(e){this.isPositioned=!0,this._boundingBox=e},o.translate=function(e){this.isPositioned&&(this.center=this.center.add(e))},o.transform=function(e){this.isPositioned&&(this.center=e.multiplyPoint(this.center))},o.positionCenter=function(e){this.boundingBox.center=e,this.isPositioned=!0},Q(s,[{key:"isPositioned",get:function(){return this._isPositioned},set:function(e){this._isPositioned=e}},{key:"boundingBox",get:function(){return this._boundingBox},set:function(e){this._boundingBox=e}},{key:"width",get:function(){return this.boundingBox.width},set:function(e){this.boundingBox.width=e}},{key:"height",get:function(){return this.boundingBox.height},set:function(e){this.boundingBox.height=e}},{key:"center",get:function(){return this.boundingBox.center},set:function(e){this.boundingBox.center=e}}]),s}(at);function ni(){ni=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ft,sr=function(l){function s(t){var e;return(e=l.call(this,t)||this).lineWidth=1,e}X(s,l),s.getGeom=function(e){return at.getGeom(e)};var o=s.prototype;return o.clone=function(){var e=new s(null);return this.smoothedPolyline&&(e.smoothedPolyline=this.smoothedPolyline.clone()),e.curve=this.curve.clone(),null!=this.sourceArrowhead&&(e.sourceArrowhead=this.sourceArrowhead.clone()),null!=this.targetArrowhead&&(e.targetArrowhead=this.targetArrowhead.clone()),e},o.RaiseLayoutChangeEvent=function(e){this.edge.raiseEvents(e)},o.requireRouting=function(){this.curve=null,this.smoothedPolyline=null},o.translate=function(e){if(0!==e.x||0!==e.y){if(null!=this.curve&&this.curve.translate(e),null!=this.smoothedPolyline)for(var r=this.smoothedPolyline.headSite,i=this.smoothedPolyline.headSite;null!=r;r=r.next,i=i.next)r.point=i.point.add(e);if(null!=this.sourceArrowhead&&this.sourceArrowhead.tipPosition&&(this.sourceArrowhead.tipPosition=this.sourceArrowhead.tipPosition.add(e)),null!=this.targetArrowhead&&this.targetArrowhead.tipPosition&&(this.targetArrowhead.tipPosition=this.targetArrowhead.tipPosition.add(e)),this.edge.label){var h=eh.getGeom(this.edge.label);h&&h.translate(e)}}},o.GetMaxArrowheadLength=function(){var e=0;return null!=this.sourceArrowhead&&(e=this.sourceArrowhead.length),null!=this.targetArrowhead&&this.targetArrowhead.length>e?this.targetArrowhead.length:e},o.transform=function(e){if(null!=this.curve){if(this.curve=this.curve.transform(e),null!=this.smoothedPolyline)for(var r=this.smoothedPolyline.headSite,i=this.smoothedPolyline.headSite;null!=r;r=r.next,i=i.next)r.point=e.multiplyPoint(r.point);null!=this.sourceArrowhead&&(this.sourceArrowhead.tipPosition=e.multiplyPoint(this.sourceArrowhead.tipPosition)),null!=this.targetArrowhead&&(this.targetArrowhead.tipPosition=e.multiplyPoint(this.targetArrowhead.tipPosition))}},o.sourceArrowheadPoints=ni().mark(function t(e){var r;return ni().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(null!=this.sourceArrowhead){h.next=2;break}return h.abrupt("return");case 2:return h.next=4,this.sourceArrowhead.tipPosition;case 4:return r=(r=this.sourceArrowhead.tipPosition.sub(this.curve.start)).rotate90Cw().mul(Math.tan(.5*e*(Math.PI/180))),h.next=8,r.add(this.curve.start);case 8:return h.next=10,this.curve.start.sub(r);case 10:case"end":return h.stop()}},t,this)}),o.targetArrowheadPoints=ni().mark(function t(e){var r;return ni().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(null!=this.targetArrowhead){h.next=2;break}return h.abrupt("return");case 2:return h.next=4,this.targetArrowhead.tipPosition;case 4:return r=(r=this.targetArrowhead.tipPosition.sub(this.curve.end)).rotate90Cw().mul(Math.tan(.5*e*(Math.PI/180))),h.next=8,r.add(this.curve.end);case 8:return h.next=10,this.curve.end.sub(r);case 10:case"end":return h.stop()}},t,this)}),o.isInterGraphEdge=function(){return this.edge.isInterGraphEdge()},o.toString=function(){return this.source.toString()+"->"+this.target},s.RouteSelfEdge=function(e,r,i){var h=e.boundingBox.width,c=e.boundingBox.height,f=e.boundingBox.center,p=new R(f.x-h/4,f.y),y=new R(f.x-h/4,f.y-c/2-r),m=new R(f.x+h/4,f.y-c/2-r),P=new R(f.x+h/4,f.y);return i.smoothedPolyline=ce.mkFromPoints([p,y,m,P]),i.smoothedPolyline.createCurve()},o.underCollapsedGraph=function(){return this.source.underCollapsedGraph()||this.target.underCollapsedGraph()},o.EdgeToAncestor=function(){return this.edge.EdgeToAncestor()},Q(s,[{key:"label",get:function(){return null!=this.edge&&null!=this.edge.label?at.getGeom(this.edge.label):null},set:function(e){this.edge.label.setAttr(rt.GeomObjectIndex,e)}},{key:"edge",get:function(){return this.entity}},{key:"source",get:function(){return at.getGeom(this.edge.source)}},{key:"boundingBox",get:function(){var e=lt.mkEmpty();if(null!=this.smoothedPolyline)for(var i,r=C(this.smoothedPolyline);!(i=r()).done;)e.add(i.value);null!=this.curve&&e.addRecSelf(this.curve.boundingBox);for(var f,c=C(this.sourceArrowheadPoints(25));!(f=c()).done;)e.add(f.value);for(var m,y=C(this.targetArrowheadPoints(25));!(m=y()).done;)e.add(m.value);this.label&&e.addRecSelf(this.label.boundingBox);var L=this.lineWidth;return e.left-=L,e.top+=L,e.right+=L,e.bottom-=L,e}},{key:"target",get:function(){return at.getGeom(this.edge.target)}}]),s}(at),jt=ie(73903);function fe(){fe=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}function Ht(l){if(0===l.length)return null;if(1===l.length)return l[0];var s={b0:l[0].irect,seed0:1},o=function(l,s){for(var o=Is(s.b0,l[s.seed0].irect),t=2;t<l.length;t++){var e=Is(s.b0,l[t].irect);e>o&&(s.seed0=t,o=e)}for(var r,i=0;i<l.length;i++)if(i!==s.seed0){r=i;break}o=l[s.seed0].irect.add_rect(l[r].irect).area;for(var h=0;h<l.length;h++)if(h!==s.seed0){var c=l[s.seed0].irect.add_rect(l[h].irect).area;c>o&&(r=h,o=c)}return r}(l,s),t=[],e=[];t.push(l[s.seed0]),e.push(l[o]);var r={box0:l[s.seed0].irect,box1:l[o].irect};!function(l,s,o,t,e,r){for(var h=0;h<l.length;h++)if(h!==s&&h!==o){var c=r.box0.add_rect(l[h].irect),f=c.area-r.box0.area,p=r.box1.add_rect(l[h].irect),y=p.area-r.box1.area;2*t.length<e.length?(t.push(l[h]),r.box0=c):2*e.length<t.length?(e.push(l[h]),r.box1=p):f<y?(t.push(l[h]),r.box0=c):y<f?(e.push(l[h]),r.box1=p):r.box0.area<r.box1.area?(t.push(l[h]),r.box0=c):(e.push(l[h]),r.box1=p)}}(l,s.seed0,o,t,e,r);var i=xs(l.length);return i.irect=r.box0.add_rect(r.box1),i.Left=Ht(t),i.Right=Ht(e),i}function Is(l,s){return l.add_rect(s).area}function qi(l,s){return null==l||null==s?null:Ht(Array.from(l).map(function(t){return Qt(t,s(t))}))}function xs(l){var s=new Ro;return s.Count=l,s}function Qt(l,s){var o=new Ro;return o.UserData=l,o.irect=s,o.Count=1,o}function ko(l,s,o){return l.irect.intersects_rect(o)?s(l.UserData)===Ft.Continue?null!=l.Left?ko(l.Left,s,o)===Ft.Continue&&ko(l.Right,s,o)===Ft.Continue?Ft.Continue:Ft.Stop:Ft.Continue:Ft.Stop:Ft.Continue}!function(l){l[l.Continue=0]="Continue",l[l.Stop=1]="Stop"}(Ft||(Ft={}));var Ro=function(){function l(){}var s=l.prototype;return s.toString=function(){return this.IsLeaf?this.Count.toString()+" "+this.UserData:this.Count.toString()},s.FirstIntersectedNode=function(t){var e;return t.intersects_rect(this.irect)?this.IsLeaf?this:null!==(e=this.Left.FirstIntersectedNode(t))&&void 0!==e?e:this.Right.FirstIntersectedNode(t):null},s.FirstHitNodeWithPredicate=function(t,e){var r;return this.irect.contains_point(t)?this.IsLeaf?e(t,this.UserData)===Ft.Stop?this:null:null!==(r=this.Left.FirstHitNodeWithPredicate(t,e))&&void 0!==r?r:this.Right.FirstHitNodeWithPredicate(t,e):null},s.FirstHitByRectWithPredicate=function(t,e){var r;return this.irect.intersects_rect(t)?this.IsLeaf?e(this.UserData)===Ft.Stop?this:null:null!==(r=this.Left.FirstHitByRectWithPredicate(t,e))&&void 0!==r?r:this.Right.FirstHitByRectWithPredicate(t,e):null},s.FirstHitNode=function(t){var e;return this.irect.contains_point(t)?this.IsLeaf?this:null!==(e=this.Left.FirstHitNode(t))&&void 0!==e?e:this.Right.FirstHitNode(t):null},s.AllHitItems=function(t,e){var r=this;return void 0===e&&(e=null),fe().mark(function i(){var h,c;return fe().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:(h=new jt.K).push(r);case 2:if(!(h.size>0)){p.next=15;break}if(!(c=h.pop()).irect.intersects_rect(t)){p.next=13;break}if(!c.IsLeaf){p.next=11;break}if(null!=e&&!e(c.UserData)){p.next=9;break}return p.next=9,c.UserData;case 9:p.next=13;break;case 11:h.push(c.left),h.push(c.right);case 13:p.next=2;break;case 15:case"end":return p.stop()}},i)})()},s.AllHitItems_=fe().mark(function o(t){var e,r;return fe().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:(e=new jt.K).push(this);case 2:if(!(e.size>0)){h.next=14;break}if(!(r=e.pop()).irect.contains_point(t)){h.next=12;break}if(!r.IsLeaf){h.next=10;break}return h.next=8,r.UserData;case 8:h.next=12;break;case 10:e.push(r.left),e.push(r.right);case 12:h.next=2;break;case 14:case"end":return h.stop()}},o,this)}),s.VisitTree=function(t,e){ko(this,t,e)},s.Clone=function(){var t=xs(this.Count);return t.UserData=this.UserData,t.irect=this.irect,null!=this.Left&&(t.Left=this.Left.Clone()),null!=this.Right&&(t.Right=this.Right.Clone()),t},s.GetNodeItemsIntersectingRectangle=fe().mark(function o(t){var e,r,i;return fe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.GetLeafRectangleNodesIntersectingRectangle(t));case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i.UserData;case 5:c.next=1;break;case 7:case"end":return c.stop()}},o,this)}),s.GetLeafRectangleNodesIntersectingRectangle=fe().mark(function o(t){var e,r;return fe().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:(e=new jt.K).push(this);case 2:if(!(e.size>0)){h.next=14;break}if(!(r=e.pop()).irect.intersects_rect(t)){h.next=12;break}if(!r.IsLeaf){h.next=10;break}return h.next=8,r;case 8:h.next=12;break;case 10:e.push(r.left),e.push(r.right);case 12:h.next=2;break;case 14:case"end":return h.stop()}},o,this)}),s.GetAllLeaves=fe().mark(function o(){var t,e,r;return fe().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:t=C(this.GetAllLeafNodes());case 1:if((e=t()).done){h.next=7;break}return r=e.value,h.next=5,r.UserData;case 5:h.next=1;break;case 7:case"end":return h.stop()}},o,this)}),s.GetAllLeafNodes=fe().mark(function o(){var t,e,r;return fe().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:t=C(this.EnumRectangleNodes(!0));case 1:if((e=t()).done){h.next=7;break}return r=e.value,h.next=5,r;case 5:h.next=1;break;case 7:case"end":return h.stop()}},o,this)}),s.EnumRectangleNodes=fe().mark(function o(t){var e,r;return fe().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:(e=new jt.K).push(this);case 2:if(!(e.size>0)){h.next=10;break}if(!(r=e.pop()).IsLeaf&&t){h.next=7;break}return h.next=7,r;case 7:r.IsLeaf||(e.push(r.left),e.push(r.right)),h.next=2;break;case 10:case"end":return h.stop()}},o,this)}),s.TraverseHierarchy=function(t,e){e(t),null!=t.Left&&this.TraverseHierarchy(t.Left,e),null!=t.Right&&this.TraverseHierarchy(t.Right,e)},Q(l,[{key:"IsLeaf",get:function(){return null==this.left}},{key:"Left",get:function(){return this.left},set:function(t){null!=this.left&&this.left.Parent===this&&(this.left.Parent=null),this.left=t,null!=this.left&&(this.left.Parent=this)}},{key:"Right",get:function(){return this.right},set:function(t){null!=this.right&&this.right.Parent===this&&(this.right.Parent=null),this.right=t,null!=this.right&&(this.right.Parent=this)}},{key:"IsLeftChild",get:function(){return this===this.Parent.Left}}]),l}(),ue=function(){function l(o,t){be(o,t)<0?(this._first=o,this._second=t):(this._first=t,this._second=o)}var s=l.prototype;return s.CompareTo=function(t){var e=be(this._first,t._first);return 0!==e?e:be(this._second,t._second)},l.equal=function(t,e){return t._first.equal(e._first)&&t._second.equal(e._second)},s.toString=function(){return this._first+" "+this._second},Q(l,[{key:"first",get:function(){return this._first}},{key:"second",get:function(){return this._second}},{key:"Length",get:function(){return At(this._first,this._second)}}]),l}();function ii(){ii=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var qt=function(l){function s(){this.size_=0,this.mapOfSets=new Map}var o=s.prototype;return o.delete=function(e){return this.deletexy(e.x,e.y)},o.clear=function(){this.mapOfSets.clear(),this.size_=0},s.mk=function(e){for(var h,r=new s,i=C(e);!(h=i()).done;)r.add(h.value);return r},o.addxy=function(e,r){var i=this.mapOfSets.get(e);null==i&&this.mapOfSets.set(e,i=new Set),i.has(r)||this.size_++,i.add(r)},o.add=function(e){return this.addxy(e.x,e.y),this},o.deletexy=function(e,r){var i=this.mapOfSets.get(e);return!(null==i||!i.delete(r)||(this.size_--,0))},o.hasxy=function(e,r){return this.mapOfSets.has(e)&&this.mapOfSets.get(e).has(r)},o.has=function(e){return this.hasxy(e.x,e.y)},o.forEach=function(e,r){for(var h,i=C(this);!(h=i()).done;){var c=h.value;e(c,c,r)}},o.entries=ii().mark(function t(){var e,r,i;return ii().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,[i,i];case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.keys=function(){return this.values()},o.values=ii().mark(function t(){var e,r,i,h,c,f;return ii().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.mapOfSets);case 1:if((r=e()).done){y.next=12;break}h=C((i=r.value)[1]);case 4:if((c=h()).done){y.next=10;break}return f=c.value,y.next=8,new R(i[0],f);case 8:y.next=4;break;case 10:y.next=1;break;case 12:case"end":return y.stop()}},t,this)}),o[l]=function(){return this.values()},Q(s,[{key:"size",get:function(){return this.size_}}]),s}(Symbol.iterator);function Tn(l,s){for(var e,o=new Set,t=C(l);!(e=t()).done;){var r=e.value;s.has(r)||o.add(r)}return o}function On(l,s){for(var e,o=new Set(l),t=C(s);!(e=t()).done;)o.add(e.value);return o}function Tr(l,s){for(var t,o=C(s);!(t=o()).done;)l.push(t.value)}function Or(l,s){var o=new Set;if(l.size<s.size)for(var e,t=C(l);!(e=t()).done;){var r=e.value;s.has(r)&&o.add(r)}else for(var h,i=C(s);!(h=i()).done;){var c=h.value;l.has(c)&&o.add(c)}return o}function oi(l,s){for(var t,o=C(s);!(t=o()).done;)l.add(t.value)}function Ui(l,s){if(l.size!==s.size)return!1;for(var t,o=C(l);!(t=o()).done;)if(!s.has(t.value))return!1;return!0}function ai(l,s){for(var e,o=[],t=C(l);!(e=t()).done;)for(var h,i=C(s(e.value));!(h=i()).done;)o.push(h.value);return o}function Yi(l,s,o){var t=l.get(s);t||l.set(s,t=new Set),t.add(o)}function An(l,s,o){var t=l.get(s);t||(t=new Array,l.set(s,t)),t.push(o)}function Ts(l,s,o){var t=l.get(s);t||l.set(s,t=new Set),t.add(o)}function ah(l,s,o){Ts(l,new ue(s[0],s[1]),o)}function Os(l,s,o){!function(l,s,o){var t=l.get(s);t&&t.delete(o)}(l,new ue(s[0],s[1]),o)}var ye=ie(92985),Mt=function(){function l(){}return l.assert=function(o,t){if(void 0===t&&(t=null),!o)throw null!=t?new Error(t):new Error("condition does not hold")},l}();function Xe(l){if(void 0===l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}function Go(){Go=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Qr,As=function(){function l(){this.attrs=[],this._parent=null}var s=l.prototype;return s.addEvent=function(t){this.events.push(t)},s.removeEvent=function(t){var e=this.events.indexOf(t);e>=0&&(this.events=this.events.splice(e,1))},s.raiseEvents=function(t){this.events.forEach(function(e){return e(t)})},s.clearAttr=function(){this.attrs=[]},s.setAttr=function(t,e){this.attrs[t]=e},s.getAttr=function(t){return this.attrs[t]},s.getAncestors=Go().mark(function o(){var t;return Go().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=this.parent;case 1:if(null==t){r.next=7;break}return r.next=4,t;case 4:t=t.parent,r.next=1;break;case 7:case"end":return r.stop()}},o,this)}),s.isDescendantOf=function(t){for(var r,e=C(this.getAncestors());!(r=e()).done;)if(r.value===t)return!0;return!1},Q(l,[{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}}]),l}();!function(l){l[l.None=0]="None",l[l.FromAncestor=1]="FromAncestor",l[l.ToAncestor=2]="ToAncestor"}(Qr||(Qr={}));var ks=function(l){function s(t,e){var r;return(r=l.call(this)||this).source=t,r.target=e,t!==e?(t.outEdges.add(Xe(r)),e.inEdges.add(Xe(r))):t.selfEdges.add(Xe(r)),r}X(s,l);var o=s.prototype;return o.add=function(){this.source!==this.target?(this.source.outEdges.add(this),this.target.inEdges.add(this)):this.source.selfEdges.add(this)},o.remove=function(){this.source!==this.target?(this.source.outEdges.delete(this),this.target.inEdges.delete(this)):this.source.selfEdges.delete(this)},o.toString=function(){return"("+this.source.toString()+"->"+this.target.toString()+")"},o.isInterGraphEdge=function(){return this.source.parent!==this.target.parent},o.EdgeToAncestor=function(){return this.source instanceof De&&this.target.isDescendantOf(this.source)?Qr.FromAncestor:this.target instanceof De&&this.source.isDescendantOf(this.target)?Qr.ToAncestor:Qr.None},s}(As);function No(){No=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Fo=function(l){function s(t){var e;return(e=l.call(this)||this).inEdges=new Set,e.outEdges=new Set,e.selfEdges=new Set,e.id=t,e}X(s,l);var o=s.prototype;return o.removeOutEdge=function(e){this.outEdges.delete(e)},o.removeInEdge=function(e){this.inEdges.delete(e)},o.toString=function(){return this.id},o._edges=No().mark(function t(){var e,r,i,h,c,f,p,y,m;return No().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:e=C(this.inEdges);case 1:if((r=e()).done){L.next=7;break}return i=r.value,L.next=5,i;case 5:L.next=1;break;case 7:h=C(this.outEdges);case 8:if((c=h()).done){L.next=14;break}return f=c.value,L.next=12,f;case 12:L.next=8;break;case 14:p=C(this.selfEdges);case 15:if((y=p()).done){L.next=21;break}return m=y.value,L.next=19,m;case 19:L.next=15;break;case 21:case"end":return L.stop()}},t,this)}),Q(s,[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"edges",get:function(){return this._edges()}},{key:"outDegree",get:function(){return this.outEdges.size}},{key:"inDegree",get:function(){return this.inEdges.size}},{key:"selfDegree",get:function(){return this.selfEdges.size}},{key:"degree",get:function(){return this.outDegree+this.inDegree+this.selfDegree}}]),s}(As);function Xr(){Xr=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var uh=function(){function l(){this.nodeMap=new Map}var s=l.prototype;return s.remove=function(t){this.nodeMap.delete(t.id)},s.nodes_=Xr().mark(function o(){var t,e,r;return Xr().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:t=C(this.nodeMap.values());case 1:if((e=t()).done){h.next=7;break}return r=e.value,h.next=5,r;case 5:h.next=1;break;case 7:case"end":return h.stop()}},o,this)}),s.graphs_=Xr().mark(function o(){var t,e,r;return Xr().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:t=C(this.nodes_());case 1:if((e=t()).done){h.next=8;break}if(!((r=e.value)instanceof De)){h.next=6;break}return h.next=6,r;case 6:h.next=1;break;case 8:case"end":return h.stop()}},o,this)}),s.findShallow=function(t){return this.nodeMap.get(t)},s._edges=Xr().mark(function o(){var t,e,r,i,h,c,f,p,y;return Xr().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:t=C(this.nodeMap.values());case 1:if((e=t()).done){P.next=19;break}i=C((r=e.value).outEdges);case 4:if((h=i()).done){P.next=10;break}return c=h.value,P.next=8,c;case 8:P.next=4;break;case 10:f=C(r.selfEdges);case 11:if((p=f()).done){P.next=17;break}return y=p.value,P.next=15,y;case 15:P.next=11;break;case 17:P.next=1;break;case 19:case"end":return P.stop()}},o,this)}),s.interGraphEdges=function(){throw new Error("not implemented")},s.addNode=function(t){this.nodeMap.set(t.id,t)},s.nodeIsConsistent=function(t){for(var r,e=C(t.outEdges);!(r=e()).done;){var i=r.value;if(i.source!==t||i.source===i.target)return!1}for(var c,h=C(t.inEdges);!(c=h()).done;){var f=c.value;if(f.target!==t||f.source===f.target)return!1}for(var y,p=C(t.selfEdges);!(y=p()).done;){var m=y.value;if(m.target!==m.source||m.source!==t)return!1}return!0},s.isConsistent=function(){for(var e,t=C(this.nodeMap.values());!(e=t()).done;)if(!this.nodeIsConsistent(e.value))return!1;return!0},Q(l,[{key:"size",get:function(){return this.nodeMap.size}},{key:"nodesShallow",get:function(){return this.nodes_()}},{key:"graphs",get:function(){return this.graphs_()}},{key:"nodeShallowCount",get:function(){return this.nodeMap.size}},{key:"edgeCount",get:function(){for(var r,t=0,e=C(this.nodeMap.values());!(r=e()).done;){var i=r.value;t+=i.outDegree+i.selfDegree}return t}},{key:"edges",get:function(){return this._edges()}}]),l}(),lh=Bt().mark(Rs);function Bt(){Bt=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var De=function(l){function s(t){var e;return void 0===t&&(t="__graph__"),(e=l.call(this,t)||this).nodeCollection=new uh,e}X(s,l);var o=s.prototype;return o.remove=function(e){this.nodeCollection.remove(e)},o.removeSubgraph=function(){var e=this.parent;e&&e.removeNode(this);for(var i,r=C(this.outGoingEdges());!(i=r()).done;){var h=i.value;h.attachedAtSource?h.node.removeOutEdge(h.edge):h.node.removeInEdge(h.edge)}},o.outGoingEdges=Bt().mark(function t(){var e,r,i,h,c,f,p,y,m,P,L,E,S,T,O,x,B,M,F;return Bt().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:e=C(this.outEdges);case 1:if((r=e()).done){z.next=9;break}if(this.isAncestor(h=(i=r.value).target)){z.next=7;break}return z.next=7,{edge:i,node:h,attachedAtSource:!1};case 7:z.next=1;break;case 9:c=C(this.inEdges);case 10:if((f=c()).done){z.next=18;break}if(this.isAncestor(y=(p=f.value).source)){z.next=16;break}return z.next=16,{edge:p,node:y,attachedAtSource:!0};case 16:z.next=10;break;case 18:m=C(this.nodesBreadthFirst);case 19:if((P=m()).done){z.next=45;break}E=C((L=P.value).outEdges);case 22:if((S=E()).done){z.next=32;break}if((O=(T=S.value).target)!==this){z.next=27;break}return z.abrupt("continue",30);case 27:if(this.isAncestor(O)){z.next=30;break}return z.next=30,{edge:T,node:O,attachedAtSource:!1};case 30:z.next=22;break;case 32:x=C(L.inEdges);case 33:if((B=x()).done){z.next=43;break}if((F=(M=B.value).source)!==this){z.next=38;break}return z.abrupt("continue",41);case 38:if(this.isAncestor(F)){z.next=41;break}return z.next=41,{edge:M,node:F,attachedAtSource:!0};case 41:z.next=33;break;case 43:z.next=19;break;case 45:case"end":return z.stop()}},t,this)}),o.isAncestor=function(e){for(var i,r=C(e.getAncestors());!(i=r()).done;)if(i.value===this)return!0;return!1},o.getClusteredConnectedComponents=Bt().mark(function t(){var e,r,i,h,c,f,p,y,m,P;return Bt().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:e=new Set,r=new ye.c,i=C(this.nodesBreadthFirst);case 3:if((h=i()).done){E.next=15;break}if(!e.has(c=h.value)){E.next=7;break}return E.abrupt("continue",13);case 7:e.add(c),r.enqueue(c),f=new Set;do{for((p=r.dequeue()).parent===this&&f.add(p),y=C(this.reachableFrom(p));!(m=y()).done;)e.has(P=m.value)||(e.add(P),r.enqueue(P))}while(r.length>0);return E.next=13,Array.from(f);case 13:E.next=3;break;case 15:case"end":return E.stop()}},t,this)}),o.reachableFrom=Bt().mark(function t(e){var r,i,h,c,f,p;return Bt().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:r=C(e.outEdges);case 1:if((i=r()).done){m.next=7;break}return h=i.value,m.next=5,h.target;case 5:m.next=1;break;case 7:c=C(e.inEdges);case 8:if((f=c()).done){m.next=14;break}return p=f.value,m.next=12,p.source;case 12:m.next=8;break;case 14:if(!(e instanceof s)){m.next=16;break}return m.delegateYield(e.shallowNodes,"t0",16);case 16:if(e.parent==this){m.next=19;break}return m.next=19,e.parent;case 19:case"end":return m.stop()}},t,this)}),o.hasSomeAttrOnIndex=function(e){for(var i,r=C(this.nodesBreadthFirst);!(i=r()).done;)if(i.value.getAttr(e))return!0;for(var f,c=C(this.deepEdges);!(f=c()).done;)if(f.value.getAttr(e))return!0;return!1},o.graphs=Bt().mark(function t(){var e,r,i;return Bt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.nodeCollection.graphs);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i;case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.noEmptySubgraphs=function(){for(var r,e=C(this.subgraphsBreadthFirst());!(r=e()).done;)if(0===r.value.shallowNodeCount)return!1;return!0},o.hasSubgraphs=function(){for(var r,e=C(this.shallowNodes);!(r=e()).done;)if(r.value instanceof s)return!0;return!1},o.subgraphsBreadthFirst=Bt().mark(function t(){var e,r,i;return Bt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.nodesBreadthFirst);case 1:if((r=e()).done){c.next=8;break}if(!((i=r.value)instanceof s)){c.next=6;break}return c.next=6,i;case 6:c.next=1;break;case 8:case"end":return c.stop()}},t,this)}),o.isEmpty=function(){return 0===this.shallowNodeCount},o.setEdge=function(e,r){var i=this.nodeCollection.findShallow(e);if(null!=i){var h=this.nodeCollection.findShallow(r);if(null!=h)return new ks(i,h)}},o.nodesBreadthFirst_=Bt().mark(function t(){var e,r,i;return Bt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.nodeCollection.nodesShallow);case 1:if((r=e()).done){c.next=9;break}return i=r.value,c.next=5,i;case 5:if(!(i instanceof s)){c.next=7;break}return c.delegateYield(i.nodesBreadthFirst,"t0",7);case 7:c.next=1;break;case 9:case"end":return c.stop()}},t,this)}),o.findNodeRecursive=function(e){var r=this.nodeCollection.findShallow(e);if(r)return r;for(var h,i=C(this.shallowNodes);!(h=i()).done;){var c=h.value;if(c instanceof s){var f=c.findNodeRecursive(e);if(f)return f}}return null},o.findNode=function(e){return this.nodeCollection.findShallow(e)},o.deepEdgesIt=Bt().mark(function t(){var e,r,i,h,c,f,p,y,m,P,L,E;return Bt().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:e=C(this.nodesBreadthFirst);case 1:if((r=e()).done){T.next=27;break}h=C((i=r.value).outEdges);case 4:if((c=h()).done){T.next=10;break}return f=c.value,T.next=8,f;case 8:T.next=4;break;case 10:p=C(i.selfEdges);case 11:if((y=p()).done){T.next=17;break}return m=y.value,T.next=15,m;case 15:T.next=11;break;case 17:P=C(i.inEdges);case 18:if((L=P()).done){T.next=25;break}if(this.isAncestor((E=L.value).source)){T.next=23;break}return T.next=23,E;case 23:T.next=18;break;case 25:T.next=1;break;case 27:case"end":return T.stop()}},t,this)}),o.isConsistent=function(){return this.parent?this.parent.isConsistent():this.eachNodeIdIsUnique()&&this.nodeCollection.isConsistent()},o.nodeIsConsistent=function(e){return this.nodeCollection.nodeIsConsistent(e)},o.removeNode=function(e){for(var i,r=C(e.outEdges);!(i=r()).done;){var h=i.value;h.target.inEdges.delete(h)}for(var f,c=C(e.inEdges);!(f=c()).done;){var p=f.value;p.source.outEdges.delete(p)}this.nodeCollection.remove(e);for(var m,y=C(this.subgraphsBreadthFirst());!(m=y()).done;)m.value.removeNode(e)},o.addNode=function(e){return Mt.assert(null==this.findNodeRecursive(e.id)),e.parent=this,this.nodeCollection.addNode(e),e},o.liftNode=function(e){for(;null!=e&&e.parent!==this;)e=e.parent;return e},o.eachNodeIdIsUnique=function(){for(var i,e=new Set,r=C(this.nodesBreadthFirst);!(i=r()).done;){var h=i.value;if(e.has(h.id))return!1;e.add(h.id)}return!0},o.allElements=Bt().mark(function t(){var e,r,i,h,c,f,p,y,m,P,L,E;return Bt().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:e=C(this.allSuccessorsWidthFirst());case 1:if((r=e()).done){T.next=29;break}return i=r.value,T.next=5,i;case 5:h=C(i.selfEdges);case 6:if((c=h()).done){T.next=12;break}return f=c.value,T.next=10,f;case 10:T.next=6;break;case 12:p=C(i.outEdges);case 13:if((y=p()).done){T.next=19;break}return m=y.value,T.next=17,m;case 17:T.next=13;break;case 19:P=C(i.inEdges);case 20:if((L=P()).done){T.next=27;break}if(this.isAncestor((E=L.value).source)){T.next=25;break}return T.next=25,E;case 25:T.next=20;break;case 27:T.next=1;break;case 29:return T.delegateYield(this.edges,"t0",30);case 30:case"end":return T.stop()}},t,this)}),o.allSuccessorsWidthFirst=Bt().mark(function t(){var e,r,i,h,c,f;return Bt().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.shallowNodes);case 1:if((r=e()).done){y.next=7;break}return i=r.value,y.next=5,i;case 5:y.next=1;break;case 7:h=C(this.shallowNodes);case 8:if((c=h()).done){y.next=14;break}if(!((f=c.value)instanceof s)){y.next=12;break}return y.delegateYield(f.allSuccessorsWidthFirst(),"t0",12);case 12:y.next=8;break;case 14:case"end":return y.stop()}},t,this)}),o.allSuccessorsDepthFirst=Bt().mark(function t(){var e,r,i;return Bt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.shallowNodes);case 1:if((r=e()).done){c.next=9;break}if(!((i=r.value)instanceof s)){c.next=5;break}return c.delegateYield(i.allSuccessorsDepthFirst(),"t0",5);case 5:return c.next=7,i;case 7:c.next=1;break;case 9:case"end":return c.stop()}},t,this)}),Q(s,[{key:"shallowNodes",get:function(){return this.nodeCollection.nodesShallow}},{key:"nodesBreadthFirst",get:function(){return this.nodesBreadthFirst_()}},{key:"shallowEdges",get:function(){return this.nodeCollection.edges}},{key:"deepEdges",get:function(){return this.deepEdgesIt()}},{key:"shallowNodeCount",get:function(){return this.nodeCollection.nodeShallowCount}},{key:"nodeCountDeep",get:function(){for(var i,e=this.nodeCollection.size,r=C(this.shallowNodes);!(i=r()).done;){var h=i.value;h instanceof s&&(e+=h.nodeCountDeep)}return e}},{key:"edgeCount",get:function(){return this.nodeCollection.edgeCount}},{key:"deepEdgesCount",get:function(){for(var i,e=0,r=C(this.nodesBreadthFirst);!(i=r()).done;){var h=i.value;e+=h.outDegree+h.selfDegree}return e}}]),s}(Fo);function Rs(l){var s,o,t,e,r,i,h,c,f,p,m,P;return Bt().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:P=function(T,O,x){x.has(T)||(O.enqueue(T),x.add(T))},m=function(T){var O,x,B,M,F,A;return Bt().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:O=C(T.outEdges);case 1:if((x=O()).done){V.next=7;break}return B=x.value,V.next=5,B.target;case 5:V.next=1;break;case 7:M=C(T.inEdges);case 8:if((F=M()).done){V.next=14;break}return A=F.value,V.next=12,A.source;case 12:V.next=8;break;case 14:case"end":return V.stop()}},s)},s=Bt().mark(m),o=new Set,t=new ye.c,e=C(l.shallowNodes);case 6:if((r=e()).done){E.next=17;break}if(!o.has(i=r.value)){E.next=10;break}return E.abrupt("continue",15);case 10:for(h=new Array,P(i,t,o);t.length>0;)for(c=t.dequeue(),h.push(c),f=C(m(c));!(p=f()).done;)P(p.value,t,o);return E.next=15,h;case 15:E.next=6;break;case 17:case"end":return E.stop()}},lh)}function Bo(l,s){return s.has(l.source)&&s.has(l.target)}function ur(){ur=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var je=function(l){function s(){var t;return(t=l.apply(this,arguments)||this).padding=1,t}X(s,l);var o=s.prototype;return o.clone=function(){var e=new s(null);return this.boundaryCurve&&(e.boundaryCurve=this.boundaryCurve.clone()),e},o.translate=function(e){0===e.x&&0===e.y||this.boundaryCurve.translate(e)},o.toJSON=function(){return{boundaryCurve:this.boundaryCurve,padding:this.padding}},o.toString=function(){return this.id},s.mkNode=function(e,r){var i=new s(r);return i.boundaryCurve=e,i},o.fitBoundaryCurveToTarget=function(e){if(null!=this.boundaryCurve){var r=te.isRoundedRect(this.boundaryCurve);null==r?(this.boundaryCurve=this.boundaryCurve.scaleFromOrigin(e.width/this.boundaryCurve.boundingBox.width,e.height/this.boundaryCurve.boundingBox.height),this.boundaryCurve.translate(e.center.sub(this.boundaryCurve.boundingBox.center))):this.boundaryCurve=te.mkRectangleWithRoundedCorners(e.width,e.height,r.radX,r.radY,e.center)}},s.getGeom=function(e){return e.getAttr(rt.GeomObjectIndex)},o.inEdges=ur().mark(function t(){var e,r,i;return ur().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.node.inEdges);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.outEdges=ur().mark(function t(){var e,r,i;return ur().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.node.outEdges);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.selfEdges=ur().mark(function t(){var e,r,i;return ur().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.node.selfEdges);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.transform=function(e){null!=this.boundaryCurve&&(this.boundaryCurve=this.boundaryCurve.transform(e))},o.underCollapsedGraph=function(){var e=this.node.parent;if(null==e)return!1;var r=at.getGeom(e);return null!=r&&(!!r.isCollapsed||r.underCollapsedGraph())},o.getAncestors=ur().mark(function t(){var e,r,i;return ur().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.node.getAncestors());case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),Q(s,[{key:"node",get:function(){return this.entity}},{key:"boundaryCurve",get:function(){return this._boundaryCurve},set:function(e){null!=e&&e.boundingBox&&(e.boundingBox.height<s.minHeight||e.boundingBox.width<s.minWidth)&&(e=te.mkCircle(s.minWidth,e.boundingBox.center)),this._boundaryCurve=e}},{key:"id",get:function(){return this.node.id}},{key:"center",get:function(){return this.boundaryCurve.boundingBox.center},set:function(e){var r=e.sub(this.center);this.boundaryCurve.translate(r)}},{key:"boundingBoxWithPadding",get:function(){var e=this.boundingBox.clone();return e.pad(this.padding),e}},{key:"boundingBox",get:function(){return this.boundaryCurve?this.boundaryCurve.boundingBox:null},set:function(e){this.boundaryCurve&&(Math.abs(e.width-this.width)<1e-4&&Math.abs(e.height-this.height)<1e-4?this.center=e.center:this.fitBoundaryCurveToTarget(e))}},{key:"width",get:function(){return this.boundaryCurve.boundingBox.width}},{key:"height",get:function(){return this.boundaryCurve.boundingBox.height}}]),s}(at);je.minHeight=2,je.minWidth=3;var Vt=function(){function l(o){this.cancelToken=o}return l.prototype.ProgressStep=function(){},l}(),si=function(){};si.GoldenRatio=(1+Math.sqrt(5))/2,si.GoldenRatioRemainder=2-si.GoldenRatio;var Gs=function(l){function s(t,e){var r;return(r=l.call(this,null)||this).desiredAspectRatio=1.2,r.bestPacking=null,r.cachedCosts=new Map,r.rectangles=t,r.desiredAspectRatio=e,r}X(s,l);var o=s.prototype;return o.Pack=function(e,r,i){var h=this,c=s.GetGoldenSectionStep(e,r),f=Math.max(i/10,(r-e)/s.MaxSteps);r+=f,this.bestPackingCost=Number.MAX_VALUE,1===this.rectangles.length?this.PackLimit(e):2===this.rectangles.length?(this.PackLimit(e),this.PackLimit(r)):this.rectangles.length>2&&s.GoldenSectionSearch(function(m){return h.PackLimit(m)},e,c,r,f);for(var p=this.bestPacking.getRects(),y=0;y<this.rectangles.length;y++)this.rectangles[y]=p[y]},o.PackLimit=function(e){var r=this.cachedCosts.get(e);if(null==r){var i=this.createPacking(this.rectangles,e);i.run(),this.cachedCosts.set(e,r=Math.abs(i.PackedAspectRatio-this.desiredAspectRatio)),r<this.bestPackingCost&&(this.bestPackingCost=r,this.bestPacking=i)}return r},s.GoldenSectionSearch=function(e,r,i,h,c){if(Math.abs(r-h)<c)return e(r)<e(h)?r:h;var f=s.GetGoldenSectionStep(i,h),p=e(i),y=e(f),m=function(){return s.GoldenSectionSearch(e,f,i,r,c)},P=function(){return s.GoldenSectionSearch(e,i,f,h,c)};if(y<p)return P();if(y>p)return m();var L=P(),E=m();return e(E)<e(L)?E:L},s.GetGoldenSectionStep=function(e,r){return e<r?e+si.GoldenRatioRemainder*(r-e):e-si.GoldenRatioRemainder*(e-r)},Q(s,[{key:"PackedWidth",get:function(){return null!=this.bestPacking?this.bestPacking.PackedWidth:0}},{key:"PackedHeight",get:function(){return null!=this.bestPacking?this.bestPacking.PackedHeight:0}}]),s}(Vt);Gs.MaxSteps=1e3;var hh=function(l){function s(){return l.apply(this,arguments)||this}return X(s,l),s.prototype.getRects=function(){for(var i,e=[],r=C(this.rectsToCenters);!(i=r()).done;){var h=i.value,c=h[0];c.center=h[1],e.push(c)}return e},Q(s,[{key:"PackedWidth",get:function(){return this.packedWidth},set:function(e){this.packedWidth=e}},{key:"PackedHeight",get:function(){return this.packedHeight},set:function(e){this.packedHeight=e}},{key:"PackedAspectRatio",get:function(){return this.PackedWidth/this.PackedHeight}}]),s}(Vt),Ns=function(l){function s(t,e,r){var i;return void 0===r&&(r=!1),(i=l.call(this,null)||this).rectsToCenters=new Map,i.rectanglesByDescendingHeight=r?t:s.SortRectangles(t),i.wrapWidth=e,i}X(s,l),s.SortRectangles=function(e){return e.sort(function(r,i){return i.height-r.height}),e};var o=s.prototype;return o.run=function(){this.Pack()},o.Pack=function(){this.PackedWidth=0,this.PackedHeight=0;for(var e=new jt.K,r=!1,i=0,h=0,c=0,f=this.rectanglesByDescendingHeight,p=0;r||p<f.length;){var y=f[p],m=e.length>0?e.top:null;if(null==m||m.right+y.width<=this.wrapWidth&&i+y.height<=m.top){var L=new R(m?m.right:0,i).add(new R(y.width/2,y.height/2));y.center=L,this.rectsToCenters.set(y,L),h=Math.max(h,y.right),c=Math.max(c,y.top),e.push(y),r=!1}else i=m.top,e.pop(),r=!0;r||p++}this.PackedWidth=h,this.PackedHeight=c},s}(hh),Fs=function(l){function s(t,e){var r;return(r=l.call(this,Ns.SortRectangles(t),e)||this).createPacking=function(i,h){return new Ns(i,h,!0)},r}return X(s,l),s.prototype.run=function(){for(var c,e=Number.MAX_VALUE,r=0,i=0,h=C(this.rectangles);!(c=h()).done;){var p=c.value.width;i+=p,e=Math.min(e,p),r=Math.max(r,p)}this.Pack(r,i,e)},s}(Gs);function Mo(){Mo=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}function ui(l){return new Qi(Ht(l.map(function(s){return Qt(s[1],s[0])})))}function Bs(l){for(var s=l.Parent;null!=s;s=s.Parent)s.Count--,s.irect=s.Left.irect.add_rect(s.Right.irect)}function Ms(l){return 2*l.Left.Count>=l.Right.Count&&2*l.Right.Count>=l.Left.Count}function Vo(l,s,o,t){return!l.irect.intersects_rect(s)||(l.IsLeaf?!t(l.UserData)||0!=--o.bound:Vo(l.Left,s,o,t)&&Vo(l.Right,s,o,t))}var Qi=function(){function l(o){this._rootNode=o}var s=l.prototype;return s.clear=function(){this.RootNode=null},s.NumberOfIntersectedIsLessThanBound=function(t,e,r){return Vo(this._rootNode,t,{bound:e},r)},s.GetAllLeaves=Mo().mark(function o(){var t,e,r;return Mo().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(null!=this._rootNode&&this.Count>0)){h.next=8;break}t=C(this._rootNode.GetAllLeaves());case 2:if((e=t()).done){h.next=8;break}return r=e.value,h.next=6,r;case 6:h.next=2;break;case 8:case"end":return h.stop()}},o,this)}),s.Add=function(t,e){this.AddNode(Qt(e,t))},s.AddNode=function(t){null==this._rootNode?this._rootNode=t:this.Count<=2?this._rootNode=Ht(Array.from(this._rootNode.GetAllLeafNodes()).concat([t])):this.AddNodeToTreeRecursive(t,this._rootNode)},s.Rebuild=function(){this._rootNode=Ht(Array.from(this._rootNode.GetAllLeafNodes()))},s.AddNodeToTreeRecursive=function(t,e){var r,i;if(e.IsLeaf)e.Left=Qt(e.UserData,e.irect),e.Right=t,e.Count=2;else if(e.Count++,2*e.Left.Count<e.Right.Count)this.AddNodeToTreeRecursive(t,e.Left),e.Left.irect=e.Left.irect.add_rect(t.irect);else if(2*e.Right.Count<e.Left.Count)this.AddNodeToTreeRecursive(t,e.Right),e.Right.irect=e.Right.irect.add_rect(t.irect);else{var h=(r=e.Left.irect.add_rect(t.irect)).area-e.Left.irect.area,c=(i=e.Right.irect.add_rect(t.irect)).area-e.Right.irect.area;h<c?(this.AddNodeToTreeRecursive(t,e.Left),e.Left.irect=r):h>c?(this.AddNodeToTreeRecursive(t,e.Right),e.Right.irect=i):r.area<i.area?(this.AddNodeToTreeRecursive(t,e.Left),e.Left.irect=r):(this.AddNodeToTreeRecursive(t,e.Right),e.Right.irect=i)}e.irect=e.Left.irect.add_rect(e.Right.irect)},s.GetAllIntersecting=function(t){return null==this._rootNode||0===this.Count?[]:Array.from(this._rootNode.GetNodeItemsIntersectingRectangle(t))},s.OneIntersecting=function(t){if(null!=this._rootNode&&0!==this.Count){var e=this._rootNode.FirstIntersectedNode(t);if(null!=e)return{intersectedLeaf:e.UserData}}},s.GetAllLeavesIntersectingRectangle=function(t){return null==this._rootNode||0===this.Count?[]:this._rootNode.GetLeafRectangleNodesIntersectingRectangle(t)},s.IsIntersecting=function(t){if(null==this._rootNode||0===this.Count)return!1;for(var e=C(this._rootNode.GetNodeItemsIntersectingRectangle(t));!e().done;)return!0;return!1},s.Contains=function(t,e){if(null==this._rootNode)return!1;for(var i,r=C(this._rootNode.GetLeafRectangleNodesIntersectingRectangle(t));!(i=r()).done;)if(i.value.UserData===e)return!0;return!1},s.Remove=function(t,e){if(null!=this._rootNode){for(var h,r=void 0,i=C(this._rootNode.GetLeafRectangleNodesIntersectingRectangle(t));!(h=i()).done;){var c=h.value;c.UserData===e&&(r=c)}if(null!=r)return 1===this.RootNode.Count?this.RootNode=null:this.RemoveLeaf(r),r.UserData}},s.RemoveLeaf=function(t){var e=function(l){for(var s=l.Parent;null!=s;s=s.Parent)if(!Ms(s))return s;return null}(t);if(null!=e)(function(l,s){for(var e,o=new Array,t=C(l.GetAllLeafNodes());!(e=t()).done;){var r=e.value;r!==s&&o.push(r)}var i=Ht(o);l.Count=i.Count,l.Left=i.Left,l.Right=i.Right,l.irect=i.Left.irect.add_rect(i.Right.irect)})(e,t),Bs(e);else{var r=t.Parent;null==r?this._rootNode=new Ro:(function(l,s){l.UserData=s.UserData,l.Left=s.Left,l.Right=s.Right,l.Count--,l.irect=s.irect}(r,t.IsLeftChild?r.Right:r.Left),Bs(r))}},s.UnbalancedNode=function(t){for(var e=t.Parent;null!=e;e=e.Parent)if(!Ms(e))return e;return null},Q(l,[{key:"RootNode",get:function(){return this._rootNode},set:function(t){this._rootNode=t}},{key:"Count",get:function(){return null==this._rootNode?0:this._rootNode.Count}}]),l}(),vh=function(l){function s(t){var e;return(e=l.call(this,t)||this).radX=t.radX,e.radY=t.radY,e.roundedRect_=te.mkRectangleWithRoundedCorners(e.width,e.height,t.radX,t.radY,e.center),e}X(s,l);var o=s.prototype;return o.onUpdated=function(){this.isEmpty||(this.roundedRect_=te.mkRectangleWithRoundedCorners(this.width,this.height,this.radX,this.radY,this.center))},o.isOk=function(){return!!this.isEmpty()||this.roundedRect_.boundingBox.equalEps(this)},o.setRect=function(e){this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.isEmpty()||(this.roundedRect_=te.mkRectangleWithRoundedCorners(e.width,e.height,this.radX,this.radY,this.center))},s}(lt);function Xt(){Xt=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}function ph(l,s){var o=s.map(function(y){return[y,y.boundingBox]}),t=o.map(function(y){return y[1]}),e=new Fs(t,1.5);e.run();for(var i,r=C(o);!(i=r()).done;){var h=i.value,c=h[0],p=h[1].leftBottom.sub(c.boundingBox.leftBottom);c.translate(p)}l.boundingBox=new lt({left:0,bottom:0,right:e.PackedWidth,top:e.PackedHeight})}var Ae=function(l){function s(t){var e;return(e=l.call(this,t)||this).margins={left:10,top:10,bottom:10,right:10},e.radX=10,e.radY=10,e.rrect=new vh({left:0,right:-1,top:20,bottom:0,radX:e.radX,radY:e.radY}),e}X(s,l);var o=s.prototype;return o.isAncestor=function(e){return this.graph.isAncestor(e.node)},o.deepTranslate=function(e){for(var i,r=C(this.nodesBreadthFirst);!(i=r()).done;){var h=i.value;h instanceof s?h.boundingBox=h.boundingBox.translate(e):h.translate(e);for(var f,c=C(h.selfEdges());!(f=c()).done;)f.value.translate(e);for(var m,y=C(h.outEdges());!(m=y()).done;){var P=m.value;this.graph.isAncestor(P.target.node)&&P.translate(e)}}this.boundingBox=this.boundingBox.translate(e)},o.clone=function(){var e=new s(null);return e.boundingBox=this.boundingBox.clone(),e.layoutSettings=this.layoutSettings,e.margins=this.margins,e.radX=this.radX,e.radY=this.radY,e},o.calculateBoundsFromChildren=function(){for(var i,e=lt.mkEmpty(),r=C(this.shallowNodes);!(i=r()).done;)e.addRecSelf(i.value.boundingBoxWithPadding);return e.padEverywhere(this.margins),e},o.allSuccessorsWidthFirst=Xt().mark(function t(){var e,r,i;return Xt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.graph.allSuccessorsWidthFirst());case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,je.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),s.getGeom=function(e){return at.getGeom(e)},o.edgeCurveOrArrowheadsIntersectRect=function(e,r){for(var h,i=C(e.sourceArrowheadPoints(25));!(h=i()).done;)if(r.contains(h.value))return!0;for(var p,f=C(e.targetArrowheadPoints(25));!(p=f()).done;)if(r.contains(p.value))return!0;var m=e.curve,P=r.perimeter();return null!=K.intersectionOne(m,P,!1)||K.PointRelativeToCurveLocation(m.start,P)===ht.Inside},o.isEmpty=function(){return this.graph.isEmpty()},o.setSettingsRecursively=function(e){this.layoutSettings=e;for(var i,r=C(this.nodesBreadthFirst);!(i=r()).done;)i.value.layoutSettings=e},o.transform=function(e){if(!e.isIdentity()){for(var i,r=C(this.shallowNodes);!(i=r()).done;)i.value.transform(e);for(var f,c=C(this.shallowEdges);!(f=c()).done;){var p=f.value;p.transform(e),p.label&&p.label.transform(e)}this.boundingBox=null==this.rrect||this.rrect.isEmpty()?this.pumpTheBoxToTheGraphWithMargins():this.boundingBox.transform(e)}},o.translate=function(e){0===e.x&&0===e.y||this.deepTranslate(e)},o.nodesBreadthFirstIter=Xt().mark(function t(){var e,r,i;return Xt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.graph.nodesBreadthFirst);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.setEdge=function(e,r){var i=this.graph.setEdge(e,r);return new sr(i)},o.getPumpedGraphWithMarginsBox=function(){var e={b:lt.mkEmpty()};return Do(this,e),e.b.padEverywhere(this.margins),e.b},o.pumpTheBoxToTheGraphWithMargins=function(){return this.boundingBox=this.getPumpedGraphWithMarginsBox()},o.CheckClusterConsistency=function(){throw new Error("Method not implemented.")},o.shallowNodes_=Xt().mark(function t(){var e,r,i;return Xt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.graph.shallowNodes);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.deepEdgesIt=Xt().mark(function t(){var e,r,i;return Xt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.graph.deepEdges);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.shallowEdgesIt=Xt().mark(function t(){var e,r,i;return Xt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.graph.shallowEdges);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),s.mk=function(e,r){void 0===r&&(r=new ar(0,0));var i=new s(new De(e));return i.labelSize=r,i},o.subgraphs=Xt().mark(function t(){var e,r,i;return Xt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.graph.subgraphsBreadthFirst());case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,at.getGeom(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),s.mkWithGraphAndLabel=function(e,r){var i=new s(e);return i.labelSize=r,i},o.getSubgraphsDepthFirst=Xt().mark(function t(){var e,r,i;return Xt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.graph.allSuccessorsDepthFirst());case 1:if((r=e()).done){c.next=8;break}if(!((i=r.value)instanceof De)){c.next=6;break}return c.next=6,s.getGeom(i);case 6:c.next=1;break;case 8:case"end":return c.stop()}},t,this)}),o.liftNode=function(e){var r=this.graph.liftNode(e.node);return r?at.getGeom(r):null},o.findNode=function(e){var r=this.graph.findNode(e);return r?at.getGeom(r):null},o.addNode=function(e){return this.graph.addNode(e.node),e},o.addLabelToGraphBB=function(e){this.labelSize&&(e.top+=this.labelSize.height+2,e.width<this.labelSize.width&&(e.width=this.labelSize.width))},Q(s,[{key:"layoutSettings",get:function(){return this._layoutSettings},set:function(e){this._layoutSettings=e}},{key:"labelSize",get:function(){return this._labelSize},set:function(e){this._labelSize=e}},{key:"boundingBox",get:function(){return this.rrect?this.rrect.clone():null},set:function(e){e?this.rrect.setRect(e):this.rrect.roundedRect_=null}},{key:"nodesBreadthFirst",get:function(){return this.nodesBreadthFirstIter()}},{key:"center",get:function(){return this.boundingBox||this.boundingBox.isEmpty?this.boundingBox.center:new R(0,0)},set:function(e){var r=e.sub(this.center),i=new Ve(1,0,r.x,0,1,r.y);this.transform(i)}},{key:"left",get:function(){return this.boundingBox.left}},{key:"right",get:function(){return this.boundingBox.right}},{key:"top",get:function(){return this.boundingBox.top}},{key:"bottom",get:function(){return this.boundingBox.bottom}},{key:"edgeCount",get:function(){return this.graph.edgeCount}},{key:"boundaryCurve",get:function(){return this.rrect.roundedRect_},set:function(e){throw new Error}},{key:"shallowNodes",get:function(){return this.shallowNodes_()}},{key:"deepEdges",get:function(){return this.deepEdgesIt()}},{key:"shallowEdges",get:function(){return this.shallowEdgesIt()}},{key:"Clusters",get:function(){return this.subgraphs()}},{key:"deepNodeCount",get:function(){for(var e=0,r=C(this.graph.nodesBreadthFirst);!r().done;)e++;return e}},{key:"subgraphsDepthFirst",get:function(){return this.getSubgraphsDepthFirst()}},{key:"uniformMargins",get:function(){return Math.max(this.margins.left,this.margins.right,this.margins.right,this.margins.bottom)},set:function(e){this.margins.left=this.margins.right=this.margins.right=this.margins.bottom=e}},{key:"height",get:function(){return this.boundingBox.height}},{key:"width",get:function(){return this.boundingBox.width}},{key:"shallowNodeCount",get:function(){return this.graph.shallowNodeCount}},{key:"graph",get:function(){return this.entity}}]),s}(je);function Do(l,s){for(var t,o=C(l.shallowEdges);!(t=o()).done;){var e=t.value;if(p(e)&&(s.b.addRecSelf(e.curve.boundingBox),null!=e.edge.label)){var i=at.getGeom(e.edge.label);i&&s.b.addRecSelf(i.boundingBox)}}for(var c,h=C(l.shallowNodes);!(c=h()).done;){var f=c.value;"shallowEdges"in f&&Do(f,s),!f.underCollapsedGraph()&&f.boundingBox&&s.b.addRecSelf(f.boundingBox)}function p(y){if(null==y||null==y.curve||y.underCollapsedGraph())return!1;if(l instanceof Ae){var m=l.entity;return m.isAncestor(y.source.entity)&&m.isAncestor(y.target.entity)}return!0}l instanceof Ae&&l.addLabelToGraphBB(s.b)}function $r(){$r=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ee=function(l){function s(){this.size_=0,this.mapOfMaps=new Map}var o=s.prototype;return o.deleteP=function(e){return this.delete(e.x,e.y)},o.clear=function(){this.mapOfMaps.clear(),this.size_=0},o.setxy=function(e,r,i){var h=this.mapOfMaps.get(e);null==h&&this.mapOfMaps.set(e,h=new Map),h.has(r)||this.size_++,h.set(r,i)},o.set=function(e,r){this.setxy(e.x,e.y,r)},o.delete=function(e,r){var i=this.mapOfMaps.get(e);return null!=i&&(i.delete(r)&&this.size_--,!0)},o.hasxy=function(e,r){var i=this.mapOfMaps.get(e);return null!=i&&i.has(r)},o.has=function(e){return this.hasxy(e.x,e.y)},o.getxy=function(e,r){var i=this.mapOfMaps.get(e);if(null!=i)return i.get(r)},o.get=function(e){return this.getxy(e.x,e.y)},o.keys=$r().mark(function t(){var e,r,i,h,c,f;return $r().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.mapOfMaps);case 1:if((r=e()).done){y.next=12;break}h=C((i=r.value)[1]);case 4:if((c=h()).done){y.next=10;break}return f=c.value,y.next=8,new R(i[0],f[0]);case 8:y.next=4;break;case 10:y.next=1;break;case 12:case"end":return y.stop()}},t,this)}),o[l]=$r().mark(function t(){var e,r,i,h,c,f;return $r().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.mapOfMaps);case 1:if((r=e()).done){y.next=12;break}h=C((i=r.value)[1]);case 4:if((c=h()).done){y.next=10;break}return f=c.value,y.next=8,[new R(i[0],f[0]),f[1]];case 8:y.next=4;break;case 10:y.next=1;break;case 12:case"end":return y.stop()}},t,this)}),o.values=$r().mark(function t(){var e,r,h,c,f;return $r().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.mapOfMaps);case 1:if((r=e()).done){y.next=12;break}h=C(r.value[1]);case 4:if((c=h()).done){y.next=10;break}return f=c.value,y.next=8,f[1];case 8:y.next=4;break;case 10:y.next=1;break;case 12:case"end":return y.stop()}},t,this)}),Q(s,[{key:"size",get:function(){return this.size_}}]),s}(Symbol.iterator);function Jr(){Jr=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var li=function(l){function s(){this.size_=0,this.mapOfMaps=new Ee}var o=s.prototype;return o.clear=function(){this.mapOfMaps.clear(),this.size_=0},o.set=function(e,r){var i=e._first,h=e._second,c=this.mapOfMaps.get(i);null==c&&this.mapOfMaps.set(i,c=new Ee),c.has(h)||this.size_++,c.set(h,r)},o.delete=function(e){var i=e._second,h=this.mapOfMaps.get(e._first);null!=h&&h.deleteP(i)&&this.size_--},o.has=function(e){var r=this.mapOfMaps.get(e._first);return null!=r&&r.has(e._second)},o.getPP=function(e,r){return this.get(new ue(e,r))},o.get=function(e){var r=this.mapOfMaps.get(e._first);if(null!=r)return r.get(e._second)},o.keys=Jr().mark(function t(){var e,r,i,h,c,f;return Jr().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.mapOfMaps);case 1:if((r=e()).done){y.next=12;break}h=C((i=r.value)[1]);case 4:if((c=h()).done){y.next=10;break}return f=c.value,y.next=8,new ue(i[0],f[0]);case 8:y.next=4;break;case 10:y.next=1;break;case 12:case"end":return y.stop()}},t,this)}),o[l]=Jr().mark(function t(){var e,r,i,h,f,p,y,m,P;return Jr().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:e=C(this.mapOfMaps);case 1:if((r=e()).done){E.next=12;break}h=(i=r.value)[0],f=C(i[1]);case 4:if((p=f()).done){E.next=10;break}return m=(y=p.value)[0],P=y[1],E.next=8,[new ue(h,m),P];case 8:E.next=4;break;case 10:E.next=1;break;case 12:case"end":return E.stop()}},t,this)}),o.values=Jr().mark(function t(){var e,r,h,c,f;return Jr().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.mapOfMaps);case 1:if((r=e()).done){y.next=12;break}h=C(r.value[1]);case 4:if((c=h()).done){y.next=10;break}return f=c.value,y.next=8,f[1];case 8:y.next=4;break;case 10:y.next=1;break;case 12:case"end":return y.stop()}},t,this)}),Q(s,[{key:"size",get:function(){return this.size_}}]),s}(Symbol.iterator);function hi(){hi=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var gt,Xi=function(){function l(o){void 0===o&&(o=null),this.parents=new Set,this.children=new Set,this.ports=new Set,this.BoundaryCurve=o}l.mkShape=function(){return new l(null)};var s=l.prototype;return s.Descendants=hi().mark(function o(){var t,e,r,h,c,f;return hi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:for(t=new ye.c,e=C(this.Children);!(r=e()).done;)t.enqueue(r.value);case 2:if(!(t.length>0)){m.next=9;break}return h=t.dequeue(),m.next=6,h;case 6:for(c=C(h.Children);!(f=c()).done;)t.enqueue(f.value);m.next=2;break;case 9:case"end":return m.stop()}},o,this)}),s.Ancestors=hi().mark(function o(){var t,e,r,h,c,f;return hi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:for(t=new ye.c,e=C(this.Parents);!(r=e()).done;)t.enqueue(r.value);case 2:if(!(t.length>0)){m.next=9;break}return h=t.dequeue(),m.next=6,h;case 6:for(c=C(h.Parents);!(f=c()).done;)t.enqueue(f.value);m.next=2;break;case 9:case"end":return m.stop()}},o,this)}),s.AddParent=function(t){this.parents.add(t),t.children.add(this)},s.AddChild=function(t){t.parents.add(this),this.children.add(t)},s.RemoveChild=function(t){this.children.delete(t),t.parents.delete(this)},s.RemoveParent=function(t){this.parents.delete(t),t.children.delete(this)},s.ToString=function(){return this.UserData?this.UserData.toString():"null"},Q(l,[{key:"Parents",get:function(){return Array.from(this.parents.values())}},{key:"Children",get:function(){return Array.from(this.children.values())}},{key:"BoundaryCurve",get:function(){return this.boundaryCurve},set:function(t){this.boundaryCurve=t}},{key:"BoundingBox",get:function(){return this.BoundaryCurve.boundingBox}},{key:"Ports",get:function(){return this.ports}},{key:"IsGroup",get:function(){return this.children.size>0}}]),l}(),jo=function(){},ke=function(l){function s(t,e){var r;return(r=l.call(this)||this).curve=r.curve,r.location=e.clone(),r}return X(s,l),s.prototype.Translate=function(e){this.location=this.location.add(e)},Q(s,[{key:"Location",get:function(){return this.location},set:function(e){this.location=e}},{key:"Curve",get:function(){return this.curve},set:function(e){this.curve=e}}]),s}(jo),kn=function(l){function s(o,t,e){var r;return(r=l.call(this,null,t().add(e))||this).LocationOffset=e,r.CurveDelegate=o,r.CenterDelegate=t,r}return X(s,l),s.mk=function(t,e){return new s(t,e,new R(0,0))},Q(s,[{key:"CenterDelegate",get:function(){return this.centerDelegate},set:function(t){this.centerDelegate=t}},{key:"CurveDelegate",get:function(){return this.curveDelegate},set:function(t){this.curveDelegate=t}},{key:"LocationOffset",get:function(){return this.locationOffset},set:function(t){this.locationOffset=t}},{key:"Location",get:function(){return this.CenterDelegate().add(this.LocationOffset)}},{key:"Curve",get:function(){return this.CurveDelegate()}}]),s}(ke),Wo=function(){function l(o,t,e,r,i){this.color=o,void 0!==t&&(this.item=t),void 0!==e&&(this.parent=e),void 0!==r&&(this.left=r),void 0!==i&&(this.right=i)}return l.prototype.toString=function(){return this.item.toString()},l}();function Ho(){Ho=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}!function(l){l[l.Red=0]="Red",l[l.Black=1]="Black"}(gt||(gt={}));var Ce=function(l){function s(t){this.comparer=t,this.count=0,this.root=this.nil=new Wo(gt.Black)}var o=s.prototype;return o[l]=function(){return this.allNodes()},o.clear=function(){this.root=this.nil=new Wo(gt.Black)},o.toNull=function(e){return e!==this.nil?e:null},o.isEmpty=function(){return this.root===this.nil},o.getComparer=function(){return this.comparer},o.getRoot=function(){return this.root},o.find=function(e,r){void 0===r&&(r=this.root);for(var i;r!==this.nil&&0!==(i=this.comparer(e,r.item));)r=i<0?r.left:r.right;return this.toNull(r)},o.findFirst=function(e,r){if(void 0===r&&(r=this.root),r===this.nil)return null;for(var i=null;r!==this.nil;)r=e(r.item)?(i=r).left:r.right;return i},o.findLast=function(e,r){if(void 0===r&&(r=this.root),r===this.nil)return null;for(var i=null;r!==this.nil;)r=e(r.item)?(i=r).right:r.left;return i},o.treeMinimum=function(e){for(void 0===e&&(e=this.root);e.left!==this.nil;)e=e.left;return this.toNull(e)},o.treeMaximum=function(e){for(void 0===e&&(e=this.root);e.right!==this.nil;)e=e.right;return this.toNull(e)},o.next=function(e){if(e.right!==this.nil)return this.treeMinimum(e.right);for(var r=e.parent;r!==this.nil&&e===r.right;)e=r,r=r.parent;return this.toNull(r)},o.previous=function(e){if(e.left!==this.nil)return this.treeMaximum(e.left);for(var r=e.parent;r!==this.nil&&e===r.left;)e=r,r=r.parent;return this.toNull(r)},o.leftRotate=function(e){var r=e.right;e.right=r.left,r.left!==this.nil&&(r.left.parent=e),r.parent=e.parent,e.parent===this.nil?this.root=r:e===e.parent.left?e.parent.left=r:e.parent.right=r,r.left=e,e.parent=r},o.rightRotate=function(e){var r=e.left;e.left=r.right,r.right!==this.nil&&(r.right.parent=e),r.parent=e.parent,e.parent===this.nil?this.root=r:e===e.parent.right?e.parent.right=r:e.parent.left=r,r.right=e,e.parent=r},o.deleteFixup=function(e){for(;e!==this.root&&e.color===gt.Black;)if(e===e.parent.left){var r=e.parent.right;r.color===gt.Red&&(r.color=gt.Black,e.parent.color=gt.Red,this.leftRotate(e.parent),r=e.parent.right),r.left.color===gt.Black&&r.right.color===gt.Black?(r.color=gt.Red,e=e.parent):(r.right.color===gt.Black&&(r.left.color=gt.Black,r.color=gt.Red,this.rightRotate(r),r=e.parent.right),r.color=e.parent.color,e.parent.color=gt.Black,r.right.color=gt.Black,this.leftRotate(e.parent),e=this.root)}else{var i=e.parent.left;i.color===gt.Red&&(i.color=gt.Black,e.parent.color=gt.Red,this.rightRotate(e.parent),i=e.parent.left),i.right.color===gt.Black&&i.left.color===gt.Black?(i.color=gt.Red,e=e.parent):(i.left.color===gt.Black&&(i.right.color=gt.Black,i.color=gt.Red,this.leftRotate(i),i=e.parent.left),i.color=e.parent.color,e.parent.color=gt.Black,i.left.color=gt.Black,this.rightRotate(e.parent),e=this.root)}e.color=gt.Black},o.deleteSubTree=function(e){var r;if(e.left===this.nil||e.right===this.nil)r=e;else for(r=e.right;r.left!==this.nil;)r=r.left;var i=r.left!==this.nil?r.left:r.right;return i.parent=r.parent,r.parent===this.nil?this.root=i:r===r.parent.left?r.parent.left=i:r.parent.right=i,r!==e&&(e.item=r.item),r.color===gt.Black&&this.deleteFixup(i),this.toNull(e)},o.deleteNodeInternal=function(e){this.count--,this.deleteSubTree(e)},o.remove=function(e){var r=this.find(e);return null!=r?(this.count--,this.deleteSubTree(r)):null},o.insert=function(e){var r=this.treeInsert(e);return this.insertPrivate(r),this.toNull(r)},o.treeInsert=function(e){for(var r=this.nil,i=this.root,h=0;i!==this.nil;)r=i,i=(h=this.comparer(e,i.item))<0?i.left:i.right;var c=new Wo(gt.Black,e,r,this.nil,this.nil);return r===this.nil?this.root=c:h<0?r.left=c:r.right=c,this.toNull(c)},o.insertPrivate=function(e){for(this.count++,e.color=gt.Red;e!==this.root&&e.parent.color===gt.Red;)if(e.parent===e.parent.parent.left){var r=e.parent.parent.right;r.color===gt.Red?(e.parent.color=gt.Black,r.color=gt.Black,e.parent.parent.color=gt.Red,e=e.parent.parent):(e===e.parent.right&&this.leftRotate(e=e.parent),e.parent.color=gt.Black,e.parent.parent.color=gt.Red,this.rightRotate(e.parent.parent))}else{var i=e.parent.parent.left;i.color===gt.Red?(e.parent.color=gt.Black,i.color=gt.Black,e.parent.parent.color=gt.Red,e=e.parent.parent):(e===e.parent.left&&this.rightRotate(e=e.parent),e.parent.color=gt.Black,e.parent.parent.color=gt.Red,this.leftRotate(e.parent.parent))}this.root.color=gt.Black},o.allNodes=Ho().mark(function t(){var e;return Ho().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!this.isEmpty()){i.next=2;break}return i.abrupt("return");case 2:e=this.treeMinimum();case 3:if(null==e){i.next=9;break}return i.next=6,e.item;case 6:e=this.next(e),i.next=3;break;case 9:return i.abrupt("return");case 10:case"end":return i.stop()}},t,this)}),o.toString=function(){for(var h,e="{",r=0,i=C(this.allNodes());!(h=i()).done;)e+=h.value.toString(),r!==this.count-1&&(e+="\n"),r++;return e+"}"},s}(Symbol.iterator);function _o(){_o=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var zo=function(l){function s(t){this.heapSize=0,this.A=[],this.compare=t}var o=s.prototype;return o[l]=_o().mark(function t(){var e;return _o().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=1;case 1:if(!(e<=this.heapSize)){i.next=7;break}return i.next=4,this.A[e];case 4:e++,i.next=1;break;case 7:case"end":return i.stop()}},t,this)}),o.Enqueue=function(e){var r=this.heapSize+1;this.A[r]=e,this.heapSize++;for(var h,c,i=r>>1;r>1&&this.Less(h=this.A[r],c=this.A[i]);)this.A[i]=h,this.A[r]=c,i=(r=i)>>1},o.Dequeue=function(){if(this.heapSize<1)throw new Error;var e=this.A[1],r=this.A[this.heapSize];return this.heapSize--,this.ChangeMinimum(r),e},o.ChangeMinimum=function(e){this.A[1]=e;for(var r=1,i=2,h=!1;i<this.heapSize&&!h;){h=!0;var c=this.A[i],f=this.A[i+1];this.compare(c,f)<0?this.compare(c,e)<0&&(this.A[r]=c,this.A[i]=e,h=!1,i=(r=i)<<1):this.compare(f,e)<0&&(this.A[r]=f,this.A[i+1]=e,h=!1,i=(r=i+1)<<1)}if(i===this.heapSize){var y=this.A[i];this.compare(y,e)<0&&(this.A[r]=y,this.A[i]=e)}},o.Less=function(e,r){return this.compare(e,r)<0},o.GetMinimum=function(){return this.A[1]},Q(s,[{key:"Count",get:function(){return this.heapSize}}]),s}(Symbol.iterator),lr=function(){},Rn=function(l){function s(o){var t;return(t=l.call(this)||this).Vertex=o,t}return X(s,l),Q(s,[{key:"Site",get:function(){return this.Vertex.point}},{key:"Polyline",get:function(){return this.Vertex.polyline}}]),s}(lr),mh=function(l){function s(o){return l.call(this,o)||this}return X(s,l),s}(Rn),wh=function(){function l(o){this.lineSweeper=o}var s=l.prototype;return s.Compare=function(t,e){switch(R.getTriangleOrientation(e.Start,e.End,this.x)){case it.Collinear:return 0;case it.Clockwise:return 1;default:return-1}},s.SetOperand=function(t){this.x=this.IntersectionOfSideAndSweepLine(t)},s.IntersectionOfSideAndSweepLine=function(t){var e=t.Direction.dot(this.lineSweeper.SweepDirection),r=(this.lineSweeper.Z-t.Start.dot(this.lineSweeper.SweepDirection))/e;return t.Start.add(t.Direction.mul(r))},l}(),Ph=function(l){function s(o){var t;return(t=l.call(this)||this).site=o,t}return X(s,l),Q(s,[{key:"Site",get:function(){return this.site}}]),s}(lr),Vs=function(){function l(o,t){var e=this;this.PreviousZ=Number.NEGATIVE_INFINITY,this.z=Number.NEGATIVE_INFINITY,this.Obstacles=o??[],this.SweepDirection=t,this.DirectionPerp=t.rotate(-Math.PI/2),this.EventQueue=new zo(function(r,i){return e.Compare(r,i)}),this.ObstacleSideComparer=new wh(this),this.LeftObstacleSideTree=new Ce(function(r,i){return e.ObstacleSideComparer.Compare(r,i)}),this.RightObstacleSideTree=new Ce(function(r,i){return e.ObstacleSideComparer.Compare(r,i)})}var s=l.prototype;return s.GetZS=function(t){return this.SweepDirection.dot(t.Site)},s.GetZP=function(t){return this.SweepDirection.dot(t)},s.SegmentIsNotHorizontal=function(t,e){return Math.abs(t.sub(e).dot(this.SweepDirection))>q.distanceEpsilon},s.RemoveLeftSide=function(t){this.ObstacleSideComparer.SetOperand(t),this.LeftObstacleSideTree.remove(t)},s.RemoveRightSide=function(t){this.ObstacleSideComparer.SetOperand(t),this.RightObstacleSideTree.remove(t)},s.InsertLeftSide=function(t){this.ObstacleSideComparer.SetOperand(t),this.LeftObstacleSideTree.insert(t)},s.InsertRightSide=function(t){this.ObstacleSideComparer.SetOperand(t),this.RightObstacleSideTree.insert(t)},s.FindFirstObstacleSideToTheLeftOfPoint=function(t){var e=this.RightObstacleSideTree.findLast(function(r){return R.pointToTheRightOfLineOrOnLine(t,r.Start,r.End)});return null==e?null:e.item},s.FindFirstObstacleSideToToTheRightOfPoint=function(t){var e=this.LeftObstacleSideTree.findFirst(function(r){return!R.pointToTheRightOfLineOrOnLine(t,r.Start,r.End)});return null==e?null:e.item},s.EnqueueEvent=function(t){this.eventQueue.Enqueue(t)},s.InitQueueOfEvents=function(){for(var e,t=C(this.Obstacles);!(e=t()).done;)this.EnqueueLowestPointsOnObstacles(e.value);if(null!=this.Ports)for(var h,i=C(this.Ports.values());!(h=i()).done;)this.EnqueueEvent(new Ph(h.value))},s.EnqueueLowestPointsOnObstacles=function(t){var e=this.GetLowestPoint(t);this.EnqueueEvent(new mh(e))},s.GetLowestPoint=function(t){for(var e=t.startPoint,r=t.startPoint.next;null!=r;r=r.next)this.Less(r.point,e.point)&&(e=r);return e},s.Compare=function(t,e){return this.ComparePoints(t.Site,e.Site)},s.Less=function(t,e){return this.ComparePoints(t,e)<0},s.ComparePoints=function(t,e){var r=this.SweepDirection.dot(t),i=this.SweepDirection.dot(e);return r<i?-1:r>i?1:(r=this.directionPerp.dot(t))<(i=this.directionPerp.dot(e))?-1:r>i?1:0},Q(l,[{key:"EventQueue",get:function(){return this.eventQueue},set:function(t){this.eventQueue=t}},{key:"DirectionPerp",get:function(){return this.directionPerp},set:function(t){this.directionPerp=t}},{key:"Z",get:function(){return this.z},set:function(t){t>this.z+q.tolerance&&(this.PreviousZ=this.z),this.z=t}}]),l}(),$t=ie(41708),hr=function(){function l(o,t,e){void 0===e&&(e=1),this.LengthMultiplier=1,this.Source=o,this.Target=t,this.Weight=e}l.closeuv=function(t,e){return R.closeDistEps(t.point,l.u,.1)&&R.closeDistEps(e.point,l.v,.1)};var s=l.prototype;return s.toString=function(){return $t.Ld.Format("{0}->{1} ({2})",this.Source,this.Target,this.Weight)},s.ReversedClone=function(){return new l(this.Target,this.Source)},s.Clone=function(){return new l(this.Source,this.Target)},Q(l,[{key:"SourcePoint",get:function(){return this.Source.point}},{key:"TargetPoint",get:function(){return this.Target.point}},{key:"Length",get:function(){return this.SourcePoint.sub(this.TargetPoint).length*this.LengthMultiplier}}]),l}();hr.u=new R(545.833,840.458),hr.v=new R(606.1667261889578,786.2917261889578),hr.DefaultWeight=1;var Ar=function(l){function s(o,t,e){return void 0===e&&(e=0),l.call(this,o,t,e)||this}return X(s,l),s.constructorVV=function(t,e){return new s(t,e,0)},s}(hr),Ds=function(){function l(o){var t=this;this._inEdges=new Array,this._outEdges=new Ce(function(e,r){return t.Compare(e,r)}),this.point=o}var s=l.prototype;return s.InEdgesLength=function(){return this._inEdges.length},s.addInEdge=function(t){this._inEdges.push(t)},s.toString=function(){return this.point.toString()},s.RemoveOutEdge=function(t){this.OutEdges.remove(t)},s.RemoveInEdge=function(t){var e=this._inEdges.indexOf(t);if(-1!==e){var r=this._inEdges.length-1;e!==r&&(this._inEdges[e]=this._inEdges[r]),this._inEdges.pop()}},l.FindFirst=function(t,e){return l.FindFirst_t(t.root,t,e)},l.FindFirst_t=function(t,e,r){if(t===e.nil)return null;for(var i=null;t!==e.nil;)t=t.item.TargetPoint.compareTo(r)>=0?(i=t).left:t.right;return i},s.get=function(t){var e=l.FindFirst(this.OutEdges,t.point);return null!=e&&e.item.Target===t||null!=(e=l.FindFirst(t.OutEdges,this.point))&&e.item.Target===this?e.item:null},s.Compare=function(t,e){return t.TargetPoint.compareTo(e.TargetPoint)},s.ClearEdges=function(){this._outEdges.clear(),this._inEdges=[]},Q(l,[{key:"InEdges",get:function(){return this._inEdges}},{key:"OutEdges",get:function(){return this._outEdges}},{key:"Degree",get:function(){return this._inEdges.length+this.OutEdges.count}},{key:"IsTerminal",get:function(){return this._isTerminal},set:function(t){this._isTerminal=t}},{key:"IsShortestPathTerminal",get:function(){return this._isShortestPathTerminal},set:function(t){this._isShortestPathTerminal=t}}]),l}();function ci(){ci=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var _t=function(){function l(){this.activeVertices=new Set,this.VertexFactory=function(o){return new Ds(o)},this.pointToVertexMap=new Ee}var s=l.prototype;return s.edges_=ci().mark(function o(){var t,e,i,h,c;return ci().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=C(this.pointToVertexMap.values());case 1:if((e=t()).done){p.next=12;break}i=C(e.value.OutEdges);case 4:if((h=i()).done){p.next=10;break}return c=h.value,p.next=8,c;case 8:p.next=4;break;case 10:p.next=1;break;case 12:case"end":return p.stop()}},o,this)}),s.ClearPrevEdgesTable=function(){for(var e,t=C(this.activeVertices);!(e=t()).done;)e.value.prevEdge=null;this.activeVertices.clear()},s.ShrinkLengthOfPrevEdge=function(t,e){t.prevEdge.LengthMultiplier=e},s.PreviosVertex=function(t){var e=t.prevEdge;return e?e.Source===t?e.Target:e.Source:null},s.SetPreviousEdge=function(t,e){this.activeVertices.add(t),t.prevEdge=e},s.AddHole=function(t){for(var e=t.startPoint;e!==t.endPoint;)this.AddEdgePlPl(e,e.next),e=e.next;this.AddEdgePlPl(t.endPoint,t.startPoint)},l.OrientHolesClockwise=ci().mark(function o(t){var e,r,i,h,c;return ci().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:e=C(t);case 1:if((r=e()).done){p.next=14;break}h=(i=r.value).startPoint;case 4:if((c=R.getTriangleOrientation(h.point,h.next.point,h.next.next.point))===it.Collinear){p.next=9;break}return p.next=8,c===it.Clockwise?i:i.reverse();case 8:return p.abrupt("break",12);case 9:h=h.next,p.next=4;break;case 12:p.next=1;break;case 14:case"end":return p.stop()}},o)}),s.AddVertexP=function(t){var e=this.pointToVertexMap.get(t);if(e)return e;var r=this.VertexFactory(t);return this.pointToVertexMap.set(t,r),r},s.AddVertexV=function(t){this.pointToVertexMap.set(t.point,t)},s.ContainsVertex=function(t){return this.pointToVertexMap.has(t)},l.AddEdgeVV=function(t,e){var r;if(r=t.get(e))return r;if(t===e)throw new Error("Self-edges are not allowed");var i=new hr(t,e);return t.OutEdges.insert(i),e.InEdges.push(i),i},s.AddEdgePlPl=function(t,e){this.AddEdgePP(t.point,e.point)},l.AddEdge=function(t){t.Source.OutEdges.insert(t),t.Target.addInEdge(t)},s.AddEdgeF=function(t,e,r){var i=this.FindVertex(t),h=null;if(null!=i&&null!=(h=this.FindVertex(e))){var c=i.get(h);if(c)return c}null==i?(i=this.AddVertexP(t),h=this.AddVertexP(e)):null==h&&(h=this.AddVertexP(e));var f=r(i,h);return i.OutEdges.insert(f),h.addInEdge(f),f},s.AddEdgePP=function(t,e){return this.AddEdgeF(t,e,function(r,i){return new hr(r,i)})},s.FindVertex=function(t){return this.pointToVertexMap.get(t)},s.Vertices=function(){return this.pointToVertexMap.values()},s.RemoveVertex=function(t){for(var r,e=C(t.OutEdges);!(r=e()).done;){var i=r.value;i.Target.RemoveInEdge(i)}for(var c,h=C(t.InEdges);!(c=h()).done;){var f=c.value;f.Source.RemoveOutEdge(f)}this.pointToVertexMap.deleteP(t.point)},s.FindEdgePP=function(t,e){var r=this.FindVertex(t);if(null==r)return null;var i=this.FindVertex(e);return null==i?null:r.get(i)},l.RemoveEdge=function(t){t.Source.RemoveOutEdge(t),t.Target.RemoveInEdge(t)},s.ClearEdges=function(){for(var e,t=C(this.Vertices());!(e=t()).done;)e.value.ClearEdges()},Q(l,[{key:"Edges",get:function(){return this.edges_()}}]),l}(),qo=function(){this.Removed=!1},Gn=function(l){function s(t,e,r){var i;return(i=l.call(this)||this).start=t,i.EndVertex=e,i.ConeSide=r,i}return X(s,l),s.prototype.toString=function(){return"BrokenConeSide: "+this.Start+","+this.End},Q(s,[{key:"Start",get:function(){return this.start}},{key:"End",get:function(){return this.EndVertex.point}},{key:"Direction",get:function(){return this.End.sub(this.Start)}}]),s}(qo),Uo=function(){function l(s,o){this.apex=s,this.coneSweeper=o}return Q(l,[{key:"Removed",get:function(){return this.removed},set:function(o){this.removed=o}},{key:"Apex",get:function(){return this.apex},set:function(o){this.apex=o}},{key:"RightSideDirection",get:function(){return this.coneSweeper.ConeRightSideDirection}},{key:"LeftSideDirection",get:function(){return this.coneSweeper.ConeLeftSideDirection}},{key:"RightSide",get:function(){return this.rightSide},set:function(o){this.rightSide=o,this.rightSide.Cone=this}},{key:"LeftSide",get:function(){return this.leftSide},set:function(o){this.leftSide=o,this.leftSide.Cone=this}}]),l}(),js=function(l){function s(t,e){var r;return(r=l.call(this)||this).site=t,r.coneToClose=e,r}return X(s,l),s.prototype.toString=function(){return"ConeClosureEvent "+this.site},Q(s,[{key:"ConeToClose",get:function(){return this.coneToClose}},{key:"Site",get:function(){return this.site}}]),s}(lr),$e=function(l){function s(t){var e;return(e=l.call(this)||this).Cone=t,e}return X(s,l),s.prototype.toString=function(){return"ConeLeftSide "+this.Start+" "+this.Direction},Q(s,[{key:"Start",get:function(){return this.Cone.Apex}},{key:"Direction",get:function(){return this.Cone.LeftSideDirection}}]),s}(qo),kr=function(l){function s(t){var e;return(e=l.call(this)||this).Cone=t,e}return X(s,l),s.prototype.toString=function(){return"ConeRightSide "+this.Start+" "+this.Direction},Q(s,[{key:"Start",get:function(){return this.Cone.Apex}},{key:"Direction",get:function(){return this.Cone.RightSideDirection}}]),s}(qo),Sh=function(){function l(o){this.coneSweeper=o}var s=l.prototype;return s.SetOperand=function(t){this.x=this.IntersectionOfSegmentAndSweepLine(t)},s.Compare=function(t,e){var i=e instanceof Gn;return t instanceof Gn?i?this.CompareBrokenSides(t,e):this.CompareObstacleSideAndConeSide(e):i?this.CompareConeSideAndObstacleSide(t,e):l.CompareNotIntersectingSegs(t,e)},l.CompareNotIntersectingSegs=function(t,e){switch(R.getTriangleOrientation(t.Start,e.Start,e.Start.add(e.Direction))){case it.Counterclockwise:return-1;case it.Clockwise:return 1;default:return 0}},s.CompareObstacleSideAndConeSide=function(t){var e=R.getTriangleOrientation(this.x,t.Start,t.Start.add(t.Direction));return e===it.Counterclockwise?-1:e===it.Clockwise?1:t instanceof $e?-1:1},s.CompareConeSideAndObstacleSide=function(t,e){var r=R.getTriangleOrientation(this.x,e.start,e.End);return r===it.Counterclockwise?-1:r===it.Clockwise||t instanceof $e?1:-1},s.IntersectionOfSegmentAndSweepLine=function(t){var e=t.Direction.dot(this.coneSweeper.SweepDirection),r=(this.coneSweeper.Z-t.Start.dot(this.coneSweeper.SweepDirection))/e;return t.Start.add(t.Direction.mul(r))},s.CompareBrokenSides=function(t,e){return t.EndVertex===e.EndVertex?l.CompareNotIntersectingSegs(t.ConeSide,e.ConeSide):R.getTriangleOrientation(this.x,e.start,e.EndVertex.point)===it.Counterclockwise?-1:1},l}(),fi=function(l){function s(t,e,r){var i;return(i=l.call(this)||this).coneLeftSide=t,i.intersectionPoint=e,i.endVertex=r,i}return X(s,l),s.prototype.toString=function(){return"LeftIntersectionEvent "+this.intersectionPoint},Q(s,[{key:"EndVertex",get:function(){return this.endVertex}},{key:"Site",get:function(){return this.intersectionPoint}}]),s}(lr),Yo=function(){function l(){}return l.prototype.toString=function(){return this.Start+" "+this.End},Q(l,[{key:"Direction",get:function(){return this.End.sub(this.Start)}}]),l}(),Qo=function(l){function s(t){var e;return(e=l.call(this)||this).Init(t),e}return X(s,l),s.prototype.Init=function(e){this.StartVertex=e},Q(s,[{key:"Polyline",get:function(){return this.StartVertex.polyline}},{key:"Start",get:function(){return this.StartVertex.point}},{key:"End",get:function(){return this.EndVertex.point}}]),s}(Yo),Nn=function(l){function s(o){var t;return(t=l.call(this,o)||this).end=o.nextOnPolyline.point,t}return X(s,l),Q(s,[{key:"End",get:function(){return this.end}},{key:"EndVertex",get:function(){return this.StartVertex.nextOnPolyline}}]),s}(Qo),Zr=function(l){function s(o){return l.call(this,o)||this}return X(s,l),s}(Rn),Ws=function(l){function s(t,e,r){var i;return(i=l.call(this)||this).coneRightSide=t,i.intersectionPoint=e,i.endVertex=r,i}return X(s,l),s.prototype.toString=function(){return"RightIntersectionEvent "+this.intersectionPoint},Q(s,[{key:"EndVertex",get:function(){return this.endVertex},set:function(e){this.endVertex=e}},{key:"Site",get:function(){return this.intersectionPoint}}]),s}(lr),Fn=function(l){function s(o){var t;return(t=l.call(this,o)||this).end=o.prevOnPolyline.point,t}return X(s,l),Q(s,[{key:"End",get:function(){return this.end}},{key:"EndVertex",get:function(){return this.StartVertex.prevOnPolyline}}]),s}(Qo),Kr=function(l){function s(o){return l.call(this,o)||this}return X(s,l),s}(Rn),Hs=function(l){function s(t,e,r,i,h,c,f){var p;return(p=l.call(this,t,e)||this).visibilityGraph=h,p.ConeRightSideDirection=r,p.ConeLeftSideDirection=i,p.coneSideComparer=new Sh(Xe(p)),p.leftConeSides=new Ce(function(y,m){return p.coneSideComparer.Compare(y,m)}),p.rightConeSides=new Ce(function(y,m){return p.coneSideComparer.Compare(y,m)}),p.Ports=c,p.BorderPolyline=f,p.PortEdgesCreator=function(y,m){return new Ar(y,m,0)},p}X(s,l),s.Sweep=function(e,r,i,h,c,f){new s(e,r,r.rotate(-i/2),r.rotate(i/2),h,c,f).Calculate()};var o=s.prototype;return o.Calculate=function(){for(this.InitQueueOfEvents();this.EventQueue.Count>0;)this.ProcessEvent(this.EventQueue.Dequeue());null!=this.BorderPolyline&&this.CloseRemainingCones(),this.CreatePortEdges()},o.CreatePortEdges=function(){if(null!=this.portEdgesGraph)for(var r,e=C(this.portEdgesGraph.Edges);!(r=e()).done;){var i=r.value;this.visibilityGraph.AddEdgeF(i.SourcePoint,i.TargetPoint,this.PortEdgesCreator)}},o.CloseRemainingCones=function(){if(0!==this.leftConeSides.count){var e=this.BorderPolyline.startPoint,r=this.leftConeSides.count;do{var i=this.leftConeSides.treeMinimum().item.Cone;e=this.FindPolylineSideIntersectingConeRightSide(e,i),e=this.GetPolylinePointInsideOfConeAndRemoveCones(e,i),r--}while(this.leftConeSides.count>0&&r>0)}},o.GetPolylinePointInsideOfConeAndRemoveCones=function(e,r){var i=e.nextOnPolyline,h=s.FindInsidePoint(e.point,i.point,r);return R.closeDistEps(h,e.point)?(this.AddEdgeAndRemoveCone(r,e.point),this.AddEdgesAndRemoveRemainingConesByPoint(e.point)):R.closeDistEps(h,i.point)?(this.AddEdgeAndRemoveCone(r,i.point),this.AddEdgesAndRemoveRemainingConesByPoint(i.point),e=i):(e=s.InsertPointIntoPolylineAfter(this.BorderPolyline,e,h),this.AddEdgeAndRemoveCone(r,e.point),this.AddEdgesAndRemoveRemainingConesByPoint(e.point)),e},s.FindInsidePoint=function(e,r,i){return s.FindInsidePointBool(e,r,i.Apex,i.Apex.add(i.LeftSideDirection),i.Apex.add(i.RightSideDirection))},s.FindInsidePointBool=function(e,r,i,h,c){if(R.closeDistEps(e,r)||R.PointIsInsideCone(e,i,h,c))return e;if(R.PointIsInsideCone(r,i,h,c))return r;var f=R.middle(e,r);return R.pointToTheLeftOfLine(f,i,h)?s.FindInsidePointBool(f,r,i,h,c):s.FindInsidePointBool(e,f,i,h,c)},o.AddEdgesAndRemoveRemainingConesByPoint=function(e){for(var h,r=new Array,i=C(this.leftConeSides);!(h=i()).done;){var c=h.value;if(!R.PointToTheRightOfLineOrOnLine(e,c.Start,c.Start.add(c.Direction)))break;r.push(c.Cone)}for(var f=0,p=r;f<p.length;f++)this.AddEdgeAndRemoveCone(p[f],e)},o.FindPolylineSideIntersectingConeRightSide=function(e,r){for(var i=e,h=r.Apex,c=r.Apex.add(this.ConeRightSideDirection),f=s.GetSign(e,h,c);;){var p=e.nextOnPolyline,y=s.GetSign(p,h,c);if(y-f>0)return e;if(f=y,(e=p)===i)throw new Error("cannod decide if the polyline intersects the cone!")}},s.GetSign=function(e,r,i){var h=R.signedDoubledTriangleArea(r,i,e.point);return h<0?1:h>0?-1:0},o.AddEdgeAndRemoveCone=function(e,r){null!=this.Ports&&this.Ports.has(e.Apex)?this.CreatePortEdge(e,r):this.visibilityGraph.AddEdgePP(e.Apex,r),this.RemoveCone(e)},o.CreatePortEdge=function(e,r){null==this.portEdgesGraph&&(this.portEdgesGraph=new _t);var i=this.portEdgesGraph.FindVertex(e.Apex),h=null!=i?Array.from(i.InEdges).concat(Array.from(i.OutEdges.allNodes())):null;if(h)for(var f,c=C(h);!(f=c()).done;){var p=f.value,y=(p.Target===i?p.Source:p.Target).point;_t.RemoveEdge(p),this.portEdgesGraph.AddEdgePP(y,r)}this.portEdgesGraph.AddEdgePP(e.Apex,r)},s.InsertPointIntoPolylineAfter=function(e,r,i){var h;return null!=r.next?((h=nr.mkFromPoint(i)).prev=r,h.next=r.next,r.next.prev=h,r.next=h):((h=nr.mkFromPoint(i)).prev=r,r.next=h,e.endPoint=h),h.polyline=e,e.setInitIsRequired(),h},o.ProcessEvent=function(e){e instanceof Rn?this.ProcessVertexEvent(e):e instanceof Ws?this.ProcessRightIntersectionEvent(e):e instanceof fi?this.ProcessLeftIntersectionEvent(e):(e instanceof js?e.ConeToClose.Removed||this.RemoveCone(e.ConeToClose):this.ProcessPortObstacleEvent(e),this.Z=this.GetZS(e))},o.ProcessPortObstacleEvent=function(e){this.Z=this.GetZS(e),this.GoOverConesSeeingVertexEvent(e),this.CreateConeOnVertex(e)},o.ProcessLeftIntersectionEvent=function(e){if(!1===e.coneLeftSide.Removed)if(Math.abs(e.EndVertex.point.sub(e.Site).dot(this.SweepDirection))<q.distanceEpsilon)this.RemoveCone(e.coneLeftSide.Cone);else{this.RemoveSegFromLeftTree(e.coneLeftSide),this.Z=this.GetZP(e.Site);var r=new Gn(e.Site,e.EndVertex,e.coneLeftSide);this.InsertToTree(this.leftConeSides,r),e.coneLeftSide.Cone.LeftSide=r,this.LookForIntersectionOfObstacleSideAndLeftConeSide(e.Site,e.EndVertex),this.TryCreateConeClosureForLeftSide(r)}else this.Z=this.GetZP(e.Site)},o.TryCreateConeClosureForLeftSide=function(e){if(e.Cone.RightSide instanceof kr){var r=e.Cone.RightSide;R.getTriangleOrientation(r.Start,r.Start.add(r.Direction),e.EndVertex.point)==it.Clockwise&&this.CreateConeClosureEvent(e,r)}},o.CreateConeClosureEvent=function(e,r){var i=R.RayIntersectsRayInteriors(e.start,e.Direction,r.Start,r.Direction);if(i){var h=new js(i,e.Cone);this.EnqueueEvent(h)}},o.ProcessRightIntersectionEvent=function(e){if(e.coneRightSide.Removed)this.Z=this.GetZP(e.Site);else{this.RemoveSegFromRightTree(e.coneRightSide),this.Z=this.GetZP(e.Site);var r=new Gn(e.Site,e.EndVertex,e.coneRightSide);this.InsertToTree(this.rightConeSides,r),e.coneRightSide.Cone.RightSide=r,this.LookForIntersectionOfObstacleSideAndRightConeSide(e.Site,e.EndVertex),this.TryCreateConeClosureForRightSide(r)}},o.TryCreateConeClosureForRightSide=function(e){if(e.Cone.LeftSide instanceof $e){var i=e.Cone.LeftSide;R.getTriangleOrientation(i.Start,i.Start.add(i.Direction),e.EndVertex.point)==it.Counterclockwise&&this.CreateConeClosureEvent(e,i)}},o.RemoveConesClosedBySegment=function(e,r){this.CloseConesCoveredBySegment(e,r,this.GetZP(e)>this.GetZP(r)?this.leftConeSides:this.rightConeSides)},o.CloseConesCoveredBySegment=function(e,r,i){var h=i.findFirst(function(P){return R.getTriangleOrientation(P.Start,P.Start.add(P.Direction),e)===it.Counterclockwise});if(null!=h&&R.IntervalIntersectsRay(e,r,h.item.Start,h.item.Direction)){var f=new Array;do{f.push(h.item.Cone),h=i.next(h)}while(null!=h&&void 0!==R.IntervalIntersectsRay(e,r,h.item.Start,h.item.Direction));for(var p=0,y=f;p<y.length;p++)this.RemoveCone(y[p])}},o.ProcessVertexEvent=function(e){this.Z=this.GetZS(e),this.GoOverConesSeeingVertexEvent(e),this.AddConeAndEnqueueEvents(e)},s.Diamond=function(e){return te.mkDiamond(2,2,e)},o.AddConeAndEnqueueEvents=function(e){e instanceof Zr?this.CloseConesAddConeAtLeftVertex(e,e.Vertex.nextOnPolyline):(e instanceof Kr||this.CloseConesAddConeAtLeftVertex(e,e.Vertex.nextOnPolyline),this.CloseConesAddConeAtRightVertex(e,e.Vertex.prevOnPolyline))},o.CloseConesAddConeAtRightVertex=function(e,r){var i=e.Vertex.nextOnPolyline.point;this.directionPerp.dot(e.Site.sub(i))>q.distanceEpsilon&&this.RemoveConesClosedBySegment(i,e.Vertex.point),this.directionPerp.dot(r.point.sub(e.Site))>q.distanceEpsilon&&this.RemoveConesClosedBySegment(e.Site,r.point);var h=e.Site,c=h.add(this.ConeLeftSideDirection),f=h.add(this.ConeRightSideDirection),p=r.point;this.GetZP(h.sub(i))>q.distanceEpsilon&&this.RemoveRightSide(new Fn(e.Vertex.nextOnPolyline)),this.GetZP(h.sub(r.point))>q.distanceEpsilon&&this.RemoveLeftSide(new Nn(r)),this.GetZP(p)+q.distanceEpsilon<this.GetZS(e)&&this.CreateConeOnVertex(e),R.PointToTheRightOfLineOrOnLine(p,h,c)?R.PointToTheLeftOfLineOrOnLine(p,h,f)?this.CaseToTheLeftOfLineOrOnLineConeRp(e,r):(this.GetZP(p.sub(h))>q.distanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndLeftConeSide(e.Site,r),this.InsertRightSide(new Fn(e.Vertex))),this.EnqueueRightVertexEvent(new Kr(r))):(this.CreateConeOnVertex(e),R.PointToTheLeftOfLineOrOnLine(p.add(this.DirectionPerp),p,h)&&this.EnqueueRightVertexEvent(new Kr(r)))},o.CaseToTheLeftOfLineOrOnLineConeRp=function(e,r){this.EnqueueRightVertexEvent(new Kr(r));var i=new Uo(e.Vertex.point,this),h=new Gn(i.Apex,r,new $e(i));i.LeftSide=h,i.RightSide=new kr(i);var c=this.InsertToTree(this.rightConeSides,i.RightSide);this.LookForIntersectionWithConeRightSide(c);var f=this.InsertToTree(this.leftConeSides,i.LeftSide);this.FixConeLeftSideIntersections(h,f),this.GetZP(r.point.sub(e.Site))>q.distanceEpsilon&&this.InsertRightSide(new Fn(e.Vertex))},o.LookForIntersectionOfObstacleSideAndRightConeSide=function(e,r){var i=this.GetLastNodeToTheLeftOfPointInRightSegmentTree(e);if(null!=i&&i.item instanceof kr){var c=R.IntervalIntersectsRay(e,r.point,i.item.Start,this.ConeRightSideDirection);c&&this.SegmentIsNotHorizontal(c,r.point)&&this.EnqueueEvent(this.CreateRightIntersectionEvent(i.item,c,r))}},o.CreateRightIntersectionEvent=function(e,r,i){return new Ws(e,r,i)},o.GetLastNodeToTheLeftOfPointInRightSegmentTree=function(e){return this.rightConeSides.findLast(function(r){return s.PointIsToTheRightOfSegment(e,r)})},o.LookForIntersectionOfObstacleSideAndLeftConeSide=function(e,r){var i=this.GetFirstNodeToTheRightOfPoint(e);if(null!=i&&i.item instanceof $e){var h=i.item,c=R.IntervalIntersectsRay(e,r.point,h.Start,this.ConeLeftSideDirection);c&&this.EnqueueEvent(new fi(h,c,r))}},o.GetFirstNodeToTheRightOfPoint=function(e){return this.leftConeSides.findFirst(function(r){return s.PointIsToTheLeftOfSegment(e,r)})},s.PointIsToTheLeftOfSegment=function(e,r){return R.getTriangleOrientation(r.Start,r.Start.add(r.Direction),e)===it.Counterclockwise},s.PointIsToTheRightOfSegment=function(e,r){return R.getTriangleOrientation(r.Start,r.Start.add(r.Direction),e)===it.Clockwise},o.FixConeLeftSideIntersections=function(e,r){do{r=this.leftConeSides.next(r)}while(null!=r&&R.PointToTheRightOfLineOrOnLine(e.Start,r.item.Start,r.item.Start.add(r.item.Direction)));if(null!=r&&r.item instanceof $e){var i=r.item,h=R.IntervalIntersectsRay(e.start,e.End,i.Start,i.Direction);h&&this.EnqueueEvent(new fi(i,h,e.EndVertex))}},o.InsertToTree=function(e,r){return this.coneSideComparer.SetOperand(r),e.insert(r)},o.CloseConesAddConeAtLeftVertex=function(e,r){var i=e.Vertex.prevOnPolyline.point;e.Site.sub(i).dot(this.directionPerp)<-q.distanceEpsilon&&this.RemoveConesClosedBySegment(e.Site,i),r.point.sub(e.Site).dot(this.directionPerp)<-q.distanceEpsilon&&this.RemoveConesClosedBySegment(r.point,e.Site);var h=e.Site,c=h.add(this.ConeLeftSideDirection),f=h.add(this.ConeRightSideDirection),p=r.point;this.GetZP(h.sub(i))>q.distanceEpsilon&&this.RemoveLeftSide(new Nn(e.Vertex.prevOnPolyline));var y=this.GetZP(p)-this.Z;y<-q.distanceEpsilon&&this.RemoveRightSide(new Fn(r));var m=p.sub(e.Site);if(y<-q.distanceEpsilon||dt(y,0)&&this.GetZP(m)>0&&m.dot(this.directionPerp)>-q.distanceEpsilon)this.CreateConeOnVertex(e);else if(R.PointToTheLeftOfLineOrOnLine(p,h,f))if(R.PointToTheLeftOfLineOrOnLine(p,h,c))this.EnqueueEvent(new Zr(r)),this.GetZP(m)>q.distanceEpsilon&&(this.LookForIntersectionOfObstacleSideAndRightConeSide(e.Site,r),this.InsertLeftSide(new Nn(e.Vertex)));else{this.EnqueueEvent(new Zr(r));var P=new Uo(e.Vertex.point,this),L=new Gn(e.Vertex.point,r,new kr(P));P.RightSide=L,P.LeftSide=new $e(P),this.LookForIntersectionWithConeLeftSide(this.InsertToTree(this.leftConeSides,P.LeftSide));var E=this.InsertToTree(this.rightConeSides,L);this.FixConeRightSideIntersections(L,E),this.GetZP(m)>q.distanceEpsilon&&this.InsertLeftSide(new Nn(e.Vertex))}else this.CreateConeOnVertex(e),this.EnqueueEvent(new Zr(r))},o.RemoveCone=function(e){e.Removed=!0,this.RemoveSegFromLeftTree(e.LeftSide),this.RemoveSegFromRightTree(e.RightSide)},o.RemoveSegFromRightTree=function(e){this.coneSideComparer.SetOperand(e);var r=this.rightConeSides.remove(e);if(e.Removed=!0,null==r){var i=this.Z;this.Z=Math.max(this.GetZP(e.Start),this.Z-.01),this.coneSideComparer.SetOperand(e),r=this.rightConeSides.remove(e),this.Z=i}},o.RemoveSegFromLeftTree=function(e){if(e.Removed=!0,this.coneSideComparer.SetOperand(e),null==this.leftConeSides.remove(e)){var i=this.Z;this.Z=Math.max(this.GetZP(e.Start),this.Z-.01),this.coneSideComparer.SetOperand(e),this.leftConeSides.remove(e),this.Z=i}},o.FixConeRightSideIntersections=function(e,r){do{r=this.rightConeSides.previous(r)}while(null!=r&&R.PointToTheLeftOfLineOrOnLine(e.start,r.item.Start,r.item.Start.add(r.item.Direction)));var i;if(null!=r&&r.item instanceof kr){var h=r.item;(i=R.IntervalIntersectsRay(e.start,e.End,h.Start,h.Direction))&&this.EnqueueEvent(this.CreateRightIntersectionEvent(h,i,e.EndVertex))}},o.CreateConeOnVertex=function(e){var r=new Uo(e.Site,this);r.LeftSide=new $e(r),r.RightSide=new kr(r);var i=this.InsertToTree(this.leftConeSides,r.LeftSide),h=this.InsertToTree(this.rightConeSides,r.RightSide);this.LookForIntersectionWithConeRightSide(h),this.LookForIntersectionWithConeLeftSide(i)},o.LookForIntersectionWithConeLeftSide=function(e){if(e.item instanceof $e){var i=e.item,h=this.FindFirstObstacleSideToTheLeftOfPoint(i.Start);null!=h&&this.TryIntersectionOfConeLeftSideAndObstacleSide(i,h)}else{var c=e.item;null!=(e=this.leftConeSides.next(e))&&e.item instanceof $e&&this.TryIntersectionOfConeLeftSideAndObstacleConeSide(e.item,c)}},o.LookForIntersectionWithConeRightSide=function(e){if(e.item instanceof kr){var i=e.item,h=this.FindFirstObstacleSideToToTheRightOfPoint(i.Start);null!=h&&this.TryIntersectionOfConeRightSideAndObstacleSide(i,h)}else{var c=e.item;null!=(e=this.rightConeSides.previous(e))&&e.item instanceof kr&&this.TryIntersectionOfConeRightSideAndObstacleConeSide(e.item,c)}},o.TryIntersectionOfConeRightSideAndObstacleConeSide=function(e,r){var i=R.IntervalIntersectsRay(r.start,r.End,e.Start,e.Direction);i&&this.EnqueueEvent(this.CreateRightIntersectionEvent(e,i,r.EndVertex))},o.TryIntersectionOfConeRightSideAndObstacleSide=function(e,r){var i=R.IntervalIntersectsRay(r.Start,r.End,e.Start,e.Direction);i&&this.EnqueueEvent(this.CreateRightIntersectionEvent(e,i,r.EndVertex))},o.TryIntersectionOfConeLeftSideAndObstacleConeSide=function(e,r){var i=R.IntervalIntersectsRay(r.start,r.End,e.Start,e.Direction);i&&this.EnqueueEvent(new fi(e,i,r.EndVertex))},o.TryIntersectionOfConeLeftSideAndObstacleSide=function(e,r){var i=R.IntervalIntersectsRay(r.Start,r.End,e.Start,e.Direction);i&&this.EnqueueEvent(new fi(e,i,r.EndVertex))},o.ExtendSegmentToZ=function(e){var r=e.Direction.dot(this.SweepDirection),i=(this.Z+40-e.Start.dot(this.SweepDirection))/r;return Z.mkPP(e.Start,e.Start.add(e.Direction.mul(i)))},o.GoOverConesSeeingVertexEvent=function(e){var r=this.FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex(e);if(null!=r){var h=r.item.Cone,c=h.LeftSide;if(!s.VertexIsToTheLeftOfSegment(e,c)){var f=[h];if(this.coneSideComparer.SetOperand(c),null==(r=this.leftConeSides.find(c))){var p=this.Z;this.Z=Math.max(this.GetZP(c.Start),this.PreviousZ),this.coneSideComparer.SetOperand(c),r=this.leftConeSides.find(c),this.Z=p}if(null!=r||null!=(r=this.GetRbNodeEmergency(c))){for(r=this.leftConeSides.next(r);null!=r&&!s.VertexIsToTheLeftOfSegment(e,r.item);)f.push(r.item.Cone),r=this.leftConeSides.next(r);for(var y=0,m=f;y<m.length;y++)this.AddEdgeAndRemoveCone(m[y],e.Site)}}}},o.GetRbNodeEmergency=function(e){if(0===this.leftConeSides.count)return null;for(var r=this.leftConeSides.treeMinimum();null!=r;r=this.leftConeSides.next(r))if(r.item===e)return r;return null},s.VertexIsToTheLeftOfSegment=function(e,r){return R.getTriangleOrientation(r.Start,r.Start.add(r.Direction),e.Site)===it.Counterclockwise},s.VertexIsToTheRightOfSegment=function(e,r){return R.getTriangleOrientation(r.Start,r.Start.add(r.Direction),e.Site)===it.Clockwise},o.FindFirstSegmentInTheRightTreeNotToTheLeftOfVertex=function(e){return this.rightConeSides.findFirst(function(r){return!s.VertexIsToTheRightOfSegment(e,r)})},o.EnqueueRightVertexEvent=function(e){this.GetZP(e.Site.sub(e.Vertex.prevOnPolyline.point))>q.tolerance||this.EnqueueEvent(e)},o.invariant=function(){for(var r,e=C(this.leftConeSides);!(r=e()).done;)if(r.value.Removed)return!1;for(var c,h=C(this.rightConeSides);!(c=h()).done;)if(c.value.Removed)return!1;return!0},s}(Vs),$i=function(l){function s(t,e){var r;return(r=l.call(this,null)||this).coneAngle=Math.PI/6,r.ports=new qt,r._obstacles=Array.from(_t.OrientHolesClockwise(t)),r._visibilityGraph=e,r}X(s,l),s.mk=function(e,r,i,h,c){var f=new s(e,r);return f.Ports=h,f.BorderPolyline=c,f.ConeAngle=i,f},s.GetTotalSteps=function(e){return Math.floor((2*Math.PI-e/2)/e)+1};var o=s.prototype;return o.run=function(){var e=2*Math.PI-this.coneAngle/2;if(this.Bidirectional)this.HandleBideractionalCase();else for(var r,i=0;(r=this.coneAngle*i)<=e;i++)l.prototype.ProgressStep.call(this),this.AddDirection(new R(Math.cos(r),Math.sin(r)),this.BorderPolyline,this._visibilityGraph)},o.HandleBideractionalCase=function(){for(var e=Math.PI/this.coneAngle,r=0;r<e;r++){var i=r*this.coneAngle,h=new _t;this.AddDirection(new R(Math.cos(i),Math.sin(i)),this.BorderPolyline,h);var c=new _t;this.AddDirection(new R(-1*Math.cos(i),-1*Math.sin(i)),this.BorderPolyline,c),this.AddIntersectionOfBothDirectionSweepsToTheResult(h,c)}},o.AddIntersectionOfBothDirectionSweepsToTheResult=function(e,r){for(var h,i=C(e.Edges);!(h=i()).done;){var c=h.value;null!=r.FindEdgePP(c.SourcePoint,c.TargetPoint)&&this._visibilityGraph.AddEdgePP(c.SourcePoint,c.TargetPoint)}},o.AddDirection=function(e,r,i){Hs.Sweep(this._obstacles,e,this.coneAngle,i,this.Ports,r)},Q(s,[{key:"ConeAngle",get:function(){return this.coneAngle},set:function(e){this.coneAngle=e}},{key:"Ports",get:function(){return this.ports},set:function(e){this.ports=e}},{key:"BorderPolyline",get:function(){return this.borderPolyline},set:function(e){this.borderPolyline=e}},{key:"Bidirectional",get:function(){return this._bidirectional},set:function(e){this._bidirectional=e}}]),s}(Vt),Le=function(l){function s(t){var e;return(e=l.call(this)||this).adjustmentAngle=Math.PI/10,e.hookSize=9,e.curve=t,e.location=e.curve().start,e}X(s,l);var o=s.prototype;return o.mk=function(e,r){var i=new s(e);return i.HookSize=r,i},o.SetLocation=function(e){this.location=e},Q(s,[{key:"Location",get:function(){return this.location}},{key:"Curve",get:function(){return this.curve()}},{key:"AdjustmentAngle",get:function(){return this.adjustmentAngle},set:function(e){this.adjustmentAngle=e}},{key:"HookSize",get:function(){return this.hookSize},set:function(e){this.hookSize=e}}]),s}(jo),Je=function(l){function s(o,t,e){return void 0===e&&(e=new R(0,0)),l.call(this,o,t,e)||this}return X(s,l),s.mk=function(t,e){return new s(t,e)},Q(s,[{key:"LoosePolyline",get:function(){return this.loosePolyline},set:function(t){this.loosePolyline=t}}]),s}(kn),Ze=function(l){function s(){return l.apply(this,arguments)||this}return X(s,l),s.mk=function(t,e){var r=new s;return r.curve=t,r.parameter=e,r},Q(s,[{key:"Location",get:function(){return this.curve.value(this.parameter)},set:function(t){throw new Error("Method should not be called.")}},{key:"Parameter",get:function(){return this.parameter},set:function(t){this.parameter=t}},{key:"Curve",get:function(){return this.curve},set:function(t){this.curve=t}}]),s}(jo),tn=function(){function l(){this.capacityOverflowCoefficient=l.DefaultCapacityOverflowCoefficientMultiplier,this.RotateBundles=!1,this.MaxHubRadius=50,this.MinHubRadius=.1,this.CreateUnderlyingPolyline=!1,this.pathLengthImportance=l.DefaultPathLengthImportance,this.inkImportance=l.DefaultInkImportance,this.edgeSeparation=l.DefaultEdgeSeparation,this._edgeWidthShrinkCoeff=1,this.useCubicBezierSegmentsInsideOfHubs=!1,this.angleThreshold=Math.PI/180*45,this.hubRepulsionImportance=100,this.bundleRepulsionImportance=100,this.minimalRatioOfGoodCdtEdges=.9,this.highestQuality=!0,this.KeepOverlaps=!1,this.StopAfterShortestPaths=!1}var s=l.prototype;return s.toJSON=function(){var t={};return this.capacityOverflowCoefficient!=l.DefaultCapacityOverflowCoefficientMultiplier&&(t.capacityOverflowCoefficient=this.capacityOverflowCoefficient),this.RotateBundles&&(t.RotateBundles=this.RotateBundles),50!=this.MaxHubRadius&&(t.MaxHubRadius=this.MaxHubRadius),.1!=this.MinHubRadius&&(t.MinHubRadius=this.MinHubRadius),this.CreateUnderlyingPolyline&&(t.CreateUnderlyingPolyline=this.CreateUnderlyingPolyline),this.pathLengthImportance!=l.DefaultPathLengthImportance&&(t.pathLengthImportance=this.pathLengthImportance),this.inkImportance!=l.DefaultInkImportance&&(t.inkImportance=this.inkImportance),this.edgeSeparation!=l.DefaultEdgeSeparation&&(t.edgeSeparation=this.edgeSeparation),1!=this._edgeWidthShrinkCoeff&&(t._edgeWidthShrinkCoeff=this._edgeWidthShrinkCoeff),this.useCubicBezierSegmentsInsideOfHubs&&(t.useCubicBezierSegmentsInsideOfHubs=this.useCubicBezierSegmentsInsideOfHubs),this.angleThreshold!=Math.PI/180*45&&(t.angleThreshold=this.angleThreshold),100!=this.hubRepulsionImportance&&(t.hubRepulsionImportance=this.hubRepulsionImportance),100!=this.bundleRepulsionImportance&&(t.bundleRepulsionImportance=this.bundleRepulsionImportance),.9!=this.minimalRatioOfGoodCdtEdges&&(t.minimalRatioOfGoodCdtEdges=this.minimalRatioOfGoodCdtEdges),this.highestQuality||(t.highestQuality=this.highestQuality),this.KeepOverlaps&&(t.KeepOverlaps=this.KeepOverlaps),this.StopAfterShortestPaths&&(t.StopAfterShortestPaths=this.StopAfterShortestPaths),t},l.createFromJSON=function(t){var e=new l;return t.capacityOverflowCoefficient&&(e.capacityOverflowCoefficient=t.capacityOverflowCoefficient),t.RotateBundles&&(e.RotateBundles=t.RotateBundles),t.MaxHubRadius&&(e.MaxHubRadius=t.MaxHubRadius),t.MinHubRadius&&(e.MinHubRadius=t.MinHubRadius),t.CreateUnderlyingPolyline&&(e.CreateUnderlyingPolyline=t.CreateUnderlyingPolyline),t.pathLengthImportance&&(e.pathLengthImportance=t.pathLengthImportance),t.inkImportance&&(e.inkImportance=t.inkImportance),t.edgeSeparation&&(e.edgeSeparation=t.edgeSeparation),t._edgeWidthShrinkCoeff&&(e._edgeWidthShrinkCoeff=t._edgeWidthShrinkCoeff),t.useCubicBezierSegmentsInsideOfHubs&&(e.useCubicBezierSegmentsInsideOfHubs=t.useCubicBezierSegmentsInsideOfHubs),t.angleThreshold&&(e.angleThreshold=t.angleThreshold),t.hubRepulsionImportance&&(e.hubRepulsionImportance=t.hubRepulsionImportance),t.bundleRepulsionImportance&&(e.bundleRepulsionImportance=t.bundleRepulsionImportance),t.minimalRatioOfGoodCdtEdges&&(e.minimalRatioOfGoodCdtEdges=t.minimalRatioOfGoodCdtEdges),t.highestQuality&&(e.HighestQuality=t.highestQuality),t.KeepOverlaps&&(e.KeepOverlaps=t.KeepOverlaps),t.StopAfterShortestPaths&&(e.StopAfterShortestPaths=t.StopAfterShortestPaths),e},s.ActualEdgeWidth=function(t,e){return void 0===e&&(e=this.edgeWidthShrinkCoeff),e*(this.edgeSeparation+t.lineWidth)},Q(l,[{key:"CapacityOverflowCoefficient",get:function(){return this.capacityOverflowCoefficient},set:function(t){this.capacityOverflowCoefficient=t}},{key:"PathLengthImportance",get:function(){return this.pathLengthImportance},set:function(t){this.pathLengthImportance=t}},{key:"InkImportance",get:function(){return this.inkImportance},set:function(t){this.inkImportance=t}},{key:"EdgeSeparation",get:function(){return this.edgeSeparation},set:function(t){this.edgeSeparation=t}},{key:"edgeWidthShrinkCoeff",get:function(){return this._edgeWidthShrinkCoeff},set:function(t){this._edgeWidthShrinkCoeff=t}},{key:"UseCubicBezierSegmentsInsideOfHubs",get:function(){return this.useCubicBezierSegmentsInsideOfHubs},set:function(t){this.useCubicBezierSegmentsInsideOfHubs=t}},{key:"AngleThreshold",get:function(){return this.angleThreshold},set:function(t){this.angleThreshold=t}},{key:"HubRepulsionImportance",get:function(){return this.hubRepulsionImportance},set:function(t){this.hubRepulsionImportance=t}},{key:"BundleRepulsionImportance",get:function(){return this.bundleRepulsionImportance},set:function(t){this.bundleRepulsionImportance=t}},{key:"MinimalRatioOfGoodCdtEdges",get:function(){return this.minimalRatioOfGoodCdtEdges},set:function(t){this.minimalRatioOfGoodCdtEdges=t}},{key:"HighestQuality",get:function(){return this.highestQuality},set:function(t){this.highestQuality=t}}]),l}();tn.DefaultCapacityOverflowCoefficientMultiplier=1e3,tn.DefaultPathLengthImportance=500,tn.DefaultInkImportance=.01,tn.DefaultEdgeSeparation=.5;var Xo=function(l){function s(o){var t;return(t=l.call(this,null)||this).node=o,t}return X(s,l),Q(s,[{key:"BoundaryCurve",get:function(){return this.node.boundaryCurve},set:function(t){if(t)throw new Error("Cannot set BoundaryCurve directly for RelativeShape")}}]),s}(Xi);function $o(){$o=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var bh=$o().mark(Zi),Eh=function(){function l(){}return l.GetShapes=function(o,t){for(var i,e=new Map,r=C(o);!(i=r()).done;){var h=i.value;l.ProcessAncestorDescendantCouple(h.target,h.source,e),l.InsertEdgePortsToShapes(e,h)}for(var f,c=C(t);!(f=c()).done;){var p=f.value;l.ProcessAncestorDescendantCouple(p.source,p.target,e),l.InsertEdgePortsToShapes(e,p)}return l.BindShapes(e),Array.from(e.values())},l.InsertEdgePortsToShapes=function(o,t){o.get(t.target).Ports.add(t.targetPort),o.get(t.source).Ports.add(t.sourcePort)},l.BindShapes=function(o){for(var e,t=C(o);!(e=t()).done;){var r=e.value,i=r[0],h=r[1];if(i instanceof Ae)for(var p,f=C(Zi(i));!(p=f()).done;){var m=o.get(p.value);m&&h.AddChild(m)}}},l.ProcessAncestorDescendantCouple=function(o,t,e){for(var r=Ji(t);;){for(var h,i=C(Zi(r));!(h=i()).done;)l.CreateShapeIfNeeeded(h.value,e);if(r===o)break;r=Ji(r)}l.CreateShapeIfNeeeded(r,e)},l.CreateShapeIfNeeeded=function(o,t){t.has(o)||t.set(o,new Xo(o))},l.NumberOfActiveNodesIsUnderThreshold=function(o,t,e){for(var h,r=new Set,i=C(o);!(h=i()).done;){var c=h.value;if(l.SetOfActiveNodesIsLargerThanThreshold(c.target,c.source,r,e))return!1}for(var p,f=C(t);!(p=f()).done;){var y=p.value;if(l.SetOfActiveNodesIsLargerThanThreshold(y.source,y.target,r,e))return!1}return!0},l.SetOfActiveNodesIsLargerThanThreshold=function(o,t,e,r){for(var i=Ji(t);;){for(var c,h=C(Zi(i));!(c=h()).done;)if(e.add(c.value),e.size>r)return!0;if(i===o)break;i=Ji(i)}return e.add(i),e.size>r},l}();function Ji(l){return at.getGeom(l.node.parent)}function Zi(l){var s,o,t;return $o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:s=C(l.graph.shallowNodes);case 1:if((o=s()).done){r.next=7;break}return t=o.value,r.next=5,at.getGeom(t);case 5:r.next=1;break;case 7:case"end":return r.stop()}},bh)}function en(){en=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Rr=function(){function l(o){this.stamp=0,this.SetPivotAndAllocateHullPointsArray(o)}var s=l.prototype;return s.SetPivotAndAllocateHullPointsArray=function(t){this.pivot=new R(0,Number.MAX_SAFE_INTEGER);for(var h,e=-1,r=0,i=C(t);!(h=i()).done;){var c=h.value;(c.y<this.pivot.y||c.y===this.pivot.y&&c.x>this.pivot.x)&&(this.pivot=c,e=r),r++}if(r>=1){this.hullPoints=new Array(r-1),r=0;for(var p,f=C(t);!(p=f()).done;)r!==e?this.hullPoints[r++]={point:p.value,deleted:!1,stamp:this.stamp++}:e=-1}},l.CalculateConvexHull=en().mark(function o(t){var e,r,i,h;return en().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:e=new l(t),r=C(e.Calculate());case 2:if((i=r()).done){f.next=8;break}return h=i.value,f.next=6,h;case 6:f.next=2;break;case 8:case"end":return f.stop()}},o)}),s.Calculate=en().mark(function o(){var t,e,r;return en().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.pivot.y!==Number.MAX_SAFE_INTEGER){h.next=2;break}return h.abrupt("return");case 2:if(0!==this.hullPoints.length){h.next=6;break}return h.next=5,this.pivot;case 5:return h.abrupt("return");case 6:this.SortAllPointsWithoutPivot(),this.Scan(),t=C(this.EnumerateStack());case 9:if((e=t()).done){h.next=15;break}return r=e.value,h.next=13,r;case 13:h.next=9;break;case 15:case"end":return h.stop()}},o,this)}),s.EnumerateStack=en().mark(function o(){var t;return en().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=this.stack;case 1:if(null==t){r.next=7;break}return r.next=4,t.point;case 4:t=t.next,r.next=1;break;case 7:case"end":return r.stop()}},o,this)}),s.Scan=function(){for(var t=0;this.hullPoints[t].deleted;)t++;for(this.stack={point:this.pivot,next:null},this.Push(t++),t<this.hullPoints.length&&(this.hullPoints[t].deleted?t++:this.Push(t++));t<this.hullPoints.length;)this.hullPoints[t].deleted?t++:this.LeftTurn(t)?this.Push(t++):this.Pop();for(;this.StackHasMoreThanTwoPoints()&&!this.LeftTurnToPivot();)this.Pop()},s.LeftTurnToPivot=function(){return R.getTriangleOrientation(this.StackSecondPoint,this.StackTopPoint,this.pivot)===it.Counterclockwise},s.StackHasMoreThanTwoPoints=function(){return null!=this.stack.next&&null!=this.stack.next.next},s.Pop=function(){this.stack=this.stack.next},s.LeftTurn=function(t){if(null==this.stack.next)return!0;var e=R.getTriangleOrientationWithIntersectionEpsilon(this.StackSecondPoint,this.StackTopPoint,this.hullPoints[t].point);return e===it.Counterclockwise||e!==it.Clockwise&&this.BackSwitchOverPivot(this.hullPoints[t].point)},s.BackSwitchOverPivot=function(t){return null==this.stack.next.next&&this.StackTopPoint.x>this.pivot.x+q.distanceEpsilon&&t.x<this.pivot.x-q.distanceEpsilon},s.Push=function(t){this.stack={point:this.hullPoints[t].point,next:this.stack}},s.SortAllPointsWithoutPivot=function(){this.hullPoints.sort(function(l){return function(s,o){if(s===o)return 0;if(null==s)return-1;if(null==o)return 1;switch(R.getTriangleOrientationWithIntersectionEpsilon(l,s.point,o.point)){case it.Counterclockwise:return-1;case it.Clockwise:return 1;case it.Collinear:var t=s.point.x-l.x,e=o.point.x-l.x;if(t>q.distanceEpsilon&&e<-q.distanceEpsilon)return-1;if(t<-q.distanceEpsilon&&e>q.distanceEpsilon)return 1;var r=s.point.sub(l),i=o.point.sub(l),h=r.l1-i.l1;return h<0?(s.deleted=!0,-1):h>0?(o.deleted=!0,1):(s.stamp>o.stamp?s.deleted=!0:o.deleted=!0,0)}throw new Error}}(this.pivot))},l.createConvexHullAsClosedPolyline=function(t){return vt.mkClosedFromPoints(Array.from(l.CalculateConvexHull(t)))},Q(l,[{key:"StackTopPoint",get:function(){return this.stack.point}},{key:"StackSecondPoint",get:function(){return this.stack.next.point}}]),l}();function me(l,s,o){l.irect.intersects_rect(s.irect)&&(null==l.Left?null==s.Left?o(l.UserData,s.UserData):(me(l,s.Left,o),me(l,s.Right,o)):null!=s.Left?(me(l.Left,s.Left,o),me(l.Left,s.Right,o),me(l.Right,s.Left,o),me(l.Right,s.Right,o)):(me(l.Left,s,o),me(l.Right,s,o)))}function le(l,s,o){l.irect.intersects_rect(s.irect)&&(l===s?function(l,s){null!=l.Left&&(le(l.Left,l.Left,s),le(l.Left,l.Right,s),le(l.Right,l.Right,s))}(l,o):null==l.Left?null==s.Left?o(l.UserData,s.UserData):(le(l,s.Left,o),le(l,s.Right,o)):null!=s.Left?(le(l.Left,s.Left,o),le(l.Left,s.Right,o),le(l.Right,s.Left,o),le(l.Right,s.Right,o)):(le(l.Left,s,o),le(l.Right,s,o)))}function Re(l,s,o){if(!l.irect.intersects_rect(s.irect))return!1;if(l===s)return function(l,s){return null!=l.Left&&(Re(l.Left,l.Left,s)||Re(l.Left,l.Right,s)||Re(l.Right,l.Right,s))}(l,o);if(null==l.Left){if(null==s.Left)return o(l.UserData,s.UserData);if(Re(l,s.Left,o)||Re(l,s.Right,o))return!0}else if(null!=s.Left){if(Re(l.Left,s.Left,o)||Re(l.Left,s.Right,o)||Re(l.Right,s.Left,o)||Re(l.Right,s.Right,o))return!0}else if(Re(l.Left,s,o)||Re(l.Right,s,o))return!0;return!1}var rn,_s=BigInt("6364136223846793005"),Jo=(BigInt(1)<<BigInt(32))-BigInt(1),cr=(BigInt(1)<<BigInt(64))-BigInt(1),Ki=function(){function l(o,t){this._state=BigInt(0),this._inc=(BigInt(t)<<BigInt(1)|BigInt(1))&cr,this._random_b(),this._state=this._state+BigInt(o)&cr,this._random_b()}var s=l.prototype;return s._random_b=function(){var t=this._state;this._state=t*_s+this._inc&cr;var e=(t>>BigInt(18)^t)>>BigInt(27),r=t>>BigInt(59);return(e>>r|e<<(r^BigInt(31)))&Jo},s._advance=function(t){t&=cr;for(var e=BigInt(1),r=_s,i=BigInt(0),h=this._inc;t>0;)t&BigInt(1)&&(e=e*r&cr,i=i*r+h&cr),h=(r+BigInt(1))*h&cr,r=r*r&cr,t>>=BigInt(1);this._state=e*this._state+i&cr},s.randint=function(t){if(t>Jo)throw new TypeError("Bound too large: "+t);if(t<=0)throw new TypeError("Empty sample space for r: 0 \u2264 r < "+t);for(var e=BigInt(t),r=(Jo^e)%e;;){var i=this._random_b();if(i>=r)return Number(i%e)}},s.random=function(){return Number(this._random_b())/Math.pow(2,32)},l}();function di(l){return null==rn&&(rn=new Ki(0,0)),rn.randint(l)}function to(l){rn=new Ki(l,0)}function nn(){return null==rn&&(rn=new Ki(0,0)),rn.random()}function vi(){vi=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var xh=vi().mark(on),Th=vi().mark(zs);function on(l){var s,o,t,e,r,i,h;return vi().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:s=new Array(l.nodeCount).fill(!1),o=new ye.c,t=0;case 3:if(!(t<l.nodeCount)){p.next=13;break}if(s[t]){p.next=10;break}for(e=new Array,qs(t,o,s);o.length>0;)for(r=o.dequeue(),e.push(r),i=C(zs(l,r));!(h=i()).done;)qs(h.value,o,s);return p.next=10,e;case 10:t++,p.next=3;break;case 13:case"end":return p.stop()}},xh)}function zs(l,s){var o,t,e,r,i,h;return vi().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:o=C(l.outEdges[s]);case 1:if((t=o()).done){f.next=7;break}return e=t.value,f.next=5,e.target;case 5:f.next=1;break;case 7:r=C(l.inEdges[s]);case 8:if((i=r()).done){f.next=14;break}return h=i.value,f.next=12,h.source;case 12:f.next=8;break;case 14:case"end":return f.stop()}},Th)}function qs(l,s,o){!1===o[l]&&(s.enqueue(l),o[l]=!0)}function fr(){fr=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}function eo(l){var s=new an;return s.SetEdges(l,an.vertexCount(l)),s}function Us(l){var s=new an;return s.SetEdges(l,an.vertexCount(l)),s}function Ke(l,s){var o=new an;return o.SetEdges(l,s),o}var ee,an=function(){function l(){this.nodeCount=0}var s=l.prototype;return s.incidentEdges=fr().mark(function o(t){var e,r,i,h,c,f;return fr().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.outEdges[t]);case 1:if((r=e()).done){y.next=7;break}return i=r.value,y.next=5,i;case 5:y.next=1;break;case 7:h=C(this.inEdges[t]);case 8:if((c=h()).done){y.next=14;break}return f=c.value,y.next=12,f;case 12:y.next=8;break;case 14:case"end":return y.stop()}},o,this)}),l.deleteFromArray=function(t,e){var r=t.indexOf(e,0);r>-1&&t.splice(r,1)},s.removeEdge=function(t){l.deleteFromArray(this.edges,t),t.source!==t.target?(l.deleteFromArray(this.outEdges[t.source],t),l.deleteFromArray(this.inEdges[t.target],t)):l.deleteFromArray(this.selfEdges[t.source],t)},l.vertexCount=function(t){for(var i,e=0,r=C(t);!(i=r()).done;){var h=i.value;h.source>=e&&(e=h.source),h.target>=e&&(e=h.target)}return++e},s.SetEdges=function(t,e){this.edges=t,this.nodeCount=e;var r=new Array(this.nodeCount).fill(0),i=new Array(this.nodeCount).fill(0),h=new Array(this.nodeCount).fill(0);this.outEdges=new Array(this.nodeCount),this.inEdges=new Array(this.nodeCount),this.selfEdges=new Array(this.nodeCount);for(var f,c=C(this.edges);!(f=c()).done;){var p=f.value;p.source!==p.target?(r[p.source]++,i[p.target]++):h[p.source]++}for(var y=0;y<this.nodeCount;y++)this.outEdges[y]=new Array(r[y]),r[y]=0,this.inEdges[y]=new Array(i[y]),i[y]=0,this.selfEdges[y]=new Array(h[y]),h[y]=0;for(var P,m=C(this.edges);!(P=m()).done;){var L=P.value,E=L.source,S=L.target;E!==S?(this.outEdges[E][r[E]++]=L,this.inEdges[S][i[S]++]=L):this.selfEdges[E][h[E]++]=L}},s.inEdgesCount=function(t){return this.inEdges[t].length},s.outEdgesCount=function(t){return this.outEdges[t].length},s.selfEdgesCount=function(t){return this.selfEdges[t].length},s.addEdge=function(t){this.edges.push(t),t.source!==t.target?(this.outEdges[t.source].push(t),this.inEdges[t.target].push(t)):this.selfEdges[t.source].push(t)},s.nodesOfConnectedGraph=fr().mark(function o(){var t,e,r,i,h,f,p,y,P;return fr().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(0!==this.edges.length){E.next=2;break}return E.abrupt("return");case 2:return t=new Set,e=new ye.c,l.enqueue(t,e,r=this.edges[0].source),E.next=8,r;case 8:if(!(e.length>0)){E.next=32;break}r=e.dequeue(),i=C(this.outEdges[r]);case 11:if((h=i()).done){E.next=20;break}if(t.has(f=h.value.target)){E.next=18;break}return l.enqueue(t,e,f),E.next=18,f;case 18:E.next=11;break;case 20:p=C(this.inEdges[r]);case 21:if((y=p()).done){E.next=30;break}if(t.has(P=y.value.source)){E.next=28;break}return l.enqueue(t,e,P),E.next=28,P;case 28:E.next=21;break;case 30:E.next=8;break;case 32:case"end":return E.stop()}},o,this)}),s.pred=fr().mark(function o(t){var e,r,i;return fr().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.inEdges[t]);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i.source;case 5:c.next=1;break;case 7:case"end":return c.stop()}},o,this)}),s.succ=fr().mark(function o(t){var e,r,i;return fr().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.outEdges[t]);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i.target;case 5:c.next=1;break;case 7:case"end":return c.stop()}},o,this)}),l.enqueue=function(t,e,r){e.enqueue(r),t.add(r)},l}(),Lt=function(){function l(o,t){this.x=o,this.y=t}return l.prototype.isDiagonal=function(){return this.x===this.y},Q(l,[{key:"source",get:function(){return this.x}},{key:"target",get:function(){return this.y}}]),l}();!function(l){l[l.Increasing=0]="Increasing",l[l.Decreasing=1]="Decreasing",l[l.Extremum=2]="Extremum"}(ee||(ee={}));var ro=function(){function l(o,t){this.f=o,this.length=t}var s=l.prototype;return s.FindMinimum=function(){var t=0,e=this.length-1,r=t+Math.floor((e-t)/2),i=this.f(r);if(i>=this.f(0)&&i>=this.f(this.length-1))return this.f(0)<this.f(this.length-1)?0:this.length-1;for(;e-t>1;)switch(r=t+Math.floor((e-t)/2),this.BehaviourAtIndex(r)){case ee.Decreasing:t=r;break;case ee.Increasing:e=r;break;case ee.Extremum:return r}return t===e||this.f(t)<=this.f(e)?t:e},s.BehaviourAtIndex=function(t){var e=this.f(t);if(0===t){var r=this.f(1);return r===e?ee.Extremum:r>e?ee.Increasing:ee.Decreasing}if(t===this.length-1){var i=this.f(this.length-2);return i===e?ee.Extremum:i>e?ee.Decreasing:ee.Increasing}var h=e-this.f(t-1);return h*(this.f(t+1)-e)<=0?ee.Extremum:h>0?ee.Increasing:ee.Decreasing},s.FindMaximum=function(){var t=0,e=this.length-1,r=t+Math.floor((e-t)/2),i=this.f(r);if(i<=this.f(0)&&i<=this.f(this.length-1))return this.f(0)>this.f(this.length-1)?0:this.length-1;for(;e-t>1;)switch(r=t+Math.floor((e-t)/2),this.BehaviourAtIndex(r)){case ee.Decreasing:e=r;break;case ee.Increasing:t=r;break;case ee.Extremum:return r}return t===e||this.f(t)>=this.f(e)?t:e},Q(l,[{key:"Sequence",get:function(){return this.f},set:function(t){this.f=t}},{key:"Length",get:function(){return this.length},set:function(t){this.length=t}}]),l}(),Oh=function(){function l(o,t){this.f=o,this.length=t}var s=l.prototype;return s.toArray=function(){for(var t=[],e=0;e<this.length;e++)t.push(this.f(e));return t},s.GetAdjustedSequenceForMinimum=function(){var t=this,e=this.f(0),i=(this.f(this.length-1)-e)/(this.length-1);return function(h){return Math.min(t.f(h),e+i*h)}},s.GetAdjustedSequenceForMaximum=function(){var t=this,e=this.f(0),i=(this.f(this.length-1)-e)/(this.length-1);return function(h){return Math.max(t.f(h),e+i*h)}},s.FindMinimum=function(){return this.f(0)===this.f(this.length-1)?new ro(this.f,this.length).FindMinimum():new ro(this.GetAdjustedSequenceForMinimum(),this.length).FindMinimum()},s.FindMaximum=function(){return this.f(0)===this.f(this.length-1)?new ro(this.f,this.length).FindMaximum():new ro(this.GetAdjustedSequenceForMaximum(),this.length).FindMaximum()},l}(),Ys=function(){function l(o,t){this.P=o,this.Q=t}var s=l.prototype;return s.LeftFromLineOnP=function(t,e,r){var i=this.P.pnt(t);return this.upperBranchOnP?R.pointToTheLeftOfLineOrOnLine(r,i,e):R.pointToTheRightOfLineOrOnLine(r,i,e)},s.LeftFromLineOnQ=function(t,e,r){var i=this.Q.pnt(t);return this.lowerBranchOnQ?R.pointToTheLeftOfLineOrOnLine(r,i,e):R.pointToTheRightOfLineOrOnLine(r,i,e)},s.PrevOnP=function(t){return this.upperBranchOnP?this.P.Prev(t):this.P.Next(t)},s.PrevOnQ=function(t){return this.lowerBranchOnQ?this.Q.Prev(t):this.Q.Next(t)},s.NextOnP=function(t){return this.upperBranchOnP?this.P.Next(t):this.P.Prev(t)},s.NextOnQ=function(t){return this.lowerBranchOnQ?this.Q.Next(t):this.Q.Prev(t)},s.MedianOnP=function(t,e){return this.upperBranchOnP?this.P.Median(t,e):this.P.Median(e,t)},s.MedianOnQ=function(t,e){return this.lowerBranchOnQ?this.Q.Median(t,e):this.Q.Median(e,t)},s.ModuleP=function(t,e){return this.P.Module(this.upperBranchOnP?e-t:t-e)},s.ModuleQ=function(t,e){return this.Q.Module(this.lowerBranchOnQ?e-t:t-e)},s.TangentBetweenBranches=function(t,e,r,i){for(;e!==t||i!==r;){var h=e!==t?this.MedianOnP(t,e):t,c=i!==r?this.MedianOnQ(r,i):r,f=this.P.pnt(h),p=this.Q.pnt(c),y=!0;this.ModuleP(t,e)>1?this.LeftFromLineOnP(this.NextOnP(h),f,p)?t=h:this.LeftFromLineOnP(this.PrevOnP(h),f,p)?e=h:y=!1:e!==t?this.LeftFromLineOnP(e,this.P.pnt(t),p)?t=e:this.LeftFromLineOnP(t,this.P.pnt(e),p)?e=t:y=!1:y=!1;var m=!0;this.ModuleQ(r,i)>1?this.LeftFromLineOnQ(this.NextOnQ(c),p,f)?r=c:this.LeftFromLineOnQ(this.PrevOnQ(c),p,f)?i=c:m=!1:i!==r?this.LeftFromLineOnQ(i,this.Q.pnt(r),f)?r=i:this.LeftFromLineOnQ(r,this.Q.pnt(i),f)?i=r:m=!1:m=!1,!y&&!m&&(t=h,e=h,r=c,i=c)}return[t,i]},s.FindDividingBisector=function(t){var e={pClosest:void 0,qClosest:void 0,p1:void 0,p2:void 0,q1:void 0,q2:void 0};this.FindClosestFeatures(e),t.bisectorPivot=R.middle(e.pClosest,e.qClosest),t.bisectorRay=e.pClosest.sub(e.qClosest).rotate(Math.PI/2),t.p1=e.p1,t.p2=e.p2,t.q1=e.q1,t.q2=e.q2},s.FindClosestPoints=function(){var t={q2:void 0,p1:void 0,p2:void 0,q1:void 0,pClosest:void 0,qClosest:void 0};return this.FindClosestFeatures(t),{pClosest:t.pClosest,qClosest:t.qClosest}},s.FindClosestFeatures=function(t){var e={leftTangentPoint:void 0,rightTangentPoint:void 0};this.P.GetTangentPoints(e,this.Q.pp(0).point),t.p2=e.leftTangentPoint,t.p1=e.rightTangentPoint,t.p2===t.p1&&(t.p2+=this.P.count),this.Q.GetTangentPoints(e,this.P.pp(0).point),t.q1=e.leftTangentPoint,t.q2=e.rightTangentPoint,t.q2===t.q1&&(t.q2+=this.Q.count),this.FindClosestPoints_(t)},s.FindClosestPoints_=function(t){for(;this.ChunksAreLong(t.p2,t.p1,t.q2,t.q1);)this.ShrinkChunks(t);t.p1===t.p2?(t.pClosest=this.P.pp(t.p2).point,t.q1===t.q2?t.qClosest=this.Q.pp(t.q1).point:(t.qClosest=R.ClosestPointAtLineSegment(t.pClosest,this.Q.pp(t.q1).point,this.Q.pp(t.q2).point),R.closeDistEps(t.qClosest,this.Q.pnt(t.q1))?t.q2=t.q1:R.closeDistEps(t.qClosest,this.Q.pnt(t.q2))&&(t.q1=t.q2))):(t.qClosest=this.Q.pp(t.q1).point,t.pClosest=R.ClosestPointAtLineSegment(t.qClosest,this.P.pp(t.p1).point,this.P.pp(t.p2).point),R.closeDistEps(t.pClosest,this.P.pnt(t.p1))?t.p2=t.p1:R.closeDistEps(t.qClosest,this.P.pnt(t.p2))&&(t.p1=t.p2))},s.ChunksAreLong=function(t,e,r,i){var h=this.P.Module(t-e)+1;if(h>2)return!0;var c=this.Q.Module(i-r)+1;return c>2||2===h&&2===c},s.ShrinkChunks=function(t){var e=t.p1===t.p2?t.p1:this.P.Median(t.p1,t.p2),r=t.q1===t.q2?t.q1:this.Q.Median(t.q2,t.q1),i=this.P.pp(e).point,h=this.Q.pp(r).point,c={a1:void 0,a2:void 0,b1:void 0,b2:void 0};if(this.GetAnglesAtTheMedian(e,r,i,h,c),!this.InternalCut(t,e,r,c.a1,c.a2,c.b1,c.b2)&&!l.OneOfChunksContainsOnlyOneVertex(t,e,r,c.a1,c.b1)&&!this.OnlyOneChunkContainsExactlyTwoVertices(t,{mp:e,mq:r},c)){if(t.p2===this.P.Next(t.p1)&&t.q1===this.Q.Next(t.q2)){var f=Z.minDistBetweenLineSegments(this.P.pnt(t.p1),this.P.pnt(t.p2),this.Q.pnt(t.q1),this.Q.pnt(t.q2));return void(0===f.parab?t.p2=t.p1:1===f.parab?t.p1=t.p2:0===f.parcd?t.q2=t.q1:1===f.parcd&&(t.q1=t.q2))}c.a1<=Math.PI&&c.a2<=Math.PI&&c.b1<=Math.PI&&c.b2<=Math.PI?c.a1+c.b1>Math.PI?c.a1>=Math.PI/2?t.p1=e:t.q1=r:c.a2>=Math.PI/2?t.p2=e:t.q2=r:c.a1>Math.PI?t.p1=e:c.a2>Math.PI?t.p2=e:c.b1>Math.PI?t.q1=r:t.q2=r}},s.InternalCut=function(t,e,r,i,h,c,f){var p=!1;if(i>=Math.PI&&h>=Math.PI){var y=this.P.pp(e).point,m=this.Q.pp(r).point,P=this.P.pp(this.P.Next(e)).point;R.getTriangleOrientation(y,m,this.Q.pp(0).point)===R.getTriangleOrientation(y,m,P)?t.p1=this.P.Next(e):t.p2=this.P.Prev(e),p=!0}if(c>=Math.PI&&f>=Math.PI){var S=this.P.pp(e).point,T=this.Q.pp(r).point,O=this.Q.pp(this.Q.Next(r)).point;R.getTriangleOrientation(S,T,this.P.pp(0).point)===R.getTriangleOrientation(S,T,O)?t.q2=this.Q.Next(r):t.q1=this.Q.Prev(r),p=!0}return p},s.GetAnglesAtTheMedian=function(t,e,r,i,h){h.a1=R.anglePCP(i,r,this.P.pnt(this.P.Prev(t))),h.a2=R.anglePCP(this.P.pnt(this.P.Next(t)),r,i),h.b1=R.anglePCP(this.Q.pnt(this.Q.Next(e)),i,r),h.b2=R.anglePCP(r,i,this.Q.pnt(this.Q.Prev(e)))},s.OnlyOneChunkContainsExactlyTwoVertices=function(t,e,r){var i=t.p2===this.P.Next(t.p1),h=t.q1===this.Q.Next(t.q2);return i&&!h?(this.ProcessShortSide(t,e.mp,e.mq,r.a1,r.b1,r.a2,r.b2),!0):!(!h||i||(this.SwapEverything(t,e,r),this.ProcessShortSide(t,e.mp,e.mq,r.a1,r.b1,r.a2,r.b2),this.SwapEverything(t,e,r),0))},s.SwapEverything=function(t,e,r){this.SwapPq();var i=t.p2;t.p2=t.q1,t.q1=i,i=t.q2,t.q2=t.p1,t.p1=i,i=e.mq,e.mq=e.mp,e.mp=i,i=r.a2,r.a2=r.b1,r.b1=i,i=r.b2,r.b2=r.a1,r.a1=i},s.ProcessShortSide=function(t,e,r,i,h,c,f){e===t.p2?this.ProcessSide(t,r,i,h,f):c<=Math.PI?c+f>=Math.PI?c>=Math.PI/2?t.p2=t.p1:t.q2=r:h>=Math.PI/2?t.q1=r:c<f&&(R.canProject(this.Q.pnt(r),this.P.pp(t.p1).point,this.P.pp(t.p2).point)?t.q1=r:t.p1=t.p2):i+h<=Math.PI?t.p1=t.p2:t.p2=t.p1},s.SwapPq=function(){var t=this.P;this.P=this.Q,this.Q=t},s.ProcessSide=function(t,e,r,i,h){var c=this.Q.pnt(e);r<=Math.PI?r+i>=Math.PI?r>=Math.PI/2?t.p1=t.p2:t.q1=e:h>=Math.PI/2?t.q2=e:r<h&&(R.canProject(c,this.P.pp(t.p1).point,this.P.pp(t.p2).point)?t.q2=e:t.p2=t.p1):(t.p2=t.p1,i>=Math.PI?t.q1=e:h>=Math.PI&&(t.q2=e))},l.OneOfChunksContainsOnlyOneVertex=function(t,e,r,i,h){return t.p1===t.p2?(h>=Math.PI/2?t.q1=r:t.q2=r,!0):t.q1===t.q2&&(i>=Math.PI/2?t.p1=e:t.p2=e,!0)},s.CalculateLeftTangents=function(){var t={bisectorPivot:null,bisectorRay:null,p1:0,p2:0,q1:0,q2:0};this.FindDividingBisector(t);var e=this.P.FindTheFurthestVertexFromBisector(t.p1,t.p2,t.bisectorPivot,t.bisectorRay),r=this.Q.FindTheFurthestVertexFromBisector(t.q2,t.q1,t.bisectorPivot,t.bisectorRay);this.upperBranchOnP=!1,this.lowerBranchOnQ=!0,this.leftPLeftQ=this.TangentBetweenBranches(e,t.p1,r,t.q1),this.lowerBranchOnQ=!1,this.leftPRightQ=this.TangentBetweenBranches(e,t.p1,r,t.q2)},s.CalculateRightTangents=function(){var t={bisectorPivot:null,bisectorRay:null,p1:0,p2:0,q1:0,q2:0};this.FindDividingBisector(t);var e=this.P.FindTheFurthestVertexFromBisector(t.p1,t.p2,t.bisectorPivot,t.bisectorRay),r=this.Q.FindTheFurthestVertexFromBisector(t.q2,t.q1,t.bisectorPivot,t.bisectorRay);this.upperBranchOnP=!0,this.lowerBranchOnQ=!0,this.rightPLeftQ=this.TangentBetweenBranches(e,t.p2,r,t.q1),this.lowerBranchOnQ=!1,this.rightPRightQ=this.TangentBetweenBranches(e,t.p2,r,t.q2)},l}(),We=function(){function l(o){this.polyline=o,this.points=new Array;for(var t=this.polyline.startPoint;t;t=t.next)this.points.push(t)}l.mkFromPoints=function(t){return new l(vt.mkClosedFromPoints(t))};var s=l.prototype;return s.Next=function(t){return this.Module(t+1)},s.Prev=function(t){return this.Module(t-1)},s.Module=function(t){return t<0?t+this.count:t<this.count?t:t-this.count},s.pp=function(t){return this.points[this.Module(t)]},s.pnt=function(t){return this.pp(t).point},s.toString=function(){return this.polyline.toString()},s.Median=function(t,e){return e>t?Math.floor((e+t)/2):this.Module(e+Math.floor((this.count+t)/2))},s.FindTheFurthestVertexFromBisector=function(t,e,r,i){var h=i.rotate(Math.PI/2);this.polyline.startPoint.point.sub(r).dot(h)<0&&(h=h.mul(-1)),t===e&&(e=this.Next(t));do{var c=this.Median(e,t),f=this.pnt(c);this.pnt(this.Next(c)).sub(f).dot(h)>=0?e=this.Next(c):this.pnt(this.Prev(c)).sub(f).dot(h)>=0?t=this.Prev(c):e=c,t=c}while(t!==e);return t},l.TestPolygonDist=function(t,e){for(var r=Number.MAX_SAFE_INTEGER,i=0;i<t.count;i++)for(var h=0;h<e.count;h++){var c=Z.minDistBetweenLineSegments(t.pnt(i),t.pnt(i+1),e.pnt(h),e.pnt(h+1));r=Math.min(r,c.dist)}return r},l.Distance=function(t,e){var i=new Ys(t,e).FindClosestPoints();return{p:i.pClosest,q:i.qClosest,dist:i.pClosest.sub(i.qClosest).length}},l.DistanceOnly=function(t,e){return l.Distance(t,e).dist},l.PolygonIsLegalDebug=function(t){for(var r=t.Polyline.startPoint;null!=r.next&&null!=r.next.next;r=r.next)if(R.getTriangleOrientation(r.point,r.next.point,r.next.next.point)===it.Collinear)return!1;return!0},l.DistancePoint=function(t,e){for(var r=Number.MAX_VALUE,i=0;i<t.count;i++){var h=R.distToLineSegment(e,t.points[i].point,t.points[(i+1)%t.count].point).dist;r=Math.min(r,h)}return r},s.GetTangentPoints=function(t,e){var r=new Oh(this.GetSequenceDelegate(e),this.count);t.leftTangentPoint=r.FindMaximum(),t.rightTangentPoint=r.FindMinimum()},s.GetSequenceDelegate=function(t){var e=this,r=this.pnt(0);return function(i){var h=R.anglePCP(r,t,e.pnt(i));return h<Math.PI?h:h-2*Math.PI}},Q(l,[{key:"Polyline",get:function(){return this.polyline}},{key:"count",get:function(){return this.Polyline.count}}]),l}();function Zo(){Zo=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ie=function(){function l(o,t,e,r){this.randomizationShift=.01,this.TightObstacles=new Set,this.Obstacles=o,this.TightPadding=t,this.LoosePadding=e,this.IgnoreTightPadding=r}var s=l.prototype;return s.ObstaclesIntersectLine=function(t,e){return this.ObstaclesIntersectICurve(Z.mkPP(t,e))},l.PadCorner=function(t,e,r,i,h){var c=l.GetPaddedCorner(e,r,i,h);return-1!==c.numberOfPoints&&(t.addPoint(c.a),2===c.numberOfPoints&&t.addPoint(c.b),!0)},l.CurveIsClockwise=function(t,e){return R.getTriangleOrientation(e,t.start,t.start.add(t.derivative(t.parStart)))==it.Clockwise},l.PaddedPolylineBoundaryOfNode=function(t,e,r){return void 0===r&&(r=!1),l.CreatePaddedPolyline(K.polylineAroundClosedCurve(t),e,r)},l.LoosePolylineWithFewCorners=function(t,e,r){return e<q.distanceEpsilon?t:l.CreateLoosePolylineOnBisectors(t,e,r)},l.CreateLoosePolylineOnBisectors=function(t,e,r){var i=Array.from(l.BisectorPoints(t,e));r&&function(){for(var f=0;f<i.length;f++){var p=i[f];i[f]=new R(p.x+(2*nn()-1)*r,p.y+(2*nn()-1)*r)}}();var h=Rr.CalculateConvexHull(i);return vt.mkClosedFromPoints(h)},l.CreateRectNodeOfPolyline=function(t){return Qt(t,t.boundingBox)},s.CreateLooseObstacles=function(){this.tightPolylinesToLooseDistances=new Map,this.LooseObstacles=new Array;for(var e,t=C(this.TightObstacles);!(e=t()).done;){var r=e.value,i=l.FindMaxPaddingForTightPolyline(this.RootOfTightHierarchy,r,this.LoosePadding);this.tightPolylinesToLooseDistances.set(r,i),this.LooseObstacles.push(l.LoosePolylineWithFewCorners(r,i,this.randomizationShift))}this.RootOfLooseHierarchy=l.CalculateHierarchy(this.LooseObstacles)},s.CreateTightObstacles=function(){this.RootOfTightHierarchy=this.CreateTightObstacles_(),this.OverlapsDetected=this.TightObstacles.size<this.Obstacles.length},s.Calculate=function(){this.IgnoreTightPadding?this.CreateTightObstaclesIgnoringTightPadding():this.CreateTightObstacles(),this.IsEmpty()||this.CreateLooseObstacles()},s.IsEmpty=function(){return null==this.TightObstacles||0===this.TightObstacles.size},s.ObstaclesIntersectICurve=function(t){return l.CurveIntersectsRectangleNode(t,t.boundingBox,this.RootOfTightHierarchy)},l.CurveIntersectsRectangleNode=function(t,e,r){if(!r.irect.intersects(e))return!1;if(null!=r.UserData){var i=r.UserData;return null!=K.intersectionOne(i,t,!1)||l.PointIsInside(i.start,t)}return l.CurveIntersectsRectangleNode(t,e,r.Left)||l.CurveIntersectsRectangleNode(t,e,r.Right)},l.PointIsInside=function(t,e){return K.PointRelativeToCurveLocation(t,e)===ht.Inside},s.CreateTightObstaclesIgnoringTightPadding=function(){var t=this.Obstacles.map(function(P){return K.polylineAroundClosedCurve(P)}),e=l.CalculateHierarchy(t),r=l.GetOverlappedPairSet(e);if(this.TightObstacles=new Set,0===r.size){for(var h,i=C(t);!(h=i()).done;){var c=h.value,f=l.FindMaxPaddingForTightPolyline(e,c,this.TightPadding);this.TightObstacles.add(l.LoosePolylineWithFewCorners(c,f,this.randomizationShift))}this.RootOfTightHierarchy=l.CalculateHierarchy(Array.from(this.TightObstacles))}else{for(var y,p=C(t);!(y=p()).done;)this.TightObstacles.add(l.CreatePaddedPolyline(y.value,this.TightPadding));if(!this.IsEmpty())for(this.RootOfTightHierarchy=l.CalculateHierarchy(Array.from(this.TightObstacles)),this.OverlapsDetected=!1;l.GetOverlappedPairSet(this.RootOfTightHierarchy).size>0;)this.RootOfTightHierarchy=l.ReplaceTightObstaclesWithConvexHulls(this.TightObstacles,Array.from(r)),this.OverlapsDetected=!0}},s.CreateTightObstacles_=function(){if(0===this.Obstacles.length)return null;for(var e,t=C(this.Obstacles);!(e=t()).done;)l.CalculateTightPolyline(this.TightObstacles,this.TightPadding,e.value);return l.RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy(this.TightObstacles)},l.CalculateTightPolyline=function(t,e,r){var i=l.PaddedPolylineBoundaryOfNode(r,e);t.add(i)},l.CalculateHierarchy=function(t){return Ht(t.map(function(r){return l.CreateRectNodeOfPolyline(r)}))},l.RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy=function(t){for(var r,e=l.CalculateHierarchy(Array.from(t));(r=l.GetOverlappedPairSet(e)).size>0;)e=l.ReplaceTightObstaclesWithConvexHulls(t,Array.from(r));return e},l.MapToInt=function(t){for(var e=new Map,r=0;r<t.length;r++)e.set(t[r],r);return e},l.ReplaceTightObstaclesWithConvexHulls=function(t,e){for(var h,r=new Set,i=C(e);!(h=i()).done;){var c=h.value;r.add(c[0]),r.add(c[1])}for(var L,f=Array.from(r),p=l.MapToInt(f),P=C(on(Us(Array.from(e).map(function(F){return new Lt(p.get(F[0]),p.get(F[1]))}))));!(L=P()).done;){for(var B,S=L.value.map(function(F){return f[F]}),T=ai(S,function(F){return F}),O=Rr.createConvexHullAsClosedPolyline(T),x=C(S);!(B=x()).done;)t.delete(B.value);t.add(O)}return l.CalculateHierarchy(Array.from(t))},l.OneCurveLiesInsideOfOther=function(t,e){return K.PointRelativeToCurveLocation(t.start,e)!==ht.Outside||K.PointRelativeToCurveLocation(e.start,t)!==ht.Outside},l.PolylinesIntersect=function(t,e){return K.CurvesIntersect(t,e)||l.OneCurveLiesInsideOfOther(t,e)},l.GetOverlappedPairSet=function(t){var e=new Set;return le(t,t,function(r,i){l.PolylinesIntersect(r,i)&&e.add([r,i])}),e},l.BisectorPoints=Zo().mark(function o(t,e){var r,i,h;return Zo().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:r=t.startPoint;case 1:if(null==r){f.next=10;break}if(h=l.GetStickingVertexOnBisector(r,e,i={skip:!1}),i.skip){f.next=7;break}return f.next=7,h;case 7:r=r.next,f.next=1;break;case 10:case"end":return f.stop()}},o)}),l.GetStickingVertexOnBisector=function(t,e,r){var i=t.polyline.prev(t).point,h=t.point,c=t.polyline.next(t).point,f=h.sub(i).normalize().add(h.sub(c).normalize()),p=f.length;return p<q.tolerance?r.skip=!0:(r.skip=!1,f=f.div(p)),f.mul(e).add(h)},l.FindMaxPaddingForTightPolyline=function(t,e,r){var i=r,h=new We(e),c=e.boundingBox.clone();c.pad(2*r);for(var p,f=C(Array.from(t.GetNodeItemsIntersectingRectangle(c)).filter(function(P){return P!==e}));!(p=f()).done;){var m=We.Distance(h,new We(p.value)).dist;i=Math.min(i,m/l.LooseDistCoefficient)}return i},l.GetPaddedCorner=function(t,e,r,i){var h=t.point,c=e.point,f=r.point;if(R.getTriangleOrientation(h,c,f)===it.Counterclockwise)return{a:void 0,b:void 0,numberOfPoints:-1};var p=c.sub(h).rotate(Math.PI/2).normalize();if(l.CornerIsNotTooSharp(h,c,f)){p=p.mul(i);var y=f.sub(c).normalize().mul(i).rotate(Math.PI/2),m=R.lineLineIntersection(h.add(p),c.add(p),c.add(y),f.add(y));return{a:m,b:m,numberOfPoints:1}}var P=c.sub(h).normalize().add(c.sub(f).normalize());if(P.length<q.intersectionEpsilon){var L=c.add(p.mul(i));return{a:L,b:L,numberOfPoints:1}}var E=P.normalize().mul(i),S=E.rotate(Math.PI/2),T=(i-E.dot(p))/S.dot(p),O=S.mul(T);return{a:E.add(O).add(c),b:E.sub(O).add(c),numberOfPoints:2}},l.CornerIsNotTooSharp=function(t,e,r){var i=t.sub(e).rotate(Math.PI/4).add(e);return R.getTriangleOrientation(e,i,r)===it.Counterclockwise},l.CreatePaddedPolyline=function(t,e,r){void 0===r&&(r=!1);var i=new vt,h=r?function(l){for(var s=new vt,t=l.startPoint;t;t=t.next){var e=t.point.x+.01*nn(),r=t.point.y+.01*nn();s.addPointXY(e,r)}return s.closed=l.closed,s}(t):t;if(!l.PadCorner(i,h.endPoint.prev,h.endPoint,h.startPoint,e)||!l.PadCorner(i,h.endPoint,h.startPoint,h.startPoint.next,e))return l.CreatePaddedPolyline(vt.mkClosedFromPoints(Array.from(Rr.CalculateConvexHull(h))),e);for(var c=h.startPoint;null!=c.next.next;c=c.next)if(!l.PadCorner(i,c,c.next,c.next.next,e))return l.CreatePaddedPolyline(vt.mkClosedFromPoints(Array.from(Rr.CalculateConvexHull(h))),e);return i.closed=!0,i},l}();Ie.LooseDistCoefficient=2.1;var kh=function(){function l(){}return l.mk=function(t,e,r){var i=new l;return i.TightPolyline=t,i.LooseShape=e,i.Distance=r,i},l.prototype.toString=function(){return(null==this.TightPolyline?"null":this.TightPolyline.toString().substring(0,5))+","+(null==this.LooseShape?"null":this.LooseShape.toString().substring(0,5))},Q(l,[{key:"TightPolyline",get:function(){return this.tightPoly},set:function(t){this.tightPoly=t}}]),l}(),Rh=function(){function l(o,t,e,r){this.loosePolylinesToNodes=new Map,this.MainShape=o,this.TightPadding=t,this.LoosePadding=e,this.ShapesToTightLooseCouples=r}var s=l.prototype;return s.Calculate=function(t){to(3),0!==this.MainShape.Children.length&&(this.CreateTightObstacles(),this.CreateTigthLooseCouples(t),this.OverlapsDetected&&this.FillTheMapOfShapeToTightLooseCouples())},s.FillTheMapOfShapeToTightLooseCouples=function(){me(Ht(this.MainShape.Children.map(function(e){return Qt(e,e.BoundingBox)})),this.coupleHierarchy,this.TryMapShapeToTightLooseCouple.bind(this))},s.TryMapShapeToTightLooseCouple=function(t,e){l.ShapeIsInsideOfPoly(t,e.TightPolyline)&&this.ShapesToTightLooseCouples.set(t,e)},l.ShapeIsInsideOfPoly=function(t,e){return K.PointRelativeToCurveLocation(t.BoundaryCurve.start,e)===ht.Inside},s.CreateTigthLooseCouples=function(t){for(var i,e=new Array,r=C(this.tightHierarchy.GetAllLeaves());!(i=r()).done;){var h=i.value,c=Ie.FindMaxPaddingForTightPolyline(this.tightHierarchy,h,this.LoosePadding),f=Ie.LoosePolylineWithFewCorners(h,c,t),p=new Xi(f),y=kh.mk(h,p,c);this.ShapesToTightLooseCouples.set(this.tightToShape.get(h),y),e.push(y)}this.coupleHierarchy=Ht(e.map(function(m){return Qt(m,m.TightPolyline.boundingBox)}))},s.CreateTightObstacles=function(){this.tightToShape=new Map;var t=new Set(this.MainShape.Children.map(this.InitialTightPolyline.bind(this))),e=t.size;this.tightHierarchy=Ie.RemovePossibleOverlapsInTightPolylinesAndCalculateHierarchy(t),this.OverlapsDetected=e>t.size},s.InitialTightPolyline=function(t){var e=Ie.PaddedPolylineBoundaryOfNode(t.BoundaryCurve,this.TightPadding),r=ai(this.LoosePolylinesUnderShape(t),function(h){return h}).filter(function(h){return K.PointRelativeToCurveLocation(h,e)===ht.Outside});if(0==r.length)return this.tightToShape&&this.tightToShape.set(e,t),e;var i=Array.from(e).concat(r);return e=vt.mkClosedFromPoints(Rr.CalculateConvexHull(i)),this.tightToShape&&this.tightToShape.set(e,t),e},s.LoosePolylinesUnderShape=function(t){var e=this;return t.Children.map(function(r){return e.ShapesToTightLooseCouples.get(r).LooseShape.BoundaryCurve})},l}(),Gh=function(s,o,t){this.indexToA=s,this.priority=o,this.v=t};function Ko(){Ko=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var dr,Gr=function(){function l(o){void 0===o&&(o=It),this.heapSize=0,this.compare=o,this.cache=new Map,this.A=[]}var s=l.prototype;return s.ContainsElement=function(t){return this.cache.has(t)},s.SwapWithParent=function(t){var e=this.A[t>>1];this.PutAtI(t>>1,this.A[t]),this.PutAtI(t,e)},s.Enqueue=function(t,e){var r=++this.heapSize,i=new Gh(r,e,t);for(this.cache.set(t,i),this.A[r]=i;r>1&&this.compare(this.A[r>>1].priority,e)>0;)this.SwapWithParent(r),r>>=1},s.IsEmpty=function(){return 0===this.heapSize},s.PutAtI=function(t,e){this.A[t]=e,e.indexToA=t},s.Dequeue=function(){if(0===this.heapSize)throw new Error("dequeue on an empty queue");var t=this.A[1].v;return this.MoveQueueOneStepForward(t),t},s.DequeueAndGetPriority=function(t){if(0===this.heapSize)throw new Error("dequeue on an empty queue");var e=this.A[1].v;return t.priority=this.A[1].priority,this.MoveQueueOneStepForward(e),e},s.MoveQueueOneStepForward=function(t){this.cache.delete(t),this.PutAtI(1,this.A[this.heapSize]);for(var e=1;;){var r=e,i=e<<1;i<=this.heapSize&&this.compare(this.A[i].priority,this.A[e].priority)<0&&(r=i);var h=i+1;if(h<=this.heapSize&&this.compare(this.A[h].priority,this.A[r].priority)<0&&(r=h),r===e)break;this.SwapWithParent(r),e=r}this.heapSize--},s.DecreasePriority=function(t,e){var r=this.cache.get(t);if(r){r.priority=e;for(var i=r.indexToA;i>1&&this.compare(this.A[i].priority,this.A[i>>1].priority)<0;)this.SwapWithParent(i),i>>=1}},s.GetEnumerator=Ko().mark(function o(){var t;return Ko().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=1;case 1:if(!(t<=this.heapSize)){r.next=7;break}return r.next=4,this.A[t].v;case 4:t++,r.next=1;break;case 7:case"end":return r.stop()}},o,this)}),s.Peek=function(t){if(0!==this.count)return t.priority=this.A[1].priority,this.A[1].v;t.priority=0},s.toString=function(){for(var r,t=new $t.HT,e=C(this.A);!(r=e()).done;)t.Append(r.value+",");return t.ToString()},Q(l,[{key:"count",get:function(){return this.heapSize}}]),l}(),Qs=function(){function l(o,t,e){this.upperBound=Number.POSITIVE_INFINITY,this._visGraph=e,this._visGraph.ClearPrevEdgesTable();for(var i,r=C(e.Vertices());!(i=r()).done;)i.value.Distance=Number.POSITIVE_INFINITY;this.source=o,this.targets=new Set(t),this.source.Distance=0}var s=l.prototype;return s.GetPath=function(){var t=new Gr(It);for(this.source.Distance=0,t.Enqueue(this.source,0);!t.IsEmpty()&&(this.current=t.Dequeue(),!this.targets.has(this.current));){for(var r,e=C(this.current.OutEdges);!(r=e()).done;){var i=r.value;this.PassableOutEdge(i)&&this.ProcessNeighbor(t,i,i.Target)}for(var c,h=C(this.current.InEdges);!(c=h()).done;){var f=c.value;this.PassableInEdge(f)&&this.ProcessNeighbor(t,f,f.Source)}}return null==this._visGraph.PreviosVertex(this.current)?null:this.CalculatePath()},s.PassableOutEdge=function(t){return t.Source===this.source||this.targets.has(t.Target)||!l.IsForbidden(t)},s.PassableInEdge=function(t){return this.targets.has(t.Source)||t.Target===this.source||!l.IsForbidden(t)},l.IsForbidden=function(t){return null!=t.IsPassable&&!t.IsPassable()||t instanceof Ar},s.ProcessNeighbor=function(t,e,r){var h=this.current.Distance+e.Length;h>=this.upperBound||(this.targets.has(r)&&(this.upperBound=h,this.closestTarget=r),r!==this.source&&null==this._visGraph.PreviosVertex(r)?(r.Distance=h,this._visGraph.SetPreviousEdge(r,e),t.Enqueue(r,h)):h<r.Distance&&(r.Distance=h,this._visGraph.SetPreviousEdge(r,e),t.DecreasePriority(r,h)))},s.CalculatePath=function(){if(null==this.closestTarget)return null;var t=new Array,e=this.closestTarget;do{t.push(e),e=this._visGraph.PreviosVertex(e)}while(e!==this.source);return t.push(this.source),t.reverse()},l}(),Nh=function(){function l(o,t,e){this._lengthMultiplier=1,this._lengthMultiplierForAStar=1,this._visGraph=o,this._source=t,this._target=e,this._source.Distance=0}var s=l.prototype;return s.GetPath=function(t){var e=new Gr(It);for(this._source.Distance=0,this._target.Distance=Number.POSITIVE_INFINITY,e.Enqueue(this._source,this.H(this._source));!e.IsEmpty();){var r={priority:0},i=e.DequeueAndGetPriority(r);if(r.priority>=this._target.Distance)break;for(var c,h=C(i.OutEdges);!(c=h()).done;){var f=c.value;this.PassableOutEdge(f)&&this.ProcessNeighbor(e,i,f,f.Target)}for(var m,y=C(i.InEdges);!(m=y()).done;){var P=m.value;this.PassableInEdge(P)&&this.ProcessNeighbor(e,i,P,P.Source)}}return null==this._visGraph.PreviosVertex(this._target)?null:this.CalculatePath(t)},s.PassableOutEdge=function(t){return t.Source===this._source||t.Target===this._target||!l.IsForbidden(t)},s.PassableInEdge=function(t){return t.Source===this._target||t.Target===this._source||!l.IsForbidden(t)},l.IsForbidden=function(t){return null!=t.IsPassable&&!t.IsPassable()||t instanceof Ar},s.ProcessNeighborN=function(t,e,r,i,h){var f=e.Distance+(r.Length+h);i!==this._source&&null==this._visGraph.PreviosVertex(i)?(i.Distance=f,this._visGraph.SetPreviousEdge(i,r),i!==this._target&&t.Enqueue(i,this.H(i))):i!==this._source&&f<i.Distance&&(i.Distance=f,this._visGraph.SetPreviousEdge(i,r),i!==this._target&&t.DecreasePriority(i,this.H(i)))},s.ProcessNeighbor=function(t,e,r,i){var c=e.Distance+r.Length;i!==this._source&&null==this._visGraph.PreviosVertex(i)?(i.Distance=c,this._visGraph.SetPreviousEdge(i,r),i!==this._target&&t.Enqueue(i,this.H(i))):i!==this._source&&c<i.Distance&&(i.Distance=c,this._visGraph.SetPreviousEdge(i,r),i!==this._target&&t.DecreasePriority(i,this.H(i)))},s.H=function(t){return t.Distance+t.point.sub(this._target.point).length*this.LengthMultiplierForAStar},s.CalculatePath=function(t){var e=new Array,r=this._target;do{e.push(r),t&&this._visGraph.ShrinkLengthOfPrevEdge(r,this.LengthMultiplier),r=this._visGraph.PreviosVertex(r)}while(r!==this._source);return e.push(this._source),e.reverse()},Q(l,[{key:"LengthMultiplier",get:function(){return this._lengthMultiplier},set:function(t){this._lengthMultiplier=t}},{key:"LengthMultiplierForAStar",get:function(){return this._lengthMultiplierForAStar},set:function(t){this._lengthMultiplierForAStar=t}}]),l}();!function(l){l[l.Regular=0]="Regular",l[l.Tangent=1]="Tangent"}(dr||(dr={}));var Xs=function(){function l(o,t){this.LeftTangent=o,this.RightTangent=t}return l.prototype.toString=function(){return $t.Ld.Format("{0},{1}",this.Start,this.End)},Q(l,[{key:"Start",get:function(){return this.leftTangent.End.point}},{key:"End",get:function(){return this.rightTangent.End.point}},{key:"LeftTangent",get:function(){return this.leftTangent},set:function(t){this.leftTangent=t}},{key:"RightTangent",get:function(){return this.rightTangent},set:function(t){this.rightTangent=t}},{key:"RbNode",get:function(){return this.rbNode},set:function(t){this.rbNode=t}}]),l}(),$s=function(){function l(o,t){this.start=o,this.End=t}return l.prototype.toString=function(){return $t.Ld.Format("{0},{1}",this.Start,this.End)},Q(l,[{key:"Comp",get:function(){return this.comp},set:function(t){this.comp=t}},{key:"IsHigh",get:function(){return!this.IsLow}},{key:"IsLow",get:function(){return this.lowTangent},set:function(t){this.lowTangent=t}},{key:"SeparatingPolygons",get:function(){return this.separatingPolygons},set:function(t){this.separatingPolygons=t}},{key:"Diagonal",get:function(){return this.diagonal},set:function(t){this.diagonal=t}},{key:"Start",get:function(){return this.start},set:function(t){this.start=t}},{key:"End",get:function(){return this.end},set:function(t){this.end=t}}]),l}(),Js=function(){function l(){}return l.prototype.Compare=function(t,e){return t.Start.equal(e.Start)?0:R.getTriangleOrientation(this.PointOnTangentAndInsertedDiagonal,e.Start,e.End)===it.Counterclockwise?-1:1},l.BelongsToTheDiagonal=function(t,e,r){return R.closeDistEps(t,R.ClosestPointAtLineSegment(t,e,r))},l.IntersectDiagonalWithRay=function(t,e,r){var i=e.sub(t),h=r.Start,c=r.End,f=Rt.solve(c.x-h.x,-1*i.x,t.x-h.x,c.y-h.y,-1*i.y,t.y-h.y);return t.add(i.mul(f.y))},Q(l,[{key:"PointOnTangentAndInsertedDiagonal",get:function(){return this.pointOnTheRay},set:function(t){this.pointOnTheRay=t}}]),l}(),Zs=function(){function l(o){this.pivot=o}return l.prototype.IComparer=function(t,e){if(t===e)return 0;if(null==t)return-1;if(null==e)return 1;var r=t.Start.point.sub(this.pivot),i=e.Start.point.sub(this.pivot);return l.CompareVectorsByAngleToXAxis(r,i)},l.CompareVectorsByAngleToXAxis=function(t,e){return t.y>=0?e.y<0?-1:l.CompareVectorsPointingToTheSameYHalfPlane(t,e):e.y>=0?1:l.CompareVectorsPointingToTheSameYHalfPlane(t,e)},l.CompareVectorsPointingToTheSameYHalfPlane=function(t,e){var r=t.x*e.y-t.y*e.x;if(r>q.tolerance)return-1;if(r<-q.tolerance)return 1;if(t.x>=0){if(e.x<0)return-1}else if(e.x>=0)return 1;var i=Math.abs(t.x)-Math.abs(e.x);return i<0?-1:i>0?1:(i=Math.abs(t.y)-Math.abs(e.y))<0?-1:i>0?1:0},l}();function ta(){ta=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var no=function(l){function s(t,e,r){var i;return(i=l.call(this,null)||this).polygons=[],i.activeDiagonalComparer=new Js,i.polygons=t,i.visibilityGraph=r,i.addedPolygons=e,i}X(s,l);var o=s.prototype;return o.run=function(){this.useLeftPTangents=!0,this.CalculateAndAddEdges(),this.useLeftPTangents=!1,this.CalculateAndAddEdges()},o.CalculateAndAddEdges=function(){for(var r,e=C(this.addedPolygons);!(r=e()).done;)this.CalculateVisibleTangentsFromPolygon(r.value);this.ProgressStep()},o.CalculateVisibleTangentsFromPolygon=function(e){this.currentPolygon=e,this.AllocateDataStructures(),this.OrganizeTangents(),this.InitActiveDiagonals(),this.Sweep()},o.AllocateDataStructures=function(){this.tangents=new Array,this.diagonals=new Array,this.activeDiagonalTree=new Ce(this.activeDiagonalComparer.Compare.bind(this.activeDiagonalComparer))},o.Sweep=function(){if(!(this.tangents.length<2))for(var e=1;e<this.tangents.length;e++){var r=this.tangents[e];null!=r.Diagonal?(r.Diagonal.RbNode===this.activeDiagonalTree.treeMinimum()&&this.AddVisibleEdge(r),r.IsHigh&&this.RemoveDiagonalFromActiveNodes(r.Diagonal)):r.IsLow&&(this.activeDiagonalComparer.PointOnTangentAndInsertedDiagonal=r.End.point,this.InsertActiveDiagonal(new Xs(r,r.Comp)),r.Diagonal.RbNode===this.activeDiagonalTree.treeMinimum()&&this.AddVisibleEdge(r))}},o.AddVisibleEdge=function(e){_t.AddEdgeVV(Ks(this.visibilityGraph,e.start),Ks(this.visibilityGraph,e.End))},o.InitActiveDiagonals=function(){if(0!==this.tangents.length){for(var c,e=this.tangents[0],r=e.start.point,i=e.End.point,h=C(this.diagonals);!(c=h()).done;){var f=c.value;s.RayIntersectDiagonal(r,i,f)&&(this.activeDiagonalComparer.PointOnTangentAndInsertedDiagonal=Js.IntersectDiagonalWithRay(r,i,f),this.InsertActiveDiagonal(f))}e.Diagonal.RbNode===this.activeDiagonalTree.treeMinimum()&&this.AddVisibleEdge(e),!1===e.IsLow&&this.RemoveDiagonalFromActiveNodes(e.Diagonal)}},o.RemoveDiagonalFromActiveNodes=function(e){var r=this.activeDiagonalTree.deleteSubTree(e.RbNode);null!=r&&null!=r.item&&(r.item.RbNode=r),e.LeftTangent.Diagonal=null,e.RightTangent.Diagonal=null},o.InsertActiveDiagonal=function(e){e.RbNode=this.activeDiagonalTree.insert(e),s.MarkDiagonalAsActiveInTangents(e)},s.MarkDiagonalAsActiveInTangents=function(e){e.LeftTangent.Diagonal=e,e.RightTangent.Diagonal=e},s.RayIntersectDiagonal=function(e,r,i){var h=i.Start,c=i.End;return R.getTriangleOrientation(e,h,c)===it.Counterclockwise&&R.getTriangleOrientation(e,r,h)!==it.Counterclockwise&&R.getTriangleOrientation(e,r,c)!==it.Clockwise},s.TangentComparison=function(e,r){return Zs.CompareVectorsByAngleToXAxis(e.End.point.sub(e.start.point),r.End.point.sub(r.start.point))},o.AllObstacles=ta().mark(function t(){var e,r,i,h,c,f;return ta().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.addedPolygons);case 1:if((r=e()).done){y.next=7;break}return i=r.value,y.next=5,i;case 5:y.next=1;break;case 7:if(!this.polygons){y.next=15;break}h=C(this.polygons);case 9:if((c=h()).done){y.next=15;break}return f=c.value,y.next=13,f;case 13:y.next=9;break;case 15:case"end":return y.stop()}},t,this)}),o.OrganizeTangents=function(){for(var r,e=C(this.AllObstacles());!(r=e()).done;){var i=r.value;i!==this.currentPolygon&&this.ProcessPolygonQ(i)}this.tangents.sort(s.TangentComparison)},o.ProcessPolygonQ=function(e){var r=new Ys(this.currentPolygon,e);this.useLeftPTangents?r.CalculateLeftTangents():r.CalculateRightTangents();var i=this.useLeftPTangents?r.leftPLeftQ:r.rightPLeftQ,h=new $s(this.currentPolygon.pp(i[0]),e.pp(i[1]));h.IsLow=!0,h.SeparatingPolygons=!this.useLeftPTangents;var c=new $s(this.currentPolygon.pp((i=this.useLeftPTangents?r.leftPRightQ:r.rightPRightQ)[0]),e.pp(i[1]));c.IsLow=!1,c.SeparatingPolygons=this.useLeftPTangents,h.Comp=c,c.Comp=h,this.tangents.push(h),this.tangents.push(c),this.diagonals.push(new Xs(h,c))},s}(Vt);function Ks(l,s){return l.FindVertex(s.point)}var Fh=function(){function l(){}var s=l.prototype;return s.Compare=function(t,e){return R.getTriangleOrientation(this.IntersectionOfTheRayAndInsertedEdge,e.point,e.nextOnPolyline.point)===it.Counterclockwise?-1:1},s.IntersectionPointBelongsToTheInsertedEdge=function(t){var e=t.point.sub(this.IntersectionOfTheRayAndInsertedEdge),r=t.nextOnPolyline.point.sub(this.IntersectionOfTheRayAndInsertedEdge);return Math.abs(e.x*r.y-r.x*e.y)<q.distanceEpsilon},s.IntersectEdgeWithRayPPP=function(t,e,r){var i=Rt.solve(e.x-t.x,-r.x,this.Pivot.x-t.x,e.y-t.y,-r.y,this.Pivot.y-t.y);if(!(-q.tolerance<=i.x&&i.x<=1+q.tolerance))throw new Error;if(!i)throw new Error;return this.Pivot.add(r.mul(i.y))},s.IntersectEdgeWithRay=function(t,e){return this.IntersectEdgeWithRayPPP(t.point,t.nextOnPolyline.point,e)},l.constructorPP=function(t,e){var r=new l;return r.pivot=t,r.pointOnTheRay=e,r},Q(l,[{key:"Pivot",get:function(){return this.pivot},set:function(t){this.pivot=t}},{key:"IntersectionOfTheRayAndInsertedEdge",get:function(){return this.pointOnTheRay},set:function(t){this.pointOnTheRay=t}}]),l}();function ea(){ea=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var gi=function(){function l(o,t){this.start=o,this.end=t}var s=l.prototype;return s.Sides=ea().mark(function o(){var t,e;return ea().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:t=this.start;case 1:if(t===this.end){i.next=8;break}return e=t,i.next=5,e;case 5:t=e.nextOnPolyline,i.next=1;break;case 8:case"end":return i.stop()}},o,this)}),s.MoveStartClockwise=function(){return this.Start!==this.End&&(this.Start=this.Start.nextOnPolyline,!0)},s.toString=function(){return $t.Ld.Format("Stem({0},{1})",this.Start,this.End)},Q(l,[{key:"Start",get:function(){return this.start},set:function(t){this.start=t}},{key:"End",get:function(){return this.end},set:function(t){this.end=t}}]),l}();function ra(){ra=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var pi=function(){function l(o,t,e,r){this.sideNodes=new Map,this.visibleBoundaries=new Map,this.sortedListOfPolypoints=new Array,this.holes=Array.from(o),this.visibilityGraph=t,this.q=e,this.qPolylinePoint=nr.mkFromPoint(this.q),this.QVertex=this.visibilityGraph.AddVertexP(this.qPolylinePoint.point),this.visibilityKind=r;var i=new Zs(this.q);this.heapForSorting=new zo(i.IComparer.bind(i))}l.CalculatePointVisibilityGraph=function(t,e,r,i){var h=e.FindVertex(r);if(null!=h)return h;var c=new l(t,e,r,i);return c.FillGraph(),c.QVertex};var s=l.prototype;return s.FillGraph=function(){this.ComputeHoleBoundariesPossiblyVisibleFromQ(),this.visibleBoundaries.size>0&&(this.SortSAndInitActiveSides(),this.Sweep())},s.SortSAndInitActiveSides=function(){this.InitHeapAndInsertActiveSides();for(var t=this.heapForSorting.GetMinimum();this.sortedListOfPolypoints.push(t.Start),t.MoveStartClockwise()?this.heapForSorting.ChangeMinimum(t):this.heapForSorting.Dequeue(),0!==this.heapForSorting.Count;t=this.heapForSorting.GetMinimum());},s.InitHeapAndInsertActiveSides=function(){for(var e,t=C(this.GetInitialVisibleBoundaryStemsAndInsertActiveSides());!(e=t()).done;)this.heapForSorting.Enqueue(e.value)},s.GetInitialVisibleBoundaryStemsAndInsertActiveSides=ra().mark(function o(){var t,e,r,i,h,c,f,p,y,m,P;return ra().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:t=C(this.visibleBoundaries);case 1:if((e=t()).done){E.next=41;break}i=(r=e.value)[0],c=!1,f=C((h=r[1]).Sides());case 5:if((p=f()).done){E.next=36;break}if(!((m=y=p.value).point.y<this.q.y)){E.next=21;break}if(!(y.nextOnPolyline.point.y>=this.q.y)){E.next=19;break}if((P=R.getTriangleOrientation(this.q,m.point,y.nextOnPolyline.point))!==it.Counterclockwise&&P!==it.Collinear){E.next=19;break}return c=!0,E.next=15,new gi(h.Start,y);case 15:return E.next=17,new gi(y.nextOnPolyline,h.End);case 17:return this.RegisterActiveSide(y),E.abrupt("break",36);case 19:E.next=34;break;case 21:if(!(m.point.y>this.q.y)){E.next=25;break}return E.abrupt("break",36);case 25:if(!(y.point.x>=this.q.x)){E.next=34;break}return c=!0,E.next=29,new gi(y,h.End);case 29:if(y===h.Start){E.next=32;break}return E.next=32,new gi(h.Start,i.prev(m));case 32:return this.RegisterActiveSide(y),E.abrupt("break",36);case 34:E.next=5;break;case 36:if(c){E.next=39;break}return E.next=39,h;case 39:E.next=1;break;case 41:case"end":return E.stop()}},o,this)}),s.RegisterActiveSide=function(t){this.activeEdgeComparer.IntersectionOfTheRayAndInsertedEdge=this.activeEdgeComparer.IntersectEdgeWithRay(t,new R(1,0)),this.sideNodes.set(t,this.activeSidesTree.insert(t))},s.Sweep=function(){for(var e,t=C(this.sortedListOfPolypoints);!(e=t()).done;)this.SweepPolylinePoint(e.value)},s.SweepPolylinePoint=function(t){var i,e=l.GetIncomingSide(t),r=this.GetOutgoingSide(t);if(this.activeEdgeComparer.IntersectionOfTheRayAndInsertedEdge=t.point,i=this.sideNodes.get(e)){if(i===this.activeSidesTree.treeMinimum()&&this.AddEdge(t),null!=r)i.item=r,this.sideNodes.set(r,i);else{var h=this.activeSidesTree.deleteSubTree(i);null!=h&&null!=h.item&&this.sideNodes.set(h.item,h)}this.sideNodes.delete(e)}else{if(null==r)throw new Error;var c;(c=this.sideNodes.get(r))||(c=this.activeSidesTree.insert(r),this.sideNodes.set(r,c),c===this.activeSidesTree.treeMinimum()&&this.AddEdge(t))}},s.AddEdge=function(t){(this.visibilityKind===dr.Regular||this.visibilityKind===dr.Tangent&&l.LineTouchesPolygon(this.QVertex.point,t))&&this.visibilityGraph.AddEdgeF(this.QVertex.point,t.point,function(e,r){return new Ar(e,r)})},l.LineTouchesPolygon=function(t,e){var r=e.polyline.prev(e).point,i=e.polyline.next(e).point,h=e.point;return R.signedDoubledTriangleArea(t,h,r)*R.signedDoubledTriangleArea(t,h,i)>=0},s.GetOutgoingSide=function(t){return t===this.visibleBoundaries.get(t.polyline).End?null:t},l.GetIncomingSide=function(t){return t.prevOnPolyline},s.ComputeHoleBoundariesPossiblyVisibleFromQ=function(){this.InitActiveEdgesAndActiveEdgesComparer();for(var e,t=C(this.holes);!(e=t()).done;)this.ComputeVisiblePartOfTheHole(e.value)},s.InitActiveEdgesAndActiveEdgesComparer=function(){this.activeEdgeComparer=new Fh,this.activeEdgeComparer.pivot=this.q,this.activeSidesTree=new Ce(this.activeEdgeComparer.Compare.bind(this.activeEdgeComparer))},s.ComputeVisiblePartOfTheHole=function(t){var e,r=!0;for(e=t.startPoint;!this.HoleSideIsVisibleFromQ(t,e);e=t.next(e))r=!1;var i=t.next(e);if(r)for(;this.HoleSideIsVisibleFromQ(t,t.prev(e));)e=t.prev(e);for(;this.HoleSideIsVisibleFromQ(t,i);i=t.next(i));this.visibleBoundaries.set(t,new gi(e,i))},s.HoleSideIsVisibleFromQ=function(t,e){return R.signedDoubledTriangleArea(this.q,e.point,t.next(e).point)>=-q.squareOfDistanceEpsilon},Q(l,[{key:"QVertex",get:function(){return this.qV},set:function(t){this.qV=t}}]),l}();function sn(){sn=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var na=function(l){function s(){var t;return(t=l.apply(this,arguments)||this).IgnoreTightPadding=!0,t.activeRectangle=lt.mkEmpty(),t.activePolygons=new Array,t.alreadyAddedOrExcludedPolylines=new Set,t.UseEdgeLengthMultiplier=!1,t.UseInnerPolylingShortcutting=!0,t.UsePolylineEndShortcutting=!0,t.AllowedShootingStraightLines=!0,t.LookForRoundedVertices=!1,t}X(s,l);var o=s.prototype;return o.rerouteEdge=function(e){if(null!=e.smoothedPolyline){var r=vt.mkFromPoints(e.smoothedPolyline);this.pathOptimizer.run(r),e.curve=this.pathOptimizer.poly.toCurve()}},s.constructorANNN=function(e,r,i,h){return s.constructorANNNB(e,r,i,h,!1)},o.ExtendVisibilityGraphToLocation=function(e){null==this.VisibilityGraph&&(this.VisibilityGraph=new _t);var r=null;if(!this.activeRectangle.contains(e)){this.activeRectangle.isEmpty?this.activeRectangle=lt.mkPP(this.SourcePort.Location,e):this.activeRectangle.add(e);for(var h,i=C(r=this.GetAddedPolygonesAndMaybeExtendActiveRectangle());!(h=i()).done;)this.VisibilityGraph.AddHole(h.value.Polyline)}null==r||0===r.length?(null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),this.CalculateEdgeTargetVisibilityGraph(e)):(this.RemovePointVisibilityGraphs(),new no(r,this.activePolygons,this.VisibilityGraph).run(),Tr(this.activePolygons,r),this.CalculateEdgeTargetVisibilityGraph(e),this.CalculateSourcePortVisibilityGraph())},o.RemovePointVisibilityGraphs=function(){null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),null!=this.sourceVV&&this.VisibilityGraph.RemoveVertex(this.sourceVV)},o.CalculateEdgeTargetVisibilityGraph=function(e){this.targetVV=pi.CalculatePointVisibilityGraph(Array.from(this.GetActivePolylines()),this.VisibilityGraph,e,dr.Tangent)},o.CalculateSourcePortVisibilityGraph=function(){this.sourceVV=pi.CalculatePointVisibilityGraph(Array.from(this.GetActivePolylines()),this.VisibilityGraph,this.StartPointOfEdgeRouting,dr.Tangent)},o.TakeBoundaryPortOutsideOfItsLoosePolyline=function(e,r,i){var h=e.value(r),c=e.leftDerivative(r).normalize().add(e.rightDerivative(r).normalize()).normalize();R.getTriangleOrientation(s.PointInsideOfConvexCurve(e),h,h.add(c))==it.Counterclockwise&&(c=c.mul(-1)),c=c.rotate(Math.PI/2);for(var p=Z.mkPP(h,h.add(c.mul(i.boundingBox.diagonal))),y=K.intersectionOne(p,i,!1).x,m=c.mul(y.sub(h).length/2);;){p=Z.mkPP(h,y.add(m));for(var E,P=!1,L=C(s.IntersectionsOfLineAndRectangleNodeOverPolylineLR(p,this.ObstacleCalculator.RootOfLooseHierarchy));!(E=L()).done;)if(E.value.seg1!==i){m=m.div(1.5),P=!0;break}if(!P)break}return p.end},s.PointInsideOfConvexCurve=function(e){return e.value(0).add(e.value(1.5)).div(2)},o.GetActivePolylines=sn().mark(function t(){var e,r,i;return sn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.activePolygons);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i.Polyline;case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.GetAddedPolygonesAndMaybeExtendActiveRectangle=function(){var i,e=this.activeRectangle,r=new Array;do{i=!1;for(var c,h=C(this.ObstacleCalculator.RootOfLooseHierarchy.GetNodeItemsIntersectingRectangle(this.activeRectangle));!(c=h()).done;){var f=c.value;this.alreadyAddedOrExcludedPolylines.has(f)||(e.addRec(f.boundingBox),r.push(new We(f)),this.alreadyAddedOrExcludedPolylines.add(f),i=!0)}i&&(this.activeRectangle=e)}while(i);return r},o.PolylineSegmentIntersectsTightHierarchy=function(e,r){return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchyPPR(e,r,this.ObstacleCalculator.RootOfTightHierarchy)},o.PolylineIntersectsPolyRectangleNodeOfTightHierarchyPPR=function(e,r,i){return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy(Z.mkPP(e,r),i)},o.PolylineIntersectsPolyRectangleNodeOfTightHierarchy=function(e,r){if(!e.boundingBox.intersects(r.irect))return!1;if(null!=r.UserData){for(var h,i=C(K.getAllIntersections(e,r.UserData,!1));!(h=i()).done;){var c=h.value;if(c.seg1!==this.SourceTightPolyline&&c.seg1!==this.TargetTightPolyline||(c.seg1===this.SourceTightPolyline&&this.SourcePort)instanceof Ze||(c.seg1===this.TargetTightPolyline&&this.TargetPort)instanceof Ze)return!0}return!1}return this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy(e,r.Left)||this.PolylineIntersectsPolyRectangleNodeOfTightHierarchy(e,r.Right)},s.IntersectionsOfLineAndRectangleNodeOverPolylineLR=function(e,r){var i=new Array;return s.IntersectionsOfLineAndRectangleNodeOverPolyline(e,r,i),i},s.IntersectionsOfLineAndRectangleNodeOverPolyline=function(e,r,i){if(null!=r&&e.boundingBox.intersects(r.irect)){if(null!=r.UserData)return void Tr(i,K.getAllIntersections(e,r.UserData,!0));s.IntersectionsOfLineAndRectangleNodeOverPolyline(e,r.Left,i),s.IntersectionsOfLineAndRectangleNodeOverPolyline(e,r.Right,i)}},o.LineCanBeAcceptedForRouting=function(e){var i=this.TargetPort instanceof ke;if(!((this.SourcePort instanceof ke||this.targetIsInsideOfSourceTightPolyline||this.InsideOfTheAllowedConeOfBoundaryPort(e.end,this.SourcePort))&&(i||null==this.TargetPort||this.sourceIsInsideOfTargetTightPolyline||this.InsideOfTheAllowedConeOfBoundaryPort(e.start,this.TargetPort))))return!1;for(var f,c=C(s.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy));!(f=c()).done;){var p=f.value;if(p.seg1!==this.SourceTightPolyline&&p.seg1!==this.targetTightPolyline)return!1}return!0},o.InsideOfTheAllowedConeOfBoundaryPort=function(e,r){var i=r.Curve,h=Ie.CurveIsClockwise(i,s.PointInsideOfConvexCurve(i)),c=r.Location,f=this.GetPointOnTheRightBoundaryPortConeSide(c,i,h,r.Parameter),p=this.GetPointOnTheLeftBoundaryPortConeSide(c,i,h,r.Parameter);return R.getTriangleOrientation(c,f,e)!==it.Clockwise&&R.getTriangleOrientation(c,e,p)!==it.Clockwise},o.GetPointOnTheRightBoundaryPortConeSide=function(e,r,i,h){var c=i?r.rightDerivative(h):r.leftDerivative(h).neg();return e.add(c.rotate(this.EnteringAngleBound))},o.GetPointOnTheLeftBoundaryPortConeSide=function(e,r,i,h){var c=i?r.leftDerivative(h).neg():r.rightDerivative(h);return e.add(c.rotate(-this.EnteringAngleBound))},o.SmoothenCorners=function(e){for(var r=e.headSite,i={b:null,c:null};i=K.findCorner(r);)r=this.SmoothOneCorner(r,i.c,i.b)},o.SmoothOneCorner=function(e,r,i){var p,y,m,f=.5;null==e.prev?(m=2,y=1):null==r.next?(m=1,y=2):m=y=1;do{p=K.createBezierSeg(f*m,f*y,e,i,r),i.previouisBezierCoefficient=f*m,i.nextBezierCoefficient=f*y,f/=1.5}while(P()>this.loosePadding&&f>.01);return(f*=1.5)<.5&&f>.01&&(p=K.createBezierSeg((f=.5*(f+1.5*f))*m,f*y,e,i,r),P()>this.loosePadding&&(i.previouisBezierCoefficient=f*m,i.nextBezierCoefficient=f*y)),i;function P(){var L=p.closestParameter(i.point);return i.point.sub(p.value(L)).length}},o.TryToRemoveInflectionsAndCollinearSegments=function(e){for(var r=!0,i={s:null};r;)for(r=!1,i.s=e.headSite;null!=i.s&&null!=i.s.next;i.s=i.s.next)i.s.turn*i.s.next.turn<0&&(r=this.TryToRemoveInflectionEdge(i)||r)},o.TryToRemoveInflectionEdge=function(e){if(!this.ObstacleCalculator.ObstaclesIntersectLine(e.s.prev.point,e.s.next.point)){var r=e.s.prev,i=e.s.next;return r.next=i,i.prev=r,e.s=r,!0}if(!this.ObstacleCalculator.ObstaclesIntersectLine(e.s.prev.point,e.s.next.next.point)){var h=e.s.prev,c=e.s.next.next;return h.next=c,c.prev=h,e.s=h,!0}if(!this.ObstacleCalculator.ObstaclesIntersectLine(e.s.point,e.s.next.next.point)){var f=e.s.next.next;return e.s.next=f,f.prev=e.s,!0}return!1},o.GetShortestPolyline=function(e,r){this.CleanTheGraphForShortestPath();var h=new Nh(this.visibilityGraph,e,r).GetPath(this.UseEdgeLengthMultiplier);if(null==h)return null;var c=vt.mkFromPoints(Array.from(h).map(function(f){return f.point})).RemoveCollinearVertices();return this.pathOptimizer&&(this.pathOptimizer.run(c),c=this.pathOptimizer.poly),c},o.CleanTheGraphForShortestPath=function(){this.visibilityGraph.ClearPrevEdgesTable()},o.CalculateObstacles=function(){this.ObstacleCalculator=new Ie(this.Obstacles,this.TightPadding,this.LoosePadding,this.IgnoreTightPadding),this.ObstacleCalculator.Calculate()},s.constructorANNNB=function(e,r,i,h,c){var f=new s(null);return f.IgnoreTightPadding=c,f.EnteringAngleBound=Math.PI/180*80,f.TightPadding=r,f.LoosePadding=i,h>0?(Mt.assert(h>Math.PI/180),Mt.assert(h<=Math.PI/180*90),f.UseSpanner=!0,f.ExpectedProgressSteps=$i.GetTotalSteps(h)):f.ExpectedProgressSteps=e.length,f.ConeSpannerAngle=h,f.Obstacles=e,f.CalculateObstacles(),f},o.RouteEdgeToLocation=function(e){this.TargetPort=new ke(null,e),this.TargetTightPolyline=null,this.TargetLoosePolyline=null;var r=new sr(null),i=Z.mkPP(this.SourcePort.Location,e);return this.LineCanBeAcceptedForRouting(i)?(this._polyline=new vt,this._polyline.addPoint(i.start),this._polyline.addPoint(i.end),r.smoothedPolyline=ce.mkFromPoints(this._polyline),r.curve=r.smoothedPolyline.createCurve(),r):this.SourcePort instanceof Ze&&(i=Z.mkPP(this.StartPointOfEdgeRouting,e),0==s.IntersectionsOfLineAndRectangleNodeOverPolylineLR(i,this.ObstacleCalculator.RootOfTightHierarchy).length)?(this._polyline=new vt,this._polyline.addPoint(this.SourcePort.Location),this._polyline.addPoint(i.start),this._polyline.addPoint(i.end),r.smoothedPolyline=ce.mkFromPoints(this._polyline),r.curve=r.smoothedPolyline.createCurve(),r):(this.ExtendVisibilityGraphToLocation(e),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV),this.SourcePort instanceof Ze&&this._polyline.PrependPoint(this.SourcePort.Location),r.smoothedPolyline=ce.mkFromPoints(this._polyline),r.curve=r.smoothedPolyline.createCurve(),r)},o.RouteEdgeToPort=function(e,r,i,h){return this.ObstacleCalculator.IsEmpty()?null!=this.sourcePort&&null!=this.targetPort?(h.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(this.sourcePort.Location,this.targetPort.Location),Z.mkPP(this.sourcePort.Location,this.targetPort.Location)):null:(this.TargetPort=e,this.TargetTightPolyline=s.GetFirstHitPolyline(e.Location,this.ObstacleCalculator.RootOfTightHierarchy),e instanceof Ze?this.RouteEdgeToBoundaryPort(r,i,h):this.RouteEdgeToFloatingPortOfNode(r,i,h))},o.SmoothedPolylineFromTwoPoints=function(e,r){return this._polyline=new vt,this._polyline.addPoint(e),this._polyline.addPoint(r),ce.mkFromPoints(this._polyline)},o.RouteEdgeToFloatingPortOfNode=function(e,r,i){return this.sourcePort instanceof ke?this.RouteFromFloatingPortToFloatingPort(e,r,i):this.RouteFromBoundaryPortToFloatingPort(e,r,i)},o.RouteFromBoundaryPortToFloatingPort=function(e,r,i){var h=this.SourcePort.Location,c=this.targetPort.Location,f=Z.mkPP(h,c);if(this.LineCanBeAcceptedForRouting(f))return i.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(f.start,f.end),f;if(!this.targetIsInsideOfSourceTightPolyline){var p=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.SourcePort.Curve,this.SourcePort.Parameter,this.SourceLoosePolyline);if(f=Z.mkPP(p,c),this.LineAvoidsTightHierarchyLP(f,e))return i.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(f.start,f.end),f}this.ExtendVisibilityGraphToLocationOfTargetFloatingPort(e),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV);var y=this.SourceTightPolyline;return this.targetIsInsideOfSourceTightPolyline||(this.SourceTightPolyline=null),this.SourceTightPolyline=y,this._polyline.PrependPoint(h),this.SmoothCornersAndReturnCurve(r,i)},o.SmoothCornersAndReturnCurve=function(e,r){return r.smoothedPolyline=ce.mkFromPoints(this._polyline),e&&this.SmoothenCorners(r.smoothedPolyline),r.smoothedPolyline.createCurve()},o.RouteFromFloatingPortToFloatingPort=function(e,r,i){return this.ExtendVisibilityGraphToLocationOfTargetFloatingPort(e),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV),null==this._polyline?null:(i.smoothedPolyline=ce.mkFromPoints(this._polyline),this.SmoothCornersAndReturnCurve(r,i))},o.TryShortcutPolyPoint=function(e){return!!this.LineAvoidsTightHierarchyLPP(Z.mkPP(e.point,e.next.next.point),this.SourceTightPolyline,this.targetTightPolyline)&&(e.next=e.next.next,e.next.prev=e,!0)},o.ExtendVisibilityGraphToLocationOfTargetFloatingPort=function(e){null==this.VisibilityGraph&&(this.VisibilityGraph=new _t);var r=null,i=this.targetPort.Location;if(!this.activeRectangle.contains(i)){this.activeRectangle.isEmpty?this.activeRectangle=lt.mkPP(this.SourcePort.Location,i):this.activeRectangle.add(i);for(var c,h=C(r=this.GetAddedPolygonesAndMaybeExtendActiveRectangle());!(c=h()).done;)this.VisibilityGraph.AddHole(c.value.Polyline)}null==r?(null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),this.CalculateEdgeTargetVisibilityGraphForFloatingPort(i,e),null==this.sourceVV&&this.CalculateSourcePortVisibilityGraph()):(this.RemovePointVisibilityGraphs(),new no(r,this.activePolygons,this.VisibilityGraph).run(),Tr(this.activePolygons,r),this.CalculateEdgeTargetVisibilityGraphForFloatingPort(i,e),this.CalculateSourcePortVisibilityGraph())},o.CalculateEdgeTargetVisibilityGraphForFloatingPort=function(e,r){this.targetVV=this.UseSpanner?this.AddTransientVisibilityEdgesForPort(e,r):pi.CalculatePointVisibilityGraph(this.GetActivePolylinesWithException(r),this.VisibilityGraph,e,dr.Tangent)},o.AddTransientVisibilityEdgesForPort=function(e,r){var i=this.GetVertex(e);if(null!=i)return i;if(i=this.visibilityGraph.AddVertexP(e),null!=r)for(var c,h=C(r);!(c=h()).done;)this.visibilityGraph.AddEdgeF(e,c.value,function(p,y){return new Ar(p,y)});else i=pi.CalculatePointVisibilityGraph(this.GetActivePolylines(),this.VisibilityGraph,e,dr.Tangent);return i},o.GetVertex=function(e){var r=this.visibilityGraph.FindVertex(e);return null==r&&this.LookForRoundedVertices&&(r=this.visibilityGraph.FindVertex(R.RoundPoint(e))),r},o.GetActivePolylinesWithException=sn().mark(function t(e){var r,i,h;return sn().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:r=C(this.activePolygons);case 1:if((i=r()).done){f.next=8;break}if((h=i.value).Polyline===e){f.next=6;break}return f.next=6,h.Polyline;case 6:f.next=1;break;case 8:case"end":return f.stop()}},t,this)}),o.RouteEdgeToBoundaryPort=function(e,r,i){return this.TargetLoosePolyline=e,this.sourcePort instanceof ke?this.RouteFromFloatingPortToBoundaryPort(r,i):this.RouteFromBoundaryPortToBoundaryPort(r,i)},o.RouteFromBoundaryPortToBoundaryPort=function(e,r){var h,i=this.SourcePort.Location,c=this.targetPort.Location,f=Z.mkPP(i,c);if(this.LineCanBeAcceptedForRouting(f))this._polyline=new vt,this._polyline.addPoint(f.start),this._polyline.addPoint(f.end),r.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(f.start,f.end),h=ce.mkFromPoints(this._polyline).createCurve();else{var p=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.targetPort.Curve,this.targetPort.Parameter,this.TargetLoosePolyline);if(f=Z.mkPP(i,p),this.InsideOfTheAllowedConeOfBoundaryPort(p,this.SourcePort)&&this.LineAvoidsTightHierarchyLP(f,this._sourceTightPolyline))this._polyline=new vt,this._polyline.addPoint(f.start),this._polyline.addPoint(f.end),this._polyline.addPoint(c),h=this.SmoothCornersAndReturnCurve(e,r);else if(f=Z.mkPP(this.StartPointOfEdgeRouting,c),this.InsideOfTheAllowedConeOfBoundaryPort(this.StartPointOfEdgeRouting,this.TargetPort)&&this.LineAvoidsTightHierarchy(f))this._polyline=new vt,this._polyline.addPoint(i),this._polyline.addPoint(f.start),this._polyline.addPoint(f.end),h=this.SmoothCornersAndReturnCurve(e,r);else{var y;if(y=Z.IntersectPPPP(i,this.StartPointOfEdgeRouting,c,p))this._polyline=new vt,this._polyline.addPoint(i),this._polyline.addPoint(y),this._polyline.addPoint(c),h=this.SmoothCornersAndReturnCurve(e,r);else if(R.closeDistEps(this.StartPointOfEdgeRouting,p))this._polyline=new vt,this._polyline.addPoint(i),this._polyline.addPoint(p),this._polyline.addPoint(c),h=this.SmoothCornersAndReturnCurve(e,r);else if(this.LineAvoidsTightHierarchy(Z.mkPP(this.StartPointOfEdgeRouting,p)))this._polyline=new vt,this._polyline.addPoint(i),this._polyline.addPoint(this.StartPointOfEdgeRouting),this._polyline.addPoint(p),this._polyline.addPoint(c),h=this.SmoothCornersAndReturnCurve(e,r);else{this.ExtendVisibilityGraphToTargetBoundaryPort(p),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV);var m={tmpTargetTight:null},P=this.HideSourceTargetTightsIfNeeded(m);this.RecoverSourceTargetTights(P,m.tmpTargetTight),this._polyline.PrependPoint(i),this._polyline.addPoint(c),h=this.SmoothCornersAndReturnCurve(e,r)}}}return h},o.RecoverSourceTargetTights=function(e,r){this.SourceTightPolyline=e,this.TargetTightPolyline=r},o.HideSourceTargetTightsIfNeeded=function(e){var r=this.SourceTightPolyline;return e.tmpTargetTight=this.TargetTightPolyline,this.TargetTightPolyline=null,this.SourceTightPolyline=null,r},o.LineAvoidsTightHierarchy=function(e){return 0===s.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy).length},o.RouteFromFloatingPortToBoundaryPort=function(e,r){var h,i=this.targetPort.Location;if(this.InsideOfTheAllowedConeOfBoundaryPort(this.sourcePort.Location,this.targetPort)&&(h=Z.mkPP(this.SourcePort.Location,i),this.LineCanBeAcceptedForRouting(h)))return r.smoothedPolyline=this.SmoothedPolylineFromTwoPoints(h.start,h.end),h;var c=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.TargetPort.Curve,this.TargetPort.Parameter,this.TargetLoosePolyline);return h=Z.mkPP(this.SourcePort.Location,c),this.LineAvoidsTightHierarchyLP(h,this._sourceTightPolyline)?(this._polyline=vt.mkFromPoints([h.start,h.end,i]),r.smoothedPolyline=ce.mkFromPoints(this._polyline),r.smoothedPolyline.createCurve()):(this.ExtendVisibilityGraphToTargetBoundaryPort(c),this._polyline=this.GetShortestPolyline(this.sourceVV,this.targetVV),this._polyline.addPoint(i),this.SmoothCornersAndReturnCurve(e,{smoothedPolyline:null}))},o.LineAvoidsTightHierarchyLP=function(e,r){for(var c,i=!0,h=C(s.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy));!(c=h()).done;)if(c.value.seg1!==r){i=!1;break}return i},o.LineAvoidsTightHierarchyLPP=function(e,r,i){for(var f,h=!0,c=C(s.IntersectionsOfLineAndRectangleNodeOverPolylineLR(e,this.ObstacleCalculator.RootOfTightHierarchy));!(f=c()).done;){var p=f.value;if(p.seg1!==r&&p.seg1!==i){h=!1;break}}return h},o.LineAvoidsTightHierarchyPPPP=function(e,r,i,h){return this.LineAvoidsTightHierarchyLPP(Z.mkPP(e,r),i,h)},o.ExtendVisibilityGraphToTargetBoundaryPort=function(e){var r=null;if(null==this.VisibilityGraph&&(this.VisibilityGraph=new _t),!this.activeRectangle.contains(e)||!this.activeRectangle.containsRect(this.TargetLoosePolyline.boundingBox)){this.activeRectangle.isEmpty?(this.activeRectangle=this.TargetLoosePolyline.boundingBox.clone(),this.activeRectangle.add(this.SourcePort.Location),this.activeRectangle.add(this.StartPointOfEdgeRouting),this.activeRectangle.add(e)):(this.activeRectangle.add(e),this.activeRectangle.addRec(this.TargetLoosePolyline.boundingBox));for(var h,i=C(r=this.GetAddedPolygonesAndMaybeExtendActiveRectangle());!(h=i()).done;)this.VisibilityGraph.AddHole(h.value.Polyline)}null==r?(null!=this.targetVV&&this.VisibilityGraph.RemoveVertex(this.targetVV),this.CalculateEdgeTargetVisibilityGraph(e)):(this.RemovePointVisibilityGraphs(),new no(r,this.activePolygons,this.VisibilityGraph).run(),Tr(this.activePolygons,r),this.CalculateEdgeTargetVisibilityGraph(e),this.CalculateSourcePortVisibilityGraph())},o.GetHitLoosePolyline=function(e){return this.ObstacleCalculator.IsEmpty()||null==this.ObstacleCalculator.RootOfLooseHierarchy?null:s.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfLooseHierarchy)},s.GetFirstHitPolyline=function(e,r){var i=s.GetFirstHitRectangleNode(e,r);return i?i.UserData:null},s.GetFirstHitRectangleNode=function(e,r){return null==r?null:r.FirstHitNodeWithPredicate(e,function(i,h){return K.PointRelativeToCurveLocation(i,h)!==ht.Outside?Ft.Stop:Ft.Continue})},o.Clean=function(){this.TargetPort=null,this.SourcePort=null,this.SourceTightPolyline=null,this.SourceLoosePolyline=null,this.TargetLoosePolyline=null,this.targetTightPolyline=null,this.VisibilityGraph=null,this.targetVV=null,this.sourceVV=null,this.activePolygons=[],this.alreadyAddedOrExcludedPolylines.clear(),this.activeRectangle.setToEmpty()},o.SetSourcePortAndSourceLoosePolyline=function(e,r){this.SourceLoosePolyline=r,this.sourcePort=e,null!=this.sourcePort&&(this.SourceTightPolyline=s.GetFirstHitPolyline(this.sourcePort.Location,this.ObstacleCalculator.RootOfTightHierarchy),this.sourcePort instanceof ke?(this.alreadyAddedOrExcludedPolylines.add(this.SourceLoosePolyline),this.StartPointOfEdgeRouting=this.SourcePort.Location):this.StartPointOfEdgeRouting=this.TakeBoundaryPortOutsideOfItsLoosePolyline(this.SourcePort.Curve,this.sourcePort.Parameter,this.SourceLoosePolyline))},o.run=function(){this.CalculateWholeTangentVisibilityGraph()},o.CalculateWholeTangentVisibilityGraph=function(){this.VisibilityGraph=new _t,this.CalculateWholeVisibilityGraphOnExistingGraph()},o.CalculateWholeVisibilityGraphOnExistingGraph=function(){this.activePolygons=Array.from(this.AllPolygons());for(var r,e=C(this.ObstacleCalculator.LooseObstacles);!(r=e()).done;)this.VisibilityGraph.AddHole(r.value);(this.UseSpanner?new $i(this.ObstacleCalculator.LooseObstacles,this.VisibilityGraph):new no(new Array,this.activePolygons,this.visibilityGraph)).run()},o.RouteSplineFromPortToPortWhenTheWholeGraphIsReady=function(e,r,i,h){var c=e instanceof ke&&r instanceof Ze||e instanceof Le;if(c){var f=e;e=r,r=f}this.sourcePort=e,this.targetPort=r,this.FigureOutSourceTargetPolylinesAndActiveRectangle();var p=this.GetEdgeGeomByRouting(i,h);return null==p?null:(this.targetVV=null,this.sourceVV=null,c&&(p=p.reverse()),p)},o.GetEdgeGeomByRouting=function(e,r){var i;if(this.sourceIsInsideOfTargetTightPolyline=null==this.TargetTightPolyline||K.PointRelativeToCurveLocation(this.sourcePort.Location,this.TargetTightPolyline)===ht.Inside,this.sourcePort instanceof Ze){var h=this.sourcePort;this.StartPointOfEdgeRouting=this.targetIsInsideOfSourceTightPolyline?h.Location:this.TakeBoundaryPortOutsideOfItsLoosePolyline(h.Curve,h.Parameter,this.SourceLoosePolyline),this.CalculateSourcePortVisibilityGraph();var c={smoothedPolyline:null};i=this.targetPort instanceof Ze?this.RouteFromBoundaryPortToBoundaryPort(e,c):this.RouteFromBoundaryPortToFloatingPort(this.targetLoosePolyline,e,c)}else this.targetPort instanceof ke?(this.ExtendVisibilityGraphFromFloatingSourcePort(),i=this.RouteFromFloatingPortToFloatingPort(this.targetLoosePolyline,e,r)):i=this.RouteFromFloatingPortToAnywherePort(this.targetPort.LoosePolyline,e,r,this.targetPort);return i},o.RouteFromFloatingPortToAnywherePort=function(e,r,i,h){return h.Curve.boundingBox.contains(this.sourcePort.Location)?(this.sourceVV=this.GetVertex(this.sourcePort.Location),this._polyline=this.GetShortestPolylineToMulitpleTargets(this.sourceVV,Array.from(this.Targets(e))),null==this._polyline?null:(this.FixLastPolylinePointForAnywherePort(h),h.HookSize>0&&this.BuildHook(h),this.SmoothCornersAndReturnCurve(r,i))):(i.smoothedPolyline=null,null)},o.BuildHook=function(e){var r=e.Curve,i=Wt.mkFullEllipseNNP(e.HookSize,e.HookSize,this._polyline.end),h=K.getAllIntersections(r,i,!0);R.getTriangleOrientation(h[0].x,this._polyline.end,this._polyline.endPoint.prev.point)==it.Counterclockwise&&h.reverse();var c=this._polyline.end.sub(this._polyline.endPoint.prev.point).normalize(),f=r.derivative(h[0].par0).normalize(),p=f.dot(c);if(Math.abs(p)<.2)this.ExtendPolyline(f,h[0],c,e);else{var y=r.derivative(h[1].par0).normalize();y.dot(c)<p?this.ExtendPolyline(y,h[1],c,e):this.ExtendPolyline(f,h[0],c,e)}},o.ExtendPolyline=function(e,r,i,h){var c=e.rotate(Math.PI/2);c.dot(i)<0&&(c=c.neg());var p,f=r.x.add(c.mul(h.HookSize));(p=R.lineLineIntersection(f,f.add(e),this._polyline.end,this._polyline.end.add(i)))&&(this._polyline.addPoint(p),this._polyline.addPoint(f),this._polyline.addPoint(r.x))},o.FixLastPolylinePointForAnywherePort=function(e){for(;;){var r=this.GetLastPointInsideOfCurveOnPolyline(e.Curve);r.next.next=null,this._polyline.endPoint=r.next;var i=r.next.point.sub(r.point),h=(i=i.normalize().mul(e.Curve.boundingBox.diagonal)).rotate(-1*e.AdjustmentAngle),c=i.rotate(e.AdjustmentAngle),f=K.intersectionOne(e.Curve,Z.mkPP(r.point,r.point.add(h)),!0),p=K.intersectionOne(e.Curve,Z.mkPP(r.point,r.point.add(c)),!0);if(null==f||null==p)return;var y=s.GetTrimmedCurveForHookingUpAnywhere(e.Curve,r,f,p),m=y.value(y.closestParameter(r.point));if(!this.LineAvoidsTightHierarchyLPP(Z.mkPP(r.point,m),this.SourceTightPolyline,null)){var P=K.intersectionOne(e.Curve,Z.mkPP(r.point,r.next.point),!1);if(null==P)return;this._polyline.endPoint.point=P.x;break}if(this._polyline.endPoint.point=m,null==r.prev||!this.TryShortcutPolyPoint(r.prev))break}},s.GetTrimmedCurveForHookingUpAnywhere=function(e,r,i,h){var y,m,c=R.getTriangleOrientation(h.x,i.x,r.point)===it.Clockwise,f=i.par0,p=h.par0;return c?f<p?e.trim(f,p):(m=e.trim(f,e.parEnd),y=e.trim(e.parStart,p),(new K).addSegs([m,y])):p<f?e.trim(p,f):(m=e.trim(p,e.parEnd),y=e.trim(e.parStart,f),(new K).addSegs([m,y]))},o.GetLastPointInsideOfCurveOnPolyline=function(e){for(var r=this._polyline.endPoint.prev;null!=r;r=r.prev)if(null==r.prev||K.PointRelativeToCurveLocation(r.point,e)===ht.Inside)return r;throw new Error},o.GetShortestPolylineToMulitpleTargets=function(e,r){this.CleanTheGraphForShortestPath();var h=new Qs(e,r,this.VisibilityGraph).GetPath();if(null==h)return null;for(var p,c=new vt,f=C(h);!(p=f()).done;)c.addPoint(p.value.point);return c.RemoveCollinearVertices()},o.Targets=function(e){var r=this;return Array.from(e).map(function(i){return r.visibilityGraph.FindVertex(i)})},o.ExtendVisibilityGraphFromFloatingSourcePort=function(){var e=this;this.StartPointOfEdgeRouting=this.sourcePort.Location,this.sourceVV=this.UseSpanner?this.AddTransientVisibilityEdgesForPort(this.sourcePort.Location,this.SourceLoosePolyline):pi.CalculatePointVisibilityGraph(Array.from(this.GetActivePolylines()).filter(function(i){return i!==e.SourceLoosePolyline}),this.VisibilityGraph,this.StartPointOfEdgeRouting,dr.Tangent)},o.FigureOutSourceTargetPolylinesAndActiveRectangle=function(){var e=this.sourcePort.Curve.value(this.sourcePort.Curve.parStart);this._sourceTightPolyline=s.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfTightHierarchy),this.SourceLoosePolyline=s.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfLooseHierarchy),e=this.targetPort.Curve.value(this.targetPort.Curve.parStart),this.targetTightPolyline=s.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfTightHierarchy),this.targetLoosePolyline=s.GetFirstHitPolyline(e,this.ObstacleCalculator.RootOfLooseHierarchy),this.activeRectangle=lt.mkPP(new R(Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY),new R(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY))},o.AllPolygons=sn().mark(function t(){var e,r,i;return sn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.ObstacleCalculator.LooseObstacles);case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,new We(i);case 5:c.next=1;break;case 7:case"end":return c.stop()}},t,this)}),o.GetVisibilityGraph=function(){return this.VisibilityGraph},o.AddActivePolygons=function(e){Tr(this.activePolygons,e)},o.ClearActivePolygons=function(){this.activePolygons=[]},Q(s,[{key:"Obstacles",get:function(){return this.obstacles_},set:function(e){this.obstacles_=e}},{key:"EnteringAngleBound",get:function(){return this.enteringAngleBound_},set:function(e){this.enteringAngleBound_=e}},{key:"SourceTightPolyline",get:function(){return this._sourceTightPolyline},set:function(e){this._sourceTightPolyline=e}},{key:"TargetTightPolyline",get:function(){return this.targetTightPolyline},set:function(e){this.targetTightPolyline=e}},{key:"TargetLoosePolyline",get:function(){return this.targetLoosePolyline},set:function(e){this.targetLoosePolyline=e}},{key:"VisibilityGraph",get:function(){return this.visibilityGraph},set:function(e){this.visibilityGraph=e}},{key:"SourcePort",get:function(){return this.sourcePort},set:function(e){if(this.sourcePort=e,null!=this.sourcePort)if(this.SourceTightPolyline=s.GetFirstHitPolyline(this.sourcePort.Location,this.ObstacleCalculator.RootOfTightHierarchy),this.sourcePort instanceof ke)this.alreadyAddedOrExcludedPolylines.add(this.SourceLoosePolyline),this.StartPointOfEdgeRouting=this.SourcePort.Location;else{var r=this.sourcePort;this.StartPointOfEdgeRouting=this.TakeBoundaryPortOutsideOfItsLoosePolyline(r.Curve,r.Parameter,this.SourceLoosePolyline)}}},{key:"TargetPort",get:function(){return this.targetPort},set:function(e){this.targetPort=e}},{key:"LoosePadding",get:function(){return this.loosePadding},set:function(e){this.loosePadding=e,null!=this.ObstacleCalculator&&(this.ObstacleCalculator.LoosePadding=e)}},{key:"OffsetForPolylineRelaxing",get:function(){return.75*this.TightPadding}},{key:"StartPointOfEdgeRouting",get:function(){return this.startPointOfRouting_},set:function(e){this.startPointOfRouting_=e}},{key:"OverlapsDetected",get:function(){return this.ObstacleCalculator.OverlapsDetected}},{key:"TightHierarchy",get:function(){return this.ObstacleCalculator.RootOfTightHierarchy},set:function(e){this.ObstacleCalculator.RootOfTightHierarchy=e}},{key:"LooseHierarchy",get:function(){return this.ObstacleCalculator.RootOfLooseHierarchy},set:function(e){this.ObstacleCalculator.RootOfLooseHierarchy=e}}]),s}(Vt),vr=function(){function l(){this.length=l.defaultArrowheadLength,this.width=0,this.length=l.defaultArrowheadLength}return l.prototype.clone=function(){var t=new l;return t.length=this.length,t.width=this.width,t.tipPosition=this.tipPosition,t},l.calculateArrowheads=function(t){if(null==t.sourceArrowhead&&null==t.targetArrowhead)return!0;var e=l.findTrimStartForArrowheadAtSource(t);if(null==e)return!1;var r=l.findTrimEndForArrowheadAtTarget(t);if(null==r||e>r-q.intersectionEpsilon||K.closeIntersectionPoints(t.curve.value(e),t.curve.value(r)))return!1;var i=t.curve.trim(e,r);return null!=i&&(null!=t.sourceArrowhead&&(t.sourceArrowhead.tipPosition=t.curve.start),null!=t.targetArrowhead&&(t.targetArrowhead.tipPosition=t.curve.end),t.curve=i,!0)},l.getIntersectionsWithArrowheadCircle=function(t,e,r){var i=Wt.mkFullEllipseNNP(e,e,r);return K.getAllIntersections(i,t,!0)},l.findTrimEndForArrowheadAtTarget=function(t){var e=q.distanceEpsilon*q.distanceEpsilon,r=t.curve.parEnd;if(null==t.targetArrowhead||t.targetArrowhead.length<=q.distanceEpsilon)return r;var c,f,i=t.curve,h=t.targetArrowhead.length,p=10;do{if(0==--p)return;r=0!==(f=l.getIntersectionsWithArrowheadCircle(i,h,i.end)).length?Math.max.apply(Math,f.map(function(y){return y.par1})):i.parEnd,c=t.curve.value(r),h/=2}while(c.sub(i.start).lengthSquared<e||0===f.length);return r},l.findTrimStartForArrowheadAtSource=function(t){if(null==t.sourceArrowhead||t.sourceArrowhead.length<=q.distanceEpsilon)return t.curve.parStart;for(var c,p,e=q.distanceEpsilon*q.distanceEpsilon,r=t.sourceArrowhead.length,h=t.curve,f=10;--f>0;){if(0===(c=l.getIntersectionsWithArrowheadCircle(h,r,h.start)).length)return h.parStart;if(p=Math.min.apply(Math,c.map(function(y){return y.par1})),c.filter(function(y){return y.par1===p})[0].x.sub(h.end).lengthSquared>=e)return p;r/=2}},l.trimSplineAndCalculateArrowheads=function(t,e,r){return l.trimSplineAndCalculateArrowheadsII(t,t.source.boundaryCurve,t.target.boundaryCurve,e,r)},l.trimSplineAndCalculateArrowheadsII=function(t,e,r,i,h){if(t.curve=K.trimEdgeSplineWithNodeBoundaries(e,r,i,h),null==t.curve)return!1;if((null==t.sourceArrowhead||t.sourceArrowhead.length<q.distanceEpsilon)&&(null==t.targetArrowhead||t.targetArrowhead.length<q.distanceEpsilon))return!0;var c=!1,f=null!=t.sourceArrowhead?t.sourceArrowhead.length:0,p=null!=t.targetArrowhead?t.targetArrowhead.length:0,y=t.curve.end.sub(t.curve.start).length;null!=t.sourceArrowhead&&(t.sourceArrowhead.length=Math.min(y,f)),null!=t.targetArrowhead&&(t.targetArrowhead.length=Math.min(y,p));for(var m=10;(null!=t.sourceArrowhead&&t.sourceArrowhead.length>q.intersectionEpsilon||null!=t.targetArrowhead&&t.targetArrowhead.length>q.intersectionEpsilon)&&!c&&((c=l.calculateArrowheads(t))||(null!=t.sourceArrowhead&&(t.sourceArrowhead.length*=.5),null!=t.targetArrowhead&&(t.targetArrowhead.length*=.5)),0!=--m););return c||(null!=t.sourceArrowhead&&(t.sourceArrowhead.tipPosition=i.start),null!=t.targetArrowhead&&(t.targetArrowhead.tipPosition=i.end)),null!=t.sourceArrowhead&&(t.sourceArrowhead.length=f),null!=t.targetArrowhead&&(t.targetArrowhead.length=p),c},l.createBigEnoughSpline=function(t){var c,e=t.source.center,r=t.target.center,i=r.sub(e);i.length<.001?(c=new R(1,0),r=e.add(c.rotate(Math.PI/2))):c=i.rotate(Math.PI/2);var f=1;null!=t.sourceArrowhead&&(f+=t.sourceArrowhead.length),null!=t.targetArrowhead&&(f+=t.targetArrowhead.length),c=c.normalize().mul(1.5*f);for(var p=1;p<1e4;p*=2){var y=K.createBezierSegN(e,r,c,p);if(l.trimSplineAndCalculateArrowheadsII(t,t.source.boundaryCurve,t.target.boundaryCurve,y,!1))return}l.createEdgeCurveWithNoTrimming(t,e,r)},l.createEdgeCurveWithNoTrimming=function(t,e,r){var i=r.sub(e).normalize(),h=e,c=r,f=t.targetArrowhead;null!=f&&(f.tipPosition=r,c=r.sub(i.mul(f.length)));var p=t.sourceArrowhead;null!=p&&(p.tipPosition=e,h=e.add(i.mul(p.length))),t.curve=Z.mkPP(h,c)},l}();vr.defaultArrowheadLength=5;var yi=function(){function l(){}return l.GetShapes=function(o,t){void 0===t&&(t=Array.from(o.shallowEdges));var e=new Map;tu(o,e);for(var i,r=C(t);!(i=r()).done;){var h=i.value,c=e.get(h.source);c&&null!=h.sourcePort&&c.Ports.add(h.sourcePort),(c=e.get(h.target))&&null!=h.targetPort&&c.Ports.add(h.targetPort)}return Array.from(e.values())},l.CreateShapeWithCenterPort=function(o){var t=new Xo(o),e=kn.mk(function(){return o.boundaryCurve},function(){return o.center});t.Ports.add(e);for(var i,r=C(o.inEdges());!(i=r()).done;)l.FixPortAtTarget(e,i.value);for(var f,c=C(o.outEdges());!(f=c()).done;)l.FixPortAtSource(e,f.value);for(var m,y=C(o.selfEdges());!(m=y()).done;){var P=m.value;l.FixPortAtSource(e,P),l.FixPortAtTarget(e,P)}return t},l.CreateShapeWithClusterBoundaryPort=function(o){var t=new Xo(o),e=Je.mk(function(){return o.boundaryCurve},function(){return o.center});t.Ports.add(e);for(var h,r=void 0,i=C(o.inEdges());!(h=i()).done;){var c=h.value;c.EdgeToAncestor()===Qr.ToAncestor?(null==r&&(r=new Le(function(){return o.boundaryCurve})),c.targetPort=r):l.FixPortAtTarget(e,c)}for(var p,f=C(o.outEdges());!(p=f()).done;){var y=p.value;y.EdgeToAncestor()===Qr.FromAncestor?(null==r&&(r=new Le(function(){return o.boundaryCurve})),y.sourcePort=r):l.FixPortAtSource(e,y)}for(var P,m=C(o.selfEdges());!(P=m()).done;){var L=P.value;l.FixPortAtSource(e,L),l.FixPortAtTarget(e,L)}return t},l.FixPortAtSource=function(o,t){null!=t&&null==t.sourcePort&&(t.sourcePort=o)},l.FixPortAtTarget=function(o,t){null!=t&&null==t.targetPort&&(t.targetPort=o)},l}();function tu(l,s){for(var t,o=C(l.shallowNodes);!(t=o()).done;){var e=t.value;if(e instanceof Ae){var r=yi.CreateShapeWithClusterBoundaryPort(e);s.set(e,r);var i=e;if(!i.isCollapsed){tu(i,s);for(var c,h=C(i.shallowNodes);!(c=h()).done;)r.AddChild(s.get(c.value))}}else s.set(e,yi.CreateShapeWithCenterPort(e))}}function un(){un=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var gr,Bn=function(){function l(o){this.arrayOfMaps=new Array(o);for(var t=0;t<o;t++)this.arrayOfMaps[t]=new Map}var s=l.prototype;return s.isEmpty=function(){if(0===this.arrayOfMaps.length)return!0;for(var e,t=C(this.arrayOfMaps);!(e=t()).done;)if(e.value.size>0)return!1;return!0},s.set=function(t,e,r){this.arrayOfMaps[t].set(e,r)},s.setPair=function(t,e){this.set(t.x,t.y,e)},s.delete=function(t,e){t<0||t>=this.arrayOfMaps.length||this.arrayOfMaps[t].delete(e)},s.has=function(t,e){return!(t<0||t>=this.arrayOfMaps.length)&&this.arrayOfMaps[t].has(e)},s.get=function(t,e){return t<0||t>=this.arrayOfMaps.length?null:this.arrayOfMaps[t].get(e)},s.getI=function(t){return this.get(t.x,t.y)},s.keys=un().mark(function o(){var t,r,i,h;return un().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t=0;case 1:if(!(t<this.arrayOfMaps.length)){f.next=13;break}r=C(this.arrayOfMaps[t]);case 4:if((i=r()).done){f.next=10;break}return h=i.value,f.next=8,new Lt(t,h[0]);case 8:f.next=4;break;case 10:t++,f.next=1;break;case 13:case"end":return f.stop()}},o,this)}),s.keyValues=un().mark(function o(){var t,r,i,h;return un().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t=0;case 1:if(!(t<this.arrayOfMaps.length)){f.next=13;break}r=C(this.arrayOfMaps[t]);case 4:if((i=r()).done){f.next=10;break}return h=i.value,f.next=8,[new Lt(t,h[0]),h[1]];case 8:f.next=4;break;case 10:t++,f.next=1;break;case 13:case"end":return f.stop()}},o,this)}),s.values=un().mark(function o(){var t,r,i,h;return un().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t=0;case 1:if(!(t<this.arrayOfMaps.length)){f.next=13;break}r=C(this.arrayOfMaps[t]);case 4:if((i=r()).done){f.next=10;break}return h=i.value,f.next=8,h[1];case 8:f.next=4;break;case 10:t++,f.next=1;break;case 13:case"end":return f.stop()}},o,this)}),l}();!function(l){l[l.NotVisited=0]="NotVisited",l[l.InStack=1]="InStack",l[l.Visited=2]="Visited"}(gr||(gr={}));var io,Bh=function(s,o){this.v=s,this.i=o},mi=function(){function l(){}return l.getFeedbackSetWithConstraints=function(o,t){throw new Error("Method not implemented.")},l.push=function(o,t,e,r){t[e]=gr.InStack,o.push(new Bh(e,r))},l.getFeedbackSet=function(o){var t=new Bn(o.nodeCount);if(null==o||0===o.nodeCount)return[];for(var e=new Array(o.nodeCount).fill(gr.NotVisited),r=0;r<o.nodeCount;r++)if(e[r]!==gr.Visited){var i=new jt.K,h=0;for(l.push(i,e,r,h);i.size>0;){var c=i.pop();e[r=c.v]=gr.Visited,h=c.i;for(var f=o.outEdges[r];h<f.length;h++){var p=f[h];if(p.source!==p.target){var y=e[p.target];y===gr.InStack?t.set(p.source,p.target,p):y===gr.NotVisited&&(l.push(i,e,r,h+1),r=p.target,e[p.target]=gr.Visited,f=o.outEdges[r],h=-1)}}}}return Array.from(t.values())},l}(),Nr=function(){function l(){this.isEmpty=!0}return l.prototype.AddValue=function(t){this.isEmpty?(this.max=t,this.min=t,this.isEmpty=!1):t<this.min?this.min=t:t>this.max&&(this.max=t)},l.sign=function(t){return t>q.distanceEpsilon?1:t<-q.distanceEpsilon?-1:0},Q(l,[{key:"length",get:function(){return this.max-this.min}}]),l}(),ia=function(){function l(o){this.Right=o,this.Left=o}var s=l.prototype;return s.SetActiveState=function(t,e){this.IsActive=t,this.VectorIndex=e,this.IsActive?(this.Left.ActiveConstraintCount++,this.Right.ActiveConstraintCount++):(this.Left.ActiveConstraintCount--,this.Right.ActiveConstraintCount--)},s.SetVectorIndex=function(t){this.VectorIndex=t},s.Reinitialize=function(){this.IsActive=!1,this.IsUnsatisfiable=!1,this.ClearDfDv()},s.UpdateGap=function(t){this.Gap=t},l.constructorVVNB=function(t,e,r,i){var h=new l(t);return h.Left=t,h.Right=e,h.Gap=r,h.IsEquality=i,h.Lagrangian=0,h.IsActive=!1,h},s.ToString=function(){return $t.Ld.Format("  Cst: [{0}] [{1}] {2} {3:F5} vio {4:F5} Lm {5:F5}/{6:F5} {7}actv",this.Left,this.Right,this.IsEquality?"==":">=",this.Gap,this.Violation,this.Lagrangian,2*this.Lagrangian,this.IsActive?"+":this.IsUnsatisfiable?"!":"-")},s.ClearDfDv=function(){this.Lagrangian=0},s.CompareTo=function(t){var e=this.Left.CompareTo(t.Left);return 0===e&&(e=this.Right.CompareTo(t.Right)),0===e&&(e=It(this.Gap,t.Gap)),e},Q(l,[{key:"Violation",get:function(){return this.Left.ActualPos*this.Left.Scale+(this.Gap-this.Right.ActualPos*this.Right.Scale)}}]),l}(),oa=function(){function l(o){this.ConstraintToEval=o,this.Depth=-1}l.constructorDCVV=function(t,e,r,i){var h=new l(e);return h.Set(t,e,r,i),h};var s=l.prototype;return s.Set=function(t,e,r,i){return this.Parent=t,this.ConstraintToEval=e,this.VariableToEval=r,this.VariableDoneEval=i,this.Depth=0,this.ChildrenHaveBeenPushed=!1,e.Lagrangian=0,this},s.toString=function(){return $t.Ld.Format("{0} {1}{2} - {3}{4} ({5})","",this.IsLeftToRight?"":"*",this.ConstraintToEval.Left.Name,this.IsLeftToRight?"*":"",this.ConstraintToEval.Right.Name,this.Depth)},Q(l,[{key:"IsLeftToRight",get:function(){return this.VariableToEval===this.ConstraintToEval.Right}}]),l}(),Mh=function(s,o){this.Constraint=s,this.IsForward=o},eu=function(){function l(o,t){this.Variables=new Array,null!=o&&this.AddVariable(o),this.allConstraints=t}var s=l.prototype;return s.toString=function(){return $t.Ld.Format("[Block: nvars = {0} refpos = {1:F5} scale = {2:F5}]",this.Variables.length,this.ReferencePos,this.Scale)},s.ComputeDfDv=function(t){this.allConstraints.DfDvStack=new jt.K;var e=new ia(t);this.dfDvDummyParentNode=new oa(e);var r=this.GetDfDvNode(this.dfDvDummyParentNode,e,t,null);for(this.allConstraints.DfDvStack.push(r);;){var i=this.allConstraints.DfDvStack.top,h=this.allConstraints.DfDvStack.length;if(!i.ChildrenHaveBeenPushed){i.ChildrenHaveBeenPushed=!0;for(var f,c=C(i.VariableToEval.LeftConstraints);!(f=c()).done;){var p=f.value;if(p.IsActive&&p.Right!==i.VariableDoneEval){var y=this.GetDfDvNode(i,p,p.Right,i.VariableToEval);1===p.Right.ActiveConstraintCount?this.ProcessDfDvLeafNodeDirectly(y):this.PushDfDvNode(y)}}for(var P,m=C(i.VariableToEval.RightConstraints);!(P=m()).done;){var L=P.value;if(L.IsActive&&L.Left!==i.VariableDoneEval){var E=this.GetDfDvNode(i,L,L.Left,i.VariableToEval);1===L.Left.ActiveConstraintCount?this.ProcessDfDvLeafNodeDirectly(E):this.PushDfDvNode(E)}}if(this.allConstraints.DfDvStack.length>h)continue}if(this.allConstraints.DfDvStack.pop(),this.ProcessDfDvLeafNode(i),i===r)break}},s.ProcessDfDvLeafNode=function(t){var e=t.VariableToEval.DfDv;t.IsLeftToRight?(t.ConstraintToEval.Lagrangian=t.ConstraintToEval.Lagrangian+e,t.Parent.ConstraintToEval.Lagrangian=t.Parent.ConstraintToEval.Lagrangian+t.ConstraintToEval.Lagrangian):(t.ConstraintToEval.Lagrangian=-1*(t.ConstraintToEval.Lagrangian+e),t.Parent.ConstraintToEval.Lagrangian=t.Parent.ConstraintToEval.Lagrangian-t.ConstraintToEval.Lagrangian),this.CheckForConstraintPathTarget(t),this.Debug_CheckForViolatedActiveConstraint(t.ConstraintToEval),this.allConstraints.RecycleDfDvNode(t)},s.Debug_CheckForViolatedActiveConstraint=function(t){},s.ProcessDfDvLeafNodeDirectly=function(t){this.ProcessDfDvLeafNode(t)},s.GetDfDvNode=function(t,e,r,i){var h=this.allConstraints.DfDvRecycleStack.size>0?this.allConstraints.DfDvRecycleStack.pop().Set(t,e,r,i):oa.constructorDCVV(t,e,r,i);return h.Depth=h.Parent.Depth+1,this.allConstraints.MaxConstraintTreeDepth<h.Depth&&(this.allConstraints.MaxConstraintTreeDepth=h.Depth),h},s.PushDfDvNode=function(t){this.PushOnDfDvStack(t)},s.AddVariableAndPushDfDvNode=function(t,e){t.push(e.VariableToEval),this.PushOnDfDvStack(e)},s.PushOnDfDvStack=function(t){this.allConstraints.DfDvStack.push(t)},s.CheckForConstraintPathTarget=function(t){if(this.pathTargetVariable===t.VariableToEval){for(;t.Parent!==this.dfDvDummyParentNode;)this.constraintPath.push(new Mh(t.ConstraintToEval,t.IsLeftToRight)),t=t.Parent;this.pathTargetVariable=null}},s.Expand=function(t){null==this.constraintPath&&(this.constraintPath=new Array),this.constraintPath=[],this.pathTargetVariable=t.Right,this.ComputeDfDv(t.Left);var e=null;if(this.constraintPath.length>0){for(var i,r=C(this.constraintPath);!(i=r()).done;){var h=i.value;h.IsForward&&(null==e||h.Constraint.Lagrangian<e.Lagrangian)&&(h.Constraint.IsEquality||(e=h.Constraint))}null!=e&&this.allConstraints.DeactivateConstraint(e)}if(this.constraintPath=[],this.pathTargetVariable=null,null==e)return t.IsUnsatisfiable=!0,void this.allConstraints.NumberOfUnsatisfiableConstraints++;var c=new Array;this.GetConnectedVariables(c,t.Right,t.Left);for(var f=t.Violation,p=c.length,y=0;y<p;y++)c[y].OffsetInBlock=c[y].OffsetInBlock+f;this.allConstraints.ActivateConstraint(t),t.ClearDfDv(),this.UpdateReferencePos()},s.Split=function(t){if(t&&this.UpdateReferencePos(),this.Variables.length<2)return null;var e=null;this.ComputeDfDv(this.Variables[0]);for(var r=this.allConstraints.SolverParameters.Advanced.MinSplitLagrangianThreshold,i=this.Variables.length,h=0;h<i;h++)for(var f,c=C(this.Variables[h].LeftConstraints);!(f=c()).done;){var p=f.value;p.IsActive&&!p.IsEquality&&p.Lagrangian<r&&(e=p,r=p.Lagrangian)}return null==e?null:this.SplitOnConstraint(e)},s.SplitOnConstraint=function(t){this.allConstraints.DeactivateConstraint(t);var e=new l(null,this.allConstraints);return this.TransferConnectedVariables(e,t.Right,t.Left),e.Variables.length>0?(this.UpdateReferencePos(),e.UpdateReferencePos()):e=null,e},s.AddVariable=function(t){this.Variables.push(t),t.Block=this,1===this.Variables.length?(this.Scale=t.Scale,this.ReferencePos=t.ActualPos,this.sumAd=t.ActualPos*t.Weight,this.sumAb=0,this.sumA2=t.Weight,t.OffsetInBlock=0):this.AddVariableToBlockSums(t)},s.UpdateReferencePos=function(){this.Scale=this.Variables[0].Scale,this.sumAd=0,this.sumAb=0,this.sumA2=0;for(var t=this.Variables.length,e=0;e<t;e++)this.AddVariableToBlockSums(this.Variables[e]);this.UpdateReferencePosFromSums()},s.AddVariableToBlockSums=function(t){var e=this.Scale/t.Scale,r=t.OffsetInBlock/t.Scale,i=e*t.Weight;this.sumAd+=i*t.DesiredPos,this.sumAb+=i*r,this.sumA2+=i*e},s.UpdateReferencePosFromSums=function(){if(!(Number.isFinite(this.sumAd)&&Number.isFinite(this.sumAb)&&Number.isFinite(this.sumA2)))throw new Error("infinite numbers");this.ReferencePos=(this.sumAd-this.sumAb)/this.sumA2,this.UpdateVariablePositions()},s.UpdateVariablePositions=function(){for(var t=this.Scale*this.ReferencePos,e=this.Variables.length,r=0;r<e;r++){var i=this.Variables[r];i.ActualPos=(t+i.OffsetInBlock)/i.Scale}},s.GetConnectedVariables=function(t,e,r){this.RecurseGetConnectedVariables(t,e,r)},s.RecurseGetConnectedVariables=function(t,e,r){this.allConstraints.DfDvStack=new jt.K;var i=new ia(e);for(this.dfDvDummyParentNode=new oa(i),this.allConstraints.DfDvStack.push(this.GetDfDvNode(this.dfDvDummyParentNode,i,e,r)),t.push(e);this.allConstraints.DfDvStack.length>0;){var h=this.allConstraints.DfDvStack.top,c=this.allConstraints.DfDvStack.length;if(!h.ChildrenHaveBeenPushed){h.ChildrenHaveBeenPushed=!0;for(var p,f=C(h.VariableToEval.LeftConstraints);!(p=f()).done;){var y=p.value;y.IsActive&&y.Right!==h.VariableDoneEval&&(1===y.Right.ActiveConstraintCount?t.push(y.Right):this.AddVariableAndPushDfDvNode(t,this.GetDfDvNode(h,y,y.Right,h.VariableToEval)))}for(var P,m=C(h.VariableToEval.RightConstraints);!(P=m()).done;){var L=P.value;L.IsActive&&L.Left!==h.VariableDoneEval&&(1===L.Left.ActiveConstraintCount?t.push(L.Left):this.AddVariableAndPushDfDvNode(t,this.GetDfDvNode(h,L,L.Left,h.VariableToEval)))}}this.allConstraints.DfDvStack.length>c||this.allConstraints.RecycleDfDvNode(this.allConstraints.DfDvStack.pop())}},s.TransferConnectedVariables=function(t,e,r){this.GetConnectedVariables(t.Variables,e,r);for(var i=t.Variables.length,h=0;h<i;h++)t.Variables[h].Block=t;for(var c=this.Variables.length-1,f=this.Variables.length-1;f>=0;f--)this.Variables[f].Block===t&&(f<c&&(this.Variables[f]=this.Variables[c]),c--);if(this.Variables=this.Variables.slice(0,c+1),0===this.Variables.length){for(var y=0;y<i;y++){var m=t.Variables[y];this.Variables.push(m),m.Block=this}t.Variables=[]}},l}(),Vh=function(){function l(){this.Vector=new Array}var s=l.prototype;return s.item=function(t){return this.Vector[t]},s.Add=function(t){t.VectorIndex=this.Vector.length,this.Vector.push(t)},s.Remove=function(t){var e=this.Vector[this.Vector.length-1];this.Vector[t.VectorIndex]=e,e.VectorIndex=t.VectorIndex,this.Vector.pop()},s.toString=function(){return this.Vector.toString()},Q(l,[{key:"Count",get:function(){return this.Vector.length}}]),l}(),Dh=function(){function l(){this.nextConstraintIndex=0,this.DfDvStack=new jt.K,this.DfDvRecycleStack=new jt.K}var s=l.prototype;return s.Create=function(t){this.Vector=new Array(t),this.firstActiveConstraintIndex=t},s.Add=function(t){t.SetVectorIndex(this.nextConstraintIndex),this.Vector[this.nextConstraintIndex++]=t},s.ActivateConstraint=function(t){this.firstActiveConstraintIndex--,this.SwapConstraint(t)},s.DeactivateConstraint=function(t){this.SwapConstraint(t),this.firstActiveConstraintIndex++},s.SwapConstraint=function(t){var e=this.Vector[this.firstActiveConstraintIndex];e.SetVectorIndex(t.VectorIndex),this.Vector[t.VectorIndex]=e,this.Vector[this.firstActiveConstraintIndex]=t,t.SetActiveState(!t.IsActive,this.firstActiveConstraintIndex)},s.Reinitialize=function(){if(null!=this.Vector){for(var e,t=C(this.Vector);!(e=t()).done;)e.value.Reinitialize();this.firstActiveConstraintIndex=this.Vector.length}},s.RecycleDfDvNode=function(t){this.DfDvRecycleStack.length<1024&&this.DfDvRecycleStack.push(t)},s.toString=function(){return this.Vector.toString()},Q(l,[{key:"IsEmpty",get:function(){return null==this.Vector}}]),l}(),jh=function(){function l(){this.GapTolerance=1e-4,this.QpscConvergenceEpsilon=1e-5,this.QpscConvergenceQuotient=1e-6,this.OuterProjectIterationsLimit=-1,this.InnerProjectIterationsLimit=-1,this.TimeLimit=-1,this.Advanced=new Wh}var s=l.prototype;return s.Clone=function(){var t=this.MemberwiseClone();return t.Advanced=this.Advanced.Clone(),t},s.MemberwiseClone=function(){var t=new l;return t.GapTolerance=this.GapTolerance,t.QpscConvergenceEpsilon=this.QpscConvergenceEpsilon,t.QpscConvergenceQuotient=this.QpscConvergenceQuotient,t.OuterProjectIterationsLimit=this.OuterProjectIterationsLimit,t.InnerProjectIterationsLimit=this.InnerProjectIterationsLimit,t.TimeLimit=this.TimeLimit,t},l}(),Wh=function(){function l(){this.ForceQpsc=!1,this.ScaleInQpsc=!0,this.MinSplitLagrangianThreshold=-1e-7,this.UseViolationCache=!0,this.ViolationCacheMinBlocksDivisor=10,this.ViolationCacheMinBlocksCount=100}return l.prototype.Clone=function(){var t=new l;return t.ForceQpsc=this.ForceQpsc,t.ScaleInQpsc=this.ScaleInQpsc,t.MinSplitLagrangianThreshold=this.MinSplitLagrangianThreshold,t.UseViolationCache=this.UseViolationCache,t.ViolationCacheMinBlocksDivisor=this.ViolationCacheMinBlocksDivisor,t.ViolationCacheMinBlocksCount=this.ViolationCacheMinBlocksCount,t},l}(),Hh=function(s){this.Variable=s,this.OrigWeight=s.Weight,this.OrigScale=s.Scale,this.OrigDesiredPos=this.Variable.DesiredPos},_h=function(s,o){this.Value=s,this.Column=o},zh=function(){function l(o,t){this.newMatrixRow=new Array,this.previousFunctionValue=Number.MAX_VALUE,this.solverParameters=o,this.matrixQ=new Array(t).fill(0),this.vectorWiDi=new Array(t).fill(0),this.vectorQpscVars=new Array(t).fill(0),this.gradientVector=new Array(t).fill(0),this.vectorQg=new Array(t).fill(0),this.vectorPrevY=new Array(t).fill(0),this.vectorCurY=new Array(t).fill(0)}var s=l.prototype;return s.AddVariable=function(t){if(this.isFirstProjectCall=!0,this.vectorWiDi[t.Ordinal]=t.Weight*t.DesiredPos*2*-1,this.vectorPrevY[t.Ordinal]=t.Weight,null!=t.Neighbors)for(var r,e=C(t.Neighbors);!(r=e()).done;){var i=r.value;this.vectorPrevY[t.Ordinal]=this.vectorPrevY[t.Ordinal]+i.Weight,this.vectorPrevY[i.Neighbor.Ordinal]=this.vectorPrevY[i.Neighbor.Ordinal]-i.Weight}for(var h=0;h<this.vectorPrevY.length;h++)0!==this.vectorPrevY[h]&&(this.newMatrixRow.push(new _h(2*this.vectorPrevY[h],h)),this.vectorPrevY[h]=0);this.matrixQ[t.Ordinal]=Array.from(this.newMatrixRow),this.newMatrixRow=[],this.vectorQpscVars[t.Ordinal]=new Hh(t),t.Weight=1},s.VariablesComplete=function(){for(var e,t=C(this.vectorQpscVars);!(e=t()).done;)for(var c,i=e.value.Variable,h=C(this.matrixQ[i.Ordinal]);!(c=h()).done;){var f=c.value;f.Column===i.Ordinal&&(this.solverParameters.Advanced.ScaleInQpsc&&(i.Scale=1/Math.sqrt(Math.abs(f.Value)),Number.isFinite(i.Scale)||(i.Scale=1),this.vectorWiDi[i.Ordinal]=this.vectorWiDi[i.Ordinal]*i.Scale),this.vectorCurY[i.Ordinal]=i.ActualPos,i.DesiredPos=i.ActualPos)}if(this.solverParameters.Advanced.ScaleInQpsc)for(var p=0;p<this.matrixQ.length;p++)for(var y=this.matrixQ[p],m=0;m<y.length;m++)y[m].Value=y[m].Column===p?1:y[m].Value*(this.vectorQpscVars[p].Variable.Scale*this.vectorQpscVars[y[m].Column].Variable.Scale)},s.PreProject=function(){if(this.isFirstProjectCall)for(var e,t=C(this.vectorQpscVars);!(e=t()).done;){var r=e.value;this.vectorCurY[r.Variable.Ordinal]=r.Variable.ActualPos}if(this.MatrixVectorMultiply(this.vectorCurY,this.gradientVector),this.HasConverged())return!1;l.VectorVectorAdd(this.gradientVector,this.vectorWiDi,this.gradientVector);var i=l.VectorVectorMultiply(this.gradientVector,this.gradientVector),h=0;if(0!==i&&(this.MatrixVectorMultiply(this.gradientVector,this.vectorQg),h=l.VectorVectorMultiply(this.vectorQg,this.gradientVector)),0===h)return!1;var c=i/h;l.VectorCopy(this.vectorPrevY,this.vectorCurY),l.VectorScaledVectorSubtract(this.vectorPrevY,c,this.gradientVector,this.vectorCurY);for(var f=0;f<this.vectorCurY.length;f++)this.vectorQpscVars[f].Variable.DesiredPos=this.vectorCurY[f];return!0},s.PostProject=function(){for(var e,t=C(this.vectorQpscVars);!(e=t()).done;){var r=e.value;this.vectorCurY[r.Variable.Ordinal]=r.Variable.ActualPos}l.VectorVectorSubtract(this.vectorPrevY,this.vectorCurY,this.vectorCurY);var i=l.VectorVectorMultiply(this.gradientVector,this.vectorCurY),h=0;if(0!==i){this.MatrixVectorMultiply(this.vectorCurY,this.vectorQg);var c=l.VectorVectorMultiply(this.vectorQg,this.vectorCurY);(h=0===c?1:i/c)>1?h=1:h<0&&(h=0)}return l.VectorScaledVectorSubtract(this.vectorPrevY,h,this.vectorCurY,this.vectorCurY),this.isFirstProjectCall=!1,h>0},s.QpscComplete=function(){for(var e,t=C(this.vectorQpscVars);!(e=t()).done;){var r=e.value;r.Variable.Weight=r.OrigWeight,r.Variable.DesiredPos=r.OrigDesiredPos,this.solverParameters.Advanced.ScaleInQpsc&&(r.Variable.ActualPos=r.Variable.ActualPos*r.Variable.Scale,r.Variable.Scale=r.OrigScale)}return this.previousFunctionValue},s.HasConverged=function(){var t=this.GetFunctionValue(this.vectorCurY),e=!1;if(!this.isFirstProjectCall){var r=this.previousFunctionValue-t,i=0;0!==r&&(i=Math.abs(r/(0!==this.previousFunctionValue?this.previousFunctionValue:t))),(Math.abs(r)<this.solverParameters.QpscConvergenceEpsilon||Math.abs(i)<this.solverParameters.QpscConvergenceQuotient)&&(e=!0)}return this.previousFunctionValue=t,e},s.GetFunctionValue=function(t){return l.VectorVectorMultiply(this.gradientVector,t)/2+l.VectorVectorMultiply(this.vectorWiDi,t)},l.VectorVectorMultiply=function(t,e){for(var r=0,i=0;i<t.length;i++)r+=t[i]*e[i];return r},s.MatrixVectorMultiply=function(t,e){for(var h,r=0,i=C(this.matrixQ);!(h=i()).done;){for(var y,f=0,p=C(h.value);!(y=p()).done;){var m=y.value;f+=m.Value*t[m.Column]}e[r++]=f}},l.VectorVectorAdd=function(t,e,r){for(var i=0;i<t.length;i++)r[i]=t[i]+e[i]},l.VectorVectorSubtract=function(t,e,r){for(var i=0;i<t.length;i++)r[i]=t[i]-e[i]},l.VectorScaledVectorSubtract=function(t,e,r,i){for(var h=0;h<t.length;h++)i[h]=t[h]-e*r[h]},l.VectorCopy=function(t,e){for(var r=0;r<e.length;r++)t[r]=e[r]},l}(),ru=function(){function l(){this.NumberOfUnsatisfiableConstraints=0,this.OuterProjectIterations=0,this.InnerProjectIterationsTotal=0,this.MinInnerProjectIterations=0,this.MaxInnerProjectIterations=0,this.MaxConstraintTreeDepth=0,this.GoalFunctionValue=0,this.TimeLimitExceeded=!1,this.OuterProjectIterationsLimitExceeded=!1,this.InnerProjectIterationsLimitExceeded=!1}return l.prototype.Clone=function(){var t=new l;return t.GoalFunctionValue=this.GoalFunctionValue,t.InnerProjectIterationsLimitExceeded=this.InnerProjectIterationsLimitExceeded,t.InnerProjectIterationsTotal=this.InnerProjectIterationsTotal,t.MaxConstraintTreeDepth=this.MaxConstraintTreeDepth,t.OuterProjectIterations=this.OuterProjectIterations,t.OuterProjectIterationsLimitExceeded=this.OuterProjectIterationsLimitExceeded,t.AlgorithmUsed=this.AlgorithmUsed,t.NumberOfUnsatisfiableConstraints=this.NumberOfUnsatisfiableConstraints,t.MaxInnerProjectIterations=this.MaxInnerProjectIterations,t},Q(l,[{key:"ExecutionLimitExceeded",get:function(){return this.TimeLimitExceeded||this.OuterProjectIterationsLimitExceeded||this.InnerProjectIterationsLimitExceeded}}]),l}();!function(l){l[l.ProjectOnly=0]="ProjectOnly",l[l.QpscWithScaling=1]="QpscWithScaling",l[l.QpscWithoutScaling=2]="QpscWithoutScaling"}(io||(io={}));var qh=function(s,o){this.Neighbor=s,this.Weight=o},Uh=function(){function l(o,t,e,r,i){if(this.ActiveConstraintCount=0,r<=0)throw new Error("weight");if(i<=0)throw new Error("scale");var h=e*r;if(!Number.isFinite(h)||Number.isNaN(h))throw new Error("desiredPos");if(h=e*i,!Number.isFinite(h)||Number.isNaN(h))throw new Error("desiredPos");this.Ordinal=o,this.UserData=t,this.DesiredPos=e,this.Weight=r,this.Scale=i,this.OffsetInBlock=0,this.ActualPos=this.DesiredPos}var s=l.prototype;return s.Reinitialize=function(){this.ActiveConstraintCount=0,this.OffsetInBlock=0,this.ActualPos=this.DesiredPos},s.AddNeighbor=function(t,e){null==this.Neighbors&&(this.Neighbors=new Array),this.Neighbors.push(new qh(t,e))},s.toString=function(){return $t.Ld.Format("{0} {1:F5} ({2:F5}) {3:F5} {4:F5}",this.Name,this.ActualPos,this.DesiredPos,this.Weight,this.Scale)},s.SetConstraints=function(t,e){this.LeftConstraints=t,this.RightConstraints=e},s.CompareTo=function(t){return It(this.Ordinal,t.Ordinal)},Q(l,[{key:"DfDv",get:function(){return this.Weight*(this.ActualPos-this.DesiredPos)*2/this.Scale}},{key:"Name",get:function(){return null==this.UserData?"-0-":this.UserData.toString()}}]),l}(),nu=function(){function l(){}var s=l.prototype;return s.Clear=function(){this.LowViolation=0,this.numConstraints=0,this.constraints||(this.constraints=new Array(l.MaxConstraints))},s.FilterBlock=function(t){this.LowViolation=Number.MAX_VALUE;for(var e=this.numConstraints>0,r=this.numConstraints-1;r>=0;r--){var i=this.constraints[r];if(i.Left.Block===t||i.Right.Block===t||i.IsActive||i.IsUnsatisfiable)r<this.numConstraints-1&&(this.constraints[r]=this.constraints[this.numConstraints-1]),this.numConstraints--;else{var h=i.Left.ActualPos*i.Left.Scale+(i.Gap-i.Right.ActualPos*i.Right.Scale);h<this.LowViolation&&(this.LowViolation=h)}}return 0===this.numConstraints&&(this.LowViolation=0),e},s.FindIfGreater=function(t){for(var e=null,r=0;r<this.numConstraints;r++){var i=this.constraints[r],h=i.Left.ActualPos*i.Left.Scale+(i.Gap-i.Right.ActualPos*i.Right.Scale);h>t&&(t=h,e=i)}return e},s.Insert=function(t,e){for(var r=0,i=e,h=e,c=0;c<this.numConstraints;c++){var f=this.constraints[c],p=f.Left.ActualPos*f.Left.Scale+(f.Gap-f.Right.ActualPos*f.Right.Scale);p<i?(h=i,r=c,i=p):p<h&&(h=p)}this.IsFull?(this.constraints[r]=t,this.LowViolation=h):(this.constraints[this.numConstraints++]=t,this.IsFull&&(this.LowViolation=i))},Q(l,[{key:"IsFull",get:function(){return this.numConstraints===l.MaxConstraints}}]),l}();function aa(){aa=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}nu.MaxConstraints=20;var iu=function(s,o){this.NumberOfLeftConstraints=0,this.Constraints=s,this.NumberOfLeftConstraints=o},Yh=function(){function l(){this.allBlocks=new Vh,this.allConstraints=new Dh,this.numberOfConstraints=0,this.numberOfVariables=0,this.equalityConstraints=new Array,this.loadedVariablesAndConstraintLists=new Map,this.emptyConstraintList=new Array(0),this.updatedConstraints=new Array,this.violationCache=new nu,this.violationCacheMinBlockCutoff=0,this.nextVariableOrdinal=0,this.solverParams=new jh,this.solverSolution=new ru}var s=l.prototype;return s.AddVariableAN=function(t,e){return this.AddVariableANNN(t,e,1,1)},s.AddVariableANN=function(t,e,r){return this.AddVariableANNN(t,e,r,1)},s.AddVariableANNN=function(t,e,r,i){if(!this.allConstraints.IsEmpty)throw new Error("Cannot add Variables or Constraints once Solve() has been called");var h=new Uh(this.nextVariableOrdinal++,t,e,r,i),c=new eu(h,this.allConstraints);return h.Block=c,this.allBlocks.Add(c),this.numberOfVariables++,this.loadedVariablesAndConstraintLists.set(h,new iu(new Array,0)),h},s.UpdateVariables=function(){for(var e,t=C(this.allBlocks.Vector);!(e=t()).done;)e.value.UpdateReferencePos()},s.Constraints=aa().mark(function o(){var t,e,r,i,h,c,f,p,y,m;return aa().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(this.allConstraints.IsEmpty){L.next=10;break}t=C(this.allConstraints.Vector);case 2:if((e=t()).done){L.next=8;break}return r=e.value,L.next=6,r;case 6:L.next=2;break;case 8:L.next=28;break;case 10:i=C(this.loadedVariablesAndConstraintLists.keys());case 11:if((h=i()).done){L.next=28;break}if(null==(f=this.loadedVariablesAndConstraintLists.get(c=h.value)).Constraints){L.next=26;break}p=f.Constraints.length,y=0;case 17:if(!(y<p)){L.next=26;break}if(c!==(m=f.Constraints[y]).Left){L.next=23;break}return void(L.next=22);case 22:return L.abrupt("return",m);case 23:y++,L.next=17;break;case 26:L.next=11;break;case 28:case"end":return L.stop()}},o,this)}),s.AddEqualityConstraint=function(t,e,r){return this.AddConstraintVVNB(t,e,r,!0)},s.AddConstraintVVNB=function(t,e,r,i){if(!this.allConstraints.IsEmpty)throw new Error("Cannot add Variables or Constraints once Solve() has been called");if(t===e)throw new Error("Cannot add a constraint between a variable and itself");var h=this.loadedVariablesAndConstraintLists.get(t),c=this.loadedVariablesAndConstraintLists.get(e),f=ia.constructorVVNB(t,e,r,i);return this.loadedVariablesAndConstraintLists.set(t,new iu(h.Constraints,h.NumberOfLeftConstraints+1)),h.Constraints.push(f),c.Constraints.push(f),this.numberOfConstraints++,i&&this.equalityConstraints.push(f),f},s.AddConstraint=function(t,e,r){return this.AddConstraintVVNB(t,e,r,!1)},s.SetConstraintUpdate=function(t,e){e!==t.Gap&&this.updatedConstraints.push([t,e])},s.AddNeighborPair=function(t,e,r){if(r<=0||Number.isNaN(r)||!Number.isFinite(r))throw new Error("relationshipWeight");if(t===e)throw new Error;t.AddNeighbor(e,r),e.AddNeighbor(t,r),this.hasNeighbourPairs=!0},s.Solve=function(){return this.SolvePar(null)},s.SolvePar=function(t){t&&(this.solverParams=t.Clone()),this.solverParams.OuterProjectIterationsLimit<0&&(this.solverParams.OuterProjectIterationsLimit=100*(Math.floor(Math.log2(this.numberOfVariables))+1)),this.solverParams.InnerProjectIterationsLimit<0&&(this.solverParams.InnerProjectIterationsLimit=2*this.numberOfConstraints+100*(Math.max(0,Math.floor(Math.log2(this.numberOfConstraints)))+1));var e=!this.allConstraints.IsEmpty;if(this.CheckForUpdatedConstraints(),this.solverSolution=new ru,this.solverSolution.MinInnerProjectIterations=Number.MAX_VALUE,this.allConstraints.MaxConstraintTreeDepth=0,this.allConstraints.SolverParameters=this.solverParams,0===this.numberOfConstraints){if(!this.IsQpsc)return this.solverSolution.Clone()}else e||this.SetupConstraints();return this.allConstraints.NumberOfUnsatisfiableConstraints=0,this.MergeEqualityConstraints(),this.IsQpsc?this.SolveQpsc():(this.SolveByStandaloneProject(),this.CalculateStandaloneProjectGoalFunctionValue()),this.solverSolution.MinInnerProjectIterations>this.solverSolution.MaxInnerProjectIterations&&(this.solverSolution.MinInnerProjectIterations=this.solverSolution.MaxInnerProjectIterations),this.solverSolution.NumberOfUnsatisfiableConstraints=this.allConstraints.NumberOfUnsatisfiableConstraints,this.solverSolution.MaxConstraintTreeDepth=this.allConstraints.MaxConstraintTreeDepth,this.solverSolution.Clone()},s.CheckForUpdatedConstraints=function(){if(0!==this.updatedConstraints.length){for(var r,t=this.IsQpsc,e=C(this.updatedConstraints);!(r=e()).done;){var i=r.value,f=i[0];f.UpdateGap(i[1]),t||f.IsEquality?t=!0:this.SplitOnConstraintIfActive(f)}this.updatedConstraints=[],t&&this.ReinitializeBlocks()}},s.SplitOnConstraintIfActive=function(t){if(t.IsActive){var e=t.Left.Block.SplitOnConstraint(t);null!=e&&this.allBlocks.Add(e)}},s.SetupConstraints=function(){this.allConstraints.Create(this.numberOfConstraints);for(var e,t=C(this.loadedVariablesAndConstraintLists.keys());!(e=t()).done;){var r=e.value,i=this.loadedVariablesAndConstraintLists.get(r),h=i.Constraints,c=0,f=0,p=0;null!=h&&(p=(c=h.length)-(f=i.NumberOfLeftConstraints));var y=this.emptyConstraintList;0!==f&&(y=new Array(f));var m=this.emptyConstraintList;0!==p&&(m=new Array(p)),r.SetConstraints(y,m);for(var P=0,L=0,E=0;E<c;E++){var S=h[E];r===S.Left?y[P++]=S:m[L++]=S}for(var O,T=C(r.LeftConstraints);!(O=T()).done;)this.allConstraints.Add(O.value)}this.loadedVariablesAndConstraintLists.clear(),this.violationCacheMinBlockCutoff=Number.MAX_VALUE,this.solverParams.Advanced.UseViolationCache&&this.solverParams.Advanced.ViolationCacheMinBlocksDivisor>0&&(this.violationCacheMinBlockCutoff=Math.min(this.allBlocks.Count/this.solverParams.Advanced.ViolationCacheMinBlocksDivisor,this.solverParams.Advanced.ViolationCacheMinBlocksCount))},s.SolveByStandaloneProject=function(){for(;;){if(!this.RunProject())return;if(!this.SplitBlocks())break}},s.RunProject=function(){return this.solverSolution.OuterProjectIterations++,this.Project(),!this.CheckForLimitsExceeded()},s.CheckForLimitsExceeded=function(){return this.solverParams.OuterProjectIterationsLimit>0&&this.solverSolution.OuterProjectIterations>=this.solverParams.OuterProjectIterationsLimit?(this.solverSolution.OuterProjectIterationsLimitExceeded=!0,!0):!!this.solverSolution.InnerProjectIterationsLimitExceeded},s.CalculateStandaloneProjectGoalFunctionValue=function(){this.solverSolution.GoalFunctionValue=0;for(var t=this.allBlocks.Count,e=0;e<t;e++)for(var r=this.allBlocks.item(e),i=r.Variables.length,h=0;h<i;h++){var c=r.Variables[h];this.solverSolution.GoalFunctionValue+=c.Weight*(c.ActualPos*c.ActualPos),this.solverSolution.GoalFunctionValue-=c.Weight*(c.DesiredPos*c.ActualPos)*2}},s.SolveQpsc=function(){if(this.solverSolution.AlgorithmUsed=this.solverParams.Advanced.ScaleInQpsc?io.QpscWithScaling:io.QpscWithoutScaling,this.QpscMakeFeasible()){for(var r,t=new zh(this.solverParams,this.numberOfVariables),e=C(this.allBlocks.Vector);!(r=e()).done;)for(var c,h=C(r.value.Variables);!(c=h()).done;)t.AddVariable(c.value);t.VariablesComplete(),this.ReinitializeBlocks(),this.MergeEqualityConstraints();for(var p=!1;(t.PreProject()||p)&&(p=this.SplitBlocks(),this.RunProject())&&(t.PostProject()||p););this.solverSolution.GoalFunctionValue=t.QpscComplete()}},s.QpscMakeFeasible=function(){return this.RunProject()},s.ReinitializeBlocks=function(){var t=Array.from(this.allBlocks.Vector);this.allBlocks.Vector=[];for(var e=0,r=t;e<r.length;e++)for(var c,h=C(r[e].Variables);!(c=h()).done;){var f=c.value;f.Reinitialize();var p=new eu(f,this.allConstraints);this.allBlocks.Add(p)}this.allConstraints.Reinitialize(),this.violationCache.Clear()},s.MergeEqualityConstraints=function(){for(var e,t=C(this.equalityConstraints);!(e=t()).done;){var r=e.value;r.Left.Block!==r.Right.Block?this.MergeBlocks(r):Math.abs(r.Violation)>this.solverParams.GapTolerance&&(r.IsUnsatisfiable=!0,this.allConstraints.NumberOfUnsatisfiableConstraints++)}},s.Project=function(){if(0===this.numberOfConstraints)return!1;this.violationCache.Clear(),this.lastModifiedBlock=null;var t=this.allBlocks.Count>this.violationCacheMinBlockCutoff,e=1,i=this.GetMaxViolatedConstraint({maxViolation:0},t);if(!i)return!1;for(;i;){if(i.Left.Block===i.Right.Block?(i.Left.Block.Expand(i),i.IsUnsatisfiable&&this.violationCache.Clear(),this.lastModifiedBlock=i.Left.Block):this.lastModifiedBlock=this.MergeBlocks(i),this.solverParams.InnerProjectIterationsLimit>0&&e>=this.solverParams.InnerProjectIterationsLimit){this.solverSolution.InnerProjectIterationsLimitExceeded=!0;break}(t=this.allBlocks.Count>this.violationCacheMinBlockCutoff)||this.violationCache.Clear(),e++,i=this.GetMaxViolatedConstraint({maxViolation:0},t)}return this.solverSolution.InnerProjectIterationsTotal=this.solverSolution.InnerProjectIterationsTotal+e,this.solverSolution.MaxInnerProjectIterations<e&&(this.solverSolution.MaxInnerProjectIterations=e),this.solverSolution.MinInnerProjectIterations>e&&(this.solverSolution.MinInnerProjectIterations=e),!0},s.MergeBlocks=function(t){var e=t.Left.Block,r=t.Right.Block,i=t.Left.OffsetInBlock+(t.Gap-t.Right.OffsetInBlock);r.Variables.length>e.Variables.length&&(e=t.Right.Block,r=t.Left.Block,i=-i);for(var h=r.Variables.length,c=0;c<h;c++){var f=r.Variables[c];f.OffsetInBlock+=i,e.AddVariable(f)}return e.UpdateReferencePosFromSums(),this.allConstraints.ActivateConstraint(t),this.allBlocks.Remove(r),e},s.SplitBlocks=function(){for(var t=new Array,e=this.allBlocks.Count,r=0;r<e;r++){var h=this.allBlocks.item(r).Split(this.IsQpsc);null!=h&&t.push(h)}for(var c=t.length,f=0;f<c;f++)this.allBlocks.Add(t[f]);return 0!==t.length},s.GetMaxViolatedConstraint=function(t,e){return t.maxViolation=this.solverParams.GapTolerance,this.SearchViolationCache(t.maxViolation)??this.SearchAllConstraints(t.maxViolation,e)},s.SearchViolationCache=function(t){var e=null;if(null!=this.lastModifiedBlock){this.lastModifiedBlock.Variables.length<this.numberOfVariables+1&&this.violationCache.FilterBlock(this.lastModifiedBlock);for(var r=this.lastModifiedBlock.Variables.length,i=0;i<r;i++){for(var f,h=this.lastModifiedBlock.Variables[i],c=C(h.LeftConstraints);!(f=c()).done;){var p=f.value;p.IsActive||p.IsUnsatisfiable||xo(p.Left.ActualPos*p.Left.Scale+(p.Gap-p.Right.ActualPos*p.Right.Scale),t)&&(null!=e&&t>this.violationCache.LowViolation&&this.violationCache.Insert(e,t),t=p.Violation,e=p)}for(var P,m=C(h.RightConstraints);!(P=m()).done;){var L=P.value;if(!L.IsActive&&!L.IsUnsatisfiable&&L.Left.Block!==this.lastModifiedBlock){var E=L.Left.ActualPos*L.Left.Scale+(L.Gap-L.Right.ActualPos*L.Right.Scale);xo(E,t)&&(null!=e&&t>this.violationCache.LowViolation&&this.violationCache.Insert(e,t),t=E,e=L)}}}var S=this.violationCache.FindIfGreater(t);return null!=S&&(null!=e&&t>this.violationCache.LowViolation&&this.violationCache.Insert(e,t),e=S),e}},s.SearchAllConstraints=function(t,e){var r=null;this.violationCache.Clear();for(var h,i=C(this.allConstraints.Vector);!(h=i()).done;){var c=h.value;if(c.IsActive)break;if(!c.IsUnsatisfiable){var f=c.Left.ActualPos*c.Left.Scale+(c.Gap-c.Right.ActualPos*c.Right.Scale),p=null,y=0;xo(f,t)&&(t>this.violationCache.LowViolation&&(p=r,y=t),t=f,r=c),e&&(null==p&&c!==r&&(!this.violationCache.IsFull||f>this.violationCache.LowViolation)&&(p=c,y=f),null!=p&&y>this.violationCache.LowViolation&&this.violationCache.Insert(p,y))}}return r},Q(l,[{key:"IsQpsc",get:function(){return this.hasNeighbourPairs||this.solverParams.Advanced.ForceQpsc}},{key:"Variables",get:function(){return ai(this.allBlocks.Vector,function(t){return t.Variables})}},{key:"VariableCount",get:function(){return this.numberOfVariables}},{key:"ConstraintCount",get:function(){return this.numberOfConstraints}}]),l}(),ou=function(){function l(){this.variables=new Map,this.fixedVars=new Map,this.FailToAdjustEpsilon=.001,this.InitSolver()}var s=l.prototype;return s.AddVariableWithIdealPositionNNN=function(t,e,r){this.variables.set(t,this.solver.AddVariableANN(t,e,r))},s.AddVariableWithIdealPositionNN=function(t,e){this.AddVariableWithIdealPositionNNN(t,e,1)},s.AddLeftRightSeparationConstraintNNNB=function(t,e,r,i){var h=this.GetVariable(t);if(null!=h){var c=this.GetVariable(e);null!=c&&this.solver.AddConstraintVVNB(h,c,r,i)}},s.AddLeftRightSeparationConstraintNNN=function(t,e,r){this.AddLeftRightSeparationConstraintNNNB(t,e,r,!1)},s.AddGoalTwoVariablesAreCloseNNN=function(t,e,r){var i=this.GetVariable(t);if(null!=i){var h=this.GetVariable(e);null!=h&&this.solver.AddNeighborPair(i,h,r)}},s.AddGoalTwoVariablesAreClose=function(t,e){this.AddGoalTwoVariablesAreCloseNNN(t,e,1)},s.GetVariable=function(t){return this.variables.get(t)},s.Solve=function(){this.SolveP(null)},s.SolveP=function(t){this.SolvePNS(t,{executionLimitExceeded:!1})},s.SolvePNS=function(t,e){var r;do{this.solution=null;var i=null;if(null!=t&&null==(i=t))throw new Error("parameters");this.solution=this.solver.SolvePar(i),e.executionLimitExceeded=this.solution.ExecutionLimitExceeded,r=this.AdjustConstraintsForMovedFixedVars()}while(r&&!1===this.solution.ExecutionLimitExceeded);return!1===this.solution.ExecutionLimitExceeded},s.AdjustConstraintsForMovedFixedVars=function(){for(var r,t=new Set,e=C(this.fixedVars.entries());!(r=e()).done;){var i=r.value,h=i[0];l.Close(i[1],this.GetVariableResolvedPosition(h))||t.add(h)}return 0!==t.size&&this.AdjustConstraintsForMovedFixedVarSet(t)},l.Close=function(t,e){return Math.abs(t-e)<5e-4},s.AdjustConstraintsForMovedFixedVarSet=function(t){for(;t.size>0;){for(var i,e=void 0,r=C(t);!(i=r()).done;){e=i.value;break}if(!this.AdjustSubtreeOfFixedVar(e,t))return!1}return!0},s.AdjustSubtreeOfFixedVar=function(t,e){var r={successInAdjusting:!1},i=this.AdjustConstraintsOfNeighborsOfFixedVariable(t,r);if(!r.successInAdjusting||0===i.length)return!1;for(var c,h=C(i);!(c=h()).done;)e.delete(c.value);return!0},s.AdjustConstraintsOfNeighborsOfFixedVariable=function(t,e){for(var p,r=this.variables.get(t).Block.Variables,i=new Nr,h=new Nr,c=1,f=C(r);!(p=f()).done;){var y=p.value;this.fixedVars.has(y.UserData)&&(i.AddValue(y.ActualPos),h.AddValue(y.DesiredPos),h.length>0&&(c=Math.max(c,i.length/h.length)))}return 1===c&&(c=2),e.successInAdjusting=this.FixActiveConstraints(r,c),r.map(function(m){return m.UserData})},s.FixActiveConstraints=function(t,e){for(var h,r=!1,i=C(t);!(h=i()).done;)for(var p,f=C(h.value.LeftConstraints);!(p=f()).done;){var y=p.value;y.IsActive&&(y.Gap>this.FailToAdjustEpsilon&&(r=!0),this.solver.SetConstraintUpdate(y,y.Gap/e))}return r},s.GetVariableResolvedPosition=function(t){var e=this.GetVariable(t);return null==e?0:e.ActualPos},s.InitSolver=function(){this.solver=new Yh,this.variables.clear()},s.AddFixedVariable=function(t,e){this.AddVariableWithIdealPositionNNN(t,e,l.FixedVarWeight),this.fixedVars.set(t,e)},s.ContainsVariable=function(t){return this.variables.has(t)},s.GetVariableIdealPosition=function(t){return this.variables.get(t).DesiredPos},Q(l,[{key:"Solution",get:function(){return this.solution}}]),l}();ou.FixedVarWeight=1e9;var Qh=function(){function l(){this.lowBound=Number.NEGATIVE_INFINITY,this.upperBound=Number.POSITIVE_INFINITY}return l.prototype.toString=function(){return this.lowBound+" "+this.Position+" "+this.upperBound},Q(l,[{key:"Position",get:function(){return this.position},set:function(t){this.position=t<this.lowBound?this.lowBound:t>this.upperBound?this.upperBound:t}},{key:"LowBound",get:function(){return this.lowBound},set:function(t){this.lowBound=t}},{key:"UpperBound",get:function(){return this.upperBound},set:function(t){this.upperBound=t}}]),l}(),Xh=function(){function l(o){this.idealPositions=new Map,this.varList=new Array,this.constraints=new Set,this.solverShell=new ou,this.boundsToInt=new Map,this.varSepartion=o}var s=l.prototype;return s.SetLowBound=function(t,e){var r=this.Var(e);r.LowBound=Math.max(t,r.LowBound)},s.Var=function(t){return this.varList[t]},s.SetUpperBound=function(t,e){var r=this.Var(t);r.UpperBound=Math.min(e,r.UpperBound)},s.Solve=function(){this.SolveByRegularSolver()},s.SolveByRegularSolver=function(){this.CreateVariablesForBounds();for(var t=0;t<this.varList.length;t++){var e=this.varList[t];e.IsFixed?this.solverShell.AddFixedVariable(t,e.Position):(this.solverShell.AddVariableWithIdealPositionNN(t,this.idealPositions.get(t)),e.LowBound!==Number.NEGATIVE_INFINITY&&this.constraints.add(new Lt(this.GetBoundId(e.LowBound),t)),e.UpperBound!==Number.POSITIVE_INFINITY&&this.constraints.add(new Lt(t,this.GetBoundId(e.UpperBound))))}this.CreateGraphAndRemoveCycles();for(var i,r=C(this.graph.edges);!(i=r()).done;){var h=i.value,c=0;h.x<this.varList.length&&(c+=this.varList[h.x].Width),h.y<this.varList.length&&(c+=this.varList[h.y].Width),this.solverShell.AddLeftRightSeparationConstraintNNN(h.x,h.y,this.varSepartion+(c/=2))}this.solverShell.Solve();for(var f=0;f<this.varList.length;f++)this.varList[f].Position=this.solverShell.GetVariableResolvedPosition(f)},s.GetBoundId=function(t){return this.boundsToInt.get(t)},s.CreateVariablesForBounds=function(){for(var e,t=C(this.varList);!(e=t()).done;){var r=e.value;r.IsFixed||(r.LowBound!==Number.NEGATIVE_INFINITY&&this.RegisterBoundVar(r.LowBound),r.UpperBound!==Number.POSITIVE_INFINITY&&this.RegisterBoundVar(r.UpperBound))}},s.RegisterBoundVar=function(t){if(!this.boundsToInt.has(t)){var e=this.varList.length+this.boundsToInt.size;this.boundsToInt.set(t,e),this.solverShell.AddFixedVariable(e,t)}},s.CreateGraphAndRemoveCycles=function(){this.graph=Ke(Array.from(this.constraints),this.varList.length+this.boundsToInt.size);var t=mi.getFeedbackSet(this.graph);if(null!=t)for(var r,e=C(t);!(r=e()).done;)this.graph.removeEdge(r.value)},s.GetVariablePosition=function(t){return this.varList[t].Position},s.AddConstraint=function(t,e){this.constraints.add(new Lt(t,e))},s.AddVariableNNNN=function(t,e,r,i){this.idealPositions.set(t,r),this.AddVariableNNBN(t,e,!1,i)},s.AddFixedVariable=function(t,e){this.AddVariableNNBN(t,e,!0,0)},s.AddVariableNNBN=function(t,e,r,i){var h=new Qh;h.Position=e,h.IsFixed=r,h.Width=i,this.varList.push(h)},l}(),xt=function(){function l(){}return l.prototype.clone=function(){var t=new l;return t.transparency=this.transparency,t.width=this.width,t.color=this.color,t.icurve=this.icurve.clone(),t.label=this.label,t.dashArray=this.dashArray,t.drawPN=this.drawPN,t},l.mkDebugCurveTWCILD=function(t,e,r,i,h,c,f){void 0===f&&(f=!1);var p=new l;return p.transparency=t,p.width=e,p.color=r,p.icurve=i,p.label=h,p.dashArray=c,p.drawPN=f,p},l.mkDebugCurveTWCI=function(t,e,r,i){return l.mkDebugCurveTWCILD(t,e,r,i,null,null)},l.mkDebugCurveWCI=function(t,e,r){return l.mkDebugCurveTWCI(255,t,e,r)},l.mkDebugCurveCI=function(t,e){return l.mkDebugCurveWCI(1,t,e)},l.mkDebugCurveI=function(t){return l.mkDebugCurveCI("Black",t)},l}();xt.colors=["DeepSkyBlue","IndianRed","Orange","Gold","DarkRed","Plum","Red","Violet","Indigo","Yellow","OrangeRed","Tomato","Purple","SaddleBrown","Green","Navy","Aqua","Pink","Bisque","Black","BlanchedAlmond","Blue","BlueViolet","Brown","Lime","BurlyWood","Chocolate","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","CadetBlue","Chartreuse","DarkBlue","DarkCyan","DarkGoldenrod","DarkGray","DarkGreen","DarkKhaki","DarkMagenta","DarkOliveGreen","DarkOrange","DarkOrchid","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkTurquoise","DarkViolet","DeepPink","DimGray","DodgerBlue","Firebrick","FloralWhite","ForestGreen","Fuchsia","CodeAnalysis","Gainsboro","GhostWhite","Goldenrod","Gray","GreenYellow","Honeydew","HotPink","Ivory","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenrodYellow","LightGray","LightGreen","LightPink","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSteelBlue","LightYellow","LimeGreen","Linen","Magenta","Maroon","MediumAquamarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","OldLace","Olive","OliveDrab","Orchid","PaleGoldenrod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","PowderBlue","RosyBrown","RoyalBlue","Salmon","SandyBrown","SeaGreen","CodeAnalysis","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Transparent","Turquoise","Aquamarine","Azure","Beige","Wheat","White","WhiteSmoke","YellowGreen","Khaki","AntiqueWhite"];var $h=function(l){function s(t,e){var r;return(r=l.call(this,t,e)||this).RightNeighbors=new Set,r.setOfLongestSegs=new Set,r.RightBound=Number.POSITIVE_INFINITY,r.LeftBound=Number.NEGATIVE_INFINITY,r.Direction=nt.DirectionFromPointToPoint(t.point,e.point),r}X(s,l);var o=s.prototype;return o.AddRightNeighbor=function(e){this.RightNeighbors.add(e)},o.AddLongestNudgedSegment=function(e){this.setOfLongestSegs.add(e)},o.BoundFromRight=function(e){e=Math.max(e,this.LeftBound),this.RightBound=Math.min(e,this.RightBound)},o.BoundFromLeft=function(e){e=Math.min(e,this.RightBound),this.LeftBound=Math.max(e,this.LeftBound)},Q(s,[{key:"LongestNudgedSegments",get:function(){return this.setOfLongestSegs}}]),s}(hr);function sa(){sa=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var ln=function(){function l(o){this.Point=o}var s=l.prototype;return s.GetEnumerator=sa().mark(function o(){var t;return sa().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=this;case 1:if(null==t){r.next=7;break}return r.next=4,t.Point;case 4:t=t.Next,r.next=1;break;case 7:case"end":return r.stop()}},o,this)}),s.InsertVerts=function(t,e,r){for(e--;t<e;e--)this.SetNewNext(r[e])},s.InsertVertsInReverse=function(t,e,r){for(t++;t<e;t++)this.SetNewNext(r[t])},s.SetNewNext=function(t){var e=new l(t),r=this.Next;this.Next=e,e.Next=r},Q(l,[{key:"X",get:function(){return this.Point.x}},{key:"Y",get:function(){return this.Point.y}}]),l}(),au=function(){function l(o,t){this.IsFixed=!1,this.Reversed=!1,this.index=-1,this.AxisEdge=o,this.Width=t}return l.prototype.toString=function(){return this.Source+" "+this.Target},l.VectorsAreParallel=function(t,e){return dt(t.x*e.y-t.y*e.x,0)},l.EdgesAreParallel=function(t,e){return l.VectorsAreParallel(t.AxisEdge.TargetPoint.sub(t.AxisEdge.SourcePoint),e.AxisEdge.TargetPoint.sub(e.AxisEdge.SourcePoint))},Q(l,[{key:"LongestNudgedSegment",get:function(){return this.longestNudgedSegment},set:function(t){this.longestNudgedSegment=t,null!=this.longestNudgedSegment&&(this.longestNudgedSegment.AddEdge(this),this.AxisEdge.AddLongestNudgedSegment(this.longestNudgedSegment))}},{key:"Source",get:function(){return this.Reversed?this.AxisEdge.TargetPoint:this.AxisEdge.SourcePoint}},{key:"Target",get:function(){return this.Reversed?this.AxisEdge.SourcePoint:this.AxisEdge.TargetPoint}},{key:"Direction",get:function(){return this.Reversed?nt.OppositeDir(this.AxisEdge.Direction):this.AxisEdge.Direction}},{key:"Index",get:function(){return this.index},set:function(t){this.index=t}}]),l}();function hn(){hn=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var su=function(){function l(o){this.pathVisibilityGraph=new _t,this.axisEdgesToPathOrders=new Map,this.OriginalPaths=o}var s=l.prototype;return s.GetOrder=function(){return this.FillTheVisibilityGraphByWalkingThePaths(),this.InitPathOrder(),this.OrderPaths(),this.axisEdgesToPathOrders},s.FillTheVisibilityGraphByWalkingThePaths=function(){for(var e,t=C(this.OriginalPaths);!(e=t()).done;)this.FillTheVisibilityGraphByWalkingPath(e.value)},s.FillTheVisibilityGraphByWalkingPath=function(t){var e=hn().mark(h),r=this.CreatePathEdgesFromPoints(h(),t.Width),i=r.next();for(i.done||t.SetFirstEdge(i.value);!1===(i=r.next()).done;)t.AddEdge(i.value);function h(){var c,f,p,y;return hn().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!(t.PathPoints instanceof ln)){P.next=10;break}c=t.PathPoints;case 2:if(null==c){P.next=8;break}return P.next=5,c.Point;case 5:c=c.Next,P.next=2;break;case 8:P.next=17;break;case 10:f=C(t.PathPoints);case 11:if((p=f()).done){P.next=17;break}return y=p.value,P.next=15,y;case 15:P.next=11;break;case 17:case"end":return P.stop()}},e)}},s.CreatePathEdgesFromPoints=hn().mark(function o(t,e){var r,i;return hn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:r=t.next(),i=r.value;case 2:if((r=t.next()).done){c.next=8;break}return c.next=5,this.CreatePathEdge(i,r.value,e);case 5:i=r.value,c.next=2;break;case 8:case"end":return c.stop()}},o,this)}),s.CreatePathEdge=function(t,e,r){switch(nt.DirectionFromPointToPoint(t,e)){case U.East:case U.North:return new au(this.GetAxisEdge(t,e),r);case U.South:case U.West:var h=new au(this.GetAxisEdge(e,t),r);return h.Reversed=!0,h;default:throw new Error("Not a rectilinear path")}},s.GetAxisEdge=function(t,e){return this.PathVisibilityGraph.AddEdgeF(t,e,function(r,i){return new $h(r,i)})},s.InitPathOrder=function(){for(var e,t=C(this.PathVisibilityGraph.Edges);!(e=t()).done;)this.axisEdgesToPathOrders.set(e.value,new Array);for(var h,i=C(this.OriginalPaths);!(h=i()).done;)for(var p,f=C(h.value.PathEdges());!(p=f()).done;){var y=p.value;this.axisEdgesToPathOrders.get(y.AxisEdge).push(y)}},s.OrderPaths=function(){for(var e,t=C(l.WalkGraphEdgesInTopologicalOrderIfPossible(this.PathVisibilityGraph));!(e=t()).done;)this.OrderPathEdgesSharingEdge(e.value)},s.OrderPathEdgesSharingEdge=function(t){var e=this.PathOrderOfVisEdge(t);e.sort(l.CompareTwoPathEdges);for(var h,r=0,i=C(e);!(h=i()).done;)h.value.Index=r++},l.CompareTwoPathEdges=function(t,e){if(t===e)return 0;var r=l.CompareInDirectionStartingFromAxisEdge(t,e,t.AxisEdge,t.AxisEdge.Direction);return 0!==r?r:-l.CompareInDirectionStartingFromAxisEdge(t,e,t.AxisEdge,nt.OppositeDir(t.AxisEdge.Direction))},l.CompareInDirectionStartingFromAxisEdge=function(t,e,r,i){for(;;){if(null==(t=l.GetNextPathEdgeInDirection(t,r,i))||null==(e=l.GetNextPathEdgeInDirection(e,r,i)))return 0;if(t.AxisEdge===e.AxisEdge){i=l.FindContinuedDirection(r,i,t.AxisEdge),r=t.AxisEdge;var h=l.GetExistingOrder(t,e);if(h===l.NotOrdered)continue;return i===r.Direction?h:-h}var c=i===r.Direction?r.Target:r.Source,f=l.OtherVertex(t.AxisEdge,c),p=l.OtherVertex(e.AxisEdge,c),y=l.ProjectionForCompare(r,i!==r.Direction);return It(y(f.point),y(p.point))}},l.FindContinuedDirection=function(t,e,r){return t.Direction===e?r.Source===t.Target?r.Direction:nt.OppositeDir(r.Direction):r.Source===t.Source?r.Direction:nt.OppositeDir(r.Direction)},l.OtherVertex=function(t,e){return t.Source===e?t.Target:t.Source},l.ProjectionForCompare=function(t,e){return t.Direction===U.North?e?function(r){return-r.x}:function(r){return r.x}:e?function(r){return r.y}:function(r){return-r.y}},l.GetNextPathEdgeInDirection=function(t,e,r){return e.Direction===r?t.Reversed?t.Prev:t.Next:t.Reversed?t.Next:t.Prev},l.GetExistingOrder=function(t,e){var r=t.Index;return-1===r?l.NotOrdered:It(r,e.Index)},s.PathOrderOfVisEdge=function(t){return this.axisEdgesToPathOrders.get(t)},l.InitQueueOfSources=function(t,e,r){for(var h,i=C(r.Vertices());!(h=i()).done;){var c=h.value,f=c.InEdgesLength();e.set(c,f),0===f&&t.enqueue(c)}},l.WalkGraphEdgesInTopologicalOrderIfPossible=hn().mark(function o(t){var e,r,i,h,c,f,p;return hn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:e=new ye.c,l.InitQueueOfSources(e,r=new Map,t);case 3:if(!(e.length>0)){m.next=17;break}i=e.dequeue(),h=C(i.OutEdges);case 6:if((c=h()).done){m.next=15;break}return p=r.get((f=c.value).Target),r.set(f.Target,p-1),1===p&&e.enqueue(f.Target),m.next=13,f;case 13:m.next=6;break;case 15:m.next=3;break;case 17:case"end":return m.stop()}},o)}),Q(l,[{key:"PathVisibilityGraph",get:function(){return this.pathVisibilityGraph}}]),l}();su.NotOrdered=Number.MAX_VALUE;var Jh=function(l){function s(o,t){var e;return(e=l.call(this)||this).site=t,e.AxisEdge=o,e}return X(s,l),Q(s,[{key:"Site",get:function(){return this.site}}]),s}(lr),uu=function(l){function s(o,t){var e;return(e=l.call(this)||this).site=t,e.AxisEdge=o,e}return X(s,l),Q(s,[{key:"Site",get:function(){return this.site}}]),s}(lr),Zh=function(){function l(o){this.edges=new Set,this.Source=o}var s=l.prototype;return s.AddEdge=function(t){this.UpPoint=t.TargetPoint,this.edges.add(t)},s.RemoveAxis=function(t){this.edges.delete(t)},s.IsEmpty=function(){return 0===this.edges.size},Q(l,[{key:"Edges",get:function(){return this.edges}}]),l}(),lu=function(l){function s(t,e,r,i,h){var c;return(c=l.call(this,e,new nt(t).ToPoint())||this).DirectionPerp=new nt(t).Right.ToPoint(),c.PathOrders=i,c.xProjection=t===U.North?function(f){return f.x}:function(f){return-f.y},c.edgeContainersTree=new Ce(function(f,p){return c.CompareAA(f,p)}),c.SweepPole=nt.VectorDirection(c.SweepDirection),c.AxisEdges=h,c.AxisEdgesToObstaclesTheyOriginatedFrom=r,c}X(s,l);var o=s.prototype;return o.FindFreeSpace=function(){this.InitTheQueueOfEvents(),this.ProcessEvents()},o.ProcessEvents=function(){for(;this.EventQueue.Count>0;)this.ProcessEvent(this.EventQueue.Dequeue())},o.ProcessEvent=function(e){e instanceof Rn?this.ProcessVertexEvent(e):(this.Z=this.GetZP(e.Site),e instanceof uu?this.ProcessLowEdgeEvent(e):this.ProcessHighEdgeEvent(e))},o.ProcessHighEdgeEvent=function(e){var r=e.AxisEdge;this.RemoveEdge(r),this.ConstraintEdgeWithObstaclesAtZ(r,r.Target.point)},o.ProcessLowEdgeEvent=function(e){var r=e.AxisEdge,i=this.GetOrCreateAxisEdgesContainer(r);i.item.AddEdge(r);var h=this.edgeContainersTree.previous(i);if(null!=h)for(var f,c=C(h.item.edges);!(f=c()).done;)for(var m,p=f.value,y=C(i.item.edges);!(m=y()).done;)this.TryToAddRightNeighbor(p,m.value);var L=this.edgeContainersTree.next(i);if(null!=L)for(var S,E=C(i.item.Edges);!(S=E()).done;)for(var x,T=S.value,O=C(L.item.edges);!(x=O()).done;)this.TryToAddRightNeighbor(T,x.value);this.ConstraintEdgeWithObstaclesAtZ(r,r.Source.point)},o.TryToAddRightNeighbor=function(e,r){this.ProjectionsOfEdgesOverlap(e,r)&&e.AddRightNeighbor(r)},o.ProjectionsOfEdgesOverlap=function(e,r){return this.SweepPole===U.North?!(e.TargetPoint.y<r.SourcePoint.y-q.distanceEpsilon||r.TargetPoint.y<e.SourcePoint.y-q.distanceEpsilon):!(e.TargetPoint.x<r.SourcePoint.x-q.distanceEpsilon||r.TargetPoint.x<e.SourcePoint.x-q.distanceEpsilon)},o.GetObstacleBoundaries=function(e){return this.Obstacles.map(function(r){return xt.mkDebugCurveWCI(1,e,r)})},o.ConstraintEdgeWithObstaclesAtZ=function(e,r){this.ConstraintEdgeWithObstaclesAtZFromLeft(e,r),this.ConstraintEdgeWithObstaclesAtZFromRight(e,r)},o.ConstraintEdgeWithObstaclesAtZFromRight=function(e,r){var i=this.GetActiveSideFromRight(r);if(null!=i&&!this.NotRestricting(e,i.item.Polyline)){var h=this.ObstacleSideComparer.IntersectionOfSideAndSweepLine(i.item);e.BoundFromRight(h.dot(this.DirectionPerp))}},o.GetActiveSideFromRight=function(e){return this.LeftObstacleSideTree.findFirst(function(r){return s.PointToTheLeftOfLineOrOnLineLocal(e,r.Start,r.End)})},o.ConstraintEdgeWithObstaclesAtZFromLeft=function(e,r){var i=this.GetActiveSideFromLeft(r);if(null!=i&&!this.NotRestricting(e,i.item.Polyline)){var h=this.ObstacleSideComparer.IntersectionOfSideAndSweepLine(i.item);e.BoundFromLeft(h.dot(this.DirectionPerp))}},s.PointToTheLeftOfLineOrOnLineLocal=function(e,r,i){return R.signedDoubledTriangleArea(e,r,i)>-s.AreaComparisonEpsilon},s.PointToTheRightOfLineOrOnLineLocal=function(e,r,i){return R.signedDoubledTriangleArea(r,i,e)<s.AreaComparisonEpsilon},o.GetActiveSideFromLeft=function(e){return this.RightObstacleSideTree.findLast(function(r){return s.PointToTheRightOfLineOrOnLineLocal(e,r.Start,r.End)})},s.EdgeMidPoint=function(e){return R.middle(e.SourcePoint,e.TargetPoint)},o.GetOrCreateAxisEdgesContainer=function(e){var r=e.Source.point;return this.GetAxisEdgesContainerNode(r)??this.edgeContainersTree.insert(new Zh(r))},o.GetAxisEdgesContainerNode=function(e){var r=this,i=this.xProjection(e),h=this.edgeContainersTree.findFirst(function(c){return r.xProjection(c.Source)>=i-q.distanceEpsilon/2});return null!=h&&this.xProjection(h.item.Source)<=i+q.distanceEpsilon/2?h:null},o.ProcessVertexEvent=function(e){this.Z=this.GetZS(e),e instanceof Zr?this.ProcessLeftVertex(e,e.Vertex.nextOnPolyline):(e instanceof Kr||this.ProcessLeftVertex(e,e.Vertex.nextOnPolyline),this.ProcessRightVertex(e,e.Vertex.prevOnPolyline))},o.ProcessRightVertex=function(e,r){this.ProcessPrevSegmentForRightVertex(e,e.Site);var h=r.point.sub(e.Site),c=h.dot(this.DirectionPerp),f=h.dot(this.SweepDirection);f<=q.distanceEpsilon?c>0&&f>=0?this.EnqueueEvent(new Kr(r)):this.RestrictEdgeContainerToTheRightOfEvent(e.Vertex):(this.InsertRightSide(new Fn(e.Vertex)),this.EnqueueEvent(new Kr(r)),this.RestrictEdgeContainerToTheRightOfEvent(e.Vertex))},o.RestrictEdgeContainerToTheRightOfEvent=function(e){var r=this,i=e.point,h=this.xProjection(i),c=this.edgeContainersTree.findFirst(function(m){return h<=r.xProjection(m.Source)});if(null!=c)for(var p,f=C(c.item.Edges);!(p=f()).done;){var y=p.value;this.NotRestricting(y,e.polyline)||y.BoundFromLeft(this.DirectionPerp.dot(i))}},o.NotRestricting=function(e,r){return this.AxisEdgesToObstaclesTheyOriginatedFrom.get(e)===r},o.ProcessPrevSegmentForRightVertex=function(e,r){r.sub(e.Vertex.nextOnPolyline.point).dot(this.SweepDirection)>q.distanceEpsilon&&this.RemoveRightSide(new Fn(e.Vertex.nextOnPolyline))},o.RemoveEdge=function(e){var r=this.GetAxisEdgesContainerNode(e.Source.point);r.item.RemoveAxis(e),r.item.IsEmpty()&&this.edgeContainersTree.deleteNodeInternal(r)},o.ProcessLeftVertex=function(e,r){this.ProcessPrevSegmentForLeftVertex(e,e.Site);var h=r.point.sub(e.Site),c=h.dot(this.DirectionPerp),f=h.dot(this.SweepDirection);f<=q.distanceEpsilon?c<0&&f>=0&&this.EnqueueEvent(new Zr(r)):(this.InsertLeftSide(new Nn(e.Vertex)),this.EnqueueEvent(new Zr(r))),this.RestrictEdgeFromTheLeftOfEvent(e.Vertex)},o.RestrictEdgeFromTheLeftOfEvent=function(e){var r=e.point,i=this.GetContainerNodeToTheLeftOfEvent(r);if(null!=i)for(var c,h=C(i.item.Edges);!(c=h()).done;){var f=c.value;this.NotRestricting(f,e.polyline)||f.BoundFromRight(r.dot(this.DirectionPerp))}},o.GetContainerNodeToTheLeftOfEvent=function(e){var r=this,i=this.xProjection(e);return this.edgeContainersTree.findLast(function(h){return r.xProjection(h.Source)<=i})},o.ProcessPrevSegmentForLeftVertex=function(e,r){r.sub(e.Vertex.prevOnPolyline.point).dot(this.SweepDirection)>q.distanceEpsilon&&this.RemoveLeftSide(new Nn(e.Vertex.prevOnPolyline))},o.InitTheQueueOfEvents=function(){this.InitQueueOfEvents();for(var r,e=C(this.AxisEdges);!(r=e()).done;)this.EnqueueEventsForEdge(r.value)},o.EnqueueEventsForEdge=function(e){this.EdgeIsParallelToSweepDir(e)&&(this.EnqueueEvent(s.EdgeLowPointEvent(e,e.Source.point)),this.EnqueueEvent(s.EdgeHighPointEvent(e,e.Target.point)))},o.EdgeIsParallelToSweepDir=function(e){return e.Direction===this.SweepPole||e.Direction===nt.OppositeDir(this.SweepPole)},s.EdgeHighPointEvent=function(e,r){return new Jh(e,r)},s.EdgeLowPointEvent=function(e,r){return new uu(e,r)},o.CompareAA=function(e,r){return It(e.Source.dot(this.DirectionPerp),r.Source.dot(this.DirectionPerp))},s}(Vs);lu.AreaComparisonEpsilon=q.intersectionEpsilon;var Kh=function(l){function s(t){var e;return(e=l.call(this)||this).CompassDirection=U.None,e.edges=new Array,e._isFixed=!1,e.Id=-1,e.IdealPosition=0,e.Id=t,e}X(s,l);var o=s.prototype;return o.AddEdge=function(e){if(0===this.Edges.length){var r=nt.VectorDirectionPP(e.Source,e.Target);switch(r){case U.South:r=U.North;break;case U.West:r=U.East}this.CompassDirection=r,this.start=e.Source,this.end=e.Source}switch(this.CompassDirection){case U.North:this.TryPointForStartAndEndNorth(e.Source),this.TryPointForStartAndEndNorth(e.Target);break;case U.East:this.TryPointForStartAndEndEast(e.Source),this.TryPointForStartAndEndEast(e.Target)}this.Edges.push(e)},o.TryPointForStartAndEndNorth=function(e){e.y<this.start.y?this.start=e:e.y>this.end.y&&(this.end=e)},o.TryPointForStartAndEndEast=function(e){e.x<this.start.x?this.start=e:e.x>this.end.x&&(this.end=e)},o.GetLeftBound=function(){if(!this.IsFixed){for(var i,e=Number.NEGATIVE_INFINITY,r=C(this.edges);!(i=r()).done;)e=Math.max(e,i.value.AxisEdge.LeftBound);return e}return this.CompassDirection===U.North?this.Edges[0].Source.x:-this.Edges[0].Source.y},o.GetRightBound=function(){if(!this.IsFixed){for(var i,e=Number.POSITIVE_INFINITY,r=C(this.edges);!(i=r()).done;)e=Math.min(e,i.value.AxisEdge.RightBound);return e}return this.Position()},o.Position=function(){return this.CompassDirection===U.North?this.Edges[0].Source.x:-this.Edges[0].Source.y},Q(s,[{key:"Start",get:function(){return this.start}},{key:"End",get:function(){return this.end}},{key:"Edges",get:function(){return this.edges}},{key:"IsFixed",get:function(){return this._isFixed},set:function(e){this._isFixed=e}},{key:"Width",get:function(){for(var i,e=0,r=C(this.edges);!(i=r()).done;)e=Math.max(e,i.value.Width);return e}}]),s}(Yo),tc=function(){function l(o,t){this.tree=new Ce(function(e,r){return It(e.Point.x,r.Point.x)}),this.VerticalPoints=t,this.HorizontalPoints=o}var s=l.prototype;return s.SplitPoints=function(){0===this.VerticalPoints.length||0===this.HorizontalPoints.length||(this.InitEventQueue(),this.ProcessEvents())},s.ProcessEvents=function(){for(;!this.Queue.IsEmpty();){var t={priority:0},e=this.Queue.DequeueAndGetPriority(t);this.ProcessEvent(e,t.priority)}},s.ProcessEvent=function(t,e){dt(t.Next.Point.x,t.Point.x)?e===l.Low(t)?this.ProcessLowLinkedPointEvent(t):this.ProcessHighLinkedPointEvent(t):this.IntersectWithTree(t)},s.IntersectWithTree=function(t){var e,r,i,h=t.Y;if(t.Point.x<t.Next.Point.x?(r=t.Point.x,e=t.Next.Point.x,i=!0):(e=t.Point.x,r=t.Next.Point.x,i=!1),i)for(var c=this.tree.findFirst(function(m){return r<=m.Point.x});null!=c&&c.item.Point.x<=e;c=this.tree.next(c)){var f=new R(c.item.Point.x,h);t=l.TrySplitHorizontalPoint(t,f,!0),l.TrySplitVerticalPoint(c.item,f)}else for(var p=this.tree.findLast(function(m){return m.Point.x<=e});null!=p&&p.item.Point.x>=r;p=this.tree.previous(p)){var y=new R(p.item.Point.x,h);t=l.TrySplitHorizontalPoint(t,y,!1),l.TrySplitVerticalPoint(p.item,y)}},l.TrySplitVerticalPoint=function(t,e){l.Low(t)+q.distanceEpsilon<e.y&&e.y+q.distanceEpsilon<l.High(t)&&t.SetNewNext(e)},l.TrySplitHorizontalPoint=function(t,e,r){return r&&t.X+q.distanceEpsilon<e.x&&e.x+q.distanceEpsilon<t.Next.X||!r&&t.Next.X+q.distanceEpsilon<e.x&&e.x+q.distanceEpsilon<t.X?(t.SetNewNext(e),t.Next):t},s.ProcessHighLinkedPointEvent=function(t){this.tree.remove(t)},s.ProcessLowLinkedPointEvent=function(t){this.tree.insert(t)},s.InitEventQueue=function(){this.Queue=new Gr(It);for(var e,t=C(this.VerticalPoints);!(e=t()).done;){var r=e.value;this.Queue.Enqueue(r,l.Low(r))}for(var h,i=C(this.HorizontalPoints);!(h=i()).done;){var c=h.value;this.Queue.Enqueue(c,c.Point.y)}},l.Low=function(t){return Math.min(t.Point.y,t.Next.Point.y)},l.High=function(t){return Math.max(t.Point.y,t.Next.Point.y)},l}();function ua(){ua=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Mn,wi,we,Jt,cn,oo,hu,Fr,Pi,xe,Te,de,Vn,ec=function(){function l(o){this.verticesToPathOffsets=new Ee,this.Paths=o}var s=l.prototype;return s.MergePaths=function(){this.InitVerticesToPathOffsetsAndRemoveSelfCycles();for(var e,t=C(this.Paths);!(e=t()).done;)this.ProcessPath(e.value)},s.ProcessPath=function(t){for(var e=new Map,r=null,i=t.PathPoints;null!=i;i=i.Next){var h=this.verticesToPathOffsets.get(i.Point);if(null!=r){if(e.size>0)for(var f,c=C(h);!(f=c()).done;){var p=f.value,y=p[0],m=p[1],P=e.get(y);P&&(this.CollapseLoopingPath(y,P,m,t,i),e.delete(y))}for(var E,L=C(r);!(E=L()).done;){var S=E.value,T=S[0],O=S[1];h.has(T)||e.set(T,O)}}r=h}},s.CollapseLoopingPath=function(t,e,r,i,h){var c=l.FindLinkedPointInPath(i,e.Point),f=Array.from(l.GetPointsInBetween(c,h));l.Before(e,r)?(this.CleanDisappearedPiece(e,r,t),this.ReplacePiece(e,r,f,t)):(this.CleanDisappearedPiece(r,e,t),this.ReplacePiece(r,e,f.reverse(),t))},l.GetPointsInBetween=ua().mark(function o(t,e){var r;return ua().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:r=t.Next;case 1:if(r===e){h.next=7;break}return h.next=4,r.Point;case 4:r=r.Next,h.next=1;break;case 7:case"end":return h.stop()}},o)}),s.ReplacePiece=function(t,e,r,i){for(var f,h=t,c=C(r);!(f=c()).done;){var p=f.value,y=new ln(p);h.Next=y,h=y,this.verticesToPathOffsets.get(p).set(i,h)}h.Next=e},s.CleanDisappearedPiece=function(t,e,r){for(var h,i=C(l.GetPointsInBetween(t,e));!(h=i()).done;)this.verticesToPathOffsets.get(h.value).delete(r)},l.Before=function(t,e){for(t=t.Next;null!=t;t=t.Next)if(t===e)return!0;return!1},l.FindLinkedPointInPath=function(t,e){for(var r=t.PathPoints;;r=r.Next)if(r.Point.equal(e))return r},s.InitVerticesToPathOffsetsAndRemoveSelfCycles=function(){for(var e,t=C(this.Paths);!(e=t()).done;)for(var r=e.value,i=r.PathPoints;null!=i;i=i.Next){var h=this.verticesToPathOffsets.get(i.Point);h||this.verticesToPathOffsets.set(i.Point,h=new Map);var c=h.get(r);c?(this.CleanDisappearedPiece(c,i,r),c.Next=i.Next):h.set(r,i)}},l}(),rc=function(){function l(o){this.projection=o}return l.prototype.compare=function(t,e){return It(this.projection(t),this.projection(e))},l}();!function(l){l.has=Symbol.for("@esfx/collection-core!ReadonlyCollection.has"),l.name="ReadonlyContainer",l.hasInstance=function(o){return("object"==typeof o&&null!==o||"function"==typeof o)&&l.has in o}}(Mn||(Mn={})),function(l){l.has=Mn.has,l.add=Symbol.for("@esfx/collection-core!Collection.add"),l.delete=Symbol.for("@esfx/collection-core!Collection.delete"),l.name="Container",l.hasInstance=function(o){return Mn.hasInstance(o)&&l.add in o&&l.delete in o}}(wi||(wi={})),function(l){l.has=Mn.has,l.size=Symbol.for("@esfx/collection-core!ReadonlyCollection.size"),l.name="ReadonlyCollection",l.hasInstance=function(o){return Mn.hasInstance(o)&&("object"==typeof o&&null!==o||"function"==typeof o)&&Symbol.iterator in o&&l.size in o}}(we||(we={})),function(l){l.size=we.size,l.has=we.has,l.add=wi.add,l.delete=wi.delete,l.clear=Symbol.for("@esfx/collection-core!Collection.clear"),l.name="Collection",l.hasInstance=function(o){return we.hasInstance(o)&&wi.hasInstance(o)&&l.clear in o}}(Jt||(Jt={})),function(l){l.size=we.size,l.has=we.has,l.indexOf=Symbol.for("@esfx/collection-core!ReadonlyIndexedCollection.indexOf"),l.getAt=Symbol.for("@esfx/collection-core!ReadonlyIndexedCollection.getAt"),l.name="ReadonlyIndexedCollection",l.hasInstance=function(o){return we.hasInstance(o)&&l.indexOf in o&&l.getAt in o}}(cn||(cn={})),function(l){l.size=we.size,l.has=we.has,l.indexOf=cn.indexOf,l.getAt=cn.getAt,l.setAt=Symbol.for("@esfx/collection-core!FixedSizeIndexedCollection.setAt"),l.name="FixedSizeIndexedCollection",l.hasInstance=function(o){return cn.hasInstance(o)&&l.setAt in o}}(oo||(oo={})),function(l){l.size=we.size,l.has=we.has,l.indexOf=cn.indexOf,l.getAt=cn.getAt,l.setAt=oo.setAt,l.add=Jt.add,l.delete=Jt.delete,l.clear=Jt.clear,l.insertAt=Symbol.for("@esfx/collection-core!IndexedCollection.insertAt"),l.removeAt=Symbol.for("@esfx/collection-core!IndexedCollection.removeAt"),l.name="IndexedCollection",l.hasInstance=function(o){return oo.hasInstance(o)&&l.insertAt in o&&l.removeAt in o}}(hu||(hu={})),function(l){l.has=Symbol.for("@esfx/collection-core!ReadonlyKeyedContainer.has"),l.get=Symbol.for("@esfx/collection-core!ReadonlyKeyedContainer.get"),l.name="ReadonlyKeyedContainer",l.hasInstance=function(o){return("object"==typeof o&&null!==o||"function"==typeof o)&&l.has in o&&l.get in o}}(Fr||(Fr={})),function(l){l.has=Fr.has,l.get=Fr.get,l.set=Symbol.for("@esfx/collection-core!KeyedCollection.set"),l.delete=Symbol.for("@esfx/collection-core!KeyedCollection.delete"),l.name="KeyedContainer",l.hasInstance=function(o){return Fr.hasInstance(o)&&l.set in o&&l.delete in o}}(Pi||(Pi={})),function(l){l.has=Fr.has,l.get=Fr.get,l.size=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.size"),l.keys=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.keys"),l.values=Symbol.for("@esfx/collection-core!ReadonlyKeyedCollection.values"),l.name="ReadonlyKeyedCollection",l.hasInstance=function(o){return("object"==typeof o&&null!==o||"function"==typeof o)&&Symbol.iterator in o&&Fr.hasInstance(o)&&l.size in o&&l.keys in o&&l.values in o}}(xe||(xe={})),function(l){l.size=xe.size,l.has=xe.has,l.get=xe.get,l.keys=xe.keys,l.values=xe.values,l.set=Pi.set,l.delete=Pi.delete,l.clear=Symbol.for("@esfx/collection-core!KeyedCollection.clear"),l.name="KeyedCollection",l.hasInstance=function(o){return xe.hasInstance(o)&&Pi.hasInstance(o)&&l.clear in o}}(Te||(Te={})),function(l){l.size=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.size"),l.has=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.has"),l.hasValue=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.hasValue"),l.get=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.get"),l.keys=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.keys"),l.values=Symbol.for("@esfx/collection-core!ReadonlyKeyedMultiCollection.values"),l.name="ReadonlyKeyedMultiCollection",l.hasInstance=function(o){return("object"==typeof o&&null!==o||"function"==typeof o)&&Symbol.iterator in o&&l.size in o&&l.has in o&&l.hasValue in o&&l.get in o&&l.keys in o&&l.values in o}}(de||(de={})),function(l){l.size=de.size,l.has=de.has,l.hasValue=de.hasValue,l.get=de.get,l.keys=de.keys,l.values=de.values,l.add=Symbol.for("@esfx/collection-core!KeyedMultiCollection.add"),l.delete=Symbol.for("@esfx/collection-core!KeyedMultiCollection.delete"),l.deleteValue=Symbol.for("@esfx/collection-core!KeyedMultiCollection.deleteValue"),l.clear=Symbol.for("@esfx/collection-core!KeyedMultiCollection.clear"),l.name="KeyedMultiCollection",l.hasInstance=function(o){return de.hasInstance(o)&&l.add in o&&l.delete in o&&l.deleteValue in o&&l.clear in o}}(Vn||(Vn={}));var fn=2654435761,dn=2246822519,cu=3266489917,fu=374761393,oc=typeof WebAssembly<"u"&&"function"==typeof WebAssembly.Module&&"function"==typeof WebAssembly.Instance,ac=new Uint8Array([0,97,115,109,1,0,0,0,1,8,1,96,3,127,127,126,1,126,3,2,1,0,5,3,1,0,1,7,15,2,3,109,101,109,2,0,5,120,120,104,54,52,0,0,10,130,6,1,255,5,2,3,126,1,127,32,0,32,1,106,33,6,32,1,65,32,79,4,126,32,6,65,32,107,33,6,32,2,66,214,235,130,238,234,253,137,245,224,0,124,33,3,32,2,66,177,169,172,193,173,184,212,166,61,125,33,4,32,2,66,249,234,208,208,231,201,161,228,225,0,124,33,5,3,64,32,3,32,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,3,32,4,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,4,32,2,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,2,32,5,32,0,65,8,106,34,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,124,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,33,5,32,6,32,0,65,8,106,34,0,79,13,0,11,32,2,66,12,137,32,5,66,18,137,124,32,4,66,7,137,124,32,3,66,1,137,124,32,3,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,32,4,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,32,2,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,32,5,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,133,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,5,32,2,66,197,207,217,178,241,229,186,234,39,124,11,32,1,173,124,33,2,32,0,32,1,65,31,113,106,33,1,3,64,32,1,32,0,65,8,106,79,4,64,32,0,41,3,0,66,207,214,211,190,210,199,171,217,66,126,66,31,137,66,135,149,175,175,152,182,222,155,158,127,126,32,2,133,66,27,137,66,135,149,175,175,152,182,222,155,158,127,126,66,157,163,181,234,131,177,141,138,250,0,125,33,2,32,0,65,8,106,33,0,12,1,11,11,32,0,65,4,106,32,1,77,4,64,32,2,32,0,53,2,0,66,135,149,175,175,152,182,222,155,158,127,126,133,66,23,137,66,207,214,211,190,210,199,171,217,66,126,66,249,243,221,241,153,246,153,171,22,124,33,2,32,0,65,4,106,33,0,11,3,64,32,0,32,1,73,4,64,32,2,32,0,49,0,0,66,197,207,217,178,241,229,186,234,39,126,133,66,11,137,66,135,149,175,175,152,182,222,155,158,127,126,33,2,32,0,65,1,106,33,0,12,1,11,11,32,2,32,2,66,33,136,133,66,207,214,211,190,210,199,171,217,66,126,34,2,66,29,136,32,2,133,66,249,243,221,241,153,246,153,171,22,126,34,2,66,32,136,32,2,133,11]),Dn=oc?new WebAssembly.Instance(new WebAssembly.Module(ac)).exports:void 0,jn=Dn?.mem,du=Dn?.xxh64,sc="function"==typeof TextEncoder,vu=function(s,o){return(vu=sc?function(){var o=new TextEncoder;return function(e,r){var h=o.encodeInto(e,r).written;return void 0===h?0:h}}():function(t,e){for(var r=t.length,i=0,h=0;h<r;h++){var c=t.charCodeAt(h);if(55296&c&&!(4294910976&c)&&h<r-1){var f=t.charCodeAt(h+1);56320==(64512&f)&&(c=((1023&c)<<10)+(1023&f)+65536,h++)}if(4294967168&c)if(4294965248&c)if(268431360&c){if(4292870144&c)throw new RangeError("Unsupported charCode.");e[i++]=c>>18|240,e[i++]=c>>12&63|128,e[i++]=c>>6&63|128,e[i++]=63&c|128}else e[i++]=c>>12|224,e[i++]=c>>6&63|128,e[i++]=63&c|128;else e[i++]=c>>6|192,e[i++]=63&c|128;else e[i++]=c}return i})(s,o)},gu=function(s,o){return vu(s,o)},la="function"==typeof BigInt&&"bigint"==typeof BigInt(0),pu="function"==typeof BigUint64Array,lc="object"==typeof jn&&"function"==typeof du,ha=new ArrayBuffer(8),hc=new Float64Array(ha),pr=new Uint32Array(ha),Wn=function(){return(Wn=la&&pu&&lc?function(){var o=new BigUint64Array(pr.buffer),t=new Uint8Array(jn.buffer);function h(f,p){!function(f){jn.buffer.byteLength<f&&(jn.grow(Math.ceil((f-jn.buffer.byteLength)/65536)),t=new Uint8Array(jn.buffer))}(3*f.length);var y=gu(f,t);return function(f){o[0]=f;var p=pr[0];return(p<<7|p>>>25)^pr[1]}(du(0,y,p))}return function(){var f=(pr[0]=ao(),pr[1]=ao(),o[0]);return function(y){return h(y,f)}}}():function(){var o=new Uint8Array(65536);function e(i,h){!function(i){o.byteLength<i&&(o=new Uint8Array(i+(65536-i%65536)))}(3*i.length);var c=gu(i,o);return 0|function(l,s,o,t){if(s%4)throw new TypeError("Pointer not aligned");var r,i,h,c,f,p,y,e=new Uint32Array(l);if(i=s+o,s>>=2,o>=16){h=i-16>>2,c=(t+fn|0)+dn|0,f=t+dn|0,p=t+0|0,y=t+fn|0;do{c=((c=c+e[s++]*dn|0)<<13|c>>>19)*fn|0,f=((f=f+e[s++]*dn|0)<<13|f>>>19)*fn|0,p=((p=p+e[s++]*dn|0)<<13|p>>>19)*fn|0,y=((y=y+e[s++]*dn|0)<<13|y>>>19)*fn|0}while(s<=h);r=(c<<1|c>>>31)+(f<<7|f>>>25)|p<<12|p>>>20|y<<18|y>>>14}else r=t+fu|0;for(r=r+o|0,h=i-4>>2;s<=h;)r=668265263*((r=r+e[s++]*cu|0)<<17|r>>>15)|0;if((s<<=2)<i){var m=new Uint8Array(e.buffer);do{r=((r=r+m[s++]*fu|0)<<11|r>>>21)*fn|0}while(s<i)}return r=((r=(r^r>>>15)*dn|0)^r>>>13)*cu|0,(r^=r>>>16)>>>0}(o.buffer,0,c,h)}return function(){var i=ao();return function(c){return e(c,i)}}}())()},yu=function(s){return(yu=function(o){return(0|o)===o?0|o:function(o){hc[0]=o;var t=pr[0];return(t<<7|t>>>25)^pr[1]}(o)})(s)},mu=function(s){return(mu=la&&pu?(t=new BigUint64Array(ha),e=BigInt(0),r=BigInt(1),i=BigInt(2),h=Math.pow(BigInt(2),BigInt(31))-BigInt(1),c=~h,f=BigInt(64),function(y){if(y===e)return 0;if(y>=c&&y<=h)return Number(y);y=y<e?~y*i+r:y*i;for(var m=0;y;)t[0]=y,m=((m=(m<<7|m>>>25)^pr[0])<<7|m>>>25)^pr[1],y>>=f;return 0|m}):la?function(){var t=BigInt(0),e=BigInt(1),r=BigInt(2),i=Math.pow(BigInt(2),BigInt(31))-BigInt(1),h=~i,c=BigInt(32),f=BigInt("0xFFFFFFFF");return function(y){if(y===t)return 0;if(y>=h&&y<=i)return Number(y);y=y<t?~y*r+e:y*r;for(var m=0;y!==t;)m=(m<<7|m>>>25)^Number(y&f),y>>=c,m=(m<<7|m>>>25)^Number(y&f),y>>=c;return 0|m}}():function(){var t=Wn();return function(r){return t(r.toString())}}())(s);var t,e,r,i,h,c,f},wu=function(s){return(wu=Wn())(s)},Pu=function(s){return(Pu=function(){var o,t,l="description"in Symbol.prototype?function(T){return T.description}:function(T){var O=T.toString();return O.length>=8&&"Symbol("===O.slice(0,7)&&")"===O.slice(-1)?O.slice(7,-1):O},s=Wn();try{(new WeakMap).set(Symbol.iterator,null),o=new WeakMap,t=new WeakMap}catch{o=new Map,t=new Map}for(var r,e=C(Object.getOwnPropertyNames(Symbol));!(r=e()).done;){var i=r.value;if("string"==typeof i){var h=Symbol[i];"symbol"==typeof h&&t.set(h,"Symbol."+i)}}var f,c=Wn();try{(new WeakMap).set(Symbol.for("@esfx/equatable!~globalSymbolTest"),null),f=new WeakMap}catch{f=new Map}var y,p=Wn(),m=1;try{(new WeakMap).set(Symbol(),null),y=new WeakMap}catch{y=new Map}return function(T){var O=t.get(T);if(void 0!==O)return function(T,O){var x=o.get(T);return void 0===x&&(x=s(O),o.set(T,x)),x}(T,O);var x=Symbol.keyFor(T);return void 0!==x?function(T,O){var x=f.get(T);return void 0===x&&(x=c(O),f.set(T,x)),x}(T,x):function(T){var O=y.get(T);return void 0===O&&(O=p(m+++"#"+l(T)),y.set(T,O)),O}(T)}}())(s)},Su=function(s){return(Su=function(){var l=new WeakMap,s=ao(),o=1;return function(r){var i=l.get(r);return void 0===i&&(i=function(r){return r=~r+(r<<15),r^=r>>12,r+=r<<2,r^=r>>4,r*=2057,(r^=r>>16)>>>0}(o++^s)^s,l.set(r,i)),i}}())(s)},bu=function(s){return Su(s)};function ao(){return Math.floor(4294967295*Math.random())>>>0}var uo,Br,Hn,Mr,_n,Oe,tr,so="object"==typeof globalThis?globalThis:"object"==typeof global?global:"object"==typeof self?self:void 0,ca=Symbol.for("@esfx/equatable!~hashUnknown");function fa(){fa=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}so&&"function"==typeof so[ca]?uo=so[ca]:(uo=function(s){switch(typeof s){case"boolean":return s?1:0;case"number":return function(s){return yu(s)}(s);case"bigint":return function(s){return mu(s)}(s);case"string":return function(s){return wu(s)}(s);case"symbol":return function(s){return Pu(s)}(s);case"function":return bu(s);case"object":return null===s?0:bu(s);case"undefined":return 0;default:throw new TypeError("Unsupported type: "+typeof s)}},Object.defineProperty(so,ca,{value:uo})),function(l){function s(o){var t;return null!=o&&l.equals in(t=Object(o))&&l.hash in t}l.equals=Symbol.for("@esfx/equatable:Equatable.equals"),l.hash=Symbol.for("@esfx/equatable:Equatable.hash"),l.name="Equatable",l.hasInstance=s,Object.defineProperty(l,Symbol.hasInstance,{configurable:!0,writable:!0,value:s})}(Br||(Br={})),function(l){function s(o){return null!=o&&l.compareTo in Object(o)}l.compareTo=Symbol.for("@esfx/equatable:Comparable.compareTo"),l.name="Comparable",l.hasInstance=s,Object.defineProperty(l,Symbol.hasInstance,{configurable:!0,writable:!0,value:s})}(Hn||(Hn={})),function(l){function s(o){var t;return null!=o&&l.structuralEquals in(t=Object(o))&&l.structuralHash in t}l.structuralEquals=Symbol.for("@esfx/equatable:StructualEquatable.structuralEquals"),l.structuralHash=Symbol.for("@esfx/equatable:StructuralEquatable.structuralHash"),l.name="StructuralEquatable",l.hasInstance=s,Object.defineProperty(l,Symbol.hasInstance,{configurable:!0,writable:!0,value:s})}(Mr||(Mr={})),function(l){function s(o){return null!=o&&l.structuralCompareTo in Object(o)}l.structuralCompareTo=Symbol.for("@esfx/equatable:StructuralComparable.structuralCompareTo"),l.name="StructuralComparable",l.hasInstance=s,Object.defineProperty(l,Symbol.hasInstance,{configurable:!0,writable:!0,value:s})}(_n||(_n={})),function(l){var s=Object.defineProperty({},Symbol.toStringTag,{configurable:!0,value:"Equaler"});function o(r,i){return void 0===i&&(i=l.defaultEqualer.hash),Object.setPrototypeOf({equals:r,hash:i},s)}function t(r,i,h){if(void 0===h&&(h=7),"number"!=typeof r)throw new TypeError("Integer expected: x");if("number"!=typeof i)throw new TypeError("Integer expected: y");if("number"!=typeof h)throw new TypeError("Integer expected: rotate");if(isNaN(r)||!isFinite(r))throw new RangeError("Argument must be a finite number value: x");if(isNaN(i)||!isFinite(i))throw new RangeError("Argument must be a finite number value: y");if(isNaN(h)||!isFinite(h))throw new RangeError("Argument must be a finite number value: rotate");for(;h<0;)h+=32;for(;h>=32;)h-=32;return(r<<h|r>>>32-h)^i}function e(r){return"object"==typeof r&&null!==r&&"function"==typeof r.equals&&"function"==typeof r.hash}l.defaultEqualer=o(function(r,i){return Br.hasInstance(r)?r[Br.equals](i):Br.hasInstance(i)?i[Br.equals](r):Object.is(r,i)},function(r){return Br.hasInstance(r)?r[Br.hash]():function(l){return function(l){return uo(l)}(l)}(r)}),l.structuralEqualer=o(function(r,i){return Mr.hasInstance(r)?r[Mr.structuralEquals](i,l.structuralEqualer):Mr.hasInstance(i)?i[Mr.structuralEquals](r,l.structuralEqualer):l.defaultEqualer.equals(r,i)},function(r){return Mr.hasInstance(r)?r[Mr.structuralHash](l.structuralEqualer):l.defaultEqualer.hash(r)}),l.tupleEqualer=o(function(r,i){if(null!=r&&!Array.isArray(r)||null!=i&&!Array.isArray(i))throw new TypeError("Array expected");if(r===i)return!0;if(!r||!i||r.length!==i.length)return!1;for(var h=0;h<r.length;h++)if(!l.defaultEqualer.equals(r[h],i[h]))return!1;return!0},function(r){if(null==r)return 0;if(!Array.isArray(r))throw new TypeError("Array expected");for(var c,i=0,h=C(r);!(c=h()).done;)i=t(i,l.defaultEqualer.hash(c.value));return i}),l.tupleStructuralEqualer=o(function(r,i){if(null!=r&&!Array.isArray(r)||null!=i&&!Array.isArray(i))throw new TypeError("Array expected");if(r===i)return!0;if(!r||!i||r.length!==i.length)return!1;for(var h=0;h<r.length;h++)if(!l.structuralEqualer.equals(r[h],i[h]))return!1;return!0},function(r){if(null==r)return 0;if(!Array.isArray(r))throw new TypeError("Array expected");for(var c,i=0,h=C(r);!(c=h()).done;)i=t(i,l.structuralEqualer.hash(c.value));return i}),l.create=o,l.combineHashes=t,l.hasInstance=e,Object.defineProperty(l,Symbol.hasInstance,{configurable:!0,writable:!0,value:e})}(Oe||(Oe={})),function(l){var s=Object.defineProperty({},Symbol.toStringTag,{configurable:!0,value:"Comparer"});function o(e){return Object.setPrototypeOf({compare:e},s)}function t(e){return"object"==typeof e&&null!==e&&"function"==typeof e.compare}l.defaultComparer=o(function(e,r){return Hn.hasInstance(e)?e[Hn.compareTo](r):Hn.hasInstance(r)?-r[Hn.compareTo](e):e<r?-1:e>r?1:0}),l.structuralComparer=o(function(e,r){return _n.hasInstance(e)?e[_n.structuralCompareTo](r,l.structuralComparer):_n.hasInstance(r)?-r[_n.structuralCompareTo](e,l.structuralComparer):l.defaultComparer.compare(e,r)}),l.tupleComparer=o(function(e,r){if(null!=e&&!Array.isArray(e)||null!=r&&!Array.isArray(r))throw new TypeError("Array expected");var i;if(i=l.defaultComparer.compare(e.length,r.length))return i;for(var h=0;h<e.length;h++)if(i=l.defaultComparer.compare(e[h],r[h]))return i;return 0}),l.tupleStructuralComparer=o(function(e,r){if(null!=e&&!Array.isArray(e)||null!=r&&!Array.isArray(r))throw new TypeError("Array expected");var i;if(i=l.defaultComparer.compare(e.length,r.length))return i;for(var h=0;h<e.length;h++)if(i=l.structuralComparer.compare(e[h],r[h]))return i;return 0}),l.create=o,l.hasInstance=t,Object.defineProperty(l,Symbol.hasInstance,{configurable:!0,writable:!0,value:t})}(tr||(tr={}));var lo=function(){var o,l={exports:{}};return o=l.exports,Object.defineProperty(o,"__esModule",{value:!0}),o.binarySearch=function(r,i,h){if(0===r.length)return-1;for(var c=0,f=r.length-1;c<=f;){var p=c+(f-c>>1);switch(Math.sign(h.compare(r[p],i))){case-1:c=p+1;break;case 0:return p;case 1:f=p-1}}return~c},l.exports}(),ho=function(l,s,o,t,e,r,i,h,c){function f(){var y,m;if(this._keys=[],this._values=[],arguments.length>0){var P=arguments.length<=0?void 0:arguments[0];void 0===P||null!=P&&Symbol.iterator in Object(P)?(y=P,arguments.length>1&&(m=arguments.length<=1?void 0:arguments[1])):m=P}if(m??(m=tr.defaultComparer),this._comparer="function"==typeof m?tr.create(m):m,y)for(var E,L=C(y);!(E=L()).done;){var S=E.value;this.set(S[0],S[1])}}var p=f.prototype;return p.has=function(m){return(0,lo.binarySearch)(this._keys,m,this._comparer)>=0},p.get=function(m){var P=(0,lo.binarySearch)(this._keys,m,this._comparer);return P>=0?this._values[P]:void 0},p.set=function(m,P){var L=(0,lo.binarySearch)(this._keys,m,this._comparer);return L>=0?this._values[L]=P:(this._keys.splice(~L,0,m),this._values.splice(~L,0,P)),this},p.delete=function(m){var P=(0,lo.binarySearch)(this._keys,m,this._comparer);return P>=0&&(this._keys.splice(P,1),this._values.splice(P,1),!0)},p.clear=function(){this._keys.length=0,this._values.length=0},p.keys=function(){return this._keys.values()},p.values=function(){return this._values.values()},p.entries=fa().mark(function y(){var m;return fa().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:m=0;case 1:if(!(m<this._keys.length)){L.next=7;break}return L.next=4,[this._keys[m],this._values[m]];case 4:m++,L.next=1;break;case 7:case"end":return L.stop()}},y,this)}),p[l]=function(){return this.entries()},p.forEach=function(m,P){if("function"!=typeof m)throw new TypeError("Function expected: callback");for(var E,L=C(this);!(E=L()).done;){var S=E.value;m.call(P,S[1],S[0],this)}},p[o]=function(y){return this.has(y)},p[t]=function(y){return this.get(y)},p[e]=function(y,m){this.set(y,m)},p[r]=function(y){return this.delete(y)},p[i]=function(){this.clear()},p[h]=function(){return this.keys()},p[c]=function(){return this.values()},Q(f,[{key:"comparer",get:function(){return this._comparer}},{key:"size",get:function(){return this._keys.length}},{key:s,get:function(){return this.size}}]),f}(Symbol.iterator,Te.size,Te.has,Te.get,Te.set,Te.delete,Te.clear,Te.keys,Te.values);function Si(){Si=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}Object.defineProperty(ho.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"SortedMap"});var bc=function(){function l(){}return l.RefinePaths=function(o,t){l.AdjustPaths(o);var e=l.CreatePathsToFirstLinkedVerticesMap(o);l.Refine(Array.from(e.values())),l.CrossVerticalAndHorizontalSegs(e.values()),l.ReconstructPathsFromLinkedVertices(e),t&&new ec(o).MergePaths()},l.AdjustPaths=function(o){for(var e,t=C(o);!(e=t()).done;){var r=e.value;r.PathPoints=l.AdjustPathPoints(r.PathPoints)}},l.AdjustPathPoints=function(o){if(o&&0!==o.length){var t=[],e=R.RoundPoint(o[0]);t.push(e);for(var r=1;r<o.length;r++){var i=R.RoundPoint(o[r]);e.equal(i)||t.push(e=i)}return t}},l.CrossVerticalAndHorizontalSegs=function(o){for(var i,t=new Array,e=new Array,r=C(o);!(i=r()).done;)for(var c=i.value;null!=c.Next;c=c.Next)dt(c.Point.x,c.Next.Point.x)?e.push(c):t.push(c);new tc(t,e).SplitPoints()},l.ReconstructPathsFromLinkedVertices=function(o){for(var e,t=C(o);!(e=t()).done;){var r=e.value;r[0].PathPoints=r[1]}},l.Refine=function(o){l.RefineInDirection(U.North,o),l.RefineInDirection(U.East,o)},l.groupByProj=Si().mark(function s(o,t){var e,r,i,h,c,f,p,y,m;return Si().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:for(e=new Map,r=C(t);!(i=r()).done;)c=o((h=i.value).Point),(f=e.get(c))||(f=new Array,e.set(c,f)),f.push(h);p=C(e.values());case 3:if((y=p()).done){L.next=9;break}return m=y.value,L.next=7,m;case 7:L.next=3;break;case 9:case"end":return L.stop()}},s)}),l.RefineInDirection=function(o,t){var e={projectionToPerp:void 0,projectionToDirection:void 0};l.GetProjectionsDelegates(o,e);for(var c,r=Array.from(l.GetAllLinkedVertsInDirection(e.projectionToPerp,t)),h=C(l.groupByProj(e.projectionToPerp,r));!(c=h()).done;)l.RefineCollinearBucket(c.value,e.projectionToDirection)},l.GetProjectionsDelegates=function(o,t){o===U.East?(t.projectionToDirection=function(e){return e.x},t.projectionToPerp=function(e){return e.y}):(t.projectionToPerp=function(e){return e.x},t.projectionToDirection=function(e){return e.y})},l.GetAllLinkedVertsInDirection=Si().mark(function s(o,t){var e,r,h;return Si().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:e=C(t);case 1:if((r=e()).done){f.next=13;break}h=r.value;case 4:if(null==h.Next){f.next=11;break}if(!dt(o(h.Point),o(h.Next.Point))){f.next=8;break}return f.next=8,h;case 8:h=h.Next,f.next=4;break;case 11:f.next=1;break;case 13:case"end":return f.stop()}},s)}),l.RefineCollinearBucket=function(o,t){for(var i,e=new ho(new rc(t)),r=C(o);!(i=r()).done;){var h=i.value;e.has(h.Point)||e.set(h.Point,0),e.has(h.Next.Point)||e.set(h.Next.Point,0)}for(var y,c=new Array(e.size),f=0,p=C(e.keys());!(y=p()).done;)c[f++]=y.value;for(f=0;f<c.length;f++)e.set(c[f],f);for(var L,P=C(o);!(L=P()).done;){var E=L.value;f=e.get(E.Point);var S=e.get(E.Next.Point);Math.abs(S-f)>1&&l.InsertPoints(E,c,f,S)}},l.InsertPoints=function(o,t,e,r){e<r?o.InsertVerts(e,r,t):o.InsertVertsInReverse(r,e,t)},l.CreatePathsToFirstLinkedVerticesMap=function(o){for(var r,t=new Map,e=C(o);!(r=e()).done;){var i=r.value;t.set(i,l.CreateLinkedVertexOfEdgePath(i))}return t},l.CreateLinkedVertexOfEdgePath=function(o){for(var t=o.PathPoints,e=new ln(t[0]),r=e,i=1;i<t.length;i++)e.Next=new ln(t[i]),e=e.Next;return r},l}(),vn=function(){function l(s,o){this.Points=s,this.I=o}return l.equal=function(o,t){return o.I===t.I&&o.Points===t.Points},Q(l,[{key:"Start",get:function(){return this.Points[this.I]}},{key:"End",get:function(){return this.Points[this.I+1]}}]),l}(),Ec=function(){function l(o,t){this.segTree=new Qi(null),this.crossedOutPaths=new Set,this.HierarchyOfObstacles=new Qi(t),this.Paths=o}l.RemoveStaircases=function(t,e){new l(t,e).Calculate()};var s=l.prototype;return s.Calculate=function(){var e,t=this;this.InitHierarchies();do{e=!1;for(var i,r=C(this.Paths.filter(function(c){return!t.crossedOutPaths.has(c)}));!(i=r()).done;)this.ProcessPath(i.value)&&(e=!0)}while(e)},s.ProcessPath=function(t){var e={pts:t.PathPoints,canHaveStaircase:!1};return this.ProcessPoints(e)?(t.PathPoints=e.pts,!0):(e.canHaveStaircase||this.crossedOutPaths.add(t),!1)},s.ProcessPoints=function(t){var e=this.FindStaircaseStart(t);return!(e<0||(t.pts=this.RemoveStaircasePN(t.pts,e),0))},s.FindStaircaseStart=function(t){if(t.canHaveStaircase=!1,t.pts.length<5)return-1;for(var e=[new vn(t.pts,0),new vn(t.pts,1),new vn(t.pts,2),new vn(t.pts,3)],r=0,i=0;;){var h={canHaveStaircaseAtI:!1};if(this.IsStaircase(t.pts,i,e,h))return t.canHaveStaircase=!0,i;if(t.canHaveStaircase=t.canHaveStaircase||h.canHaveStaircaseAtI,i++,t.pts.length<i+5)return-1;e[r]=new vn(t.pts,i+3),r++,r%=4}},l.GetFlippedPoint=function(t,e){return dt(t[e].y,t[e+1].y)?new R(t[e+4].x,t[e].y):new R(t[e].x,t[e+4].y)},s.Crossing=function(t,e,r){return l.IsCrossing(Z.mkPP(t,e),this.segTree,r)},l.IsCrossing=function(t,e,r){for(var h,f,i=function(){var y=f.value;if(-1===r.findIndex(function(m){return m===y}))return{v:!0}},c=C(e.GetAllIntersecting(t.boundingBox));!(f=c()).done;)if(h=i())return h.v;return!1},s.IntersectObstacleHierarchyPPP=function(t,e,r){return this.IntersectObstacleHierarchyL(Z.mkPP(t,e))||this.IntersectObstacleHierarchyL(Z.mkPP(e,r))},s.IntersectObstacleHierarchyL=function(t){return this.HierarchyOfObstacles.GetAllIntersecting(t.boundingBox).some(function(e){return null!=K.intersectionOne(t,e,!1)})},s.IsStaircase=function(t,e,r,i){var h=t[e],c=t[e+1],f=t[e+2],p=t[e+3],y=t[e+4];return i.canHaveStaircaseAtI=!1,nt.DirectionFromPointToPoint(h,c)===nt.DirectionFromPointToPoint(f,p)&&nt.DirectionFromPointToPoint(c,f)===nt.DirectionFromPointToPoint(p,y)&&(f=l.GetFlippedPoint(t,e),!this.IntersectObstacleHierarchyPPP(c,f,p))&&(i.canHaveStaircaseAtI=!0,!this.Crossing(c,f,r))},s.RemoveStaircasePN=function(t,e){var h=Math.abs(t[e].y-t[e+1].y)<q.distanceEpsilon/2;return this.RemoveStaircasePNB(t,e,h)},s.RemoveStaircasePNB=function(t,e,r){this.RemoveSegs(t);var i=new Array(t.length-2);!function(l,s,o){for(var t=0;o-- >0;)s[t++]=l[t++]}(t,i,e+1);var h=t[e+1],c=t[e+3];return i[e+1]=r?new R(c.x,h.y):new R(h.x,c.y),function(l,s,o,t,e){for(;e-- >0;)o[t++]=l[s++]}(t,e+4,i,e+2,i.length-e-2),this.InsertNewSegs(i,e),i},s.RemoveSegs=function(t){for(var e=0;e<t.length-1;e++)this.RemoveSeg(new vn(t,e))},s.RemoveSeg=function(t){this.segTree.Remove(l.Rect(t),t)},s.InsertNewSegs=function(t,e){this.InsSeg(t,e),this.InsSeg(t,e+1)},s.InitHierarchies=function(){for(var e,t=C(this.Paths);!(e=t()).done;)this.InsertPathSegs(e.value)},s.InsertPathSegs=function(t){this.InsertSegs(t.PathPoints)},s.InsertSegs=function(t){for(var e=0;e<t.length-1;e++)this.InsSeg(t,e)},s.InsSeg=function(t,e){var r=new vn(t,e);this.segTree.Add(l.Rect(r),r)},l.Rect=function(t){return lt.mkPP(t.Start,t.End)},l}();function da(){da=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ic=function(){function l(o,t,e,r){this.AncestorsSets=r,this.HierarchyOfGroups=Ht(Array.from(r.keys()).filter(function(i){return i.IsGroup}).map(function(i){return Qt(i,i.BoundingBox)})),this.Obstacles=e,this.EdgeSeparation=2*t,this.Paths=o,this.HierarchyOfObstacles=Ht(e.map(function(i){return Qt(i,i.boundingBox)})),this.MapPathsToTheirObstacles()}var s=l.prototype;return s.MapPathsToTheirObstacles=function(){this.PathToObstacles=new Map;for(var e,t=C(this.Paths);!(e=t()).done;)this.MapPathToItsObstacles(e.value)},s.MapPathToItsObstacles=function(t){if(t.PathPoints&&0!==t.PathPoints.length){var e=t.PathPoints,r=this.HierarchyOfObstacles.FirstHitNodeWithPredicate(e[0],l.ObstacleTest),i=this.HierarchyOfObstacles.FirstHitNodeWithPredicate(e[e.length-1],l.ObstacleTest);null!=r&&null!=i&&this.PathToObstacles.set(t,[r.UserData,i.UserData])}},l.ObstacleTest=function(t,e){return K.PointRelativeToCurveLocation(t,e)!==ht.Outside?Ft.Stop:Ft.Continue},s.Calculate=function(t,e){this.NudgingDirection=t,bc.RefinePaths(this.Paths,e),this.GetPathOrdersAndPathGraph(),this.MapAxisEdgesToTheirObstacles(),this.DrawPaths()},s.MapAxisEdgesToTheirObstacles=function(){this.axisEdgesToObstaclesTheyOriginatedFrom=new Map;for(var e,t=C(this.Paths);!(e=t()).done;)this.MapPathEndAxisEdgesToTheirObstacles(e.value);for(var h,i=C(this.Paths);!(h=i()).done;)this.UmmapPathInteriourFromStrangerObstacles(h.value)},s.UmmapPathInteriourFromStrangerObstacles=function(t){var e=this.FindFirstUnmappedEdge(t);if(null!=e)for(var r=this.FindLastUnmappedEdge(t),i=e;null!=i&&i!==r;i=i.Next)this.axisEdgesToObstaclesTheyOriginatedFrom.delete(i.AxisEdge)},s.FindLastUnmappedEdge=function(t){for(var e=t.LastEdge;null!=e;e=e.Prev)if(e.AxisEdge.Direction!==this.NudgingDirection)return e;return null},s.FindFirstUnmappedEdge=function(t){for(var e=t.FirstEdge;null!=e;e=e.Next)if(e.AxisEdge.Direction!==this.NudgingDirection)return e;return null},s.MapPathEndAxisEdgesToTheirObstacles=function(t){var e=this.PathToObstacles.get(t);e&&(this.ProcessThePathStartToMapAxisEdgesToTheirObstacles(t,e[0]),this.ProcessThePathEndToMapAxisEdgesToTheirObstacles(t,e[1]))},s.ProcessThePathEndToMapAxisEdgesToTheirObstacles=function(t,e){for(var r=t.LastEdge;null!=r&&nt.DirectionsAreParallel(r.Direction,this.NudgingDirection);r=r.Prev)this.axisEdgesToObstaclesTheyOriginatedFrom.set(r.AxisEdge,e)},s.ProcessThePathStartToMapAxisEdgesToTheirObstacles=function(t,e){for(var r=t.FirstEdge;null!=r&&nt.DirectionsAreParallel(r.Direction,this.NudgingDirection);r=r.Next)this.axisEdgesToObstaclesTheyOriginatedFrom.set(r.AxisEdge,e)},s.GetPathOrdersAndPathGraph=function(){var t=new su(this.Paths);this.PathOrders=t.GetOrder(),this.PathVisibilityGraph=t.PathVisibilityGraph},l.GetCurvesForShow=function(t,e){for(var h,r=new Array,i=C(t);!(h=i()).done;){for(var y,c=h.value,f=new vt,p=C(c.PathPoints);!(y=p()).done;)f.addPoint(y.value);r.push(f)}return r.concat(Array.from(e))},s.DrawPaths=function(){this.SetWidthsOfArrowheads(),this.CreateLongestNudgedSegments(),this.FindFreeSpaceInDirection(Array.from(this.PathVisibilityGraph.Edges)),this.MoveLongestSegsIdealPositionsInsideFeasibleIntervals(),this.PositionShiftedEdqges()},s.SetWidthsOfArrowheads=function(){for(var e,t=C(this.Paths);!(e=t()).done;)l.SetWidthsOfArrowheadsForEdge(e.value)},l.SetWidthsOfArrowheadsForEdge=function(t){var e=t.GeomEdge;if(null!=e.targetArrowhead){var r=t.LastEdge;r.Width=Math.max(e.targetArrowhead.width,r.Width)}if(null!=e.sourceArrowhead){var i=t.FirstEdge;i.Width=Math.max(e.sourceArrowhead.width,i.Width)}},s.PositionShiftedEdqges=function(){this.Solver=new Xh(this.EdgeSeparation);for(var t=0;t<this.LongestNudgedSegs.length;t++)this.CreateVariablesOfLongestSegment(this.LongestNudgedSegs[t]);this.CreateConstraintsOfTheOrder(),this.CreateConstraintsBetweenLongestSegments(),this.Solver.SolveByRegularSolver(),this.ShiftPathEdges()},s.MoveLongestSegsIdealPositionsInsideFeasibleIntervals=function(){for(var t=0;t<this.LongestNudgedSegs.length;t++)l.MoveLongestSegIdealPositionsInsideFeasibleInterval(this.LongestNudgedSegs[t])},l.MoveLongestSegIdealPositionsInsideFeasibleInterval=function(t){if(!t.IsFixed){var e=t.GetLeftBound(),r=t.GetRightBound();t.IdealPosition<e?t.IdealPosition=e:t.IdealPosition>r&&(t.IdealPosition=r)}},s.ShiftPathEdges=function(){for(var e,t=C(this.Paths);!(e=t()).done;){var r=e.value;r.PathPoints=this.GetShiftedPoints(r)}},s.GetShiftedPoints=function(t){return l.RemoveSwitchbacksAndMiddlePoints(this.GetShiftedPointsSimple(t))},l.Rectilinearise=function(t,e){return t.x===e.x||t.y===e.y?e:Math.abs(t.x-e.x)<Math.abs(t.y-e.y)?new R(t.x,e.y):new R(e.x,t.y)},s.GetShiftedPointsSimple=function(t){var e=[],r=t.FirstEdge;e.push(this.ShiftedPoint(r.Source,r.LongestNudgedSegment));for(var h,i=C(t.PathEdges());!(h=i()).done;)e.push(this.ShiftedEdgePositionOfTarget(h.value));return e},s.ShiftedEdgePositionOfTarget=function(t){return null!=t.LongestNudgedSegment||null==t.Next?this.ShiftedPoint(t.Target,t.LongestNudgedSegment):this.ShiftedPoint(t.Next.Source,t.Next.LongestNudgedSegment)},s.ShiftedPoint=function(t,e){if(null==e)return t;var r=this.Solver.GetVariablePosition(e.Id);return this.NudgingDirection===U.North?new R(r,t.y):new R(t.x,-r)},l.LineSegOfLongestSeg=function(t,e){for(var c,r=e===U.East?function(p){return p.x}:function(p){return p.y},i={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},h=C(t.Edges);!(c=h()).done;){var f=c.value;l.UpdateMinMaxWithPoint(i,r,f.Source),l.UpdateMinMaxWithPoint(i,r,f.Target)}return e===U.East?new Z(i.min,-t.IdealPosition,i.max,-t.IdealPosition):new Z(t.IdealPosition,i.min,t.IdealPosition,i.max)},l.UpdateMinMaxWithPoint=function(t,e,r){var i=e(r);t.min>i&&(t.min=i),t.max<i&&(t.max=i)},s.CreateConstraintsBetweenLongestSegments=function(){for(var e,t=C(this.LongestNudgedSegs);!(e=t()).done;)this.CreateConstraintsBetweenLongestSegmentsForSegment(e.value)},s.CreateConstraintsBetweenLongestSegmentsForSegment=function(t){for(var i,e=new Set,r=C(t.Edges);!(i=r()).done;){var c=i.value.AxisEdge;if(null!=c)for(var p,f=C(c.RightNeighbors);!(p=f()).done;)for(var P,m=C(p.value.LongestNudgedSegments);!(P=m()).done;)e.add(P.value)}for(var S,E=C(e);!(S=E()).done;)this.ConstraintTwoLongestSegs(t,S.value)},s.CreateConstraintsOfTheOrder=function(){for(var e,t=C(this.PathOrders);!(e=t()).done;){var r=e.value;l.ParallelToDirection(r[0],this.NudgingDirection)&&this.CreateConstraintsOfThePathOrder(r[1])}},l.ParallelToDirection=function(t,e){switch(e){case U.North:case U.South:return dt(t.SourcePoint.x,t.TargetPoint.x);default:return dt(t.SourcePoint.y,t.TargetPoint.y)}},s.CreateConstraintsOfThePathOrder=function(t){for(var i,e=null,r=C(t.filter(function(c){return null!=c.LongestNudgedSegment}));!(i=r()).done;){var h=i.value;null!=e&&this.ConstraintTwoLongestSegs(e.LongestNudgedSegment,h.LongestNudgedSegment),e=h}},s.ConstraintTwoLongestSegs=function(t,e){(!t.IsFixed||!e.IsFixed)&&this.Solver.AddConstraint(t.Id,e.Id)},s.CreateVariablesOfLongestSegment=function(t){if(t.IsFixed)this.Solver.AddFixedVariable(t.Id,l.SegmentPosition(t,this.NudgingDirection));else{var e=t.GetLeftBound(),r=t.GetRightBound();e>=r?(this.Solver.AddFixedVariable(t.Id,l.SegmentPosition(t,this.NudgingDirection)),t.IsFixed=!0):(this.Solver.AddVariableNNNN(t.Id,l.SegmentPosition(t,this.NudgingDirection),t.IdealPosition,t.Width),e!==Number.NEGATIVE_INFINITY&&this.Solver.SetLowBound(e,t.Id),r!==Number.POSITIVE_INFINITY&&this.Solver.SetUpperBound(t.Id,r))}},l.SegmentPosition=function(t,e){return e===U.North?t.Start.x:-t.Start.y},s.FindFreeSpaceInDirection=function(t){this.BoundAxisEdgesByRectsKnownInAdvance(),new lu(this.NudgingDirection,this.Obstacles,this.axisEdgesToObstaclesTheyOriginatedFrom,this.PathOrders,t).FindFreeSpace()},s.BoundAxisEdgesByRectsKnownInAdvance=function(){for(var e,t=C(this.Paths);!(e=t()).done;){var r=e.value;this.HasGroups&&this.BoundPathByMinCommonAncestors(r),this.BoundAxisEdgesAdjacentToSourceAndTargetOnEdge(r)}},s.BoundPathByMinCommonAncestors=function(t){for(var r,e=C(this.GetMinCommonAncestors(t.GeomEdge));!(r=e()).done;)for(var f,h=r.value.BoundingBox,c=C(t.PathEdges());!(f=c()).done;){var y=f.value.AxisEdge;y.Direction===this.NudgingDirection&&this.BoundAxisEdgeByRect(h,y)}},s.GetMinCommonAncestors=function(t){null==this.PortToShapes&&(this.PortToShapes=l.MapPortsToShapes(this.AncestorsSets.keys()));var e=function(l,s){var o=new Set;if(l.size<s.size)for(var e,t=C(l);!(e=t()).done;){var r=e.value;s.has(r)&&o.add(r)}else for(var h,i=C(s);!(h=i()).done;){var c=h.value;l.has(c)&&o.add(c)}return o}(this.AncestorsForPort(t.sourcePort),this.AncestorsForPort(t.targetPort));return Array.from(e).filter(function(r){return!r.Children.some(function(i){return e.has(i)})})},s.AncestorsForPort=function(t){var e=this.PortToShapes.get(t);return e?this.AncestorsSets.get(e):new Set(this.HierarchyOfGroups.AllHitItems(lt.mkPP(t.Location,t.Location),null))},s.BoundAxisEdgeAdjacentToObstaclePort=function(t,e){null==t.Curve?this.BoundAxisByPoint(t.Location,e):t.Curve.boundingBox.contains(t.Location)&&this.BoundAxisEdgeByRect(t.Curve.boundingBox,e)},s.BoundAxisByPoint=function(t,e){null!=e&&e.Direction===this.NudgingDirection&&(this.NudgingDirection===U.North?(e.BoundFromLeft(t.x),e.BoundFromRight(t.x)):(e.BoundFromLeft(-t.y),e.BoundFromRight(-t.y)))},s.BoundAxisEdgesAdjacentToSourceAndTargetOnEdge=function(t){this.BoundAxisEdgeAdjacentToObstaclePort(t.GeomEdge.sourcePort,t.FirstEdge.AxisEdge),this.BoundAxisEdgeAdjacentToObstaclePort(t.GeomEdge.targetPort,t.LastEdge.AxisEdge)},s.BoundAxisEdgeByRect=function(t,e){null!=e&&e.Direction===this.NudgingDirection&&(this.NudgingDirection===U.North?(e.BoundFromLeft(t.left),e.BoundFromRight(t.right)):(e.BoundFromLeft(-1*t.top),e.BoundFromRight(-1*t.bottom)))},s.CreateLongestNudgedSegments=function(){var t=this.NudgingDirection===U.East?function(r){return-r.y}:function(r){return r.x};this.LongestNudgedSegs=new Array;for(var e=0;e<this.Paths.length;e++)this.CreateLongestNudgedSegmentsForPath(this.Paths[e],t)},s.CreateLongestNudgedSegmentsForPath=function(t,e){this.GoOverPathAndCreateLongSegs(t),l.CalculateIdealPositionsForLongestSegs(t,e)},l.CalculateIdealPositionsForLongestSegs=function(t,e){for(var f,r=null,i=null,h=e(t.Start),c=C(t.PathEdges());!(f=c()).done;){var p=f.value;if(null!=p.LongestNudgedSegment){if(r=p.LongestNudgedSegment,null!=i){var y;l.SetIdealPositionForSeg(i,y=e(i.start),h,e(r.Start)),h=y,i=null}}else null!=r&&(i=r,r=null)}null!=i?l.SetIdealPositionForSeg(i,e(i.Start),h,e(t.End)):null!=r&&(r.IdealPosition=e(r.Start))},l.SetIdealPositionForSeg=function(t,e,r,i){var h=Math.max(r,i),c=Math.min(r,i);t.IdealPosition=c+q.distanceEpsilon<e?e<h?.5*(h+c):h:c},s.GoOverPathAndCreateLongSegs=function(t){for(var h,e=null,r=nt.OppositeDir(this.NudgingDirection),i=C(t.PathEdges());!(h=i()).done;){var c=h.value,f=c.Direction;f===this.NudgingDirection||f===r?(null==e?(c.LongestNudgedSegment=e=new Kh(this.LongestNudgedSegs.length),this.LongestNudgedSegs.push(e)):c.LongestNudgedSegment=e,c.IsFixed&&(e.IsFixed=!0)):(c.LongestNudgedSegment=null,e=null)}},l.BuildPolylineForPath=function(t){var e={points:t.PathPoints.map(function(r){return r.clone()})};return l.ExtendPolylineToPorts(e,t),e.points},l.ExtendPolylineToPorts=function(t,e){l.ExtendPolylineToSourcePort(t,e.GeomEdge.sourcePort.Location),l.ExtendPolylineToTargetPort(t,e.GeomEdge.targetPort.Location),t.points.length<2&&(t.points=new Array(2),t.points[0]=e.GeomEdge.sourcePort.Location,t.points[1]=e.GeomEdge.targetPort.Location)},l.ExtendPolylineToTargetPort=function(t,e){var r=t.points.length-1,i=nt.VectorDirectionPP(t.points[r-1],t.points[r]);if(l.ProjectionsAreClose(t.points[r-1],i,e))t.points=t.points.slice(0,r);else{var h=t.points[r];t.points[r]=i===U.East||i===U.West?new R(e.x,h.y):new R(h.x,e.y)}},l.ProjectionsAreClose=function(t,e,r){return e===U.East||e===U.West?dt(t.x,r.x):dt(t.y,r.y)},l.ExtendPolylineToSourcePort=function(t,e){var r=nt.VectorDirectionPP(t.points[0],t.points[1]);if(l.ProjectionsAreClose(t.points[1],r,e))t.points=t.points.slice(1);else{var i=t.points[0];t.points[0]=r===U.East||r===U.West?new R(e.x,i.y):new R(i.x,e.y)}},l.RemoveSwitchbacksAndMiddlePoints=function(t){var e=[],r=t[0];e.push(r);for(var i=t[1],h=nt.VectorDirectionPP(r,i),c=1;++c<t.length;){var f=nt.VectorDirectionPP(i,t[c]);f===h||nt.OppositeDir(f)===h||f===U.None||(R.closeDistEps(r,i)||e.push(r=l.Rectilinearise(r,i)),h=f),i=t[c]}return R.closeDistEps(r,i)||e.push(l.Rectilinearise(r,i)),e},l.NudgePaths=function(t,e,r,i,h){if(0!==t.length){var c=new l(t,e,r,i);c.Calculate(U.North,!0),c.Calculate(U.East,!1),c.Calculate(U.North,!1),h&&c.RemoveStaircases();for(var p,f=C(t);!(p=f()).done;){var y=p.value;y.GeomEdge.curve=vt.mkFromPoints(l.BuildPolylineForPath(y))}}},s.RemoveStaircases=function(){Ec.RemoveStaircases(this.Paths,this.HierarchyOfObstacles)},l.MapPortsToShapes=function(t){for(var i,e=new Map,r=C(t);!(i=r()).done;)for(var f,h=i.value,c=C(h.Ports);!(f=c()).done;)e.set(f.value,h);return e},l.GetEdgePathFromPathEdgesAsDebugCurves=da().mark(function o(t,e,r,i){var h,c,f,p;return da().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:h=i.ArrayOfPathPoints(),f=(c=h.length)>1?(e-t)/(c-1):1,p=0;case 4:if(!(p<h.length-1)){m.next=10;break}return m.next=7,xt.mkDebugCurveTWCI(200,t+f*p,r,Z.mkPP(h[p],h[p+1]));case 7:p++,m.next=4;break;case 10:case"end":return m.stop()}},o)}),Q(l,[{key:"HasGroups",get:function(){return null!=this.HierarchyOfGroups&&this.HierarchyOfGroups.Count>0}}]),l}(),Tc=function(s,o){this.Crossings=[],this.Location=s,this.Crossings=o},bi=function(){function l(){this.ListOfPointsAndCrossings=[],this.index=0,this.ListOfPointsAndCrossings=new Array}var s=l.prototype;return s.Count=function(){return this.ListOfPointsAndCrossings.length},s.Add=function(t,e){this.ListOfPointsAndCrossings.push(new Tc(t,e))},s.Pop=function(){return this.ListOfPointsAndCrossings[this.index++]},s.CurrentIsBeforeOrAt=function(t){return!(this.index>=this.ListOfPointsAndCrossings.length)&&J.ComparePP(this.ListOfPointsAndCrossings[this.index].Location,t)<=0},s.Reset=function(){this.index=0},s.MergeFrom=function(t){if(this.Reset(),null!=t){for(var e=this.ListOfPointsAndCrossings.length,r=0,i=t.ListOfPointsAndCrossings.length,h=0,c=new Array(this.ListOfPointsAndCrossings.length);r<e||h<i;)if(r>=e)c.push(t.ListOfPointsAndCrossings[h++]);else if(h>=i)c.push(this.ListOfPointsAndCrossings[r++]);else{var f=this.ListOfPointsAndCrossings[r],p=t.ListOfPointsAndCrossings[h],y=J.ComparePP(f.Location,p.Location);0===y?(c.push(f),++r,++h):-1===y?(c.push(f),++r):(c.push(p),++h)}this.ListOfPointsAndCrossings=c}},s.Trim=function(t,e){this.Reset(),null!=this.ListOfPointsAndCrossings&&0!==this.ListOfPointsAndCrossings.length&&(this.ListOfPointsAndCrossings=this.ListOfPointsAndCrossings.filter(function(r){return J.ComparePP(r.Location,t)>=0&&J.ComparePP(r.Location,e)<=0}))},l.ToCrossingArray=function(t,e){for(var r=0,i=t.length,h=0;h<i;h++)t[h].DirectionToInside===e&&r++;if(0===r)return null;for(var c=new Array(r),f=0,p=0;p<i;p++)t[p].DirectionToInside===e&&(c[f++]=t[p]);return c},s.ToString=function(){return $t.Ld.Format("{0} [{1}]",this.ListOfPointsAndCrossings.length,this.index)},Q(l,[{key:"First",get:function(){return this.ListOfPointsAndCrossings[0]}},{key:"Last",get:function(){return this.ListOfPointsAndCrossings[this.ListOfPointsAndCrossings.length-1]}}]),l}(),ut=function(){function l(){}return l.EdgeDirectionVE=function(o){return l.EdgeDirectionVV(o.Source,o.Target)},l.EdgeDirectionVV=function(o,t){return J.GetDirections(o.point,t.point)},l.GetEdgeEnd=function(o,t){return t===l.EdgeDirectionVE(o)?o.Target:o.Source},l.FindAdjacentVertex=function(o,t){for(var r,e=C(o.InEdges);!(r=e()).done;){var i=r.value;if(J.GetDirections(o.point,i.SourcePoint)===t)return i.Source}for(var c,h=C(o.OutEdges);!(c=h()).done;){var f=c.value;if(J.GetDirections(o.point,f.TargetPoint)===t)return f.Target}return null},l.FindAdjacentEdge=function(o,t){for(var r,e=C(o.InEdges);!(r=e()).done;){var i=r.value;if(J.GetDirections(i.SourcePoint,o.point)===t)return i}for(var c,h=C(o.OutEdges);!(c=h()).done;){var f=c.value;if(J.GetDirections(o.point,f.TargetPoint)===t)return f}return null},l.FindBendPointBetween=function(o,t,e){return l.IsVerticalD(e)?new R(t.x,o.y):new R(o.x,t.y)},l.SegmentIntersectionPPP=function(o,t,e){var r=J.GetDirections(o,t);return l.IsVerticalD(r)?new R(o.x,e.y):new R(e.x,o.y)},l.SegmentIntersectionSP=function(o,t){return l.SegmentIntersectionPPP(o.Start,o.End,t)},l.SegmentsIntersection=function(o,t){return l.IntervalsIntersect(o.Start,o.End,t.Start,t.End)},l.SegmentsIntersectLL=function(o,t){return l.IntervalsIntersect(o.start,o.end,t.start,t.end)},l.IntervalsOverlapSS=function(o,t){return l.IntervalsOverlapPPPP(o.Start,o.End,t.Start,t.End)},l.IntervalsOverlapPPPP=function(o,t,e,r){return l.IntervalsAreCollinear(o,t,e,r)&&J.ComparePP(o,r)!==J.ComparePP(t,e)},l.IntervalsAreCollinear=function(o,t,e,r){var i=l.IsVerticalPP(o,t);return l.IsVerticalPP(e,r)===i&&(i?J.Equal(o.x,e.x):J.Equal(o.y,e.y))},l.IntervalsAreSame=function(o,t,e,r){return J.EqualPP(o,e)&&J.EqualPP(t,r)},l.IntervalsIntersect=function(o,t,e,r){var i=l.SegmentIntersectionPPP(o,t,e);return l.PointIsOnSegmentPPP(o,t,i)&&l.PointIsOnSegmentPPP(e,r,i)?i:void 0},l.SegmentIntersectionEP=function(o,t){return l.SegmentIntersectionPPP(o.SourcePoint,o.TargetPoint,t)},l.PointIsOnSegmentPPP=function(o,t,e){return J.EqualPP(o,e)||J.EqualPP(t,e)||J.GetDirections(o,e)===J.GetDirections(e,t)},l.PointIsOnSegmentSP=function(o,t){return l.PointIsOnSegmentPPP(o.Start,o.End,t)},l.IsVerticalD=function(o){return!!(o&(U.North|U.South))},l.IsVerticalE=function(o){return l.IsVerticalD(J.GetDirections(o.SourcePoint,o.TargetPoint))},l.IsVerticalPP=function(o,t){return l.IsVerticalD(J.GetDirections(o,t))},l.IsVertical=function(o){return l.IsVerticalD(J.GetDirections(o.start,o.end))},l.IsAscending=function(o){return!!(o&(U.North|U.East))},l.Slope=function(o,t,e){var r=t.sub(o);return r.dot(e.PerpDirectionAsPoint)/r.dot(e.DirectionAsPoint)},l.SortAscending=function(o,t){var e=J.GetDirections(o,t);return U.None===e||l.IsAscending(e)?[o,t]:[t,o]},l.RectangleBorderIntersect=function(o,t,e){switch(e){case U.North:case U.South:return new R(t.x,l.GetRectangleBound(o,e));case U.East:case U.West:return new R(l.GetRectangleBound(o,e),t.y);default:throw new Error}},l.GetRectangleBound=function(o,t){switch(t){case U.North:return o.top;case U.South:return o.bottom;case U.East:return o.right;case U.West:return o.left;default:throw new Error}},l.RectangleInteriorsIntersect=function(o,t){return J.Compare(o.bottom,t.top)<0&&J.Compare(t.bottom,o.top)<0&&J.Compare(o.left,t.right)<0&&J.Compare(t.left,o.right)<0},l.PointIsInRectangleInterior=function(o,t){return J.Compare(o.y,t.top)<0&&J.Compare(t.bottom,o.y)<0&&J.Compare(o.x,t.right)<0&&J.Compare(t.left,o.x)<0},l}(),Zt=function(){function l(o){this.Dir=o,this.DirectionAsPoint=nt.toPoint(this.Dir),this.PerpDirection=U.North===o?U.East:U.North,this.PerpDirectionAsPoint=nt.toPoint(this.PerpDirection),this.OppositeDirection=nt.OppositeDir(o)}var s=l.prototype;return s.Compare=function(t,e){var r=this.ComparePerpCoord(t,e);return 0!==r?r:this.CompareScanCoord(t,e)},s.CompareScanCoord=function(t,e){return J.Compare(t.sub(e).dot(this.DirectionAsPoint),0)},s.ComparePerpCoord=function(t,e){return J.Compare(t.sub(e).dot(this.PerpDirectionAsPoint),0)},s.IsFlatS=function(t){return this.IsFlatPP(t.Start,t.End)},s.IsFlatPP=function(t,e){return J.Equal(e.sub(t).dot(this.PerpDirectionAsPoint),0)},s.IsPerpendicularS=function(t){return this.IsPerpendicularPP(t.Start,t.End)},s.IsPerpendicularPP=function(t,e){return J.Equal(e.sub(t).dot(this.DirectionAsPoint),0)},s.Coord=function(t){return t.dot(this.DirectionAsPoint)},s.Min=function(t,e){return this.Compare(t,e)<=0?t:e},s.Max=function(t,e){return this.Compare(t,e)>=0?t:e},l.GetInstance=function(t){return ut.IsVerticalD(t)?l.VerticalInstance:l.HorizontalInstance},s.ToString=function(){return this.Dir.toString()},Q(l,[{key:"Dir",get:function(){return this.dir},set:function(t){this.dir=t}},{key:"IsHorizontal",get:function(){return U.East===this.Dir}},{key:"IsVertical",get:function(){return U.North===this.Dir}},{key:"PerpendicularInstance",get:function(){return this.IsHorizontal?l.VerticalInstance:l.HorizontalInstance}}]),l}();Zt.HorizontalInstance=new Zt(U.East),Zt.VerticalInstance=new Zt(U.North);var Ct=function(l){function s(t,e,r,i){var h;return(h=l.call(this)||this).Update(t,e),h.Weight=r,h.GroupBoundaryPointAndCrossingsList=i,h}X(s,l),s.mk=function(e,r){return new s(e,r,s.NormalWeight,null)},s.IsVerticalSegment=function(e,r){return e.x===r.x};var o=s.prototype;return o.MergeGroupBoundaryCrossingList=function(e){null!=e&&(null==this.GroupBoundaryPointAndCrossingsList&&(this.GroupBoundaryPointAndCrossingsList=new bi),this.GroupBoundaryPointAndCrossingsList.MergeFrom(e))},o.TrimGroupBoundaryCrossingList=function(){null!=this.GroupBoundaryPointAndCrossingsList&&this.GroupBoundaryPointAndCrossingsList.Trim(this.Start,this.End)},o.Update=function(e,r){this.startPoint=e,this.endPoint=r},o.SetInitialVisibilityVertex=function(e){this.LowestVisibilityVertex=e,this.HighestVisibilityVertex=e},o.AppendVisibilityVertex=function(e,r){if(null==this.HighestVisibilityVertex)this.AddGroupCrossingsBeforeHighestVisibilityVertex(e,r)||this.SetInitialVisibilityVertex(r);else{if(J.IsPureLower(r.point,this.HighestVisibilityVertex.point))return;this.AddGroupCrossingsBeforeHighestVisibilityVertex(e,r)||this.AppendHighestVisibilityVertex(r)}},o.AddVisibilityEdge=function(e,r){var i=new hr(e,r,this.Weight);return _t.AddEdge(i),i},o.AppendHighestVisibilityVertex=function(e){J.EqualPP(this.HighestVisibilityVertex.point,e.point)||(this.AddVisibilityEdge(this.HighestVisibilityVertex,e),this.HighestVisibilityVertex=e)},o.LoadStartOverlapVertexIfNeeded=function(e){if(this.NeedStartOverlapVertex){var r=e.FindVertex(this.Start);this.AppendVisibilityVertex(e,r??e.AddVertexP(this.Start))}},o.LoadEndOverlapVertexIfNeeded=function(e){if(this.NeedEndOverlapVertex){var r=e.FindVertex(this.End);this.AppendVisibilityVertex(e,r??e.AddVertexP(this.End))}},o.OnSegmentIntersectorBegin=function(e){this.AppendGroupCrossingsThroughPoint(e,this.Start)||this.LoadStartOverlapVertexIfNeeded(e)},o.OnSegmentIntersectorEnd=function(e){this.AppendGroupCrossingsThroughPoint(e,this.End),this.GroupBoundaryPointAndCrossingsList=null,(null==this.HighestVisibilityVertex||J.IsPureLower(this.HighestVisibilityVertex.point,this.End))&&this.LoadEndOverlapVertexIfNeeded(e)},s.Subsume=function(e,r,i,h,c,f,p,y){return y.extendStart=!0,y.extendEnd=!0,!(null==e.seg||!ut.IntervalsOverlapPPPP(e.seg.Start,e.seg.End,r,i)||(e.seg.Weight!==h?e.seg.Start!==r||e.seg.End!==i||(e.seg.Weight=Math.min(e.seg.Weight,h),0):(y.extendStart=-1===f.CompareScanCoord(r,e.seg.Start),y.extendEnd=1===f.CompareScanCoord(i,e.seg.End),(y.extendStart||y.extendEnd)&&(p.Remove(e.seg),e.seg.startPoint=f.Min(e.seg.Start,r),e.seg.endPoint=f.Max(e.seg.End,i),e.seg=p.InsertUnique(e.seg).item,e.seg.MergeGroupBoundaryCrossingList(c)),0)))},o.IntersectsSegment=function(e){return void 0!==ut.SegmentsIntersection(this,e)},o.toString=function(){return"["+this.Start+" -> "+this.End+(this.IsOverlapped?" olap":" free")+"]"},o.ContainsPoint=function(e){return J.EqualPP(this.Start,e)||J.EqualPP(this.End,e)||J.GetDirections(this.Start,e)===J.GetDirections(e,this.End)},o.CreatePointFromPerpCoord=function(e){return this.IsVertical?new R(this.Start.x,e):new R(e,this.Start.y)},o.AddSparseVertexCoord=function(e){null==this.sparsePerpendicularCoords&&(this.sparsePerpendicularCoords=new Set),this.sparsePerpendicularCoords.add(e)},o.AddSparseEndpoint=function(e){return!this.sparsePerpendicularCoords.has(e)&&(this.sparsePerpendicularCoords.add(e),!0)},o.CreateSparseVerticesAndEdges=function(e){var r;if(null!=this.sparsePerpendicularCoords){this.AppendGroupCrossingsThroughPoint(e,this.Start);for(var h,i=C(Array.from(this.sparsePerpendicularCoords.values()).sort(It));!(h=i()).done;){var f=this.CreatePointFromPerpCoord(h.value);this.AppendVisibilityVertex(e,null!==(r=e.FindVertex(f))&&void 0!==r?r:e.AddVertexP(f))}this.AppendGroupCrossingsThroughPoint(e,this.End),this.GroupBoundaryPointAndCrossingsList=null,this.sparsePerpendicularCoords.clear(),this.sparsePerpendicularCoords=null}},o.HasVisibility=function(){return null!=this.LowestVisibilityVertex},o.AddGroupCrossingsBeforeHighestVisibilityVertex=function(e,r){return!!this.AppendGroupCrossingsThroughPoint(e,r.point)&&(J.IsPureLower(this.HighestVisibilityVertex.point,r.point)&&(this.AddVisibilityEdge(this.HighestVisibilityVertex,r),this.HighestVisibilityVertex=r),!0)},o.AppendGroupCrossingsThroughPoint=function(e,r){var i;if(null==this.GroupBoundaryPointAndCrossingsList)return!1;for(var h=!1;this.GroupBoundaryPointAndCrossingsList.CurrentIsBeforeOrAt(r);){var c=this.GroupBoundaryPointAndCrossingsList.Pop(),f=null,p=null;J.ComparePP(c.Location,this.Start)>0&&(f=bi.ToCrossingArray(c.Crossings,this.ScanDirection.OppositeDirection)),J.ComparePP(c.Location,this.End)<0&&(p=bi.ToCrossingArray(c.Crossings,this.ScanDirection.Dir)),h=!0;var y=null!==(i=e.FindVertex(c.Location))&&void 0!==i?i:e.AddVertexP(c.Location);e.AddVertexP(c.Location),null!=f||null!=p?(this.AddLowCrossings(e,y,f),this.AddHighCrossings(e,y,p)):null==this.LowestVisibilityVertex?this.SetInitialVisibilityVertex(y):this.AppendHighestVisibilityVertex(y)}return h},s.GetCrossingInteriorVertex=function(e,r,i){var h,c=i.GetInteriorVertexPoint(r.point);return null!==(h=e.FindVertex(c))&&void 0!==h?h:e.AddVertexP(c)},o.AddCrossingEdge=function(e,r,i,h){var c=null;null!=this.HighestVisibilityVertex&&(J.EqualPP(this.HighestVisibilityVertex.point,i.point)?c=e.FindEdgePP(r.point,i.point):this.AppendHighestVisibilityVertex(r)),null==c&&(c=this.AddVisibilityEdge(r,i));var f=h.map(function(y){return y.Group.InputShape}),p=c.IsPassable;c.IsPassable=null==p?function(){for(var m,y=C(f);!(m=y()).done;)if(m.value.IsTransparent)return!0;return!1}:function(){for(var m,y=C(f);!(m=y()).done;)if(m.value.IsTransparent||p())return!0;return!1},null==this.LowestVisibilityVertex&&this.SetInitialVisibilityVertex(r),this.HighestVisibilityVertex=i},o.AddLowCrossings=function(e,r,i){if(null!=i){var h=s.GetCrossingInteriorVertex(e,r,i[0]);this.AddCrossingEdge(e,h,r,i)}},o.AddHighCrossings=function(e,r,i){if(null!=i){var h=s.GetCrossingInteriorVertex(e,r,i[0]);this.AddCrossingEdge(e,r,h,i)}},Q(s,[{key:"Start",get:function(){return this.startPoint}},{key:"End",get:function(){return this.endPoint}},{key:"IsVertical",get:function(){return s.IsVerticalSegment(this.Start,this.End)}},{key:"ScanDirection",get:function(){return this.IsVertical?Zt.VerticalInstance:Zt.HorizontalInstance}},{key:"IsOverlapped",get:function(){return s.OverlappedWeight===this.Weight}},{key:"IsReflection",get:function(){return s.ReflectionWeight===this.Weight}},{key:"HasSparsePerpendicularCoords",get:function(){return null!=this.sparsePerpendicularCoords&&this.sparsePerpendicularCoords.size>0}}]),s}(Yo);Ct.NormalWeight=hr.DefaultWeight,Ct.ReflectionWeight=5,Ct.OverlappedWeight=500;var Cu=function(){function l(o,t,e,r,i){this.IsClosed=!1,this.Vertex=o,this.Direction=null!=t?nt.DirectionFromPointToPoint(t.Vertex.point,o.point):U.None,this.ResetEntry(t,e,r,i)}var s=l.prototype;return s.ResetEntry=function(t,e,r,i){this.PreviousEntry=t,this.Length=e,this.NumberOfBends=r,this.Cost=i},s.toString=function(){return this.Vertex.point+" "+this.Direction+" "+this.IsClosed+" "+this.Cost},Q(l,[{key:"PreviousVertex",get:function(){return null==this.PreviousEntry?null:this.PreviousEntry.Vertex}}]),l}(),va=function(){function l(){this.Clear()}var s=l.prototype;return s.Set=function(t,e){this.Vertex=t,this.Weight=e},s.Clear=function(){this.Vertex=null,this.Weight=Number.NaN},l}(),yr=function(){function l(){this.nextNeighbors=[new va,new va,new va],this.LengthImportance=1,this.BendsImportance=1}var s=l.prototype;return s.CombinedCost=function(t,e){return this.LengthImportance*t+this.BendsImportance*e},s.TotalCostFromSourceToVertex=function(t,e){return this.CombinedCost(t,e)+this.sourceCostAdjustment},s.InitPath=function(t,e,r){if(e===r||!this.InitEntryDirectionsAtTarget(r))return!1;this.Target=r,this.Source=e;var i=this.TotalCostFromSourceToVertex(0,0)+this.HeuristicDistanceFromVertexToTarget(e.point,U.None);return!(i>=this.upperBoundOnCost)&&(this.queue=new Gr(It),this.visitedVertices=[e],null==t?this.EnqueueInitialVerticesFromSource(i):this.EnqueueInitialVerticesFromSourceEntries(t),this.queue.count>0)},s.InitEntryDirectionsAtTarget=function(t){this.EntryDirectionsToTarget=U.None;for(var r,e=C(t.OutEdges);!(r=e()).done;)this.EntryDirectionsToTarget=this.EntryDirectionsToTarget|nt.DirectionFromPointToPoint(r.value.TargetPoint,t.point);for(var c,h=C(t.InEdges);!(c=h()).done;)this.EntryDirectionsToTarget=this.EntryDirectionsToTarget|nt.DirectionFromPointToPoint(c.value.SourcePoint,t.point);return this.EntryDirectionsToTarget!==U.None},l.IsInDirs=function(t,e){return t===(t&e)},s.MultistageAdjustedCostBound=function(t){return Number.isFinite(t)?t+this.BendsImportance:t},s.HeuristicDistanceFromVertexToTarget=function(t,e){var r=this.Target.point.sub(t);if(dt(r.x,0)&&dt(r.y,0))return this.targetCostAdjustment;var h,i=nt.VectorDirection(r);return h=this.GetNumberOfBends(e===U.None?e=U.East|U.North|U.West|U.South:e,i),this.CombinedCost(l.ManhattanDistance(t,this.Target.point),h)+this.targetCostAdjustment},s.GetNumberOfBends=function(t,e){return nt.IsPureDirection(e)?this.GetNumberOfBendsForPureDirection(t,e):l.GetBendsForNotPureDirection(e,t,this.EntryDirectionsToTarget)},s.GetNumberOfBendsForPureDirection=function(t,e){return(e&t)===e?l.IsInDirs(e,this.EntryDirectionsToTarget)?0:l.IsInDirs(l.Left(e),this.EntryDirectionsToTarget)||l.IsInDirs(l.Right(e),this.EntryDirectionsToTarget)?2:4:this.GetNumberOfBendsForPureDirection(l.AddOneTurn[t],e)+1},l.GetBendsForNotPureDirection=function(t,e,r){var i=t&e;if(i===U.None)return l.GetBendsForNotPureDirection(t,l.AddOneTurn[e],r)+1;var h=t&r;return h===U.None?l.GetBendsForNotPureDirection(t,e,l.AddOneTurn[r])+1:(i|h)===t?1:2},l.Left=function(t){switch(t){case U.None:return U.None;case U.North:return U.West;case U.East:return U.North;case U.South:return U.East;case U.West:return U.South;default:throw new Error("direction")}},l.Right=function(t){switch(t){case U.None:return U.None;case U.North:return U.East;case U.East:return U.South;case U.South:return U.West;case U.West:return U.North;default:throw new Error("direction")}},l.RestorePathV=function(t){return l.RestorePath(t,null)},l.RestorePath=function(t,e){if(null==t.entry)return[];for(var r=new Array,i=!1,h=U.None;;){h===t.entry.Direction?i=!0:(i=!1,r.push(t.entry.Vertex.point),h=t.entry.Direction);var c=t.entry.PreviousEntry;if(null==c||t.entry.Vertex===e)break;t.entry=c}return i&&r.push(t.entry.Vertex.point),r.reverse(),r},s.QueueReversedEntryToNeighborVertexIfNeeded=function(t,e,r){var i={numberOfBends:0,length:0},h=e.PreviousVertex,c=l.GetLengthAndNumberOfBendsToNeighborVertex(t,h,r,i);if(this.CombinedCost(i.length,i.numberOfBends)<this.CombinedCost(e.Length,e.NumberOfBends)||1===t.Vertex.Degree){var f=this.TotalCostFromSourceToVertex(i.length,i.numberOfBends)+this.HeuristicDistanceFromVertexToTarget(h.point,c);this.EnqueueEntry(t,h,i.length,i.numberOfBends,f)}},s.UpdateEntryToNeighborVertexIfNeeded=function(t,e,r){var i={numberOfBends:0,length:0},h=l.GetLengthAndNumberOfBendsToNeighborVertex(t,e.Vertex,r,i);if(this.CombinedCost(i.length,i.numberOfBends)<this.CombinedCost(e.Length,e.NumberOfBends)){var c=this.TotalCostFromSourceToVertex(i.length,i.numberOfBends)+this.HeuristicDistanceFromVertexToTarget(e.Vertex.point,h);e.ResetEntry(t,i.length,i.numberOfBends,c),this.queue.DecreasePriority(e,c)}},s.CreateAndEnqueueEntryToNeighborVertex=function(t,e,r){var i={numberOfBends:0,length:0},h=l.GetLengthAndNumberOfBendsToNeighborVertex(t,e,r,i),c=this.TotalCostFromSourceToVertex(i.length,i.numberOfBends)+this.HeuristicDistanceFromVertexToTarget(e.point,h);c<this.upperBoundOnCost&&(null==e.VertexEntries&&this.visitedVertices.push(e),this.EnqueueEntry(t,e,i.length,i.numberOfBends,c))},s.EnqueueEntry=function(t,e,r,i,h){var c=new Cu(e,t,r,i,h);e.SetVertexEntry(c),this.queue.Enqueue(c,c.Cost)},l.GetLengthAndNumberOfBendsToNeighborVertex=function(t,e,r,i){i.length=t.Length+l.ManhattanDistance(t.Vertex.point,e.point)*r;var h=nt.DirectionFromPointToPoint(t.Vertex.point,e.point);return i.numberOfBends=t.NumberOfBends,t.Direction!==U.None&&h!==t.Direction&&i.numberOfBends++,h},l.ManhattanDistance=function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},s.GetPathWithCost=function(t,e,r,i,h,c,f){if(this.upperBoundOnCost=f,this.sourceCostAdjustment=r,this.targetCostAdjustment=c,!this.InitPath(t,e,h))return null;for(;this.queue.count>0;){var p=this.queue.Dequeue(),y=p.Vertex;if(y!==this.Target){p.IsClosed=!0;for(var T,S=C(this.nextNeighbors);!(T=S()).done;)T.value.Clear();var x=l.Right(p.Direction);this.ExtendPathAlongInEdges(p,y.InEdges,x),this.ExtendPathAlongOutEdges(p,y.OutEdges,x);for(var M,B=C(this.nextNeighbors);!(M=B()).done;){var F=M.value;null!=F.Vertex&&this.ExtendPathToNeighborVertex(p,F.Vertex,F.Weight)}}else{if(null==i)return this.Cleanup(),p;if(this.EntryDirectionsToTarget===U.None){for(var L,m=0,P=C(this.Target.VertexEntries);!(L=P()).done;)i[m++]=L.value;return this.Cleanup(),null}this.upperBoundOnCost=Math.min(this.MultistageAdjustedCostBound(p.Cost),this.upperBoundOnCost)}}if(null!=i&&null!=this.Target.VertexEntries)for(var A=0;A<this.Target.VertexEntries.length;A++)i[A]=this.Target.VertexEntries[A];return this.Cleanup(),null},s.ExtendPathAlongInEdges=function(t,e,r){for(var h,i=C(e);!(h=i()).done;)this.ExtendPathAlongEdge(t,h.value,!0,r)},s.ExtendPathAlongOutEdges=function(t,e,r){for(var i=e.isEmpty()?null:e.treeMinimum();null!=i;i=e.next(i))this.ExtendPathAlongEdge(t,i.item,!1,r)},s.ExtendPathAlongEdge=function(t,e,r,i){if(l.IsPassable(e)){var h=r?e.Source:e.Target;if(h===t.PreviousVertex){if(t.Vertex.Degree>1||t.Vertex!==this.Source)return;return void this.ExtendPathToNeighborVertex(t,h,e.Weight)}var c=nt.DirectionFromPointToPoint(t.Vertex.point,h.point),f=this.nextNeighbors[2];c!==t.Direction&&(f=this.nextNeighbors[c===i?1:0]),f.Set(h,e.Weight)}},s.EnqueueInitialVerticesFromSource=function(t){for(var i,e=new Cu(this.Source,null,0,0,t),r=C(this.Source.OutEdges);!(i=r()).done;){var h=i.value;l.IsPassable(h)&&this.ExtendPathToNeighborVertex(e,h.Target,h.Weight)}for(var f,c=C(this.Source.InEdges);!(f=c()).done;){var p=f.value;l.IsPassable(p)&&this.ExtendPathToNeighborVertex(e,p.Source,p.Weight)}},s.EnqueueInitialVerticesFromSourceEntries=function(t){for(var r,e=C(t);!(r=e()).done;){var i=r.value;null!=i&&this.queue.Enqueue(i,i.Cost)}},s.ExtendPathToNeighborVertex=function(t,e,r){var i=nt.DirectionFromPointToPoint(t.Vertex.point,e.point),h=null!=e.VertexEntries?e.VertexEntries[nt.ToIndex(i)]:null;null==h?this.CreateAndEnqueueReversedEntryToNeighborVertex(t,e,r)||this.CreateAndEnqueueEntryToNeighborVertex(t,e,r):h.IsClosed||this.UpdateEntryToNeighborVertexIfNeeded(t,h,r)},s.CreateAndEnqueueReversedEntryToNeighborVertex=function(t,e,r){if(null!=t.Vertex.VertexEntries){var i=nt.DirectionFromPointToPoint(e.point,t.Vertex.point),h=t.Vertex.VertexEntries[nt.ToIndex(i)];if(null!=h)return this.QueueReversedEntryToNeighborVertexIfNeeded(t,h,r),!0}return!1},l.IsPassable=function(t){return null==t.IsPassable||t.IsPassable()},s.Cleanup=function(){for(var e,t=C(this.visitedVertices);!(e=t()).done;)e.value.RemoveVertexEntries();this.visitedVertices=[],this.queue=null},l}();yr.DefaultBendPenaltyAsAPercentageOfDistance=4,yr.AddOneTurn=[U.None,U.North|U.East|U.West,U.North|U.East|U.South,15,U.East|U.South|U.West,15,15,15,13,15,15,15,15,15,15,15];var Oc=function(){function l(o){this.bendPenaltyAsAPercentageOfDistance=yr.DefaultBendPenaltyAsAPercentageOfDistance,this.currentPassTargetEntries=new Array(4),this.bendPenaltyAsAPercentageOfDistance=o}var s=l.prototype;return s.GetPath=function(t,e){var r={entry:this.GetPathStage(null,t,null,e)};return yr.RestorePathV(r)},s.GetPathStage=function(t,e,r,i){var h=new yr,c={bestEntry:null,bestCost:Number.MAX_VALUE/Ct.OverlappedWeight},f=Number.POSITIVE_INFINITY,p=l.Barycenter(e),y=l.Barycenter(i),m=yr.ManhattanDistance(p,y);h.BendsImportance=Math.max(.001,m*(.01*this.bendPenaltyAsAPercentageOfDistance));for(var T,P=h.LengthImportance,L=null!=r?this.currentPassTargetEntries:null,E=[],S=C(e);!(T=S()).done;)for(var B,O=T.value,x=C(i);!(B=x()).done;)E.push([O,B.value]);E.sort(function(d,g){var b=g[0],I=g[1];return n(d[0],d[1])-n(b,I)});for(var F=0,A=E;F<A.length;F++){var z=A[F],V=z[0],Y=z[1];if(!R.closeDistEps(V.point,Y.point)){var W=a(V,p)*P,_=a(Y,y)*P,D=c.bestCost;if(null!=r){for(var j=0;j<L.length;j++)L[j]=null;D=h.MultistageAdjustedCostBound(c.bestCost)}var H=h.GetPathWithCost(t,V,W,L,Y,_,D);if(null!=L){l.UpdateTargetEntriesForEachDirection(r,L,c);continue}if(null!=H){var u=H.Cost/n(V,Y);(H.Cost<c.bestCost||dt(H.Cost,c.bestCost)&&u<f)&&(c.bestCost=H.Cost,c.bestEntry=H,f=H.Cost/n(V,Y))}}}return c.bestEntry;function n(d,g){return yr.ManhattanDistance(d.point,g.point)}function a(d,g){return yr.ManhattanDistance(d.point,g)}},l.UpdateTargetEntriesForEachDirection=function(t,e,r){for(var i=0;i<e.length;i++){var h=e[i];null!=h&&(null==t[i]||h.Cost<t[i].Cost)&&(t[i]=h,h.Cost<r.bestCost&&(r.bestCost=h.Cost,r.bestEntry=h))}},l.Barycenter=function(t){for(var i,e=new R(0,0),r=C(t);!(i=r()).done;)e=e.add(i.value.point);return e.div(t.length)},l}(),Ac=Ei().mark(ga);function Ei(){Ei=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var kc=function(){function l(o){this.GeomEdge=o}var s=l.prototype;return s.ArrayOfPathPoints=function(){return this._pathPoints instanceof ln?Array.from(ga(this._pathPoints)):this._pathPoints},s.PathEdges=Ei().mark(function o(){var t;return Ei().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t=this.FirstEdge;case 1:if(null==t){r.next=7;break}return r.next=4,t;case 4:t=t.Next,r.next=1;break;case 7:case"end":return r.stop()}},o,this)}),s.AddEdge=function(t){t.Path=this,this.LastEdge.Next=t,t.Prev=this.LastEdge,this.LastEdge=t},s.SetFirstEdge=function(t){this.FirstEdge=t,this.LastEdge=t,t.Path=this},s.toString=function(){var t=new $t.HT;this.PathPoints instanceof ln&&t.Append("L");for(var r,e=C(ga(this.PathPoints));!(r=e()).done;)t.Append(r.value.toString());return t.ToString()},Q(l,[{key:"PathPoints",get:function(){return this._pathPoints},set:function(t){this._pathPoints=t}},{key:"Width",get:function(){return this.GeomEdge.lineWidth}},{key:"End",get:function(){return this.LastEdge.Target}},{key:"Start",get:function(){return this.FirstEdge.Source}}]),l}();function ga(l){var s,o,t,e;return Ei().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(l instanceof ln)){i.next=10;break}s=l;case 2:if(null==s){i.next=8;break}return i.next=5,s.Point;case 5:s=s.Next,i.next=2;break;case 8:i.next=17;break;case 10:o=C(l);case 11:if((t=o()).done){i.next=17;break}return e=t.value,i.next=15,e;case 15:i.next=11;break;case 17:case"end":return i.stop()}},Ac)}var Lu=function(l){function s(o,t,e,r){var i;return(i=l.call(this,t)||this).Slope=0,i.SlopeInverse=0,i.Obstacle=o,i.endVertex=r?t.nextOnPolyline:t.prevOnPolyline,e.IsPerpendicularPP(t.point,i.endVertex.point)||(i.Slope=ut.Slope(t.point,i.endVertex.point,e),i.SlopeInverse=1/i.Slope),i}return X(s,l),Q(s,[{key:"Obstacle",get:function(){return this.obstacle},set:function(t){this.obstacle=t}},{key:"EndVertex",get:function(){return this.endVertex}}]),s}(Qo),He=function(l){function s(o,t,e){return l.call(this,o,t,e,e.IsHorizontal)||this}return X(s,l),s}(Lu),Ci=function(l){function s(o,t,e){return l.call(this,o,t,e,e.IsVertical)||this}return X(s,l),s}(Lu),Ge=function(){function l(o,t){null!=o&&(this.PaddedPolyline=Ie.PaddedPolylineBoundaryOfNode(o.BoundaryCurve,t),l.RoundVerticesAndSimplify(this.PaddedPolyline),this.IsRectangle=this.IsPolylineRectangle(),this.InputShape=o,this.Ports=new Set(this.InputShape.Ports))}var s=l.prototype;return s.GetPortChanges=function(t){return t.addedPorts=Tn(this.InputShape.Ports,this.Ports),t.removedPorts=Tn(this.Ports,this.InputShape.Ports),(0!==t.addedPorts.size||0!==t.removedPorts.size)&&(this.Ports=new Set(this.InputShape.Ports),!0)},l.CreateSentinel=function(t,e,r,i){var h=l.mk(t,e,i);return h.CreateInitialSides(h.PaddedPolyline.startPoint,r),h},s.CreateInitialSides=function(t,e){this.ActiveLowSide=new He(this,t,e),this.ActiveHighSide=new Ci(this,t,e),e.IsFlatS(this.ActiveHighSide)&&(this.ActiveHighSide=new Ci(this,this.ActiveHighSide.EndVertex,e))},l.mk=function(t,e,r){var i=new l(null,0);return i.PaddedPolyline=vt.mkClosedFromPoints([R.RoundPoint(t),R.RoundPoint(e)]),i.Ordinal=r,i},s.IsPolylineRectangle=function(){if(4!==this.PaddedPolyline.count)return!1;var t=this.PaddedPolyline.startPoint,e=t.nextOnPolyline,r=nt.VectorDirectionPP(t.point,e.point);if(!nt.IsPureDirection(r))return!1;do{var i=nt.DirectionFromPointToPoint((t=e).point,(e=t.nextOnPolyline).point);if(i!==nt.RotateRight(r))return!1;r=i}while(t!==this.PaddedPolyline.startPoint);return!0},l.RoundVerticesAndSimplify=function(t){var e=t.startPoint;do{e.point=R.RoundPoint(e.point),e=e.nextOnPolyline}while(e!==t.startPoint);l.RemoveCloseAndCollinearVerticesInPlace(t),t.setInitIsRequired()},l.RemoveCloseAndCollinearVerticesInPlace=function(t){for(var e=10*q.intersectionEpsilon,r=t.startPoint.next;null!=r;r=r.next)R.close(r.prev.point,r.point,e)&&(null==r.next?t.RemoveEndPoint():(r.prev.next=r.next,r.next.prev=r.prev));return R.close(t.start,t.end,e)&&t.RemoveStartPoint(),null!=(t=t.RemoveCollinearVertices()).endPoint.prev&&t.endPoint.prev!==t.startPoint&&R.getTriangleOrientation(t.endPoint.prev.point,t.end,t.start)===it.Collinear&&t.RemoveEndPoint(),null!=t.startPoint.next&&t.endPoint.prev!==t.startPoint&&R.getTriangleOrientation(t.end,t.start,t.startPoint.next.point)===it.Collinear&&t.RemoveStartPoint(),t.setInitIsRequired(),t},s.IsInSameClump=function(t){return this.isOverlapped&&this.clump===t.clump},s.Close=function(){this.ActiveLowSide=null,this.ActiveHighSide=null},s.SetConvexHull=function(t){this.clump=null,this.IsRectangle=!1,this.ConvexHull=t,this.looseVisibilityPolyline=null},l.CreateLoosePolyline=function(t){var e=Ie.CreatePaddedPolyline(t,10*q.intersectionEpsilon);return l.RoundVerticesAndSimplify(e),e},Q(l,[{key:"PaddedPolyline",get:function(){return this._PaddedPolyline},set:function(t){this._PaddedPolyline=t}},{key:"looseVisibilityPolyline",get:function(){return null==this._looseVisibilityPolyline&&(this._looseVisibilityPolyline=l.CreateLoosePolyline(this.VisibilityPolyline)),this._looseVisibilityPolyline},set:function(t){this._looseVisibilityPolyline=t}},{key:"IsInConvexHull",get:function(){return null!=this.ConvexHull}},{key:"IsGroup",get:function(){return null!=this.InputShape&&this.InputShape.IsGroup}},{key:"VisibilityBoundingBox",get:function(){return this.VisibilityPolyline.boundingBox}},{key:"VisibilityPolyline",get:function(){return null!=this.ConvexHull?this.ConvexHull.Polyline:this.PaddedPolyline}},{key:"IsPrimaryObstacle",get:function(){return null==this.ConvexHull||this===this.ConvexHull.PrimaryObstacle}},{key:"isOverlapped",get:function(){return void 0!==this.clump&&this.clump.length>0}},{key:"IsSentinel",get:function(){return null==this.InputShape}},{key:"IsTransparentAncestor",get:function(){return null!=this.InputShape&&this.InputShape.IsTransparent},set:function(t){this.InputShape.IsTransparent=t}}]),l}();Ge.FirstSentinelOrdinal=1,Ge.FirstNonSentinelOrdinal=10;var Rc=function(){function l(o,t,e,r){this.IsOverlapped=!1,this.unpaddedToPaddedBorderWeight=Ct.NormalWeight,this.ObstaclePort=o,this.UnpaddedBorderIntersect=t,this.OutwardDirection=e;var i=Z.mkPP(this.UnpaddedBorderIntersect,ut.RectangleBorderIntersect(o.Obstacle.VisibilityBoundingBox,this.UnpaddedBorderIntersect,e)),h=K.getAllIntersections(i,o.Obstacle.VisibilityPolyline,!0);this.VisibilityBorderIntersect=R.RoundPoint(h[0].x);var c={pacList:null};this.MaxVisibilitySegment=r.CreateMaxVisibilitySegment(this.VisibilityBorderIntersect,this.OutwardDirection,c),this.pointAndCrossingsList=c.pacList,(this.Obstacle.isOverlapped||this.Obstacle.IsGroup&&!this.Obstacle.IsInConvexHull)&&(this.IsOverlapped=r.IntersectionIsInsideAnotherObstacle(null,this.Obstacle,this.VisibilityBorderIntersect,Zt.GetInstance(this.OutwardDirection)),(!this.Obstacle.IsGroup||this.IsOverlapped||this.InteriorEdgeCrossesObstacle(r))&&(this.unpaddedToPaddedBorderWeight=Ct.OverlappedWeight)),this.Obstacle.IsInConvexHull&&this.unpaddedToPaddedBorderWeight===Ct.NormalWeight&&this.SetUnpaddedToPaddedBorderWeightFromHullSiblingOverlaps(r)}var s=l.prototype;return s.SetUnpaddedToPaddedBorderWeightFromHullSiblingOverlaps=function(t){(this.Obstacle.IsGroup?this.InteriorEdgeCrossesObstacle(t):this.InteriorEdgeCrossesConvexHullSiblings())&&(this.unpaddedToPaddedBorderWeight=Ct.OverlappedWeight)},s.InteriorEdgeCrossesObstacle=function(t){var e=this,r=lt.mkPP(this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect);return this.InteriorEdgeCrossesObstacleRFI(r,function(i){return i.VisibilityPolyline},Array.from(t.Root.GetLeafRectangleNodesIntersectingRectangle(r)).filter(function(i){return!i.UserData.IsGroup&&i.UserData!==e.Obstacle}).map(function(i){return i.UserData}))},s.InteriorEdgeCrossesConvexHullSiblings=function(){var t=this,e=lt.mkPP(this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect);return this.InteriorEdgeCrossesObstacleRFI(e,function(r){return r.PaddedPolyline},this.Obstacle.ConvexHull.Obstacles.filter(function(r){return r!==t.Obstacle}))},s.InteriorEdgeCrossesObstacleRFI=function(t,e,r){for(var c,i=null,h=C(r);!(c=h()).done;){var p=e(c.value);if(ut.RectangleInteriorsIntersect(t,p.boundingBox)&&(i=i??Z.mkPP(this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect),null!=K.intersectionOne(i,p,!1)||ht.Outside!==K.PointRelativeToCurveLocation(this.UnpaddedBorderIntersect,p)))return!0}return!1},s.HasGroupCrossingBeforePoint=function(t){if(!this.HasGroupCrossings)return!1;var e=ut.IsAscending(this.OutwardDirection)?this.pointAndCrossingsList.First:this.pointAndCrossingsList.Last;return J.GetDirections(this.MaxVisibilitySegment.start,e.Location)===J.GetDirections(e.Location,t)},s.AddToAdjacentVertex=function(t,e,r,i){var h=t.VisGraph.FindVertex(this.VisibilityBorderIntersect);null==h?(this.OutwardDirection===J.GetDirections(e.point,this.VisibilityBorderIntersect)?(this.VisibilityBorderIntersect=e.point,h=e):(h=t.FindOrAddVertex(this.VisibilityBorderIntersect),t.FindOrAddEdge(h,e,this.InitialWeight)),this.ExtendEdgeChain(t,h,e,r,i)):this.ExtendEdgeChain(t,h,h,r,i)},s.ExtendEdgeChain=function(t,e,r,i,h){t.ExtendEdgeChainVRLPB(r,i,this.MaxVisibilitySegment,this.pointAndCrossingsList,this.IsOverlapped);var c=t.FindOrAddVertex(this.UnpaddedBorderIntersect);t.FindOrAddEdge(c,e,this.unpaddedToPaddedBorderWeight),h&&t.ConnectVertexToTargetVertex(this.ObstaclePort.CenterVertex,c,this.OutwardDirection,this.InitialWeight)},s.toString=function(){return $t.Ld.Format("{0} {1}~{2} {3}",this.ObstaclePort.Location,this.UnpaddedBorderIntersect,this.VisibilityBorderIntersect,this.OutwardDirection)},Q(l,[{key:"Obstacle",get:function(){return this.ObstaclePort.Obstacle}},{key:"InitialWeight",get:function(){return this.IsOverlapped?Ct.OverlappedWeight:Ct.NormalWeight}},{key:"IsCollinearWithPort",get:function(){return nt.IsPureDirection(J.GetDirections(this.VisibilityBorderIntersect,this.ObstaclePort.Location))}},{key:"IsVertical",get:function(){return ut.IsVertical(this.MaxVisibilitySegment)}},{key:"WantVisibilityIntersection",get:function(){return!this.IsOverlapped&&this.CanExtend&&(!this.ObstaclePort.HasCollinearEntrances||this.IsCollinearWithPort)}},{key:"CanExtend",get:function(){return J.GetDirections(this.MaxVisibilitySegment.start,this.MaxVisibilitySegment.end)!==U.None}},{key:"HasGroupCrossings",get:function(){return null!=this.pointAndCrossingsList&&this.pointAndCrossingsList.Count()>0}}]),l}(),Gc=function(){function l(o,t){this.HasCollinearEntrances=!1,this.VisibilityRectangle=lt.mkEmpty(),this.Port=o,this.Obstacle=t,this.PortEntrances=new Array,this.Location=R.RoundPoint(this.Port.Location)}var s=l.prototype;return s.CreatePortEntrance=function(t,e,r){var i=new Rc(this,t,e,r);this.PortEntrances.push(i),this.VisibilityRectangle.add(i.MaxVisibilitySegment.end),this.HasCollinearEntrances=this.HasCollinearEntrances||i.IsCollinearWithPort},s.ClearVisibility=function(){this.PortEntrances=[]},s.AddToGraph=function(t,e){e&&(this.CenterVertex=t.FindOrAddVertex(this.Location))},s.RemoveFromGraph=function(){this.CenterVertex=null},s.toString=function(){return this.Port+this.Obstacle.toString()},Q(l,[{key:"LocationHasChanged",get:function(){return!R.closeDistEps(this.Location,R.RoundPoint(this.Port.Location))}},{key:"PortCurve",get:function(){return this.Port.Curve}},{key:"PortLocation",get:function(){return this.Port.Location}}]),l}(),Nc=function(){function l(o,t){this.maxVisibilitySegmentsAndCrossings=new Array(4),this.OutOfBoundsDirectionFromGraph=U.None,this.GetVertex(o,t)}var s=l.prototype;return s.GetVertex=function(t,e){this.Vertex=t.FindOrAddVertex(e)},s.AddEdgeToAdjacentEdge=function(t,e,r,i){var h=ut.SegmentIntersectionEP(e,this.Point),c=t.VisGraph.FindVertex(h);return null!=c?this.AddToAdjacentVertex(t,c,r,i):c=t.AddEdgeToTargetEdge(this.Vertex,e,h),this.ExtendEdgeChain(t,c,r,i),c},s.AddToAdjacentVertex=function(t,e,r,i){J.EqualPP(this.Point,e.point)||t.FindOrAddEdge(this.Vertex,e,this.InitialWeight),this.ExtendEdgeChain(t,e,r,i)},s.ExtendEdgeChain=function(t,e,r,i){var h=this.IsOverlapped;h&&(h=t.ObstacleTree.PointIsInsideAnObstaclePD(e.point,r));var c=this.GetSegmentAndCrossings(this.IsOverlapped?e:this.Vertex,r,t);t.ExtendEdgeChainVRLPB(e,i,c[0],c[1],h)},s.GetSegmentAndCrossings=function(t,e,r){var i=nt.ToIndex(e),h=this.maxVisibilitySegmentsAndCrossings[i];if(null==h){var c={pacList:null},f=r.ObstacleTree.CreateMaxVisibilitySegment(t.point,e,c);this.maxVisibilitySegmentsAndCrossings[i]=h=[f,c.pacList]}else J.GetDirections(t.point,h[0].start)===e&&(h[0].start=t.point);return h},s.MaxVisibilityInDirectionForNonOverlappedFreePoint=function(t,e){return this.GetSegmentAndCrossings(this.Vertex,t,e)[0].end},s.AddOobEdgesFromGraphCorner=function(t,e){var r=J.GetDirections(e,this.Vertex.point),i=t.VisGraph.FindVertex(e);t.ConnectVertexToTargetVertex(i,this.Vertex,r&(U.North|U.South),Ct.NormalWeight),t.ConnectVertexToTargetVertex(i,this.Vertex,r&(U.East|U.West),Ct.NormalWeight)},s.RemoveFromGraph=function(){this.Vertex=null},s.toString=function(){return this.Vertex.toString()},Q(l,[{key:"Point",get:function(){return this.Vertex.point}},{key:"InitialWeight",get:function(){return this.IsOverlapped?Ct.OverlappedWeight:Ct.NormalWeight}},{key:"IsOutOfBounds",get:function(){return U.None!==this.OutOfBoundsDirectionFromGraph}}]),l}(),pa=function(){function l(o,t){this.BoundaryWidth=q.distanceEpsilon,this.Group=o,this.DirectionToInside=t}var s=l.prototype;return s.GetInteriorVertexPoint=function(t){return R.RoundPoint(t.add(nt.toPoint(this.DirectionToInside).mul(this.BoundaryWidth)))},s.toString=function(){return $t.Ld.Format("{0} {1}",this.DirectionToInside,this.Group)},l}();pa.BoundaryWidth=q.distanceEpsilon;var ya=function(l){function s(o){var t;return(t=l.call(this)||this).site=o,t}return X(s,l),Q(s,[{key:"Site",get:function(){return this.site}}]),s}(lr),co=function(l){function s(o,t){var e;return(e=l.call(this,t)||this).Obstacle=o,e}return X(s,l),s}(Rn),fo=function(l){function s(o,t){return l.call(this,o,t)||this}return X(s,l),s}(co),Fc=function(){function l(o){this.Coord=o}var s=l.prototype;return s.AddPendingPerpendicularCoord=function(t){null==this.pendingPerpCoords&&(this.pendingPerpCoords=new Array),this.pendingPerpCoords.push(t)},s.ResetForIntersections=function(){this.CurrentSegment=this.FirstSegment},s.TraverseToSegmentContainingPoint=function(t){if(this.CurrentSegment.ContainsPoint(t))return!0;if(!J.Equal(this.Coord,this.IsHorizontal?t.y:t.x)){for(;this.MoveNext(););return!1}for(;;){if((null==this.CurrentSegment.NextSegment||J.GetDirections(this.CurrentSegment.End,t)==J.GetDirections(t,this.CurrentSegment.NextSegment.Start))&&R.closeIntersections(this.CurrentSegment.End,t))return this.CurrentSegment.Update(this.CurrentSegment.Start,t),!0;if(!this.MoveNext())return!1;if(this.CurrentSegment.ContainsPoint(t))return!0;if(J.IsPureLower(t,this.CurrentSegment.Start))return this.CurrentSegment.Update(t,this.CurrentSegment.End),!0}},s.MoveNext=function(){return this.CurrentSegment=this.CurrentSegment.NextSegment,this.HasCurrent},s.PointIsCurrentEndAndNextStart=function(t){return t.equal(this.CurrentSegment.End)&&null!=this.CurrentSegment.NextSegment&&t.equal(this.CurrentSegment.NextSegment.Start)},s.AddPerpendicularCoord=function(t){var e=this.IsHorizontal?new R(t,this.Coord):new R(this.Coord,t);this.TraverseToSegmentContainingPoint(e),this.CurrentSegment.AddSparseVertexCoord(t)},s.toString=function(){return null==this.FirstSegment?"-0- "+this.Coord:this.IsHorizontal?"(H) Y === "+this.Coord:"(V) X === "},s.AppendScanSegment=function(t){null==this.FirstSegment?this.FirstSegment=t:this.CurrentSegment.NextSegment=t,this.CurrentSegment=t},s.AddPendingPerpendicularCoordsToScanSegments=function(){if(null!=this.pendingPerpCoords){this.ResetForIntersections();for(var e,t=C(this.pendingPerpCoords);!(e=t()).done;)this.AddPerpendicularCoord(e.value)}},Q(l,[{key:"IsHorizontal",get:function(){return!this.FirstSegment.IsVertical}},{key:"HasCurrent",get:function(){return null!=this.CurrentSegment}}]),l}(),Iu=function(){function l(o,t){this.CurrentSlotIndex=0,this.vector=[],this.IsHorizontal=t;for(var i,r=C(Array.from(o).sort(function(c,f){return c>f?1:c<f?-1:0}));!(i=r()).done;)this.vector.push(new Fc(i.value))}var s=l.prototype;return s.Item=function(t){return this.vector[t]},s.CreateScanSegment=function(t,e,r,i){this.CurrentSlot.AppendScanSegment(new Ct(t,e,r,i))},s.ScanSegmentsCompleteForCurrentSlot=function(){this.CurrentSlotIndex++},s.ScanSegmentsComplete=function(){for(var e,t=C(this.vector);!(e=t()).done;)e.value.AddPendingPerpendicularCoordsToScanSegments()},s.Items=function(){return this.vector},s.ResetForIntersections=function(){for(var e,t=C(this.vector);!(e=t()).done;)e.value.ResetForIntersections()},s.FindNearest=function(t,e){var r=0,i=this.vector.length-1;if(t<=this.vector[r].Coord)return r;if(t>=this.vector[i].Coord)return i;for(;i-r>2;){var h=r+(i-r>>1),c=this.vector[h];if(t<c.Coord)i=h;else{if(!(t>c.Coord))return h;r=h}}for(r++;r<=i;r++){var f=this.vector[r];if(t<f.Coord)return e>0?r:r-1;if(t===f.Coord)break}return r},s.CreateSparseVerticesAndEdges=function(t){for(var r,e=C(this.vector);!(r=e()).done;){var i=r.value;i.ResetForIntersections();for(var h=i.FirstSegment;null!=h;h=h.NextSegment)h.CreateSparseVerticesAndEdges(t)}},s.GetParallelCoord=function(t){return this.IsHorizontal?t.y:t.x},s.GetPerpendicularCoord=function(t){return this.IsHorizontal?t.x:t.y},s.ConnectAdjoiningSegmentEndpoints=function(){for(var e,t=C(this.vector);!(e=t()).done;){var r=e.value;r.ResetForIntersections();for(var i=r.FirstSegment,h=i.NextSegment;null!=h;h=h.NextSegment){if(h.HasSparsePerpendicularCoords&&i.HasSparsePerpendicularCoords&&h.Start===i.End){var c=this.GetPerpendicularCoord(h.Start);i.AddSparseEndpoint(c),h.AddSparseEndpoint(c)}i=h}}},s.toString=function(){return(this.IsHorizontal?"(H) count":"(V) count === ")+this.vector.length},Q(l,[{key:"Length",get:function(){return this.vector.length}},{key:"CurrentSlot",get:function(){return this.vector[this.CurrentSlotIndex]}}]),l}(),Li=function(l){function s(t,e,r){var i;return(i=l.call(this)||this).InitialObstacle=t,i.ReflectingObstacle=e,i.site=r,i}return X(s,l),s.mk=function(e,r,i){var h=new s(e.ReflectingObstacle,r,i);return h.PreviousSite=e,h},s.prototype.IsStaircaseStep=function(e){return this.InitialObstacle===e},Q(s,[{key:"Site",get:function(){return this.site}}]),s}(lr),xu=function(){function l(){var o=this;this.eventTree=new zo(function(t,e){return o.Compare(t,e)})}var s=l.prototype;return s.Reset=function(t){this.scanDirection=t},s.Enqueue=function(t){this.eventTree.Enqueue(t)},s.Dequeue=function(){return this.eventTree.Dequeue()},s.Compare=function(t,e){if(t===e)return 0;if(null==t)return-1;if(null==e)return 1;var r=this.scanDirection.ComparePerpCoord(t.Site,e.Site);return r||(r=(t instanceof Li?0:1)-(e instanceof Li?0:1))||this.scanDirection.CompareScanCoord(t.Site,e.Site)},Q(l,[{key:"Count",get:function(){return this.eventTree.Count}}]),l}(),Tu=function(){function l(){this.pointCrossingMap=new Ee,this.pointList=new Array}var s=l.prototype;return s.AddIntersection=function(t,e,r){var i=this.pointCrossingMap.get(t);i||(i=new Array,this.pointCrossingMap.set(t,i));for(var h=i.length,c=0;c<h;c++){var f=i[c];if(f.Group===e)return f}var p=new pa(e,r);return i.push(p),p},s.Clear=function(){this.pointCrossingMap.clear()},s.GetOrderedListBetween=function(t,e){if(0===this.pointCrossingMap.size)return null;if(J.ComparePP(t,e)>0){var r=t;t=e,e=r}this.pointList=[];for(var h,i=C(this.pointCrossingMap.keys());!(h=i()).done;){var c=h.value;J.ComparePP(c,t)>=0&&J.ComparePP(c,e)<=0&&this.pointList.push(c)}this.pointList.sort(function(P,L){return P.compareTo(L)});for(var f=new bi,p=this.pointList.length,y=0;y<p;y++){var m=this.pointList[y];f.Add(m,this.pointCrossingMap.get(m))}return f},s.toString=function(){return $t.Ld.Format("{0}",this.pointCrossingMap.size)},l}(),Ou=function(l){function s(o,t,e){var r;return(r=l.call(this,o.ReflectingObstacle,t.Obstacle,e)||this).Side=t,r}return X(s,l),s}(Li),Bc=function(){function l(o){var t=this;this.staleSites=new Array,this.scanDirection=o,this.eventTree=new Ce(function(e,r){return t.CompareBB(e,r)}),this.findFirstPred=function(e){return t.CompareToFindFirstPoint(e.Site)>=0}}var s=l.prototype;return s.Add=function(t){this.eventTree.insert(t)},s.MarkStaleSite=function(t){this.staleSites.push(t)},s.RemoveStaleSites=function(){var t=this.staleSites.length;if(t>0){for(var e=0;e<t;e++)this.RemoveExact(this.staleSites[e]);this.staleSites=[]}},s.RemoveSitesForFlatBottom=function(t,e){for(var r=this.FindFirstInRange(t,e);null!=r;r=this.FindNextInRange(r,e))this.MarkStaleSite(r.item);this.RemoveStaleSites()},s.Find=function(t){return this.FindFirstInRange(t,t)},s.RemoveExact=function(t){var e=this.eventTree.find(t);return null!=e&&e.item.Site===t.Site&&(this.eventTree.deleteNodeInternal(e),!0)},s.FindFirstInRange=function(t,e){this.findFirstPoint=t;var r=this.eventTree.findFirst(this.findFirstPred);return null!=r&&this.Compare(r.item.Site,e)<=0?r:null},s.CompareToFindFirstPoint=function(t){return this.Compare(t,this.findFirstPoint)},s.FindNextInRange=function(t,e){var r=this.eventTree.next(t);return null!=r&&this.Compare(r.item.Site,e)<=0?r:null},s.CompareBB=function(t,e){return this.scanDirection.CompareScanCoord(t.Site,e.Site)},s.Compare=function(t,e){return this.scanDirection.CompareScanCoord(t,e)},l}(),Au=function(l){function s(o,t){return l.call(this,o,t)||this}return X(s,l),s}(co),ku=function(l){function s(o,t){return l.call(this,o,t)||this}return X(s,l),s}(co),Ru=function(l){function s(o,t){return l.call(this,o,t)||this}return X(s,l),s}(co),Gu=function(l){function s(o,t,e){var r;return(r=l.call(this,o.ReflectingObstacle,t.obstacle,e)||this).Side=t,r}return X(s,l),s}(Li),Nu=function(){function l(){}var s=l.prototype;return s.Clear=function(){this.LowNeighbor=null,this.LowOverlapEnd=null,this.GroupSideInterveningBeforeLowNeighbor=null,this.HighNeighbor=null,this.HighOverlapEnd=null,this.GroupSideInterveningBeforeHighNeighbor=null},s.SetSides=function(t,e,r,i){if(ut.IsAscending(t))return this.HighNeighbor=e,this.HighOverlapEnd=r,void(this.GroupSideInterveningBeforeHighNeighbor=i);this.LowNeighbor=e,this.LowOverlapEnd=r,this.GroupSideInterveningBeforeLowNeighbor=i},Q(l,[{key:"LowNeighborSide",get:function(){return null==this.LowNeighbor?null:this.LowNeighbor.item}},{key:"HighNeighborSide",get:function(){return null==this.HighNeighbor?null:this.HighNeighbor.item}}]),l}();function ma(){ma=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var mr=function(){function l(){this.arrayOfSets=new Array}var s=l.prototype;return s.has=function(t){return this.hasxy(t.x,t.y)},s.remove=function(t){if(!(t.x<0||t.x>=this.arrayOfSets.length))return this.arrayOfSets[t.x].delete(t.y)},s.hasxy=function(t,e){if(t<0||t>=this.arrayOfSets.length)return!1;var r=this.arrayOfSets[t];return void 0!==r&&r.has(e)},l.mk=function(t){for(var i,e=new l,r=C(t);!(i=r()).done;)e.add(i.value);return e},s.values=ma().mark(function o(){var t,e,r,i,h;return ma().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t=0;case 1:if(!(t<this.arrayOfSets.length)){f.next=15;break}if(e=this.arrayOfSets[t]){f.next=5;break}return f.abrupt("continue",12);case 5:r=C(e.values());case 6:if((i=r()).done){f.next=12;break}return h=i.value,f.next=10,new Lt(t,h);case 10:f.next=6;break;case 12:t++,f.next=1;break;case 15:case"end":return f.stop()}},o,this)}),s.add=function(t){var e=this.arrayOfSets[t.x];null==e&&(this.arrayOfSets[t.x]=e=new Set),e.add(t.y)},s.addNN=function(t,e){var r=this.arrayOfSets[t];null==r&&(this.arrayOfSets[t]=r=new Set),r.add(e)},s.clear=function(){for(var e,t=C(this.arrayOfSets);!(e=t()).done;){var r=e.value;r&&r.clear()}},l}(),Fu=function(s,o){this.Polyline=s,this.Obstacles=Array.from(o),this.PrimaryObstacle=this.Obstacles[0],Ge.RoundVerticesAndSimplify(this.Polyline)},wa=function(){function l(){}return l.MungeClosestIntersectionInfo=function(o,t,e){var r=t.seg1.boundingBox,i=R.RoundPoint(t.x).clone();return e?new R(l.MungeIntersect(o.x,i.x,r.left,r.right),i.y):new R(i.x,l.MungeIntersect(o.y,i.y,r.bottom,r.top))},l.MungeIntersect=function(o,t,e,r){if(o<t){var i=Math.min(e,r);t<i&&(t=i)}else if(o>t){var h=Math.max(e,r);t>h&&(t=h)}return R.RoundDouble(t)},l}(),Mc=function(){function l(){this.CurrentGroupBoundaryCrossingMap=new Tu,this.overlapPairs=new mr,this.hasOverlaps=!1,this.lookupIntPair=new Lt(-1,-1)}var s=l.prototype;return s.Init=function(t,e,r){this.CreateObstacleListAndOrdinals(t),this.AncestorSets=e,this.CreateRoot(),this.shapeIdToObstacleMap=r},s.CreateObstacleListAndOrdinals=function(t){this.allObstacles=Array.from(t);for(var i,e=Ge.FirstNonSentinelOrdinal,r=C(this.allObstacles);!(i=r()).done;)i.value.Ordinal=e++},s.OrdinalToObstacle=function(t){return this.allObstacles[t-Ge.FirstNonSentinelOrdinal]},s.CreateRoot=function(){this.Root=l.CalculateHierarchy(this.GetAllObstacles()),this.OverlapsExist()&&(this.AccreteClumps(),this.AccreteConvexHulls(),this.GrowGroupsToAccommodateOverlaps(),this.Root=l.CalculateHierarchy(this.GetAllObstacles().filter(function(t){return t.IsPrimaryObstacle})))},s.OverlapsExist=function(){var t=this;return null!=this.Root&&(le(this.Root,this.Root,function(e,r){return t.CheckForInitialOverlaps(e,r)}),this.hasOverlaps)},s.OverlapPairAlreadyFound=function(t,e){return this.lookupIntPair.x=e.Ordinal,this.lookupIntPair.y=t.Ordinal,this.overlapPairs.has(this.lookupIntPair)},s.CheckForInitialOverlaps=function(t,e){if(!this.hasOverlaps){var r={bIsInsideA:!1,aIsInsideB:!1};if(l.ObstaclesIntersect(t,e,r))return void(this.hasOverlaps=!0);!r.aIsInsideB&&!r.bIsInsideA||t.IsGroup&&e.IsGroup||t.IsGroup&&r.bIsInsideA||e.IsGroup&&r.aIsInsideB||(this.hasOverlaps=!0)}},s.AccreteClumps=function(){this.AccumulateObstaclesForClumps(),this.CreateClumps()},s.AccreteConvexHulls=function(){for(;;)if(this.AccumulateObstaclesForConvexHulls(),!this.CreateConvexHulls())return},l.CalculateHierarchy=function(t){return Ht(Array.from(t).map(function(r){return Qt(r,r.VisibilityBoundingBox)}))},s.AccumulateObstaclesForClumps=function(){var t=this;this.overlapPairs.clear();var e=l.CalculateHierarchy(this.GetAllObstacles().filter(function(r){return!r.IsGroup&&r.IsRectangle}));null!=e&&me(e,e,function(r,i){return t.EvaluateOverlappedPairForClump(r,i)})},s.EvaluateOverlappedPairForClump=function(t,e){if(t!==e&&!this.OverlapPairAlreadyFound(t,e)){var r={bIsInsideA:!1,aIsInsideB:!1};!l.ObstaclesIntersect(t,e,r)&&!r.aIsInsideB&&!r.bIsInsideA||this.overlapPairs.add(new Lt(t.Ordinal,e.Ordinal))}},s.AccumulateObstaclesForConvexHulls=function(){var t=this;this.overlapPairs.clear();var e=l.CalculateHierarchy(this.GetAllObstacles().filter(function(r){return r.IsPrimaryObstacle&&!r.IsGroup}));null!=e&&me(e,e,function(r,i){return t.EvaluateOverlappedPairForConvexHull(r,i)})},s.EvaluateOverlappedPairForConvexHull=function(t,e){if(t!==e&&!this.OverlapPairAlreadyFound(t,e)){var r={bIsInsideA:!1,aIsInsideB:!1};!l.ObstaclesIntersect(t,e,r)&&!r.aIsInsideB&&!r.bIsInsideA||!t.IsInConvexHull&&!e.IsInConvexHull&&t.IsRectangle&&e.IsRectangle||(this.overlapPairs.add(new Lt(t.Ordinal,e.Ordinal)),this.AddClumpToConvexHull(t),this.AddClumpToConvexHull(e),this.AddConvexHullToConvexHull(t),this.AddConvexHullToConvexHull(e))}},s.GrowGroupsToAccommodateOverlaps=function(){for(;;)if(this.AccumulateObstaclesForGroupOverlaps(),!this.GrowGroupsToResolveOverlaps())return},s.AccumulateObstaclesForGroupOverlaps=function(){var t=this,e=l.CalculateHierarchy(this.GetAllObstacles().filter(function(i){return i.IsGroup})),r=l.CalculateHierarchy(this.GetAllObstacles().filter(function(i){return i.IsPrimaryObstacle}));null==e||null==r||me(e,r,function(i,h){return t.EvaluateOverlappedPairForGroup(i,h)})},s.EvaluateOverlappedPairForGroup=function(t,e){if(t!==e&&!this.OverlapPairAlreadyFound(t,e)){var r={bIsInsideA:!1,aIsInsideB:!1},i=l.ObstaclesIntersect(t,e,r);if(i||r.aIsInsideB||r.bIsInsideA){if(t.IsRectangle&&e.IsRectangle)return void(e.IsGroup||(r.aIsInsideB||l.FirstRectangleContainsACornerOfTheOther(e.VisibilityBoundingBox,t.VisibilityBoundingBox))&&(e.OverlapsGroupCorner=!0));!i&&(e.IsGroup||r.bIsInsideA)||this.overlapPairs.add(new Lt(t.Ordinal,e.Ordinal))}}},l.FirstRectangleContainsACornerOfTheOther=function(t,e){return t.contains(e.leftBottom)||t.contains(e.leftTop)||t.contains(e.rightTop)||t.contains(e.rightBottom)},l.FirstPolylineStartIsInsideSecondPolyline=function(t,e){return K.PointRelativeToCurveLocation(t.start,e)!==ht.Outside},s.AddClumpToConvexHull=function(t){if(t.isOverlapped){for(var r,e=C(t.clump.filter(function(h){return h.Ordinal!==t.Ordinal}));!(r=e()).done;)this.overlapPairs.add(new Lt(t.Ordinal,r.value.Ordinal));t.clump=[]}},s.AddConvexHullToConvexHull=function(t){if(t.IsInConvexHull){for(var r,e=C(t.ConvexHull.Obstacles.filter(function(h){return h.Ordinal!==t.Ordinal}));!(r=e()).done;)this.overlapPairs.add(new Lt(t.Ordinal,r.value.Ordinal));t.ConvexHull.Obstacles=[]}},s.CreateClumps=function(){for(var h,t=this,i=C(on(eo(Array.from(this.overlapPairs.values()))));!(h=i()).done;){var c=h.value;if(1!==c.length)for(var y,f=c.map(function(P){return t.OrdinalToObstacle(P)}),p=C(f);!(y=p()).done;)y.value.clump=f}},s.CreateConvexHulls=function(){for(var h,t=!1,i=C(on(eo(Array.from(this.overlapPairs.values()))));!(h=i()).done;){var c=h.value;if(1!==c.length){t=!0;for(var P,f=c.map(this.OrdinalToObstacle),p=ai(f,function(E){return E.VisibilityPolyline}),y=new Fu(Rr.createConvexHullAsClosedPolyline(p),f),m=C(f);!(P=m()).done;)P.value.SetConvexHull(y)}}return t},s.GrowGroupsToResolveOverlaps=function(){for(var r,t=!1,e=C(this.overlapPairs.values());!(r=e()).done;){var i=r.value;t=!0;var h=this.OrdinalToObstacle(i.x),c=this.OrdinalToObstacle(i.y);l.ResolveGroupAndGroupOverlap(h,c)||l.ResolveGroupAndObstacleOverlap(h,c)}return this.overlapPairs.clear(),t},l.ResolveGroupAndGroupOverlap=function(t,e){return!!e.IsGroup&&(t.VisibilityPolyline.boundingBox.area>e.VisibilityPolyline.boundingBox.area?l.ResolveGroupAndObstacleOverlap(t,e):l.ResolveGroupAndObstacleOverlap(e,t),!0)},l.ResolveGroupAndObstacleOverlap=function(t,e){var r=e.looseVisibilityPolyline;l.GrowGroupAroundLoosePolyline(t,r);for(var i={bIsInsideA:!1,aIsInsideB:!1};l.ObstaclesIntersect(e,t,i)||!i.aIsInsideB;)r=Ge.CreateLoosePolyline(r),l.GrowGroupAroundLoosePolyline(t,r)},l.GrowGroupAroundLoosePolyline=function(t,e){var r=Array.from(t.VisibilityPolyline).concat(Array.from(e));t.SetConvexHull(new Fu(Rr.createConvexHullAsClosedPolyline(r),[t]))},l.ObstaclesIntersect=function(t,e,r){return K.CurvesIntersect(t.VisibilityPolyline,e.VisibilityPolyline)?(r.aIsInsideB=!1,r.bIsInsideA=!1,!0):(r.aIsInsideB=l.FirstPolylineStartIsInsideSecondPolyline(t.VisibilityPolyline,e.VisibilityPolyline),r.bIsInsideA=!r.aIsInsideB&&l.FirstPolylineStartIsInsideSecondPolyline(e.VisibilityPolyline,t.VisibilityPolyline),!(t.IsRectangle&&e.IsRectangle||!l.ObstaclesAreCloseEnoughToBeConsideredTouching(t,e,r.aIsInsideB,r.bIsInsideA)||(r.aIsInsideB=!1,r.bIsInsideA=!1,0)))},l.ObstaclesAreCloseEnoughToBeConsideredTouching=function(t,e,r,i){if(!r&&!i)return K.CurvesIntersect(t.looseVisibilityPolyline,e.VisibilityPolyline);for(var p,c=r?e.VisibilityPolyline:t.VisibilityPolyline,f=C(r?t.looseVisibilityPolyline:e.looseVisibilityPolyline);!(p=f()).done;){var y=p.value;if(K.PointRelativeToCurveLocation(y,c)===ht.Outside){var m=K.ClosestPoint(c,y);if(!R.closeIntersections(y,m))return!0}}return!1},s.AdjustSpatialAncestors=function(){var t=this;if(this.SpatialAncestorsAdjusted)return!1;for(var r,e=C(this.GetAllGroups());!(r=e()).done;)for(var f,i=r.value,c=C(this.Root.GetNodeItemsIntersectingRectangle(i.VisibilityBoundingBox));!(f=c()).done;){var p=f.value;if(p!==i&&K.ClosedCurveInteriorsIntersect(p.VisibilityPolyline,i.VisibilityPolyline)){if(p.IsInConvexHull)for(var m,y=C(p.ConvexHull.Obstacles);!(m=y()).done;)this.AncestorSets.get(m.value.InputShape).add(i.InputShape);this.AncestorSets.get(p.InputShape).add(i.InputShape)}}for(var T,L=new Array,E=function(){for(var F,x=T.value,B=x.VisibilityBoundingBox,M=C(L=L.concat(Array.from(t.AncestorSets.get(x.InputShape)).filter(function(z){return!B.intersects(t.shapeIdToObstacleMap.get(z).VisibilityBoundingBox)})));!(F=M()).done;){var A=F.value;t.AncestorSets.get(x.InputShape).delete(A)}L=[]},S=C(this.Root.GetAllLeaves());!(T=S()).done;)E();return this.SpatialAncestorsAdjusted=!0,!0},s.GetAllGroups=function(){return this.GetAllObstacles().filter(function(t){return t.IsGroup})},s.Clear=function(){this.Root=null,this.AncestorSets=null},s.CreateMaxVisibilitySegment=function(t,e,r){var i=ut.RectangleBorderIntersect(this.GraphBox,t,e);if(J.GetDirections(t,i)===U.None)return r.pacList=null,Z.mkPP(t,t);var h=this.RestrictSegmentWithObstacles(t,i);return r.pacList=this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(h.start,h.end),h},s.GetAllObstacles=function(){return this.allObstacles},s.GetAllPrimaryObstacles=function(){return this.Root.GetAllLeaves()},s.IntersectionIsInsideAnotherObstacle=function(t,e,r,i){return this.insideHitTestIgnoreObstacle1=e,this.insideHitTestIgnoreObstacle2=t,this.insideHitTestScanDirection=i,null!=this.Root.FirstHitNodeWithPredicate(r,this.InsideObstacleHitTest.bind(this))},s.PointIsInsideAnObstaclePD=function(t,e){return this.PointIsInsideAnObstacle(t,Zt.GetInstance(e))},s.PointIsInsideAnObstacle=function(t,e){return this.insideHitTestIgnoreObstacle1=null,this.insideHitTestIgnoreObstacle2=null,this.insideHitTestScanDirection=e,null!=this.Root.FirstHitNodeWithPredicate(t,this.InsideObstacleHitTest.bind(this))},s.InsideObstacleHitTest=function(t,e){if(e===this.insideHitTestIgnoreObstacle1||e===this.insideHitTestIgnoreObstacle2||e.IsGroup||!ut.PointIsInRectangleInterior(t,e.VisibilityBoundingBox))return Ft.Continue;var r=ut.RectangleBorderIntersect(e.VisibilityBoundingBox,t,this.insideHitTestScanDirection.dir).add(this.insideHitTestScanDirection.DirectionAsPoint),i=ut.RectangleBorderIntersect(e.VisibilityBoundingBox,t,this.insideHitTestScanDirection.OppositeDirection).sub(this.insideHitTestScanDirection.DirectionAsPoint),h=Z.mkPP(i,r),c=K.getAllIntersections(h,e.VisibilityPolyline,!0);if(2===c.length){var f=R.RoundPoint(c[0].x),p=R.RoundPoint(c[1].x);if(!J.EqualPP(t,f)&&!J.EqualPP(t,p)&&t.compareTo(f)!==t.compareTo(p)&&!dt(Math.floor(c[0].par1),Math.floor(c[1].par1)))return Ft.Stop}return Ft.Continue},s.SegmentCrossesAnObstacle=function(t,e){this.stopAtGroups=!0,this.wantGroupCrossings=!1;var r=this.RestrictSegmentPrivate(t,e);return!J.EqualPP(r.end,e)},s.SegmentCrossesANonGroupObstacle=function(t,e){this.stopAtGroups=!1,this.wantGroupCrossings=!1;var r=this.RestrictSegmentPrivate(t,e);return!J.EqualPP(r.end,e)},s.RestrictSegmentWithObstacles=function(t,e){return this.stopAtGroups=!1,this.wantGroupCrossings=!0,this.RestrictSegmentPrivate(t,e)},s.RestrictSegmentPrivate=function(t,e){return this.GetRestrictedIntersectionTestSegment(t,e),this.currentRestrictedRay=Z.mkPP(t,e),this.restrictedRayLengthSquared=t.sub(e).lengthSquared,this.CurrentGroupBoundaryCrossingMap.Clear(),this.RecurseRestrictRayWithObstacles(this.Root),this.currentRestrictedRay},s.GetRestrictedIntersectionTestSegment=function(t,e){var r=J.GetDirections(t,e),h=U.West===r?this.GraphBox.left:U.East===r?this.GraphBox.right:e.x,f=U.South===r?this.GraphBox.bottom:U.North===r?this.GraphBox.top:t.y;this.restrictedIntersectionTestSegment=Z.mkPP(new R(U.West===r?this.GraphBox.right:U.East===r?this.GraphBox.left:t.x,U.South===r?2*this.GraphBox.top:U.North===r?this.GraphBox.bottom:t.y),new R(h,f))},s.RecurseRestrictRayWithObstacles=function(t){if(ut.RectangleInteriorsIntersect(this.currentRestrictedRay.boundingBox,t.irect)){var e=t.UserData;if(null!=e){var r=K.getAllIntersections(this.restrictedIntersectionTestSegment,e.VisibilityPolyline,!0);return!e.IsGroup||this.stopAtGroups?void this.LookForCloserNonGroupIntersectionToRestrictRay(r):void(this.wantGroupCrossings&&this.AddGroupIntersectionsToRestrictedRay(e,r))}this.RecurseRestrictRayWithObstacles(t.Left),this.RecurseRestrictRayWithObstacles(t.Right)}},s.LookForCloserNonGroupIntersectionToRestrictRay=function(t){for(var f,e=0,r=null,i=this.restrictedRayLengthSquared,h=J.GetDirections(this.restrictedIntersectionTestSegment.start,this.restrictedIntersectionTestSegment.end),c=C(t);!(f=c()).done;){var p=f.value,y=R.RoundPoint(p.x),m=J.GetDirections(this.currentRestrictedRay.start,y);if(m!==nt.OppositeDir(h)){if(e++,U.None===m){i=0,r=p;continue}var P=y.sub(this.currentRestrictedRay.start).lengthSquared;if(P<i){if(p.x.sub(this.currentRestrictedRay.start).lengthSquared<q.squareOfDistanceEpsilon)continue;i=P,r=p}}}if(null!=r){if(1===e){var E=R.RoundPoint(r.x);if(R.closeIntersections(E,this.currentRestrictedRay.start)||R.closeIntersections(E,this.currentRestrictedRay.end))return}this.restrictedRayLengthSquared=i,this.currentRestrictedRay.end=wa.MungeClosestIntersectionInfo(this.currentRestrictedRay.start,r,!ut.IsVerticalPP(this.currentRestrictedRay.start,this.currentRestrictedRay.end))}},s.AddGroupIntersectionsToRestrictedRay=function(t,e){for(var i,r=C(e);!(i=r()).done;){var h=i.value,c=R.RoundPoint(h.x);if(!(c.sub(this.currentRestrictedRay.start).lengthSquared>this.restrictedRayLengthSquared)){var p=J.GetDirections(this.currentRestrictedRay.start,this.currentRestrictedRay.end),P=p;nt.VectorDirection(h.seg1.derivative(h.par1))&nt.RotateRight(p)&&(P=nt.OppositeDir(P)),this.CurrentGroupBoundaryCrossingMap.AddIntersection(c,t,P)}}},Q(l,[{key:"GraphBox",get:function(){return this.Root.irect}}]),l}(),Vc=function(){function l(o,t){var e=this;this.scanDirection=o,this.SideTree=new Ce(function(r,i){return e.Compare(r,i)}),this.linePositionAtLastInsertOrRemove=t}var s=l.prototype;return s.Insert=function(t,e){return this.linePositionAtLastInsertOrRemove=e,this.SideTree.insert(t)},s.Remove=function(t,e){this.linePositionAtLastInsertOrRemove=e,this.SideTree.remove(t)},s.Find=function(t){return-1===this.scanDirection.ComparePerpCoord(this.linePositionAtLastInsertOrRemove,t.Start)?null:this.SideTree.find(t)},s.NextLowB=function(t){return this.NextLowR(this.Find(t))},s.NextLowR=function(t){return this.SideTree.previous(t)},s.NextHighB=function(t){return this.NextHighR(this.Find(t))},s.NextHighR=function(t){return this.SideTree.next(t)},s.Next=function(t,e){return ut.IsAscending(t)?this.SideTree.next(e):this.SideTree.previous(e)},s.Lowest=function(){return this.SideTree.treeMinimum()},s.Compare=function(t,e){if(t.Obstacle===e.Obstacle)return t===e?0:t instanceof He?-1:1;var r=go.ScanLineIntersectSidePBS(this.linePositionAtLastInsertOrRemove,t,this.scanDirection),i=go.ScanLineIntersectSidePBS(this.linePositionAtLastInsertOrRemove,e,this.scanDirection),h=r.compareTo(i);return 0===h&&(h=function(l,s){return(l?1:0)-(s?1:0)}(t instanceof He,e instanceof He),0===h&&(h=It(t.Obstacle.Ordinal,e.Obstacle.Ordinal))),h},Q(l,[{key:"Count",get:function(){return this.SideTree.count}}]),l}(),vo=function(){function l(o){var t=this;this.lookupSegment=Ct.mk(new R(0,0),new R(0,1)),this.ScanDirection=o,this.segmentTree=new Ce(function(e,r){return t.Compare(e,r)}),this.findIntersectorPred=function(e){return t.CompareIntersector(e)},this.findPointPred=function(e){return t.CompareToPoint(e)}}var s=l.prototype;return s.InsertUnique=function(t){return this.AssertValidSegmentForInsertion(t),this.segmentTree.find(t)??this.segmentTree.insert(t)},s.AssertValidSegmentForInsertion=function(t){},s.Remove=function(t){this.segmentTree.remove(t)},s.Find=function(t,e){this.lookupSegment.Update(t,e);var r=this.segmentTree.find(this.lookupSegment);return null!=r&&J.EqualPP(r.item.End,e)?r.item:null},s.FindLowestIntersector=function(t,e){var r=this.FindLowestIntersectorNode(t,e);return null!=r?r.item:null},s.FindLowestIntersectorNode=function(t,e){this.lookupSegment.Update(t,t);var r=this.segmentTree.findLast(this.findIntersectorPred);if(J.EqualPP(t,e))null!=r&&this.ScanDirection.Compare(r.item.End,t)<0&&(r=null);else for(this.lookupSegment.Update(t,e);null!=r&&!r.item.IntersectsSegment(this.lookupSegment);){if(this.ScanDirection.Compare(r.item.Start,e)>0)return null;r=this.segmentTree.next(r)}return r},s.FindHighestIntersector=function(t,e){this.lookupSegment.Update(e,e);var r=this.segmentTree.findLast(this.findIntersectorPred);if(J.EqualPP(t,e))null!=r&&this.ScanDirection.Compare(r.item.End,t)<0&&(r=null);else for(this.lookupSegment.Update(t,e);null!=r&&!r.item.IntersectsSegment(this.lookupSegment);){if(this.ScanDirection.Compare(r.item.End,t)<0)return null;r=this.segmentTree.previous(r)}return null!=r?r.item:null},s.CompareIntersector=function(t){return this.ScanDirection.Compare(t.Start,this.lookupSegment.Start)<=0},s.FindSegmentContainingPoint=function(t,e){return this.FindSegmentOverlappingPoints(t,t,e)},s.FindSegmentOverlappingPoints=function(t,e,r){this.lookupSegment.Update(t,e);var i=this.segmentTree.findFirst(this.findPointPred);if(null!=i){var h=i.item;if(this.ScanDirection.Compare(h.Start,e)<=0)return h}return null},s.CompareToPoint=function(t){return this.ScanDirection.Compare(t.End,this.lookupSegment.Start)>=0},s.MergeAndRemoveNextNode=function(t,e){return-1===this.ScanDirection.Compare(t.End,e.item.End)&&t.Update(t.Start,e.item.End),t.MergeGroupBoundaryCrossingList(e.item.GroupBoundaryPointAndCrossingsList),this.segmentTree.deleteNodeInternal(e),this.segmentTree.find(t)},s.MergeSegments=function(){if(!(this.segmentTree.count<2))for(var t=this.segmentTree.treeMinimum(),e=this.segmentTree.next(t);null!=e;e=this.segmentTree.next(t))switch(this.ScanDirection.Compare(e.item.Start,t.item.End)){case 1:t=e;break;case 0:e.item.IsOverlapped===t.item.IsOverlapped?t=this.MergeAndRemoveNextNode(t.item,e):(t.item.NeedEndOverlapVertex=!0,e.item.NeedStartOverlapVertex=!0,t=e);break;default:if(t.item.IsOverlapped!==e.item.IsOverlapped){if(t.item.IsOverlapped)t.item.Start===e.item.Start?t=this.MergeAndRemoveNextNode(e.item,t):(t.item.Update(t.item.Start,e.item.Start),t=e);else if(t.item.End===e.item.End)t=this.MergeAndRemoveNextNode(t.item,e);else{var i=e.item,h=t.item;this.segmentTree.deleteNodeInternal(e),i.Update(h.End,i.End),this.segmentTree.insert(i),i.TrimGroupBoundaryCrossingList(),t=this.segmentTree.find(h)}break}t=this.MergeAndRemoveNextNode(t.item,e)}},s.Compare=function(t,e){if(t===e)return 0;if(null==t)return-1;if(null==e)return 1;var r=this.ScanDirection.Compare(t.Start,e.Start);return 0===r&&(r=-1*this.ScanDirection.Compare(t.End,e.End)),r},Q(l,[{key:"Segments",get:function(){return this.segmentTree.allNodes()}}]),l}(),Dc=function(l){function s(t){return l.call(this,t)||this}X(s,l);var o=s.prototype;return o.SetVertexEntry=function(e){null==this.VertexEntries&&(this.VertexEntries=new Array(4)),this.VertexEntries[nt.ToIndex(e.Direction)]=e},o.RemoveVertexEntries=function(){this.VertexEntries=null},s}(Ds),go=function(){function l(o){this.ObstacleTree=new Mc,this.CurrentGroupBoundaryCrossingMap=new Tu,this.LowNeighborSides=new Nu,this.HighNeighborSides=new Nu,this.ScanDirection=Zt.HorizontalInstance,this.eventQueue=new xu,this.HorizontalScanSegments=new vo(Zt.HorizontalInstance),this.VerticalScanSegments=new vo(Zt.VerticalInstance),this.wantReflections=o}l.NewVisibilityGraph=function(){var t=new _t;return t.VertexFactory=function(e){return new Dc(e)},t};var s=l.prototype;return s.GenerateVisibilityGraph=function(){if(null!=this.ObstacleTree.Root){this.InitializeEventQueue(Zt.HorizontalInstance);var t=Ge.FirstSentinelOrdinal,e=new R(this.ObstacleTree.GraphBox.left-l.SentinelOffset,this.ObstacleTree.GraphBox.bottom-l.SentinelOffset),r=new R(this.ObstacleTree.GraphBox.left-l.SentinelOffset,this.ObstacleTree.GraphBox.top+l.SentinelOffset),i=Ge.CreateSentinel(e,r,this.ScanDirection,t++);this.scanLine.Insert(i.ActiveHighSide,this.ObstacleTree.GraphBox.leftBottom),e=new R(this.ObstacleTree.GraphBox.right+l.SentinelOffset,this.ObstacleTree.GraphBox.bottom-l.SentinelOffset),r=new R(this.ObstacleTree.GraphBox.right+l.SentinelOffset,this.ObstacleTree.GraphBox.top+l.SentinelOffset),i=Ge.CreateSentinel(e,r,this.ScanDirection,t++),this.scanLine.Insert(i.ActiveLowSide,this.ObstacleTree.GraphBox.leftBottom),this.ProcessEvents(),this.InitializeEventQueue(Zt.VerticalInstance),e=new R(this.ObstacleTree.GraphBox.left-l.SentinelOffset,this.ObstacleTree.GraphBox.bottom-l.SentinelOffset),r=new R(this.ObstacleTree.GraphBox.right+l.SentinelOffset,this.ObstacleTree.GraphBox.bottom-l.SentinelOffset),i=Ge.CreateSentinel(e,r,this.ScanDirection,t++),this.scanLine.Insert(i.ActiveHighSide,this.ObstacleTree.GraphBox.leftBottom),e=new R(this.ObstacleTree.GraphBox.left-l.SentinelOffset,this.ObstacleTree.GraphBox.top+l.SentinelOffset),r=new R(this.ObstacleTree.GraphBox.right+l.SentinelOffset,this.ObstacleTree.GraphBox.top+l.SentinelOffset),i=Ge.CreateSentinel(e,r,this.ScanDirection,t),this.scanLine.Insert(i.ActiveLowSide,this.ObstacleTree.GraphBox.leftBottom),this.ProcessEvents()}},l.ScanLineIntersectSidePBS=function(t,e,r){var i=e.Direction,h=e.Start.x,c=e.Start.y;return r.IsHorizontal?(h=wa.MungeIntersect(t.x,h+=i.x/i.y*(t.y-e.Start.y),e.Start.x,e.End.x),c=t.y):(h=t.x,c=wa.MungeIntersect(t.y,c+=i.y/i.x*(t.x-e.Start.x),e.Start.y,e.End.y)),new R(h,c)},s.GetOpenVertex=function(t){for(var e=t.startPoint,r=this.TraversePolylineForEvents(e),i=this.PointCompare(r.point,e.point);;r=this.TraversePolylineForEvents(r)){var h=this.PointCompare(r.point,e.point);if(h<=0)e=r;else if(h>0&&i<=0)break;i=h}return e},s.TraversePolylineForEvents=function(t){return this.ScanDirection.IsHorizontal?t.nextOnPolyline:t.prevOnPolyline},s.InitializeEventQueue=function(t){this.ScanDirection=t,this.eventQueue.Reset(this.ScanDirection),this.EnqueueBottomVertexEvents(),this.scanLine=new Vc(this.ScanDirection,this.ObstacleTree.GraphBox.leftBottom),this.lookaheadScan=new Bc(this.ScanDirection)},s.EnqueueBottomVertexEvents=function(){for(var e,t=C(this.ObstacleTree.GetAllPrimaryObstacles());!(e=t()).done;){var r=e.value,i=this.GetOpenVertex(r.VisibilityPolyline);this.eventQueue.Enqueue(new fo(r,i))}},s.IsFlat=function(t){return this.ScanDirection.IsFlatS(t)},s.IsPerpendicular=function(t){return this.ScanDirection.IsPerpendicularS(t)},s.ScanLineIntersectSide=function(t,e){return l.ScanLineIntersectSidePBS(t,e,this.ScanDirection)},s.SideReflectsUpward=function(t){return t instanceof He?this.ScanDirection.Coord(t.End)>this.ScanDirection.Coord(t.Start):this.ScanDirection.Coord(t.End)<this.ScanDirection.Coord(t.Start)},s.SideReflectsDownward=function(t){return t instanceof He?this.ScanDirection.Coord(t.End)<this.ScanDirection.Coord(t.Start):this.ScanDirection.Coord(t.End)>this.ScanDirection.Coord(t.Start)},s.StoreLookaheadSite=function(t,e,r,i){if(this.wantReflections&&!this.IsPerpendicular(e)){if(!i&&!ut.PointIsInRectangleInterior(r,e.Obstacle.VisibilityBoundingBox))return;this.SideReflectsUpward(e)&&null==this.lookaheadScan.Find(r)&&this.lookaheadScan.Add(new Li(t,e.Obstacle,r))}},s.LoadReflectionEvents=function(t){this.LoadReflectionEventsBB(t,t)},s.LoadReflectionEventsBB=function(t,e){if(null!=t&&!this.SideReflectsUpward(t)&&!this.IsPerpendicular(t)){var r=lt.mkPP(t.Start,t.End),i=lt.mkPP(e.Start,e.End);if(!(this.ScanDirection.IsHorizontal?!r.intersectsOnX(i):!r.intersectsOnY(i))){for(var h=lt.intersect(r,i),f=h.rightTop,p=this.lookaheadScan.FindFirstInRange(h.leftBottom,f);null!=p;){var y=l.ScanLineIntersectSidePBS(p.item.Site,t,this.ScanDirection.PerpendicularInstance);this.ScanDirection.ComparePerpCoord(y,p.item.Site)>0?this.AddReflectionEvent(p.item,t,y):p.item.ReflectingObstacle!==t.Obstacle&&this.lookaheadScan.MarkStaleSite(p.item),p=this.lookaheadScan.FindNextInRange(p,f)}this.lookaheadScan.RemoveStaleSites()}}},s.AddPerpendicularReflectionSegment=function(t,e,r){if(this.lookaheadScan.RemoveExact(t.PreviousSite)){if(null==e)return!1;if(t.PreviousSite.IsStaircaseStep(t.ReflectingObstacle)){if(!ut.PointIsInRectangleInterior(t.Site,t.ReflectingObstacle.VisibilityBoundingBox)||!this.InsertPerpendicularReflectionSegment(t.PreviousSite.Site,t.Site))return!1;if(null!=r&&t.IsStaircaseStep(r.Obstacle))return this.ScanLineCrossesObstacle(t.Site,r.Obstacle)}}return!1},s.AddParallelReflectionSegment=function(t,e,r,i){var h=this.ScanLineIntersectSide(i.Site,e??r),c=null!=e?h:i.Site,f=null!=e?i.Site:h;return null==e?e=this.scanLine.NextLowB(r).item:r=this.scanLine.NextHighB(e).item,this.InsertParallelReflectionSegment(c,f,t,e,r,i)},s.AddReflectionEvent=function(t,e,r){this.eventQueue.Enqueue(null!=e?new Gu(t,e,r):new Ou(t,e,r))},s.AddSideToScanLine=function(t,e){var r=this.scanLine.Insert(t,e);return this.LoadReflectionEvents(t),r},s.RemoveSideFromScanLine=function(t,e){this.scanLine.Remove(t.item,e)},s.PointCompare=function(t,e){return this.ScanDirection.Compare(t,e)},s.Clear=function(){this.ObstacleTree.Clear(),this.eventQueue=new xu,this.HorizontalScanSegments=new vo(Zt.HorizontalInstance),this.VerticalScanSegments=new vo(Zt.VerticalInstance),this.VisibilityGraph=null},s.ProcessEvents=function(){for(;this.eventQueue.Count>0;){var t=this.eventQueue.Dequeue();t instanceof fo?this.ProcessEventO(t):t instanceof Au?this.ProcessEventLB(t):t instanceof ku?this.ProcessEventHB(t):t instanceof Ru?this.ProcessEventCV(t):t instanceof Gu?this.ProcessEventLR(t):t instanceof Ou?this.ProcessEventHR(t):this.ProcessCustomEvent(t),this.LowNeighborSides.Clear(),this.HighNeighborSides.Clear()}},s.ProcessCustomEvent=function(t){},s.ScanLineCrossesObstacle=function(t,e){return this.ScanDirection.ComparePerpCoord(t,e.VisibilityBoundingBox.leftBottom)>0&&this.ScanDirection.ComparePerpCoord(t,e.VisibilityBoundingBox.rightTop)<0},s.FindInitialNeighborSides=function(t,e){e.lowNborSideNode=this.scanLine.NextLowR(t),e.highNborSideNode=this.scanLine.NextHighR(t)},s.FindNeighborsBRR=function(t,e,r){this.LowNeighborSides.Clear(),this.HighNeighborSides.Clear(),this.FindNeighbors(t,e,this.LowNeighborSides),this.FindNeighbors(t,r,this.HighNeighborSides)},s.FindNeighbors=function(t,e,r){var i=t instanceof fo?e.item.Start:e.item.End,h={lowNborSideNode:null,highNborSideNode:null};this.FindInitialNeighborSides(e,h),this.SkipToNeighbor(this.ScanDirection.OppositeDirection,e.item,i,h.lowNborSideNode,r),this.SkipToNeighbor(this.ScanDirection.Dir,e.item,i,h.highNborSideNode,r)},s.SkipToNeighbor=function(t,e,r,i,h){for(var c=null,f=null;;i=this.scanLine.Next(t,i))if(i.item.Obstacle!==e.Obstacle){if(i.item.Obstacle.IsGroup){this.ProcessGroupSideEncounteredOnTraversalToNeighbor(i,r,t)&&null==f&&(f=i.item);continue}if(i.item instanceof Ci===ut.IsAscending(t)){this.ScanLineCrossesObstacle(r,i.item.Obstacle)&&(c=i,f=null);continue}break}h.SetSides(t,i,c,f)},s.ProcessGroupSideEncounteredOnTraversalToNeighbor=function(t,e,r){if(!this.ScanLineCrossesObstacle(e,t.item.Obstacle))return!1;var i=t.item instanceof He===ut.IsAscending(r)?r:nt.OppositeDir(r),h=this.ScanLineIntersectSide(e,t.item);return this.CurrentGroupBoundaryCrossingMap.AddIntersection(h,t.item.Obstacle,i),!0},s.FindNeighborsAndProcessVertexEvent=function(t,e,r){this.CurrentGroupBoundaryCrossingMap.Clear(),this.FindNeighborsBRR(r,t,e),this.ProcessVertexEvent(t,e,r),this.CurrentGroupBoundaryCrossingMap.Clear()},s.ProcessEventO=function(t){var e,r,i=t.Obstacle;i.CreateInitialSides(t.Vertex,this.ScanDirection),this.AddSideToScanLine(i.ActiveLowSide,t.Site);var h=this.AddSideToScanLine(i.ActiveHighSide,t.Site),c=this.scanLine.Find(i.ActiveLowSide);this.FindNeighborsAndProcessVertexEvent(c,h,t);var f=null!==(e=this.LowNeighborSides.GroupSideInterveningBeforeLowNeighbor)&&void 0!==e?e:this.LowNeighborSides.LowNeighborSide;this.SideReflectsUpward(f)&&this.LoadReflectionEvents(i.ActiveLowSide);var p=null!==(r=this.HighNeighborSides.GroupSideInterveningBeforeHighNeighbor)&&void 0!==r?r:this.HighNeighborSides.HighNeighborSide;if(this.SideReflectsUpward(p)&&this.LoadReflectionEvents(i.ActiveHighSide),i.ActiveHighSide.Start!==i.ActiveLowSide.Start){var y=new Ci(i,t.Vertex,this.ScanDirection);this.lookaheadScan.RemoveSitesForFlatBottom(y.Start,y.End)}this.EnqueueLowBendVertexEvent(i.ActiveLowSide),this.EnqueueHighBendOrCloseVertexEvent(i.ActiveHighSide)},s.ProcessEventLB=function(t){var e=t.Obstacle,r=new He(e,t.Vertex,this.ScanDirection);this.ScanDirection.ComparePerpCoord(r.End,r.Start)>0&&(this.RemoveSideFromScanLine(this.scanLine.Find(e.ActiveLowSide),t.Site),this.AddSideToScanLine(r,t.Site),e.ActiveLowSide=r,this.EnqueueLowBendVertexEvent(r))},s.EnqueueLowBendVertexEvent=function(t){this.eventQueue.Enqueue(new Au(t.Obstacle,t.EndVertex))},s.ProcessEventHB=function(t){var e=t.Obstacle,r=new Ci(e,t.Vertex,this.ScanDirection);this.RemoveSideFromScanLine(this.scanLine.Find(e.ActiveHighSide),t.Site);var i=this.AddSideToScanLine(r,t.Site);if(e.ActiveHighSide=r,this.EnqueueHighBendOrCloseVertexEvent(e.ActiveHighSide),this.wantReflections&&this.ScanDirection.IsHorizontal&&r.Start.x===e.VisibilityBoundingBox.right&&this.SideReflectsUpward(r)){var h=this.scanLine.NextHighR(i);h.item instanceof He&&this.SideReflectsDownward(h.item)&&(!e.isOverlapped||!this.ObstacleTree.PointIsInsideAnObstacle(r.Start,this.ScanDirection))&&(this.StoreLookaheadSite(h.item.Obstacle,r,r.Start,!0),this.LoadReflectionEvents(h.item))}},s.EnqueueHighBendOrCloseVertexEvent=function(t){var e=t.Obstacle;this.ScanDirection.ComparePerpCoord((this.ScanDirection.IsHorizontal?t.EndVertex.prevOnPolyline:t.EndVertex.nextOnPolyline).point,t.End)>0?this.eventQueue.Enqueue(new ku(e,t.EndVertex)):this.eventQueue.Enqueue(new Ru(e,t.EndVertex))},s.CreateCloseEventSegmentsAndFindNeighbors=function(t){var e=t.Obstacle,r=this.scanLine.Find(e.ActiveLowSide),i=this.scanLine.Find(e.ActiveHighSide);if(1===this.scanLine.Compare(e.ActiveLowSide,e.ActiveHighSide)){var h=r;r=i,i=h}if(this.FindNeighborsAndProcessVertexEvent(r,i,t),this.wantReflections&&e.isOverlapped)for(var c=this.scanLine.NextHighR(r);c.item!==i.item;c=this.scanLine.NextHighR(c))this.LoadReflectionEvents(c.item);this.scanLine.Remove(e.ActiveLowSide,t.Site),this.scanLine.Remove(e.ActiveHighSide,t.Site)},s.ProcessEventCV=function(t){this.CreateCloseEventSegmentsAndFindNeighbors(t);var r=this.HighNeighborSides.HighNeighbor.item,i=t.Obstacle;this.LoadReflectionEvents(this.LowNeighborSides.LowNeighbor.item),this.LoadReflectionEvents(r),i.Close()},s.ProcessEventLR=function(t){var e=t.Side.Obstacle,r=this.scanLine.NextLowB(t.Side).item;this.AddPerpendicularReflectionSegment(t,t.Side,r)&&this.AddParallelReflectionSegment(e,r,null,t)&&this.LoadReflectionEvents(e.ActiveLowSide)},s.ProcessEventHR=function(t){var e=t.Side.Obstacle,r=this.scanLine.NextHighB(t.Side).item;this.AddPerpendicularReflectionSegment(t,t.Side,r)&&this.AddParallelReflectionSegment(e,null,r,t)&&this.LoadReflectionEvents(e.ActiveHighSide)},s.MakeInBoundsLocation=function(t){var e=Math.max(t.x,this.ObstacleTree.GraphBox.left),r=Math.max(t.y,this.ObstacleTree.GraphBox.bottom);return new R(Math.min(e,this.ObstacleTree.GraphBox.right),Math.min(r,this.ObstacleTree.GraphBox.top))},s.IsInBoundsV=function(t){return this.IsInBoundsP(t.point)},s.IsInBoundsP=function(t){return J.EqualPP(t,this.MakeInBoundsLocation(t))},Q(l,[{key:"ParallelScanSegments",get:function(){return this.ScanDirection.IsHorizontal?this.HorizontalScanSegments:this.VerticalScanSegments}},{key:"PerpendicularScanSegments",get:function(){return this.ScanDirection.IsHorizontal?this.VerticalScanSegments:this.HorizontalScanSegments}}]),l}();go.SentinelOffset=1;var Pa=function(l){function s(){var t;return(t=l.call(this,!1)||this).horizontalVertexPoints=new qt,t.verticalVertexPoints=new qt,t.boundingBoxSteinerPoints=new qt,t.xCoordAccumulator=new Set,t.yCoordAccumulator=new Set,t.horizontalCoordMap=new Map,t.verticalCoordMap=new Map,t}X(s,l);var o=s.prototype;return o.Clear=function(){l.prototype.Clear.call(this),this.Cleanup()},o.Cleanup=function(){this.horizontalVertexPoints.clear(),this.verticalVertexPoints.clear(),this.boundingBoxSteinerPoints.clear(),this.xCoordAccumulator.clear(),this.yCoordAccumulator.clear(),this.horizontalCoordMap.clear(),this.verticalCoordMap.clear()},o.GenerateVisibilityGraph=function(){this.AccumulateVertexCoords(),this.CreateSegmentVectorsAndPopulateCoordinateMaps(),this.RunScanLineToCreateSegmentsAndBoundingBoxSteinerPoints(),this.GenerateSparseIntersectionsFromVertexPoints(),this.CreateScanSegmentTrees(),this.Cleanup()},o.AccumulateVertexCoords=function(){for(var r,e=C(this.ObstacleTree.GetAllObstacles());!(r=e()).done;){var i=r.value;this.xCoordAccumulator.add(i.VisibilityBoundingBox.left),this.xCoordAccumulator.add(i.VisibilityBoundingBox.right),this.yCoordAccumulator.add(i.VisibilityBoundingBox.top),this.yCoordAccumulator.add(i.VisibilityBoundingBox.bottom)}},o.CreateSegmentVectorsAndPopulateCoordinateMaps=function(){this.horizontalScanSegmentVector=new Iu(this.yCoordAccumulator,!0),this.verticalScanSegmentVector=new Iu(this.xCoordAccumulator,!1);for(var e=0;e<this.horizontalScanSegmentVector.Length;e++)this.horizontalCoordMap.set(this.horizontalScanSegmentVector.Item(e).Coord,e);for(var r=0;r<this.verticalScanSegmentVector.Length;r++)this.verticalCoordMap.set(this.verticalScanSegmentVector.Item(r).Coord,r)},o.RunScanLineToCreateSegmentsAndBoundingBoxSteinerPoints=function(){l.prototype.GenerateVisibilityGraph.call(this),this.horizontalScanSegmentVector.ScanSegmentsComplete(),this.verticalScanSegmentVector.ScanSegmentsComplete(),this.xCoordAccumulator.clear(),this.yCoordAccumulator.clear()},o.InitializeEventQueue=function(e){l.prototype.InitializeEventQueue.call(this,e),this.SetVectorsAndCoordMaps(e),this.AddAxisCoordinateEvents(e)},o.AddAxisCoordinateEvents=function(e){if(e.IsHorizontal)for(var i,r=C(this.yCoordAccumulator);!(i=r()).done;)this.eventQueue.Enqueue(new ya(new R(this.ObstacleTree.GraphBox.left-s.SentinelOffset,i.value)));else for(var f,c=C(this.xCoordAccumulator);!(f=c()).done;)this.eventQueue.Enqueue(new ya(new R(f.value,this.ObstacleTree.GraphBox.bottom-s.SentinelOffset)))},o.ProcessCustomEvent=function(e){this.ProcessAxisCoordinate(e)||this.ProcessCustomEvent(e)},o.ProcessAxisCoordinate=function(e){return e instanceof ya&&(this.CreateScanSegmentsOnAxisCoordinate(e.Site),!0)},o.InsertPerpendicularReflectionSegment=function(e,r){return!1},o.InsertParallelReflectionSegment=function(e,r,i,h,c,f){return!1},o.ProcessVertexEvent=function(e,r,i){var h=this.ScanDirection.IsHorizontal?this.horizontalVertexPoints:this.verticalVertexPoints;h.add(i.Site);var c=this.LowNeighborSides.LowNeighbor.item,f=this.HighNeighborSides.HighNeighbor.item,p=this.ScanDirection.Dir,y=this.ScanDirection.OppositeDirection,m=this.ScanLineIntersectSide(i.Site,c),P=this.ScanLineIntersectSide(i.Site,f);if(this.ObstacleTree.GraphBox.contains(m)){var L=ut.RectangleBorderIntersect(c.Obstacle.VisibilityBoundingBox,m,p);J.IsPureLower(L,i.Site)&&this.boundingBoxSteinerPoints.add(L)}if(this.ObstacleTree.GraphBox.contains(P)){var E=ut.RectangleBorderIntersect(f.Obstacle.VisibilityBoundingBox,P,y);J.IsPureLower(i.Site,E)&&this.boundingBoxSteinerPoints.add(E)}var S={lowCorner:void 0,highCorner:void 0};s.GetBoundingCorners(e.item.Obstacle.VisibilityBoundingBox,i instanceof fo,this.ScanDirection.IsHorizontal,S),(J.IsPureLower(m,S.lowCorner)||c.Obstacle.IsInSameClump(i.Obstacle))&&h.add(S.lowCorner),(J.IsPureLower(S.highCorner,P)||f.Obstacle.IsInSameClump(i.Obstacle))&&h.add(S.highCorner)},s.GetBoundingCorners=function(e,r,i,h){if(r)return h.lowCorner=e.leftBottom,void(h.highCorner=i?e.rightBottom:e.leftTop);h.lowCorner=i?e.leftTop:e.rightBottom,h.highCorner=e.rightTop},o.CreateScanSegmentsOnAxisCoordinate=function(e){this.CurrentGroupBoundaryCrossingMap.Clear();for(var r=this.scanLine.Lowest(),i=this.scanLine.NextHighR(r),h=0,c=e,f=!1;null!=i;i=this.scanLine.NextHighR(i))if(!this.SkipSide(c,i.item)){if(i.item.Obstacle.IsGroup){(0===h||f)&&this.HandleGroupCrossing(e,i.item);continue}if(i.item instanceof He){if(h>0){h++;continue}c=this.CreateScanSegment(c,i.item,Ct.NormalWeight),this.CurrentGroupBoundaryCrossingMap.Clear(),h=1,f=i.item.Obstacle.isOverlapped;continue}!(++h>0)&&(c=i.item.Obstacle.isOverlapped||i.item.Obstacle.OverlapsGroupCorner?this.CreateScanSegment(c,i.item,Ct.OverlappedWeight):this.ScanLineIntersectSide(c,i.item),this.CurrentGroupBoundaryCrossingMap.Clear(),f=!1)}var y=this.ScanDirection.IsHorizontal?new R(this.ObstacleTree.GraphBox.right+s.SentinelOffset,c.y):new R(c.x,this.ObstacleTree.GraphBox.top+s.SentinelOffset);this.parallelSegmentVector.CreateScanSegment(c,y,Ct.NormalWeight,this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(c,y)),this.parallelSegmentVector.ScanSegmentsCompleteForCurrentSlot()},o.HandleGroupCrossing=function(e,r){if(this.ScanLineCrossesObstacle(e,r.Obstacle)){var i=r instanceof He?this.ScanDirection.Dir:this.ScanDirection.OppositeDirection,h=this.ScanLineIntersectSide(e,r),c=this.CurrentGroupBoundaryCrossingMap.AddIntersection(h,r.Obstacle,i);this.AddPerpendicularCoordForGroupCrossing(h);var f=c.GetInteriorVertexPoint(h);this.AddPerpendicularCoordForGroupCrossing(f)}},o.AddPerpendicularCoordForGroupCrossing=function(e){var r=this.FindPerpendicularSlot(e,0);-1!==r&&this.perpendicularSegmentVector.Item(r).AddPendingPerpendicularCoord(this.parallelSegmentVector.CurrentSlot.Coord)},o.SkipSide=function(e,r){if(r.Obstacle.IsSentinel)return!0;var i=r.Obstacle.VisibilityBoundingBox;return this.ScanDirection.IsHorizontal?e.y===i.bottom||e.y===i.top:e.x===i.left||e.x===i.right},o.CreateScanSegment=function(e,r,i){var h=this.ScanLineIntersectSide(e,r);return e!==h&&this.parallelSegmentVector.CreateScanSegment(e,h,i,this.CurrentGroupBoundaryCrossingMap.GetOrderedListBetween(e,h)),h},o.GenerateSparseIntersectionsFromVertexPoints=function(){this.VisibilityGraph=s.NewVisibilityGraph(),this.GenerateSparseIntersectionsAlongHorizontalAxis(),this.GenerateSparseIntersectionsAlongVerticalAxis(),this.ConnectAdjoiningScanSegments(),this.horizontalScanSegmentVector.CreateSparseVerticesAndEdges(this.VisibilityGraph),this.verticalScanSegmentVector.CreateSparseVerticesAndEdges(this.VisibilityGraph)},o.GenerateSparseIntersectionsAlongHorizontalAxis=function(){this.currentAxisPointComparer=be;var e=Array.from(this.horizontalVertexPoints.values()).sort(this.currentAxisPointComparer),r=Array.from(this.boundingBoxSteinerPoints.values()).sort(this.currentAxisPointComparer);this.ScanDirection=Zt.HorizontalInstance,this.SetVectorsAndCoordMaps(this.ScanDirection),this.GenerateSparseIntersections(e,r)},o.GenerateSparseIntersectionsAlongVerticalAxis=function(){this.currentAxisPointComparer=function(i,h){return i.compareTo(h)};var e=Array.from(this.verticalVertexPoints.values()).sort(this.currentAxisPointComparer),r=Array.from(this.boundingBoxSteinerPoints.values()).sort(this.currentAxisPointComparer);this.ScanDirection=Zt.VerticalInstance,this.SetVectorsAndCoordMaps(this.ScanDirection),this.GenerateSparseIntersections(e,r)},o.SetVectorsAndCoordMaps=function(e){e.IsHorizontal?(this.parallelSegmentVector=this.horizontalScanSegmentVector,this.perpendicularSegmentVector=this.verticalScanSegmentVector,this.perpendicularCoordMap=this.verticalCoordMap):(this.parallelSegmentVector=this.verticalScanSegmentVector,this.perpendicularSegmentVector=this.horizontalScanSegmentVector,this.perpendicularCoordMap=this.horizontalCoordMap)},o.ConnectAdjoiningScanSegments=function(){this.horizontalScanSegmentVector.ConnectAdjoiningSegmentEndpoints(),this.verticalScanSegmentVector.ConnectAdjoiningSegmentEndpoints()},o.GenerateSparseIntersections=function(e,r){this.perpendicularSegmentVector.ResetForIntersections(),this.parallelSegmentVector.ResetForIntersections();for(var f,i=1,h={j:0},c=C(this.parallelSegmentVector.Items());!(f=c()).done;)for(var p=f.value;p.CurrentSegment.ContainsPoint(e[i])||this.AddSteinerPointsToInterveningSegments(e[i],r,h,p)&&p.TraverseToSegmentContainingPoint(e[i]);)if(this.AddPointsToCurrentSegmentIntersections(r,h,p),this.GenerateIntersectionsFromVertexPointForCurrentSegment(e[i],p),p.PointIsCurrentEndAndNextStart(e[i]))p.MoveNext();else if(++i>=e.length)return},o.AddSteinerPointsToInterveningSegments=function(e,r,i,h){for(;i.j<r.length&&-1===this.currentAxisPointComparer(r[i.j],e);){if(!h.TraverseToSegmentContainingPoint(r[i.j]))return!1;this.AddPointsToCurrentSegmentIntersections(r,i,h)}return!0},o.AddPointsToCurrentSegmentIntersections=function(e,r,i){for(;r.j<e.length&&i.CurrentSegment.ContainsPoint(e[r.j]);r.j++){var h=this.FindPerpendicularSlot(e[r.j],0);this.AddSlotToSegmentIntersections(i,h)}},o.GenerateIntersectionsFromVertexPointForCurrentSegment=function(e,r){var i=this.FindPerpendicularSlot(r.CurrentSegment.Start,1),h=this.FindPerpendicularSlot(r.CurrentSegment.End,-1),c=this.FindPerpendicularSlot(e,0);i>=h||(this.AddSlotToSegmentIntersections(r,i),this.AddSlotToSegmentIntersections(r,h),c>i&&c<h&&(this.AddSlotToSegmentIntersections(r,c),this.AddBinaryDivisionSlotsToSegmentIntersections(r,i,c,h)))},o.FindPerpendicularSlot=function(e,r){return s.FindIntersectingSlot(this.perpendicularSegmentVector,this.perpendicularCoordMap,e,r)},s.FindIntersectingSlot=function(e,r,i,h){var c=e.GetParallelCoord(i),f=r.get(c);return void 0!==f?f:0===h?-1:e.FindNearest(c,h)},o.AddSlotToSegmentIntersections=function(e,r){var i=this.perpendicularSegmentVector.Item(r);e.CurrentSegment.AddSparseVertexCoord(i.Coord),i.AddPerpendicularCoord(e.Coord)},o.AddBinaryDivisionSlotsToSegmentIntersections=function(e,r,i,h){for(var c=0,f=this.perpendicularSegmentVector.Length-1;f-c>1;){var p=c+Math.floor((f-c)/2);i<=p?i<(f=p)&&f<=h&&this.AddSlotToSegmentIntersections(e,f):i>(c=p)&&c>=r&&this.AddSlotToSegmentIntersections(e,c)}},o.CreateScanSegmentTrees=function(){s.CreateScanSegmentTree(this.horizontalScanSegmentVector,this.HorizontalScanSegments),s.CreateScanSegmentTree(this.verticalScanSegmentVector,this.VerticalScanSegments)},s.CreateScanSegmentTree=function(e,r){for(var h,i=C(e.Items());!(h=i()).done;)for(var f=h.value.FirstSegment;null!=f;f=f.NextSegment)f.HasVisibility()&&r.InsertUnique(f)},s}(go),Bu=function(){function l(o){this.AddedVertices=new Array,this.AddedEdges=new Array,this.edgesToRestore=new Array,this.LimitPortVisibilitySpliceToEndpointBoundingBox=!1,this.GraphGenerator=o}var s=l.prototype;return s.AddVertex=function(t){var e=this.VisGraph.AddVertexP(t);return this.AddedVertices.push(e),e},s.FindOrAddVertex=function(t){return this.VisGraph.FindVertex(t)??this.AddVertex(t)},s.FindOrAddEdgeVV=function(t,e){return this.FindOrAddEdge(t,e,Ct.NormalWeight)},s.FindOrAddEdge=function(t,e,r){var i=J.GetPureDirectionVV(t,e),h={bracketSource:void 0,bracketTarget:void 0,splitVertex:void 0};l.GetBrackets(t,e,i,h);var c=this.VisGraph.FindEdgePP(h.bracketSource.point,h.bracketTarget.point);return null!=c?this.SplitEdge(c,h.splitVertex):this.CreateEdge(h.bracketSource,h.bracketTarget,r)},l.GetBrackets=function(t,e,r,i){if(i.splitVertex=e,!l.FindBracketingVertices(t,e.point,r,i)){var h={bracketSource:null,bracketTarget:null};l.FindBracketingVertices(e,t.point,nt.OppositeDir(r),h)&&(i.bracketSource=h.bracketTarget,i.splitVertex=t),i.bracketTarget=h.bracketSource}},l.FindBracketingVertices=function(t,e,r,i){for(i.bracketSource=t;i.bracketTarget=ut.FindAdjacentVertex(i.bracketSource,r),null!=i.bracketTarget;){if(R.closeDistEps(i.bracketTarget.point,e))return!0;if(r!==J.GetDirections(i.bracketTarget.point,e))break;i.bracketSource=i.bracketTarget}return null!=i.bracketTarget},s.CreateEdge=function(t,e,r){var i=t,h=e;J.IsPureLower(i.point,h.point)||(i=e,h=t);var c=new Ar(i,h,r);return _t.AddEdge(c),this.AddedEdges.push(c),c},s.RemoveFromGraph=function(){this.RemoveAddedVertices(),this.RemoveAddedEdges(),this.RestoreRemovedEdges()},s.RemoveAddedVertices=function(){for(var e,t=C(this.AddedVertices);!(e=t()).done;){var r=e.value;null!=this.VisGraph.FindVertex(r.point)&&this.VisGraph.RemoveVertex(r)}this.AddedVertices=[]},s.RemoveAddedEdges=function(){for(var e,t=C(this.AddedEdges);!(e=t()).done;){var r=e.value;null!=this.VisGraph.FindVertex(r.SourcePoint)&&_t.RemoveEdge(r)}this.AddedEdges=[]},s.RestoreRemovedEdges=function(){for(var e,t=C(this.edgesToRestore);!(e=t()).done;)_t.AddEdge(e.value);this.edgesToRestore=[]},s.FindNextEdge=function(t,e){return ut.FindAdjacentEdge(t,e)},s.FindPerpendicularOrContainingEdge=function(t,e,r){for(;;){var i=ut.FindAdjacentVertex(t,e);if(null==i)break;var h=J.GetDirections(i.point,r);if(nt.OppositeDir(e)&h)return this.VisGraph.FindEdgePP(t.point,i.point);t=i}return null},s.FindNearestPerpendicularOrContainingEdge=function(t,e,r){var i,p;J.GetDirections(t.point,r);for(var h=t,c=i;U.None!==c;){var f=ut.FindAdjacentVertex(h,i);if(null==f||nt.OppositeDir(i)&J.GetDirections(f.point,r))break;J.GetDirections((h=f).point,r)}for(;null==(p=this.FindPerpendicularOrContainingEdge(h,e,r))&&h!==t;)h=ut.FindAdjacentVertex(h,nt.OppositeDir(i));return p},s.ConnectVertexToTargetVertex=function(t,e,r,i){if(!R.closeDistEps(t.point,e.point)){var h=J.GetDirections(t.point,e.point);if(J.IsPureDirectionD(h))return void this.FindOrAddEdgeVV(t,e);var c=ut.FindBendPointBetween(t.point,e.point,r),f=this.FindOrAddVertex(c);this.FindOrAddEdge(t,f,i),this.FindOrAddEdge(f,e,i)}},s.AddEdgeToTargetEdge=function(t,e,r){var i=this.VisGraph.FindVertex(r);return null==i&&(i=this.AddVertex(r),this.SplitEdge(e,i)),this.FindOrAddEdgeVV(t,i),i},s.SplitEdge=function(t,e){return null==t?null:R.closeDistEps(t.Source.point,e.point)||R.closeDistEps(t.Target.point,e.point)?t:(t instanceof Ar||this.edgesToRestore.push(t),_t.RemoveEdge(t),(this.IsSparseVg||t.Weight===Ct.OverlappedWeight)&&e.Degree>0?(this.FindOrAddEdge(e,t.Source,t.Weight),this.FindOrAddEdge(e,t.Target,t.Weight)):(this.CreateEdge(e,t.Target,t.Weight),this.CreateEdge(t.Source,e,t.Weight)))},s.ExtendEdgeChainVRLPB=function(t,e,r,i,h){var c=J.GetDirections(r.start,r.end);if(c!==U.None){var f=ut.GetRectangleBound(e,c),p=ut.IsVerticalD(c)?R.RoundPoint(new R(t.point.x,f)):R.RoundPoint(new R(f,t.point.y));if(!R.closeDistEps(p,t.point)&&J.GetDirections(t.point,p)===c){var y=r;J.GetDirections(p,y.end)===c&&(y=Z.mkPP(y.start,p)),this.ExtendEdgeChain(t,c,y,r,i,h)}}},s.ExtendEdgeChain=function(t,e,r,i,h,c){if(J.GetDirections(t.point,r.end)===e){var p=nt.RotateLeft(e),y=ut.FindAdjacentVertex(t,p);if(null!=y||(p=nt.OppositeDir(p),null!=(y=ut.FindAdjacentVertex(t,p)))){var m=nt.OppositeDir(p),P={spliceTarget:null};this.ExtendSpliceWorker(y,e,m,r,i,c,P)&&this.ExtendSpliceWorker(P.spliceTarget,e,p,r,i,c,P),this.SpliceGroupBoundaryCrossings(h,t,r)}}},s.SpliceGroupBoundaryCrossings=function(t,e,r){if(null!=t&&0!==t.Count()){t.Reset();var i=r.start,h=r.end,c=J.GetDirections(i,h);ut.IsAscending(c)||(i=r.end,h=r.start,c=nt.OppositeDir(c));for(var f=e=l.TraverseToFirstVertexAtOrAbove(e,i,nt.OppositeDir(c));null!=f;f=ut.FindAdjacentVertex(f,c)){for(var p=J.ComparePP(f.point,h)>=0;t.CurrentIsBeforeOrAt(f.point);){var y=t.Pop();J.ComparePP(y.Location,e.point)>0&&J.ComparePP(y.Location,h)<=0&&this.SpliceGroupBoundaryCrossing(f,y,nt.OppositeDir(c)),J.ComparePP(y.Location,e.point)>=0&&J.ComparePP(y.Location,h)<0&&this.SpliceGroupBoundaryCrossing(f,y,c)}if(p)break}}},l.TraverseToFirstVertexAtOrAbove=function(t,e,r){for(var i=t,h=nt.OppositeDir(r);;){var c=ut.FindAdjacentVertex(i,r);if(null==c||J.GetDirections(c.point,e)===h)break;i=c}return i},s.SpliceGroupBoundaryCrossing=function(t,e,r){var i,h,c=bi.ToCrossingArray(e.Crossings,r);if(null!=c){var f=null!==(i=this.VisGraph.FindVertex(e.Location))&&void 0!==i?i:this.AddVertex(e.Location);t.point.equal(f.point)||this.FindOrAddEdgeVV(t,f);var p=c[0].GetInteriorVertexPoint(e.Location),y=null!==(h=this.VisGraph.FindVertex(p))&&void 0!==h?h:this.AddVertex(p),m=this.FindOrAddEdgeVV(f,y),P=c.map(function(L){return L.Group.InputShape});m.IsPassable=function(){return P.some(function(L){return L.IsTransparent})}}},s.ExtendSpliceWorker=function(t,e,r,i,h,c,f){var p=ut.FindAdjacentVertex(t,r);f.spliceTarget=ut.FindAdjacentVertex(p,r);for(var y={spliceSource:t};l.GetNextSpliceSource(y,r,e);){var m=ut.FindBendPointBetween(p.point,y.spliceSource.point,nt.OppositeDir(r));if(l.IsPointPastSegmentEnd(h,m))break;if(f.spliceTarget=l.GetSpliceTarget(y,r,m),null==f.spliceTarget){if(this.IsSkippableSpliceSourceWithNullSpliceTarget(y.spliceSource,e))continue;if(this.ObstacleTree.SegmentCrossesAnObstacle(y.spliceSource.point,m))return!1}var P=this.VisGraph.FindVertex(m);if(null!=P){if(null==f.spliceTarget||null!=this.VisGraph.FindEdgePP(p.point,m))return null==f.spliceTarget&&this.FindOrAddEdge(p,P,c?Ct.OverlappedWeight:Ct.NormalWeight),!1}else P=this.AddVertex(m);if(this.FindOrAddEdge(p,P,c?Ct.OverlappedWeight:Ct.NormalWeight),this.FindOrAddEdge(y.spliceSource,P,c?Ct.OverlappedWeight:Ct.NormalWeight),c&&(c=this.SeeIfSpliceIsStillOverlapped(e,P)),p=P,!(e&J.GetDirections(m,i.end))){f.spliceTarget=null;break}}return null!=f.spliceTarget},l.GetNextSpliceSource=function(t,e,r){var i=ut.FindAdjacentVertex(t.spliceSource,r);if(null==i)for(i=t.spliceSource;;){if(null==(i=ut.FindAdjacentVertex(i,nt.OppositeDir(e))))return!1;var h=ut.FindAdjacentVertex(i,r);if(null!=h){i=h;break}}return t.spliceSource=i,!0},l.GetSpliceTarget=function(t,e,r){for(var i=J.GetDirections(t.spliceSource.point,r),h=i,c=t.spliceSource;h===i&&(t.spliceSource=c,null!=(c=ut.FindAdjacentVertex(t.spliceSource,e)));){if(R.closeDistEps(c.point,r)){c=ut.FindAdjacentVertex(c,e);break}h=J.GetDirections(c.point,r)}return c},s.SeeIfSpliceIsStillOverlapped=function(t,e){var r=this.FindNextEdge(e,nt.RotateLeft(t)),i=null!=r&&Ct.NormalWeight===r.Weight;return i||(i=null!=(r=this.FindNextEdge(e,nt.RotateRight(t)))&&Ct.NormalWeight===r.Weight),!i||this.ObstacleTree.PointIsInsideAnObstaclePD(e.point,t)},s.IsSkippableSpliceSourceWithNullSpliceTarget=function(t,e){if(l.IsSkippableSpliceSourceEdgeWithNullTarget(ut.FindAdjacentEdge(t,e)))return!0;var r=ut.FindAdjacentEdge(t,nt.OppositeDir(e));return l.IsSkippableSpliceSourceEdgeWithNullTarget(r)||l.IsReflectionEdge(r)},l.IsSkippableSpliceSourceEdgeWithNullTarget=function(t){return null!=t&&null!=t.IsPassable&&dt(t.Length,pa.BoundaryWidth)},l.IsReflectionEdge=function(t){return null!=t&&t.Weight===Ct.ReflectionWeight},l.IsPointPastSegmentEnd=function(t,e){return J.GetDirections(t.start,t.end)===J.GetDirections(t.end,e)},s.toString=function(){return $t.Ld.Format("{0} {1}",this.AddedVertices.length,this.edgesToRestore.length)},Q(l,[{key:"ObstacleTree",get:function(){return this.GraphGenerator.ObstacleTree}},{key:"VisGraph",get:function(){return this.GraphGenerator.VisibilityGraph}},{key:"IsSparseVg",get:function(){return this.GraphGenerator instanceof Pa}}]),l}(),jc=function(){function l(o){this.obstaclePortMap=new Map,this.freePointMap=new Ee,this.freePointLocationsUsedByRouteEdges=new qt,this.RouteToCenterOfObstacles=!1,this.obstaclePortsInGraph=new Array,this.freePointsInGraph=new Set,this.activeAncestors=new Array,this.TransUtil=new Bu(o),this.graphGenerator=o}var s=l.prototype;return s.Clear=function(){this.TransUtil.RemoveFromGraph(),this.obstaclePortMap.clear()},s.CreateObstaclePorts=function(t){for(var r,e=C(t.Ports);!(r=e()).done;)this.CreateObstaclePort(t,r.value)},s.CreateObstaclePort=function(t,e){if(null==e.Curve)return null;var r=R.RoundPoint(e.Location);if(ht.Outside===K.PointRelativeToCurveLocation(r,t.InputShape.BoundaryCurve)||t.InputShape.BoundaryCurve!==e.Curve&&ht.Outside===K.PointRelativeToCurveLocation(r,e.Curve))return null;var i=new Gc(e,t);return this.obstaclePortMap.set(e,i),i},s.FindVertices=function(t){var e=new Array,r=this.obstaclePortMap.get(t);if(r)if(this.RouteToCenterOfObstacles)e.push(r.CenterVertex);else for(var h,i=C(r.PortEntrances);!(h=i()).done;){var f=this.VisGraph.FindVertex(h.value.UnpaddedBorderIntersect);null!=f&&e.push(f)}else e.push(this.VisGraph.FindVertex(R.RoundPoint(t.Location)));return e},s.RemoveObstaclePorts=function(t){for(var r,e=C(t.Ports);!(r=e()).done;)this.RemoveObstaclePort(r.value)},s.RemoveObstaclePort=function(t){this.obstaclePortMap.delete(t)},s.AddControlPointsToGraph=function(t,e){this.GetPortSpliceLimitRectangle(t),this.activeAncestors=[];var r={oport:null},i={oport:null},h=this.FindAncestorsAndObstaclePort(t.sourcePort,r),c=this.FindAncestorsAndObstaclePort(t.targetPort,i);if(this.AncestorSets.size>0&&null!=r.oport&&null!=i.oport){var f=Tn(c,h),p=Tn(h,c);this.ActivateAncestors(p,f,e)}this.AddPortToGraph(t.sourcePort,r.oport),this.AddPortToGraph(t.targetPort,i.oport)},s.ConnectOobWaypointToEndpointVisibilityAtGraphBoundary=function(t,e){if(null!=t&&t.IsOutOfBounds){var r=this.FindVertices(e),i=t.OutOfBoundsDirectionFromGraph&(U.North|U.South);this.ConnectToGraphAtPointsCollinearWithVertices(t,i,r),this.ConnectToGraphAtPointsCollinearWithVertices(t,i=t.OutOfBoundsDirectionFromGraph&(U.East|U.West),r)}},s.ConnectToGraphAtPointsCollinearWithVertices=function(t,e,r){if(U.None!==e)for(var c,i=nt.OppositeDir(e),h=C(r);!(c=h()).done;){var p=this.InBoundsGraphBoxIntersect(c.value.point,e),y=this.VisGraph.FindVertex(p);null!=y&&this.TransUtil.ConnectVertexToTargetVertex(t.Vertex,y,i,Ct.NormalWeight)}},s.SetAllAncestorsActive=function(t,e){if(0===this.AncestorSets.size)return!1;this.ObstacleTree.AdjustSpatialAncestors(),this.ClearActiveAncestors();var h=this.FindAncestorsAndObstaclePort(t.sourcePort,{oport:null}),c=this.FindAncestorsAndObstaclePort(t.targetPort,{oport:null});return this.AncestorSets.size>0&&null!=h&&null!=c&&(this.ActivateAncestors(h,c,e),!0)},s.SetAllGroupsActive=function(){this.ClearActiveAncestors();for(var e,t=C(this.ObstacleTree.GetAllGroups());!(e=t()).done;){var r=e.value;r.IsTransparentAncestor=!0,this.activeAncestors.push(r)}},s.FindAncestorsAndObstaclePort=function(t,e){return e.oport=this.FindObstaclePort(t),0===this.AncestorSets.size?null:null!=e.oport?this.AncestorSets.get(e.oport.Obstacle.InputShape):new Set(Array.from(this.ObstacleTree.Root.AllHitItems(lt.mkPP(t.Location,t.Location),function(r){return r.IsGroup})).map(function(r){return r.InputShape}))},s.ActivateAncestors=function(t,e,r){for(var h,i=C(On(t,e));!(h=i()).done;){var f=r.get(h.value);f.IsTransparentAncestor=!0,this.activeAncestors.push(f)}},s.ClearActiveAncestors=function(){for(var e,t=C(this.activeAncestors);!(e=t()).done;)e.value.IsTransparentAncestor=!1;this.activeAncestors=[]},s.RemoveControlPointsFromGraph=function(){this.ClearActiveAncestors(),this.RemoveObstaclePortsFromGraph(),this.RemoveFreePointsFromGraph(),this.TransUtil.RemoveFromGraph(),this.portSpliceLimitRectangle=lt.mkEmpty()},s.RemoveObstaclePortsFromGraph=function(){for(var e,t=C(this.obstaclePortsInGraph);!(e=t()).done;)e.value.RemoveFromGraph();this.obstaclePortsInGraph=[]},s.RemoveFreePointsFromGraph=function(){for(var e,t=C(this.freePointsInGraph);!(e=t()).done;)e.value.RemoveFromGraph();this.freePointsInGraph.clear()},s.RemoveStaleFreePoints=function(){var t=this;if(this.freePointMap.size>this.freePointLocationsUsedByRouteEdges.size)for(var i,r=C(Array.from(this.freePointMap).filter(function(c){return!t.freePointLocationsUsedByRouteEdges.has(c[0])}));!(i=r()).done;)this.freePointMap.deleteP(i.value[0])},s.ClearVisibility=function(){this.freePointMap.clear();for(var e,t=C(this.obstaclePortMap.values());!(e=t()).done;)e.value.ClearVisibility()},s.BeginRouteEdges=function(){this.RemoveControlPointsFromGraph(),this.freePointLocationsUsedByRouteEdges.clear()},s.EndRouteEdges=function(){this.RemoveStaleFreePoints()},s.FindObstaclePort=function(t){var e=this.obstaclePortMap.get(t);if(e){var r={removedPorts:null,addedPorts:null};if(e.Obstacle.GetPortChanges(r)){for(var h,i=C(r.addedPorts);!(h=i()).done;)this.CreateObstaclePort(e.Obstacle,h.value);for(var p,f=C(r.removedPorts);!(p=f()).done;)this.RemoveObstaclePort(p.value);e=this.obstaclePortMap.get(t)}}return e},s.AddPortToGraph=function(t,e){null==e?this.AddFreePointToGraph(t.Location):this.AddObstaclePortToGraph(e)},s.AddObstaclePortToGraph=function(t){if(!t.LocationHasChanged||(this.RemoveObstaclePort(t.Port),null!=(t=this.CreateObstaclePort(t.Obstacle,t.Port)))){t.AddToGraph(this.TransUtil,this.RouteToCenterOfObstacles),this.obstaclePortsInGraph.push(t),this.CreateObstaclePortEntrancesIfNeeded(t);for(var r,e=C(t.PortEntrances);!(r=e()).done;)this.AddObstaclePortEntranceToGraph(r.value)}},s.CreateObstaclePortEntrancesIfNeeded=function(t){t.PortEntrances.length>0||this.CreateObstaclePortEntrancesFromPoints(t)},s.GetPortVisibilityIntersection=function(t){var e=this.FindObstaclePort(t.sourcePort),r=this.FindObstaclePort(t.targetPort);if(null==e||null==r||e.Obstacle.IsInConvexHull||r.Obstacle.IsInConvexHull||(this.CreateObstaclePortEntrancesIfNeeded(e),this.CreateObstaclePortEntrancesIfNeeded(r),!e.VisibilityRectangle.intersects(r.VisibilityRectangle)))return null;for(var h,i=C(e.PortEntrances);!(h=i()).done;){var c=h.value;if(c.WantVisibilityIntersection)for(var p,f=C(r.PortEntrances);!(p=f()).done;){var y=p.value;if(y.WantVisibilityIntersection){var m=c.IsVertical===y.IsVertical?l.GetPathPointsFromOverlappingCollinearVisibility(c,y):l.GetPathPointsFromIntersectingVisibility(c,y);if(null!=m)return m}}}return null},l.GetPathPointsFromOverlappingCollinearVisibility=function(t,e){return!ut.IntervalsAreSame(t.MaxVisibilitySegment.start,t.MaxVisibilitySegment.end,e.MaxVisibilitySegment.end,e.MaxVisibilitySegment.start)||t.HasGroupCrossings||e.HasGroupCrossings||R.closeDistEps(t.UnpaddedBorderIntersect,e.UnpaddedBorderIntersect)?null:[t.UnpaddedBorderIntersect,e.UnpaddedBorderIntersect]},l.GetPathPointsFromIntersectingVisibility=function(t,e){var r=ut.SegmentsIntersectLL(t.MaxVisibilitySegment,e.MaxVisibilitySegment);return!r||t.HasGroupCrossingBeforePoint(r)||e.HasGroupCrossingBeforePoint(r)?null:[t.UnpaddedBorderIntersect,r,e.UnpaddedBorderIntersect]},s.CreateObstaclePortEntrancesFromPoints=function(t){var e=this.graphGenerator.ObstacleTree.GraphBox,r=lt.mkPP(R.RoundPoint(t.PortCurve.boundingBox.leftBottom),R.RoundPoint(t.PortCurve.boundingBox.rightTop)),i=R.RoundPoint(t.PortLocation),h=!1,c={xx0:null,xx1:null};if(!J.Equal(i.y,r.top)&&!J.Equal(i.y,r.bottom)){h=!0;var f=new Z(e.left,i.y,e.right,i.y);this.GetBorderIntersections(i,f,t.PortCurve,c);var p=new R(Math.min(c.xx0.x,c.xx1.x),i.y);p.x<r.left&&(p=new R(r.left,p.y));var y=new R(Math.max(c.xx0.x,c.xx1.x),i.y);y.x>r.right&&(y=new R(r.right,y.y)),this.CreatePortEntrancesAtBorderIntersections(r,t,i,p,y)}if(!J.Equal(i.x,r.left)&&!J.Equal(i.x,r.right)){h=!0;var m=new Z(i.x,e.bottom,i.x,e.top);this.GetBorderIntersections(i,m,t.PortCurve,c);var P=new R(i.x,Math.min(c.xx0.y,c.xx1.y));P.y<e.bottom&&(P=new R(P.x,e.bottom));var L=new R(i.x,Math.max(c.xx0.y,c.xx1.y));L.y>e.top&&(L=new R(L.x,e.top)),this.CreatePortEntrancesAtBorderIntersections(r,t,i,P,L)}h||this.CreateEntrancesForCornerPort(r,t,i)},s.GetBorderIntersections=function(t,e,r,i){var h=K.getAllIntersections(e,r,!0);i.xx0=R.RoundPoint(h[0].x),i.xx1=R.RoundPoint(h[1].x)},s.CreatePortEntrancesAtBorderIntersections=function(t,e,r,i,h){var c=J.GetDirections(i,h);J.EqualPP(i,r)||this.CreatePortEntrance(t,e,h,c),J.EqualPP(h,r)||this.CreatePortEntrance(t,e,i,nt.OppositeDir(c))},l.GetDerivative=function(t,e){var r=t.PortCurve.closestParameter(e),i=t.PortCurve.derivative(r);return Ie.CurveIsClockwise(t.PortCurve,t.PortCurve.value((t.PortCurve.parStart+t.PortCurve.parEnd)/2))||(i=i.mul(-1)),i},s.CreatePortEntrance=function(t,e,r,i){e.CreatePortEntrance(r,i,this.ObstacleTree);var h=Zt.GetInstance(i),c=ut.GetRectangleBound(t,i)-h.Coord(r);if(c<0&&(c=-c),c>q.intersectionEpsilon){var p,f=nt.VectorDirection(l.GetDerivative(e,r));nt.OppositeDir(i),U.None!==(i&f)&&(p=nt.OppositeDir(p)),e.CreatePortEntrance(r,p,this.ObstacleTree)}},s.CreateEntrancesForCornerPort=function(t,e,r){var i=U.North;J.EqualPP(r,t.leftBottom)?i=U.South:J.EqualPP(r,t.leftTop)?i=U.West:J.EqualPP(r,t.rightTop)?i=U.North:J.EqualPP(r,t.rightBottom)&&(i=U.East),e.CreatePortEntrance(r,i,this.ObstacleTree),e.CreatePortEntrance(r,nt.RotateRight(i),this.ObstacleTree)},s.AddObstaclePortEntranceToGraph=function(t){var e=this.VisGraph.FindVertex(t.VisibilityBorderIntersect);if(e)t.ExtendEdgeChain(this.TransUtil,e,e,this.portSpliceLimitRectangle,this.RouteToCenterOfObstacles);else{var r={targetVertex:null};null!=this.FindorCreateNearestPerpEdgePPDNT(t.MaxVisibilitySegment.end,t.VisibilityBorderIntersect,t.OutwardDirection,t.IsOverlapped?Ct.OverlappedWeight:Ct.NormalWeight,r)&&t.AddToAdjacentVertex(this.TransUtil,r.targetVertex,this.portSpliceLimitRectangle,this.RouteToCenterOfObstacles)}},s.InBoundsGraphBoxIntersect=function(t,e){return ut.RectangleBorderIntersect(this.graphGenerator.ObstacleTree.GraphBox,t,e)},s.FindorCreateNearestPerpEdgePPDN=function(t,e,r,i){return this.FindorCreateNearestPerpEdgePPDNT(t,e,r,i,{targetVertex:null})},s.FindorCreateNearestPerpEdgePPDNT=function(t,e,r,i,h){var c=ut.SortAscending(t,e),f=c[0],p=c[1],y=ut.IsVerticalD(r)?this.HScanSegments:this.VScanSegments,m=ut.IsAscending(r)?y.FindLowestIntersector(f,p):y.FindHighestIntersector(f,p);if(null==m)return h.targetVertex=null,null;var P=ut.SegmentIntersectionSP(m,f);return this.FindOrCreateNearestPerpEdgeFromNearestPerpSegment(ut.IsAscending(r)?f:p,m,P,i,h)},s.FindOrCreateNearestPerpEdgeFromNearestPerpSegment=function(t,e,r,i,h){var c,f={segsegVertex:this.VisGraph.FindVertex(r),targetVertex:null};if(null==f.segsegVertex){var p=this.FindOrCreateSegmentIntersectionVertexAndAssociatedEdge(t,r,e,i,f);if(null!=p)return p}else if(J.EqualPP(t,r))return h.targetVertex=f.segsegVertex,this.TransUtil.FindNextEdge(h.targetVertex,nt.OppositeDir(e.ScanDirection.Dir));var y=J.GetDirections(r,t),m=J.GetDirections(f.segsegVertex.point,t);if(y===m){var P={bracketTarget:null,bracketSource:null};return Bu.FindBracketingVertices(f.segsegVertex,t,y,P),null!==(c=this.TransUtil.FindNextEdge(P.bracketSource,nt.RotateLeft(y)))&&void 0!==c?c:this.TransUtil.FindNextEdge(P.bracketSource,nt.RotateRight(y))}var L=this.TransUtil.FindNearestPerpendicularOrContainingEdge(f.segsegVertex,m&=~y,t);return null==L?(h.targetVertex=this.TransUtil.AddVertex(r),this.TransUtil.FindOrAddEdge(h.targetVertex,e.HighestVisibilityVertex,e.Weight)):(f.segsegVertex=ut.GetEdgeEnd(L,nt.OppositeDir(m)),r=ut.SegmentIntersectionPPP(t,r,f.segsegVertex.point),J.EqualPP(f.segsegVertex.point,r)?(h.targetVertex=f.segsegVertex,this.TransUtil.FindNextEdge(f.segsegVertex,m)):(h.targetVertex=this.TransUtil.FindOrAddVertex(r),this.TransUtil.FindOrAddEdge(f.segsegVertex,h.targetVertex,i)))},s.FindOrCreateSegmentIntersectionVertexAndAssociatedEdge=function(t,e,r,i,h){var f=(r.IsVertical?this.HScanSegments:this.VScanSegments).FindHighestIntersector(r.Start,e);if(null==f)return h.segsegVertex=null,h.targetVertex=this.TransUtil.AddVertex(e),this.TransUtil.FindOrAddEdge(h.targetVertex,r.LowestVisibilityVertex,r.Weight);var p=ut.SegmentsIntersection(r,f);if(h.segsegVertex=this.VisGraph.FindVertex(p),!h.segsegVertex){h.segsegVertex=this.TransUtil.AddVertex(p);var y=this.AddEdgeToClosestSegmentEnd(r,h.segsegVertex,r.Weight);if(this.AddEdgeToClosestSegmentEnd(f,h.segsegVertex,f.Weight),J.EqualPP(h.segsegVertex.point,e))return h.targetVertex=h.segsegVertex,y}return J.EqualPP(t,e)?(h.targetVertex=this.TransUtil.FindOrAddVertex(e),this.TransUtil.FindOrAddEdge(h.segsegVertex,h.targetVertex,i)):(h.targetVertex=null,null)},s.AddEdgeToClosestSegmentEnd=function(t,e,r){return J.IsPureLower(t.HighestVisibilityVertex.point,e.point)?this.TransUtil.FindOrAddEdge(t.HighestVisibilityVertex,e,r):J.IsPureLower(e.point,t.LowestVisibilityVertex.point)?this.TransUtil.FindOrAddEdge(e,t.LowestVisibilityVertex,r):this.TransUtil.FindOrAddEdgeVV(t.LowestVisibilityVertex,e)},s.GetPortSpliceLimitRectangle=function(t){this.LimitPortVisibilitySpliceToEndpointBoundingBox?(this.portSpliceLimitRectangle=this.GetPortRectangle(t.sourcePort),this.portSpliceLimitRectangle.addRecSelf(this.GetPortRectangle(t.targetPort))):this.portSpliceLimitRectangle=this.graphGenerator.ObstacleTree.GraphBox},s.GetPortRectangle=function(t){var e=this.obstaclePortMap.get(t);return e?e.Obstacle.VisibilityBoundingBox.clone():lt.mkOnPoints([R.RoundPoint(t.Location)])},s.AddToLimitRectangle=function(t){this.graphGenerator.IsInBoundsP(t)&&this.portSpliceLimitRectangle.add(t)},s.FindOrCreateFreePoint=function(t){var e=this.freePointMap.get(t);return e?e.GetVertex(this.TransUtil,t):(e=new Nc(this.TransUtil,t),this.freePointMap.set(t,e)),this.freePointsInGraph.add(e),this.freePointLocationsUsedByRouteEdges.add(t),e},s.AddFreePointToGraph=function(t){t=R.RoundPoint(t);var e=this.VisGraph.FindVertex(t),r=this.FindOrCreateFreePoint(t);if(null!=e)return r;if(!this.graphGenerator.IsInBoundsP(t))return this.CreateOutOfBoundsFreePoint(r),r;r.IsOverlapped=this.ObstacleTree.PointIsInsideAnObstacle(r.Point,this.HScanSegments.ScanDirection),this.VScanSegments.FindSegmentContainingPoint(t,!0);for(var f=U.South,p=0;p<4;p++)this.ConnectFreePointToLateralEdge(r,f),f=nt.RotateLeft(f);return r},s.CreateOutOfBoundsFreePoint=function(t){var e=t.Point,r=this.graphGenerator.MakeInBoundsLocation(e),i=J.GetDirections(r,e);if(t.OutOfBoundsDirectionFromGraph=i,J.IsPureDirectionD(i)){var h=this.VisGraph.FindVertex(r),c=nt.OppositeDir(i);if(null!=h)t.AddToAdjacentVertex(this.TransUtil,h,c,this.portSpliceLimitRectangle);else{var f=this.FindorCreateNearestPerpEdgePPDN(e,r,i,Ct.NormalWeight);null!=f&&(h=t.AddEdgeToAdjacentEdge(this.TransUtil,f,c,this.portSpliceLimitRectangle))}var p=ut.FindAdjacentVertex(h,nt.RotateLeft(c));null!=p&&this.TransUtil.ConnectVertexToTargetVertex(t.Vertex,p,c,Ct.NormalWeight);var y=ut.FindAdjacentVertex(h,nt.RotateRight(c));null!=y&&this.TransUtil.ConnectVertexToTargetVertex(t.Vertex,y,c,Ct.NormalWeight)}else t.AddOobEdgesFromGraphCorner(this.TransUtil,r)},s.ConnectFreePointToLateralEdge=function(t,e){var r=t.IsOverlapped?this.InBoundsGraphBoxIntersect(t.Point,e):t.MaxVisibilityInDirectionForNonOverlappedFreePoint(e,this.TransUtil),i=this.FindorCreateNearestPerpEdgePPDN(r,t.Point,e,t.InitialWeight);null!=i&&t.AddEdgeToAdjacentEdge(this.TransUtil,i,e,this.portSpliceLimitRectangle)},Q(l,[{key:"LimitPortVisibilitySpliceToEndpointBoundingBox",get:function(){return this.TransUtil.LimitPortVisibilitySpliceToEndpointBoundingBox},set:function(t){this.TransUtil.LimitPortVisibilitySpliceToEndpointBoundingBox=t}},{key:"VisGraph",get:function(){return this.graphGenerator.VisibilityGraph}},{key:"HScanSegments",get:function(){return this.graphGenerator.HorizontalScanSegments}},{key:"VScanSegments",get:function(){return this.graphGenerator.VerticalScanSegments}},{key:"ObstacleTree",get:function(){return this.graphGenerator.ObstacleTree}},{key:"AncestorSets",get:function(){return this.ObstacleTree.AncestorSets}}]),l}();function Sa(){Sa=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var ba=function(l){function s(t,e,r){var i;return(i=l.call(this,null)||this).Padding=0,i.CornerFitRadius=0,i.edgeSeparatian=3,i.BendPenaltyAsAPercentageOfDistance=0,i.ShapeToObstacleMap=new Map,i.EdgesToRoute=new Array,i.removeStaircases=!0,i.selfEdges=new Array,i.Padding=e,i.CornerFitRadius=r,i.BendPenaltyAsAPercentageOfDistance=yr.DefaultBendPenaltyAsAPercentageOfDistance,i.GraphGenerator=new Pa,i.PortManager=new jc(i.GraphGenerator),i.AddShapes(t),i}X(s,l);var o=s.prototype;return o.AddEdgeGeometryToRoute=function(e){R.closeDistEps(R.RoundPoint(e.sourcePort.Location),R.RoundPoint(e.targetPort.Location))?this.selfEdges.push(e):this.EdgesToRoute.push(e)},o.RemoveAllEdgeGeometriesToRoute=function(){this.EdgesToRoute=[]},o.AddObstacles=function(e){this.AddShapes(e),this.RebuildTreeAndGraph()},o.AddShapes=function(e){for(var i,r=C(e);!(i=r()).done;)this.AddObstacleWithoutRebuild(i.value)},o.AddObstacle=function(e){this.AddObstacleWithoutRebuild(e),this.RebuildTreeAndGraph()},o.UpdateObstacles=function(e){for(var i,r=C(e);!(i=r()).done;)this.UpdateObstacleWithoutRebuild(i.value);this.RebuildTreeAndGraph()},o.UpdateObstacle=function(e){this.UpdateObstacleWithoutRebuild(e),this.RebuildTreeAndGraph()},o.RemoveObstacles=function(e){for(var i,r=C(e);!(i=r()).done;)this.RemoveObstacleWithoutRebuild(i.value);this.RebuildTreeAndGraph()},o.RemoveObstacle=function(e){this.RemoveObstacleWithoutRebuild(e),this.RebuildTreeAndGraph()},o.AddObstacleWithoutRebuild=function(e){if(null==e.BoundaryCurve)throw new Error("Shape must have a BoundaryCurve");this.CreatePaddedObstacle(e)},o.UpdateObstacleWithoutRebuild=function(e){if(null==e.BoundaryCurve)throw new Error("Shape must have a BoundaryCurve");this.PortManager.RemoveObstaclePorts(this.ShapeToObstacleMap.get(e)),this.CreatePaddedObstacle(e)},o.CreatePaddedObstacle=function(e){var r=new Ge(e,this.Padding);this.ShapeToObstacleMap.set(e,r),this.PortManager.CreateObstaclePorts(r)},o.RemoveObstacleWithoutRebuild=function(e){var r=this.ShapeToObstacleMap.get(e);this.ShapeToObstacleMap.delete(e),this.PortManager.RemoveObstaclePorts(r)},o.RemoveAllObstacles=function(){this.InternalClear(!1)},o.RebuildTreeAndGraph=function(){var e=null!=this.ObsTree.Root,r=null!=this.GraphGenerator.VisibilityGraph;this.InternalClear(!0),e&&this.GenerateObstacleTree(),r&&this.GenerateVisibilityGraph()},o.Clear=function(){this.InternalClear(!1)},s.constructorEmpty=function(){return s.constructorC(null)},s.constructorC=function(e){return new s([],s.DefaultPadding,s.DefaultCornerFitRadius)},s.constructorI=function(e){return new s(e,s.DefaultPadding,s.DefaultCornerFitRadius)},s.constructorINN=function(e,r,i){return new s(e,r,i)},s.constructorGNAN=function(e,r,i,h){var c=new s(yi.GetShapes(e),i,h);if(null==r)for(var p,f=C(e.deepEdges);!(p=f()).done;)c.AddEdgeGeometryToRoute(p.value);else for(var P,m=C(r);!(P=m()).done;)c.AddEdgeGeometryToRoute(P.value);return c},o.run=function(){this.GenerateVisibilityGraph(),this.GeneratePaths()},o.GeneratePaths=function(){var e=this.EdgesToRoute.map(function(r){return new kc(r)});this.FillEdgePathsWithShortestPaths(e),this.NudgePaths(e),this.RouteSelfEdges(),this.FinaliseEdgeGeometries()},o.RouteSelfEdges=function(){for(var r,e=C(this.selfEdges);!(r=e()).done;){var i=r.value;i.curve=sr.RouteSelfEdge(i.sourcePort.Curve,Math.max(this.Padding,2*i.GetMaxArrowheadLength()),{smoothedPolyline:null})}},o.FillEdgePathsWithShortestPaths=function(e){this.PortManager.BeginRouteEdges();for(var h,r=new Oc(this.BendPenaltyAsAPercentageOfDistance),i=C(e);!(h=i()).done;)this.AddControlPointsAndGeneratePath(r,h.value);this.PortManager.EndRouteEdges()},o.AddControlPointsAndGeneratePath=function(e,r){var i=this.PortManager.GetPortVisibilityIntersection(r.GeomEdge);null==i?this.SpliceVisibilityAndGeneratePath(e,r):this.GeneratePathThroughVisibilityIntersection(r,i)},o.GeneratePathThroughVisibilityIntersection=function(e,r){e.PathPoints=r},o.SpliceVisibilityAndGeneratePath=function(e,r){this.PortManager.AddControlPointsToGraph(r.GeomEdge,this.ShapeToObstacleMap),this.GeneratePath(e,r,!1)||this.RetryPathsWithAdditionalGroupsEnabled(e,r),this.PortManager.RemoveControlPointsFromGraph()},o.GeneratePath=function(e,r,i){var h=this.PortManager.FindVertices(r.GeomEdge.sourcePort),c=this.PortManager.FindVertices(r.GeomEdge.targetPort);return s.GetSingleStagePath(r,e,h,c,i)},s.GetSingleStagePath=function(e,r,i,h,c){return e.PathPoints=r.GetPath(i,h),c&&s.EnsureNonNullPath(e),null!=e.PathPoints&&e.PathPoints.length>0},s.EnsureNonNullPath=function(e){null==e.PathPoints&&(e.PathPoints=J.IsPureDirection(e.GeomEdge.sourcePort.Location,e.GeomEdge.targetPort.Location)?[e.GeomEdge.sourcePort.Location,e.GeomEdge.targetPort.Location]:[e.GeomEdge.sourcePort.Location,new R(e.GeomEdge.sourcePort.Location.x,e.GeomEdge.targetPort.Location.y),e.GeomEdge.targetPort.Location])},o.RetryPathsWithAdditionalGroupsEnabled=function(e,r){(!this.PortManager.SetAllAncestorsActive(r.GeomEdge,this.ShapeToObstacleMap)||!this.GeneratePath(e,r,!1))&&(this.PortManager.SetAllGroupsActive(),this.GeneratePath(e,r,!0))},o.NudgePaths=function(e){var r=this.ObsTree.SpatialAncestorsAdjusted?bn.GetAncestorSetsMap(this.Obstacles):this.AncestorsSets;Ic.NudgePaths(e,this.edgeSeparatian,this.PaddedObstacles,r,this.RemoveStaircases)},o.FinaliseEdgeGeometries=function(){for(var r,e=C(this.EdgesToRoute.concat(this.selfEdges));!(r=e()).done;){var i=r.value;null!=i.curve&&(i.curve instanceof vt&&(i.curve=s.FitArcsIntoCorners(this.CornerFitRadius,Array.from(i.curve))),s.CalculateArrowheads(i))}},o.CreateVisibilityGraph=function(){this.GraphGenerator.Clear(),this.InitObstacleTree(),this.GraphGenerator.GenerateVisibilityGraph()},s.CalculateArrowheads=function(e){vr.trimSplineAndCalculateArrowheadsII(e,e.sourcePort.Curve,e.targetPort.Curve,e.curve,!0)},o.GenerateObstacleTree=function(){if(null==this.Obstacles||0===this.Obstacles.length)throw new Error("No obstacles have been added");null==this.ObsTree.Root&&this.InitObstacleTree()},o.InitObstacleTree=function(){this.AncestorsSets=bn.GetAncestorSetsMap(this.Obstacles),this.ObsTree.Init(this.ShapeToObstacleMap.values(),this.AncestorsSets,this.ShapeToObstacleMap)},o.InternalClear=function(e){this.GraphGenerator.Clear(),this.ClearShortestPaths(),e?this.PortManager.ClearVisibility():(this.PortManager.Clear(),this.ShapeToObstacleMap.clear(),this.EdgesToRoute=[])},o.ClearShortestPaths=function(){for(var r,e=C(this.EdgesToRoute);!(r=e()).done;)r.value.curve=null},o.GenerateVisibilityGraph=function(){if(null==this.Obstacles||0===this.Obstacles.length)throw new Error("No obstacles have been set");null==this.GraphGenerator.VisibilityGraph&&this.CreateVisibilityGraph()},s.FitArcsIntoCorners=function(e,r){if(0==e)return vt.mkFromPoints(r);for(var p,i=s.GetFittedArcSegs(e,r),h=new K,c=null,f=C(i);!(p=f()).done;){var y=p.value,m=s.EllipseIsAlmostLineSegment(y);null!=c?m?K.continueWithLineSegmentP(h,s.CornerPoint(y)):(K.continueWithLineSegmentP(h,y.start),h.addSegment(y)):m?K.addLineSegment(h,r[0],s.CornerPoint(y)):(K.addLineSegment(h,r[0],y.start),h.addSegment(y)),c=y}return h.segs.length>0?K.continueWithLineSegmentP(h,r[r.length-1]):K.addLineSegment(h,r[0],r[r.length-1]),h},s.CornerPoint=function(e){return e.center.add(e.aAxis.add(e.bAxis))},s.EllipseIsAlmostLineSegment=function(e){return e.aAxis.lengthSquared<1e-4||e.aAxis.lengthSquared<1e-4},s.GetFittedArcSegs=Sa().mark(function t(e,r){var i,h,c,f,p,y,m,P,L;return Sa().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:i=r[1].sub(r[0]),h=i.normalize(),c=Math.min(e,i.length/2),f=1;case 4:if(!(f<r.length-1)){S.next=25;break}if(i=r[f+1].sub(r[f]),!((p=i.length)<q.intersectionEpsilon)){S.next=11;break}return S.next=10,new Wt(0,0,new R(0,0),new R(0,0),r[f]);case 10:return S.abrupt("continue",22);case 11:if(y=i.div(p),!(Math.abs(y.dot(h))>.9)){S.next=15;break}return S.next=15,new Wt(0,0,new R(0,0),new R(0,0),r[f]);case 15:return m=Math.min(e,i.length/2),P=y.mul(-m),L=h.mul(c),S.next=20,new Wt(0,Math.PI/2,P,L,r[f].sub(L.add(P)));case 20:h=y,c=m;case 22:f++,S.next=4;break;case 25:case"end":return S.stop()}},t)}),Q(s,[{key:"RouteToCenterOfObstacles",get:function(){return this.PortManager.RouteToCenterOfObstacles},set:function(e){this.PortManager.RouteToCenterOfObstacles=e}},{key:"LimitPortVisibilitySpliceToEndpointBoundingBox",get:function(){return this.PortManager.LimitPortVisibilitySpliceToEndpointBoundingBox},set:function(e){this.PortManager.LimitPortVisibilitySpliceToEndpointBoundingBox=e}},{key:"EdgeGeometriesToRoute",get:function(){return this.EdgesToRoute}},{key:"UseSparseVisibilityGraph",get:function(){return this.GraphGenerator instanceof Pa}},{key:"Obstacles",get:function(){return Array.from(this.ShapeToObstacleMap.values()).map(function(e){return e.InputShape})}},{key:"PaddedObstacles",get:function(){return Array.from(this.ShapeToObstacleMap.values()).map(function(e){return e.PaddedPolyline})}},{key:"VisibilityGraph",get:function(){return this.GenerateVisibilityGraph(),this.GraphGenerator.VisibilityGraph}},{key:"RemoveStaircases",get:function(){return this.removeStaircases},set:function(e){this.removeStaircases=e}},{key:"ObsTree",get:function(){return this.GraphGenerator.ObstacleTree}}]),s}(Vt);ba.DefaultPadding=1,ba.DefaultCornerFitRadius=3;var Vr=function(){function l(o,t,e,r){void 0===r&&(r=1),this.Source=o,this.Target=t,this.CrossingWeight=e,this.Weight=r}return l.prototype.toString=function(){return $t.Ld.Format("{0}->{1}",this.Source,this.Target)},l}();function Ea(){Ea=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Wc=function(){function l(){}return l.FindClosestPoints=function(o,t){var e=K.minDistWithinIntervals(o,t,o.parStart,o.parEnd,t.parStart,t.parEnd,(o.parStart+o.parEnd)/2,(t.parStart+t.parEnd)/2);if(e)return{curveClosestPoint:e.aX,labelSideClosest:e.bX}},l.GetSegmentInFrontOfLabel=function(o,t){if(o instanceof K)for(var r,e=C(o.segs);!(r=e()).done;){var i=r.value;if((i.start.y-t)*(i.end.y-t)<=0)return i}return null},l.ShiftLabel=function(o,t,e){var r=o.lineWidth/2,i=t.sub(e),h=i.length;h>r&&o.label.positionCenter(o.label.center.add(i.div(h*(h-r))))},l.updateLabel=function(o,t){var e=null;t.labelIsToTheRightOfTheSpline?(o.label.positionCenter(new R(t.x+t.rightAnchor/2,t.y)),e=Z.mkPP(o.label.boundingBox.leftTop,o.label.boundingBox.leftBottom)):t.labelIsToTheLeftOfTheSpline&&(o.label.positionCenter(new R(t.x-t.leftAnchor/2,t.y)),e=Z.mkPP(o.label.boundingBox.rightTop,o.label.boundingBox.rightBottom));var r=l.GetSegmentInFrontOfLabel(o.curve,o.label.center.y);if(null!=r&&0===K.getAllIntersections(o.curve,K.polyFromBox(o.label.boundingBox),!1).length){var i=l.FindClosestPoints(r,e);if(i)l.ShiftLabel(o,i.curveClosestPoint,i.labelSideClosest);else{var h,c,f=r.closestParameter(e.start),p=r.closestParameter(e.end);r.value(f).sub(e.start).length<r.value(p).sub(e.end).length?(h=r.value(f),c=e.start):(h=r.value(p),c=e.end),l.ShiftLabel(o,h,c)}}},l}(),wr=function(l){function s(t,e,r,i,h){void 0===i&&(i=1),void 0===h&&(h=1),this.reversed=!1,this.source=t,this.target=e,this.edge=r,this.weight=i,this.separation=h}var o=s.prototype;return o.reverse=function(){var e=this.source;this.source=this.target,this.target=e,this.reversed=!this.reversed},o.toString=function(){return"edge("+this.source+"->"+this.target+")"},o.isSelfEdge=function(){return this.source===this.target},o.reversedClone=function(){var e=new s(this.target,this.source,this.edge);if(null!=this.LayerEdges){var r=this.LayerEdges.length;e.LayerEdges=new Array(r);for(var i=0;i<r;i++){var h=this.LayerEdges[r-1-i];e.LayerEdges[i]=new Vr(h.Target,h.Source,h.CrossingWeight)}e.LayerEdges[0].Source=this.target,e.LayerEdges[this.LayerEdges.length-1].Target=this.source}return e},o.getNode=function(e){if(e>=0){if(e<this.LayerEdges.length)return this.LayerEdges[e].Source;if(e===this.LayerEdges.length)return this.LayerEdges[e-1].Target}throw new Error("wrong index "+e)},o.updateEdgeLabelPosition=function(e){null!=this.edge.label&&Wc.updateLabel(this.edge,e[this.LayerEdges[this.LayerEdges.length/2].Source])},o[l]=function(){return this.nodes()},o.nodes=Ea().mark(function t(){var e,r,i;return Ea().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.LayerEdges[0].Source;case 2:e=C(this.LayerEdges);case 3:if((r=e()).done){c.next=9;break}return i=r.value,c.next=7,i.Target;case 7:c.next=3;break;case 9:case"end":return c.stop()}},t,this)}),Q(s,[{key:"CrossingWeight",get:function(){return 1}},{key:"hasLabel",get:function(){return null!=this.edge.label}},{key:"labelWidth",get:function(){return this.edge.label.width}},{key:"labelHeight",get:function(){return this.edge.label.height}},{key:"curve",get:function(){return this.edge.curve},set:function(e){this.edge.curve=e}},{key:"underlyingPolyline",get:function(){return this.edge.smoothedPolyline},set:function(e){this.edge.smoothedPolyline=e}},{key:"LayerSpan",get:function(){return null!=this.LayerEdges?this.LayerEdges.length:0}},{key:"count",get:function(){return this.LayerEdges.length}}]),s}(Symbol.iterator);function Ii(){Ii=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var _e,re,Hc=function(){function l(){this.maxLayerOfGeomGraph=new Set,this.minLayerOfGeomGraph=new Set,this.sameLayerConstraints=new Array,this.upDownConstraints=new Array,this.gluedUpDownIntConstraints=new mr,this.sameLayerDictionaryOfRepresentatives=new Map,this.representativeToItsLayer=new Map,this.maxLayerInt=new Array,this.minLayerInt=new Array,this.sameLayerInts=new Array,this.upDownInts=new Array}var s=l.prototype;return s.getFeedbackSetExternal=function(t,e){throw new Error("Method not implemented.")},s.pinNodeToMaxLayer=function(t){this.maxLayerOfGeomGraph.add(t)},s.pinNodeToMinLayer=function(t){this.minLayerOfGeomGraph.add(t)},s.clear=function(){this.maxLayerOfGeomGraph.clear(),this.minLayerOfGeomGraph.clear(),this.sameLayerConstraints=[],this.upDownConstraints=[]},s.getFeedbackSetImp=function(t,e){return this.nodeIdToIndex=e,this.intGraph=t,this.maxRepresentative=-1,this.minRepresentative=-1,this.createIntegerConstraints(),this.glueTogetherSameConstraintsMaxAndMin(),this.addMaxMinConstraintsToGluedConstraints(),this.removeCyclesFromGluedConstraints(),this.getFeedbackSet()},s.removeCyclesFromGluedConstraints=function(){for(var i,t=Ke(Array.from(this.gluedUpDownIntConstraints.values()),this.intGraph.nodeCount),r=C(mi.getFeedbackSetWithConstraints(t,null));!(i=r()).done;)this.gluedUpDownIntConstraints.remove(i.value)},s.addMaxMinConstraintsToGluedConstraints=function(){if(-1!==this.maxRepresentative)for(var t=0;t<this.intGraph.nodeCount;t++){var e=this.nodeToRepr(t);e!==this.maxRepresentative&&this.gluedUpDownIntConstraints.add(new Lt(this.maxRepresentative,e))}if(-1!==this.minRepresentative)for(var r=0;r<this.intGraph.nodeCount;r++){var i=this.nodeToRepr(r);i!==this.minRepresentative&&this.gluedUpDownIntConstraints.add(new Lt(i,this.minRepresentative))}},s.glueTogetherSameConstraintsMaxAndMin=function(){this.createDictionaryOfSameLayerRepresentatives(),this.upDownInts.map(this.gluedIntPairNN),this.gluedUpDownIntConstraints=new mr},s.gluedIntPairNN=function(t){return new Lt(this.nodeToRepr(t[0]),this.nodeToRepr(t[1]))},s.gluedIntPairI=function(t){return new Lt(this.nodeToRepr(t.source),this.nodeToRepr(t.target))},s.gluedIntPair=function(t){return new Lt(this.nodeToRepr(t.source),this.nodeToRepr(t.target))},s.gluedIntEdge=function(t){var e=this.nodeToRepr(t.source),r=this.nodeToRepr(t.target),i=new wr(e,r,t.edge);return i.separation=t.separation,i.weight=0,i},s.nodeToRepr=function(t){return this.sameLayerDictionaryOfRepresentatives.get(t)||t},s.createDictionaryOfSameLayerRepresentatives=function(){for(var r,e=C(on(this.createGraphOfSameLayers()));!(r=e()).done;)this.glueSameLayerNodesOfALayer(r.value)},s.createGraphOfSameLayers=function(){return Ke(this.createEdgesOfSameLayers(),this.intGraph.nodeCount)},s.createEdgesOfSameLayers=function(){var t=this,e=new Array;return-1!==this.maxRepresentative&&this.maxLayerInt.filter(function(r){return r!==t.maxRepresentative}).map(function(r){return new Lt(t.maxRepresentative,r)}).forEach(function(r){return e.push(r)}),-1!==this.minRepresentative&&this.minLayerInt.filter(function(r){return r!==t.minRepresentative}).map(function(r){return new Lt(t.minRepresentative,r)}).forEach(function(r){return e.push(r)}),this.sameLayerInts.forEach(function(r){return e.push(new Lt(r[0],r[1]))}),e},s.glueSameLayerNodesOfALayer=function(t){if(t.length>1){var e=-1;if(this.componentsIsMaxLayer(t))for(var i,r=C(t);!(i=r()).done;)this.sameLayerDictionaryOfRepresentatives.set(i.value,e=this.maxRepresentative);else if(this.componentIsMinLayer(t))for(var f,c=C(t);!(f=c()).done;)this.sameLayerDictionaryOfRepresentatives.set(f.value,e=this.minRepresentative);else for(var m,y=C(t);!(m=y()).done;){var P=m.value;-1===e&&(e=P),this.sameLayerDictionaryOfRepresentatives.set(P,e)}this.representativeToItsLayer.set(e,t)}},s.componentIsMinLayer=function(t){var e=this;return t.findIndex(function(r){return e.minRepresentative===r})>=0},s.componentsIsMaxLayer=function(t){var e=this;return t.findIndex(function(r){return e.maxRepresentative===r})>=0},s.createIntegerConstraints=function(){this.createMaxIntConstraints(),this.createMinIntConstraints(),this.createUpDownConstraints(),this.createSameLayerConstraints()},s.createSameLayerConstraints=function(){this.sameLayerInts=this.createIntConstraintsFromStringCouples(this.sameLayerConstraints)},s.createUpDownConstraints=function(){this.upDownInts=this.createIntConstraintsFromStringCouples(this.upDownConstraints)},s.createIntConstraintsFromStringCouples=function(t){var e=this;return t.map(function(r){return[e.nodeIndex(r[0]),e.nodeIndex(r[1])]}).filter(function(r){return-1!==r[0]&&-1!==r[1]})},s.createMinIntConstraints=function(){this.minLayerInt=this.createIntConstraintsFromExtremeLayer(this.minLayerOfGeomGraph),this.minLayerInt.length>0&&(this.minRepresentative=this.minLayerInt[0])},s.createMaxIntConstraints=function(){this.maxLayerInt=this.createIntConstraintsFromExtremeLayer(this.maxLayerOfGeomGraph),this.maxLayerInt.length>0&&(this.maxRepresentative=this.maxLayerInt[0])},s.createIntConstraintsFromExtremeLayer=function(t){var e=this;return Array.from(t).map(function(r){return e.nodeIndex(r)}).filter(function(r){return-1!==r})},s.nodeIndex=function(t){return this.nodeIdToIndex.get(t.node.id)||-1},s.getFeedbackSet=function(){return this.gluedIntGraph=this.createGluedGraph(),Array.from(this.unglueIntPairs(mi.getFeedbackSetWithConstraints(this.gluedIntGraph,this.gluedUpDownIntConstraints)))},s.unglueIntPairs=Ii().mark(function o(t){var e,r,h,c,f;return Ii().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(t);case 1:if((r=e()).done){y.next=12;break}h=C(this.unglueEdge(r.value));case 4:if((c=h()).done){y.next=10;break}return f=c.value,y.next=8,f;case 8:y.next=4;break;case 10:y.next=1;break;case 12:case"end":return y.stop()}},o,this)}),s.unglueEdge=Ii().mark(function o(t){var e,r,h,c,f;return Ii().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:e=C(this.unglueNode(t.source));case 1:if((r=e()).done){y.next=13;break}h=C(this.intGraph.outEdges[r.value]);case 4:if((c=h()).done){y.next=11;break}if(this.nodeToRepr((f=c.value).target)!==t.target){y.next=9;break}return y.next=9,f;case 9:y.next=4;break;case 11:y.next=1;break;case 13:case"end":return y.stop()}},o,this)}),s.createGluedGraph=function(){var t=this,e=new mr;return this.intGraph.edges.forEach(function(r){return e.add(t.gluedIntPairI(r))}),Ke(Array.from(e.values()),this.intGraph.nodeCount)},s.unglueNode=function(t){return this.representativeToItsLayer.get(t)||[t]},s.getGluedNodeCounts=function(){for(var t=new Array(this.nodeIdToIndex.size).fill(0),e=0;e<t.length;e++)t[this.nodeToRepr(e)]++;return t},Q(l,[{key:"isEmpty",get:function(){return 0===this.maxLayerOfGeomGraph.size&&0===this.minLayerOfGeomGraph.size&&0===this.sameLayerConstraints.length&&0===this.upDownConstraints.length}}]),l}(),zc=function(){function l(){this.leftRightConstraints=new Array,this.leftRightNeighbors=new Array,this.nodeToBlockRoot=new Map,this.upDownVerticalConstraints=new Array,this.BlockRootToBlock=new Map}var s=l.prototype;return s.AddSameLayerNeighbors=function(t){for(var e=0;e<t.length-1;e++)this.AddSameLayerNeighborsPair(t[e],t[e+1])},s.AddSameLayerNeighborsPair=function(t,e){this.leftRightNeighbors.push([t,e])},s.NodeToBlockRootSoft=function(t){return this.nodeToBlockRoot.get(t)||t},s.CreateMappingOfNeibBlocks=function(){for(var t=this.BasicGraphFromLeftRightIntNeibs(),e=0;e<t.nodeCount;e++)if(0===t.inEdges[e].length&&!this.nodeToBlockRoot.has(e)){for(var r=new Array,i=e,h=t.outEdges[i];h.length>0;h=t.outEdges[i])r.push(i=h[0].y),this.nodeToBlockRoot.set(i,e);r.length>0&&this.BlockRootToBlock.set(e,r)}},s.BasicGraphFromLeftRightIntNeibs=function(){return eo(Array.from(this.LeftRightIntNeibs.values()).map(function(t){return new Lt(t.x,t.y)}))},s.NodeIndex=function(t){return this.nodeIdToIndex.get(t.id)||-1},s.PrepareForOrdering=function(t,e){this.nodeIdToIndex=t,this.MapNodesToToIntegers(e),this.CreateMappingOfNeibBlocks(),this.LiftLeftRightRelationsToNeibBlocks()},s.LiftLeftRightRelationsToNeibBlocks=function(){var t=this;this.LeftRighInts=mr.mk(this.leftRightConstraints.map(function(c){return function(l,s){return[l,s]}(t.NodeIndex(c[0]),t.NodeIndex(c[1]))}).filter(function(c){return-1!==c[0]&&-1!==c[1]}).map(function(c){return new Lt(t.NodeToBlockRootSoft(c[0]),t.NodeToBlockRootSoft(c[1]))}).filter(function(c){return c.x!=c.x}));for(var i,r=C(mi.getFeedbackSet(eo(Array.from(this.LeftRighInts.values()))));!(i=r()).done;){var h=i.value;this.LeftRighInts.remove(new Lt(h.source,h.target))}},s.MapNodesToToIntegers=function(t){var e=this;this.LeftRightIntNeibs=mr.mk(Array.from(this.leftRightNeighbors.values()).map(function(r){return[e.NodeIndex(r[0]),e.NodeIndex(r[1])]}).filter(function(r){return-1!==r[0]&&-1!==r[1]}).map(function(r){return new Lt(r[0],r[1])})),this.VerticalInts=mr.mk(this.upDownVerticalConstraints.map(function(r){return[e.NodeIndex(r[0]),e.NodeIndex(r[1])]}).filter(function(r){return-1!==r[0]&&-1!==r[1]&&t[r[0]]>t[r[1]]}).map(function(r){return new Lt(r[0],r[1])}))},Q(l,[{key:"IsEmpty",get:function(){return 0===this.leftRightNeighbors.length&&0===this.upDownVerticalConstraints.length&&0===this.leftRightConstraints.length}}]),l}();!function(l){l[l.TB=0]="TB",l[l.LR=1]="LR",l[l.BT=2]="BT",l[l.RL=3]="RL",l[l.None=4]="None"}(_e||(_e={})),function(l){l[l.Spline=0]="Spline",l[l.SplineBundling=1]="SplineBundling",l[l.StraightLine=2]="StraightLine",l[l.SugiyamaSplines=3]="SugiyamaSplines",l[l.Rectilinear=4]="Rectilinear",l[l.RectilinearToCenter=5]="RectilinearToCenter",l[l.None=6]="None"}(re||(re={}));var zn,Ca=function(){function l(){this.coneAngle=Math.PI/180*30,this.padding=2,this.polylinePadding=1,this.routingToParentConeAngle=Math.PI/6,this.simpleSelfLoopsForParentEdgesThreshold=200,this.incrementalRoutingThreshold=5e6,this.routeMultiEdgesAsBundles=!0,this.KeepOriginalSpline=!1,this.EdgeRoutingMode=re.Spline}return l.prototype.toJSON=function(){var t={};return this.EdgeRoutingMode!=re.Spline&&(t.edgeRoutingMode=re.Spline),this.ConeAngle!=Math.PI/180*30&&(t.coneAngle=this.ConeAngle),3!=this.padding&&(t.padding=this.padding),1.5!=this.polylinePadding&&(t.polylinePadding=this.polylinePadding),this.bundlingSettings&&(t.bundlingSettingsJSON=this.bundlingSettings.toJSON()),t},l.fromJSON=function(t){var e=new l;return t.edgeRoutingMode&&(t.edgeRoutingMode=e.edgeRoutingMode),t.coneAngle&&(e.coneAngle=t.coneAngle),t.padding&&(e.padding=t.padding),t.polylinePadding&&(e.polylinePadding=t.polylinePadding),t.bundlingSettingsJSON&&(e.bundlingSettings=tn.createFromJSON(t.bundlingSettingsJSON)),t.routingToParentConeAngle&&(e.routingToParentConeAngle=t.routingToParentConeAngle),t.simpleSelfLoopsForParentEdgesThreshold&&(e.simpleSelfLoopsForParentEdgesThreshold=t.simpleSelfLoopsForParentEdgesThreshold),t.incrementalRoutingThreshold&&(e.incrementalRoutingThreshold=t.incrementalRoutingThreshold),t.routeMultiEdgesAsBundles&&(e.routeMultiEdgesAsBundles=t.routeMultiEdgesAsBundles),t.KeepOriginalSpline&&(e.KeepOriginalSpline=t.KeepOriginalSpline),e},Q(l,[{key:"EdgeRoutingMode",get:function(){return this.edgeRoutingMode},set:function(t){t===re.SplineBundling&&null==this.bundlingSettings&&null==this.bundlingSettings&&(this.bundlingSettings=new tn),this.edgeRoutingMode=t}},{key:"ConeAngle",get:function(){return this.coneAngle},set:function(t){this.coneAngle=t}},{key:"Padding",get:function(){return this.padding},set:function(t){this.padding=t}},{key:"PolylinePadding",get:function(){return this.polylinePadding},set:function(t){this.polylinePadding=t}},{key:"RoutingToParentConeAngle",get:function(){return this.routingToParentConeAngle},set:function(t){this.routingToParentConeAngle=t}},{key:"SimpleSelfLoopsForParentEdgesThreshold",get:function(){return this.simpleSelfLoopsForParentEdgesThreshold},set:function(t){this.simpleSelfLoopsForParentEdgesThreshold=t}},{key:"IncrementalRoutingThreshold",get:function(){return this.incrementalRoutingThreshold},set:function(t){this.incrementalRoutingThreshold=t}},{key:"RouteMultiEdgesAsBundles",get:function(){return this.routeMultiEdgesAsBundles},set:function(t){this.routeMultiEdgesAsBundles=t}}]),l}(),po=function(){function l(){this.edgeRoutingSettings=new Ca,this.nodeSeparation=10,this.packingAspectRatio=1.5}return l.fromJSON=function(t){var e=new l;return 10!=t.nodeSeparation&&(e.nodeSeparation=t.nodeSeparation),t.packingAspectRatio&&(e.packingAspectRatio=t.packingAspectRatio),t.edgeRoutingSettings&&(e.edgeRoutingSettings=Ca.fromJSON(t.edgeRoutingSettings)),e},l.prototype.toJSON=function(){var t=!1,e={};return 10!=this.nodeSeparation&&(e.nodeSeparation=this.nodeSeparation,t=!0),1.5!=this.packingAspectRatio&&(e.packingAspectRatio=this.packingAspectRatio,t=!0),(e.edgeRoutingSettings=this.edgeRoutingSettings.toJSON())&&(t=!0),t?e:void 0},Q(l,[{key:"NodeSeparation",get:function(){return this.nodeSeparation},set:function(t){this.nodeSeparation=t}},{key:"PackingAspectRatio",get:function(){return this.packingAspectRatio},set:function(t){this.packingAspectRatio=t}}]),l}();!function(l){l[l.None=0]="None",l[l.Top=1]="Top",l[l.Bottom=2]="Bottom"}(zn||(zn={}));var La=function(){function l(){this.commonSettings=new po,this.verticalConstraints=new Hc,this.horizontalConstraints=new zc,this.NoGainAdjacentSwapStepsBound=5,this.RepetitionCoefficientForOrdering=1,this.AspectRatio=0,this.MaxNumberOfPassesInOrdering=24,this.BrandesThreshold=600,this.LabelCornersPreserveCoefficient=.1,this.MinNodeHeight=9,this.MinNodeWidth=13.5,this.SnapToGridByY=zn.None,this.yLayerSep=30,this.transform=Ve.getIdentity(),this.GridSizeByY=0,this.GridSizeByX=0,this.commonSettings.edgeRoutingSettings.EdgeRoutingMode=re.SugiyamaSplines}var s=l.prototype;return s.toJSON=function(){var t={};return this.sameRanks&&(t.sameRanks=this.sameRanks),this.verticalConstraints&&(t.verticalConstraints=this.verticalConstraints),this.horizontalConstraints&&(t.horizontalConstraints=this.horizontalConstraints),5!=this.NoGainAdjacentSwapStepsBound&&(t.horizontalConstraints=this.horizontalConstraints),1!=this.RepetitionCoefficientForOrdering&&(t.RepetitionCoefficientForOrdering=this.RepetitionCoefficientForOrdering),this.AspectRatio&&(t.AspectRatio=this.AspectRatio),24!=this.MaxNumberOfPassesInOrdering&&(t.MaxNumberOfPassesInOrdering=this.MaxNumberOfPassesInOrdering),600!=this.BrandesThreshold&&(t.BrandesThreshold=this.BrandesThreshold),.1!=this.LabelCornersPreserveCoefficient&&(t.LabelCornersPreserveCoefficient=this.LabelCornersPreserveCoefficient),9!=this.MinNodeHeight&&(t.MinNodeHeight=this.MinNodeHeight),13.5!=this.MinNodeWidth&&(t.MinNodeWidth=this.MinNodeWidth),this.SnapToGridByY!=zn.None&&(t.SnapToGridByY=this.SnapToGridByY),30!=this.yLayerSep&&(t.yLayerSep=this.yLayerSep),this.transform&&(t.transform=this.transform.elements),this.GridSizeByY&&(t.GridSizeByY=this.GridSizeByY),this.GridSizeByX&&(t.GridSizeByX=this.GridSizeByX),t.commonLayoutSettings=this.commonSettings.toJSON(),t},l.fromJSON=function(t){var e=new l;return t.sameRanks&&(e.sameRanks=t.sameRanks),t.verticalConstraints&&(e.verticalConstraints=t.verticalConstraints),t.horizontalConstraints&&(e.horizontalConstraints=t.horizontalConstraints),t.NoGainAdjacentSwapStepsBound&&(e.horizontalConstraints=t.horizontalConstraints),t.RepetitionCoefficientForOrdering&&(e.RepetitionCoefficientForOrdering=t.RepetitionCoefficientForOrdering),t.AspectRatio&&(e.AspectRatio=t.AspectRatio),t.MaxNumberOfPassesInOrdering&&(e.MaxNumberOfPassesInOrdering=t.MaxNumberOfPassesInOrdering),t.BrandesThreshold&&(e.BrandesThreshold=t.BrandesThreshold),t.LabelCornersPreserveCoefficient&&(e.LabelCornersPreserveCoefficient=t.LabelCornersPreserveCoefficient),t.MinNodeHeight&&(e.MinNodeHeight=t.MinNodeHeight),t.MinNodeWidth&&(e.MinNodeWidth=e.MinNodeWidth),t.SnapToGridByY&&(e.SnapToGridByY=t.SnapToGridByY),t.yLayerSep&&(e.yLayerSep=t.yLayerSep),t.transform&&(e.transform=new Ve(t.transform[0][0],t.transform[0][1],t.transform[0][2],t.transform[1][0],t.transform[1][1],t.transform[1][2])),t.GridSizeByY&&(e.GridSizeByY=t.GridSizeByY),t.GridSizeByX&&(e.GridSizeByX=t.GridSizeByX),t.commonLayoutSettings&&(e.commonSettings=po.fromJSON(t.commonLayoutSettings)),e},s.ActualLayerSeparation=function(t){return t?this.LayerSeparation/2:this.LayerSeparation},s.transformIsRotation=function(t){for(var e=Ve.rotation(t),r=0;r<2;r++)for(var i=0;i<3;i++)if(!dt(e.elements[r][i],this.transform.elements[r][i]))return!1;return!0},Q(l,[{key:"NodeSeparation",get:function(){return this.commonSettings.NodeSeparation}},{key:"edgeRoutingSettings",get:function(){return this.commonSettings.edgeRoutingSettings},set:function(t){this.commonSettings.edgeRoutingSettings=t}},{key:"LayerSeparation",get:function(){return this.yLayerSep},set:function(t){this.yLayerSep=Math.max(30,t)}},{key:"layerDirection",get:function(){return this.transformIsRotation(0)?_e.TB:this.transformIsRotation(Math.PI/2)?_e.LR:this.transformIsRotation(-Math.PI/2)?_e.RL:this.transformIsRotation(Math.PI)?_e.BT:_e.None},set:function(t){switch(t){case _e.TB:this.transform=Ve.getIdentity();break;case _e.LR:this.transform=Ve.rotation(Math.PI/2);break;case _e.RL:this.transform=Ve.rotation(-Math.PI/2);break;case _e.BT:this.transform=Ve.rotation(Math.PI);break;default:throw new Error("unexpected layout direction")}}}]),l}(),Mu=function(l){function s(t,e,r){var i;return(i=l.call(this,null)||this).graph=t,i.source=e,i.length=r,i}return X(s,l),s.prototype.run=function(){for(var h,e=new Gr(function(_,D){return _-D}),r=new Map,i=C(this.graph.shallowNodes);!(h=i()).done;){var c=h.value,f=c===this.source?0:Number.POSITIVE_INFINITY;e.Enqueue(c,f),r.set(c,f)}for(;e.count>0;){var p={priority:0},y=e.DequeueAndGetPriority(p);r.set(y,p.priority);for(var L,m=r.get(y),P=C(y.inEdges());!(L=P()).done;){var E=L.value,S=E.source,T=m+this.length(E);r.get(S)>T&&(r.set(S,T),e.DecreasePriority(S,T))}for(var x,O=C(y.outEdges());!(x=O()).done;){var B=x.value,M=B.target,F=m+this.length(B);r.get(M)>F&&(r.set(M,F),e.DecreasePriority(M,F))}}this.result=new Array(this.graph.shallowNodeCount);for(var V,A=0,z=C(this.graph.shallowNodes);!(V=z()).done;){var W=r.get(V.value);this.result[A++]=void 0!==W?W:Number.POSITIVE_INFINITY}},Q(s,[{key:"Result",get:function(){return this.result}}]),s}(Vt),qc=function(l){function s(t,e){var r;return(r=l.call(this,null)||this).graph=t,r.length=e,r}return X(s,l),s.prototype.run=function(){this.result=new Array(this.graph.shallowNodeCount);for(var i,e=0,r=C(this.graph.shallowNodes);!(i=r()).done;){var c=new Mu(this.graph,i.value,this.length);c.run(),this.Result[e++]=c.Result}},s.Stress=function(e,r){var i=0;if(0===e.edgeCount)return i;var h=new s(e,r);h.run();for(var y,c=h.Result,f=0,p=C(e.shallowEdges);!(y=p()).done;)f+=r(y.value);f/=e.edgeCount;for(var E,P=0,L=C(e.shallowNodes);!(E=L()).done;){for(var x,S=E.value,T=0,O=C(e.shallowNodes);!(x=O()).done;){if(P!==T){var M=S.center.sub(x.value.center).length,F=f*c[P][T],A=F-M;i+=A*A/(F*F)}T++}P++}return i},Q(s,[{key:"Result",get:function(){return this.result},set:function(e){this.result=e}}]),s}(Vt),Uc=function(l){function s(t,e,r){var i;return(i=l.call(this,null)||this).graph=t,i.pivotArray=e,i.length=r,i}return X(s,l),s.prototype.run=function(){this.result=new Array(this.pivotArray.length);var e=Array.from(this.graph.shallowNodes),r=new Array(this.graph.shallowNodeCount).fill(Number.POSITIVE_INFINITY),i=e[0];this.pivotArray[0]=0;for(var h=0;;h++){var c=new Mu(this.graph,i,this.length);if(c.run(),this.Result[h]=c.Result,!(h+1<this.pivotArray.length))break;for(var f=0,p=0;p<this.Result[h].length;p++)r[p]=Math.min(r[p],this.Result[h][p]),r[p]>r[f]&&(f=p);i=e[f],this.pivotArray[h+1]=f}},Q(s,[{key:"Result",get:function(){return this.result}}]),s}(Vt),Yc=function(){function l(){}return l.Rotate=function(o,t,e){for(var r=Math.sin(e*(Math.PI/180)),i=Math.cos(e*(Math.PI/180)),h=0;h<o.length;h++){var c=i*o[h]+r*t[h];t[h]=i*t[h]-r*o[h],o[h]=c}},l}(),Ia=function(){function l(){}return l.DoubleCenter=function(o){for(var t=new Array(o.length).fill(0),e=new Array(o[0].length).fill(0),r=0,i=0;i<o.length;i++)for(var h=0;h<o[0].length;h++)t[i]+=o[i][h],e[h]+=o[i][h],r+=o[i][h];for(var c=0;c<o.length;c++)t[c]/=o.length;for(var f=0;f<o[0].length;f++)e[f]/=o[0].length;r/=o.length,r/=o[0].length;for(var p=0;p<o.length;p++)for(var y=0;y<o[0].length;y++)o[p][y]-=t[p]+e[y]-r},l.SquareEntries=function(o){for(var t=0;t<o.length;t++)for(var e=0;e<o[0].length;e++)o[t][e]=Math.pow(o[t][e],2)},l.Multiply=function(o,t){for(var e=0;e<o.length;e++)for(var r=0;r<o[0].length;r++)o[e][r]*=t},l.MultiplyX=function(o,t){if(o[0].length!==t.length)return null;for(var e=new Array(t.length).fill(0),r=0;r<o.length;r++)for(var i=0;i<o[0].length;i++)e[r]+=o[r][i]*t[i];return e},l.Norm=function(o){for(var t=0,e=0;e<o.length;e++)t+=Math.pow(o[e],2);return Math.sqrt(t)},l.Normalize=function(o){var t=l.Norm(o);if(t<=0)return 0;for(var e=0;e<o.length;e++)o[e]/=t;return t},l.RandomUnitLengthVector=function(o){for(var t=new Array(o),e=0;e<o;e++)t[e]=nn();return l.Normalize(t),t},l.SpectralDecomposition=function(o,t){l.SpectralDecompositionIE(o,t,30,1e-6)},l.SpectralDecompositionIE=function(o,t,e,r){var i=o[0].length;t.u1=l.RandomUnitLengthVector(i),t.lambda1=0,t.u2=l.RandomUnitLengthVector(i),t.lambda2=0;for(var h=0,c=1-r,f=0;f<e&&h<c;f++){var p=l.MultiplyX(o,t.u1),y=l.MultiplyX(o,t.u2);t.lambda1=l.Normalize(p),t.lambda2=l.Normalize(y),l.MakeOrthogonal(y,p),l.Normalize(y),h=Math.min(l.DotProduct(t.u1,p),l.DotProduct(t.u2,y)),t.u1=p,t.u2=y}},l.DotProduct=function(o,t){if(o.length!==t.length)return 0;for(var e=0,r=0;r<o.length;r++)e+=o[r]*t[r];return e},l.MakeOrthogonal=function(o,t){if(o.length===t.length)for(var e=l.DotProduct(o,t)/l.DotProduct(t,t),r=0;r<o.length;r++)o[r]-=e*t[r]},l.ClassicalScaling=function(o,t){for(var e=new Array(o.length),r=0;r<o.length;r++)e[r]=o[r].slice();l.SquareEntries(e),l.DoubleCenter(e),l.Multiply(e,-.5),l.SpectralDecomposition(e,t),t.lambda1=Math.sqrt(Math.abs(t.lambda1)),t.lambda2=Math.sqrt(Math.abs(t.lambda2));for(var i=0;i<t.u1.length;i++)t.u1[i]*=t.lambda1,t.u2[i]*=t.lambda2},l.DistanceScalingSubset=function(o,t,e,r,i){for(var h=t.length,c=o.length,f=new Array(c),p=0;p<c;p++)for(var y=0;y<h;y++)0===o[p][y]&&(f[p]=y);for(var m=new Array(c).fill(0),P=0;P<c;P++)for(var L=0;L<h;L++)f[P]!==L&&(m[P]+=r[P][L]);for(var E=0;E<i;E++)for(var S=0;S<c;S++){for(var T=0,O=0,x=0;x<h;x++)if(S!==x){var B=Math.sqrt(Math.pow(t[f[S]]-t[x],2)+Math.pow(e[f[S]]-e[x],2));B>0&&(B=1/B),T+=r[S][x]*(t[x]+o[S][x]*(t[f[S]]-t[x])*B),O+=r[S][x]*(e[x]+o[S][x]*(e[f[S]]-e[x])*B)}t[f[S]]=T/m[S],e[f[S]]=O/m[S]}},l.DistanceScaling=function(o,t,e,r,i){for(var h=t.length,c=new Array(h).fill(0),f=0;f<h;f++)for(var p=0;p<h;p++)f!==p&&(c[f]+=r[f][p]);for(var y=0;y<i;y++)for(var m=0;m<h;m++){for(var P=0,L=0,E=0;E<h;E++)if(m!==E){var S=Math.sqrt(Math.pow(t[m]-t[E],2)+Math.pow(e[m]-e[E],2));S>0&&(S=1/S),P+=r[m][E]*(t[E]+o[m][E]*(t[m]-t[E])*S),L+=r[m][E]*(e[E]+o[m][E]*(e[m]-e[E])*S)}t[m]=P/c[m],e[m]=L/c[m]}},l.ExponentialWeightMatrix=function(o,t){for(var e=new Array(o.length),r=0;r<o.length;r++){e[r]=new Array(o[r].length).fill(0);for(var i=0;i<o[r].length;i++)o[r][i]>0&&(e[r][i]=Math.pow(o[r][i],t))}return e},l.EuclideanDistanceMatrix=function(o,t){for(var e=new Array(o.length),r=0;r<o.length;r++){e[r]=new Array(o.length);for(var i=0;i<o.length;i++)e[r][i]=Math.sqrt(Math.pow(o[r]-o[i],2)+Math.pow(t[r]-t[i],2))}return e},l.LandmarkClassicalScaling=function(o,t,e){for(var r=new Array(o.length),i=0;i<o.length;i++){r[i]=new Array(o.length);for(var h=0;h<o.length;h++)r[i][h]=o[i][e[h]]}l.SquareEntries(r);for(var c=new Array(o.length).fill(0),f=0;f<o.length;f++){for(var p=0;p<o.length;p++)c[f]+=r[f][p];c[f]/=o.length}l.DoubleCenter(r),l.Multiply(r,-.5);var y={u1:new Array,u2:new Array,lambda1:0,lambda2:0};l.SpectralDecomposition(r,y),y.lambda1=Math.sqrt(Math.abs(y.lambda1)),y.lambda2=Math.sqrt(Math.abs(y.lambda2)),t.x=new Array(o[0].length).fill(0),t.y=new Array(o[0].length).fill(0);for(var m=0;m<t.x.length;m++)for(var P=0;P<r.length;P++){var L=(Math.pow(o[P][m],2)-c[P])/2;t.x[m]-=y.u1[P]*L,t.y[m]-=y.u2[P]*L}},l}(),Qc=function(){function l(o,t){this.constrained=!1,this.Capacity=1e6,1===Ne.AbovePP(o.point,t.point)?(this.upperSite=o,this.lowerSite=t):(this.lowerSite=o,this.upperSite=t),this.upperSite.AddEdgeToSite(this)}var s=l.prototype;return s.GetOtherTriangle_c=function(t){return this.cwTriangle.Contains(t)?this.ccwTriangle:this.cwTriangle},s.IsAdjacent=function(t){return t===this.upperSite||t===this.lowerSite},s.GetOtherTriangle_T=function(t){return this.ccwTriangle===t?this.cwTriangle:this.ccwTriangle},s.toString=function(){return $t.Ld.Format("({0},{1})",this.upperSite,this.lowerSite)},s.OtherSite=function(t){return this.upperSite===t?this.lowerSite:this.upperSite},Q(l,[{key:"CcwTriangle",get:function(){return this.ccwTriangle},set:function(t){this.ccwTriangle=t}},{key:"CwTriangle",get:function(){return this.cwTriangle},set:function(t){this.cwTriangle=t}}]),l}();function xa(){xa=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ta=function(){function l(o){this.Owner=null,this.InEdges=new Array,this.point=o}var s=l.prototype;return s.cleanRemovedEdges=function(){for(var e,t=C(this.Edges);!(e=t()).done;){var r=e.value;null===r.CcwTriangle&&null===r.CwTriangle&&this.Edges.splice(this.Edges.indexOf(r),1)}},l.mkSO=function(t,e){var r=new l(t);return r.Owner=e,r},s.AddEdgeToSite=function(t){null==this.Edges&&(this.Edges=new Array),this.Edges.push(t)},s.EdgeBetweenUpperSiteAndLowerSite=function(t){if(null!=this.Edges)for(var r,e=C(this.Edges);!(r=e()).done;){var i=r.value;if(i.lowerSite===t)return i}return null},s.AddInEdge=function(t){this.InEdges.push(t)},s.Triangles=xa().mark(function o(){var t,e,r,i;return xa().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(null!=this.Edges&&this.Edges.length>0)){c.next=4;break}t=this.Edges[0],c.next=9;break;case 4:if(!(null!=this.InEdges&&this.InEdges.length>0)){c.next=8;break}t=this.InEdges[0],c.next=9;break;case 8:return c.abrupt("return");case 9:e=t;case 10:if(null!=(r=e.upperSite===this?e.CcwTriangle:e.CwTriangle)){c.next=14;break}return e=null,c.abrupt("break",18);case 14:return c.next=16,r;case 16:e=r.Edges.getItem(r.Edges.index(e)+2);case 17:if(e!==t){c.next=10;break}case 18:if(e===t){c.next=27;break}e=t;case 20:if(null!=(i=e.upperSite===this?e.CwTriangle:e.CcwTriangle)){c.next=23;break}return c.abrupt("break",27);case 23:return c.next=25,i;case 25:e=i.Edges.getItem(i.Edges.index(e)+1);case 26:c.next=20;break;case 27:case"end":return c.stop()}},o,this)}),s.toString=function(){return this.point.toString()},l}(),qn=function(){function l(o,t){this.RightSite=t.upperSite===o?t.lowerSite:t.upperSite,this.LeftSite=o,this.Edge=t}return l.prototype.toString=function(){return"("+this.LeftSite.toString()+", "+this.Edge.toString()+","+this.RightSite.toString()+")"},Q(l,[{key:"x",get:function(){return this.LeftSite.point.x}}]),l}();function Oa(){Oa=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var yo=function(l){function s(){}var o=s.prototype;return o.has=function(e){return e===this.item0||e===this.item1||e===this.item2},o.index=function(e){return e===this.item0?0:e===this.item1?1:e===this.item2?2:-1},o.getItem=function(e){switch(e){case 0:case 3:case-3:return this.item0;case 1:case 4:case-2:return this.item1;case 2:case 5:case-1:return this.item2;default:throw new Error}},o.setItem=function(e,r){switch(e){case 0:case 3:case-3:this.item0=r;break;case 1:case 4:case-2:this.item1=r;break;case 2:case 5:case-1:this.item2=r;break;default:throw new Error}},o[l]=function(){return this.GetEnumerator()},o.GetEnumerator=Oa().mark(function t(){return Oa().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.item0;case 2:return r.next=4,this.item1;case 4:return r.next=6,this.item2;case 6:case"end":return r.stop()}},t,this)}),s}(Symbol.iterator),gn=function(){function l(){this.Edges=new yo,this.Sites=new yo}var s=l.prototype;return s.containsPoint=function(t){return l.PointLocationForTriangle(t,this)!==ht.Outside},l.PointLocationForTriangle=function(t,e){for(var r=!1,i=0;i<3;i++){var h=R.signedDoubledTriangleArea(t,e.Sites.getItem(i).point,e.Sites.getItem(i+1).point);if(h<-q.distanceEpsilon)return ht.Outside;h<q.distanceEpsilon&&(r=!0)}return r?ht.Boundary:ht.Inside},s.intersectsLine=function(t,e,r){if(l.PointLocationForTriangle(t,this)!=ht.Outside||l.PointLocationForTriangle(e,this)!=ht.Outside)return!0;for(var h,i=C(this.Edges);!(h=i()).done;)if(this.abIntersectsTrianglSide(t,e,h.value))return!0;return!1},s.abIntersectsTrianglSide=function(t,e,r){return Cs(t,e,r.lowerSite.point,r.upperSite.point)},l.mkSSSD=function(t,e,r,i){var h=R.getTriangleOrientation(t.point,e.point,r.point),c=new l;switch(h){case it.Counterclockwise:c.FillCcwTriangle(t,e,r,i);break;case it.Clockwise:c.FillCcwTriangle(t,r,e,i);break;default:throw new Error}return c},l.mkSED=function(t,e,r){var i=new l;switch(R.getTriangleOrientation(e.upperSite.point,e.lowerSite.point,t.point)){case it.Counterclockwise:e.CcwTriangle=i,i.Sites.setItem(0,e.upperSite),i.Sites.setItem(1,e.lowerSite);break;case it.Clockwise:e.CwTriangle=i,i.Sites.setItem(0,e.lowerSite),i.Sites.setItem(1,e.upperSite);break;default:throw new Error}return i.Edges.setItem(0,e),i.Sites.setItem(2,t),i.CreateEdge(1,r),i.CreateEdge(2,r),i},l.mkSSSEE=function(t,e,r,i,h,c){var f=l.mkSSSD(t,e,r,c);return f.Edges.setItem(0,i),f.Edges.setItem(1,h),f.BindEdgeToTriangle(t,i),f.BindEdgeToTriangle(e,h),f.CreateEdge(2,c),f},s.BindEdgeToTriangle=function(t,e){t===e.upperSite?e.CcwTriangle=this:e.CwTriangle=this},s.FillCcwTriangle=function(t,e,r,i){this.Sites.setItem(0,t),this.Sites.setItem(1,e),this.Sites.setItem(2,r);for(var h=0;h<3;h++)this.CreateEdge(h,i)},s.CreateEdge=function(t,e){var r=this.Sites.getItem(t),h=e(r,this.Sites.getItem(t+1));this.Edges.setItem(t,h),this.BindEdgeToTriangle(r,h)},s.Contains=function(t){return this.Sites.has(t)},s.OppositeEdge=function(t){var e=this.Sites.index(t);return this.Edges.getItem(e+1)},s.OppositeSite=function(t){var e=this.Edges.index(t);return this.Sites.getItem(e+2)},s.BoundingBox=function(){var t=lt.mkPP(this.Sites.getItem(0).point,this.Sites.getItem(1).point);return t.add(this.Sites.getItem(2).point),t},l.mkSSSEED=function(t,e,r,i,h,c){var f=new l;return f.Sites.setItem(0,t),f.Sites.setItem(1,e),f.Sites.setItem(2,r),f.Edges.setItem(0,i),f.Edges.setItem(1,h),f.BindEdgeToTriangle(t,i),f.BindEdgeToTriangle(e,h),f.CreateEdge(2,c),f},s.toString=function(){return this.Sites.getItem(0).toString()+","+this.Sites.getItem(1).toString()+","+this.Sites.getItem(2).toString()},l}(),Vu=function(s){this.Edge=s},Xc=function(l){function s(t,e,r,i){var h;if((h=l.call(this,null)||this).front=new Ce(function(f,p){return f.x-p.x}),h.triangles=new Set,h.listOfSites=t,0===h.listOfSites.length)return Xe(h);h.p_1=e,h.p_2=r,h.createEdgeDelegate=i;var c=gn.mkSSSD(e,r,h.listOfSites[0],i);return h.triangles.add(c),h.front.insert(new qn(e,c.Edges.getItem(2))),h.front.insert(new qn(h.listOfSites[0],c.Edges.getItem(1))),h}X(s,l);var o=s.prototype;return o.run=function(){if(0!==this.listOfSites.length){for(var e=1;e<this.listOfSites.length;e++)this.ProcessSite(this.listOfSites[e]);this.FinalizeTriangulation()}},o.FinalizeTriangulation=function(){this.RemoveP1AndP2Triangles(),this.triangles.size>0&&this.MakePerimeterConvex()},o.MakePerimeterConvex=function(){for(var e=this.CreateDoubleLinkedListOfPerimeter();;){var r=this.FindConcaveEdge(e);if(null==r)return;e=this.ShortcutTwoListElements(r)}},o.FindConcaveEdge=function(e){var i,r=e;do{if(R.getTriangleOrientation(r.Start.point,r.End.point,(i=r.Next).End.point)===it.Counterclockwise)return r;r=i}while(i!==e);return null},s.FindPivot=function(e){var r=e,i=e;do{((i=i.Next).Start.point.x<r.Start.point.x||i.Start.point.x===r.Start.point.x&&i.Start.point.y<r.Start.point.y)&&(r=i)}while(i!==e);return r},o.FindFirsePerimeterEdge=function(){for(var r,e=C(this.triangles);!(r=e()).done;)for(var c,i=r.value,h=C(i.Edges);!(c=h()).done;){var f=c.value;if(null==f.GetOtherTriangle_T(i))return f}return null},o.CreateDoubleLinkedListOfPerimeter=function(){var h,e=this.FindFirsePerimeterEdge(),r=e,i=null,c=null,f=new Array;do{h=s.CreatePerimeterElementFromEdge(r),f.push(Z.mkPP(h.Start.point,h.End.point)),r=s.FindNextEdgeOnPerimeter(r),null!=c?(h.Prev=c,c.Next=h):i=h,c=h}while(r!==e);return i.Prev=h,h.Next=i,i},s.FindNextEdgeOnPerimeter=function(e){var r,i=null!==(r=e.CwTriangle)&&void 0!==r?r:e.CcwTriangle;for(e=i.Edges.getItem(i.Edges.index(e)+2);null!=e.CwTriangle&&null!=e.CcwTriangle;)i=e.GetOtherTriangle_T(i),e=i.Edges.getItem(i.Edges.index(e)+2);return e},s.CreatePerimeterElementFromEdge=function(e){var r=new Vu(e);return null!=e.CwTriangle?(r.Start=e.upperSite,r.End=e.lowerSite):(r.End=e.upperSite,r.Start=e.lowerSite),r},o.RemoveP1AndP2Triangles=function(){for(var i,e=new Set,r=C(this.triangles);!(i=r()).done;){var h=i.value;(h.Sites.has(this.p_1)||h.Sites.has(this.p_2))&&e.add(h)}for(var f,c=C(e);!(f=c()).done;)s.RemoveTriangleWithEdges(this.triangles,f.value)},s.RemoveTriangleWithEdges=function(e,r){e.delete(r);for(var h,i=C(r.Edges);!(h=i()).done;){var c=h.value;c.CwTriangle===r?c.CwTriangle=null:c.CcwTriangle=null,null==c.CwTriangle&&null==c.CcwTriangle&&Aa(c.upperSite.Edges,c)}},s.RemoveTriangleButLeaveEdges=function(e,r){e.delete(r);for(var h,i=C(r.Edges);!(h=i()).done;){var c=h.value;c.CwTriangle===r?c.CwTriangle=null:c.CcwTriangle=null}},o.ProcessSite=function(e){this.PointEvent(e);for(var r=0;r<e.Edges.length;r++){var i=e.Edges[r];i.constrained&&this.EdgeEvent(i)}},o.EdgeEvent=function(e){s.EdgeIsProcessed(e)||(this.traversingEdge=e,this.runEdgeInserter())},s.EdgeIsProcessed=function(e){return null!=e.CwTriangle||null!=e.CcwTriangle},o.ShowFrontWithSite=function(e,r){void 0===r&&(r=null);var i=new Array;if(null!=e.Edges)for(var c,h=C(e.Edges);!(c=h()).done;){var f=c.value;i.push(xt.mkDebugCurveTWCI(200,.8,f.constrained?"Pink":"Brown",Z.mkPP(f.upperSite.point,f.lowerSite.point)))}i.push(xt.mkDebugCurveTWCI(200,1,"Brown",Wt.mkFullEllipseNNP(.5,.5,e.point)));for(var y,p=C(this.triangles);!(y=p()).done;)for(var m=y.value,P=0;P<3;P++){var L=m.Edges.getItem(P);i.push(xt.mkDebugCurveTWCI(L.constrained?155:100,L.constrained?.8:.4,L.constrained?"Pink":"Navy",Z.mkPP(L.upperSite.point,L.lowerSite.point)))}if(null!=r)for(var S,E=C(r);!(S=E()).done;)i.push(xt.mkDebugCurveTWCI(100,.5,"Red",S.value));for(var x,O=C(this.front);!(x=O()).done;){var B=x.value;i.push(xt.mkDebugCurveTWCI(100,5.5,"Green",Z.mkPP(B.Edge.upperSite.point,B.Edge.lowerSite.point)))}},o.Show=function(e){s.ShowCdt(Array.from(this.triangles.values()),this.front,null,null,[],e)},s.ShowCdt=function(e,r,i,h,c,f){var p=new Array;if(null!=i)for(var m,y=C(i);!(m=y()).done;)p.push(xt.mkDebugCurveTWCI(200,.1,"Red",m.value));if(null!=h)for(var E,L=C(h);!(E=L()).done;)p.push(xt.mkDebugCurveTWCI(200,.1,"Blue",E.value));if(null!=r)for(var O,T=C(r);!(O=T()).done;){var x=O.value;p.push(xt.mkDebugCurveTWCI(200,.1,"Green",Z.mkPP(x.Edge.upperSite.point,x.Edge.lowerSite.point)))}for(var M,B=C(e);!(M=B()).done;)for(var F=M.value,A=0;A<3;A++){var z=F.Edges.getItem(A);p.push(s.GetDebugCurveOfCdtEdge(z))}p=p.concat(c)},s.GetDebugCurveOfCdtEdge=function(e){return null==e.CcwTriangle||null==e.CwTriangle?xt.mkDebugCurveTWCI(255,.5,e.constrained?"Brown":"Black",Z.mkPP(e.upperSite.point,e.lowerSite.point)):xt.mkDebugCurveTWCI(200,e.constrained?.8:.2,e.constrained?"Pink":"Navy",Z.mkPP(e.upperSite.point,e.lowerSite.point))},o.PointEvent=function(e){var r=this.ProjectToFront(e),i={rightSite:null},h=r.item.x+q.distanceEpsilon<e.point.x?this.MiddleCase(e,r,i):this.LeftCase(e,r,i),c=this.InsertSiteIntoFront(h,e,i.rightSite);this.TriangulateEmptySpaceToTheRight(c),c=s.FindNodeInFrontBySite(this.front,h),this.TriangulateEmptySpaceToTheLeft(c)},o.LeftCase=function(e,r,i){var h=r.item;this.InsertAndLegalizeTriangle(e,h);var c=this.front.previous(r),f=c.item.LeftSite;return i.rightSite=r.item.RightSite,this.InsertAndLegalizeTriangle(e,c.item),this.front.deleteNodeInternal(c),this.front.remove(h),f},o.MiddleCase=function(e,r,i){var h=r.item.LeftSite;return i.rightSite=r.item.RightSite,this.InsertAndLegalizeTriangle(e,r.item),this.front.deleteNodeInternal(r),h},o.TriangulateEmptySpaceToTheLeft=function(e){for(var r=e.item.RightSite,i=this.front.previous(e);null!=i;){var h=i.item,c=h.LeftSite,f=h.RightSite;if(!(f.point.sub(r.point).dot(c.point.sub(f.point))<0)){this.TryTriangulateBasinToTheLeft(e);break}e=this.ShortcutTwoFrontElements(i,e),i=this.front.previous(e)}},o.ShortcutTwoListElements=function(e){var r,i=e.Next,h=gn.mkSSSEE(e.Start,e.End,i.End,e.Edge,i.Edge,this.createEdgeDelegate);this.triangles.add(h);var c=h.Edges.getItem(2);this.LegalizeEdge(e.Start,h.OppositeEdge(e.Start)),h=null!==(r=c.CcwTriangle)&&void 0!==r?r:c.CwTriangle,this.LegalizeEdge(i.End,h.OppositeEdge(i.End));var f=new Vu(c);return f.Start=e.Start,f.End=i.End,e.Prev.Next=f,f.Prev=e.Prev,f.Next=i.Next,i.Next.Prev=f,f},o.ShortcutTwoFrontElements=function(e,r){var i,h=e.item,c=r.item,f=gn.mkSSSEED(h.LeftSite,h.RightSite,c.RightSite,h.Edge,c.Edge,this.createEdgeDelegate);this.triangles.add(f),this.front.deleteNodeInternal(e),this.front.remove(c);var p=f.Edges.getItem(2);return this.LegalizeEdge(h.LeftSite,f.OppositeEdge(h.LeftSite)),f=null!==(i=p.CcwTriangle)&&void 0!==i?i:p.CwTriangle,this.LegalizeEdge(c.RightSite,f.OppositeEdge(c.RightSite)),this.front.insert(new qn(h.LeftSite,p))},o.TryTriangulateBasinToTheLeft=function(e){if(s.DropsSharpEnoughToTheLeft(e.item)){var r=new jt.K;for(r.push(e.item.LeftSite);;){var i=r.pop();e=s.FindNodeInFrontBySite(this.front,i);var h=this.front.previous(e);if(null==h)return;if(R.getTriangleOrientation(h.item.LeftSite.point,e.item.LeftSite.point,e.item.RightSite.point)==it.Counterclockwise)r.push(h.item.LeftSite),this.ShortcutTwoFrontElements(h,e);else if(e.item.LeftSite.point.y>e.item.RightSite.point.y)r.push(h.item.LeftSite);else{if(h.item.LeftSite.point.y<=h.item.RightSite.point.y)return;r.push(h.item.LeftSite)}}}},s.DropsSharpEnoughToTheLeft=function(e){var r=e.Edge;if(e.RightSite!==r.upperSite)return!1;var i=r.lowerSite.point.sub(r.upperSite.point);return i.x>=.5*i.y},o.InsertSiteIntoFront=function(e,r,i){for(var p,h=null,c=null,f=C(r.Edges);!(p=f()).done;){var y=p.value;if(null==c&&y.lowerSite===e&&(c=y),null==h&&y.lowerSite===i&&(h=y),null!=c&&null!=h)break}return this.front.insert(new qn(e,c)),this.front.insert(new qn(r,h))},o.TriangulateEmptySpaceToTheRight=function(e){for(var i=e.item.LeftSite.point,h=this.front.next(e);null!=h;){var c=h.item,f=c.LeftSite,p=c.RightSite;if(!(f.point.sub(i).dot(p.point.sub(f.point))<0)){this.TryTriangulateBasinToTheRight(e);break}e=this.ShortcutTwoFrontElements(e,h),h=this.front.next(e)}},o.TryTriangulateBasinToTheRight=function(e){if(s.DropsSharpEnoughToTheRight(e.item)){var r=new jt.K;for(r.push(e.item.LeftSite);;){var i=r.pop();e=s.FindNodeInFrontBySite(this.front,i);var h=this.front.next(e);if(null==h)return;if(R.getTriangleOrientation(e.item.LeftSite.point,e.item.RightSite.point,h.item.RightSite.point)==it.Counterclockwise)this.ShortcutTwoFrontElements(e,h),r.push(i);else if(e.item.LeftSite.point.y>e.item.RightSite.point.y)r.push(e.item.RightSite);else{if(h.item.LeftSite.point.y>=h.item.RightSite.point.y)return;r.push(e.item.RightSite)}}}},s.DropsSharpEnoughToTheRight=function(e){var r=e.Edge;if(e.LeftSite!==r.upperSite)return!1;var i=r.lowerSite.point.sub(r.upperSite.point);return i.x<=-.5*i.y},s.FindNodeInFrontBySite=function(e,r){return e.findLast(function(i){return i.LeftSite.point.x<=r.point.x})},o.InsertAndLegalizeTriangle=function(e,r){var i;if(R.getTriangleOrientation(e.point,r.LeftSite.point,r.RightSite.point)!==it.Collinear){var h=gn.mkSED(e,r.Edge,this.createEdgeDelegate);this.triangles.add(h),this.LegalizeEdge(e,h.Edges.getItem(0))}else{var c=r.Edge;Aa(c.upperSite.Edges,c);var f=null!==(i=c.CcwTriangle)&&void 0!==i?i:c.CwTriangle,p=f.OppositeSite(c);s.RemoveTriangleButLeaveEdges(this.triangles,f),f=gn.mkSSSD(r.LeftSite,p,e,this.createEdgeDelegate);var y=gn.mkSSSD(r.RightSite,p,e,this.createEdgeDelegate);this.triangles.add(f),this.triangles.add(y),this.LegalizeEdge(e,f.OppositeEdge(e)),this.LegalizeEdge(e,y.OppositeEdge(e))}},o.LegalizeEdge=function(e,r){r.constrained||null==r.CcwTriangle||null==r.CwTriangle||(r.CcwTriangle.Contains(e)?this.LegalizeEdgeForOtherCwTriangle(e,r):this.LegalizeEdgeForOtherCcwTriangle(e,r))},o.LegalizeEdgeForOtherCwTriangle=function(e,r){var i=r.CwTriangle.Edges.index(r);if(Du(e,r.upperSite,r.CwTriangle.Sites.getItem(i+2),r.lowerSite)){var h=ju(e,r);this.LegalizeEdge(e,h.CwTriangle.OppositeEdge(e)),this.LegalizeEdge(e,h.CcwTriangle.OppositeEdge(e))}},o.LegalizeEdgeForOtherCcwTriangle=function(e,r){var i=r.CcwTriangle.Edges.index(r);if(Du(e,r.lowerSite,r.CcwTriangle.Sites.getItem(i+2),r.upperSite)){var h=ju(e,r);this.LegalizeEdge(e,h.CwTriangle.OppositeEdge(e)),this.LegalizeEdge(e,h.CcwTriangle.OppositeEdge(e))}},o.ProjectToFront=function(e){return this.front.findLast(function(r){return r.x<=e.point.x})},o.runEdgeInserter=function(){this.initEdgeInserter(),this.TraceEdgeThroughTriangles(),this.TriangulatePolygon0(this.rightPolygon,this.traversingEdge.upperSite,this.traversingEdge.lowerSite,!0),this.TriangulatePolygon0(this.leftPolygon,this.traversingEdge.upperSite,this.traversingEdge.lowerSite,!1),this.UpdateFront()},o.initEdgeInserter=function(){this.rightPolygon=new Array,this.leftPolygon=new Array,this.addedTriangles=new Array,this.piercedEdge=null,this.piercedTriangle=null,this.piercedToTheLeftFrontElemNode=null,this.piercedToTheRightFrontElemNode=null},o.UpdateFront=function(){for(var i,e=new Set,r=C(this.addedTriangles);!(i=r()).done;)for(var f,c=C(i.value.Edges);!(f=c()).done;){var p=f.value;if(null==p.CwTriangle||null==p.CcwTriangle){if(p.lowerSite==this.p_2&&p.upperSite==this.p_1)continue;e.add(p)}}for(var m,y=C(e);!(m=y()).done;)this.AddEdgeToFront(m.value)},o.AddEdgeToFront=function(e){this.front.insert(new qn(e.upperSite.point.x<e.lowerSite.point.x?e.upperSite:e.lowerSite,e))},o.TriangulatePolygon0=function(e,r,i,h){e.length>0&&this.TriangulatePolygon1(0,e.length-1,e,r,i,h)},o.TriangulatePolygon1=function(e,r,i,h,c,f){for(var p=i[e],y=e,m=e+1;m<=r;m++){var P=i[m];S=P,(f?ka(S,h,p,c):ka(S,h,c,p))&&(y=m,p=P)}var S,L=gn.mkSSSD(h,c,p,this.createEdgeDelegate);this.triangles.add(L),this.addedTriangles.push(L),e<y&&this.TriangulatePolygon1(e,y-1,i,h,p,f),y<r&&this.TriangulatePolygon1(y+1,r,i,p,c,f)},o.TraceEdgeThroughTriangles=function(){this.initEdgeTracer(),this.Traverse()},o.Traverse=function(){for(;!this.BIsReached();)null!=this.piercedToTheLeftFrontElemNode?this.ProcessLeftFrontPiercedElement():null!=this.piercedToTheRightFrontElemNode?this.ProcessRightFrontPiercedElement():this.ProcessPiercedEdge();null!=this.piercedTriangle&&this.removePiercedTriangle(this.piercedTriangle),this.FindMoreRemovedFromFrontElements();for(var r,e=C(this.elementsToBeRemovedFromFront);!(r=e()).done;)this.front.remove(r.value)},o.ProcessLeftFrontPiercedElement=function(){var e=this.piercedToTheLeftFrontElemNode;do{this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToLeftPolygon(e.item.LeftSite),e=this.front.previous(e)}while(R.pointToTheLeftOfLine(e.item.LeftSite.point,this.a.point,this.b.point));this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToRightPolygon(e.item.LeftSite),e.item.LeftSite!==this.b?(this.FindPiercedTriangle(e),this.piercedToTheLeftFrontElemNode=null):this.piercedToTheLeftFrontElemNode=e},o.FindPiercedTriangle=function(e){for(var r,i=e.item.Edge,h=null!==(r=i.CcwTriangle)&&void 0!==r?r:i.CwTriangle,c=h.Edges.index(i),f=1;f<=2;f++){var p=h.Edges.getItem(f+c),y=Nr.sign(R.signedDoubledTriangleArea(p.lowerSite.point,this.a.point,this.b.point));if(Nr.sign(R.signedDoubledTriangleArea(p.upperSite.point,this.a.point,this.b.point))*y<=0){this.piercedTriangle=h,this.piercedEdge=p;break}}},o.FindMoreRemovedFromFrontElements=function(){for(var r,e=C(this.removedTriangles);!(r=e()).done;)for(var c,h=C(r.value.Edges);!(c=h()).done;){var f=c.value;if(null==f.CcwTriangle&&null==f.CwTriangle){var y=s.FindNodeInFrontBySite(this.front,f.upperSite.point.x<f.lowerSite.point.x?f.upperSite:f.lowerSite);y.item.Edge===f&&this.elementsToBeRemovedFromFront.push(y.item)}}},o.ProcessPiercedEdge=function(){this.piercedEdge.CcwTriangle===this.piercedTriangle?(this.AddSiteToLeftPolygon(this.piercedEdge.lowerSite),this.AddSiteToRightPolygon(this.piercedEdge.upperSite)):(this.AddSiteToLeftPolygon(this.piercedEdge.upperSite),this.AddSiteToRightPolygon(this.piercedEdge.lowerSite)),this.removePiercedTriangle(this.piercedTriangle),this.PrepareNextStateAfterPiercedEdge()},o.PrepareNextStateAfterPiercedEdge=function(){for(var e,r,i=null!==(e=this.piercedEdge.CwTriangle)&&void 0!==e?e:this.piercedEdge.CcwTriangle,h=i.Edges.index(this.piercedEdge),c=1;c<=2;c++){var f=i.Edges.getItem(c+h),p=Nr.sign(R.signedDoubledTriangleArea(f.lowerSite.point,this.a.point,this.b.point));if(Nr.sign(R.signedDoubledTriangleArea(f.upperSite.point,this.a.point,this.b.point))*p<=0){if(null!=f.CwTriangle&&null!=f.CcwTriangle){this.piercedTriangle=i,this.piercedEdge=f;break}this.piercedTriangle=null,this.piercedEdge=null;var m=f.upperSite.point.x<f.lowerSite.point.x?f.upperSite:f.lowerSite,P=s.FindNodeInFrontBySite(this.front,m);m.point.x<this.a.point.x?this.piercedToTheLeftFrontElemNode=P:this.piercedToTheRightFrontElemNode=P,this.removePiercedTriangle(null!==(r=f.CwTriangle)&&void 0!==r?r:f.CcwTriangle);break}}},o.removePiercedTriangle=function(e){this.triangles.delete(e);for(var i,r=C(e.Edges);!(i=r()).done;){var h=i.value;h.CwTriangle===e?h.CwTriangle=null:h.CcwTriangle=null,this.removedTriangles.push(e)}},o.ProcessRightFrontPiercedElement=function(){var e=this.piercedToTheRightFrontElemNode;do{this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToRightPolygon(e.item.RightSite),e=this.front.next(e)}while(R.pointToTheRightOfLine(e.item.RightSite.point,this.a.point,this.b.point));this.elementsToBeRemovedFromFront.push(e.item),this.AddSiteToLeftPolygon(e.item.RightSite),e.item.RightSite!==this.b?(this.FindPiercedTriangle(e),this.piercedToTheRightFrontElemNode=null):this.piercedToTheRightFrontElemNode=e},o.AddSiteToLeftPolygon=function(e){this.AddSiteToPolygonWithCheck(e,this.leftPolygon)},o.AddSiteToPolygonWithCheck=function(e,r){e!==this.b&&(0===r.length||r[r.length-1]!==e)&&r.push(e)},o.AddSiteToRightPolygon=function(e){this.AddSiteToPolygonWithCheck(e,this.rightPolygon)},o.BIsReached=function(){var e,r=null!==(e=this.piercedToTheLeftFrontElemNode)&&void 0!==e?e:this.piercedToTheRightFrontElemNode;return null!=r?r.item.Edge.IsAdjacent(this.b):this.piercedEdge.IsAdjacent(this.b)},o.initEdgeTracer=function(){this.elementsToBeRemovedFromFront=[],this.a=this.traversingEdge.upperSite,this.b=this.traversingEdge.lowerSite,this.removedTriangles=[];var e=s.FindNodeInFrontBySite(this.front,this.a),r=this.front.previous(e);if(R.pointToTheLeftOfLine(this.b.point,r.item.LeftSite.point,r.item.RightSite.point))this.piercedToTheLeftFrontElemNode=r;else if(R.pointToTheRightOfLine(this.b.point,e.item.RightSite.point,e.item.LeftSite.point))this.piercedToTheRightFrontElemNode=e;else for(var h,i=C(this.a.Edges);!(h=i()).done;){var c=h.value,f=c.CcwTriangle;if(null!=f&&!R.pointToTheLeftOfLine(this.b.point,c.lowerSite.point,c.upperSite.point)){var p=f.Edges.index(c),y=f.Sites.getItem(p+2);if(R.pointToTheLeftOfLineOrOnLine(this.b.point,y.point,c.upperSite.point)){this.piercedEdge=f.Edges.getItem(p+1),this.piercedTriangle=f;break}}}},s}(Vt);function Aa(l,s){if(0!==l.length){var o=l.findIndex(function(t){return s===t});o>=0&&(o!==l.length-1&&(l[o]=l[l.length-1]),l.pop())}}function Du(l,s,o,t){return function(l,s,o,t){return R.getTriangleOrientation(s.point,l.point,o.point)===it.Clockwise&&R.getTriangleOrientation(o.point,l.point,t.point)===it.Clockwise}(l,s,o,t)&&ka(l,s,o,t)}function ka(l,s,o,t){var e=s.point.x-l.point.x,r=s.point.y-l.point.y,i=o.point.x-l.point.x,h=o.point.y-l.point.y,c=t.point.x-l.point.x,f=t.point.y-l.point.y,p=e*e+r*r,y=i*i+h*h,m=c*c+f*f;return e*(h*m-f*y)-i*(r*m-f*p)+c*(r*y-h*p)>q.tolerance}function ju(l,s){var o,t;s.CcwTriangle.Contains(l)?(o=s.CcwTriangle,t=s.CwTriangle):(o=s.CwTriangle,t=s.CcwTriangle);var e=o.Edges.index(s),r=t.Edges.index(s),i=t.Sites.getItem(r+2),h=o.Edges.getItem(e+1),c=t.Edges.getItem(r+1),f=Ne.GetOrCreateEdge(l,i);return o.Sites.setItem(e+1,i),o.Edges.setItem(e,c),o.Edges.setItem(e+1,f),t.Sites.setItem(r+1,l),t.Edges.setItem(r,h),t.Edges.setItem(r+1,f),c.lowerSite===i?c.CcwTriangle=o:c.CwTriangle=o,h.lowerSite===l?h.CcwTriangle=t:h.CwTriangle=t,f.upperSite===l?(f.CcwTriangle=t,f.CwTriangle=o):(f.CcwTriangle=o,f.CwTriangle=t),Aa(s.upperSite.Edges,s),f}var Ne=function(l){function s(t,e,r){var i;return(i=l.call(this,null)||this).isolatedSites=[],i.obstacles=[],i.PointsToSites=new Ee,i.simplifyObstacles=!0,i.rectangleNodeOnTriangles=null,i.isolatedSites=t,i.obstacles=e,i.isolatedSegments=r,i}X(s,l),s.constructor_=function(e){var r=new s(null,null,null);return r.isolatedSitesWithObject=e,r};var o=s.prototype;return o.FillAllInputSites=function(){if(null!=this.isolatedSitesWithObject)for(var r,e=C(this.isolatedSitesWithObject);!(r=e()).done;){var i=r.value;this.AddSite(i[0],i[1])}if(null!=this.isolatedSites)for(var c,h=C(this.isolatedSites);!(c=h()).done;)this.AddSite(c.value,null);if(null!=this.obstacles)for(var y,p=C(this.obstacles);!(y=p()).done;)this.AddPolylineToAllInputSites(y.value);if(null!=this.isolatedSegments)for(var L,P=C(this.isolatedSegments);!(L=P()).done;){var E=L.value;this.AddConstrainedEdge(E.A,E.B,null)}this.AddP1AndP2(),this.allInputSites=Array.from(this.PointsToSites.values())},o.AddSite=function(e,r){var i;return(i=this.PointsToSites.get(e))?i.Owner=r:(i=Ta.mkSO(e,r),this.PointsToSites.set(e,i)),i},o.AddP1AndP2=function(){for(var i,e=lt.mkEmpty(),r=C(this.PointsToSites.keys());!(i=r()).done;)e.add(i.value);this.P1=new Ta(e.leftBottom.add(new R(-10,-10))),this.P2=new Ta(e.rightBottom.add(new R(10,-10)))},o.AddPolylineToAllInputSites=function(e){if(this.simplifyObstacles)for(var r=e.startPoint;null!=r;){var i=r.point;if(!(r=r.next))break;for(;r.next&&R.getTriangleOrientation(i,r.point,r.next.point)===it.Collinear;)r=r.next;this.AddConstrainedEdge(i,r.point,e)}else for(var h=e.startPoint;null!=h.next;h=h.next)this.AddConstrainedEdge(h.point,h.next.point,e);e.closed&&this.AddConstrainedEdge(e.endPoint.point,e.startPoint.point,e)},o.AddConstrainedEdge=function(e,r,i){var c,f;s.AbovePP(e,r)>0?(c=this.AddSite(e,i),f=this.AddSite(r,i)):(c=this.AddSite(r,i),f=this.AddSite(e,i)),s.CreateEdgeOnOrderedCouple(c,f).constrained=!0},s.GetOrCreateEdge=function(e,r){return 1===s.AboveCC(e,r)?e.EdgeBetweenUpperSiteAndLowerSite(r)??s.CreateEdgeOnOrderedCouple(e,r):r.EdgeBetweenUpperSiteAndLowerSite(e)??s.CreateEdgeOnOrderedCouple(r,e)},s.CreateEdgeOnOrderedCouple=function(e,r){return new Qc(e,r)},o.GetTriangles=function(){return this.sweeper.triangles},o.run=function(){this.Initialization(),this.SweepAndFinalize()},o.SweepAndFinalize=function(){this.sweeper=new Xc(this.allInputSites,this.P1,this.P2,s.GetOrCreateEdge),this.sweeper.run(),this.cleanRemovedEdges()},o.cleanRemovedEdges=function(){for(var r,e=C(this.PointsToSites.values());!(r=e()).done;)r.value.cleanRemovedEdges()},o.Initialization=function(){this.FillAllInputSites(),this.allInputSites.sort(s.OnComparison)},s.OnComparison=function(e,r){return s.AboveCC(e,r)},s.AbovePP=function(e,r){var i=e.y-r.y;return i>0?1:i<0||(i=e.x-r.x)>0?-1:i<0?1:0},s.AboveCC=function(e,r){return s.AbovePP(e.point,r.point)},o.RestoreEdgeCapacities=function(){for(var r,e=C(this.allInputSites);!(r=e()).done;)for(var c,h=C(r.value.Edges);!(c=h()).done;){var f=c.value;f.constrained||(f.ResidualCapacity=f.Capacity)}},o.SetInEdges=function(){for(var r,e=C(this.PointsToSites.values());!(r=e()).done;)for(var c,h=C(r.value.Edges);!(c=h()).done;){var f=c.value;f.lowerSite.AddInEdge(f)}},o.FindSite=function(e){return this.PointsToSites.get(e)},s.PointIsInsideOfTriangle=function(e,r){for(var i=0;i<3;i++){var h=r.Sites.getItem(i).point,c=r.Sites.getItem(i+1).point;if(R.signedDoubledTriangleArea(e,h,c)<-1*q.distanceEpsilon)return!1}return!0},o.getRectangleNodeOnTriangles=function(){return null==this.rectangleNodeOnTriangles&&(this.rectangleNodeOnTriangles=Ht(Array.from(this.GetTriangles().values()).map(function(e){return Qt(e,e.BoundingBox())}))),this.rectangleNodeOnTriangles},s}(Vt);function Wu(l){var s=Array.from(l.GetAllLeaves()),o=l.irect,t=o.diagonal/4,e=o.clone();return e.pad(t),function(l){var s=new Ne(null,l,null);return s.run(),s}(s.concat([e.perimeter()]))}var Zc=function(){function l(o,t){this.start=o,this.end=t}var s=l.prototype;return s.add=function(t){this.add_d(t)},s.add_rect=function(t){var e=t,r=this.clone();return r.add_d(e.start),r.add_d(e.end),r},s.clone=function(){return new l(this.start,this.end)},s.contains_point=function(t){return this.contains_d(t)},s.contains_rect=function(t){var e=t;return this.contains_d(e.start)&&this.contains_d(e.end)},s.intersection_rect=function(t){var e=t;return new l(Math.max(this.start,e.start),Math.min(this.end,e.end))},s.intersects_rect=function(t){return this.intersects(t)},s.contains_point_radius=function(t,e){return this.contains_d(t-e)&&this.contains_d(t+e)},l.mkInterval=function(t,e){var r=new l(t.start,t.end);return r.add_d(e.start),r.add_d(e.end),r},s.add_d=function(t){this.start>t&&(this.start=t),this.end<t&&(this.end=t)},s.contains_d=function(t){return this.start<=t&&t<=this.end},s.GetInRange=function(t){return t<this.start?this.start:t>this.end?this.end:t},s.intersects=function(t){return!(t.start>this.end+q.distanceEpsilon||t.end<this.start-q.distanceEpsilon)},Q(l,[{key:"Start",get:function(){return this.start},set:function(t){this.start=t}},{key:"Length",get:function(){return this.end-this.start}}]),l}(),Hu=function(){function l(o){this.heapSize=0,this._priors=new Array(o),this._heap=new Array(o+1),this._reverse_heap=new Array(o)}var s=l.prototype;return s.SwapWithParent=function(t){var e=this._heap[t>>1];this.PutAtI(t>>1,this._heap[t]),this.PutAtI(t,e)},s.Enqueue=function(t,e){this.heapSize++;var r=this.heapSize;for(this._priors[t]=e,this.PutAtI(r,t);r>1&&this._priors[this._heap[r>>1]]>e;)this.SwapWithParent(r),r>>=1},s.PutAtI=function(t,e){this._heap[t]=e,this._reverse_heap[e]=t},s.Dequeue=function(){if(0===this.heapSize)throw new Error;var t=this._heap[1];if(this.heapSize>1){this.PutAtI(1,this._heap[this.heapSize]);for(var e=1;;){var r=e,i=e<<1;i<=this.heapSize&&this._priors[this._heap[i]]<this._priors[this._heap[e]]&&(r=i);var h=i+1;if(h<=this.heapSize&&this._priors[this._heap[h]]<this._priors[this._heap[r]]&&(r=h),r===e)break;this.SwapWithParent(r),e=r}}return this.heapSize--,t},s.IsEmpty=function(){return 0===this.heapSize},s.DecreasePriority=function(t,e){this._priors[t]=e;for(var r=this._reverse_heap[t];r>1&&this._priors[this._heap[r]]<this._priors[this._heap[r>>1]];)this.SwapWithParent(r),r>>=1},Q(l,[{key:"Count",get:function(){return this.heapSize}}]),l}(),Kc=function(){function l(o,t,e,r){this._numberOfOverlaps=0,this._proximityEdges=o,this._nodeSizes=t,this._nodePositions=e,this._forLayers=r,this._q=new Hu(2*t.length)}var s=l.prototype;return s.Run=function(){return this.InitQueue(),this.FindOverlaps(),this._numberOfOverlaps},s.FindOverlaps=function(){for(;this._q.Count>0;){var t=this._q.Dequeue();t<this._nodePositions.length?(this.FindOverlapsWithInterval(t),this.AddIntervalToTree(t)):this.RemoveIntervalFromTree(t-=this._nodePositions.length)}},s.RemoveIntervalFromTree=function(t){this._intervalTree.Remove(this.GetInterval(t),t)},s.AddIntervalToTree=function(t){var e=this.GetInterval(t);null==this._intervalTree&&(this._intervalTree=ui([])),this._intervalTree.Add(e,t)},s.FindOverlapsWithInterval=function(t){if(null!=this._intervalTree)for(var i,e=this.GetInterval(t),r=C(this._intervalTree.GetAllIntersecting(e));!(i=r()).done;){var h=i.value,c=Ra.GetIdealEdge(t,h,this._nodePositions[t],this._nodePositions[h],this._nodeSizes);if(c.overlapFactor<=1)return;this._proximityEdges.push(c),this._numberOfOverlaps++}},s.GetInterval=function(t){var e=this._nodeSizes[t].width/2,r=this._nodePositions[t].x;return new Zc(r-e,r+e)},s.InitQueue=function(){for(var t=0;t<this._nodeSizes.length;t++){var e=this._nodeSizes[t].height/2,r=this._nodePositions[t].y;this._q.Enqueue(t,r-e),this._q.Enqueue(this._nodeSizes.length+t,r+e)}},l}(),_u=function(){function l(o,t,e){this.treeNodes=new Set,this.hedgehog=new Map,this.graph=o,this.weight=t,this.root=e,this.q=new Hu(this.graph.nodeCount)}var s=l.prototype;return s.NodeIsInTree=function(t){return this.treeNodes.has(t)},s.GetTreeEdges=function(){var t=new Array;for(this.Init();t.length<this.graph.nodeCount-1&&this.q.Count>0;)this.AddEdgeToTree(t);return t},s.AddEdgeToTree=function(t){var e=this.q.Dequeue(),r=this.hedgehog.get(e);this.treeNodes.add(e),t.push(r),this.UpdateOutEdgesOfV(e),this.UpdateInEdgesOfV(e)},s.UpdateOutEdgesOfV=function(t){for(var r,e=C(this.graph.outEdges[t]);!(r=e()).done;){var i=r.value,h=i.target;if(!this.NodeIsInTree(h)){var c=this.hedgehog.get(h);if(c){var f=this.weight(c),p=this.weight(i);p<f&&(this.q.DecreasePriority(h,p),this.hedgehog.set(h,i))}else this.q.Enqueue(h,this.weight(i)),this.hedgehog.set(h,i)}}},s.UpdateInEdgesOfV=function(t){for(var r,e=C(this.graph.inEdges[t]);!(r=e()).done;){var i=r.value,h=i.source;if(!this.NodeIsInTree(h)){var c=this.hedgehog.get(h);if(c){var f=this.weight(c),p=this.weight(i);p<f&&(this.q.DecreasePriority(h,p),this.hedgehog.set(h,i))}else this.q.Enqueue(h,this.weight(i)),this.hedgehog.set(h,i)}}},s.Init=function(){this.treeNodes.add(this.root);for(var e,t=C(this.graph.outEdges[this.root]);!(e=t()).done;){var r=e.value,i=this.weight(r);this.q.Enqueue(r.target,i),this.hedgehog.set(r.target,r)}for(var c,h=C(this.graph.inEdges[this.root]);!(c=h()).done;){var f=c.value,p=this.weight(f);this.q.Enqueue(f.source,p),this.hedgehog.set(f.source,f)}},l}(),tf=function(){function l(){}return l.GetMst=function(o,t){if(0===o.length)return null;for(var e=o.map(function(p){return new Lt(p.source,p.target)}),r=e.reduce(function(p,y){return Math.max(p,Math.max(y.x,y.y))},0),i=new Bn(r+1),h=0;h<o.length;h++)i.setPair(e[h],o[h]);var c=Ke(e,t);return new _u(c,function(p){return i.get(p.source,p.target).weight},e[0].source).GetTreeEdges().map(function(p){return i.get(p.source,p.target)})},l.GetMstOnCdt=function(o,t){for(var e=Array.from(o.PointsToSites.values()),r=new Map,i=0;i<e.length;i++)r.set(e[i],i);var h=l.GetEdges(e,r),c=Us(Array.from(h.keys()));return new _u(c,function(p){return t(h.get(p.source,p.target))},0).GetTreeEdges().map(function(p){return h.get(p.source,p.target)})},l.GetEdges=function(o,t){for(var e=new Bn(o.length),r=0;r<o.length;r++)for(var f,i=o[r],h=t.get(i),c=C(i.Edges);!(f=c()).done;){var p=f.value;e.set(h,t.get(p.lowerSite),p)}return e},l}(),ef=function(){function l(){this.epsilon=.01,this.iterationsMax=1e3,this.stopOnMaxIterat=!1,this.nodeSeparation=4,this.randomizationSeed=1,this.randomizationShift=.1}return l.prototype.Clone=function(){var t=new l;return t.Epsilon=this.Epsilon,t.IterationsMax=this.IterationsMax,t.StopOnMaxIterat=this.StopOnMaxIterat,t.NodeSeparation=this.NodeSeparation,t.RandomizationSeed=this.RandomizationSeed,t.RandomizationShift=this.randomizationShift,t},Q(l,[{key:"StopOnMaxIterat",get:function(){return this.stopOnMaxIterat},set:function(t){this.stopOnMaxIterat=t}},{key:"Epsilon",get:function(){return this.epsilon},set:function(t){this.epsilon=t}},{key:"IterationsMax",get:function(){return this.iterationsMax},set:function(t){this.iterationsMax=t}},{key:"NodeSeparation",get:function(){return this.nodeSeparation},set:function(t){this.nodeSeparation=t}},{key:"RandomizationSeed",get:function(){return this.randomizationSeed},set:function(t){this.randomizationSeed=t}},{key:"RandomizationShift",get:function(){return this.randomizationShift},set:function(t){this.randomizationShift=t}}]),l}(),Ra=function(){function l(o,t){this._settings=o,this._nodes=t}l.RemoveOverlaps=function(t,e){var r=new ef;r.RandomizationShift=1,r.NodeSeparation=e,new l(r,t).RemoveOverlaps()};var s=l.prototype;return s.RemoveOverlaps=function(){if(this._nodes.length<3)this.RemoveOverlapsOnTinyGraph();else{var t={nodePositions:new Array,nodeSizes:new Array};for(function(l,s,o,t){o.nodePositions=s.map(function(e){return e.center}),t&&function(l,s,o){for(var t=new qt,e=0;e<l.length;e++){var r=l[e];if(o||t.has(r))do{var i=r.x+(2*s.random()-1)*o,h=r.y+(2*s.random()-1)*o;r=new R(i,h)}while(t.has(r));l[e]=r,t.add(r)}}(o.nodePositions,new Ki(0,0),t),o.nodeSizes=s.map(function(e){var r=e.boundingBox.size;return r.width+=l.NodeSeparation,r.height+=l.NodeSeparation,r})}(this._settings,this._nodes,t,this._settings.RandomizationShift),this.lastRunNumberIterations=0;this.OneIteration(t.nodePositions,t.nodeSizes,!1);)this.lastRunNumberIterations++;for(;this.OneIteration(t.nodePositions,t.nodeSizes,!0);)this.lastRunNumberIterations++;for(var e=0;e<this._nodes.length;e++)this._nodes[e].center=t.nodePositions[e]}},s.RemoveOverlapsOnTinyGraph=function(){if(1!==this._nodes.length&&2===this._nodes.length){var t=this._nodes[0],e=this._nodes[1];R.closeDistEps(t.center,e.center)&&(e.center=e.center.add(new R(.001,0)));var r=this.GetIdealDistanceBetweenTwoNodes(t,e),i=R.middle(t.center,e.center),h=t.center.sub(e.center);h=h.mul(r/h.length*.5),t.center=i.add(h),e.center=i.sub(h)}},s.GetIdealDistanceBetweenTwoNodes=function(t,e){var r=t.center.sub(e.center),i=Math.abs(r.x),h=Math.abs(r.y),p=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY;return i>q.tolerance&&(p=((t.width+e.width)/2+this._settings.NodeSeparation)/i),h>q.tolerance&&(y=((t.height+e.height)/2+this._settings.NodeSeparation)/h),Math.min(p,y)*r.length},l.AvgEdgeLength=function(t){for(var h,e=0,r=0,i=C(t);!(h=i()).done;)for(var p,c=h.value,f=C(c.outEdges());!(p=f()).done;)r+=c.center.sub(p.value.target.center).length,e++;return e>0?r/e:1},s.OneIteration=function(t,e,r){for(var i=new Array,h=0;h<t.length;h++)i.push([t[h],h]);var c=Ne.constructor_(i);c.run();for(var f=new Map,p=0;p<t.length;p++)f.set(c.PointsToSites.get(t[p]),p);for(var L,y=0,m=new Array,P=C(c.PointsToSites.values());!(L=P()).done;)for(var T,S=C(L.value.Edges);!(T=S()).done;){var O=T.value,x=O.upperSite.point,B=O.lowerSite.point,M=f.get(O.upperSite),F=f.get(O.lowerSite),A=l.GetIdealEdge(M,F,x,B,e);m.push(A),A.overlapFactor>1&&y++}if(0===y||r){var z=this.FindProximityEdgesWithSweepLine(m,e,t);if(0===y&&0===z||0===y&&!r)return!1}var V=tf.GetMst(m,t.length);return l.MoveNodePositions(V,t,V[0].source),!0},s.FindProximityEdgesWithSweepLine=function(t,e,r){return new Kc(t,e,r,this._overlapForLayers).Run()},l.GetIdealEdge=function(t,e,r,i,h){var c={overlapFactor:0},f=l.GetIdealEdgeLength(t,e,r,i,h,c),p=r.sub(i).length,y=lt.mkSizeCenter(h[t],r),m=lt.mkSizeCenter(h[e],i),P=c.overlapFactor>1?p-f:l.GetDistanceRects(y,m);return{source:Math.min(t,e),target:Math.max(t,e),overlapFactor:c.overlapFactor,idealDistance:f,weight:P}},l.GetIdealEdgeLength=function(t,e,r,i,h,c){var f=r.sub(i),p=f.length,y=Math.abs(f.x),m=Math.abs(f.y),P=(h[t].width+h[e].width)/2,L=(h[t].height+h[e].height)/2;if(y>=P||m>=L)return c.overlapFactor=1,f.length;var E,S=1e-10;if(y>S)E=m>S?Math.min(P/y,L/m):P/y;else{if(!(m>S))return c.overlapFactor=2,Math.sqrt(P*P+L*L)/4;E=L/m}return E=Math.max(E,1.001),c.overlapFactor=E,E*p},l.GetDistanceRects=function(t,e){if(t.intersects(e))return 0;var r=0,i=0;return(t.right<e.left||e.right<t.left)&&(i=t.left-e.right),t.top<e.bottom?r=e.bottom-t.top:e.top<t.bottom&&(r=t.bottom-e.top),Math.sqrt(i*i+r*r)},l.MoveNodePositions=function(t,e,r){var i=e.map(function(p){return p.clone()}),h=new Set;h.add(r);for(var c=0;c<t.length;c++){var f=t[c];h.has(f.source)?l.MoveNode(f.source,f.target,i,e,h,f.idealDistance):l.MoveNode(f.target,f.source,i,e,h,f.idealDistance)}},l.MoveNode=function(t,e,r,i,h,c){var f=r[e].sub(r[t]);f=f.mul(c/f.length+.01),i[e]=i[t].add(f),h.add(e)},s.GetLastRunIterations=function(){return this.lastRunNumberIterations},l}(),zu=function(l){function s(t,e,r,i){var h;return(h=l.call(this,r)||this).settings=t,h.graph=e,h.length=i,h}X(s,l);var o=s.prototype;return o.run=function(){this.LayoutConnectedGraphWithMds(),this.graph.pumpTheBoxToTheGraphWithMargins()},s.ScaleToAverageEdgeLength=function(e,r,i,h){for(var y,c=new Map,f=0,p=C(e.shallowNodes);!(y=p()).done;)c.set(y.value,f),f++;for(var S,P=0,L=0,E=C(e.shallowEdges);!(S=E()).done;){var T=S.value,O=c.get(T.source),x=c.get(T.target);L+=Math.sqrt(Math.pow(r[O]-r[x],2)+Math.pow(i[O]-i[x],2)),P+=h(T)}if(P>0&&(L/=P),L>0)for(var B=0;B<r.length;B++)r[B]/=L,i[B]/=L},s.LayoutGraphWithMds=function(e,r,i,h){if(i.x=new Array(e.shallowNodeCount),i.y=new Array(e.shallowNodeCount),0!==i.x.length){if(1===i.x.length)return void(i.x[0]=i.y[0]=0);var c=Math.min(r.PivotNumber,e.shallowNodeCount),f=r.GetNumberOfIterationsWithMajorization(e.shallowNodeCount),p=r.Exponent,y=new Array(c),m=new Uc(e,y,h);if(m.run(),Ia.LandmarkClassicalScaling(m.Result,i,y),s.ScaleToAverageEdgeLength(e,i.x,i.y,h),f>0){var L=new qc(e,h);L.run();var E=L.Result,S=Ia.ExponentialWeightMatrix(E,p);Ia.DistanceScalingSubset(E,i.x,i.y,S,f)}}},o.LayoutConnectedGraphWithMds=function(){var e={x:[],y:[]};s.LayoutGraphWithMds(this.graph,this.settings,e,this.length),0!==this.settings.RotationAngle&&Yc.Rotate(e.x,e.y,this.settings.RotationAngle);for(var h,r=0,i=C(this.graph.shallowNodes);!(h=i()).done;){var c=h.value;c.boundingBox&&(c.center=new R(e.x[r]*this.settings.ScaleX,e.y[r]*this.settings.ScaleY)),r++}this.settings.removeOverlaps&&Ra.RemoveOverlaps(Array.from(this.graph.shallowNodes),this.settings.NodeSeparation),this.graph.pumpTheBoxToTheGraphWithMargins()},o.ScaleNodes=function(e,r){for(var h,i=C(e);!(h=i()).done;){var c=h.value;c.center=c.center.mul(r)}},s.PackGraphs=function(e,r){if(0===e.length)return lt.mkEmpty();if(1===e.length)return e[0].boundingBox;for(var f,i=e.map(function(O){return O.boundingBox}),h=new Array,c=C(e);!(f=c()).done;){var p=f.value;h.push({g:p,lb:p.boundingBox.leftBottom.clone()})}var y=new Fs(i,r.PackingAspectRatio);y.run();for(var m=0,P=h;m<P.length;m++){var L=P[m],E=L.g,T=E.boundingBox.leftBottom.sub(L.lb);E.translate(T)}return new lt({left:0,bottom:0,right:y.PackedWidth,top:y.PackedHeight})},s}(Vt),Ga=function(){function l(){this.commonSettings=new po,this.pivotNumber=50,this.iterationsWithMajorization=30,this.scaleX=100,this.scaleY=100,this.exponent=-2,this.rotationAngle=0,this._removeOverlaps=!0,this._callIterationsWithMajorizationThreshold=2e3,this.adjustScale=!1}l.fromJSON=function(t){var e=new l;return t.pivotNumber&&(e.pivotNumber=t.pivotNumber),t.iterationsWithMajorization&&(e.iterationsWithMajorization=t.iterationsWithMajorization),t.scaleX&&(e.scaleX=t.scaleX),t.scaleY&&(e.scaleY=t.scaleY),t.exponent&&(e.exponent=t.exponent),t.rotationAngle&&(e.rotationAngle=t.rotationAngle),null!=t.removeOverlaps&&(e._removeOverlaps=t.removeOverlaps),t._callIterationsWithMajorizationThreshold&&(e._callIterationsWithMajorizationThreshold=t._callIterationsWithMajorizationThreshold),e};var s=l.prototype;return s.toJSON=function(){var t={};return 50!=this.pivotNumber&&(t.pivotNumber=this.pivotNumber),30!=this.iterationsWithMajorization&&(t.iterationsWithMajorization=this.iterationsWithMajorization),200!=this.scaleX&&(t.scaleX=this.scaleX),200!=this.scaleY&&(t.scaleY=this.scaleY),-2!=this.exponent&&(t.exponent=this.exponent),0!=this.rotationAngle&&(t.rotationAngle=this.rotationAngle),this._removeOverlaps||(t.removeOverlaps=this._removeOverlaps),3e3!=this._callIterationsWithMajorizationThreshold&&(t._callIterationsWithMajorizationThreshold=this._callIterationsWithMajorizationThreshold),t},s.GetNumberOfIterationsWithMajorization=function(t){return t>this.CallIterationsWithMajorizationThreshold?0:this.IterationsWithMajorization},Q(l,[{key:"NodeSeparation",get:function(){return this.commonSettings.NodeSeparation},set:function(t){this.commonSettings.NodeSeparation=t}},{key:"edgeRoutingSettings",get:function(){return this.commonSettings.edgeRoutingSettings},set:function(t){this.commonSettings.edgeRoutingSettings=t}},{key:"removeOverlaps",get:function(){return this._removeOverlaps},set:function(t){this._removeOverlaps=t}},{key:"PivotNumber",get:function(){return this.pivotNumber},set:function(t){this.pivotNumber=t}},{key:"IterationsWithMajorization",get:function(){return this.iterationsWithMajorization},set:function(t){this.iterationsWithMajorization=t}},{key:"ScaleX",get:function(){return this.scaleX},set:function(t){this.scaleX=t}},{key:"ScaleY",get:function(){return this.scaleY},set:function(t){this.scaleY=t}},{key:"Exponent",get:function(){return this.exponent},set:function(t){this.exponent=t}},{key:"RotationAngle",get:function(){return this.rotationAngle},set:function(t){this.rotationAngle=t%360}},{key:"AdjustScale",get:function(){return this.adjustScale},set:function(t){this.adjustScale=t}},{key:"CallIterationsWithMajorizationThreshold",get:function(){return this._callIterationsWithMajorizationThreshold},set:function(t){this._callIterationsWithMajorizationThreshold=t}}]),l}(),Na=function(l){function s(t,e,r,i){var h;return(h=l.call(this,e)||this).graph=t,h.length=r,h.settings=i,h.settings.ScaleX=h.settings.ScaleY=200,h}return X(s,l),s.prototype.run=function(){new zu(this.settings,this.graph,this.cancelToken,this.length).run()},Q(s,[{key:"scaleX",get:function(){return this.settings.ScaleX},set:function(e){this.settings.ScaleX=e}},{key:"scaleY",get:function(){return this.settings.ScaleY},set:function(e){this.settings.ScaleY=e}}]),s}(Vt);function qu(l,s,o){if(s)for(var e,t=C(s);!(e=t()).done;){if(o&&o.canceled)return;Fa.RouteEdge(e.value,l.padding)}else for(var h,i=C(l.nodesBreadthFirst);!(h=i()).done;){var c=h.value;if(o&&o.canceled)return;for(var p,f=C(c.outEdges());!(p=f()).done;){var y=p.value;null==y.curve&&Fa.RouteEdge(y,l.padding)}for(var P,m=C(c.selfEdges());!(P=m()).done;){var L=P.value;null==L.curve&&Fa.RouteEdge(L,l.padding)}}}var Fa=function(l){function s(t,e){var r;return(r=l.call(this,null)||this).edges=t,r.padding=e,r}return X(s,l),s.prototype.run=function(){bn.CreatePortsIfNeeded(this.edges);for(var r,e=C(this.edges);!(r=e()).done;)s.RouteEdge(r.value,this.padding)},s.RouteEdge=function(e,r){var i=e;null==i.sourcePort&&(i.sourcePort=kn.mk(function(){return e.source.boundaryCurve},function(){return e.source.center})),null==i.targetPort&&(i.targetPort=kn.mk(function(){return e.target.boundaryCurve},function(){return e.target.center})),s.ContainmentLoop(i,r)||(i.curve=s.GetEdgeLine(e)),vr.trimSplineAndCalculateArrowheadsII(i,i.sourcePort.Curve,i.targetPort.Curve,e.curve,!1)},s.ContainmentLoop=function(e,r){var i=e.sourcePort.Curve,h=e.targetPort.Curve;if(null==i||null==h)return!1;var c=i.boundingBox,f=h.boundingBox,p=c.containsRect(f),y=!p&&f.containsRect(c);return!(!p&&!y||(e.curve=s.CreateLoop(c,f,y,r),0))},s.CreateLoop=function(e,r,i,h){return i?s.CreateLoop_(e,r,h,!1):s.CreateLoop_(r,e,h,!0)},s.CreateLoop_=function(e,r,i,h){var c=e.center,f=s.FindClosestPointOnBoxBoundary(e.center,r),p=f.sub(c),m=(Math.abs(p.x)<q.distanceEpsilon?Math.min(c.y-r.bottom,r.top-c.y):Math.min(c.x-r.left,r.right-c.x))/2,P=Math.min(i,m);p.length<=q.distanceEpsilon&&(p=new R(1,0));var L=p.normalize(),E=L.rotate(Math.PI/2),S=f.add(L.mul(i)),T=S.add(E.mul(P)),O=f.add(E.mul(P)),x=c.add(E.mul(P));return ce.mkFromPoints(h?[x,O,T,S,f,c]:[c,f,S,T,O,x]).createCurve()},s.FindClosestPointOnBoxBoundary=function(e,r){var i=e.x-r.left<r.right-e.x?r.left:r.right,h=e.y-r.bottom<r.top-e.y?r.bottom:r.top;return Math.abs(i-e.x)<Math.abs(h-e.y)?new R(i,e.y):new R(e.x,h)},s.GetEdgeLine=function(e){var r,i,h,c;null==e.sourcePort?(r=e.source.center,i=e.source.boundaryCurve):(r=e.sourcePort.Location,i=e.sourcePort.Curve),null==e.targetPort?(h=e.target.center,c=e.target.boundaryCurve):(h=e.targetPort.Location,c=e.targetPort.Curve);var f=Z.mkPP(r,h),p=K.getAllIntersections(i,f,!1);if(p.length>0){var y=f.trim(p[0].par1,1);y instanceof Z&&(p=K.getAllIntersections(c,f=y,!1)).length>0&&(y=f.trim(0,p[0].par1))instanceof Z&&(f=y)}return f},s.CreateSimpleEdgeCurveWithUnderlyingPolyline=function(e){var r=e.sourcePort?e.sourcePort.Location:e.source.center,i=e.targetPort?e.targetPort.Location:e.target.center;e.source===e.target?(e.smoothedPolyline=s.CreateUnderlyingPolylineForSelfEdge(r,2/(3*e.source.boundaryCurve.boundingBox.width),e.source.boundingBox.height/4),e.curve=e.smoothedPolyline.createCurve()):(e.smoothedPolyline=ce.mkFromPoints([r,i]),e.curve=e.smoothedPolyline.createCurve()),vr.trimSplineAndCalculateArrowheadsII(e,e.source.boundaryCurve,e.target.boundaryCurve,e.curve,!1)},s.CreateUnderlyingPolylineForSelfEdge=function(e,r,i){var h=e.add(new R(0,i)),c=e.add(new R(r,i)),f=e.add(new R(r,-1*i)),p=e.add(new R(0,-1*i)),y=Yt.mkSiteP(e),m=new ce(y);return y=Yt.mkSiteSP(y,h),y=Yt.mkSiteSP(y,c),y=Yt.mkSiteSP(y,f),y=Yt.mkSiteSP(y,p),Yt.mkSiteSP(y,e),m},s.SetStraightLineEdgesWithUnderlyingPolylines=function(e){bn.CreatePortsIfNeeded(Array.from(e.deepEdges));for(var i,r=C(e.deepEdges);!(i=r()).done;)s.CreateSimpleEdgeCurveWithUnderlyingPolyline(i.value)},s}(Vt);function Ba(){Ba=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ma=function(){var o,l={exports:{}};return o=l.exports,Object.defineProperty(o,"__esModule",{value:!0}),o.binarySearch=function(r,i,h){if(0===r.length)return-1;for(var c=0,f=r.length-1;c<=f;){var p=c+(f-c>>1);switch(Math.sign(h.compare(r[p],i))){case-1:c=p+1;break;case 0:return p;case 1:f=p-1}}return~c},l.exports}(),af=function(l,s,o,t,e,r){function i(){var c,f;if(this._values=[],arguments.length>0){var p=arguments.length<=0?void 0:arguments[0];void 0===p||null!=p&&Symbol.iterator in Object(p)?(c=p,arguments.length>1&&(f=arguments.length<=1?void 0:arguments[1])):f=p}if(f??(f=tr.defaultComparer),this._comparer="function"==typeof f?tr.create(f):f,c)for(var m,y=C(c);!(m=y()).done;)this.add(m.value)}var h=i.prototype;return h.has=function(f){return(0,Ma.binarySearch)(this._values,f,this._comparer)>=0},h.add=function(f){var p=(0,Ma.binarySearch)(this._values,f,this._comparer);return p>=0?this._values[p]=f:this._values.splice(~p,0,f),this},h.delete=function(f){var p=(0,Ma.binarySearch)(this._values,f,this._comparer);return p>=0&&(this._values.splice(p,1),!0)},h.clear=function(){this._values.length=0},h.keys=function(){return this._values.values()},h.values=function(){return this._values.values()},h.entries=Ba().mark(function c(){var f;return Ba().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:f=0;case 1:if(!(f<this._values.length)){y.next=7;break}return y.next=4,[this._values[f],this._values[f]];case 4:f++,y.next=1;break;case 7:case"end":return y.stop()}},c,this)}),h[l]=function(){return this.values()},h.forEach=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var m,y=C(this);!(m=y()).done;){var P=m.value;f.call(p,P,P,this)}},h[o]=function(c){return this.has(c)},h[t]=function(c){this.add(c)},h[e]=function(c){return this.delete(c)},h[r]=function(){this.clear()},Q(i,[{key:"comparer",get:function(){return this._comparer}},{key:"size",get:function(){return this._values.length}},{key:s,get:function(){return this.size}}]),i}(Symbol.iterator,Jt.size,Jt.has,Jt.add,Jt.delete,Jt.clear);function Va(){Va=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}Object.defineProperty(af.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"SortedSet"});var ve=function(){var l={exports:{}};return function(s,o,t){var e=Va().mark(Y);Object.defineProperty(o,"__esModule",{value:!0});var r=Math.pow(2,31)-1,i=2146435069,h=101,c=[3,7,11,17,23,29,37,47,59,71,89,107,131,163,197,239,293,353,431,521,631,761,919,1103,1327,1597,1931,2333,2801,3371,4049,4861,5839,7013,8419,10103,12143,14591,17519,21023,25229,30293,36353,43627,52361,62851,75431,90523,108631,130363,156437,187751,225307,270371,324449,389357,467237,560689,672827,807403,968897,1162687,1395263,1674319,2009191,2411033,2893249,3471899,4166287,4999559,5999471,7199369];function f(_){if(1&_){for(var D=0|Math.sqrt(_),j=3;j<=D;j+=2)if(!(_%j))return!1;return!0}return 2===_}function p(_){if(_<0)throw new RangeError;for(var D=0;D<c.length;D++){var j=c[D];if(j>=_)return j}for(var H=1|_;H<r;H+=2)if(f(H)&&(H-1)%h)return H;return _}function L(_,D){var j=p(D);return _.freeList=-1,_.buckets=new Int32Array(j),_.entries=new Array(j),j}function E(_,D){var j=_.size,H=new Int32Array(D),u=_.entries?_.entries.slice():[];u.length=D;for(var n=0;n<j;n++){var a=u[n];if(a&&a.hashCode>=0){var d=a.hashCode%D;a.next=H[d]-1,H[d]=n+1}}_.buckets=H,_.entries=u}function S(_,D){var j=-1;if(_.buckets&&_.entries){var H=_.equaler.hash(D)&r;j=_.buckets[H%_.buckets.length]-1;for(var u=_.entries.length;j>>>0<u;){var n=_.entries[j];if(n.hashCode===H&&_.equaler.equals(n.key,D))break;j=n.next}}return j}function Y(_,D){var j,H;return Va().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:j=_;case 1:if(!j){n.next=11;break}if(H=j.skipNextEntry,j=j.nextEntry,!H){n.next=6;break}return n.abrupt("continue",1);case 6:if(!j){n.next=9;break}return n.next=9,D(j);case 9:n.next=1;break;case 11:case"end":return n.stop()}},e)}o.createHashData=function(_,D){var j={prevEntry:void 0,nextEntry:void 0,skipNextEntry:!1,next:0,hashCode:0,key:void 0,value:void 0},H={buckets:void 0,entries:void 0,freeSize:0,freeList:0,size:0,equaler:_,head:j,tail:j};return L(H,D),H},o.findEntryIndex=S,o.findEntryValue=function(_,D){var j=S(_,D);return j>=0?_.entries[j].value:void 0},o.insertEntry=function(_,D,j){if(_.buckets||L(_,0),!_.buckets||!_.entries)throw new Error;for(var H=_.equaler.hash(D)&r,u=H%_.buckets.length,n=_.buckets[u]-1;n>>>0<_.entries.length;){var a=_.entries[n];if(a.hashCode===H&&_.equaler.equals(a.key,D))return void(a.value=j);n=a.next}var g,d=!1;if(_.freeSize>0)g=_.freeList,d=!0,_.freeSize--;else{var v=_.size;if(v===_.entries.length){if(E(_,function(_){var D=2*_;return D>i&&i>_?i:p(D)}(_.size)),!_.buckets||!_.entries)throw new Error;u=H%_.buckets.length}g=v,_.size=v+1}var w=_.entries[g]||(_.entries[g]={prevEntry:void 0,nextEntry:void 0,skipNextEntry:!1,next:0,hashCode:0,key:void 0,value:void 0});d&&(_.freeList=w.next),w.hashCode=H,w.next=_.buckets[u]-1,w.key=D,w.value=j,w.skipNextEntry=!1;var b=_.tail;b.nextEntry=w,w.prevEntry=b,_.tail=w,_.buckets[u]=g+1},o.deleteEntry=function(_,D){if(_.buckets&&_.entries)for(var n,j=_.equaler.hash(D)&r,H=j%_.buckets.length,u=-1,a=_.buckets[H]-1;a>=0;a=n.next){if((n=_.entries[a]).hashCode===j&&_.equaler.equals(n.key,D)){u<0?_.buckets[H]=n.next+1:_.entries[u].next=n.next;var d=n.prevEntry;return d.nextEntry=n.nextEntry,d.nextEntry&&(d.nextEntry.prevEntry=d),_.tail===n&&(_.tail=d),n.hashCode=-1,n.next=_.freeList,n.key=void 0,n.value=void 0,n.prevEntry=void 0,n.nextEntry=d,n.skipNextEntry=!0,_.freeList=a,_.freeSize++,!0}u=a}return!1},o.clearEntries=function(_){if(_.size>0){_.buckets&&_.buckets.fill(0),_.entries&&_.entries.fill(void 0);for(var j=_.head.nextEntry;j;){var H=j.nextEntry;j.prevEntry=void 0,j.nextEntry=_.head,j.skipNextEntry=!0,j=H}_.head.nextEntry=void 0,_.tail=_.head,_.size=0,_.freeList=-1,_.freeSize=0}},o.ensureCapacity=function(_,D){if(D<0)throw new RangeError;var j=_.entries?_.entries.length:0;if(j>=D)return j;if(!_.buckets)return L(_,D);var H=p(D);return E(_,p(D)),H},o.trimExcessEntries=function(_,D){if(void 0===D&&(D=_.size-_.freeSize),D<_.size)throw new RangeError;if(_.buckets&&_.entries){var j=p(D),H=_.entries;if(!(j>=(H?H.length:0))){var u=_.size;if(L(_,j),!_.buckets||!_.entries)throw new Error;for(var n=0,a=0;a<u;a++){var d=H[a].hashCode;if(d>=0){var g=d%j;_.entries[n]=H[a],_.entries[n].next=_.buckets[g]-1,_.buckets[g]=n+1,n++}}_.size=n,_.freeSize=0}}},o.selectEntryKey=function(_){return _.key},o.selectEntryValue=function(_){return _.value},o.selectEntryEntry=function(_){return[_.key,_.value]},o.iterateEntries=Y,o.forEachEntry=function(_,D,j,H){for(var u=D;u;){var n=u.skipNextEntry;u=u.nextEntry,!n&&u&&j.call(H,u.value,u.key,_)}}}(0,l.exports),l.exports}(),Qu=function(l,s,o,t,e,r,i,h,c){function f(){var y,m,P;if(arguments.length>0){var L=arguments.length<=0?void 0:arguments[0];if("number"==typeof L){if(!(Object.is(L,0|L)&&L>=0))throw new RangeError("Argument out of range: capacity");y=L,arguments.length>1&&(P=arguments.length<=1?void 0:arguments[1])}else void 0===L||null!=L&&Symbol.iterator in Object(L)?(m=L,arguments.length>1&&(P=arguments.length<=1?void 0:arguments[1])):P=L}if(y??(y=0),P??(P=Oe.defaultEqualer),this._hashData=(0,ve.createHashData)(P,y),m)for(var S,E=C(m);!(S=E()).done;){var T=S.value;this.set(T[0],T[1])}}var p=f.prototype;return p.has=function(m){return(0,ve.findEntryIndex)(this._hashData,m)>=0},p.get=function(m){return(0,ve.findEntryValue)(this._hashData,m)},p.set=function(m,P){return(0,ve.insertEntry)(this._hashData,m,P),this},p.delete=function(m){return(0,ve.deleteEntry)(this._hashData,m)},p.clear=function(){(0,ve.clearEntries)(this._hashData)},p.ensureCapacity=function(m){if("number"!=typeof m)throw new TypeError("Number expected: capacity");if(!(Object.is(m,0|m)&&m>=0))throw new RangeError("Argument out of range: capacity");return(0,ve.ensureCapacity)(this._hashData,m)},p.trimExcess=function(m){if(void 0!==m){if("number"!=typeof m)throw new TypeError("Number expected: capacity");if(!(Object.is(m,0|m)&&m>=0))throw new RangeError("Argument out of range: capacity")}(0,ve.trimExcessEntries)(this._hashData,m)},p.keys=function(){return(0,ve.iterateEntries)(this._hashData.head,ve.selectEntryKey)},p.values=function(){return(0,ve.iterateEntries)(this._hashData.head,ve.selectEntryValue)},p.entries=function(){return(0,ve.iterateEntries)(this._hashData.head,ve.selectEntryEntry)},p[l]=function(){return this.entries()},p.forEach=function(m,P){if("function"!=typeof m)throw new TypeError("Function expected: callback");(0,ve.forEachEntry)(this,this._hashData.head,m,P)},p[o]=function(y){return this.has(y)},p[t]=function(y){return this.get(y)},p[e]=function(){return this.keys()},p[r]=function(){return this.values()},p[i]=function(y,m){this.set(y,m)},p[h]=function(y){return this.delete(y)},p[c]=function(){this.clear()},Q(f,[{key:"equaler",get:function(){return this._hashData.equaler}},{key:"size",get:function(){return this._hashData.size-this._hashData.freeSize}},{key:s,get:function(){return this.size}}]),f}(Symbol.iterator,xe.size,xe.has,xe.get,xe.keys,xe.values,Te.set,Te.delete,Te.clear);function Da(){Da=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}Object.defineProperty(Qu.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"HashMap"});var ge=function(){var l={exports:{}};return function(s,o,t){var e=Da().mark(V);Object.defineProperty(o,"__esModule",{value:!0});var r=Math.pow(2,31)-1,i=2146435069,h=101,c=[3,7,11,17,23,29,37,47,59,71,89,107,131,163,197,239,293,353,431,521,631,761,919,1103,1327,1597,1931,2333,2801,3371,4049,4861,5839,7013,8419,10103,12143,14591,17519,21023,25229,30293,36353,43627,52361,62851,75431,90523,108631,130363,156437,187751,225307,270371,324449,389357,467237,560689,672827,807403,968897,1162687,1395263,1674319,2009191,2411033,2893249,3471899,4166287,4999559,5999471,7199369];function f(W){if(1&W){for(var _=0|Math.sqrt(W),D=3;D<=_;D+=2)if(!(W%D))return!1;return!0}return 2===W}function p(W){if(W<0)throw new RangeError;for(var _=0;_<c.length;_++){var D=c[_];if(D>=W)return D}for(var j=1|W;j<r;j+=2)if(f(j)&&(j-1)%h)return j;return W}function L(W,_){var D=p(_);return W.freeList=-1,W.buckets=new Int32Array(D),W.entries=new Array(D),D}function E(W,_){var D=W.size,j=new Int32Array(_),H=W.entries?W.entries.slice():[];H.length=_;for(var u=0;u<D;u++){var n=H[u];if(n&&n.hashCode>=0){var a=n.hashCode%_;n.next=j[a]-1,j[a]=u+1}}W.buckets=j,W.entries=H}function V(W,_){var D,j;return Da().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:D=W;case 1:if(!D){u.next=11;break}if(j=D.skipNextEntry,D=D.nextEntry,!j){u.next=6;break}return u.abrupt("continue",1);case 6:if(!D){u.next=9;break}return u.next=9,_(D);case 9:u.next=1;break;case 11:case"end":return u.stop()}},e)}o.createHashData=function(W,_){var D={prevEntry:void 0,nextEntry:void 0,skipNextEntry:!1,next:0,hashCode:0,key:void 0,value:void 0},j={buckets:void 0,entries:void 0,freeSize:0,freeList:0,size:0,equaler:W,head:D,tail:D};return L(j,_),j},o.findEntryIndex=function(W,_){var D=-1;if(W.buckets&&W.entries){var j=W.equaler.hash(_)&r;D=W.buckets[j%W.buckets.length]-1;for(var H=W.entries.length;D>>>0<H;){var u=W.entries[D];if(u.hashCode===j&&W.equaler.equals(u.key,_))break;D=u.next}}return D},o.insertEntry=function(W,_,D){if(W.buckets||L(W,0),!W.buckets||!W.entries)throw new Error;for(var j=W.equaler.hash(_)&r,H=j%W.buckets.length,u=W.buckets[H]-1;u>>>0<W.entries.length;){var n=W.entries[u];if(n.hashCode===j&&W.equaler.equals(n.key,_))return void(n.value=D);u=n.next}var d,a=!1;if(W.freeSize>0)d=W.freeList,a=!0,W.freeSize--;else{var g=W.size;if(g===W.entries.length){if(E(W,function(W){var _=2*W;return _>i&&i>W?i:p(_)}(W.size)),!W.buckets||!W.entries)throw new Error;H=j%W.buckets.length}d=g,W.size=g+1}var v=W.entries[d]||(W.entries[d]={prevEntry:void 0,nextEntry:void 0,skipNextEntry:!1,next:0,hashCode:0,key:void 0,value:void 0});a&&(W.freeList=v.next),v.hashCode=j,v.next=W.buckets[H]-1,v.key=_,v.value=D,v.skipNextEntry=!1;var w=W.tail;w.nextEntry=v,v.prevEntry=w,W.tail=v,W.buckets[H]=d+1},o.deleteEntry=function(W,_){if(W.buckets&&W.entries)for(var u,D=W.equaler.hash(_)&r,j=D%W.buckets.length,H=-1,n=W.buckets[j]-1;n>=0;n=u.next){if((u=W.entries[n]).hashCode===D&&W.equaler.equals(u.key,_)){H<0?W.buckets[j]=u.next+1:W.entries[H].next=u.next;var a=u.prevEntry;return a.nextEntry=u.nextEntry,a.nextEntry&&(a.nextEntry.prevEntry=a),W.tail===u&&(W.tail=a),u.hashCode=-1,u.next=W.freeList,u.key=void 0,u.value=void 0,u.prevEntry=void 0,u.nextEntry=a,u.skipNextEntry=!0,W.freeList=n,W.freeSize++,!0}H=n}return!1},o.clearEntries=function(W){if(W.size>0){W.buckets&&W.buckets.fill(0),W.entries&&W.entries.fill(void 0);for(var D=W.head.nextEntry;D;){var j=D.nextEntry;D.prevEntry=void 0,D.nextEntry=W.head,D.skipNextEntry=!0,D=j}W.head.nextEntry=void 0,W.tail=W.head,W.size=0,W.freeList=-1,W.freeSize=0}},o.ensureCapacity=function(W,_){if(_<0)throw new RangeError;var D=W.entries?W.entries.length:0;if(D>=_)return D;if(!W.buckets)return L(W,_);var j=p(_);return E(W,p(_)),j},o.trimExcessEntries=function(W,_){if(void 0===_&&(_=W.size-W.freeSize),_<W.size)throw new RangeError;if(W.buckets&&W.entries){var D=p(_),j=W.entries;if(!(D>=(j?j.length:0))){var H=W.size;if(L(W,D),!W.buckets||!W.entries)throw new Error;for(var u=0,n=0;n<H;n++){var a=j[n].hashCode;if(a>=0){var d=a%D;W.entries[u]=j[n],W.entries[u].next=W.buckets[d]-1,W.buckets[d]=u+1,u++}}W.size=u,W.freeSize=0}}},o.selectEntryKey=function(W){return W.key},o.selectEntryValue=function(W){return W.value},o.selectEntryEntry=function(W){return[W.key,W.value]},o.iterateEntries=V,o.forEachEntry=function(W,_,D,j){for(var H=_;H;){var u=H.skipNextEntry;H=H.nextEntry,!u&&H&&D.call(j,H.value,H.key,W)}}}(0,l.exports),l.exports}(),mo=function(l,s,o,t,e,r){function i(){var c,f,p;if(arguments.length>0){var y=arguments.length<=0?void 0:arguments[0];if("number"==typeof y){if(!(Object.is(y,0|y)&&y>=0))throw new RangeError("Argument out of range: capacity");c=y,arguments.length>1&&(p=arguments.length<=1?void 0:arguments[1])}else void 0===y||null!=y&&Symbol.iterator in Object(y)?(f=y,arguments.length>1&&(p=arguments.length<=1?void 0:arguments[1])):p=y}if(c??(c=0),p??(p=Oe.defaultEqualer),this._hashData=(0,ge.createHashData)(p,c),f)for(var P,m=C(f);!(P=m()).done;)this.add(P.value)}var h=i.prototype;return h.has=function(f){return(0,ge.findEntryIndex)(this._hashData,f)>=0},h.add=function(f){return(0,ge.insertEntry)(this._hashData,f,f),this},h.tryAdd=function(f){var p=this.size;return(0,ge.insertEntry)(this._hashData,f,f),this.size>p},h.delete=function(f){return(0,ge.deleteEntry)(this._hashData,f)},h.clear=function(){(0,ge.clearEntries)(this._hashData)},h.ensureCapacity=function(f){if("number"!=typeof f)throw new TypeError("Number expected: capacity");if(!(Object.is(f,0|f)&&f>=0))throw new RangeError("Argument out of range: capacity");return(0,ge.ensureCapacity)(this._hashData,f)},h.trimExcess=function(f){if(void 0!==f){if("number"!=typeof f)throw new TypeError("Number expected: capacity");if(!(Object.is(f,0|f)&&f>=0))throw new RangeError("Argument out of range: capacity")}(0,ge.trimExcessEntries)(this._hashData,f)},h.keys=function(){return(0,ge.iterateEntries)(this._hashData.head,ge.selectEntryKey)},h.values=function(){return(0,ge.iterateEntries)(this._hashData.head,ge.selectEntryValue)},h.entries=function(){return(0,ge.iterateEntries)(this._hashData.head,ge.selectEntryEntry)},h[l]=function(){return this.values()},h.forEach=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");(0,ge.forEachEntry)(this,this._hashData.head,f,p)},h[o]=function(c){return this.has(c)},h[t]=function(c){this.add(c)},h[e]=function(c){return this.delete(c)},h[r]=function(){this.clear()},Q(i,[{key:"equaler",get:function(){return this._hashData.equaler}},{key:"size",get:function(){return this._hashData.size-this._hashData.freeSize}},{key:s,get:function(){return this.size}}]),i}(Symbol.iterator,Jt.size,Jt.has,Jt.add,Jt.delete,Jt.clear);function xi(){xi=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}Object.defineProperty(mo.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"HashSet"});var sf=function(l,s,o,t,e,r,i,h,c,f,p){function y(){var P,L;this._size=0;for(var E,S,T,O=arguments.length,x=new Array(O),B=0;B<O;B++)x[B]=arguments[B];if(function(l){var o=l[1];return"number"==typeof l[0]&&(void 0===o||"object"==typeof o&&null!==o||"function"==typeof o)}(x)){E=x[0];var M=x[1];T=void 0===M?{}:M}else if(E=0,function(l){var s=l[0],o=l[1];return(void 0===s||null!=s&&Symbol.iterator in Object(s))&&(void 0===o||"object"==typeof o&&null!==o||"function"==typeof o)}(x)){S=x[0];var F=x[1];T=void 0===F?{}:F}else T={};var A=null!==(P=T?.keyEqualer)&&void 0!==P?P:Oe.defaultEqualer,z=null!==(L=T?.valueEqualer)&&void 0!==L?L:Oe.defaultEqualer;if(this._map=new Qu(E,A),this._keyEqualer=A,this._valueEqualer=z,S)for(var Y,V=C(S);!(Y=V()).done;){var W=Y.value;this.add(W[0],W[1])}}var m=y.prototype;return m.has=function(L){return this._map.has(L)},m.hasValue=function(L,E){var S=this._map.get(L);return!!S&&S.has(E)},m.get=function(L){return this._map.get(L)},m.add=function(L,E){var S=this._map.get(L);S||(S=new mo(this._valueEqualer),this._map.set(L,S));var T=S.size;return S.add(E),this._size+=S.size-T,this},m.delete=function(L){var E=this._map.get(L);return E?(this._size-=E.size,this._map.delete(L),E.size):0},m.deleteValue=function(L,E){var S=this._map.get(L);if(S){var T=S.size;if(S.delete(E))return this._size+=S.size-T,S.size<=0&&this._map.delete(L),!0}return!1},m.clear=function(){this._map.clear(),this._size=0},m.ensureCapacity=function(L){return this._map.ensureCapacity(L)},m.trimExcess=function(L){this._map.trimExcess(L)},m.keys=function(){return this._map.keys()},m.values=xi().mark(function(){var L,E,S;return xi().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:L=C(this._map.values());case 1:if((E=L()).done){O.next=6;break}return O.delegateYield(S=E.value,"t0",4);case 4:O.next=1;break;case 6:case"end":return O.stop()}},S,this)}),m.entries=xi().mark(function P(){var L,E,S,T,x,B,M;return xi().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:L=C(this._map);case 1:if((E=L()).done){A.next=12;break}T=(S=E.value)[0],x=C(S[1]);case 4:if((B=x()).done){A.next=10;break}return M=B.value,A.next=8,[T,M];case 8:A.next=4;break;case 10:A.next=1;break;case 12:case"end":return A.stop()}},P,this)}),m[l]=function(){return this.entries()},m.forEach=function(L,E){if("function"!=typeof L)throw new TypeError("Function expected: callback");for(var T,S=C(this._map);!(T=S()).done;)for(var F,O=T.value,x=O[0],M=C(O[1]);!(F=M()).done;)L.call(E,F.value,x,this)},m[o]=function(P){return this.has(P)},m[t]=function(P,L){return this.hasValue(P,L)},m[e]=function(P){return this.get(P)},m[r]=function(){return this.keys()},m[i]=function(){return this.values()},m[h]=function(P,L){this.add(P,L)},m[c]=function(P){return this.delete(P)},m[f]=function(P,L){return this.deleteValue(P,L)},m[p]=function(){this.clear()},Q(y,[{key:"keyEqualer",get:function(){return this._keyEqualer}},{key:"valueEqualer",get:function(){return this._valueEqualer}},{key:"size",get:function(){return this._size}},{key:s,get:function(){return this.size}}]),y}(Symbol.iterator,de.size,de.has,de.hasValue,de.get,de.keys,de.values,Vn.add,Vn.delete,Vn.deleteValue,Vn.clear);function pn(){pn=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}Object.defineProperty(sf.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"MultiMap"});var ja,yn,Dr,mn,jr,he=function(){function l(o){this._list=void 0,this._previous=void 0,this._next=void 0,this.value=o}return l.prototype.detachSelf=function(){return!!this._list&&this._list.deleteNode(this)},Q(l,[{key:"list",get:function(){return this._list}},{key:"previous",get:function(){if(this._previous&&this._list&&this!==this._list.first)return this._previous}},{key:"next",get:function(){if(this._next&&this._list&&this._next!==this._list.first)return this._next}}]),l}();ja=function(s,o){s._list=o},yn=function(s){return s._previous},Dr=function(s,o){s._previous=o},mn=function(s){return s._next},jr=function(s,o){s._next=o},Object.defineProperty(he.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"LinkedListNode"});var wn,Pe,Wa=function(l,s,o,t,e,r){function i(){var c,f;if(this._size=0,this._head=void 0,arguments.length>0){var p=arguments.length<=0?void 0:arguments[0];void 0===p||null!=p&&Symbol.iterator in Object(p)?(c=p,arguments.length>1&&(f=arguments.length<=1?void 0:arguments[1])):f=p}if(f??(f=Oe.defaultEqualer),this._equaler="function"==typeof f?Oe.create(f):f,c)for(var m,y=C(c);!(m=y()).done;)this.push(m.value)}var h=i.prototype;return h[l]=function(){return this.values()},h.values=pn().mark(function c(){var f,p,y;return pn().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:f=C(this.nodes());case 1:if((p=f()).done){P.next=7;break}return y=p.value,P.next=5,y.value;case 5:P.next=1;break;case 7:case"end":return P.stop()}},c,this)}),h.nodes=pn().mark(function c(){var f,p;return pn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:p=this.first;case 1:if(void 0===p){m.next=8;break}return p=(f=p).next,m.next=6,f;case 6:m.next=1;break;case 8:case"end":return m.stop()}},c,this)}),h.drain=pn().mark(function c(){var f,p,y;return pn().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:f=C(this.nodes());case 1:if((p=f()).done){P.next=8;break}return this.deleteNode(y=p.value),P.next=6,y.value;case 6:P.next=1;break;case 8:case"end":return P.stop()}},c,this)}),h.nodeOf=function(f,p){if(null!=p&&!(p instanceof he))throw new TypeError("LinkedListNode expected: fromNode");if(null!=p&&p.list!==this)throw new TypeError("Wrong list.");for(var y=p??this.first;y;y=y.next)if(this._equaler.equals(y.value,f))return y},h.lastNodeOf=function(f,p){if(null!=p&&!(p instanceof he))throw new TypeError("LinkedListNode expected: fromNode");if(null!=p&&p.list!==this)throw new TypeError("Wrong list.");for(var y=p??this.last;y;y=y.previous)if(this._equaler.equals(y.value,f))return y},h.find=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var y,m=this.first;void 0!==m;){m=(y=m).next;var P=y.value;if(f.call(p,P,y,this))return P}},h.findLast=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var y,m=this.last;void 0!==m;){m=(y=m).previous;var P=y.value;if(f.call(p,P,y,this))return P}},h.findNode=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var y,m=this.first;void 0!==m;)if(m=(y=m).next,f.call(p,y.value,y,this))return y},h.findLastNode=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var y,m=this.last;void 0!==m;)if(m=(y=m).previous,f.call(p,y.value,y,this))return y},h.has=function(f){return void 0!==this.nodeOf(f)},h.insertBefore=function(f,p){if(null!=f&&!(f instanceof he))throw new TypeError("LinkedListNode expected: node");if(null!=f&&f.list!==this)throw new TypeError("Wrong list.");return this._insertNode(f??void 0,new he(p),0)},h.insertNodeBefore=function(f,p){if(null!=f&&!(f instanceof he))throw new TypeError("LinkedListNode expected: node");if(null!=f&&f.list!==this)throw new TypeError("Wrong list.");if(!(p instanceof he))throw new TypeError("LinkedListNode expected: newNode");if(p.list)throw new Error("Node is already attached to a list.");this._insertNode(f||void 0,p,0)},h.insertAfter=function(f,p){if(null!=f&&!(f instanceof he))throw new TypeError("LinkedListNode expected: node");if(null!=f&&f.list!==this)throw new TypeError("Wrong list.");return this._insertNode(f||void 0,new he(p),1)},h.insertNodeAfter=function(f,p){if(null!=f&&!(f instanceof he))throw new TypeError("LinkedListNode expected: node");if(null!=f&&f.list!==this)throw new TypeError("Wrong list.");if(!(p instanceof he))throw new TypeError("LinkedListNode expected: newNode");if(p.list)throw new Error("Node is already attached to a list.");this._insertNode(f||void 0,p,1)},h.push=function(f){return this._insertNode(void 0,new he(f),1)},h.pushNode=function(f){if(!(f instanceof he))throw new TypeError("LinkedListNode expected: newNode");if(f.list)throw new Error("Node is already attached to a list.");this._insertNode(void 0,f,1)},h.pop=function(){var f=this.popNode();return f?f.value:void 0},h.popNode=function(){var f=this.last;if(this.deleteNode(f))return f},h.shift=function(){var f=this.shiftNode();return f?f.value:void 0},h.shiftNode=function(){var f=this.first;if(this.deleteNode(f))return f},h.unshift=function(f){return this._insertNode(void 0,new he(f),0)},h.unshiftNode=function(f){if(!(f instanceof he))throw new TypeError("LinkedListNode expected: newNode");if(f.list)throw new Error("Node is already attached to a list.");this._insertNode(void 0,f,0)},h.delete=function(f){var p=this.nodeOf(f);if(p&&this.deleteNode(p))return p},h.deleteNode=function(f){if(null!=f&&!(f instanceof he))throw new TypeError("LinkedListNode expected: node");if(null!=f&&f.list!==this)throw new TypeError("Wrong list.");return!(null==f||!f.list)&&this._deleteNode(f)},h.deleteAll=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: predicate");for(var y=0,m=this.first;m;){var P=m.next;f.call(p,m.value,m,this)&&m.list===this&&(this._deleteNode(m),++y),m=P}return y},h.clear=function(){for(;this.size>0;)this.deleteNode(this.last)},h.forEach=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var y,m=this.first;void 0!==m;)m=(y=m).next,f.call(p,y.value,y,this)},h.map=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var m,y=new i,P=this.first;void 0!==P;){P=(m=P).next;var L=f.call(p,m.value,m,this);y.push(L)}return y},h.filter=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var m,y=new i(this.equaler),P=this.first;void 0!==P;){P=(m=P).next;var L=m.value;f.call(p,L,m,this)&&y.push(L)}return y},h.reduce=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var P,y=arguments.length>1,m=p,L=this.first;void 0!==L;){L=(P=L).next;var E=P.value;y?m=f(m,E,P,this):(m=E,y=!0)}return m},h.reduceRight=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var P,y=arguments.length>1,m=p,L=this.last;void 0!==L;){var E=(P=L).value;y?m=f(m,E,P,this):(m=E,y=!0),L=P.previous}return m},h.some=function(f,p){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected: callback");for(var y,m=this.first;void 0!==m;)if(m=(y=m).next,!f||f.call(p,y.value,y,this))return!0;return!1},h.every=function(f,p){if("function"!=typeof f)throw new TypeError("Function expected: callback");for(var m,y=!1,P=this.first;void 0!==P;){if(P=(m=P).next,!f.call(p,m.value,m,this))return!1;y=!0}return y},h._deleteNode=function(f){return mn(f)===f?this._head=void 0:(Dr(mn(f),yn(f)),jr(yn(f),mn(f)),this._head===f&&(this._head=mn(f))),ja(f,void 0),Dr(f,void 0),jr(f,void 0),this._size--,!0},h._insertNode=function(f,p,y){if(ja(p,this),void 0===this._head)jr(p,p),Dr(p,p),this._head=p;else switch(y){case 0:void 0===f?(f=this._head,this._head=p):f===this._head&&(this._head=p),jr(p,f),Dr(p,yn(f)),jr(yn(f),p),Dr(f,p);break;case 1:void 0===f&&(f=yn(this._head)),Dr(p,f),jr(p,mn(f)),Dr(mn(f),p),jr(f,p)}return this._size++,p},h[o]=function(c){return this.has(c)},h[t]=function(c){this.push(c)},h[e]=function(c){return!!this.delete(c)},h[r]=function(){this.clear()},Q(i,[{key:"equaler",get:function(){return this._equaler}},{key:"first",get:function(){return this._head}},{key:"last",get:function(){if(this._head)return yn(this._head)}},{key:"size",get:function(){return this._size}},{key:s,get:function(){return this.size}}]),i}(Symbol.iterator,we.size,we.has,Jt.add,Jt.delete,Jt.clear);function Ha(){Ha=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}Object.defineProperty(Wa.prototype,Symbol.toStringTag,{configurable:!0,writable:!0,value:"LinkedList"}),function(l){l[l.OverlapsOtherLabels=0]="OverlapsOtherLabels",l[l.OverlapsNodes=1]="OverlapsNodes",l[l.OverlapsEdges=2]="OverlapsEdges",l[l.OverlapsNothing=Number.MAX_VALUE]="OverlapsNothing"}(wn||(wn={})),function(l){l[l.Any=0]="Any",l[l.Port=1]="Port",l[l.Starboard=2]="Starboard",l[l.Top=3]="Top",l[l.Bottom=4]="Bottom",l[l.Left=5]="Left",l[l.Right=6]="Right"}(Pe||(Pe={}));var Un,hf=function(){},cf=function(){function l(){this.points=new Wa,this.coveredLength=0}var s=l.prototype;return s.AddFirst=function(t){return 0!==this.points.size&&(this.coveredLength=this.coveredLength+t.Center.sub(this.points.first.value.Center).length),this.points.insertBefore(null,t),this.coveredLength},s.AddLast=function(t){return 0!==this.points.size&&(this.coveredLength=this.coveredLength+t.Center.sub(this.points.last.value.Center).length),this.points.insertAfter(null,t),this.coveredLength},l}();!function(l){l[l.AlongCurve=0]="AlongCurve",l[l.Horizontal=1]="Horizontal"}(Un||(Un={}));var Ku=function(s){this.location=s,this.boundingBox=lt.rectangleOnPoint(s)},Ti=function(s,o){this.data=o,this.boundingBox=s},ff=function(s){this.innerPoints=[],this.outerPoints=[],this.placementSide=Pe.Any,this.placementOffset=.5,this.edgePoints=s},Yn=function(l){function s(t,e){var r;return(r=l.call(this,null)||this).placementStrategy=[Un.Horizontal,Un.AlongCurve],r.obstacleMaps=[],r.edgeInfos=new Map,r.granularity=s.MinGranularity,r.ScaleCollisionGranularity=!0,r.granularity=r.ScaleCollisionGranularity?r.interpolateGranularity(e.length):s.MinGranularity,r.InitializeObstacles(t,e),r.edges=e,r}X(s,l),s.constructorG=function(e){return new s(Array.from(e.nodesBreadthFirst),Array.from(e.deepEdges).filter(function(r){return r.label}))},s.constructorGA=function(e,r){return new s(Array.from(e.nodesBreadthFirst),r.filter(function(i){return i.label}))};var o=s.prototype;return o.interpolateGranularity=function(e){return e<=s.LowerEdgeBound?s.MaxGranularity:e>=s.UpperEdgeBound?s.MinGranularity:Math.ceil(s.MinGranularity+(s.UpperEdgeBound-s.LowerEdgeBound)/(e-s.LowerEdgeBound))},o.InitializeObstacles=function(e,r){var i=this.GetEdgeObstacles(r);this.obstacleMaps[1]=ui(e.map(function(h){return[h.boundingBox,new Ti(h.boundingBox,h)]})),this.obstacleMaps[2]=ui(i.map(function(h){return[h.boundingBox,new Ti(h.boundingBox,h)]}))},s.CurvePoints=function(e,r){var i=[],h=e.end.sub(e.start).lengthSquared/(r*r);return s.SubdivideCurveSegment(i,e,h,e.parStart,e.parEnd),i.sort(s.compareByArgument),i},s.compareByArgument=function(e,r){return e[0]<r[0]?-1:e[0]>r[0]?1:0},s.SubdivideCurveSegment=function(e,r,i,h,c){if(!(e.length>64)){var f=r.value(h),p=r.value(c);if(f.sub(p).lengthSquared>i){var y=(h+c)/2;s.SubdivideCurveSegment(e,r,i,h,y),s.SubdivideCurveSegment(e,r,i,y,c)}else e.push([h,f])}},s.PlaceLabelsAtDefaultPositions=function(e,r){for(var h,i=C(r);!(h=i()).done;){var c=h.value;c.label&&new s([c.source,c.target],[c]).run()}},o.GetEdgeObstacles=function(e){for(var h,r=[],i=C(e);!(h=i()).done;){var c=h.value;if(null!=c.curve){var f=s.CurvePoints(c.curve,this.CollisionGranularity);this.edgeInfos.set(c,new ff(f));for(var y,p=C(f);!(y=p()).done;)r.push(new Ku(y.value[1]))}}return r},o.AddLabelObstacle=function(e){null==this.labelObstacleMap?(this.labelObstacleMap=ui([[e.boundingBox,e]]),this.obstacleMaps[0]=this.labelObstacleMap):this.labelObstacleMap.Add(e.boundingBox,e)},o.run=function(){var e=this;this.edges.sort(function(c,f){return e.edgeInfos.get(c).edgePoints.length-e.edgeInfos.get(f).edgePoints.length});for(var i,r=C(this.edges);!(i=r()).done;)this.PlaceLabel(i.value)},o.PlaceLabel=function(e){for(var h,r=!1,i=C(this.placementStrategy);!(h=i()).done;){switch(h.value){case Un.AlongCurve:r=this.PlaceEdgeLabelOnCurve(e.label);break;case Un.Horizontal:r=this.PlaceEdgeLabelHorizontally(e);break;default:throw new Error("unexpected case")}if(r)break}r?this.CalculateCenterLabelInfoCenter(e.label):this.PlaceLabelAtFirstPosition(e.label)},o.getLabelInfo=function(e){return this.edgeInfos.get(e.parent)},o.PlaceLabelAtFirstPosition=function(e){var r=e.parent,i=r.curve,h=this.edgeInfos.get(r).edgePoints,c=this.StartIndex(e,h.map(function(E){return E[1]})),f=h[c][1],p=i.derivative(h[c][0]);p.length<q.distanceEpsilon&&(p=new R(1,1)),p=p.normalize();var y=new ar(e.width,e.height),m=this.getLabelInfo(e),P=s.GetPossibleSides(m.placementSide,p)[0],L=s.GetLabelBounds(f,p,y,P);this.SetLabelBounds(this.getLabelInfo(e),L)},o.StartIndex=function(e,r){var i=this.getLabelInfo(e);return Math.min(r.length-1,Math.max(0,Math.floor(r.length*i.placementOffset)))},o.CalculateCenterLabelInfoCenter=function(e){for(var c,r=this.getLabelInfo(e),i=new R(0,0),h=C(r.innerPoints);!(c=h()).done;)i=i.add(c.value);for(var y,p=C(r.outerPoints);!(y=p()).done;)i=i.add(y.value);e.positionCenter(i.div(r.innerPoints.length+r.outerPoints.length))},o.PlaceEdgeLabelHorizontally=function(e){for(var P,r=e.label,h=this.getLabelInfo(r).edgePoints,c=new ar(r.width,r.height),f=-1,p=lt.mkEmpty(),y=e.curve,m=C(s.ExpandingSearch(this.StartIndex(r,h.map(function(z){return z[1]})),0,h.length));!(P=m()).done;){var E=h[P.value],S=y.derivative(E[0]);if(!dt(S.lengthSquared,0)){S=S.normalize();for(var O,T=C(s.GetPossibleSides(this.getLabelInfo(r).placementSide,S));!(O=T()).done;){var B=s.GetLabelBounds(E[1],S,c,O.value),M=this.ConflictIndexRL(B,r);if(M>f&&(p=B,(f=M)===Number.MAX_VALUE))break}if(f===Number.MAX_VALUE)break}}if(f>=0){this.SetLabelBounds(this.getLabelInfo(r),p);var F=new Ti(p,null);return this.AddLabelObstacle(F),this.getLabelInfo(r).placementResult=0===f?wn.OverlapsOtherLabels:1===f?wn.OverlapsNodes:2===f?wn.OverlapsEdges:wn.OverlapsNothing,!0}return!1},s.GetLabelBounds=function(e,r,i,h){var c=r.rotate(Math.PI/2).mul(h),f=e.add(c),y=c.x>0?f.x:f.x-i.width,m=c.y>0?f.y:f.y-i.height;if(Math.abs(c.x)<.75){var P=Math.acos(Math.abs(c.y)/1),L=1/Math.sin(P),E=1/Math.cos(P);y+=(c.x>0?-1:1)*Math.min(L,i.width/2),m+=(c.y>0?1:-1)*E}else if(Math.abs(c.y)<.75){var S=Math.acos(Math.abs(c.x)/1),T=1/Math.sin(S),O=1/Math.cos(S);y+=(c.x>0?1:-1)*O,m+=(c.y>0?-1:1)*Math.min(T,i.height/2)}return lt.mkLeftBottomSize(y,m,i)},o.SetLabelBounds=function(e,r){e.innerPoints=[r.leftTop,r.rightTop],e.outerPoints=[r.leftBottom,r.rightBottom]},s.GetPossibleSides=function(e,r){switch(0===r.length&&(e=Pe.Any),e){case Pe.Port:return[-1];case Pe.Starboard:return[1];case Pe.Top:return dt(r.x,0)?s.GetPossibleSides(Pe.Left,r):[1];case Pe.Bottom:return dt(r.x,0)?s.GetPossibleSides(Pe.Right,r):[r.x<0?-1:1];case Pe.Left:return dt(r.y,0)?s.GetPossibleSides(Pe.Top,r):[r.y<0?-1:1];case Pe.Right:return dt(r.y,0)?s.GetPossibleSides(Pe.Bottom,r):[r.y<0?1:-1];default:return[-1,1]}},s.ExpandingSearch=Ha().mark(function t(e,r,i){var h,c;return Ha().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:c=h=e+1;case 2:if(!(c>r)){p.next=7;break}return p.next=5,--c;case 5:p.next=2;break;case 7:if(!(h<i)){p.next=12;break}return p.next=10,h++;case 10:p.next=7;break;case 12:case"end":return p.stop()}},t)}),s.PointSetLength=function(e){for(var c,r=0,i=null,h=C(e);!(c=h()).done;){var f=c.value;null!=i&&(r+=i.sub(f.Center).length),i=f.Center}return r},o.PlaceEdgeLabelOnCurve=function(e){var r=e.parent,i=this.getLabelInfo(e);i.innerPoints=null;for(var P,h=i.edgePoints,f=e.height/2,p=new ar(f,f),y=e.width,m=C(s.ExpandingSearch(this.StartIndex(e,h),0,h.length));!(P=m()).done;)for(var T,L=P.value,S=C(this.GetSidesAndEdgeCurve(e,r,h,L));!(T=S()).done;){var O=T.value,x=new cf,B={coveredLength:0};if(this.ProcessExpandingSearchOnSide(L,h,r.curve,O,f,3,p,B,x,y),B.coveredLength>=y)return this.CaseOfCoveredLengthGreaterThanLabelLength(e,x,B.coveredLength,y,p),!0}return!1},o.CaseOfCoveredLengthGreaterThanLabelLength=function(e,r,i,h,c){var f=new Array,p=new Array,y=Array.from(r.points),m=i-h;if(m>0){var P=y[y.length-1],L=y[y.length-2],E=P.Center.sub(L.Center),S=E.length;m>S&&(S=(E=(P=y[0]).Center.sub((L=y[1]).Center)).length);var T=E.mul((S-m)/S);P.Center=L.Center.add(T),P.Inner=L.Inner.add(T),P.Outer=L.Outer.add(T)}this.GoOverOrderedPointsAndAddLabelObstacels(y,f,p,c);var O=this.getLabelInfo(e);O.innerPoints=f,O.outerPoints=p},o.GoOverOrderedPointsAndAddLabelObstacels=function(e,r,i,h){for(var f,c=C(e);!(f=c()).done;){var p=f.value,y=p.Center;r.push(p.Inner),i.push(p.Outer);var m=new Ti(lt.mkSizeCenter(new ar(2*h.width,2*h.height),y),null);this.AddLabelObstacle(m)}},o.ProcessExpandingSearchOnSide=function(e,r,i,h,c,f,p,y,m,P){for(var E,L=C(s.ExpandingSearch(e,0,r.length));!(E=L()).done;){var S=E.value,T=r[S],x=T[1],B=i.derivative(T[0]);if(!dt(B.lengthSquared,0)){var M=B.rotate(Math.PI/2).normalize().mul(h),F=x.add(M.mul(c+f));if(this.Conflict(F,c,p))break;var A=new hf;if(A.Center=F,A.Inner=x.add(M.mul(f)),A.Outer=x.add(M.mul(2*c+f)),y.coveredLength=S<=e?m.AddFirst(A):m.AddLast(A),y.coveredLength>=P)break}}},o.GetSidesAndEdgeCurve=function(e,r,i,h){var c=r.curve.derivative(i[h][0]);return s.GetPossibleSides(this.getLabelInfo(e).placementSide,c)},o.Conflict=function(e,r,i){return this.ConflictIndex(e,r,i)!==Number.MAX_VALUE},o.ConflictIndexRL=function(e,r){for(var i=r.parent,h=i.source,c=i.target,f=0;f<this.obstacleMaps.length;f++)if(null!=this.obstacleMaps[f])for(var y,p=C(this.obstacleMaps[f].GetAllIntersecting(e));!(y=p()).done;){var m=y.value;if(!(f===wn.OverlapsNodes&&m instanceof Ti&&m.data instanceof Ae&&(h.node.isDescendantOf(m.data.graph)||c.node.isDescendantOf(m.data))))return f}return Number.MAX_VALUE},o.ConflictIndex=function(e,r,i){for(var h=lt.creatRectangleWithSize(new ar(2*i.width,2*i.height),e),c=r*r,f=0;f<this.obstacleMaps.length;f++)if(null!=this.obstacleMaps[f]){for(var p=0;p<this.obstacleMaps.length;p++)if(null!=this.obstacleMaps[p])for(var m,y=C(this.obstacleMaps[p].GetAllIntersecting(h));!(m=y()).done;){var P=m.value;if(!(P instanceof Ku))return p;if(e.sub(P.location).lengthSquared<c)return p}return Number.MAX_VALUE}},Q(s,[{key:"CollisionGranularity",get:function(){return this.granularity},set:function(e){this.granularity=e}}]),s}(Vt);Yn.MinGranularity=5,Yn.MaxGranularity=50,Yn.LowerEdgeBound=500,Yn.UpperEdgeBound=3e3;var Pr=function(l){function s(t,e){var r;return void 0===e&&(e=null),(r=l.call(this,t,rt.AlgorithmDataIndex)||this).data=e,r}X(s,l);var o=s.prototype;return o.clone=function(){throw new Error("Method not implemented.")},o.rebind=function(e){this.entity=e,this.bind(rt.AlgorithmDataIndex)},s.getAlgData=function(e){return e.getAttr(rt.AlgorithmDataIndex)},s}(et);function _a(l){var s=Pr.getAlgData(l.node);return null==s?null:s.data}var df=function(){function l(o,t){this.force=new R(0,0),this.stayWeight=1,this.index=o,this.geomNode=t,this.ResetBounds()}var s=l.prototype;return s.ResetBounds=function(){this.previousCenter=this.geomNode.center,this.center=this.geomNode.center,this.Width=this.geomNode.width,this.Height=this.geomNode.height},s.ToString=function(){return"FINode("+this.index+"):"+this.geomNode},Q(l,[{key:"Center",get:function(){return this.center},set:function(t){this.geomNode.center=t,this.center=t}}]),l}(),vf=function(){function l(o){this._length=1,this.mEdge=o,this.sourceFiNode=_a(this.mEdge.source),this.targetFiNode=_a(this.mEdge.target)}return l.prototype.vector=function(){return this.sourceFiNode.geomNode.center.sub(this.targetFiNode.geomNode.center)},Q(l,[{key:"source",get:function(){return this.sourceFiNode.index}},{key:"target",get:function(){return this.targetFiNode.index}},{key:"length",get:function(){return this._length},set:function(t){this._length=t}}]),l}(),Wr=function(){function l(){}var s=l.prototype;return s.Distance2=function(t){var e=this.c.y-t.y,r=this.c.x-t.x;return r*r+e*e},s.Contains=function(t){return this.Distance2(t)-1e-7<=this.r2},s.ContainsPN=function(t,e){for(var h,r=this,i=function(p){if(-1==e.findIndex(function(y){return y==p})&&!r.Contains(t[p]))return{v:!1}},c=0;c<t.length;c++)if(h=i(c))return h.v;return!0},l.constructorP=function(t){var e=new l;return e.c=t,e.r=0,e.r2=0,e},l.midPoint=function(t,e){return new R((e.x+t.x)/2,(e.y+t.y)/2)},l.constructorPP=function(t,e){var r=new l;return r.c=l.midPoint(t,e),r.r2=r.Distance2(t),r.r=Math.sqrt(r.r2),Mt.assert(r.OnBoundary(t)),Mt.assert(r.OnBoundary(e)),r},s.OnBoundary=function(t){var e=this.Distance2(t);return Math.abs(e-this.r2)/(e+this.r2)<1e-5},l.centre=function(t,e,r){Mt.assert(e.x!=t.x),Mt.assert(r.x!=e.x);var i=(e.y-t.y)/(e.x-t.x),h=(r.y-e.y)/(r.x-e.x);Mt.assert(h!=i);var c,f=(i*h*(t.y-r.y)+h*(t.x+e.x)-i*(e.x+r.x))/(2*(h-i));return c=Math.abs(i)>Math.abs(h)?(t.y+e.y)/2-(f-(t.x+e.x)/2)/i:(e.y+r.y)/2-(f-(e.x+r.x)/2)/h,new R(f,c)},l.Collinear=function(t,e,r){return t.x*(e.y-r.y)+(e.x*(r.y-t.y)+r.x*(t.y-e.y))==0},l.constructorPPP=function(t,e,r){l.count++;var i=new l;if(l.Collinear(t,e,r)){var h=new R(Math.min(t.x,Math.min(e.x,r.x)),Math.min(t.y,Math.max(e.y,r.y))),c=new R(Math.max(t.x,Math.max(e.x,r.x)),Math.max(t.y,Math.max(e.y,r.y)));i.c=l.midPoint(h,c),i.r2=i.Distance2(c),i.r=Math.sqrt(i.r2)}else{var p=r.x-e.x,y=r.x-t.x;0!=e.x-t.x?0!=p?i.c=l.centre(t,e,r):(Mt.assert(0!=y),i.c=l.centre(e,t,r)):(Mt.assert(0!=p),i.c=l.centre(e,r,t)),i.r2=i.Distance2(t),i.r=Math.sqrt(i.r2),Mt.assert(i.OnBoundary(t)),Mt.assert(i.OnBoundary(e)),Mt.assert(i.OnBoundary(r))}return i},Q(l,[{key:"Center",get:function(){return this.c}},{key:"Radius",get:function(){return this.r}}]),l}();Wr.count=0;var Fe,gf=function(){function l(o,t){switch(this.boundary=t,Mt.assert(t.length<=3),t.length){case 0:this.disc=null;break;case 1:this.disc=Wr.constructorP(o[t[0]]);break;case 2:this.disc=Wr.constructorPP(o[t[0]],o[t[1]]);break;case 3:this.disc=Wr.constructorPPP(o[t[0]],o[t[1]],o[t[2]])}}return l.prototype.contains=function(t){return null!=this.disc&&this.disc.Contains(t)},l}(),pf=function(){function l(o){this.ps=o,this.L=new Wa;for(var t=0;t<this.ps.length;t++)this.L.push(t);var e=this.mtf_md(null,new Array);this.disc=e.disc,this.boundary=e.boundary}var s=l.prototype;return s.collinear3=function(t){return 3==t.length&&Wr.Collinear(this.ps[t[0]],this.ps[t[1]],this.ps[t[2]])},s.mtf_md=function(t,e){Mt.assert(e.length<=3);var r=new gf(this.ps,e);if(3==e.length)return r;for(var i=this.L.first;null!=i&&i!=t;){var h=i.next,c=i.value;if(!r.contains(this.ps[c])){var f=Array.from(e);f.push(c),Mt.assert(!this.collinear3(f),"Collinear points on boundary of minimal enclosing disc"),r=this.mtf_md(i,f),this.L.deleteNode(i),this.L.insertNodeBefore(null,i)}i=h}return r},l}(),yf=function(){function l(){}return l.LinearComputation=function(o){return new pf(o).disc},l.SlowComputation=function(o){for(var t=o.length,e=null,r=null,i=0;i<t;i++)for(var h=0;h<t;h++){if(i!=h){var c=Wr.constructorPP(o[i],o[h]);c.ContainsPN(o,[i,h])&&(null==e||e.Radius>c.Radius)&&(e=c,r=[i,h])}for(var f=0;f<t;f++)if(f!=i&&f!=h&&!Wr.Collinear(o[i],o[h],o[f])){var p=Wr.constructorPPP(o[i],o[h],o[f]);p.ContainsPN(o,[i,h,f])&&(null==e||e.Radius>p.Radius)&&(e=p,r=[i,h,f])}}return Mt.assert(null!=r),e},l}(),Oi=function(){function l(){}l.constructorNPA=function(t,e,r){var i=new l;i.p=t,i.z0=new Kt(e.x,e.y),i.a=new Array(t);for(var h=0;h<t;h++)i.a[h]=i.compute(h,r);return i},l.constructorPMM=function(t,e,r){var i=new l;Mt.assert(e.p==r.p),i.p=e.p,i.z0=new Kt(t.x,t.y);var h=r.shift(i.z0),c=e.shift(i.z0);i.a=new Array(i.p);for(var f=0;f<i.p;f++)i.a[f]=za(c[f],h[f]);return i},l.factorial=function(t){for(var e=1,r=2;r<=t;r++)e*=r;return e},l.binomial=function(t,e){return l.factorial(t)/(l.factorial(e)*l.factorial(t-e))};var s=l.prototype;return s.sum=function(t,e){for(var r=Kt.constructorN(0),i=1;i<=t;i++){var h=Kt.constructorN(l.binomial(t-1,i-1));r=za(r,Hr(this.a[i],Hr(Kt.Pow(e,t-i),h)))}return r},s.shift=function(t){for(var e=new Array(this.p),r=e[0]=this.a[0],i=Ai(this.z0,t),h=1;h<this.p;h++){var c=Kt.constructorN(h);e[h]=za(Hr(wf(r),qa(Kt.Pow(i,h),c)),this.sum(h,i))}return e},s.compute=function(t,e){var r=e.length,i=Kt.constructorN(0);if(0==t)i.re=r;else{for(var h=0;h<r;h++){var c=e[h],f=new Kt(c.x,c.y);i=Ai(i,Kt.Pow(Ai(f,this.z0),t))}i.divideBy(t)}return i},s.ApproximateForce=function(t){for(var r=Ai(new Kt(t.x,t.y),this.z0),i=qa(this.a[0],r),h=r,c=0;i=Ai(i,qa(mf(this.a[c],c),h)),++c!=this.p;)h=Hr(h,r);return new R(i.re,-i.im)},l.Force=function(t,e){var r=e.sub(t),i=r.lengthSquared;return i<.1?0!=i?r.div(.1):new R(1,0):r.div(i)},l}(),Kt=function(){function l(o,t){this.re=o,this.im=t}return l.constructorN=function(t){return new l(t,0)},l.prototype.divideBy=function(t){this.re/=t,this.im/=t},l.Pow=function(t,e){switch(Mt.assert(e>=0),e){case 0:return l.constructorN(1);case 1:return t;case 2:return Hr(t,t);case 3:return Hr(t,Hr(t,t));default:return Hr(l.Pow(t,e/2),l.Pow(t,e/2+e%2))}},l}();function za(l,s){return new Kt(l.re+s.re,l.im+s.im)}function Hr(l,s){return new Kt(l.re*s.re-l.im*s.im,l.re*s.im+s.re*l.im)}function mf(l,s){return new Kt(l.re*s,l.im*s)}function Ai(l,s){return new Kt(l.re-s.re,l.im-s.im)}function wf(l){return new Kt(-l.re,-l.im)}function qa(l,s){var o=s.re*s.re+s.im*s.im;return 0==o?Kt.constructorN(0):new Kt((l.re*s.re+l.im*s.im)/o,(l.im*s.re-l.re*s.im)/o)}!function(l){l[l.Horizontal=0]="Horizontal",l[l.Vertical=1]="Vertical"}(Fe||(Fe={}));var tl=function(){function l(){}return l.prototype.intersects=function(t){return t.med.Center.sub(this.med.Center).length<t.med.Radius+this.med.Radius},l}(),Pf=function(l){function s(t,e,r){var i;return(i=l.call(this)||this).med=t,i.parent=e.parent,null!=i.parent&&(i.parent.leftChild==e?i.parent.leftChild=Xe(i):i.parent.rightChild=Xe(i)),i.leftChild=e,i.rightChild=r,e.parent=Xe(i),r.parent=Xe(i),i}return X(s,l),s.prototype.computeMultipoleCoefficients=function(e){this.leftChild.computeMultipoleCoefficients(e),this.rightChild.computeMultipoleCoefficients(e),this.multipoleCoefficients=Oi.constructorPMM(this.med.Center,this.leftChild.multipoleCoefficients,this.rightChild.multipoleCoefficients)},s}(tl),el=function(l){function s(t){var e;return(e=l.call(this)||this).particles=t,e.ComputeMinimumEnclosingDisc(),e}X(s,l);var o=s.prototype;return o.computeMultipoleCoefficients=function(e){this.multipoleCoefficients=Oi.constructorNPA(e,this.med.Center,this.ps)},o.ComputeMinimumEnclosingDisc=function(){var e=this.Size();this.ps=new Array(e);for(var r=0;r<e;r++)this.ps[r]=this.particles[0][r].point;return this.med=yf.LinearComputation(this.ps)},o.Min=function(e){return this.particles[e][0].pos(e)},o.Size=function(){return this.particles[0].length},o.Max=function(e){return this.particles[e][this.Size()-1].pos(e)},o.Dimension=function(e){return this.Max(e)-this.Min(e)},o.Split=function(e){for(var r=this.Dimension(Fe.Horizontal)>this.Dimension(Fe.Vertical)?Fe.Horizontal:Fe.Vertical,i=r==Fe.Horizontal?Fe.Vertical:Fe.Horizontal,h=this.Size(),c=h>>1,f=h-c,p=[new Array(c),new Array(c)],y=[new Array(f),new Array(f)],m=0,P=0,L=0;L<h;L++){var E=this.particles[r][L];L<c?(p[r][L]=E,E.splitLeft=!0):(y[r][L-c]=E,E.splitLeft=!1)}for(var S=0;S<h;S++){var T=this.particles[i][S];T.splitLeft?p[i][P++]=T:y[i][m++]=T}var O=this.med;return this.particles=p,this.ComputeMinimumEnclosingDisc(),e.rightSibling=new s(y),new Pf(O,this,e.rightSibling)},o.ComputeForces=function(){for(var r,e=C(this.particles[0]);!(r=e()).done;)for(var c,i=r.value,h=C(this.particles[0]);!(c=h()).done;){var f=c.value;i!=f&&(i.force=i.force.add(Oi.Force(i.point,f.point)))}},s}(tl),Sf=function(){function l(o){this.point=o,this.force=new R(0,0)}return l.prototype.pos=function(t){return t==Fe.Horizontal?this.point.x:this.point.y},l}(),bf=function(){function l(o,t){this.particles=o;var e=new Array;e.push(this.particlesBy(Fe.Horizontal)),e.push(this.particlesBy(Fe.Vertical)),this.leaves=new Array;var r=new el(e);this.leaves.push(r);var i={rightSibling:null};this.root=r.Split(i),this.leaves.push(i.rightSibling);var h=new Ef(t);for(h.EnqueueLL(r,i.rightSibling);h.length>0;)(r=h.dequeue()).Split(i),this.leaves.push(i.rightSibling),h.EnqueueLL(r,i.rightSibling)}var s=l.prototype;return s.particlesBy=function(t){return this.particles.map(function(e){return e}).sort(function(e,r){return e.pos(t)-r.pos(t)})},s.ComputeForces=function(t){this.root.computeMultipoleCoefficients(t);for(var r,e=C(this.leaves);!(r=e()).done;){var i=r.value;i.ComputeForces();var h=new Array;for(h.push(this.root);h.length>0;){var c=h.pop();if(i.intersects(c))if(c instanceof el)for(var P,m=C(i.particles[0]);!(P=m()).done;)for(var S,L=P.value,E=C(c.particles[0]);!(S=E()).done;){var T=S.value;L!=T&&(L.force=L.force.add(Oi.Force(L.point,T.point)))}else{var O=c;h.push(O.leftChild),h.push(O.rightChild)}else for(var p,f=C(i.particles[0]);!(p=f()).done;){var y=p.value;y.force=y.force.sub(c.multipoleCoefficients.ApproximateForce(y.point))}}}},l}(),Ef=function(l){function s(t){var e;return(e=l.call(this)||this).B=t,e}return X(s,l),s.prototype.EnqueueLL=function(e,r){e.Size()>this.B&&this.enqueue(e),r.Size()>this.B&&this.enqueue(r)},s}(ye.c),rl=function(l){function s(t,e,r){var i;if((i=l.call(this,null)||this).clustersInfo=new Map,i.clusterEdges=new Array,i.graph=t,i.settings=e,i.initFiNodesEdges(),i.edges=Array.from(i.graph.shallowEdges).map(function(E){return Pr.getAlgData(E.edge).data}),i.nodes=Array.from(i.graph.shallowNodes).map(function(E){return Pr.getAlgData(E.node).data}),i.components=new Array,i.settings.InterComponentForces)i.components.push(i.nodes);else{i.basicGraph=Ke(i.edges,i.nodes.length);for(var c,h=C(on(i.basicGraph));!(c=h()).done;){for(var P,f=c.value,p=new Array(f.length),y=0,m=C(f);!(P=m()).done;)p[y++]=i.nodes[P.value];i.components.push(p)}}return i.computeWeight(t),i.setCurrentConstraintLevel(r),i}X(s,l);var o=s.prototype;return o.initFiNodesEdges=function(){for(var i,e=0,r=C(this.graph.shallowNodes);!(i=r()).done;){var h=i.value,c=new df(e++,h);new Pr(h.node,c)}for(var p,f=C(this.graph.shallowEdges);!(p=f()).done;){var y=p.value,m=new vf(y);new Pr(y.edge,m)}},o.getCurrentConstraintLevel=function(){return this.currentConstraintLevel},o.setCurrentConstraintLevel=function(e){this.currentConstraintLevel=e,this.settings.Unconverge()},o.ResetNodePositions=function(){for(var r,e=C(this.nodes);!(r=e()).done;)r.value.ResetBounds()},o.AddRepulsiveForce=function(e,r){e.force=r.mul(10*this.settings.RepulsiveForceConstant)},o.AddLogSpringForces=function(e,r,i){var h=r.length,c=7e-4*this.settings.AttractiveForceConstant*h*Math.log((h+.1)/(i+.1));e.sourceFiNode.force=e.sourceFiNode.force.add(r.mul(c)),e.targetFiNode.force=e.targetFiNode.force.sub(r.mul(c))},o.AddSquaredSpringForces=function(e,r,i){var f=this.settings.AttractiveForceConstant*(r.length-i)/(i*i+.1);e.sourceFiNode.force=e.sourceFiNode.force.add(r.mul(f)),e.targetFiNode.force=e.targetFiNode.force.sub(r.mul(f))},o.AddSpringForces=function(e){var r;if(this.settings.RespectEdgePorts){var i=e.sourceFiNode.Center,h=e.targetFiNode.Center,c=e.mEdge.sourcePort;c instanceof ke&&(i=c.Location);var f=e.mEdge.targetPort;f instanceof ke&&(h=f.Location),r=i.sub(h)}else r=e.vector();this.settings.LogScaleEdgeForces?this.AddLogSpringForces(e,r,e.length):this.AddSquaredSpringForces(e,r,e.length)},s.AddGravityForce=function(e,r,i){null!=i&&(i.force=i.force.sub(e.sub(i.Center).mul(1e-4*r)))},o.ComputeRepulsiveForces=function(e){var r=e.length;if(r>16&&this.settings.ApproximateRepulsion){for(var i=new Array(e.length),h=Math.PI/r*2,c=0,f=0;f<r;f++)i[f]=new Sf(e[f].Center.add(new R(Math.cos(c),Math.sin(c)).mul(1e-5))),c+=h;new bf(i,8).ComputeForces(5);for(var y=0;y<e.length;y++)this.AddRepulsiveForce(e[y],i[y].force)}else for(var P,m=C(e);!(P=m()).done;){for(var T,L=P.value,E=new R(0,0),S=C(e);!(T=S()).done;){var O=T.value;L!=O&&(E=E.add(Oi.Force(L.Center,O.Center)))}this.AddRepulsiveForce(L,E)}},o.SetBarycenter=function(e){var r=this.clustersInfo.get(e);if(null!=r)return r.barycenter;var i=new R(0,0);if(e.shallowNodeCount||function(l){for(var s=C(l.Clusters);!s().done;)return!0;return!1}(e)){var h=this.clustersInfo.get(e);if((null==h||null==h.weight)&&this.computeWeight(e),null!=h.weight){for(var f,c=C(e.shallowNodes);!(f=c()).done;){var p=f.value;i=i.add(p instanceof je?p.center:this.SetBarycenter(p).mul(this.clustersInfo.get(p).weight))}this.clustersInfo.get(e).barycenter=i=i.div(h.weight)}}else this.clustersInfo.get(e).barycenter=i;return i},o.computeWeight=function(e){for(var h,r=0,i=C(e.shallowNodes);!(h=i()).done;){var c=h.value;c.entity instanceof De?r+=this.computeWeight(c):r++}var f=this.clustersInfo.get(e);return null==f&&this.clustersInfo.set(e,f={barycenter:new R(0,0)}),f.weight=r,r},o.AddClusterForces=function(e){if(null!=e){this.SetBarycenter(e);for(var i,r=C(this.clusterEdges);!(i=r()).done;){var h=i.value,c=at.getGeom(h.source),f=at.getGeom(h.target),p=Pr.getAlgData(h.source).data,y=Pr.getAlgData(h.target).data,m=c.hasOwnProperty("shallowNodes"),P=m?this.clustersInfo.get(c).barycenter:c.center,L=f.hasOwnProperty("shallowNodes"),E=L?this.clustersInfo.get(f).barycenter:f.center,S=P.sub(E),T=S.length,O=this.settings.AttractiveInterClusterForceConstant*(T*Math.log(T+.1))*1e-8;if(S=S.mul(O),m)for(var M,B=C(c.shallowNodes);!(M=B()).done;){var A=Pr.getAlgData(M.value.node).data;A.force=A.force.add(S)}else p.force=p.force.add(S);if(L)for(var Y,V=C(f.shallowNodes);!(Y=V()).done;){var _=Pr.getAlgData(Y.value.node).data;_.force=_.force.sub(S)}else y.force=y.force.sub(S)}for(var j,D=C(e.subgraphsDepthFirst);!(j=D()).done;)for(var a,H=j.value,u=this.clustersInfo.get(H).barycenter,n=C(H.shallowNodes);!(a=n()).done;)s.AddGravityForce(u,this.settings.ClusterGravity,_a(a.value))}},o.ComputeForces=function(){var e=this;if(null!=this.components)for(var i,r=C(this.components);!(i=r()).done;)this.ComputeRepulsiveForces(i.value);else this.ComputeRepulsiveForces(this.nodes);this.edges.forEach(function(T){return e.AddSpringForces(T)});for(var f,c=C(this.components);!(f=c()).done;){for(var p=f.value,y=new R(0,0),m=0;m<p.length;m++)y=y.add(p[m].Center);y=y.div(p.length);for(var P=Number.NEGATIVE_INFINITY,L=0;L<p.length;L++){var E=p[L];s.AddGravityForce(y,this.settings.GravityConstant,E),E.force.length>P&&(P=E.force.length)}if(P>100)for(var S=0;S<p.length;S++)p[S].force=p[S].force.mul(100/P)}this.AddClusterForces(this.graph)},o.VerletIntegration=function(){var e=this.energy;this.energy=this.ComputeDescentDirection(1),this.UpdateStepSize(e);for(var r=0,i=0;i<this.nodes.length;i++){var h=this.nodes[i];r+=h.Center.sub(h.previousCenter).lengthSquared}return r},o.ComputeDescentDirection=function(e){this.ResetForceVectors(),this.settings.ApplyForces&&this.ComputeForces();for(var h,r=0,i=C(this.nodes);!(h=i()).done;){var c=h.value;r+=c.force.lengthSquared;var f=c.Center.sub(c.previousCenter).mul(this.settings.Friction),p=c.force.mul(-this.stepSize*e);c.previousCenter=c.Center,Mt.assert(!Number.isNaN(p.x),"!double.IsNaN(a.X)"),Mt.assert(!Number.isNaN(p.y),"!double.IsNaN(a.Y)"),Mt.assert(Number.isFinite(p.x),"!double.IsInfinity(a.X)"),Mt.assert(Number.isFinite(p.y),"!double.IsInfinity(a.Y)"),f=(f=f.add(p)).div(c.stayWeight),c.Center=c.Center.add(f)}return r},o.ResetForceVectors=function(){for(var r,e=C(this.nodes);!(r=e()).done;)r.value.force=new R(0,0)},o.UpdateStepSize=function(e){this.energy<e?++this.progress>=3&&(this.progress=0,this.stepSize/=this.settings.Decay):(this.progress=0,this.stepSize*=this.settings.Decay)},o.RungeKuttaIntegration=function(){for(var e=new Array(this.nodes.length),r=new Array(this.nodes.length),i=new Array(this.nodes.length),h=new Array(this.nodes.length),c=new Array(this.nodes.length),f=this.energy,p=0;p<this.nodes.length;p++)this.nodes[p].previousCenter=this.nodes[p].Center,e[p]=this.nodes[p].Center;this.ComputeDescentDirection(3);for(var m=0;m<this.nodes.length;m++)r[m]=this.nodes[m].Center.sub(this.nodes[m].previousCenter),this.nodes[m].Center=e[m].add(r[m].mul(.5));this.ComputeDescentDirection(3);for(var P=0;P<this.nodes.length;P++)i[P]=this.nodes[P].Center.sub(this.nodes[P].previousCenter),this.nodes[P].previousCenter=e[P],this.nodes[P].Center=e[P].add(i[P].mul(.5));this.ComputeDescentDirection(3);for(var L=0;L<this.nodes.length;L++)h[L]=this.nodes[L].Center.sub(this.nodes[L].previousCenter),this.nodes[L].previousCenter=e[L],this.nodes[L].Center=e[L].add(h[L]);this.energy=this.ComputeDescentDirection(3);for(var E=0;E<this.nodes.length;E++){c[E]=this.nodes[E].Center.sub(this.nodes[E].previousCenter),this.nodes[E].previousCenter=e[E];var S=r[E].add(i[E].mul(2).add(h[E].mul(2)).add(c[E])).div(6);this.nodes[E].Center=e[E].add(S)}return this.UpdateStepSize(f),this.nodes.reduce(function(T,O){return O.Center.sub(O.previousCenter).lengthSquared+T},0)},o.run=function(){this.settings.Converged=!1,this.settings.EdgeRoutesUpToDate=!1,0==this.settings.Iterations++&&(this.stepSize=this.settings.InitialStepSize,this.energy=Number.MAX_VALUE,this.progress=0);for(var e=0;e<this.settings.MinorIterations;e++){if((this.settings.RungeKuttaIntegration?this.RungeKuttaIntegration():this.VerletIntegration())<this.settings.DisplacementThreshold||this.settings.Iterations>this.settings.MaxIterations){this.settings.Converged=!0;break}this.ProgressStep()}},s}(Vt),ki=function(){function l(){this.commonSettings=new po,this.maxIterations=100,this.clusterMargin=10,this.minorIterations=3,this.projectionIterations=5,this.approximateRepulsion=!0,this.RungeKuttaIntegration=!1,this.initialStepSize=1.4,this.decay=.9,this.friction=.8,this.repulsiveForceConstant=1,this.attractiveForceConstant=1,this.gravity=1,this.interComponentForces=!0,this.applyForces=!0,this.AvoidOverlaps=!0,this.approximateRouting=!0,this.logScaleEdgeForces=!0,this.displacementThreshold=.1,this.maxConstraintLevel=2,this.minConstraintLevel=0,this.attractiveInterClusterForceConstant=1,this.clusterGravity=1,this.commonSettings.NodeSeparation*=2}var s=l.prototype;return s.ResetLayout=function(){this.Unconverge(),null!=this.algorithm&&this.algorithm.ResetNodePositions()},s.Unconverge=function(){this.iterations=0,this.converged=!1},s.InitializeLayoutGN=function(t,e){this.InitializeLayout(t,e)},s.InitializeLayout=function(t,e){this.algorithm=new rl(t,this,e),this.ResetLayout()},s.Uninitialize=function(){this.algorithm=null},s.IncrementalRunG=function(t){this.IncrementalRunGF(t)},s.SetupIncrementalRun=function(t){this.IsInitialized?this.IsDone&&this.ResetLayout():this.InitializeLayout(t,this.MaxConstraintLevel)},s.IncrementalRunGF=function(t){this.SetupIncrementalRun(t),this.algorithm.run()},s.IncrementalRun=function(t,e){t?.throwIfCanceled(),this.SetupIncrementalRun(e),this.algorithm.cancelToken=t,this.algorithm.run()},s.Clone=function(){return l.ctorClone(this)},s.getCurrentConstraintLevel=function(){return null==this.algorithm?0:this.algorithm.getCurrentConstraintLevel()},s.setCurrentConstraintLevel=function(t){this.algorithm.setCurrentConstraintLevel(t)},l.ctorClone=function(t){var e=new l;return e.maxIterations=t.maxIterations,e.minorIterations=t.minorIterations,e.projectionIterations=t.projectionIterations,e.approximateRepulsion=t.approximateRepulsion,e.initialStepSize=t.initialStepSize,e.RungeKuttaIntegration=t.RungeKuttaIntegration,e.decay=t.decay,e.friction=t.friction,e.repulsiveForceConstant=t.repulsiveForceConstant,e.attractiveForceConstant=t.attractiveForceConstant,e.gravity=t.gravity,e.interComponentForces=t.interComponentForces,e.applyForces=t.applyForces,e.AvoidOverlaps=t.AvoidOverlaps,e.RespectEdgePorts=t.RespectEdgePorts,e.RouteEdges=t.RouteEdges,e.approximateRouting=t.approximateRouting,e.logScaleEdgeForces=t.logScaleEdgeForces,e.displacementThreshold=t.displacementThreshold,e.minConstraintLevel=t.minConstraintLevel,e.maxConstraintLevel=t.maxConstraintLevel,e.attractiveInterClusterForceConstant=t.attractiveInterClusterForceConstant,e.clusterGravity=t.clusterGravity,e.PackingAspectRatio=t.PackingAspectRatio,e.NodeSeparation=t.NodeSeparation,e.clusterMargin=t.clusterMargin,e},l.CreateFastIncrementalLayoutSettings=function(){var t=new l;return t.ApplyForces=!1,t.ApproximateRepulsion=!0,t.ApproximateRouting=!0,t.AttractiveForceConstant=1,t.AttractiveInterClusterForceConstant=1,t.AvoidOverlaps=!0,t.ClusterGravity=1,t.Decay=.9,t.DisplacementThreshold=5e-8,t.Friction=.8,t.GravityConstant=1,t.InitialStepSize=2,t.InterComponentForces=!1,t.Iterations=0,t.LogScaleEdgeForces=!1,t.MaxConstraintLevel=2,t.MaxIterations=20,t.MinConstraintLevel=0,t.MinorIterations=1,t.ProjectionIterations=5,t.RepulsiveForceConstant=2,t.RespectEdgePorts=!1,t.RouteEdges=!1,t.RungeKuttaIntegration=!0,t.NodeSeparation=20,t},Q(l,[{key:"edgeRoutingSettings",get:function(){return this.commonSettings.edgeRoutingSettings},set:function(t){this.commonSettings.edgeRoutingSettings=t}},{key:"PackingAspectRatio",get:function(){return this.commonSettings.PackingAspectRatio},set:function(t){this.commonSettings.PackingAspectRatio=t}},{key:"NodeSeparation",get:function(){return this.commonSettings.NodeSeparation},set:function(t){this.commonSettings.NodeSeparation=t}},{key:"MaxIterations",get:function(){return this.maxIterations},set:function(t){this.maxIterations=t}},{key:"MinorIterations",get:function(){return this.minorIterations},set:function(t){this.minorIterations=t}},{key:"Iterations",get:function(){return this.iterations},set:function(t){this.iterations=t}},{key:"ProjectionIterations",get:function(){return this.projectionIterations},set:function(t){this.projectionIterations=t}},{key:"ApproximateRepulsion",get:function(){return this.approximateRepulsion},set:function(t){this.approximateRepulsion=t}},{key:"InitialStepSize",get:function(){return this.initialStepSize},set:function(t){if(t<=0||t>2)throw new Error("ForceScalar should be greater than 0 and less than 2 (if we let you set it to 0 nothing would happen, greater than 2 would most likely be very unstable!)");this.initialStepSize=t}},{key:"Decay",get:function(){return this.decay},set:function(t){if(t<.1||t>1)throw new Error("Setting decay too small gives no progress.  1==no decay, 0.1==minimum allowed value");this.decay=t}},{key:"Friction",get:function(){return this.friction},set:function(t){if(t<0||t>1)throw new Error("Setting friction less than 0 or greater than 1 would just be strange.  1==no friction, 0==no conservation of velocity");this.friction=t}},{key:"RepulsiveForceConstant",get:function(){return this.repulsiveForceConstant},set:function(t){this.repulsiveForceConstant=t}},{key:"AttractiveForceConstant",get:function(){return this.attractiveForceConstant},set:function(t){this.attractiveForceConstant=t}},{key:"GravityConstant",get:function(){return this.gravity},set:function(t){this.gravity=t}},{key:"InterComponentForces",get:function(){return this.interComponentForces},set:function(t){this.interComponentForces=t}},{key:"ApplyForces",get:function(){return this.applyForces},set:function(t){this.applyForces=t}},{key:"IsInitialized",get:function(){return null!=this.algorithm}},{key:"ApproximateRouting",get:function(){return this.approximateRouting},set:function(t){this.approximateRouting=t}},{key:"LogScaleEdgeForces",get:function(){return this.logScaleEdgeForces},set:function(t){this.logScaleEdgeForces=t}},{key:"DisplacementThreshold",get:function(){return this.displacementThreshold},set:function(t){this.displacementThreshold=t}},{key:"Converged",get:function(){return this.converged},set:function(t){this.converged=t}},{key:"PercentDone",get:function(){return this.Converged?100:100*this.iterations/this.MaxIterations}},{key:"IsDone",get:function(){return this.Converged||this.iterations>=this.MaxIterations}},{key:"Energy",get:function(){return null!=this.algorithm?this.algorithm.energy:0}},{key:"MaxConstraintLevel",get:function(){return this.maxConstraintLevel},set:function(t){this.maxConstraintLevel!=t&&(this.maxConstraintLevel=t,this.IsInitialized&&this.Uninitialize())}},{key:"MinConstraintLevel",get:function(){return this.minConstraintLevel},set:function(t){this.minConstraintLevel=t}},{key:"AttractiveInterClusterForceConstant",get:function(){return this.attractiveInterClusterForceConstant},set:function(t){this.attractiveInterClusterForceConstant=t}},{key:"ClusterGravity",get:function(){return this.clusterGravity},set:function(t){this.clusterGravity=t}}]),l}();function ze(){ze=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Lf=function(){function l(o){this.topNodes=o}var s=l.prototype;return s.nodesBreadthFirst_=ze().mark(function o(){var t,e,r,i,h,c;return ze().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=C(this.topNodes);case 1:if((e=t()).done){p.next=15;break}return r=e.value,p.next=5,je.getGeom(r);case 5:if(!(r instanceof De)){p.next=13;break}i=C(r.nodesBreadthFirst);case 7:if((h=i()).done){p.next=13;break}return c=h.value,p.next=11,je.getGeom(c);case 11:p.next=7;break;case 13:p.next=1;break;case 15:case"end":return p.stop()}},o,this)}),s.clusters=ze().mark(function o(){var t,e,r;return ze().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:t=C(this.topNodes);case 1:if((e=t()).done){h.next=8;break}if(!((r=e.value)instanceof De)){h.next=6;break}return h.next=6,Ae.getGeom(r);case 6:h.next=1;break;case 8:case"end":return h.stop()}},o,this)}),s.subgraphsDepthFirst_=ze().mark(function o(){var t,e,r,i;return ze().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:t=C(this.topNodes);case 1:if((e=t()).done){c.next=10;break}if(!((r=e.value)instanceof De)){c.next=8;break}return i=Ae.getGeom(r),c.delegateYield(i.subgraphsDepthFirst,"t0",6);case 6:return c.next=8,i;case 8:c.next=1;break;case 10:case"end":return c.stop()}},o,this)}),s.edges_=ze().mark(function o(){var t,e,r,i,h,c,f,p,y;return ze().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:t=C(this.topNodes);case 1:if((e=t()).done){P.next=19;break}i=C((r=e.value).outEdges);case 4:if((h=i()).done){P.next=10;break}return c=h.value,P.next=8,sr.getGeom(c);case 8:P.next=4;break;case 10:f=C(r.selfEdges);case 11:if((p=f()).done){P.next=17;break}return y=p.value,P.next=15,sr.getGeom(y);case 15:P.next=11;break;case 17:P.next=1;break;case 19:case"end":return P.stop()}},o,this)}),s.shallowNodes_=ze().mark(function o(){var t,e,r;return ze().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:t=C(this.topNodes);case 1:if((e=t()).done){h.next=7;break}return r=e.value,h.next=5,je.getGeom(r);case 5:h.next=1;break;case 7:case"end":return h.stop()}},o,this)}),s.pumpTheBoxToTheGraphWithMargins=function(){var t={b:lt.mkEmpty()};return Do(this,t),this.boundingBox=t.b},s.translate=function(t){this.boundingBox&&(this.boundingBox.center=this.boundingBox.center.add(t));for(var r,e=C(this.topNodes);!(r=e()).done;)je.getGeom(r.value).translate(t)},Q(l,[{key:"nodesBreadthFirst",get:function(){return this.nodesBreadthFirst_()}},{key:"Clusters",get:function(){return this.clusters()}},{key:"subgraphsDepthFirst",get:function(){return this.subgraphsDepthFirst_()}},{key:"shallowEdges",get:function(){return this.edges_()}},{key:"shallowNodes",get:function(){return this.shallowNodes_()}},{key:"shallowNodeCount",get:function(){return this.topNodes.length}}]),l}(),nl=function(){function l(){}return l.LinearInterpolation=function(o,t,e,r,i){return o<t?r:o>e?i:r+(o-t)/(e-t)*(i-r)},l.NegativeLinearInterpolation=function(o,t,e,r,i){return o<t?i:o>e?r:r+(1-(o-t)/(e-t))*(i-r)},l}(),If=function(l){function s(t,e){var r;return(r=l.call(this,null)||this).SingleComponent=!1,r.graph=t,r.settings=ki.ctorClone(e),r.settings.ApplyForces=!0,r.settings.InterComponentForces=!0,r.settings.RungeKuttaIntegration=!1,r.settings.RespectEdgePorts=!1,r}X(s,l);var o=s.prototype;return o.run=function(){if(this.SingleComponent)this.componentCount=1,this.LayoutComponent(this.graph);else{var e=Array.from(this.graph.graph.getClusteredConnectedComponents()).map(function(c){return new Lf(c)});this.componentCount=e.length;for(var i,r=C(e);!(i=r()).done;)this.LayoutComponent(i.value);this.graph.boundingBox=zu.PackGraphs(e,this.settings.commonSettings)}},o.LayoutComponent=function(e){if(e.shallowNodeCount>1){if(this.settings.MaxIterations=nl.NegativeLinearInterpolation(e.shallowNodeCount,50,500,5,10),this.settings.MinorIterations=nl.NegativeLinearInterpolation(e.shallowNodeCount,50,500,3,20),0==this.settings.MinConstraintLevel){var r=new Ga;r.removeOverlaps=!1,r.IterationsWithMajorization=0,new Na(e,null,function(){return 1},new Ga).run()}for(var f,h=new rl(e,this.settings,this.settings.MinConstraintLevel),c=C(this.GetConstraintLevels(e));!(f=c()).done;){var p=f.value;if(p>this.settings.MaxConstraintLevel)break;p>this.settings.MinConstraintLevel&&h.setCurrentConstraintLevel(p);do{h.run()}while(!this.settings.IsDone)}this.settings.AvoidOverlaps&&Ra.RemoveOverlaps(Array.from(this.graph.shallowNodes),this.settings.NodeSeparation)}e.pumpTheBoxToTheGraphWithMargins(),e.uniformMargins=this.settings.NodeSeparation,e.translate(e.boundingBox.leftBottom.mul(-1))},o.GetConstraintLevels=function(e){var r=new Set;return r.add(0),this.settings.AvoidOverlaps&&e.shallowNodeCount<2e3&&r.add(2),r},s}(Vt);function ol(l){l.layoutSettings||(l.layoutSettings=al(l))}function al(l){var s=function(l){for(var s=l.parent;s;){if(s.layoutSettings)return s.layoutSettings;s=s.parent}return null}(l);if(s)return s;if(l.graph.shallowNodeCount>2e3||l.graph.deepEdgesCount>4e3)return new ki;for(var r,t=!1,e=C(l.deepEdges);!(r=e()).done;){var i=r.value;if(null!=i.sourceArrowhead||null!=i.targetArrowhead){t=!0;break}}return t?new La:new ki}function Of(l,s,o){if(void 0===o&&(o=function(){return 1}),ol(l),l.layoutSettings instanceof La)new as(l,l.layoutSettings,s).run();else if(l.layoutSettings instanceof Ga)new Na(l,s,o,l.layoutSettings).run();else{if(!(l.layoutSettings instanceof ki))throw new Error("not implemented");var r=new If(l,l.layoutSettings);r.SingleComponent=!0,r.run()}}function Af(l,s){void 0===s&&(s=null),ol(l),ll(l,s,Of,ul,ph)}function sl(l){for(;;){if(l.layoutSettings&&l.layoutSettings.commonSettings.edgeRoutingSettings)return l.layoutSettings.commonSettings.edgeRoutingSettings;var s=l.graph.parent;if(!s)break;l=at.getGeom(s)}var o=new Ca;return o.EdgeRoutingMode=re.Spline,o}function ul(l,s,o){var t=sl(l);t.EdgeRoutingMode===re.Rectilinear?hl(l,s):t.EdgeRoutingMode===re.Spline||t.EdgeRoutingMode===re.SplineBundling?function(l,s,o){var t=sl(l);new bn(l,s,t.Padding,t.PolylinePadding,t.coneAngle,t.bundlingSettings,o).run()}(l,s,o):t.EdgeRoutingMode===re.StraightLine?qu(l,s,o):t.EdgeRoutingMode!==re.None&&new bn(l,s).run(),cl(l,s)}function ll(l,s,o,t,e,r,i){if(void 0===r&&(r=1),void 0===i&&(i=function(){return 1}),!l.graph.isEmpty()){null==l.parent&&(to(r),function(l){for(var o,s=C(l.deepEdges);!(o=s()).done;){var t=o.value;t.label&&(t.label.isPositioned=!1)}}(l));var h=function(){var E=new Set,S=l.graph;if(null==S.parent)return E;for(var O,T=C(S.shallowNodes);!(O=T()).done;){for(var M,x=O.value,B=C(x.outEdges);!(M=B()).done;){var F=M.value,A=S.liftNode(F.target);(null==A||A===x)&&E.add(F)}for(var V,z=C(x.inEdges);!(V=z()).done;){var Y=V.value,W=S.liftNode(Y.source);(null==W||W===x)&&E.add(Y)}}for(var D,_=C(E);!(D=_()).done;)D.value.remove();return E}();!function(E){for(var T,S=C(E.shallowNodes);!(T=S()).done;){var O=T.value;O instanceof Ae&&ll(O,s,o,t,e)}}(l);var c=function(l){for(var t,s=new Array,o=C(l.nodesBreadthFirst);!(t=o()).done;){var e=t.value,r=l.liftNode(e);if(null!=r)for(var h,i=C(e.outEdges.values());!(h=i()).done;){var c=h.value,f=c.target,p=l.liftNode(f);if(null!=p&&(r!==e||p!==f)&&r!==p){c.remove();var y=new ks(r,p),m=new sr(y);s.push([m,c])}}}return s}(l.graph),f=function(l){for(var s,h,o=l.graph,e=[],r=0,i=C(Rs(o));!(h=i()).done;){var c=h.value,f=new De(o.id+r++);f.parent=o;var p=new Ae(f);p.layoutSettings=null!==(s=l.layoutSettings)&&void 0!==s?s:al(l);for(var m,y=C(c);!(m=y()).done;){var P=m.value;P.parent=f,f.addNode(P)}e.push(p)}return e}(l);if(function(){if(1===f.length)o(l,s,i);else{for(var S,E=C(f);!(S=E()).done;){var T=S.value;o(T,s,i),T.boundingBox=T.pumpTheBoxToTheGraphWithMargins()}e(l,f)}}(),c.forEach(function(E){E[0].edge.remove(),E[1].add()}),f.forEach(function(E){for(var T,S=C(E.graph.shallowNodes);!(T=S()).done;)T.value.parent=l.graph}),h.forEach(function(E){return E.add()}),null==l.graph.parent){var p=function(E){for(var O,S=[],T=C(E.nodesBreadthFirst);!(O=T()).done;){for(var M,x=O.value,B=C(x.outEdges());!(M=B()).done;){var F=M.value;null==F.curve&&S.push(F)}for(var z,A=C(x.selfEdges());!(z=A()).done;){var V=z.value;null==V.curve&&S.push(V)}}return S}(l);t(l,p,s),cl(l,p),l.pumpTheBoxToTheGraphWithMargins()}}}function hl(l,s,o,t,e,r){void 0===t&&(t=1),void 0===e&&(e=3),void 0===r&&(r=3);var i=ba.constructorGNAN(l,s,t,e);i.edgeSeparatian=r,i.run()}function cl(l,s){0!==s.length&&Yn.constructorGA(l,s).run()}var Ua,Bf=function(){function l(){}l.constructorStatic=function(t,e){var r=new l;r.edges=t,r.nodeBoundaries=e,r.boundingBox=lt.mkEmpty();for(var h,i=C(r.nodeBoundaries);!(h=i()).done;)r.boundingBox=r.boundingBox.addRec(h.value.boundingBox);return r};var s=l.prototype;return s.AddGraph=function(t){this.edges=this.edges.concat(t.edges),this.nodeBoundaries=On(this.nodeBoundaries,t.nodeBoundaries),this.boundingBox.addRec(t.boundingBox)},s.AddNodeBoundary=function(t){this.nodeBoundaries.add(t),this.boundingBox.addRec(t.boundingBox)},l}();!function(l){l[l.Success=0]="Success",l[l.Overlaps=1]="Overlaps",l[l.EdgeSeparationIsTooLarge=2]="EdgeSeparationIsTooLarge"}(Ua||(Ua={}));var wo=function(){function l(o,t,e){this.currentTriangle=o,this.start=t,this.end=e}var s=l.prototype;return s.FindFirstPiercedEdge=function(){var t=this.GetHyperplaneSign(this.currentTriangle.Sites.item0),e=this.GetHyperplaneSign(this.currentTriangle.Sites.item1);if(t!==e&&R.getTriangleOrientation(this.end,this.currentTriangle.Sites.item0.point,this.currentTriangle.Sites.item1.point)==it.Clockwise)return this.positiveSign=t,this.negativeSign=e,this.currentTriangle.Edges.item0;var r=this.GetHyperplaneSign(this.currentTriangle.Sites.item2);return e!==r&&R.getTriangleOrientation(this.end,this.currentTriangle.Sites.item1.point,this.currentTriangle.Sites.item2.point)==it.Clockwise?(this.positiveSign=e,this.negativeSign=r,this.currentTriangle.Edges.item1):(this.positiveSign=r,this.negativeSign=t,this.currentTriangle.Edges.item2)},s.FindNextPierced=function(){if(this.currentTriangle=this.currentPiercedEdge.GetOtherTriangle_T(this.currentTriangle),null!=this.currentTriangle){var e,t=this.currentTriangle.Edges.index(this.currentPiercedEdge),r=this.currentTriangle.Sites.getItem(t+2),i=this.GetHyperplaneSign(r);0===this.negativeSign?-1===i||0===i?(this.negativeSign=i,e=t+1):e=t+2:0===this.positiveSign?1===i||0===i?(this.positiveSign=i,e=t+2):e=t+1:i!==this.positiveSign?(this.negativeSign=i,e=t+1):(this.positiveSign=i,e=t+2),this.currentPiercedEdge=R.signedDoubledTriangleArea(this.end,this.currentTriangle.Sites.getItem(e).point,this.currentTriangle.Sites.getItem(e+1).point)<-q.distanceEpsilon?this.currentTriangle.Edges.getItem(e):null}else this.currentPiercedEdge=null},s.GetHyperplaneSign=function(t){var e=R.signedDoubledTriangleArea(this.start,t.point,this.end);return e>q.distanceEpsilon?1:e<-q.distanceEpsilon?-1:0},s.MoveNext=function(){return null==this.currentPiercedEdge?this.currentPiercedEdge=this.FindFirstPiercedEdge():this.FindNextPierced(),null!=this.currentPiercedEdge},Q(l,[{key:"CurrentPiercedEdge",get:function(){return this.currentPiercedEdge}},{key:"CurrentTriangle",get:function(){return this.currentTriangle}}]),l}(),Mf=function(){function l(o,t){this.ComputeForcesForBundles=!1,this.metroGraphData=o,this.bundlingSettings=t}var s=l.prototype;return s.EdgeIsLegal_=function(t,e,r,i){if(Ne.PointIsInsideOfTriangle(e,r))return!0;for(var h=new wo(r,t,e);h.MoveNext();){var c=h.CurrentPiercedEdge;if(c.constrained&&!i.has(c.lowerSite.Owner))return!1}return!0},s.BundleAvoidsObstacles=function(t,e,r,i,h,c){c.closestDist=new Array;var f=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(t,e),p=this.FindCloseObstaclesForBundle(e.cdtTriangle,i,r,f,h);if(null==p)return!1;for(var m,y=C(p);!(m=y()).done;)c.closestDist.push(m.value[1]);return!0},s.FindCloseObstaclesForBundle=function(t,e,r,i,h){var c=new Map,f=[];if(!this.ThreadLineSegmentThroughTriangles(t,e,r,i,f))return null;if(!this.ComputeForcesForBundles&&!this.bundlingSettings.HighestQuality)return c;for(var p=new mo,y=0,m=f;y<m.length;y++)for(var E,L=C(m[y].Sites);!(E=L()).done;){var S=E.value;if(!p.has(S)){p.add(S);var T=S.Owner;if(!i.has(T)){var O=l.FindPolylinePoint(T,S.point),x=Z.minDistBetweenLineSegments(O.point,O.nextOnPolyline.point,e,r),B=x.dist,M=x.parab,F=x.parcd,A=Z.minDistBetweenLineSegments(O.point,O.prevOnPolyline.point,e,r),z=A.dist,V=A.parab,Y=A.parcd,W=void 0,_=void 0;if(B<z){if(B>h)continue;W=O.point.add(O.nextOnPolyline.point.sub(O.point).mul(M)),_=e.add(r.sub(e).mul(F))}else{if(z>h)continue;W=O.point.add(O.prevOnPolyline.point.sub(O.point).mul(V)),_=e.add(r.sub(e).mul(Y))}c.get(T)||c.set(T,[W,_])}}}return c},s.ThreadLineSegmentThroughTriangles=function(t,e,r,i,h){if(Ne.PointIsInsideOfTriangle(r,t))return h.push(t),!0;var c=new wo(t,e,r);for(h.push(t);c.MoveNext();){h.push(c.CurrentTriangle);var f=c.CurrentPiercedEdge;if(f.constrained&&!i.has(f.lowerSite.Owner))return!1}return null!=c.CurrentTriangle&&h.push(c.CurrentTriangle),!0},l.PointLocationInsideTriangle=function(t,e){for(var r=!1,i=0;i<3;i++){var h=R.signedDoubledTriangleArea(t,e.Sites.getItem(i).point,e.Sites.getItem(i+1).point);if(h<-1*q.distanceEpsilon)return ht.Outside;h<q.distanceEpsilon&&(r=!0)}return r?ht.Boundary:ht.Inside},l.FindPolylinePoint=function(t,e){for(var i,r=C(t.polylinePoints());!(i=r()).done;){var h=i.value;if(h.point.equal(e))return h}throw new Error("polyline point "+e+" not found")},s.EdgeIsLegal=function(t,e,r,i){var c=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(t,e);return this.ThreadLineSegmentThroughTriangles(t.cdtTriangle,r,i,c,[])},s.EdgeIsLegalSSPPS=function(t,e,r){var i=t.Position,h=t.cdtTriangle,c=e.Position;if(Ne.PointIsInsideOfTriangle(c,h))return!0;for(var f=new wo(h,i,c);f.MoveNext();){var p=f.CurrentPiercedEdge;if(p.constrained&&!r.has(p.lowerSite.Owner))return!1}return!0},l}(),Po=function(){function l(o,t,e,r){this.metroGraphData=o,this.obstaclesToIgnoreLambda=r,this.bundlingSettings=t,this.obstacleTree=e}var s=l.prototype;return s.ObstaclesToIgnoreForBundle=function(t,e){return null!=t&&null!=e?On(this.obstaclesToIgnoreLambda(t),this.obstaclesToIgnoreLambda(e)):null==t&&null==e?new Set:this.obstaclesToIgnoreLambda(null!=t?t:e)},s.HubAvoidsObstaclesSPNBA=function(t,e,r,i){var h={minimalDistance:r};return l.IntersectCircleWithTree(this.obstacleTree,e,r,this.obstaclesToIgnoreLambda(t),i.touchedObstacles,h)},s.HubAvoidsObstaclesPNS__=function(t,e,r){var i={touchedObstacles:Array()};return this.HubAvoidsObstaclesPNSTT(t,e,r,i,{minimalDistance:0})},s.GetMinimalDistanceToObstacles=function(t,e,r){var i=new Array,h={minimalDistance:r};return l.IntersectCircleWithTree(this.obstacleTree,e,r,this.obstaclesToIgnoreLambda(t),i,h)?h.minimalDistance:0},s.HubAvoidsObstaclesPNSTT=function(t,e,r,i,h){return i.touchedObstacles=new Array,h.minimalDistance=e,l.IntersectCircleWithTree(this.obstacleTree,t,e,r,i.touchedObstacles,h)},l.IntersectCircleWithTree=function(t,e,r,i,h,c){if(!t.irect.contains_point_radius(e,r))return!0;if(null==t.UserData){var f=l.IntersectCircleWithTree(t.Left,e,r,i,h,c);if(!f||!(f=l.IntersectCircleWithTree(t.Right,e,r,i,h,c)))return!1}else{var p=t.UserData;if(i.has(p))return!0;if(K.PointRelativeToCurveLocation(e,p)!==ht.Outside)return l.containingPoly=p,!1;var m=p.value(p.closestParameter(e)),P=m.sub(e).length;P<=r&&h.push([p,m]),c.minimalDistance=Math.min(P,c.minimalDistance)}return!0},l.Create4gon=function(t,e,r,i){var h=e.sub(t).normalize();return h=new R(h.y,-1*h.x),vt.mkFromPoints([t.add(h.mul(r/2)),t.sub(h.mul(r/2)),e.sub(h.mul(i/2)),e.add(h.mul(i/2))])},l}(),Vf=function(){function l(o,t,e,r){this.Width=t,this.Polyline=o,this.sourceAndTargetLoosePolylines=e,this.Index=r}return l.prototype.UpdateLengths=function(){for(var t=0,e=this.Polyline.startPoint;null!=e.next;e=e.next)t+=e.next.point.sub(e.point).length;this.Length=t,this.IdealLength=this.Polyline.end.sub(this.Polyline.start).length},l}(),Df=function(){function l(s,o,t){this.metroline=s,this.station=o,this.polyPoint=t}return Q(l,[{key:"Metroline",get:function(){return this.metroline}},{key:"PolyPoint",get:function(){return this.polyPoint}}]),l}(),jf=function(){function l(o,t,e){this.Radius=0,this.BundleBases=new Map,this.MetroNodeInfos=new Array,this._cachedIdealRadius=0,this.SerialNumber=o,this.IsReal=t,this.Position=e}var s=l.prototype;return s.debStop=function(){return 28===this.SerialNumber&&this.Position.sub(new R(841.2662778763244,303.3817005853006)).length<.001},s.getELP=function(){return this.EnterableLoosePolylines},s.setELP=function(t){this.EnterableLoosePolylines=t},s.addEL=function(t){this.EnterableLoosePolylines.add(t)},s.AddEnterableLoosePolyline=function(t){null==this.EnterableLoosePolylines&&(this.EnterableLoosePolylines=new Set),this.EnterableLoosePolylines.add(t)},s.AddEnterableTightPolyline=function(t){null==this.EnterableTightPolylines&&(this.EnterableTightPolylines=new Set),this.EnterableTightPolylines.add(t)},Q(l,[{key:"Position",get:function(){return this._Position},set:function(t){this._Position=t}},{key:"cachedIdealRadius",get:function(){return this._cachedIdealRadius},set:function(t){this._cachedIdealRadius=t}}]),l}(),Wf=function(){function l(){this.Width=0,this.Metrolines=new Array,this.cachedBundleCost=0}return Q(l,[{key:"Count",get:function(){return this.Metrolines.length}}]),l}(),_r=function(){function l(o,t){this.metroGraphData=o,this.bundlingSettings=t}var s=l.prototype;return s.CreateNodeRadii=function(){for(var e,t=C(this.metroGraphData.VirtualStations());!(e=t()).done;){var r=e.value;r.Radius=0,r.cachedIdealRadius=l.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,r)}this.GrowHubs(!1),this.GrowHubs(!0);for(var h,i=C(this.metroGraphData.VirtualStations());!(h=i()).done;){var c=h.value;c.Radius=Math.max(c.Radius,this.bundlingSettings.MinHubRadius)}},s.GrowHubs=function(t){for(var i,e=new Gr(It),r=C(this.metroGraphData.VirtualStations());!(i=r()).done;){var h=i.value;e.Enqueue(h,-this.CalculatePotential(h,t))}for(var c=!1;!e.IsEmpty();){var f={priority:0},p=e.DequeueAndGetPriority(f);if(f.priority>=0)break;this.TryGrowHub(p,t)&&(e.Enqueue(p,-this.CalculatePotential(p,t)),c=!0)}return c},s.TryGrowHub=function(t,e){var r=this.CalculateAllowedHubRadius(t);if(t.Radius>=r)return!1;var i=e?l.CalculateIdealHubRadiusWithAdjacentEdges(this.bundlingSettings,t):t.cachedIdealRadius;if(t.Radius>=i)return!1;var c=.05*(i-t.Radius);c<1&&(c=1);var f=Math.min(t.Radius+c,r);return!(f<=t.Radius||(t.Radius=f,0))},s.CalculatePotential=function(t,e){var r=e?l.CalculateIdealHubRadiusWithAdjacentEdges(this.bundlingSettings,t):t.cachedIdealRadius;return r<=t.Radius?0:(r-t.Radius)/r},s.CalculateAllowedHubRadius=function(t){for(var i,e=this.bundlingSettings.MaxHubRadius,r=C(t.Neighbors);!(i=r()).done;){var h=i.value,c=h.Position.sub(t.Position).length;e=Math.min(e,c/1.05-h.Radius)}var f=this.metroGraphData.tightIntersections.GetMinimalDistanceToObstacles(t,t.Position,e);return f<e&&(e=f-.001),Math.max(e,.1)},l.CalculateIdealHubRadius=function(t,e,r){for(var c,i=1,h=C(r.Neighbors);!(c=h()).done;){var p=t.GetWidthSSN(c.value,r,e.EdgeSeparation);i=Math.max(i,p/2+e.EdgeSeparation)}return Math.min(i,2*e.MaxHubRadius)},l.CalculateIdealHubRadiusWithNeighborsMBS=function(t,e,r){return l.CalculateIdealHubRadiusWithNeighborsMBNP(t,e,r,r.Position)},l.CalculateIdealHubRadiusWithNeighborsMBNP=function(t,e,r,i){var h=l.CalculateIdealHubRadius(t,e,r);if(r.Neighbors.length>1)for(var c=r.Neighbors,f=0;f<c.length;f++)h=Math.max(h,l.GetMinRadiusForTwoAdjacentBundles(h,r,i,c[f],c[(f+1)%c.length],t,e));return Math.min(h,2*e.MaxHubRadius)},l.CalculateIdealHubRadiusWithAdjacentEdges=function(t,e){for(var h,r=t.MaxHubRadius,i=C(e.Neighbors);!(h=i()).done;)r=Math.min(r,e.Position.sub(h.value.Position).length/2);return r},l.GetMinRadiusForTwoAdjacentBundles=function(t,e,r,i,h,c,f){var p=c.GetWidthSSN(e,i,f.EdgeSeparation),y=c.GetWidthSSN(e,h,f.EdgeSeparation);return l.GetMinRadiusForTwoAdjacentBundlesNPPPNNB(t,r,i.Position,h.Position,p,y,f)},l.GetMinRadiusForTwoAdjacentBundlesNPPPNNB=function(t,e,r,i,h,c,f){if(h<q.distanceEpsilon||c<q.distanceEpsilon)return t;var p=R.anglePCP(r,e,i);if((p=Math.min(p,2*Math.PI-p))<q.distanceEpsilon)return 2*f.MaxHubRadius;if(p>=Math.PI/2)return 1.05*t;var y=Math.sin(p),m=Math.cos(p),P=h/(4*y),L=c/(4*y),E=2*Math.sqrt(P*P+(L*L+P*(L*m)*2));return E=Math.min(E,2*f.MaxHubRadius),Math.max(E,t)},l}(),fl=function(){function l(o,t,e,r){this.metroGraphData=o,this.bundlingSettings=t,this.costCalculator=e,this.cdt=r}var s=l.prototype;return s.InitializeCostCache=function(){for(var e,t=C(this.metroGraphData.VirtualStations());!(e=t()).done;){var r=e.value;r.cachedIdealRadius=_r.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,r),r.cachedRadiusCost=this.costCalculator.RadiusCost(r,r.Position),r.cachedBundleCost=0}for(var h,i=C(this.metroGraphData.VirtualEdges());!(h=i()).done;){var c=h.value,f=c[0],p=c[1],y=this.metroGraphData.GetIjInfo(f,p);y.cachedBundleCost=this.costCalculator.BundleCost(f,p,f.Position),f.cachedBundleCost+=y.cachedBundleCost,p.cachedBundleCost+=y.cachedBundleCost}},s.UpdateCostCache=function(t){var e=this.cdt.getRectangleNodeOnTriangles();t.cdtTriangle=e.FirstHitNodeWithPredicate(t.Position,l.testPointInside).UserData,t.cachedIdealRadius=_r.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,t),t.cachedRadiusCost=this.costCalculator.RadiusCost(t,t.Position),t.cachedBundleCost=0;for(var i,r=C(t.Neighbors);!(i=r()).done;){var h=i.value;h.IsReal||(h.cachedIdealRadius=_r.CalculateIdealHubRadiusWithNeighborsMBS(this.metroGraphData,this.bundlingSettings,h),h.cachedRadiusCost=this.costCalculator.RadiusCost(h,h.Position));var c=this.metroGraphData.GetIjInfo(t,h);h.cachedBundleCost-=c.cachedBundleCost,c.cachedBundleCost=this.costCalculator.BundleCost(t,h,t.Position),t.cachedBundleCost+=c.cachedBundleCost,h.cachedBundleCost+=c.cachedBundleCost}},l.testPointInside=function(t,e){return Ne.PointIsInsideOfTriangle(t,e)?Ft.Stop:Ft.Continue},l}();function Ri(){Ri=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var dl=function(l){function s(){this.mainMap=new Map}var o=s.prototype;return o.everyMapIsEmpty=function(){for(var r,e=C(this.mainMap.values());!(r=e()).done;)if(r.value.size)return!1;return!0},o.get=function(e,r){var i=this.mainMap.get(e);if(i)return i.get(r)},o.has=function(e,r){var i=this.mainMap.get(e);return!!i&&i.has(r)},o.set=function(e,r,i){var h=this.mainMap.get(e);h||this.mainMap.set(e,h=new Map),h.set(r,i)},o[l]=Ri().mark(function t(){var e,r,i,h,f,p,y,m,P;return Ri().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:e=C(this.mainMap);case 1:if((r=e()).done){E.next=12;break}h=(i=r.value)[0],f=C(i[1]);case 4:if((p=f()).done){E.next=10;break}return m=(y=p.value)[0],P=y[1],E.next=8,[h,m,P];case 8:E.next=4;break;case 10:E.next=1;break;case 12:case"end":return E.stop()}},t,this)}),o.keys=Ri().mark(function t(){var e,r,i,h,f,p,m;return Ri().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:e=C(this.mainMap);case 1:if((r=e()).done){L.next=12;break}h=(i=r.value)[0],f=C(i[1]);case 4:if((p=f()).done){L.next=10;break}return m=p.value[0],L.next=8,[h,m];case 8:L.next=4;break;case 10:L.next=1;break;case 12:case"end":return L.stop()}},t,this)}),Q(s,[{key:"isEmpty",get:function(){return 0===this.mainMap.size||this.everyMapIsEmpty()}}]),s}(Symbol.iterator);function Ya(){Ya=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Hf=function(){function l(o,t,e,r,i,h,c,f){this.cachedEnterableLooseForEnd=new Ee,this.bundlingSettings=r,this.regularEdges=o,this.cdt=null!=i?i:Wu(t),this.EdgeLooseEnterable=h,this.EdgeTightEnterable=c,this.LoosePolylineOfPort=f,this.looseIntersections=new Po(this,r,t,function(p){return p.getELP()}),this.tightIntersections=new Po(this,r,e,function(p){return p.EnterableTightPolylines}),this.cdtIntersections=new Mf(this,r),this.Initialize(!1)}var s=l.prototype;return s.VirtualStations=function(){return Array.from(this.Stations).filter(function(t){return!t.IsReal})},s.VirtualEdges=Ya().mark(function o(){var t,e,r;return Ya().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:t=C(this.edgeInfoDictionary.keys());case 1:if((e=t()).done){h.next=7;break}return r=e.value,h.next=5,r;case 5:h.next=1;break;case 7:case"end":return h.stop()}},o,this)}),s.RealEdgeCount=function(t,e){var r=t.SerialNumber<e.SerialNumber?[t,e]:[e,t],i=this.edgeInfoDictionary.get(r[0],r[1]);return i?i.Count:0},s.MetroNodeInfosOfNode=function(t){return t.MetroNodeInfos},s.GetIjInfo=function(t,e){var r=t.SerialNumber<e.SerialNumber?[t,e]:[e,t];return this.edgeInfoDictionary.get(r[0],r[1])},s.MoveNode=function(t,e){var r=t.Position;this.PointToStations.deleteP(r),this.PointToStations.set(e,t),t.Position=e;for(var h,i=C(this.MetroNodeInfosOfNode(t));!(h=i()).done;)h.value.PolyPoint.point=e;for(var p,f=C(this.MetroNodeInfosOfNode(t));!(p=f()).done;){var y=p.value,P=y.PolyPoint.prev.point,L=y.PolyPoint.next.point;y.Metroline.Length+=L.sub(e).length+P.sub(e).length-L.sub(r).length-P.sub(r).length}for(var S,E=C(t.Neighbors);!(S=E()).done;){var T=S.value;this.ink+=e.sub(T.Position).length-r.sub(T.Position).length}this.SortNeighbors(t);for(var x,O=C(t.Neighbors);!(x=O()).done;)this.SortNeighbors(x.value)},s.GetWidthSSN=function(t,e,r){var i=t.SerialNumber<e.SerialNumber?[t,e]:[e,t],h=this.edgeInfoDictionary.get(i[0],i[1]);return h?h.Width+(h.Count-1)*r:0},s.GetWidthAN=function(t,e){for(var h,r=0,i=C(t);!(h=i()).done;)r+=h.value.Width;var f=t.length;return r+(f>0?(f-1)*e:0)},s.Initialize=function(t){this.SimplifyRegularEdges(),this.InitializeStationData(),this.InitializeEdgeData(),this.InitializeVirtualGraph(),this.InitializeEdgeNodeInfo(t),this.InitializeCdtInfo()},s.SimplifyRegularEdges=function(){for(var e,t=C(this.regularEdges);!(e=t()).done;)this.SimplifyRegularEdge(e.value)},s.SimplifyRegularEdge=function(t){for(var e=t.curve,r=new jt.K,i=new qt,h=e.endPoint;null!=h;h=h.prev){var c=h.point;if(i.has(h.point)){for(var f=h.next;;){var p=r.top;if(p.equal(c))break;i.delete(p),r.pop(),f=f.next}f.prev=h.prev,f.prev.next=f}else r.push(c),i.add(c)}},s.InitializeStationData=function(){this.Stations=[],this.PointToStations=new Ee;for(var e,t=C(this.regularEdges);!(e=t()).done;)this.ProcessPolylinePoints(e.value.curve)},s.ProcessPolylinePoints=function(t){var e=t.startPoint;for(this.RegisterStation(e,!0),e=e.next;e!==t.endPoint;e=e.next)this.RegisterStation(e,!1);this.RegisterStation(e,!0)},s.RegisterStation=function(t,e){if(!this.PointToStations.has(t.point)){var r=new jf(this.Stations.length,e,t.point);this.PointToStations.set(t.point,r),this.Stations.push(r)}},s.InitializeEdgeData=function(){this.metrolines=new Array;for(var t=0;t<this.regularEdges.length;t++)this.InitEdgeData(this.regularEdges[t],t)},s.InitEdgeData=function(t,e){var r=new Vf(t.curve,this.bundlingSettings.ActualEdgeWidth(t),this.EdgeSourceAndTargetFunc(t),e);this.metrolines.push(r),this.PointToStations.get(r.Polyline.start).BoundaryCurve=t.sourcePort.Curve,this.PointToStations.get(r.Polyline.end).BoundaryCurve=t.targetPort.Curve},s.EdgeSourceAndTargetFunc=function(t){var e=this;return function(){return[e.LoosePolylineOfPort(t.sourcePort),e.LoosePolylineOfPort(t.targetPort)]}},s.InitializeVirtualGraph=function(){for(var r,t=new Map,e=C(this.metrolines);!(r=e()).done;)for(var i=r.value,h=this.PointToStations.get(i.Polyline.start),c=void 0,f=i.Polyline.startPoint;null!=f.next;f=f.next,h=c)Yi(t,h,c=this.PointToStations.get(f.next.point)),Yi(t,c,h);for(var y,p=C(this.Stations);!(y=p()).done;){var m=y.value;m.Neighbors=Array.from(t.get(m))}},s.GetUnorderedIjInfo=function(t,e){return t.SerialNumber<e.SerialNumber?this.GetCreateOrderedIjInfo(t,e):this.GetCreateOrderedIjInfo(e,t)},l.closedeb=function(t,e){return t.Position.sub(new R(360.561,428.416)).length<.1&&e.Position.sub(new R(414.281,440.732)).length<.1},s.GetCreateOrderedIjInfo=function(t,e){var r=this.edgeInfoDictionary.get(t,e);return r||(r=new Wf,this.edgeInfoDictionary.set(t,e,r),r)},s.InitializeEdgeNodeInfo=function(t){this.edgeInfoDictionary=new dl,this.InitAllMetroNodeInfos(t),this.SortAllNeighbors(),this.InitEdgeIjInfos(),this.ink=0;for(var r,e=C(this.VirtualEdges());!(r=e()).done;){var i=r.value;this.ink+=i[0].Position.sub(i[1].Position).length}},s.InitAllMetroNodeInfos=function(t){for(var e=0;e<this.metrolines.length;e++){var r=this.metrolines[e];this.InitMetroNodeInfos(r),this.InitNodeEnterableLoosePolylines(r,this.regularEdges[e]),t&&this.InitNodeEnterableTightPolylines(r,this.regularEdges[e]),r.UpdateLengths()}},s.InitMetroNodeInfos=function(t){for(var e=t.Polyline.startPoint;null!=e;e=e.next){var r=this.PointToStations.get(e.point);r.MetroNodeInfos.push(new Df(t,r,e))}},s.InitNodeEnterableLoosePolylines=function(t,e){for(var r=null!=this.EdgeLooseEnterable?this.EdgeLooseEnterable.get(e):new Set,i=t.Polyline.startPoint.next;null!=i&&null!=i.next;i=i.next){var h=this.PointToStations.get(i.point);null!=h.getELP()?h.setELP(Or(h.getELP(),r)):h.setELP(new Set(r))}this.AddLooseEnterableForMetrolineStartEndPoints(t)},s.AddLooseEnterableForMetrolineStartEndPoints=function(t){this.AddLooseEnterableForEnd(t.Polyline.start),this.AddLooseEnterableForEnd(t.Polyline.end)},s.AddTightEnterableForMetrolineStartEndPoints=function(t){this.AddTightEnterableForEnd(t.Polyline.start),this.AddTightEnterableForEnd(t.Polyline.end)},s.AddLooseEnterableForEnd=function(t){var e=this.PointToStations.get(t);if(this.cachedEnterableLooseForEnd.has(t))e.setELP(this.cachedEnterableLooseForEnd.get(t));else{for(var i,r=C(this.LooseTree.AllHitItems_(t));!(i=r()).done;){var h=i.value;K.PointRelativeToCurveLocation(t,h)===ht.Inside&&e.AddEnterableLoosePolyline(h)}this.cachedEnterableLooseForEnd.set(t,e.getELP())}},s.AddTightEnterableForEnd=function(t){for(var i,e=this.PointToStations.get(t),r=C(this.TightTree.AllHitItems_(t));!(i=r()).done;){var h=i.value;K.PointRelativeToCurveLocation(t,h)===ht.Inside&&e.AddEnterableTightPolyline(h)}},s.InitNodeEnterableTightPolylines=function(t,e){for(var r=null!=this.EdgeTightEnterable?this.EdgeTightEnterable.get(e):new Set,i=t.Polyline.startPoint.next;null!=i&&null!=i.next;i=i.next){var h=this.PointToStations.get(i.point),c=h.EnterableTightPolylines;h.EnterableTightPolylines=null!=c?Or(c,r):new Set(r)}this.AddTightEnterableForMetrolineStartEndPoints(t)},s.SortAllNeighbors=function(){for(var e,t=C(this.Stations);!(e=t()).done;)this.SortNeighbors(e.value)},s.SortNeighbors=function(t){if(!(t.Neighbors.length<=2)){var e=t.Neighbors[0].Position,r=t.Position;t.Neighbors.sort(function(i,h){return Pn(e.sub(r),i.Position.sub(r),h.Position.sub(r))})}},s.InitEdgeIjInfos=function(){for(var e,t=C(this.metrolines);!(e=t()).done;)for(var r=e.value,h=this.PointToStations.get(r.Polyline.start),c=void 0,f=r.Polyline.startPoint;null!=f.next;f=f.next,h=c){c=this.PointToStations.get(f.next.point);var p=this.GetUnorderedIjInfo(h,c);p.Width+=r.Width,p.Metrolines.push(r)}},s.InitializeCdtInfo=function(){for(var r,t=this.cdt.getRectangleNodeOnTriangles(),e=C(this.Stations);!(r=e()).done;){var i=r.value;i.cdtTriangle=t.FirstHitNodeWithPredicate(i.Position,fl.testPointInside).UserData}},s.PointIsAcceptableForEdge=function(t,e){if(null==this.LoosePolylineOfPort)return!0;var r=t.sourceAndTargetLoosePolylines();return K.PointRelativeToCurveLocation(e,r[0])===ht.Outside&&K.PointRelativeToCurveLocation(e,r[1])===ht.Outside},Q(l,[{key:"Ink",get:function(){return this.ink}},{key:"Edges",get:function(){return this.regularEdges}},{key:"Metrolines",get:function(){return this.metrolines}},{key:"LooseTree",get:function(){return this.looseIntersections.obstacleTree}},{key:"TightTree",get:function(){return this.tightIntersections.obstacleTree}}]),l}();function Pn(l,s,o){var t=R.crossProduct(l,o),e=l.dot(o),r=R.crossProduct(l,s),i=l.dot(s);return dt(r,0)&&So(i,0)?dt(t,0)&&So(e,0)?0:1:dt(t,0)&&So(e,0)?-1:dt(r,0)||dt(t,0)||r*t>0?ei(R.crossProduct(o,s),0):-ei(Math.sign(r),0)}function So(l,s){return ei(l,s)>=0}var Se=function(){function l(o,t){this.metroGraphData=o,this.bundlingSettings=t}l.InkError=function(t,e,r){return(t-e)*r.InkImportance},l.PathLengthsError=function(t,e,r,i){return i.PathLengthImportance/r*(t-e)},l.RError=function(t,e,r){return t<=e?0:r.HubRepulsionImportance*((1-e/t)*(t-e))},l.BundleError=function(t,e,r){return t<=e?0:r.BundleRepulsionImportance*((1-e/t)*(t-e))},l.Cost=function(t,e){for(var h,r=e.InkImportance*t.Ink,i=C(t.Metrolines);!(h=i()).done;){var c=h.value;r+=e.PathLengthImportance*c.Length/c.IdealLength}return r+this.CostOfForces(t)},l.CostOfForces=function(t){for(var i,e=0,r=C(t.VirtualStations());!(i=r()).done;)e+=i.value.cachedRadiusCost;for(var f,c=C(t.VirtualEdges());!(f=c()).done;){var p=f.value;e+=t.GetIjInfo(p[0],p[1]).cachedBundleCost}return e};var s=l.prototype;return s.InkGain=function(t,e){for(var c,r=this.metroGraphData.Ink,i=this.metroGraphData.Ink,h=C(t.Neighbors);!(c=h()).done;){var p=c.value.Position;i-=p.sub(t.Position).length,i+=p.sub(e).length}return l.InkError(r,i,this.bundlingSettings)},s.PathLengthsGain=function(t,e){for(var h,r=0,i=C(this.metroGraphData.MetroNodeInfosOfNode(t));!(h=i()).done;){var c=h.value,f=c.Metroline.Length,p=c.PolyPoint.prev.point,y=c.PolyPoint.next.point,m=c.Metroline.Length+y.sub(e).length+p.sub(e).length-y.sub(t.Position).length-p.sub(t.Position).length;r+=l.PathLengthsError(f,m,c.Metroline.IdealLength,this.bundlingSettings)}return r},s.RadiusGain=function(t,e){var r=0;return(r+=t.cachedRadiusCost)-this.RadiusCost(t,e)},s.RadiusCost=function(t,e){var r;r=R.closeDistEps(t.Position,e)?t.cachedIdealRadius:_r.CalculateIdealHubRadiusWithNeighborsMBNP(this.metroGraphData,this.bundlingSettings,t,e);var i={touchedObstacles:[]};if(!this.metroGraphData.looseIntersections.HubAvoidsObstaclesSPNBA(t,e,r,i))return l.Inf;for(var f,h=0,c=C(i.touchedObstacles);!(f=c()).done;){var y=f.value[1].sub(e).length;h+=l.RError(r,y,this.bundlingSettings)}return h},s.BundleGain=function(t,e){for(var h,r=t.cachedBundleCost,i=C(t.Neighbors);!(h=i()).done;){var f=this.BundleCost(t,h.value,e);if(So(f,l.Inf))return-l.Inf;r-=f}return r},s.BundleCost=function(t,e,r){var i=this.metroGraphData.GetWidthSSN(t,e,this.bundlingSettings.EdgeSeparation),h={closestDist:[]};if(!this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(t,e,r,e.Position,i,h))return l.Inf;for(var p,c=0,f=C(h.closestDist);!(p=f()).done;){var y=p.value,m=y[0].sub(y[1]).length;c+=l.BundleError(i/2,m,this.bundlingSettings)}return c},l}();Se.Inf=1e9;var _f=function(){function l(o){this.polylineToEdgeGeom=new Map,this.pathsThroughPoints=new Ee,this.interestingPoints=new qt,this.metroGraphData=o}var s=l.prototype;return s.Run=function(){this.Init(),this.SwitchFlips()},s.Init=function(){for(var e,t=C(this.metroGraphData.Edges);!(e=t()).done;){var r=e.value;this.polylineToEdgeGeom.set(r.curve,r)}for(var h,i=C(this.Polylines);!(h=i()).done;)this.RegisterPolylinePointInPathsThrough(h.value.polylinePoints())},s.RegisterPolylinePointInPathsThrough=function(t){for(var r,e=C(t);!(r=e()).done;)this.RegisterPolylinePointInPathsThroughP(r.value)},s.RegisterPolylinePointInPathsThroughP=function(t){!function(l,s,o){var t=l.get(s);t||l.set(s,t=new Set),t.add(o)}(this.pathsThroughPoints,t.point,t)},s.UnregisterPolylinePointsInPathsThrough=function(t){for(var r,e=C(t);!(r=e()).done;)this.UnregisterPolylinePointInPathsThrough(r.value)},s.UnregisterPolylinePointInPathsThrough=function(t){!function(l,s,o){var t=l.get(s);t&&(t.delete(o),0===t.size&&l.deleteP(s))}(this.pathsThroughPoints,t.point,t)},s.SwitchFlips=function(){for(var i,t=new Set(this.Polylines),e=new ye.c,r=C(this.Polylines);!(i=r()).done;)e.enqueue(i.value);for(;e.length>0;){var c=e.dequeue();t.delete(c);var f=this.ProcessPolyline(c);null!=f&&(t.has(c)||(t.add(c),e.enqueue(c)),t.has(f)||(t.add(f),e.enqueue(f)))}},s.ProcessPolyline=function(t){for(var e=new Map,r=t.startPoint.next;null!=r;r=r.next){this.FillDepartedPolylinePoints(r,e);for(var h,i=C(this.pathsThroughPoints.get(r.point));!(h=i()).done;){var c=h.value,f=e.get(c.polyline);if(f){if(this.ProcessFlip(r,f))return c.polyline;e.delete(c.polyline)}}}return null},s.FillDepartedPolylinePoints=function(t,e){for(var h,i=C(this.pathsThroughPoints.get(t.prev.point));!(h=i()).done;){var c=h.value;this.IsNeighborOnTheSamePolyline(c,t)||e.has(c.polyline)||e.set(c.polyline,c)}},s.ProcessFlip=function(t,e){var r=t.polyline,i=e.polyline,h=t.point,c=e.point,f=this.polylineToEdgeGeom.get(r),p=this.polylineToEdgeGeom.get(i);if(f.lineWidth!==p.lineWidth||null==this.metroGraphData.EdgeLooseEnterable||!Ui(this.metroGraphData.EdgeLooseEnterable.get(f),this.metroGraphData.EdgeLooseEnterable.get(p)))return!1;var y=this.FindPointsOnPolyline(r,h,c),m=y[0],P=y[1],L=y[2],E=(y=this.FindPointsOnPolyline(i,h,c))[0],S=y[1],T=y[2],O=this.FindRelationOnFirstPoint(m,E,L,T),x=this.FindRelationOnLastPoint(P,S,L,T);return(2===O||2===x)&&1!==O&&1!==x&&(this.UnregisterPolylinePointsInPathsThrough(r.polylinePoints()),this.UnregisterPolylinePointsInPathsThrough(i.polylinePoints()),this.Swap(m,E,P,S,L,T),this.RegisterPolylinePointInPathsThrough(r.polylinePoints()),this.RegisterPolylinePointInPathsThrough(i.polylinePoints()),this.RegisterInterestingPoint(m.point),this.RegisterInterestingPoint(P.point),this.numberOfReducedCrossings++,!0)},s.FindPointsOnPolyline=function(t,e,r){for(var i,h,c=t.startPoint;null!=c;c=c.next)if(null==i)if(c.point.equal(e)){if(null!=h)return[c,h,!1];i=c}else null==h&&c.point.equal(r)&&(h=c);else if(c.point.equal(r))return[i,c,!0]},s.PolylinePointsAreInForwardOrder=function(t,e){for(var r=t;null!=r;r=r.next)if(r===e)return!0;return!1},s.Next=function(t,e){return e?t.next:t.prev},s.Prev=function(t,e){return e?t.prev:t.next},s.FindRelationOnFirstPoint=function(t,e,r,i){for(var h=t,c=e;;){var f=this.Prev(t,r),p=this.Prev(e,i);if(null==f||null==p)return 0;if(!f.point.equal(p.point))break;t=f,e=p}return this.PolylinesIntersect(h,c,t,e,r,i)},s.FindRelationOnLastPoint=function(t,e,r,i){for(var h=t,c=e;;){var f=this.Next(t,r),p=this.Next(e,i);if(null==f||null==p)return 0;if(!f.point.equal(p.point))break;t=f,e=p}for(;this.Next(t,r).point.equal(this.Prev(e,i).point);)t=this.Next(t,r),e=this.Prev(e,i);return this.PolylinesIntersect(t,e,h,c,r,i)},s.PolylinesIntersect=function(t,e,r,i,h,c){var f=this.Prev(t,h),p=this.Next(t,h),y=this.Next(r,h),m=this.Prev(r,h),P=this.Next(e,c),L=this.Prev(i,c);if(t.point.equal(r.point)){var E=t.point;return Pn(m.point.sub(E),L.point.sub(E),p.point.sub(E))===Pn(m.point.sub(E),P.point.sub(E),p.point.sub(E))?1:2}return Pn(f.point.sub(t.point),p.point.sub(t.point),P.point.sub(t.point))===Pn(y.point.sub(r.point),L.point.sub(r.point),m.point.sub(r.point))?1:2},s.Swap=function(t,e,r,i,h,c){var f=this.GetRangeOnPolyline(this.Next(t,h),r,h),p=this.GetRangeOnPolyline(this.Next(e,c),i,c);this.ChangePolylineSegment(t,r,h,p),this.ChangePolylineSegment(e,i,c,f),Xa.RemoveSelfCyclesFromPolyline(t.polyline),Xa.RemoveSelfCyclesFromPolyline(e.polyline)},s.ChangePolylineSegment=function(t,e,r,i){for(var f,h=t,c=C(i);!(f=c()).done;){var y=nr.mkFromPoint(f.value.point);y.polyline=h.polyline,r?(y.prev=h,h.next=y):(y.next=h,h.prev=y),h=y}r?(h.next=e,e.prev=h):(h.prev=e,e.next=h)},s.GetRangeOnPolyline=function(t,e,r){for(var i=new Array,h=t;h!==e;h=this.Next(h,r))i.push(h);return i},s.IsNeighborOnTheSamePolyline=function(t,e){return null!=t.prev&&t.prev.point.equal(e.point)||null!=t.next&&t.next.point.equal(e.point)},s.RegisterInterestingPoint=function(t){this.interestingPoints.has(t)||this.interestingPoints.add(t)},s.GetChangedHubs=function(){return this.interestingPoints},s.NumberOfReducedCrossings=function(){return this.numberOfReducedCrossings},s.PolylineIsOK=function(t){for(var e=new qt,r=t.startPoint;null!=r;r=r.next){if(r===t.startPoint){if(null!=r.prev)return!1}else if(r.prev.next!==r)return!1;if(r===t.endPoint){if(null!=r.next)return!1}else if(r.next.prev!==r)return!1;if(e.has(r.point))return!1;e.add(r.point)}return!(null!=t.startPoint.prev||null!=t.endPoint.next)},Q(l,[{key:"Polylines",get:function(){return Array.from(this.polylineToEdgeGeom.keys())}}]),l}();function Qa(){Qa=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Xa=function(){function l(o,t){this.foundCrossings=new qt,this.crossingsThatShouldBecomeHubs=new qt,this.metroGraphData=o,this.polylineAcceptsPoint=t}var s=l.prototype;return s.Vertices=Qa().mark(function o(){var t,e,i,h,c;return Qa().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=C(this.Polylines);case 1:if((e=t()).done){p.next=12;break}i=C(e.value.polylinePoints());case 4:if((h=i()).done){p.next=10;break}return c=h.value,p.next=8,c;case 8:p.next=4;break;case 10:p.next=1;break;case 12:case"end":return p.stop()}},o,this)}),s.Edges=function(){for(var r,t=new li,e=C(this.Vertices());!(r=e()).done;){var i=r.value;i.next&&t.set(new ue(i.point,i.next.point),0)}return Array.from(t.keys())},s.run=function(){var t=this;if(0===this.metroGraphData.Edges.length)return!1;for(var h,e=new li,r=new Qi(null),i=C(this.Vertices());!(h=i()).done;){var c=h.value,f=lt.mkOnPoints([c.point]);f.pad(q.intersectionEpsilon),r.Add(f,c.point)}var p=qi(this.Edges(),function(L){return lt.mkPP(L.first,L.second)});le(p,p,function(L,E){return t.IntersectTwoEdges.bind(L,E,e,r)}),this.SortInsertedPoints(e);var y=this.InsertPointsIntoPolylines(e),m=this.FixPaths(),P=this.RemoveUnimportantCrossings();return m||y||P},s.FixPaths=function(){var t=!1;return this.RemoveSelfCycles()&&(t=!0),this.ReduceEdgeCrossings()&&(t=!0),t},s.SortInsertedPoints=function(t){for(var r,e=C(t);!(r=e()).done;){var i=r.value;this.SortInsideSegment(i[0],i[1])}},s.SortInsideSegment=function(t,e){e.sort(function(r,i){return It(At(r,t.first),At(i,t.first))})},s.InsertPointsIntoPolylines=function(t){for(var i,e=!1,r=C(this.metroGraphData.Metrolines);!(i=r()).done;)return this.InsertPointsIntoPolyline(i.value,t)&&(e=!0),e},s.InsertPointsIntoPolyline=function(t,e){for(var r=!1,i=t.Polyline.startPoint;null!=i.next;i=i.next)this.InsertPointsOnPolypoint(i,e,t)&&(r=!0);return r},s.InsertPointsOnPolypoint=function(t,e,r){var i=new ue(t.point,t.next.point),h=t.point!==i.first,c=e.get(i);if(!c)return!1;var f=t.next,p=t.polyline;if(h){for(var y=c.length-1;y>=0;y--)if(null==this.polylineAcceptsPoint||this.polylineAcceptsPoint(r,c[y])){var m=nr.mkFromPoint(c[y]);m.prev=t,m.polyline=p,t.next=m,t=m}}else for(var P=0;P<c.length;P++)if(null==this.polylineAcceptsPoint||this.polylineAcceptsPoint(r,c[P])){var L=nr.mkFromPoint(c[P]);L.prev=t,L.polyline=p,t.next=L,t=L}return t.next=f,f.prev=t,!0},s.RemoveSelfCycles=function(){for(var r,t=!1,e=C(this.Polylines);!(r=e()).done;)l.RemoveSelfCyclesFromPolyline(r.value)&&(t=!0);return t},l.RemoveSelfCyclesFromPolyline=function(t){for(var e=!1,r=new Ee,i=t.startPoint;null!=i;i=i.next){var c=r.get(i.point);if(c){for(var f=c.next;f!==i.next;f=f.next)r.deleteP(f.point);c.next=i.next,i.next.prev=c,e=!0}else r.set(i.point,i)}return e},s.ReduceEdgeCrossings=function(){var t=new _f(this.metroGraphData);t.Run();for(var r,e=C(t.GetChangedHubs());!(r=e()).done;)this.crossingsThatShouldBecomeHubs.add(r.value);return t.NumberOfReducedCrossings()>0},s.RemoveUnimportantCrossings=function(){var t=!1;this.pointsToDelete=function(l,s){for(var e,o=new qt,t=C(l);!(e=t()).done;){var r=e.value;s.has(r)||o.add(r)}return o}(this.foundCrossings,this.crossingsThatShouldBecomeHubs);for(var r,e=C(this.Polylines);!(r=e()).done;)this.RemoveUnimportantCrossingsFromPolyline(r.value)&&(t=!0);return t},s.RemoveUnimportantCrossingsFromPolyline=function(t){for(var e=!1,r=t.startPoint.next;null!=r&&null!=r.next;r=r.next)if(this.pointsToDelete.has(r.point)&&R.getTriangleOrientation(r.prev.point,r.point,r.next.point)===it.Collinear){var i=r.prev,h=r.next;i.next=h,h.prev=i,r=i,e=!0}return e},s.IntersectTwoEdges=function(t,e,r,i){var h=Z.IntersectPPPP(t.first,t.second,e.first,e.second);if(h){var c=this.FindExistingVertexOrCreateNew(i,h);(this.AddVertexToSplittingList(t,r,c)||this.AddVertexToSplittingList(e,r,c))&&this.foundCrossings.add(c)}},s.FindExistingVertexOrCreateNew=function(t,e){var r=t.RootNode.FirstHitNode(e);if(null!=r)return r.UserData;var i=lt.mkOnPoints([e]);return i.pad(q.intersectionEpsilon),t.Add(i,e),e},s.AddVertexToSplittingList=function(t,e,r){if(!K.closeIntersectionPoints(r,t.first)&&!K.closeIntersectionPoints(r,t.second)){var i=e.get(t);if(i||(i=new Array,e.set(t,i)),!i.find(function(h){return h.equal(r)}))return i.push(r),!0}return!1},Q(l,[{key:"Polylines",get:function(){return this.metroGraphData.Edges.map(function(t){return t.curve})}}]),l}(),vl=function(){function l(o,t,e,r){this.BelongsToRealNode=r,this.Curve=t,this.Position=e,this.points=new Array(o),this.tangents=new Array(o),this.OrientedHubSegments=new Array(o)}var s=l.prototype;return s.isCorrectlyOrienected=function(){return R.getTriangleOrientation(this.Curve.boundingBox.center,this.Curve.value(this.parEnd),this.Curve.value(this.parStart))!==it.Counterclockwise},s.SpanBetweenTwoParameters=function(t,e){return t<=e?e-t:e-t+xr(this.Curve)},s.RotateLeftPoint=function(t,e){return 0===t?this.EndPoint:this.RotatePoint(t,this.parEnd,e)},s.RotateRigthPoint=function(t,e){return 0===t?this.StartPoint:this.RotatePoint(t,this.parStart,e)},s.RotatePoint=function(t,e,r){var i=xr(this.Curve)*r;return e=this.AdjustParam(e+=t*i),this.Curve.value(e)},s.AdjustParam=function(t){return t>this.Curve.parEnd?t=this.Curve.parStart+(t-this.Curve.parEnd):t<this.Curve.parStart&&(t=this.Curve.parEnd-(this.Curve.parStart-t)),t},s.RotateBy=function(t,e,r){var i=xr(this.Curve)*r;0!==t&&(this.ParStart=this.AdjustParam(this.ParStart+t*i)),0!==e&&(this.ParEnd=this.AdjustParam(this.ParEnd+e*i))},s.RelativeOrderOfBasesIsPreserved=function(t,e,r){var i=xr(this.Curve)*r,h=this.parStart+t*i,c=this.parStart<this.parEnd?this.parEnd+e*i:this.parEnd+xr(this.Curve)+e*i;if(h>c||this.SpanBetweenTwoParameters(h,c)>xr(this.Curve)/2)return!1;if(null==this.Prev||this.SpanBetweenTwoParameters(this.Prev.ParMid,this.ParMid)>i&&this.SpanBetweenTwoParameters(this.ParMid,this.Next.ParMid)>i)return!0;var f=this.RotateLeftPoint(e,r),p=this.RotateRigthPoint(t,r),y=R.middle(f,p),m=this.MidPoint;return!(R.getTriangleOrientation(this.CurveCenter,this.Prev.MidPoint,m)!=R.getTriangleOrientation(this.CurveCenter,this.Prev.MidPoint,y)||R.getTriangleOrientation(this.CurveCenter,this.Next.MidPoint,m)!=R.getTriangleOrientation(this.CurveCenter,this.Next.MidPoint,y))},Q(l,[{key:"Count",get:function(){return this.points.length}},{key:"CurveCenter",get:function(){return this.Curve.boundingBox.center}},{key:"OppositeBase",get:function(){return null!=this.OutgoingBundleInfo?this.OutgoingBundleInfo.TargetBase:this.IncomingBundleInfo.SourceBase}},{key:"length",get:function(){return this.points.length}},{key:"Points",get:function(){return this.points}},{key:"Tangents",get:function(){return this.tangents}},{key:"InitialMidParameter",get:function(){return this.initialMidParameter},set:function(t){this.initialMidParameter=t,this.InitialMidPoint=this.Curve.value(t)}},{key:"ParStart",get:function(){return this.parStart},set:function(t){this.parStart=t,this.StartPoint=this.Curve.value(this.parStart)}},{key:"ParEnd",get:function(){return this.parEnd},set:function(t){this.parEnd=t,this.EndPoint=this.Curve.value(this.parEnd)}},{key:"ParMid",get:function(){return(this.parStart+this.parEnd)/2}},{key:"MidPoint",get:function(){return R.middle(this.StartPoint,this.EndPoint)}},{key:"Span",get:function(){return this.SpanBetweenTwoParameters(this.parStart,this.parEnd)}}]),l}(),gl=function(){function l(o,t,e,r){this.SourceBase=o,this.TargetBase=t,this.obstaclesToIgnore=e,this.HalfWidthArray=r,this.TotalRequiredWidth=2*this.HalfWidthArray.reduce(function(f,p){return f+p},0),this.longEnoughSideLength=o.Curve.boundingBox.addRec(t.Curve.boundingBox).diagonal;var i=Math.max(o.Curve.boundingBox.diagonal,t.Curve.boundingBox.diagonal);if(this.TotalRequiredWidth>i){for(var h=this.TotalRequiredWidth/i,c=0;c<this.HalfWidthArray.length;c++)this.HalfWidthArray[c]/=h;this.TotalRequiredWidth/=h}}var s=l.prototype;return s.SetParamsFeasiblySymmetrically=function(t){this.CalculateTightObstaclesForBundle(t,this.obstaclesToIgnore),this.SetEndParamsSymmetrically()},s.CalculateTightObstaclesForBundle=function(t,e){var h=Po.Create4gon(this.SourceBase.Position,this.TargetBase.Position,this.SourceBase.Curve.boundingBox.diagonal/2*2,this.TargetBase.Curve.boundingBox.diagonal/2*2);this.tightObstaclesInTheBoundingBox=Array.from(t.AllHitItems(h.boundingBox,function(c){return!e.has(c)&&K.ClosedCurveInteriorsIntersect(h,c)}))},s.SetEndParamsSymmetrically=function(){var t=this.TargetBase.Position,e=this.SourceBase.Position,r=t.sub(e).normalize(),i=r.rotate90Ccw(),h=R.middle(t,e),c=r.mul(this.longEnoughSideLength),f=h.add(c),p=h.sub(c);if(this.SetRLParamsIfWidthIsFeasible(i.mul(this.TotalRequiredWidth/2),f,p))this.SetInitialMidParams();else{for(var y=this.TotalRequiredWidth,m=0,P=y/2;y-m>l.FeasibleWidthEpsilon;)this.SetRLParamsIfWidthIsFeasible(i.mul(P/2),f,p)?m=P:y=P,P=.5*(y+m);P<=l.FeasibleWidthEpsilon&&(this.SetRLParamsIfWidthIsFeasible_(i.mul(l.FeasibleWidthEpsilon),new R(0,0),f,p)||this.SetRLParamsIfWidthIsFeasible_(new R(0,0),i.mul(-l.FeasibleWidthEpsilon),f,p))&&(P=2*l.FeasibleWidthEpsilon),this.SourceBase.InitialMidParameter=this.SourceBase.AdjustParam(this.SourceBase.ParStart+this.SourceBase.Span/2),this.TargetBase.InitialMidParameter=this.TargetBase.AdjustParam(this.TargetBase.ParStart+this.TargetBase.Span/2)}},s.mkNameFromLRST=function(){return"./tmp/leftRight"+this.SourceBase.Position.toString()+"_"+this.TargetBase.Position.toString()+".svg"},s.SetRLParamsIfWidthIsFeasible=function(t,e,r){return this.SetRLParamsIfWidthIsFeasible_(t,t.neg(),e,r)},s.SetRLParamsIfWidthIsFeasible_=function(t,e,r,i){var h={par:0},c={par:0},f={par:0},p={par:0},y=this.TrimSegWithBoundaryCurves(Z.mkPP(r.add(t),i.add(t)),c,f);return null!=y&&!this.tightObstaclesInTheBoundingBox.find(function(P){return null!=K.intersectionOne(y,P,!1)})&&null!=(y=this.TrimSegWithBoundaryCurves(Z.mkPP(r.add(e),i.add(e)),p,h))&&!this.tightObstaclesInTheBoundingBox.find(function(P){return null!=K.intersectionOne(y,P,!1)})&&(this.SourceBase.IsParent?(this.SourceBase.ParStart=c.par,this.SourceBase.ParEnd=p.par):(this.SourceBase.ParStart=p.par,this.SourceBase.ParEnd=c.par),this.TargetBase.IsParent?(this.TargetBase.ParStart=h.par,this.TargetBase.ParEnd=f.par):(this.TargetBase.ParStart=f.par,this.TargetBase.ParEnd=h.par),!0)},s.SetInitialMidParams=function(){var t={par:0},e={par:0};null!=this.TrimSegWithBoundaryCurves(Z.mkPP(this.TargetBase.CurveCenter,this.TargetBase.CurveCenter),e,t)?(this.SourceBase.InitialMidParameter=e.par,this.TargetBase.InitialMidParameter=t.par):(this.SourceBase.InitialMidParameter=this.SourceBase.AdjustParam(this.SourceBase.ParStart+this.SourceBase.Span/2),this.TargetBase.InitialMidParameter=this.TargetBase.AdjustParam(this.TargetBase.ParStart+this.TargetBase.Span/2))},s.mkNameFromST=function(){return"./tmp/mparam"+this.SourceBase.Position.toString()+"_"+this.TargetBase.Position.toString()+".svg"},s.TrimSegWithBoundaryCurves=function(t,e,r){var h,c,i=K.getAllIntersections(t,this.SourceBase.Curve,!0);return 0===i.length?(r.par=0,e.par=0,null):(h=1===i.length?i[0]:this.SourceBase.IsParent?i[0].par0<i[1].par0?i[1]:i[0]:i[0].par0<i[1].par0?i[0]:i[1],0===(i=K.getAllIntersections(t,this.TargetBase.Curve,!0)).length?(r.par=0,e.par=0,null):(c=1===i.length?i[0]:this.TargetBase.IsParent?i[0].par0>i[1].par0?i[1]:i[0]:i[0].par0>i[1].par0?i[0]:i[1],e.par=h.par1,r.par=c.par1,Z.mkPP(h.x,c.x)))},s.RotateBy=function(t,e,r,i,h){var c=0!==t||0!==e,f=0!==r||0!==i;c&&this.SourceBase.RotateBy(t,e,h),f&&this.TargetBase.RotateBy(r,i,h),this.UpdateSourceAndTargetBases(c,f)},s.UpdateSourceAndTargetBases=function(t,e){t&&this.UpdatePointsOnBundleBase(this.SourceBase),e&&this.UpdatePointsOnBundleBase(this.TargetBase),this.UpdateTangentsOnBases()},s.UpdateTangentsOnBases=function(){for(var t=this.TargetBase.length,e=0;e<t;e++){var r=this.TargetBase.Points[e].sub(this.SourceBase.Points[t-1-e]),i=r.length;i>=q.tolerance&&(r=r.div(i),this.TargetBase.Tangents[e]=r,this.SourceBase.Tangents[t-1-e]=r.neg())}},s.UpdatePointsOnBundleBase=function(t){var e=t.length,r=t.Points,i=Z.mkPP(t.EndPoint,t.StartPoint),h=1/this.TotalRequiredWidth,c=this.HalfWidthArray[0];r[0]=i.value(c*h);for(var f=1;f<e;f++)r[f]=i.value((c+=this.HalfWidthArray[f-1]+this.HalfWidthArray[f])*h)},s.RotationIsLegal=function(t,e,r,i,h){if(this.SourceBase.IsParent||this.TargetBase.IsParent){if(0!==e||0!==i){var m=this.SourceBase.RotateLeftPoint(e,h),P=this.TargetBase.RotateLeftPoint(i,h);if(!this.LineIsLegal(m,P))return!1}if(0!==t||0!==r){var L=this.SourceBase.RotateRigthPoint(t,h),E=this.TargetBase.RotateRigthPoint(r,h);if(!this.LineIsLegal(L,E))return!1}}else{if(0!==e||0!==r){var c=this.SourceBase.RotateLeftPoint(e,h),f=this.TargetBase.RotateRigthPoint(r,h);if(!this.LineIsLegal(c,f))return!1}if(0!==t||0!==i){var p=this.SourceBase.RotateRigthPoint(t,h),y=this.TargetBase.RotateLeftPoint(i,h);if(!this.LineIsLegal(p,y))return!1}}return!((0!==t||0!==e)&&!this.SourceBase.RelativeOrderOfBasesIsPreserved(t,e,h)||(0!==r||0!==i)&&!this.TargetBase.RelativeOrderOfBasesIsPreserved(r,i,h))},s.LineIsLegal=function(t,e){return null==this.tightObstaclesInTheBoundingBox.find(function(r){return null!=K.intersectionOne(Z.mkPP(t,e),r,!1)})},l}();gl.FeasibleWidthEpsilon=.1;var pl=function(){function l(o,t,e,r){this.Segment=o,this.Reversed=t,this.Index=e,this.BundleBase=r}return l.prototype.value=function(t){return this.Segment.value(this.Reversed?this.Segment.parEnd-t:t)},Q(l,[{key:"Segment",get:function(){return this.segment},set:function(t){this.segment=t}}]),l}(),qe=function(){function l(o,t,e){this.fixedBundles=new mo,this.stepsWithProgress=0,this.metroOrdering=o,this.metroGraphData=t,this.bundlingSettings=e}var s=l.prototype;return s.Run=function(){this.AllocateBundleBases(),this.SetBasesRightLeftParamsToTheMiddles(),this.bundlingSettings.KeepOverlaps?(this.UpdateSourceAndTargetBases(),this.CreateOrientedSegs()):(this.SetRightLeftParamsFeasiblySymmetrically(),this.AdjustStartEndParamsToAvoidBaseOverlaps(),this.UpdateSourceAndTargetBases(),this.CreateOrientedSegs(),this.bundlingSettings.RotateBundles&&this.RotateBundlesToDiminishCost(),this.AdjustStartEndParamsToAvoidBaseOverlaps(),this.UpdateSourceAndTargetBases())},s.AllocateBundleBases=function(){this.externalBases=new Map,this.internalBases=new Map,this.Bundles=new Array;for(var e,t=C(this.metroGraphData.Stations);!(e=t()).done;){var r=e.value;null==r.BoundaryCurve&&(r.BoundaryCurve=Wt.mkCircle(r.Radius,r.Position))}for(var h,i=C(this.metroGraphData.Stations);!(h=i()).done;)for(var p,c=h.value,f=C(c.Neighbors);!(p=f()).done;){var y=p.value;if(c.SerialNumber<y.SerialNumber){var m=new vl(this.metroGraphData.RealEdgeCount(c,y),c.BoundaryCurve,c.Position,c.IsReal);c.BundleBases.set(y,m);var P=new vl(this.metroGraphData.RealEdgeCount(c,y),y.BoundaryCurve,y.Position,y.IsReal);y.BundleBases.set(c,P),K.PointRelativeToCurveLocation(y.Position,c.BoundaryCurve)!==ht.Outside?(m.IsParent=!0,An(this.internalBases,c,m),An(this.externalBases,y,P)):K.PointRelativeToCurveLocation(c.Position,y.BoundaryCurve)!==ht.Outside?(P.IsParent=!0,An(this.externalBases,c,m),An(this.internalBases,y,P)):(An(this.externalBases,c,m),An(this.externalBases,y,P));var L=this.metroGraphData.tightIntersections.ObstaclesToIgnoreForBundle(c,y),E=new gl(m,P,L,Array.from(this.metroOrdering.GetOrder(c,y)).map(function(S){return S.Width/2}));m.OutgoingBundleInfo=P.IncomingBundleInfo=E,this.Bundles.push(E)}}this.SetBundleBaseNeighbors()},s.SetBundleBaseNeighbors=function(){for(var e,t=C(this.externalBases.keys());!(e=t()).done;){var i=this.externalBases.get(e.value);this.SortBundlesCounterClockwise(i),this.SetLeftRightBases(i)}for(var c,h=C(this.internalBases.keys());!(c=h()).done;){var p=this.internalBases.get(c.value);this.SortBundlesCounterClockwise(p),this.SetLeftRightBases(p)}},s.SortBundlesCounterClockwise=function(t){if(t.length>2){var e=t[0].OppositeBase.Position,r=t[0].CurveCenter;t.sort(function(i,h){return Pn(e.sub(r),i.OppositeBase.Position.sub(r),h.OppositeBase.Position.sub(r))})}},s.SetLeftRightBases=function(t){var e=t.length;if(!(e<=1))for(var r=0;r<e;r++)t[r].Prev=t[(r-1+e)%e],t[r].Next=t[(r+1)%e]},s.CreateOrientedSegs=function(){for(var e,t=C(this.metroGraphData.Metrolines);!(e=t()).done;)this.CreateOrientedSegsOnLine(e.value)},s.CreateOrientedSegsOnLine=function(t){for(var e=t.Polyline.startPoint.next;null!=e.next;e=e.next)this.CreateOrientedSegsOnLineVertex(t,e)},s.CreateOrientedSegsOnLineVertex=function(t,e){var r=this.metroGraphData.PointToStations.get(e.prev.point),i=this.metroGraphData.PointToStations.get(e.point),h=this.metroGraphData.PointToStations.get(e.next.point),c=i.BundleBases.get(r),f=i.BundleBases.get(h),p=this.metroOrdering.GetLineIndexInOrder(r,i,t),y=this.metroOrdering.GetLineIndexInOrder(h,i,t),m=c.OrientedHubSegments[p]=new pl(null,!1,p,c),P=f.OrientedHubSegments[y]=new pl(null,!0,y,f);P.Other=m,m.Other=P},s.UpdateSourceAndTargetBases=function(){for(var e,t=C(this.Bundles);!(e=t()).done;)e.value.UpdateSourceAndTargetBases(!0,!0)},s.SetBasesRightLeftParamsToTheMiddles=function(){for(var e,t=C(this.Bundles);!(e=t()).done;){var r=e.value,i=r.SourceBase,h=r.TargetBase;i.ParEnd=i.ParStart=this.GetBaseMiddleParamInDirection(i,i.Position,h.Position),h.ParEnd=h.ParStart=this.GetBaseMiddleParamInDirection(h,h.Position,i.Position)}},s.GetBaseMiddleParamInDirection=function(t,e,r){var i=t.Curve;if(i instanceof Wt){var c=i;if(c.isArc())return R.angle(c.aAxis,r.sub(e))}for(var y,p=C(K.getAllIntersections(i,Z.mkPP(e,r),!0));!(y=p()).done;){var m=y.value,P=m.x;if(P.sub(e).dot(P.sub(r))<=0)return m.par0}throw new Error},s.SetRightLeftParamsFeasiblySymmetrically=function(){for(var e,t=C(this.Bundles);!(e=t()).done;)e.value.SetParamsFeasiblySymmetrically(this.metroGraphData.TightTree)},s.AdjustStartEndParamsToAvoidBaseOverlaps=function(){for(var e,t=C(this.externalBases.values());!(e=t()).done;)this.AdjustCurrentBundleWidthsOnCurve(e.value);for(var h,i=C(this.internalBases.values());!(h=i()).done;)this.AdjustCurrentBundleWidthsOnCurve(h.value)},s.AdjustCurrentBundleWidthsOnCurve=function(t){var e=t.length;if(!(e<=1))for(var r=0;r<e;r++){var i=t[r];this.ShrinkBasesToMakeTwoConsecutiveNeighborsHappy(i,i.Next)}},s.ShrinkBasesToMakeTwoConsecutiveNeighborsHappy=function(t,e){var r=function(l,s){var o=xr(l.Curve),t=l.ParEnd,e=l.ParStart<l.ParEnd?l.ParStart:l.ParStart-o,r=s.ParEnd,i=s.ParStart<s.ParEnd?s.ParStart:s.ParStart-o;t>r?t-i>o&&(i+=o,r+=o):r-e>o&&(e+=o,t+=o);var h=Math.min(t,r),c=Math.max(e,i);return c<=h?{start:c,end:h,rbaseMiddle:(e+t)/2,lbaseMiddle:(i+r)/2}:null}(t,e);if(null!=r&&!dt(r.start,r.end)){if(r.rbaseMiddle<r.lbaseMiddle){var c=t;t=e,e=c}var f=t.Span,p=e.Span,y=(r.end*f+r.start*p)/(p+f);t.ParStart=t.AdjustParam(y+q.distanceEpsilon),e.ParEnd=e.AdjustParam(y-q.distanceEpsilon)}},s.RegularCut=function(t,e,r,i,h,c){var f=(h*i+c*t)/(h+c),p=Math.min(e,i),y=Math.max(t,r);return f<y&&(f=y),f>p&&(f=p),f},s.RotateBundlesToDiminishCost=function(){for(var t=l.MaxParameterChange,e={cost:this.Cost()},r=0;r++<l.MaxIterations;){var i=e.cost;if(this.RotateBundlesToDiminishCostOneIteration(t,e),(t=this.UpdateParameterChange(t,i,e.cost))<l.MinParameterChange)break}},s.UpdateParameterChange=function(t,e,r){return r+1<e?(this.stepsWithProgress++,this.stepsWithProgress>=5&&(this.stepsWithProgress=0,this.fixedBundles.clear())):(this.stepsWithProgress=0,t*=.8,this.fixedBundles.clear()),t},s.RotateBundlesToDiminishCostOneIteration=function(t,e){for(var h,r=!1,i=C(this.Bundles);!(h=i()).done;){var c=h.value;this.fixedBundles.has(c)||(this.OptimizeBundle(c,t,e)?r=!0:this.fixedBundles.add(c))}return r},s.OptimizeBundle=function(t,e,r){var i=this.CostBi(t);if(i<l.CostThreshold)return!1;for(var h=0,c=-1,f=-1,p=0;p<l.Deltas.length-1;p++){var y=this.DeltaWithChangedAngles(l.Deltas[p][0],l.Deltas[p][1],0,0,t,i,e);y>l.CostDeltaThreshold&&y>h&&(f=p,c=l.Deltas.length-1,h=y),(y=this.DeltaWithChangedAngles(0,0,l.Deltas[p][0],l.Deltas[p][1],t,i,e))>l.CostDeltaThreshold&&y>h&&(f=l.Deltas.length-1,c=p,h=y)}return!(h<l.CostDeltaThreshold||(r.cost-=h,t.RotateBy(l.Deltas[f][0],l.Deltas[f][1],l.Deltas[c][0],l.Deltas[c][1],e),0))},s.DeltaWithChangedAngles=function(t,e,r,i,h,c,f){if(!h.RotationIsLegal(t,e,r,i,f))return 0;h.RotateBy(t,e,r,i,f);var p=this.CostBN(h,c);return h.RotateBy(-1*t,-1*e,-1*r,-1*i,f),c-p},s.CostBi=function(t){return l.SeparationCoeff*this.SeparationCost(t)+(l.SqueezeCoeff*this.SqueezeCost(t)+(l.AssymetryCoeff*this.AssymetryCost(t)+l.CenterCoeff*this.CenterCostBi(t)))},s.CostBN=function(t,e){var r=0;return(r+=l.CenterCoeff*this.CenterCostBi(t))>e||(r+=l.SeparationCoeff*this.SeparationCost(t))>e||(r+=l.SqueezeCoeff*this.SqueezeCost(t))>e||(r+=l.AssymetryCoeff*this.AssymetryCost(t)),r},s.SqueezeCost=function(t){var r=t.TargetBase.MidPoint.sub(t.SourceBase.MidPoint).normalize().rotate90Ccw(),i=Math.abs(t.SourceBase.StartPoint.sub(t.SourceBase.EndPoint).dot(r)),h=Math.abs(t.TargetBase.StartPoint.sub(t.TargetBase.EndPoint).dot(r)),c=Math.abs(t.TotalRequiredWidth-i)/t.TotalRequiredWidth,f=Math.abs(t.TotalRequiredWidth-h)/t.TotalRequiredWidth,p=Math.abs(i-h)/t.TotalRequiredWidth;return Math.exp(10*c)-1+(Math.exp(10*f)-1)+p},s.CenterCostBi=function(t){return t.SourceBase.BelongsToRealNode||t.TargetBase.BelongsToRealNode?this.CenterCostBb(t.SourceBase)+this.CenterCostBb(t.TargetBase):0},s.CenterCostBb=function(t){if(!t.BelongsToRealNode)return 0;var e=t.ParMid,r=Math.min(t.InitialMidParameter,e),i=Math.max(t.InitialMidParameter,e),h=Math.min(i-r,r+(xr(t.Curve)-i));return t.CurveCenter.equal(t.Position)||t.IsParent?h*h*25:h*h*500},s.AssymetryCost=function(t){return this.GetAssymetryCostForBase(t.SourceBase)+this.GetAssymetryCostForBase(t.TargetBase)},s.GetAssymetryCostForBase=function(t){if(t.BelongsToRealNode)return 0;for(var h,e=t.OppositeBase.BelongsToRealNode?200:500,r=0,i=C(t.OrientedHubSegments);!(h=i()).done;){var c=h.value,f=c.Index,p=c.Other.Index,P=c.Other.BundleBase,S=t.Count+P.Count;r+=this.GetAssymetryCostOnData(t.Points[f],t.Tangents[f],P.Points[p],P.Tangents[p],e)/S}return r},s.GetAssymetryCostOnData=function(t,e,r,i,h){var c=t.sub(r);if(c.length<q.distanceEpsilon)return 0;var p=e.add(i).dot(c),y=R.crossProduct(c,e),m=R.crossProduct(c,i),P=y-m;return 10*(p*p+P*P)+h*(y*y+m*m)},s.SeparationCost=function(t){return this.SeparationCostForBundleBase(t.SourceBase)+this.SeparationCostForBundleBase(t.TargetBase)},s.SeparationCostForBundleBase=function(t){return null==t.Prev?0:this.SeparationCostForAdjacentBundleBases(t,t.Prev)+this.SeparationCostForAdjacentBundleBases(t,t.Next)},s.SeparationCostForAdjacentBundleBases=function(t,e){var i=this.IntervalsOverlapLength(t.ParStart,t.ParEnd,e.ParStart,e.ParEnd,t.Curve),h=Math.min(t.Span,e.Span);return Math.exp(i/(10*h))-1},s.IntervalsOverlapLength=function(t,e,r,i,h){var c=h.parStart,f=h.parEnd;return t<e?r<i?this.IntersectRegularIntervals(t,e,r,i):this.IntersectRegularIntervals(t,e,r,f)+this.IntersectRegularIntervals(t,e,c,i):r<i?this.IntersectRegularIntervals(t,f,r,i)+this.IntersectRegularIntervals(c,e,r,i):this.IntersectRegularIntervals(t,f,r,f)+this.IntersectRegularIntervals(c,e,c,i)},s.IntersectRegularIntervals=function(t,e,r,i){var h=Math.max(t,r),c=Math.min(e,i);return h<c?c-h:0},s.Cost=function(){for(var r,t=0,e=C(this.Bundles);!(r=e()).done;){var i=r.value;t+=(l.SeparationCoeff*this.SeparationCost(i)+l.AssymetryCoeff*this.AssymetryCost(i))/2+l.SqueezeCoeff*this.SqueezeCost(i)+l.CenterCoeff*this.CenterCostBi(i)}return t},l}();qe.Deltas=[[1,-1],[1,-1]],qe.SeparationCoeff=1,qe.SqueezeCoeff=1,qe.CenterCoeff=10,qe.AssymetryCoeff=1,qe.MaxIterations=200,qe.MaxParameterChange=8/360,qe.MinParameterChange=.1/360,qe.CostThreshold=1e-5,qe.CostDeltaThreshold=.01;var Yf=function(){function l(){this.Metrolines=new Array}return l.prototype.Add=function(t){this.Metrolines.push(t)},l}();function $a(){$a=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Qf=function(){function l(o){this.Metrolines=o,this.BuildOrder()}var s=l.prototype;return s.GetOrder=$a().mark(function o(t,e){var r,i,h,c;return $a().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(r=new ue(t.Position,e.Position),i=this.bundles.get(r).Metrolines,t.Position!==r.first){p.next=12;break}h=0;case 4:if(!(h<i.length)){p.next=10;break}return p.next=7,i[h];case 7:h++,p.next=4;break;case 10:p.next=19;break;case 12:c=i.length-1;case 13:if(!(c>=0)){p.next=19;break}return p.next=16,i[c];case 16:c--,p.next=13;break;case 19:case"end":return p.stop()}},o,this)}),s.GetLineIndexInOrder=function(t,e,r){var i=new ue(t.Position,e.Position),h=t.Position!==i.first,c=this.bundles.get(i).LineIndexInOrder;return h?c.size-1-c.get(r):c.get(r)},s.BuildOrder=function(){this.bundles=new li;for(var e,t=C(this.Metrolines);!(e=t()).done;)for(var r=e.value,i=r.Polyline.startPoint;null!=i.next;i=i.next){var h=new ue(i.point,i.next.point),c=this.bundles.get(h);c||this.bundles.set(h,c=new Yf),c.Add(r)}for(var p,f=C(this.bundles);!(p=f()).done;){var y=p.value;this.BuildOrderPP(y[0],y[1])}},s.BuildOrderPP=function(t,e){var r=this;if(!e.orderFixed){e.Metrolines.sort(function(h,c){return r.CompareLines(h,c,t.first,t.second)}),e.orderFixed=!0,e.LineIndexInOrder=new Map;for(var i=0;i<e.Metrolines.length;i++)e.LineIndexInOrder.set(e.Metrolines[i],i)}},s.CompareLines=function(t,e,r,i){var h={polyPoint:null,next:null,prev:null};this.FindStationOnLine(r,i,t,h);var c=h.polyPoint,f=h.next,p=h.prev;this.FindStationOnLine(r,i,e,h);for(var S,T,y=h.polyPoint,m=h.next,P=h.prev,L=c,E=y;null!=(T=p(L))&&null!=(S=P(E))&&T.point.equal(S.point);){var O=new ue(T.point,L.point);if(this.bundles.get(O).orderFixed)return this.CompareOnFixedOrder(O,t,e,!T.point.equal(O.first));L=T,E=S}if(null!=T&&null!=S){var x=L.point;return-l.IsLeft(f(L).point.sub(x),T.point.sub(x),S.point.sub(x))}for(L=c,E=y;null!=(T=f(L))&&null!=(S=m(E))&&T.point.equal(S.point);){var B=new ue(T.point,L.point);if(this.bundles.get(B).orderFixed)return this.CompareOnFixedOrder(B,t,e,!L.point.equal(B.first));L=T,E=S}if(null!=T&&null!=S){var M=L.point;return l.IsLeft(p(L).point.sub(M),T.point.sub(M),S.point.sub(M))}return It(t.Index,e.Index)},s.CompareOnFixedOrder=function(t,e,r,i){var h=this.bundles.get(t).LineIndexInOrder;return(i?-1:1)*It(h.get(e),h.get(r))},s.FindStationOnLine=function(t,e,r,i){for(var h=r.Polyline.startPoint;null!=h.next;h=h.next){if(h.point.equal(t)&&h.next.point.equal(e))return i.next=function(c){return c.next},i.prev=function(c){return c.prev},void(i.polyPoint=h);if(h.point.equal(e)&&h.next.point.equal(t))return i.next=function(c){return c.prev},i.prev=function(c){return c.next},void(i.polyPoint=h.next)}throw new Error},l.IsLeft=function(t,e,r){return Pn(t,e,r)},l}();function Ja(){Ja=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var bo=function(l){function s(t,e){var r;return(r=l.call(this,null)||this).metroGraphData=t,r.bundlingSettings=e,r}X(s,l);var o=s.prototype;return o.run=function(){this.CreateMetroOrdering(),this.InitRadii(),this.FinalizePaths()},o.InitRadii=function(){new _r(this.metroGraphData,this.bundlingSettings).CreateNodeRadii()},o.CreateMetroOrdering=function(){this.metroOrdering=new Qf(this.metroGraphData.Metrolines)},o.FinalizePaths=function(){this.CreateBundleBases(),this.CreateSegmentsInsideHubs(),this.CreateCurves()},o.CreateBundleBases=function(){new qe(this.metroOrdering,this.metroGraphData,this.bundlingSettings).Run()},o.CreateCurves=function(){for(var e=0;e<this.metroGraphData.Metrolines.length;e++)this.CreateCurveLine(this.metroGraphData.Metrolines[e],this.metroGraphData.Edges[e])},o.CreateCurveLine=function(e,r){for(var y,i=new K,c=s.FindCurveStart(this.metroGraphData,this.metroOrdering,e),p=C(s.HubSegsOfLine(this.metroGraphData,this.metroOrdering,e));!(y=p()).done;){var m=y.value;null!=m&&(i.addSegment(Z.mkPP(c,m.start)),i.addSegment(m),c=m.end)}i.addSegment(Z.mkPP(c,s.FindCurveEnd(this.metroGraphData,this.metroOrdering,e))),r.curve=i},s.FindCurveStart=function(e,r,i){var h=e.PointToStations.get(i.Polyline.startPoint.point),c=e.PointToStations.get(i.Polyline.startPoint.next.point),f=h.BundleBases.get(c),p=f.IsParent?r.GetLineIndexInOrder(h,c,i):r.GetLineIndexInOrder(c,h,i);return f.Points[p]},s.FindCurveEnd=function(e,r,i){var h=e.PointToStations.get(i.Polyline.endPoint.prev.point),c=e.PointToStations.get(i.Polyline.endPoint.point),f=c.BundleBases.get(h),p=f.IsParent?r.GetLineIndexInOrder(c,h,i):r.GetLineIndexInOrder(h,c,i);return f.Points[p]},s.HubSegsOfLine=Ja().mark(function t(e,r,i){var h;return Ja().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:h=i.Polyline.startPoint.next;case 1:if(null==h.next){f.next=7;break}return f.next=4,s.SegOnLineVertex(e,r,i,h);case 4:h=h.next,f.next=1;break;case 7:case"end":return f.stop()}},t)}),s.SegOnLineVertex=function(e,r,i,h){var c=e.PointToStations.get(h.prev.point),f=e.PointToStations.get(h.point),p=f.BundleBases.get(c),y=r.GetLineIndexInOrder(c,f,i);if(null==p.OrientedHubSegments[y]||null==p.OrientedHubSegments[y].Segment){var m=e.PointToStations.get(h.next.point),P=f.BundleBases.get(m),L=r.GetLineIndexInOrder(m,f,i);return Z.mkPP(p.Points[y],P.Points[L])}return p.OrientedHubSegments[y].Segment},o.CreateSegmentsInsideHubs=function(){for(var r,e=C(this.metroGraphData.Metrolines);!(r=e()).done;)this.CreateOrientedSegsOnLine(r.value);this.bundlingSettings.UseCubicBezierSegmentsInsideOfHubs&&this.FanBezierSegs()},o.CreateOrientedSegsOnLine=function(e){for(var r=e.Polyline.startPoint.next;null!=r.next;r=r.next)this.CreateICurveForOrientedSeg(e,r)},o.CreateICurveForOrientedSeg=function(e,r){var i=this.metroGraphData.PointToStations.get(r.prev.point),h=this.metroGraphData.PointToStations.get(r.point),c=this.metroGraphData.PointToStations.get(r.next.point),f=h.BundleBases.get(i),p=h.BundleBases.get(c),y=this.metroOrdering.GetLineIndexInOrder(i,h,e),m=this.metroOrdering.GetLineIndexInOrder(c,h,e),P=this.bundlingSettings.UseCubicBezierSegmentsInsideOfHubs?s.StandardBezier(f.Points[y],f.Tangents[y],p.Points[m],p.Tangents[m]):s.BiArc(f.Points[y],f.Tangents[y],p.Points[m],p.Tangents[m]);f.OrientedHubSegments[y].Segment=P,p.OrientedHubSegments[m].Segment=P},s.ShowHubs=function(e,r,i,h,c){void 0===c&&(c=[]);var f=s.GetAllDebugCurves(r,e);null!=i&&f.push(xt.mkDebugCurveTWCI(255,1,"red",te.mkDiamond(5,25,i.Position))),f=f.concat(c)},s.GetAllDebugCurves=function(e,r){return s.GraphNodes(r).concat(s.VertexDebugCurves(e,r)).concat(s.DebugEdges(r))},s.DebugEdges=function(e){return e.Edges.map(function(r){return xt.mkDebugCurveTWCI(40,.1,"gray",r.curve)})},s.VertexDebugCurves=function(e,r){return s.DebugCircles(r).concat(s.DebugHubBases(r)).concat(s.DebugSegs(r)).concat(s.BetweenHubs(e,r))},s.BetweenHubs=function(e,r){for(var c,i=[],h=C(r.Metrolines);!(c=h()).done;)for(var P,f=c.value,p=s.GetInterestingSegs(r,e,f),y=s.GetMonotoneColor(f.Polyline.start,f.Polyline.end,p),m=C(p);!(P=m()).done;){var L=P.value;i.push(xt.mkDebugCurveTWCI(100,f.Width,y,Z.mkPP(L[0],L[1])))}return i},s.GetInterestingSegs=function(e,r,i){var h=new Array;if(0===e.Stations.length||null==e.Stations[0].BundleBases||0===e.Stations[0].BundleBases.size)return[];for(var y,c=s.FindCurveStart(e,r,i),p=C(s.HubSegsOfLine(e,r,i));!(y=p()).done;){var m=y.value;null!=m&&(h.push([c,m.start]),c=m.end)}return h.push([c,s.FindCurveEnd(e,r,i)]),h},s.GetMonotoneColor=function(e,r,i){return"green"},s.DebugHubBases=function(e){for(var h,r=new Array,i=C(e.Stations);!(h=i()).done;)for(var p,f=C(h.value.BundleBases.values());!(p=f()).done;){var y=p.value;r.push(xt.mkDebugCurveTWCI(100,1,"red",Z.mkPP(y.EndPoint,y.StartPoint)))}return r},s.DebugCircles=function(e){return e.Stations.map(function(r){return xt.mkDebugCurveTWCI(100,.1,"blue",te.mkCircle(r.Radius,r.Position))})},s.DebugSegs=function(e){for(var h,r=new Array,i=C(e.VirtualStations());!(h=i()).done;)for(var p,f=C(h.value.BundleBases.values());!(p=f()).done;)for(var P,y=p.value,m=C(y.OrientedHubSegments);!(P=m()).done;){var L=P.value;null!=L&&r.push(L.Segment??Z.mkPP(y.Points[L.Index],L.Other.BundleBase.Points[L.Other.Index]))}return r.map(function(O){return xt.mkDebugCurveTWCI(100,.01,"green",O)})},s.GraphNodes=function(e){return e.Edges.map(function(i){return i.sourcePort.Curve}).concat(e.Edges.map(function(i){return i.targetPort.Curve})).map(function(i){return xt.mkDebugCurveTWCI(40,1,"black",i)})},s.BiArc=function(e,r,i,h){var c=e.sub(i);if(c.length<q.distanceEpsilon)return null;var f=c.dot(r.sub(h)),p=-r.dot(h);if(r.dot(i.sub(e))<=0&&r.dot(h)<=0)return s.StandardBezier(e,r,i,h);var L,y=2*(p-1),m=2*f,P=c.dot(c);if(Math.abs(y)<q.distanceEpsilon){if(!(Math.abs(m)>q.distanceEpsilon))return null;L=-P/m}else{var E=m*m-4*y*P;E<0&&(E=0),(L=(-m+(E=Math.sqrt(E)))/(2*y))<0&&(L=(-m-E)/(2*y))}var S=e.add(r.mul(L)),T=i.add(h.mul(L)),O=R.middle(S,T);if(R.getTriangleOrientation(e,S,O)!==R.getTriangleOrientation(O,T,i))return s.StandardBezier(e,r,i,h);var M=new K;return M.addSegs([s.ArcOn(e,S,O),s.ArcOn(O,T,i)]),M},s.ArcOn=function(e,r,i){var h={center:null};if(Math.abs(R.signedDoubledTriangleArea(e,r,i))<1e-4||!s.FindArcCenter(e,r,i,h))return Z.mkPP(e,i);var c=h.center,f=At(e,c);if(At(e,r)/f<1e-4)return Z.mkPP(e,i);var y=e.sub(c),m=Math.atan2(y.y,y.x),P=i.sub(c),L=Math.atan2(P.y,P.x),E=L-m;if(E<0&&(E+=2*Math.PI,L+=2*Math.PI),E<=Math.PI)return new Wt(m,L,new R(f,0),new R(0,f),c);for(L>2*Math.PI&&(L-=2*Math.PI),m=Math.PI-m,L=Math.PI-L,m<0&&(m+=2*Math.PI);L<m;)L+=2*Math.PI;return E=L-m,new Wt(m,L,new R(-f,0),new R(0,f),c)},s.FindArcCenter=function(e,r,i,h){var c=r.sub(e).rotate90Cw(),f=r.sub(i).rotate90Cw();return h.center=R.lineLineIntersection(e,e.add(c),i,i.add(f)),null!=h.center},s.StandardBezier=function(e,r,i,h){var c=At(e,i)/4;return or.mkBezier([e,e.add(r.mul(c)),i.add(h.mul(c)),i])},o.FanBezierSegs=function(){for(var e=!0,i=0;e&&i++<5;){e=!1;for(var c,h=C(this.metroGraphData.Stations);!(c=h()).done;)for(var y,p=C(c.value.BundleBases.values());!(y=p()).done;)e||(e=this.FanEdgesOfHubSegment(y.value))}},o.FanEdgesOfHubSegment=function(e){for(var r=!1,i=0;i<e.Count-1;i++)r||(r=this.FanCouple(e,i,e.CurveCenter,e.Curve.boundingBox.diagonal/2));return r},o.FanCouple=function(e,r,i,h){var c=e.OrientedHubSegments[r],f=e.OrientedHubSegments[r+1];if(null==c)return!1;if(Cs(c.Segment.start,c.Segment.end,f.Segment.start,f.Segment.end)||R.getTriangleOrientation(c.value(0),c.value(.5),c.value(1))!=R.getTriangleOrientation(f.value(0),f.value(.5),f.value(1)))return!1;var y=this.BaseLength(c),m=this.BaseLength(f);return!(Math.abs(y-m)<q.intersectionEpsilon)&&(y>m?this.AdjustLongerSeg(c,f,i,h):this.AdjustLongerSeg(f,c,i,h))},o.AdjustLongerSeg=function(e,r,i,h){var c=e.value(0).sub(r.value(0)),f=e.value(1).sub(r.value(1)),p=Math.min(c.length,f.length),y=r.value(.5),m=Math.max(c.length,f.length);return 0!==this.NicelyAligned(e.Segment,c,f,y,p,m)&&this.FitLonger(e,c,f,y,p,m,i,h)},o.FitLonger=function(e,r,i,h,c,f,p,y){var m=e.Segment,P=m.start,L=m.end,E=0,T=m.start.mul(1-s.SqueezeBound).add(m.B(1).mul(s.SqueezeBound)),O=m.end.mul(1-s.SqueezeBound).add(m.B(2).mul(s.SqueezeBound)),x=m.B(1).mul(2).sub(m.start),B=m.B(2).mul(2).sub(m.end),M={highP:x};this.PullControlPointToTheCircle(m.start,M,p,y),x=M.highP;for(var F=this.NicelyAligned(m,r,i,h,c,f);;){if(-1===F){var A=R.middle(m.B(1),T),z=R.middle(m.B(2),O);x=m.B(1),B=m.B(2),m=new or(P,A,z,L)}else{var V=R.middle(m.B(1),x),Y=(m.B(2),B);T=m.B(1),O=m.B(2),m=new or(P,V,Y,L)}if(0===(F=this.NicelyAligned(m,r,i,h,c,f)))return e.Segment=m,e.Other.Segment=m,!0;if(E++>10)return!1}},o.PullControlPointToTheCircle=function(e,r,i,h){var c=R.ProjectionToLine(e,r.highP,i),f=Math.sqrt(h*h-c.sub(i).lengthSquared),p=r.highP.sub(c),y=p.length;y>f&&(r.highP=c.add(p.mul(f/y)))},o.NicelyAligned=function(e,r,i,h,c,f){var y=e.value(.5).sub(h),m=y.length;return r.dot(y)<0||i.dot(y)<0||m<c-.001?1:m>f+.001?-1:0},o.BaseLength=function(e){return e.value(0).sub(e.value(1)).lengthSquared},s}(Vt);bo.SqueezeBound=.2;var Sr=function(){function l(o,t){this.stepsWithProgress=0,this.metroGraphData=o,this.bundlingSettings=t,this.costCalculator=new Se(this.metroGraphData,this.bundlingSettings),this.cache=new fl(this.metroGraphData,this.bundlingSettings,this.costCalculator,this.metroGraphData.cdt)}l.FixRouting=function(t,e){return this.FixRoutingMBP(t,e,null)},l.FixRoutingMBP=function(t,e,r){return new l(t,e).FixRoutingP(r)};var s=l.prototype;return s.FixRoutingP=function(t){this.stationsForOptimizations=this.GetStationsForOptimizations(t),this.cache.InitializeCostCache();for(var e=l.MaxStep,r=Number.POSITIVE_INFINITY,i=this.metroGraphData.VirtualStations().map(function(y){return y.Position}),h=0;h++<l.MaxIterations;){var c=this.TryMoveStations();if(h<=1&&!c)return!1;if(!c)break;var f=r;r=Se.Cost(this.metroGraphData,this.bundlingSettings),e=this.UpdateMaxStep(e,f,r);var p=i;if(i=this.metroGraphData.VirtualStations().map(function(y){return y.Position}),e<l.MinStep||this.Converged(e,p,i))break}return!0},l.stationsArePositionedCorrectly=function(t){for(var r,e=C(t.VirtualEdges());!(r=e()).done;)if(!this.edgeIsPositionedCorrectly(r.value,t))return!1;return!0},l.edgeIsPositionedCorrectly=function(t,e){var r=t[0],i=t[1],h=e.looseIntersections.ObstaclesToIgnoreForBundle(r,i),c=Z.mkPP(r.Position,i.Position),f=Array.from(e.looseIntersections.obstacleTree.GetNodeItemsIntersectingRectangle(c.boundingBox)).filter(function(p){return!h.has(p)}).filter(function(p){return K.CurvesIntersect(c,p)});return!(f.length>0&&(bo.ShowHubs(e,null,null,"./tmp/badcross.svg",[xt.mkDebugCurveTWCI(200,1,"Brown",c),xt.mkDebugCurveTWCI(200,1,"Red",te.mkCircle(2,r.Position)),xt.mkDebugCurveTWCI(200,1,"Blue",te.mkCircle(5,i.Position)),xt.mkDebugCurveTWCI(100,1,"Blue",te.mkCircle(5,i.Position))].concat(f.map(function(p){return xt.mkDebugCurveTWCI(100,1,"Pink",p)}))),1))},s.GetStationsForOptimizations=function(t){if(null==t)return new Set(this.metroGraphData.VirtualStations());for(var i,e=new Set,r=C(t);!(i=r()).done;){var c=this.metroGraphData.PointToStations.get(i.value);c&&!c.IsReal&&e.add(c)}return e},s.Converged=function(t,e,r){for(var i=0,h=0,c=0;c<e.length;c++)h+=e[c].sub(r[c]).lengthSquared,i+=e[c].lengthSquared;return Math.sqrt(h/i)<l.MinRelativeChange},s.UpdateMaxStep=function(t,e,r){return r+1<e?(this.stepsWithProgress++,this.stepsWithProgress>=5&&(this.stepsWithProgress=0,t=Math.min(l.MaxStep,t/.8))):(this.stepsWithProgress=0,t*=.8),t},s.TryMoveStations=function(){for(var i,t=!1,e=new Set,r=C(this.stationsForOptimizations);!(i=r()).done;){var h=i.value;if(this.TryMoveStation(h)){t=!0,e.add(h);for(var f,c=C(h.Neighbors);!(f=c()).done;){var p=f.value;p.IsReal||e.add(p)}}}return this.stationsForOptimizations=e,t},s.TryMoveStation=function(t){var e=this.BuildDirection(t);if(0===e.length)return!1;var r=this.BuildStepLength(t,e);if(r<l.MinStep&&(e=new R(1+2*nn(),1+2*nn()),(r=this.BuildStepLength(t,e))<l.MinStep))return!1;var i=e.mul(r),h=t.Position.add(i);return!(this.metroGraphData.PointToStations.has(h)||!this.moveIsLegalForAdjacentBundles(t,h)||(this.metroGraphData.MoveNode(t,h),this.cache.UpdateCostCache(t),0))},s.moveIsLegalForAdjacentBundles=function(t,e){for(var i,r=C(this.metroGraphData.looseIntersections.obstacleTree.AllHitItems(lt.mkOnPoints([e]),function(m){return K.PointRelativeToCurveLocation(e,m)!==ht.Outside}));!(i=r()).done;){var h=i.value;if(!1===t.getELP().has(h))return!1}for(var f,c=C(t.Neighbors);!(f=c()).done;){var p=f.value,y=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(p,t);if(!this.metroGraphData.cdtIntersections.EdgeIsLegal_(p.Position,e,p.cdtTriangle,y))return!1}return!0},s.BuildDirection=function(t){var e=this.BuildForceForInk(t),r=this.BuildForceForPathLengths(t),i=this.BuildForceForRadius(t),h=this.BuildForceForBundle(t),c=e.add(r.add(i.add(h)));return c.length<.1?new R(0,0):c.normalize()},s.BuildStepLength=function(t,e){var r=l.MinStep,i=this.CostGain(t,t.Position.add(e.mul(r)));if(i<.01)return 0;for(;2*r<=l.MaxStep;){var h=this.CostGain(t,t.Position.add(e.mul(2*r)));if(h<=i)break;r*=2,i=h}return r},s.CostGain=function(t,e){var r=-12345678,i=this.costCalculator.RadiusGain(t,e);if(i<r)return r;var h=this.costCalculator.BundleGain(t,e);return h<r?r:i+this.costCalculator.InkGain(t,e)+this.costCalculator.PathLengthsGain(t,e)+h},s.BuildForceForInk=function(t){for(var i,e=new R(0,0),r=C(t.Neighbors);!(i=r()).done;){var c=i.value.Position.sub(t.Position);e=e.add(c.normalize())}return e.mul(this.bundlingSettings.InkImportance)},s.BuildForceForPathLengths=function(t){for(var i,e=new R(0,0),r=C(this.metroGraphData.MetroNodeInfosOfNode(t));!(i=r()).done;){var h=i.value,c=h.Metroline,p=h.PolyPoint.prev.point,y=h.PolyPoint.next.point.sub(t.Position),m=p.sub(t.Position);e=(e=e.add(y.div(y.length*c.IdealLength))).add(m.div(m.length*c.IdealLength))}return e.mul(this.bundlingSettings.PathLengthImportance)},s.BuildForceForRadius=function(t){var e=new R(0,0),r=t.cachedIdealRadius,i={touchedObstacles:[]};if(!this.metroGraphData.looseIntersections.HubAvoidsObstaclesSPNBA(t,t.Position,r,i))throw bo.ShowHubs(this.metroGraphData,null,t,"./tmp/hubs.svg",[xt.mkDebugCurveTWCI(255,1,"Brown",Po.containingPoly),xt.mkDebugCurveTWCI(100,1,"Blue",te.mkCircle(r,t.Position))]),new Error;for(var f,c=C(i.touchedObstacles);!(f=c()).done;){var p=f.value,m=2*(1-p[1].sub(t.Position).length/r),P=t.Position.sub(p[1]).normalize();e=e.add(P.mul(m))}return e.mul(this.bundlingSettings.HubRepulsionImportance)},s.BuildForceForBundle=function(t){for(var i,e=new R(0,0),r=C(t.Neighbors);!(i=r()).done;)for(var m,h=i.value,c=this.metroGraphData.GetWidthSSN(t,h,this.bundlingSettings.EdgeSeparation),f={closestDist:[]},y=(this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(t,h,t.Position,h.Position,c/2,f),C(f.closestDist));!(m=y()).done;){var P=m.value,E=2*(1-P[0].sub(P[1]).length/(c/2)),S=P[0].sub(P[1]).normalize().neg();e=e.add(S.mul(E))}return e.mul(this.bundlingSettings.BundleRepulsionImportance)},l}();Sr.MaxIterations=100,Sr.MaxStep=50,Sr.MinStep=1,Sr.MinRelativeChange=5e-4;var $f=function(){function l(o,t){this.metroGraphData=o,this.bundlingSettings=t}l.FixRouting=function(t,e){var r=new l(t,e);r.GlueConflictingStations(),r.UnglueEdgesFromBundleToSaveInk(!0);for(var i=0;++i<10;){var c=r.GlueConflictingStations();if(c||(c=r.RelaxConstrainedEdges()),c||(c=i<=3&&r.UnglueEdgesFromBundleToSaveInk(!1)),c||(c=r.GlueCollinearNeighbors(i)),c||(c=3===i&&r.RemoveDoublePathCrossings()),!c)break}for(t.cdtIntersections.ComputeForcesForBundles=!0,r.RemoveDoublePathCrossings(),r.UnglueEdgesFromBundleToSaveInk(!0);r.GlueConflictingStations(););t.Initialize(!0)};var s=l.prototype;return s.GlueConflictingStations=function(){var t=this,e=this.GetCirclesHierarchy();if(null==e)return!1;var r=new Map,i=new Set;if(le(e,e,function(E,S){return t.TryToGlueStations(E,S,r,i)}),0===r.size)return!1;for(var h=0;h<this.metroGraphData.Edges.length;h++)this.RegenerateEdge(r,h);for(var p,c=new qt,f=C(i);!(p=f()).done;){var y=p.value;c.add(y.Position);for(var P,m=C(y.Neighbors);!(P=m()).done;){var L=P.value;L.IsReal||c.add(L.Position)}}return this.metroGraphData.Initialize(!1),Sr.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,c),!0},s.GetCirclesHierarchy=function(){for(var e,t=C(this.metroGraphData.VirtualStations());!(e=t()).done;){var r=e.value;r.Radius=this.GetCurrentHubRadius(r)}return Ht(this.metroGraphData.VirtualStations().map(function(c){var f=c.Position,p=Math.max(c.Radius,5),y=new R(p,p);return Qt(c,lt.mkPP(f.add(y),f.sub(y)))}))},s.GetCurrentHubRadius=function(t){if(t.IsReal)return t.BoundaryCurve.boundingBox.diagonal/2;for(var h,r=this.metroGraphData.looseIntersections.GetMinimalDistanceToObstacles(t,t.Position,t.cachedIdealRadius),i=C(t.Neighbors);!(h=i()).done;)r=Math.min(r,t.Position.sub(h.value.Position).length);return r},s.TryToGlueStations=function(t,e,r,i){if(!Ui(t.getELP(),e.getELP()))return!1;t.Position.sub(e.Position).length>=Math.max(t.Radius,5)+Math.max(e.Radius,5)||this.TryGlueOrdered(t,e,i,r)||this.TryGlueOrdered(e,t,i,r)},s.TryGlueOrdered=function(t,e,r,i){return!(i.has(t)||r.has(t)||!this.StationGluingIsAllowed(t,e,i)||(this.Map(t,e,r,i),0))},s.Map=function(t,e,r,i){i.set(t,e),r.add(e)},s.StationGluingIsAllowed=function(t,e,r){for(var h,i=C(t.Neighbors);!(h=i()).done;){var f=l.Glued(h.value,r),p=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(f,t);if(!this.metroGraphData.cdtIntersections.EdgeIsLegalSSPPS(f,e,p))return!1}return!(this.ComputeCostDeltaAfterStationGluing(t,e,r)<0)},s.ComputeCostDeltaAfterStationGluing=function(t,e,r){var i=t.Position.sub(e.Position).length;if(t.Radius>=i||e.Radius>=i)return 1;for(var y,h=0,c=this.metroGraphData.Ink,f=this.metroGraphData.Ink-e.Position.sub(t.Position).length,p=C(t.Neighbors);!(y=p()).done;){var P=l.Glued(y.value,r);f-=P.Position.sub(t.Position).length,f+=0===this.metroGraphData.RealEdgeCount(P,e)?P.Position.sub(e.Position).length:0}h+=Se.InkError(c,f,this.bundlingSettings);for(var E,L=C(this.metroGraphData.MetroNodeInfosOfNode(t));!(E=L()).done;){var S=E.value,T=S.Metroline.Length,O=S.Metroline.Length,x=S.PolyPoint,B=x.prev,M=x.next;O-=B.point.sub(t.Position).length+M.point.sub(t.Position).length,O+=B.point.sub(e.Position).length+M.point.sub(e.Position).length,h+=Se.PathLengthsError(T,O,S.Metroline.IdealLength,this.bundlingSettings)}return h},s.RegenerateEdge=function(t,e){for(var c,r=this,i=this.metroGraphData.Metrolines[e].Polyline,h=C(i);!(c=h()).done;)if(!this.metroGraphData.PointToStations.has(c.value))return;for(var m,p=!1,y=C(i);!(m=y()).done;)if(t.has(this.metroGraphData.PointToStations.get(m.value))){p=!0;break}if(p){var L=Array.from(i).map(function(E){return r.metroGraphData.PointToStations.get(E)});this.metroGraphData.Edges[e].curve=vt.mkFromPoints(l.GluedPolyline(L,t))}},l.GluedPolyline=function(t,e){var r,i=new jt.K;i.push(t[0]);var h=new Set;for(r=1;r<t.length-1;r++){var c=l.Glued(t[r],e);if(h.has(c))for(;i.top!==c;)h.delete(i.pop());else R.closeDistEps(c.Position,i.top.Position)||(h.add(c),i.push(c))}return i.push(t[r]),Array.from(i).reverse().map(function(f){return f.Position})},l.Glued=function(t,e){var r;return null!==(r=e.get(t))&&void 0!==r?r:t},s.UnglueEdgesFromBundleToSaveInk=function(t){var e=new li;this.ink=this.metroGraphData.Ink,this.polylineLength=new Map;for(var i,r=C(this.metroGraphData.Metrolines);!(i=r()).done;){var h=i.value;this.polylineLength.set(h,h.Length);for(var c=h.Polyline.startPoint;null!=c.next;c=c.next)Ts(e,new ue(c.point,c.next.point),h)}for(var P,p=new qt,y=!1,m=C(this.metroGraphData.Metrolines);!(P=m()).done;){var L=P.value,E=Or(this.metroGraphData.PointToStations.get(L.Polyline.start).getELP(),this.metroGraphData.PointToStations.get(L.Polyline.end).getELP());this.TrySeparateOnPolyline(L,e,p,E)&&(y=!0)}return y&&this.metroGraphData.Initialize(!1),(t||y)&&Sr.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,t?null:p),y},s.TrySeparateOnPolyline=function(t,e,r,i){for(var h=!1,c=!0;c;){c=!1;for(var f=t.Polyline.startPoint;null!=f.next&&null!=f.next.next;f=f.next)this.TryShortcutPolypoint(f,e,r,i)&&(c=!0);c&&(h=!0)}return h},s.TryShortcutPolypoint=function(t,e,r,i){return!!this.SeparationShortcutAllowed(t,e,i)&&(r.add(t.point),r.add(t.next.point),r.add(t.next.next.point),this.RemoveShortcuttedPolypoint(t,e),!0)},s.SeparationShortcutAllowed=function(t,e,r){var i=t.point,h=t.next.point,c=t.next.next.point,f=this.metroGraphData.PointToStations.get(i),p=this.metroGraphData.PointToStations.get(h),y=this.metroGraphData.PointToStations.get(c),m=On(f.getELP(),y.getELP()),P=function(l){if(0===l.length)return new Set;for(var s=l[0],o=1;o<l.length;o++)s=Or(s,l[o]);return s}([r,p.getELP(),m]);return!(!this.metroGraphData.cdtIntersections.EdgeIsLegalSSPPS(f,y,P)||this.GetInkgain(t,e,i,h,c)<0)},s.GetInkgain=function(t,e,r,i,h){var c=this.FindPolylines(t,e),f=c[0],p=c[1],y=c[2],m=0,P=this.ink,L=this.ink,E=r.sub(i).length,S=i.sub(h).length,T=r.sub(h).length;f.size===y.size&&(L-=E),p.size===y.size&&(L-=S);var O=e.get(new ue(r,h));(!O||0===O.size)&&(L+=T),m+=Se.InkError(P,L,this.bundlingSettings);for(var B,x=C(y);!(B=x()).done;){var M=B.value,F=this.polylineLength.get(M);m+=Se.PathLengthsError(F,F-(E+S-T),M.IdealLength,this.bundlingSettings)}var z=this.GetCurrentHubRadius(this.metroGraphData.PointToStations.get(r)),V=this.metroGraphData.GetWidthAN(Array.from(y),this.bundlingSettings.EdgeSeparation),Y=this.metroGraphData.GetWidthAN(Array.from(Tn(f,y)),this.bundlingSettings.EdgeSeparation),W=_r.GetMinRadiusForTwoAdjacentBundlesNPPPNNB(z,r,h,i,V,Y,this.bundlingSettings);W>z&&(m-=Se.RError(W,z,this.bundlingSettings)),z=this.GetCurrentHubRadius(this.metroGraphData.PointToStations.get(h));var _=this.metroGraphData.GetWidthAN(Array.from(Tn(p,y)),this.bundlingSettings.EdgeSeparation);return(W=_r.GetMinRadiusForTwoAdjacentBundlesNPPPNNB(z,h,i,r,_,V,this.bundlingSettings))>z&&(m-=Se.RError(W,z,this.bundlingSettings)),m},s.RemoveShortcuttedPolypoint=function(t,e){var r=t.point,i=t.next.point,h=t.next.next.point,c=this.FindPolylines(t,e),f=c[0],p=c[1],y=c[2],m=At(r,i),P=At(i,h),L=At(r,h);f.size===y.size&&(this.ink-=m),p.size===y.size&&(this.ink-=P);var E=e.get(new ue(r,h));(!E||0===E.size)&&(this.ink+=L);for(var T,S=C(y);!(T=S()).done;){var O=T.value,x=this.polylineLength.get(O);this.polylineLength.set(O,x-(m+P-L))}for(var M,B=C(y);!(M=B()).done;){var F=M.value,A=Array.from(F.Polyline.polylinePoints()).find(function(z){return z.point.equal(i)});this.RemovePolypoint(A),Os(e,[r,i],F),Os(e,[i,h],F),ah(e,[r,h],F)}},s.FindPolylines=function(t,e){var i=t.next.point,h=t.next.next.point,c=e.getPP(t.point,i),f=e.getPP(i,h);return[c,f,Or(c,f)]},s.RemovePolypoint=function(t){var e=t.prev,r=t.next;e.next=r,r.prev=e},s.GlueCollinearNeighbors=function(t){for(var h,e=new qt,r=!1,i=C(this.metroGraphData.Stations);!(h=i()).done;)this.GlueCollinearNeighborsSPN(h.value,e,t)&&(r=!0);return r&&(this.metroGraphData.Initialize(!1),Sr.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,e)),r},s.GlueCollinearNeighborsSPN=function(t,e,r){if(t.Neighbors.length<=1)return!1;for(var i=new dl,h=t.Neighbors,c=0;c<h.length;c++)this.TryToGlueEdges(t,h[c],h[(c+1)%h.length],i,r);if(i.isEmpty)return!1;for(var p,f=C(i);!(p=f()).done;){var y=p.value;this.GlueEdge(y),e.add(y[0].Position),e.add(y[1].Position),e.add(y[2])}return!0},s.TryToGlueEdges=function(t,e,r,i,h){if(R.anglePCP(e.Position,t.Position,r.Position)<this.bundlingSettings.AngleThreshold){var f=At(e.Position,t.Position),p=At(r.Position,t.Position),y=Math.min(f,p)/Math.max(f,p);if(y<.05)return;if(f<p){if(this.EdgeGluingIsAllowedSSS(t,e,r))return void this.AddEdgeToGlue(t,r,e,e.Position,i)}else if(this.EdgeGluingIsAllowedSSS(t,r,e))return void this.AddEdgeToGlue(t,e,r,r.Position,i);if(h<5&&y>.5){var m=this.ConstructGluingPoint(t,e,r);this.EdgeGluingIsAllowedSSSP(t,e,r,m)&&this.AddEdgeToGlue(t,r,e,m,i)}}},s.ConstructGluingPoint=function(t,e,r){var i=Math.min(At(e.Position,t.Position),At(r.Position,t.Position)/2),h=e.Position.sub(t.Position).normalize().add(r.Position.sub(t.Position).normalize());return t.Position.add(h.mul(i/2))},s.EdgeGluingIsAllowedSSS=function(t,e,r){if(e.IsReal||r.IsReal||!Ui(e.getELP(),r.getELP())||!this.metroGraphData.cdtIntersections.EdgeIsLegal(e,r,e.Position,r.Position))return!1;var i=this.metroGraphData.looseIntersections.ObstaclesToIgnoreForBundle(t,r);return!(na.IntersectionsOfLineAndRectangleNodeOverPolylineLR(Z.mkPP(t.Position,e.Position),this.metroGraphData.LooseTree).find(function(p){return!i.has(p.seg1)})||na.IntersectionsOfLineAndRectangleNodeOverPolylineLR(Z.mkPP(e.Position,r.Position),this.metroGraphData.LooseTree).find(function(p){return!i.has(p.seg1)})||this.ComputeCostDeltaAfterEdgeGluing(t,e,r,e.Position)<0)},s.EdgeGluingIsAllowedSSSP=function(t,e,r,i){return!(!(this.metroGraphData.looseIntersections.HubAvoidsObstaclesPNS__(i,0,Or(e.getELP(),r.getELP()))&&this.metroGraphData.cdtIntersections.EdgeIsLegal(t,null,t.Position,i)&&this.metroGraphData.cdtIntersections.EdgeIsLegal(e,null,e.Position,i)&&this.metroGraphData.cdtIntersections.EdgeIsLegal(r,null,r.Position,i))||this.ComputeCostDeltaAfterEdgeGluing(t,e,r,i)<0)},s.ComputeCostDeltaAfterEdgeGluing=function(t,e,r,i){var h=0,c=this.metroGraphData.Ink,f=this.metroGraphData.Ink-At(t.Position,r.Position)-At(t.Position,e.Position)+At(t.Position,i)+At(i,e.Position)+At(i,r.Position);h+=Se.InkError(c,f,this.bundlingSettings);for(var y,p=C(this.metroGraphData.GetIjInfo(t,r).Metrolines);!(y=p()).done;){var m=y.value,P=m.Length,L=m.Length-At(t.Position,r.Position)+At(t.Position,i)+At(i,r.Position);h+=Se.PathLengthsError(P,L,m.IdealLength,this.bundlingSettings)}for(var S,E=C(this.metroGraphData.GetIjInfo(t,e).Metrolines);!(S=E()).done;){var T=S.value,O=T.Length,x=T.Length-At(t.Position,e.Position)+At(t.Position,i)+At(i,e.Position);h+=Se.PathLengthsError(O,x,T.IdealLength,this.bundlingSettings)}var B=t.cachedIdealRadius,M=this.GetCurrentHubRadius(t),F=_r.GetMinRadiusForTwoAdjacentBundles(M,t,t.Position,e,r,this.metroGraphData,this.bundlingSettings);return F>M&&(h+=Se.RError(F,M,this.bundlingSettings)),B>At(t.Position,i)&&!t.IsReal&&(h-=Se.RError(B,At(t.Position,i),this.bundlingSettings)),h},s.AddEdgeToGlue=function(t,e,r,i,h){h.has(r,t)||h.has(e,t)||h.has(t,r)||h.has(t,e)||(h.set(t,r,i),h.set(t,e,i))},s.GlueEdge=function(t){for(var c,r=t[1],i=t[2],h=C(t[0].MetroNodeInfos.map(function(p){return p.PolyPoint}));!(c=h()).done;){var f=c.value;null!=f.next&&f.next.point.equal(r.Position)?this.SplitPolylinePoint(f,i):null!=f.prev&&f.prev.point.equal(r.Position)&&this.SplitPolylinePoint(f.prev,i)}},s.SplitPolylinePoint=function(t,e){if(t.point!==e&&t.next.point!==e){var r=nr.mkFromPoint(e);r.polyline=t.polyline,r.next=t.next,r.prev=t,r.next.prev=r,r.prev.next=r}},s.RelaxConstrainedEdges=function(){for(var i,t=new qt,e=!1,r=C(this.metroGraphData.VirtualEdges());!(i=r()).done;){var h=i.value;this.RelaxConstrainedEdge(h[0],h[1],t)&&(e=!0)}return e&&(this.metroGraphData.Initialize(!1),Sr.FixRoutingMBP(this.metroGraphData,this.bundlingSettings,t)),e},s.RelaxConstrainedEdge=function(t,e,r){var i=this.metroGraphData.GetWidthSSN(t,e,this.bundlingSettings.EdgeSeparation),h={closestDist:new Array};this.metroGraphData.cdtIntersections.BundleAvoidsObstacles(t,e,t.Position,e.Position,.99*i/2,h);var c=h.closestDist;if(c.length>0){for(var p,m,f=-1,y=C(c);!(m=y()).done;){var P=m.value;if(!(Math.min(At(t.Position,P[1]),At(e.Position,P[1]))/At(t.Position,e.Position)<.1)){var T=At(P[0],P[1]);(-1===f||T<f)&&(f=T,p=P[1])}}if(-1===f||!this.metroGraphData.looseIntersections.HubAvoidsObstaclesPNS__(p,0,Or(t.getELP(),e.getELP())))return!1;r.add(p),r.add(t.Position),r.add(e.Position);for(var x,O=C(this.metroGraphData.GetIjInfo(t,e).Metrolines);!(x=O()).done;){for(var A,M=null,F=C(x.value.Polyline.polylinePoints());!(A=F()).done;){var z=A.value;if(z.point.equal(t.Position)){M=z;break}}null!=M.next&&M.next.point.equal(e.Position)?this.SplitPolylinePoint(M,p):this.SplitPolylinePoint(M.prev,p)}return!0}return!1},s.RemoveDoublePathCrossings=function(){var t=new Xa(this.metroGraphData,this.metroGraphData.PointIsAcceptableForEdge.bind(this)).run();return t&&(this.metroGraphData.Initialize(!1),Sr.FixRouting(this.metroGraphData,this.bundlingSettings)),t},l}(),Jf=function(){function l(o,t,e){this.upperBound=Number.POSITIVE_INFINITY,this._visGraph=e,e.ClearPrevEdgesTable();for(var i,r=C(e.Vertices());!(i=r()).done;)i.value.Distance=Number.POSITIVE_INFINITY;this.sources=o,this.targets=new Set(t)}var s=l.prototype;return s.GetPath=function(){for(var r,t=new Gr,e=C(this.sources);!(r=e()).done;){var i=r.value;i.Distance=0,t.Enqueue(i,0)}for(;!t.IsEmpty()&&(this._current=t.Dequeue(),!this.targets.has(this._current));){for(var c,h=C(this._current.OutEdges);!(c=h()).done;){var f=c.value;this.PassableOutEdge(f)&&this.ProcessNeighbor(t,f,f.Target)}for(var y,p=C(this._current.InEdges.filter(this.PassableInEdge.bind));!(y=p()).done;){var m=y.value;this.ProcessNeighbor(t,m,m.Source)}}return null==this._visGraph.PreviosVertex(this._current)?null:this.CalculatePath()},s.PassableOutEdge=function(t){return this.targets.has(t.Target)||!l.IsForbidden(t)},s.PassableInEdge=function(t){return this.targets.has(t.Source)||!l.IsForbidden(t)},l.IsForbidden=function(t){return(null!=t.IsPassable&&!t.IsPassable()||t)instanceof Ar},s.ProcessNeighbor=function(t,e,r){var h=this._current.Distance+e.Length;h>=this.upperBound||(this.targets.has(r)&&(this.upperBound=h,this.closestTarget=r),null==this._visGraph.PreviosVertex(r)?(r.Distance=h,this._visGraph.SetPreviousEdge(r,e),t.Enqueue(r,h)):h<r.Distance&&(r.Distance=h,this._visGraph.SetPreviousEdge(r,e),t.DecreasePriority(r,h)))},s.CalculatePath=function(){if(null==this.closestTarget)return null;var t=new Array,e=this.closestTarget;do{t.push(e),e=this._visGraph.PreviosVertex(e)}while(e.Distance>0);return t.push(e),t.reverse()},l}(),Gi=function(l){function s(t,e,r,i,h,c,f,p,y,m){var P;return(P=l.call(this,null)||this).bundlingSettings=i,P.bundlingSettings.edgeWidthShrinkCoeff=1,P.edgesToRoute=t,P.regularEdges=t.filter(function(L){return L.source!==L.target}),P.VisibilityGraph=r,P.shortestPathRouter=e,P.LoosePadding=h,P.LooseHierarchy=f,P.TightHierarchy=c,P.EdgeLooseEnterable=p,P.EdgeTightEnterable=y,P.loosePolylineOfPort=m,to(0),P}X(s,l);var o=s.prototype;return o.ThereAreOverlaps=function(e){return Re(e,e,K.CurvesIntersect)},o.run=function(){this.ThereAreOverlaps(this.TightHierarchy)?this.Status=Ua.Overlaps:(this.FixLocationsForHookAnywherePorts(this.edgesToRoute),this.RoutePathsWithSteinerDijkstra(),this.FixChildParentEdges(),this.bundlingSettings.StopAfterShortestPaths||this.OrderOptimizeNudgeEtc(),this.RouteSelfEdges(),this.FixArrowheads())},o.OrderOptimizeNudgeEtc=function(){var e=new Hf(this.regularEdges,this.LooseHierarchy,this.TightHierarchy,this.bundlingSettings,this.shortestPathRouter.cdt,this.EdgeLooseEnterable,this.EdgeTightEnterable,this.loosePolylineOfPort);$f.FixRouting(e,this.bundlingSettings),new bo(e,this.bundlingSettings).run()},o.FixChildParentEdges=function(){for(var r,e=C(this.regularEdges);!(r=e()).done;){var i=r.value,h=i.sourcePort,c=i.targetPort;if(h.Curve.boundingBox.containsRect(c.Curve.boundingBox)){var f=K.intersectionOne(h.Curve,Z.mkPP(i.curve.start,i.curve.end),!1);i.curve.startPoint.point=f.x}if(c.Curve.boundingBox.containsRect(h.Curve.boundingBox)){var y=K.intersectionOne(c.Curve,Z.mkPP(i.curve.start,i.curve.end),!0);i.curve.endPoint.point=y.x}}},o.FixLocationsForHookAnywherePorts=function(e){for(var i,r=C(e);!(i=r()).done;){var h=i.value,c=h.sourcePort instanceof Le;if(c){var f=h.sourcePort;f.SetLocation(this.FigureOutHookLocation(f.LoosePolyline,h.targetPort,h))}else if(c=h.targetPort instanceof Le){var p=h.targetPort;p.SetLocation(this.FigureOutHookLocation(p.LoosePolyline,h.sourcePort,h))}}},o.FigureOutHookLocation=function(e,r,i){return r instanceof Je?this.FigureOutHookLocationForClusterOtherPort(e,r,i):this.FigureOutHookLocationForSimpleOtherPort(e,r,i)},o.FigureOutHookLocationForClusterOtherPort=function(e,r,i){for(var y,h=this.shortestPathRouter.MakeTransparentShapesOfEdgeGeometry(i),f=new Jf(Array.from(r.LoosePolyline).map(this.VisibilityGraph.FindVertex.bind),Array.from(e).map(this.VisibilityGraph.FindVertex.bind),this.VisibilityGraph).GetPath(),p=C(h);!(y=p()).done;)y.value.IsTransparent=!1;return f[f.length-1].point},o.FigureOutHookLocationForSimpleOtherPort=function(e,r,i){for(var P,h=this,c=r.Location,f=this.shortestPathRouter.MakeTransparentShapesOfEdgeGeometry(i),y=new Qs(this.VisibilityGraph.FindVertex(c),Array.from(e).map(function(E){return h.VisibilityGraph.FindVertex(E)}),this.VisibilityGraph).GetPath(),m=C(f);!(P=m()).done;)P.value.IsTransparent=!1;return y[y.length-1].point},o.RoutePathsWithSteinerDijkstra=function(){this.shortestPathRouter.VisibilityGraph=this.VisibilityGraph,this.shortestPathRouter.BundlingSettings=this.bundlingSettings,this.shortestPathRouter.geomEdges=this.regularEdges,this.shortestPathRouter.ObstacleHierarchy=this.LooseHierarchy,this.shortestPathRouter.RouteEdges(),null!=this.shortestPathRouter.cdt&&this.AdjustEdgeSeparation()},o.AdjustEdgeSeparation=function(){var e=new Map;this.shortestPathRouter.FillCrossedCdtEdges(e);var r=this.GetPathsOnCdtEdge(e);this.bundlingSettings.edgeWidthShrinkCoeff=this.CalculateEdgeWidthShrinkCoeff(r)},o.GetPathsOnCdtEdge=function(e){for(var h,r=new Map,i=C(e.keys());!(h=i()).done;)for(var p,c=h.value,f=C(e.get(c));!(p=f()).done;)Yi(r,p.value,c);return r},o.CalculateEdgeWidthShrinkCoeff=function(e){var r=0,i=this.bundlingSettings.edgeWidthShrinkCoeff;if(this.EdgeSeparationIsOkMN(e,i))return i;for(var h=!1;!h||Math.abs(i-r)>.01;){var c=(r+i)/2;this.EdgeSeparationIsOkMN(e,c)?(r=c,h=!0):i=c}return r},o.EdgeSeparationIsOkMN=function(e,r){for(var h,i=C(e.keys());!(h=i()).done;){var c=h.value;if(!this.EdgeSeparationIsOk(c,e.get(c),r))return!1}return!0},o.EdgeSeparationIsOk=function(e,r,i){var h=this;return Array.from(r).map(function(f){return h.bundlingSettings.ActualEdgeWidth(f,i)}).reduce(function(f,p){return f+p},0)<=e.Capacity},o.RouteSelfEdges=function(){for(var r,e=C(this.edgesToRoute);!(r=e()).done;){var i=r.value;i.source===i.target&&(i.curve=sr.RouteSelfEdge(i.source.boundaryCurve,2*this.LoosePadding,{smoothedPolyline:null}))}},o.FixArrowheads=function(){for(var r,e=C(this.edgesToRoute);!(r=e()).done;){var i=r.value;vr.trimSplineAndCalculateArrowheadsII(i,i.source.boundaryCurve,i.target.boundaryCurve,i.curve,!1)}},s}(Vt);Gi.SuperLoosePaddingCoefficient=1.1;var Zf=function(){function l(o,t,e){this.numberOfPassedPaths=0,this.VisibilityEdge=o,this.Source=t,this.Target=e}var s=l.prototype;return s.AddOccupiedEdge=function(){this.numberOfPassedPaths++},s.RemoveOccupiedEdge=function(){this.numberOfPassedPaths--},Q(l,[{key:"TargetPoint",get:function(){return this.Target.Point}},{key:"SourcePoint",get:function(){return this.Source.Point}},{key:"IsOccupied",get:function(){return this.numberOfPassedPaths>0}},{key:"IsPassable",get:function(){return this.Target.IsTargetOfRouting||this.Source.IsSourceOfRouting||null==this.VisibilityEdge.IsPassable||this.VisibilityEdge.IsPassable()}}]),l}(),Kf=function(){function l(o){this.InBoneEdges=new Array,this.OutBoneEdges=new Array,this.VisibilityVertex=o}return l.prototype.SetPreviousToNull=function(){this.PrevEdge=null},Q(l,[{key:"Prev",get:function(){return null==this.PrevEdge?null:this.PrevEdge.Source===this?this.PrevEdge.Target:this.PrevEdge.Source}},{key:"Point",get:function(){return this.VisibilityVertex.point}},{key:"Cost",get:function(){return this.IsSourceOfRouting?this.cost:null==this.Prev?Number.POSITIVE_INFINITY:this.cost},set:function(t){this.cost=t}}]),l}(),yl=function(){function l(o,t,e){this.EdgesToRoutes=new Map,this.EdgesToRouteSources=new Map,this.MakeTransparentShapesOfEdgeGeometry=o,this.cdt=t,this.Gates=e}var s=l.prototype;return s.CreateGraphElements=function(){for(var e,t=C(this.vertexArray);!(e=t()).done;)for(var c,r=e.value,h=C(r.VisibilityVertex.InEdges);!(c=h()).done;){var f=c.value,p=new Zf(f,this.VisibilityVerticesToSdVerts.get(f.Source),this.VisibilityVerticesToSdVerts.get(f.Target)),y=this.VisibilityVerticesToSdVerts.get(f.Source);r.InBoneEdges.push(p),y.OutBoneEdges.push(p)}},s.CreateRoutingGraph=function(){this.vertexArray=[],this.VisibilityVerticesToSdVerts=new Map;for(var e,t=C(this.VisibilityGraph.Vertices());!(e=t()).done;){var r=e.value,i=new Kf(r);this.vertexArray.push(i),this.VisibilityVerticesToSdVerts.set(r,i)}this.CreateGraphElements()},s.RouteEdges=function(){this.Initialize(),this.RestoreCapacities();for(var e,t=C(this.geomEdges);!(e=t()).done;){var r=e.value;this.EdgesToRoutes.set(r,this.RouteEdge(r))}this.RerouteEdges();for(var h,i=C(this.geomEdges);!(h=i()).done;)this.SetEdgeGeometryCurve(h.value)},s.SetEdgeGeometryCurve=function(t){var e=new vt,r=this.EdgesToRouteSources.get(t);e.addPoint(r.Point);for(var h,i=C(this.EdgesToRoutes.get(t));!(h=i()).done;){var c=h.value;c.SourcePoint.equal(r.Point)?(e.addPoint(c.TargetPoint),r=c.Target):(e.addPoint(c.SourcePoint),r=c.Source)}t.curve=e,t.sourcePort instanceof Je&&l.ExtendPolylineStartToClusterBoundary(e,t.sourcePort.Curve),t.targetPort instanceof Je&&l.ExtendPolylineEndToClusterBoundary(e,t.targetPort.Curve)},l.ExtendPolylineEndToClusterBoundary=function(t,e){var r=e.closestParameter(t.end);t.addPoint(e.value(r))},l.ExtendPolylineStartToClusterBoundary=function(t,e){var r=e.closestParameter(t.start);t.PrependPoint(e.value(r))},s.RerouteEdges=function(){this.RestoreCapacities();for(var e,t=C(this.geomEdges);!(e=t()).done;){var r=e.value,i=this.RerouteEdge(r);this.EdgesToRoutes.set(r,i)}},s.RestoreCapacities=function(){null!=this.cdt&&this.cdt.RestoreEdgeCapacities()},s.RerouteEdge=function(t){for(var i,r=C(this.EdgesToRoutes.get(t));!(i=r()).done;)i.value.RemoveOccupiedEdge();return this.RouteEdge(t)},s.RouteEdge=function(t){this.CurrentEdgeGeometry=t;for(var e=0;e<this.vertexArray.length;e++){var r=this.vertexArray[e];r.SetPreviousToNull(),r.IsTargetOfRouting=r.IsSourceOfRouting=!1}for(var f,i=this.MakeTransparentShapesOfEdgeGeometry(t),h=this.RouteEdgeWithGroups(),c=C(i);!(f=c()).done;)f.value.IsTransparent=!1;return h},s.RouteEdgeWithGroups=function(){for(var t=0;t<2;t++){this.SetLengthCoefficient(),this.Queue=new Gr,this.sourceLoosePoly=this.SetPortVerticesAndObstacles(this.CurrentEdgeGeometry.sourcePort,!0),this.targetLoosePoly=this.SetPortVerticesAndObstacles(this.CurrentEdgeGeometry.targetPort,!1);var e=this.RouteOnKnownSourceTargetVertices(this.CurrentEdgeGeometry.targetPort.Location.sub(this.CurrentEdgeGeometry.sourcePort.Location).normalize(),0===t);if(null!=e)return e;for(var r=0;r<this.vertexArray.length;r++)this.vertexArray[r].SetPreviousToNull()}throw new Error},s.RouteOnKnownSourceTargetVertices=function(t,e){for(this.LowestCostToTarget=Number.POSITIVE_INFINITY,this.ClosestTargetVertex=null;this.Queue.count>0;){var r={priority:0},i=this.Queue.DequeueAndGetPriority(r);if(!(r.priority>=this.LowestCostToTarget)){for(var h=0;h<i.OutBoneEdges.length;h++){var c=i.OutBoneEdges[h];c.IsPassable&&this.ProcessOutcomingBoneEdge(i,c,t,e)}for(var f=0;f<i.InBoneEdges.length;f++){var p=i.InBoneEdges[f];p.IsPassable&&this.ProcessIncomingBoneEdge(i,p,t,e)}}}return this.GetPathAndUpdateRelatedCosts()},s.ProcessOutcomingBoneEdge=function(t,e,r,i){i&&r.dot(e.TargetPoint.sub(e.SourcePoint))<0||this.ProcessBoneEdge(t,e.Target,e)},s.ProcessIncomingBoneEdge=function(t,e,r,i){i&&r.dot(e.SourcePoint.sub(e.TargetPoint))<0||this.ProcessBoneEdge(t,e.Source,e)},s.ProcessBoneEdge=function(t,e,r){var i=this.GetEdgeAdditionalCost(r,t.Cost);if(!(e.Cost<=i))if(e.Cost=i,e.PrevEdge=r,this.Queue.ContainsElement(e))this.Queue.DecreasePriority(e,i);else{if(e.IsTargetOfRouting){var h=0;return this.CurrentEdgeGeometry.targetPort instanceof Je&&(h=this.LengthCoefficient*e.Point.sub(this.CurrentEdgeGeometry.targetPort.Location).length),void(i+h<this.LowestCostToTarget&&(this.LowestCostToTarget=i+h,this.ClosestTargetVertex=e))}this.Enqueue(e)}},s.GetPathAndUpdateRelatedCosts=function(){var t=this.ClosestTargetVertex;if(null==t)return null;for(var e=new Array;null!=t.PrevEdge;)e.push(t.PrevEdge),this.RegisterPathInBoneEdge(t.PrevEdge),t=t.Prev;return this.EdgesToRouteSources.set(this.CurrentEdgeGeometry,t),e.reverse(),e},s.RegisterPathInBoneEdge=function(t){t.AddOccupiedEdge(),null!=this.cdt&&0!==this.BundlingSettings.CapacityOverflowCoefficient&&this.UpdateResidualCostsOfCrossedCdtEdges(t)},s.UpdateResidualCostsOfCrossedCdtEdges=function(t){for(var r,e=C(t.CrossedCdtEdges);!(r=e()).done;){var i=r.value;this.AdjacentToSourceOrTarget(i)||(i.ResidualCapacity-=i.ResidualCapacity===i.Capacity?this.BundlingSettings.edgeWidthShrinkCoeff*this.CurrentEdgeGeometry.lineWidth:this.BundlingSettings.ActualEdgeWidth(this.CurrentEdgeGeometry))}},s.H=function(t){return t.Cost+this.LengthCoefficient*t.Point.sub(this.CurrentEdgeGeometry.targetPort.Location).length},s.GetEdgeAdditionalCost=function(t,e){var r=t.TargetPoint.sub(t.SourcePoint).length;return this.LengthCoefficient*r+e+(t.IsOccupied?0:this.BundlingSettings.InkImportance*r)+this.CapacityOverflowCost(t)},s.CapacityOverflowCost=function(t){if(null==this.cdt||0===this.BundlingSettings.CapacityOverflowCoefficient)return 0;for(var i,e=0,r=C(this.CrossedCdtEdgesOfBoneEdge(t));!(i=r()).done;)e+=this.CostOfCrossingCdtEdgeLocal(this.capacityOverlowPenaltyMultiplier,this.BundlingSettings,this.CurrentEdgeGeometry,i.value);return e},s.CrossedCdtEdgesOfBoneEdge=function(t){return Array.from(null!=t.CrossedCdtEdges?t.CrossedCdtEdges:t.CrossedCdtEdges=this.ThreadBoneEdgeThroughCdt(t))},s.ThreadBoneEdgeThroughCdt=function(t){var e=t.SourcePoint,r=t.Source.Triangle,i=new Set,h=t.TargetPoint;if(Ne.PointIsInsideOfTriangle(h,r))return i;for(var c=new wo(r,e,h);c.MoveNext();){var f=c.CurrentPiercedEdge;this.Gates.has(f)&&i.add(f)}return i},l.CostOfCrossingCdtEdge=function(t,e,r,i){var h=r.lineWidth*e.edgeWidthShrinkCoeff;i.Capacity!==i.ResidualCapacity&&(h+=e.EdgeSeparation*e.edgeWidthShrinkCoeff);var c=i.ResidualCapacity-h;return c>=0?0:-c*t},s.CostOfCrossingCdtEdgeLocal=function(t,e,r,i){return this.AdjacentToSourceOrTarget(i)?0:l.CostOfCrossingCdtEdge(t,e,r,i)},s.AdjacentToSourceOrTarget=function(t){return t.upperSite.Owner===this.sourceLoosePoly||t.lowerSite.Owner===this.sourceLoosePoly||t.upperSite.Owner===this.targetLoosePoly||t.lowerSite.Owner===this.targetLoosePoly},s.SetLengthCoefficient=function(){var t=this.GetIdealDistanceBetweenSourceAndTarget(this.CurrentEdgeGeometry);this.LengthCoefficient=this.BundlingSettings.PathLengthImportance/t},s.GetIdealDistanceBetweenSourceAndTarget=function(t){return t.sourcePort.Location.sub(t.targetPort.Location).length},s.SetPortVerticesAndObstacles=function(t,e){var r;if(t instanceof Je)for(var c,h=C(r=t.LoosePolyline);!(c=h()).done;){var f=c.value,p=0;e&&(p=this.LengthCoefficient*f.sub(this.CurrentEdgeGeometry.sourcePort.Location).length),this.AddAndEnqueueVertexToEnds(f,e,p)}else if(t instanceof Le)for(var P,m=C(r=t.LoosePolyline);!(P=m()).done;)this.AddAndEnqueueVertexToEnds(P.value,e,0);else{this.AddAndEnqueueVertexToEnds(t.Location,e,0);var E=Array.from(this.ObstacleHierarchy.GetNodeItemsIntersectingRectangle(t.Curve.boundingBox)),S=E[0].boundingBox.diagonal;r=E[0];for(var T=1;T<E.length;T++){var O=E[T],x=O.boundingBox.diagonal;x<S&&(S=x,r=O)}}return r},s.Enqueue=function(t){this.Queue.Enqueue(t,this.H(t))},s.AddAndEnqueueVertexToEnds=function(t,e,r){var i=this.FindVertex(t),h=this.VisibilityVerticesToSdVerts.get(i);e?(h.IsSourceOfRouting=!0,h.Cost=r,this.Enqueue(h)):h.IsTargetOfRouting=!0},s.FindVertex=function(t){return this.VisibilityGraph.FindVertex(t)},s.Initialize=function(){this.CreateRoutingGraph(),null!=this.cdt&&(this.capacityOverlowPenaltyMultiplier=l.CapacityOverflowPenaltyMultiplier(this.BundlingSettings),this.SetVertexTriangles(),this.CalculateCapacitiesOfTrianglulation())},s.CalculateCapacitiesOfTrianglulation=function(){for(var e,t=C(this.Gates);!(e=t()).done;)l.CalculateCdtEdgeCapacityForEdge(e.value)},l.CalculateCdtEdgeCapacityForEdge=function(t){if(!t.constrained&&null!=t.CwTriangle&&null!=t.CcwTriangle){var e=t.upperSite.Owner,r=t.lowerSite.Owner;if(e!==r){var i=We.DistancePoint(new We(e),t.lowerSite.point),h=We.DistancePoint(new We(r),t.upperSite.point);t.Capacity=(i+h)/2}}},s.SetVertexTriangles=function(){var t=this;me(Ht(Array.from(this.cdt.GetTriangles()).map(function(i){return Qt(i,i.BoundingBox())})),Ht(this.vertexArray.map(function(i){return Qt(i,lt.mkOnPoints([i.Point]))})),function(i,h){return t.TryToAssigenTriangleToVertex(i,h)})},s.TryToAssigenTriangleToVertex=function(t,e){null==e.Triangle&&Ne.PointIsInsideOfTriangle(e.Point,t)&&(e.Triangle=t)},l.CapacityOverflowPenaltyMultiplier=function(t){return t.CapacityOverflowCoefficient*(t.PathLengthImportance+t.InkImportance)},s.FillCrossedCdtEdges=function(t){for(var r,e=C(this.geomEdges);!(r=e()).done;){var i=r.value;this.sourceLoosePoly=this.SetPortVerticesAndObstacles(i.sourcePort,!0),this.targetLoosePoly=this.SetPortVerticesAndObstacles(i.targetPort,!1);for(var c,h=C(this.EdgesToRoutes.get(i));!(c=h()).done;)for(var y,p=C(this.CrossedCdtEdgesOfBoneEdge(c.value));!(y=p()).done;){var m=y.value;this.AdjacentToSourceOrTarget(m)||Yi(t,i,m)}}},l}(),td=function(){function l(o,t,e,r,i){this.multiEdges=o,this.interactiveEdgeRouter=t,this.bundlingSettings=r,this.bundlingSettings.edgeWidthShrinkCoeff=1,this.transparentShapeSetter=i,this.nodeTree=qi(e,function(h){return h.boundingBox})}var s=l.prototype;return s.run=function(){for(var e,t=C(this.GetIndependantPreGraphs());!(e=t()).done;)new Gi(e.value.edges,new yl(this.transparentShapeSetter,null,null),this.interactiveEdgeRouter.VisibilityGraph,this.bundlingSettings,this.interactiveEdgeRouter.LoosePadding,this.interactiveEdgeRouter.TightHierarchy,this.interactiveEdgeRouter.LooseHierarchy,null,null,null).run()},s.GetPortCurve=function(t){return this.nodeTree.FirstHitNodeWithPredicate(t.Location,function(r,i){return K.PointRelativeToCurveLocation(r,i)!==ht.Outside?Ft.Stop:Ft.Continue}).UserData},s.GetIndependantPreGraphs=function(){for(var t=this.CreateInitialPregraphs();;){var e=t.length;if(this.UniteConnectedPreGraphs({preGraphs:t}),e<=t.length)break}return t},s.UniteConnectedPreGraphs=function(t){var e=l.GetIntersectionGraphOfPreGraphs(t.preGraphs);if(null!=e){for(var c,r=on(e),i=new Array,h=C(r);!(c=h()).done;)for(var m,p=null,y=C(c.value);!(m=y()).done;){var P=m.value;null==p?i.push(p=t.preGraphs[P]):p.AddGraph(t.preGraphs[P])}t.preGraphs=i;for(var E,L=C(t.preGraphs);!(E=L()).done;)this.AddIntersectingNodes(E.value)}},s.AddIntersectingNodes=function(t){for(var i,r=C(this.nodeTree.GetNodeItemsIntersectingRectangle(t.boundingBox));!(i=r()).done;)t.AddNodeBoundary(i.value)},l.GetIntersectionGraphOfPreGraphs=function(t){var e=l.EnumeratePairsOfIntersectedPreGraphs(t);return e.length?Ke(e,t.length):null},l.EnumeratePairsOfIntersectedPreGraphs=function(t){var r=qi(Array.from(Array(t.length).keys()),function(h){return t[h].boundingBox}),i=new Array;return le(r,r,function(h,c){return i.push(new Lt(h,c))}),i},s.CreateInitialPregraphs=function(){var t=this;return this.multiEdges.map(function(e){return t.CreatePregraphFromSetOfEdgeGeometries(e)})},s.CreatePregraphFromSetOfEdgeGeometries=function(t){var e=new Set,r=t[0],i=this.GetPortCurve(r.sourcePort),h=i.boundingBox;e.add(i),e.add(r.targetPort.Curve),h.addRec(r.targetPort.Curve.boundingBox);for(var p,f=C(this.nodeTree.GetNodeItemsIntersectingRectangle(h));!(p=f()).done;)e.add(p.value);return Bf.constructorStatic(t,e)},l}();function Ni(){Ni=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var ed=function(){function l(){this.triangles=new Set,this.front=new ye.c,this.passedTrs=new Set,this.visitedInThreader=new Set}var s=l.prototype;return s.setCdt=function(t){this.cdt=t,this.cdt.SetInEdges();for(var i,e=new Set,r=C(t.GetTriangles());!(i=r()).done;)for(var f,c=C(i.value.Sites);!(f=c()).done;){var p=f.value;null!=p.Owner&&e.add(p.Owner)}},s.findChannelTriangles=function(){this.passedTrs.clear();for(var t=this.poly.startPoint;null!=t.next;t=t.next)this.addPiercedTrianglesOnSegment(t.point,t.next.point);this.addSourceTargetTriangles()},s.addSourceTargetTriangles=function(){this.addPolyTrianglesForEndStart(this.poly.start),this.addPolyTrianglesForEndStart(this.poly.end)},s.findSiteTriangle=function(t){var e=this.cdt.FindSite(t);if(e.Edges)for(var i,r=C(e.Edges);!(i=r()).done;){var h=i.value,c=h.CcwTriangle;if(c&&Qn(c)||(c=h.CwTriangle)&&Qn(c))return c}if(e.InEdges)for(var p,f=C(e.InEdges);!(p=f()).done;){var y=p.value,m=y.CcwTriangle;if(m&&Qn(m)||(m=y.CwTriangle)&&Qn(m))return m}return null},s.addPolyTrianglesForEndStart=function(t){for(var e=new Set,r=new ye.c(this.findSiteTriangle(t));r.length;)for(var c,i=r.dequeue(),h=C(i.Edges);!(c=h()).done;){var p=c.value.GetOtherTriangle_T(i);p&&!e.has(p)&&Qn(p)&&(r.enqueue(p),e.add(p))}for(var m,y=C(e);!(m=y()).done;)this.triangles.add(m.value)},s.addPiercedTrianglesOnSegment=function(t,e){if(this.extendPassedTrsByContainingPoint(t),this.createThreader(t,e),this.passedTrs.size)this.front=new ye.c;else for(var i,r=C(this.threadThrough());!(i=r()).done;)this.triangles.add(i.value)},s.edgeCanBePierced=function(t){var e=t.lowerSite.Owner,r=t.upperSite.Owner;return e==this.sourcePoly||r==this.targetPoly||r==this.sourcePoly||e==this.targetPoly||e!=r&&null!==e&&null!==r},s.padTriangle=function(t,e){var r=t.Sites.item0.point.add(t.Sites.item1.point).add(t.Sites.item2.point).mul(.3333333333333333),i=new yo;return i.setItem(0,h(t.Sites.item0)),i.setItem(1,h(t.Sites.item1)),i.setItem(2,h(t.Sites.item2)),i;function h(c){var f=c.point.sub(r),p=f.length;return r.add(f.mul((p+e)/p))}},s.insideSourceOrTargetPoly=function(t){var e=t.Sites.item0.Owner;return(e===this.sourcePoly||e===this.targetPoly)&&e===t.Sites.item1.Owner&&e===t.Sites.item2.Owner},s.outsideOfObstacles=function(t){var e;if(null==t)return!1;var r=null!==(e=t.Sites.item0.Owner)&&void 0!==e?e:t.Sites.item1.Owner;return r===this.sourcePoly||r===this.targetPoly||!Qn(t)},s.run=function(t){if(this.triangles.clear(),this.poly=t,this.d=[],!(t.count<=2||null==this.cdt)){this.sourcePoly=this.findPoly(t.start),this.targetPoly=this.findPoly(t.end),this.findChannelTriangles();var e=this.getPerimeterEdges();e=this.fillTheCollapedSites(e);var r=new Ne([],[],Array.from(e).map(function(h){return{A:h.lowerSite.point,B:h.upperSite.point}}));r.run();var i=this.getSleeve(this.findSourceTriangle(r));if(null==i)return;if(0==i.length)return void(this.poly=vt.mkFromPoints([t.start,t.end]));this.initDiagonals(i),this.refineFunnel()}},s.findPoly=function(t){for(var e,h,i=C(this.cdt.FindSite(t).Edges);!(h=i()).done;){var c=h.value;return null!==(e=c.lowerSite.Owner)&&void 0!==e?e:c.upperSite.Owner}},s.fillTheCollapedSites=function(t){for(var i,e=new Map,r=C(t);!(i=r()).done;){var h=i.value;B(h.lowerSite,h),B(h.upperSite,h)}for(var p,c=[],f=C(e);!(p=f()).done;){var y=p.value;y[1].length>2&&c.push(y[0])}if(0==c.length)return t;for(var L=0,E=c;L<E.length;L++)for(var O,T=C(E[L].Triangles());!(O=T()).done;){var x=O.value;this.outsideOfObstacles(x)&&this.triangles.add(x)}return this.getPerimeterEdges();function B(M,F){var A=e.get(M);null==A&&e.set(M,A=[]),A.push(F)}},s.findSourceTriangle=function(t){for(var e,i,r=C(t.GetTriangles());!(i=r()).done;){var h=i.value;if(h.containsPoint(this.poly.start)){e=h;break}}return e},s.refineFunnel=function(){var t=[],e=this.poly.start,r={point:e},i={point:e},h={point:this.d[0].left,prev:r},c={point:this.d[0].right,prev:i};r.next=h,i.next=c;for(var f,p=1;p<this.d.length;p++)P(p,this.d);this.d.push({right:this.poly.end,left:h.point}),P(this.d.length-1,this.d);for(var y=vt.mkFromPoints(t),m=i;null!=m;m=m.next)y.addPoint(m.point);function P(A,z){if(z[A-1].left!==z[A].left){f=z[A].left;for(var Y=h;!B(Y)&&!S(Y);Y=Y.prev);B(Y)?function(){for(var A=i;!L(A);)A=A.next;if(!B(A)){for(var z=i;!z.point.equal(A.point);z=z.next)t.push(z.point);i.point=z.point,i.next=z.next,e=z.point,c.point.equal(i.point)&&(c.prev=c.next=null)}r.point=e,h.point=f,h.prev=r,r.next=h}():function(A){A!=h?(h.point=f,h.prev=A,A.next=h):A.next=h={point:f,prev:A}}(Y)}else{f=z[A].right;for(var W=c;!B(W)&&!T(W);W=W.prev);B(W)?function(){for(var A=r;!E(A);)A=A.next;if(!B(A)){for(var z=r;!z.point.equal(A.point);z=z.next)t.push(z.point);r.point=z.point,r.next=z.next,e=z.point,h.point.equal(r.point)&&(h.prev=r.next=null)}i.point=e,c.point=f,c.prev=i,i.next=c}():function(A){A!=c?(c.point=f,c.prev=A,A.next=c):A.next=c={point:f,prev:A}}(W)}}function L(A){return null==A.next||R.pointToTheLeftOfLineOrOnLine(f,A.point,A.next.point)}function E(A){return null==A.next||R.pointToTheRightOfLineOrOnLine(f,A.point,A.next.point)}function S(A){return R.pointToTheLeftOfLine(f,A.prev.point,A.point)}function T(A){return R.pointToTheRightOfLine(f,A.prev.point,A.point)}function B(A){return A.point==e}this.poly=y},s.initDiagonals=function(t){for(var r,e=C(t);!(r=e()).done;){var i=r.value,h=i.edge,c=i.source.OppositeSite(h);R.getTriangleOrientation(c.point,h.lowerSite.point,h.upperSite.point)==it.Counterclockwise?this.d.push({left:h.upperSite.point,right:h.lowerSite.point}):this.d.push({right:h.upperSite.point,left:h.lowerSite.point})}},s.getSleeve=function(t){var e=new ye.c;e.enqueue(t);var r=new Map;for(r.set(t,void 0);e.length>0;){var i=e.dequeue(),h=r.get(i);if(i.containsPoint(this.poly.end))return this.recoverPath(t,r,i);for(var f,c=C(i.Edges);!(f=c()).done;){var p=f.value;if(!p.constrained&&(void 0===h||p!==h)){var y=p.GetOtherTriangle_T(i);null!=y&&(r.has(y)||(r.set(y,p),e.enqueue(y)))}}}},s.recoverPath=function(t,e,r){for(var i=[],h=r;h!=t&&h!==t;){var c=e.get(h);h=c.GetOtherTriangle_T(h),i.push({source:h,edge:c})}return i.reverse()},s.getPerimeterEdges=function(){for(var r,t=new Set,e=C(this.triangles);!(r=e()).done;)for(var c,i=r.value,h=C(i.Edges);!(c=h()).done;){var f=c.value;this.triangles.has(f.GetOtherTriangle_T(i))||t.add(f)}return t},s.canPierce=function(t,e){return t&&!this.visitedInThreader.has(e.GetOtherTriangle_T(t))&&this.edgeCanBePierced(e)},s.createThreader=function(t,e){this.start=t,this.end=e,this.visitedInThreader.clear();var r=Array.from(this.passedTrs).map(function(f){return f});this.passedTrs.clear();for(var h,i=C(r);!(h=i()).done;)this.initFront(h.value)},s.initFront=function(t){t.containsPoint(this.end)&&(this.passedTrs.add(t),this.triangles.add(t));var e=this.GetHyperplaneSign(t.Sites.item0),r=this.GetHyperplaneSign(t.Sites.item1);this.canPierce(t,t.Edges.item0)&&e!==r&&R.getTriangleOrientation(this.end,t.Sites.item0.point,t.Sites.item1.point)==it.Clockwise&&this.enqueueInFront({source:t,edge:t.Edges.item0,rightSign:e,leftSign:r});var h=this.GetHyperplaneSign(t.Sites.item2);this.canPierce(t,t.Edges.item1)&&r!==h&&R.getTriangleOrientation(this.end,t.Sites.item1.point,t.Sites.item2.point)==it.Clockwise&&this.enqueueInFront({source:t,edge:t.Edges.item1,rightSign:r,leftSign:h}),this.canPierce(t,t.Edges.item2)&&e!==h&&R.getTriangleOrientation(this.end,t.Sites.item2.point,t.Sites.item0.point)==it.Clockwise&&this.enqueueInFront({source:t,edge:t.Edges.item2,rightSign:h,leftSign:e})},s.enqueueInFront=function(t){this.front.enqueue(t)},s.processFrontEdge=function(t){var e=function(l){return l.edge.GetOtherTriangle_T(l.source)}(t);if(null!=e){if(this.visitedInThreader.add(e),e.containsPoint(this.end))return void this.passedTrs.add(e);var r=e.Edges.index(t.edge),i=e.Sites.getItem(r+2),h=this.canPierce(e,e.Edges.getItem(r+1)),c=this.canPierce(e,e.Edges.getItem(r+2));if(h||c){var f=this.GetHyperplaneSign(i);h&&f<t.rightSign&&this.enqueueInFront({source:e,edge:e.Edges.getItem(r+1),leftSign:f,rightSign:t.rightSign}),c&&f>t.leftSign&&this.enqueueInFront({source:e,edge:e.Edges.getItem(r+2),leftSign:t.leftSign,rightSign:f})}}},s.extendPassedTrsByContainingPoint=function(t){var e=this.cdt.FindSite(t);if(e)for(var i,r=C(e.Triangles());!(i=r()).done;){var h=i.value;this.outsideOfObstacles(h)&&(this.passedTrs.add(h),this.triangles.add(h))}else for(var p,c=this.passedTrs.values().next().value,f=C(c.Edges);!(p=f()).done;){var m=p.value.GetOtherTriangle_T(c);if(this.outsideOfObstacles(m)&&m.containsPoint(t)){this.passedTrs.add(m),this.triangles.add(m);break}}},s.neigborsInChannel=Ni().mark(function o(t){var e,r,i,h;return Ni().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:e=C(t.Edges);case 1:if((r=e()).done){f.next=12;break}if(!1!==this.edgeCanBePierced(i=r.value)){f.next=5;break}return f.abrupt("continue",10);case 5:if(h=i.GetOtherTriangle_T(t),!this.visitedInThreader.has(h)){f.next=8;break}return f.abrupt("continue",10);case 8:return f.next=10,h;case 10:f.next=1;break;case 12:case"end":return f.stop()}},o,this)}),s.GetHyperplaneSign=function(t){var e=R.signedDoubledTriangleArea(this.start,t.point,this.end);return e>q.distanceEpsilon?1:e<-q.distanceEpsilon?-1:0},s.threadThrough=Ni().mark(function o(){var t,e,r,i;return Ni().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:for(;this.front.length;)t=this.front.dequeue(),this.processFrontEdge(t);e=C(this.visitedInThreader);case 2:if((r=e()).done){c.next=8;break}return i=r.value,c.next=6,i;case 6:c.next=2;break;case 8:case"end":return c.stop()}},o,this)}),l}();function Qn(l){return null==l.Sites.item0.Owner||null==l.Sites.item1.Owner||null==l.Sites.item2.Owner||l.Sites.item0.Owner==l.Sites.item1.Owner&&l.Sites.item0.Owner==l.Sites.item2.Owner}function Sn(){Sn=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var bn=function(l){function s(t,e,r,i,h,c,f){var p;return void 0===r&&(r=1),void 0===i&&(i=2),void 0===h&&(h=Math.PI/180*30),void 0===c&&(c=null),void 0===f&&(f=null),(p=l.call(this,f)||this).continueOnOverlaps=!0,p.shapesToTightLooseCouples=new Map,p.multiEdgesSeparation=.5,p.routeMultiEdgesAsBundles=!0,p.UsePolylineEndShortcutting=!0,p.UseInnerPolylingShortcutting=!0,p.AllowedShootingStraightLines=!0,p._overlapsDetected=!1,p.edges=e,p.BundlingSettings=c,p.geomGraph=t,p.LoosePadding=i,p.tightPadding=r,p.coneAngle=h,p.routeMultiEdgesAsBundles=e.length<1e3&&t.deepNodeCount<1e3,p}X(s,l),s.mk2=function(e,r){return s.mk5(e,r.Padding,r.PolylinePadding,r.ConeAngle,r.bundlingSettings)},s.mk4=function(e,r,i,h){return new s(e,Array.from(e.deepEdges),r,i,h,null)},s.mk5=function(e,r,i,h,c){return new s(e,Array.from(e.deepEdges),r,i,h,c)},s.mk6=function(e,r,i,h,c,f){var p=s.mk4(e,r,i,h),y=Eh.GetShapes(c,f);return p.Initialize(y,h),p};var o=s.prototype;return o.Initialize=function(e,r){this.rootShapes=e.filter(function(i){return null==i.Parents||0===i.Parents.length}),this.coneAngle=r,0===this.coneAngle&&(this.coneAngle=Math.PI/6)},o.run=function(){if(0!=this.edges.length&&!this.geomGraph.isEmpty()){var e=yi.GetShapes(this.geomGraph,this.edges);null==this.BundlingSettings&&this.geomGraph.layoutSettings&&this.geomGraph.layoutSettings.commonSettings.edgeRoutingSettings&&this.geomGraph.layoutSettings.commonSettings.edgeRoutingSettings.bundlingSettings&&(this.BundlingSettings=this.geomGraph.layoutSettings.commonSettings.edgeRoutingSettings.bundlingSettings),this.Initialize(e,this.coneAngle),this.GetOrCreateRoot(),this.RouteOnRoot(),this.RemoveRoot()}},o.rerouteOnSubsetOfNodes=function(e){this.RouteMultiEdgesAsBundles=!1,this.edges=Array.from(this.geomGraph.deepEdges).filter(function(i){return Bo(i.edge,e)});var r=yi.GetShapes(this.geomGraph,this.edges);this.rootShapes=r.filter(function(i){return null==i.Parents||0===i.Parents.length}),this.GetOrCreateRoot(),this.CalculateShapeToBoundaries(this.root),this.calcLooseShapesToNodes(),this.CalculatePortsToShapes(),this.rerouteOnActiveNodes(e),this.RemoveRoot()},o.calcLooseShapesToNodes=function(){var e=this;if(this.loosePolylinesToNodes=new Map,this.OverlapsDetected){var p=qi(this.geomGraph.nodesBreadthFirst,function(m){return m.boundingBox});me(this.GetLooseHierarchy(),p,function(m,P){if(K.CurveIsInsideOther(P.boundaryCurve,m)){for(var S,L=e.loosePolylinesToNodes.get(m),E=C(P.getAncestors());!(S=E()).done;){var T=S.value;if(!(T instanceof Ae&&null==T.parent)&&null!=T.boundaryCurve&&K.CurveIsInsideOther(T.boundaryCurve,m))return}null==L&&e.loosePolylinesToNodes.set(m,L=new Set),L.add(P.node)}})}else for(var i,r=C(this.shapesToTightLooseCouples);!(i=r()).done;){var h=i.value;this.loosePolylinesToNodes.set(h[1].LooseShape.BoundaryCurve,new Set([h[0].node.node]))}},o.RouteOnRoot=function(){to(0),this.CalculatePortsToShapes(),this.CalculatePortsToEnterableShapes(),this.CalculateShapeToBoundaries(this.root),(!this.OverlapsDetected||this.ContinueOnOverlaps)&&(this.BindLooseShapes(),this.SetLoosePolylinesForAnywherePorts(),this.CalculateVisibilityGraph(),this.RouteOnVisGraph())},o.CalculatePortsToEnterableShapes=function(){this.portsToEnterableShapes=new Map;for(var r,e=C(this.portsToShapes);!(r=e()).done;){var i=r.value,h=i[0],c=i[1],f=new Set;s.EdgesAttachedToPortAvoidTheNode(h)||f.add(c),this.portsToEnterableShapes.set(h,f)}for(var y,p=C(this.rootShapes);!(y=p()).done;)for(var L,P=C(y.value.Descendants());!(L=P()).done;)for(var T,E=L.value,S=C(E.Ports);!(T=S()).done;)oi(this.portsToEnterableShapes.get(T.value),Array.from(E.Ancestors()).filter(function(B){return null!=B.BoundaryCurve}))},s.EdgesAttachedToPortAvoidTheNode=function(e){return e instanceof Ze||e instanceof Je},o.SetLoosePolylinesForAnywherePorts=function(){for(var r,e=C(this.shapesToTightLooseCouples);!(r=e()).done;)for(var p,i=r.value,c=i[1],f=C(i[0].Ports);!(p=f()).done;){var y=p.value;y instanceof Le&&(y.LoosePolyline=c.LooseShape.BoundaryCurve),y instanceof Je&&(y.LoosePolyline=c.LooseShape.BoundaryCurve)}},o.BindLooseShapes=function(){this.looseRoot=new Xi;for(var r,e=C(this.root.Children);!(r=e()).done;){var i=r.value,h=this.shapesToTightLooseCouples.get(i).LooseShape;this.BindLooseShapesUnderShape(i),this.looseRoot.AddChild(h)}},o.BindLooseShapesUnderShape=function(e){for(var h,r=this.shapesToTightLooseCouples.get(e).LooseShape,i=C(e.Children);!(h=i()).done;){var c=h.value,f=this.shapesToTightLooseCouples.get(c).LooseShape;r.AddChild(f),this.BindLooseShapesUnderShape(c)}},o.CalculateShapeToBoundaries=function(e){if(this.ProgressStep(),0!==e.Children.length){for(var i,r=C(e.Children);!(i=r()).done;)this.CalculateShapeToBoundaries(i.value);this.obstacleCalculator=new Rh(e,this.tightPadding,this.AdjustedLoosePadding,this.shapesToTightLooseCouples),this.obstacleCalculator.Calculate(.01),this.OverlapsDetected||(this.OverlapsDetected=this.obstacleCalculator.OverlapsDetected)}},o.GroupEdgesByPassport=function(){for(var c,e=this,r=new Array,i=function(){var p=c.value,y=e.EdgePassport(p),m=r.find(function(P){return Ui(P.passport,y)});m||r.push(m={passport:y,edges:[]}),m.edges.push(p)},h=C(this.edges);!(c=h()).done;)i();return r},o.RouteOnVisGraph=function(){if(this.ancestorSets=s.GetAncestorSetsMap(Array.from(this.root.Descendants())),null==this.BundlingSettings)for(var e=this.GroupEdgesByPassport(),r=0;r<e.length;r++){var i=e[r],c=this.GetObstaclesFromPassport(i.passport),f=this.CreateInteractiveEdgeRouter(Array.from(c));this.RouteEdgesWithTheSamePassport(i,f,c)}else this.RouteBundles()},o.rerouteOnActiveNodes=function(e){if(this.ancestorSets=s.GetAncestorSetsMap(Array.from(this.root.Descendants())),null==this.BundlingSettings)for(var i,r=C(this.GroupEdgesByPassport());!(i=r()).done;){for(var m,h=i.value,f=this.GetObstaclesFromPassport(h.passport),p=new Set,y=C(f);!(m=y()).done;)for(var S,P=m.value,L=this.LooseShapeOfOriginalShape(P),E=C(this.loosePolylinesToNodes.get(L.BoundaryCurve));!(S=E()).done;)e.has(S.value)&&p.add(P);var O=this.CreateInteractiveEdgeRouter(Array.from(p));this.rerouteEdgesWithTheSamePassportActiveNodes(h,O,p,e)}else this.RouteBundles()},o.getDebugCurvesFromEdgesAndCdt=function(e){for(var h,r=Array.from(this.geomGraph.deepEdges).map(function(m){return m.curve}).filter(function(m){return null!=m}).filter(function(m){return m.count>5}).map(function(m){return xt.mkDebugCurveTWCI(200,1,"Red",m)}),i=C(e.PointsToSites.values());!(h=i()).done;)for(var p,f=C(h.value.Edges);!(p=f()).done;){var y=p.value;r.push(xt.mkDebugCurveTWCI(200,.5,y.constrained?"Blue":"Green",Z.mkPP(y.lowerSite.point,y.upperSite.point)))}return r},o.RouteEdgesWithTheSamePassport=function(e,r,i){var h={regularEdges:[],multiEdges:[]};try{var c=this.getCdtFromPassport(i);r.pathOptimizer.setCdt(c)}catch{r.pathOptimizer.setCdt(null)}if(this.RouteMultiEdgesAsBundles){if(this.SplitOnRegularAndMultiedges(e.edges,h),h.regularEdges.length>0)for(var f=0;f<h.regularEdges.length;f++)this.routeEdge(r,h.regularEdges[f]);null!=h.multiEdges&&(this.ScaleDownLooseHierarchy(r,i),this.RouteMultiEdges(h.multiEdges,r,e.passport))}else for(var p=0;p<e.edges.length;p++)this.routeEdge(r,e.edges[p])},o.rerouteEdgesWithTheSamePassportActiveNodes=function(e,r,i,h){var c={regularEdges:[],multiEdges:[]};try{var f=this.getCdtFromPassport(i);r.pathOptimizer.setCdt(f)}catch(L){r.pathOptimizer.setCdt(null)}if(this.RouteMultiEdgesAsBundles){if(this.SplitOnRegularAndMultiedges(e.edges,c),c.regularEdges.length>0)for(var p=0;p<c.regularEdges.length;p++){var y=c.regularEdges[p];Mt.assert(Bo(y.edge,h)),this.rerouteEdge(r,y)}null!=c.multiEdges&&(this.ScaleDownLooseHierarchy(r,i),this.RouteMultiEdges(c.multiEdges,r,e.passport))}else for(var m=0;m<e.edges.length;m++){var P=e.edges[m];Bo(P.edge,h)&&this.rerouteEdge(r,P)}},o.rerouteEdge=function(e,r){try{e.rerouteEdge(r),vr.trimSplineAndCalculateArrowheadsII(r,r.sourcePort.Curve,r.targetPort.Curve,r.curve,!1)}catch{}},o.getCdtFromPassport=function(e){for(var f,r=new Set,i=[],h=lt.mkEmpty(),c=C(e);!(f=c()).done;){var p=f.value,y=this.LoosePolyOfOriginalShape(p);if(null!=y){r.add(y);for(var P,m=C(p.Ports);!(P=m()).done;)i.push(P.value.Location);h.addRecSelf(y.boundingBox)}}h.pad(Math.max(h.diagonal/4,100));var E=Array.from(r);E.push(h.perimeter());var S=new Ne(i,E,[]);return S.run(),S},o.routeEdge=function(e,r){var i=this.makeTransparentShapesOfEdgeAndGetTheShapes(r);this.ProgressStep(),this.RouteEdgeInternal(r,e),s.SetTransparency(i,!1)},o.ScaleDownLooseHierarchy=function(e,r){for(var c,i=new Array,h=C(r);!(c=h()).done;){var p=this.shapesToTightLooseCouples.get(c.value);i.push(Ie.LoosePolylineWithFewCorners(p.TightPolyline,p.Distance/1.1,0))}e.LooseHierarchy=s.CreateLooseObstacleHierarachy(i),e.ClearActivePolygons(),e.AddActivePolygons(i.map(function(y){return new We(y)}))},o.RouteMultiEdges=function(e,r,i){for(var p,h=this,c=[],f=C(i);!(p=f()).done;)for(var P,m=C(p.value.Children);!(P=m()).done;)c.push(P.value.BoundaryCurve);var E=new tn;E.InkImportance=1e-5,E.EdgeSeparation=this.MultiEdgesSeparation,new td(e,r,c,E,function(T){return h.makeTransparentShapesOfEdgeAndGetTheShapes(T)}).run()},o.SplitOnRegularAndMultiedges=function(e,r){for(var c,i=new li,h=C(e);!(c=h()).done;){var f=c.value;s.IsEdgeToParent(f)?r.regularEdges.push(f):s.RegisterInPortLocationsToEdges(f,i)}r.multiEdges=null;for(var y,p=C(i.values());!(y=p()).done;){var m=y.value;1===m.length||this.OverlapsDetected?Tr(r.regularEdges,m):(null==r.multiEdges&&(r.multiEdges=new Array),r.multiEdges.push(m))}},s.RegisterInPortLocationsToEdges=function(e,r){var i,h=new ue(e.sourcePort.Location,e.targetPort.Location);(i=r.get(h))||(i=new Array,r.set(h,i)),i.push(e)},s.IsEdgeToParent=function(e){return e.sourcePort instanceof Le||e.targetPort instanceof Le},o.CreateInteractiveEdgeRouter=function(e){var r=this,i=new Set(e.map(function(c){return r.shapesToTightLooseCouples.get(c).LooseShape.BoundaryCurve})),h=new na(this.cancelToken);return h.pathOptimizer=new ed,h.ObstacleCalculator=new Ie(e.map(function(c){return c.BoundaryCurve}),this.tightPadding,this.loosePadding,!1),h.VisibilityGraph=this.visGraph,h.TightHierarchy=this.CreateTightObstacleHierarachy(e),h.LooseHierarchy=s.CreateLooseObstacleHierarachy(Array.from(i)),h.UseSpanner=!0,h.LookForRoundedVertices=!0,h.TightPadding=this.tightPadding,h.LoosePadding=this.LoosePadding,h.UseEdgeLengthMultiplier=this.UseEdgeLengthMultiplier,h.UsePolylineEndShortcutting=this.UsePolylineEndShortcutting,h.UseInnerPolylingShortcutting=this.UseInnerPolylingShortcutting,h.AllowedShootingStraightLines=this.AllowedShootingStraightLines,h.AddActivePolygons(Array.from(i).map(function(c){return new We(c)})),h},o.GetObstaclesFromPassport=function(e){if(0===e.size)return new Set(this.root.Children);for(var f,r=this.GetCommonAncestorsAbovePassport(e),i=this.GetAllAncestors(e),h=new Set,c=C(e);!(f=c()).done;)for(var m,y=C(f.value.Children);!(m=y()).done;){var P=m.value;i.has(P)||h.add(P)}for(var T,L=On(new Set(e),h),E=new ye.c,S=C(e);!(T=S()).done;){var O=T.value;r.has(O)||E.enqueue(O)}for(;E.length>0;)for(var M,B=C(E.dequeue().Parents);!(M=B()).done;){for(var z,F=M.value,A=C(F.Children);!(z=A()).done;){var V=z.value;i.has(V)||h.add(V)}!r.has(F)&&!L.has(F)&&(E.enqueue(F),L.add(F))}return h},o.GetAllAncestors=function(e){if(0===e.size)return new Set;for(var h,r=new Set(e),i=C(e);!(h=i()).done;)r=On(r,this.ancestorSets.get(h.value));return r},o.GetCommonAncestorsAbovePassport=function(e){if(0===e.size)return new Set;for(var r=Array.from(e),i=this.ancestorSets.get(r[0]),h=1;h<r.length;h++)i=Or(i,this.ancestorSets.get(r[h]));return i},o.RouteBundles=function(){var e=this;this.ScaleLooseShapesDown(),this.CalculateEdgeEnterablePolylines();var r=this.GetLooseHierarchy(),i=Wu(r),h=new yl(function(f){return e.makeTransparentShapesOfEdgeAndGetTheShapes(f)},i,this.FindCdtGates(i));new Gi(this.edges,h,this.visGraph,this.BundlingSettings,this.LoosePadding,this.GetTightHierarchy(),r,this.enterableLoose,this.enterableTight,function(f){return e.LoosePolyOfOriginalShape(e.portsToShapes.get(f))}).run()},o.CreateTheMapToParentLooseShapes=function(e,r){for(var h,i=C(e.Children);!(h=i()).done;){var c=h.value,f=this.shapesToTightLooseCouples.get(c);r.set(f.LooseShape.BoundaryCurve,e),this.CreateTheMapToParentLooseShapes(c,r)}},o.FindCdtGates=function(e){var r=new Map;this.CreateTheMapToParentLooseShapes(this.root,r);for(var c,i=new Set,h=C(e.PointsToSites.values());!(c=h()).done;)for(var y,f=c.value,p=C(f.Edges);!(y=p()).done;){var m=y.value;if(null!=m.CwTriangle||null!=m.CcwTriangle){var P=f.Owner,L=m.lowerSite.Owner;if(P!==L){var E=r.get(P);E&&E===r.get(L)&&i.add(m)}}}return i},o.CalculateEdgeEnterablePolylines=function(){this.enterableLoose=new Map,this.enterableTight=new Map;for(var r,e=C(this.edges);!(r=e()).done;){var i=r.value,h=new Set,c=new Set;this.GetEdgeEnterablePolylines(i,h,c),this.enterableLoose.set(i,h),this.enterableTight.set(i,c)}},o.GetEdgeEnterablePolylines=function(e,r,i){var h=this.portsToShapes.get(e.sourcePort),c=this.portsToShapes.get(e.targetPort);h!==this.root&&this.GetEnterablesForShape(h,r,i),c!==this.root&&this.GetEnterablesForShape(c,r,i)},o.GetEnterablesForShape=function(e,r,i){for(var c,h=C(this.ancestorSets.get(e));!(c=h()).done;){var f=c.value,p=this.LoosePolyOfOriginalShape(f);p&&r.add(p);var y=this.TightPolyOfOriginalShape(f);y&&i.add(y)}},o.GetTightHierarchy=function(){return Ht(Array.from(this.shapesToTightLooseCouples.values()).map(function(e){return Qt(e.TightPolyline,e.TightPolyline.boundingBox)}))},o.GetLooseHierarchy=function(){for(var i,e=new Set,r=C(this.shapesToTightLooseCouples.values());!(i=r()).done;)e.add(i.value.LooseShape.BoundaryCurve);return Ht(Array.from(e).map(function(c){return Qt(c,c.boundingBox)}))},o.ScaleLooseShapesDown=function(){for(var r,e=C(this.shapesToTightLooseCouples);!(r=e()).done;){var h=r.value[1];h.LooseShape.BoundaryCurve=Ie.LoosePolylineWithFewCorners(h.TightPolyline,h.Distance/Gi.SuperLoosePaddingCoefficient,0)}},o.EdgePassport=function(e){var r=new Set,i=this.portsToShapes.get(e.sourcePort),h=this.portsToShapes.get(e.targetPort);return this.IsAncestor(i,h)?(oi(r,h.Parents),r.add(i),r):this.IsAncestor(h,i)?(oi(r,i.Parents),r.add(h),r):(i!==this.looseRoot&&oi(r,i.Parents),h!==this.looseRoot&&oi(r,h.Parents),r)},o.AllPorts=Sn().mark(function t(){var e,r,i;return Sn().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.edges);case 1:if((r=e()).done){c.next=9;break}return i=r.value,c.next=5,i.sourcePort;case 5:return c.next=7,i.targetPort;case 7:c.next=1;break;case 9:case"end":return c.stop()}},t,this)}),o.CalculatePortsToShapes=function(){this.portsToShapes=new Map;for(var r,e=C(this.root.Descendants());!(r=e()).done;)for(var c,i=r.value,h=C(i.Ports);!(c=h()).done;)this.portsToShapes.set(c.value,i);for(var y,p=C(this.AllPorts());!(y=p()).done;){var m=y.value;this.portsToShapes.has(m)||(this.root.Ports.add(m),this.portsToShapes.set(m,this.root))}},o.RouteEdgeInternal=function(e,r){var i=new Array;e.sourcePort instanceof Le||Tr(i,this.AddVisibilityEdgesFromPort(e.sourcePort)),e.targetPort instanceof Le||Tr(i,this.AddVisibilityEdgesFromPort(e.targetPort));var h={smoothedPolyline:null};if(e.curve=R.closeDistEps(e.sourcePort.Location,e.targetPort.Location)?sr.RouteSelfEdge(e.sourcePort.Curve,Math.max(2*this.LoosePadding,e.GetMaxArrowheadLength()),h):r.RouteSplineFromPortToPortWhenTheWholeGraphIsReady(e.sourcePort,e.targetPort,!0,h),e.smoothedPolyline=h.smoothedPolyline,null==e.curve)throw new Error;for(var c=0,f=i;c<f.length;c++)_t.RemoveEdge(f[c]);vr.trimSplineAndCalculateArrowheadsII(e,e.sourcePort.Curve,e.targetPort.Curve,e.curve,!1)},o.AddVisibilityEdgesFromPort=Sn().mark(function t(e){var r,i,c,f,p;return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(e instanceof Ze)&&(r=this.portsToShapes.get(e))&&(i=this.shapesToTightLooseCouples.get(r))){m.next=2;break}return m.abrupt("return");case 2:c=C(i.LooseShape.BoundaryCurve);case 4:if((f=c()).done){m.next=11;break}if(null!=this.visGraph.FindEdgePP(e.Location,p=f.value)){m.next=9;break}return m.next=9,this.visGraph.AddEdgePP(e.Location,p);case 9:m.next=4;break;case 11:case"end":return m.stop()}},t,this)}),o.makeTransparentShapesOfEdgeAndGetTheShapes=function(e){for(var f,r=this.portsToShapes.get(e.sourcePort),i=this.portsToShapes.get(e.targetPort),h=new Array,c=C(this.GetTransparentShapes(e.sourcePort,e.targetPort,r,i));!(f=c()).done;){var p=f.value;null!=p&&h.push(this.LooseShapeOfOriginalShape(p))}for(var m,y=C(this.portsToEnterableShapes.get(e.sourcePort));!(m=y()).done;)h.push(this.LooseShapeOfOriginalShape(m.value));for(var E,L=C(this.portsToEnterableShapes.get(e.targetPort));!(E=L()).done;)h.push(this.LooseShapeOfOriginalShape(E.value));return s.SetTransparency(h,!0),h},o.LooseShapeOfOriginalShape=function(e){return e===this.root?this.looseRoot:this.shapesToTightLooseCouples.get(e).LooseShape},o.LoosePolyOfOriginalShape=function(e){return this.LooseShapeOfOriginalShape(e).BoundaryCurve},o.TightPolyOfOriginalShape=function(e){return e===this.root?null:this.shapesToTightLooseCouples.get(e).TightPolyline},o.GetTransparentShapes=Sn().mark(function t(e,r,i,h){var c,f,p,y,m,P;return Sn().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:c=C(this.ancestorSets.get(i));case 1:if((f=c()).done){E.next=7;break}return p=f.value,E.next=5,p;case 5:E.next=1;break;case 7:y=C(this.ancestorSets.get(h));case 8:if((m=y()).done){E.next=14;break}return P=m.value,E.next=12,P;case 12:E.next=8;break;case 14:if(s.EdgesAttachedToPortAvoidTheNode(e)){E.next=17;break}return E.next=17,i;case 17:if(s.EdgesAttachedToPortAvoidTheNode(r)){E.next=20;break}return E.next=20,h;case 20:case"end":return E.stop()}},t,this)}),s.SetTransparency=function(e,r){for(var h,i=C(e);!(h=i()).done;)h.value.IsTransparent=r},o.IsAncestor=function(e,r){var i;return null!=r&&null!=(i=this.ancestorSets.get(r))&&i.has(e)},s.CreateLooseObstacleHierarachy=function(e){return Ht(e.map(function(r){return Qt(r,r.boundingBox)}))},o.CreateTightObstacleHierarachy=function(e){var r=this;return Ht(e.map(function(h){return r.shapesToTightLooseCouples.get(h).TightPolyline}).map(function(h){return Qt(h,h.boundingBox)}))},o.CalculateVisibilityGraph=function(){var e=null!=this.LineSweeperPorts?qt.mk(this.LineSweeperPorts):new qt;this.ProcessHookAnyWherePorts(e),this.portRTree=ui(Array.from(e.values()).map(function(r){return[lt.rectangleOnPoint(r),r]})),this.visGraph=new _t,this.FillVisibilityGraphUnderShape(this.root)},s.ShowVisGraph=function(e,r,i,h,c){void 0===h&&(h=null),void 0===c&&(c=null);var f=Array.from(r.Edges).map(function(F){return xt.mkDebugCurveTWCI(100,1,null!=F.IsPassable&&F.IsPassable()?"green":"black",Z.mkPP(F.SourcePoint,F.TargetPoint))});if(null!=i)for(var y,p=C(i);!(y=p()).done;){var m=y.value;f.push(xt.mkDebugCurveTWCI(100,.3,"brown",m));for(var L,P=C(m);!(L=P()).done;)f.push(xt.mkDebugCurveTWCI(100,1,"green",te.mkCircle(1,L.value)))}if(null!=h)for(var T,S=C(h);!(T=S()).done;)f.push(xt.mkDebugCurveTWCI(100,10,"navy",T.value));if(null!=c)for(var B,x=C(c);!(B=x()).done;)f.push(xt.mkDebugCurveTWCI(100,10,"red",B.value))},o.ProcessHookAnyWherePorts=function(e){for(var i,r=C(this.edges);!(i=r()).done;){var h=i.value;h.sourcePort instanceof Le||h.sourcePort instanceof Je||e.add(h.sourcePort.Location),h.targetPort instanceof Le||h.targetPort instanceof Je||e.add(h.targetPort.Location)}},o.FillVisibilityGraphUnderShape=function(e){for(var r=e.Children,i=0;i<r.length;i++)this.FillVisibilityGraphUnderShape(r[i]);var c=this.shapesToTightLooseCouples.get(e),f=c?c.LooseShape.BoundaryCurve:null,p=c?c.LooseShape:this.looseRoot,y=new Set(p.Children.map(function(O){return O.BoundaryCurve})),m=this.RemoveInsidePortsAndSplitBoundaryIfNeeded(f),P=new _t,L=$i.mk([],P,this.coneAngle,m,f);L.run(),P=new _t,(L=$i.mk(Array.from(y),P,this.coneAngle,m,f)).run(),this.ProgressStep();for(var S,E=C(P.Edges);!(S=E()).done;)this.TryToCreateNewEdgeAndSetIsPassable(S.value,p);this.AddBoundaryEdgesToVisGraph(f)},o.TryToCreateNewEdgeAndSetIsPassable=function(e,r){var i=this.visGraph.FindEdgePP(e.SourcePoint,e.TargetPoint);null==i&&(i=this.visGraph.AddEdgePP(e.SourcePoint,e.TargetPoint),null!=r&&(i.IsPassable=function(){return r.IsTransparent}))},o.AddBoundaryEdgesToVisGraph=function(e){if(null!=e)for(var r,i=e.startPoint;this.visGraph.AddEdgePP(i.point,(r=i.nextOnPolyline).point),r!==e.startPoint;i=r);},o.RemoveInsidePortsAndSplitBoundaryIfNeeded=function(e){var r=new qt;if(null==e){for(var h,i=C(this.portRTree.GetAllLeaves());!(h=i()).done;)r.add(h.value);return this.portRTree.clear(),r}for(var m,y=C(this.portRTree.GetAllIntersecting(e.boundingBox));!(m=y()).done;){var P=m.value;switch(K.PointRelativeToCurveLocation(P,e)){case ht.Inside:r.add(P),this.portRTree.Remove(lt.rectangleOnPoint(P),P);break;case ht.Boundary:this.portRTree.Remove(lt.rectangleOnPoint(P),P);var L=s.FindPointOnPolylineToInsertAfter(e,P);if(null==L)throw new Error;Hs.InsertPointIntoPolylineAfter(e,L,P)}}return r},s.FindPointOnPolylineToInsertAfter=function(e,r){for(var i=e.startPoint;;){var h=i.nextOnPolyline;if(R.closeDistEps(r,i.point)||R.closeDistEps(r,h.point))return null;if(dt(R.distToLineSegment(r,i.point,h.point).dist,0))return i;if((i=h)===e.startPoint)throw new Error}},o.GetOrCreateRoot=function(){if(1===this.rootShapes.length){var e=this.rootShapes[0];if(null==e.BoundaryCurve)return void(this.root=e)}this.rootWasCreated=!0,this.root=new Xi(null);for(var i,r=C(this.rootShapes);!(i=r()).done;)this.root.AddChild(i.value)},o.RemoveRoot=function(){if(this.rootWasCreated){for(var r,e=C(this.rootShapes);!(r=e()).done;)r.value.RemoveParent(this.root);this.root=null,this.rootWasCreated=!1}},s.GetAncestorSetsMap=function(e){for(var h,r=new Map,i=C(e.filter(function(f){return!r.has(f)}));!(h=i()).done;){var c=h.value;r.set(c,s.GetAncestorSet(c,r))}return r},s.GetAncestorSet=function(e,r){for(var c,i=new Set(e.Parents),h=C(e.Parents);!(c=h()).done;){var f=c.value,p=r.get(f);p||r.set(f,p=s.GetAncestorSet(f,r));for(var m,y=C(p);!(m=y()).done;)i.add(m.value)}return i},s.CreatePortsIfNeeded=function(e){for(var h,r=function(){var f=h.value;if(null==f.sourcePort){var p=f;new kn(function(){return p.source.boundaryCurve},function(){return p.source.center},new R(0,0))}if(null==f.targetPort){var y=f;new kn(function(){return y.target.boundaryCurve},function(){return y.target.center},new R(0,0))}},i=C(e);!(h=i()).done;)r()},Q(s,[{key:"ContinueOnOverlaps",get:function(){return this.continueOnOverlaps},set:function(e){this.continueOnOverlaps=e}},{key:"LoosePadding",get:function(){return this.loosePadding},set:function(e){this.loosePadding=e}},{key:"MultiEdgesSeparation",get:function(){return this.multiEdgesSeparation},set:function(e){this.multiEdgesSeparation=e}},{key:"OverlapsDetected",get:function(){return this._overlapsDetected},set:function(e){this._overlapsDetected=e}},{key:"AdjustedLoosePadding",get:function(){return null==this.BundlingSettings?this.LoosePadding:this.LoosePadding*Gi.SuperLoosePaddingCoefficient}},{key:"RouteMultiEdgesAsBundles",get:function(){return this.routeMultiEdgesAsBundles},set:function(e){this.routeMultiEdgesAsBundles=e}}]),s}(Vt),Fi=function(l){function s(o,t){var e;return(e=l.call(this)||this).SetEdges(o,t),e}return X(s,l),s}(an);function En(){En=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var od=function(){function l(o){this.MultipleMiddles=new Set,this.Multiedges=new Bn(o)}var s=l.prototype;return s.RegularMultiedges=En().mark(function o(){var t,e,r,i,h;return En().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t=C(this.Multiedges.keyValues());case 1:if((e=t()).done){f.next=8;break}if(h=(r=e.value)[1],(i=r[0]).x===i.y){f.next=6;break}return f.next=6,h;case 6:f.next=1;break;case 8:case"end":return f.stop()}},o,this)}),s.AllIntEdges=En().mark(function o(){var t,e,i,h,c;return En().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=C(this.Multiedges.values());case 1:if((e=t()).done){p.next=12;break}i=C(e.value);case 4:if((h=i()).done){p.next=10;break}return c=h.value,p.next=8,c;case 8:p.next=4;break;case 10:p.next=1;break;case 12:case"end":return p.stop()}},o,this)}),s.addFeedbackSet=function(t){for(var r,e=C(t);!(r=e()).done;){for(var y,i=r.value,h=new Lt(i.source,i.target),c=new Lt(i.target,i.source),f=this.Multiedges.get(h.x,h.y),p=C(f);!(y=p()).done;)y.value.reverse();if(this.Multiedges.has(c.x,c.y))for(var E,P=this.Multiedges.get(c.x,c.y),L=C(f);!(E=L()).done;)P.push(E.value);else this.Multiedges.set(c.x,c.y,f);this.Multiedges.delete(h.x,h.y)}},s.registerOriginalEdgeInMultiedges=function(t){var e=this.Multiedges.get(t.source,t.target);null==e&&this.Multiedges.set(t.source,t.target,e=[]),e.push(t)},s.SkeletonEdges=En().mark(function o(){var t,e,r,i,h;return En().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t=C(this.Multiedges.keyValues());case 1:if((e=t()).done){f.next=8;break}if(h=(r=e.value)[1],(i=r[0]).x===i.y){f.next=6;break}return f.next=6,h[0];case 6:f.next=1;break;case 8:case"end":return f.stop()}},o,this)}),s.GetMultiedge=function(t,e){return this.GetMultiedgeI(new Lt(t,e))},s.GetMultiedgeI=function(t){return this.Multiedges.has(t.x,t.y)?this.Multiedges.get(t.x,t.y):new Array},l}();function Za(l,s){for(var o=0;o<l.length;o++)s[o]=l[o]}var Xn=function(){function l(o){this.initialize(o)}var s=l.prototype;return s.initialize=function(t){this.y=t,this.verticesToX=null,this.layers=null},s.DropEmptyLayers=function(){for(var t=new Array(this.Layers.length),e=0,r=0;r<this.Layers.length;r++)t[r]=e,0===this.Layers[r].length&&e++;if(0===e)return this;for(var i=new Array(this.y.length),h=0;h<i.length;h++)i[h]=this.y[h]-t[this.y[h]];for(var c=new Array(this.layers.length-e),f=0;f<this.layers.length;f++)this.layers[f].length>0&&(c[f-t[f]]=Array.from(this.layers[f]));var p=new l(i);return p.layers=c,p},s.updateLayers=function(t){null==this.layers&&this.InitLayers();for(var e=0;e<this.layers.length;e++)Za(t[e],this.layers[e]);this.UpdateXFromLayers()},s.UpdateXFromLayers=function(){null==this.layers&&this.InitLayers(),null==this.verticesToX&&(this.verticesToX=new Array(this.y.length));for(var e,t=C(this.layers);!(e=t()).done;)for(var c,i=0,h=C(e.value);!(c=h()).done;)this.verticesToX[c.value]=i++},s.ReversedClone=function(){for(var t=new Array(this.y.length),e=this.Layers.length-1,r=0;r<this.y.length;r++)t[r]=e-this.y[r];return new l(t)},s.InitLayers=function(){for(var r,t=0,e=C(this.y);!(r=e()).done;){var i=r.value;i+1>t&&(t=i+1)}for(var f,h=new Array(t).fill(0),c=C(this.y);!(f=c()).done;)h[f.value]++;this.layers=new Array(t);for(var y=0;y<t;y++)this.layers[y]=new Array(h[y]),h[y]=0;for(var m=0;m<this.y.length;m++){var P=this.y[m];this.layers[P][h[P]++]=m}},Q(l,[{key:"x",get:function(){return null!=this.verticesToX||(this.verticesToX=new Array(this.y.length),this.UpdateXFromLayers()),this.verticesToX}},{key:"Layers",get:function(){return null!=this.layers||this.InitLayers(),this.layers},set:function(t){this.layers=t}}]),l}(),sd=function(l){function s(t,e,r,i){var h;return(h=l.call(this,i)||this).jumpers=new Set,h.possibleJumperFeasibleIntervals=new Map,h.nodeCount=r,h.dag=t,h.layering=e,h.Init(),h}X(s,l),s.Balance=function(e,r,i,h){new s(e,r,i,h).run()};var o=s.prototype;return o.run=function(){for(;this.jumpers.size>0;)this.Jump(this.ChooseJumper())},o.Init=function(){this.CalculateLayerCounts(),this.InitJumpers()},o.Jump=function(e){this.jumpers.delete(e);var r=this.possibleJumperFeasibleIntervals.get(e),i=this.CalcJumpInfo(r.x,r.y,e);if(null!=i){this.layering[e]=i.layerToJumpTo;var h=this.nodeCount[e];this.vertsCounts[i.jumperLayer]-=h,this.vertsCounts[i.layerToJumpTo]+=h,this.UpdateRegionsForPossibleJumpersAndInsertJumpers(i.jumperLayer,e)}},o.IsJumper=function(e){return this.possibleJumperFeasibleIntervals.has(e)},o.UpdateRegionsForPossibleJumpersAndInsertJumpers=function(e,r){for(var c,i=new Set,h=C(this.dag.pred(r));!(c=h()).done;){var f=c.value;this.IsJumper(f)&&(this.CalculateRegionAndInsertJumper(f),i.add(f))}for(var y,p=C(this.dag.succ(r));!(y=p()).done;){var m=y.value;this.IsJumper(m)&&(this.CalculateRegionAndInsertJumper(m),i.add(m))}for(var E,P=new Array,L=C(this.possibleJumperFeasibleIntervals);!(E=L()).done;){var S=E.value;i.has(S[0])||S[1].x>e&&S[1].y<e&&P.push(S[0])}for(var T=0,O=P;T<O.length;T++)this.CalculateRegionAndInsertJumper(O[T])},o.InitJumpers=function(){for(var i,e=new Array(this.dag.nodeCount).fill(0),r=C(this.dag.edges);!(i=r()).done;){var h=i.value;e[h.source]-=h.weight,e[h.target]+=h.weight}this.possibleJumperFeasibleIntervals=new Map;for(var c=0;c<this.dag.nodeCount;c++)0===e[c]&&this.CalculateRegionAndInsertJumper(c)},o.CalculateRegionAndInsertJumper=function(e){var r=new Lt(this.Up(e),this.Down(e));this.possibleJumperFeasibleIntervals.set(e,r),this.InsertJumper(r.x,r.y,e)},o.InsertJumper=function(e,r,i){null!=this.CalcJumpInfo(e,r,i)&&this.jumpers.add(i)},o.CalcJumpInfo=function(e,r,i){for(var h=this.layering[i],c=-1,f=this.vertsCounts[h]-2*this.nodeCount[i],p=e-1;p>h;p--)this.vertsCounts[p]<f&&(f=this.vertsCounts[p],c=p);for(var y=h-1;y>r;y--)this.vertsCounts[y]<f&&(f=this.vertsCounts[y],c=y);if(-1!==c)return{jumperLayer:h,layerToJumpTo:c}},o.Up=function(e){for(var h,r=Number.MAX_SAFE_INTEGER,i=C(this.dag.inEdges[e]);!(h=i()).done;){var c=h.value,f=this.layering[c.source]-c.separation+1;f<r&&(r=f)}return r===Number.MAX_SAFE_INTEGER&&(r=this.layering[e]+1),r},o.Down=function(e){for(var h,r=Number.NEGATIVE_INFINITY,i=C(this.dag.outEdges[e]);!(h=i()).done;){var c=h.value,f=this.layering[c.target]+c.separation-1;f>r&&(r=f)}return r===Number.NEGATIVE_INFINITY&&(r=this.layering[e]-1),r},o.CalculateLayerCounts=function(){this.vertsCounts=new Array(Math.max.apply(Math,this.layering)+1).fill(0);for(var r,e=C(this.layering);!(r=e()).done;){var i=r.value;this.vertsCounts[i]+=this.nodeCount[i]}},o.ChooseJumper=function(){for(var r,e=C(this.jumpers);!(r=e()).done;)return r.value;throw new Error("there are no jumpers to choose")},s}(Vt);function Ue(){Ue=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ka=function(){function l(o){this.Initialize(o)}var s=l.prototype;return s.Initialize=function(t){this.BaseGraph=t,this.totalNumberOfNodes=t.nodeCount;for(var r,e=C(this.BaseGraph.edges);!(r=e()).done;){var i=r.value;if(null!=i.LayerEdges)for(var c,h=C(i.LayerEdges);!(c=h()).done;){var f=c.value,p=Math.max(f.Source,f.Target)+1;p>this.totalNumberOfNodes&&(this.totalNumberOfNodes=p)}}this.firstVirtualNode=Number.POSITIVE_INFINITY;for(var m,y=C(this.BaseGraph.edges);!(m=y()).done;){var P=m.value;if(null!=P.LayerEdges)for(var L=1;L<P.LayerEdges.length;L++)this.firstVirtualNode=Math.min(this.firstVirtualNode,P.LayerEdges[L].Source)}this.firstVirtualNode===Number.POSITIVE_INFINITY&&(this.firstVirtualNode=this.BaseGraph.nodeCount,this.totalNumberOfNodes=this.BaseGraph.nodeCount),this.virtualNodesToInEdges=new Array(this.totalNumberOfNodes-this.firstVirtualNode),this.virtualNodesToOutEdges=new Array(this.totalNumberOfNodes-this.firstVirtualNode);for(var T,S=C(this.BaseGraph.edges);!(T=S()).done;){var O=T.value;if(O.LayerSpan>0)for(var B,x=C(O.LayerEdges);!(B=x()).done;){var M=B.value;M.Target!==O.target&&(this.virtualNodesToInEdges[M.Target-this.firstVirtualNode]=M),M.Source!==O.source&&(this.virtualNodesToOutEdges[M.Source-this.firstVirtualNode]=M)}}},s.edges_=Ue().mark(function o(){var t,e,r,i,h,c;return Ue().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:t=C(this.BaseGraph.edges);case 1:if((e=t()).done){p.next=13;break}if(!((r=e.value).LayerSpan>0)){p.next=11;break}i=C(r.LayerEdges);case 5:if((h=i()).done){p.next=11;break}return c=h.value,p.next=9,c;case 9:p.next=5;break;case 11:p.next=1;break;case 13:case"end":return p.stop()}},o,this)}),s.InEdges=Ue().mark(function o(t){var e,r,i;return Ue().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(t<this.BaseGraph.nodeCount)){c.next=11;break}e=C(this.BaseGraph.inEdges[t]);case 2:if((r=e()).done){c.next=9;break}if((i=r.value).source===i.target||null==i.LayerEdges){c.next=7;break}return c.next=7,l.LastEdge(i);case 7:c.next=2;break;case 9:c.next=14;break;case 11:if(!(t>=this.firstVirtualNode)){c.next=14;break}return c.next=14,this.InEdgeOfVirtualNode(t);case 14:case"end":return c.stop()}},o,this)}),l.LastEdge=function(t){return t.LayerEdges[t.LayerEdges.length-1]},s.InEdgeOfVirtualNode=function(t){return this.virtualNodesToInEdges[t-this.firstVirtualNode]},s.OutEdges=Ue().mark(function o(t){var e,r,i;return Ue().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(t<this.BaseGraph.nodeCount)){c.next=11;break}e=C(this.BaseGraph.outEdges[t]);case 2:if((r=e()).done){c.next=9;break}if((i=r.value).source===i.target||null==i.LayerEdges){c.next=7;break}return c.next=7,l.FirstEdge(i);case 7:c.next=2;break;case 9:c.next=14;break;case 11:if(!(t>=this.firstVirtualNode)){c.next=14;break}return c.next=14,this.OutEdgeOfVirtualNode(t);case 14:case"end":return c.stop()}},o,this)}),s.OutDegreeIsMoreThanOne=function(t){return t<this.BaseGraph.nodeCount&&this.BaseGraph.outEdges[t].length>1},s.InDegreeIsMoreThanOne=function(t){return t<this.BaseGraph.nodeCount&&this.BaseGraph.inEdges[t].length>1},s.OutEdgeOfVirtualNode=function(t){return this.virtualNodesToOutEdges[t-this.firstVirtualNode]},l.FirstEdge=function(t){return t.LayerEdges[0]},s.InEdgesCount=function(t){return this.RealInEdgesCount(t)},s.RealInEdgesCount=function(t){return t<this.BaseGraph.nodeCount?this.BaseGraph.inEdges[t].filter(function(e){return null!=e.LayerEdges}).length:1},s.OutEdgesCount=function(t){return this.RealOutEdgesCount(t)},s.RealOutEdgesCount=function(t){return t<this.BaseGraph.nodeCount?this.BaseGraph.outEdges[t].filter(function(e){return null!=e.LayerEdges}).length:1},s.IsRealNode=function(t){return t<this.BaseGraph.nodeCount},s.IsVirtualNode=function(t){return!this.IsRealNode(t)},s.ReversedClone=function(){var t=this.CreateReversedEdges();return new l(new Fi(t,this.BaseGraph.nodeCount))},s.CreateReversedEdges=function(){for(var r,t=new Array,e=C(this.BaseGraph.edges);!(r=e()).done;){var i=r.value;i.isSelfEdge()||t.push(i.reversedClone())}return t},s.Succ=Ue().mark(function o(t){var e,r,i;return Ue().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.OutEdges(t));case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i.Target;case 5:c.next=1;break;case 7:case"end":return c.stop()}},o,this)}),s.Pred=Ue().mark(function o(t){var e,r,i;return Ue().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.InEdges(t));case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i.Source;case 5:c.next=1;break;case 7:case"end":return c.stop()}},o,this)}),Q(l,[{key:"Edges",get:function(){return this.edges_()}},{key:"NodeCount",get:function(){return this.totalNumberOfNodes}}]),l}(),ml=function(){function l(o,t,e,r){this.la=t,this.database=e,this.layeredGraph=o,this.intGraph=r}l.InsertLayers=function(t,e,r,i){var h=new l(t,e,r,i);return h.InsertLayers(),{layeredGraph:h.nLayeredGraph,la:h.Nla.DropEmptyLayers()}};var s=l.prototype;return s.InsertLayers=function(){this.EditOldLayering(),this.CreateFullLayeredGraph(),this.InitNewLayering(),this.MapVirtualNodesToEdges(),this.FillUnsortedNewOddLayers(),this.WidenOriginalLayers(),this.SortNewOddLayers()},s.EditOldLayering=function(){for(var r,t=this.intGraph.nodeCount,e=C(this.database.RegularMultiedges());!(r=e()).done;){var h,i=r.value,c=i[0];if((h=2*c.LayerSpan)>0){for(var p,f=C(c.LayerEdges);!(p=f()).done;){var y=p.value;y.Target!==c.target&&(t++,this.UpdateOldLayer(t++,y.Target))}t+=(h-1)*(i.length-1)+1}}},s.UpdateOldLayer=function(t,e){this.la.Layers[this.la.y[e]][this.la.x[e]]=t},s.WidenOriginalLayers=function(){for(var t=0;t<this.la.Layers.length;t++)for(var h,e=this.Nla.Layers[2*t],r=0,i=C(this.la.Layers[t]);!(h=i()).done;){var c=h.value,f=this.virtNodesToIntEdges[c];if(null!=f)for(var P,p=this.NLayering[f.source]-this.NLayering[c],m=C(this.database.Multiedges.get(f.source,f.target));!(P=m()).done;){var L=P.value;if(L!==f){var E=L.LayerEdges[p].Source;e[r]=E,this.Nla.x[E]=r++}else e[r]=c,this.Nla.x[c]=r++}else e[r]=c,this.Nla.x[c]=r++}},s.FillUnsortedNewOddLayers=function(){for(var t=new Array(this.Nla.Layers.length).fill(0),e=this.intGraph.nodeCount;e<this.nLayeredGraph.NodeCount;e++){var r=this.NLayering[e];r%2==1&&(this.Nla.Layers[r][t[r]++]=e)}},s.MapVirtualNodesToEdges=function(){this.virtNodesToIntEdges=new Array(this.NLayering.length);for(var e,t=C(this.database.AllIntEdges());!(e=t()).done;){var r=e.value;if(r.source!==r.target&&null!=r.LayerEdges)for(var h,i=C(r.LayerEdges);!(h=i()).done;){var c=h.value;c.Target!==r.target&&(this.virtNodesToIntEdges[c.Target]=r)}}},s.CreateFullLayeredGraph=function(){this.totalNodes=this.intGraph.nodeCount;for(var e,t=C(this.database.RegularMultiedges());!(e=t()).done;)for(var f,i=0,h=!0,c=C(e.value);!(f=c()).done;){var p=f.value;if(h&&(h=!1,i=2*p.LayerSpan),i>0){p.LayerEdges=new Array(i);for(var y=0;y<i;y++){var m={currentVV:this.totalNodes},P=ts.GetSource(m,p,y);this.totalNodes=m.currentVV;var L=ts.GetTarget(this.totalNodes,p,y,i);p.LayerEdges[y]=new Vr(P,L,p.CrossingWeight)}l.RegisterDontStepOnVertex(this.database,p)}}this.nLayeredGraph=new Ka(this.intGraph)},s.SortNewOddLayers=function(){for(var t=1;t<this.Nla.Layers.length;t+=2){for(var h,e=new ho,r=this.Nla.Layers[t],i=C(r);!(h=i()).done;){for(var y,c=h.value,f=-1,p=C(this.nLayeredGraph.InEdges(c));!(y=p()).done;)f=y.value.Source;for(var E,P=-1,L=C(this.nLayeredGraph.OutEdges(c));!(E=L()).done;)P=E.value.Target;var T=this.Nla.x[f]+this.Nla.x[P];if(e.has(T)){var O=e.get(T);if("number"==typeof O){var x=new Array;x.push(O),x.push(c),e.set(T,x)}else O.push(c)}else e.set(T,c)}for(var A,M=0,F=C(e.values());!(A=F()).done;){var z=A.value;if("number"==typeof z)r[M++]=z;else for(var Y,V=C(z);!(Y=V()).done;)r[M++]=Y.value}for(var _=0;_<r.length;_++)this.Nla.x[r[_]]=_}},s.InitNewLayering=function(){this.Nla=new Xn(new Array(this.totalNodes));for(var t=0;t<this.layeredGraph.NodeCount;t++)this.NLayering[t]=2*this.la.y[t];for(var r,e=C(this.database.Multiedges.keyValues());!(r=e()).done;){var i=r.value,h=i[0];if(h.x!==h.y&&this.la.y[h.x]!==this.la.y[h.y])for(var y,f=2*this.la.y[h.x],p=C(i[1]);!(y=p()).done;)for(var E,m=y.value,P=f-1,L=C(m.LayerEdges);!(E=L()).done;){var S=E.value;S.Target!==m.target&&(this.NLayering[S.Target]=P--)}}for(var B,T=new Array(2*this.la.Layers.length-1),O=new Array(T.length).fill(0),x=C(this.NLayering);!(B=x()).done;)O[B.value]++;for(var F=0;F<O.length;F++)T[F]=new Array(O[F]);this.Nla=new Xn(this.NLayering),this.Nla.Layers=T},l.RegisterDontStepOnVertex=function(t,e){t.Multiedges.get(e.source,e.target).length>1&&t.MultipleMiddles.add(e.LayerEdges[e.LayerEdges.length/2].Source)},Q(l,[{key:"NLayering",get:function(){return this.Nla.y}}]),l}(),ts=function(){function l(o,t,e,r){this.virtNodesToIntEdges=new Map,this.la=t,this.database=e,this.layeredGraph=o,this.intGraph=r}l.InsertPaths=function(t,e,r,i){var h=new l(t,e,r,i);return h.InsertPaths(),{layeredGraph:h.NLayeredGraph,la:h.Nla}};var s=l.prototype;return s.InsertPaths=function(){this.CreateFullLayeredGraph(),this.InitNewLayering(),this.MapVirtualNodesToEdges(),this.WidenOriginalLayers()},s.WidenOriginalLayers=function(){for(var t=0;t<this.la.Layers.length;t++)for(var h,e=this.Nla.Layers[t],r=0,i=C(this.la.Layers[t]);!(h=i()).done;){var c=h.value,f=this.virtNodesToIntEdges.get(c);if(null!=f)for(var P,p=this.NLayering[f.source]-this.NLayering[c],m=C(this.database.Multiedges.get(f.source,f.target));!(P=m()).done;){var L=P.value;if(!this.EdgeIsFlat(L))if(L!==f){var E=L.LayerEdges[p].Source;e[r]=E,this.Nla.x[E]=r++}else e[r]=c,this.Nla.x[c]=r++}else e[r]=c,this.Nla.x[c]=r++}},s.EdgeIsFlat=function(t){return this.la.y[t.source]===this.la.y[t.target]},s.MapVirtualNodesToEdges=function(){for(var e,t=C(this.database.RegularMultiedges());!(e=t()).done;)for(var h,i=C(e.value);!(h=i()).done;){var c=h.value;if(!this.EdgeIsFlat(c))for(var p,f=C(c.LayerEdges);!(p=f()).done;){var y=p.value;y.Target!==c.target&&this.virtNodesToIntEdges.set(y.Target,c)}}},s.CreateFullLayeredGraph=function(){for(var r,t=this.layeredGraph.NodeCount,e=C(this.database.Multiedges.keyValues());!(r=e()).done;){var i=r.value,h=i[0];if(h.x!==h.y)for(var m,f=!0,p=0,y=C(i[1]);!(m=y()).done;){var P=m.value;if(f)f=!1,p=P.LayerSpan;else if(P.LayerEdges=new Array(p),1===p)P.LayerEdges[0]=new Vr(P.source,P.target,P.CrossingWeight);else for(var L=0;L<p;L++){var E={currentVV:t},S=l.GetSource(E,P,L),T=l.GetTarget(t=E.currentVV,P,L,p);P.LayerEdges[L]=new Vr(S,T,P.CrossingWeight)}ml.RegisterDontStepOnVertex(this.database,P)}}this.NLayeredGraph=new Ka(this.intGraph)},l.GetTarget=function(t,e,r,i){return r<i-1?t:e.target},l.GetSource=function(t,e,r){return 0===r?e.source:t.currentVV++},s.InitNewLayering=function(){this.Nla=new Xn(new Array(this.NLayeredGraph.NodeCount));for(var t=0;t<this.layeredGraph.NodeCount;t++)this.NLayering[t]=this.la.y[t];for(var r,e=C(this.database.Multiedges.keyValues());!(r=e()).done;){var i=r.value,h=i[0];if(h.x!==h.y&&this.la.y[h.x]!==this.la.y[h.y])for(var m,f=0,p=!0,y=C(i[1]);!(m=y()).done;){var P=m.value;p&&(p=!1,f=this.la.y[P.source]);for(var S,L=f-1,E=C(P.LayerEdges);!(S=E()).done;)this.NLayering[S.value.Target]=L--}}for(var M,O=new Array(this.la.Layers.length),x=new Array(O.length).fill(0),B=C(this.NLayering);!(M=B()).done;)x[M.value]++;for(var A=0;A<x.length;A++)O[A]=new Array(x[A]);this.Nla=new Xn(this.NLayering),this.Nla.Layers=O},Q(l,[{key:"NLayering",get:function(){return this.Nla.y}}]),l}(),Bi=function(){function l(o,t,e){this.numberOfCrossings=t,this.la=o,this.virtVertexStart=e}var s=l.prototype;return s.LayerGroupDisbalance=function(t,e,r){return 1===e?this.LayerGroupDisbalanceWithOrigSeparators(t,r):this.LayerGroupDisbalanceWithVirtSeparators(t,e)},s.LayerGroupDisbalanceWithVirtSeparators=function(t,e){for(var r=0,i=0;i<t.length;){var h=this.CurrentOrigGroupDelta(i,t,e);i=h.i,r+=h.ret}return r},s.CurrentOrigGroupDelta=function(t,e,r){for(var i=0,h=t;h<e.length&&e[h]<this.virtVertexStart;h++)i++;return t=h+1,{ret:Math.abs(r-i),i:t}},s.LayerGroupDisbalanceWithOrigSeparators=function(t,e){for(var r=0,i=0;i<t.length;){var h=this.CurrentVirtGroupDelta(i,t,e);r+=h.ret,i=h.i}return r},s.CurrentVirtGroupDelta=function(t,e,r){for(var i=0,h=t;h<e.length&&e[h]>=this.virtVertexStart;h++)i++;return t=h+1,{ret:Math.abs(r-i),i:t}},l.less=function(t,e){return t.numberOfCrossings<e.numberOfCrossings},l.greater=function(t,e){return t.numberOfCrossings>e.numberOfCrossings},s.IsPerfect=function(){return 0===this.numberOfCrossings},l}(),ud=function(){function l(o){this.x=o}return l.prototype.Compare=function(t,e){var r=this.x[t.Source]-this.x[e.Source];return 0!==r?r:this.x[t.Target]-this.x[e.Target]},l}(),ld=function(){function l(o){this.x=o}return l.prototype.Compare=function(t,e){var r=this.x[t.Target]-this.x[e.Target];return 0!==r?r:this.x[t.Source]-this.x[e.Source]},l}();function Eo(){return 0===di(2)}function hd(l,s,o){var t=o.Layers[l+1],e=o.Layers[l];return e.length<=t.length?function(l,s,o){var t=wl(l,s),e=new ud(o.x);t.sort(function(P,L){return e.Compare(P,L)});for(var r=1;r<l.length;)r*=2;var i=new Array(2*r-1).fill(0);r--;for(var f,h=0,c=C(t);!(f=c()).done;){var p=f.value,y=r+o.x[p.Target],m=p.CrossingWeight;for(i[y]+=m;y>0;)y%2!=0&&(h+=m*i[y+1]),i[y=Math.floor((y-1)/2)]+=m}return h}(e,s,o):function(l,s,o,t){var e=wl(s,o),r=new ld(t.x);e.sort(function(L,E){return r.Compare(L,E)});for(var i=1;i<l.length;)i*=2;var h=new Array(2*i-1).fill(0);i--;for(var p,c=0,f=C(e);!(p=f()).done;){var y=p.value,m=i+t.x[y.Source],P=y.CrossingWeight;for(h[m]+=P;m>0;)m%2!=0&&(c+=P*h[m+1]),h[m=Math.floor((m-1)/2)]+=P}return c}(t,e,s,o)}function wl(l,s){return ai(l,function(o){return s.InEdges(o)})}function Pl(l,s){for(var o=0,t=0;t<s.Layers.length-1;t++)o+=hd(t,l,s);return o}var dd=function(l){function s(t,e,r,i,h,c,f){var p;return(p=l.call(this,f)||this).tryReverse=!0,p.MaxNumberOfAdjacentExchanges=50,p.cancelToken=f,p.tryReverse=e,p.startOfVirtNodes=i,p.layerArrays=r,p.layering=r.y,p.nOfLayers=r.Layers.length,p.layers=r.Layers,p.properLayeredGraph=t,p.hasCrossWeights=h,p.SugSettings=c,p}X(s,l),s.OrderLayers=function(e,r,i,h,c){for(var y,f=!1,p=C(e.Edges);!(y=p()).done;)if(1!==y.value.CrossingWeight){f=!0;break}new s(e,!0,r,i,f,h,c).run()};var o=s.prototype;return o.run=function(){if(this.Calculate(),this.tryReverse){var e=this.layerArrays.ReversedClone(),r=new s(this.properLayeredGraph.ReversedClone(),!1,e,this.startOfVirtNodes,this.hasCrossWeights,this.SugSettings,this.cancelToken);if(r.run(),Bi.less(r.measure,this.measure)){for(var i=0;i<this.nOfLayers;i++)Za(e.Layers[i],this.layerArrays.Layers[this.nOfLayers-1-i]);this.layerArrays.UpdateXFromLayers()}}},o.Calculate=function(){this.Init(),this.layerArraysCopy=s.CloneLayers(this.layers,this.layerArraysCopy);var e=0;this.measure=new Bi(this.layerArraysCopy,Pl(this.properLayeredGraph,this.layerArrays),this.startOfVirtNodes);for(var r=0;r<this.MaxOfIterations&&e<this.NoGainStepsBound&&!this.measure.IsPerfect();r++){this.LayerByLayerSweep(r%2==0),this.AdjacentExchange();var h=new Bi(this.layerArrays.Layers,Pl(this.properLayeredGraph,this.layerArrays),this.startOfVirtNodes);Bi.less(this.measure,h)?(this.Restore(),e++):(Bi.less(h,this.measure)||Eo())&&(e=0,this.layerArraysCopy=s.CloneLayers(this.layers,this.layerArraysCopy),this.measure=h)}},s.CloneLayers=function(e,r){if(null==r){r=new Array(e.length);for(var i=0;i<e.length;i++)r[i]=e[i].map(function(c){return c})}else for(var h=0;h<e.length;h++)Za(e[h],r[h]);return r},o.Restore=function(){this.layerArrays.updateLayers(this.layerArraysCopy)},o.LayerByLayerSweep=function(e){if(e)for(var r=1;r<this.nOfLayers;r++)this.SweepLayer(r,!0);else for(var i=this.nOfLayers-2;i>=0;i--)this.SweepLayer(i,!1)},o.SweepLayer=function(e,r){for(var i=this.layers[e],h=new Array(i.length),c=0;c<h.length;c++)h[c]=this.WMedian(i[c],r);this.Sort(e,h);for(var f=this.layerArrays.Layers[e],p=0;p<f.length;p++)this.layerArrays.x[f[p]]=p},o.Sort=function(e,r){for(var p,i=new ho,h=this.layers[e],c=0,f=C(r);!(p=f()).done;){var y=p.value,m=h[c++];if(-1!==y)if(i.has(y)){var P=i.get(y);if("number"!=typeof P){var L=P;if(Eo())L.push(m);else{var E=di(L.length),S=L[E];L[E]=m,L.push(S)}}else{var T=P,O=new Array;i.set(y,O),Eo()?(O.push(T),O.push(m)):(O.push(m),O.push(T))}}else i.set(y,m)}var x=i.values();for(c=0;c<h.length;)if(-1!==r[c]){var B=x.next().value;if("number"==typeof B)h[c++]=B;else for(var A,F=C(B);!(A=F()).done;){for(var z=A.value;-1===r[c];)c++;h[c++]=z}}else c++},o.WMedian=function(e,r){var i,h;if(r?(i=this.properLayeredGraph.OutEdges(e),h=this.properLayeredGraph.OutEdgesCount(e)):(i=this.properLayeredGraph.InEdges(e),h=this.properLayeredGraph.InEdgesCount(e)),0===h)return-1;var c=new Array(h),f=0;if(r)for(var y,p=C(i);!(y=p()).done;)c[f++]=this.X[y.value.Target];else for(var L,P=C(i);!(L=P()).done;)c[f++]=this.X[L.value.Source];c.sort(function(x,B){return x-B});var S=Math.floor(h/2);if(h%2==1)return c[S];if(2===h)return.5*(c[0]+c[1]);var T=c[S-1]-c[0],O=c[h-1]-c[S];return Math.floor((c[S-1]*T+c[S]*O)/(T+O))},o.Init=function(){for(var e=new Array(this.nOfLayers).fill(0),r=new jt.K,i=0;i<this.properLayeredGraph.NodeCount;i++)0===this.properLayeredGraph.InEdgesCount(i)&&r.push(i);for(var h=new Array(this.properLayeredGraph.NodeCount).fill(!1);r.size>0;){var c=r.pop(),f=this.layerArrays.y[c];this.layerArrays.Layers[f][e[f]]=c,this.layerArrays.x[c]=e[f],e[f]++;for(var y,p=C(this.properLayeredGraph.Succ(c));!(y=p()).done;){var m=y.value;h[m]||(h[m]=!0,r.push(m))}}this.X=this.layerArrays.x},o.AdjacentExchange=function(){this.InitArrays();for(var e=0,r=!0;r&&e++<this.MaxNumberOfAdjacentExchanges;){r=!1;for(var i=0;i<this.layers.length;i++)r=this.AdjExchangeLayer(i)||r;for(var h=this.layers.length-2;h>=0;h--)r=this.AdjExchangeLayer(h)||r}},o.AllocArrays=function(){var e=this.properLayeredGraph.NodeCount;this.predecessors=new Array(e),this.successors=new Array(e),this.pOrder=new Array(e),this.sOrder=new Array(e),this.hasCrossWeights&&(this.outCrossingCount=new Array(e),this.inCrossingCount=new Array(e));for(var r=0;r<e;r++){var i=this.properLayeredGraph.InEdgesCount(r);if(this.predecessors[r]=new Array(i),this.hasCrossWeights)for(var f,h=this.inCrossingCount[r]=new Map,c=C(this.properLayeredGraph.InEdges(r));!(f=c()).done;){var p=f.value;h.set(p.Source,p.CrossingWeight)}if(this.pOrder[r]=new Map,i=this.properLayeredGraph.OutEdgesCount(r),this.successors[r]=new Array(i),this.sOrder[r]=new Map,this.hasCrossWeights)for(var P,y=this.outCrossingCount[r]=new Map,m=C(this.properLayeredGraph.OutEdges(r));!(P=m()).done;){var L=P.value;y.set(L.Target,L.CrossingWeight)}}},o.InitArrays=function(){null==this.successors&&this.AllocArrays();for(var e=0;e<this.properLayeredGraph.NodeCount;e++)this.pOrder[e]=new Map,this.sOrder[e]=new Map;for(var i,r=C(this.layers);!(i=r()).done;)this.InitPsArraysForLayer(i.value)},o.CalcPair=function(e,r){var i=this.successors[e],h=this.successors[r],c=this.predecessors[e],f=this.predecessors[r];if(this.hasCrossWeights){var p=this.outCrossingCount[e],y=this.outCrossingCount[r],m=this.inCrossingCount[e],P=this.inCrossingCount[r];return{cuv:this.CountOnArraysUV(i,h,p,y)+this.CountOnArraysUV(c,f,m,P),cvu:this.CountOnArraysUV(h,i,y,p)+this.CountOnArraysUV(f,c,P,m)}}return{cuv:this.CountOnArrays(i,h)+this.CountOnArrays(c,f),cvu:this.CountOnArrays(h,i)+this.CountOnArrays(f,c)}},o.InitPsArraysForLayer=function(e){for(var i,r=C(e);!(i=r()).done;){for(var f,h=i.value,c=C(this.properLayeredGraph.Pred(h));!(f=c()).done;){var p=f.value,y=this.sOrder[p],m=y.size;this.successors[p][m]=h,y.set(h,m)}for(var L,P=C(this.properLayeredGraph.Succ(h));!(L=P()).done;){var E=L.value,S=this.pOrder[E],T=S.size;this.predecessors[E][T]=h,S.set(h,T)}}},o.CountOnArrays=function(e,r){for(var y,i=0,h=r.length-1,c=-1,f=0,p=C(e);!(y=p()).done;){for(var P=this.X[y.value];c<h&&this.X[r[c+1]]<P;c++)f++;i+=f}return i},o.CountOnArraysUV=function(e,r,i,h){for(var P,c=0,f=r.length-1,p=-1,y=0,m=C(e);!(P=m()).done;){for(var L=P.value,E=this.X[L],S=void 0;p<f&&this.X[S=r[p+1]]<E;p++)y+=h.get(S);c+=y*i.get(L)}return c},o.AdjExchangeLayer=function(e){var r=this.layers[e];return!!this.ExchangeWithGainWithNoDisturbance(r)||(this.DisturbLayer(r),this.ExchangeWithGainWithNoDisturbance(r))},o.Swap=function(e,r){var i=this.X[e],h=this.X[r],f=this.layers[this.layering[e]];f[i]=r,f[h]=e,this.X[e]=h,this.X[r]=i,this.UpdateSsContainingUv(e,r),this.UpdatePsContainingUv(e,r)},o.UpdatePsContainingUv=function(e,r){if(this.successors[e].length<=this.successors[r].length)for(var h,i=C(this.successors[e]);!(h=i()).done;){var c=h.value,f=this.pOrder[c];if(f.has(r)){var p=f.get(r),y=this.predecessors[c];y[p-1]=r,y[p]=e,f.set(r,p-1),f.set(e,p)}}else for(var P,m=C(this.successors[r]);!(P=m()).done;){var L=P.value,E=this.pOrder[L];if(E.has(e)){var S=E.get(r),T=this.predecessors[L];T[S-1]=r,T[S]=e,E.set(r,S-1),E.set(e,S)}}},o.UpdateSsContainingUv=function(e,r){if(this.predecessors[e].length<=this.predecessors[r].length)for(var h,i=C(this.predecessors[e]);!(h=i()).done;){var c=h.value,f=this.sOrder[c];if(f.has(r)){var p=f.get(r),y=this.successors[c];y[p-1]=r,y[p]=e,f.set(r,p-1),f.set(e,p)}}else for(var P,m=C(this.predecessors[r]);!(P=m()).done;){var L=P.value,E=this.sOrder[L];if(E.has(e)){var S=E.get(r),T=this.successors[L];T[S-1]=r,T[S]=e,E.set(r,S-1),E.set(e,S)}}},o.DisturbLayer=function(e){for(var r=0;r<e.length-1;r++)this.AdjacentSwapToTheRight(e,r)},o.ExchangeWithGainWithNoDisturbance=function(e){var i,r=!1;do{i=this.ExchangeWithGain(e),r=r||i}while(i);return r},o.ExchangeWithGain=function(e){for(var r=0;r<e.length-1;r++)if(this.SwapWithGain(e[r],e[r+1]))return this.SwapToTheLeft(e,r),this.SwapToTheRight(e,r+1),!0;return!1},o.SwapToTheLeft=function(e,r){for(var i=r-1;i>=0;i--)this.AdjacentSwapToTheRight(e,i)},o.SwapToTheRight=function(e,r){for(var i=r;i<e.length-1;i++)this.AdjacentSwapToTheRight(e,i)},o.AdjacentSwapToTheRight=function(e,r){var i=e[r],h=e[r+1],c=this.SwapGain(i,h);(c>0||0===c&&Eo())&&this.Swap(i,h)},o.SwapGain=function(e,r){var i=this.CalcPair(e,r);return i.cuv-i.cvu},o.UvAreOfSameKind=function(e,r){return e<this.startOfVirtNodes&&r<this.startOfVirtNodes||e>=this.startOfVirtNodes&&r>=this.startOfVirtNodes},o.NeighborsForbidTheSwap=function(e,r){return this.UpperNeighborsForbidTheSwap(e,r)||this.LowerNeighborsForbidTheSwap(e,r)},o.LowerNeighborsForbidTheSwap=function(e,r){var i,h;return 0!==(i=this.properLayeredGraph.OutEdgesCount(e))&&0!==(h=this.properLayeredGraph.OutEdgesCount(r))&&this.X[this.successors[e][i>>1]]<this.X[this.successors[r][h>>1]]},o.UpperNeighborsForbidTheSwap=function(e,r){var i=this.properLayeredGraph.InEdgesCount(e),h=this.properLayeredGraph.InEdgesCount(r);return 0!==i&&0!==h&&this.X[this.predecessors[e][i>>1]]<this.X[this.predecessors[r][h>>1]]},o.CalcDeltaBetweenGroupsToTheLeftAndToTheRightOfTheSeparator=function(e,r,i){for(var h=this.GetKindDelegate(i),c=0,f=r-1;f>=0&&!h(e[f]);f--)c++;for(var p=0,y=r+1;y<e.length&&!h(e[y]);y++)p++;return c-p},o.IsOriginal=function(e){return e<this.startOfVirtNodes},o.IsVirtual=function(e){return e>=this.startOfVirtNodes},o.GetKindDelegate=function(e){return this.IsVirtual(e)?this.IsVirtual:this.IsOriginal},o.SwapWithGain=function(e,r){return this.SwapGain(e,r)>0&&(this.Swap(e,r),!0)},Q(s,[{key:"NoGainStepsBound",get:function(){return this.SugSettings.NoGainAdjacentSwapStepsBound*this.SugSettings.RepetitionCoefficientForOrdering}},{key:"SeedOfRandom",get:function(){return di(100)}},{key:"MaxOfIterations",get:function(){return this.SugSettings.MaxNumberOfPassesInOrdering*this.SugSettings.RepetitionCoefficientForOrdering}}]),s}(Vt),vd=function(){function l(o,t,e){this.properLayeredGraph=o,this.layerArrays=t,this.nodePositions=e}l.UpdateLayerArrays0=function(t,e,r){new l(t,e,r).UpdateLayerArrays()},l.UpdateLayerArrays1=function(t,e){var r=l.BuildInitialNodePositions(t,e);this.UpdateLayerArrays0(t,e,r)},l.BuildInitialNodePositions=function(t,e){for(var r=new Map,i=0;i<e.Layers.length;i++)for(var h=0,c=0;h<e.Layers[i].length;){for(;h<e.Layers[i].length&&t.IsVirtualNode(e.Layers[i][h]);)h++;for(var f=c;f<h;f++)r.set(e.Layers[i][f],new R(i,c));h<e.Layers[i].length&&r.set(e.Layers[i][h],new R(i,h)),c=++h}return r};var s=l.prototype;return s.UpdateLayerArrays=function(){var t=this.CreateInitialOrdering();t=this.BuildOrdering(t),this.RestoreLayerArrays(t)},s.CreateInitialOrdering=function(){for(var r,t=new Ee,e=C(this.layerArrays.Layers);!(r=e()).done;)for(var c,h=C(r.value);!(c=h()).done;){var f=c.value,p=this.nodePositions.get(f);t.hasxy(p.x,p.y)||t.setxy(p.x,p.y,[]),t.getxy(p.x,p.y).push(f)}return t},s.BuildOrdering=function(t){for(var h,e=new Ee,r=new Map,i=C(this.layerArrays.Layers);!(h=i()).done;)for(var p,f=C(h.value);!(p=f()).done;){var m=this.nodePositions.get(p.value);e.hasxy(m.x,m.y)||(this.BuildNodeOrdering(t.get(m),r),e.set(m,t.get(m)))}return e},s.BuildNodeOrdering=function(t,e){t.sort(this.Comparison(e));for(var r=0;r<t.length;r++)e.set(t[r],r)},s.firstSucc=function(t){for(var r,e=C(this.properLayeredGraph.Succ(t));!(r=e()).done;)return r.value},s.firstPred=function(t){for(var r,e=C(this.properLayeredGraph.Pred(t));!(r=e()).done;)return r.value},s.Comparison=function(t){var e=this;return function(r,i){var h=e.firstSucc(r),c=e.firstSucc(i),f=e.firstPred(r),p=e.firstPred(i),y=e.nodePositions.get(h),m=e.nodePositions.get(c),P=e.nodePositions.get(f),L=e.nodePositions.get(p);if(!y.equal(m))return P.equal(L)?y.compareTo(m):P.compareTo(L);if(e.properLayeredGraph.IsVirtualNode(h))return P.equal(L)?It(t.get(h),t.get(c)):P.compareTo(L);for(;e.nodePositions.get(f).equal(e.nodePositions.get(p))&&e.properLayeredGraph.IsVirtualNode(f);)f=e.firstPred(f),p=e.firstPred(p);return e.nodePositions.get(f).equal(e.nodePositions.get(p))?It(r,i):e.nodePositions.get(f).compareTo(e.nodePositions.get(p))}},s.RestoreLayerArrays=function(t){for(var r,e=C(this.layerArrays.Layers);!(r=e()).done;)for(var i=r.value,h=0,c=0;h<i.length;){for(;h<i.length&&this.nodePositions.get(i[c]).equal(this.nodePositions.get(i[h]));)h++;for(var f=t.get(this.nodePositions.get(i[c])),p=c;p<h;p++)i[p]=f[p-c];c=h}this.layerArrays.UpdateXFromLayers()},l}(),Sl=function(){function l(){}return l.getOrder=function(o,t){var e=Ke(t.map(function(r){return new Lt(r[0],r[1])}),o);return l.getOrderOnGraph(e)},l.getOrderOnGraph=function(o){for(var i,t=new Array(o.nodeCount).fill(!1),e=new jt.K,r=[],h=0;h<o.nodeCount;h++)if(!t[h]){var c=h;t[c]=!0;var f=0;for(i=o.outEdges[h];;){for(;f<i.length;f++){var p=i[f].target;t[p]||(t[p]=!0,e.push({edges:i,index:f+1,current_u:c}),i=o.outEdges[c=p],f=-1)}if(r.push(c),!(e.length>0))break;var y=e.pop();i=y.edges,f=y.index,c=y.current_u}}return r.reverse()},l}(),gd=function(){function l(o){this.graph=o}var s=l.prototype;return s.GetLayers=function(){for(var t=Sl.getOrderOnGraph(this.graph),e=new Array(this.graph.nodeCount).fill(0),r=this.graph.nodeCount;r-- >0;)for(var c,i=t[r],h=C(this.graph.inEdges[i]);!(c=h()).done;){var f=c.value,p=f.source,y=e[i]+f.separation;e[p]<y&&(e[p]=y)}return e},s.checkTopoOrder=function(t){for(var r,e=C(this.graph.edges);!(r=e()).done;)if(pd(r.value,t))return!1;return!0},l}();function pd(l,s){var o=s.findIndex(function(e){return e===l.source}),t=s.findIndex(function(e){return e===l.target});return-1===o||-1===t||o>=t}var Be=function(){function l(s){this.inTree=!1,this.cut=l.infinity,this.iedge=s}return Q(l,[{key:"source",get:function(){return this.iedge.source}},{key:"target",get:function(){return this.iedge.target}},{key:"separation",get:function(){return this.iedge.separation}},{key:"crossingWeight",get:function(){return this.iedge.CrossingWeight}},{key:"weight",get:function(){return this.iedge.weight}}]),l}();Be.infinity=Number.MAX_SAFE_INTEGER;var es=function(s,o,t,e,r){this.v=s,this.outEnum=o,this.i=t,this.inEnum=e,this.j=r},El=function(){function l(o,t){this.layers=null,this.treeVertices=[],this.vertices=[],this.leaves=[],this.graph=function(l){for(var t,s=new Array,o=C(l.edges);!(t=o()).done;)s.push(new Be(t.value));return Ke(s,l.nodeCount)}(o),this.networkCancelToken=t;for(var e=0;e<this.graph.nodeCount;e++)this.vertices.push({inTree:!1,lim:-1,low:-1,parent:null})}var s=l.prototype;return s.setLow=function(t,e){this.vertices[t].low=e},s.setLim=function(t,e){this.vertices[t].lim=e},s.setParent=function(t,e){this.vertices[t].parent=e},s.GetLayers=function(){return null==this.layers&&this.run(),this.layers},s.shiftLayerToZero=function(){for(var t=Math.min.apply(Math,this.layers),e=0;e<this.layers.length;e++)this.layers[e]-=t},s.addVertexToTree=function(t){this.vertices[t].inTree=!0},s.vertexInTree=function(t){return this.vertices[t].inTree},s.lim=function(t){return this.vertices[t].lim},s.low=function(t){return this.vertices[t].low},s.parent=function(t){return this.vertices[t].parent},s.feasibleTree=function(){for(this.initLayers();this.tightTree()<this.nodeCount;){var t=this.getNonTreeEdgeIncidentToTheTreeWithMinimalAmountOfSlack();if(null==t)break;var e=this.slack(t);this.vertexInTree(t.source)&&(e=-e);for(var i,r=C(this.treeVertices);!(i=r()).done;)this.layers[i.value]+=e}this.initCutValues()},s.vertexSourceTargetVal=function(t,e){var r=e.source,i=e.target;return this.lim(r)>this.lim(i)?this.lim(t)<=this.lim(i)&&this.low(i)<=this.lim(t)?0:1:this.lim(t)<=this.lim(r)&&this.low(r)<=this.lim(t)?1:0},s.incidentEdges=function(t){return this.graph.incidentEdges(t)},s.allLowCutsHaveBeenDone=function(t){for(var r,e=C(this.incidentEdges(t));!(r=e()).done;){var i=r.value;if(i.inTree&&i.cut===Be.infinity&&i!==this.parent(t))return!1}return!0},s.edgeSourceTargetVal=function(t,e){return this.vertexSourceTargetVal(t.source,e)-this.vertexSourceTargetVal(t.target,e)},s.initCutValues=function(){this.initLimLowAndParent();for(var r,t=new jt.K,e=C(this.leaves);!(r=e()).done;)t.push(r.value);for(var h=new jt.K;t.length>0;){for(;t.length>0;){var c=t.pop(),f=this.parent(c);if(null!=f){for(var m,p=0,y=C(this.incidentEdges(c));!(m=y()).done;){var P=m.value;if(!1===P.inTree){var L=this.edgeSourceTargetVal(P,f);0!==L&&(p+=L*P.weight)}else if(P===f)p+=P.weight;else{var E=f.source===P.target||f.target===P.source?1:-1;p+=this.edgeContribution(P,c)*E}}f.cut=p;var T=f.source===c?f.target:f.source;this.allLowCutsHaveBeenDone(T)&&h.push(T)}}var O=t;t=h,h=O}},s.edgeContribution=function(t,e){for(var h,r=t.cut-t.weight,i=C(this.incidentEdges(e));!(h=i()).done;){var c=h.value;if(!1===c.inTree){var f=this.edgeSourceTargetVal(c,t);-1===f?r+=c.weight:1===f&&(r-=c.weight)}}return r},s.initLimLowAndParent=function(){this.initLowLimParentAndLeavesOnSubtree(1,0)},s.initLowLimParentAndLeavesOnSubtree=function(t,e){var r=new jt.K,i=this.graph.outEdges[e],h=-1,c=this.graph.inEdges[e],f=-1;for(r.push(new es(e,i,h,c,f)),this.vertices[e].low=t;r.length>0;){var p=r.pop();e=p.v,i=p.outEnum,h=p.i,c=p.inEnum,f=p.j;var y=void 0;do{for(y=!0;++h<i.length;){var m=i[h];!m.inTree||this.vertices[m.target].low>0||(r.push(new es(e,i,h,c,f)),this.setParent(e=m.target,m),this.setLow(e,t),i=this.graph.outEdges[e],h=-1,c=this.graph.inEdges[e],f=-1)}for(;++f<c.length;){var P=c[f];if(P.inTree&&!(this.vertices[P.source].low>0)){r.push(new es(e,i,h,c,f)),this.setLow(e=P.source,t),this.setParent(e,P),i=this.graph.outEdges[e],h=-1,c=this.graph.inEdges[e],f=-1,y=!1;break}}}while(!y);this.setLim(e,t++),this.lim(e)===this.low(e)&&this.leaves.push(e)}},s.updateLimLowLeavesAndParentsUnderNode=function(t){var e=this.vertices[t].low,r=this.vertices[t].lim;this.leaves=[];for(var i=0;i<this.nodeCount;i++)e<=this.vertices[i].lim&&this.vertices[i].lim<=r?this.setLow(i,0):this.low(i)===this.lim(i)&&this.leaves.push(i);this.initLowLimParentAndLeavesOnSubtree(e,t)},s.slack=function(t){return this.layers[t.source]-this.layers[t.target]-t.separation},s.getNonTreeEdgeIncidentToTheTreeWithMinimalAmountOfSlack=function(){for(var i,t=null,e=Be.infinity,r=C(this.treeVertices);!(i=r()).done;){for(var f,h=i.value,c=C(this.graph.outEdges[h]);!(f=c()).done;){var p=f.value;if(!this.vertexInTree(p.source)||!this.vertexInTree(p.target)){var y=this.slack(p);if(y<e&&(t=p,e=y,1===y))return p}}for(var P,m=C(this.graph.inEdges[h]);!(P=m()).done;){var L=P.value;if(!this.vertexInTree(L.source)||!this.vertexInTree(L.target)){var E=this.slack(L);if(E<e&&(t=L,e=E,1===E))return L}}}return t},s.tightTree=function(){this.treeVertices=[];for(var e,t=C(this.graph.edges);!(e=t()).done;)e.value.inTree=!1;for(var i=1;i<this.nodeCount;i++)this.vertices[i].inTree=!1;this.vertices[0].inTree=!0,this.treeVertices.push(0);var h=new jt.K;for(h.push(0);h.length>0;){for(var p,c=h.pop(),f=C(this.graph.outEdges[c]);!(p=f()).done;){var y=p.value;this.vertexInTree(y.target)||this.layers[y.source]-this.layers[y.target]===y.separation&&(h.push(y.target),this.addVertexToTree(y.target),this.treeVertices.push(y.target),y.inTree=!0)}for(var P,m=C(this.graph.inEdges[c]);!(P=m()).done;){var L=P.value;this.vertexInTree(L.source)||this.layers[L.source]-this.layers[L.target]===L.separation&&(h.push(L.source),this.addVertexToTree(L.source),this.treeVertices.push(L.source),L.inTree=!0)}}return this.treeVertices.length},s.leaveEnterEdge=function(){for(var t,e,h,r=0,i=C(this.graph.edges);!(h=i()).done;){var c=h.value;c.inTree&&c.cut<r&&(r=c.cut,t=c)}if(null==t)return null;for(var m,f=!1,p=Be.infinity,y=C(this.graph.edges);!(m=y()).done;){var P=m.value,L=this.slack(P);if(!1===P.inTree&&-1===this.edgeSourceTargetVal(P,t)&&(L<p||L===p&&(f=1===di(2)))){if(e=P,0===(p=L)&&!f)break;f=!1}}if(null==e)throw new Error;return{leaving:t,entering:e}},s.exchange=function(t,e){var r=this.commonPredecessorOfSourceAndTargetOfF(e);this.createPathForCutUpdates(t,e,r),this.updateLimLowLeavesAndParentsUnderNode(r),this.updateCuts(t),this.updateLayersUnderNode(r)},s.updateLayersUnderNode=function(t){var e=new jt.K;e.push(t);for(var r=0;r<this.nodeCount;r++)this.low(t)<=this.lim(r)&&this.lim(r)<=this.lim(t)&&r!==t&&(this.layers[r]=Be.infinity);for(;e.length>0;){for(var c,i=e.pop(),h=C(this.graph.outEdges[i]);!(c=h()).done;){var f=c.value;f.inTree&&this.layers[f.target]===Be.infinity&&(this.layers[f.target]=this.layers[i]-f.separation,e.push(f.target))}for(var y,p=C(this.graph.inEdges[i]);!(y=p()).done;){var m=y.value;m.inTree&&this.layers[m.source]===Be.infinity&&(this.layers[m.source]=this.layers[i]+m.separation,e.push(m.source))}}},s.updateCuts=function(t){var e=new jt.K,r=new jt.K;for(e.push(t.source),e.push(t.target);e.length>0;){for(;e.length>0;){var i=e.pop(),h=this.parent(i);if(null!=h&&h.cut===Be.infinity){for(var p,c=0,f=C(this.incidentEdges(i));!(p=f()).done;){var y=p.value;if(!1===y.inTree)c+=this.edgeSourceTargetVal(y,h)*y.weight;else if(y===h)c+=y.weight;else{var m=h.source===y.target||h.target===y.source?1:-1;c+=this.edgeContribution(y,i)*m}}h.cut=c;var L=h.source===i?h.target:h.source;this.allLowCutsHaveBeenDone(L)&&r.push(L)}}var E=e;e=r,r=E}},s.createPathForCutUpdates=function(t,e,r){for(var i=e.target;i!==r;){var h=this.parent(i);h.cut=Be.infinity,i=h.source===i?h.target:h.source}e.cut=Be.infinity,t.inTree=!1,e.inTree=!0},s.commonPredecessorOfSourceAndTargetOfF=function(t){var e,r;this.lim(t.source)<this.lim(t.target)?(e=this.lim(t.source),r=this.lim(t.target)):(e=this.lim(t.target),r=this.lim(t.source));for(var i=t.source;!(this.low(i)<=e&&r<=this.lim(i));){var h=this.parent(i);h.cut=Be.infinity,i=h.source===i?h.target:h.source}return i},s.checkCutValues=function(){for(var e,t=C(this.graph.edges);!(e=t()).done;){var r=e.value;if(r.inTree)for(var c,h=C(this.graph.edges);!(c=h()).done;){var f=c.value;this.edgeSourceTargetVal(f,r)}}},s.initLayers=function(){var t=new gd(this.graph);return this.layers=t.GetLayers()},s.run=function(){if(0===this.graph.edges.length&&0===this.graph.nodeCount)this.layers=[];else{this.feasibleTree();for(var t;null!=(t=this.leaveEnterEdge());)this.exchange(t.leaving,t.entering);this.shiftLayerToZero()}},Q(l,[{key:"weight",get:function(){var t=this;return this.graph.edges.map(function(e){return e.weight*(t.layers[e.source]-t.layers[e.target])}).reduce(function(e,r){return e+r},0)}},{key:"nodeCount",get:function(){return this.vertices.length}}]),l}(),md=function(){function l(o,t){this.graph=o,this.Cancel=t}var s=l.prototype;return s.GetLayers=function(){return new El(this.graph,this.Cancel).GetLayers()},s.ShrunkComponent=function(t){for(var i,e=[],r=C(t);!(i=r()).done;)for(var y,h=i.value,f=h[1],p=C(this.graph.outEdges[h[0]]);!(y=p()).done;){var m=y.value,P=new wr(f,t.get(m.target),m.edge);P.separation=m.separation,P.weight=m.weight,e.push(P)}return new Fi(e,t.size)},l}();function rs(){rs=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Cl=function(){function l(o){this.padding=0,this.alreadySitsOnASpline=!1,this.labelIsToTheLeftOfTheSpline=!1,this.labelIsToTheRightOfTheSpline=!1,this.labelCornersPreserveCoefficient=o}var s=l.prototype;return s.toString=function(){return"la:ra "+this.la+" "+this.ra+" ta:ba "+this.ta+" "+this.ba+" x:y "+this.x_+" "+this.y_},l.mkAnchor=function(t,e,r,i,h,c){var f=new l(c);return f.la=t,f.ra=e,f.ta=r,f.ba=i,f.node=h,f},l.pad=function(t,e){return 0===e?t:l.curveIsConvex(t)?l.padConvexCurve(t,e):l.padConvexCurve(t.boundingBox.perimeter(),e)},l.padCorner=function(t,e,r,i,h){var c=l.getPaddedCorner(e,r,i,h);t.addPoint(c.a),2===c.numberOfPoints&&t.addPoint(c.b)},l.padConvexCurve=function(t,e){var r=new vt;l.padCorner(r,t.endPoint.prev,t.endPoint,t.startPoint,e),l.padCorner(r,t.endPoint,t.startPoint,t.startPoint.next,e);for(var i=t.startPoint;null!=i.next.next;i=i.next)l.padCorner(r,i,i.next,i.next.next,e);return r.closed=!0,r},l.getPaddedCorner=function(t,e,r,i){var h=t.point,c=e.point,f=r.point,p=R.getTriangleOrientation(h,c,f)===it.Counterclockwise,y=c.sub(h),m=y.rotate((p?-Math.PI:Math.PI)/2).normalize(),P=y.normalize().add(c.sub(f).normalize());if(P.length<q.intersectionEpsilon)return{a:c.add(m.mul(i)),b:null,numberOfPoints:1};var L=P.normalize().mul(i),E=L.rotate(Math.PI/2),S=(i-L.dot(m))/E.dot(m);return{a:L.add(E.mul(S)).add(c),b:L.sub(E.mul(S)).add(c),numberOfPoints:2}},l.orientations=rs().mark(function o(t){var e;return rs().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,R.getTriangleOrientation(t.endPoint.point,t.startPoint.point,t.startPoint.next.point);case 2:return i.next=4,R.getTriangleOrientation(t.endPoint.prev.point,t.endPoint.point,t.startPoint.point);case 4:e=t.startPoint;case 5:if(null==e.next.next){i.next=11;break}return i.next=8,R.getTriangleOrientation(e.point,e.next.point,e.next.next.point);case 8:e=e.next,i.next=5;break;case 11:case"end":return i.stop()}},o)}),l.curveIsConvex=function(t){for(var i,e=it.Collinear,r=C(l.orientations(t));!(i=r()).done;){var h=i.value;if(h!==it.Collinear)if(e===it.Collinear)e=h;else if(h!==e)return!1}return!0},s.creatPolygonalBoundaryWithoutPadding=function(){return this.hasLabel?this.labelIsToTheLeftOfTheSpline?this.polygonOnLeftLabel():this.polygonOnRightLabel():null==this.nodeBoundary?this.standardRectBoundary():K.polylineAroundClosedCurve(this.nodeBoundary)},s.standardRectBoundary=function(){var t=new vt;return t.addPoint(this.leftTop),t.addPoint(this.rightTop),t.addPoint(this.rightBottom),t.addPoint(this.leftBottom),t.closed=!0,t},s.polygonOnLeftLabel=function(){var t=this.left+(1-this.labelCornersPreserveCoefficient)*this.LabelWidth;return vt.mkClosedFromPoints([new R(t,this.top),this.rightTop,this.rightBottom,new R(t,this.bottom),new R(this.left,this.y)])},s.polygonOnRightLabel=function(){var t=this.right-(1-this.labelCornersPreserveCoefficient)*this.LabelWidth;return vt.mkClosedFromPoints([new R(t,this.top),new R(this.right,this.y),new R(t,this.bottom),this.leftBottom,this.leftTop])},s.move=function(t){this.x+=t.x,this.y+=t.y},Q(l,[{key:"leftAnchor",get:function(){return this.la},set:function(t){this.la=Math.max(t,0)}},{key:"rightAnchor",get:function(){return this.ra},set:function(t){this.ra=Math.max(t,0)}},{key:"topAnchor",get:function(){return this.ta},set:function(t){this.ta=Math.max(t,0)}},{key:"bottomAnchor",get:function(){return this.ba},set:function(t){this.ba=Math.max(t,0)}},{key:"left",get:function(){return this.x_-this.la}},{key:"right",get:function(){return this.x_+this.ra}},{key:"top",get:function(){return this.y_+this.ta},set:function(t){this.y_+=t-this.ta}},{key:"bottom",get:function(){return this.y_-this.ba},set:function(t){this.y_+=t-this.ba}},{key:"leftTop",get:function(){return new R(this.left,this.top)}},{key:"leftBottom",get:function(){return new R(this.left,this.bottom)}},{key:"rightBottom",get:function(){return new R(this.right,this.bottom)}},{key:"node",get:function(){return this.node_},set:function(t){this.node_=t,this.polygonalBoundary_=null}},{key:"rightTop",get:function(){return new R(this.right,this.top)}},{key:"x",get:function(){return this.x_},set:function(t){this.polygonalBoundary_=null,this.x_=t}},{key:"y",get:function(){return this.y_},set:function(t){this.polygonalBoundary_=null,this.y_=t}},{key:"origin",get:function(){return new R(this.x,this.y)}},{key:"width",get:function(){return this.la+this.ra}},{key:"height",get:function(){return this.ta+this.ba}},{key:"hasLabel",get:function(){return this.labelIsToTheLeftOfTheSpline||this.labelIsToTheLeftOfTheSpline}},{key:"LabelWidth",get:function(){if(this.labelIsToTheLeftOfTheSpline)return this.leftAnchor;if(this.labelIsToTheRightOfTheSpline)return this.rightAnchor;throw new Error}},{key:"polygonalBoundary",get:function(){return null!=this.polygonalBoundary_?this.polygonalBoundary_:this.polygonalBoundary_=l.pad(this.creatPolygonalBoundaryWithoutPadding(),this.padding)}},{key:"nodeBoundary",get:function(){return null==this.node?null:this.node.boundaryCurve}}]),l}();function ns(){ns=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Ll=function(){function l(o,t,e,r,i){this.xCoords=new Array(4),this.la=o,this.graph=t,this.nOfOriginalVertices=e,this.nOfVertices=this.graph.NodeCount,this.markedEdges=new mr,this.h=this.la.Layers.length,this.root=new Array(this.nOfVertices),this.align=new Array(this.nOfVertices),this.anchors=r,this.nodeSep=i}var s=l.prototype;return s.IsVirtual=function(t){return t>=this.nOfOriginalVertices},s.Source=function(t){return this.BT?t.Source:t.Target},s.Target=function(t){return this.BT?t.Target:t.Source},l.CalculateXCoordinates=function(t,e,r,i,h){new l(t,e,r,i,h).Calculate()},s.Calculate=function(){this.SortInAndOutEdges(),this.RightUpSetup(),this.CalcBiasedAlignment(),this.LeftUpSetup(),this.CalcBiasedAlignment(),this.RightDownSetup(),this.CalcBiasedAlignment(),this.LeftDownSetup(),this.CalcBiasedAlignment(),this.HorizontalBalancing()},s.SortInAndOutEdges=function(){this.FillLowMedians(),this.FillUpperMedins()},s.FillUpperMedins=function(){this.upperMedians=new Array(this.graph.NodeCount);for(var t=0;t<this.graph.NodeCount;t++)this.FillUpperMediansForNode(t)},s.CompareByX=function(t,e){return this.la.x[t]-this.la.x[e]},s.FillUpperMediansForNode=function(t){var e=this,r=this.graph.InEdgesCount(t);if(r>0){var i=new Array(r);r=0;for(var c,h=C(this.graph.InEdges(t));!(c=h()).done;)i[r++]=c.value.Source;i.sort(function(y,m){return e.CompareByX(y,m)});var p=Math.floor(r/2);this.upperMedians[t]=2*p===r?new Lt(i[p-1],i[p]):i[p]}else this.upperMedians[t]=-1},s.FillLowMedians=function(){this.lowMedians=new Array(this.graph.NodeCount);for(var t=0;t<this.graph.NodeCount;t++)this.FillLowMediansForNode(t)},s.FillLowMediansForNode=function(t){var e=this,r=this.graph.OutEdgesCount(t);if(r>0){var i=new Array(r);r=0;for(var c,h=C(this.graph.OutEdges(t));!(c=h()).done;)i[r++]=c.value.Target;i.sort(function(y,m){return e.CompareByX(y,m)});var p=Math.floor(r/2);this.lowMedians[t]=2*p===r?new Lt(i[p-1],i[p]):i[p]}else this.lowMedians[t]=-1},s.HorizontalBalancing=function(){for(var t=-1,e=new Array(4),r=new Array(4),i=Number.MAX_VALUE,h=0;h<4;h++){var c={a:0,b:0};this.AssignmentBounds(h,c),e[h]=c.a,r[h]=c.b;var f=r[h]-e[h];f<i&&(t=h,i=f)}for(var p=0;p<4;p++){var y;if(y=l.IsLeftMostAssignment(p)?e[t]-e[p]:r[t]-r[p],this.x=this.xCoords[p],0!==y)for(var m=0;m<this.nOfVertices;m++)this.x[m]=this.x[m]+y}for(var P=new Array(4),L=0;L<this.nOfVertices;L++)P[0]=this.xCoords[0][L],P[1]=this.xCoords[1][L],P[2]=this.xCoords[2][L],P[3]=this.xCoords[3][L],P.sort(function(E,S){return E-S}),this.anchors[L].x=(P[1]+P[2])/2},l.IsLeftMostAssignment=function(t){return 0===t||2===t},s.AssignmentBounds=function(t,e){if(0===this.nOfVertices)e.a=0,e.b=0;else{this.x=this.xCoords[t],e.a=e.b=this.x[0];for(var r=1;r<this.nOfVertices;r++){var i=this.x[r];i<e.a?e.a=i:i>e.b&&(e.b=i)}}},s.CalcBiasedAlignment=function(){this.ConflictElimination(),this.Align()},s.LeftUpSetup=function(){this.LR=!1,this.BT=!0},s.LeftDownSetup=function(){this.LR=!1,this.BT=!1},s.RightDownSetup=function(){this.LR=!0,this.BT=!1},s.RightUpSetup=function(){this.LR=!0,this.BT=!0},s.ConflictElimination=function(){this.RemoveMarksFromEdges(),this.MarkConflictingEdges()},s.UpperEdgeMedians=ns().mark(function o(t){var e,i,h;return ns().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if("number"==typeof(e=this.BT?this.upperMedians[t]:this.lowMedians[t])){f.next=17;break}if(i=e,!this.LR){f.next=11;break}return f.next=7,i.x;case 7:return f.next=9,i.y;case 9:f.next=15;break;case 11:return f.next=13,i.y;case 13:return f.next=15,i.x;case 15:f.next=21;break;case 17:if(!((h=e)>=0)){f.next=21;break}return f.next=21,h;case 21:case"end":return f.stop()}},o,this)}),s.MarkConflictingEdges=function(){for(var t=this.LowerOf(0,this.h-1),e=t,r=this.UpperOf(0,this.h-1),i=this.NextLower(r);this.IsBelow(t,r);t=this.NextUpper(t))this.IsBelow(e,t)&&this.IsBelow(t,i)&&this.ConflictsWithAtLeastOneInnerEdgeForALayer(t)},s.NextUpper=function(t){return this.BT?t+1:t-1},s.NextLower=function(t){return this.BT?t-1:t+1},s.UpperOf=function(t,e){return this.BT?Math.max(t,e):Math.min(t,e)},s.LowerOf=function(t,e){return this.BT?Math.min(t,e):Math.max(t,e)},s.IsBelow=function(t,e){return this.BT?t<e:e<t},s.LeftMost=function(t,e){return this.LR?Math.min(t,e):Math.max(t,e)},s.RightMost=function(t,e){return this.LR?Math.max(t,e):Math.min(t,e)},s.IsNotRightFrom=function(t,e){return this.LR?t<=e:e<=t},s.IsLeftFrom=function(t,e){return this.LR?t<e:e<t},s.NextRight=function(t){return this.LR?t+1:t-1},s.NextLeft=function(t){return this.LR?t-1:t+1},s.ConflictsWithAtLeastOneInnerEdgeForALayer=function(t){if(t>=0&&t<this.la.Layers.length){for(var e=this.la.Layers[t],r=null,i=this.LeftMost(0,e.length-1),h=this.RightMost(0,e.length-1);this.IsNotRightFrom(i,h)&&null==r;i=this.NextRight(i))r=this.InnerEdgeByTarget(e[i]);if(null!=r){for(var c=this.Pos(this.Source(r)),f=this.LeftMost(0,e.length-1);this.IsLeftFrom(f,i);f=this.NextRight(f))for(var y,p=C(this.InEdges(e[f]));!(y=p()).done;){var m=y.value;this.IsLeftFrom(c,this.Pos(this.Source(m)))&&this.MarkEdge(m)}for(var P=this.Pos(this.Source(r));this.IsNotRightFrom(i,h);){var L=this.AlignmentToTheRightOfInner(e,i,c);if(i=this.NextRight(i),null!=L){var E=this.Pos(this.Source(L));this.MarkEdgesBetweenInnerAndNewInnerEdges(e,r,L,P,E),r=L,P=E}}for(var S=this.NextRight(this.Pos(this.Target(r)));this.IsNotRightFrom(S,h);S=this.NextRight(S))for(var O,T=C(this.InEdges(e[S]));!(O=T()).done;){var x=O.value;this.IsLeftFrom(this.Pos(this.Source(x)),this.Pos(this.Source(r)))&&this.MarkEdge(x)}}}},s.InEdgeOfVirtualNode=function(t){return this.BT?this.graph.InEdgeOfVirtualNode(t):this.graph.OutEdgeOfVirtualNode(t)},s.InEdges=function(t){return this.BT?this.graph.InEdges(t):this.graph.OutEdges(t)},s.MarkEdgesBetweenInnerAndNewInnerEdges=function(t,e,r,i,h){for(var c=this.NextRight(this.Pos(this.Target(e)));this.IsLeftFrom(c,this.Pos(this.Target(r)));c=this.NextRight(c))for(var p,f=C(this.InEdges(t[c]));!(p=f()).done;){var y=p.value,m=this.Pos(this.Source(y));(this.IsLeftFrom(m,i)||this.IsLeftFrom(h,m))&&this.MarkEdge(y)}},s.AlignmentToTheRightOfInner=function(t,e,r){if(1===this.NumberOfInEdges(t[e])){for(var f,h=null,c=C(this.InEdges(t[e]));!(f=c()).done;)h=f.value;return this.IsInnerEdge(h)&&this.IsLeftFrom(r,this.Pos(h.Source))?h:null}return null},s.NumberOfInEdges=function(t){return this.BT?this.graph.InEdgesCount(t):this.graph.OutEdgesCount(t)},s.Pos=function(t){return this.la.x[t]},s.InnerEdgeByTarget=function(t){if(this.IsVirtual(t)){var e=this.InEdgeOfVirtualNode(t);if(this.IsVirtual(this.Source(e)))return e}return null},s.IsInnerEdge=function(t){return this.IsVirtual(t.Source)&&this.IsVirtual(t.Target)},s.RemoveMarksFromEdges=function(){this.markedEdges.clear()},s.Align=function(){this.CreateBlocks(),this.AssignCoordinatesByLongestPath()},s.AssignCoordinatesByLongestPath=function(){this.x=this.xCoords[this.CurrentEnumRightUp]=new Array(this.nOfVertices);for(var t=new Array,e=0;e<this.nOfVertices;e++)if(e===this.root[e]){var r=e;do{var i={neighbor:0};this.TryToGetRightNeighbor(r,i)&&t.push(new wr(e,this.root[i.neighbor],null)),r=this.align[r]}while(r!==e)}for(var p,h=Ke(t,this.nOfVertices),c=Sl.getOrderOnGraph(h),f=C(c);!(p=f()).done;){var y=p.value;if(y===this.root[y]){var m=0,P=!0,L=y;do{var E={neighbor:0};this.TryToGetLeftNeighbor(L,E)&&(P?(m=this.x[this.root[E.neighbor]]+this.DeltaBetweenVertices(E.neighbor,L),P=!1):m=this.RightMost(m,this.x[this.root[E.neighbor]]+this.DeltaBetweenVertices(E.neighbor,L))),L=this.align[L]}while(L!==y);this.x[y]=m}}for(var T,S=C(c);!(T=S()).done;){var O=T.value;if(O===this.root[O]&&0===h.inEdges[O].length){var x=O,B=this.RightMost(-l.infinity,l.infinity),M=B;do{var F={neighbor:0};this.TryToGetRightNeighbor(x,F)&&(B=this.LeftMost(B,this.x[this.root[F.neighbor]]-this.DeltaBetweenVertices(x,F.neighbor))),x=this.align[x]}while(x!==O);M!==B&&(this.x[O]=B)}}for(var A=0;A<this.nOfVertices;A++)A!==this.root[A]&&(this.x[A]=this.x[this.root[A]])},s.TryToGetRightNeighbor=function(t,e){var r=this.NextRight(this.Pos(t)),i=this.la.Layers[this.la.y[t]];return r>=0&&r<i.length&&(e.neighbor=i[r],!0)},s.TryToGetLeftNeighbor=function(t,e){var r=this.NextLeft(this.Pos(t)),i=this.la.Layers[this.la.y[t]];return r>=0&&r<i.length&&(e.neighbor=i[r],!0)},s.CreateBlocks=function(){for(var t=0;t<this.nOfVertices;t++)this.root[t]=this.align[t]=t;for(var e=this.LowerOf(0,this.h-1),r=this.NextLower(this.UpperOf(0,this.h-1));!this.IsBelow(r,e);r=this.NextLower(r))for(var i=this.la.Layers[r],h=this.LeftMost(-1,this.la.Layers[this.NextUpper(r)].length),c=this.RightMost(0,i.length-1),f=this.LeftMost(0,i.length-1);this.IsNotRightFrom(f,c);f=this.NextRight(f))for(var m,p=i[f],y=C(this.UpperEdgeMedians(p));!(m=y()).done;){var P=m.value;if(!this.IsMarked(p,P)&&this.IsLeftFrom(h,this.Pos(P))){this.align[P]=p,this.root[p]=this.root[P],this.align[p]=this.root[P],h=this.Pos(P);break}}},s.IsMarked=function(t,e){return this.BT?this.markedEdges.hasxy(e,t):this.markedEdges.hasxy(t,e)},s.MarkEdge=function(t){this.markedEdges.addNN(t.Source,t.Target)},s.DeltaBetweenVertices=function(t,e){var r;if(this.Pos(t)>this.Pos(e)){var i=t;t=e,e=i,r=-1}else r=1;return(this.anchors[t].rightAnchor+this.anchors[e].leftAnchor+this.nodeSep)*r},Q(l,[{key:"CurrentEnumRightUp",get:function(){return(this.LR?0:1)+2*(this.BT?0:1)}}]),l}();Ll.infinity=1e7;var ne,wd=function(l){function s(t,e,r,i,h){var c;return(c=l.call(this)||this).weightMultiplierOfOriginalOriginal=1,c.weightMultOfOneVirtual=3,c.weightMultiplierOfTwoVirtual=8,c.SetEdges(i,h),c.virtualVerticesStart=t.nodeCount,c.virtualVerticesEnd=e.NodeCount-1,c.layeredGraph=e,c.layerArrays=r,c}X(s,l);var o=s.prototype;return o.EdgeWeightMultiplier=function(e){var r=e.source,i=e.target;if(r<this.layeredGraph.NodeCount&&this.layerArrays.y[r]===this.layerArrays.y[i]&&this.layerArrays.x[r]===this.layerArrays.x[i]+1)return 0;for(var y,h=0,c=-1,f=-1,p=C(this.outEdges[r]);!(y=p()).done;){var m=y.value;-1===f?f=m.target:c=m.target}return f>=this.virtualVerticesStart&&f<=this.virtualVerticesEnd&&h++,c>=this.virtualVerticesStart&&c<=this.virtualVerticesEnd&&h++,0===h?this.weightMultiplierOfOriginalOriginal:1===h?this.weightMultOfOneVirtual:this.weightMultiplierOfTwoVirtual},o.SetEdgeWeights=function(){for(var r,e=C(this.edges);!(r=e()).done;){var i=r.value;i.weight=i.weight*this.EdgeWeightMultiplier(i)}},s}(an);!function(l){l[l.Top=0]="Top",l[l.Internal=1]="Internal",l[l.Bottom=2]="Bottom"}(ne||(ne={}));var Co=function(){function l(o,t){this.groupSplitThreshold=2,this.initialNodes=o,this.groupSplitThreshold=t}l.Calculate=function(t,e){return void 0===e&&(e=0),new l(t,e).Calculate()};var s=l.prototype;return s.Calculate=function(){return this.Calc(this.initialNodes)},s.Calc=function(t){if(0===t.length)return null;if(1===t.length)return t[0];for(var e=t[0].parallelogram,r=1,i=Ut.parallelogramOfTwo(e,t[r].parallelogram).area,h=2;h<t.length;h++){var c=Ut.parallelogramOfTwo(e,t[h].parallelogram).area;c>i&&(r=h,i=c)}for(var f,p=0;p<t.length;p++)if(p!==r){f=p;break}i=Ut.parallelogramOfTwo(t[r].parallelogram,t[f].parallelogram).area;for(var y=0;y<t.length;y++)if(y!==r){var m=Ut.parallelogramOfTwo(t[r].parallelogram,t[y].parallelogram).area;m>i&&(f=y,i=m)}var P=new Array,L=new Array;P.push(t[r]),L.push(t[f]);for(var E=t[r].parallelogram,S=t[f].parallelogram,T=0;T<t.length;T++)if(T!==r&&T!==f){var O=Ut.parallelogramOfTwo(E,t[T].parallelogram),x=O.area-E.area,B=Ut.parallelogramOfTwo(S,t[T].parallelogram),M=B.area-S.area;P.length*this.groupSplitThreshold<L.length?(P.push(t[T]),E=O):L.length*this.groupSplitThreshold<P.length?(L.push(t[T]),S=B):x<M?(P.push(t[T]),E=O):(L.push(t[T]),S=B)}return{parallelogram:Ut.parallelogramOfTwo(E,S),node:{children:[this.Calc(P),this.Calc(L)]},seg:void 0,leafBoxesOffset:void 0}},l}();function pe(){pe=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Pd=function(){function l(o,t,e,r,i,h,c,f){this.topNode=o,this.bottomNode=t,this.topSite=e,this.bottomSite=e.next,this.currentTopSite=e,this.currentBottomSite=e.next,this.layerArrays=r,this.layeredGraph=i,this.originalGraph=h,this.anchors=c,this.layerSeparation=f}l.Refine=function(t,e,r,i,h,c,f,p){new l(t,e,r,h,c,f,i,p).Refine()};var s=l.prototype;return s.Refine=function(){for(this.Init();this.InsertSites(););},s.FixCorner=function(t,e,r){if(t.equal(e))return e;var i=R.ClosestPointAtLineSegment(e,t,r),h=e.sub(i),c=Math.abs(h.y),f=this.layerSeparation/2;return c>f&&(h=h.mul(f/(2*c))),h.add(e)},s.InsertSites=function(){return 0===di(2)?this.CalculateNewTopSite()||this.CalculateNewBottomSite():this.CalculateNewBottomSite()||this.CalculateNewTopSite()},s.CalculateNewBottomSite=function(){for(var r,c,t=this.currentBottomSite.point.sub(this.currentTopSite.point),e=l.absCotan(t),i=!1,h=C(this.bottomCorners());!(c=h()).done;){var f=c.value,p=l.absCotan(f.sub(this.currentBottomSite.point));p<e&&(e=p,r=f,i=!0)}return!!i&&!dt(e,l.absCotan(t))&&(this.currentBottomSite=Yt.mkSiteSPS(this.currentTopSite,this.FixCorner(this.currentTopSite.point,r,this.currentBottomSite.point),this.currentBottomSite),!0)},l.absCotan=function(t){return Math.abs(t.x/t.y)},s.CalculateNewTopSite=function(){for(var r,c,t=this.currentBottomSite.point.sub(this.currentTopSite.point),e=l.absCotan(t),i=!1,h=C(this.topCorners());!(c=h()).done;){var f=c.value,p=l.absCotan(f.sub(this.currentTopSite.point));p<e&&(e=p,r=f,i=!0)}return!!i&&!dt(e,l.absCotan(t))&&(this.currentTopSite=Yt.mkSiteSPS(this.currentTopSite,this.FixCorner(this.currentTopSite.point,r,this.currentBottomSite.point),this.currentBottomSite),!0)},s.Init=function(){var t=this;this.IsTopToTheLeftOfBottom()?(this.topCorners=function(){return t.CornersToTheRightOfTop()},this.bottomCorners=function(){return t.CornersToTheLeftOfBottom()}):(this.topCorners=function(){return t.CornersToTheLeftOfTop()},this.bottomCorners=function(){return t.CornersToTheRightOfBottom()})},s.IsTopToTheLeftOfBottom=function(){return this.topSite.point.x<this.topSite.next.point.x},s.NodeCorners=pe().mark(function o(t){var e,r,i;return pe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=C(this.anchors[t].polygonalBoundary.polylinePoints());case 1:if((r=e()).done){c.next=7;break}return i=r.value,c.next=5,i.point;case 5:c.next=1;break;case 7:case"end":return c.stop()}},o,this)}),s.CornersToTheLeftOfBottom=pe().mark(function o(){var t,e,r,i,h,f,p,y;return pe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:t=this.layerArrays.x[this.bottomNode],e=this.currentTopSite.point.x,r=this.currentBottomSite.point.x,i=C(this.LeftFromTheNode(this.NodeLayer(this.bottomNode),t,ne.Bottom,e,r));case 4:if((h=i()).done){P.next=16;break}f=C(this.NodeCorners(h.value));case 7:if((p=f()).done){P.next=14;break}if(!((y=p.value).y>this.currentBottomSite.point.y&&l.PossibleCorner(e,r,y))){P.next=12;break}return P.next=12,y;case 12:P.next=7;break;case 14:P.next=4;break;case 16:case"end":return P.stop()}},o,this)}),s.CornersToTheLeftOfTop=pe().mark(function o(){var t,e,r,i,h,f,p,y;return pe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:t=this.layerArrays.x[this.topNode],e=this.currentBottomSite.point.x,r=this.currentTopSite.point.x,i=C(this.LeftFromTheNode(this.NodeLayer(this.topNode),t,ne.Top,e,r));case 4:if((h=i()).done){P.next=16;break}f=C(this.NodeCorners(h.value));case 7:if((p=f()).done){P.next=14;break}if(!((y=p.value).y<this.currentTopSite.point.y&&l.PossibleCorner(e,r,y))){P.next=12;break}return P.next=12,y;case 12:P.next=7;break;case 14:P.next=4;break;case 16:case"end":return P.stop()}},o,this)}),s.CornersToTheRightOfBottom=pe().mark(function o(){var t,e,r,i,h,f,p,y;return pe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:t=this.layerArrays.x[this.bottomNode],e=this.currentBottomSite.point.x,r=this.currentTopSite.point.x,i=C(this.RightFromTheNode(this.NodeLayer(this.bottomNode),t,ne.Bottom,e,r));case 4:if((h=i()).done){P.next=16;break}f=C(this.NodeCorners(h.value));case 7:if((p=f()).done){P.next=14;break}if(!((y=p.value).y>this.currentBottomSite.point.y&&l.PossibleCorner(e,r,y))){P.next=12;break}return P.next=12,y;case 12:P.next=7;break;case 14:P.next=4;break;case 16:case"end":return P.stop()}},o,this)}),s.CornersToTheRightOfTop=pe().mark(function o(){var t,e,r,i,h,f,p,y;return pe().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:t=this.layerArrays.x[this.topNode],e=this.currentTopSite.point.x,r=this.currentBottomSite.point.x,i=C(this.RightFromTheNode(this.NodeLayer(this.topNode),t,ne.Top,e,r));case 4:if((h=i()).done){P.next=16;break}f=C(this.NodeCorners(h.value));case 7:if((p=f()).done){P.next=14;break}if(!((y=p.value).y<this.currentTopSite.point.y&&l.PossibleCorner(e,r,y))){P.next=12;break}return P.next=12,y;case 12:P.next=7;break;case 14:P.next=4;break;case 16:case"end":return P.stop()}},o,this)}),l.PossibleCorner=function(t,e,r){return r.x>t&&r.x<e},s.NodeLayer=function(t){return this.layerArrays.Layers[this.layerArrays.y[t]]},s.IsLabel=function(t){return this.anchors[t].hasLabel},s.NodeUCanBeCrossedByNodeV=function(t,e){return!this.IsLabel(t)&&!this.IsLabel(e)&&!!(this.IsVirtualVertex(t)&&this.IsVirtualVertex(e)&&this.AdjacentEdgesIntersect(t,e))},s.AdjacentEdgesIntersect=function(t,e){return this.Intersect(this.IncomingEdge(t),this.IncomingEdge(e))||this.Intersect(this.OutcomingEdge(t),this.OutcomingEdge(e))},s.Intersect=function(t,e){return(this.layerArrays.x[t.Source]-this.layerArrays.x[e.Source])*(this.layerArrays.x[t.Target]-this.layerArrays.x[e.Target])<0},s.IncomingEdge=function(t){for(var r,e=C(this.layeredGraph.InEdges(t));!(r=e()).done;)return r.value;throw new Error},s.OutcomingEdge=function(t){for(var r,e=C(this.layeredGraph.OutEdges(t));!(r=e()).done;)return r.value;throw new Error},s.IsVirtualVertex=function(t){return t>=this.originalGraph.shallowNodeCount},s.RightFromTheNode=pe().mark(function o(t,e,r,i,h){var c,f,p,y,m,P;return pe().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:c=0,f=0,r===ne.Bottom&&(c=Number.MAX_VALUE),r===ne.Top&&(f=Number.MAX_VALUE),p=t[e],y=e+1;case 6:if(!(y<t.length)){E.next=27;break}if(!this.NodeUCanBeCrossedByNodeV(m=t[y],p)){E.next=10;break}return E.abrupt("continue",24);case 10:if(!((P=this.anchors[m]).left>=h)){E.next=13;break}return E.abrupt("break",27);case 13:if(!(P.right>i)){E.next=24;break}if(!(P.topAnchor>f+q.distanceEpsilon)){E.next=20;break}return f=P.topAnchor,E.next=18,m;case 18:E.next=24;break;case 20:if(!(P.bottomAnchor>c+q.distanceEpsilon)){E.next=24;break}return c=P.bottomAnchor,E.next=24,m;case 24:y++,E.next=6;break;case 27:case"end":return E.stop()}},o,this)}),s.LeftFromTheNode=pe().mark(function o(t,e,r,i,h){var c,f,p,y,m,P;return pe().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:c=0,f=0,r===ne.Bottom&&(c=Number.MAX_VALUE),r===ne.Top&&(f=Number.MAX_VALUE),p=t[e],y=e-1;case 6:if(!(y>-1)){E.next=27;break}if(!this.NodeUCanBeCrossedByNodeV(m=t[y],p)){E.next=10;break}return E.abrupt("continue",24);case 10:if(!((P=this.anchors[m]).right<=i)){E.next=13;break}return E.abrupt("break",27);case 13:if(!(P.left<h)){E.next=24;break}if(!(P.topAnchor>f+q.distanceEpsilon)){E.next=20;break}return f=P.topAnchor,E.next=18,m;case 18:E.next=24;break;case 20:if(!(P.bottomAnchor>c+q.distanceEpsilon)){E.next=24;break}return c=P.bottomAnchor,E.next=24,m;case 24:y--,E.next=6;break;case 27:case"end":return E.stop()}},o,this)}),l}();function Mi(){Mi=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var Sd=function(){function l(o,t,e,r,i,h,c){this.thinRightNodes=new Array,this.thinWestNodes=new Array,this.database=c,this.edgePath=o,this.anchors=t,this.layerArrays=i,this.originalGraph=e,this.settings=r,this.layeredGraph=h,this.eastHierarchy=this.BuildEastHierarchy(),this.westHierarchy=this.BuildWestHierarchy()}var s=l.prototype;return s.BuildEastHierarchy=function(){for(var i,t=this.FindEastBoundaryAnchorCurves(),e=new Array,r=C(t);!(i=r()).done;)e.push(i.value.pNodeOverICurve());return this.thinEastHierarchy=Co.Calculate(this.thinRightNodes),Co.Calculate(e)},s.BuildWestHierarchy=function(){for(var i,t=this.FindWestBoundaryAnchorCurves(),e=new Array,r=C(t);!(i=r()).done;)e.push(i.value.pNodeOverICurve());return this.thinWestHierarchy=Co.Calculate(this.thinWestNodes),Co.Calculate(e)},s.FindEastBoundaryAnchorCurves=function(){for(var i,t=new Array,e=0,r=C(this.edgePath);!(i=r()).done;){for(var p,c=null,f=C(this.EastBoundaryNodesOfANode(i.value,is.GetNodeKind(e,this.edgePath)));!(p=f()).done;){var m=this.anchors[p.value];(null==c||c.origin.x>m.origin.x)&&(c=m),t.push(m.polygonalBoundary)}null!=c&&this.thinRightNodes.push(Z.mkLinePXY(c.origin,this.originalGraph.right,c.y).pNodeOverICurve()),e++}return t},s.FindWestBoundaryAnchorCurves=function(){for(var i,t=[],e=0,r=C(this.edgePath.nodes());!(i=r()).done;){for(var p,c=-1,f=C(this.LeftBoundaryNodesOfANode(i.value,is.GetNodeKind(e,this.edgePath)));!(p=f()).done;){var y=p.value;(-1===c||this.layerArrays.x[y]>this.layerArrays.x[c])&&(c=y),t.push(this.anchors[y].polygonalBoundary)}if(-1!==c){var m=this.anchors[c];this.thinWestNodes.push(Z.mkLinePXY(m.origin,this.originalGraph.left,m.origin.y).pNodeOverICurve())}e++}return t},s.FillRightTopAndBottomVerts=Mi().mark(function o(t,e,r){var i,h,c,f,p,y;return Mi().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:i=0,h=0,r===ne.Bottom?i=Number.MAX_VALUE:r===ne.Top&&(h=Number.MAX_VALUE),c=t[e],f=e+1;case 5:if(!(f<t.length)){P.next=25;break}if(!((y=this.anchors[p=t[f]]).topAnchor>h)){P.next=16;break}if(this.NodeUCanBeCrossedByNodeV(p,c)){P.next=14;break}return h=y.topAnchor,y.bottomAnchor>i&&(i=y.bottomAnchor),P.next=14,p;case 14:P.next=22;break;case 16:if(!(y.bottomAnchor>i)){P.next=22;break}if(this.NodeUCanBeCrossedByNodeV(p,c)){P.next=22;break}return i=y.bottomAnchor,y.topAnchor>h&&(h=y.topAnchor),P.next=22,p;case 22:f++,P.next=5;break;case 25:case"end":return P.stop()}},o,this)}),s.FillLeftTopAndBottomVerts=Mi().mark(function o(t,e,r){var i,h,c,f,p,y;return Mi().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:i=0,h=0,r===ne.Top?h=Number.MAX_VALUE:r===ne.Bottom&&(i=Number.MAX_VALUE),c=t[e],f=e-1;case 5:if(!(f>=0)){P.next=25;break}if(!((y=this.anchors[p=t[f]]).topAnchor>h+q.distanceEpsilon)){P.next=16;break}if(this.NodeUCanBeCrossedByNodeV(p,c)){P.next=14;break}return h=y.topAnchor,i=Math.max(i,y.bottomAnchor),P.next=14,p;case 14:P.next=22;break;case 16:if(!(y.bottomAnchor>i+q.distanceEpsilon)){P.next=22;break}if(this.NodeUCanBeCrossedByNodeV(p,c)){P.next=22;break}return h=Math.max(h,y.topAnchor),i=y.bottomAnchor,P.next=22,p;case 22:f--,P.next=5;break;case 25:case"end":return P.stop()}},o,this)}),s.IsVirtualVertex=function(t){return t>=this.originalGraph.shallowNodeCount},s.IsLabel=function(t){return this.anchors[t].hasLabel},s.NodeUCanBeCrossedByNodeV=function(t,e){return!this.IsLabel(t)&&!this.IsLabel(e)&&!!(this.IsVirtualVertex(t)&&this.IsVirtualVertex(e)&&this.EdgesIntersectSomewhere(t,e))},s.EdgesIntersectSomewhere=function(t,e){return!this.UVAreMiddlesOfTheSameMultiEdge(t,e)&&(this.IntersectAbove(t,e)||this.IntersectBelow(t,e))},s.UVAreMiddlesOfTheSameMultiEdge=function(t,e){return!(!this.database.MultipleMiddles.has(t)||!this.database.MultipleMiddles.has(e)||this.SourceOfTheOriginalEdgeContainingAVirtualNode(t)!==this.SourceOfTheOriginalEdgeContainingAVirtualNode(e))},s.SourceOfTheOriginalEdgeContainingAVirtualNode=function(t){for(;this.IsVirtualVertex(t);)t=this.IncomingEdge(t).Source;return t},s.IntersectBelow=function(t,e){do{var r=this.OutcomingEdge(t),i=this.OutcomingEdge(e);if(this.Intersect(r,i))return!0;t=r.Target,e=i.Target}while(this.IsVirtualVertex(t)&&this.IsVirtualVertex(e));return t===e},s.IntersectAbove=function(t,e){do{var r=this.IncomingEdge(t),i=this.IncomingEdge(e);if(this.Intersect(r,i))return!0;t=r.Source,e=i.Source}while(this.IsVirtualVertex(t)&&this.IsVirtualVertex(e));return t===e},s.Intersect=function(t,e){var r=this.layerArrays.x[t.Source]-this.layerArrays.x[e.Source],i=this.layerArrays.x[t.Target]-this.layerArrays.x[e.Target];return r>0&&i<0||r<0&&i>0},s.IncomingEdge=function(t){return this.layeredGraph.InEdgeOfVirtualNode(t)},s.OutcomingEdge=function(t){return this.layeredGraph.OutEdgeOfVirtualNode(t)},s.EastBoundaryNodesOfANode=function(t,e){return this.FillRightTopAndBottomVerts(this.NodeLayer(t),this.layerArrays.x[t],e)},s.NodeLayer=function(t){return this.layerArrays.Layers[this.layerArrays.y[t]]},s.LeftBoundaryNodesOfANode=function(t,e){return this.FillLeftTopAndBottomVerts(this.NodeLayer(t),this.layerArrays.x[t],e)},s.getSpline=function(t){return this.createRefinedPolyline(t),this.createSmoothedPolyline()},s.LineSegIntersectBound=function(t,e){var r=Z.mkPP(t,e);return l.CurveIntersectsHierarchy(r,this.westHierarchy)||l.CurveIntersectsHierarchy(r,this.thinWestHierarchy)||l.CurveIntersectsHierarchy(r,this.eastHierarchy)||l.CurveIntersectsHierarchy(r,this.thinEastHierarchy)},s.SegIntersectWestBound=function(t,e){return l.SegIntersectsBound(t,e,this.westHierarchy)||l.SegIntersectsBound(t,e,this.thinWestHierarchy)},s.SegIntersectEastBound=function(t,e){return l.SegIntersectsBound(t,e,this.eastHierarchy)||l.SegIntersectsBound(t,e,this.thinEastHierarchy)},s.TryToRemoveInflectionCorner=function(t){if(!t.s.next||!t.s.prev||t.s.turn===it.Counterclockwise&&this.SegIntersectEastBound(t.s.prev,t.s.next)||t.s.turn===it.Clockwise&&this.SegIntersectWestBound(t.s.prev,t.s.next))return t.cut=!1,void(t.s=t.s.next);var e=t.s.next;t.s.prev.next=e,e.prev=t.s.prev,t.s=e,t.cut=!0},l.SegIntersectsBound=function(t,e,r){return l.CurveIntersectsHierarchy(Z.mkPP(t.point,e.point),r)},l.CurveIntersectsHierarchy=function(t,e){if(null==e||!Ut.intersect(t.pNodeOverICurve().parallelogram,e.parallelogram))return!1;if(e.node.hasOwnProperty("children")){var r=e.node;return l.CurveIntersectsHierarchy(t,r.children[0])||l.CurveIntersectsHierarchy(t,r.children[1])}return null!=K.intersectionOne(t,e.seg,!1)},l.Flat=function(t){return R.getTriangleOrientation(t.prev.point,t.point,t.next.point)===it.Collinear},s.Reverse=function(){for(var t=new l(this.edgePath,this.anchors,this.originalGraph,this.settings,this.layerArrays,this.layeredGraph,this.database),e=this.headSite,r=null;null!=e;)t.headSite=e.clone(),t.headSite.next=r,null!=r&&(r.prev=t.headSite),r=t.headSite,e=e.next;return t},s.createRefinedPolyline=function(t){this.CreateInitialListOfSites();for(var r,e=this.headSite,i=0;i<this.edgePath.count;i++)r=e.next,this.RefineBeetweenNeighborLayers(e,this.EdgePathNode(i),this.EdgePathNode(i+1)),e=r;this.TryToRemoveInflections(),t&&this.OptimizeShortPath()},s.RefineBeetweenNeighborLayers=function(t,e,r){Pd.Refine(e,r,t,this.anchors,this.layerArrays,this.layeredGraph,this.originalGraph,this.settings.LayerSeparation)},s.CreateInitialListOfSites=function(){for(var t=this.headSite=Yt.mkSiteP(this.EdgePathPoint(0)),e=1;e<=this.edgePath.count;e++)t=Yt.mkSiteSP(t,this.EdgePathPoint(e))},s.OptimizeForThreeSites=function(){var t=this.EdgePathNode(0),e=this.EdgePathNode(2),r=this.anchors[t],i=this.anchors[e];if(!dt(r.x,i.x)){var h={ax:r.x,bx:i.x,sign:0};if(this.FindLegalPositions(r,i,h)){var c=(r.y-i.y)/(r.bottom-i.top),f=.5*(h.ax+h.bx),p=h.sign*(.5*(h.ax-h.bx));h.ax=f+c*(p*h.sign),h.bx=f-c*(p*h.sign),this.headSite.point=new R(h.ax,r.y);var y=this.headSite.next,m=y.point.y;y.point=new R(this.MiddlePos(h.ax,h.bx,r,i,m),m),y.next.point=new R(h.bx,i.y),this.anchors[this.EdgePathNode(1)].x=y.point.x}}},s.OptimizeForTwoSites=function(){var t=this.EdgePathNode(0),e=this.EdgePathNode(1),r=this.anchors[t],i=this.anchors[e];if(!dt(r.x,i.x)){var h={ax:r.x,bx:i.x,sign:0};if(this.FindPositions(r,i,h)){var c=(r.y-i.y)/(r.bottom-i.top),f=.5*(h.ax+h.bx),p=h.sign*(.5*(h.ax-h.bx));h.ax=f+c*(p*h.sign),h.bx=f-c*(p*h.sign),this.headSite.point=new R(h.ax,r.y),this.headSite.next.point=new R(h.bx,i.y)}}},s.FindLegalPositions=function(t,e,r){return!!this.FindPositions(t,e,r)&&this.PositionsAreLegal(r.ax,r.bx,r.sign,t,e,this.EdgePathNode(1))},s.FindPositions=function(t,e,r){var i,h;if(r.ax<r.bx?(r.sign=1,h=Math.max(r.ax,e.left),i=Math.min(t.right,r.bx)):(r.sign=-1,h=Math.max(t.left,r.bx),i=Math.min(e.right,r.ax)),h<=i)r.bx=.5*(h+i),r.ax=.5*(h+i);else{if(this.OriginToOriginSegCrossesAnchorSide(t,e))return!1;1===r.sign?(r.ax=t.right-.1*t.rightAnchor,r.bx=e.left):(r.ax=t.left+.1*t.leftAnchor,r.bx=e.right)}return!0},s.OriginToOriginSegCrossesAnchorSide=function(t,e){var r=Z.mkPP(t.origin,e.origin);return t.x<e.x&&K.CurvesIntersect(r,Z.mkPP(t.rightBottom,t.rightTop))||K.CurvesIntersect(r,Z.mkPP(e.leftBottom,t.leftTop))||t.x>e.x&&K.CurvesIntersect(r,Z.mkPP(t.leftBottom,t.leftTop))||K.CurvesIntersect(r,Z.mkPP(e.rightBottom,t.rightTop))},s.OptimizeShortPath=function(){this.edgePath.count>2||(2===this.edgePath.count&&null!=this.headSite.next.next&&null==this.headSite.next.next.next&&null==this.anchors[this.EdgePathNode(1)].node?this.OptimizeForThreeSites():1===this.edgePath.count&&this.OptimizeForTwoSites())},s.PositionsAreLegal=function(t,e,r,i,h,c){if(!dt(t,e)&&(t-e)*r>0)return!1;var f=this.anchors[c],p=this.MiddlePos(t,e,i,h,f.y);return!!this.MiddleAnchorLegal(p,c,f)&&!this.LineSegIntersectBound(new R(t,i.bottom),new R(e,h.top))},s.MiddleAnchorLegal=function(t,e,r){var i=this.NodeLayer(e),h=this.layerArrays.x[e],c=t-r.x;return!(h>0&&this.anchors[i[h-1]].right>c+r.left)&&!(h<i.length-1&&this.anchors[i[h+1]].left<c+r.right)},s.MiddlePos=function(t,e,r,i,h){var c=r.y-h,f=h-i.y;return(t*c+e*f)/(c+f)},s.TryToRemoveInflections=function(){if(!this.TurningAlwaySameDirection())for(var t=!0;t;){t=!1;for(var e={s:this.headSite,cut:!1};e.s;)this.TryToRemoveInflectionCorner(e),t=e.cut||t}},s.TurningAlwaySameDirection=function(){for(var t=0,e=this.headSite.next;null!=e&&null!=e.next;e=e.next){var r=e.turn;if(0===t)r>0?t=1:r<0&&(t=-1);else if(t*r<0)return!1}return!0},s.EdgePathPoint=function(t){return this.anchors[this.EdgePathNode(t)].origin},s.EdgePathNode=function(t){return t===this.edgePath.count?this.edgePath.LayerEdges[this.edgePath.count-1].Target:this.edgePath.LayerEdges[t].Source},s.createSmoothedPolyline=function(){this.RemoveVerticesWithNoTurns();var t=new K,e=this.headSite,r=K.findCorner(e);return void 0!==r?(this.createFilletCurve(t,{a:e,b:r.b,c:r.c}),t=this.ExtendCurveToEndpoints(t)):t.addSegment(Z.mkPP(this.headSite.point,this.TailSite.point)),t},s.curveIsLegal=function(t){return!0},s.RemoveVerticesWithNoTurns=function(){for(;this.RemoveVerticesWithNoTurnsOnePass(););},s.RemoveVerticesWithNoTurnsOnePass=function(){for(var t=!1,e=this.headSite;null!=e.next&&null!=e.next.next;e=e.next)l.Flat(e.next)&&(t=!0,e.next=e.next.next,e.next.prev=e);return t},s.ExtendCurveToEndpoints=function(t){var e=this.headSite.point;if(!R.closeDistEps(e,t.start)){var r=new K;r.addSegs([Z.mkPP(e,t.start),t]),t=r}return R.closeDistEps(e=this.TailSite.point,t.end)||t.addSegment(Z.mkPP(t.end,e)),t},s.createFilletCurve=function(t,e){for(;this.AddSmoothedCorner(e.a,e.b,e.c,t),e.a=e.b,e.b=e.c,null!=e.b.next;)e.c=e.b.next},s.AddSmoothedCorner=function(t,e,r,i){var c,h=.5;do{c=K.createBezierSeg(h,h,t,e,r),e.previouisBezierCoefficient=h,h/=2}while(this.BezierSegIntersectsBoundary(c));if((h*=2)<.5){var f=K.createBezierSeg(h=.5*(h+2*h),h,t,e,r);this.BezierSegIntersectsBoundary(f)||(e.nextBezierCoefficient=h,e.previouisBezierCoefficient=h,c=f)}i.segs.length>0&&!R.closeDistEps(i.end,c.start)&&i.addSegment(Z.mkPP(i.end,c.start)),i.addSegment(c)},s.BezierSegIntersectsBoundary=function(t){return R.signedDoubledTriangleArea(t.B(0),t.B(1),t.B(2))<0?this.BezierSegIntersectsTree(t,this.thinWestHierarchy)||this.BezierSegIntersectsTree(t,this.westHierarchy):this.BezierSegIntersectsTree(t,this.thinEastHierarchy)||this.BezierSegIntersectsTree(t,this.eastHierarchy)},s.BezierSegIntersectsTree=function(t,e){if(null==e)return!1;if(Ut.intersect(t.pNodeOverICurve().parallelogram,e.parallelogram)){if(e.node.hasOwnProperty("children")){var r=e.node;return this.BezierSegIntersectsTree(t,r.children[0])||this.BezierSegIntersectsTree(t,r.children[1])}return l.BezierSegIntersectsBoundary(t,e.seg)}return!1},l.BezierSegIntersectsBoundary=function(t,e){for(var i,r=C(K.getAllIntersections(t,e,!1));!(i=r()).done;){if(!(e instanceof K))return!0;if(K.realCutWithClosedCurve(i.value,e,!1))return!0}return!1},Q(l,[{key:"GetPolyline",get:function(){return new ce(this.headSite)}},{key:"TailSite",get:function(){for(var t=this.headSite;null!=t.next;)t=t.next;return t}}]),l}(),is=function(l){function s(t,e,r,i,h,c){var f;return(f=l.call(this,null)||this).settings=t,f.OriginalGraph=e,f.Database=r,f.ProperLayeredGraph=h,f.LayerArrays=i,f.IntGraph=c,f}X(s,l);var o=s.prototype;return o.run=function(){this.createSplines()},o.createSplines=function(){this.createRegularSplines(),this.createSelfSplines(),null!=this.IntGraph&&this.RouteFlatEdges(),null==this.OriginalGraph.graph.parent&&this.RouteUnroutedEdges()},o.RouteUnroutedEdges=function(){for(var i,e=[],r=C(this.OriginalGraph.deepEdges);!(i=r()).done;){var h=i.value;h.curve||e.push(h)}if(0!=e.length){var f=(this.OriginalGraph.layoutSettings?this.OriginalGraph.layoutSettings:new La).commonSettings.edgeRoutingSettings;new bn(this.OriginalGraph,e,f.padding,f.polylinePadding,f.coneAngle,f.bundlingSettings,this.cancelToken).run(),Yn.constructorGA(this.OriginalGraph,e).run()}},o.RouteFlatEdges=function(){},o.createRegularSplines=function(){for(var r,e=C(this.Database.RegularMultiedges());!(r=e()).done;){var i=r.value;if(!bd(i)){for(var h=i.length,c=1===h&&this.MayOptimizeEdge(i[0]),f=Math.floor(h/2);f<h;f++)this.createSplineForNonSelfEdge(i[f],c);for(var p=Math.floor(h/2)-1;p>=0;p--)this.createSplineForNonSelfEdge(i[p],c)}}},o.MayOptimizeEdge=function(e){return!(this.ProperLayeredGraph.OutDegreeIsMoreThanOne(e.source)||this.ProperLayeredGraph.InDegreeIsMoreThanOne(e.target)||Il(e.edge.source)||Il(e.edge.target))},o.createSelfSplines=function(){for(var r,e=C(this.Database.Multiedges.keyValues());!(r=e()).done;){var i=r.value,h=i[0];if(h.x===h.y)for(var P,p=this.Database.Anchors[h.x],y=p.leftAnchor,m=C(i[1]);!(P=m()).done;){var L=P.value,E=this.settings.NodeSeparation+(this.settings.MinNodeWidth+y),S=p.bottomAnchor/2,T=p.origin,O=T.add(new R(0,S)),x=T.add(new R(E,S)),B=T.add(new R(E,-S)),M=T.add(new R(0,-S)),F=Yt.mkSiteP(T),A=new ce(F);F=Yt.mkSiteSP(F,O),F=Yt.mkSiteSP(F,x),F=Yt.mkSiteSP(F,B),F=Yt.mkSiteSP(F,M),Yt.mkSiteSP(F,T);var z=A.createCurve();if(L.curve=z,L.edge.smoothedPolyline=A,y=E,null!=L.edge.label){y+=L.edge.label.width;var V=z.value((z.parStart+z.parEnd)/2),Y=new R(V.x+L.labelWidth/2,p.y),W=new R(L.edge.label.width/2,L.edge.label.height/2),_=lt.mkPP(Y.add(W),Y.sub(W));L.edge.label.width=_.width,L.edge.label.height=_.height,L.edge.label.positionCenter(Y)}vr.trimSplineAndCalculateArrowheadsII(L.edge,L.edge.source.boundaryCurve,L.edge.target.boundaryCurve,z,!1)}}},o.createSplineForNonSelfEdge=function(e,r){null!=e.LayerEdges&&(this.drawSplineBySmothingThePolyline(e,r),e.IsVirtualEdge||(e.updateEdgeLabelPosition(this.Database.Anchors),vr.trimSplineAndCalculateArrowheadsII(e.edge,e.edge.source.boundaryCurve,e.edge.target.boundaryCurve,e.curve,!0)))},o.drawSplineBySmothingThePolyline=function(e,r){var i=new Sd(e,this.Database.Anchors,this.OriginalGraph,this.settings,this.LayerArrays,this.ProperLayeredGraph,this.Database),h=i.getSpline(r);e.reversed?(e.curve=h.reverse(),e.underlyingPolyline=i.Reverse().GetPolyline):(e.curve=h,e.underlyingPolyline=i.GetPolyline)},s.UpdateLabel=function(e,r){var i=null;r.labelIsToTheRightOfTheSpline?(e.label.positionCenter(new R(r.x+r.rightAnchor/2,r.y)),i=Z.mkPP(e.label.boundingBox.leftTop,e.label.boundingBox.leftBottom)):r.labelIsToTheLeftOfTheSpline&&(e.label.positionCenter(new R(r.x-r.leftAnchor/2,r.y)),i=Z.mkPP(e.label.boundingBox.rightTop,e.label.boundingBox.rightBottom));var h=s.GetSegmentInFrontOfLabel(e.curve,e.label.center.y);if(null!=h&&0===K.getAllIntersections(e.curve,K.polyFromBox(e.label.boundingBox),!1).length){var c={curveClosestPoint:void 0,labelSideClosest:void 0};if(s.FindClosestPoints(c,h,i))s.ShiftLabel(e,c);else{var f=h.closestParameter(i.start),p=h.closestParameter(i.end);h.value(f).sub(i.start).length<h.value(p).sub(i.end).length?(c.curveClosestPoint=h.value(f),c.labelSideClosest=i.start):(c.curveClosestPoint=h.value(p),c.labelSideClosest=i.end),s.ShiftLabel(e,c)}}},s.ShiftLabel=function(e,r){var i=e.lineWidth/2,h=r.curveClosestPoint.sub(r.labelSideClosest),c=h.length;c>i&&e.label.positionCenter(e.label.center.add(h.div(c*(c-i))))},s.FindClosestPoints=function(e,r,i){var h=K.minDistWithinIntervals(r,i,r.parStart,r.parEnd,i.parStart,i.parEnd,(r.parStart+r.parEnd)/2,(i.parStart+i.parEnd)/2);return!!h&&(e.curveClosestPoint=h.aX,e.labelSideClosest=h.bX,!0)},s.GetSegmentInFrontOfLabel=function(e,r){if(e instanceof K)for(var c,h=C(e.segs);!(c=h()).done;){var f=c.value;if((f.start.y-r)*(f.end.y-r)<=0)return f}return null},s.GetNodeKind=function(e,r){return 0===e?ne.Top:e<r.count?ne.Internal:ne.Bottom},s}(Vt);function bd(l){if(l.length<4)return!1;for(var o,s=C(l);!(o=s()).done;)if(o.value.edge.label)return!1;return!0}function Il(l){return l.node.selfEdges.size>0}function os(){os=function(){return s};var l,s={},o=Object.prototype,t=o.hasOwnProperty,e=Object.defineProperty||function(u,n,a){u[n]=a.value},r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",h=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag";function f(u,n,a){return Object.defineProperty(u,n,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[n]}try{f({},"")}catch{f=function(a,d,g){return a[d]=g}}function p(u,n,a,d){var v=Object.create((n&&n.prototype instanceof T?n:T).prototype),w=new j(d||[]);return e(v,"_invoke",{value:Y(u,a,w)}),v}function y(u,n,a){try{return{type:"normal",arg:u.call(n,a)}}catch(d){return{type:"throw",arg:d}}}s.wrap=p;var m="suspendedStart",P="suspendedYield",L="executing",E="completed",S={};function T(){}function O(){}function x(){}var B={};f(B,i,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(H([])));F&&F!==o&&t.call(F,i)&&(B=F);var A=x.prototype=T.prototype=Object.create(B);function z(u){["next","throw","return"].forEach(function(n){f(u,n,function(a){return this._invoke(n,a)})})}function V(u,n){function a(g,v,w,b){var I=y(u[g],u,v);if("throw"!==I.type){var G=I.arg,k=G.value;return k&&"object"==typeof k&&t.call(k,"__await")?n.resolve(k.__await).then(function(N){a("next",N,w,b)},function(N){a("throw",N,w,b)}):n.resolve(k).then(function(N){G.value=N,w(G)},function(N){return a("throw",N,w,b)})}b(I.arg)}var d;e(this,"_invoke",{value:function(v,w){function b(){return new n(function(I,G){a(v,w,I,G)})}return d=d?d.then(b,b):b()}})}function Y(u,n,a){var d=m;return function(g,v){if(d===L)throw new Error("Generator is already running");if(d===E){if("throw"===g)throw v;return{value:l,done:!0}}for(a.method=g,a.arg=v;;){var w=a.delegate;if(w){var b=W(w,a);if(b){if(b===S)continue;return b}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(d===m)throw d=E,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);d=L;var I=y(u,n,a);if("normal"===I.type){if(d=a.done?E:P,I.arg===S)continue;return{value:I.arg,done:a.done}}"throw"===I.type&&(d=E,a.method="throw",a.arg=I.arg)}}}function W(u,n){var a=n.method,d=u.iterator[a];if(d===l)return n.delegate=null,"throw"===a&&u.iterator.return&&(n.method="return",n.arg=l,W(u,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),S;var g=y(d,u.iterator,n.arg);if("throw"===g.type)return n.method="throw",n.arg=g.arg,n.delegate=null,S;var v=g.arg;return v?v.done?(n[u.resultName]=v.value,n.next=u.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,S):v:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,S)}function _(u){var n={tryLoc:u[0]};1 in u&&(n.catchLoc=u[1]),2 in u&&(n.finallyLoc=u[2],n.afterLoc=u[3]),this.tryEntries.push(n)}function D(u){var n=u.completion||{};n.type="normal",delete n.arg,u.completion=n}function j(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(_,this),this.reset(!0)}function H(u){if(u||""===u){var n=u[i];if(n)return n.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var a=-1,d=function g(){for(;++a<u.length;)if(t.call(u,a))return g.value=u[a],g.done=!1,g;return g.value=l,g.done=!0,g};return d.next=d}}throw new TypeError(typeof u+" is not iterable")}return O.prototype=x,e(A,"constructor",{value:x,configurable:!0}),e(x,"constructor",{value:O,configurable:!0}),O.displayName=f(x,c,"GeneratorFunction"),s.isGeneratorFunction=function(u){var n="function"==typeof u&&u.constructor;return!!n&&(n===O||"GeneratorFunction"===(n.displayName||n.name))},s.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,x):(u.__proto__=x,f(u,c,"GeneratorFunction")),u.prototype=Object.create(A),u},s.awrap=function(u){return{__await:u}},z(V.prototype),f(V.prototype,h,function(){return this}),s.AsyncIterator=V,s.async=function(u,n,a,d,g){void 0===g&&(g=Promise);var v=new V(p(u,n,a,d),g);return s.isGeneratorFunction(n)?v:v.next().then(function(w){return w.done?w.value:v.next()})},z(A),f(A,c,"Generator"),f(A,i,function(){return this}),f(A,"toString",function(){return"[object Generator]"}),s.keys=function(u){var n=Object(u),a=[];for(var d in n)a.push(d);return a.reverse(),function g(){for(;a.length;){var v=a.pop();if(v in n)return g.value=v,g.done=!1,g}return g.done=!0,g}},s.values=H,j.prototype={constructor:j,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(D),!n)for(var a in this)"t"===a.charAt(0)&&t.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=l)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var a=this;function d(G,k){return w.type="throw",w.arg=n,a.next=G,k&&(a.method="next",a.arg=l),!!k}for(var g=this.tryEntries.length-1;g>=0;--g){var v=this.tryEntries[g],w=v.completion;if("root"===v.tryLoc)return d("end");if(v.tryLoc<=this.prev){var b=t.call(v,"catchLoc"),I=t.call(v,"finallyLoc");if(b&&I){if(this.prev<v.catchLoc)return d(v.catchLoc,!0);if(this.prev<v.finallyLoc)return d(v.finallyLoc)}else if(b){if(this.prev<v.catchLoc)return d(v.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return d(v.finallyLoc)}}}},abrupt:function(n,a){for(var d=this.tryEntries.length-1;d>=0;--d){var g=this.tryEntries[d];if(g.tryLoc<=this.prev&&t.call(g,"finallyLoc")&&this.prev<g.finallyLoc){var v=g;break}}v&&("break"===n||"continue"===n)&&v.tryLoc<=a&&a<=v.finallyLoc&&(v=null);var w=v?v.completion:{};return w.type=n,w.arg=a,v?(this.method="next",this.next=v.finallyLoc,S):this.complete(w)},complete:function(n,a){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&a&&(this.next=a),S},finish:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.finallyLoc===n)return this.complete(d.completion,d.afterLoc),D(d),S}},catch:function(n){for(var a=this.tryEntries.length-1;a>=0;--a){var d=this.tryEntries[a];if(d.tryLoc===n){var g=d.completion;if("throw"===g.type){var v=g.arg;D(d)}return v}}throw new Error("illegal catch attempt")},delegateYield:function(n,a,d){return this.delegate={iterator:H(n),resultName:a,nextLoc:d},"next"===this.method&&(this.arg=l),S}},s}var as=function(l){function s(t,e,r){var i;if((i=l.call(this,r)||this).LayersAreDoubled=!1,null==t)return Xe(i);i.originalGraph=t,i.sugiyamaSettings=e;var h=Array.from(t.shallowNodes);i.nodeIdToIndex=new Map;for(var c=0,f=0,p=h;f<p.length;f++)i.nodeIdToIndex.set(p[f].id,c++);for(var L,m=[],P=C(i.originalGraph.shallowEdges);!(L=P()).done;){var E=L.value,S=i.nodeIdToIndex.get(E.source.id);if(null!=S){var T=i.nodeIdToIndex.get(E.target.id);if(null!=T){var O=new wr(S,T,E);m.push(O)}}}i.IntGraph=new Fi(m,t.shallowNodeCount),i.IntGraph.nodes=h,i.database=new od(h.length);for(var B,x=C(i.IntGraph.edges);!(B=x()).done;)i.database.registerOriginalEdgeInMultiedges(B.value);return i.cycleRemoval(),i}X(s,l);var o=s.prototype;return o.run=function(){0!==this.originalGraph.shallowNodeCount?(function(l,s){if(!s.isIdentity()){for(var e,o=s.inverse(),t=C(l.shallowNodes);!(e=t()).done;)e.value.transform(o);for(var h,i=C(l.shallowEdges);!(h=i()).done;){var c=h.value;if(null!=c.label){var f=lt.mkPP(o.multiplyPoint(new R(0,0)),o.multiplyPoint(new R(c.label.width,c.label.height)));c.label.width=f.width,c.label.height=f.height}}}}(this.originalGraph,this.sugiyamaSettings.transform),this.engineLayerArrays=this.calculateLayers(),this.sugiyamaSettings.edgeRoutingSettings.EdgeRoutingMode===re.SugiyamaSplines&&this.runPostLayering(),function(l,s){if(!s.isIdentity()){for(var t,o=C(l.shallowNodes);!(t=o()).done;)t.value.transform(s);for(var i,r=C(l.shallowEdges);!(i=r()).done;){var h=i.value;if(null!=h.label){var c=lt.mkPP(s.multiplyPoint(new R(0,0)),s.multiplyPoint(new R(h.label.width,h.label.height)));h.label.width=c.width,h.label.height=c.height}}(function(l,s){for(var t,o=C(l.shallowEdges);!(t=o()).done;){var e=t.value;e.label&&e.label.transform(s),Wd(s,e)}})(l,s),null==l.graph.parent&&(l.boundingBox=null)}}(this.originalGraph,this.sugiyamaSettings.transform)):this.originalGraph.boundingBox=lt.mkEmpty()},o.runPostLayering=function(){var r=null!=this.constrainedOrdering?re.Spline:this.sugiyamaSettings.commonSettings.edgeRoutingSettings.EdgeRoutingMode;this.extremeAspectRatio?qu(this.originalGraph,Array.from(this.originalGraph.deepEdges),this.cancelToken):r===re.SugiyamaSplines?this.calculateEdgeSplines():ul(this.originalGraph,Array.from(this.originalGraph.deepEdges),this.cancelToken)},o.SetLabels=function(){throw new Error("not implementedt")},o.cycleRemoval=function(){var e=this.sugiyamaSettings.verticalConstraints,r=e.isEmpty?mi.getFeedbackSet(this.IntGraph):e.getFeedbackSetExternal(this.IntGraph,this.nodeIdToIndex);this.database.addFeedbackSet(r)},o.calculateLayers=function(){this.CreateGluedDagSkeletonForLayering();var e=this.CalculateLayerArrays();return this.UpdateNodePositionData(),e},o.UpdateNodePositionData=function(){for(var e=0;e<this.IntGraph.nodeCount&&e<this.database.Anchors.length;e++)this.IntGraph.nodes[e].center=this.database.Anchors[e].origin;if(this.sugiyamaSettings.GridSizeByX>0)for(var r=0;r<this.originalGraph.shallowNodeCount;r++)this.SnapLeftSidesOfTheNodeToGrid(r,this.sugiyamaSettings.GridSizeByX)},o.SnapLeftSidesOfTheNodeToGrid=function(e,r){var i=this.IntGraph.nodes[e],h=this.database.Anchors[e];h.leftAnchor-=r/2,h.rightAnchor-=r/2;var c=i.boundingBox.left,p=c-Math.floor(c/r)*r;Math.abs(p)<.001||(i.center=Math.abs(p)<=r/2?i.center.add(new R(-p,0)):i.center.add(new R(r-p,0)),h.x=i.center.x)},o.GetCurrentHeight=function(){for(var i,e=new Nr,r=C(this.NodeAnchors());!(i=r()).done;){var h=i.value;e.AddValue(h.top),e.AddValue(h.bottom)}return e.length},o.NodeAnchors=os().mark(function t(){var e,r;return os().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:e=Math.min(this.IntGraph.nodeCount,this.anchors.length),r=0;case 2:if(!(r<e)){h.next=8;break}return h.next=5,this.anchors[r];case 5:r++,h.next=2;break;case 8:case"end":return h.stop()}},t,this)}),o.GetCurrentWidth=function(){for(var i,e=new Nr,r=C(this.NodeAnchors());!(i=r()).done;){var h=i.value;e.AddValue(h.left),e.AddValue(h.right)}return e.length},o.ExtendLayeringToUngluedSameLayerVertices=function(e){for(var r=this.verticalConstraints,i=0;i<e.length;i++)e[i]=e[r.nodeToRepr(i)];return e},o.calculateEdgeSplines=function(){new is(this.sugiyamaSettings,this.originalGraph,this.database,this.engineLayerArrays,this.properLayeredGraph,this.IntGraph).run()},o.YLayeringAndOrdering=function(e){var r=e.GetLayers();sd.Balance(this.gluedDagSkeletonForLayering,r,this.GetNodeCountsOfGluedDag(),null),r=this.ExtendLayeringToUngluedSameLayerVertices(r);var i=new Xn(r);if(null==this.HorizontalConstraints||this.HorizontalConstraints.IsEmpty)return this.YLayeringAndOrderingWithoutHorizontalConstraints(i);throw new Error("not implemented")},o.CreateProperLayeredGraph=function(e){for(var c,r=e.length,i=0,h=C(this.database.SkeletonEdges());!(c=h()).done;){var f=c.value,p=Td(e,f);p>0&&(f.LayerEdges=new Array(p));var y=0;if(p>1){var m=r+i++,P=new Vr(f.source,m,f.CrossingWeight,f.weight);f.LayerEdges[y++]=P;for(var L=0;L<p-2;L++)m++,i++,P=new Vr(m-1,m,f.CrossingWeight,f.weight),f.LayerEdges[y++]=P;P=new Vr(m,f.target,f.CrossingWeight,f.weight),f.LayerEdges[y]=P}else if(1===p){var E=new Vr(f.source,f.target,f.CrossingWeight,f.weight);f.LayerEdges[y]=E}}for(var O,S=new Array(this.originalGraph.shallowNodeCount+i).fill(0),T=C(this.database.SkeletonEdges());!(O=T()).done;){var x=O.value;if(null!=x.LayerEdges){var B=e[x.source];S[x.source]=B--;for(var F,M=C(x.LayerEdges);!(F=M()).done;)S[F.value.Target]=B--}else S[x.source]=e[x.source],S[x.target]=e[x.target]}return this.properLayeredGraph=new Ka(new Fi(Array.from(this.database.SkeletonEdges()),e.length)),this.properLayeredGraph.BaseGraph.nodes=this.IntGraph.nodes,new Xn(S)},o.YLayeringAndOrderingWithoutHorizontalConstraints=function(e){var r=this.CreateProperLayeredGraph(e.y);return dd.OrderLayers(this.properLayeredGraph,r,this.originalGraph.shallowNodeCount,this.sugiyamaSettings,this.cancelToken),vd.UpdateLayerArrays1(this.properLayeredGraph,r),r},o.CalculateYLayers=function(){var e=this.YLayeringAndOrdering(new md(this.gluedDagSkeletonForLayering,this.cancelToken));return null!=this.constrainedOrdering?e:this.InsertLayersIfNeeded(e)},o.InsertLayersIfNeeded=function(e){this.InsertVirtualEdgesIfNeeded(e);var r=this.AnalyzeNeedToInsertLayersAndHasMultiedges(e);if(r.needToInsertLayers){var i=ml.InsertLayers(this.properLayeredGraph,e,this.database,this.IntGraph);this.properLayeredGraph=i.layeredGraph,e=i.la,this.LayersAreDoubled=!0}else if(r.multipleEdges){var h=ts.InsertPaths(this.properLayeredGraph,e,this.database,this.IntGraph);this.properLayeredGraph=h.layeredGraph,e=h.la}return this.RecreateIntGraphFromDataBase(),e},o.RecreateIntGraphFromDataBase=function(){for(var i,e=new Array,r=C(this.database.Multiedges.values());!(i=r()).done;)e=e.concat(i.value);this.IntGraph.SetEdges(e,this.IntGraph.nodeCount)},o.InsertVirtualEdgesIfNeeded=function(e){if(null==this.constrainedOrdering)for(var i,r=C(this.database.Multiedges.keyValues());!(i=r()).done;){var h=i.value,c=h[0],f=h[1];if(f.length%2==0&&e.y[c.x]-1===e.y[c.y]){var p=new sr(null),y=new wr(c.x,c.y,p);y.IsVirtualEdge=!0,f.splice(f.length/2,0,y),this.IntGraph.addEdge(y)}}},o.AnalyzeNeedToInsertLayersAndHasMultiedges=function(e){for(var c,r=!1,i=!1,h=C(this.IntGraph.edges);!(c=h()).done;){var f=c.value;if(f.hasLabel&&e.y[f.source]!==e.y[f.target]){r=!0;break}}if(!1===r&&null==this.constrainedOrdering)for(var y,p=C(this.database.Multiedges.keyValues());!(y=p()).done;){var m=y.value,P=m[0];if(m[1].length>1&&(i=!0,e.y[P.x]-e.y[P.y]==1)){r=!0;break}}return{needToInsertLayers:r,multipleEdges:i}},o.UseBrandesXCalculations=function(e){return e.x.length>=this.sugiyamaSettings.BrandesThreshold},o.CalculateAnchorsAndYPositions=function(e){this.anchors=function(l,s,o,t,e){for(var r=l.Anchors=new Array(s.NodeCount),i=0;i<r.length;i++)r[i]=new Cl(e.LabelCornersPreserveCoefficient);for(var h=0;h<o.shallowNodeCount;h++)as.CalcAnchorsForOriginalNode(h,t,r,l,e);for(var f,c=C(l.AllIntEdges());!(f=c()).done;){var p=f.value;if(null!=p.LayerEdges){for(var m,y=C(p.LayerEdges);!(m=y()).done;){var L=m.value.Target;if(L!==p.target){var E=r[L];l.MultipleMiddles.has(L)?(E.leftAnchor=E.rightAnchor=4,E.topAnchor=E.bottomAnchor=Tl(e)/2):(E.leftAnchor=E.rightAnchor=.5,E.topAnchor=E.bottomAnchor=Tl(e)/2)}}if(p.hasLabel){var T=r[p.LayerEdges[p.LayerEdges.length/2].Source],x=p.labelHeight;T.rightAnchor=p.labelWidth,T.leftAnchor=8,T.topAnchor<x/2&&(T.topAnchor=T.bottomAnchor=x/2),T.labelIsToTheRightOfTheSpline=!0}}}return r}(this.database,this.properLayeredGraph,this.originalGraph,this.IntGraph,this.sugiyamaSettings),function(l,s,o,t,e,r,i){for(var y,h=t.Anchors,c=o.margins.top+500,f=0,p=C(l.Layers);!(y=p()).done;){for(var S,m=y.value,P=0,L=0,E=C(m);!(S=E()).done;){var O=h[S.value];O.bottomAnchor>P&&(P=O.bottomAnchor),O.topAnchor>L&&(L=O.topAnchor)}Od(m,P,L,o.shallowNodeCount,t.Anchors);var B=c+P+Ol(t,l,f,e,r,c),M=B+L;if(Ad(r)){M+=xl(M,r.GridSizeByY);for(var A,F=C(m);!(A=F()).done;)h[A.value].top=M}else if(kd(r)){var V=B-P;V+=xl(V,V);for(var W,Y=C(m);!(W=Y()).done;){var _=W.value;h[_].bottom=V,M=Math.max(h[_].top,M)}}else for(var j,D=C(m);!(j=D()).done;)h[j.value].y=B;c=M+r.ActualLayerSeparation(i),f++}Ol(t,l,f,e,r,c)}(e,0,this.originalGraph,this.database,this.IntGraph,this.sugiyamaSettings,this.LayersAreDoubled)},o.OptimizeEdgeLabelsLocations=function(){for(var e=0;e<this.anchors.length;e++){var r=this.anchors[e];if(r.labelIsToTheRightOfTheSpline){var i=this.GetSuccessorAndPredecessor(e);if(!Rd(r,i.predecessor,i.successor)){var h=i.predecessor.origin.sub(r.origin).length+i.successor.origin.sub(r.origin).length,f=new R(r.right-r.leftAnchor,r.y);i.predecessor.origin.sub(f).length+i.successor.origin.sub(f).length<h&&Al(r)}}}},o.GetSuccessorAndPredecessor=function(e){for(var r,h,i=C(this.properLayeredGraph.InEdges(e));!(h=i()).done;)r=h.value.Source;for(var f,y,p=C(this.properLayeredGraph.OutEdges(e));!(y=p()).done;)f=y.value.Target;return{predecessor:this.anchors[r],successor:this.anchors[f]}},o.CalculateLayerArrays=function(){var e=this.CalculateYLayers();return null==this.constrainedOrdering?(this.CalculateAnchorsAndYPositions(e),this.UseBrandesXCalculations(e)?this.CalculateXPositionsByBrandes(e):this.CalculateXLayersByGansnerNorth(e)):this.anchors=this.database.Anchors,this.OptimizeEdgeLabelsLocations(),this.engineLayerArrays=e,this.StraightensShortEdges(),this.CalculateOriginalGraphBox(),e},o.StretchToDesiredAspectRatio=function(e,r){e>r?this.StretchInYDirection(e/r):e<r&&this.StretchInXDirection(r/e)},o.StretchInYDirection=function(e){for(var h,r=(this.originalGraph.boundingBox.top+this.originalGraph.boundingBox.bottom)/2,i=C(this.database.Anchors);!(h=i()).done;){var c=h.value;c.bottomAnchor=c.bottomAnchor*e,c.topAnchor=c.topAnchor*e,c.y=r+e*(c.y-r)}var f=this.originalGraph.height*e;this.originalGraph.boundingBox=new lt({left:this.originalGraph.boundingBox.left,top:r+f/2,right:this.originalGraph.boundingBox.right,bottom:r-f/2})},o.StretchInXDirection=function(e){for(var h,r=(this.originalGraph.boundingBox.left+this.originalGraph.boundingBox.right)/2,i=C(this.database.Anchors);!(h=i()).done;){var c=h.value;c.leftAnchor=c.leftAnchor*e,c.rightAnchor=c.rightAnchor*e,c.x=r+e*(c.x-r)}var f=this.originalGraph.width*e;this.originalGraph.boundingBox=new lt({left:r-f/2,top:this.originalGraph.boundingBox.top,right:r+f/2,bottom:this.originalGraph.boundingBox.bottom})},o.CalculateOriginalGraphBox=function(){if(0!==this.anchors.length){for(var e=new lt({left:this.anchors[0].left,top:this.anchors[0].top,right:this.anchors[0].right,bottom:this.anchors[0].bottom}),r=1;r<this.anchors.length;r++){var i=this.anchors[r];e.add(i.leftTop),e.add(i.rightBottom)}this.originalGraph.labelSize&&this.originalGraph.addLabelToGraphBB(e),e.padEverywhere(this.originalGraph.margins),this.originalGraph.boundingBox=e}},o.StraightensShortEdges=function(){for(;this.StraightenEdgePaths(););},o.StraightenEdgePaths=function(){for(var i,e=!1,r=C(this.database.AllIntEdges());!(i=r()).done;){var h=i.value;2===h.LayerSpan&&(e=this.ShiftVertexWithNeighbors(h.LayerEdges[0].Source,h.LayerEdges[0].Target,h.LayerEdges[1].Target)||e)}return e},o.ShiftVertexWithNeighbors=function(e,r,i){var h=this.database.Anchors[e],c=this.database.Anchors[i],f=this.database.Anchors[r],p=(c.x-h.x)/(c.y-h.y)*(f.y-h.y)+h.x,y=1e-4;return p>f.x+y?this.TryShiftToTheRight(p,r):p<f.x-y&&this.TryShiftToTheLeft(p,r)},o.TryShiftToTheLeft=function(e,r){var h=this.engineLayerArrays.x[r];if(h>0){var f=Math.max(this.database.Anchors[this.engineLayerArrays.Layers[this.engineLayerArrays.y[r]][h-1]].right+(this.sugiyamaSettings.NodeSeparation+this.database.Anchors[r].leftAnchor),e);return f<this.database.Anchors[r].x-1&&(this.database.Anchors[r].x=f,!0)}return this.database.Anchors[r].x=e,!0},o.TryShiftToTheRight=function(e,r){var i=this.engineLayerArrays.Layers[this.engineLayerArrays.y[r]],h=this.engineLayerArrays.x[r];if(h<i.length-1){var f=Math.min(this.database.Anchors[i[h+1]].left-(this.sugiyamaSettings.NodeSeparation-this.database.Anchors[r].rightAnchor),e);return f>this.database.Anchors[r].x+1&&(this.database.Anchors[r].x=f,!0)}return this.database.Anchors[r].x=e,!0},o.CalculateXLayersByGansnerNorth=function(e){this.xLayoutGraph=this.CreateXLayoutGraph(e),this.CalculateXLayersByGansnerNorthOnProperLayeredGraph()},o.CalculateXLayersByGansnerNorthOnProperLayeredGraph=function(){for(var e=new El(this.xLayoutGraph,null).GetLayers(),r=0;r<this.database.Anchors.length;r++)this.anchors[r].x=e[r]},o.CreateXLayoutGraph=function(e){for(var c,r=this.properLayeredGraph.NodeCount,i=new Array,h=C(this.properLayeredGraph.Edges);!(c=h()).done;){var f=c.value,p=new wr(r,f.Source,null),y=new wr(r,f.Target,null);y.weight=f.Weight,p.weight=f.Weight,p.separation=0,y.separation=0,r++,i.push(p),i.push(y)}for(var P,m=C(e.Layers);!(P=m()).done;)for(var L=P.value,E=L.length-1;E>0;E--){var S=L[E],T=L[E-1],O=new wr(S,T,null);O.separation=Math.ceil(this.database.Anchors[S].leftAnchor+(this.database.Anchors[T].rightAnchor+this.sugiyamaSettings.NodeSeparation)+.5),i.push(O)}var F=new wd(this.IntGraph,this.properLayeredGraph,e,i,r);return F.SetEdgeWeights(),F},o.CalculateXPositionsByBrandes=function(e){Ll.CalculateXCoordinates(e,this.properLayeredGraph,this.originalGraph.shallowNodeCount,this.database.Anchors,this.sugiyamaSettings.NodeSeparation)},o.GluedDagSkeletonEdges=function(){for(var i,e=new Bn(this.IntGraph.nodeCount),r=C(this.database.Multiedges.keyValues());!(i=r()).done;){var h=i.value,f=h[1];if(!h[0].isDiagonal()){var p=this.verticalConstraints.gluedIntEdge(f[0]);p.source!==p.target&&e.set(p.source,p.target,p)}}for(var P,y=Array.from(this.verticalConstraints.gluedUpDownIntConstraints.values()).map(function(E){return function(l,s){var o=new wr(l.x,l.y,null);return o.weight=0,o.separation=1,o}(E)}),m=C(y);!(P=m()).done;){var L=P.value;e.set(L.source,L.target,L)}return Array.from(e.values())},s.CalcAnchorsForOriginalNode=function(e,r,i,h,c){var f={leftAnchor:0,rightAnchor:0,topAnchor:0,bottomAnchor:0};null!=r.nodes&&function(l,s,o){l.rightAnchor=l.leftAnchor=(s.width+o.GridSizeByX)/2,l.topAnchor=l.bottomAnchor=s.height/2}(f,r.nodes[e],c),function(l,s,o,t){var e=function(l,s,o,t){var e=0,r=l.GetMultiedge(s,s);if(r.length>0){for(var h,i=C(r);!(h=i()).done;){var c=h.value;null!=c.edge.label&&(o.rightAnchor+=c.edge.label.width,o.topAnchor<c.edge.label.height/2&&(o.topAnchor=o.bottomAnchor=c.edge.label.height/2))}e+=(t.NodeSeparation+t.MinNodeWidth)*r.length}return e}(o,l,s,t);s.rightAnchor+=e}(e,f,h,c);var y=c.MinNodeWidth/2;f.leftAnchor<y&&(f.leftAnchor=y),f.rightAnchor<y&&(f.rightAnchor=y);var m=c.MinNodeHeight/2;f.topAnchor<m&&(f.topAnchor=m),f.bottomAnchor<m&&(f.bottomAnchor=m),i[e]=Cl.mkAnchor(f.leftAnchor,f.rightAnchor,f.topAnchor,f.bottomAnchor,r.nodes[e],c.LabelCornersPreserveCoefficient),i[e].padding=r.nodes[e].padding},o.CreateGluedDagSkeletonForLayering=function(){this.gluedDagSkeletonForLayering=new Fi(this.GluedDagSkeletonEdges(),this.originalGraph.shallowNodeCount),this.SetGluedEdgesWeights()},o.SetGluedEdgesWeights=function(){for(var i,e=new Bn(this.IntGraph.nodeCount),r=C(this.gluedDagSkeletonForLayering.edges);!(i=r()).done;){var h=i.value;e.set(h.source,h.target,h)}for(var f,c=C(this.database.Multiedges.keyValues());!(f=c()).done;){var p=f.value,y=p[0],m=p[1];if(y.x!==y.y){var P=this.verticalConstraints.gluedIntPair(y);if(P.x===P.y)continue;for(var S,L=e.get(P.x,P.y),E=C(m);!(S=E()).done;)L.weight+=S.value.weight}}},o.GetNodeCountsOfGluedDag=function(){return this.verticalConstraints.isEmpty?new Array(this.IntGraph.nodeCount).fill(1):this.verticalConstraints.getGluedNodeCounts()},Q(s,[{key:"extremeAspectRatio",get:function(){var e=this.originalGraph.boundingBox,r=e.width/e.height;return r<.02||r>50}},{key:"verticalConstraints",get:function(){return this.sugiyamaSettings.verticalConstraints}},{key:"HorizontalConstraints",get:function(){return this.sugiyamaSettings.horizontalConstraints}}]),s}(Vt);function xl(l,s){if(0===s)return 0;var t=l-Math.floor(l/s)*s;return Math.abs(t)<1e-4?0:s-t}function Tl(l){return 1.5*l.MinNodeHeight/8}function Ol(l,s,o,t,e,r){var i=0;if(o>0){var h=function(l,s,o){for(var r,t=new mr,e=C(l);!(r=e()).done;){var i=r.value;if(!(i>=o.nodeCount))for(var c,h=C(o.outEdges[i]);!(c=h()).done;){var f=c.value;s[f.source]===s[f.target]&&t.addNN(f.source,f.target)}}return Array.from(t.values())}(s.Layers[o-1],s.y,t);if(h.length){var c=e.LayerSeparation/3,f=r;i=Math.max.apply(Math,h.map(function(p){return function(l,s,o,t){for(var h,e=0,i=C(t.GetMultiedgeI(l));!(h=i()).done;){e+=o;var f=h.value.edge.label;null!=f&&(f.positionCenter(new R(f.center.x,s+e+f.height/2)),e+=f.height)}return e}(p,f,c,l)}))}}return i}function Td(l,s){return l[s.source]-l[s.target]}function Od(l,s,o,t,e){if(function(l,s){for(var t,o=C(l);!(t=o()).done;)if(t.value<s)return!0;return!1}(l,t))for(var i,r=C(l);!(i=r()).done;){var h=i.value;if(h>=t){var c=e[h];c.bottomAnchor=s,c.topAnchor=o}}}function Ad(l){return l.SnapToGridByY===zn.Top}function kd(l){return l.SnapToGridByY===zn.Bottom}function Rd(l,s,o){if(l.labelIsToTheRightOfTheSpline){if(R.getTriangleOrientation(s.origin,l.origin,o.origin)===it.Clockwise)return!0;var t=l.leftAnchor,e=l.rightAnchor,r=l.x;return Al(l),R.getTriangleOrientation(s.origin,l.origin,o.origin)===it.Counterclockwise||(l.x=r,l.leftAnchor=t,l.rightAnchor=e,l.labelIsToTheRightOfTheSpline=!0,l.labelIsToTheLeftOfTheSpline=!1,!1)}return!1}function Al(l){var s=l.right,o=l.leftAnchor;l.leftAnchor=l.rightAnchor,l.rightAnchor=o,l.x=s-l.rightAnchor,l.labelIsToTheLeftOfTheSpline=!0,l.labelIsToTheRightOfTheSpline=!1}function Wd(l,s){if(null!=s.curve){s.curve=s.curve.transform(l);var o=s;null!=o.sourceArrowhead&&(o.sourceArrowhead.tipPosition=l.multiplyPoint(o.sourceArrowhead.tipPosition)),null!=o.targetArrowhead&&(o.targetArrowhead.tipPosition=l.multiplyPoint(o.targetArrowhead.tipPosition)),function(l,s){if(null!=l.smoothedPolyline)for(var o=l.smoothedPolyline.headSite;null!=o;o=o.next)o.point=s.multiplyPoint(o.point)}(s,l)}}var _d=.5,zd=0,qd=10;function us(l){return function(l,s){if(0===l.length)return[];var o=new Map,t=function(l,s,o,t){void 0===t&&(t=!0);var e=Cr({nodes:l});if(e){for(var r=Ae.mk("graph",new ar(e.width,e.height)),i=[],h=[],c=0,f=l;c<f.length;c++){var p=f[c];h[p.sourceIndex]=p,t&&!i[p.sourceIndex]&&(ls(r,p),i[p.sourceIndex]=!0)}for(var y=0,m=s;y<m.length;y++){var P=m[y];if(h[P.fromIndex]&&h[P.toIndex]){t||(i[P.fromIndex]||(ls(r,h[P.fromIndex]),i[P.fromIndex]=!0),i[P.toIndex]||(ls(r,h[P.toIndex]),i[P.toIndex]=!0));var L=r.setEdge("".concat(P.fromIndex),"".concat(P.toIndex));o.set(L,P)}}return r}}(l,s,o),e=Cr({nodes:l});hl(t,Array.from(t.deepEdges),0,_d,zd,qd);for(var r=[],i=0,h=Array.from(t.deepEdges).map(function(O){return O});i<h.length;i++){for(var c=h[i],f=o.get(c),p=[],y=c.curve.parStart;y<=c.curve.parEnd;y++){var m=c.curve.value(y);p.push(new R(m.x,m.y))}var P=Qd(c.curve),L=c.curve.value(P),S=Xd($d(c.curve.derivative(P))),T={edgeType:"ThreeSegmentedEdge",fromIndex:f.fromIndex,fromItem:f.fromItem,toIndex:f.toIndex,toItem:f.toItem,uniqueId:f.uniqueId,crossFilterLocation:{x:L.x,y:e.height-L.y},crossFilterAngle:-1*S,fromLocation:{x:c.curve.start.x,y:e.height-c.curve.start.y},toLocation:{x:c.curve.end.x,y:e.height-c.curve.end.y},points:p.map(function(O){return{x:O.x,y:e.height-O.y}})};r.push(T)}return r}(ti(l.nodeRequest,!1),l.edgeRequest)}function ls(l,s){var o=s.x+s.width/2,t=s.y+s.height/2,e=new je(new Fo("".concat(s.sourceIndex)));e.boundaryCurve=te.createRectangle(s.width,s.height,new R(o,t)),l.addNode(e)}function Qd(l){var o,s=[0];for(o=l.startPoint.next;null!=o;o=o.next)s.push(o.point.sub(o.prev.point).length+s[s.length-1]);for(var t=s[s.length-1]/2,e=0;e<s.length-1;e++)if(t<=s[e+1])return e+.5;return.5}function Xd(l){return(l+=180)>360&&(l-=360),l}function $d(l){return l.y>1e-4?90:l.y<-1e-4?270:l.x>1e-4?0:180}var Vi=function(){function l(){this.items=[]}return l.prototype.set=function(s,o){for(var t=this.items.length;t<s;t++)this.items[s]=null;this.items[s]=o},l.prototype.get=function(s){return this.items[s]},l.prototype.containsKey=function(s){return s<this.items.length&&null!=this.items[s]},l.prototype.forEach=function(s){for(var o=0;o<this.items.length;o++)this.containsKey(o)&&s(this.items[o])},l.prototype.getItems=function(){var s=[];return this.forEach(function(o){s.push(o)}),s},l}();function kl(l,s){for(var o=l.sort(function(L,E){return E.nodes.length-L.nodes.length}),t=Er({nodes:l.map(function(L){return ft(ft({},Er(L)),{sourceIndex:0})})}),e=[],r=0,i=0,h=o;i<h.length;i++){for(var c=h[i],f=Er(c),p=(t.height-f.height)/2,y=0,m=c.nodes;y<m.length;y++){var P=m[y];e.push({sourceIndex:P.sourceIndex,height:P.height,width:P.width,top:P.top+p,left:P.left+r})}r+=f.width+s}return e}var hs=50;function Rl(l){for(var o=function(l,s){for(var o=new Vi,t=[],e=new Vi,r=new Vi,i=new Vi,h=0,c=l;h<c.length;h++){var f=c[h];e.set(f.sourceIndex,[]),r.set(f.sourceIndex,!1),o.set(f.sourceIndex,f)}for(var p=0,y=s;p<y.length;p++)e.get((m=y[p]).fromIndex).push(m.toIndex),e.get(m.toIndex).push(m.fromIndex);for(var P=0,L=l;P<L.length;P++){var E=L[P];if(!r.get(E.sourceIndex)){var S={nodes:[],edges:[]};t.push(S);for(var T=t.length-1,O=[E.sourceIndex];O?.length>0;){var x=O.pop();r.get(x)||(r.set(x,!0),S.nodes.push(o.get(x)),i.set(x,T),O.push.apply(O,e.get(x)))}}}for(var B=0,M=s;B<M.length;B++){var m;t[i.get((m=M[B]).fromIndex)].edges.push(m)}return t}(ti(l.nodeRequest,!0),l.edgeRequest),t=[],e=0,r=o;e<r.length;e++){var c=Ln(Zd(r[e]));t.push({nodes:c})}return kl(t,hs)}function Zd(l){if(1===l.nodes.length)return[{height:l.nodes[0].height,sourceIndex:l.nodes[0].sourceIndex,width:l.nodes[0].width,x:0,y:0}];var s=function(l){var s=new De,o=new Ae(s);o.labelSize=new ar(100,100);for(var t=0,e=l.nodes;t<e.length;t++){var r=e[t],i=r.x+r.width/2,h=r.y+r.height/2,c=new je(new Fo("".concat(r.sourceIndex)));c.boundaryCurve=te.createRectangle(r.width,r.height,new R(i,h)),o.addNode(c)}for(var f=0,p=l.edges;f<p.length;f++){var y=p[f];o.setEdge("".concat(y.fromIndex),"".concat(y.toIndex))}return o}(l),o=new ki;o.NodeSeparation=hs,o.commonSettings.edgeRoutingSettings.EdgeRoutingMode=re.None,o.AvoidOverlaps=!0,s.layoutSettings=o,Af(s,null);for(var t=[],e=0,r=Array.from(s.shallowNodes);e<r.length;e++){var i=r[e],h=i.boundingBox;t.push({sourceIndex:parseInt(i.id,10),x:h.left,y:h.bottom,width:h.width,height:h.height})}return t}var cs=function(){function l(s){this.layedOut=!1,this.points=[],this.fromIndex=s.fromIndex,this.fromItem=s.fromItem,this.toIndex=s.toIndex,this.toItem=s.toItem,this.uniqueId=s.uniqueId}return Object.defineProperty(l.prototype,"fromNString",{get:function(){return"".concat(this.fromIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"toNString",{get:function(){return"".concat(this.toIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"uniqueString",{get:function(){return"".concat(this.uniqueId)},enumerable:!1,configurable:!0}),l}(),fs=function(){function l(s){this.left=s?s.left:0,this.top=s?s.top:0,this.width=s?s.width:0,this.height=s?s.height:0}return l.prototype.getCenter=function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},l.prototype.moveBy=function(s){return new l({left:this.left+s.x,top:this.top+s.y,width:this.width,height:this.height})},l.prototype.moveByMargin=function(s){return this.moveBy({x:s,y:s})},l.prototype.extendBy=function(s){return new l({left:this.left-s,top:this.top-s,width:this.width+2*s,height:this.height+2*s})},l.prototype.contains=function(s){return s&&this.left<=s.left&&s.left+s.width<=this.left+this.width&&this.top<=s.top&&s.top+s.height<=this.top+this.height},l.prototype.canFit=function(s){return s&&s.width<=this.width&&s.height<=this.height},l.prototype.intersects=function(s){return s&&s.left<=this.left+this.width&&this.left<=s.left+s.width&&s.top<=this.top+this.height&&this.top<=s.top+s.height},l.getBoundingRect=function(s){for(var o,t=0,e=s;t<e.length;t++){var r=e[t];if(r)if(o){var i=Math.min(r.left,o.left),h=Math.max(r.left+r.width,o.left+o.width),c=Math.min(r.top,o.top);o={left:i,top:c,width:h-i,height:Math.max(r.top+r.height,o.top+o.height)-c}}else o=r}return o?new l(o):null},l.getPointsRect=function(s){for(var o,t=0,e=s;t<e.length;t++){var r=e[t];if(r)if(o){var i=Math.min(r.x,o.left),h=Math.max(r.x,o.left+o.width),c=Math.min(r.y,o.top);o={left:i,top:c,width:h-i,height:Math.max(r.y,o.top+o.height)-c}}else o={left:r.x,top:r.y,width:0,height:0}}return o?new l(o):null},l.isIRect=function(s){return l.exists(s.left)&&l.exists(s.top)&&l.exists(s.width)&&l.exists(s.height)},l.exists=function(s){return null!=s},l.prototype.addPoint=function(s){if(s.x<this.left){var o=this.left+this.width;this.left=s.x,this.width=o-this.left}if(s.y<this.top){var t=this.top+this.height;this.top=s.y,this.height=t-this.top}this.left+this.width<s.x&&(this.width=s.x-this.left),this.top+this.height<s.y&&(this.height=s.y-this.top)},l.prototype.addRect=function(s){this.addPoint({x:s.left,y:s.top}),this.addPoint({x:s.left+s.width,y:s.top+s.height})},l.prototype.area=function(){return this.width*this.height},l}(),Di=function(l){return l[l.AllLayedOut=0]="AllLayedOut",l[l.AllNeedLayout=1]="AllNeedLayout",l[l.Partial=2]="Partial",l}({}),br=function(){function l(s,o){this.nodes=s,this.edges=o,this.nodeMap={},this.nodeAllEdgeMap={},this.nodesByComponentIndex={},this.recalc()}return l.prototype.recalc=function(){this.nodeMap={},this.nodeAllEdgeMap={},this.nodesByComponentIndex={};for(var s=0,o=this.nodes;s<o.length;s++){var t=o[s];this.nodeMap[t.sourceIndex]=t,this.nodesByComponentIndex[t.componentIndex]=t}for(var e=0,r=this.edges;e<r.length;e++){var i=r[e];this.addEdgeToSimpleNodeMap(i,i.fromIndex),this.addEdgeToSimpleNodeMap(i,i.toIndex)}this.CalculateEdgeLength()},l.prototype.getNodeBySourceIndex=function(s){return this.nodeMap[s]},l.prototype.getNodeByComponentIndex=function(s){return s in this.nodesByComponentIndex?this.nodesByComponentIndex[s]:void 0},l.prototype.CalculateEdgeLength=function(){for(var s=0,o=this.edges;s<o.length;s++){var t=o[s],e=this.getEdgesForNode(this.nodeMap[t.fromIndex]).length,r=this.getEdgesForNode(this.nodeMap[t.toIndex]).length;t.length=.5*Math.sqrt(e+r)}},l.prototype.getEdgesForNode=function(s){return s.sourceIndex in this.nodeAllEdgeMap?this.nodeAllEdgeMap[s.sourceIndex]:[]},l.prototype.getEdgesForNodes=function(s){for(var o=[],t=[],e=0,r=s;e<r.length;e++)for(var h=0,c=this.getEdgesForNode(r[e]);h<c.length;h++){var f=c[h];o[f.uniqueId]||(o[f.uniqueId]=!0,t.push(f))}return t},l.prototype.getOtherNode=function(s,o){return s.fromIndex===o.sourceIndex?this.nodeMap[s.toIndex]:this.nodeMap[s.fromIndex]},l.prototype.addEdgeToSimpleNodeMap=function(s,o){this.nodeAllEdgeMap[o]||(this.nodeAllEdgeMap[o]=[]),this.nodeAllEdgeMap[o].push(s)},l.prototype.getBoundingRect=function(){var s=this.nodes.map(function(o){return fs.isIRect(o)?o:void 0}).filter(function(o){return!!o});if(0!==s.length)return fs.getBoundingRect(s)},l.prototype.getNodesAsRect=function(){return this.nodes.map(function(o){return fs.isIRect(o)?o:void 0}).filter(function(o){return!!o}).map(function(o){return{sourceIndex:o.sourceIndex,left:o.left,top:o.top,width:o.width,height:o.height}})},l.prototype.getNodeLayoutStatus=function(){for(var s=!0,o=!0,t=0,e=this.nodes;t<e.length;t++)e[t].isLayedOut?o=!1:s=!1;return s?Di.AllLayedOut:o?Di.AllNeedLayout:Di.Partial},l}(),Cn=function(){function l(){this.left=void 0,this.top=void 0}return Object.defineProperty(l.prototype,"index",{get:function(){return"".concat(this.sourceIndex)},enumerable:!1,configurable:!0}),l.CreateFromNode=function(s){var o=new l;return o.componentIndex=s.sourceIndex,o.sourceIndex=s.sourceIndex,o.left=s.left,o.top=s.top,o.width=s.width,o.height=s.height,o.isLayedOut=this.exists(s.left)&&this.exists(s.top),o},l.CreateComponentNode=function(s,o){var t=new l;return t.componentIndex=o,t.sourceIndex=s.sourceIndex,t.left=s.left,t.top=s.top,t.width=s.width,t.height=s.height,t.isLayedOut=s.isLayedOut,t},l.prototype.setCenter=function(s){this.left=s.x-this.width/2,this.top=s.y-this.height/2},l.prototype.setPosition=function(s){this.left=s.left,this.top=s.top,this.height=s.height,this.width=s.width},Object.defineProperty(l.prototype,"Center",{get:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},enumerable:!1,configurable:!0}),l.prototype.toNode=function(){return{left:this.left,top:this.top,width:this.width,height:this.height,sourceIndex:this.sourceIndex}},l.exists=function(s){return null!=s},l}();function Gl(l,s,o,t){var e,r,i,h,c=l.nodes.find(function(m){return m.sourceIndex===(t?o.fromIndex:o.toIndex)}),f=ds(l,o,t),p={edge:o,isFromNode:t};if(c&&s.has(c))null!==(e=s.get(c))&&void 0!==e&&e.has(f)?null===(i=null===(r=s.get(c))||void 0===r?void 0:r.get(f))||void 0===i||i.push(p):null===(h=s.get(c))||void 0===h||h.set(f,[p]);else if(c){var y=new Map;y.set(f,[p]),s.set(c,y)}}function ov(l,s){var o=l.nodes.find(function(f){return f.sourceIndex===s.fromIndex}),t=l.nodes.find(function(f){return f.sourceIndex===s.toIndex}),e=ds(l,s,!0),r=ds(l,s,!1);if(!o||!t)return[];var i=Fl(o,t,e,r),h=Fl(t,o,r,e);return s.edgeType=zr(e)===zr(r)?"ThreeSegmentedEdge":"TwoSegmentedEdge",(h[0].x===i[0].x||h[0].y===i[0].y)&&(s.edgeType="OneSegmentedEdge"),[i[0],i[1],{x:(i[1].x+h[1].x)/2,y:(i[1].y+h[1].y)/2},h[1],h[0]]}function ds(l,s,o){var t=l.nodes.find(function(h){return h.sourceIndex===(o?s.fromIndex:s.toIndex)}),e=l.nodes.find(function(h){return h.sourceIndex===(o?s.toIndex:s.fromIndex)});if(!t||!e)return 2;var r=function(l){return Math.atan2(l.Center.y-l.top,l.Center.x-l.left)}(t),i=vs({x:t.Center.x,y:t.Center.y},{x:e.Center.x,y:e.Center.y});return 2*Math.PI-r<=i||i<r?0:r<=i&&i<Math.PI-r?1:Math.PI-r<=i&&i<Math.PI+r?2:3}function Nl(l,s){return l.y===s.y?l.x<s.x?0:2:l.y<s.y?3:1}function Fl(l,s,o,t){var e=[];return 0===o?(e[0]={x:l.left+l.width,y:l.Center.y},e[1]=zr(t)?{x:s.Center.x,y:l.Center.y}:{x:(l.left+l.width+s.left)/2,y:l.Center.y}):1===o?(e[0]={x:l.Center.x,y:l.top},e[1]=zr(t)?{x:l.Center.x,y:(l.top+s.top+s.height)/2}:{x:l.Center.x,y:s.Center.y}):2===o?(e[0]={x:l.left,y:l.Center.y},e[1]=zr(t)?{x:s.Center.x,y:l.Center.y}:{x:(s.left+s.width+l.left)/2,y:l.Center.y}):(e[0]={x:l.Center.x,y:l.top+l.height},e[1]=zr(t)?{x:l.Center.x,y:(l.top+l.height+s.top)/2}:{x:l.Center.x,y:s.Center.y}),e}function zr(l){return l%2==1}function vs(l,s){return function(l){return l<0?2*Math.PI+l:l}(Math.atan2(l.y-s.y,s.x-l.x))}var fv=function(){return function(){this.ScaleX=200,this.ScaleY=200,this.RemoveOverlaps=!0,this.IterationsWithMajorization=30,this.Exponent=-2,this.NodeSeparation=10}}(),dv=function(){return function(){this.endPointPadding=20,this.edgePadding=8,this.minEdgeSegmentLength=16}}(),gs=function(){function l(s,o){this.elements=[],this.next=void 0,this.elements.push(o),this.priority=s}return l.prototype.Add=function(s){this.elements.push(s)},l.prototype.Remove=function(s){if(1===this.elements.length)return this.elements[0]===s?(this.elements=[],{wasRemoved:!0,wasLast:!0}):{wasRemoved:!1,wasLast:!1};for(var o=0;o<this.elements.length;o++)if(this.elements[o]===s)return this.elements.splice(o,1),{wasRemoved:!0,wasLast:!1};return{wasRemoved:!1,wasLast:!1}},l.prototype.PopFirst=function(){var s=this.elements.length>0?this.elements[0]:void 0;return s&&this.Remove(s),{element:s,wasLast:0===this.elements.length}},l.prototype.GetNodeAndPreviousForPriority=function(s,o){return o>this.priority?this.next?this.next.GetNodeAndPreviousForPriority(this,o):void 0:o<this.priority?void 0:{previous:s,node:this}},l}(),vv=function(){function l(){this.head=void 0,this.elementPriorities=[]}return Object.defineProperty(l.prototype,"Count",{get:function(){for(var o=0,t=this.head;t;)o+=t.elements.length,t=t.next;return o},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"Any",{get:function(){return!!this.head},enumerable:!1,configurable:!0}),l.prototype.Insert=function(s,o){if(this.head){for(var t=void 0,e=this.head,r=void 0;e;){if(o<e.priority){(r=new gs(o,s)).next=e,t?t.next=r:this.head=r;break}if(o===e.priority){r=e;break}e=(t=e).next}r?r.Add(s):(r=new gs(o,s),t.next=r)}else this.head=new gs(o,s);this.elementPriorities[s.componentIndex]=o},l.prototype.SetPriority=function(s,o){if(this.head){var t=this.head.GetNodeAndPreviousForPriority(void 0,this.elementPriorities[s.componentIndex]);if(t){var e=t.node.Remove(s);e.wasRemoved&&e.wasLast&&(t.previous?t.previous.next=t.node.next:this.head=t.node.next)}}this.Insert(s,o)},l.prototype.PopMin=function(){if(this.head){var s=this.head.PopFirst(),o=this.head.priority;return s.wasLast&&(this.head=this.head.next),{element:s.element,priority:o}}},l}();function Bl(l,s){for(var o=[],t=new vv,e=[],r=0,i=l.nodes;r<i.length;r++)t.Insert(h=i[r],Number.POSITIVE_INFINITY),e[h.componentIndex]=Number.POSITIVE_INFINITY;for(t.SetPriority(s,0);t.Any;){var c=t.PopMin();e[c.element.componentIndex]=c.priority;for(var f=0,p=l.getEdgesForNode(c.element);f<p.length;f++){var y=p[f],m=l.getOtherNode(y,c.element);e[m.componentIndex]>e[c.element.componentIndex]+y.length&&(e[m.componentIndex]=e[c.element.componentIndex]+y.length,t.SetPriority(m,e[m.componentIndex]))}}for(var P=0,L=l.nodes;P<L.length;P++){var h;o[(h=L[P]).componentIndex]=h.componentIndex in e?e[h.componentIndex]:Number.POSITIVE_INFINITY}return o}var ps=function(){function l(){}return l.calculateAverageSize=function(s){for(var o=0,t=0,e=0,r=s;e<r.length;e++)for(var h=0,c=r[e].nodes;h<c.length;h++){var f=c[h];o+=Math.hypot(f.height,f.width),t+=1}return o/t/2},l.GetComponentGraphs=function(s){for(var o=[],e=function(f){var p=s.getEdgesForNodes(f),y=0;o.push(new br(f.map(function(m){return Cn.CreateComponentNode(m,y++)}),p))},r=0,i=this.GetComponentGraphList(s).sort(function(c){return c.length});r<i.length;r++)e(i[r]);return o},l.StitchGraphs=function(s){for(var o=s.sort(function(A,z){return z.getBoundingRect().height-A.getBoundingRect().height}),t=this.calculateAverageSize(o),e=new br([],[]),r=0,i=o;r<i.length;r++){for(var h=i[r],c=e.getBoundingRect(),f=c?c.left+c.width+t:0,p=c?(c.top+c.height)/2:0,y=h.getBoundingRect(),m=(y.top+y.height)/2,P=0,L=h.nodes;P<L.length;P++){var E=L[P];f&&(E.left+=f),p&&(E.top+=p-m),e.nodes.push(E)}for(var S=0,T=h.edges;S<T.length;S++){var O=T[S];e.edges.push(new cs({fromIndex:O.fromIndex,fromItem:O.fromItem,toIndex:O.toIndex,toItem:O.toItem,uniqueId:O.uniqueId}))}}for(var x=e.getNodesAsRect(),B=e.getBoundingRect(),M=0,F=x;M<F.length;M++)(E=F[M]).left=E.left-B.left,E.top=E.top-B.top;return new br(x.map(function(A){return Cn.CreateFromNode(A)}),e.edges)},l.GetComponentGraphList=function(s){for(var o=[],t=[],e=[],r=0,i=s.nodes;r<i.length;r++){var h=i[r];if(!o[h.sourceIndex]){var c=[];for(this.Enqueue(h,t,o);t.length>0;){var f=t[0];t.splice(0,1),c.push(f);for(var p=0,y=this.GetNeighbors(s,f);p<y.length;p++)this.Enqueue(y[p],t,o)}e.push(c)}}return e},l.GetNeighbors=function(s,o){for(var t=[],e=[],i=0,h=s.getEdgesForNode(o);i<h.length;i++){var f=s.getOtherNode(h[i],o);f&&!e[f.sourceIndex]&&(e[f.sourceIndex]=!0,t.push(f))}return t},l.Enqueue=function(s,o,t){t[s.sourceIndex]||(o.push(s),t[s.sourceIndex]=!0)},l}(),ys=function(){function l(){}return l.DotProduct=function(s,o){if(s.length!==o.length)return 0;for(var t=0,e=0;e<s.length;e++)t+=s[e]*o[e];return t},l.DoubleCenter=function(s){for(var o=this.initialize([],s.length),t=this.initialize([],s[0].length),e=0,r=0;r<s.length;r++)for(var i=0;i<s[0].length;i++)o[r]+=s[r][i],t[i]+=s[r][i],e+=s[r][i];for(r=0;r<s.length;r++)o[r]/=s.length;for(i=0;i<s[0].length;i++)t[i]/=s[0].length;for(e/=s.length,e/=s[0].length,r=0;r<s.length;r++)for(i=0;i<s[0].length;i++)s[r][i]-=o[r]+t[i]-e},l.MakeOrthogonal=function(s,o){if(s.length===o.length)for(var t=this.DotProduct(s,o)/this.DotProduct(o,o),e=0;e<s.length;e++)s[e]-=t*o[e]},l.Multiply=function(s,o){for(var t=0,e=s;t<e.length;t++)for(var i=0,h=e[t];i<h.length;i++);},l.MultiplyArray=function(s,o){if(s[0].length!==o.length)return null;for(var t=this.initialize([],s.length),e=0;e<s.length;e++)for(var r=0;r<s[0].length;r++)t[e]+=s[e][r]*o[r];return t},l.Norm=function(s){for(var o=0,t=0,e=s;t<e.length;t++)o+=Math.pow(e[t],2);return Math.sqrt(o)},l.Normalize=function(s){var o=this.Norm(s);if(o<=0)return 0;for(var t=0;t<s.length;t++)s[t]/=o;return o},l.RandomUnitLengthVector=function(s){for(var o=[],t=0;t<s;t++)o[t]=Math.random();return this.Normalize(o),o},l.SpectralDecomposition=function(s,o,t){for(var e=s[0].length,r=this.RandomUnitLengthVector(e),i=0,h=this.RandomUnitLengthVector(e),c=0,f=0,p=1-t,y=0;y<o&&f<p;y++){var m=this.MultiplyArray(s,r),P=this.MultiplyArray(s,h);i=this.Normalize(m),c=this.Normalize(P),this.MakeOrthogonal(P,m),this.Normalize(P),f=Math.min(this.DotProduct(r,m),this.DotProduct(h,P)),r=m,h=P}return{u1:r,u2:h,lambda1:i,lambda2:c}},l.SquareEntries=function(s){for(var o=0,t=s;o<t.length;o++)for(var r=0,i=t[o];r<i.length;r++){var h=i[r];h=Math.pow(h,2)}},l.DistanceScalingSubset=function(s,o,t,e,r){for(var i=o.length,h=s.length,c=[],f=0;f<h;f++)for(var p=0;p<i;p++)0===s[f][p]&&(c[f]=p);var y=this.initialize([],h);for(f=0;f<h;f++)for(p=0;p<i;p++)c[f]!==p&&(y[f]+=e[f][p]);for(var m=0;m<r;m++)for(f=0;f<h;f++){var P=0,L=0;for(p=0;p<i;p++)if(f!==p){var E=Math.hypot(o[c[f]]-o[p],t[c[f]]-t[p]);E>0&&(E=1/E),P+=e[f][p]*(o[p]+s[f][p]*(o[c[f]]-o[p])*E),L+=e[f][p]*(t[p]+s[f][p]*(t[c[f]]-t[p])*E)}o[c[f]]=P/y[f],t[c[f]]=L/y[f]}},l.ExponentialWeightMatrix=function(s,o){for(var t=[],e=0;e<s.length;e++){t[e]=[];for(var r=0;r<s[e].length;r++)s[e][r]>0&&(t[e][r]=Math.pow(s[e][r],o))}return t},l.LandmarkClassicalScaling=function(s,o,t){this.initialize(o.x,s.length),this.initialize(o.y,s.length);for(var e=[],r=0;r<s.length;r++){e[r]=[];for(var i=0;i<t.length;i++)e[r][i]=s[r][t[i]]}this.SquareEntries(e);var h=this.initialize([],s.length);for(r=0;r<s.length;r++){for(i=0;i<s.length;i++)h[r]+=e[r][i];h[r]/=s.length}this.DoubleCenter(e),this.Multiply(e,-.5);var c=this.SpectralDecomposition(e,30,1e-6);for(c.lambda1=Math.sqrt(Math.abs(c.lambda1)),c.lambda2=Math.sqrt(Math.abs(c.lambda2)),r=0;r<s[0].length;r++)for(i=0;i<e.length;i++)o.x[r]-=c.u1[i]*(Math.pow(s[i][r],2)-h[i])/2,o.y[r]-=c.u2[i]*(Math.pow(s[i][r],2)-h[i])/2},l.initialize=function(s,o){for(var t=0;t<o;t++)s[t]=0;return s},l}(),mt=function(l){return l[l.Red=0]="Red",l[l.Black=1]="Black",l}({}),Ml=function(){function l(){}return l.FromColor=function(s){var o=new l;return o.color=s,o},l.FromNodes=function(s,o,t,e,r){var i=this.FromColor(s);return i.item=o,i.parent=t,i.left=e,i.right=r,i},l.prototype.toString=function(){return this.item.toString()},l}(),Vl=function(){function l(s){this.tree=s,this.initialState=!1,this.reset()}return Object.defineProperty(l.prototype,"Current",{get:function(){return this.c.item},enumerable:!1,configurable:!0}),l.prototype.reset=function(){this.initialState=!0},l.prototype.moveNext=function(){return!this.tree.IsEmpty()&&(this.initialState?(this.initialState=!1,this.c=this.tree.TreeMinimum()):this.c=this.tree.Next(this.c),!!this.c)},l.prototype.next=function(s){return this.moveNext()?{done:!1,value:this.Current}:{done:!0,value:void 0}},l}(),yv=function(){function l(){this.root=void 0,this.nil=void 0,this.count=0,this.comparer=void 0,this.root=Ml.FromColor(mt.Black),this.nil=this.root}return l.FromComparer=function(s){var o=new l;return o.comparer=s,o},l.prototype[Symbol.iterator]=function(){return new Vl(this)},l.prototype.FindFirst=function(s){return this.FindFirstFromN(this.root,s)},l.prototype.FindFirstFromN=function(s,o){if(s!==this.nil){for(var t;s!==this.nil;)s=o(s.item)?(t=s).left:s.right;return t}},l.prototype.FindLast=function(s){return this.FindLastFromN(this.root,s)},l.prototype.FindLastFromN=function(s,o){if(s!==this.nil){for(var t;s!==this.nil;)o(s.item)?(t=s,s=s.right):s=s.left;return t}},l.prototype.Next=function(s){if(s.right!==this.nil)return this.TreeMinimumForN(s.right);for(var o=s.parent;o!==this.nil&&s===o.right;)s=o,o=o.parent;return this.ToNull(o)},l.prototype.ToNull=function(s){return s!==this.nil?s:null},l.prototype.Previous=function(s){if(s.left!==this.nil)return this.TreeMaximumForN(s.left);for(var o=s.parent;o!==this.nil&&s===o.left;)s=o,o=o.parent;return this.ToNull(o)},l.prototype.TreeMinimumForN=function(s){for(;s.left!==this.nil;)s=s.left;return this.ToNull(s)},l.prototype.TreeMinimum=function(){return this.TreeMinimumForN(this.root)},l.prototype.TreeMaximumForN=function(s){for(;s.right!==this.nil;)s=s.right;return this.ToNull(s)},l.prototype.TreeMaximum=function(){return this.TreeMaximumForN(this.root)},l.prototype.toString=function(){for(var s="{",o=0,t=new Vl(this);t.moveNext();)s+=t.Current.toString(),o!==this.count-1&&(s+=","),o++;return s+"}"},l.prototype.DeleteSubtree=function(s){var o;if(s.left===this.nil||s.right===this.nil)o=s;else for(o=s.right;o.left!==this.nil;)o=o.left;var t=o.left!==this.nil?o.left:o.right;return t.parent=o.parent,o.parent===this.nil?this.root=t:o===o.parent.left?o.parent.left=t:o.parent.right=t,o!==s&&(s.item=o.item),o.color===mt.Black&&this.DeleteFixup(t),this.ToNull(s)},Object.defineProperty(l.prototype,"Count",{get:function(){return this.count},enumerable:!1,configurable:!0}),l.prototype.Remove=function(s){var o=this.Find(s);return null!==o?(this.count--,this.DeleteSubtree(o)):null},l.prototype.DeleteNodeInternal=function(s){this.count--,this.DeleteSubtree(s)},l.prototype.FindForN=function(s,o){for(var t;s!==this.nil&&0!==(t=this.comparer.compareTo(o,s.item));)s=t<0?s.left:s.right;return this.ToNull(s)},l.prototype.Find=function(s){return this.FindForN(this.root,s)},l.prototype.Contains=function(s){return null!==this.Find(s)},l.prototype.DeleteFixup=function(s){for(;s!==this.root&&s.color===mt.Black;)if(s===s.parent.left)(o=s.parent.right).color===mt.Red&&(o.color=mt.Black,s.parent.color=mt.Red,this.LeftRotate(s.parent),o=s.parent.right),o.left.color===mt.Black&&o.right.color===mt.Black?(o.color=mt.Red,s=s.parent):(o.right.color===mt.Black&&(o.left.color=mt.Black,o.color=mt.Red,this.RightRotate(o),o=s.parent.right),o.color=s.parent.color,s.parent.color=mt.Black,o.right.color=mt.Black,this.LeftRotate(s.parent),s=this.root);else{var o;(o=s.parent.left).color===mt.Red&&(o.color=mt.Black,s.parent.color=mt.Red,this.RightRotate(s.parent),o=s.parent.left),o.right.color===mt.Black&&o.left.color===mt.Black?(o.color=mt.Red,s=s.parent):(o.left.color===mt.Black&&(o.right.color=mt.Black,o.color=mt.Red,this.LeftRotate(o),o=s.parent.left),o.color=s.parent.color,s.parent.color=mt.Black,o.left.color=mt.Black,this.RightRotate(s.parent),s=this.root)}s.color=mt.Black},l.prototype.IsEmpty=function(){return this.root===this.nil},l.prototype.TreeInsert=function(s){for(var o=this.nil,t=this.root,e=0;t!==this.nil;)o=t,t=(e=this.comparer.compareTo(s,t.item))<0?t.left:t.right;var r=Ml.FromNodes(mt.Black,s,o,this.nil,this.nil);return o===this.nil?this.root=r:e<0?o.left=r:o.right=r,this.ToNull(r)},l.prototype.InsertPrivate=function(s){for(this.count++,s.color=mt.Red;s!==this.root&&s.parent.color===mt.Red;)if(s.parent===s.parent.parent.left)(o=s.parent.parent.right).color===mt.Red?(s.parent.color=mt.Black,o.color=mt.Black,s.parent.parent.color=mt.Red,s=s.parent.parent):(s===s.parent.right&&this.LeftRotate(s=s.parent),s.parent.color=mt.Black,s.parent.parent.color=mt.Red,this.RightRotate(s.parent.parent));else{var o;(o=s.parent.parent.left).color===mt.Red?(s.parent.color=mt.Black,o.color=mt.Black,s.parent.parent.color=mt.Red,s=s.parent.parent):(s===s.parent.left&&this.RightRotate(s=s.parent),s.parent.color=mt.Black,s.parent.parent.color=mt.Red,this.LeftRotate(s.parent.parent))}this.root.color=mt.Black},l.prototype.Insert=function(s){var o=this.TreeInsert(s);return this.InsertPrivate(o),this.ToNull(o)},l.prototype.LeftRotate=function(s){var o=s.right;s.right=o.left,o.left!==this.nil&&(o.left.parent=s),o.parent=s.parent,s.parent===this.nil?this.root=o:s===s.parent.left?s.parent.left=o:s.parent.right=o,o.left=s,s.parent=o},l.prototype.RightRotate=function(s){var o=s.left;s.left=o.right,o.right!==this.nil&&(o.right.parent=s),o.parent=s.parent,s.parent===this.nil?this.root=o:s===s.parent.right?s.parent.right=o:s.parent.left=o,o.right=s,s.parent=o},l.prototype.AddCollection=function(s){for(var o=0,t=s;o<t.length;o++)this.Insert(t[o])},l.prototype.InsertUnique=function(s){var o=this.Find(s);return null!==o?o:this.Insert(s)},l}();function ms(l,s){return{x:l.x-s.x,y:l.y-s.y}}function ws(l,s){return l.x*s.x+l.y*s.y}function Dl(l){return{x:l.left+l.width/2,y:l.top+l.height/2}}function Pv(l,s){return{left:l.left+s.x,top:l.top+s.y,width:l.width,height:l.height}}function jl(l){return l.width*l.height}function Wl(l,s){var o=Math.min(l.left,s.left),t=Math.max(l.left+l.width,s.left+s.width),e=Math.min(l.top,s.top);return(t-o)*(Math.max(l.top+l.height,s.top+s.height)-e)}var Ev=function(){function l(){this.l=void 0,this.r=void 0,this.node=void 0}return Object.defineProperty(l.prototype,"box",{get:function(){return this.node?this.node:this.r?function(l,s){if(0===l.width||0===l.height)return s;if(0===s.width||0===s.height)return l;var o=Math.min(l.left,s.left),t=Math.max(l.left+l.width,s.left+s.width)-o,e=Math.min(l.top,s.top);return{left:o,width:t,top:e,height:Math.max(l.top+l.height,s.top+s.height)-e}}(this.l.box,this.r.box):this.l?this.l.box:null},enumerable:!1,configurable:!0}),l.prototype.add=function(s){if(this.l&&this.r)Wl(this.l.box,s)-jl(this.l.box)<Wl(this.r.box,s)-jl(this.r.box)?this.l.add(s):this.r.add(s);else{if(this.l&&!this.r)throw"TreeNode from OverlapRemoval is in a bad state.";this.node?(this.l=new l,this.l.node=this.node,this.node=null,this.r=new l,this.r.node=s):this.node=s}},l.prototype.count=function(){var s,o;return((null===(s=this.l)||void 0===s?void 0:s.count())||0)+((null===(o=this.r)||void 0===o?void 0:o.count())||0)+(this.node?1:0)},l.prototype.doesNodeIntersect=function(s){var o=this.box;if(!o)return null;if(function(l,s){return l&&l.left<=s.left+s.width&&s.left<=l.left+l.width&&l.top<=s.top+s.height&&s.top<=l.top+l.height}(s,o)){if(this.node)return this.node;if(this.l){var t=this.l.doesNodeIntersect(s);if(t)return t}if(this.r){var e=this.r.doesNodeIntersect(s);if(e)return e}}return null},l}(),Cv=function(){function l(s){this.center=s}return l.prototype.compareTo=function(s,o){var e={x:o.left+o.width/2,y:o.top+o.height/2},r=ms({x:s.left+s.width/2,y:s.top+s.height/2},this.center),i=ms(e,this.center),f=ws(r,r)-ws(i,i);return f<0?-1:f>0?1:0},l}(),Lv=function(){function l(s,o){this.graph=s,this.separation=o,this.maxRandomNodeShifts=1e3;var t=this.graph.nodes.map(function(e){return e.toNode()});this.initOverlapFightStructures(t)}return l.prototype.initOverlapFightStructures=function(s){this.root=new Ev,this.sortNodesForSweep(s)},l.prototype.calculateSpacing=function(){for(var s=[];!this.rBTreeForSweep.IsEmpty();){var o=this.rBTreeForSweep.TreeMinimum();this.rBTreeForSweep.DeleteNodeInternal(o);for(var t=o.item,e=0;e<this.maxRandomNodeShifts;e++){var r=this.root.doesNodeIntersect(t);if(null===r)break;var i=this.findRandomOffset(r,t);t=ft(ft({},Pv(t,i)),{sourceIndex:t.sourceIndex})}s.push({sourceIndex:t.sourceIndex,height:t.height,width:t.width,left:t.left,top:t.top}),this.root.add(t)}return s},l.prototype.findRandomOffset=function(s,o){var t=Dl(o),e=Dl(s),r=178*Math.random()-89,i=ms(t,this.center);ws(i,i)<1&&(i={x:1,y:0}),i=function(l,s){var o=Math.cos(s),t=Math.sin(s);return{x:o*l.x-t*l.y,y:t*l.x+o*l.y}}(i,r);var h=this.findCoeff(i.x,t.x,e.x,s.width/2+o.width/2+this.separation),c=this.findCoeff(i.y,t.y,e.y,s.height/2+o.height/2+this.separation),f=function(l,s){return{x:l.x*s,y:l.y*s}}(i,h=h>0&&c>0?Math.min(c,h):Math.max(c,h));return f},l.prototype.findCoeff=function(s,o,t,e){var r=(-e+t-o)/s,i=(e+t-o)/s;return i>0&&r>0?Math.min(r,i):i>=0?i:r},l.prototype.sortNodesForSweep=function(s){this.calculateCenter();var o=new Cv(this.center);this.rBTreeForSweep=yv.FromComparer(o);for(var t=0,e=s;t<e.length;t++)this.rBTreeForSweep.Insert(e[t])},l.prototype.calculateCenter=function(){var s=this.graph.getBoundingRect();this.center={x:s.left+s.width/2,y:s.top+s.height/2}},l}();function Tv(l,s){var o={x:[],y:[]};if(0===l.nodes.length)return Ps(l,o);if(1===l.nodes.length)return Ps(l,{x:[0],y:[0]});var t=s.IterationsWithMajorization,e=s.Exponent,r=function(l){for(var s={pivotArray:[],distances:[]},o={},t=0,e=l.nodes;t<e.length;t++)o[(r=e[t]).componentIndex]=Number.POSITIVE_INFINITY;for(var i=l.nodes[0],h=0;h<l.nodes.length;h++){var c=Bl(l,i);s.pivotArray[h]=i.componentIndex,s.distances[h]=[];for(var f=0,p=l.nodes;f<p.length;f++){var r;s.distances[h][(r=p[f]).componentIndex]=c[r.componentIndex]}for(var y=-1,m=0;m<c.length;m++)o[m]=Math.min(o[m],c[m]),(y<0||o[m]>o[y])&&(y=m);i=l.nodes[y]}return s}(l);if(ys.LandmarkClassicalScaling(r.distances,o,r.pivotArray),function(l,s){for(var o=0,t=0,e=0,r=l.edges;e<r.length;e++){var i=r[e],h=i.fromIndex,c=i.toIndex;o+=Math.hypot(s.x[h]-s.x[c],s.y[h]-s.y[c]),t+=i.length}if(t>0&&(o/=t),o>0)for(var f=0,p=l.nodes;f<p.length;f++){var y=p[f];s.x[y.componentIndex]/=o,s.y[y.componentIndex]/=o}}(l,o),t>0){var i=function(l){for(var s=[],o=0,t=l.nodes;o<t.length;o++){var e=t[o],r=Bl(l,e);s&&(s[e.componentIndex]=r)}return s}(l),h=ys.ExponentialWeightMatrix(i,e);ys.DistanceScalingSubset(i,o.x,o.y,h,t)}return Ps(l,o)}function Ov(l,s,o){for(var t=[],e=function(L){var E=o.find(function(x){return x.sourceIndex===L.sourceIndex});if(E){var O=Cn.CreateFromNode({left:E.x*s.ScaleX,top:E.y*s.ScaleY,height:L.height,width:L.width,sourceIndex:L.sourceIndex});t.push(O)}else t.push(L)},r=0,i=l.nodes;r<i.length;r++)e(i[r]);for(var c=function(l){var s=l.nodes.map(function(i){return Cn.CreateFromNode(i)}),o=new br(s,[]),t=ps.calculateAverageSize([o]);return{nodes:new Lv(o,t).calculateSpacing()}}({nodes:t}),f=function(L){var E=t.find(function(S){return S.sourceIndex===L.sourceIndex});E&&E.setPosition(L)},p=0,y=c.nodes;p<y.length;p++)f(y[p]);return new br(t,l.edges)}function Ps(l,s){for(var o=[],t=0,e=l.nodes;t<e.length;t++){var r=e[t];o.push({componentIndex:r.componentIndex,sourceIndex:r.sourceIndex,x:s.x[r.componentIndex],y:s.y[r.componentIndex]})}return o}var Rv=function(){function l(s){this.layoutSettings=s}return l.prototype.layoutDiagram=function(s){var e,o=s.getNodeLayoutStatus(),t=[];if(o===Di.AllNeedLayout){var r=this.layoutNodes(s);e=new br(r,s.edges),t=r}else if(o===Di.AllLayedOut)e=s;else{var h=s.getBoundingRect().width+50,c=s.nodes.filter(function(p){return!!p.isLayedOut});t=this.layoutNewNodes(s).map(function(p){return p.left=p.left+h,p}),e=new br(bt(bt([],c,!0),t.map(function(p){return Cn.CreateFromNode(p)}),!0),s.edges)}return{alteredNodes:t,alteredEdges:this.layoutEdges(e)}},l.prototype.layoutNewNodes=function(s){for(var o=[],t=[],e=0,r=s.nodes.filter(function(p){return!p.isLayedOut});e<r.length;e++)o.push(Cn.CreateFromNode(ft({},r[e])));for(var h=0,c=s.edges;h<c.length;h++){var f=c[h];this.hasNode(o,f.fromIndex)&&this.hasNode(o,f.toIndex)&&t.push(new cs(ft({},f)))}return this.layoutNodes(new br(o,t))},l.prototype.hasNode=function(s,o){return!!s.find(function(t){return t.sourceIndex===o})},l.prototype.layoutNodes=function(s){return function(l,s){return function(l,s){for(var t=[],e=0,r=ps.GetComponentGraphs(l);e<r.length;e++){var i=r[e],c=Ov(i,s,Tv(i,s));t.push(c)}return ps.StitchGraphs(t).nodes}(l,s)}(s,new fv)},l.prototype.layoutEdges=function(s){return function(l,s){for(var o=[],t=0,e=l.edges;t<e.length;t++){var r=e[t];if(!r.layedOut){var i=ft(ft({},r),{fromLocation:{x:0,y:0},toLocation:{x:0,y:0},crossFilterAngle:0,crossFilterLocation:{x:0,y:0}}),h=ov(l,i);o.push(ft(ft({},i),{fromLocation:h[0],toLocation:h[h.length-1],points:h,crossFilterAngle:0,crossFilterLocation:h[2]}))}}var c=new Map;(function(l,s,o){o.forEach(function(t){Gl(l,s,t,!0),Gl(l,s,t,!1)})})(l,c,o),function(l,s){l.forEach(function(o,t){o.forEach(function(e,r){var i=function(l,s){return s%2==0?l.height:l.width}(t,r),h=i/(e.length+1);if(e=function(l,s){return l.sort(function(o,t){var i=vs(o.isFromNode?o.edge.fromLocation:o.edge.toLocation,o.isFromNode?o.edge.toLocation:o.edge.fromLocation),f=vs(t.isFromNode?t.edge.fromLocation:t.edge.toLocation,t.isFromNode?t.edge.toLocation:t.edge.fromLocation);return 0===s&&(i=i>=1.5*Math.PI?i-2*Math.PI:i,f=f>=1.5*Math.PI?f-2*Math.PI:f),1===s||0===s?f-i:i-f})}(e,r),e.length>1)for(var c=0;c<=e.length-1;c++){var f=e[c].edge.points,p="TwoSegmentedEdge"===e[c].edge.edgeType,y="OneSegmentedEdge"===e[c].edge.edgeType;e[c].isFromNode?(zr(r)?(f[0].x=t.left+h*(c+1),f[1].x=t.left+h*(c+1),y&&(f[4].x=f[0].x)):(f[0].y=t.top+h*(c+1),f[1].y=t.top+h*(c+1),y&&(f[4].y=f[0].y)),p&&(f[3].x=f[1].x,f[3].y=f[1].y)):(zr(r)?(f[f.length-2].x=t.left+h*(c+1),f[f.length-1].x=t.left+h*(c+1),y&&(f[0].x=f[4].x)):(f[f.length-2].y=t.top+h*(c+1),f[f.length-1].y=t.top+h*(c+1),y&&(f[0].y=f[4].y)),p&&(f[1].x=f[3].x,f[1].y=f[3].y)),f[2]={x:(f[1].x+f[f.length-2].x)/2,y:(f[1].y+f[f.length-2].y)/2},e[c].edge.fromLocation.x=f[0].x,e[c].edge.fromLocation.y=f[0].y,e[c].edge.toLocation.x=f[4].x,e[c].edge.toLocation.y=f[4].y}})})}(c);var f=new Map;return function(l,s){s.forEach(function(o){var t,e=o.fromIndex<o.toIndex?o.fromIndex.toString()+":"+o.toIndex.toString():o.toIndex.toString()+":"+o.fromIndex.toString();l.has(e)?null===(t=l.get(e))||void 0===t||t.push(o):l.set(e,new Array(o))})}(f,o),function(l,s){l.forEach(function(o,t){if(o.length>1&&"ThreeSegmentedEdge"===o[0].edgeType)for(var r=(o[0].points[1].x===o[1].points[1].x?Math.abs(o[0].fromLocation.x-o[0].toLocation.x):Math.abs(o[0].fromLocation.y-o[0].toLocation.y))/(o.length+1),i=0;i<o.length;i++){var h=Nl(o[i].points[0],o[i].points[1]),c=Nl(o[i].points[1],o[i].points[3]),f=(i+1)*r;0===h?(o[i].points[1].x=1===c?o[i].points[0].x+f:o[i].points[4].x-f,o[i].points[3].x=o[i].points[1].x):2===h?(o[i].points[1].x=1===c?o[i].points[0].x-f:o[i].points[4].x+f,o[i].points[3].x=o[i].points[1].x):3===h?(o[i].points[1].y=2===c?o[i].points[0].y+f:o[i].points[4].y-f,o[i].points[3].y=o[i].points[1].y):(o[i].points[1].y=2===c?o[i].points[0].y-f:o[i].points[4].y+f,o[i].points[3].y=o[i].points[1].y),o[i].points[2]={x:(o[i].points[1].x+o[i].points[3].x)/2,y:(o[i].points[1].y+o[i].points[3].y)/2}}})}(f),function(l){l.forEach(function(s){s.crossFilterLocation="TwoSegmentedEdge"===s.edgeType?{x:(s.points[0].x+s.points[1].x)/2,y:(s.points[0].y+s.points[1].y)/2}:{x:(s.points[1].x+s.points[3].x)/2,y:(s.points[1].y+s.points[3].y)/2}})}(o),function(l,s){l.forEach(function(o){var t=o.points[3],e=o.points[1];(Math.abs(o.points[0].x-o.points[4].x)<=s.minEdgeSegmentLength||Math.abs(o.points[0].y-o.points[4].y)<=s.minEdgeSegmentLength)&&(e=o.points[0],t=o.points[1]),"TwoSegmentedEdge"===o.edgeType&&(e=o.points[0],t=o.points[1]),o.crossFilterAngle=Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI)})}(o,s),o}(s,new dv)},l}();function Lo(l){return{crossFilterAngle:l.crossFilterAngle,crossFilterLocation:l.crossFilterLocation,edgeType:Gv(l.edgeType),fromIndex:l.fromIndex,fromItem:l.fromItem,fromLocation:l.fromLocation,points:l.points,toIndex:l.toIndex,toItem:l.toItem,toLocation:l.toLocation,uniqueId:l.uniqueId}}function Gv(l){return"OneSegmentedEdge"===l?"OneSegmentedEdge":"ThreeSegmentedEdge"===l?"ThreeSegmentedEdge":"TwoSegmentedEdge"}function Fv(l){return Pt(this,void 0,void 0,function(){var o;return Et(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Bv(l)];case 1:return[2,t.sent()];case 2:return o=t.sent(),[2,{failureReason:JSON.stringify(o),promiseHandle:l.promiseHandle,status:er.Failure}];case 3:return[2]}})})}function Bv(l){return Pt(this,void 0,void 0,function(){var s,o,t,e,r,i,c,f,p,y,m,P,L,E,S,T,O,x,B,M,F,A,z,V,Y;return Et(this,function(W){switch(W.label){case 0:for(o=[],t=[],e=[],r=0,i=(s=l[ae.PerformLayout]).nodeRequest;r<i.length;r++)o[i[r].sourceIndex]=!1;if(0!==s.layoutType&&1!==s.layoutType)return[3,3];if(1===s.layoutType)for(c=0,f=s.nodeRequest;c<f.length;c++)Io((p=f[c]).left)||Io(p.top)?(o[p.sourceIndex]=!0,e.push(ft(ft({},p),{left:void 0,top:void 0}))):t.push(p);return 0===s.layoutType||0===t.length?(y=Ss,m=[l],[4,Mv(s)]):[3,2];case 1:return[2,y.apply(void 0,m.concat([W.sent()]))];case 2:return[3,6];case 3:return 3!==s.layoutType?[3,5]:(P=Ss,L=[l],[4,Vv(s)]);case 4:return[2,P.apply(void 0,L.concat([W.sent()]))];case 5:s.nodeRequest.forEach(function(_){!Io(_.left)&&!Io(_.top)&&t.push(_)}),W.label=6;case 6:if(E=new Vi,e.length>0)for(S=[],s.edgeRequest.forEach(function(_){o[_.fromIndex]&&o[_.toIndex]&&S.push(_)}),T=Rl({nodeRequest:e,edgeRequest:S,layoutType:s.layoutType}),[],O=e.length>0?kl([{nodes:t},{nodes:T}],hs):T,x=0,B=O;x<B.length;x++)E.set((A=B[x]).sourceIndex,A);else for(M=0,F=t;M<F.length;M++)E.set((A=F[M]).sourceIndex,A);return z=s.edgeRequest.filter(function(_){return E.containsKey(_.fromIndex)&&E.containsKey(_.toIndex)}),V=E.getItems(),Y=us({nodeRequest:V,edgeRequest:z,layoutType:s.layoutType}),[2,Ss(l,{alteredEdges:Y.map(function(_){return Lo(_)}),alteredNodes:V})]}})})}function Mv(l){var s=Rl(l),o={alteredNodes:s.map(function(e){return{height:e.height,left:e.left,sourceIndex:e.sourceIndex,top:e.top,width:e.width}}),alteredEdges:[]},t=[];return s.length>0&&(t=us({nodeRequest:s,edgeRequest:l.edgeRequest,layoutType:l.layoutType}).map(function(e){return Lo(e)})),{alteredNodes:o.alteredNodes,alteredEdges:t}}function Vv(l){return{alteredNodes:[],alteredEdges:us({nodeRequest:l.nodeRequest,edgeRequest:l.edgeRequest,layoutType:l.layoutType}).map(function(t){return Lo(t)})}}function Io(l){return null==l}function Ss(l,s){var o;return(o={failureReason:void 0,promiseHandle:l.promiseHandle})[ae.PerformLayout]=s,o.status=er.Success,o}var Dv=function(){function l(){this.layoutAlgorithm=new Rv({nodePadding:50})}return l.prototype.performLayout=function(s){var o=new br(s.nodeRequest.map(function(e){return Cn.CreateFromNode(e)}),s.edgeRequest.map(function(e){return new cs(e)})),t=this.layoutAlgorithm.layoutDiagram(o);return{alteredEdges:t.alteredEdges.map(function(e){return Lo(e)}),alteredNodes:t.alteredNodes}},l}(),jv=new Dv;function Wv(l){return Pt(this,void 0,void 0,function(){var o;return Et(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Hv(l)];case 1:return[2,t.sent()];case 2:return o=t.sent(),[2,{failureReason:JSON.stringify(o),promiseHandle:l.promiseHandle,status:er.Failure}];case 3:return[2]}})})}function Hv(l){return Pt(this,void 0,void 0,function(){var s,o;return Et(this,function(t){return(s=l[ae.PerformLayout]).useMsagl?[2,Fv(l)]:(o=jv.performLayout(s),[2,_v(l,o)])})})}function _v(l,s){var o;return(o={failureReason:void 0,promiseHandle:l.promiseHandle})[ae.PerformLayout]=s,o.status=er.Success,o}var zv=function(){function l(s){this.workerHost=s}return l.prototype.onMessage=function(s){if(s?.data){var o=s.data;o[ae.PerformLayout]?this.executeAwaitAndPost(Wv,o):o[ae.Ping]&&this.executeAwaitAndPost(this.ping,o)}},l.prototype.executeAwaitAndPost=function(s,o){return Pt(this,void 0,void 0,function(){var t;return Et(this,function(e){switch(e.label){case 0:return[4,s(o)];case 1:return t=e.sent(),this.postResult(t),[2]}})})},l.prototype.postResult=function(s){this.workerHost.postMessage(s)},l.prototype.ping=function(s){return Pt(this,void 0,void 0,function(){var t;return Et(this,function(e){return[2,(t={},t[ae.Ping]=s[ae.Ping],t.promiseHandle=s.promiseHandle,t.status=er.Success,t)]})})},l}(),qv=new zv(self);self.addEventListener("message",function(l){return qv.onMessage(l)})}(),window.desktopModelView={}}();