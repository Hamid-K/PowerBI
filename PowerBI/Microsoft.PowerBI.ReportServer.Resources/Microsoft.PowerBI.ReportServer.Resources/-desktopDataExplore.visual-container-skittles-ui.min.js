"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["visual-container-skittles-ui"],{41606:function(ue,H,a){a.d(H,{x:function(){return B}});var f=a(47508),B=function(){function A(){}return A.getDefaultVisualPlugin=function(w){return w&&w.featureSwitches&&w.featureSwitches.pivotTableVisualEnabled?f.L.tableEx:f.L.table},A}()},32441:function(ue,H,a){a.d(H,{u:function(){return w}});var f=a(50423),B=a(18460),A=function(M,F,k,G,Y){return{formattingSources:M,indicatorEnabled:F,mobileFormatting:k,disabledCards:G,disabledSlices:Y}},w=function(){function x(){var M=this;this.mobileFormatting=!1,this.propertyChanged=new f.EventEmitter,this.outputArgs={propertyChanged:function(k){return M.propertyChanged.emit(k)}},this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="FormattingPaneComponentId"}return x.\u0275fac=function(F){return new(F||x)},x.\u0275cmp=f.\u0275\u0275defineComponent({type:x,selectors:[["formatting-pane-lazy"]],inputs:{formattingSources:"formattingSources",indicatorEnabled:"indicatorEnabled",mobileFormatting:"mobileFormatting",disabledCards:"disabledCards",disabledSlices:"disabledSlices"},outputs:{propertyChanged:"propertyChanged"},decls:1,vars:10,consts:[[3,"inputArgs","modulePath","outputArgs","componentId"]],template:function(F,k){1&F&&f.\u0275\u0275element(0,"pbi-lazy-load",0),2&F&&f.\u0275\u0275property("inputArgs",f.\u0275\u0275pureFunction5(4,A,k.formattingSources,k.indicatorEnabled,k.mobileFormatting,k.disabledCards,k.disabledSlices))("modulePath",k.modulePath)("outputArgs",k.outputArgs)("componentId",k.componentId)},dependencies:[B.R],encapsulation:2,changeDetection:0}),x}()},78633:function(ue,H,a){a.d(H,{a:function(){return w}});var f=a(50423),B=a(18460),A=function(M){return{colors:M}},w=function(){function x(){this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="GradientBarComponentId"}return x.\u0275fac=function(F){return new(F||x)},x.\u0275cmp=f.\u0275\u0275defineComponent({type:x,selectors:[["gradient-bar-lazy"]],inputs:{colors:"colors"},decls:1,vars:5,consts:[[3,"inputArgs","modulePath","componentId"]],template:function(F,k){1&F&&f.\u0275\u0275element(0,"pbi-lazy-load",0),2&F&&f.\u0275\u0275property("inputArgs",f.\u0275\u0275pureFunction1(3,A,k.colors))("modulePath",k.modulePath)("componentId",k.componentId)},dependencies:[B.R],encapsulation:2,changeDetection:0}),x}()},92278:function(ue,H,a){a.d(H,{I:function(){return w}});var f=a(50423),B=a(18460),A=function(M,F,k,G,Y){return{toggle:M,ariaLabelledby:F,ariaDescribedby:k,toggleLabel:G,isDisabled:Y}},w=function(){function x(){var M=this;this.onToggleChange=new f.EventEmitter,this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="ToggleSwitchModernComponentId",this.outputArgs={onToggleChange:function(k){return M.onToggleChange.emit(k)}}}return x.\u0275fac=function(F){return new(F||x)},x.\u0275cmp=f.\u0275\u0275defineComponent({type:x,selectors:[["toggle-switch-modern-lazy"]],inputs:{toggle:"toggle",ariaLabelledby:"ariaLabelledby",ariaDescribedby:"ariaDescribedby",toggleLabel:"toggleLabel",isDisabled:"isDisabled"},outputs:{onToggleChange:"onToggleChange"},decls:1,vars:10,consts:[[3,"inputArgs","modulePath","outputArgs","componentId"]],template:function(F,k){1&F&&f.\u0275\u0275element(0,"pbi-lazy-load",0),2&F&&f.\u0275\u0275property("inputArgs",f.\u0275\u0275pureFunction5(4,A,k.toggle,k.ariaLabelledby,k.ariaDescribedby,k.toggleLabel,k.isDisabled))("modulePath",k.modulePath)("outputArgs",k.outputArgs)("componentId",k.componentId)},dependencies:[B.R],encapsulation:2,changeDetection:0}),x}()},90094:function(ue,H,a){a.d(H,{l:function(){return w}});var f=a(50423),B=a(18460),A=function(M){return{warningMessage:M}},w=function(){function x(){this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="WarningComponentId"}return x.\u0275fac=function(F){return new(F||x)},x.\u0275cmp=f.\u0275\u0275defineComponent({type:x,selectors:[["warning-eager"]],inputs:{warningMessage:"warningMessage"},decls:1,vars:5,consts:[[3,"inputArgs","modulePath","componentId"]],template:function(F,k){1&F&&f.\u0275\u0275element(0,"pbi-lazy-load",0),2&F&&f.\u0275\u0275property("inputArgs",f.\u0275\u0275pureFunction1(3,A,k.warningMessage))("modulePath",k.modulePath)("componentId",k.componentId)},dependencies:[B.R],encapsulation:2,changeDetection:0}),x}()},42101:function(ue,H,a){a.d(H,{p:function(){return ne}});var f=a(9844),M=(a(32441),a(78633),a(92278),a(90094),a(77476)),F=a(9398),k=a(76072),G=a(82156),Y=a(50423),ie={loadChildren:function(){return Promise.all([a.e(5),a.e("pane-formatting")]).then(a.bind(a,53150)).then(function(v){return v.PaneFormattingModule})}};k.E.addLazyLoadForLegacyMapping("@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",ie.loadChildren);var de=[{path:"dummy-pane-formatting-lazy",loadChildren:ie.loadChildren}],ne=function(){function e(){}return e.\u0275fac=function(I){return new(I||e)},e.\u0275mod=Y.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=Y.\u0275\u0275defineInjector({imports:[M.CommonModule,f.j,G.N,F.Bz.forChild(de)]}),e}()},79930:function(ue,H,a){a.d(H,{EY:function(){return e},Wg:function(){return v}});var f=a(81337),B=a(8082),A=a(40823),w=a(83008),x=a(77616),M=a(54766),F=a(54834),k=a(74082),G=a(25740),Y=a(65181),ie=a(58938),de=a(4877),J=a(50423),e={provide:"conditionalFormattingDialogLauncherService",useFactory:function(I,C,u,h,O,T){return new v(I,C,u,h,O,T)},deps:[Y.o,ie.x,de.a,w.D,B.s,A._]},v=function(){function I(C,u,h,O,T,$){this.localizationService=C,this.dialogService=u,this.itemPickerService=h,this.dataSourcesService=O,this.runningVisuals=T,this.dataSourcesSerializer=$}return I.prototype.show=function(C,u,h,O,T,$){return(0,f.__awaiter)(this,void 0,void 0,function(){var D;return(0,f.__generator)(this,function(z){switch(z.label){case 0:return D=h&&(0,k.tO)(h)?h.measure:h,[4,this.showModernConditionaFormattingDialog(C,u,D,O,T,$)];case 1:return[2,z.sent().afterClosed().toPromise()]}})})},I.prototype.showModernConditionaFormattingDialog=function(C,u,h,O,T,$){var D,V;return(0,f.__awaiter)(this,void 0,void 0,function(){var z,ge,j,pe,ke;return(0,f.__generator)(this,function(He){return z=this.dataSourcesSerializer.serializeDataSources(this.dataSourcesService.get()),ge=O.propertyDescriptor,j=this.runningVisuals.getVisual(C),pe={colorPalette:(0,G.NO)($.colorPalette),icons:null===(D=this.itemPickerService)||void 0===D?void 0:D.getIcons(),iconSets:null===(V=this.itemPickerService)||void 0===V?void 0:V.getIconSets(),inDataSources:z,propertySelector:O.selector&&(0,M.UZ)(O.selector),allowOverrideTotalMatching:O.allowOverrideSubtotalMatching,propertyDefinition:T&&(0,M.W7)(T,ge),propertyDescriptor:(0,x.m8)(ge,this.localizationService),targetFieldDisplayName:u,targetFieldExpr:h&&F.ib.serializeExpr(h),visualType:j.getType(),hasGrouping:!!O.selector&&this.hasGroupingColumn(j)},ke={title:"".concat(pe.propertyDescriptor.displayName," - ").concat(pe.targetFieldDisplayName),input:pe,hideOkButton:!1,hideCancelButton:!1,focusInitialCloseButton:!0,footerLink:{text:this.localizationService.get("ConditionalFormattingDialog_LearnMore"),url:"https://go.microsoft.com/fwlink/?linkid=874399",type:"external"}},[2,this.dialogService.showTemplateDialog("ConditionalFormattingDialog",ke,{minWidth:"940px",height:"665px",autoFocus:!0})]})})},I.prototype.hasGroupingColumn=function(C){if(!C)return!1;var u=C.getDataViews()[0];if(u.metadata&&u.metadata.columns)for(var h=0,O=u.metadata.columns;h<O.length;h++)if(!O[h].isMeasure)return!0;return!1},I.\u0275fac=function(u){return new(u||I)(J.\u0275\u0275inject(Y.o),J.\u0275\u0275inject(ie.x),J.\u0275\u0275inject(de.a),J.\u0275\u0275inject(w.D),J.\u0275\u0275inject(B.s),J.\u0275\u0275inject(A._))},I.\u0275prov=J.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac}),I}()},15250:function(ue,H,a){a.r(H),a.d(H,{VisualContainerSkittlesUIModule:function(){return qi}});var f=a(77476),B=a(22346),A=a(91280),w=a(42101),x=a(82156),M=a(79061),F=a(47913),k=a(63654),G=a(45411),Y=a(66972),ie=a(13254),de=a(72359),J=a(16095),ne=a(17177),e=a(50423),v=a(36858),I=a(74913),C=function(){function r(){}return r.prototype.ngOnInit=function(){this.infoIconName=this.mouseOutIcon},r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["build-field-well-info"]],inputs:{iconSprite:"iconSprite",mouseInIcon:"mouseInIcon",mouseOutIcon:"mouseOutIcon",tooltip:"tooltip"},decls:1,vars:4,consts:[["role","tooltip","tri-svg-icon-16","","tabIndex","0",2,"margin-left","4px","margin-top","6px","fill","currentColor",3,"name","sprite","pbiTooltip","mouseenter","mouseleave"]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"tri-svg-icon",0),e.\u0275\u0275listener("mouseenter",function(){return i.infoIconName=i.mouseInIcon})("mouseleave",function(){return i.infoIconName=i.mouseOutIcon}),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275property("name",i.infoIconName)("sprite",i.iconSprite)("pbiTooltip",i.tooltip),e.\u0275\u0275attribute("aria-label",i.tooltip))},dependencies:[v.V,I.M],encapsulation:2}),r}(),u=a(81337),h=a(35510),O=a(30794),T=a(59017),$=a(63057),D=a(37272),V=a(59973),z=a(81905),ge=a(22318),j=a(83317),pe=a(13941),ke=a(98476),xe=a(73221),St=a(96883),Ke=a(61561),se=a(8590),fe=a(60661),_t=a(41606),Qe=a(38078),bt=a(57419),S=a(62458),Ie=a(45413),ve=a(74082),Ft=a(58295),Xe=a(45551),me=a(58609),Ge=a(43626),kt=a(79930),Ye=a(26898),Be=a(29748),Ve=a(83008),Et=a(85677),Je=a(66890),xt=a(48145),ze=a(11494),It=a(13702),Ze=a(8082),qe=a(15393),Pt=a(9380),wt=a(23983),Pe=a(28894),we=a(65181),Ot=a(88409),Tt=a(29866),Dt=a(67930);function Mt(r,n){if(1&r&&e.\u0275\u0275element(0,"build-field-well-info",6),2&r){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("tooltip",t.bucketInfTooltip)}}function Lt(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",2)(2,"h2",3),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Mt,1,1,"build-field-well-info",4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"field-picker-modern-lazy",5),e.\u0275\u0275listener("onExprChange",function(c){var p=e.\u0275\u0275restoreView(t).$implicit,g=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(g.onFieldsChange(c,p))})("onCrossPickerDrop",function(c){e.\u0275\u0275restoreView(t);var d=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(d.onCrossBucketFieldDrop(c))}),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&r){var l,i=n.$implicit,o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(i.displayName),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.hasHiddenFieldsInVisual),e.\u0275\u0275advance(1),e.\u0275\u0275property("ariaLabelledby",o.bucketTitle)("disabled",i.disabled)("initialExpr",i.exprs)("withFieldList",!0)("allowMultipleValues",i.supportsMultipleItems)("allowReorderItems",null===(l=o.allowReorderFields)||void 0===l||l)("promotedActionStrategy",i.showHideProjectionStrategy)("getDropExprStrategy",i.getDropExprStrategy)("menuStrategy",i.menuStrategy)("displayNameStrategy",i.displayNameStrategy)("flyoutFieldsStrategy",i.fieldFlyoutFieldsStrategy)("visualCalcFieldsStrategy",i.visualCalcFlyoutFieldsStrategy)("directEditStrategy",i.directEditStrategy)("enterExitFieldRename",e.\u0275\u0275pipeBind1(6,24,i.enterExitFieldRename$))("externalCrossPickerDragDropMonitor",i.crossBucketDragDropMonitor)("perspectiveDisplayName",o.perspectiveDisplayName)("tooltipWithFlexiblePositions",!1)("parameterPickerDataFormat",o.parameterPickerDataFormat)("visualCapabilities",o.visualCapabilities)("addDataAriaLabelKey",i.addDataAriaLabelKey)("emptyFieldSetsDefaultLabel",!o.isVisualCalc)("role",i.role)}}var et=function(r){function n(t,i,o,l,s,c,d,p,g,P,W,m,oe,U,te,E,X,R){var y=r.call(this)||this;y.changeDetectorRef=t,y.conceptualSchemaProxy=i,y.contextActivityService=o,y.dataSourcesService=l,y.eventBridge=s,y.explorationDisplayNameService=c,y.featureSwitchService=d,y.groupingDesignStateService=p,y.lazyScoped=g,y.localizationService=P,y.runningVisualService=W,y.showValueAsService=m,y.visibilityService=oe,y.visualAuthoring=U,y.visualCalcEagerService=te,y.visualPlugin=E,y.explorationCapabilitiesService=X,y.visualActionContext=R,y.contentUpdate=new e.EventEmitter,y.parameterPickerDataFormat="buildfieldwell",y.fieldBucketsInternal$=new h.X(void 0),y.uid=Qe.b$.generateGuid(),y.manualUpdate$=new O.xQ,y.fieldBuckets$=y.fieldBucketsInternal$.asObservable();var b,re=new bt.W,q=y.changes$("visualContainer");return(0,T.aj)([q.pipe(),(0,$.T)(y.manualUpdate$,y.visualCalcEagerService.onContextChange$(),y.visibilityService.get$(16),y.eventBridge.on(se.CCe),y.eventBridge.on(se.KD7),y.eventBridge.on(se.jCS),q.pipe((0,V.h)(function(L){return!!L}),(0,z.w)(function(L){return y.runningVisualService.getVisual$(L)}),(0,z.w)(function(L){return L?L.getErrorInfo$():D.E})),y.eventBridge.on(se.D1A)).pipe((0,ge.O)(void 0))]).pipe((0,j.R)(y.onDestroy$)).subscribe(function(L){var le=L[0];return(0,u.__awaiter)(y,void 0,void 0,function(){var ae=this;return(0,u.__generator)(this,function(Ce){switch(Ce.label){case 0:return[4,re.enqueue(function(){return(0,u.__awaiter)(ae,void 0,void 0,function(){var N,K=this;return(0,u.__generator)(this,function(Q){switch(Q.label){case 0:return this.visualCapabilities=(0,fe.cj)(le,this.visualPlugin),this.contentUpdate.emit({type:"start",forVisualContainerChange:N=le!==b}),[4,this.updateFieldBuckets(le)];case 1:return Q.sent(),this.changeDetectorRef.detectChanges(),setTimeout(function(){K.contentUpdate.emit({type:"end",forVisualContainerChange:N})}),b=le,[2]}})})})];case 1:return Ce.sent(),[2]}})})}),y.showFieldTooltip=y.localizationService.get("Visual_Calculation_Field_Well_Show_In_Visual"),y.hideFieldTooltip=y.localizationService.get("Visual_Calculation_Field_Well_Hide_From_Visual"),y.bucketInfTooltip=y.localizationService.get("Visual_Calculation_Field_Bucket_Tooltip"),y}return(0,u.__extends)(n,r),n.prototype.onFieldsChange=function(t,i){return(0,u.__awaiter)(this,void 0,void 0,function(){var o,l;return(0,u.__generator)(this,function(s){switch(s.label){case 0:return l=!0,(0,pe.JB)(o=t.fromUpdate)?[4,this.handleAdd(i,o,t.newExpr)]:[3,2];case 1:return l=s.sent(),[3,9];case 2:return(0,pe.H2)(o)?[4,this.handleDelete(i,o)]:[3,4];case 3:return s.sent(),[3,9];case 4:return(0,pe.cA)(o)?[4,this.handleReplace(i,o,t.newExpr)]:[3,6];case 5:return l=s.sent(),[3,9];case 6:return(0,pe.cS)(o)?(S.fF.assert(function(){return _.isArray(t.newExpr)},"there must be multiple fields when reoreder udpate happpens"),[4,this.handleReorder(i,o,t.newExpr)]):[3,8];case 7:return l=s.sent(),[3,9];case 8:(0,pe.y$)(o)&&this.handleRename(i,o),s.label=9;case 9:return l||this.manualUpdate$.next(),[2]}})})},n.prototype.onCrossBucketFieldDrop=function(t){if(t.fromGroupId===this.uid&&t.toGroupId===this.uid){var i=t.fromComponentId,o=t.toComponentId;if(i===o)return void S.fF.assertFail("Expect this only be called when field is moved between different buckets");var l=this.fieldBucketsInternal$.value,s=_.find(l,function(U){return U.bucketUid===i});if(s){var c=_.find(l,function(U){return U.bucketUid===o});if(c){var d=t.fromPosition,p=t.toPosition;S.fF.assert(function(){return 1===_.size(d)&&("end"===p||1===_.size(p))},"build-field-well supports cross-bucket drag-drop of first-level items only. Add your implementation for new scenario.");var P="end"===p?"end":p[0],W=s.properties[d[0]],m={sourceRole:s.role,sourceIndex:W.startIndex,hierarchyLevelCount:_.size(W.hierarchyLevels)};"end"===P?c.core.dropWithPayload(m):c.properties[P].core.dropWithPayloadAndAction(m,2)}}}},n.prototype.updateFieldBuckets=function(t){return(0,u.__awaiter)(this,void 0,void 0,function(){var i,o,l,s,c,d,p,g,P,W,m,oe,U,te,E=this;return(0,u.__generator)(this,function(X){switch(X.label){case 0:return this.fieldWellViewModelService?[3,2]:(i=this,[4,this.lazyScoped.get("fieldWellViewModelService")]);case 1:i.fieldWellViewModelService=X.sent(),X.label=2;case 2:return this.fieldWellBucketService?[3,4]:(o=this,[4,this.lazyScoped.get(Ge.fI)]);case 3:o.fieldWellBucketService=X.sent(),X.label=4;case 4:return this.fieldWellFieldService?[3,6]:(l=this,[4,this.lazyScoped.get(Ge.tE)]);case 5:l.fieldWellFieldService=X.sent(),X.label=6;case 6:return t?[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]:(s=(0,fe.x3)(_t.x.getDefaultVisualPlugin(this.featureSwitchService)),c=this.fieldWellViewModelService.createEmptyBuckets(s,[]),S.fF.assert(function(){return 1===_.size(c)},"build-field-well should show only one empty bucket when no visual is selected"),d=c[0],p=this.localizationService.get("Data"),(g=(0,u.__assign)((0,u.__assign)({},d),{core:this.getFieldWellBucketCore(d),displayName:p,addDataAriaLabelKey:this.localizationService.format("Skittles_Build_AddData",p)})).fieldFlyoutFieldsStrategy=this.getFieldFlyoutFieldsStrategy(g,0,t),this.fieldBucketsInternal$.next([g]),[2]);case 7:return P=X.sent(),this.isVisualCalc=16===t.visibility,[4,this.fieldWellViewModelService.createBuckets(this.runningVisualService.getVisual(t),t,P,this.groupingDesignStateService,this.showValueAsService,this.visualPlugin,this.explorationDisplayNameService,[],!1,this.isVisualCalc,!0,this.overrideSingleBucketForAutoVisual).promise];case 8:for(W=X.sent(),m=_.map(W,function(R){var y=E.isVisualCalc?R.properties:_.filter(R.properties,function(N){return!N.isHiddenInVisual}),b=R.properties.length>y.length;R.properties=y,R.supportsMultipleItems=E.isVisualCalc||R.supportsMultipleItems;var Z={getDropExpr:function(K,Q){return Promise.resolve({expr:K})},getDroppedExprChildren:function(K,Q,he,ce){return E.getChildExprs(R,Q,he,ce)}},re={getMenu:function(K,Q,he,ce){return void 0===ce&&(ce=void 0),E.getMenu(R,K,Q,ce)},menuItemClickHandler:function(K,Q,he){S.fF.assert(function(){return 1===_.size(Q)},"build-field-well supports menu on first-level items, i.e., non hierarchy-levels only. Add your implementation for new scenario."),Ce[Q[0]].core.selectFieldMenuItem(K.data)}},q={getDisplayName:function(K,Q,he,ce){return E.getFieldDisplayName(R,Q,ce)},isRenameAllowed:function(K,Q){return E.getIsRenameAllowed(R,K,Q)},getCustomTooltipContent:function(K,Q,he,ce){return E.getCustomTooltipContent(R,he,ce)},isFieldInvalid:function(K,Q){return E.getIsFieldInvalid(R,K,Q)},getDisplayNameStyle:function(K,Q){return E.getFieldDisplayNameStyle(R,K,Q)}},L=_.map(R.properties,function(N){return N.expr}),le=new h.X(void 0),ae=(0,u.__assign)((0,u.__assign)({},R),{bucketUid:Qe.b$.generateGuid(),exprs:R.supportsMultipleItems?_.map(L,function(N){return{expr:N}}):L[0]?{expr:L[0]}:void 0,core:E.getFieldWellBucketCore(R),getDropExprStrategy:Z,menuStrategy:re,displayNameStrategy:q,enterExitFieldRename$:le,addDataAriaLabelKey:E.localizationService.format("Skittles_Build_AddData",R.displayName)}),Ce=_.map(R.properties,function(N,K){return(0,u.__assign)((0,u.__assign)({},N),{core:E.getFieldWellFieldCore(ae,K,N),showHideFieldAction$:new h.X(E.generateFieldAction(t,N))})});return ae.properties=Ce,ae.showHideProjectionStrategy={getAction:function(K,Q){if(E.isShowHideActionInfoReady(Q)&&1===_.size(K))return ae.properties[K[0]].showHideFieldAction$.asObservable()}},ae.hasHiddenFieldsInVisual=b,ae}),oe=function(y){var b=m[y];b.crossBucketDragDropMonitor={groupId:U.uid,componentId:b.bucketUid},b.fieldFlyoutFieldsStrategy=U.getFieldFlyoutFieldsStrategy(b,y,t),U.featureSwitchService.featureSwitches.visualCalculationPencilIcon?b.directEditStrategy={onEdit:function(q){return(0,u.__awaiter)(E,void 0,void 0,function(){var L,le;return(0,u.__generator)(this,function(ae){switch(ae.label){case 0:return null==(L=b.properties[q[0]])?[2]:(le=(0,fe.$Z)(t,L.role,L.startIndex),[4,this.enterVisualCalcMode(t,le)]);case 1:return ae.sent(),[2]}})})},isDisabled:function(q){if(!E.visualCalcEagerService.isVisualCalcAuthoringEnabled()||E.explorationCapabilitiesService.getCapabilities().disableVisualCalcAuthoring)return!0;var L=b.properties[q[0]];if(null==L)return!0;S.fF.assert(function(){return(0,ve.jX)(L.expr)},"Expect only native visual calc fields to be editable");var le=L.expr,ae=_.find((0,fe.oJ)(t),function(Ce){return Ce.nativeReferenceName===le.name});return null==ae||E.visualCalcEagerService.shouldDisableEditing(ae.name,t)},getActionTooltip:function(){return E.visualCalcEagerService.isVisualCalcAuthoringEnabled()?E.explorationCapabilitiesService.getCapabilities().disableVisualCalcAuthoring?E.localizationService.get("FieldWell_EditVisualCalculation_Disabled_From_Explore"):E.localizationService.get("Calculation_Options_Pencil"):E.localizationService.get("Calculation_Options_NoFS")},shouldAllowDirectEdit:function(q){var L,le=null===(L=b.properties[q[0]])||void 0===L?void 0:L.expr;return null!=le&&(0,ve.jX)(le)}}:b.visualCalcFlyoutFieldsStrategy={onEditVisualCalc:function(q){return(0,u.__awaiter)(E,void 0,void 0,function(){return(0,u.__generator)(this,function(L){switch(L.label){case 0:return[4,this.enterVisualCalcMode(t,q)];case 1:return L.sent(),[2]}})})},getQueryName:function(q){var L=b.properties[q[0]];if(null!=L)return(0,fe.$Z)(t,L.role,L.startIndex)},isEditableVisualCalc:function(q){return!(!E.visualCalcEagerService.isVisualCalcAuthoringEnabled()||null==q)&&(0,ve.jX)(q)}}},U=this,te=0;te<m.length;te++)oe(te);return this.fieldBucketsInternal$.next(m),[2]}})})},n.prototype.enterVisualCalcMode=function(t,i){return(0,u.__awaiter)(this,void 0,void 0,function(){var o;return(0,u.__generator)(this,function(l){switch(l.label){case 0:return o=(0,me.hF)(this.contextActivityService,{name:"VisualAction",visualName:this.visualContainer.name,data:(0,u.__assign)((0,u.__assign)({},this.visualActionContext),{action:"EditVisualCalculation"})}),[4,this.visualCalcEagerService.enterVisualCalcMode(t,i,o)];case 1:return l.sent(),[2]}})})},n.prototype.getFieldFlyoutFieldsStrategy=function(t,i,o){var l=this;return{getFieldsToSelectOnOpen:function(d,p){return l.getInitialFlyoutFieldsToSelect(t,d,p)},getFieldsToDisableOnOpen:function(d,p,g,P){return l.getInitialFlyoutFieldsToDisable(t,d,P)},handleSelectedField:function(d,p){return(0,u.__awaiter)(l,void 0,void 0,function(){return(0,u.__generator)(this,function(g){switch(g.label){case 0:return[4,this.handleSelectedField(t,d,p)];case 1:return g.sent(),[2]}})})},handleDeselectedField:function(d){return l.handleDeselectedField(l.fieldBucketsInternal$.value[i],d)},onCloseWithCreateVisualCalc:function(d){return(0,u.__awaiter)(l,void 0,void 0,function(){return(0,u.__generator)(this,function(p){switch(p.label){case 0:return[4,this.onCloseFlyoutWithCreateVisualCalc(o,d)];case 1:return p.sent(),[2]}})})},getVisualCalcCreationInfo:function(d){return(0,u.__awaiter)(l,void 0,void 0,function(){return(0,u.__generator)(this,function(p){switch(p.label){case 0:return[4,this.getVisualCalcCreationInfo(o,d)];case 1:return[2,p.sent()]}})})},canOpenFlyout:function(d){var p;if(null==d)return!1;if(!l.featureSwitchService.featureSwitches.visualCalculationPencilIcon)return!0;var g=null===(p=t.properties[d[0]])||void 0===p?void 0:p.expr;return null==g||!(0,ve.jX)(g)}}},n.prototype.generateFieldAction=function(t,i){var o=this;if(16===t.visibility){var l=i.expr;if(null!=l&&((0,Ft.k)(l)||(0,ve.jX)(l))){var s=i.isHiddenInVisual,c=i.role,d=i.startIndex;return{tooltip:s?this.showFieldTooltip:this.hideFieldTooltip,svgIconName:s?"eye_off_16_regular":"eye_16_regular",svgIconSpriteName:"fluentui-icons",handler:function(){o.visualAuthoring.toggleFieldHidden(c,d,t,o.dataSourcesService.get())}}}}},n.prototype.getCustomTooltipContent=function(t,i,o){if(this.isNameInfoReadyAtUpdate(o)){var s=_.size(i);S.fF.assert(function(){return 1===s||2===s},"fields in build-field-well has either 1 or 2 levels");var c=_.nth(t.properties,i[0]);return 1===s?{title:c.displayOptions.tooltipTitle,description:c.displayOptions.tooltipDescription}:{title:c.hierarchyLevels[i[1]].tooltipTitle}}},n.prototype.getFieldDisplayName=function(t,i,o){if(this.isNameInfoReadyAtUpdate(o)){var s=_.size(i);S.fF.assert(function(){return 1===s||2===s},"fields in build-field-well has either 1 or 2 levels");var c=_.nth(t.properties,i[0]);return 1===s?c.displayOptions.displayName:c.hierarchyLevels[i[1]].displayName}},n.prototype.getFieldDisplayNameStyle=function(t,i,o){var l={};if(!this.isNameInfoReadyAtUpdate(o))return l;var c=_.size(i);S.fF.assert(function(){return 1===c||2===c},"fields in build-field-well has either 1 or 2 levels");var d=_.nth(t.properties,i[0]);return null!=d?.displayOptions.pbiStyle?d.displayOptions.pbiStyle:l},n.prototype.getIsFieldInvalid=function(t,i,o){if(this.isNameInfoReadyAtUpdate(o)){var s=_.size(i);S.fF.assert(function(){return 1===s||2===s},"fields in build-field-well has either 1 or 2 levels");var c=_.nth(t.properties,i[0]);return 1===s&&!c.valid}},n.prototype.isNameInfoReadyAtUpdate=function(t){var i=t.type;switch(i){case"delete":case"add":case"reorder":case"replace":return!1;case"rename":S.fF.assertFail("Expect this NOT to be called for update type Rename");case"initialize":return!0;default:return void S.fF.assertNever(i)}},n.prototype.isShowHideActionInfoReady=function(t){var i=t.type;switch(i){case"add":case"replace":case"delete":return!1;case"initialize":case"rename":case"reorder":return!0;default:return void S.fF.assertNever(i)}},n.prototype.getMenu=function(t,i,o,l){var s,c,d=l.type;switch(d){case"delete":S.fF.assertFail("Expect this NOT to be called for update type Delete");case"add":case"rename":case"reorder":case"replace":c=!1;break;case"initialize":c=!0;break;default:S.fF.assertNever(d)}if(c){var p=_.size(o);if(S.fF.assert(function(){return 1===p||2===p},"fields in build-field-well has either 1 or 2 levels"),1===p){var g=_.nth(t.properties,o[0]);if(!g||!(0,Ie.fS)(g.expr,i))return void S.fF.assertFail("expression (after drop) of property at index "+o[0]+" does not match expected");var P=null===(s=g.interactivityOptions)||void 0===s?void 0:s.dropDownItems;return _.isEmpty(P)?void 0:(0,St.m)(P)}}},n.prototype.getIsRenameAllowed=function(t,i,o){var l,s,c=o.type;switch(c){case"delete":S.fF.assertFail("Expect this NOT to be called for update type Delete");case"add":case"reorder":case"replace":s=!1;break;case"rename":S.fF.assertFail("Expect this NOT to be called for update type Rename");case"initialize":s=!0;break;default:S.fF.assertNever(c)}if(s){var d=_.size(i);if(S.fF.assert(function(){return 1===d||2===d},"fields in build-field-well has either 1 or 2 levels"),1===d)return null===(l=_.nth(t.properties,i[0]).interactivityOptions)||void 0===l?void 0:l.isEditableField}},n.prototype.getChildExprs=function(t,i,o,l){var s,c=l.type;switch(c){case"delete":S.fF.assertFail("Expect this NOT to be called for update type Delete");case"add":case"reorder":case"replace":s=!1;break;case"rename":S.fF.assertFail("Expect this NOT to be called for update type Rename");case"initialize":s=!0;break;default:S.fF.assertNever(c)}if(s&&1===_.size(i)){var d=tt(t,i[0],o);return _.map(d,function(p){return{expr:p}})}},n.prototype.getInitialFlyoutFieldsToSelect=function(t,i,o){if(S.fF.assert(function(){return!!o==!!i},"flyoutOpenFromPosition and flyoutOpenFromField should be both undefined or defined"),o){S.fF.assert(function(){return _.size(i)<=2},"build-field-well have maximum 2 levels of fiels");var l=_.nth(t.properties,i[0]),s=l.expr;if(S.fF&&2===_.size(i))if((0,ve.ez)(o)){var c=(0,ve.t3)(s)&&(0,Ie.fS)((0,Xe.ZB)(o),s),d=(0,ve.y3)(s)&&(0,Ie.fS)(s,o.arg);S.fF.assert(function(){return c||d},"in build-field-well, a hierarchy-level field's parent should be its variation source or owning hierarchy")}else S.fF.assertFail("second level fields of build-field-well should be hierarchy levels");return _.isEmpty(l.hierarchyLevels)?[s]:[l.hierarchyLevels[0].expr.arg]}},n.prototype.getInitialFlyoutFieldsToDisable=function(t,i,o){if(i)return S.fF.assert(function(){return _.size(i)<=2},"build-field-well have maximum 2 levels of fiels"),tt(t,i[0],o)},n.prototype.handleDeselectedField=function(t,i){var o=(0,ke.f)(i,t.properties);_.isEmpty(o)||this.handleDelete(t,{type:"delete",deleted:{position:o,expr:i}})},n.prototype.handleSelectedField=function(t,i,o){return(0,u.__awaiter)(this,void 0,void 0,function(){return(0,u.__generator)(this,function(l){switch(l.label){case 0:return o?(S.fF.assert(function(){return _.size(o)<=2},"field-picker-modern right now only supports maximum 2-levels of fields."),S.fF.assert(function(){return 1===_.size(o)||!!_.nth(t.properties[o[0]].hierarchyLevels,o[1])},"build-field-well flyout opened from second-level field should correspond to a hierarchy level"),[4,t.properties[o[0]].core.dropField(i,1)]):[3,2];case 1:return l.sent(),[3,3];case 2:t.core.dropField(i),l.label=3;case 3:return[2]}})})},n.prototype.onCloseFlyoutWithCreateVisualCalc=function(t,i){var o,l;return(0,u.__awaiter)(this,void 0,void 0,function(){var s,c,d,g;return(0,u.__generator)(this,function(P){switch(P.label){case 0:s=(0,me.hF)(this.contextActivityService,{name:"VisualAction",visualName:this.visualContainer.name,data:(0,u.__assign)((0,u.__assign)({},this.visualActionContext),{action:"CreateVisualCalculation"})}),P.label=1;case 1:return P.trys.push([1,5,,6]),null!=this.visualCalcService?[3,3]:(c=this,[4,this.lazyScoped.get(Ke.w)]);case 2:c.visualCalcService=P.sent(),P.label=3;case 3:return d=null===(l=null===(o=t?.config)||void 0===o?void 0:o.singleVisual)||void 0===l?void 0:l.autoSelectVisualType,[4,this.visualCalcService.enterVisualCalcMode(t,void 0,d?void 0:i,s)];case 4:return P.sent(),s.resolve(),[3,6];case 5:throw g=P.sent(),s.reject(g),g;case 6:return[2]}})})},n.prototype.getVisualCalcCreationInfo=function(t,i){return(0,u.__awaiter)(this,void 0,void 0,function(){var o;return(0,u.__generator)(this,function(l){switch(l.label){case 0:return null!=this.visualCalcService?[3,2]:(o=this,[4,this.lazyScoped.get(Ke.w)]);case 1:o.visualCalcService=l.sent(),l.label=2;case 2:return[4,this.visualCalcService.getVisualCalcCreationInfo(t,this.visualCapabilities,i)];case 3:return[2,l.sent()]}})})},n.prototype.handleAdd=function(t,i,o){return(0,u.__awaiter)(this,void 0,void 0,function(){var l,c,d;return(0,u.__generator)(this,function(oe){return l=_.isArray(o)?o:o?[o]:[],1===_.size(l)?[2,t.core.dropField(l[0].expr)]:(c=i.added.position,S.fF.assert(function(){return"end"===c||1===_.size(c)},"build-field-well only allows add into first-level fields."),(d="end"===c?_.size(l)-1:c[0])===_.size(l)-1?[2,t.core.dropField(_.last(l).expr)]:[2,t.properties[d].core.dropWithPayloadAndAction({field:i.added.pickerOriginalExpr},2)])})})},n.prototype.handleDelete=function(t,i){return(0,u.__awaiter)(this,void 0,void 0,function(){var o,l,s,c;return(0,u.__generator)(this,function(d){switch(d.label){case 0:return o=i.deleted.position,S.fF.assert(function(){return 1===_.size(o)||2===_.size(o)},"build-field-well supports maximum 2-levels of fields"),l=_.first(o),S.fF.assert(function(){return _.inRange(l,0,_.size(t.properties))},"first level fieldindex to delete is not in valid range"),s=t.properties[l],c=_.nth(o,1),S.fF.assert(function(){return null==c||_.inRange(c,0,_.size(s.hierarchyLevels))},"child index to delete is not in valid range"),[4,s.core.deleteField(c)];case 1:return d.sent(),[2]}})})},n.prototype.handleReorder=function(t,i,o){return(0,u.__awaiter)(this,void 0,void 0,function(){var l,s,c,d,p,g,P;return(0,u.__generator)(this,function(m){return l=i.reordered.fromPosition,s=i.reordered.toPosition,S.fF.assert(function(){return 1===_.size(l)&&1===_.size(s)},"build-field-well supports reordering of first-level items only. Add your implementation for new scenario."),c=l[0],S.fF.assert(function(){return _.inRange(c,0,_.size(t.properties))},"reorder.fromIndex is not in valid range"),d={sourceRole:t.role,sourceIndex:t.properties[c].startIndex,hierarchyLevelCount:_.size(t.properties[c].hierarchyLevels)},P=s[0],S.fF.assert(function(){return _.inRange(P,0,_.size(t.properties)+1)},"reorder.toIndex is not in valid range"),P===_.size(o)?(p=_.last(t.properties).core,g=3):(p=t.properties[P].core,g=2),[2,p.dropWithPayloadAndAction(d,g)]})})},n.prototype.handleReplace=function(t,i,o){return(0,u.__awaiter)(this,void 0,void 0,function(){var l,s,c;return(0,u.__generator)(this,function(d){return l=i.replaced.position,S.fF.assert(function(){return 1===_.size(l)},"build-field-well only allows replace first-level fields from underlying pbi-drag-drop-picker"),s=l[0],S.fF.assert(function(){return _.inRange(s,0,_.size(t.properties))},"index to replace is not in valid range"),S.fF.assert(t.supportsMultipleItems?function(){return _.isArray(o)&&_.size(t.properties)===_.size(o)}:function(){return!_.isArray(o)&&1===_.size(t.properties)},"properties and newExprsAfterUpdate size mismatch"),c=_.isArray(o)?o[s]:o,[2,t.properties[s].core.dropField(c.expr,1)]})})},n.prototype.handleRename=function(t,i){var o=i.renamed.position;S.fF.assert(function(){return 1===_.size(o)},"build-field-well only allows rename of first-level fields");var l=i.renamed.newName,s=t.properties[o[0]];S.fF.assertValue(s,"Invalid fieldIndex"),s.core.rename(l)},n.prototype.getFieldWellFieldCore=function(t,i,o){var l=this,s=this.fieldWellFieldService.createFieldWellFieldCore(void 0,function(c){return l.onLabelInEditingModeChanged(t,i,c)});return s.viewModel=o,s},n.prototype.onLabelInEditingModeChanged=function(t,i,o){t.enterExitFieldRename$.next({fieldPosition:[i],modeOn:!!o})},n.prototype.getFieldWellBucketCore=function(t){var i=this.fieldWellBucketService.createFieldWellBucketCore();return i.viewModel=t,i},n.\u0275fac=function(i){return new(i||n)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Ye.i),e.\u0275\u0275directiveInject(Be.r),e.\u0275\u0275directiveInject(Ve.D),e.\u0275\u0275directiveInject(ze.J),e.\u0275\u0275directiveInject(It.O),e.\u0275\u0275directiveInject(Pt.vZ),e.\u0275\u0275directiveInject(wt.AA),e.\u0275\u0275directiveInject(Pe.H),e.\u0275\u0275directiveInject(we.o),e.\u0275\u0275directiveInject(Ze.s),e.\u0275\u0275directiveInject(Et.P),e.\u0275\u0275directiveInject(qe.w),e.\u0275\u0275directiveInject(Je.$8),e.\u0275\u0275directiveInject(Ot.w),e.\u0275\u0275directiveInject(Tt.D),e.\u0275\u0275directiveInject(xt.U),e.\u0275\u0275directiveInject(me.yk))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["build-field-well"]],inputs:{visualContainer:"visualContainer",perspectiveDisplayName:"perspectiveDisplayName",allowReorderFields:"allowReorderFields",overrideSingleBucketForAutoVisual:"overrideSingleBucketForAutoVisual"},outputs:{contentUpdate:"contentUpdate"},features:[e.\u0275\u0275ProvidersFeature([kt.Wg]),e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:3,consts:[[1,"buildFieldWell"],[4,"ngFor","ngForOf"],[1,"bucketHeader"],["id","bucketTitle",1,"bucketTitle"],["iconSprite","fluentui-icons","mouseInIcon","info_20_filled","mouseOutIcon","info_20_regular",3,"tooltip",4,"ngIf"],["tooltipPosition","before",3,"ariaLabelledby","disabled","initialExpr","withFieldList","allowMultipleValues","allowReorderItems","promotedActionStrategy","getDropExprStrategy","menuStrategy","displayNameStrategy","flyoutFieldsStrategy","visualCalcFieldsStrategy","directEditStrategy","enterExitFieldRename","externalCrossPickerDragDropMonitor","perspectiveDisplayName","tooltipWithFlexiblePositions","parameterPickerDataFormat","visualCapabilities","addDataAriaLabelKey","emptyFieldSetsDefaultLabel","role","onExprChange","onCrossPickerDrop"],["iconSprite","fluentui-icons","mouseInIcon","info_20_filled","mouseOutIcon","info_20_regular",3,"tooltip"]],template:function(i,o){1&i&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Lt,7,26,"ng-container",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(2,1,o.fieldBuckets$)))},dependencies:[f.NgForOf,f.NgIf,Dt.m,C,f.AsyncPipe],styles:['.buildFieldWell[_ngcontent-%COMP%]   .bucketHeader[_ngcontent-%COMP%]{display:flex;box-sizing:border-box;flex-direction:row}.buildFieldWell[_ngcontent-%COMP%]   .bucketTitle[_ngcontent-%COMP%]{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--sm-font-size, 12px);font-weight:var(--font-weight-regular, 400);margin:8px 0 4px}.buildFieldWell[_ngcontent-%COMP%]     .drap-drop-picker{background:white}'],changeDetection:0}),n}(xe.w);function tt(r,n,t){var i=_.nth(r.properties,n);if(!_.isEmpty(i.hierarchyLevels)){var o=_.map(i.hierarchyLevels,function(s){return s.expr});if(S.fF){var l=(0,Xe.wA)(t,i.expr);if(!_.isArray(l)||_.isEmpty(l))return void S.fF.assertFail("Corresponding bucket property has hierarchyLevels, the expanded expr should have hierarchy level children as well");_.some(o,function(s){return!_.find(l,function(c){return(0,Ie.fS)(c,s)})})&&S.fF.assertFail("Cannot find the corresponding bucket property hierarchyLevel in hierarchy levels expanded from the dropped expr")}return o}}var ee=a(14172),Bt=a(59051),Vt=a(96441),Oe=a(86286),ye=a(49977),zt=a(90331),_e=function(r){function n(t,i){var l,o=this;(o=r.call(this,t,i)||this).overlayRef=i,o.config.providers.set(n,o),o.horizontalSide=t.horizontalSide,o.verticalLayout=t.verticalLayout,o.horizontalLayout=t.horizontalLayout,o.flyoutWidthSubject$=new h.X(null!==(l=o.config.options.width)&&void 0!==l?l:ye.Lc.childOverlayWidth),o.flyoutWidth$=o.flyoutWidthSubject$.asObservable(),o.flyoutWidth$.pipe((0,j.R)(o.onClose)).subscribe(function(p){requestAnimationFrame(function(){o.overlayRef.updateSize({width:p})})});var c,d,s=o.config.options.positionStrategy;return(c=s instanceof zt.M?s.positionStrategy:s)instanceof Bt._G?d=c.positionChanges.pipe((0,ee.U)(function(p){return p.connectionPair.originX})):c instanceof Vt.A&&(d=c.onPositionChange$().pipe((0,ee.U)(function(p){return p.originX}))),d&&d.pipe((0,j.R)(o.onClose)).subscribe(function(p){p&&("start"===p&&(o.horizontalSide="left"),"end"===p&&(o.horizontalSide="right"))}),o}return(0,u.__extends)(n,r),n.prototype.updateWidth=function(t){this.flyoutWidthSubject$.next(t)},n}(Oe.w),it=function(){function r(){this.pauseScrollCalls=0}return r.prototype.setScrollContainerElementRef=function(n){this.scrollContainerElementRef!==n&&(this.pauseScrollCalls=0),this.scrollContainerElementRef=n},r.prototype.onContentScroll=function(){var n=this.scrollContainerElementRef.nativeElement;this.pauseScrollCalls>0&&n.scrollTop!==this.restoreScrollTop&&(n.scrollTop=this.restoreScrollTop)},r.prototype.onContentUpdate=function(n){var t;if(!n.forVisualContainerChange)if("start"===n.type){if(this.pauseScrollCalls++,1===this.pauseScrollCalls){var i=null===(t=this.scrollContainerElementRef)||void 0===t?void 0:t.nativeElement;if(S.fF.assertValue(i,"skittle content update starts when it is not for a new visual container, scrollContainerElement should exist"),!i)return;this.restoreScrollTop=i.scrollTop}}else this.pauseScrollCalls--},r}(),Rt=a(49162),At={autoVisualWithPerspectives:!1,showClearChanges:!1,dimensions:{}},be=function(r){function n(){return r.call(this,At)||this}return(0,u.__extends)(n,r),n.prototype.getAutoVisualWithPerspectives=function(){return this.settings.autoVisualWithPerspectives},n.prototype.setAutoVisualWithPerspectives=function(t){this.setValue("autoVisualWithPerspectives",t)},n.prototype.getShowClearChanges=function(){return this.settings.showClearChanges},n.prototype.setShowClearChanges=function(t){this.setValue("showClearChanges",t)},n.prototype.getDimensions=function(t){return void 0===t&&(t=0),this.settings.dimensions[t]},n.prototype.setDimensions=function(t,i){var o,l=this.getDimensions(t),s=i;l&&(s=(0,u.__assign)((0,u.__assign)({},l),i)),this.setValue("dimensions",(0,u.__assign)((0,u.__assign)({},this.settings.dimensions),((o={})[t]=s,o)))},n.\u0275prov=e.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac=function(i){return new(i||n)}}),n}(Rt.g),nt=a(80649),Fe=a(77526),Te=a(17653),Re=a(48787),Wt=a(87644),ot=a(75096),$t=a(7779),jt=a(59725),rt=a(15580),Ut=a(3579),Nt=a(39503),Ht=a(93215),Kt=a(18460),De=a(59968),Qt=a(65005);function Xt(r,n){if(1&r&&e.\u0275\u0275element(0,"pbi-lazy-load",6),2&r){var t=e.\u0275\u0275nextContext();e.\u0275\u0275property("modulePath",t.exploreUIAuthoringModulePath)("componentId","AutoVisualComponentId")("inputArgs",t.autoVisualInputArgs)}}var lt=function(n,t){return{"pbi-glyph-chevrondownmedium":n,"pbi-glyph-chevronupmedium":t}};function Gt(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.fieldListSectionExpanded=!l.fieldListSectionExpanded)}),e.\u0275\u0275element(1,"span",8)(2,"i",9),e.\u0275\u0275elementEnd()}if(2&r){var i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(1,lt,!i.fieldListSectionExpanded,i.fieldListSectionExpanded))}}function Yt(r,n){if(1&r&&(e.\u0275\u0275elementStart(0,"div",10),e.\u0275\u0275element(1,"pbi-field-list",11),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()),2&r){var t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("fieldListTree",e.\u0275\u0275pipeBind1(2,5,t.fieldListTree$))("checkMode",t.fieldListCheckMode)("hasHighlights",!1)("loading",!e.\u0275\u0275pipeBind1(3,7,t.fieldListTree$))("options",t.fieldListOptions)}}function Jt(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.toggleFieldWellSectionExpansion())}),e.\u0275\u0275element(1,"span",12)(2,"i",9),e.\u0275\u0275elementEnd()}if(2&r){var i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(1,lt,!i.fieldWellSectionExpanded,i.fieldWellSectionExpanded))}}var Zt=function(n){return{"with-field-list":n}};function qt(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"build-field-well",13),e.\u0275\u0275listener("contentUpdate",function(l){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onContentUpdate(l))}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementEnd()}if(2&r){var i=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(7,Zt,i.withFieldList))("visualContainer",i.visualContainer)("perspectiveDisplayName",i.perspectiveDisplayName)("allowReorderFields",i.overrideSingleBucketForAutoVisual||e.\u0275\u0275pipeBind1(1,5,i.allowReorderFields$))("overrideSingleBucketForAutoVisual",i.overrideSingleBucketForAutoVisual)}}var ei=function(){return{ignoreOverlay:!1,ignoreMobile:!1}},Me=function(r){function n(t,i,o,l,s,c,d,p,g,P,W){var m=r.call(this)||this;m.changeDetectorRef=t,m.conceptualSchemaProxy=i,m.contextActivityService=o,m.dataSources=l,m.eventBridge=s,m.explorationNavigation=c,m.fieldListTreeService=d,m.lazyScoped=p,m.localizationService=g,m.modelService=P,m.skittleSettingsService=W,m.contentUpdate=new e.EventEmitter,m.fieldListCheckMode=jt.kH.Multi,m.isAutoVisualInternal$=new h.X(void 0),m.isSessionDirtyInternal$=new h.X(!1);var oe=m.localizationService.get("Suggestions"),U=m.localizationService.get("Skittles_Build_SuggestLabel"),te=m.localizationService.get("Skittles_Build_SuggestTooltip");return m.isSessionDirty$=m.isSessionDirtyInternal$.pipe((0,Fe.x)(),(0,j.R)(m.onDestroy$)),m.allowReorderFields$=m.isAutoVisualInternal$.pipe((0,ee.U)(function(E){return!E}),(0,Fe.x)(),(0,j.R)(m.onDestroy$)),m.changes$("visualContainer").pipe((0,j.R)(m.onDestroy$)).subscribe(function(E){E&&(m.originalVisualConfig={singleVisual:(0,rt.d9)(E.config.singleVisual)},m.isAutoVisualInternal$.next((0,fe.II)(E)))}),(0,T.aj)([m.changes$("visualContainer"),m.changes$("host"),m.changes$("setFocusAfterInitialization",!0)]).pipe((0,j.R)(m.onDestroy$)).subscribe(function(E){var R=E[1],y=E[2],b="Pane"===R;m.autoVisualInputArgs={label:oe,autoModeToggleLabel:U,tooltip:te,visualContainer:E[0],withPerspectives:m.skittleSettingsService.getAutoVisualWithPerspectives(),setFocusAfterInitialization:y,host:R,allowSelectVisualTypeWhenNoVisual:!0,noAutoToggleSwitch:b,noSuggestions:b,alwaysExpanded:b}}),m.lazyScoped.get(Wt.ub).then(function(E){E.startFormattingTutorial("FieldPickerTutorial")}),m}return(0,u.__extends)(n,r),n.prototype.onContentUpdate=function(t){this.contentUpdate.emit(t)},n.prototype.ngOnInit=function(){var t=this;this.withFieldList=null!=this.fieldListOptions&&null!=this.fieldListTreeOptions,this.fieldListSectionExpanded=this.withFieldList,this.fieldWellSectionExpanded=this.expandFieldWellOnInit||!this.withFieldList,null!=this.refreshFieldList$&&this.refreshFieldList$.pipe((0,Fe.x)()).pipe((0,j.R)(this.onDestroy$)).subscribe(function(){return t.fieldListTreeService.refresh()}),this.withFieldList&&this.modelService.update([]).then(function(){t.modelService.modelChange$.pipe((0,j.R)(t.onDestroy$)).subscribe(function(i){if(null!=i?.model){var o=1===_.size(i.model.tables);t.fieldListTreeService.modelToPbiTreeConverterOptions=t.fieldListTreeOptions,t.fieldListTreeService.modelToPbiTreeConverterOptions.expandedSetting=new ti(o),t.fieldListTreeService.setOrUpdateFieldListTreeModel(i.model),t.fieldListTree$=t.fieldListTreeService.fieldListTree$}})}),this.skittleSettingsService.getAutoVisualWithPerspectives()&&(this.perspectiveDisplayName=this.getPerspectiveDisplayName()),(0,$.T)(this.eventBridge.on(se.tRg),this.eventBridge.on(se.KD7),this.eventBridge.on(se.jCS),this.eventBridge.on(se.D1A),this.eventBridge.on(se.Udu)).pipe((0,Te.b)(function(){return t.checkDirtyState()}),(0,j.R)(this.onDestroy$)).subscribe(function(){t.isAutoVisualInternal$.next((0,fe.II)(t.visualContainer)),null!=t.fieldListOptions&&t.updateFieldListSelectionState()}),this.expandFieldWellSectionOnInitialChange&&this.eventBridge.on(se.jCS).pipe((0,Re.q)(1)).subscribe(function(){var i;!0!==t.fieldWellSectionExpanded&&(t.fieldWellSectionExpanded=!0,t.changeDetectorRef.detectChanges(),document.activeElement.scrollIntoView(!0),t.autoExpandFieldWellSectionActivity=t.contextActivityService.createActivity({name:"Automatically expand field well section",visualName:null===(i=t.visualContainer)||void 0===i?void 0:i.name,data:{closed:null,source:"Skittle",skittleType:"Build"}}))})},n.prototype.ngOnDestroy=function(){var t;!(null===(t=this.autoExpandFieldWellSectionActivity)||void 0===t)&&t.isRunning()&&this.resolveAutoExpandFieldWellSectionActivity("automatically"),r.prototype.ngOnDestroy.call(this)},Object.defineProperty(n.prototype,"exploreUIAuthoringModulePath",{get:function(){return"@powerbi/ExploreUIAuthoring/lazy-modules/explore-ui-authoring/explore-ui-authoring.module#ExploreUIAuthoringModule"},enumerable:!1,configurable:!0}),n.prototype.toggleFieldWellSectionExpansion=function(){var t;!(null===(t=this.autoExpandFieldWellSectionActivity)||void 0===t)&&t.isRunning()&&this.resolveAutoExpandFieldWellSectionActivity("manually"),this.fieldWellSectionExpanded=!this.fieldWellSectionExpanded},n.prototype.discardChanges=function(){var t=this;this.visualContainer.config.singleVisual=(0,rt.d9)(this.originalVisualConfig.singleVisual),this.eventBridge.publishToChannel(se.jCS,{affectContainer:function(o){return o.name===t.visualContainer.name}})},n.prototype.resolveAutoExpandFieldWellSectionActivity=function(t){this.autoExpandFieldWellSectionActivity.updateProperty("data",function(i){return(0,u.__assign)((0,u.__assign)({},i),{closed:t})}),this.autoExpandFieldWellSectionActivity.resolve()},n.prototype.getPerspectiveDisplayName=function(){var t,i,o,l=this.explorationNavigation.getCurrentExploration(),s=l.sections[l.activeSectionIndex];return null===(o=null===(i=null===(t=s?.evaluatedObjects)||void 0===t?void 0:t.personalizeVisual)||void 0===i?void 0:i.perspectiveRef)||void 0===o?void 0:o.toString()},n.prototype.updateFieldListSelectionState=function(){return(0,u.__awaiter)(this,void 0,void 0,function(){var t,i,o,l;return(0,u.__generator)(this,function(s){switch(s.label){case 0:return[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return t=s.sent(),i=(0,fe.oJ)(this.visualContainer),o=this.modelService.model,l=_.flatMapDeep(i,function(c){return o.findItems(c.expr,t)}),this.fieldListTreeService.setOrUpdateFieldListTreeModel(o,void 0,l),[2]}})})},n.prototype.checkDirtyState=function(){var t,i,o,l,s=null===(i=null===(t=this.originalVisualConfig)||void 0===t?void 0:t.singleVisual)||void 0===i?void 0:i.query,c=null===(l=null===(o=this.originalVisualConfig)||void 0===o?void 0:o.singleVisual)||void 0===l?void 0:l.visualType,d=(0,fe.Xf)(this.visualContainer),p=(0,Ut.s)(this.visualContainer),g=null==s,P=null==d;if(g&&P)this.isSessionDirtyInternal$.next(!1);else{var W=c!==p||g!==P||!s.equals(d);this.isSessionDirtyInternal$.next(W)}},n.\u0275fac=function(i){return new(i||n)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Ye.i),e.\u0275\u0275directiveInject(Be.r),e.\u0275\u0275directiveInject(Ve.D),e.\u0275\u0275directiveInject(ze.J),e.\u0275\u0275directiveInject(Nt.z),e.\u0275\u0275directiveInject(ot.p),e.\u0275\u0275directiveInject(Pe.H),e.\u0275\u0275directiveInject(we.o),e.\u0275\u0275directiveInject(Ht.b),e.\u0275\u0275directiveInject(be))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["build-skittle"]],inputs:{fieldListOptions:"fieldListOptions",fieldListTreeOptions:"fieldListTreeOptions",hideVisualPicker:"hideVisualPicker",expandFieldWellSectionOnInitialChange:"expandFieldWellSectionOnInitialChange",overrideSingleBucketForAutoVisual:"overrideSingleBucketForAutoVisual",setFocusAfterInitialization:"setFocusAfterInitialization",host:"host",refreshFieldList$:"refreshFieldList$",expandFieldWellOnInit:"expandFieldWellOnInit",visualContainer:"visualContainer"},outputs:{contentUpdate:"contentUpdate"},features:[e.\u0275\u0275ProvidersFeature((0,u.__spreadArray)([ot.p],$t.r,!0)),e.\u0275\u0275InheritDefinitionFeature],decls:7,vars:7,consts:[[1,"buildSkittle",3,"pbiScrollbar"],[1,"visualPicker","compact-visual-types"],[3,"modulePath","componentId","inputArgs",4,"ngIf"],["class","sectionHeader",3,"click",4,"ngIf"],["class","fieldListContainer",4,"ngIf"],[3,"ngClass","visualContainer","perspectiveDisplayName","allowReorderFields","overrideSingleBucketForAutoVisual","contentUpdate",4,"ngIf"],[3,"modulePath","componentId","inputArgs"],[1,"sectionHeader",3,"click"],["localize","Skittles_Build_FieldListSectionTitle"],[1,"glyphicon","glyph-small",3,"ngClass"],[1,"fieldListContainer"],[3,"fieldListTree","checkMode","hasHighlights","loading","options"],["localize","Skittles_Build_FieldWellSectionTitle"],[3,"ngClass","visualContainer","perspectiveDisplayName","allowReorderFields","overrideSingleBucketForAutoVisual","contentUpdate"]],template:function(i,o){1&i&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275template(2,Xt,1,3,"pbi-lazy-load",2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Gt,3,4,"div",3),e.\u0275\u0275template(4,Yt,4,9,"div",4),e.\u0275\u0275template(5,Jt,3,4,"div",3),e.\u0275\u0275template(6,qt,2,9,"build-field-well",5),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275property("pbiScrollbar",e.\u0275\u0275pureFunction0(6,ei)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!o.hideVisualPicker),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.withFieldList),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.withFieldList&&o.fieldListSectionExpanded),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.withFieldList),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.fieldWellSectionExpanded))},dependencies:[f.NgClass,f.NgIf,Kt.R,De.X,Qt.l,nt.r,et,f.AsyncPipe],styles:['.buildSkittle[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.buildSkittle[_ngcontent-%COMP%]   .sectionHeader[_ngcontent-%COMP%], .buildSkittle[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%], .buildSkittle[_ngcontent-%COMP%]   .fieldListContainer[_ngcontent-%COMP%], .buildSkittle[_ngcontent-%COMP%]   build-field-well[_ngcontent-%COMP%]{padding:0 8px}.buildSkittle[_ngcontent-%COMP%]   .fieldListContainer[_ngcontent-%COMP%]{flex:1;position:relative}.buildSkittle[_ngcontent-%COMP%]   build-field-well[_ngcontent-%COMP%]{flex:1}.buildSkittle[_ngcontent-%COMP%]   build-field-well.with-field-list[_ngcontent-%COMP%]{overflow:auto}.buildSkittle[_ngcontent-%COMP%]   .sectionHeader[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px;border-top:1px solid var(--globalColorGrey90)}.buildSkittle[_ngcontent-%COMP%]   .sectionHeader[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--md-font-size, 14px);font-weight:var(--font-weight-semi-bold, 600)}']}),n}(xe.w),ti=function(){function r(n){this.hasSingleTable=n}return r.prototype.isExpanded=function(n){return"Hierarchy"===n.modelObjectType||"Table"===n.modelObjectType&&this.hasSingleTable},r.prototype.isExpandedStateFixed=function(n){return"Hierarchy"===n.modelObjectType},r}(),ii=["buildSkittle"],ni=["scrollContainer"],oi=function(){return{ignoreOverlay:!1,ignoreMobile:!1}},at=function(){function r(n,t,i){this.skittleSettingsService=n,this.localizationService=t,this.flyoutRef=i,this.host="Skittle",this.contentScrollContainerHelper=new it,this.destroy$=new O.xQ,this.allowClearChanges=this.skittleSettingsService.getShowClearChanges(),this.visualContainer=i.visualContainer}return Object.defineProperty(r.prototype,"_scrollContainer",{set:function(t){this.contentScrollContainerHelper.setScrollContainerElementRef(t)},enumerable:!1,configurable:!0}),r.prototype.ngAfterViewInit=function(){var n=this;this.buildSkittleComponent.isSessionDirty$.pipe((0,j.R)(this.destroy$),(0,ee.U)(function(t){var i=[];return n.allowClearChanges&&i.push({icon:"eraser",iconSize:"small",tooltip:n.getDiscardChangesTooltipText(t),disabled:!t,click:function(){return n.discardChanges()}}),i})).subscribe(function(t){return n.flyoutRef.setHeaderButtons(t)})},r.prototype.onContentUpdate=function(n){this.contentScrollContainerHelper.onContentUpdate(n)},r.prototype.onContentScroll=function(){this.contentScrollContainerHelper.onContentScroll()},r.prototype.discardChanges=function(){this.buildSkittleComponent.discardChanges()},r.prototype.getDiscardChangesTooltipText=function(n){return this.localizationService.get(n?"PersonalizeVisual_DiscardChanges":"PersonalizeVisual_DiscardChanges_Disabled")},r.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(be),e.\u0275\u0275directiveInject(we.o),e.\u0275\u0275directiveInject(_e))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["build-skittle-flyout"]],viewQuery:function(t,i){if(1&t&&(e.\u0275\u0275viewQuery(ii,5),e.\u0275\u0275viewQuery(ni,5)),2&t){var o=void 0;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i.buildSkittleComponent=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i._scrollContainer=o.first)}},features:[e.\u0275\u0275ProvidersFeature([{provide:me.yk,useValue:{source:"Skittle",skittleType:"Build"}}])],decls:4,vars:4,consts:[[1,"scrollContainer",3,"pbiScrollbar","scroll"],["scrollContainer",""],[3,"host","visualContainer","contentUpdate"],["buildSkittle",""]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"div",0,1),e.\u0275\u0275listener("scroll",function(){return i.onContentScroll()}),e.\u0275\u0275elementStart(2,"build-skittle",2,3),e.\u0275\u0275listener("contentUpdate",function(l){return i.onContentUpdate(l)}),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275property("pbiScrollbar",e.\u0275\u0275pureFunction0(3,oi)),e.\u0275\u0275advance(2),e.\u0275\u0275property("host",i.host)("visualContainer",i.visualContainer))},dependencies:[nt.r,Me],encapsulation:2}),r}(),st=a(9215),Le=a(21024),Ae=a(72262),ri=a(66977),We=a(21023),$e=a(24548),ct=a(69437),ut=function(){function r(){}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["build-skittle-watermark"]],inputs:{watermarkText:"watermarkText"},decls:4,vars:1,consts:[[1,"watermark"],["name","PBIBuild_20",1,"watermarkIcon"],[1,"watermarkText"],[3,"localize"]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"pbi-office-icon",1),e.\u0275\u0275elementStart(2,"div",2),e.\u0275\u0275element(3,"span",3),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("localize",i.watermarkText))},dependencies:[De.X,ct.m],styles:[".watermark[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.watermarkIcon[_ngcontent-%COMP%]{width:32px;height:32px;padding-bottom:16px}.watermarkText[_ngcontent-%COMP%]{--watermark-text-color: var(--globalColorGrey14);padding-inline-start:24px;padding-inline-end:24px;text-align:center;color:var(--watermark-text-color)}  [data-legacy-theming=false] .watermarkText{--watermark-text-color: var(--colorNeutralForeground1)}"],changeDetection:0}),r}(),li=["allContentScrollContainer"];function ai(r,n){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",5),e.\u0275\u0275element(2,"build-skittle-watermark",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&r){var t=n.ngIf;e.\u0275\u0275advance(2),e.\u0275\u0275property("watermarkText",t)}}function si(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",7,8),e.\u0275\u0275listener("scroll",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(l.onContentScroll())}),e.\u0275\u0275elementStart(2,"build-skittle",9),e.\u0275\u0275listener("contentUpdate",function(l){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.onContentUpdate(l))}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()()}if(2&r){var i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("fieldListOptions",i.fieldListOptions)("fieldListTreeOptions",i.fieldListTreeOptions)("visualContainer",e.\u0275\u0275pipeBind1(3,10,i.visualContainer$))("hideVisualPicker",i.hideVisualPicker)("expandFieldWellSectionOnInitialChange",i.expandFieldWellSectionOnInitialChange)("overrideSingleBucketForAutoVisual",i.overrideSingleBucketForAutoVisual)("setFocusAfterInitialization",i.setFocusAfterInitialization)("refreshFieldList$",i.refreshFieldList$)("expandFieldWellOnInit",i.expandFieldWellOnInit)("host",i.host)}}function ci(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"pbi-pane",1),e.\u0275\u0275listener("onCollapse",function(){e.\u0275\u0275restoreView(t);var d=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(d.onPaneCollapsed())}),e.\u0275\u0275elementStart(1,"pbi-pane-section",2),e.\u0275\u0275template(2,ai,3,1,"ng-container",3),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,si,4,12,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()}if(2&r){var s,i=n.ngIf,o=e.\u0275\u0275reference(5),l=e.\u0275\u0275nextContext();e.\u0275\u0275property("expanded",i.isPaneExpanded)("title",i.title)("disableScroll",!0)("allowToggle",!1)("optionsSetting",i.optionsSetting)("showCollapse",null===(s=l.showCollapse)||void 0===s||s),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(3,8,l.watermarkText$))("ngIfElse",o)}}var dt=function(r){function n(t,i,o){var l=r.call(this)||this;l.panesVisibilityService=t,l.selectionService=i,l.visualPluginOps=o,l.paneViewModel$=l.panesVisibilityService.getPanes$().pipe((0,ee.U)(function(c){return c.build})),l.host="Pane",l.contentScrollContainerHelper=new it;var s=l.selectionService.selectedElements$.pipe((0,ee.U)(function(c){if(c)return c.reduce(function(d,p){var g=p.canvasItem;return g&&d.push(g),d},[])}));return l.visualContainer$=s.pipe((0,ee.U)(function(c){if(!_.isEmpty(c)){var d=(0,st.rQ)(c)[0];return 1===d.length?d[0]:void 0}})),l.watermarkText$=s.pipe((0,ee.U)(function(c){var d;if(!_.isEmpty(c)){var p=(d=(0,st.rQ)(c))[0];if(!_.isEmpty(d[1])||p.length>1)return"Build_Pane_Multiple_Visual";var P=p[0],W=l.visualPluginOps.canConvertVisual(P),m=l.visualPluginOps.isQueryVisual(P.config.singleVisual.visualType);if(!W&&!m)return"Build_Pane_NoData_Visual"}})),l}return(0,u.__extends)(n,r),Object.defineProperty(n.prototype,"_allContentScrollContainer",{set:function(i){this.contentScrollContainerHelper.setScrollContainerElementRef(i)},enumerable:!1,configurable:!0}),n.prototype.onPaneCollapsed=function(){this.panesVisibilityService.setPaneExpansion("build",!1)},n.prototype.onContentUpdate=function(t){this.contentScrollContainerHelper.onContentUpdate(t)},n.prototype.onContentScroll=function(){this.contentScrollContainerHelper.onContentScroll()},n.\u0275fac=function(i){return new(i||n)(e.\u0275\u0275directiveInject(Le.r),e.\u0275\u0275directiveInject(Ae.z),e.\u0275\u0275directiveInject(ri.f))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["build-skittle-pane"]],viewQuery:function(i,o){var l;(1&i&&e.\u0275\u0275viewQuery(li,5),2&i)&&(e.\u0275\u0275queryRefresh(l=e.\u0275\u0275loadQuery())&&(o._allContentScrollContainer=l.first))},inputs:{fieldListOptions:"fieldListOptions",fieldListTreeOptions:"fieldListTreeOptions",hideVisualPicker:"hideVisualPicker",expandFieldWellSectionOnInitialChange:"expandFieldWellSectionOnInitialChange",overrideSingleBucketForAutoVisual:"overrideSingleBucketForAutoVisual",setFocusAfterInitialization:"setFocusAfterInitialization",refreshFieldList$:"refreshFieldList$",expandFieldWellOnInit:"expandFieldWellOnInit",showCollapse:"showCollapse"},features:[e.\u0275\u0275ProvidersFeature([{provide:me.yk,useValue:{source:"Pane",paneType:"build"}}]),e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","buildSkittlePane",3,"expanded","title","disableScroll","allowToggle","optionsSetting","showCollapse","onCollapse",4,"ngIf"],[1,"buildSkittlePane",3,"expanded","title","disableScroll","allowToggle","optionsSetting","showCollapse","onCollapse"],[1,"no-padding"],[4,"ngIf","ngIfElse"],["skittles",""],[1,"watermarkContainer"],[3,"watermarkText"],[1,"paneContentScrollContainer",3,"scroll"],["allContentScrollContainer",""],[3,"fieldListOptions","fieldListTreeOptions","visualContainer","hideVisualPicker","expandFieldWellSectionOnInitialChange","overrideSingleBucketForAutoVisual","setFocusAfterInitialization","refreshFieldList$","expandFieldWellOnInit","host","contentUpdate"]],template:function(i,o){1&i&&(e.\u0275\u0275template(0,ci,6,10,"pbi-pane",0),e.\u0275\u0275pipe(1,"async")),2&i&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,o.paneViewModel$))},dependencies:[f.NgIf,We.VO,$e.i,Me,ut,f.AsyncPipe],styles:[".buildSkittlePane[_ngcontent-%COMP%]   pbi-pane-section[_ngcontent-%COMP%]{height:100%}.buildSkittlePane[_ngcontent-%COMP%]   pbi-pane-section[_ngcontent-%COMP%]   .paneContentScrollContainer[_ngcontent-%COMP%]{height:100%;overflow:auto}.buildSkittlePane[_ngcontent-%COMP%]   pbi-pane-section[_ngcontent-%COMP%]   .watermarkContainer[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}"]}),n}(xe.w),ui=a(90094),di=a(56011),je=a(85102),pi=["checkboxElement"];function fi(r,n){1&r&&e.\u0275\u0275element(0,"warning-eager",11),2&r&&e.\u0275\u0275property("warningMessage",n.ngIf)}function vi(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",7)(1,"pbi-checkbox",8,9),e.\u0275\u0275listener("onChange",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext().$implicit,c=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(c.updateFormatOption(s))}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,fi,1,1,"warning-eager",10),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementEnd()}if(2&r){var o,i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("checked",i.checked)("label",i.displayName)("isCompact",!0)("ariaDescription",i.warningMessage$?null==(o=e.\u0275\u0275pipeBind1(3,6,i.warningMessage$))?null:o.detail:void 0),e.\u0275\u0275attribute("id",i.uid),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(5,8,i.warningMessage$))}}function hi(r,n){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,vi,6,10,"div",6),e.\u0275\u0275elementContainerEnd()),2&r){var t=n.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.disabled)}}function gi(r,n){if(1&r&&(e.\u0275\u0275elementStart(0,"div",4),e.\u0275\u0275template(1,hi,2,1,"ng-container",5),e.\u0275\u0275elementEnd()),2&r){var t=n.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.items)}}function mi(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275template(1,gi,2,1,"div",2),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"button",3),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.openFormatPane())}),e.\u0275\u0275pipe(4,"localize"),e.\u0275\u0275elementEnd()()}if(2&r){var i=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,3,i.formatState$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("localize","Options_Menu")("pbiTooltip",e.\u0275\u0275pipeBind1(4,5,"Options_Menu"))}}var Ue=function(r){function n(t,i,o,l){var s=r.call(this)||this;return s.changeDetector=t,s.lazyScoped=i,s.panesVisibility=o,s.selectionService=l,s.isInitialized$=new h.X(!1),s}return(0,u.__extends)(n,r),Object.defineProperty(n.prototype,"_checkboxElementRefs",{set:function(i){var o,l;if(this.checkboxElements=[],i){var s=i.toArray();if(this.checkboxElements=s.map(function(g){return g.nativeElement}),!_.isEmpty(this.restoreFocusElementId))for(var c=0,d=s;c<d.length;c++){var p=d[c];if(p.nativeElement.id===this.restoreFocusElementId)return void(null===(l=null===(o=p.nativeElement.getElementsByTagName("INPUT"))||void 0===o?void 0:o[0])||void 0===l||l.focus())}}},enumerable:!1,configurable:!0}),n.prototype.ngOnInit=function(){var t=this,i=_.compact(this.selectionService.getSelectedElements().map(function(l){return l.canvasItem})),o=_.first(i);this.lazyScoped.get("formattingService").then(function(l){t.formattingService=l;var s=t.formattingService.getFor({type:0,canvasItem:o});t.formatState$=s.getChartElementsContract$().pipe((0,Te.b)(function(c){var d=document.activeElement;if("INPUT"===document.activeElement.tagName){var p=_.find(t.checkboxElements,function(g){return g.contains(d)});t.restoreFocusElementId=p?.id}})),t.changeDetector.detectChanges(),t.isInitialized$.next(!0)})},n.prototype.updateFormatOption=function(t){var i;t.checked=!t.checked;var o=null===(i=_.first(this.selectionService.getSelectedElements()))||void 0===i?void 0:i.canvasItem;this.formattingService.saveValues({changes:[{objectName:t.descriptor.objectName,uid:t.uid,hasDynamicExpressionSupport:!1,formattingSource:t.formattingSource,propertySlice:{name:t.descriptor.propertyName,selector:t.descriptor.selector,type:{bool:!0},value:t.checked},canvasItems:[o],visualUpdateSource:0}]},{source:"Skittle",skittleType:"ChartElements"}),this.changeDetector.detectChanges()},n.prototype.openFormatPane=function(){this.panesVisibility.isPaneVisible("format")&&!this.panesVisibility.isPaneExpanded("format")?this.panesVisibility.togglePaneExpansion("format"):this.panesVisibility.isPaneVisible("format")?this.panesVisibility.emphasizePane("format"):this.panesVisibility.togglePaneVisibility("format"),this.panesVisibility.setFocusedPane("format")},n.\u0275fac=function(i){return new(i||n)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Pe.H),e.\u0275\u0275directiveInject(Le.r),e.\u0275\u0275directiveInject(Ae.z))},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["chart-elements-skittle"]],viewQuery:function(i,o){var l;(1&i&&e.\u0275\u0275viewQuery(pi,5,e.ElementRef),2&i)&&(e.\u0275\u0275queryRefresh(l=e.\u0275\u0275loadQuery())&&(o._checkboxElementRefs=l))},features:[e.\u0275\u0275ProvidersFeature([{provide:me.yk,useValue:{source:"Skittle",skittleType:"ChartElements"}}]),e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","chartElementsSkittle",4,"ngIf"],[1,"chartElementsSkittle"],["class","options",4,"ngIf"],[1,"pbi-fluent-button","moreOptionsButton",3,"localize","pbiTooltip","click"],[1,"options"],[4,"ngFor","ngForOf"],["class","item-container",4,"ngIf"],[1,"item-container"],[3,"checked","label","isCompact","ariaDescription","onChange"],["checkboxElement",""],["class","warning",3,"warningMessage",4,"ngIf"],[1,"warning",3,"warningMessage"]],template:function(i,o){1&i&&(e.\u0275\u0275template(0,mi,5,7,"div",0),e.\u0275\u0275pipe(1,"async")),2&i&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,o.isInitialized$))},dependencies:[f.NgForOf,f.NgIf,De.X,ui.l,di.v,v.V,f.AsyncPipe,je.F],styles:['.chartElementsSkittle[_ngcontent-%COMP%]{padding:4px 8px 0}.chartElementsSkittle[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]{display:flex;flex-direction:column}.chartElementsSkittle[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]{align-items:center;display:flex;flex-direction:row;margin-bottom:6px}.chartElementsSkittle[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]   pbi-checkbox[_ngcontent-%COMP%]{width:fit-content;margin:2px 0}html:not([dir="rtl"])[_nghost-%COMP%]   .chartElementsSkittle[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .chartElementsSkittle[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{margin-left:auto}html[dir="rtl"][_nghost-%COMP%]   .chartElementsSkittle[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .chartElementsSkittle[_ngcontent-%COMP%]   .options[_ngcontent-%COMP%]   .item-container[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{margin-right:auto}.chartElementsSkittle[_ngcontent-%COMP%]   .moreOptionsButton[_ngcontent-%COMP%]{margin-top:6px;padding:6px 16px;border:1px solid var(--gray-110, #8A8886);max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}'],changeDetection:0}),n}(xe.w),pt=function(){function r(){}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["chart-elements-skittle-flyout"]],decls:1,vars:0,template:function(t,i){1&t&&e.\u0275\u0275element(0,"chart-elements-skittle")},dependencies:[Ue],encapsulation:2,changeDetection:0}),r}();function yi(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"pbi-pane",1),e.\u0275\u0275listener("onCollapse",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.onPaneCollapsed())}),e.\u0275\u0275elementStart(1,"pbi-pane-section"),e.\u0275\u0275element(2,"chart-elements-skittle"),e.\u0275\u0275elementEnd()()}if(2&r){var i=n.ngIf;e.\u0275\u0275property("expanded",i.isPaneExpanded)("title",i.title)("allowToggle",!1)("optionsSetting",i.optionsSetting)("showCollapse",!0)}}var ft=function(){function r(n){this.panesVisibilityService=n,this.paneViewModel$=this.panesVisibilityService.getPanes$().pipe((0,ee.U)(function(t){return t.chartElementsSkittle}))}return r.prototype.onPaneCollapsed=function(){this.panesVisibilityService.setPaneExpansion("chartElementsSkittle",!1)},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(Le.r))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["chart-elements-skittle-pane"]],decls:2,vars:3,consts:[[3,"expanded","title","allowToggle","optionsSetting","showCollapse","onCollapse",4,"ngIf"],[3,"expanded","title","allowToggle","optionsSetting","showCollapse","onCollapse"]],template:function(t,i){1&t&&(e.\u0275\u0275template(0,yi,3,5,"pbi-pane",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,i.paneViewModel$))},dependencies:[f.NgIf,We.VO,$e.i,Ue,f.AsyncPipe],encapsulation:2,changeDetection:0}),r}();function Ci(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"pbi-pane",1),e.\u0275\u0275listener("onCollapse",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onPaneCollapsed())}),e.\u0275\u0275elementStart(1,"pbi-pane-section",2),e.\u0275\u0275element(2,"build-skittle",3),e.\u0275\u0275elementEnd()()}if(2&r){var i=n.ngIf,o=e.\u0275\u0275nextContext();e.\u0275\u0275property("expanded",i.isPaneExpanded)("title",i.title)("allowToggle",!1)("optionsSetting",i.optionsSetting)("showCollapse",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("host",o.host)}}var vt=function(){function r(n){this.panesVisibilityService=n,this.host="Skittle",this.paneViewModel$=this.panesVisibilityService.getPanes$().pipe((0,ee.U)(function(t){return t.suggestSkittle}))}return r.prototype.onPaneCollapsed=function(){this.panesVisibilityService.setPaneExpansion("suggestSkittle",!1)},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(Le.r))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["suggest-skittle-pane"]],features:[e.\u0275\u0275ProvidersFeature([{provide:me.yk,useValue:{source:"Pane",paneType:"suggestSkittle"}}])],decls:2,vars:3,consts:[[3,"expanded","title","allowToggle","optionsSetting","showCollapse","onCollapse",4,"ngIf"],[3,"expanded","title","allowToggle","optionsSetting","showCollapse","onCollapse"],[1,"no-padding"],[3,"host"]],template:function(t,i){1&t&&(e.\u0275\u0275template(0,Ci,3,6,"pbi-pane",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,i.paneViewModel$))},dependencies:[f.NgIf,We.VO,$e.i,Me,f.AsyncPipe],encapsulation:2,changeDetection:0}),r}(),Se=a(25512),ht=a(76072),Si=a(83309),_i=["flyout"],bi=["container"];function Fi(r,n){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"h2",8),e.\u0275\u0275elementContainerEnd()),2&r){var t=n.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("localize",t)}}function ki(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10),e.\u0275\u0275listener("click",function(l){var s=e.\u0275\u0275restoreView(t);return e.\u0275\u0275resetView(s.$implicit.click(l))}),e.\u0275\u0275elementEnd()}if(2&r){var i=n.$implicit;e.\u0275\u0275classMapInterpolate2("glyphicon glyph-",i.iconSize," pbi-glyph-",i.icon,""),e.\u0275\u0275property("pbiTooltip",i.tooltip)}}function Ei(r,n){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ki,1,5,"button",9),e.\u0275\u0275elementContainerEnd()),2&r){var t=n.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t)}}function xi(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.onClose())}),e.\u0275\u0275pipe(1,"localize"),e.\u0275\u0275elementEnd()}2&r&&e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(1,1,"Close"))}var Ii=function(){function r(n,t,i,o,l,s){this.injector=n,this.lazyProvider=t,this.localizationService=i,this.screenReaderService=o,this.flyoutRef=l,this.data=s,this.destroy$=new O.xQ}return r.prototype.ngOnInit=function(){var n=this;this.flyoutRef.title$.pipe((0,j.R)(this.destroy$)).subscribe(function(t){if(t){var i="".concat(n.localizationService.get(t)," ").concat(n.localizationService.get("Slicer_Menu"));n.screenReaderService.alert(i)}})},r.prototype.ngAfterViewInit=function(){return(0,u.__awaiter)(this,void 0,void 0,function(){var n;return(0,u.__generator)(this,function(i){switch(i.label){case 0:return[4,this.lazyProvider.getModule("@powerbi/ExploreUIAuthoring/lazy-modules/visual-container-skittles/visual-container-skittles-ui.module#VisualContainerSkittlesUIModule")];case 1:return n=i.sent(),this.container.createComponent(this.data.skittleContentComponent,{injector:this.injector,ngModuleRef:n}).changeDetectorRef.detectChanges(),[2]}})})},r.prototype.ngOnDestroy=function(){this.container.clear(),this.destroy$.next(),this.destroy$.complete()},r.prototype.onClose=function(){this.data.toggleSkittle(this.flyoutRef.type)},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(ht.E),e.\u0275\u0275directiveInject(we.o),e.\u0275\u0275directiveInject(Si.g),e.\u0275\u0275directiveInject(_e),e.\u0275\u0275directiveInject(Oe.M))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["skittle-flyout"]],viewQuery:function(t,i){if(1&t&&(e.\u0275\u0275viewQuery(_i,5),e.\u0275\u0275viewQuery(bi,5,e.ViewContainerRef)),2&t){var o=void 0;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i.flyoutElement=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i.container=o.first)}},decls:13,vars:10,consts:[["role","menu","aria-labelledby","skittleTitle",1,"skittleFlyout"],["flyout",""],[1,"header"],[4,"ngIf"],[1,"buttonContainer"],["class","glyphicon glyph-mini pbi-glyph-close","aria-label","Close",3,"pbiTooltip","click",4,"ngIf"],["role","menuitem",1,"allContent"],["container",""],["id","skittleTitle",1,"title",3,"localize"],["pbiTooltipCaretSize","small",3,"class","pbiTooltip","click",4,"ngFor","ngForOf"],["pbiTooltipCaretSize","small",3,"pbiTooltip","click"],["aria-label","Close",1,"glyphicon","glyph-mini","pbi-glyph-close",3,"pbiTooltip","click"]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"div",0,1)(2,"div",2),e.\u0275\u0275template(3,Fi,2,1,"ng-container",3),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementStart(5,"div",4),e.\u0275\u0275template(6,Ei,2,1,"ng-container",3),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,xi,2,3,"button",5),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",6),e.\u0275\u0275elementContainer(11,null,7),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275attribute("aria-expanded",!0),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,4,i.flyoutRef.title$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,6,i.flyoutRef.headerButtons$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(9,8,i.flyoutRef.showCloseButton$)))},dependencies:[f.NgForOf,f.NgIf,De.X,v.V,f.AsyncPipe,je.F],styles:['[_nghost-%COMP%]{--caret-background-color: var(--fluent-theme-neutral-lighter-color, #F3F2F1);--caret-border-color: var(--gray-70, #BEBBB8);--skittle-flyout-border-color: var(--gray-70, #BEBBB8);--skittle-flyout-background-color: var(--fluent-theme-neutral-lighter-color, #F3F2F1);background-color:var(--skittle-flyout-background-color);border:1px solid var(--skittle-flyout-border-color);border-radius:2px;box-shadow:0 0 2px var(--colorNeutralShadowAmbient),0 2px 4px var(--colorNeutralShadowKey);box-sizing:border-box;padding:8px 0;width:100%}[data-legacy-theming=false]   [_nghost-%COMP%]{--caret-background-color: var(--colorNeutralBackground3);--caret-border-color: var(--colorNeutralStroke1Selected);--skittle-flyout-border-color: var(--colorNeutralStroke1Selected);--skittle-flyout-background-color: var(--colorNeutralBackground3)}.pbi-overlay-caret.themeableElement[_nghost-%COMP%]:before, .pbi-overlay-caret.themeableElement[_nghost-%COMP%]:after{background:var(--caret-background-color);border:1px solid var(--caret-border-color)}.skittleFlyout[_ngcontent-%COMP%]{--skittle-flyout-button-color: var(--gray-190, #201F1E);display:flex;flex-direction:column;position:relative;height:100%;width:100%;z-index:1;color:var(--colorNeutralForeground1)}  [data-legacy-theming=false] .skittleFlyout{--skittle-flyout-button-color: var(--colorNeutralForeground1)}.skittleFlyout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:0 8px 12px}.skittleFlyout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--lg-font-size, 16px);font-weight:var(--font-weight-semi-bold, 600);margin:0;flex-grow:1}.skittleFlyout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .buttonContainer[_ngcontent-%COMP%]{display:flex;align-items:center}.skittleFlyout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .buttonContainer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0;border:0;background:transparent;margin-left:8px;color:var(--skittle-flyout-button-color)}.skittleFlyout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .buttonContainer[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{opacity:.5}.skittleFlyout[_ngcontent-%COMP%]   .allContent[_ngcontent-%COMP%]{flex:1;margin:0;overflow-x:hidden;overflow-y:overlay}@media print{[_nghost-%COMP%]{display:none!important}}'],changeDetection:0}),r}(),Pi=a(88819),gt=a(86940),wi=a(10675),Oi=["container"],Ti=function(){function r(n,t,i){this.injector=n,this.lazyProvider=t,this.flyoutRef=i,this.destroy$=new O.xQ}return r.prototype.ngOnDestroy=function(){this.container.clear(),this.destroy$.next(),this.destroy$.complete()},r.prototype.ngAfterViewInit=function(){return(0,u.__awaiter)(this,void 0,void 0,function(){var n;return(0,u.__generator)(this,function(i){switch(i.label){case 0:return[4,this.lazyProvider.getModule("@powerbi/ExploreUIAuthoring/lazy-modules/visual-container-skittles/visual-container-skittles-ui.module#VisualContainerSkittlesUIModule")];case 1:return n=i.sent(),this.container.createComponent(this.flyoutRef.config.component,{injector:this.injector,ngModuleRef:n}).changeDetectorRef.detectChanges(),[2]}})})},r.prototype.setNewHorizontalFlyoutSize=function(n){n.cancel||this.flyoutRef.updateWidth(n.newSize)},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(ht.E),e.\u0275\u0275directiveInject(_e))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["flyout"]],viewQuery:function(t,i){var o;(1&t&&e.\u0275\u0275viewQuery(Oi,5,e.ViewContainerRef),2&t)&&(e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i.container=o.first))},decls:3,vars:3,consts:[[3,"dock","enabled","disableElementSizing","onResize"],["container",""]],template:function(t,i){1&t&&(e.\u0275\u0275elementStart(0,"resizer",0),e.\u0275\u0275listener("onResize",function(l){return i.setNewHorizontalFlyoutSize(l)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainer(1,null,1)),2&t&&e.\u0275\u0275property("dock",i.flyoutRef.horizontalSide)("enabled",!0)("disableElementSizing",!0)},dependencies:[wi.d],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;min-height:100%;min-width:100%}.pbi-overlay-caret.themeableElement[_nghost-%COMP%]:before, .pbi-overlay-caret.themeableElement[_nghost-%COMP%]:after{background:var(--fluent-theme-neutral-lighter-color, #F3F2F1);border:1px solid var(--gray-70, #BEBBB8)}[_nghost-%COMP%] >*{display:block}@media print{[_nghost-%COMP%]{display:none!important}}"],changeDetection:0}),r}(),Di=function(){function r(n,t,i){void 0===i&&(i=0),this.skittleSettingsService=t,this.level=i,this.currentLayout=_.first(n),this.childLayouts=n.slice(1)}return r.prototype.createFlyoutConfig=function(n){var t,i,o,l=n.providers;this.childLayouts.length>0&&(l||(l=new WeakMap),l.set(Pi.l,new r(this.childLayouts,this.skittleSettingsService,this.level+1)));var s=null===(t=n.options)||void 0===t?void 0:t.width,c=this.skittleSettingsService.getDimensions(this.level);return c?.width&&(s=this.minMaxDimension(c.width,null===(i=n.options)||void 0===i?void 0:i.minWidth,null===(o=n.options)||void 0===o?void 0:o.maxWidth)),(0,u.__assign)((0,u.__assign)({},n),{options:(0,u.__assign)((0,u.__assign)({},n.options),{width:s}),providers:l,horizontalLayout:this.currentLayout.horizontalLayout,horizontalSide:this.currentLayout.horizontalSide,verticalLayout:this.currentLayout.verticalLayout})},r.prototype.monitorFlyoutDimensions=function(n){var t=this;n.flyoutWidth$.pipe((0,j.R)(n.onClose)).subscribe(function(i){var o=t.skittleSettingsService.getDimensions(t.level);i!==o?.width&&t.skittleSettingsService.setDimensions(t.level,{width:i})})},r.prototype.create=function(n,t){var i=this.createFlyoutConfig(n),o=new _e(i,t);return this.monitorFlyoutDimensions(o),o},r.prototype.createComponentPortal=function(n){return gt._.createComponentPortal((0,u.__assign)((0,u.__assign)({},n),{component:Ti}))},r.prototype.minMaxDimension=function(n,t,i){return(null==t||"string"==typeof t)&&(t=0),(null==i||"string"==typeof i)&&(i=Number.MAX_SAFE_INTEGER),Math.max(t,Math.min(n,i))},r}(),Mi=function(r){function n(t,i){var o=r.call(this,t,i)||this;o.overlayRef=i,o.titleSubject$=new h.X(null),o.title$=o.titleSubject$.asObservable(),o.showCloseButtonSubject$=new h.X(!1),o.showCloseButton$=o.showCloseButtonSubject$.asObservable(),o.headerButtonsSubject$=new h.X([]),o.headerButtons$=o.headerButtonsSubject$.asObservable(),o.config.providers.set(n,o);var l=o.config.data;return o.type=l.type,o.visualContainer=l.visualContainer,o.setTitle(l.title),o.setShowCloseButton(l.showCloseButton),o}return(0,u.__extends)(n,r),n.prototype.setTitle=function(t){this.titleSubject$.next(t)},n.prototype.setHeaderButtons=function(t){this.headerButtonsSubject$.next(t)},n.prototype.setShowCloseButton=function(t){this.showCloseButtonSubject$.next(t)},n}(_e),Li=function(r){function n(t,i){return r.call(this,t,i)||this}return(0,u.__extends)(n,r),n.prototype.create=function(t,i){var o=this.createFlyoutConfig(t),l=new Mi(o,i);return this.monitorFlyoutDimensions(l),l},n}(Di),mt=function(){function r(n,t){this.overlay=n,this.skittleSettingsService=t,this.destroy$=new O.xQ}return r.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},r.prototype.isFlyoutOpen=function(){return void 0!==this.skittleFlyoutRef},r.prototype.isFlyoutOfTypeOpen=function(n){var t;return(null===(t=this.skittleFlyoutRef)||void 0===t?void 0:t.type)===n},r.prototype.showFlyout=function(n,t){var i=this;S.fF.assertNonEmpty(t.flyoutLayouts,"Flyout layouts cannot be empty. Please provide at least 2 layouts.");var o=t.elementRef,l=t.flyoutLayouts,s=t.focusElementOnClose,c=t.disableAutoFocus,d=t.injector,p=t.minWidth,g=t.parent,W=t.position;if(g){var oe=g.overlayRef.getConfig().positionStrategy,E=this.overlay.position(g.overlayContainer).getPositionStrategyAdapter(oe).getPosition();"start"===E.overlayX?W=this.getPositions(!1):"end"===E.overlayX&&(W=this.getPositions(!0))}var X=this.getPositionStrategy(o,W,g?.overlayContainer),R=new Li(l,this.skittleSettingsService),y={component:Ii,data:n,options:{positionStrategy:X,scrollStrategy:this.overlay.scrollStrategies.reposition(),hasBackdrop:!1,disposeOnNavigation:!0,minWidth:p},caretSize:1,hasCaret:!0,useCaretOffsets:!1,closeOnBackdropClick:!1,disableCloseOnEsc:!1,disableFocusTrapSetting:{disable:!1,disableAutoFocus:c??!1},focusElementOnClose:s,injector:d,parent:g,closeWithParent:!0},b=this.overlay.openWithFactory(y,R);b.onClose.subscribe(function(){i.skittleFlyoutRef=void 0}),this.skittleFlyoutRef=b},r.prototype.closeFlyout=function(){this.skittleFlyoutRef&&this.skittleFlyoutRef.close()},r.prototype.getPositionStrategy=function(n,t,i){return this.overlay.position(i).withinOverlayContainer(n).withPositions(t).withMaxiumumVisibility(!0)},r.prototype.getPositions=function(n){var t=n?0:1,i=n?1:0;return[(0,Se.Zz)(ye.Lc.marginHorizontal,void 0,t),(0,Se.v3)(ye.Lc.marginHorizontal,void 0,t),(0,Se.J7)(ye.Lc.marginHorizontal,void 0,t),(0,Se.Iz)(-ye.Lc.marginHorizontal,void 0,i),(0,Se.q6)(-ye.Lc.marginHorizontal,void 0,i),(0,Se.Kb)(-ye.Lc.marginHorizontal,void 0,i)]},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275inject(gt._),e.\u0275\u0275inject(be))},r.\u0275prov=e.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(),yt=a(14002),Bi=a(21728),Vi=a(76312),zi=a(65302),Ne=a(98727),Ri=a(11547);function Wi(r){return null!=r.get(11)}var $i=["buildSkittle"],ji=["chartElementsSkittle"],Ui=["buildSkittleMask"],Ni=function(n){return{selected:n}};function Hi(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",4,5),e.\u0275\u0275listener("keydown",function(s){e.\u0275\u0275restoreView(t);var c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.onKeydown(s,"Build"))})("click",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(s.toggleBuildSkittle())}),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275pipe(3,"localize"),e.\u0275\u0275element(4,"pbi-office-icon",6)(5,"div",7,8),e.\u0275\u0275elementEnd()}if(2&r){var i=e.\u0275\u0275nextContext().ngIf,o=e.\u0275\u0275nextContext();e.\u0275\u0275styleProp("width",i.width+"px")("height",i.height+"px"),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(13,Ni,"Build"===o.skittlesService.lastOpenSkittleType))("pbiTooltip",e.\u0275\u0275pipeBind1(2,9,"VisualContainer_Skittle_Tooltip_Build"))("pbiTooltipPosition",o.tooltipPosition),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(3,11,"VisualContainer_Skittle_Tooltip_Build"))("aria-haspopup","menu")}}var Ki=function(n,t){return{selected:n,disabled:t}};function Qi(r,n){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10,11),e.\u0275\u0275listener("keydown",function(c){e.\u0275\u0275restoreView(t);var d=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(d.onKeydown(c,"ChartElements"))})("click",function(){e.\u0275\u0275restoreView(t);var c=e.\u0275\u0275nextContext().ngIf,d=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(!(null!=c.disabledState&&c.disabledState.disabled)&&d.toggleChartElementsSkittle())}),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275pipe(3,"localize"),e.\u0275\u0275element(4,"pbi-office-icon",12),e.\u0275\u0275elementEnd()}if(2&r){var i=e.\u0275\u0275nextContext().ngIf,o=e.\u0275\u0275nextContext().ngIf,l=e.\u0275\u0275nextContext();e.\u0275\u0275styleProp("width",o.width+"px")("height",o.height+"px"),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(15,Ki,"ChartElements"===l.skittlesService.lastOpenSkittleType,null==i.disabledState?null:i.disabledState.disabled))("pbiTooltip",e.\u0275\u0275pipeBind1(2,11,i.tooltip))("pbiTooltipDisabled",!1)("pbiTooltipPosition",l.tooltipPosition),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(3,13,i.tooltip))("aria-disabled",null==i.disabledState?null:i.disabledState.disabled)("aria-haspopup","menu")}}function Xi(r,n){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Qi,5,18,"button",9),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&r){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,1,t.chartElementsVisible$))}}var Gi=function(n,t){return{disabledState:n,tooltip:t}};function Yi(r,n){if(1&r&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275template(1,Hi,7,15,"button",2),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Xi,3,3,"ng-container",3),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementEnd()),2&r){var t=n.ngIf,i=e.\u0275\u0275nextContext();e.\u0275\u0275styleProp("row-gap",t.betweenMargin+"px"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,4,i.buildVisible$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction2(10,Gi,e.\u0275\u0275pipeBind1(4,6,i.chartElementsDisabledState$),e.\u0275\u0275pipeBind1(5,8,i.chartElementsTooltip$)))}}var Ct=function(){function r(n,t,i,o,l,s,c,d,p,g,P,W,m,oe){var te,E,U=this;this.skittleSettingsService=n,this.changeDetection=t,this.dataSources=i,this.eventBridge=o,this.hostOverlayRef=l,this.injector=s,this.lazyScopedProviderModern=c,this.runningVisualService=d,this.selectionService=p,this.skittleFlyoutService=g,this.visualAuthoring=P,this.skittlesData=W,this.contextActivityService=m,this.visibilityService=oe,this.destroy$=new O.xQ,this.buildSkittleElementRef$=new h.X(void 0),this.chartElementsSkittleElementRef$=new h.X(void 0),this.buildSkittleMaskElementRef$=new h.X(void 0),this.visualContainer=this.skittlesData.visualContainer,S.fF.assertValue(this.visualContainer,"Expect this.skittlesData.visualContainer to be defined"),this.buildVisible$=this.skittlesData.supportedSkittleTypes$.pipe((0,ee.U)(function(b){return _.some(b,function(Z){return"Build"===Z.type})}),(0,Te.b)(function(b){!b&&U.isFlyoutOfTypeOpen("Build")&&U.skittleFlyoutService.closeFlyout()}),(0,Fe.x)());var X=this.skittlesData.supportedSkittleTypes$.pipe((0,ee.U)(function(b){return _.some(b,function(Z){return"ChartElements"===Z.type})})),R=null===(te=this.runningVisualService.getVisual(this.visualContainer))||void 0===te?void 0:te.getErrorInfo(),y=new h.X(!!R);this.eventBridge.on(se.uB4).pipe((0,j.R)(this.destroy$)).subscribe(function(){var b;S.fF.assertValue(y,"Expect visualHasError$ to be defined");var Z=null===(b=U.runningVisualService.getVisual(U.visualContainer))||void 0===b?void 0:b.getErrorInfo();y.next(!!Z)}),this.chartElementsVisible$=(0,T.aj)([X,y]).pipe((0,ee.U)(function(b){return b[0]&&!b[1]}),(0,Te.b)(function(b){!b&&U.isFlyoutOfTypeOpen("ChartElements")&&U.skittleFlyoutService.closeFlyout()}),(0,Fe.x)()),this.chartElementsDisabledState$=this.skittlesData.supportedSkittleTypes$.pipe((0,ee.U)(function(b){var Z;return null===(Z=_.find(b,function(re){return"ChartElements"===re.type}))||void 0===Z?void 0:Z.disabled$}),(0,z.w)(function(b){return b??(0,Ri.of)(void 0)})),this.chartElementsTooltip$=null===(E=this.chartElementsDisabledState$)||void 0===E?void 0:E.pipe((0,ee.U)(function(b){if(null!=b)return b?.disabled?b.disabledReasonKey:"VisualContainer_Skittle_Tooltip_ChartElement"}),(0,j.R)(this.destroy$))}return Object.defineProperty(r.prototype,"_buildSkittleElement",{set:function(t){var i=this;this.buildSkittleElementRef$.next(t),t?.nativeElement&&this.skittlesData.showBuildFlyout$.pipe((0,V.h)(function(o){return null!==o}),(0,j.R)(this.destroy$)).subscribe(function(){setTimeout(function(){i.isFlyoutOfTypeOpen("Build")||i.showFlyoutOfType("Build")},Ne.sM.DefaultShowDelay)})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_chartElementsSkittleElement",{set:function(t){this.chartElementsSkittleElementRef$.next(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_buildSkittleMaskElement",{set:function(t){this.buildSkittleMaskElementRef$.next(t),t?.nativeElement&&this.setupBuildSkittleDragHandler(t.nativeElement)},enumerable:!1,configurable:!0}),r.prototype.ngOnInit=function(){var n=this;this.lazyScopedProviderModern.get("visualContainerSkittlesService").then(function(t){n.skittlesService=t,n.skittlesStyle$=n.skittlesService.skittlesPosition$.pipe((0,V.h)(function(o){return null!=o&&o.container===n.visualContainer}),(0,ee.U)(function(o){return{height:o.positions.skittleButtons.buttonHeight,width:o.positions.skittleButtons.buttonWidth,betweenMargin:o.positions.skittleButtons.betweenButtonMargin}})),n.skittlesService.skittlesPosition$.pipe((0,V.h)(function(o){return null!=o&&o.container===n.visualContainer}),(0,j.R)(n.destroy$)).subscribe(function(o){n.skittlePosition=o.positions,n.tooltipPosition=n.skittlePosition.skittleButtons.tooltipPosition}),n.changeDetection.detectChanges();var i=n.skittlesData.withActiveSkittle;null!=i&&n.skittlesData.supportedSkittleTypes$.pipe((0,Re.q)(1)).subscribe(function(o){n.skittlePosition&&_.some(o,function(s){return s.type===i})&&(n.initialFlyoutOpenSkittleType$=new h.X(i),(0,T.aj)([n.initialFlyoutOpenSkittleType$,"Build"===i?n.buildSkittleElementRef$:n.chartElementsSkittleElementRef$]).pipe((0,V.h)(function(s){return null!=s[0]&&null!=s[1]}),(0,Re.q)(1)).subscribe(function(s){n.toggleSkittle(s[0],n.skittlesData.skipActiveSkittleFlyoutAutoFocus)}))})}),this.eventBridge.on(se.tRg).pipe((0,j.R)(this.destroy$)).subscribe(function(){if(n.skittleFlyoutService.isFlyoutOpen()){var t=n.selectionService.getSelectedElements();1===_.size(t)&&!_.isEmpty(t[0].subSelections)&&(n.skittlesService.lastOpenSkittleType=void 0,n.skittleFlyoutService.closeFlyout())}})},r.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},r.prototype.toggleBuildSkittle=function(){return(0,u.__awaiter)(this,void 0,void 0,function(){return(0,u.__generator)(this,function(n){switch(n.label){case 0:return[4,this.toggleSkittle("Build")];case 1:return n.sent(),[2]}})})},r.prototype.toggleChartElementsSkittle=function(){return(0,u.__awaiter)(this,void 0,void 0,function(){return(0,u.__generator)(this,function(n){switch(n.label){case 0:return[4,this.toggleSkittle("ChartElements")];case 1:return n.sent(),[2]}})})},r.prototype.onKeydown=function(n,t){return(0,u.__awaiter)(this,void 0,void 0,function(){var i;return(0,u.__generator)(this,function(o){switch(n.key){case"ArrowDown":"Build"===t&&(i=this.chartElementsSkittleElementRef$.value.nativeElement);break;case"ArrowUp":"ChartElements"===t&&(i=this.buildSkittleElementRef$.value.nativeElement)}return i&&zi.IK.focus(i),[2]})})},r.prototype.toggleSkittle=function(n,t){return void 0===t&&(t=!1),(0,u.__awaiter)(this,void 0,void 0,function(){var i,o,l;return(0,u.__generator)(this,function(s){switch(s.label){case 0:i=function(r,n,t,i){var o,l=null===(o=_.first(i.getSelectedElements()))||void 0===o?void 0:o.canvasItem.name;return n.createActivity({name:"OpenSkittle",visualName:l,data:{skittleType:r,source:Wi(t)?"InFocus":"Skittle"}})}(n,this.contextActivityService,this.visibilityService,this.selectionService),s.label=1;case 1:return s.trys.push([1,5,,6]),o=this.isFlyoutOfTypeOpen(n),this.skittleFlyoutService.closeFlyout(),o?[3,3]:[4,this.showFlyoutOfType(n,t)];case 2:return s.sent(),this.skittlesService.lastOpenSkittleType=n,[3,4];case 3:this.skittlesService.lastOpenSkittleType=void 0,s.label=4;case 4:return this.changeDetection.detectChanges(),i.resolve(),[3,6];case 5:throw l=s.sent(),i.reject(l),l;case 6:return[2]}})})},r.prototype.showFlyoutOfType=function(n,t){var i,o=this;void 0===t&&(t=!1),S.fF.assertValue(this.skittlePosition,"expecting skittles to be open to show the flyout");var l=(i=this.getSkittleFlyoutProperties(n)).title,s=i.component,c=i.flyoutPosition,d=i.elementRef;S.fF.assertValue(d,"expecting skittle of type ".concat(n," exists")),this.ensureSubselectionClosed(),"Build"===n&&(this.skittleSettingsService.setAutoVisualWithPerspectives(this.skittlesData.fromPersonalize),this.skittleSettingsService.setShowClearChanges(this.skittlesData.fromPersonalize)),this.skittleFlyoutService.showFlyout({skittleContentComponent:s,toggleSkittle:function(X){return o.toggleSkittle(X)},title:l,type:n,showCloseButton:!0,visualContainer:this.visualContainer},{flyoutLayouts:[{horizontalLayout:this.skittlePosition.horizontalLayout.firstLevelFlyout,verticalLayout:this.skittlePosition.verticalLayout.firstLevelFlyout,horizontalSide:"Left"===this.skittlePosition.horizontalLayout.firstLevelFlyout.alignment?"left":"right"},{horizontalLayout:this.skittlePosition.horizontalLayout.secondLevelFlyout,verticalLayout:this.skittlePosition.verticalLayout.secondLevelFlyout,horizontalSide:"Left"===this.skittlePosition.horizontalLayout.secondLevelFlyout.alignment?"left":"right"}],elementRef:d,focusElementOnClose:d.nativeElement,disableAutoFocus:t,injector:this.injector,parent:this.hostOverlayRef,position:c.position,height:c.height,maxHeight:c.maxHeight,width:c.width,minWidth:c.minWidth,maxWidth:c.maxWidth})},r.prototype.getSkittleFlyoutProperties=function(n){switch(n){case"Build":return{title:"Suggest_A_Visual",flyoutPosition:(0,yt.m)(this.skittlePosition.horizontalLayout.firstLevelFlyout,this.skittlePosition.verticalLayout.firstLevelFlyout,(t=this.buildSkittleElementRef$.value).nativeElement),elementRef:t,component:at};case"ChartElements":var t;return{title:"Skittles_ChartElements_Title",flyoutPosition:(0,yt.m)(this.skittlePosition.horizontalLayout.firstLevelFlyout,this.skittlePosition.verticalLayout.firstLevelFlyout,(t=this.chartElementsSkittleElementRef$.value).nativeElement),elementRef:this.chartElementsSkittleElementRef$.value,component:pt};default:S.fF.assertNever(n)}},r.prototype.isFlyoutOfTypeOpen=function(n){return this.skittleFlyoutService.isFlyoutOfTypeOpen&&this.skittleFlyoutService.isFlyoutOfTypeOpen(n)},r.prototype.ensureSubselectionClosed=function(){Bi.UP.selectSubSelection(this.selectionService,this.visualContainer,[],0)},r.prototype.setupBuildSkittleDragHandler=function(n){var i,t=this;n.addEventListener("dragenter",function(){i=setTimeout(function(){t.isFlyoutOfTypeOpen("Build")||t.showFlyoutOfType("Build")},Ne.sM.DefaultShowDelay)}),n.addEventListener("dragleave",function(){clearTimeout(i)}),(0,Vi.$o)(n,function(o,l){return(0,u.__awaiter)(t,void 0,void 0,function(){var c=this;return(0,u.__generator)(this,function(d){switch(d.label){case 0:return[4,this.visualAuthoring.addFieldToVisual(l,this.dataSources.get(),this.visualContainer,"DraggedToVisual")];case 1:return d.sent()&&setTimeout(function(){c.isFlyoutOfTypeOpen("Build")||c.showFlyoutOfType("Build")},Ne.sM.DefaultShowDelay),[2]}})})})},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(be),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Ve.D),e.\u0275\u0275directiveInject(ze.J),e.\u0275\u0275directiveInject(Oe.w),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(Pe.H),e.\u0275\u0275directiveInject(Ze.s),e.\u0275\u0275directiveInject(Ae.z),e.\u0275\u0275directiveInject(mt),e.\u0275\u0275directiveInject(Je.$8),e.\u0275\u0275directiveInject(Oe.M),e.\u0275\u0275directiveInject(Be.r),e.\u0275\u0275directiveInject(qe.w))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["visual-container-skittles"]],viewQuery:function(t,i){if(1&t&&(e.\u0275\u0275viewQuery($i,5,e.ElementRef),e.\u0275\u0275viewQuery(ji,5,e.ElementRef),e.\u0275\u0275viewQuery(Ui,5,e.ElementRef)),2&t){var o=void 0;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i._buildSkittleElement=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i._chartElementsSkittleElement=o.first),e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(i._buildSkittleMaskElement=o.first)}},features:[e.\u0275\u0275ProvidersFeature([mt])],decls:2,vars:3,consts:[["class","visualContainerSkittles",3,"row-gap",4,"ngIf"],[1,"visualContainerSkittles"],["class","skittle pbi-depth-1","data-automation-id","visual-container-skittle-build-button","pbiTooltipCaretSize","small","pbiTooltipShowDelay","500",3,"ngClass","width","height","pbiTooltip","pbiTooltipPosition","keydown","click",4,"ngIf"],[4,"ngIf"],["data-automation-id","visual-container-skittle-build-button","pbiTooltipCaretSize","small","pbiTooltipShowDelay","500",1,"skittle","pbi-depth-1",3,"ngClass","pbiTooltip","pbiTooltipPosition","keydown","click"],["buildSkittle",""],["name","suggestLightningBolt_20"],[1,"skittle-mask"],["buildSkittleMask",""],["class","skittle pbi-depth-1","pbiTooltipCaretSize","small","pbiTooltipShowDelay","500",3,"ngClass","width","height","pbiTooltip","pbiTooltipDisabled","pbiTooltipPosition","keydown","click",4,"ngIf"],["pbiTooltipCaretSize","small","pbiTooltipShowDelay","500",1,"skittle","pbi-depth-1",3,"ngClass","pbiTooltip","pbiTooltipDisabled","pbiTooltipPosition","keydown","click"],["chartElementsSkittle",""],["name","PBIAddToChart_20"]],template:function(t,i){1&t&&(e.\u0275\u0275template(0,Yi,6,13,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,i.skittlesStyle$))},dependencies:[f.NgClass,f.NgIf,ct.m,v.V,f.AsyncPipe,je.F],styles:[".visualContainerSkittles[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:0;--skittle-background-color: var(--gray-40, #E1DFDD);--skittle-box-shadow: 0px 0px 2px var(--colorNeutralShadowAmbient), 0px 2px 4px var(--colorNeutralShadowKey);--skittle-border-color: var(--gray-50, #D2D0CE);--skittle-selected-background-color: var(--gray-80, #B3B0AD);--skittle-selected-border-color: var(--gray-130, #605E5C);--skittle-hover-background-color: var(--gray-70, #BEBBB8);--skittle-active-background-color: var(--gray-90, #A19F9D)}  [data-legacy-theming=false] .visualContainerSkittles{--skittle-background-color: var(--colorNeutralBackground3);--skittle-box-shadow: 0px 0px 2px var(--colorNeutralShadowAmbient), 0px 2px 4px var(--colorNeutralShadowKey);--skittle-border-color: var(--colorNeutralStroke3);--skittle-selected-background-color: var(--colorNeutralBackground3Selected);--skittle-selected-border-color: var(--colorNeutralStroke3);--skittle-hover-background-color: var(--colorNeutralBackground3Hover);--skittle-active-background-color: var(--colorNeutralBackground3Pressed)}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle[_ngcontent-%COMP%]{background-color:var(--skittle-background-color);box-shadow:var(--skittle-box-shadow);outline:none;border:1px solid var(--skittle-border-color);border-radius:2px;box-sizing:border-box;padding:0;align-items:center;justify-content:center;display:flex;cursor:pointer;position:relative}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle[_ngcontent-%COMP%]:hover:not(.disabled){background-color:var(--skittle-hover-background-color);border-color:transparent}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle[_ngcontent-%COMP%]:active:not(.disabled){background-color:var(--skittle-active-background-color);border-color:transparent}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle.selected[_ngcontent-%COMP%]{background-color:var(--skittle-selected-background-color);border-color:var(--skittle-selected-border-color)}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle.disabled[_ngcontent-%COMP%]{cursor:default}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle.disabled[_ngcontent-%COMP%]   pbi-office-icon[_ngcontent-%COMP%]{opacity:.4}  html[data-focus-source=key] .visualContainerSkittles .skittle:focus,   html[data-focus-source=key] .visualContainerSkittles .skittle:hover:focus,   html[data-focus-source=key] .visualContainerSkittles .skittle:active:focus,   html[data-focus-source=key] .visualContainerSkittles .skittle.selected:focus{border:2px solid var(--fluent-theme-black-color, #000)}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle[_ngcontent-%COMP%]   pbi-office-icon[_ngcontent-%COMP%]{height:20px;width:20px}.visualContainerSkittles[_ngcontent-%COMP%]   .skittle[_ngcontent-%COMP%]   .skittle-mask[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}@media print{[_nghost-%COMP%]{display:none!important}}"],changeDetection:0}),r}(),Ji=a(54485),Zi=[{type:Ct,componentId:"VisualContainerSkittlesComponentId"},{type:dt,componentId:"BuildSkittlePaneComponentId"},{type:vt,componentId:"SuggestSkittlePaneComponentId"},{type:ft,componentId:"ChartElementsSkittlePaneComponentId"}],qi=function(){function r(n){a.e("on-object").then(a.bind(a,39875)).then(function(t){n.registerIcons(t.iconSpriteSheet.sprite)})}return r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275inject(Ji.u))},r.\u0275mod=e.\u0275\u0275defineNgModule({type:r}),r.\u0275inj=e.\u0275\u0275defineInjector({providers:[be],imports:[f.CommonModule,B.J,x.N.withManifests(Zi),M.v,w.p,F.V,k.X,G.m,Y.N,ie.x,J.Z,de.K,ne.T6,A.Q]}),r}()},13941:function(ue,H,a){function f(F){return"add"===F.type}function B(F){return"delete"===F.type}function A(F){return"reorder"===F.type}function w(F){return"replace"===F.type}function x(F){return"rename"===F.type}function M(F){return"initialize"===F.type}a.d(H,{H2:function(){return B},JB:function(){return f},V5:function(){return M},cA:function(){return w},cS:function(){return A},y$:function(){return x}})},14002:function(ue,H,a){a.d(H,{C:function(){return F},m:function(){return k}});var f=a(64466),B=a(62458),A=a(25512),w=a(49977),x={LeftTop:A.Iz,RightTop:A.Zz,LeftCenter:A.q6,RightCenter:A.v3,LeftBottom:A.Kb,RightBottom:A.J7,RightInsideTop:function(I,C){return{originX:"end",originY:"top",overlayX:"end",overlayY:"top",offsetX:I,offsetY:C}},RightInsideBottom:function(I,C){return{originX:"end",originY:"bottom",overlayX:"end",overlayY:"bottom",offsetX:I,offsetY:C}}},M=2;function F(v,I){B.fF.assertValue(v,"visualContainer"),B.fF.assertValue(I,"visualOverlayPosition");var C=I.getOrigin(v);if(C){if(!(C instanceof Element))return void B.fF.assertFail("Visual container origin is not of type Element");var u=document.querySelector(f.s.DisplayAreaContainerNameSelector.selector);if(!(u&&u instanceof Element))return void B.fF.assertFail("Canvas area container is not of type Element");var h=G(u,C);if(B.fF.assert(function(){return 0!==h.originWidth&&0!==h.originHeight},"visual width or height is 0 now, check how to avoid calculating skittle position before visual is rendered"),function(v){if(v.relativeY>=v.pageHeight||v.relativeY+v.originHeight<=0||v.relativeX>=v.pageWidth)return!1;var C=v.relativeX+v.originWidth;return!(C<=0)&&!(v.relativeX<0&&v.pageWidth-C<0)}(h)){var O=function(v){var D,V,z,C=v.pageWidth-(v.relativeX+v.originWidth),u=v.relativeX,h=w.Lc.width+w.Lc.marginHorizontal,O=w.Lc.childOverlayWidth+w.Lc.marginHorizontal,T=h+2*O,$=h+O;return C>=$?{skittleButtons:D="Right",firstLevelFlyout:{alignment:V="Right",maxWidth:ne(v,D,V,z=C>=T?"Right":"Left")},secondLevelFlyout:{alignment:z}}:u>=$?{skittleButtons:D="Left",firstLevelFlyout:{alignment:V="Left",maxWidth:ne(v,D,V,z=u>=T?"Left":"Right")},secondLevelFlyout:{alignment:z}}:C>=h?{skittleButtons:D="Right",firstLevelFlyout:{alignment:V="Left",maxWidth:ne(v,D,V,z="Left")},secondLevelFlyout:{alignment:z}}:u>=h?{skittleButtons:D="Left",firstLevelFlyout:{alignment:V="Right",maxWidth:ne(v,D,V,z="Right")},secondLevelFlyout:{alignment:z}}:C>=0?{skittleButtons:D="RightInside",firstLevelFlyout:{alignment:V="Left",maxWidth:ne(v,D,V,z="Left")},secondLevelFlyout:{alignment:z}}:void 0}(h);if(O){var T=function(v){var O=v.relativeY/v.pageHeight*100;return{skittleButtons:(v.relativeY>=0?v.pageHeight-v.relativeY:v.pageHeight)>=(w.Lc.height+w.Lc.betweenSkittlesVerticalSpace)*M-w.Lc.betweenSkittlesVerticalSpace?"Top":"Bottom",firstLevelFlyout:O<=50?"Top":O<=75?"Center":"Bottom",secondLevelFlyout:"Center"}}(h);if(T){var $=function(v,I){var C;if("Top"===v){var u=0-I.relativeY;u>0&&(C=u)}else if("Bottom"===v){var h=I.relativeY+I.originHeight-I.pageHeight;h>0&&(C=-h)}return C}(T.skittleButtons,h);return{skittleButtons:{overlayPosition:[J(O.skittleButtons,T.skittleButtons,w.Lc.marginHorizontal,$)],buttonHeight:w.Lc.height,buttonWidth:w.Lc.width,betweenButtonMargin:w.Lc.betweenSkittlesVerticalSpace,tooltipPosition:"Left"===O.firstLevelFlyout.alignment?"after":"before"},verticalLayout:T,horizontalLayout:O}}}}}}function k(v,I,C,u){void 0===u&&(u=0);var h=v.alignment,O=v.maxWidth,T=I,$=document.querySelector(f.s.DisplayAreaContainerNameSelector.selector);if($&&$ instanceof Element){var z,D=G($,C),V=D.pageHeight-D.relativeY-1;switch(T){case"Top":z=V-u;break;case"Center":z=2*(V-D.originHeight/2),u=document.documentElement.clientHeight-D.originY-u-1-V+u;break;case"Bottom":z=D.originY+D.originHeight-u}return{position:[J(h,T,w.Lc.marginHorizontal,u)],height:void 0,width:w.Lc.childOverlayWidth,maxHeight:z,maxWidth:O,minWidth:w.Lc.childOverlayWidth}}}function G(v,I){var C=I.getBoundingClientRect(),u=v.getBoundingClientRect();return{pageHeight:u.height,pageWidth:u.width,pageX:u.x,pageY:u.y,originHeight:C.height,originWidth:C.width,originX:C.x,originY:C.y,relativeX:C.x-u.x,relativeY:C.y-u.y}}function J(v,I,C,u){if(null==C&&null==u)return x["".concat(v).concat(I)]();var h="Left"===v||"RightInside"===v?-C:C;return x["".concat(v).concat(I)](h,u)}function ne(v,I,C,u){var h=v.pageWidth,O=v.originWidth,T=v.relativeX,$=w.Lc.width+2*w.Lc.marginHorizontal,D=w.Lc.childOverlayWidth+w.Lc.marginHorizontal;if("Right"===I){if("Right"!==C)return B.fF.assert(function(){return"Left"===C&&"Left"===u},"Skittle buttons right; Should match combination in getHorizontalLayout"),T+O-D;if("Right"===u)return h-(T+O)-$-D;if("Left"===u)return h-(T+O)-$}else if("Left"===I){if("Left"===C){if("Right"===u)return T-$;if("Left"===u)return T-$-D}else if("Right"===C)return B.fF.assert(function(){return"Right"===u},"SkittlePosition left; should match combinations in getHorizontalLayout"),h-T-D}else if("RightInside"===I)return B.fF.assert(function(){return"Left"===C&&"Left"===u},"Skittle buttons are RightInside, but should match combination in getHorizontalLayout"),T+O-$-D;return w.Lc.childOverlayWidth}},98476:function(ue,H,a){a.d(H,{f:function(){return w}});var f=a(45413),B=a(74082);function A(x){return void 0!==x.pickerDataExpr}function w(x,M){for(var k,F=(0,B.ez)(x),G=M.length-1;G>=0;G--){var Y=M[G],ie=Y.expr;if(F&&(0,B.y3)(ie)){var J,de=G;if((J=A(Y)?_.findIndex(Y.children,function(ne){return(0,f.fS)(ne.expr,x)}):_.findIndex(Y.hierarchyLevels,function(ne){return(0,f.fS)(ne.expr,x)}))>=0)return[de,J]}if((0,B.iV)(ie)&&(ie=ie.arg),(0,f.fS)(ie,x))return[G]}return k}}}]);