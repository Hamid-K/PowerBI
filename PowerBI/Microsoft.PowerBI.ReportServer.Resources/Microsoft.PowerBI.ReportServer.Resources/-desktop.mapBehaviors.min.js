"use strict";

(self.webpackChunkdesktop = self.webpackChunkdesktop || []).push([ [ "mapBehaviors" ], {
    96071: function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {
        __webpack_require__.r(__webpack_exports__), __webpack_require__.d(__webpack_exports__, {
            MapBehavior: function() {
                return MapBehavior;
            }
        });
        var _Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(60066), _Visuals_common_eventBubblingUtil__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(66232), _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(30237), _Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(5962), _Visuals_common_tooltipUtils__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(38400), _VisualsCommon_geometry_point__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(81551), _VisualsCommon_geometry_shapes2__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(79476), _VisualsCommon_Utility_browserUtils__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(59107), _VisualsCommon_Utility_keyUtils__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(9795), MapBehavior = function() {
            function MapBehavior() {
                this.mapPointerEventsDisabled = !1, this.mapPointerTimeoutSet = !1, this.viewChangedSinceLastClearMouseDown = !1, 
                this.receivedZoomOrPanEvent = !1, this.clearMouseDownLocation = new _VisualsCommon_geometry_point__WEBPACK_IMPORTED_MODULE_0__.E;
            }
            return MapBehavior.prototype.bindEvents = function(options, selectionHandler, dataPointNavigationManagerWithKey) {
                var _this = this, root = this.root = options.root, bubbles = this.bubbles = options.bubbles, slices = this.slices = options.slices, shapes = this.shapes = options.shapes, visualInstanceId = this.visualInstanceId = options.visualInstanceId, clearCapture = options.clearCapture;
                if (this.focusCallback = options.focusCallback, this.hostServices = options.hostServices, 
                this.pointLabelText = this.hostServices.getLocalizedString("Generic_Point"), this.widthDivisor = options.widthDivisor, 
                dataPointNavigationManagerWithKey) {
                    var pointSourceKey = dataPointNavigationManagerWithKey.pointSourceKey;
                    this.dataPointNavigationManager = dataPointNavigationManagerWithKey.dataPointNavigationManager, 
                    this.pointSourceKey = pointSourceKey;
                }
                this.selectionHandler = selectionHandler, this.hitTester = options.hitTester, root && (this.registerArrowKeyStopper(root), 
                this.dataPointNavigationManager && !this.dataPointNavigationManager.isEmpty(this.pointSourceKey) && ((0, 
                _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.W3)(root.select(_Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__.Kp), this.dataPointNavigationManager, this.pointSourceKey), 
                (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.zV)(root, visualInstanceId, this.pointSourceKey), 
                (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.lt)(root, selectionHandler))), 
                this.mapPointerEventsDisabled || (bubbles && bubbles.style("pointer-events", "all"), 
                slices && slices.style("pointer-events", "all"), shapes && shapes.style("pointer-events", "all"));
                var allowWheelEventToBingMap = function() {
                    var selection = _this.activeSelection, d3Event = d3.event;
                    selection && (_this.mapPointerEventsDisabled || selection.style("pointer-events", "none"), 
                    _this.mapPointerEventsDisabled = !0, d3Event.preventDefault(), _this.mapPointerTimeoutSet || (_this.mapPointerTimeoutSet = !0, 
                    setTimeout(function() {
                        selection && selection.style("pointer-events", "all"), _this.mapPointerEventsDisabled = !1, 
                        _this.mapPointerTimeoutSet = !1;
                    }, 500)));
                };
                bubbles && (this.activeSelection = bubbles, options.bubbleEventGroup.on("mousewheel", allowWheelEventToBingMap), 
                this.registerMapSelectionHandler(options.bubbleEventGroup, selectionHandler), (0, 
                _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.TY)(options.eventManager, options.bubbleEventGroup, selectionHandler), 
                this.dataPointNavigationManager && !this.dataPointNavigationManager.isEmpty(this.pointSourceKey) && (0, 
                _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.I8)(options.bubbleEventGroup, this.dataPointNavigationManager, this.pointSourceKey)), 
                slices && (this.activeSelection = slices, options.sliceEventGroup.on("mousewheel", allowWheelEventToBingMap), 
                this.registerMapSelectionHandler(options.sliceEventGroup, selectionHandler), (0, 
                _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.TY)(options.eventManager, options.sliceEventGroup, selectionHandler), 
                this.dataPointNavigationManager && !this.dataPointNavigationManager.isEmpty(this.pointSourceKey) && (0, 
                _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.I8)(options.sliceEventGroup, this.dataPointNavigationManager, this.pointSourceKey)), 
                shapes && (this.activeSelection = shapes, options.shapeEventGroup.on("mousewheel", allowWheelEventToBingMap), 
                this.registerMapSelectionHandler(options.shapeEventGroup, selectionHandler), (0, 
                _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.TY)(options.eventManager, options.shapeEventGroup, selectionHandler), 
                this.dataPointNavigationManager && !this.dataPointNavigationManager.isEmpty(this.pointSourceKey) && (0, 
                _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.I8)(options.shapeEventGroup, this.dataPointNavigationManager, this.pointSourceKey)), 
                clearCapture && (clearCapture.on("mouseup", function() {
                    var d3Event = d3.event;
                    _this.shouldExitHandlerEarly(d3Event) || (0, _VisualsCommon_geometry_shapes2__WEBPACK_IMPORTED_MODULE_3__.Sp)(_this.clearMouseDownLocation, new _VisualsCommon_geometry_point__WEBPACK_IMPORTED_MODULE_0__.E(d3Event.x, d3Event.y)) < 12 && !_this.viewChangedSinceLastClearMouseDown && !_VisualsCommon_Utility_browserUtils__WEBPACK_IMPORTED_MODULE_4__.M.isCtrlOrMeta(d3Event) && (_this.bubbles && 0 !== _this.bubbles.filter(function() {
                        return this === d3Event.target;
                    }).size() || _this.slices && 0 !== _this.slices.filter(function() {
                        return this === d3Event.target;
                    }).size() || _this.shapes && 0 !== _this.shapes.filter(function() {
                        return this === d3Event.target;
                    }).size() || selectionHandler.handleClearSelection(), _this.receivedZoomOrPanEvent = !0);
                }, !0), clearCapture.on("mousedown", function() {
                    var d3Event = d3.event;
                    _this.viewChangedSinceLastClearMouseDown = !1, _this.clearMouseDownLocation = new _VisualsCommon_geometry_point__WEBPACK_IMPORTED_MODULE_0__.E(d3Event.x, d3Event.y);
                }, !0), clearCapture.on("mousewheel", function() {
                    _this.receivedZoomOrPanEvent = !0;
                }, !0)), options.navigationEntry && (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.W3)(d3.select(options.navigationEntry), this.dataPointNavigationManager, this.pointSourceKey);
            }, MapBehavior.prototype.bindHitTester = function(hitTester) {
                this.hitTester = hitTester;
            }, MapBehavior.prototype.renderSelection = function(hasSelection) {
                this.bubbles && this.bubbles.attr("aria-selected", function(d) {
                    return d.selected;
                }).style("fill-opacity", function(d) {
                    return (0, _Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.eR)(d.selected, !1, hasSelection, !1);
                }).style("stroke-opacity", function(d) {
                    return (0, _Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.eR)(d.selected, !1, hasSelection, !1);
                }), this.slices && this.slices.attr("aria-selected", function(d) {
                    return d.selected;
                }).style("fill-opacity", function(d) {
                    return (0, _Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.eR)(d.data.selected, !1, hasSelection, !1);
                }).style("stroke-opacity", function(d) {
                    return (0, _Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.eR)(d.data.selected, !1, hasSelection, !1);
                }), this.shapes && this.shapes.attr("aria-selected", function(d) {
                    return d.selected;
                }).style("fill-opacity", function(d) {
                    return (0, _Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.eR)(d.selected, !1, hasSelection, !1);
                }).style("stroke-opacity", function(d) {
                    return (0, _Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.eR)(d.selected, !1, hasSelection, !1);
                });
            }, MapBehavior.prototype.viewChanged = function() {
                this.viewChangedSinceLastClearMouseDown = !0;
            }, MapBehavior.prototype.resetZoomPan = function() {
                this.receivedZoomOrPanEvent = !1;
            }, MapBehavior.prototype.hasReceivedZoomOrPanEvent = function() {
                return this.receivedZoomOrPanEvent;
            }, MapBehavior.prototype.lassoSelectRect = function(e, rect) {
                if (this.hitTester) {
                    var selectedDataPoints = this.hitTester.queryRegion(rect);
                    (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.ct)(e, selectedDataPoints, this.selectionHandler);
                }
            }, MapBehavior.prototype.renderFocus = function(element) {
                if (element) {
                    this.bubbles && this.bubbles.attr("aria-label", this.pointLabelText), this.slices && this.slices.attr("aria-label", this.pointLabelText), 
                    this.shapes && this.shapes.attr("aria-label", this.pointLabelText);
                    var focusElement = d3.select(element);
                    this.addAriaLabelToSelection(focusElement);
                    var focusElementBounds = focusElement.node().getBoundingClientRect(), viewPortBounds = focusElement.node().viewportElement.getBoundingClientRect();
                    this.elementOutsideViewport(focusElementBounds, viewPortBounds) && this.focusCallback();
                    var focusElementId = "".concat(_Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.aY, "-").concat(this.visualInstanceId);
                    this.root.select("#" + focusElementId).attr("id", null), element.setAttribute("id", focusElementId), 
                    focusElement.style("outline-width", "".concat(1 / this.widthDivisor, "px"), "important"), 
                    _VisualsCommon_Utility_browserUtils__WEBPACK_IMPORTED_MODULE_4__.M.focus(element);
                }
            }, MapBehavior.prototype.elementOutsideViewport = function(elementRect, viewportRect) {
                return elementRect.x < viewportRect.x || elementRect.y < viewportRect.y || elementRect.x + elementRect.width > viewportRect.x + viewportRect.width || elementRect.y + elementRect.height > viewportRect.y + viewportRect.height;
            }, MapBehavior.prototype.registerMapSelectionHandler = function(selection, selectionHandler) {
                var _this = this;
                selection.on("click", function() {
                    var d3Event = d3.event;
                    _this.shouldExitHandlerEarly(d3Event) || (0, _Visuals_common_eventBubblingUtil__WEBPACK_IMPORTED_MODULE_6__.q)(d3Event) || (0, 
                    _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.kW)(function(d) {
                        _this.bubbles && _this.bubbles.style("pointer-events", "all").attr("aria-label", _this.pointLabelText), 
                        _this.slices && _this.slices.style("pointer-events", "all").attr("aria-label", _this.pointLabelText), 
                        _this.shapes && _this.shapes.style("pointer-events", "all").attr("aria-label", _this.pointLabelText), 
                        _this.mapPointerEventsDisabled = !_this.slices, _this.addAriaLabelToSelection(d3.select(d3Event.target));
                        var dataPoint = (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.Xt)(d) ? d.data : d;
                        (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.c8)(dataPoint, selectionHandler);
                    });
                }).on("keydown.select", function() {
                    var d3Event = d3.event;
                    if (!_this.shouldExitHandlerEarly(d3Event)) {
                        var keyCode = d3Event.keyCode;
                        32 !== keyCode && 13 !== keyCode || (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.kW)(function(d) {
                            var dataPoint = (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.Xt)(d) ? d.data : d;
                            (0, _Visuals_common_interactivityUtils__WEBPACK_IMPORTED_MODULE_1__.c8)(dataPoint, selectionHandler);
                        }, !0);
                    }
                }, !0);
            }, MapBehavior.prototype.registerArrowKeyStopper = function(rootSelection) {
                $(rootSelection.node()).keydown(function(eventObj) {
                    (0, _VisualsCommon_Utility_keyUtils__WEBPACK_IMPORTED_MODULE_7__.Wl)(eventObj.keyCode) && (eventObj.stopPropagation && eventObj.stopPropagation(), 
                    eventObj.preventDefault && eventObj.preventDefault());
                });
            }, MapBehavior.prototype.shouldExitHandlerEarly = function(d3Event) {
                return d3.select(d3Event.target).classed(_Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__.Gs);
            }, MapBehavior.prototype.addAriaLabelToSelection = function(selection) {
                selection.attr("aria-label", function(d) {
                    return (0, _Visuals_common_tooltipUtils__WEBPACK_IMPORTED_MODULE_8__.X)(void 0 !== d.data ? d.data.tooltipInfo : d.tooltipInfo);
                });
            }, MapBehavior.prototype.setTabbableElements = function() {
                $(".bm_bottomRightOverlay a").attr("tabindex", 0);
            }, MapBehavior.prototype.setNonTabbableElements = function() {
                $(".ms-composite").children("div").attr("tabindex", -1), $(".bm_bottomLeftOverlay a").attr("tabindex", -1);
            }, MapBehavior.prototype.mapKeyboardAccessibility = function(host, controlEnabled) {
                var _this = this;
                if (this.root) {
                    var navBarSelection = this.root.select(_Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__.PN), plotAreaSelection = this.root.select(_Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__.Kp);
                    if (!navBarSelection.empty() && !this.root.selectAll(_Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__.qG).empty()) {
                        var isEdgeOrIE = _VisualsCommon_Utility_browserUtils__WEBPACK_IMPORTED_MODULE_4__.M.isInternetExplorerOrEdge();
                        navBarSelection.attr("tabindex", controlEnabled ? 0 : -1).attr("focusable", !!controlEnabled).attr("role", "region").attr("aria-label", host.getLocalizedString("Visual_AzureMapsNavigationControls")).attr("focus-nav-mode", "Hierarchy").attr("style", "position:absolute; inset: 4px 0px auto auto").classed(_Visuals_common_renderUtil__WEBPACK_IMPORTED_MODULE_5__.Pg, !isEdgeOrIE), 
                        navBarSelection.selectAll(_Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__.CL).attr("tabindex", controlEnabled ? 0 : -1).attr("focusable", "true"), 
                        navBarSelection.select(_Visuals_common_mapUtil__WEBPACK_IMPORTED_MODULE_2__.Kq).attr("tabindex", -1), 
                        $(navBarSelection.node()).one("focus", function() {
                            _this.setNonTabbableElements(), _this.setTabbableElements();
                        });
                    }
                    $(plotAreaSelection.node()).one("focus", function() {
                        _this.setNonTabbableElements(), _this.setTabbableElements();
                    }), this.setNonTabbableElements(), this.setTabbableElements();
                }
            }, MapBehavior;
        }();
    },
    81551: function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {
        __webpack_require__.d(__webpack_exports__, {
            E: function() {
                return Point;
            }
        });
        var Point = function() {
            return function(x, y) {
                this.x = x || 0, this.y = y || 0;
            };
        }();
    }
} ]);