"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["explore-ui-authoring"],{41606:function(ie,W,c){c.d(W,{x:function(){return t}});var A=c(47508),t=function(){function S(){}return S.getDefaultVisualPlugin=function(F){return F&&F.featureSwitches&&F.featureSwitches.pivotTableVisualEnabled?A.L.tableEx:A.L.table},S}()},55201:function(ie,W,c){function A(t,S){if(!t&&!S)return!0;if(!!t!=!!S||t.length!==S.length)return!1;for(var F=0,C=t.length;F<C;F++)if(!t[F].equals(S[F]))return!1;return!0}c.d(W,{L:function(){return A}})},32441:function(ie,W,c){c.d(W,{u:function(){return F}});var A=c(50423),t=c(18460),S=function(M,z,g,L,E){return{formattingSources:M,indicatorEnabled:z,mobileFormatting:g,disabledCards:L,disabledSlices:E}},F=function(){function C(){var M=this;this.mobileFormatting=!1,this.propertyChanged=new A.EventEmitter,this.outputArgs={propertyChanged:function(g){return M.propertyChanged.emit(g)}},this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="FormattingPaneComponentId"}return C.\u0275fac=function(z){return new(z||C)},C.\u0275cmp=A.\u0275\u0275defineComponent({type:C,selectors:[["formatting-pane-lazy"]],inputs:{formattingSources:"formattingSources",indicatorEnabled:"indicatorEnabled",mobileFormatting:"mobileFormatting",disabledCards:"disabledCards",disabledSlices:"disabledSlices"},outputs:{propertyChanged:"propertyChanged"},decls:1,vars:10,consts:[[3,"inputArgs","modulePath","outputArgs","componentId"]],template:function(z,g){1&z&&A.\u0275\u0275element(0,"pbi-lazy-load",0),2&z&&A.\u0275\u0275property("inputArgs",A.\u0275\u0275pureFunction5(4,S,g.formattingSources,g.indicatorEnabled,g.mobileFormatting,g.disabledCards,g.disabledSlices))("modulePath",g.modulePath)("outputArgs",g.outputArgs)("componentId",g.componentId)},dependencies:[t.R],encapsulation:2,changeDetection:0}),C}()},78633:function(ie,W,c){c.d(W,{a:function(){return F}});var A=c(50423),t=c(18460),S=function(M){return{colors:M}},F=function(){function C(){this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="GradientBarComponentId"}return C.\u0275fac=function(z){return new(z||C)},C.\u0275cmp=A.\u0275\u0275defineComponent({type:C,selectors:[["gradient-bar-lazy"]],inputs:{colors:"colors"},decls:1,vars:5,consts:[[3,"inputArgs","modulePath","componentId"]],template:function(z,g){1&z&&A.\u0275\u0275element(0,"pbi-lazy-load",0),2&z&&A.\u0275\u0275property("inputArgs",A.\u0275\u0275pureFunction1(3,S,g.colors))("modulePath",g.modulePath)("componentId",g.componentId)},dependencies:[t.R],encapsulation:2,changeDetection:0}),C}()},92278:function(ie,W,c){c.d(W,{I:function(){return F}});var A=c(50423),t=c(18460),S=function(M,z,g,L,E){return{toggle:M,ariaLabelledby:z,ariaDescribedby:g,toggleLabel:L,isDisabled:E}},F=function(){function C(){var M=this;this.onToggleChange=new A.EventEmitter,this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="ToggleSwitchModernComponentId",this.outputArgs={onToggleChange:function(g){return M.onToggleChange.emit(g)}}}return C.\u0275fac=function(z){return new(z||C)},C.\u0275cmp=A.\u0275\u0275defineComponent({type:C,selectors:[["toggle-switch-modern-lazy"]],inputs:{toggle:"toggle",ariaLabelledby:"ariaLabelledby",ariaDescribedby:"ariaDescribedby",toggleLabel:"toggleLabel",isDisabled:"isDisabled"},outputs:{onToggleChange:"onToggleChange"},decls:1,vars:10,consts:[[3,"inputArgs","modulePath","outputArgs","componentId"]],template:function(z,g){1&z&&A.\u0275\u0275element(0,"pbi-lazy-load",0),2&z&&A.\u0275\u0275property("inputArgs",A.\u0275\u0275pureFunction5(4,S,g.toggle,g.ariaLabelledby,g.ariaDescribedby,g.toggleLabel,g.isDisabled))("modulePath",g.modulePath)("outputArgs",g.outputArgs)("componentId",g.componentId)},dependencies:[t.R],encapsulation:2,changeDetection:0}),C}()},90094:function(ie,W,c){c.d(W,{l:function(){return F}});var A=c(50423),t=c(18460),S=function(M){return{warningMessage:M}},F=function(){function C(){this.modulePath="@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",this.componentId="WarningComponentId"}return C.\u0275fac=function(z){return new(z||C)},C.\u0275cmp=A.\u0275\u0275defineComponent({type:C,selectors:[["warning-eager"]],inputs:{warningMessage:"warningMessage"},decls:1,vars:5,consts:[[3,"inputArgs","modulePath","componentId"]],template:function(z,g){1&z&&A.\u0275\u0275element(0,"pbi-lazy-load",0),2&z&&A.\u0275\u0275property("inputArgs",A.\u0275\u0275pureFunction1(3,S,g.warningMessage))("modulePath",g.modulePath)("componentId",g.componentId)},dependencies:[t.R],encapsulation:2,changeDetection:0}),C}()},42101:function(ie,W,c){c.d(W,{p:function(){return Q}});var A=c(9844),M=(c(32441),c(78633),c(92278),c(90094),c(77476)),z=c(9398),g=c(76072),L=c(77906),E=c(50423),I={loadChildren:function(){return Promise.all([c.e(5),c.e("pane-formatting")]).then(c.bind(c,53150)).then(function(K){return K.PaneFormattingModule})}};g.E.addLazyLoadForLegacyMapping("@powerbi/ExploreUIAuthoring/lazy-modules/pane-formatting/pane-formatting.module#PaneFormattingModule",I.loadChildren);var D=[{path:"dummy-pane-formatting-lazy",loadChildren:I.loadChildren}],Q=function(){function H(){}return H.\u0275fac=function(X){return new(X||H)},H.\u0275mod=E.\u0275\u0275defineNgModule({type:H}),H.\u0275inj=E.\u0275\u0275defineInjector({imports:[M.CommonModule,A.j,L.N,z.Bz.forChild(D)]}),H}()},21302:function(ie,W,c){c.d(W,{Ol:function(){return F},mF:function(){return S},sn:function(){return t}});var A=c(50423),t={type:3,name:"showFormatPane"},S={type:3,name:"showPageFormatPane"},F=new A.InjectionToken("PropertyChangeIndicatorService")},53424:function(ie,W,c){c.r(W),c.d(W,{ExploreUIAuthoringModule:function(){return ds}});var A=c(86286),t=c(50423),S=c(77476),F=c(89961);function C(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"section",1),t.\u0275\u0275element(1,"visual-types-container-modern",4),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("visualContainer",e.visualContainer)("visualPluginFilter",e.nonPersonalVisualPluginFilter)("disableMoreOptionsIcon",!0)("visualConversionSource",e.visualConversionSource)}}var M=function(){function o(){}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["all-visual-selector"]],inputs:{visualContainer:"visualContainer",visualPluginFilter:"visualPluginFilter",showNonPersonalVisualizationPane$:"showNonPersonalVisualizationPane$",nonPersonalVisualPluginFilter:"nonPersonalVisualPluginFilter",visualConversionSource:"visualConversionSource"},decls:5,vars:6,consts:[[1,"allVisualizationsPicker","explorationContainer","newPaneColors"],[1,"modern-format-pane"],[1,"compact-visual-types",3,"visualContainer","visualPluginFilter","visualConversionSource"],["class","modern-format-pane",4,"ngIf"],[1,"withTopDivider","compact-visual-types",3,"visualContainer","visualPluginFilter","disableMoreOptionsIcon","visualConversionSource"]],template:function(e,n){1&e&&(t.\u0275\u0275elementStart(0,"div",0)(1,"section",1),t.\u0275\u0275element(2,"visual-types-container-modern",2),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(3,C,2,4,"section",3),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275elementEnd()),2&e&&(t.\u0275\u0275advance(2),t.\u0275\u0275property("visualContainer",n.visualContainer)("visualPluginFilter",n.visualPluginFilter)("visualConversionSource",n.visualConversionSource),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(4,4,n.showNonPersonalVisualizationPane$)))},dependencies:[S.NgIf,F.r,S.AsyncPipe],styles:[".allVisualizationsPicker[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),o}(),z=function(){function o(i){this.visualSelectorInput=i,this.visualContainer=i.visualContainer,this.visualPluginFilter=i.visualPluginFilter,this.nonPersonalVisualPluginFilter=i.nonPersonalVisualPluginFilter,this.showNonPersonalVisualizationPane$=i.showNonPersonalVisualizationPane$}return o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275directiveInject(A.M))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["all-visual-selector-flyout"]],decls:2,vars:4,consts:[[1,"allVisualSelectorContainer"],[1,"white-background",3,"visualContainer","visualPluginFilter","nonPersonalVisualPluginFilter","showNonPersonalVisualizationPane$"]],template:function(e,n){1&e&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275element(1,"all-visual-selector",1),t.\u0275\u0275elementEnd()),2&e&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("visualContainer",n.visualContainer)("visualPluginFilter",n.visualPluginFilter)("nonPersonalVisualPluginFilter",n.nonPersonalVisualPluginFilter)("showNonPersonalVisualizationPane$",n.showNonPersonalVisualizationPane$))},dependencies:[M],styles:["[_nghost-%COMP%]{width:100%}.allVisualSelectorContainer[_ngcontent-%COMP%]{padding:3px 0;background:var(--fluent-theme-white-color);border:1px solid var(--gray-110);border-top:none}"]}),o}(),g=c(81337),L=c(35510),E=c(63057),I=c(83317),D=c(59973),x=c(48787),Q=c(33754),H=c(78778),K=c(73221),X=c(25512),q=c(86940),k=c(8590),N=c(3579),R=c(60661),G=c(61903),ne=c(93573),J=c(47508),T=c(62458),Z=c(26898),ue=c(54952),te=c(39503),oe=c(11494),de=c(83008),Be=c(66977),le=c(9380),_e=c(28894),ce=c(65181),Zi=c(69071),Pe=c(29866),fe=c(10861),Rt=c(34518),Xi=c(65188),jt=c(92278),tt=c(36858),ht=c(85102),Yi=["visualPicker"],qi=["allVisualToggleButton"],en=["suggestedVisualTypeElement"];function tn(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"label",8),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate(e.label)}}var nn=function(i,e){return{selected:i,notSelected:e}};function rn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",14,15),t.\u0275\u0275listener("click",function(){var d=t.\u0275\u0275restoreView(e).$implicit,v=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(v.updateVisualType(d.type))})("keydown",function(u){var v=t.\u0275\u0275restoreView(e).index,p=t.\u0275\u0275nextContext(2).ngIf,f=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(f.onSuggestedVisualTypeKeydown(u,v,p.suggestions.length))}),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275element(3,"svg-use-symbol",16),t.\u0275\u0275elementEnd()}if(2&o){var n=i.$implicit,r=i.index,a=t.\u0275\u0275nextContext(2).ngIf,s=t.\u0275\u0275nextContext();t.\u0275\u0275property("tabindex",r===t.\u0275\u0275pipeBind1(2,8,s.suggestedVisualTypeFocusIndex$)?0:-1)("ngClass",t.\u0275\u0275pureFunction2(10,nn,n.type===a.selectedInfo.type,n.type!==a.selectedInfo.type))("disabled",!s.allowChangeVisualType)("ngStyle",n.imageStyles)("pbiTooltip",n.tooltip),t.\u0275\u0275attribute("aria-colindex",r),t.\u0275\u0275advance(3),t.\u0275\u0275property("sheet",n.iconSheet)("symbolId",n.symbol)}}var on=function(i,e){return{"pbi-glyph-chevronupsmall":i,"pbi-glyph-chevrondownsmall":e}};function an(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",17,18),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(e);var a=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(a.toggleAllVisualState())}),t.\u0275\u0275pipe(2,"localize"),t.\u0275\u0275pipe(3,"localize"),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275nextContext(3);t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction2(9,on,n.showAllVisualizations,!n.showAllVisualizations))("pbiTooltip",t.\u0275\u0275pipeBind1(3,7,n.showAllVisualizations?"Chevron_CollapseDescription":"Chevron_ExpandDescription"))("disabled",!n.allowChangeVisualType),t.\u0275\u0275attribute("aria-expanded",n.showAllVisualizations)("aria-label",t.\u0275\u0275pipeBind1(2,5,"Show_All_Visual_Types"))}}var sn=function(i){return{withAllVisualsSelector:i}};function ln(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"div",9)(1,"div",10)(2,"div",11),t.\u0275\u0275template(3,rn,4,13,"button",12),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(4,an,4,12,"button",13),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext().ngIf,n=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(4,sn,n.showAllVisualizations&&!n.allVisualsPickerInFlyout||n.alwaysExpanded)),t.\u0275\u0275advance(1),t.\u0275\u0275attribute("aria-colcount",e.suggestions.length),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngForOf",e.suggestions),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!n.alwaysExpanded)}}function cn(o,i){if(1&o&&t.\u0275\u0275element(0,"all-visual-selector",19),2&o){var e=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("visualContainer",e.visualContainer)("visualPluginFilter",e.visualPluginFilter)("showNonPersonalVisualizationPane$",e.showNonPersonalVisualizationPane$)("nonPersonalVisualPluginFilter",e.nonPersonalVisualizationPaneFilter)("visualConversionSource",e.host)}}var un=function(i){return{isDisabled:i}};function dn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",20)(1,"toggle-switch-modern-lazy",21),t.\u0275\u0275listener("onToggleChange",function(s){t.\u0275\u0275restoreView(e);var l=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(l.updateAutoVisualState(s))}),t.\u0275\u0275elementEnd()()}if(2&o){var n=t.\u0275\u0275nextContext().ngIf,r=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(5,un,!r.allowChangeVisualType)),t.\u0275\u0275advance(1),t.\u0275\u0275property("toggle",n.selectedInfo.isAutoVisual)("isDisabled",!r.allowChangeVisualType)("pbiTooltip",r.tooltip)("toggleLabel",r.autoModeToggleLabel)}}var pn=function(i,e){return{disabledVisualPicker:i,withSuggestions:e}};function vn(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"div",1),t.\u0275\u0275template(1,tn,2,1,"label",2),t.\u0275\u0275elementStart(2,"div",3,4),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275template(5,ln,5,6,"div",5),t.\u0275\u0275template(6,cn,1,5,"all-visual-selector",6),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(7,dn,2,7,"div",7),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",e.label),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction2(7,pn,t.\u0275\u0275pipeBind1(4,5,e.disabled$),!e.noSuggestions)),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",!e.noSuggestions),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",e.showAllVisualizations&&!e.allVisualsPickerInFlyout||e.alwaysExpanded),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!e.noAutoToggleSwitch)}}var Wt=function(o){function i(e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V){var P=o.call(this)||this;return P.conceptualSchemaProxy=e,P.contextActivityService=n,P.explorationNavigation=r,P.eventBridge=a,P.dataSources=s,P.featureSwitchService=l,P.injector=u,P.lazyScoped=d,P.localizationService=v,P.overlay=p,P.trustedVisual=f,P.visualAuthoring=h,P.visualPaneSettingsService=m,P.visualPluginOperationsService=b,P.visualPlugin=y,P.visualTypesService=V,P.numberOfSuggestionsToShow=5,P.onVisualTypeUpdated=new t.EventEmitter,P.showNonPersonalVisualizationPane$=new L.X(!1),P.isInitialized$=new L.X(!1),P.suggestedVisualTypeFocusIndex$=new L.X(void 0),P.visualViewModel$=new L.X(void 0),P.isInitialFocusSet=!1,P.visualPluginFilter=function(O,w,j){return!(P.withPerspectives&&P.visualPluginOperationsService.isQnaVisual(O.name)||_.isFunction(P.isVisualExcluded)&&P.isVisualExcluded(O.name))&&(0,G.CL)(O,w,j)},P.nonPersonalVisualizationPaneFilter=function(O,w,j){return!(0,G.CL)(O,w,j)},P}return(0,g.ZT)(i,o),Object.defineProperty(i.prototype,"_suggestedVisualTypeElementRefs",{set:function(n){this.suggestedVisualTypeElementRefs=n?.toArray()||[],!this.isInitialFocusSet&&null!=this.suggestedVisualTypeFocusIndex$.value&&this.setFocusAfterInitialization&&(this.setInitialFocus(),this.isInitialFocusSet=!0)},enumerable:!1,configurable:!0}),i.prototype.ngOnInit=function(){var e=this;this.lazyScoped.get("authoringVisualRecommendationInterop").then(function(n){e.recommendationInterop=n,e.visualTypesService.initialize(),e.isInitialized$.next(!0)}),this.visualTypesService.availableVisualTypes$.pipe((0,I.R)(this.onDestroy$)).subscribe(function(n){e.availableVisualTypes=n}),this.allowChangeVisualType=this.visualContainer?this.visualPluginOperationsService.canConvertVisual(this.visualContainer):this.allowSelectVisualTypeWhenNoVisual,this.isInitialized$.pipe((0,I.R)(this.onDestroy$),(0,D.h)(function(n){return!!n})).subscribe(function(){e.updateVisualViewModel(),e.updateNonPersonalVisualState()}),(0,E.T)(this.changes$("visualContainer"),this.eventBridge.on(k.KD7),this.eventBridge.on(k.jCS),this.eventBridge.on(k.D1A),this.eventBridge.on(k.Udu)).pipe((0,I.R)(this.onDestroy$)).subscribe(function(){e.isInitialized$.value&&(e.updateVisualViewModel(),e.updateNonPersonalVisualState())})},i.prototype.onResize=function(){var e;null===(e=this.allVisualSelectorOverlayRef)||void 0===e||e.close()},i.prototype.toggleAllVisualState=function(){this.showAllVisualizations=!this.showAllVisualizations,this.allVisualsPickerInFlyout&&this.showHideVisualPickerFlyout(this.showAllVisualizations)},i.prototype.updateAutoVisualState=function(e){this.visualAuthoring.convert(this.visualContainer,this.dataSources.get(),e?void 0:(0,N.s)(this.visualContainer),this.explorationNavigation.getCurrentSection())},i.prototype.updateVisualType=function(e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,s,l,u;return(0,g.Jh)(this,function(d){switch(d.label){case 0:if(!this.visualContainer)return[3,5];n=this.contextActivityService.createActivity({name:"SelectVisualRecommendation",visualName:this.visualContainer.name,data:{visualTypePicked:e,source:"Skittle",skittleType:"Build"}}),d.label=1;case 1:return d.trys.push([1,3,,4]),r=(0,R.II)(this.visualContainer),[4,this.visualAuthoring.convert(this.visualContainer,this.dataSources.get(),e,this.explorationNavigation.getCurrentSection(),r,"Skittle",n)];case 2:return d.sent()?(this.onVisualTypeUpdated.emit(e),n.resolve()):n.reject(new Error("cannot convert to recommended type")),[3,4];case 3:throw s=d.sent(),n.reject(s),s;case 4:return[3,6];case 5:this.allowSelectVisualTypeWhenNoVisual&&(l=this.visualPlugin.getPlugin(e))&&(u=_.find(this.availableVisualTypes.types,function(v){return v.plugin.name===l.name}))&&this.visualTypesService.performSelectVisualTypeAction(u,this.host),d.label=6;case 6:return[2]}})})},i.prototype.onSuggestedVisualTypeKeydown=function(e,n,r){"ArrowRight"===e.key||"ArrowDown"===e.key?n+1<r&&(this.suggestedVisualTypeFocusIndex$.next(n+1),this.suggestedVisualTypeElementRefs[n+1].nativeElement.focus()):("ArrowLeft"===e.key||"ArrowUp"===e.key)&&n-1>=0&&(this.suggestedVisualTypeFocusIndex$.next(n-1),this.suggestedVisualTypeElementRefs[n-1].nativeElement.focus())},i.prototype.showHideVisualPickerFlyout=function(e){e&&!this.allVisualSelectorOverlayRef&&this.showAllVisualFlyout(),!e&&this.allVisualSelectorOverlayRef&&(this.allVisualSelectorOverlayRef.close(),this.allVisualSelectorOverlayRef=void 0)},i.prototype.showAllVisualFlyout=function(){var e=this;this.allVisualSelectorOverlayRef=this.overlay.open({component:z,data:{visualContainer:this.visualContainer,visualPluginFilter:this.visualPluginFilter,showNonPersonalVisualizationPane$:this.showNonPersonalVisualizationPane$,nonPersonalVisualPluginFilter:this.nonPersonalVisualizationPaneFilter},options:{width:this.visualPickerRef.nativeElement.offsetWidth,positionStrategy:this.overlay.position().flexibleConnectedTo(this.visualPickerRef).withPositions([(0,X.Oq)()]).withFlexibleDimensions(!0).withGrowAfterOpen(!0),hasBackdrop:!0,backdropClass:q.L,disposeOnNavigation:!0},injector:this.injector,closeOnBackdropClick:!0,forwardClickDisabledElements:[this.allVisualToggleButtonRef.nativeElement]}),this.allVisualSelectorOverlayRef.onClose.pipe((0,x.q)(1)).subscribe(function(){e.allVisualSelectorOverlayRef=void 0,e.showAllVisualizations=!1})},i.prototype.setInitialFocus=function(){var n,r,e=this;this.suggestedVisualTypeFocusIndex$.value>=0&&(T.fF.assert(function(){return e.suggestedVisualTypeFocusIndex$.value<_.size(e.suggestedVisualTypeElementRefs)},"suggested type elementRefs not updated yet"),null===(r=null===(n=this.suggestedVisualTypeElementRefs[this.suggestedVisualTypeFocusIndex$.value])||void 0===n?void 0:n.nativeElement)||void 0===r||r.focus())},i.prototype.updateVisualViewModel=function(){var e;return(0,g.mG)(this,void 0,void 0,function(){var n,r,a,s,l,u,d,v,p,f,h=this;return(0,g.Jh)(this,function(m){switch(m.label){case 0:return n=(0,R.Xf)(this.visualContainer),_.isEmpty(null===(e=n?.defn)||void 0===e?void 0:e.select())?[3,2]:[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:a=m.sent(),r=this.recommendationInterop.getRecommendedVisualTypes(this.visualContainer,a,this.numberOfSuggestionsToShow,this.isVisualExcluded),m.label=2;case 2:return _.isEmpty(r)&&(r=[J.L.columnChart.name,J.L.barChart.name,J.L.lineChart.name,J.L.tableEx.name,J.L.card.name]),(0,R.II)(this.visualContainer)||(s=(0,N.s)(this.visualContainer),(l=_.indexOf(r,s))>=0&&r.splice(l,1),r.unshift(s),_.size(r)>this.numberOfSuggestionsToShow&&r.pop()),u=_.map(r,function(b){var y=h.visualPlugin.getPlugin(b);if(y){var V=(0,ne.tl)(y,h.trustedVisual,h.localizationService,void 0);return{type:b,symbol:V.class,iconSheet:"visualizationPaneIcons",imageStyles:h.getVisualImageStyles(y),tooltip:V.title}}}),d=_.filter(u,function(b){return null!=b}),v=(0,N.s)(this.visualContainer),p=(0,R.II)(this.visualContainer),f={type:v,isAutoVisual:p},this.withPerspectives&&this.visualAuthoring.setPresentationChangesApplied(!0),this.visualViewModel$.next({selectedInfo:f,suggestions:d}),this.suggestedVisualTypeFocusIndex$.next(Math.min(0,d.length-1)),[2]}})})},i.prototype.getVisualImageStyles=function(e){return e.iconUrl&&(e.developerModeVisual||e.custom&&!this.trustedVisual.isAutomaticallyImportedVisual(e.name))?{"background-image":e.iconUrl,"background-repeat":"round","background-clip":"content-box",padding:"1px"}:null},i.prototype.updateNonPersonalVisualState=function(){var e=this;this.showNonPersonalVisualizationPane$.next(_.some(this.visualPlugin.getConvertibleVisuals(),function(n){return null!=n&&!(0,G.CL)(n,e.featureSwitchService,e.visualPaneSettingsService)}))},i.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(Z.i),t.\u0275\u0275directiveInject(ue.r),t.\u0275\u0275directiveInject(te.z),t.\u0275\u0275directiveInject(oe.J),t.\u0275\u0275directiveInject(de.D),t.\u0275\u0275directiveInject(le.vZ),t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(_e.H),t.\u0275\u0275directiveInject(ce.o),t.\u0275\u0275directiveInject(q._),t.\u0275\u0275directiveInject(Zi.t),t.\u0275\u0275directiveInject(fe.$8),t.\u0275\u0275directiveInject(Rt.R),t.\u0275\u0275directiveInject(Be.f),t.\u0275\u0275directiveInject(Pe.D),t.\u0275\u0275directiveInject(Q.V))},i.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["auto-visual"]],viewQuery:function(n,r){if(1&n&&(t.\u0275\u0275viewQuery(Yi,5,t.ElementRef),t.\u0275\u0275viewQuery(qi,5,t.ElementRef),t.\u0275\u0275viewQuery(en,5,t.ElementRef)),2&n){var a=void 0;t.\u0275\u0275queryRefresh(a=t.\u0275\u0275loadQuery())&&(r.visualPickerRef=a.first),t.\u0275\u0275queryRefresh(a=t.\u0275\u0275loadQuery())&&(r.allVisualToggleButtonRef=a.first),t.\u0275\u0275queryRefresh(a=t.\u0275\u0275loadQuery())&&(r._suggestedVisualTypeElementRefs=a)}},hostBindings:function(n,r){1&n&&t.\u0275\u0275listener("resize",function(){return r.onResize()},!1,t.\u0275\u0275resolveWindow)},inputs:{visualContainer:"visualContainer",label:"label",autoModeToggleLabel:"autoModeToggleLabel",withPerspectives:"withPerspectives",tooltip:"tooltip",numberOfSuggestionsToShow:"numberOfSuggestionsToShow",setFocusAfterInitialization:"setFocusAfterInitialization",noAutoToggleSwitch:"noAutoToggleSwitch",noSuggestions:"noSuggestions",allVisualsPickerInFlyout:"allVisualsPickerInFlyout",disabled$:"disabled$",host:"host",alwaysExpanded:"alwaysExpanded",allowSelectVisualTypeWhenNoVisual:"allowSelectVisualTypeWhenNoVisual",isVisualExcluded:"isVisualExcluded"},outputs:{onVisualTypeUpdated:"onVisualTypeUpdated"},features:[t.\u0275\u0275ProvidersFeature([Q.V,{provide:Q.B,useValue:H.Ys}]),t.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","visualPickerContainer",4,"ngIf"],[1,"visualPickerContainer"],["id","visualPickerTitle",4,"ngIf"],[1,"visualPicker",3,"ngClass"],["visualPicker",""],["class","suggestionsContainer",3,"ngClass",4,"ngIf"],["class","allVisualSelector white-background",3,"visualContainer","visualPluginFilter","showNonPersonalVisualizationPane$","nonPersonalVisualPluginFilter","visualConversionSource",4,"ngIf"],["class","autoVisualContainer",3,"ngClass",4,"ngIf"],["id","visualPickerTitle"],[1,"suggestionsContainer",3,"ngClass"],["id","suggestedVisualTypesContainer","aria-labelledby","visualPickerTitle","role","grid","aria-rowcount","1",1,"suggestions"],["role","row",1,"suggestionsRow"],["class","visualSymbol","role","gridcell",3,"tabindex","ngClass","disabled","ngStyle","pbiTooltip","click","keydown",4,"ngFor","ngForOf"],["class","glyphicon glyph-mini toggleAllVisualsButton",3,"ngClass","pbiTooltip","disabled","click",4,"ngIf"],["role","gridcell",1,"visualSymbol",3,"tabindex","ngClass","disabled","ngStyle","pbiTooltip","click","keydown"],["suggestedVisualTypeElement",""],[3,"sheet","symbolId"],[1,"glyphicon","glyph-mini","toggleAllVisualsButton",3,"ngClass","pbiTooltip","disabled","click"],["allVisualToggleButton",""],[1,"allVisualSelector","white-background",3,"visualContainer","visualPluginFilter","showNonPersonalVisualizationPane$","nonPersonalVisualPluginFilter","visualConversionSource"],[1,"autoVisualContainer",3,"ngClass"],[3,"toggle","isDisabled","pbiTooltip","toggleLabel","onToggleChange"]],template:function(n,r){1&n&&(t.\u0275\u0275template(0,vn,8,10,"div",0),t.\u0275\u0275pipe(1,"async")),2&n&&t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(1,1,r.visualViewModel$))},dependencies:[S.NgClass,S.NgForOf,S.NgIf,S.NgStyle,Xi.k,jt.I,tt.V,M,S.AsyncPipe,ht.F],styles:['.visualPickerContainer[_ngcontent-%COMP%]{--visual-symbol-selected-background-color: var(--gray-40);--visual-symbol-selected-border-color: var(--gray-130)}  [data-legacy-theming=false] .visualPickerContainer{--visual-symbol-selected-background-color: var(--colorNeutralBackground1);--visual-symbol-selected-border-color: var(--colorNeutralStroke1)}.visualPickerContainer[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;display:block;margin-bottom:4px}.visualPickerContainer[_ngcontent-%COMP%]   .disabledVisualPicker[_ngcontent-%COMP%]{pointer-events:none;opacity:.4}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]{display:flex;flex-direction:column;background:var(--fluent-theme-white-color, #FFF);padding:3px;border:1px solid var(--gray-110);border-radius:2px}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsRow[_ngcontent-%COMP%]{display:flex;align-items:center}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:0}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer.withAllVisualsSelector[_ngcontent-%COMP%]{margin-bottom:3px}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]{display:flex;flex:1}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol[_ngcontent-%COMP%]{height:24px;width:24px;padding:0;box-sizing:border-box;border:none;background-color:transparent;display:flex;align-items:center;justify-content:center}html:not([dir="rtl"])[_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol[_ngcontent-%COMP%]{margin-right:2px}html[dir="rtl"][_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol[_ngcontent-%COMP%]{margin-left:2px}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol[_ngcontent-%COMP%]   svg-use-symbol[_ngcontent-%COMP%]{height:20px;width:20px}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol.selected[_ngcontent-%COMP%]{background-color:var(--visual-symbol-selected-background-color);border:1px solid var(--visual-symbol-selected-border-color)}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .visualSymbol.notSelected[disabled][_ngcontent-%COMP%]{opacity:.4}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .toggleAllVisualsButton[_ngcontent-%COMP%]{border:none;background-color:transparent;border-left:1px solid var(--gray-110);width:24px;box-sizing:border-box}html:not([dir="rtl"])[_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .toggleAllVisualsButton[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .toggleAllVisualsButton[_ngcontent-%COMP%]{padding:0 2px 0 6px}html[dir="rtl"][_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .toggleAllVisualsButton[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .toggleAllVisualsButton[_ngcontent-%COMP%]{padding:0 6px 0 2px}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker.withSuggestions[_ngcontent-%COMP%]   all-visual-selector[_ngcontent-%COMP%]{padding-top:3px;border-top:1px solid var(--gray-110)}.visualPickerContainer[_ngcontent-%COMP%]   .visualPicker[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{color:var(--gray-90)}.visualPickerContainer[_ngcontent-%COMP%]   .autoVisualContainer[_ngcontent-%COMP%]{margin-bottom:2px;margin-top:2px}']}),i}(K.w),Gt=c(64824),gn=c(80649),hn=c(73425),ft=c(42587),it=c(76312),Ke=c(73795),ve=c(46544),$t=c(17653),Ce=c(74082),Ut=c(28199),Je=c(13702),fn=c(5862),me=c(72262),mt=c(50702),yt=c(48145),Ct=c(82214),mn=c(77919),yn=c(1240);function Cn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",10)(1,"div",11),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"toggle-switch-modern-lazy",12),t.\u0275\u0275listener("onToggleChange",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.crossReportDrillthroughAdapter.fn(a))}),t.\u0275\u0275elementEnd()()}if(2&o){var n=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(n.viewModel.crossReportDrillthroughToggle.displayName),t.\u0275\u0275advance(1),t.\u0275\u0275property("ariaLabelledby","cross-report-toggle-id")("toggle",n.viewModel.crossReportDrillthroughToggle.value)("isDisabled",n.viewModel.crossReportDrillthroughToggle.isDisabled)}}function bn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",10)(1,"div",13),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"toggle-switch-modern-lazy",12),t.\u0275\u0275listener("onToggleChange",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.filterPassingModeAdapter.fn(a))}),t.\u0275\u0275elementEnd()()}if(2&o){var n=t.\u0275\u0275nextContext();t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(n.viewModel.filterPassingModeToggle.displayName),t.\u0275\u0275advance(1),t.\u0275\u0275property("ariaLabelledby","keep-all-toggle-id")("toggle",n.viewModel.filterPassingModeToggle.value)("isDisabled",n.viewModel.filterPassingModeToggle.isDisabled)}}function Pn(o,i){1&o&&t.\u0275\u0275element(0,"filter",14),2&o&&t.\u0275\u0275property("viewModel",i.$implicit)}function Sn(o,i){1&o&&t.\u0275\u0275element(0,"filter",14),2&o&&t.\u0275\u0275property("viewModel",i.$implicit)}var xn=function(){function o(){}return o.prototype.transform=function(i){return i&&_.filter(i,function(e){return e&&e.contract&&!!e.contract.isTransient})},o.\u0275fac=function(e){return new(e||o)},o.\u0275pipe=t.\u0275\u0275definePipe({name:"isTransientFilter",type:o,pure:!1}),o}(),Mn=function(){function o(){}return o.prototype.transform=function(i){return i&&_.filter(i,function(e){return e&&e.contract&&!e.contract.isTransient})},o.\u0275fac=function(e){return new(e||o)},o.\u0275pipe=t.\u0275\u0275definePipe({name:"isNonTransientFilter",type:o,pure:!1}),o}(),bt=function(o){function i(e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V,P){var O=o.call(this)||this;return O.aggrOps=e,O.conceptualSchemaProxy=n,O.dataSources=r,O.displayNameService=a,O.dragDataService=s,O.elementRef=l,O.eventBridge=u,O.explorationCapabilities=d,O.explorationNavigation=v,O.featureSwitchService=p,O.lazyScoped=f,O.localizationService=h,O.scriptVisuals=m,O.selection=b,O.telemetryService=y,O.visualAuthoring=V,O.visualPlugin=P,O.useModernFormatPane=O.featureSwitchService.featureSwitches.useModernFormatPane,O.dropActionHandler=function(w){return O.getDropAction(w)},O}return(0,g.ZT)(i,o),i.prototype.ngOnInit=function(){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r=this;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return e=this.explorationNavigation.getCurrentSection(),n=ft.j(e?.type,this.localizationService),this.isDestroyed=!1,this.viewModel={drillthroughFilters:[],filterPassingModeToggle:{name:"keepAllFilters",displayName:n.keepAllFiltersLabel,value:!1,isDisabled:!1,tooltip:n.keepAllFiltersTooltip,type:{bool:!0},show:!0,placeholder:"",isValid:!0},crossReportDrillthroughToggle:{name:"crossReportDrillthrough",displayName:n.crossReportDrillthroughLabel,value:!1,isDisabled:!1,tooltip:n.crossReportDrillthroughTooltip,type:{bool:!0},show:!1,placeholder:"",isValid:!0},resources:n},this.filterPassingModeAdapter=this.createEventAdapter(),this.crossReportDrillthroughAdapter=this.createEventAdapter(),this.filterPassingModeAdapter.$.pipe((0,$t.b)(function(s){return r.viewModel.filterPassingModeToggle.value=s})).subscribe(function(){return r.onFilterPassingModeToggleChanged()}),this.crossReportDrillthroughAdapter.$.pipe((0,$t.b)(function(s){return r.viewModel.crossReportDrillthroughToggle.value=s})).subscribe(function(){return r.onCrossReportDrillthroughToggleChanged()}),this.dropConfig={accept:"field"},this.onDestroy$.subscribe(function(){r.subscriptionManager&&r.subscriptionManager.unsubscribeAll(),r.isDestroyed=!0}),[4,this.createDrillthroughFilters()];case 1:return a.sent(),this.isDestroyed||(this.subscriptionManager=this.eventBridge.createChannelSubscriptionManager().subscribe(k.Tuj,function(s,l){return r.onFilterContainerChanged(l)}).subscribe(k.yVh,function(){return r.onSectionChanged()}).subscribe(k.CCe,function(){return r.onModelChanged()}).subscribe(k.wAN,function(){return r.onCanvasChanged()}).subscribe(k.LE3,function(){return r.onExplorationLoaded()}).subscribe(k.mke,function(s,l){return r.onSectionFiltersContainerChanged(l)}),this.checkAndSetToggle(),(0,it.$o)(this.elementRef.nativeElement,function(s,l){return r.dropDrillthroughFilterFromField(l)})),[2]}})})},i.prototype.getDropAction=function(e){var n=this.dragDataService.getDragContext();return n&&n.field&&this.isSupportedDrillthroughFilterExpr(n.field)?Promise.resolve(3):Promise.resolve(0)},i.prototype.dropDrillthroughFilter=function(){var e=this.dragDataService.getDragContext();!e||!e.field||this.dropDrillthroughFilterFromField(e.field)},i.prototype.dropDrillthroughFilterFromField=function(e){var n=this.explorationNavigation.getCurrentSection();T.fF.assertValue(n,"No section"),(0,Ke.uE)(1,n,!0,this.dataSources,e,this.visualAuthoring,!0),this.checkAndSetToggle()},i.prototype.getFilterPaneUtilServices=function(){return{aggrOps:this.aggrOps,conceptualSchemaProxy:this.conceptualSchemaProxy,dataSources:this.dataSources,displayNameService:this.displayNameService,eventBridge:this.eventBridge,explorationCapabilities:this.explorationCapabilities,explorationNavigation:this.explorationNavigation,featureSwitchService:this.featureSwitchService,localizationService:this.localizationService,scriptVisuals:this.scriptVisuals,selection:this.selection,telemetryService:this.telemetryService,visualAuthoring:this.visualAuthoring,visualPlugin:this.visualPlugin}},i.prototype.getKeepAllFiltersTooltipConfig=function(){var e=this.viewModel.filterPassingModeToggle;return{tooltipTitle:e.displayName,tooltipDescription:e.tooltip}},i.prototype.getCrossReportDrillthroughTooltipConfig=function(){var e=this.viewModel.crossReportDrillthroughToggle;return{tooltipTitle:e.displayName,tooltipDescription:e.tooltip}},i.prototype.getPaneTitleTooltipConfig=function(){var e=this.viewModel.resources;return{tooltipTitle:e.paneTitle,tooltipDescription:e.paneTitleTooltip}},i.prototype.onFilterPassingModeToggleChanged=function(){return(0,g.mG)(this,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return e=this.explorationNavigation.getCurrentSection(),n=this.explorationNavigation.getCurrentExploration(),[4,this.lazyScoped.get("explorationAuthoring")];case 1:return s.sent().setDrillthroughFilterPassingMode(n,e,this.viewModel.filterPassingModeToggle.value),[2]}})})},i.prototype.onCrossReportDrillthroughToggleChanged=function(){return(0,g.mG)(this,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return e=this.explorationNavigation.getCurrentSection(),n=this.explorationNavigation.getCurrentExploration(),[4,this.lazyScoped.get("explorationAuthoring")];case 1:return s.sent().setCrossReportDrillthrough(n,e,this.viewModel.crossReportDrillthroughToggle.value),[2]}})})},i.prototype.onSectionChanged=function(){var e=this.explorationNavigation.getCurrentSection();T.fF.assertValue(e,"section undefined in onSectionChanged"),this.viewModel.resources=ft.j(e.type,this.localizationService),this.checkAndSetToggle()},i.prototype.onModelChanged=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,this.createDrillthroughFilters()];case 1:return e.sent(),this.checkAndSetToggle(),[2]}})})},i.prototype.onCanvasChanged=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,this.createDrillthroughFilters()];case 1:return e.sent(),this.checkAndSetToggle(),[2]}})})},i.prototype.onExplorationLoaded=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,this.createDrillthroughFilters()];case 1:return e.sent(),this.checkAndSetToggle(),[2]}})})},i.prototype.onFilterContainerChanged=function(e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,a,s;return(0,g.Jh)(this,function(l){switch(l.label){case 0:return n=this.viewModel.drillthroughFilters,r=this.getFilterPaneUtilServices(),(0,Ke.Rh)(r,1,n,e),e.filter&&5===e.filter.howCreated?(a=this.explorationNavigation.getCurrentExploration(),[4,(0,Ke.PJ)(this.dataSources,this.conceptualSchemaProxy)]):[3,2];case 1:s=l.sent(),(0,Ke.Z)(e,n,a,r,s),l.label=2;case 2:return this.checkAndSetToggle(),[2]}})})},i.prototype.isSupportedDrillthroughFilterExpr=function(e){return(0,Ce.kb)(e)||(0,Ce.t3)(e)||(0,Ce.ez)(e)||(0,Ce.wD)(e)},i.prototype.onSectionFiltersContainerChanged=function(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(n){switch(n.label){case 0:return e.container!==this.explorationNavigation.getCurrentSection()?[3,2]:[4,this.createDrillthroughFilters()];case 1:n.sent(),this.checkAndSetToggle(),n.label=2;case 2:return[2]}})})},i.prototype.createDrillthroughFilters=function(){return(0,g.mG)(this,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return e=this.getFilterPaneUtilServices(),n=this.viewModel,[4,(0,Ke.JN)(e,5)];case 1:return n.drillthroughFilters=r.sent(),[2]}})})},i.prototype.checkAndSetToggle=function(){var e,n=this.explorationNavigation.getCurrentSection(),r=this.explorationNavigation.getCurrentExploration(),s=ft.F(r,n,this.viewModel.resources,!0),l=(e=this.viewModel).filterPassingModeToggle,u=e.crossReportDrillthroughToggle;l.isDisabled=s.keepAllFilters.disabled,l.value=s.keepAllFilters.value,l.tooltip=s.keepAllFilters.tooltip,u.show=s.crossReportDrillthrough.show,u.isDisabled=s.crossReportDrillthrough.disabled,u.value=s.crossReportDrillthrough.value},i.prototype.trackByFn=function(e,n){return n?.id},i.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(Ut.C),t.\u0275\u0275directiveInject(Z.i),t.\u0275\u0275directiveInject(de.D),t.\u0275\u0275directiveInject(Je.O),t.\u0275\u0275directiveInject(mt.x),t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(oe.J),t.\u0275\u0275directiveInject(yt.U),t.\u0275\u0275directiveInject(te.z),t.\u0275\u0275directiveInject(le.vZ),t.\u0275\u0275directiveInject(_e.H),t.\u0275\u0275directiveInject(ce.o),t.\u0275\u0275directiveInject(fn.k),t.\u0275\u0275directiveInject(me.z),t.\u0275\u0275directiveInject(ve.y0),t.\u0275\u0275directiveInject(fe.$8),t.\u0275\u0275directiveInject(Pe.D))},i.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["drillthrough-pane"]],features:[t.\u0275\u0275InheritDefinitionFeature],decls:18,vars:19,consts:[[1,"sectionHeader","drillthroughSectionHeader"],[1,"sectionTitle","sidePaneTitle","unselectable","largeFontSize",3,"pbi-tooltip"],[1,"drillthroughPane","filterPane","filterPaneClassic","propertyPaneContents"],[3,"pbi-tooltip"],["class","toggle-container",4,"ngIf"],[1,"cards",3,"drop","dropAction","dropHandler"],[1,"linkFieldFilters"],["dataAutomationType","filterCard",3,"viewModel",4,"ngFor","ngForOf","ngForTrackBy"],[1,"transientFilters"],[1,"unselectable","trimmedTextWithEllipsis",3,"ngClass"],[1,"toggle-container"],["id","cross-report-toggle-id",1,"toggle-text"],[3,"ariaLabelledby","toggle","isDisabled","onToggleChange"],["id","keep-all-toggle-id",1,"toggle-text"],["dataAutomationType","filterCard",3,"viewModel"]],template:function(n,r){1&n&&(t.\u0275\u0275elementStart(0,"h3",0)(1,"span",1),t.\u0275\u0275text(2),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(3,"section",2)(4,"div")(5,"div",3),t.\u0275\u0275template(6,Cn,4,4,"div",4),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(7,"div",3),t.\u0275\u0275template(8,bn,4,4,"div",4),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(9,"div",5),t.\u0275\u0275listener("dropHandler",function(){return r.dropDrillthroughFilter()}),t.\u0275\u0275elementStart(10,"ul",6),t.\u0275\u0275template(11,Pn,1,1,"filter",7),t.\u0275\u0275pipe(12,"isNonTransientFilter"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(13,"ul",8),t.\u0275\u0275template(14,Sn,1,1,"filter",7),t.\u0275\u0275pipe(15,"isTransientFilter"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(16,"div",9),t.\u0275\u0275text(17),t.\u0275\u0275elementEnd()()()()),2&n&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("pbi-tooltip",r.getPaneTitleTooltipConfig()),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",r.viewModel.resources.paneTitle," "),t.\u0275\u0275advance(3),t.\u0275\u0275property("pbi-tooltip",r.getCrossReportDrillthroughTooltipConfig()),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",r.viewModel.crossReportDrillthroughToggle.show&&r.useModernFormatPane),t.\u0275\u0275advance(1),t.\u0275\u0275property("pbi-tooltip",r.getKeepAllFiltersTooltipConfig()),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",r.useModernFormatPane),t.\u0275\u0275advance(1),t.\u0275\u0275property("drop",r.dropConfig)("dropAction",r.dropActionHandler),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngForOf",t.\u0275\u0275pipeBind1(12,15,r.viewModel.drillthroughFilters))("ngForTrackBy",r.trackByFn),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",t.\u0275\u0275pipeBind1(15,17,r.viewModel.drillthroughFilters))("ngForTrackBy",r.trackByFn),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngClass",0===r.viewModel.drillthroughFilters.length?"dropzone":"end-dropzone"),t.\u0275\u0275attribute("tabindex",0===r.viewModel.drillthroughFilters.length?0:-1),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",0===r.viewModel.drillthroughFilters.length?r.viewModel.resources.dropZoneText:""," "))},dependencies:[S.NgClass,S.NgForOf,S.NgIf,Ct.W,mn.z,jt.I,yn.i,Mn,xn],styles:['.drillthroughPane[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:0 6px 4px 4px}.drillthroughPane[_ngcontent-%COMP%]   ul.transientFilters[_ngcontent-%COMP%]{font-style:italic}.modern[_nghost-%COMP%]   .drillthroughSectionHeader[_ngcontent-%COMP%]{padding:6px 4px 4px;font-size:unset;margin-left:8px}.modern[_nghost-%COMP%]   .drillthroughSectionHeader[_ngcontent-%COMP%]   .sectionTitle[_ngcontent-%COMP%]{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--sm-font-size, 12px);font-weight:var(--font-weight-semi-bold, 600);margin:0;line-height:16px}.modern[_nghost-%COMP%]   .toggle-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:5px 0;margin-left:8px}.modern[_nghost-%COMP%]   .filterPane[_ngcontent-%COMP%]   .cards[_ngcontent-%COMP%]{margin-top:5px}.filterPane[_ngcontent-%COMP%]{--field-well-title-color: var(--gray-180, #252423);--field-well-bucket-border-color: var(--gray-60, #C8C6C4);float:left;width:100%;box-sizing:border-box;padding:0 6px 4px 4px;overflow:visible}  [data-legacy-theming=false] .filterPane{--field-well-title-color: var(--colorNeutralForeground1);--field-well-bucket-border-color: var(--colorNeutralStroke1)}.filterPane[_ngcontent-%COMP%]   .bucket[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%}.filterPane[_ngcontent-%COMP%]   .bucket[_ngcontent-%COMP%]:focus{outline:none}.filterPane[_ngcontent-%COMP%]   .bucket[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{color:var(--gray-180, #252423);display:flex;margin:6px 5px 6px 0;box-sizing:border-box;font-weight:inherit}.filterPane[_ngcontent-%COMP%]   .bucket[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{margin-left:12px;font-size:var(--sm-font-size, 12px)}.filterPane[_ngcontent-%COMP%]   .bucket[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]:focus{outline:none}.filterPane[_ngcontent-%COMP%]   .cards[_ngcontent-%COMP%]{float:left;width:100%;box-sizing:border-box;background-color:var(--fluent-theme-white-color, #FFF);border:1px dashed var(--field-well-bucket-border-color);border-radius:2px}.filterPane[_ngcontent-%COMP%]   .cards.append[_ngcontent-%COMP%]{border-color:var(--gray-130, #605E5C)}.filterPane[_ngcontent-%COMP%]   .dropzone[_ngcontent-%COMP%]{color:var(--field-well-title-color);padding:4px 8px}html[data-focus-source=key][_ngcontent-%COMP%]   .filterPane[_ngcontent-%COMP%]   .dropzone[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:-1px}.filterPane[_ngcontent-%COMP%]   .end-dropzone[_ngcontent-%COMP%]{height:8px}']}),i}(K.w),Ze=c(84431),Le=c(15580),Se=c(21728),Ht=c(66794),Qt=c(41606),_n=c(55201),Kt=c(65302),Pt=c(5265),On=c(34763),St=c(37272),nt=c(81905),xt=c(8082),Ie=c(15393),Mt=c(23983),Ne=c(85677),Re=c(88409),De=c(40702),we=c(14463);function Jt(o,i,e){return o?e.get(o):i.reject()}var Zt=c(12587),Fe=c(59017),U=c(14172),Xt=c(57243),je=c(28149),Yt=c(77200),qt=c(74913),ei=c(79930),rt=c(89839),wn=c(72038),be=c(3468);var ii=c(54766),ot=c(42342),Vn=c(50550),En=c(79602),ni=c(19008),_t=c(80366),ri=c(76001),at=c(94419),Ae=c(45551),xe=c(45413),oi=c(58295),ai=c(58609),Ot=c(54165),wt=c(67660),Ft=c(62812),In=c(5467),st=c(83309),An=c(53267),Te=c(17174),si=c(44581),kn=c(24150),li=c(45916);function zn(o,i){if(1&o&&t.\u0275\u0275element(0,"div",13)(1,"div",14),2&o){var e=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("textContent",e.viewModel.displayOptions.tooltipTitle),t.\u0275\u0275advance(1),t.\u0275\u0275property("textContent",e.viewModel.displayOptions.tooltipDescription)}}function Bn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"i",15),t.\u0275\u0275listener("accessible-click",function(){t.\u0275\u0275restoreView(e);var a=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(a.editLabel())}),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275element(2,"pbi-svg-use-symbol",16),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275nextContext(2);t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(1,3,n.editableLabelAriaLabel$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("sheet","fieldListPaneIcons")("symbolId","fieldListError")}}function Ln(o,i){1&o&&t.\u0275\u0275element(0,"tri-svg-icon",17)}function Nn(o,i){if(1&o&&t.\u0275\u0275element(0,"i",18),2&o){var e=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("ngClass",e.viewModel.displayOptions.glyph)}}function Rn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"input",19),t.\u0275\u0275listener("ngModelChange",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(s.editableLabelName=a)}),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("ngModel",n.editableLabelName),t.\u0275\u0275attribute("maxlength",n.maxInputlength)}}function jn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",20),t.\u0275\u0275listener("click",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(s.toggleHiddenProjection(a))}),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275element(2,"tri-svg-icon",21),t.\u0275\u0275pipe(3,"async"),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275nextContext(2);t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(1,3,n.tooltipForHide$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("name",t.\u0275\u0275pipeBind1(3,5,n.iconNameForHide$))("pbiTooltip",t.\u0275\u0275pipeBind1(4,7,n.tooltipForHide$))}}function Wn(o,i){1&o&&t.\u0275\u0275element(0,"pbi-svg-use-symbol",24)}var Gn=function(i){return{"glyphicon glyph-mini pbi-glyph-chevrondownsmall":i}};function $n(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",22),t.\u0275\u0275listener("click",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(s.showMenu(a))}),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275template(2,Wn,1,0,"pbi-svg-use-symbol",23),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(5,Gn,n.newPaneColorsEnabled)),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(1,3,n.editableLabelAriaLabel$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",!n.newPaneColorsEnabled)}}function Un(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",25),t.\u0275\u0275listener("click",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(s.deleteFieldAndFocus(a))}),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275nextContext(2);t.\u0275\u0275attribute("aria-label",n.removeAriaLabel)}}function Hn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"li",28),t.\u0275\u0275element(1,"span",29),t.\u0275\u0275elementStart(2,"button",25),t.\u0275\u0275listener("click",function(s){var u=t.\u0275\u0275restoreView(e).index,d=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(d.deleteFieldAndFocus(s,u))}),t.\u0275\u0275elementEnd()()}if(2&o){var n=i.$implicit,r=t.\u0275\u0275nextContext(3);t.\u0275\u0275advance(1),t.\u0275\u0275property("textContent",n.displayName),t.\u0275\u0275attribute("aria-label",n.displayName),t.\u0275\u0275advance(1),t.\u0275\u0275attribute("aria-label",r.removeAriaLabel)}}function Qn(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"ol",26),t.\u0275\u0275template(1,Hn,3,3,"li",27),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",e.viewModel.hierarchyLevels)}}var Kn=function(i,e){return{"can-prepend":i,"not-draggable":e}};function Jn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"li",1),t.\u0275\u0275listener("dropHandler",function(s){t.\u0275\u0275restoreView(e);var l=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(l.drop(s.event,s.ui,s.dropAction))}),t.\u0275\u0275template(1,zn,2,2,"ng-template",null,2,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementStart(3,"h2",3),t.\u0275\u0275listener("contextmenu",function(s){t.\u0275\u0275restoreView(e);var l=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(l.showMenu(s))}),t.\u0275\u0275template(4,Bn,3,5,"i",4),t.\u0275\u0275template(5,Ln,1,0,"tri-svg-icon",5),t.\u0275\u0275pipe(6,"async"),t.\u0275\u0275template(7,Nn,1,1,"i",6),t.\u0275\u0275elementStart(8,"div",7),t.\u0275\u0275listener("dblclick",function(){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.editLabel())})("keydown.enter",function(){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.editLabel())})("keydown.space",function(){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.editLabel())})("click",function(){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.editVisualCalc())}),t.\u0275\u0275pipe(9,"async"),t.\u0275\u0275template(10,Rn,1,2,"input",8),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(11,jn,5,9,"button",9),t.\u0275\u0275pipe(12,"async"),t.\u0275\u0275template(13,$n,3,7,"button",10),t.\u0275\u0275template(14,Un,1,1,"button",11),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(15,Qn,2,1,"ol",12),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275reference(2),r=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction2(30,Kn,!r.viewModel.interactivityOptions.isReplaceable,!r.viewModel.interactivityOptions.isDraggableField))("drag","field")("dragDisabled",!r.viewModel.interactivityOptions.isDraggableField)("getDragContext",r.getDragContext)("drop",r.dropConfig)("dropAction",r.dropActionHandler)("dropContainerId",r.fieldDropUniqueId)("pbiTooltip",n)("pbiTooltipDisabled",r.isTooltipDisabled)("pbiTooltipHideDelay",100)("pbiTooltipMaxHeight","92vh")("pbiTooltipPosition","before"),t.\u0275\u0275advance(4),t.\u0275\u0275property("ngIf",!r.viewModel.valid),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(6,24,r.hasVisualCalcExpression$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",r.viewModel.displayOptions.glyph),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngStyle",t.\u0275\u0275pipeBind1(9,26,r.displayNameStyle$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("pbiEditableLabel",r.pbiEditableLabelOptions)("pbiEditableLabelValue",r.currentDisplayName)("pbiEditableLabelMode",r.viewModel.isEditingLabel)("pbiEditableLabelEditable",r.viewModel.isEditingLabel),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(12,28,r.showHideButton$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",r.viewModel.interactivityOptions.hasContextMenu),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",r.viewModel.interactivityOptions.isRemovableField),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",r.viewModel.hierarchyLevels)}}var ci=function(o){function i(e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V,P,O,w,j,ee,Y,ae,se,re,he){var B=o.call(this)||this;return B.changeDetection=e,B.conceptualSchemaProxy=n,B.contextActivityService=r,B.dataSources=a,B.dragDataService=s,B.element=l,B.eventBridge=u,B.explorationCapabilities=d,B.explorationNavigation=v,B.featureSwitchService=p,B.groupAuthoring=f,B.lazyScoped=h,B.localizationService=m,B.modelChangeHandler=b,B.pbiMenuService=y,B.promiseFactory=V,B.screenReaderService=P,B.selection=O,B.showValueAsService=w,B.sparklinesService=j,B.telemetryService=ee,B.themeService=Y,B.visibilityService=ae,B.visualAuthoring=se,B.visualCalcEagerService=re,B.visualPlugin=he,B.maxInputlength=100,B.getDragContext=function(){return{sourceIndex:B.viewModel.startIndex,sourceRole:B.viewModel.role,hierarchyLevelCount:B.viewModel.hierarchyLevels.length}},B.fieldDropUniqueId=_.uniqueId("fieldDropUniqueId"),B.element.nativeElement.id=B.fieldDropUniqueId,B.pbiEditableLabelOptions={disableClick:!0,customTooltip:!0,inputMatchLabelWidth:!1,onEdit:function(){return B.editLabel()},onBlur:function(){return B.rename()}},B.showFieldTooltip=B.localizationService.get("Visual_Calculation_Field_Well_Show_In_Visual"),B.hideFieldTooltip=B.localizationService.get("Visual_Calculation_Field_Well_Hide_From_Visual"),B.tooltipConfigManager={getTooltipConfig:function(){return{tooltipTitle:B.viewModel.displayOptions.tooltipTitle,tooltipDescription:B.viewModel.displayOptions.tooltipDescription}}},B.dropConfig={accept:"field",greedy:!1},B.removeAriaLabel=B.localizationService.get("FieldWell_Remove"),B.newPaneColorsEnabled=B.explorationCapabilities.getCapabilities().showFluentDesign||B.featureSwitchService.featureSwitches&&B.featureSwitchService.featureSwitches.paneColorRefresh,B}return(0,g.ZT)(i,o),Object.defineProperty(i.prototype,"currentDisplayName",{get:function(){return this.viewModel.displayOptions.displayName},enumerable:!1,configurable:!0}),i.prototype.ngOnInit=function(){var e=this;this.core=new ui({conceptualSchemaProxy:this.conceptualSchemaProxy,contextActivityService:this.contextActivityService,dataSources:this.dataSources,eventBridge:this.eventBridge,explorationNavigation:this.explorationNavigation,featureSwitchService:this.featureSwitchService,groupAuthoring:this.groupAuthoring,lazyScoped:this.lazyScoped,localizationService:this.localizationService,modelChangeHandler:this.modelChangeHandler,promiseFactory:this.promiseFactory,screenReaderService:this.screenReaderService,selection:this.selection,showValueAsService:this.showValueAsService,sparklinesService:this.sparklinesService,telemetryService:this.telemetryService,themeService:this.themeService,visualAuthoring:this.visualAuthoring,visualPlugin:this.visualPlugin,visibilityService:this.visibilityService,visualCalcEagerService:this.visualCalcEagerService},function(){Kt.IK.focus($(e.element.nativeElement).find(".fieldWellIcon.dropDown")[0])}),this.core.viewModel=this.viewModel,this.core.bucketDisplayName=this.bucketDisplayName;var r=this.element.nativeElement;r&&(0,it.$o)(r,function(s,l,u){return e.core.dropField(l,e.getFieldDropAction(u))},function(s){return e.getFieldDropAction(s)}),this.dropActionHandler=function(s){return Promise.resolve(e.getDropAction(s))},this.editableLabelName=this.currentDisplayName;var a=this.changes$("viewModel").pipe((0,Xt.d)());this.hasVisualCalcExpression$=a.pipe((0,U.U)(function(s){var l=s.expr;return s.valid&&!!l&&(0,Ce.jX)(l)}),(0,I.R)(this.onDestroy$)),this.iconNameForHide$=a.pipe((0,U.U)(function(s){return s?.isHiddenInVisual?"eye_off_16_regular":"eye_16_regular"}),(0,I.R)(this.onDestroy$)),this.tooltipForHide$=a.pipe((0,U.U)(function(s){return s?.isHiddenInVisual?e.showFieldTooltip:e.hideFieldTooltip}),(0,I.R)(this.onDestroy$)),this.showHideButton$=(0,Fe.aj)([a,this.visibilityService.get$(16)]).pipe((0,U.U)(function(s){var l=s[0],u=s[1],d=l?.expr;return null!=d&&((0,oi.k)(d)||(0,Ce.jX)(d))&&16===u?.visibility}),(0,I.R)(this.onDestroy$)),this.editableLabelAriaLabel$=a.pipe((0,U.U)(function(s){return e.getEditableLabelAriaLabel(s)})),this.displayNameStyle$=(0,Fe.aj)([a,this.visibilityService.get$(16)]).pipe((0,U.U)(function(s){var l=s[0],u=s[1];if(16===u?.visibility)return l.displayOptions.pbiStyle}),(0,I.R)(this.onDestroy$)),this.changeDetection.detectChanges()},Object.defineProperty(i.prototype,"isTooltipDisabled",{get:function(){var n=this.viewModel.displayOptions;return _.isEmpty(n.tooltipDescription)&&_.isEmpty(n.tooltipTitle)},enumerable:!1,configurable:!0}),i.prototype.onDestroy=function(){this.core.onDestroy()},i.prototype.getDropAction=function(e){var n=this.dragDataService.getDragContext(),r=this.viewModel.interactivityOptions,a=r.canAppend?3:2;if(n&&r.isDroppableField&&(r.canAppend||r.canPrepend)){var s=n.sourceRole;if(s){var l=n.hierarchyLevelCount||1,u=n.sourceIndex,d=!r.canPrepend||(0,ot.wc)(e);if(this.core.getTargetIndex(s,u,l,{role:this.viewModel.role,startIndex:this.viewModel.startIndex,hierarchyLevelsLength:this.viewModel.hierarchyLevels?this.viewModel.hierarchyLevels.length:0},d)<0)return 0}r.isReplaceable&&r.isReplaceOnly?a=1:(0,ot.W6)(e)&&r.canPrepend&&(a=2)}else a=0;return a},i.prototype.drop=function(e,n,r){var a=this.dragDataService.getDragContext();this.core.dropWithPayloadAndAction(a,r)},i.prototype.deleteField=function(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(n){return[2,this.core.deleteField(e)]})})},i.prototype.deleteFieldAndFocus=function(e,n){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(r){return[2,this.core.deleteFieldAndFocus(e,n)]})})},i.prototype.selectFieldMenuItem=function(e){this.core.selectFieldMenuItem(e)},i.prototype.showMenu=function(e){return(0,g.mG)(this,void 0,void 0,function(){var n,a=this;return(0,g.Jh)(this,function(s){return e.preventDefault(),n={anchorElement:$(e.currentTarget)},this.pbiMenuService.open(wn.p.getPbiMenuConfig(this.viewModel.interactivityOptions.dropDownItems,e.currentTarget,!1,!1,n)).onButtonClick$.pipe((0,x.q)(1)).subscribe(function(l){a.selectFieldMenuItem(l.id)}),e.keyCode===$.ui.keyCode.SPACE&&e.stopPropagation(),[2]})})},i.prototype.editLabel=function(){this.core.editLabel()},i.prototype.cancelRename=function(){this.core.cancelRename(),this.changeDetection.detectChanges()},i.prototype.rename=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,this.core.rename(this.editableLabelName)];case 1:return e.sent(),this.cancelRename(),[2]}})})},i.prototype.toggleHiddenProjection=function(e){return e.preventDefault(),this.toggleFieldHidden()},i.prototype.editVisualCalc=function(){var e;if(16===(null===(e=this.visibilityService.get(16))||void 0===e?void 0:e.visibility)){var r=this.viewModel.expr;null!==r&&(0,Ce.jX)(r)&&this.core.editVisualCalculation()}},i.prototype.toggleFieldHidden=function(){var e=this.viewModel.role,n=this.viewModel.startIndex,r=this.core.getSelectedVisual(),a=this.dataSources.get();return this.visualAuthoring.toggleFieldHidden(e,n,r,a)},i.prototype.getFieldDropAction=function(e){var n=this.viewModel.interactivityOptions;return n.isDroppableField&&(n.canAppend||n.canPrepend)?n.isReplaceable&&n.isReplaceOnly?1:(0,ot.W6)(e)&&n.canPrepend?2:(0,ot.wc)(e)&&n.canAppend?3:0:0},i.prototype.getEditableLabelAriaLabel=function(e){var n=e.displayOptions.displayName;return _.isString(e.displayOptions.tooltipTitle)&&(n=_.isString(n)?n.concat(". ",e.displayOptions.tooltipTitle):e.displayOptions.tooltipTitle),_.isString(e.displayOptions.tooltipDescription)&&(n=_.isString(n)?n.concat(". ",e.displayOptions.tooltipDescription):e.displayOptions.tooltipDescription),n},i.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(t.ChangeDetectorRef),t.\u0275\u0275directiveInject(Z.i),t.\u0275\u0275directiveInject(ue.r),t.\u0275\u0275directiveInject(de.D),t.\u0275\u0275directiveInject(mt.x),t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(oe.J),t.\u0275\u0275directiveInject(yt.U),t.\u0275\u0275directiveInject(te.z),t.\u0275\u0275directiveInject(le.vZ),t.\u0275\u0275directiveInject(je.RD),t.\u0275\u0275directiveInject(_e.H),t.\u0275\u0275directiveInject(ce.o),t.\u0275\u0275directiveInject(Ot.x),t.\u0275\u0275directiveInject(In.o),t.\u0275\u0275directiveInject(we.t),t.\u0275\u0275directiveInject(st.g),t.\u0275\u0275directiveInject(me.z),t.\u0275\u0275directiveInject(Ne.P),t.\u0275\u0275directiveInject(Ft.s),t.\u0275\u0275directiveInject(ve.y0),t.\u0275\u0275directiveInject(wt.f),t.\u0275\u0275directiveInject(Ie.w),t.\u0275\u0275directiveInject(fe.$8),t.\u0275\u0275directiveInject(Re.w),t.\u0275\u0275directiveInject(Pe.D))},i.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["field-well-field-modern"]],inputs:{bucketDisplayName:"bucketDisplayName",viewModel:"viewModel"},features:[t.\u0275\u0275ProvidersFeature([ei.Wg]),t.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["role","listitem","class","fieldWellProperty","data-testid","field-well-property",3,"ngClass","drag","dragDisabled","getDragContext","drop","dropAction","dropContainerId","pbiTooltip","pbiTooltipDisabled","pbiTooltipHideDelay","pbiTooltipMaxHeight","pbiTooltipPosition","dropHandler",4,"ngIf"],["role","listitem","data-testid","field-well-property",1,"fieldWellProperty",3,"ngClass","drag","dragDisabled","getDragContext","drop","dropAction","dropContainerId","pbiTooltip","pbiTooltipDisabled","pbiTooltipHideDelay","pbiTooltipMaxHeight","pbiTooltipPosition","dropHandler"],["tooltipTemplateRef",""],[1,"flex","smallFontSize",3,"contextmenu"],["tabindex","0","role","button","class","errorIcon error item-auto",3,"accessible-click",4,"ngIf"],["class","fieldIcon","sprite","visual-calc-icons","name","data_histogram_function_20_regular",4,"ngIf"],["class","field-glyph glyphicon glyph-mini",3,"ngClass",4,"ngIf"],["tabindex","0",1,"item-fill","propertyText","propertyContent","caption","trimmedTextWithEllipsis","fieldWellFieldEditableLabel",3,"ngStyle","dblclick","keydown.enter","keydown.space","click"],[3,"ngModel","ngModelChange",4,"pbiEditableLabel","pbiEditableLabelValue","pbiEditableLabelMode","pbiEditableLabelEditable"],["role","button","class","actionButton",3,"click",4,"ngIf"],["role","button","aria-expanded","false","class","fieldWellIcon dropDown item-auto",3,"ngClass","click",4,"ngIf"],["class","delete glyphicon pbi-glyph-close glyph-micro",3,"click",4,"ngIf"],["class","hierarchyList",4,"ngIf"],[1,"tooltipTitle",3,"textContent"],[1,"fieldTooltipDescription",3,"textContent"],["tabindex","0","role","button",1,"errorIcon","error","item-auto",3,"accessible-click"],[3,"sheet","symbolId"],["sprite","visual-calc-icons","name","data_histogram_function_20_regular",1,"fieldIcon"],[1,"field-glyph","glyphicon","glyph-mini",3,"ngClass"],[3,"ngModel","ngModelChange"],["role","button",1,"actionButton",3,"click"],["tri-svg-icon-16","","sprite","fluentui-icons",1,"eyeIcon",3,"name","pbiTooltip"],["role","button","aria-expanded","false",1,"fieldWellIcon","dropDown","item-auto",3,"ngClass","click"],["sheet","fieldListPaneIcons","symbol-id","fieldListDropdown",4,"ngIf"],["sheet","fieldListPaneIcons","symbol-id","fieldListDropdown"],[1,"delete","glyphicon","pbi-glyph-close","glyph-micro",3,"click"],[1,"hierarchyList"],["class","flex",4,"ngFor","ngForOf"],[1,"flex"],["tabindex","0",1,"subcaption","trimmedTextWithEllipsis","item-fill",3,"textContent"]],template:function(n,r){1&n&&t.\u0275\u0275template(0,Jn,16,33,"li",0),2&n&&t.\u0275\u0275property("ngIf",r.core)},dependencies:[S.NgClass,S.NgForOf,S.NgIf,S.NgStyle,An.w,Ct.W,Te.Fj,Te.JJ,Te.On,si.t,kn.D,li.R,tt.V,qt.M,S.AsyncPipe],styles:[".fieldWellFieldEditableLabel[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;border:none}.tooltipTitle[_ngcontent-%COMP%]{font-weight:700}.fieldTooltipDescription[_ngcontent-%COMP%]{max-width:240px;display:block;position:relative;word-break:break-word;white-space:pre-wrap}.fieldIcon[_ngcontent-%COMP%]{margin-right:4px}.actionButton[_ngcontent-%COMP%]{background:transparent;margin-right:4px;margin-top:-4px}.eyeIcon[_ngcontent-%COMP%]{--eye-icon-fill: var(--gray-140);fill:var(--eye-icon-fill)}  [data-legacy-theming=false] .eyeIcon{--eye-icon-fill: var(--colorNeutralForeground1)}"]}),i}(Zt.w),ui=function(){function o(i,e,n){this.services=i,this.onContextMenuActionFailed=e,this.onLabelInEditingModeChanged=n}return o.prototype.onDestroy=function(){this.dataBarsDialogRef&&this.dataBarsDialogRef.close()},o.prototype.dropWithPayloadAndAction=function(i,e){var n;return(0,g.mG)(this,void 0,void 0,function(){var r,a,s,l,u,d,v,p,f;return(0,g.Jh)(this,function(h){return r=i,a=this.viewModel,s=this.services.dataSources.get(),l=16===(null===(n=this.services.visibilityService.get(16))||void 0===n?void 0:n.visibility),(u=r.sourceRole)?[2,!((p=this.getTargetIndex(u,v=r.sourceIndex,d=r.hierarchyLevelCount||1,{role:this.viewModel.role,startIndex:this.viewModel.startIndex,hierarchyLevelsLength:this.viewModel.hierarchyLevels?this.viewModel.hierarchyLevels.length:0},3===e))<0)&&this.services.visualAuthoring.moveField(u,a.role,v,p,d,s,l)]:(f=i).field?[2,this.dropField(f.field,e)]:[2,!1]})})},o.prototype.dropField=function(i,e){var n;return(0,g.mG)(this,void 0,void 0,function(){var r,a,s,u;return(0,g.Jh)(this,function(d){switch(d.label){case 0:return r=this.services.dataSources.get(),a=_.size(this.viewModel.hierarchyLevels),s=this.getSelectedVisual(),this.viewModel.interactivityOptions.isReplaceable&&(this.viewModel.interactivityOptions.isReplaceOnly||1===e)?(this.viewModel.isInsideAutoVisualBucket||((0,R.PQ)(s).autoSelectVisualType=void 0),[4,this.checkToRestoreOrMergeLevelToHierarchy(i,r)]):[3,2];case 1:return d.sent()?[2,!0]:[2,this.services.visualAuthoring.replaceField(i,this.viewModel.role,this.viewModel.startIndex,s,r,a>0?a:void 0)];case 2:return u=16===(null===(n=this.services.visibilityService.get(16))||void 0===n?void 0:n.visibility),[2,this.services.visualAuthoring.addFieldInRole(i,this.viewModel.role,r,s,3===e?this.viewModel.startIndex+Math.max(a,1):this.viewModel.startIndex,void 0,void 0,u)]}})})},o.prototype.editLabel=function(){var i=this.viewModel;i.interactivityOptions.isEditableField&&(i.isEditingLabel=!0,this.onLabelInEditingModeChanged&&this.onLabelInEditingModeChanged(!0))},o.prototype.deleteField=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return null!==this.viewModel.expr&&(0,Ce.jX)(this.viewModel.expr)&&(e=this.getSelectedVisual(),n=(0,R.$Z)(e,this.viewModel.role,this.viewModel.startIndex),this.services.visualCalcEagerService.deleteVisualCalc(n)),[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())];case 1:return r=a.sent(),this.services.visualAuthoring.removeFieldFromRole({role:this.viewModel.role,projOptions:{fieldIndex:this.viewModel.startIndex+(i||0)},count:_.isNumber(i)?1:this.viewModel.hierarchyLevels.length||1},r),this.logDeleteTelemetry(),[2]}})})},o.prototype.deleteFieldAndFocus=function(i,e){return(0,g.mG)(this,void 0,void 0,function(){var n=this;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return i&&i.stopPropagation(),[4,this.deleteField(e)];case 1:return r.sent(),En.l.setTimeout(function(){n.services.eventBridge.publishToChannel(k.Ah$,n.bucketDisplayName)}),[2]}})})},o.prototype.cancelRename=function(){this.viewModel.isEditingLabel=!1,this.onLabelInEditingModeChanged&&this.onLabelInEditingModeChanged(!1)},o.prototype.rename=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r,a,s;return(0,g.Jh)(this,function(l){switch(l.label){case 0:return i===(e=this.viewModel.displayOptions).displayName||null==(n=this.getSelectedVisual())?[2]:(r=n.config.singleVisual.query,a=n&&n.name,s=n&&n.config.singleVisual.visualType,n&&r&&r.projections&&r.projections[this.viewModel.role]&&this.viewModel.visualContainerName===a?(e.displayName=i,[4,this.services.visualAuthoring.setDisplayNameAlias(n,{fieldIndex:this.viewModel.startIndex},this.viewModel.role,i)]):(this.services.telemetryService.logEvent(De.jG,{originalVisualContainerName:this.viewModel.visualContainerName,originalVisualType:this.viewModel.visualType,currentVisualContainerName:a,currentVisualType:s}),[2]));case 1:return l.sent(),this.cancelRename(),[2]}})})},o.prototype.selectFieldMenuItem=function(i){switch(T.fF.assertValue(i,"Expected a menu item option."),i.action){case 32768:this.editLabel();break;case 1:this.deleteFieldAndFocus();break;case 4:this.setAggregate(this.viewModel,i.aggregate);break;case 2:this.removeAggregate(this.viewModel);break;case 8:this.toggleShowAll(this.viewModel);break;case 128:this.setVariation(this.viewModel,i.variationExpr);break;case 32:this.setShowValueAs(this.viewModel,i.showValueAs);break;case 64:this.showQuickCalcDialog();break;case 256:this.showGroupsDialog(this.viewModel,!0);break;case 512:this.showGroupsDialog(this.viewModel,!1);break;case 1024:this.showEditClusteringDialogAsync(this.viewModel);break;case 2048:this.restoreHierarchy();break;case 4096:this.setConditionalFormatting(i.conditionalFormattingOptions);break;case 16384:this.removeConditionalFormatting(i.conditionalFormattingOptions);break;case 8192:this.removeConditionalFormattingAll();break;case 65536:this.moveField(i.moveFieldPropertyOptions,!1);break;case 131072:this.moveField(i.moveFieldPropertyOptions,!0);break;case 262144:this.moveToBucket(i.moveFieldBucketOptions);break;case 2097152:this.showSparklinesDialog(!1);break;case 33554432:this.editVisualCalculation();break;case 4194304:this.showSparklinesDialog(!0);break;case 16777216:case 8388608:this.switchQueryParameter();break;default:T.fF.assertFail("Invalid action.")}},o.prototype.restoreHierarchy=function(){var i=this.getAuthoringContext();return i?this.services.visualAuthoring.expandHierarchy(i.dataSources,i.visual,this.viewModel.role,this.viewModel.startIndex,this.viewModel.hierarchyLevels.length):Promise.resolve(!1)},o.prototype.editVisualCalculation=function(){return(0,g.mG)(this,void 0,void 0,function(){var i,e,n;return(0,g.Jh)(this,function(r){return i=this.getSelectedVisual(),e=(0,R.$Z)(i,this.viewModel.role,this.viewModel.startIndex),n=(0,ai.hF)(this.services.contextActivityService,{name:"VisualAction",visualName:i.name,data:{action:"EditVisualCalculation",source:"ContextMenu",contextMenuType:"FieldWell"}}),[2,this.services.visualCalcEagerService.enterVisualCalcMode(i,e,n)]})})},o.prototype.getTargetIndex=function(i,e,n,r,a){var s=r.startIndex;if(a&&(s+=r.hierarchyLevelsLength||1),i===r.role){if(s===e||s===e+n)return-1;s>e&&(s=Math.max(s-n,0))}return s},o.prototype.getSelectedVisual=function(){return Se.UP.getSelectedVisual(this.services.selection)},o.prototype.checkToRestoreOrMergeLevelToHierarchy=function(i,e){var n;return(0,g.mG)(this,void 0,void 0,function(){var r,l,u,d,v,p,f,h,m,b,V=this;return(0,g.Jh)(this,function(P){switch(P.label){case 0:return r=this.viewModel.hierarchyLevels,_.size(r)>0?(l=null===(n=_.first(r))||void 0===n?void 0:n.expr,[4,this.services.conceptualSchemaProxy.get(e)]):[2,!1];case 1:return u=P.sent(),(0,Ce.t3)(i)&&(0,Ae.K8)(u,i)&&(0,xe.fS)((0,Ae.ZB)(l),i)?(f=(0,Ae.wA)(u,i),_.size(f)===_.size(r)?[2,!0]:[4,this.restoreHierarchy()]):[3,3];case 2:if(P.sent())return[2,!0];P.label=3;case 3:return(0,Ce.y3)(i)?(d=!1,i.arg instanceof at.c7?(v=(0,Ae.cH)(l),d=(0,xe.fS)(v,i.arg)):(p=(0,Ae.uW)(l),d=(0,xe.fS)(p,i)),d?(f=(0,Ae.wA)(u,i),_.size(f)===_.size(r)?[2,!0]:[4,this.restoreHierarchy()]):[3,5]):[3,5];case 4:if(P.sent())return[2,!0];P.label=5;case 5:return(0,Ce.ez)(i)?(f=(0,Ae.wA)(u,this.viewModel.expr),_.isArray(f)&&_.find(f,function(O){return(0,xe.fS)(O,i)})?_.find(this.viewModel.hierarchyLevels,function(O){return(0,xe.fS)(O.expr,i)})?[2,!0]:(h=_.findIndex(f,function(O){return(0,xe.fS)(O,i)}),m=-1,_.findLast(f.slice(0,h),function(O){var w=_.findIndex(V.viewModel.hierarchyLevels,function(j){return(0,xe.fS)(j.expr,O)});if(-1!==w)return m=w,!0}),b=-1!==m?m+1:0,[4,this.services.visualAuthoring.addFieldInRole(i,this.viewModel.role,e,this.getSelectedVisual(),this.viewModel.startIndex+b)]):[3,7]):[3,7];case 6:if(P.sent())return[2,!0];P.label=7;case 7:return[2,!1]}})})},o.prototype.switchQueryParameter=function(){return(0,g.mG)(this,void 0,void 0,function(){var i;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,this.services.conceptualSchemaProxy.get(this.services.dataSources.get())];case 1:return i=e.sent(),this.services.visualAuthoring.switchQueryParameter(i,this.viewModel.startIndex,this.viewModel.role),[2]}})})},o.prototype.setAggregate=function(i,e){T.fF.assertValue(e,"Must specify a new aggregate.");var n=this.getAuthoringContext();if(n){var r=(0,_t._L)((0,ri.Q)(i.expr)),a=this.services.visualAuthoring.setAggregate(this.viewModel.role,this.viewModel.startIndex,e,n.visual,n.dataSources);return(0,rt.l)(i,n.visual),this.services.telemetryService.logEvent(De.TS,{original:(0,ni.b)(r),target:(0,ni.b)(e),visualName:n.visual.name}),a}},o.prototype.setVariation=function(i,e){var n=this.getAuthoringContext();n&&this.services.visualAuthoring.setVariation(n.dataSources,n.visual,e,this.viewModel.role,this.viewModel.startIndex,this.viewModel.hierarchyLevels.length)},o.prototype.removeAggregate=function(i){var e=this.getAuthoringContext();e&&(this.services.visualAuthoring.removeAggregate(this.viewModel.role,this.viewModel.startIndex,e.visual,e.dataSources),(0,rt.l)(i,e.visual))},o.prototype.toggleShowAll=function(i){var e=this.getAuthoringContext();e&&(this.services.visualAuthoring.toggleShowAll(i.role,e.visual),(0,rt.l)(i,e.visual))},o.prototype.showQuickCalcDialog=function(){return(0,g.mG)(this,void 0,void 0,function(){var i,e,n,r;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return(i=this.getAuthoringContext())?(r=i.visual.config.singleVisual.query.tryGetExpr(e=this.viewModel.role,n=this.viewModel.startIndex),[4,this.services.lazyScoped.get("quickMeasures")]):[2];case 1:return a.sent().launchQuickMeasures(r,"FieldWell",void 0,{visualContainer:i.visual,index:n,role:e}),[2]}})})},o.prototype.showSparklinesDialog=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r,a,s,l,u;return(0,g.Jh)(this,function(d){switch(d.label){case 0:return(e=this.getAuthoringContext())?(a=e.visual.config.singleVisual.query.tryGetExpr(n=this.viewModel.role,r=this.viewModel.startIndex),i?[3,2]:[4,this.services.sparklinesService.showCreateDialog(a)]):[2];case 1:return(s=d.sent())&&(l=be.ib.deserializeExpr(s.measure),u=be.ib.deserializeExpr(s.grouping),this.services.sparklinesService.addSparklinesToVisual(l,u,e.visual)),[3,4];case 2:return[4,this.services.sparklinesService.showEditDialog(a)];case 3:(s=d.sent())&&(l=be.ib.deserializeExpr(s.measure),u=be.ib.deserializeExpr(s.grouping),this.services.sparklinesService.updateSparklinesExpr(l,u,e.visual,n,r)),d.label=4;case 4:return[2]}})})},o.prototype.showGroupsDialog=function(i,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,a,s,l,u,d=this;return(0,g.Jh)(this,function(v){switch(v.label){case 0:return n=this.services.dataSources.get(),[4,this.services.conceptualSchemaProxy.get(n)];case 1:r=v.sent(),a=i.expr.getTargetEntity(),s=i.expr.getConceptualProperty(r),l={schema:a.schema,entity:a.entity,name:e?null:s.name,sourcePropertyName:e?s.name:null,isNew:e},u=this.services.modelChangeHandler.register(function(p){return d.handleNewGroupsBins(a,i,p),d.services.promiseFactory.resolve()}),v.label=2;case 2:return v.trys.push([2,,4,5]),[4,this.services.groupAuthoring.openGroupDialog(l)];case 3:return v.sent(),[3,5];case 4:return u.stopHandling(),[7];case 5:return[2]}})})},o.prototype.handleNewGroupsBins=function(i,e,n){var r,a=_.find(n.changes,function(v){return v.newBins});a&&(r=(0,at.Oh)(i,a.newBins.name));var s=_.find(n.changes,function(v){return v.newGroups});if(s){var l=function(o){if(T.fF.assertValue(o,"input"),0===o.Version){for(var i={groupedColumns:[]},e=be.ib.deserializeFrom(o.Sources),n=0,r=o.GroupedColumns;n<r.length;n++)i.groupedColumns.push(be.ib.deserializeExprWithRef(r[n],e));if(o.GroupItems){i.groupItems=[];for(var s=0,l=o.GroupItems;s<l.length;s++){var u=l[s],d={name:u.DisplayName};u.Expression&&(d.expression=be.ib.deserializeExprWithRef(u.Expression,e)),u.BlankDefaultPlaceholder&&(d.blankDefaultPlaceholder=!0),i.groupItems.push(d)}}if(o.BinItem&&(i.binItem=be.ib.deserializeExprWithRef(o.BinItem.Expression,e)),o.PartitionTable){var v=o.PartitionTable.Definition;i.partitionTable={mappingTable:be.ib.deserializeQuery(v.TableDefinition),itemIdColumns:v.ItemIdColumns,partitionIdColumn:v.PartitionIdColumn};var f=v.Partitions;f&&(i.partitionTable.partitions=_.map(f,function(b){return{displayName:b.DisplayName,partitionIds:_.map(b.PartitionIds,be.ib.deserializeExpr)}}));var h=o.PartitionTable.Result;h&&(i.partitionTableResult={tableName:h.TableName,partitionIdColumn:h.PartitionIdColumn});var m=v.DefaultPartitionPrefix;m&&(i.partitionTable.defaultPartitionPrefix=m)}return i}T.fF.assertFail("invalid version of Grouping Definition")}(s.newGroups.definition);r=(0,at.Wp)(s.newGroups.name,i,[l.groupedColumns[0]])}if(r){var d=this.services.dataSources.get();this.services.visualAuthoring.replaceField(r,e.role,e.startIndex,this.getSelectedVisual(),d)}},o.prototype.showEditClusteringDialogAsync=function(i){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(n){switch(n.label){case 0:return[4,this.services.lazyScoped.get("clustering")];case 1:return[4,n.sent().editClustering((0,ri.Q)(i.expr),this.services.dataSources.get())];case 2:return n.sent(),[2]}})})},o.prototype.setShowValueAs=function(i,e){var n=this,r=this.getAuthoringContext();if(r){var a=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(a).then(function(s){var l={dataSources:a,roleIndex:n.viewModel.startIndex,visual:r.visual,visualDataRole:n.getVisualDataRole()},d=_.find(i.interactivityOptions.dropDownItems.items,function(p){return p.key&&16===p.key.action}),v=_.find(d.children,function(p){return p.checked});n.services.showValueAsService.applyShowValueAs(l,v.key.showValueAs,e),(0,rt.l)(i,r.visual)})}},o.prototype.logDeleteTelemetry=function(){var i=Jt(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy),e=(0,N.s)(this.getSelectedVisual());this.services.groupAuthoring.telemetry.logGroupsUsageTelemetry(i,this.viewModel.expr,e,null,this.viewModel.role,"Delete")},o.prototype.moveField=function(i,e){var n=this.viewModel.hierarchyLevels.length||1,r=this.getTargetIndex(this.viewModel.role,this.viewModel.startIndex,n,i,e);r>=0&&this.services.visualAuthoring.moveField(this.viewModel.role,i.role,this.viewModel.startIndex,r,n,this.services.dataSources.get(),!1)},o.prototype.moveToBucket=function(i){return(0,g.mG)(this,void 0,void 0,function(){var r;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return[4,this.services.visualAuthoring.moveField(this.viewModel.role,i.role,this.viewModel.startIndex,i.targetIndex,this.viewModel.hierarchyLevels.length||1,this.services.dataSources.get(),!1)];case 1:return a.sent()||(r=this.services.localizationService.format("Invalid_FieldWellBucket_Move",[this.viewModel.displayOptions.displayName,i.displayName]),this.services.screenReaderService.alert(r),this.onContextMenuActionFailed&&this.onContextMenuActionFailed()),[2]}})})},o.prototype.setConditionalFormatting=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r,a,s,l,u,d,v,p,f,h,m,y,V,P,w,j,ee;return(0,g.Jh)(this,function(Y){switch(Y.label){case 0:return e=this.getSelectedVisual(),n=this.services.dataSources.get(),r=this.viewModel,a=this.services.featureSwitchService.featureSwitches,s=a?.conditionalTablixWebURL,l=a?.dataBarsUpdate,[4,this.services.conceptualSchemaProxy.get(n)];case 1:return u=Y.sent(),v=(d=i.repetition).propertyDescriptor&&d.propertyDescriptor.type,p=d.propertyDescriptor&&d.propertyDescriptor.type.misc,f=this.services.explorationNavigation.getCurrentExploration().themeCollection,h=this.services.themeService.getVisualStyle(f),m=this.viewModel.displayOptions.displayName,v&&(v.fill||v.icon||s&&p&&p.webUrl||l&&v.dataBars)?[4,this.services.lazyScoped.get("conditionalFormattingDialogLauncherService")]:[3,4];case 2:return[4,Y.sent().show(e,m,r.expr,d,i.propertyDefinition,h)];case 3:return(y=Y.sent())&&(V=(0,ii.PU)(y.propertyDefinition,d.propertyDescriptor,!1),P=(0,ii.L1)(y.selector),this.services.visualAuthoring.setPropertyDefinition(e,d.propertyId,d.selector,V,P)),[3,8];case 4:return v&&v.dataBars?(w=r.expr.getMetadata(u).type,[4,this.services.lazyScoped.get("dataBarsDialogLauncherService")]):[3,7];case 5:return j=Y.sent(),ee=this,[4,j.show(e,m,d,h.colorPalette,w,!1)];case 6:return ee.dataBarsDialogRef=Y.sent(),[3,8];case 7:T.fF.assertFail("FieldWellFieldController.createConditionalFormatting - Invalid Conditional Formatting Type"),Y.label=8;case 8:return[2]}})})},o.prototype.removeConditionalFormatting=function(i){T.fF.assertValue(i.propertyDefinition,"removeConditionalFormatting called for missing property");var e=this.getSelectedVisual(),n=i.repetition,r=n.propertyDescriptor&&n.propertyDescriptor.type,a=n.propertyDescriptor&&n.propertyDescriptor.type.misc;r&&(r.fill||r.icon||this.services.featureSwitchService.featureSwitches&&this.services.featureSwitchService.featureSwitches.conditionalTablixWebURL&&a&&a.webUrl)?this.services.visualAuthoring.removePropertyDefinition(e,n.propertyId,n.selector):r&&r.dataBars?this.services.visualAuthoring.removeDataBars(e,n):T.fF.assertFail("FieldWellFieldController.createConditionalFormatting - Invalid Conditional Formatting Type"),this.services.telemetryService.logEvent(De.Sd,{visualType:(0,N.s)(e),visualName:e.name})},o.prototype.removeConditionalFormattingAll=function(){var i=this.getSelectedVisual();this.services.visualAuthoring.removeConditionalFormattingAll(i,this.viewModel.conditionalFormattingRepetitions),this.services.telemetryService.logEvent(De.Sd,{visualType:(0,N.s)(i),visualName:i.name})},o.prototype.getAuthoringContext=function(){var i=this.getSelectedVisual();if(i){var e=this.services.dataSources.get();if(e)return{visual:i,dataSources:e}}},o.prototype.getVisualDataRole=function(){var i=(0,R.d$)(this.getSelectedVisual(),this.services.visualPlugin);if(!_.isEmpty(i))return(0,Vn.rC)(i,this.viewModel.role)},o}();function Xn(o,i){if(1&o&&(t.\u0275\u0275element(0,"i",8),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275pipe(2,"async")),2&o){var e=t.\u0275\u0275nextContext();t.\u0275\u0275classMapInterpolate1("warning glyphicon glyph-mini ng-scope ",e.viewModel.warning.glyph,""),t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(2,7,e.warningTooltip$)),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(1,5,e.tooltipDescription$))}}function Yn(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"tri-svg-icon",9),t.\u0275\u0275listener("mouseenter",function(){t.\u0275\u0275restoreView(e);var a=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(a.infoIconName="info_20_filled")})("mouseleave",function(){t.\u0275\u0275restoreView(e);var a=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(a.infoIconName="info_20_regular")}),t.\u0275\u0275elementEnd()}if(2&o){var n=t.\u0275\u0275nextContext();t.\u0275\u0275property("name",n.infoIconName)("pbiTooltip",n.bucketTooltip),t.\u0275\u0275attribute("aria-label",n.bucketTooltip)}}function qn(o,i){if(1&o&&t.\u0275\u0275element(0,"field-well-field-modern",12),2&o){var e=i.$implicit,n=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("bucketDisplayName",n.viewModel.displayName)("viewModel",e)}}var er=function(i,e,n){return{dropzone:i,"end-dropzone":e,"supports-multiple-items":n}};function tr(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,qn,1,2,"field-well-field-modern",10),t.\u0275\u0275elementStart(2,"li",11),t.\u0275\u0275listener("dropHandler",function(s){t.\u0275\u0275restoreView(e);var l=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(l.drop(s.event,s.ui,s.dropAction))}),t.\u0275\u0275pipe(3,"async"),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275pipe(5,"async"),t.\u0275\u0275pipe(6,"async"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementContainerEnd()}if(2&o){var n=i.ngIf,r=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",n),t.\u0275\u0275advance(1),t.\u0275\u0275property("drop",r.dropConfig)("dropAction",r.dropActionHandler)("ngClass",t.\u0275\u0275pureFunction3(16,er,0===n.length,n.length>0,t.\u0275\u0275pipeBind1(3,8,r.supportsMultipleItems$)))("textContent",t.\u0275\u0275pipeBind1(4,10,r.dropzoneLocalize$))("title",t.\u0275\u0275pipeBind1(5,12,r.dropzoneLocalize$))("tabindex",t.\u0275\u0275pipeBind1(6,14,r.tabIndex$)),t.\u0275\u0275attribute("aria-label",r.addFieldsAriaLabel)}}var ir=function(i){return{disabled:i}},nr=function(i){return{border:i}},di=function(o){function i(e,n,r,a,s,l,u,d,v,p,f,h,m,b){var y=o.call(this)||this;return y.element=e,y.conceptualSchemaProxy=n,y.dataSources=r,y.dragDataService=a,y.eventBridge=s,y.featureSwitchService=l,y.groupAuthoring=u,y.localizationService=d,y.promiseFactory=v,y.selection=p,y.telemetryService=f,y.viewModeState=h,y.visibilityService=m,y.visualAuthoring=b,y.infoIconName="info_20_regular",y.core=new pi({conceptualSchemaProxy:y.conceptualSchemaProxy,dataSources:y.dataSources,eventBridge:y.eventBridge,featureSwitchService:y.featureSwitchService,groupAuthoring:y.groupAuthoring,promiseFactory:y.promiseFactory,selection:y.selection,telemetryService:y.telemetryService,visualAuthoring:y.visualAuthoring}),y.uniqueId=_.uniqueId("fieldWellId"),y.dropConfig=y.getDropConfig(),y.dropActionHandler=function(P){return Promise.resolve(y.getDropAction(P))},y.bucketTooltip=d.get("Visual_Calculation_Field_Bucket_Tooltip"),y.dropzoneText=y.localizationService.get("FieldDropZone_AddFields"),y}return(0,g.ZT)(i,o),Object.defineProperty(i.prototype,"viewModel",{get:function(){return this.core.viewModel},set:function(n){this.core.viewModel=n},enumerable:!1,configurable:!0}),i.prototype.ngOnInit=function(){var e=this;this.viewModel$=this.changes$("viewModel"),this.showTooltip$=(0,Fe.aj)([this.viewModel$,this.visibilityService.get$(16)]).pipe((0,U.U)(function(n){var a=n[1];return n[0].properties.filter(function(l){return l.isHiddenInVisual}).length>0&&16!==a?.visibility}),(0,I.R)(this.onDestroy$)),this.visibleFieldProperties$=(0,Fe.aj)([this.viewModel$,this.visibilityService.get$(16)]).pipe((0,U.U)(function(n){var r=n[0],a=n[1];return 16===a?.visibility?r.properties:_.filter(r.properties,function(s){return!s.isHiddenInVisual})}),(0,Xt.d)(1),(0,I.R)(this.onDestroy$)),this.dropzoneLocalize$=this.visibleFieldProperties$.pipe((0,U.U)(function(n){return 0===n.length?e.dropzoneText:""})),this.tabIndex$=this.visibleFieldProperties$.pipe((0,U.U)(function(n){return 0===n.length?0:-1})),this.supportsMultipleItems$=(0,Fe.aj)([this.viewModel$,this.visibilityService.get$(16)]).pipe((0,U.U)(function(n){var r=n[0],a=n[1];return 16===a?.visibility||r.supportsMultipleItems}),(0,I.R)(this.onDestroy$)),this.addFieldsAriaLabel=this.getAddFieldsAriaLabel(),this.borderStyle$=(0,Fe.aj)([this.viewModel$,this.viewModeState.getMode$()]).pipe((0,U.U)(function(n){return e.getBorderStyle(n[0],n[1])}),(0,I.R)(this.onDestroy$)),this.fieldWellAriaLabel$=this.viewModel$.pipe((0,U.U)(function(n){return e.getFieldWellAriaLabel(n)})),this.tooltipDescription$=this.viewModel$.pipe((0,U.U)(function(n){return n.description||n.displayName})),this.warningTooltip$=this.viewModel$.pipe((0,U.U)(function(n){return e.getWarningTooltip(n)}))},i.prototype.ngAfterViewInit=function(){var e=this;this.viewModel$.pipe((0,I.R)(this.onDestroy$)).subscribe(function(n){n.disabled?(0,it.u3)(e.element.nativeElement):(0,it.$o)(e.element.nativeElement,function(r,a){return e.core.dropField(a)})})},i.prototype.drop=function(e,n,r){var a=this.dragDataService.getDragContext();this.core.dropWithPayload(a)},i.prototype.getDropAction=function(e){var n=this.dragDataService.getDragContext(),r=0;if(n){var a=this.viewModel;r=n.sourceRole===a.role&&_.last(a.properties).startIndex===n.sourceIndex?0:_.isEmpty(this.viewModel.properties)?1:2}return r},i.prototype.getDropConfig=function(){return{accept:"field",greedy:!1}},i.prototype.getAddFieldsAriaLabel=function(){var e=this.localizationService;return e.get("FieldDropZone_NoDataFields").concat(". ",e.get("FieldDropZone_AddFields"))},i.prototype.getBorderStyle=function(e,n){if(0===n&&0!==e.properties.length)return"none"},i.prototype.getFieldWellAriaLabel=function(e){var n=e.displayName;return _.isString(e.description)&&(n=_.isString(n)?n.concat(". ",e.description):e.description),n},i.prototype.getWarningTooltip=function(e){var n={tooltipTitle:"",tooltipDescription:""};return e.warning&&(n={tooltipTitle:e.warning.title,tooltipDescription:e.warning.description}),n.tooltipDescription||n.tooltipTitle},i.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(Z.i),t.\u0275\u0275directiveInject(de.D),t.\u0275\u0275directiveInject(mt.x),t.\u0275\u0275directiveInject(oe.J),t.\u0275\u0275directiveInject(le.vZ),t.\u0275\u0275directiveInject(je.RD),t.\u0275\u0275directiveInject(ce.o),t.\u0275\u0275directiveInject(we.t),t.\u0275\u0275directiveInject(me.z),t.\u0275\u0275directiveInject(ve.y0),t.\u0275\u0275directiveInject(Yt.kc),t.\u0275\u0275directiveInject(Ie.w),t.\u0275\u0275directiveInject(fe.$8))},i.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["field-well-bucket-modern"]],inputs:{viewModel:"viewModel"},features:[t.\u0275\u0275InheritDefinitionFeature],decls:13,vars:23,consts:[[1,"bucket",3,"ngClass"],[1,"bucket-header"],[1,"caption","trimmedTextWithEllipsis","smallFontSize",3,"textContent","pbiTooltip"],["role","alert","tabindex","0",3,"class","pbiTooltip",4,"ngIf"],["role","tooltip","style","margin-left:4px","tabindex","0","tri-svg-icon-16","","sprite","fluentui-icons",3,"name","pbiTooltip","mouseenter","mouseleave",4,"ngIf"],[1,"properties",3,"ngStyle","drop"],["aria-hidden","true",1,"bucketTopBorder"],[4,"ngIf"],["role","alert","tabindex","0",3,"pbiTooltip"],["role","tooltip","tabindex","0","tri-svg-icon-16","","sprite","fluentui-icons",2,"margin-left","4px",3,"name","pbiTooltip","mouseenter","mouseleave"],[3,"bucketDisplayName","viewModel",4,"ngFor","ngForOf"],["data-testid","bucket-add-field",1,"trimmedTextWithEllipsis",3,"drop","dropAction","ngClass","textContent","title","tabindex","dropHandler"],[3,"bucketDisplayName","viewModel"]],template:function(n,r){1&n&&(t.\u0275\u0275elementStart(0,"div",0)(1,"div",1),t.\u0275\u0275element(2,"h2",2),t.\u0275\u0275pipe(3,"async"),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275template(5,Xn,3,9,"i",3),t.\u0275\u0275template(6,Yn,1,3,"tri-svg-icon",4),t.\u0275\u0275pipe(7,"async"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(8,"ol",5),t.\u0275\u0275pipe(9,"async"),t.\u0275\u0275element(10,"li",6),t.\u0275\u0275template(11,tr,7,20,"ng-container",7),t.\u0275\u0275pipe(12,"async"),t.\u0275\u0275elementEnd()()),2&n&&(t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(19,ir,r.viewModel.disabled)),t.\u0275\u0275advance(2),t.\u0275\u0275property("textContent",r.viewModel.displayName)("pbiTooltip",t.\u0275\u0275pipeBind1(4,11,r.tooltipDescription$)),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(3,9,r.fieldWellAriaLabel$)),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",r.viewModel.warning),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(7,13,r.showTooltip$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(21,nr,t.\u0275\u0275pipeBind1(9,15,r.borderStyle$)))("drop",r.dropConfig),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(12,17,r.visibleFieldProperties$)))},dependencies:[S.NgClass,S.NgForOf,S.NgIf,S.NgStyle,Ct.W,tt.V,qt.M,ci,S.AsyncPipe],styles:[".bucket.disabled[_ngcontent-%COMP%]{pointer-events:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;opacity:.5}"]}),i}(Zt.w),pi=function(){function o(i){this.services=i}return o.prototype.dropWithPayload=function(i){if(i&&!this.viewModel.disabled){var e=i,n=this.getSelectedVisual();if(e.sourceRole){T.fF.assert(function(){return $.isNumeric(e.sourceIndex)},"Unexpected drag source");var r=0;this.viewModel.properties.length>0&&(r=_.last(this.viewModel.properties).endIndex+1),e.sourceRole===this.viewModel.role&&(r=Math.max(r-(e.hierarchyLevelCount||1),0));var a=this.services.dataSources.get();this.services.visualAuthoring.moveField(e.sourceRole,this.viewModel.role,e.sourceIndex,r,e.hierarchyLevelCount||1,a,16===n?.visibility);var l=n?n.config.singleVisual.query.tryGetExpr(e.sourceRole,e.sourceIndex):null;return void this.logTelemetry(l,e.sourceRole,n)}i.field&&this.dropField(i.field)}},o.prototype.dropField=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return this.viewModel.disabled?[2,!1]:(n=this.getSelectedVisual())?(r=this.services.dataSources.get(),[4,this.services.visualAuthoring.addFieldInRole(i,this.viewModel.role,r,n,void 0,void 0,void 0,16===n?.visibility)]):[3,2];case 1:return e=s.sent(),[3,3];case 2:this.services.eventBridge.publishToChannel(k.Tyr,{expr:i,visualType:Qt.x.getDefaultVisualPlugin(this.services.featureSwitchService).name,targetRole:this.viewModel.role,allowAggregate:!0,telemetrySource:3,startAuthoringAfterAddition:!1}),e=!0,s.label=3;case 3:return this.logTelemetry(i,null),[2,e]}})})},o.prototype.logTelemetry=function(i,e,n){if(i){var r="Create";e&&(r="Update",this.services.telemetryService.logEvent(De.V1,{sourceBucketRole:e,targetBucketRole:this.viewModel.role,visualName:n&&n.name}));var a=(0,N.s)(this.getSelectedVisual()),s=Jt(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy);this.services.groupAuthoring.telemetry.logGroupsUsageTelemetry(s,i,a,this.viewModel.role,e,r)}},o.prototype.getSelectedVisual=function(){return Se.UP.getSelectedVisual(this.services.selection)},o}();function rr(o,i){1&o&&t.\u0275\u0275element(0,"field-well-bucket-modern",3),2&o&&t.\u0275\u0275property("viewModel",i.$implicit)}function or(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"ol"),t.\u0275\u0275template(1,rr,1,1,"field-well-bucket-modern",2),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",e.viewModel.buckets)}}var vi={},Tt=function(){function o(i,e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V){this.changeDetection=i,this.conceptualSchemaProxy=e,this.dataSources=n,this.displayNameService=r,this.eventBridge=a,this.explorationNavigation=s,this.groupingDesignStateService=l,this.featureSwitchService=u,this.lazyScoped=d,this.localizationService=v,this.runningVisualService=p,this.selectionService=f,this.showValueAsService=h,this.vcRef=m,this.visualPlugin=b,this.visibility=y,this.visualCalcEagerService=V}return o.prototype.ngOnInit=function(){return(0,g.mG)(this,void 0,void 0,function(){var i;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return i={$element:$(this.vcRef.element.nativeElement),conceptualSchemaProxy:this.conceptualSchemaProxy,dataSources:this.dataSources,explorationDisplayNameService:this.displayNameService,eventBridge:this.eventBridge,explorationNavigation:this.explorationNavigation,groupingDesignStateService:this.groupingDesignStateService,featureSwitchService:this.featureSwitchService,selection:this.selectionService,showValueAsService:this.showValueAsService,visualPlugin:this.visualPlugin,localizationService:this.localizationService,runningVisuals:this.runningVisualService,visibility:this.visibility,visualCalcEagerService:this.visualCalcEagerService,lazyScopedProvider:this.lazyScoped},this.core=new gi(i,!1,this.updateViewModel.bind(this)),[4,this.core.onInit()];case 1:return e.sent(),[2]}})})},o.prototype.ngOnDestroy=function(){this.core.onDestroy()},o.prototype.updateViewModel=function(i){this.viewModel=i,this.changeDetection.detectChanges()},o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275directiveInject(t.ChangeDetectorRef),t.\u0275\u0275directiveInject(Z.i),t.\u0275\u0275directiveInject(de.D),t.\u0275\u0275directiveInject(Je.O),t.\u0275\u0275directiveInject(oe.J),t.\u0275\u0275directiveInject(te.z),t.\u0275\u0275directiveInject(Mt.AA),t.\u0275\u0275directiveInject(le.vZ),t.\u0275\u0275directiveInject(_e.H),t.\u0275\u0275directiveInject(ce.o),t.\u0275\u0275directiveInject(xt.s),t.\u0275\u0275directiveInject(me.z),t.\u0275\u0275directiveInject(Ne.P),t.\u0275\u0275directiveInject(t.ViewContainerRef),t.\u0275\u0275directiveInject(Pe.D),t.\u0275\u0275directiveInject(Ie.w),t.\u0275\u0275directiveInject(Re.w))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["field-well-modern"]],decls:2,vars:1,consts:[[1,"fieldWell","unselectable"],[4,"ngIf"],["class","field-well-bucket-element","data-testid","field-well-bucket-element","role","listitem",3,"viewModel",4,"ngFor","ngForOf"],["data-testid","field-well-bucket-element","role","listitem",1,"field-well-bucket-element",3,"viewModel"]],template:function(e,n){1&e&&(t.\u0275\u0275elementStart(0,"section",0),t.\u0275\u0275template(1,or,2,1,"ol",1),t.\u0275\u0275elementEnd()),2&e&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",n.viewModel&&n.viewModel.buckets))},dependencies:[S.NgForOf,S.NgIf,di],styles:[".explorationContainer .fieldWell{overflow:auto}.explorationContainer .fieldWell .errorIcon{cursor:pointer;width:16px;height:16px;background-color:transparent;vertical-align:top}.explorationContainer .fieldWell .bucket{display:flex;flex-direction:column;padding-bottom:4px;color:var(--neutral-tertiary-alt-color, #C8C8C8);width:100%}.explorationContainer .fieldWell .bucket .bucket-header{display:flex;flex-direction:row;margin:6px 5px 6px 0;align-items:center}.explorationContainer .fieldWell .bucket .bucket-header .caption{box-sizing:border-box;margin-left:12px;font-weight:inherit;color:var(--white-color, #FFF)}.explorationContainer .fieldWell .bucket .bucket-header .caption:focus{outline:none}.explorationContainer .fieldWell .bucket .bucket-header .warning{flex:none;margin-top:auto;color:var(--data-color6, #8AD4EB);cursor:pointer}.explorationContainer .fieldWell .properties{float:left;min-height:28px;width:calc(100% - 10px);margin:0 4px;border:1px dashed var(--neutral-secondary-color, #666666);border-radius:4px;background-color:var(--neutral-primary-color-alt2, #4a4a4a);padding:1px 0}.explorationContainer .fieldWell .properties.dragover{border:1px dashed var(--theme-primary-color, #F2C811)!important}.explorationContainer .fieldWell .properties li:focus{outline:none}.explorationContainer .fieldWell .dropzone,.explorationContainer .fieldWell .end-dropzone{width:calc(100% - 4px);line-height:22px;padding-left:8px;margin:0 2px}.explorationContainer .fieldWell .end-dropzone.supports-multiple-items{height:7px;border-top:1px solid transparent}.explorationContainer .fieldWell .end-dropzone.supports-multiple-items.prepend{border-top-color:var(--theme-primary-color, #F2C811)!important}.explorationContainer .fieldWell .end-dropzone.supports-multiple-items:focus{outline:none}.explorationContainer .fieldWellProperty[drag]{position:relative;padding-left:4px;background:var(--neutral-primary-color, #333333);border-radius:3px;border:1px solid var(--neutral-dark-color, #212121);cursor:pointer}.explorationContainer .fieldWellProperty[drag].not-draggable,.explorationContainer .fieldWellProperty[drag].not-draggable .errorIcon,.explorationContainer .fieldWellProperty[drag].not-draggable .editableLabel .textLabel{cursor:default}.explorationContainer .fieldWellProperty[drag] .caption{color:var(--white-color, #FFF);line-height:21px}.explorationContainer .fieldWellProperty[drag] .field-glyph{float:left;margin:4px 4px 4px 2px}.explorationContainer .fieldWellProperty[drag] .error{float:left;width:16px;height:16px}.explorationContainer .fieldWellProperty[drag] .delete{width:16px;height:16px;color:var(--neutral-secondary-alt-color2, #888888);background:transparent}.explorationContainer .fieldWellProperty[drag] .hierarchyList{padding-left:8px;color:var(--white-color, #FFF)}.explorationContainer .fieldWellProperty[drag] .hierarchyList .subcaption{color:var(--white-color, #FFF);line-height:19px}.explorationContainer .fieldWellProperty[drag] .glyphicon{color:var(--white-color, #FFF)}.explorationContainer field-well-field-modern{border:solid var(--neutral-primary-color-alt2, #4a4a4a);display:block;border-width:1px 0;border-radius:3px;margin:0 2px}.explorationContainer field-well-field-modern.append{border-bottom-color:var(--theme-primary-color, #F2C811)!important}.explorationContainer field-well-field-modern.prepend{border-top-color:var(--theme-primary-color, #F2C811)!important}.explorationContainer field-well-field-modern .textInput{background:var(--neutral-tertiary-alt-color, #C8C8C8);color:var(--black-color, #000)}.explorationContainer field-well-field-modern .textInput::selection{background:var(--theme-primary-color, #F2C811)}.explorationContainer field-well-field-modern editable-label .textLabel{white-space:nowrap}.explorationContainer .fieldWellIcon{background-color:transparent}.explorationContainer .fieldWellIcon:hover,.explorationContainer .fieldWellIcon:focus,.explorationContainer .fieldWellIcon:active,.explorationContainer .fieldWellIcon:active:hover,.explorationContainer .fieldWellIcon:focus:hover{background-color:transparent}.explorationContainer .bucketTopBorder{border-bottom:1px solid transparent;border-radius:3px;margin:0 2px}.explorationContainer .bucketTopBorder.append{border-bottom-color:var(--theme-primary-color, #F2C811)}.newPaneColors.explorationContainer{--field-well-title-color: var(--gray-180, #252423);--field-well-background: var(--white-color, #FFF);--field-well-item-background: var(--gray-30, #EDEBE9);--field-well-item-border-color: var(--gray-60, #C8C6C4)}[data-legacy-theming=false] .newPaneColors.explorationContainer{--field-well-title-color: var(--colorNeutralForeground1);--field-well-background: var(--colorNeutralBackground3);--field-well-item-background: var(--colorNeutralBackground2);--field-well-item-border-color: var(--colorNeutralStroke1)}.newPaneColors.explorationContainer .fieldWell .bucket,.newPaneColors.explorationContainer .fieldWell .bucket .bucket-header .caption{color:var(--field-well-title-color)}html[data-focus-source=key] .newPaneColors.explorationContainer .fieldWell .bucket .bucket-header .caption:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}.newPaneColors.explorationContainer .fieldWell .properties{border-color:var(--field-well-item-border-color);background-color:var(--field-well-background);border-radius:2px}.newPaneColors.explorationContainer .fieldWell .properties.dragover{border-color:var(--gray-130, #605E5C)!important}html[data-focus-source=key] .newPaneColors.explorationContainer .fieldWell .properties li:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}html[data-focus-source=key] .newPaneColors.explorationContainer .fieldWell .errorIcon:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}.newPaneColors.explorationContainer .fieldWellProperty[drag]{background:var(--field-well-item-background);border-radius:2px;border-color:var(--field-well-item-border-color)}.newPaneColors.explorationContainer .fieldWellProperty[drag] .caption{color:var(--field-well-title-color)}.newPaneColors.explorationContainer .fieldWellProperty[drag] .caption input{background:var(--field-well-background);color:var(--field-well-title-color)}.newPaneColors.explorationContainer .fieldWellProperty[drag] .delete{color:var(--field-well-title-color)}html[data-focus-source=key] .newPaneColors.explorationContainer .fieldWellProperty[drag] .delete:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}.newPaneColors.explorationContainer .fieldWellProperty[drag] .hierarchyList,.newPaneColors.explorationContainer .fieldWellProperty[drag] .hierarchyList .subcaption{color:var(--field-well-title-color)}html[data-focus-source=key] .newPaneColors.explorationContainer .fieldWellProperty[drag] .hierarchyList .subcaption:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}.newPaneColors.explorationContainer .fieldWellProperty[drag] .glyphicon{color:var(--field-well-title-color)}.newPaneColors.explorationContainer field-well-field-modern{border-color:transparent;border-radius:2px}.newPaneColors.explorationContainer field-well-field-modern .textInput{background:var(--field-well-background);color:var(--field-well-title-color)}html[data-focus-source=key] .newPaneColors.explorationContainer field-well-field-modern editable-label:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}html[data-focus-source=key] .newPaneColors.explorationContainer .fieldWellIcon:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}.newPaneColors.explorationContainer .bucketTopBorder{border-radius:2px}\n"],encapsulation:2}),o}(),gi=function(){function o(i,e,n){this.services=i,this.disableHierarchyLevelGrouping=e,this.onViewModelChange=n,this.additionalSubscriptions=new On.w}return o.prototype.onInit=function(){return(0,g.mG)(this,void 0,void 0,function(){var i=this;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return this.viewModel=new Ze.KT([]),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(k.CCe,function(){return i.requestModelAndUpdate(!0)}).subscribe(k.tRg,function(){return i.requestModelAndUpdate()}).subscribe(k.KD7,function(){return i.requestModelAndUpdate()}).subscribe(k.y5h,function(){return i.requestModelAndUpdate(!0)}).subscribe(k.jCS,function(){return i.requestModelAndUpdate(!0)}).subscribe(k.Ah$,function(n,r){return i.onFieldWellFieldRemoved(r)}).subscribe(k.D1A,function(){return i.requestModelAndUpdate(!0)}).subscribe(k.oRp,function(){return i.requestModelAndUpdate()}),this.additionalSubscriptions.add(this.services.visualCalcEagerService.onContextChange$().subscribe(function(){return i.requestModelAndUpdate()})),this.additionalSubscriptions.add(Se.UP.getSelectedVisualContainer$(this.services.selection).pipe((0,D.h)(function(n){return!!n}),(0,nt.w)(function(n){return i.services.runningVisuals.getVisual$(n)}),(0,nt.w)(function(n){return n?n.getErrorInfo$():St.E})).subscribe(function(){return i.requestModelAndUpdate()})),[4,this.requestModelAndUpdate()];case 1:return[2,e.sent()]}})})},o.prototype.onDestroy=function(){this.subscriptionManager&&this.subscriptionManager.unsubscribeAll(),this.additionalSubscriptions.unsubscribe()},o.prototype.onFieldWellFieldRemoved=function(i){Kt.IK.focus(_.find(this.services.$element.find(".field-well-bucket-element .bucket .bucket-header .caption"),function(e){return $(e).html()===i}),!1)},o.prototype.requestModelAndUpdate=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n=this;return(0,g.Jh)(this,function(r){return(e=this.services.dataSources.get())?[2,this.services.conceptualSchemaProxy.get(e).then(function(a){return n.update(a,i)})]:[2]})})},o.prototype.update=function(i,e){var n;return(0,g.mG)(this,void 0,void 0,function(){var r,a,s,l,u,d,v,p=this;return(0,g.Jh)(this,function(f){switch(f.label){case 0:return[4,this.services.lazyScopedProvider.get("fieldWellViewModelService")];case 1:if(r=f.sent(),s=this.getSelectedVisual(),this.deferredCreateBuckets&&(this.deferredCreateBuckets.reject(vi),this.deferredCreateBuckets=void 0),i){if(s)return u=[new ar(this.services.explorationNavigation,this.services.localizationService)],d=16===(null===(n=this.services.visibility.get())||void 0===n?void 0:n.visibility),this.services.featureSwitchService.featureSwitches.cartesianMultiplesAuthoring||u.push(new sr(this.services.visualPlugin,s)),v=this.services.runningVisuals.getVisual(s),this.deferredCreateBuckets=r.createBuckets(v,s,i,this.services.groupingDesignStateService,this.services.showValueAsService,this.services.visualPlugin,this.services.explorationDisplayNameService,u,this.disableHierarchyLevelGrouping,d),[2,this.deferredCreateBuckets.promise.then(function(h){p.updateViewModel(h,e)},function(h){if(h!==vi)throw h}).finally(function(){p.deferredCreateBuckets=void 0})];l=(0,R.x3)(Qt.x.getDefaultVisualPlugin(this.services.featureSwitchService)),a=r.createEmptyBuckets(l,[]),this.updateViewModel(a,e)}else this.updateViewModel(a=null,e);return[2]}})})},o.prototype.updateViewModel=function(i,e){e&&(0,_n.L)(i,this.viewModel.buckets)||(this.viewModel.buckets=i,this.onViewModelChange&&this.onViewModelChange(this.viewModel))},o.prototype.getSelectedVisual=function(){return Se.UP.getSelectedVisual(this.services.selection)},o}(),ar=function(){function o(i,e){this.explorationNavigation=i,this.localizationService=e}return o.prototype.onBucketCreated=function(i,e,n,r,a,s,l){var u=e.config.singleVisual,d=s.capabilities(u.visualType),v=!d||!d.tooltips||void 0===d.tooltips.showByDefault||d.tooltips.showByDefault,p=(0,Pt.NA)(u.vcObjects,{objectName:"visualTooltip",propertyName:"show"},void 0);if((p||v)&&(!p||p.value)){var f=(0,Pt.NA)(u.vcObjects,{objectName:"visualTooltip",propertyName:"type"},void 0),h=(0,Pt.NA)(u.vcObjects,{objectName:"visualTooltip",propertyName:"section"},void 0),m=f&&f.value,y=h&&h.value;if((!m||m===Le.Xz)&&y&&y!==Le.pJ&&_.some(d.tooltips&&d.tooltips.roles,function(re){return re===i.role})){var O=h&&h.value,w=void 0;if(O===Le.pJ)w=l.get("ReportPage");else{var j=this.explorationNavigation.getAllSections(),ee=_.find(j,function(re){return re.name===O&&1===re.type});if(!ee)return;w=ee.displayName}var Y=new Ze.DR(w,null,null,"pbi-glyph-canvas-tooltip"),ae=new Ze.Ct(null,!1,!1);ae.disableInteractivity();var se=new Ze._d(void 0,i.role,-1,-1,!0,Y,ae,void 0,void 0,void 0,void 0);i.properties.push(se),i.warning=new Ze.kh("pbi-glyph-info",void 0,this.localizationService.get("FieldWellBucket_Warning_CanvasTooltipDescription"))}}},o.prototype.shouldCreateBucketForRole=function(i){return!0},o}(),sr=function(){function o(i,e){this.visualPluginService=i,this.visual=e}return o.prototype.onBucketCreated=function(i,e,n,r,a,s,l){},o.prototype.shouldCreateBucketForRole=function(i){var e=this.visualPluginService.capabilities(this.visual.config.singleVisual.visualType);return(0,Ht.hQ)(i,this.visual.config.singleVisual,e)},o}();function lr(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"section"),t.\u0275\u0275element(1,"visual-types-container-modern",5),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("visualPluginFilter",e.visualPluginFilter)}}function cr(o,i){1&o&&t.\u0275\u0275element(0,"spinner")}function ur(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"section",6),t.\u0275\u0275template(1,cr,1,0,"spinner",2),t.\u0275\u0275elementStart(2,"visual-types-container-modern",7),t.\u0275\u0275listener("isFinishedLoading",function(){t.\u0275\u0275restoreView(e);var a=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(a.onVisualTypesContainerDoneLoading())}),t.\u0275\u0275elementEnd()()}if(2&o){var n=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!n.isPersonalVisualTypesLoaded),t.\u0275\u0275advance(1),t.\u0275\u0275classProp("hidden",!n.isPersonalVisualTypesLoaded),t.\u0275\u0275property("visualPluginFilter",n.nonPersonalVisualizationPaneFilter)("disableMoreOptionsIcon",!0)}}function dr(o,i){1&o&&(t.\u0275\u0275elementStart(0,"section"),t.\u0275\u0275element(1,"field-well-modern"),t.\u0275\u0275elementEnd())}function pr(o,i){1&o&&(t.\u0275\u0275elementStart(0,"section"),t.\u0275\u0275element(1,"drillthrough-pane",9),t.\u0275\u0275elementEnd())}var vr=function(){return{ignoreOverlay:!1,ignoreMobile:!1}};function gr(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"div")(1,"div",8),t.\u0275\u0275template(2,dr,2,0,"section",2),t.\u0275\u0275template(3,pr,2,0,"section",2),t.\u0275\u0275elementEnd()()),2&o){var e=t.\u0275\u0275nextContext();t.\u0275\u0275classMap(e.fieldWellOrFiltersClass),t.\u0275\u0275advance(1),t.\u0275\u0275property("pbiScrollbar",t.\u0275\u0275pureFunction0(6,vr))("pbiScrollbarDisabled",e.disableScrollbar),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",e.showFieldWell),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",e.showDrillthroughPane)}}var Dt,hi=function(){function o(){this.disableScrollbar=!1}return o.prototype.onVisualTypesContainerDoneLoading=function(){this.isPersonalVisualTypesLoaded=!0},Object.defineProperty(o.prototype,"fieldWellOrFiltersClass",{get:function(){return this.disableScrollbar?"fieldWellOrFilters disableScrollbar":"fieldWellOrFilters enableScrollbar"},enumerable:!1,configurable:!0}),o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["build-section"]],inputs:{showVisualTypes:"showVisualTypes",showFieldWell:"showFieldWell",showDrillthroughPane:"showDrillthroughPane",showFieldWellOrFilters:"showFieldWellOrFilters",populatePanes:"populatePanes",visualPluginFilter:"visualPluginFilter",nonPersonalVisualizationPaneFilter:"nonPersonalVisualizationPaneFilter",showNonPersonalVisuals:"showNonPersonalVisuals",disableScrollbar:"disableScrollbar"},decls:5,vars:3,consts:[["section-animation-slider","",1,"pane-contents-modern","modern-format-pane"],[1,"visualTypesContainer"],[4,"ngIf"],["class","nonPersonalVisualizationPane",4,"ngIf"],[3,"class",4,"ngIf"],[3,"visualPluginFilter"],[1,"nonPersonalVisualizationPane"],[3,"visualPluginFilter","disableMoreOptionsIcon","isFinishedLoading"],[1,"scroller",3,"pbiScrollbar","pbiScrollbarDisabled"],[1,"modern"]],template:function(e,n){1&e&&(t.\u0275\u0275elementStart(0,"div",0)(1,"div",1),t.\u0275\u0275template(2,lr,2,1,"section",2),t.\u0275\u0275template(3,ur,3,5,"section",3),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(4,gr,4,7,"div",4),t.\u0275\u0275elementEnd()),2&e&&(t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",n.showVisualTypes),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",n.showVisualTypes&&n.showNonPersonalVisuals),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",n.showFieldWellOrFilters))},dependencies:[S.NgIf,Gt.R,gn.r,hn.O,F.r,bt,Tt],styles:['.pane-contents-modern[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;margin-top:2px}.hidden[_ngcontent-%COMP%]{display:none}.nonPersonalVisualizationPane[_ngcontent-%COMP%]{margin-top:4px;padding-top:4px;border-top:1px dashed var(--gray-40, #E1DFDD)}.fieldWellOrFilters[_ngcontent-%COMP%]{border-top:1px solid var(--gray-40, #E1DFDD);padding-top:2px;flex-basis:0;flex-grow:1}.disableScrollbar[_ngcontent-%COMP%]{overflow:unset;padding-right:"6px";padding-left:"6px"}.enableScrollbar[_ngcontent-%COMP%]{overflow:hidden}.visualTypesContainer[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:2px 6px;margin-bottom:4px}']}),o}(),Ve=c(41887),ke=c(80981);!function(o){function i(r,a,s,l,u,d){if(r&&function(r,a){var s=r.config.singleVisual,u=s.query;if(u)return a.capabilities(s.visualType).supportsSynchronizingFilterState&&u.hasProjections()}(r,a))return new hr(r,u,d,s,l)}o.create=i,o.createObservable=function(r,a,s,l,u,d,v,p){var f=this,h=new L.X(void 0);a.get(s.get()).then(function(V){return h.next(V)});var y,m=new L.X(Se.UP.getSelectedVisual(l)),b=new L.X(v.getCurrentExploration());return r.subscribe(k.jCS,function(V,P){if(1!==P.visualContainerChangeType){var O=Se.UP.getSelectedVisual(l);O&&P.affectContainer(O)&&m.next(O)}}).subscribe(k.tRg,function(){m.next(Se.UP.getSelectedVisual(l))}).subscribe(k.UpY,function(){y=!0}).subscribe(k.t4l,function(){b.next(v.getCurrentExploration())}).subscribe(k.LE3,function(){b.next(v.getCurrentExploration())}).subscribeAsync(k.CCe,function(){return(0,g.mG)(f,void 0,void 0,function(){var V;return(0,g.Jh)(this,function(P){switch(P.label){case 0:return[4,a.get(s.get())];case 1:return V=P.sent(),y=!1,h.next(V),[2]}})})}).subscribe(k.KD7,function(){return m.next(Se.UP.getSelectedVisual(l))}).subscribe(k.TTT,function(){b.next(v.getCurrentExploration())}).subscribe(k.HGU,function(){b.next(v.getCurrentExploration())}),(0,Fe.aj)([h,m,b]).pipe((0,D.h)(function(){return!y}),(0,U.U)(function(V){var P=V[0],O=V[1],w=V[2];if(O&&P&&w)return i(O,u,p,d,w,P)}))}}(Dt||(Dt={}));var hr=function(){return function(i,e,n,r,a){this.sourceVisual=i,this.exploration=e,this.schema=n,this.localizationService=r,this.visualSyncService=a,this.pageSyncItems=[];var s=function(o,i,e,n,r){return o.syncGroup?function(o,i,e){var n=Xe(o);T.fF.assertValue(n,"source visual should be in a group");for(var r=[],a={},s=0,l=i.sections;s<l.length;s++){for(var u=l[s],d=e.format("SyncGroupPane_SyncCheckboxLabel",[u.displayName]),v=e.format("SyncGroupPane_VisibleCheckboxLabel",[u.displayName]),p=void 0,f=[],h=[],m=0,b=u.visualContainers;m<b.length;m++){var V=(y=b[m]).config.singleVisual,P=Xe(V);P?(a[P]=!0,V===o?p=y:P===n&&h.push(y)):fi(o,V)&&f.push(y)}if(p)r.push({section:u,synced:!!n,visible:!(0,ke.xj)(o),visualContainer:p,isSourceVisual:!0,syncCheckboxAriaLabel:d,visibleCheckboxAriaLabel:v});else if(_.some(h))r.push(1===h.length?{section:u,synced:!0,visible:!(0,ke.xj)((y=h[0]).config.singleVisual),visualContainer:y,syncCheckboxAriaLabel:d,visibleCheckboxAriaLabel:v}:{disabledReason:1,section:u,synced:!0,visible:_.some(h,function(O){return!(0,ke.xj)(O.config.singleVisual)}),visualContainer:h[0],syncCheckboxAriaLabel:d,visibleCheckboxAriaLabel:v});else if(1===f.length){var y;r.push({section:u,synced:!1,visible:!(0,ke.xj)((y=f[0]).config.singleVisual),visualContainer:y,syncCheckboxAriaLabel:d,visibleCheckboxAriaLabel:v})}else r.push({section:u,synced:!1,visible:!1,syncCheckboxAriaLabel:d,visibleCheckboxAriaLabel:v})}return T.fF.assert(function(){return r.length===i.sections.length},"expected a single sync group item for each section"),{state:0,items:r,activeSyncGroup:n}}(o,i,r):function(o,i,e,n,r){T.fF.assert(function(){return!o.syncGroup},"expected visual to be ungrouped");for(var d,a={},s={},l={},u=-1,v=[],p=0;p<i.sections.length;p++){var h=r.format("SyncGroupPane_SyncCheckboxLabel",[(f=i.sections[p]).displayName]),m=r.format("SyncGroupPane_VisibleCheckboxLabel",[f.displayName]);v[p]={};for(var b=void 0,y={},V=0,P=f.visualContainers;V<P.length;V++){var O=P[V],w=O.config.singleVisual,j=Xe(w);if(w===o&&(b=d=O,u=p),j&&(a[j]=!0),fi(o,w)){j&&(s[j]=!0,y[j]=!0,b&&(l[j]=!0));var ee=v[p][j];ee&&w!==o?b||(v[p][j]=j?{disabledReason:1,synced:!0,section:f,visible:ee.visible||!(0,ke.xj)(w),syncCheckboxAriaLabel:h,visibleCheckboxAriaLabel:m}:{synced:!1,section:f,visible:!1,syncCheckboxAriaLabel:h,visibleCheckboxAriaLabel:m}):v[p][j]={synced:!!j,section:f,visible:!(0,ke.xj)(w),visualContainer:O,syncCheckboxAriaLabel:h,visibleCheckboxAriaLabel:m}}}b&&(l=y)}for(var Y in l)delete s[Y];var ae=Object.keys(s),se=Xe(null),re=1===ae.length?ae[0]:se,he=[];for(p=0;p<i.sections.length;p++){var f;h=r.format("SyncGroupPane_SyncCheckboxLabel",[(f=i.sections[p]).displayName]),m=r.format("SyncGroupPane_VisibleCheckboxLabel",[f.displayName]),he.push(p===u?{section:f,synced:!!o.syncGroup,visible:!(0,ke.xj)(o),visualContainer:d,isSourceVisual:!0,syncCheckboxAriaLabel:h,visibleCheckboxAriaLabel:m}:v[p][re]||v[p][se]||{section:f,synced:!1,visible:!1,syncCheckboxAriaLabel:h,visibleCheckboxAriaLabel:m})}return T.fF.assert(function(){return he.length===i.sections.length},"expected a single sync group item for each section"),{state:0,items:he,activeSyncGroup:re||e.generateUniqueGroupName(n,o,a)}}(o,i,e,n,r)}(this.sourceVisual.config.singleVisual,this.exploration,this.visualSyncService,this.schema,this.localizationService),l=this.sourceVisual.config.singleVisual;this.pageSyncItems=s.items,this.syncFields=l.syncGroup&&l.syncGroup.fieldChanges,this.syncFilters=l.syncGroup&&l.syncGroup.filterChanges,this.sourceVisualSyncGroup=Xe(l),this.activeSyncGroup=s.activeSyncGroup,this.status=s.state}}();function fi(o,i){if(i.visualType!==o.visualType)return!1;var e=i.query&&i.query.defn&&i.query.defn.select(),n=o.query&&o.query.defn&&o.query.defn.select();return!_.isEmpty(n)&&!_.isEmpty(e)&&n.length===e.length&&(1===n.length?(0,xe.fS)(n[0].expr,e[0].expr):!_.differenceWith(n,e,function(a,s){return(0,xe.fS)(a.expr,s.expr)}).length)}function Xe(o){return o&&o.syncGroup&&o.syncGroup.groupName||null}var mi=c(64647),Vt=c(69474),Et=c(3404),Ye=c(84281),lt=c(17328),yi=c(21024),qe=c(27980),Cr=c(64370),br=c(59968),Pr=c(50057),Sr=c(54932),Ci=c(35756),xr=c(56011),Mr=c(86663),bi=c(21023),Pi=c(24548);function _r(o,i){1&o&&(t.\u0275\u0275elementStart(0,"pbi-pane-section"),t.\u0275\u0275element(1,"legend",4),t.\u0275\u0275elementEnd()),2&o&&(t.\u0275\u0275advance(1),t.\u0275\u0275property("id","syncGroupDescriptionLegend"))}function Or(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",10)(1,"div",21),t.\u0275\u0275listener("click",function(){var l=t.\u0275\u0275restoreView(e).$implicit,u=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(u.navigateAndSelectVisual(l))}),t.\u0275\u0275elementStart(2,"label",22),t.\u0275\u0275text(3),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(4,"div",23)(5,"pbi-checkbox",24),t.\u0275\u0275listener("onChange",function(s){var u=t.\u0275\u0275restoreView(e).$implicit,d=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(d.onSyncCheckChanged(u,s))}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(6,"div",23)(7,"pbi-checkbox",25),t.\u0275\u0275listener("onChange",function(s){var u=t.\u0275\u0275restoreView(e).$implicit,d=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(d.onVisibleCheckChanged(u,s))}),t.\u0275\u0275elementEnd()()()}if(2&o){var n=i.$implicit,r=t.\u0275\u0275nextContext(3);t.\u0275\u0275classProp("navigatable",n.visualContainer)("currentPage",n.isSourceVisual),t.\u0275\u0275advance(2),t.\u0275\u0275attribute("title",n.section.displayName)("role",n.visualContainer?"button":null)("tabindex",n.visualContainer?0:null)("aria-label",n.visualContainer?r.ariaNavigateDescription:null),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",n.section.displayName," "),t.\u0275\u0275advance(2),t.\u0275\u0275property("isCompact",!0)("ariaLabel",n.syncCheckboxAriaLabel)("checked",n.synced)("disabled",!!n.disabledReason),t.\u0275\u0275advance(2),t.\u0275\u0275property("isCompact",!0)("ariaLabel",n.visibleCheckboxAriaLabel)("disabled",!!n.disabledReason)("checked",n.visible)}}function wr(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",26),t.\u0275\u0275element(1,"label",27),t.\u0275\u0275elementStart(2,"input",28),t.\u0275\u0275listener("ngModelChange",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(s.onSourceVisualSyncGroupChanged(a))}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"pbi-checkbox",29),t.\u0275\u0275listener("onChange",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(s.onSyncFieldsCheckChanged(a))}),t.\u0275\u0275pipe(4,"localize"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(5,"pbi-checkbox",29),t.\u0275\u0275listener("onChange",function(a){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(s.onSyncFiltersCheckChanged(a))}),t.\u0275\u0275pipe(6,"localize"),t.\u0275\u0275elementEnd()()}if(2&o){var n=t.\u0275\u0275nextContext(3);t.\u0275\u0275advance(2),t.\u0275\u0275property("ngModel",n.syncViewModel.sourceVisualSyncGroup),t.\u0275\u0275attribute("aria-label",n.ariaSyncGroupName),t.\u0275\u0275advance(1),t.\u0275\u0275property("isCompact",!0)("disabled",!n.syncViewModel.sourceVisualSyncGroup)("label",t.\u0275\u0275pipeBind1(4,12,"SyncGroupPane_SyncFieldsLabel"))("ariaLabel",n.ariaSyncFieldCheckbox)("checked",n.syncViewModel.syncFields),t.\u0275\u0275advance(2),t.\u0275\u0275property("isCompact",!0)("disabled",!n.syncViewModel.sourceVisualSyncGroup)("label",t.\u0275\u0275pipeBind1(6,14,"SyncGroupPane_SyncFiltersLabel"))("ariaLabel",n.ariaSyncFiltersCheckbox)("checked",n.syncViewModel.syncFilters)}}function Fr(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"pbi-pane-section",5)(1,"pbi-pane-section",6)(2,"legend",7)(3,"span",8),t.\u0275\u0275listener("accessible-click",function(){t.\u0275\u0275restoreView(e);var a=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(a.syncToAll())}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(4,"div",9)(5,"div",10),t.\u0275\u0275element(6,"div",11),t.\u0275\u0275elementStart(7,"div",12),t.\u0275\u0275element(8,"pbi-icon",13),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(9,"div",12),t.\u0275\u0275element(10,"pbi-icon",14),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(11,Or,8,17,"div",15),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(12,"pbi-pane-section",16)(13,"div",17),t.\u0275\u0275listener("accessible-click",function(){t.\u0275\u0275restoreView(e);var a=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(a.toggleShowAdvancedOptions())}),t.\u0275\u0275element(14,"pbi-icon",18)(15,"legend",19),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(16,wr,7,16,"div",20),t.\u0275\u0275elementEnd()()}if(2&o){var n=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(8),t.\u0275\u0275attribute("aria-label",n.ariaSyncDescription),t.\u0275\u0275advance(2),t.\u0275\u0275attribute("aria-label",n.ariaVisibilityDescription),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",n.syncViewModel.pageSyncItems)("ngForTrackBy",n.trackPageSyncItemBy),t.\u0275\u0275advance(1),t.\u0275\u0275classProp("expandedAdvancedOptions",n.showAdvancedOptions),t.\u0275\u0275advance(4),t.\u0275\u0275property("ngIf",n.showAdvancedOptions)}}function Tr(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"pbi-pane",1),t.\u0275\u0275listener("onCollapse",function(){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.onPaneCollapsed())})("onToggle",function(){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.onTogglePane())}),t.\u0275\u0275template(1,_r,2,1,"pbi-pane-section",2),t.\u0275\u0275template(2,Fr,17,7,"pbi-pane-section",3),t.\u0275\u0275elementEnd()}if(2&o){var n=i.ngIf,r=t.\u0275\u0275nextContext();t.\u0275\u0275property("expanded",n.isPaneExpanded)("allowToggle",!r.onObject)("title",n.title)("optionsSetting",n.optionsSetting)("ariaDescribedBy","syncGroupDescriptionLegend")("showCollapse",r.onObject),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!r.syncViewModel||0!==r.syncViewModel.status),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",r.syncViewModel&&0===r.syncViewModel.status)}}var Si=function(){function o(i,e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V,P,O,w){this.conceptualSchemaProxy=i,this.highContrastCssGenerationService=e,this.dataSources=n,this.eventBridge=r,this.explorationActivity=a,this.explorationCapabilities=s,this.explorationNavigation=l,this.explorationSerializer=u,this.featureSwitchService=d,this.telemetryService=v,this.formFactor=p,this.localizationService=f,this.panesVisibility=h,this.selection=m,this.undoRedo=b,this.visualAuthoring=y,this.visualAuthoringOperations=V,this.visualPlugin=P,this.visualSync=O,this.changeDetectorRef=w,this.paneViewModel$=this.panesVisibility.getPanes$().pipe((0,U.U)(function(j){return j.syncSlicers})),this.newPaneColorsEnabled=this.explorationCapabilities.getCapabilities().showFluentDesign||this.featureSwitchService.featureSwitches&&this.featureSwitchService.featureSwitches.paneColorRefresh,this.initializeHighContrastRules(),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.subscriptionManager=this.eventBridge.createChannelSubscriptionManager()}return o.prototype.ngOnInit=function(){var i=this;this.ariaSyncFieldCheckbox=this.localizationService.get("SyncGroupPane_SyncFieldsLabel"),this.ariaSyncFilterCheckbox=this.localizationService.get("SyncGroupPane_SyncFiltersLabel"),this.ariaSyncGroupName=this.localizationService.get("SyncGroupPane_GroupNameLabel"),this.ariaSyncDescription=this.localizationService.get("Sync"),this.ariaVisibilityDescription=this.localizationService.get("Visible"),this.ariaNavigateDescription=this.localizationService.get("SyncGroupPane_NavigateDescription");var e=Dt.createObservable(this.subscriptionManager,this.conceptualSchemaProxy,this.dataSources,this.selection,this.visualPlugin,this.visualSync,this.explorationNavigation,this.localizationService);this.viewModelSubscription=e.subscribe(function(n){i.syncViewModel=n,i.changeDetectorRef.markForCheck()})},o.prototype.ngOnDestroy=function(){this.subscriptionManager.unsubscribeAll(),this.viewModelSubscription.unsubscribe()},Object.defineProperty(o.prototype,"onObject",{get:function(){return this.featureSwitchService.featureSwitches.onObject},enumerable:!1,configurable:!0}),o.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule(".themeableElement .advancedOptionsToggle:focus, .themeableElement .advancedOptionsToggle:focus-within, .themeableElement .advancedOptionsToggle:hover","{ color: @selectedForegroundColor !important; background-color: @selectedBackgroundColor !important; outline: none; }")},o.prototype.getVisibleCheckboxAriaLabel=function(i){return this.localizationService.format("SyncGroupPane_VisibleCheckboxLabel",[i.section.displayName])},o.prototype.syncToAll=function(){return(0,g.mG)(this,void 0,void 0,function(){var i=this;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return this.undoRedo.register("SyncToAll",function(){for(var n=0,r=i.syncViewModel.pageSyncItems;n<r.length;n++){var a=r[n];!a.synced&&!a.disabledReason&&i.syncItem(a)}}),[4,this.visualSync.syncFilterState(this.syncViewModel.sourceVisual,!0)];case 1:return e.sent(),[2]}})})},o.prototype.onSyncCheckChanged=function(i,e){return(0,g.mG)(this,void 0,void 0,function(){var r=this;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return this.undoRedo.register("Sync changed",function(){e?r.syncItem(i):xi(r.visualAuthoringOperations,r.eventBridge,i.visualContainer)}),e?[4,this.visualSync.syncFilterState(this.syncViewModel.sourceVisual.config.singleVisual.syncGroup?this.syncViewModel.sourceVisual:i.visualContainer,!0)]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})},o.prototype.onSyncFieldsCheckChanged=function(i){var e=this;this.undoRedo.register("Sync fields changed",function(){e.visualAuthoringOperations.assignSyncGroup(e.syncViewModel.sourceVisual,(0,g.pi)((0,g.pi)({},e.syncViewModel.sourceVisual.config.singleVisual.syncGroup),{fieldChanges:i}))})},o.prototype.onSyncFiltersCheckChanged=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e=this;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return this.undoRedo.register("Sync fields changed",function(){e.visualAuthoringOperations.assignSyncGroup(e.syncViewModel.sourceVisual,(0,g.pi)((0,g.pi)({},e.syncViewModel.sourceVisual.config.singleVisual.syncGroup),{filterChanges:i}))}),i?[4,this.visualSync.syncVisualFiltersState(this.syncViewModel.sourceVisual)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},o.prototype.onVisibleCheckChanged=function(i,e){var n=this;this.undoRedo.register("Visible changed",function(){i.visualContainer?Mi(n.visualAuthoringOperations,n.eventBridge,i.visualContainer,e):n.syncItem(i)})},o.prototype.onSourceVisualSyncGroupChanged=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n=this;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return e=!!i,this.undoRedo.register("Sync group changed",function(){e?It(n.visualAuthoringOperations,n.syncViewModel.sourceVisual,i):xi(n.visualAuthoringOperations,n.eventBridge,n.syncViewModel.sourceVisual)}),e?[4,this.visualSync.syncFilterState(this.syncViewModel.sourceVisual,!0)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},o.prototype.onTogglePane=function(){this.panesVisibility.togglePaneExpansion("syncSlicers")},o.prototype.onPaneCollapsed=function(){this.panesVisibility.setPaneExpansion("syncSlicers",!1)},o.prototype.toggleShowAdvancedOptions=function(){this.showAdvancedOptions=!this.showAdvancedOptions},o.prototype.trackPageSyncItemBy=function(i,e){return e.section.name},o.prototype.navigateAndSelectVisual=function(i){var e=this;this.undoRedo.register("Navigate and select",function(){e.explorationActivity.doRootActivity(function(n){var r=e.syncViewModel.exploration.sections.indexOf(i.section);r<0||!i.visualContainer||(e.explorationNavigation.updateActiveSection({targetSectionIndex:r,parentActivity:n}),Se.UP.selectCanvasItem(i.visualContainer,e.selection))},function(){return e.telemetryService.startChildActivity(void 0,De.Es)})})},o.prototype.syncItem=function(i){if(i.visualContainer)It(this.visualAuthoringOperations,i.visualContainer,this.syncViewModel.activeSyncGroup);else{var e=(0,Ve.Mt)(this.explorationSerializer.serializeVisualContainer(this.syncViewModel.sourceVisual),this.syncViewModel.exploration,i.section,this.explorationSerializer,this.formFactor,this.visualAuthoring);It(this.visualAuthoringOperations,e,this.syncViewModel.activeSyncGroup)}},o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275directiveInject(Z.i),t.\u0275\u0275directiveInject(mi.g),t.\u0275\u0275directiveInject(de.D),t.\u0275\u0275directiveInject(oe.J),t.\u0275\u0275directiveInject(Vt.Z),t.\u0275\u0275directiveInject(yt.U),t.\u0275\u0275directiveInject(te.z),t.\u0275\u0275directiveInject(Et.L),t.\u0275\u0275directiveInject(le.vZ),t.\u0275\u0275directiveInject(ve.y0),t.\u0275\u0275directiveInject(lt.F),t.\u0275\u0275directiveInject(ce.o),t.\u0275\u0275directiveInject(yi.r),t.\u0275\u0275directiveInject(me.z),t.\u0275\u0275directiveInject(Ye.z),t.\u0275\u0275directiveInject(fe.$8),t.\u0275\u0275directiveInject(qe.Q),t.\u0275\u0275directiveInject(Pe.D),t.\u0275\u0275directiveInject(Cr.M),t.\u0275\u0275directiveInject(t.ChangeDetectorRef))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["sync-group-pane"]],decls:2,vars:3,consts:[["focus-nav-mode","Group","disableScroll","","noPadding","","pbiAutoFocus","","keyboard-shortcuts","ctrl-F6","focus-priority","8",3,"expanded","allowToggle","title","optionsSetting","ariaDescribedBy","showCollapse","onCollapse","onToggle",4,"ngIf"],["focus-nav-mode","Group","disableScroll","","noPadding","","pbiAutoFocus","","keyboard-shortcuts","ctrl-F6","focus-priority","8",3,"expanded","allowToggle","title","optionsSetting","ariaDescribedBy","showCollapse","onCollapse","onToggle"],[4,"ngIf"],["class","syncGroupPane","noPadding","",4,"ngIf"],["localize","SyncGroupPane_SelectSlicer",1,"selectionInstructions",3,"id"],["noPadding","",1,"syncGroupPane"],[1,"syncGroupSection"],["localize","SyncGroupPane_Description","localize-fragments","",1,"syncGroupDescription"],["tabindex","0","role","button","fragment-index","0","localize","SyncGroupPane_AddToAll",1,"syncAllButton",3,"accessible-click"],["data-testid","sync-group-table","role","table",1,"syncGroupTable"],["role","row",1,"row"],["role","columnheader","localize","PageName",1,"headerCell","columnPageName","trimmedTextWithEllipsis"],["role","columnheader",1,"headerCell","columnCheckbox"],["size","mini","role","img","name","filtersync","localize-tooltip","Sync"],["role","img","size","mini","name","show","localize-tooltip","Visible",1,"visibility"],["role","row","class","row",3,"navigatable","currentPage",4,"ngFor","ngForOf","ngForTrackBy"],["noPadding","",1,"advancedOptions"],["tabindex","0",1,"advancedOptionsToggle",3,"accessible-click"],["size","mini","name","chevrondownsmall",1,"advancedOptionsCaret"],["localize","AdvancedOptions",1,"advancedOptionsLabel"],["class","advancedOptionsContent",4,"ngIf"],["role","rowheader",1,"bodyCell","columnPageName",3,"click"],[1,"trimmedTextWithEllipsis"],["role","cell",1,"bodyCell","columnCheckbox"],["localize-tooltip","SyncGroupPane_SyncTooltip",3,"isCompact","ariaLabel","checked","disabled","onChange"],["localize-tooltip","SyncGroupPane_VisibleTooltip",3,"isCompact","ariaLabel","disabled","checked","onChange"],[1,"advancedOptionsContent"],["localize","SyncGroupPane_GroupNameLabel",1,"groupNameLabel"],["maxlength","250",1,"groupNameInput",3,"ngModel","ngModelChange"],[1,"syncFieldsCheckbox",3,"isCompact","disabled","label","ariaLabel","checked","onChange"]],template:function(e,n){1&e&&(t.\u0275\u0275template(0,Tr,3,8,"pbi-pane",0),t.\u0275\u0275pipe(1,"async")),2&e&&t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(1,1,n.paneViewModel$))},dependencies:[S.NgForOf,S.NgIf,Te.Fj,Te.JJ,Te.nD,Te.On,br.X,Pr.r,si.t,Sr.r,Ci.q,xr.v,Mr._,bi.VO,Pi.i,S.AsyncPipe,ht.F],styles:["[_nghost-%COMP%]{display:flex;flex-grow:1;flex-direction:column}.syncGroupPane[_ngcontent-%COMP%]{--sync-slicers-link-color: var(--fluent-theme-link-color, #0078D4);--sync-slicers-link-hover-color: var(--fluent-theme-dark-color, #A98C0C);--sync-slicers-row-hover-background-color: var(--gray-30, #EDEBE9);--sync-slicers-advanced-pane-hover-background-color: var(--gray-30, #EDEBE9);--sync-slicers-input-border-color: var(--gray-120, #797775);--sync-slicers-input-background-color: var(--fluent-theme-white-color, #FFF);--sync-slicers-advanced-button-border-color: var(--gray-40, #E1DFDD);--sync-slicers-table-border-color: var(--gray-60, #C8C6C4);--sync-slicers-table-header-background: var(--fluent-theme-neutral-quarter-alt-color, #E1DFDD);--sync-slicers-table-header-border-color: var(--fluent-theme-neutral-tertiary-alt-color, #C8C6C4);flex-grow:1;overflow:auto}  [data-legacy-theming=false] .syncGroupPane{--sync-slicers-link-color: var(--colorBrandForegroundLink);--sync-slicers-link-hover-color: var(--colorBrandForegroundLinkHover);--sync-slicers-row-hover-background-color: var(--colorNeutralBackground1Hover);--sync-slicers-advanced-pane-hover-background-color: var(--colorNeutralBackground1Hover);--sync-slicers-input-border-color: var(--colorNeutralStroke1);--sync-slicers-input-background-color: var(--colorNeutralBackground1);--sync-slicers-advanced-button-border-color: var(--colorNeutralStroke1);--sync-slicers-table-border-color: var(--colorNeutralStroke1);--sync-slicers-table-header-background: var(--colorNeutralBackground1);--sync-slicers-table-header-border-color: var(--colorNeutralStroke1)}.syncGroupPane[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%], .syncGroupPane[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:default}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupSection[_ngcontent-%COMP%]{display:flex;flex-direction:column}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupDescription[_ngcontent-%COMP%]{margin-bottom:4px}.syncGroupPane[_ngcontent-%COMP%]   .syncAllButton[_ngcontent-%COMP%]{color:var(--sync-slicers-link-color)}.syncGroupPane[_ngcontent-%COMP%]   .syncAllButton[_ngcontent-%COMP%]:hover, .syncGroupPane[_ngcontent-%COMP%]   .syncAllButton[_ngcontent-%COMP%]:focus{cursor:pointer;text-decoration:underline}html[data-focus-source=key][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncAllButton[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}html[data-focus-source=mouse][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncAllButton[_ngcontent-%COMP%]:focus, html[data-focus-source=program][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncAllButton[_ngcontent-%COMP%]:focus{outline:none}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]{border:1px solid var(--sync-slicers-table-border-color)}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex}html[data-focus-source=key][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:focus-within{background:var(--fluent-theme-neutral-secondary-color, #605E5C)}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.navigatable[_ngcontent-%COMP%]:hover{background:var(--sync-slicers-row-hover-background-color)}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.navigatable[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.navigatable[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]{cursor:pointer;color:var(--sync-slicers-link-color)}html[data-focus-source][_ngcontent-%COMP%]:not([data-focus-source=key])   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.navigatable[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:focus, html[data-focus-source][_ngcontent-%COMP%]:not([data-focus-source=key])   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.navigatable[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]:focus{outline:none}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.currentPage[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]{color:var(--sync-slicers-link-color)}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.currentPage[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]:hover{color:var(--sync-slicers-link-hover-color)}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .headerCell[_ngcontent-%COMP%]{height:20px;border-style:solid;border-width:0 0 1px 1px;background:var(--sync-slicers-table-header-background);border-color:var(--sync-slicers-table-header-border-color)}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .headerCell.columnPageName[_ngcontent-%COMP%]{text-align:left;cursor:default}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .headerCell[_ngcontent-%COMP%]   pbi-icon.visibility[_ngcontent-%COMP%]   .glyphicon[_ngcontent-%COMP%]{font-size:13px}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .bodyCell[_ngcontent-%COMP%]{border-left:1px solid var(--fluent-theme-neutral-secondary-color, #605E5C);padding:2px 0}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .columnCheckbox[_ngcontent-%COMP%], .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .columnVisible[_ngcontent-%COMP%]{width:24px;display:flex;align-items:center;justify-content:center;flex:0 0 auto}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;border-left:0;overflow:hidden;white-space:nowrap}.syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{flex:1;display:block;padding-left:2px}.syncGroupPane[_ngcontent-%COMP%]   pbi-checkbox[_ngcontent-%COMP%]{margin-bottom:0}.syncGroupPane[_ngcontent-%COMP%]   .advancedOptions[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;margin-top:12px}.syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsContent[_ngcontent-%COMP%]{padding:8px}.syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsCaret[_ngcontent-%COMP%]{transform:rotate(-90deg);transition:transform .25s ease-out;display:flex}.syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]{height:36px;padding:4px 4px 4px 12px;display:flex;align-items:center;border:1px solid var(--sync-slicers-advanced-button-border-color);border-style:solid none;cursor:pointer}.syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]:hover{background:var(--sync-slicers-advanced-pane-hover-background-color)}html[data-focus-source=key][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}html[data-focus-source=mouse][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]:focus, html[data-focus-source=program][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]:focus{outline:none}.syncGroupPane[_ngcontent-%COMP%]   .expandedAdvancedOptions[_ngcontent-%COMP%]   .advancedOptionsCaret[_ngcontent-%COMP%]{transform:rotate(0)}.syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsLabel[_ngcontent-%COMP%]{display:inline;margin-left:8px;cursor:pointer}.syncGroupPane[_ngcontent-%COMP%]   .groupNameLabel[_ngcontent-%COMP%]{white-space:normal}.syncGroupPane[_ngcontent-%COMP%]   .groupNameInput[_ngcontent-%COMP%]{display:block;width:100%;height:24px;margin-top:8px;padding-left:4px;border:1px solid var(--sync-slicers-input-border-color);background:var(--sync-slicers-input-background-color)}.syncGroupPane[_ngcontent-%COMP%]   .groupNameInput[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}.syncGroupPane[_ngcontent-%COMP%]   .syncFieldsCheckbox[_ngcontent-%COMP%]{margin-top:8px}html[data-focus-source=key][_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncFieldsCheckbox[_ngcontent-%COMP%]:focus-within{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncAllButton[_ngcontent-%COMP%]{color:var(--fluent-theme-link-color, #0078D4)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]{border-color:var(--gray-60, #C8C6C4)}html[data-focus-source=key][_ngcontent-%COMP%]   .newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:focus-within{background:var(--gray-30, #EDEBE9)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.navigatable[_ngcontent-%COMP%]:hover{background:var(--gray-30, #EDEBE9)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.currentPage[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]{color:var(--fluent-theme-link-color, #0078D4)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .row.currentPage[_ngcontent-%COMP%]   .columnPageName[_ngcontent-%COMP%]:hover{color:var(--fluent-theme-dark-color, #A98C0C)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .headerCell[_ngcontent-%COMP%]{background:var(--gray-40, #E1DFDD);border-color:var(--gray-60, #C8C6C4)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .syncGroupTable[_ngcontent-%COMP%]   .bodyCell[_ngcontent-%COMP%]{border-color:var(--gray-60, #C8C6C4)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsContent[_ngcontent-%COMP%]{background:var(--gray-20, #F3F2F1)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]{border-color:var(--gray-40, #E1DFDD)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]:hover, .newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]:focus, .newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .advancedOptionsToggle[_ngcontent-%COMP%]:focus-within{background:var(--gray-30, #EDEBE9)}.newPaneColors.explorationContainer[_ngcontent-%COMP%]   .syncGroupPane[_ngcontent-%COMP%]   .groupNameInput[_ngcontent-%COMP%]{background:var(--fluent-theme-white-color, #FFF);border-color:var(--gray-60, #C8C6C4)}"],changeDetection:0}),o}();function xi(o,i,e){o.clearSyncGroup(e),Mi(o,i,e,!0)}function Mi(o,i,e,n){o.setVisibility(e,!n,!0),o.notifyVisualContainers([e]),i.publishToChannel(k.cyb,{changedItems:[e]})}function It(o,i,e){var n=i.config.singleVisual.syncGroup;o.assignSyncGroup(i,n?(0,g.pi)((0,g.pi)({},n),{groupName:e}):{groupName:e,fieldChanges:!0,filterChanges:!0})}c(92160);var Vr=c(59787),_i=c(22318),We=c(23558),Er=c(77526),Ir=c(6181),Ar=c(73805),ge=c(9215),kr=c(23224),Ge=c(10556),Oi=c(65195),zr=c(9500),Br=c(7475),Lr=c(95281),ye=c(85732);function wi(o){return Se.UP.getSelectedCanvasItems(o)}function At(o,i){return!_.isEmpty(o)&&_.every(o,function(e){return(0,ge.Vz)(e)&&i.isQueryVisual((0,N.s)(e))})}function kt(o,i){return!_.isEmpty(o)&&_.every(o,function(e){return(0,ge.Vz)(e)&&i.canConvertVisual(e)})}function Fi(o){return!_.isEmpty(o)&&_.every(o,function(i){return(0,N.s)(i)===(0,N.s)(o[0])})}function Ti(o,i){return!_.isEmpty(o)&&_.every(o,function(e){return(0,ge.Vz)(e)&&i.isSupportedVisual(e)})}var Ee=function(i){return i.active},Nr=function(i){return i.alwaysPopulatePanes},Di=function(i){return i.availableSectionTypes},Rr=function(i){return i.isEditing},ct=function(i){return i.selectedVisuals},Vi=function(o){function i(e,n,r){var a=o.call(this)||this;return a.featureSwitchService=e,a.localizationService=n,a.visualPluginOps=r,a.updateState=a.updater(function(s,l){return(0,g.pi)((0,g.pi)({},s),l)}),a.getProperty=function(s){return(0,ye.P1)(function(l){return l},function(l){return l[s]})},a.populatePanes=(0,ye.P1)(Rr,Nr,function(s,l){return s||l}),a.header=(0,ye.P1)(a.populatePanes,ct,function(s,l){var u,d,v=(u=(0,ge.rQ)(l))[0],p=u[1];if(s&&!_.isEmpty(v)&&_.isEmpty(p)){var f=(0,N.s)(v[0]),h=Fi(v)?f:null;h&&(h===J.L.basicShape.name||h===J.L.shape.name?d="VisualizationPane_Shape":h===J.L.image.name?d="VisualizationPane_Image":h===J.L.textbox.name?d="VisualizationPane_Text_Box":h===J.L.actionButton.name?d="VisualizationPane_Action_Button":(h===J.L.pageNavigator.name||h===J.L.bookmarkNavigator.name)&&(d="VisualizationPane_Navigator"))}return d??(a.featureSwitchService.featureSwitches.onObject?"Format":"VisualizationPane_Title")}),a.showVisualTypes=(0,ye.P1)(a.populatePanes,ct,Ee,function(s,l,u){var d,v;if(_.isEmpty(l))v=s&&0===u;else{var p=(d=(0,ge.rQ)(l))[0];v=s&&(!_.isEmpty(d[1])||kt(p,a.visualPluginOps))&&0===u}return v}),a.sections=(0,ye.P1)(Di,function(s){return a.loadSectionDetails(s)}),a.showFieldWellOrFilters=(0,ye.P1)(Ee,function(s){return 0===s}),a.showFieldWell=(0,ye.P1)(a.populatePanes,Ee,function(s,l){return s&&0===l}),a.showPropertyPane=(0,ye.P1)(a.populatePanes,Ee,ct,function(s,l,u){return!_.isEmpty(u)&&s&&1===l}),a.showPagePropertyPane=(0,ye.P1)(a.populatePanes,Ee,ct,function(s,l,u){return _.isEmpty(u)&&s&&3===l}),a.showAnalyticsPane=(0,ye.P1)(a.populatePanes,Ee,function(s,l){return s&&2===l}),a.showDrillthroughPane=(0,ye.P1)(a.showFieldWellOrFilters,function(s){return s}),a.showBuildSection=(0,ye.P1)(a.showVisualTypes,a.showFieldWellOrFilters,function(s,l){return!a.featureSwitchService.featureSwitches.onObject&&(s||l)}),a.activeSectionIndex=(0,ye.P1)(Ee,Di,function(s,l){return l.findIndex(function(u){return u===s})}),a}return(0,g.ZT)(i,o),i.prototype.setVisualizationPaneViewModelState=function(e){this.setState(e)},i.prototype.select$=function(e){return this.select(this.getProperty(e))},i.prototype.loadSectionDetails=function(e){var n=this;return e.map(function(a){return n.getSectionDetails(a)})},i.prototype.getSectionDetails=function(e){var n,r="_paneColorRefresh";switch(e){case 0:n={sectionType:e,displayName:this.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields",normalSvg:"",styledSvg:""};break;case 1:n={sectionType:e,displayName:this.localizationService.get("Format"),cssClass:"format",normalSvg:"",styledSvg:""};break;case 2:n={sectionType:e,displayName:this.localizationService.get("VisualizationPane_Section_Analytics"),cssClass:"analytics",normalSvg:"",styledSvg:""};break;case 3:n={sectionType:e,displayName:this.localizationService.get("Page"),cssClass:"page",normalSvg:"",styledSvg:""};break;default:T.fF.assertNever(e)}return n.normalSvg="visualizationPane".concat(_.upperFirst(n.cssClass),"Modern").concat(r),n.styledSvg="visualizationPane".concat(_.upperFirst(n.cssClass),"ModernSelected").concat(r),n},i.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275inject(le.vZ),t.\u0275\u0275inject(ce.o),t.\u0275\u0275inject(Be.f))},i.\u0275prov=t.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i}(Lr.m1),Ei=c(21302),jr=c(94130),Wr=c(22885),Gr=c(43025),$r=c(84144),Ur=c(43859),Hr=c(32441),Qr=c(53240),Kr=c(64713),Jr=c(2380),Zr=c(11991),Xr=c(26124),Yr=function(o){function i(e,n){return o.call(this,e,n)||this}return(0,g.ZT)(i,o),i.prototype.ngOnInit=function(){var e=this;this.changes$("pbiEmphasisOpacity").pipe((0,nt.w)(function(r){return r||St.E})).subscribe(function(){var r=e.getAnimation("opacity",1);e.emphasize(r)})},i.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(Xr._j,8),t.\u0275\u0275directiveInject(t.ElementRef))},i.\u0275dir=t.\u0275\u0275defineDirective({type:i,selectors:[["","pbiEmphasisOpacity",""]],inputs:{pbiEmphasisOpacity:"pbiEmphasisOpacity"},features:[t.\u0275\u0275InheritDefinitionFeature]}),i}(Zr.A),qr=c(47808),eo=d3.easeCubic,to=d3.select,io=["svgPathElement"];function no(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"div",10),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"localize"),t.\u0275\u0275elementEnd()),2&o){var e=i.ngIf;t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(2,1,e)," ")}}var ro=function(i,e){return{currentSection:i,sections:e,rootAttribute:"focus-pivot-root",pivotAttribute:"focus-pivot"}};function oo(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"pbi-button-toggle",11),t.\u0275\u0275listener("pointerenter",function(){var d=t.\u0275\u0275restoreView(e).$implicit,v=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(v.toggleEffectClasses(d.styledSvg,!0,!0))})("pointerleave",function(){var d=t.\u0275\u0275restoreView(e).$implicit,v=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(v.toggleEffectClasses(d.styledSvg,!1,!0))})("onFocus",function(){var d=t.\u0275\u0275restoreView(e).$implicit,v=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(v.toggleEffectClasses(d.normalSvg,!0,!1))})("onBlur",function(){var d=t.\u0275\u0275restoreView(e).$implicit,v=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(v.toggleEffectClasses(d.normalSvg,!1,!1))})("valueChanged",function(u){var v=t.\u0275\u0275restoreView(e).$implicit,p=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(p.sectionSelectEvent.fn({value:v.sectionType,checked:u}))})("onActiveSection",function(u){t.\u0275\u0275restoreView(e);var d=t.\u0275\u0275nextContext(3);return t.\u0275\u0275resetView(d.sectionSelectEvent.fn({value:u.nextSection.sectionType,checked:!0}))}),t.\u0275\u0275elementStart(2,"div",12)(3,"div",13),t.\u0275\u0275element(4,"pbi-svg-use-symbol",14)(5,"pbi-svg-use-symbol",15),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementContainerEnd()}if(2&o){var n=i.$implicit,r=i.ngForOf,a=t.\u0275\u0275nextContext(2).ngIf,s=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("role","tab")("checked",n.sectionType===a.active)("value",n.sectionType)("aria-label",s.ariaLabels[n.sectionType])("buttonTabIndex",n.sectionType===a.active?0:-1)("pivot-tab-key-handler",t.\u0275\u0275pureFunction2(15,ro,n,r)),t.\u0275\u0275attribute("data-testid","visualization-pane-tab-"+n.sectionType),t.\u0275\u0275advance(1),t.\u0275\u0275classProp("selected",n.sectionType===a.active),t.\u0275\u0275property("pbiTooltip",s.tooltips[n.sectionType]),t.\u0275\u0275attribute("data-unique-id",n.sectionType),t.\u0275\u0275advance(2),t.\u0275\u0275property("sheet",s.sectionIconSheetName)("symbolId",n.normalSvg),t.\u0275\u0275advance(1),t.\u0275\u0275property("sheet",s.sectionIconSheetName)("symbolId",n.styledSvg)}}function ao(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"div",16,17)(2,"div",18),t.\u0275\u0275namespaceSVG(),t.\u0275\u0275elementStart(3,"svg",19,20),t.\u0275\u0275pipe(5,"async"),t.\u0275\u0275element(6,"path",21,22),t.\u0275\u0275elementEnd(),t.\u0275\u0275namespaceHTML(),t.\u0275\u0275elementStart(8,"div",23),t.\u0275\u0275element(9,"div",24)(10,"div",25),t.\u0275\u0275elementEnd()()()),2&o){var e=t.\u0275\u0275nextContext(3);t.\u0275\u0275advance(3),t.\u0275\u0275attribute("transform",t.\u0275\u0275pipeBind1(5,1,e.isRTL$)?"scale(-1, 1)":null)}}function so(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"pbi-pane-divider"),t.\u0275\u0275template(1,no,3,3,"div",6),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275elementStart(3,"pbi-button-toggle-group",7),t.\u0275\u0275template(4,oo,6,18,"ng-container",8),t.\u0275\u0275pipe(5,"async"),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(6,ao,11,3,"div",9),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext().ngIf,n=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(2,4,n.sectionTitle$)),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",t.\u0275\u0275pipeBind1(5,6,n.sections$))("ngForTrackBy",n.trackBySectionTypeFn),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",n.showIndicator(e.availableSectionTypes))}}function lo(o,i){if(1&o&&(t.\u0275\u0275element(0,"build-section",29),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275pipe(3,"async"),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275pipe(5,"async")),2&o){var e=t.\u0275\u0275nextContext(3);t.\u0275\u0275property("disableScrollbar",e.isWholePaneScrollable)("showVisualTypes",t.\u0275\u0275pipeBind1(1,9,e.showVisualTypes$))("showFieldWell",t.\u0275\u0275pipeBind1(2,11,e.showFieldWell$))("showDrillthroughPane",t.\u0275\u0275pipeBind1(3,13,e.showDrillthroughPane$))("showFieldWellOrFilters",t.\u0275\u0275pipeBind1(4,15,e.showFieldWellOrFilters$))("populatePanes",t.\u0275\u0275pipeBind1(5,17,e.populatePanes$))("visualPluginFilter",e.paneViewModel.visualPluginFilter)("nonPersonalVisualizationPaneFilter",e.paneViewModel.nonPersonalVisualizationPaneFilter)("showNonPersonalVisuals",e.showNonPersonalVisualizationPane())}}function co(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"section",30),t.\u0275\u0275element(1,"formatting-pane-lazy",31),t.\u0275\u0275elementEnd()),2&o){var e=i.ngIf,n=t.\u0275\u0275nextContext(3);t.\u0275\u0275property("id","toggle-group-tab-panel3"),t.\u0275\u0275advance(1),t.\u0275\u0275property("formattingSources",e.formattingSources)("disableScrollbar",n.isWholePaneScrollable)}}function uo(o,i){if(1&o&&(t.\u0275\u0275elementStart(0,"pbi-pane-section",26),t.\u0275\u0275template(1,lo,6,19,"build-section",27),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275template(3,co,2,3,"section",28),t.\u0275\u0275pipe(4,"async"),t.\u0275\u0275elementEnd()),2&o){var e=t.\u0275\u0275nextContext().ngIf,n=t.\u0275\u0275nextContext();t.\u0275\u0275property("hidden",!e.isPaneExpanded),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(2,3,n.showBuildSection$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(4,5,n.formattingPaneModel$))}}function po(o,i){if(1&o){var e=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275listener("resizing",function(s){t.\u0275\u0275restoreView(e);var l=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(l.onResizing(s))}),t.\u0275\u0275elementStart(1,"pbi-pane",3),t.\u0275\u0275listener("onToggle",function(){var l=t.\u0275\u0275restoreView(e).ngIf,u=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(u.onPaneExpanded.emit(!l.isPaneExpanded))})("onCollapse",function(){t.\u0275\u0275restoreView(e);var s=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(s.onPaneCollapsed())}),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275template(3,so,7,8,"pbi-pane-divider",4),t.\u0275\u0275template(4,uo,5,7,"pbi-pane-section",5),t.\u0275\u0275elementEnd()()}if(2&o){var n=i.ngIf,r=t.\u0275\u0275nextContext();t.\u0275\u0275classProp("isCollapsed",!n.isPaneExpanded),t.\u0275\u0275property("pbiEmphasisBackground",r.emphasize$)("pbiEmphasisBackgroundColor","var(--globalColorBrand160)"),t.\u0275\u0275advance(1),t.\u0275\u0275property("expanded",n.isPaneExpanded)("title",t.\u0275\u0275pipeBind1(2,12,r.header$))("allowToggle",!r.onObject)("optionsSetting",r.paneViewModel.optionsSetting)("disableScroll",!r.isWholePaneScrollable)("showCollapse",r.onObject),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",!r.onObjectOn&&n.isPaneExpanded),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",n.isPaneExpanded)}}var vo=["M0 8.5H16L24 1L32 8.5H180","M0 8.5H82L90 1L98 8.5H180","M0 8.5H148L156 1L164 8.5H180"],ki=function(o){function i(e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V,P,O){var w=o.call(this)||this;return w.promiseFactory=e,w.directionality=n,w.eventBridge=r,w.explorationNavigation=a,w.favoriteVisualLoader=s,w.featureSwitchService=l,w.globalEventBridge=u,w.highContrastCssGenerationService=d,w.localizationService=v,w.paneVisibilityService=p,w.selection=f,w.svgProviderService=h,w.telemetryService=m,w.viewModeState=b,w.visualizationPaneService=y,w.visualPaneSettingsService=V,w.visualPlugin=P,w.visualPluginOps=O,w.onPaneExpanded=new t.EventEmitter,w.isWholePaneScrollable=window.innerWidth<640||window.innerHeight<360,w.preparePersonalVisualizationPane(),w.initializeHighContrastRules(),w.onObjectOn=w.featureSwitchService.featureSwitches.onObject,w.channelSubscriptions=r.createChannelSubscriptionManager(),w.channelSubscriptions.subscribe(Ei.sn,function(){w.visualizationPaneService.updateState({isPaneExpanded:!0,active:1}),w.paneVisibilityService.isPaneExpanded("format")||w.paneVisibilityService.togglePaneExpansion("format")}),w.channelSubscriptions.subscribe(Ei.mF,function(){w.selection.clearSelection(),w.visualizationPaneService.updateState({isPaneExpanded:!0,active:3}),w.paneVisibilityService.isPaneExpanded("format")||w.paneVisibilityService.togglePaneExpansion("format")}),w.onDestroy$.subscribe(function(j){j&&w.channelSubscriptions.unsubscribeAll()}),w}return(0,g.ZT)(i,o),i.prototype.ngOnInit=function(){var e=this;this.setInitialState(),this.initSelectors(),this.initExpansionHandler(),this.initEventHandlers(),this.ariaLabels=this.buildAriaLabels(),this.tooltips=this.buildTooltips();var n=this.isEditing$.pipe((0,U.U)(function(p){return{isEditing:p}})),r=this.alwaysPopulatePanes$.pipe((0,U.U)(function(p){return{alwaysPopulatePanes:p}})),a=this.mergeSelectedVisualType$.pipe((0,U.U)(function(p){return{selectedVisuals:p.selectedVisuals,visualType:p.visualType}})),s=this.availableSectionTypes$.pipe((0,U.U)(function(p){return{availableSectionTypes:p}})),l=this.active$.pipe((0,U.U)(function(p){return{active:p.active,previous:p.previous}})),u=this.isPaneExpanded$.pipe((0,U.U)(function(p){return{isPaneExpanded:p}})),d=this.isPaneVisible$.pipe((0,U.U)(function(p){return{isPaneVisible:p}})),v=(0,E.T)(n,r,a,s,l,u,d);this.visualizationPaneService.updateState(v),this.isRTL$=this.directionality.change.pipe((0,_i.O)(this.directionality.value),(0,U.U)(function(p){return"rtl"===p})),this.emphasize$=this.paneVisibilityService.getPaneEmphasis$("format"),(0,Vr.R)(window,"resize").subscribe(function(p){var f=window.innerWidth,h=window.innerHeight;e.isWholePaneScrollable=f<640||h<360})},i.prototype.ngAfterViewInit=function(){var e=this;this.svgPathElement$=this.svgPathElements.changes.pipe((0,U.U)(function(r){return r.first}),(0,_i.O)(this.svgPathElements.first),(0,U.U)(function(r){return r&&to(r.nativeElement)}));var n=this.svgPathElement$.pipe((0,nt.w)(function(r){return r?e.activeSectionIndex$:St.E}));(0,E.T)(n,this.svgPathElement$.pipe((0,D.h)(function(r){return!!r}))).pipe((0,We.M)(n,this.svgPathElement$),(0,Er.x)()).subscribe(function(r){return e.changePath(r[2],r[1])}),this.svgProviderService.toggleCssClasses(!0,"active",this.sectionIconSheetName,this.defaultSectionSelectedSVG)},Object.defineProperty(i.prototype,"onObject",{get:function(){return this.featureSwitchService.featureSwitches.onObject},enumerable:!1,configurable:!0}),i.prototype.onPaneCollapsed=function(){this.paneVisibilityService.setPaneExpansion("format",!1)},i.prototype.showNonPersonalVisualizationPane=function(){var e=this;return _.some(this.visualPlugin.getConvertibleVisuals(),function(n){if(!n)return!1;var r=!1,a=e.featureSwitchService.featureSwitches.userFavoriteResourcePackagesEnabled&&n.custom&&e.visualPaneSettingsService.isFavoritePublicCustomVisual(n.name),s=e.featureSwitchService.featureSwitches.userFavoriteResourcePackagesEnabled&&n.custom&&n.favoriteId||a,l=e.featureSwitchService.featureSwitches.userFavoriteResourcePackagesEnabled&&n.custom&&!n.favoriteId&&!a,u=e.featureSwitchService.featureSwitches.tenantOutOfBoxVisualsEnabled&&n.custom&&n.isOutOfBox,d=e.featureSwitchService.featureSwitches.personalVisualizationPaneEnabled&&e.visualPaneSettingsService.isUnpinnedVisual(n.name);return(n.custom&&!u&&l||d&&!s)&&(r=!0),r})},i.prototype.preparePersonalVisualizationPaneServices=function(){var e=this,n=[];return this.featureSwitchService.featureSwitches.userFavoriteResourcePackagesEnabled&&n.push(this.favoriteVisualLoader.ensureFavoriteVisualResources(this.visualPlugin)),this.featureSwitchService.featureSwitches.tenantOutOfBoxVisualsEnabled&&n.push(this.favoriteVisualLoader.ensureOutOfBoxVisuals(this.visualPlugin)),this.promiseFactory.allSettled(n).finally(function(){if(e.featureSwitchService.featureSwitches.personalVisualizationPaneEnabled)return e.visualPaneSettingsService.updateVisuals()})},i.prototype.preparePersonalVisualizationPane=function(){var e=this;this.preparePersonalVisualizationPaneServices().finally(function(){e.eventBridge.publishToChannel(k.Udu)})},i.prototype.initSelectors=function(){var e=this.visualizationPaneService;this.activeSectionIndex$=e.select(e.activeSectionIndex),this.populatePanes$=e.select(e.populatePanes),this.showFieldWell$=e.select(e.showFieldWell),this.showAnalyticsPane$=e.select(e.showAnalyticsPane),this.showDrillthroughPane$=e.select(e.showDrillthroughPane),this.showPropertyPane$=e.select(e.showPropertyPane),this.showPagePropertyPane$=e.select(e.showPagePropertyPane),this.showVisualTypes$=e.select(e.showVisualTypes),this.showFieldWellOrFilters$=e.select(e.showFieldWellOrFilters),this.showBuildSection$=e.select(e.showBuildSection),this.header$=e.select(e.header),this.sections$=e.select(e.sections),this.sectionTitle$=e.select(Ee).pipe((0,U.U)(function(s){switch(s){case 3:return"Format_Page";case 1:return"Format_Visual";case 0:return"Build_Visual";case 2:return"VisualizationPane_Section_Analytics";default:return void T.fF.assertNever(s)}}));var n=this.showAnalyticsPane$.pipe((0,U.U)(function(s){return s?{formattingSources:["Analytics"]}:void 0})),r=this.showPagePropertyPane$.pipe((0,U.U)(function(s){return s?{formattingSources:["Page"]}:void 0})),a=this.showPropertyPane$.pipe((0,U.U)(function(s){return s?{formattingSources:["Visual","Format_Label_General"]}:void 0}));this.formattingPaneModel$=(0,Fe.aj)([n,r,a]).pipe((0,U.U)(function(s){return s.find(function(l){return!_.isUndefined(l)})}))},i.prototype.initEventHandlers=function(){var e=this,n=this.visualizationPaneService,r=n.select$("selectedVisuals"),a=n.select$("active"),s=n.select$("availableSectionTypes");this.isEditing$=this.viewModeState.getMode$().pipe((0,I.R)(this.onDestroy$),(0,U.U)(function(p){return 1===p})),this.isEditing$.pipe((0,I.R)(this.onDestroy$)).subscribe(function(p){p&&e.updateExplorationVisuals()}),this.alwaysPopulatePanes$=this.viewModeState.getConfig$().pipe((0,Ir.j)("alwaysPopulatePanes"),(0,I.R)(this.onDestroy$),(0,U.U)(function(p){return p})),this.mergeSelectedVisualType$=(0,E.T)(this.eventBridge.on(k.tRg),this.eventBridge.on(k.KD7)).pipe((0,I.R)(this.onDestroy$),(0,U.U)(function(p){var f,h=wi(e.selection),m=null,b=(f=(0,ge.rQ)(h))[0],y=f[1];if(!_.isEmpty(b)&&_.isEmpty(y)){var V=(0,N.s)(b[0]);Fi(b)&&(m=V)}return{selectedVisuals:h,visualType:m}}));var l=this.globalEventBridge.on(kr.U.SignInStatusChangedEvent);l.pipe((0,I.R)(this.onDestroy$)).subscribe(function(p){e.favoriteVisualLoader.reset(e.visualPlugin),e.visualPaneSettingsService.reset()}),(0,E.T)(this.eventBridge.on(Br.nR),l).pipe((0,I.R)(this.onDestroy$)).subscribe(function(p){e.preparePersonalVisualizationPane()}),this.availableSectionTypes$=this.mergeSelectedVisualType$.pipe((0,We.M)(r),(0,U.U)(function(p){var f,m=p[1],b=[];if(_.isEmpty(m))e.featureSwitchService.featureSwitches.onObject||b.push(0),b.push(3);else{var y=(f=(0,ge.rQ)(m))[0],V=f[1],P=kt(m,e.visualPluginOps);(At(m,e.visualPluginOps)||P||!_.isEmpty(V))&&(e.featureSwitchService.featureSwitches.onObject||b.push(0),_.every(y,function(j){return e.visualPluginOps.canFormatVisual(j)})&&(b.push(1),e.featureSwitchService.featureSwitches.onObject||b.push(2)))}return b})),this.sectionSelectEvent=this.createEventAdapter();var u=this.sectionSelectEvent.$.pipe((0,D.h)(function(p){return p.checked}),(0,We.M)(s),(0,U.U)(function(p){var f=p[0];return p[1].find(function(m){return m===f.value})})),d=(0,E.T)(this.eventBridge.on(k.cY_),this.eventBridge.on(k.x4H)).pipe((0,We.M)(r),(0,D.h)(function(p){return At(p[1],e.visualPluginOps)}),(0,Ar.h)(this.featureSwitchService.featureSwitches.onObject?1:2)),v=this.mergeSelectedVisualType$.pipe((0,We.M)(r,a),(0,U.U)(function(p){var y,m=p[1],b=p[2],V=e.featureSwitchService.featureSwitches.onObject?3:0;if(_.isEmpty(m))y=V;else{var O=(0,ge.rQ)(m)[1],w=At(m,e.visualPluginOps),j=kt(m,e.visualPluginOps);y=!_.isEmpty(O)||w||j?3===b?1:b:Ti(m,e.visualPluginOps)?1:V}return y}));this.active$=(0,E.T)(u,d,v).pipe((0,We.M)(a),(0,U.U)(function(p){return{active:p[0],previous:p[1]}})),(0,Fe.aj)([this.active$,this.sections$]).subscribe(function(p){var f=p[0],h=p[1],m=f.active,b=f.previous,y=h.find(function(P){return P.sectionType===m}),V=h.find(function(P){return P.sectionType===b});V&&(e.svgProviderService.toggleCssClasses(!1,"active",e.sectionIconSheetName,V.styledSvg),e.svgProviderService.toggleCssClasses(!1,"focus",e.sectionIconSheetName,V.normalSvg)),y&&e.svgProviderService.toggleCssClasses(!0,"active",e.sectionIconSheetName,y.styledSvg)})},i.prototype.initExpansionHandler=function(){var e=this,n=this.paneVisibilityService.getPanes$().pipe((0,U.U)(function(a){var s;return null===(s=a.format)||void 0===s?void 0:s.isPaneExpanded})),r=this.onPaneExpanded.asObservable();this.isPaneExpanded$=(0,E.T)(r,n),this.isPaneVisible$=this.paneVisibilityService.getPanes$().pipe((0,U.U)(function(a){var s;return null===(s=a.format)||void 0===s?void 0:s.isPaneVisible})),r.pipe((0,I.R)(this.onDestroy$)).subscribe(function(a){e.telemetryService.logEvent(Ge.vLR,{paneType:"Visualization",expanded:a,viewMode:(0,zr.ku)(e.viewModeState.getMode())}),e.paneVisibilityService.togglePaneExpansion("format")})},i.prototype.setInitialState=function(){this.sectionIconSheetName="visualizationPaneIcons_paneColorRefresh",this.defaultSectionSelectedSVG="visualizationPaneFieldsModernSelected_paneColorRefresh",this.viewModelStore$=this.visualizationPaneService.state$,this.svgProviderService.loadSheet(this.sectionIconSheetName);var e=wi(this.selection),n=_.isEmpty(e)?[3]:[1],r=0,a=Ti(e,this.visualPluginOps);this.featureSwitchService.featureSwitches.onObject?r=a?1:3:(n.unshift(0),a&&n.push(2)),this.visualizationPaneService.setVisualizationPaneViewModelState({active:r,previous:r,availableSectionTypes:n,isPaneVisible:this.paneVisibilityService.isPaneVisible("format"),isPaneExpanded:this.paneVisibilityService.isPaneExpanded("format"),selectedVisuals:e})},i.prototype.changePath=function(e,n){n>=0&&n<=2&&e.transition().duration(200).ease(eo).attr("d",vo[n])},i.prototype.updateExplorationVisuals=function(){this.visualPaneSettingsService.resetExplorationVisuals();var e=this.explorationNavigation.getCurrentExploration();if(e)for(var n=0,r=e.sections;n<r.length;n++)for(var s=0,l=r[n].visualContainers;s<l.length;s++)this.visualPaneSettingsService.addExplorationVisual(l[s].config.singleVisual.visualType)},i.prototype.showIndicator=function(e){return!!(e&&e.length>0)},i.prototype.buildAriaLabels=function(){var e;return(e={})[0]=this.localizationService.get("Build_Visual"),e[1]=this.localizationService.get("Format_Visual"),e[2]=this.localizationService.get("VisualizationPane_Section_Analytics"),e[3]=this.localizationService.get("Format_Page"),e},i.prototype.buildTooltips=function(){var e;return(e={})[0]=this.localizationService.get("VisualizationPane_Section_Build_Visual_Description"),e[1]=this.localizationService.get("VisualizationPane_Section_Format_Visual_Description"),e[2]=this.localizationService.get("VisualizationPane_Section_Analytics_Button_Description"),e[3]=this.localizationService.get("VisualizationPane_Section_Format_Page_Description"),e},i.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule(".visualization-pane pbi-button-toggle-group .outer.selected","{ background-color: @selectedBackgroundColor !important; }")},i.prototype.toggleEffectClasses=function(e,n,r){this.svgProviderService.toggleCssClasses(n,r?Oi.Cj:Oi.PG,this.sectionIconSheetName,e)},i.prototype.trackBySectionTypeFn=function(e,n){return n.sectionType},Object.defineProperty(i.prototype,"paneSectionClass",{get:function(){return this.isWholePaneScrollable?"pane-section paneScrollable":"pane-section paneNotScrollable"},enumerable:!1,configurable:!0}),i.\u0275fac=function(n){return new(n||i)(t.\u0275\u0275directiveInject(we.t),t.\u0275\u0275directiveInject(jr.Is),t.\u0275\u0275directiveInject(oe.J),t.\u0275\u0275directiveInject(te.z),t.\u0275\u0275directiveInject(Wr.W),t.\u0275\u0275directiveInject(le.vZ),t.\u0275\u0275directiveInject(Gr.Z),t.\u0275\u0275directiveInject(mi.g),t.\u0275\u0275directiveInject(ce.o),t.\u0275\u0275directiveInject(yi.r),t.\u0275\u0275directiveInject(me.z),t.\u0275\u0275directiveInject($r.g),t.\u0275\u0275directiveInject(ve.y0),t.\u0275\u0275directiveInject(Yt.kc),t.\u0275\u0275directiveInject(Vi),t.\u0275\u0275directiveInject(Rt.R),t.\u0275\u0275directiveInject(Pe.D),t.\u0275\u0275directiveInject(Be.f))},i.\u0275cmp=t.\u0275\u0275defineComponent({type:i,selectors:[["visualization-pane-modern"]],viewQuery:function(n,r){var a;(1&n&&t.\u0275\u0275viewQuery(io,5),2&n)&&(t.\u0275\u0275queryRefresh(a=t.\u0275\u0275loadQuery())&&(r.svgPathElements=a))},hostVars:2,hostBindings:function(n,r){2&n&&t.\u0275\u0275attribute("data-automation-type","visualizationPane")("data-testid","visualization-pane")},inputs:{paneViewModel:"paneViewModel"},outputs:{onPaneExpanded:"onPaneExpanded"},features:[t.\u0275\u0275ProvidersFeature([Vi,{provide:ai.yk,useValue:{source:"Pane",paneType:"format"}}]),t.\u0275\u0275InheritDefinitionFeature],decls:3,vars:4,consts:[["class","visualization-pane","data-automation-type","visualizationPaneGroup","keyboard-shortcuts","ctrl-F6","focus-priority","12","focus-nav-mode","Group",3,"isCollapsed","pbiEmphasisBackground","pbiEmphasisBackgroundColor","resizing",4,"ngIf"],[1,"emphasis-border",3,"pbiEmphasisOpacity"],["data-automation-type","visualizationPaneGroup","keyboard-shortcuts","ctrl-F6","focus-priority","12","focus-nav-mode","Group",1,"visualization-pane",3,"pbiEmphasisBackground","pbiEmphasisBackgroundColor","resizing"],["role","region","overlayScrollbar","","noPadding","",3,"expanded","title","allowToggle","optionsSetting","disableScroll","showCollapse","onToggle","onCollapse"],[4,"ngIf"],["class","pane-section","noPadding","",3,"hidden",4,"ngIf"],["class","section-title",4,"ngIf"],["role","tablist","focus-pivot-root",""],[4,"ngFor","ngForOf","ngForTrackBy"],["class","select-button-indicator",4,"ngIf"],[1,"section-title"],["pbiTooltipCheckChildren","true","focus-pivot","",3,"role","checked","value","aria-label","buttonTabIndex","pivot-tab-key-handler","pointerenter","pointerleave","onFocus","onBlur","valueChanged","onActiveSection"],[1,"outer",3,"pbiTooltip"],[1,"content"],[1,"normal-svg",3,"sheet","symbolId"],[1,"styled-svg",3,"sheet","symbolId"],[1,"select-button-indicator"],["custom",""],[1,"divider-component"],["width","180","height","9","viewBox","0 0 180 9","fill","none","xmlns","http://www.w3.org/2000/svg",1,"select-indicator-bar"],["svgElement",""],["d","M0 8.5H16L24 1L32 8.5H180"],["svgPathElement",""],[1,"filler"],[1,"space"],[1,"line"],["noPadding","",1,"pane-section",3,"hidden"],["class","pane-content",3,"disableScrollbar","showVisualTypes","showFieldWell","showDrillthroughPane","showFieldWellOrFilters","populatePanes","visualPluginFilter","nonPersonalVisualizationPaneFilter","showNonPersonalVisuals",4,"ngIf"],["class","pane-content","role","tabpanel","section-animation-slider","",3,"id",4,"ngIf"],[1,"pane-content",3,"disableScrollbar","showVisualTypes","showFieldWell","showDrillthroughPane","showFieldWellOrFilters","populatePanes","visualPluginFilter","nonPersonalVisualizationPaneFilter","showNonPersonalVisuals"],["role","tabpanel","section-animation-slider","",1,"pane-content",3,"id"],["data-testid","formatting-pane-lazy",3,"formattingSources","disableScrollbar"]],template:function(n,r){1&n&&(t.\u0275\u0275template(0,po,5,14,"div",0),t.\u0275\u0275pipe(1,"async"),t.\u0275\u0275element(2,"div",1)),2&n&&(t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(1,2,r.viewModelStore$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("pbiEmphasisOpacity",r.emphasize$))},dependencies:[S.NgForOf,S.NgIf,Gt.R,Ur.H,Hr.u,Ci.q,Qr.I,Kr.J,Jr.O,Yr,bi.VO,qr.P,Pi.i,li.R,tt.V,hi,S.AsyncPipe,ht.F],styles:['[_nghost-%COMP%]{display:flex;height:100%}.emphasis-border[_ngcontent-%COMP%]{border:1px solid var(--globalColorBrand80);position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box;opacity:0;pointer-events:none}.visualization-pane[_ngcontent-%COMP%]{--viz-pane-selected-button-background: var(--gray-50, #D2D0CE);--viz-pane-button-hover-background: var(--gray-40, #E1DFDD);--viz-pane-button-hover-outline-color: var(--gray-110, #8A8886);--viz-pane-selected-svg-line-color: var(--gray-110, #8A8886);--viz-pane-selected-line-color: var(--gray-70, #BEBBB8);--icon-fill-color: var(--theme-primary-color);--icon-stroke-color: #252423;overflow:hidden;flex-grow:1}  [data-legacy-theming=false] .visualization-pane{--viz-pane-selected-button-background: var(--colorNeutralBackground1);--viz-pane-button-hover-background: var(--colorNeutralBackground1Hover);--viz-pane-button-hover-outline-color: var(--colorNeutralStroke1Hover);--viz-pane-selected-svg-line-color: var(--colorNeutralStroke1);--viz-pane-selected-line-color: var(--colorNeutralStroke1);--icon-fill-color: var(--colorCompoundBrandStroke);--icon-stroke-color: var(--colorNeutralStrokeAccessible)}.visualization-pane[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--sm-font-size, 12px);font-weight:var(--font-weight-semi-bold, 600);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;-webkit-user-select:none;-ms-user-select:none;user-select:none}html:not([dir="rtl"])[_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin-left:8px}html[dir="rtl"][_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin-right:8px}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]{display:flex;padding:4px 0}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]{cursor:pointer;border-radius:2px;border:none;padding:4px}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]   .normal-svg[_ngcontent-%COMP%]{display:block}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]   .styled-svg[_ngcontent-%COMP%]{display:none}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer.selected[_ngcontent-%COMP%]{background:var(--viz-pane-selected-button-background)}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer.selected[_ngcontent-%COMP%]   .normal-svg[_ngcontent-%COMP%]{display:none}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer.selected[_ngcontent-%COMP%]   .styled-svg[_ngcontent-%COMP%]{display:block}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]:hover{outline:var(--focus-outline-definition, 2.5px solid) var(--viz-pane-button-hover-outline-color);background:var(--viz-pane-button-hover-background)}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]:hover   .normal-svg[_ngcontent-%COMP%]{display:none}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]:hover   .styled-svg[_ngcontent-%COMP%]{display:block}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]:focus{outline:none}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle-group[_ngcontent-%COMP%]   .outer[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{height:24px;width:24px;display:flex;justify-content:center}.visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]{flex:none}html:not([dir="rtl"])[_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]{margin-right:34px}html[dir="rtl"][_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]{margin-left:34px}html[data-focus-source="key"][_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:focus-within   .content[_ngcontent-%COMP%], html[data-focus-source="key"]   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:focus-within   .content[_ngcontent-%COMP%]{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}html:not([dir="rtl"])[_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:first-child, html:not([dir="rtl"])   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:first-child{margin-left:8px}html[dir="rtl"][_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:first-child, html[dir="rtl"]   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:first-child{margin-right:8px}html:not([dir="rtl"])[_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:last-child, html:not([dir="rtl"])   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:last-child{margin-right:0}html[dir="rtl"][_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:last-child, html[dir="rtl"]   [_nghost-%COMP%]   .visualization-pane[_ngcontent-%COMP%]   pbi-button-toggle[_ngcontent-%COMP%]:last-child{margin-left:0}.visualization-pane[_ngcontent-%COMP%]   .select-button-indicator[_ngcontent-%COMP%]{display:block;padding-bottom:4px}.visualization-pane[_ngcontent-%COMP%]   .select-button-indicator[_ngcontent-%COMP%]   .divider-component[_ngcontent-%COMP%]{display:flex;width:100%}.visualization-pane[_ngcontent-%COMP%]   .select-button-indicator[_ngcontent-%COMP%]   .divider-component[_ngcontent-%COMP%]   .select-indicator-bar[_ngcontent-%COMP%]{flex:none}.visualization-pane[_ngcontent-%COMP%]   .select-button-indicator[_ngcontent-%COMP%]   .divider-component[_ngcontent-%COMP%]   .select-indicator-bar[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:var(--viz-pane-selected-svg-line-color)}.visualization-pane[_ngcontent-%COMP%]   .select-button-indicator[_ngcontent-%COMP%]   .divider-component[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]{height:9px;display:flex;flex-direction:column;flex-grow:1}.visualization-pane[_ngcontent-%COMP%]   .select-button-indicator[_ngcontent-%COMP%]   .divider-component[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]   .space[_ngcontent-%COMP%]{height:8px}.visualization-pane[_ngcontent-%COMP%]   .select-button-indicator[_ngcontent-%COMP%]   .divider-component[_ngcontent-%COMP%]   .filler[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{height:1px;background:var(--viz-pane-selected-line-color)}.visualization-pane[_ngcontent-%COMP%]   .pane-section[_ngcontent-%COMP%], .visualization-pane[_ngcontent-%COMP%]   .pane-section[_ngcontent-%COMP%]   .pane-content[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.visualization-pane[_ngcontent-%COMP%]   .pane-section[_ngcontent-%COMP%]   .pane-content[_ngcontent-%COMP%]   formatting-pane-lazy[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column}.visualization-pane[_ngcontent-%COMP%]   .paneScrollable[_ngcontent-%COMP%]{height:"100%"}.visualization-pane[_ngcontent-%COMP%]   .paneNotScrollable[_ngcontent-%COMP%]{height:unset}']}),i}(K.w),go=c(49080),ho=c(17966),fo=c(19276),pe=c(49702),ze=c(23306),zi=c(35497),mo={provide:"bookmarkAuthoringService",useFactory:function(o,i,e,n,r,a,s,l,u,d,v){return new Co(o,i,e,n,r,s,l,u,a,d,v)},deps:[ho.F,Z.i,de.D,oe.J,fo.j,go.J,ce.o,st.g,me.z,ve.y0,Ye.z]},Co=function(){function o(i,e,n,r,a,s,l,u,d,v,p){this.bookmarkService=i,this.conceptualSchemaProxy=e,this.dataSources=n,this.eventBridge=r,this.explorationStateApplier=a,this.localizationService=s,this.screenReaderService=l,this.selection=u,this.stateManager=d,this.telemetryService=v,this.undoRedoService=p}return o.prototype.create=function(i,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var a,s,l,u,d,v;return(0,g.Jh)(this,function(f){switch(f.label){case 0:return[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return a=f.sent(),e?[3,3]:(s={captureAllSections:!1,suppressDataSourceVariables:!0,capturePresentation:!1},_.assign(s,r),[4,this.stateManager.capture(a,s)]);case 2:e=f.sent(),f.label=3;case 3:return l=this.bookmarkService.getBookmarks(),u=l?l.length+1:1,d=i||this.localizationService.get("Generic_Bookmark")+" ".concat(u),v=this.generateBookmarkName(),n||(n=this.updateTargetVisualsOptions({})),[2,{displayName:d,name:v,explorationState:e,options:n}]}})})},o.prototype.add=function(i,e,n,r){return void 0===r&&(r=!0),(0,g.mG)(this,void 0,void 0,function(){var a,s,l=this;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return[4,this.create(i,e,n)];case 1:return a=u.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return s=u.sent(),this.undoRedoService.register(pe.U.Add,function(){l.bookmarkService.setBookmarks((0,ze.IH)(l.bookmarkService.getBookmarks(),a)),r&&(l.bookmarkService.setActiveBookmark(a),e&&l.applyBookmarkState(a,s)),l.telemetryService.logEvent(Ge.Dbt)}),this.screenReaderService.alertPolite(this.localizationService.format("CreatedItem",a.displayName)),[2,a]}})})},o.prototype.remove=function(i){var e=this,n=this.getBookmark(i);T.fF.assert(function(){return pe.J.isValidBookmark(n)},"Invalid bookmark"),this.undoRedoService.register(pe.U.Remove,function(){var r=(0,ze.Od)(n,e.bookmarkService.getBookmarks());e.bookmarkService.setBookmarks(r);var a=e.bookmarkService.getActiveBookmark();a&&n.name===a.name&&e.bookmarkService.setActiveBookmark(null),e.telemetryService.logEvent(Ge.FQA)})},o.prototype.move=function(i,e,n,r){var a=this;void 0===n&&(n=!1),"number"==typeof i&&"number"==typeof e&&(n=i<e);var s=this.getBookmark(i),l=this.getBookmark(e);T.fF.assert(function(){return pe.J.isValidBookmark(s)},"Invalid source bookmark"),T.fF.assert(function(){return pe.J.isValidBookmark(l)},"Invalid target bookmark"),this.undoRedoService.register(pe.U.Move,function(){a.bookmarkService.setBookmarks((0,ze.pB)([s],l,a.bookmarkService.getBookmarks(),n))})},o.prototype.rename=function(i,e){var n=this,r=this.getBookmark(i);T.fF.assert(function(){return pe.J.isValidBookmark(r)},"Invalid bookmark"),T.fF.assert(function(){return!_.isEmpty(e)},"Bookmark name can't be empty"),this.undoRedoService.register(pe.U.Rename,function(){r.displayName=e,n.bookmarkService.emitUpdatedBookmarks()})},o.prototype.update=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r,a=this;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return e=this.getBookmark(i),T.fF.assert(function(){return pe.J.isValidBookmark(e)},"Invalid bookmark"),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return n=s.sent(),[4,this.stateManager.capture(n,{captureAllSections:!1})];case 2:return r=s.sent(),this.undoRedoService.register(pe.U.Update,function(){a.bookmarkService.setActiveBookmark(e),e.explorationState=r,e.options=a.updateTargetVisualsOptions(e.options),a.telemetryService.logEvent(Ge.m_M)}),[2]}})})},o.prototype.ungroup=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e=this;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return T.fF.assert(function(){return pe.J.isValidBookmark(i)},"Invalid bookmark"),[4,this.undoRedoService.register(pe.U.Ungroup,function(){e.bookmarkService.setBookmarks((0,ze.Z8)(i,e.bookmarkService.getBookmarks()))})];case 1:return n.sent(),[2]}})})},o.prototype.group=function(i){var e=this;T.fF.assert(function(){return!_.isEmpty(i)},"Bookmarks to group should not be empty");var n=this.createBookmarkGroup(i);this.undoRedoService.register(pe.U.Group,function(){e.bookmarkService.setBookmarks((0,ze.ru)(n,e.bookmarkService.getBookmarks()))})},o.prototype.getBookmark=function(i){return"number"==typeof i?this.bookmarkService.getBookmarks()[i]:i},o.prototype.generateBookmarkName=function(){var i={};return _.each(this.bookmarkService.getBookmarks(),function(e){i[e.name]=!0}),zi.q.generateUniqueId(i)},o.prototype.createBookmarkGroup=function(i){var e=_.filter(this.bookmarkService.getBookmarks(),function(l){return pe.J.isBookmarkGroup(l)}),n=e?e.length+1:1;return{displayName:this.localizationService.get("Group")+" ".concat(n),name:this.generateBookmarkName(),children:i}},o.prototype.updateTargetVisualsOptions=function(i){i||(i={});for(var e=Se.UP.getSelectedCanvasItems(this.selection),n=[],r=[],a=0,s=e;a<s.length;a++){var l=s[a];n.push(l.name),(0,ge.q4)(l)&&r.push(l)}return _.isEmpty(r)||(0,ge.Iw)(r,function(u){return n.push(u.name)}),i.targetVisualNames=_.uniq(n),i},o.prototype.applyBookmarkState=function(i,e,n){T.fF.assertValue(i,"bookmark");var r={clearUnmatchedData:!0,suppressDataSourceVariables:!0};if(_.assign(r,n),!pe.J.isBookmarkGroup(i)){var a=this.explorationStateApplier.createApplyBookmarkActivity("AddReportBookmark");try{i.options&&(r.suppressData=i.options.suppressData,r.suppressActiveSection=i.options.suppressActiveSection,r.suppressDisplay=i.options.suppressDisplay,i.options.applyOnlyToTargetVisuals&&(r.targetVisualNames=i.options.targetVisualNames));var s=this.applyState(a,i.explorationState,e,r);return this.eventBridge.publishToChannel(k.gG5,{bookmarkName:i.name}),this.telemetryService.logEvent(Ge.LPp,{bookmarkName:i.name}),a.resolve(),s}catch(l){a.reject(l)}}},o.prototype.applyState=function(i,e,n,r){return this.explorationStateApplier.applyDirty(e,n,r,i)},o}(),zt=c(40033),et=c(80),xo={provide:"canvasListOrderingService",useFactory:function(o,i,e,n){return new Promise(function(r){r(new Mo(o,i,e,n))})},deps:[zt.F,fe.$8,qe.Q,lt.F]},Mo=function(){function o(i,e,n,r){this.canvasListOrderNormalizeService=i,this.visualAuthoring=e,this.visualAuthoringOperations=n,this.formFactor=r}return o.prototype.getListOrderPropertyFunction=function(i,e){var n=this.formFactor.getCurrentLayout();return i.layouts.withId(n).position[e]},o.prototype.insertAtMinMagnitude=function(i,e,n,r,a,s){var l=this;if(!_.isEmpty(e)){var u=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(p){return l.getListOrderPropertyFunction(p,r)});this.insertAtMinMagnitudeInternal(e,u,n,r,a,s);var d=_.concat(i,e);if(u=this.canvasListOrderNormalizeService.getContainerListOrders(d,function(p){return l.getListOrderPropertyFunction(p,r)}),this.canvasListOrderNormalizeService.shouldNormalizeListOrder(u,n)){var v=this.canvasListOrderNormalizeService.normalizeListOrder(u,n);a?this.visualAuthoringOperations.updateContainerListOrders(d,v,r):this.visualAuthoring.updateContainerListOrders(d,v,r)}}},o.prototype.insertAtMinMagnitudeInternal=function(i,e,n,r,a,s){var p,l=this,u=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(m){return l.getListOrderPropertyFunction(m,r)}),d=this.canvasListOrderNormalizeService.getSortedContainerNames(u,s?!n:n),v=this.canvasListOrderNormalizeService.getSortedContainerNames(e,n);p=v.length?e[_.head(v)]:n?et.RT:et.Wp;var f=this.convertsMagnitude(et.oZ,!n),h={};this.canvasListOrderNormalizeService.settingListOrder(h,d,p+=f,f),a?this.visualAuthoringOperations.updateContainerListOrders(i,h,r):this.visualAuthoring.updateContainerListOrders(i,h,r)},o.prototype.convertsMagnitude=function(i,e){return e?i:-i},o.prototype.bringToFront=function(i,e,n,r,a){var s=this;if(!_.isEmpty(e)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(d){return s.getListOrderPropertyFunction(d,r)});this.moveAfterIndexInternal(i,i.length-1,l,e,n,r,a)}},o.prototype.bringForward=function(i,e,n,r,a){var s=this;if(!_.isEmpty(e)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(u){return s.getListOrderPropertyFunction(u,r)});this.groupSequentialContainers(i,e,l,function(u,d,v){var p=v+1;return _.map(u,function(f){return{afterContainerIndex:p,containerName:f}})},n,r,a)}},o.prototype.sendToBack=function(i,e,n,r,a){var s=this;if(!_.isEmpty(e)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(u){return s.getListOrderPropertyFunction(u,r)});this.moveBeforeIndexInternal(i,0,l,e,n,r,a)}},o.prototype.sendBackward=function(i,e,n,r,a){var s=this;if(!_.isEmpty(e)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(u){return s.getListOrderPropertyFunction(u,r)});this.groupSequentialContainers(i,e,l,function(u,d,v){var p=d-1;return _.map(u,function(f){return{beforeContainerIndex:p,containerName:f}})},n,r,a)}},o.prototype.moveAfter=function(i,e,n,r,a){var s=this;if(!_.isEmpty(n)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(v){return s.getListOrderPropertyFunction(v,a)}),u=this.findContainerIndex(e,l,r),d=_.union(i,n);this.moveAfterIndexInternal(d,u,l,n,r,a)}},o.prototype.moveAfterIndex=function(i,e,n,r,a){var s=this;if(!_.isEmpty(n)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(u){return s.getListOrderPropertyFunction(u,a)});this.moveAfterIndexInternal(i,e,l,n,r,a)}},o.prototype.shouldNormalize=function(i,e,n){var r=this,a=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(v){return r.getListOrderPropertyFunction(v,n)}),s=this.canvasListOrderNormalizeService.shouldNormalizeListOrder(a,e);if(!s)for(var l=0,u=i;l<u.length;l++){var d=u[l];if((0,ge.q4)(d)&&(s=this.shouldNormalize(d.children,e,n)))break}return s},o.prototype.normalize=function(i,e,n){var r=this,a=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(v){return r.getListOrderPropertyFunction(v,n)}),s=this.canvasListOrderNormalizeService.normalizeListOrder(a,e);this.visualAuthoringOperations.updateContainerListOrders(i,s,n);for(var l=0,u=i;l<u.length;l++){var d=u[l];(0,ge.q4)(d)&&this.normalize(d.children,e,n)}},o.prototype.moveAfterIndexInternal=function(i,e,n,r,a,s,l){var u=this.buildOperations(r,n,a,function(d){return{containerName:d.name,afterContainerIndex:e}});this.movecanvasItems(i,u,n,a,s,l)},o.prototype.moveBefore=function(i,e,n,r,a){var s=this;if(!_.isEmpty(n)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(v){return s.getListOrderPropertyFunction(v,a)}),u=this.findContainerIndex(e,l,r),d=_.union(i,n);this.moveBeforeIndexInternal(d,u,l,n,r,a)}},o.prototype.moveBeforeIndex=function(i,e,n,r,a){var s=this;if(!_.isEmpty(n)){var l=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(u){return s.getListOrderPropertyFunction(u,a)});this.moveBeforeIndexInternal(i,e,l,n,r,a)}},o.prototype.moveBeforeIndexInternal=function(i,e,n,r,a,s,l){var u=this.buildOperations(r,n,a,function(d){return{containerName:d.name,beforeContainerIndex:e}});this.movecanvasItems(i,u,n,a,s,l)},o.prototype.findContainerIndex=function(i,e,n){var r=this.canvasListOrderNormalizeService.getSortedContainerNames(e,n);return _.findIndex(r,function(a){return a===i.name})},o.prototype.movecanvasItems=function(i,e,n,r,a,s){for(var l=this.canvasListOrderNormalizeService.getSortedContainerNames(n,r),u=[],d={},v={},p=et.oZ,f=function(O){var w=O.containerName;T.fF.assert(function(){return!d[w]},"VisualContainer is used in multiple operations");var j=void 0,ee=void 0,Y=void 0;!function(o){return null!=o.afterContainerIndex}(O)?function(o){return null!=o.beforeContainerIndex}(O)?(j=(ee=Math.max(O.beforeContainerIndex,0))-1,Y=h.convertsMagnitude(p,!r)):T.fF.assertFail("Unknown operation type"):(ee=(j=Math.min(O.afterContainerIndex,l.length-1))+1,Y=h.convertsMagnitude(p,r));var ae=h.getAfterContainerListOrderPropertyNumber(u,l,n,j),se=h.getBeforeContainerListOrderPropertyNumber(l,n,ee),re=null!=ae,he=null!=se;(!re||!he)&&(!re&&he?ae=se+Y:re&&!he?se=ae+Y:T.fF.assertFail("Could not find afterListOrderNumber and beforeListOrderNumber"));var B=(se+ae)/2;T.fF.assert(function(){return r?ae<B:B<ae},"afterListOrderNumber is not less than insertionListOrderNumber if range is positive, insertionListOrderNumber is not less than afterListOrderNumber if range is negative"),T.fF.assert(function(){return r?se>B:B>se},"beforeListOrderNumber is not greater than insertionListOrderNumber if range is positive, insertionListOrderNumber is not greater than beforePrderNumber if range is negative"),u[j]=B,v[w]=B},h=this,m=0,b=e;m<b.length;m++)f(b[m]);var V=_.extend({},n,v);this.canvasListOrderNormalizeService.shouldNormalizeListOrder(V,r)&&(V=this.canvasListOrderNormalizeService.normalizeListOrder(V,r)),s?this.visualAuthoringOperations.updateContainerListOrders(i,V,a):this.visualAuthoring.updateContainerListOrders(i,V,a)},o.prototype.getAfterContainerListOrderPropertyNumber=function(i,e,n,r){var a=i[r];if(null==a){var s=e[r];s&&(a=n[s])}return a},o.prototype.getBeforeContainerListOrderPropertyNumber=function(i,e,n){return e[i[n]]},o.prototype.groupSequentialContainers=function(i,e,n,r,a,s,l){for(var b,u=this,d=this.canvasListOrderNormalizeService.getSortedContainerNames(n,a),v=_.zipObject(_.map(e,function(O){return O.name}),_.map(e,function(){return!0})),p=e.length,f=0,h=0,m=0,y=0;y<d.length;y++){var V=d[y];if(v[V]){if(b?b.push(V):(b=[V],h=y),++f===p){m=y;break}}else if(b){var P=r(b,h,m=y-1);this.movecanvasItems(i,P,n,a,s),n=this.canvasListOrderNormalizeService.getContainerListOrders(i,function(O){return u.getListOrderPropertyFunction(O,s)}),b=null}}b&&(P=r(b,h,m),this.movecanvasItems(i,P,n,a,s,l))},o.prototype.buildOperations=function(i,e,n,r){var a=n?"asc":"desc";return _.chain(i).map(r).orderBy(function(s){return e[s.containerName]},a).value()},o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275inject(zt.F),t.\u0275\u0275inject(fe.$8),t.\u0275\u0275inject(qe.Q),t.\u0275\u0275inject(lt.F))},o.\u0275prov=t.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),Bi=c(26902),_o=c(25740),Li=c(58938),wo={provide:"dataBarsDialogLauncherService",useFactory:function(o,i,e,n){return new Fo(o,i,e,n)},deps:[Li.x,ce.o,ve.y0,fe.$8]},Fo=function(){function o(i,e,n,r){this.dialogService=i,this.localizationService=e,this.telemetryService=n,this.visualAuthoring=r}return o.prototype.show=function(i,e,n,r,a,s){return(0,g.mG)(this,void 0,void 0,function(){var l,u,d,v,f,h=this;return(0,g.Jh)(this,function(m){switch(m.label){case 0:return l=(0,Bi.aI)(i.config.singleVisual,n),u={dataBarsSettings:l,colorPalette:(0,_o.NO)(r)},d=this.localizationService.get("Visual_ConditionalFormatting_DataBars"),v={title:"".concat(d," - ").concat(e),input:u,hideOkButton:!1,hideCancelButton:!1},[4,this.dialogService.showTemplateDialog("DataBarsDialog",v,{height:"668px",width:"426px"})];case 1:return(f=m.sent()).afterClosed().subscribe(function(b){b&&h.setDataBars(b.dataBars,i,n,a,s)}),[2,f]}})})},o.prototype.setDataBars=function(i,e,n,r,a){var s=(0,Bi.ac)(i,r);this.visualAuthoring.addDataBars(e,n,s),this.telemetryService.logEvent(Ge.QBi,{visualType:(0,N.s)(e),userValueSpecified:void 0!==i.minValue||void 0!==i.maxValue,fromPropertyPane:a,visualName:e.name})},o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275inject(Li.x),t.\u0275\u0275inject(ce.o),t.\u0275\u0275inject(ve.y0),t.\u0275\u0275inject(fe.$8))},o.\u0275prov=t.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),Ni=c(52298),Ri=c(57871),Me=c(78417),To=c(83400),Do=c(71216),ut=c(43286),Vo={provide:"explorationAuthoring",useFactory:function(o,i,e,n,r,a,s,l,u,d){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(v){return[2,new Io(o,i,e,n,r,a,s,l,u,d)]})})},deps:[oe.J,Vt.Z,te.z,Et.L,le.vZ,Ni.e,ce.o,we.t,ve.y0,Ye.z]},Io=function(){function o(i,e,n,r,a,s,l,u,d,v){this.eventBridge=i,this.explorationNavigation=n,this.featureSwitchService=a,this.linguisticSchemaProxy=s,this.promiseFactory=u,this.undoRedo=v,this.explorationAuthoringOps=new Ao(e,n,r,l,d)}return o.prototype.renameSection=function(i,e,n){var r=this,a=i.exploration.contract,s=a.sections[n].name;this.undoRedo.register("RenameNavigationTab",function(){r.explorationAuthoringOps.renameSection(i,e,n),(0,Me.D6)(a,s,e,r.linguisticSchemaProxy,!1).then(function(){r.eventBridge.publishToChannel(k.TTT,{sectionName:e,sectionIndex:n})})})},o.prototype.createSection=function(i,e,n,r,a){var s=this;this.undoRedo.register("CreateSection",function(){s.explorationAuthoringOps.createSection(i,e,n,r,a)})},o.prototype.duplicateSection=function(i,e){var n=this;this.undoRedo.register("DuplicateSection",function(){var r=n.explorationAuthoringOps.duplicateSection(i,e);(0,Me.bx)(i.exploration.contract,r,e,n.linguisticSchemaProxy,n.promiseFactory).then(function(){n.explorationAuthoringOps.insertSection(i,r)})})},o.prototype.deleteSection=function(i,e,n){var r=this,a=function(){var l=i.exploration.contract;(0,Me.Og)(l,l.sections[e].name,r.linguisticSchemaProxy).then(function(){r.explorationAuthoringOps.deleteSection(i,e),r.eventBridge.publishToChannel(k.HGU,{sectionIndex:e})})};n?this.undoRedo.register("DeleteSection",function(){a()}):a()},o.prototype.insertSection=function(i,e){var n=this;this.undoRedo.register("InsertSection",function(){n.explorationAuthoringOps.insertSection(i,e)})},o.prototype.setSectionVisibility=function(i,e){var n=this;this.undoRedo.register("SetSectionVisibility",function(){n.explorationAuthoringOps.setSectionVisibility(i,e)})},o.prototype.reorderSection=function(i,e,n){var r=this;this.undoRedo.register("ReorderSection",function(){r.explorationAuthoringOps.reorderSection(i,e,n)})},o.prototype.setSectionType=function(i,e,n,r){var a=this,s=function(){0===n?a.explorationAuthoringOps.clearSectionType(e,~n):a.explorationAuthoringOps.setSectionType(e,n),(0,Me.TJ)(i,e.name,(0,Me.wj)(e,a.featureSwitchService.featureSwitches.onObject))};r?s():this.undoRedo.register("SetSectionType",s)},o.prototype.clearSectionType=function(i,e,n){var r=this;0!==n?this.undoRedo.register("ClearSectionType",function(){r.explorationAuthoringOps.clearSectionType(e,n),(0,Me.TJ)(i,e.name,(0,Me.wj)(e,r.featureSwitchService.featureSwitches.onObject))}):T.fF.assertFail('Can not clear a "Regular" default section state')},o.prototype.setDrillthroughFilterPassingMode=function(i,e,n){var r=this;this.undoRedo.register("setDrillthroughFilterPassingMode",function(){r.explorationAuthoringOps.setDrillthroughFilterPassingMode(i,e,n)})},o.prototype.setCrossReportDrillthrough=function(i,e,n,r){var a=this;void 0===r&&(r=!0),r?this.undoRedo.register("setCrossReportDrillthrough",function(){a.explorationAuthoringOps.setCrossReportDrillthrough(i,e,n)}):this.explorationAuthoringOps.setCrossReportDrillthrough(i,e,n)},o.prototype.setDataSourceVariables=function(i,e){var n=this;void 0===e&&(e=this.explorationNavigation.getCurrentExploration()),T.fF.assertValue(e,"contract"),this.undoRedo.register("setDataSourceVariables",function(){n.explorationAuthoringOps.setDataSourceVariables(e,i),n.eventBridge.publishToChannel(k.jCS,{affectContainer:_.stubTrue})})},o.prototype.setCanvasDisplay=function(i){this.eventBridge.publishToChannel(k.Pkb,i)},(0,g.gn)([(0,g.fM)(7,(0,t.Inject)(we.t)),(0,g.w6)("design:paramtypes",[oe.J,Vt.Z,te.z,Et.L,le.vZ,Ni.e,ce.o,Object,ve.y0,Ye.z])],o)}(),Ao=function(){function o(i,e,n,r,a){this.explorationActivity=i,this.explorationNavigation=e,this.explorationSerializer=n,this.localization=r,this.telemetryService=a}return o.prototype.renameSection=function(i,e,n){var r=i.exploration;r.contract.sections[n].displayName=e;var a=r.sections;a[n].displayName=e,a[n].isTabEditable=!1,this.explorationNavigation.emitUpdatedSections()},o.prototype.duplicateSection=function(i,e){var n=i.exploration.contract;T.fF.assert(function(){return e<=n.sections.length},"Expected target index should be less than or equals sections length.");var r=this.explorationSerializer.serializePage(n.sections[e],1),a=this.explorationSerializer.deserializePage(r,{enableVisualContainerGrouping:n.settings&&n.settings.useStylableVisualContainerHeader});return a.name=ji(n),(0,To.gs)(a,i.exploration.contract.sections),a.displayName=this.localization.format("DuplicateSectionName_StartingText",[a.displayName]),a},o.prototype.insertSection=function(i,e){var n=this;this.explorationActivity.doRootActivity(function(r){e.id=void 0,e.objectId=void 0;var s=i.exploration.contract.sections;s.push(e),i.exploration.sections.push((0,G.Iu)(e,n.localization));var u=s.length-1;n.explorationNavigation.updateActiveSection({targetSectionIndex:u,forceUpdate:i.sectionStatus.currentSectionNumber===u,parentActivity:r}),n.explorationNavigation.emitUpdatedSections()},function(){return n.telemetryService.startChildActivity(void 0,De.$0)})},o.prototype.deleteSection=function(i,e){var n=this;this.explorationActivity.doRootActivity(function(r){var a=i.exploration.contract;if(e>-1&&a&&e<a.sections.length){var s=a.sections[e];a.sections.splice(e,1);var l=i.exploration.sections,u=l[e];u&&u.contract===s&&l.splice(e,1);var d=i.sectionStatus.currentSectionNumber;if(d===e){var v=e;v>=a.sections.length&&(v=a.sections.length-1),n.explorationNavigation.updateActiveSection({targetSectionIndex:v,forceUpdate:d===v,suppressHistory:!0,parentActivity:r})}else{var f=e>d?d:d-1;i.sectionStatus.currentSectionNumber=f,a.activeSectionIndex=f}}n.explorationNavigation.emitUpdatedSections()},function(){return n.telemetryService.startChildActivity(void 0,De.yw)})},o.prototype.createSection=function(i,e,n,r,a){var s=i.exploration.contract;n||(n={displayOption:1,width:Ri.$z,height:Ri.az});var l={name:ji(s),displayName:a||(0,Do.Vk)(s.sections,this.localization),size:n,objects:r,visualContainers:[],visualContainerGroups:[],filters:[],acceptsAllFiltersWhenLinked:void 0,howCreated:e??"Default",isNew:!0};this.insertSection(i,l),this.explorationNavigation.emitUpdatedSections()},o.prototype.reorderSection=function(i,e,n){if(e<0||n<0)return!1;var r=!1,a=i.exploration.contract.sections,s=a[e];a.splice(e,1),a.splice(n,0,s);var l=i.exploration.sections,u=l[e];u&&u.contract===s&&(l.splice(e,1),l.splice(n,0,u),r=!0);for(var d=l.length-1;d>=0;--d)if(l[d].selected){i.sectionStatus.currentSectionNumber=d;break}return this.explorationNavigation.emitUpdatedSections(),r},o.prototype.setSectionVisibility=function(i,e){i.visibility=e,this.explorationNavigation.emitUpdatedSections()},o.prototype.setSectionType=function(i,e){T.fF.assert(function(){return!((0,ut.yE)(e,2)&&(0,ut.yE)(e,1))},"Tooltip and Drillthrough types cannot co-exist!"),(0,ut.yE)(e,2)&&this.clearSectionType(i,1),(0,ut.yE)(e,1)&&this.clearSectionType(i,2),i.type|=e,this.explorationNavigation.emitUpdatedSections()},o.prototype.clearSectionType=function(i,e){i.type&=~e,this.explorationNavigation.emitUpdatedSections()},o.prototype.setDrillthroughFilterPassingMode=function(i,e,n){(0,Me.rF)(i,e.name,(0,Me.Js)(n))},o.prototype.setCrossReportDrillthrough=function(i,e,n){(0,Me.kt)(i,e.name,(0,Me.zO)(n))},o.prototype.setDataSourceVariables=function(i,e){i.dataSourceVariables=e},o}();function ji(o){var i=_.map(o.sections,function(n){return n.name}),e=_.zipObject(i,_.map(i,function(){return!0}));return zi.q.generateUniqueId(e)}var ko=c(49092),zo=c(88565),Bo=c(77435),Lo=c(66028),No=c(28107),Ro=c(33163),jo=c(88175),Wo=c(73875),Go=c(82755),Wi=c(28326),dt=c(80777),Bt='"',Lt=",",$o="yyyy-MM-dd HH:mm:ss",Uo="'";function Ho(o,i,e){var n,r=o.table;if(!r)return"";var a=r.columns;T.fF.assertValue(a,"columns metadata is null");var s="",l=0;(null==e||e>r.rows.length)&&(e=r.rows.length);for(var u=0;u<e;u++){var d=r.rows[u],v=[];d.length>l&&(l=d.length);for(var p=0,f=d.length;p<f;p++){var h=a[p],m=h&&h.type,b=(0,Go.NA)(null===(n=d.objects)||void 0===n?void 0:n[p],i);v.push(Ko(d[p],m,b||h&&h.format))}v.length>0&&(s+=v.join(Lt)+"\r\n")}return s=function(o,i){(i<=0||i>o.length)&&(i=o.length);for(var e=[],n=0;n<i;n++)e.push(Gi(o[n].displayName));return e.join(Lt)}(a,l)+"\r\n"+s,s}function Ko(o,i,e){return null==o?"":(i||(i=function(o){return T.fF.assertValue(o,"value"),_.isDate(o)?dt.Ge.fromPrimitiveTypeAndCategory(6):_.isBoolean(o)?dt.Ge.fromPrimitiveTypeAndCategory(5):_.isNumber(o)?dt.Ge.fromPrimitiveTypeAndCategory(3):dt.Ge.fromPrimitiveTypeAndCategory(1)}(o)),Gi(i.dateTime?Wi.dx.formatValue(o,$o):i.bool||i.numeric&&!e?o.toString():i.numeric?Wi.dx.formatValue(o,function(o){return T.fF.assertValue(o,"format"),o.replace(/(\r\n|\n|\r|,)/g,"")}(e)):function(o){return("="===o.charAt(0)||"-"===o.charAt(0)||"+"===o.charAt(0)||"@"===o.charAt(0))&&(o=Uo.concat(o)),o}(o.toString())))}function Gi(o){return null==o?"":(o=o.replace(/\"/g,'""'),_.includes(o,"\n")||_.includes(o,Bt)||_.includes(o,Lt)||_.includes(o,"\r")||0===o.length?Bt+o+Bt:o)}var $i=c(42220),Yo=c(74593),qo=c(48706),ea=c(13479),Ui=c(74804),Hi=c(29169),ta=c(11077),Nt=c(89522),$e=c(94853),Qi=c(53497),ia=c(16699),na=c(14599),ra=c(48708),Ki=c(38078),pt=c(71813),oa=c(39317),aa=c(25992),sa=c(5361),la=c(8679),ca={provide:"exportVisualData",useFactory:function(o,i,e,n,r,a,s,l,u,d,v,p,f,h,m){var b=(0,Ht.Vz)(o,a,r,s,m,l),y=h.create();return new va(b,o,i,e,n,l,u,d,s,v,p,f,m,y)},deps:[Pe.D,zo.S,ko.d,Z.i,Ut.C,Bo.q,le.vZ,Je.O,ce.o,la.z,jo.U,Wo.O,qe.Q,Lo.P,No.Q]},vt=1e6,va=function(){function o(i,e,n,r,a,s,l,u,d,v,p,f,h,m){this.visualAuthoringCore=i,this.visualPluginService=e,this.visualQueryGenerator=n,this.dataProxy=r,this.conceptualSchemaProxy=a,this.displayNameService=s,this.localizationService=l,this.localeProviderService=u,this.featureSwitchService=d,this.exportToExcelProxy=v,this.httpService=p,this.visualAuthoringOperations=f,this.visualAuthoringCustomizeOperations=h,this.visualParameterService=m,T.fF.assertValue(i,"visualAuthoring"),T.fF.assertValue(e,"visualPluginService"),T.fF.assertValue(n,"visualQueryGenerator"),T.fF.assertValue(r,"dataProxy"),T.fF.assertValue(a,"conceptualSchemaProxy"),T.fF.assertValue(s,"displayNameService"),T.fF.assertValue(l,"localizationService"),T.fF.assertValue(u,"localeProviderService"),T.fF.assertValue(f,"visualAuthoringOperations")}return o.prototype.exportToCsv=function(i,e,n,r,a,s){return(0,g.mG)(this,void 0,void 0,function(){var l,u,d,v,p,f,h,m,b,V=this;return(0,g.Jh)(this,function(P){switch(P.label){case 0:return T.fF.assertAnyValue(i,"visualTitle"),T.fF.assertAnyValue(e,"visualData"),T.fF.assertValue(n,"dataSources"),T.fF.assertValue(r,"visualContainer"),T.fF.assertAnyValue(a,"additionalFilters"),u=(l=e&&e.data)&&l.dataViewSource,l&&(d=l.isFirstSegment),v=e&&e.dataTransforms,null==n||null==v||null==u||(0,Nt.e6)(r)?[3,2]:[4,this.exportDataViewSourceToCSV(u,v,null!=s,i,this.featureSwitchService.featureSwitches,d,s)];case 1:if(null!=(p=P.sent()))return[2,Promise.resolve(p)];P.label=2;case 2:return[4,this.getConceptualSchema(n)];case 3:return f=P.sent(),[4,this.getGeneratedQuery(f,r,n,a,v?.selects)];case 4:return(h=P.sent())&&h.result&&!h.result.error?(this.overrideDataReduction((m=h.result).options.query.command,s=s??vt,!1),m&&m.options&&m.options.query&&(m.options.query.cacheResponseOnClient=!1),b=m.transforms,[2,this.queryData(m.options,function(w){return V.exportDataViewSourceToCSV(w,b,!0,i,V.featureSwitchService.featureSwitches,void 0,s)})]):[2,Promise.resolve({blob:null,errorDetails:{errorType:0}})]}})})},o.prototype.getConceptualSchema=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.conceptualSchemaProxy.get(i)];case 1:return e=r.sent(),[3,3];case 2:return r.sent(),[2,Promise.reject({blob:null,errorDetails:{errorType:3}})];case 3:return[2,e]}})})},o.prototype.exportToExcel=function(i,e,n,r,a,s,l,u){var d;return(0,g.mG)(this,void 0,void 0,function(){var v,p,h,m,b,y,P,O,w,j,ee,Y,ae,se=this;return(0,g.Jh)(this,function(re){switch(re.label){case 0:return T.fF.assertAnyValue(i,"visualTitle"),T.fF.assertValue(n,"dataSources"),T.fF.assertValue(r,"visualContainer"),T.fF.assertAnyValue(a,"additionalFilters"),T.fF.assertAnyValue(s,"filtersDescription"),T.fF.assertAnyValue(l,"exportType"),[4,this.getConceptualSchema(n)];case 1:return v=re.sent(),2!==l?[3,2]:(p=this.getGeneratedQueryMatrixDataLayout(v,r,n,a),[3,4]);case 2:return[4,this.getGeneratedQuery(v,r,n,a,null===(d=e?.dataTransforms)||void 0===d?void 0:d.selects)];case 3:p=re.sent(),re.label=4;case 4:return p&&p.result&&!p.result.error?(m=(h=p.result).options.query.command,b=r.config.singleVisual,T.fF.assert(function(){return!_.isEmpty(m.Commands)},"query command should contains Commands"),T.fF.assertValue(m.Commands[0].SemanticQueryDataShapeCommand,"The first command must be a SemanticQuery command"),2===l?(y=this.generateExportVisualLayoutDataCommand(v,m.Commands[0].SemanticQueryDataShapeCommand.Query,b,h.transforms,s),m.Commands.push(y),this.overrideDataReduction(m,vt,this.featureSwitchService.featureSwitches.useWindowWhenExporting)):(P=this.generateExportDataCommand(v,m.Commands[0].SemanticQueryDataShapeCommand.Query,s,b,h.transforms,p.selectsWithDisplayName),m.Commands.push(P),this.clearDataQuerySubtotal(m),3===l&&this.setConnectedExportRowLimit(r.config.singleVisual.query,m.Commands[0].SemanticQueryDataShapeCommand.Query),this.overrideDataReduction(m,vt,!1)),(O=this.httpService.powerbiRequestOptions()).responseType="blob",O.retryCount=0,w=(0,ea.xV)([m],(0,Ui.kB)((0,Ui.$$)(n,b.query&&b.query.defn))),j=(0,$i.u5)(w,this.localeProviderService),3===l&&(0,$i.K4)(j)?[2,Promise.reject({blob:null,errorDetails:{errorType:7}})]:(ee={exportDataType:l,executeSemanticQueryRequest:j,artifactId:u},Y=1,[2,(ae=function(){return(0,g.mG)(se,void 0,void 0,function(){var B,Oe,Ue,gt,He;return(0,g.Jh)(this,function(Qe){switch(Qe.label){case 0:return Qe.trys.push([0,2,,3]),[4,this.exportToExcelProxy.exportToExcel(ee,O)];case 1:return B=Qe.sent(),[3,3];case 2:return Oe=Qe.sent(),Y>0&&0===Oe?.status&&"NetworkConnectionIssue"===(null===(He=Oe.error)||void 0===He?void 0:He.code)?(Y--,[2,ae()]):[2,this.handleExportToExcelErrorResult(Oe)];case 3:return B.headers&&(Ue=B.headers("requestId")),0===B.data.size?[2,Promise.reject({blob:null,requestId:Ue,errorDetails:{errorType:1}})]:(gt={blob:B.data,requestId:Ue,isPartialResult:!1,format:1,fileName:o.getFileName(i,1)},[2,Promise.resolve(gt)])}})})})()])):[2,Promise.reject({blob:null,errorDetails:{errorType:0}})]}})})},o.prototype.handleExportToExcelErrorResult=function(i){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r,a,s,l,u;return(0,g.Jh)(this,function(d){switch(d.label){case 0:if(i.headers&&(e=i.headers("requestId")),!(i.data&&i.data instanceof Blob&&_.startsWith(i.data.type,"application/json")))return[3,9];r=new FileReader,a=void 0,d.label=1;case 1:return d.trys.push([1,3,,5]),[4,this.readAsText(i.data,r)];case 2:return a=d.sent(),[3,5];case 3:return s=d.sent(),[4,this.getDefaultQueryErrorExportDataResult(s,e)];case 4:return u=d.sent(),[2,Promise.reject(u)];case 5:return(l=JSON.parse(a))&&l.error&&(n=(0,$e.GB)(l.error)),n?[2,Promise.reject(this.getTelemetryErrorExportDataResult(n,e))]:[3,6];case 6:return[4,this.getDefaultQueryErrorExportDataResult(a,e)];case 7:return u=d.sent(),[2,Promise.reject(u)];case 8:return[3,12];case 9:return i.error||i.data&&i.data.error?(n=(0,$e.GB)(i.error?i.error:i.data.error),[2,Promise.reject(this.getTelemetryErrorExportDataResult(n,e,i.status))]):[3,10];case 10:return[4,this.getDefaultQueryErrorExportDataResult(i.data,e)];case 11:return u=d.sent(),[2,Promise.reject(u)];case 12:return[2]}})})},o.prototype.getCustomizedVisualArgs=function(i,e){if(T.fF.assertValue(i,"hostVisualContainer is undefined"),i){if(!this.visualAuthoringCustomizeOperations.requiresCustomizeConvert(i))return{customizedVisualContainer:i,mergedFilters:e};var n=Ki.b$.generateGuid(),r={singleVisual:(0,Le.d9)(i.config.singleVisual)},a=this.visualAuthoringOperations.buildVisualContainerFromConfig(n,r,"Default");return a.name=i.name,this.visualAuthoringCustomizeOperations.customizeConvert(a),{customizedVisualContainer:a,mergedFilters:this.mergeCustomizedFilters(a.filters,e)}}},o.prototype.readAsText=function(i,e){if(void 0!==i)return new Promise(function(n,r){e.onload=function(){n(e.result)},e.onerror=function(){r(e.error)},e.readAsText(i)})},o.prototype.getDefaultQueryErrorExportDataResult=function(i,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,a,l;return(0,g.Jh)(this,function(u){switch(u.label){case 0:if(n=i.toString(),!(i instanceof Blob))return[3,5];r=new FileReader,a=void 0,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.readAsText(i,r)];case 2:return a=u.sent(),[3,4];case 3:return u.sent(),[2,Promise.resolve({blob:null,requestId:e,errorDetails:{errorType:2,errorMessage:n,errorSource:(0,$e.oG)("System")}})];case 4:return n=a,(l=JSON.stringify(a))&&l.length>2&&(n=l),[2,Promise.resolve({blob:null,requestId:e,errorDetails:{errorType:2,errorMessage:n,errorSource:(0,$e.oG)("System")}})];case 5:return"object"==typeof i&&(l=JSON.stringify(i))&&l.length>2&&(n=l),[2,Promise.resolve({blob:null,requestId:e,errorDetails:{errorType:2,errorMessage:n,errorSource:(0,$e.oG)("System")}})]}})})},o.prototype.getTelemetryErrorExportDataResult=function(i,e,n){return{blob:null,requestId:e,errorDetails:{errorType:i.errorCode===Qi._h?6:2,errorCode:i.errorCode,errorSource:i.errorCode===Qi._h?(0,$e.oG)("User"):i.errorSource,errorMessage:i.errorCode,status:n}}},o.prototype.mergeCustomizedFilters=function(i,e){var n=new ta.ME;if(e&&!_.isEmpty(e.dataFiltersUnmerged))for(var r=0,a=e.dataFiltersUnmerged;r<a.length;r++)n.addVisualFilter(a[r]);for(var u=0,d=_.isEmpty(i)?[]:_.chain(i).filter(function(p){return p.filter}).map(function(p){return p.filter}).value();u<d.length;u++)n.addVisualFilter({filter:d[u]});return n.getFilters(!1)},o.prototype.resolveQueryParameters=function(i,e,n,r){return this.visualParameterService.resolve({dataSources:e,schema:i,additionalFilters:n,config:r.config.singleVisual,visual:r})},o.prototype.getGeneratedQuery=function(i,e,n,r,a){return(0,g.mG)(this,void 0,void 0,function(){var s,u,d,v,p,f,h,m,b,y,V,P,O,w,j,ee,Y,se,re,he;return(0,g.Jh)(this,function(B){switch(B.label){case 0:return s=(0,Le.d9)(e.config.singleVisual),this.visualAuthoringCustomizeOperations.requiresCustomizeConvert(e)&&(u=this.getCustomizedVisualArgs(e,r),s=u.customizedVisualContainer.config.singleVisual,r=u.mergedFilters),s=this.replaceSparklineDataWithMeasure(i,s),d=this.getPercentRoleSelectIndexToDisplayNameMapping(s,i),this.rewritePercentRoleRefs(s,r),v=this.mapSelectIndexWithExprs(s,d),this.clearConversionContextWithPercentRole(s),this.clearVisualConfigObjects(s),[4,this.visualPluginService.ensureBuiltInPlugins()];case 1:return B.sent(),p=this.visualPluginService.getPlugin(J.L.tableEx.name),e.config.singleVisual.visualType===p.name?[3,3]:(f=this.visualAuthoringCore.convert({schema:i,source:s,target:p.name}),(h=_.clone(e)).config=_.clone(h.config),h.config.singleVisual=s,[4,this.resolveQueryParameters(i,n,r,h)]);case 2:if(B.sent(),!f)return[2];B.label=3;case 3:if(b=(m=s.query).projections,y=this.visualPluginService.capabilities(J.L.tableEx.name),!_.isEmpty(a))for(V=0,P=a;V<P.length;V++)O=P[V],!_.isEmpty(O.relatedSelects)&&O.expr&&m.add(O.expr,y.dataRoles[0].name);for(w=function(Ue){var gt=_.find(m.defn.select(),function(Qe){return(0,xe.fS)(Qe.expr,Ue.expr)}),He=j.getQueryProjectionForSelect(gt,b);He&&(He.displayName=Ue.name)},j=this,ee=0,Y=v;ee<Y.length;ee++)w(Y[ee]);return(se=_.cloneDeep(y.dataViewMappings))[0].table.rows.dataReductionAlgorithm={top:{count:vt}},re=(0,Hi.c)(n),he=re&&re.getDataSourceVariables(),[2,{result:this.visualQueryGenerator.execute({dataSources:n,config:s,schema:i,additionalFilters:r,dataViewMappingsOverride:se,dataSourceVariables:he}),selectsWithDisplayName:v}]}})})},o.prototype.getGeneratedQueryMatrixDataLayout=function(i,e,n,r){var a=(0,Le.d9)(e.config.singleVisual);a=this.replaceSparklineDataWithMeasure(i,a);var s=(0,Hi.c)(n),u=s&&s.getDataSourceVariables();return{result:this.visualQueryGenerator.execute({dataSources:n,config:a,schema:i,additionalFilters:r,dataViewMappingsOverride:void 0,dataSourceVariables:u}),selectsWithDisplayName:void 0}},o.prototype.replaceSparklineDataWithMeasure=function(i,e){var n={name:"vc",config:{singleVisual:e}};return(0,Nt.e6)(n)?((0,Nt.Gy)(i,n,this.visualAuthoringOperations),n.config.singleVisual):e},o.prototype.queryData=function(i,e){return(0,g.mG)(this,void 0,void 0,function(){var n,a;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.dataProxy.execute(i)];case 1:return n=s.sent(),[3,3];case 2:return s.sent(),[2,Promise.reject({blob:null,errorDetails:{errorType:2}})];case 3:return[4,e(n.dataViewSource)];case 4:return[2,null!=(a=s.sent())?Promise.resolve(a):Promise.reject({blob:null,errorDetails:{errorType:1}})]}})})},o.prototype.exportDataViewSourceToCSV=function(i,e,n,r,a,s,l){return(0,g.mG)(this,void 0,void 0,function(){var u,d,v,f,h,m;return(0,g.Jh)(this,function(b){switch(b.label){case 0:return T.fF.assertValue(i,"dataViewSource"),T.fF.assertValue(e,"transformActions"),(u=o.readDataViewSource(i,a))&&(v=(d=u.dataView)&&d.table)?_.filter(v.columns,function(y){return null!=y.index&&!_.find(v.columns,function(V){return V.formatSource&&V.formatSource.formatString===y})}).length!==e.selects.length||(f=o.isPartialResult(u,s))&&!n?[2]:[4,this.visualPluginService.ensureBuiltInPlugins()]:[2];case 1:return b.sent(),h=this.visualPluginService.capabilities(J.L.table.name),m=(0,aa.nn)({transforms:e,dataRoles:h.dataRoles,objectDescriptors:h.objects,prototype:d,colorAllocatorFactory:(0,oa.V)(),dataViewMappings:h.dataViewMappings,visualStyle:(0,ra.Ue)(),featureSwitches:this.featureSwitchService.featureSwitches}).dataViews,_.isEmpty(m)||null!=l&&void 0!==s&&o.isRowsBelowLimit(m[0],l)?[2]:f||null==l||!(f=o.isRowsAboveLimit(m[0],l))||n?[2,{isPartialResult:f,blob:Ho(m[0],na.e0.formatString,l),format:0,fileName:o.getFileName(r,0)}]:[2]}})})},o.isRowsAboveLimit=function(i,e){var n=i.table;return!!n&&n.rows.length>e},o.isRowsBelowLimit=function(i,e){var n=i.table;return!!n&&n.rows.length<e},o.readDataViewSource=function(i,e){var n;try{n=(0,qo.ij)(31,i.data,(0,ia.u)(e))}catch(r){return}return n},o.isPartialResult=function(i,e){if(!i)return!1;var n=_.some(i.warnings,function(r){return r instanceof Yo.x});return!!i.restartToken||n||void 0!==e},o.getFileName=function(i,e){var n="data";if(!_.isEmpty(i)){var r=(0,Ki.k4)(i);_.isEmpty(r)||(n=r)}switch(e){case 0:return n+".csv";case 1:return n+".xlsx";default:T.fF.assertFail("Unknown format type")}},o.prototype.generateExportDataCommand=function(i,e,n,r,a,s){var l=this,u=be.ib.deserializeQuery(e),d={includeVariationSource:!0,includeDefaultAggregate:!0,includeHierarchyName:!0},v=this.visualPluginService.capabilities(r.visualType),p=_.map(u.select(),function(h){var m=_.find(s,function(b){return(0,xe.fS)(h.expr,b.expr)});return{queryName:h.name,displayName:m?m.name:l.displayNameService.getDisplayName(h.expr,i,v,h.name,r.columnProperties,d),qualifiedDisplayName:m?m.name:l.displayNameService.getQualifiedDisplayName(h.expr,i,v,d)}});return o.ensureUniqueName(p,n),{ExportDataCommand:{Columns:_.map(p,function(h){return{QueryName:h.queryName,Name:h.useQualified?h.qualifiedDisplayName:h.displayName}}),Ordering:this.getTableOrderingFromTransforms(a)||this.getDefaultTableOrdering(u.select().length),FiltersDescription:this.generateFiltersDescriptionString(n)}}},o.prototype.generateExportVisualLayoutDataCommand=function(i,e,n,r,a){var s=this,l=be.ib.deserializeQuery(e),u={includeVariationSource:!0,includeDefaultAggregate:!1,includeHierarchyName:!0},d=this.visualPluginService.capabilities(n.visualType);return{ExportDataCommand:{Columns:_.map(l.select(),function(m){var b=s.displayNameService.getDisplayName(m.expr,i,d,m.name,n.columnProperties,u);return{QueryName:m.name,Name:b}}),Ordering:this.getTableOrderingFromTransforms(r)||[],FiltersDescription:this.generateFiltersDescriptionString(a)}}},o.prototype.getTableOrderingFromTransforms=function(i){if(i.roles&&i.roles.ordering)return i.roles.ordering[Ro.xP.ValuesRoleName]},o.prototype.getDefaultTableOrdering=function(i){return _.range(i)},o.ensureUniqueName=function(i,e){var n={},r={};T.fF.assertValue(i,"selectsNames"),T.fF.assertValue(e,"filtersDescription");for(var l=[],u=0,d=i.concat(e.filtersNamesAndRestatements||[]);u<d.length;u++)if((v=d[u]).displayName){l.push(v);var p=v.displayName.toLowerCase(),f=v.qualifiedDisplayName.toLowerCase();p in n&&n[p]!==f&&(r[p]=!0),n[p]=f}else v.useQualified=!0;for(var h=0,m=l;h<m.length;h++){var v;(v=m[h]).useQualified=r[v.displayName.toLowerCase()]}},o.prototype.generateFiltersDescriptionString=function(i){if(null==i.filtersNamesAndRestatements)return"";if(0===i.filtersNamesAndRestatements.length)return this.localizationService.get("ExportData_NoAppliedFiltersText");for(var e="",n=0,r=i.filtersNamesAndRestatements;n<r.length;n++){var a=r[n];e=e.concat(this.localizationService.format("ExportData_SingleFilterText",["\n",a.useQualified?a.qualifiedDisplayName:a.displayName,a.restatement]))}return this.localizationService.format("ExportData_AppliedFiltersText",[e])},o.prototype.overrideDataReduction=function(i,e,n,r){r=r||100,i.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction=n?{Primary:(0,pt.P)({window:{count:e}},void 0),Secondary:(0,pt.P)({top:{count:r}},void 0)}:{Primary:(0,pt.P)({top:{count:e}},void 0),Secondary:(0,pt.P)({top:{count:r}},void 0)}},o.prototype.clearDataQuerySubtotal=function(i){for(var e=0,n=i.Commands[0].SemanticQueryDataShapeCommand.Binding.Primary.Groupings;e<n.length;e++){var r=n[e];null!=r.Subtotal&&(r.Subtotal=0)}},o.prototype.clearVisualConfigObjects=function(i){i.objects=void 0,i.vcObjects=void 0},o.prototype.getPercentRoleSelectIndexToDisplayNameMapping=function(i,e){for(var n=this.visualPluginService.capabilities(i.visualType),a=i.query.defn.select(),s=[],l=0;l<a.length;l++){var u=a[l];if((0,_t.fv)(u.expr)){var d=this.displayNameService.getDisplayName(u.expr,e,n,u.name,i.columnProperties);s.push({selectIndex:l,displayName:d})}}return s},o.prototype.rewritePercentRoleRefs=function(i,e){var n=i.query,r=n.defn.select(),s=new ga(r,n.projections);n.defn=n.defn.rewrite(s),e&&e.dataFilter&&(e.dataFilter=e.dataFilter.rewrite(s))},o.prototype.mapSelectIndexWithExprs=function(i,e){for(var n=i.query.defn.select(),r=[],a=0,s=e;a<s.length;a++){var l=s[a];r.push({expr:n[l.selectIndex].expr,name:l.displayName})}return r},o.prototype.clearConversionContextWithPercentRole=function(i){if(i.conversionSourceContext&&i.conversionSourceContext.query)for(var r=0,a=i.conversionSourceContext.query.defn.select();r<a.length;r++)if((0,_t.fv)(a[r].expr)){i.conversionSourceContext=void 0;break}},o.prototype.getQueryProjectionForSelect=function(i,e){for(var n in e){var r=e[n].all(),a=_.find(r,function(s){return s.queryRef===i.name});if(a)return a}},o.prototype.setConnectedExportRowLimit=function(i,e){var n=5e5;!i||this.checkQueryForAllMeasures(i)||(null==e.Top||e.Top>n)&&(e.Top=n)},o.prototype.checkQueryForAllMeasures=function(i){return _.every(i.defn.select(),function(e){return(0,oi.k)(e.expr)})},o}(),ga=function(o){function i(e,n){var r=o.call(this)||this;return r.selects=e,r.projections=n,r}return(0,g.ZT)(i,o),i.prototype.visitScopedEval=function(e){for(var n=this,r=[],a=!1,s=0,l=e.scope;s<l.length;s++){var u=l[s];if((0,Ce.yL)(u)){a=!0;var d=this.projections[u.role];if(d){var v=d.all();r.push.apply(r,_.map(v,function(p){return n.selects.withName(p.queryRef).expr}))}}else r.push(u)}return a?new at.kC(e.expression,r):e},i}(sa.b),Ji=c(43626),fa={provide:Ji.DS,useFactory:function(o,i,e,n,r,a,s,l,u){return new ma(o,i,e,n,r,s,a,l,u)},deps:[Z.i,de.D,oe.J,le.vZ,je.RD,we.t,me.z,ve.y0,fe.$8]},ma=function(){function o(i,e,n,r,a,s,l,u,d){this.conceptualSchemaProxy=i,this.dataSources=e,this.eventBridge=n,this.featureSwitchService=r,this.groupAuthoring=a,this.selection=s,this.promiseFactory=l,this.telemetryService=u,this.visualAuthoring=d}return o.prototype.createFieldWellBucketCore=function(){return new pi({conceptualSchemaProxy:this.conceptualSchemaProxy,dataSources:this.dataSources,eventBridge:this.eventBridge,featureSwitchService:this.featureSwitchService,groupAuthoring:this.groupAuthoring,promiseFactory:this.promiseFactory,selection:this.selection,telemetryService:this.telemetryService,visualAuthoring:this.visualAuthoring})},o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275inject(Z.i),t.\u0275\u0275inject(de.D),t.\u0275\u0275inject(oe.J),t.\u0275\u0275inject(le.vZ),t.\u0275\u0275inject(je.RD),t.\u0275\u0275inject(me.z),t.\u0275\u0275inject(we.t),t.\u0275\u0275inject(ve.y0),t.\u0275\u0275inject(fe.$8))},o.\u0275prov=t.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),Ca={provide:Ji.E6,useFactory:function(o,i,e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V,P,O,w){return new ba(o,i,e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V,P,O,w)},deps:[Z.i,de.D,oe.J,te.z,le.vZ,je.RD,_e.H,ce.o,Ot.x,we.t,st.g,me.z,Ne.P,Ft.s,wt.f,ve.y0,fe.$8,Re.w,Pe.D,Ie.w,ue.r]},ba=function(){function o(i,e,n,r,a,s,l,u,d,v,p,f,h,m,b,y,V,P,O,w,j){this.conceptualSchemaProxy=i,this.dataSources=e,this.eventBridge=n,this.explorationNavigation=r,this.featureSwitchService=a,this.groupAuthoring=s,this.lazyScoped=l,this.localizationService=u,this.modelChangeHandler=d,this.promiseFactory=v,this.screenReaderService=p,this.selection=f,this.showValueAsService=h,this.sparklinesService=m,this.themeService=b,this.telemetryService=y,this.visualAuthoring=V,this.visualCalcEagerService=P,this.visualPlugin=O,this.visibilityService=w,this.contextActivityService=j}return o.prototype.createFieldWellFieldCore=function(i,e){return new ui({conceptualSchemaProxy:this.conceptualSchemaProxy,dataSources:this.dataSources,eventBridge:this.eventBridge,explorationNavigation:this.explorationNavigation,featureSwitchService:this.featureSwitchService,groupAuthoring:this.groupAuthoring,lazyScoped:this.lazyScoped,localizationService:this.localizationService,modelChangeHandler:this.modelChangeHandler,promiseFactory:this.promiseFactory,screenReaderService:this.screenReaderService,selection:this.selection,showValueAsService:this.showValueAsService,sparklinesService:this.sparklinesService,telemetryService:this.telemetryService,themeService:this.themeService,visualAuthoring:this.visualAuthoring,visualPlugin:this.visualPlugin,visibilityService:this.visibilityService,visualCalcEagerService:this.visualCalcEagerService,contextActivityService:this.contextActivityService},i,e)},o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275inject(Z.i),t.\u0275\u0275inject(de.D),t.\u0275\u0275inject(oe.J),t.\u0275\u0275inject(te.z),t.\u0275\u0275inject(le.vZ),t.\u0275\u0275inject(je.RD),t.\u0275\u0275inject(_e.H),t.\u0275\u0275inject(ce.o),t.\u0275\u0275inject(Ot.x),t.\u0275\u0275inject(we.t),t.\u0275\u0275inject(st.g),t.\u0275\u0275inject(me.z),t.\u0275\u0275inject(Ne.P),t.\u0275\u0275inject(Ft.s),t.\u0275\u0275inject(wt.f),t.\u0275\u0275inject(ve.y0),t.\u0275\u0275inject(fe.$8),t.\u0275\u0275inject(Re.w),t.\u0275\u0275inject(Pe.D),t.\u0275\u0275inject(Ie.w),t.\u0275\u0275inject(ue.r))},o.\u0275prov=t.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),Sa={provide:"fieldWellModernService",useFactory:function(o,i,e,n,r,a,s,l,u,d,v,p,f,h,m){return new xa(o,i,e,n,r,a,s,l,u,d,v,p,f,h,m)},deps:[Z.i,de.D,oe.J,Je.O,te.z,le.vZ,Mt.AA,_e.H,ce.o,xt.s,me.z,Ne.P,Ie.w,Re.w,Pe.D]},xa=function(){function o(i,e,n,r,a,s,l,u,d,v,p,f,h,m,b){this.conceptualSchemaProxy=i,this.dataSources=e,this.eventBridge=n,this.explorationDisplayNameService=r,this.explorationNavigation=a,this.featureSwitchService=s,this.groupingDesignStateService=l,this.lazyScopedProvider=u,this.localizationService=d,this.runningVisuals=v,this.selection=p,this.showValueAsService=f,this.visibility=h,this.visualCalcEagerService=m,this.visualPlugin=b}return o.prototype.createFieldWellCore=function(i,e,n){return new gi({$element:i,conceptualSchemaProxy:this.conceptualSchemaProxy,dataSources:this.dataSources,eventBridge:this.eventBridge,explorationDisplayNameService:this.explorationDisplayNameService,explorationNavigation:this.explorationNavigation,featureSwitchService:this.featureSwitchService,groupingDesignStateService:this.groupingDesignStateService,lazyScopedProvider:this.lazyScopedProvider,localizationService:this.localizationService,runningVisuals:this.runningVisuals,selection:this.selection,showValueAsService:this.showValueAsService,visibility:this.visibility,visualCalcEagerService:this.visualCalcEagerService,visualPlugin:this.visualPlugin},e,n)},o.\u0275fac=function(e){return new(e||o)(t.\u0275\u0275inject(Z.i),t.\u0275\u0275inject(de.D),t.\u0275\u0275inject(oe.J),t.\u0275\u0275inject(Je.O),t.\u0275\u0275inject(te.z),t.\u0275\u0275inject(le.vZ),t.\u0275\u0275inject(Mt.AA),t.\u0275\u0275inject(_e.H),t.\u0275\u0275inject(ce.o),t.\u0275\u0275inject(xt.s),t.\u0275\u0275inject(me.z),t.\u0275\u0275inject(Ne.P),t.\u0275\u0275inject(Ie.w),t.\u0275\u0275inject(Re.w),t.\u0275\u0275inject(Pe.D))},o.\u0275prov=t.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),Ma={provide:"tabOrderService",useFactory:function(o,i,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var a;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return[4,e.get("canvasListOrderingService")];case 1:return a=s.sent(),[2,new Oa(a,o,i,n,r)]}})})},deps:[zt.F,lt.F,_e.H,Ye.z,qe.Q]},Oa=function(){function o(i,e,n,r,a){this.canvasListOrderingService=i,this.canvasListOrderNormalizeService=e,this.formFactor=n,this.undoRedoService=r,this.visualAuthoringOperations=a,this.tabOrderPropertyName="tabOrder"}return o.prototype.changeSection=function(i,e,n,r,a){this.canvasListOrderingService.insertAtMinMagnitude(i,e,n,this.tabOrderPropertyName,r,a)},o.prototype.bringForward=function(i,e,n,r){this.canvasListOrderingService.bringForward(i,e,n,this.tabOrderPropertyName,r)},o.prototype.sendBackward=function(i,e,n,r){this.canvasListOrderingService.sendBackward(i,e,n,this.tabOrderPropertyName,r)},o.prototype.moveAfter=function(i,e,n,r){this.canvasListOrderingService.moveAfter(i,e,n,r,this.tabOrderPropertyName)},o.prototype.moveAfterIndex=function(i,e,n,r){this.canvasListOrderingService.moveAfterIndex(i,e,n,r,this.tabOrderPropertyName)},o.prototype.moveBefore=function(i,e,n,r){this.canvasListOrderingService.moveBefore(i,e,n,r,this.tabOrderPropertyName)},o.prototype.moveBeforeIndex=function(i,e,n,r){this.canvasListOrderingService.moveBeforeIndex(i,e,n,r,this.tabOrderPropertyName)},o.prototype.shouldNormalize=function(i,e){return this.canvasListOrderingService.shouldNormalize(i,e,this.tabOrderPropertyName)},o.prototype.normalize=function(i,e){this.canvasListOrderingService.normalize(i,e,this.tabOrderPropertyName)},o.prototype.normalizeHierarchy=function(i){var e=this,n=_.partition(i,function(m){var b=(0,Ve.bt)(m,0).tabOrder;return void 0===b||b>=0}),a=n[1],s=this.canvasListOrderNormalizeService.getContainerListOrders(n[0],function(m){return e.canvasListOrderingService.getListOrderPropertyFunction(m,"tabOrder")}),l=this.canvasListOrderNormalizeService.getContainerListOrders(a,function(m){return e.canvasListOrderingService.getListOrderPropertyFunction(m,"tabOrder")}),u=this.canvasListOrderNormalizeService.normalizeListOrder(s,!0),d=this.canvasListOrderNormalizeService.normalizeListOrder(l,!1),v=(0,g.pi)((0,g.pi)({},u),d);this.visualAuthoringOperations.updateContainerListOrders(i,v,"tabOrder");for(var p=0,f=i;p<f.length;p++){var h=f[p];(0,ge.q4)(h)&&this.normalizeHierarchy(h.children)}},o.prototype.sendTabOrderCommandsByLevel=function(i,e,n){var r=this;this.undoRedoService.register("Update Visual Containers for tabOrder",function(){r.sendTabOrderCommandsByLevelImpl(i,e,n)})},o.prototype.sendTabOrderCommandsByLevelImpl=function(i,e,n){var r=(0,Ve.Dg)(i);for(var a in r){var s=r[a],l=(0,ze.E8)(s[0],e);switch(n){case 0:this.bringForwardHierarchy(l,s,!0,!0);break;case 1:this.sendBackwardHierarchy(l,s,!0,!0)}}},o.prototype.bringForwardHierarchy=function(i,e,n,r){var a=(0,Ve.cV)(i,!0);this.canvasListOrderingService.bringForward(a,e,n,this.tabOrderPropertyName,r)},o.prototype.sendBackwardHierarchy=function(i,e,n,r){var a=(0,Ve.cV)(i,!0);this.canvasListOrderingService.sendBackward(a,e,n,this.tabOrderPropertyName,r)},o.prototype.orderByPosition=function(i){var e=this;this.undoRedoService.register("Update Visual Containers for tabOrder",function(){e.orderByPositionImpl(i)})},o.prototype.orderByPositionImpl=function(i){for(var e=this,a=(0,Ve.cV)(i,!0).map(function(d){return(0,Ve.bt)(d,e.formFactor.getCurrentLayout())}).sort(function(d,v){var p=Math.round(v.x)-Math.round(d.x),f=Math.round(v.y)-Math.round(d.y);return 0===Math.abs(f)?p:f}),s=0;s<a.length;s++){a[s].tabOrder=s*et.R$;var u=i[s];(0,ge.q4)(u)&&this.orderByPositionImpl(u.children)}},o}(),wa={provide:"zIndexService",useFactory:function(o){return(0,g.mG)(this,void 0,void 0,function(){var i;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,o.get("canvasListOrderingService")];case 1:return i=e.sent(),[2,new Ta(i)]}})})},deps:[_e.H]},Ta=function(){function o(i){this.canvasListOrderingService=i,this.zIndexPropertyName="z"}return o.prototype.bringForward=function(i,e,n){this.canvasListOrderingService.bringForward(i,e,!0,this.zIndexPropertyName,n)},o.prototype.bringToFront=function(i,e,n){this.canvasListOrderingService.bringToFront(i,e,!0,this.zIndexPropertyName,n)},o.prototype.sendBackward=function(i,e,n){this.canvasListOrderingService.sendBackward(i,e,!0,this.zIndexPropertyName,n)},o.prototype.sendToBack=function(i,e,n){this.canvasListOrderingService.sendToBack(i,e,!0,this.zIndexPropertyName,n)},o.prototype.moveAfter=function(i,e,n){this.canvasListOrderingService.moveAfter(i,e,n,!0,this.zIndexPropertyName)},o.prototype.moveAfterIndex=function(i,e,n){this.canvasListOrderingService.moveAfterIndex(i,e,n,!0,this.zIndexPropertyName)},o.prototype.moveBefore=function(i,e,n){this.canvasListOrderingService.moveBefore(i,e,n,!0,this.zIndexPropertyName)},o.prototype.moveBeforeIndex=function(i,e,n){this.canvasListOrderingService.moveBeforeIndex(i,e,n,!0,this.zIndexPropertyName)},o.prototype.shouldNormalize=function(i){return this.canvasListOrderingService.shouldNormalize(i,!0,this.zIndexPropertyName)},o.prototype.normalize=function(i){this.canvasListOrderingService.normalize(i,!0,this.zIndexPropertyName)},o.prototype.sendZIndexCommandsByLevel=function(i,e,n){var r=(0,Ve.Dg)(i);for(var a in r){var s=r[a],l=(0,ze.E8)(s[0],e);switch(n){case 3:this.bringForward(l,s,!0);break;case 4:this.sendBackward(l,s,!0);break;case 1:this.bringToFront(l,s,!0);break;case 2:this.sendToBack(l,s,!0)}}},o}(),Da=c(44408),Va=c(67659),Ea=c(52910),Ia=c(31109),Aa=c(32288),ka=c(91280),za=c(42101),Ba=c(80093),La=c(77906),Na=c(95859),Ra=c(14888),ja=c(13316),Wa=c(94770),Ga=c(72359),$a=c(3741),Ua=c(52950),Ha=c(45925),Qa=c(52040),Ka=c(91382),Ja=c(53935),Za=c(47913),Xa=c(6015),Ya=c(76433),qa=c(47542),es=c(93367),ts=c(94841),is=c(13254),ns=c(39433),rs=c(55533),os=c(79725),as=c(16095),ss=c(6618),ls=c(27037),cs=c(17177),us=[{type:Si,componentId:"SyncGroupPaneComponentId"},{type:ki,componentId:"VisualizationPaneModernComponentId"},{type:Tt,componentId:"FieldWellModernComponentId"},{type:bt,componentId:"DrillthroughPaneComponentId"},{type:Wt,componentId:"AutoVisualComponentId"}],ds=function(){function o(){}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=t.\u0275\u0275defineInjector({providers:[mo,xo,ei.EY,wo,Vo,ca,fa,Ca,Sa,Ma,wa],imports:[S.CommonModule,Ea.O,ja._,Ia.F,Aa.J,Ha.e,Te.u5,Ba.InsightsUIModule,La.N.withManifests(us),Na.v,Da.Ps,Qa.x,Ka.d,za.p,Va._,Ja.e,Za.V,Xa.C,Wa.f,Ya.d,qa.d,es.U,ts.b,is.x,Ga.K,ns.t,rs.q,os.j,as.Z,Ra.m,Te.UX,ss.J,ls.b,$a.z,cs.T6,Ua.g,ka.Q]}),o}()},79930:function(ie,W,c){c.d(W,{EY:function(){return H},Wg:function(){return K}});var A=c(81337),t=c(8082),S=c(40823),F=c(83008),C=c(77616),M=c(54766),z=c(3468),g=c(74082),L=c(25740),E=c(65181),I=c(58938),D=c(4877),x=c(50423),H={provide:"conditionalFormattingDialogLauncherService",useFactory:function(X,q,k,N,R,G){return new K(X,q,k,N,R,G)},deps:[E.o,I.x,D.a,F.D,t.s,S._]},K=function(){function X(q,k,N,R,G,ne){this.localizationService=q,this.dialogService=k,this.itemPickerService=N,this.dataSourcesService=R,this.runningVisuals=G,this.dataSourcesSerializer=ne}return X.prototype.show=function(q,k,N,R,G,ne){return(0,A.mG)(this,void 0,void 0,function(){var J;return(0,A.Jh)(this,function(Z){switch(Z.label){case 0:return J=N&&(0,g.tO)(N)?N.measure:N,[4,this.showModernConditionaFormattingDialog(q,k,J,R,G,ne)];case 1:return[2,Z.sent().afterClosed().toPromise()]}})})},X.prototype.showModernConditionaFormattingDialog=function(q,k,N,R,G,ne){var J,T;return(0,A.mG)(this,void 0,void 0,function(){var Z,ue,te,oe,de;return(0,A.Jh)(this,function(le){return Z=this.dataSourcesSerializer.serializeDataSources(this.dataSourcesService.get()),ue=R.propertyDescriptor,te=this.runningVisuals.getVisual(q),oe={colorPalette:(0,L.NO)(ne.colorPalette),icons:null===(J=this.itemPickerService)||void 0===J?void 0:J.getIcons(),iconSets:null===(T=this.itemPickerService)||void 0===T?void 0:T.getIconSets(),inDataSources:Z,propertySelector:R.selector&&(0,M.UZ)(R.selector),allowOverrideTotalMatching:R.allowOverrideSubtotalMatching,propertyDefinition:G&&(0,M.W7)(G,ue),propertyDescriptor:(0,C.m8)(ue,this.localizationService),targetFieldDisplayName:k,targetFieldExpr:N&&z.ib.serializeExpr(N),visualType:te.getType(),hasGrouping:!!R.selector&&this.hasGroupingColumn(te)},de={title:"".concat(oe.propertyDescriptor.displayName," - ").concat(oe.targetFieldDisplayName),input:oe,hideOkButton:!1,hideCancelButton:!1,focusInitialCloseButton:!0,footerLink:{text:this.localizationService.get("ConditionalFormattingDialog_LearnMore"),url:"https://go.microsoft.com/fwlink/?linkid=874399",type:"external"}},[2,this.dialogService.showTemplateDialog("ConditionalFormattingDialog",de,{minWidth:"940px",height:"665px",autoFocus:!0})]})})},X.prototype.hasGroupingColumn=function(q){if(!q)return!1;var k=q.getDataViews()[0];if(k.metadata&&k.metadata.columns)for(var N=0,R=k.metadata.columns;N<R.length;N++)if(!R[N].isMeasure)return!0;return!1},X.\u0275fac=function(k){return new(k||X)(x.\u0275\u0275inject(E.o),x.\u0275\u0275inject(I.x),x.\u0275\u0275inject(D.a),x.\u0275\u0275inject(F.D),x.\u0275\u0275inject(t.s),x.\u0275\u0275inject(S._))},X.\u0275prov=x.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac}),X}()},42587:function(ie,W,c){c.d(W,{F:function(){return S},j:function(){return t}});var A=c(78417);function t(F,C,M){return void 0===M&&(M=!1),1===F?{paneTitle:C.get("Tooltip"),paneTitleTooltip:C.get("Drillthrough_TooltipTitleTooltip"),linkFieldsDropZoneTitle:C.get(M?"PagePropertyPane_LinkFieldsDropZoneTitle_Tooltip":"DrillthroughLinks_Tooltip_Fields"),dropZoneText:C.get("FieldDropZone_TooltipLink_Watermark"),keepAllFiltersLabel:C.get("Drillthrough_KeepAllFilters"),keepAllFiltersTooltip:C.get("Drillthrough_KeepAllFiltersForTooltip_Tooltip"),keepAllFiltersToggleForcedOnTooltip:C.format("Drillthrough_KeepAllFiltersForcedOnForTooltip_Tooltip",[C.get("Drillthrough_KeepAllFiltersForTooltip_Tooltip")]),crossReportDrillthroughLabel:C.get("Drillthrough_CrossReportDrillthrough"),crossReportDrillthroughTooltip:C.get("Drillthrough_CrossReportDrillthrough_Tooltip"),linkFieldsLinkTypeGroupTitle:C.get("DrillthroughLinks_LinkTypeGroup_Tooltip")}:{paneTitle:C.get("Drillthrough"),paneTitleTooltip:C.get("Drillthrough_DrillthroughTitleTooltip"),linkFieldsDropZoneTitle:C.get(M?"PagePropertyPane_LinkFieldsDropZoneTitle_Drillthrough":"DrillthroughLinks_Drillthrough_Fields"),dropZoneText:C.get("FieldDropZone_DrillthroughLink_Watermark"),keepAllFiltersLabel:C.get("Drillthrough_KeepAllFilters"),keepAllFiltersTooltip:C.get("Drillthrough_KeepAllFiltersForDrillthrough_Tooltip"),keepAllFiltersToggleForcedOnTooltip:C.format("Drillthrough_KeepAllFiltersForcedOnForDrillthrough_Tooltip",[C.get("Drillthrough_KeepAllFiltersForDrillthrough_Tooltip")]),crossReportDrillthroughLabel:C.get("Drillthrough_CrossReportDrillthrough"),crossReportDrillthroughTooltip:C.get("Drillthrough_CrossReportDrillthrough_Tooltip"),linkFieldsLinkTypeGroupTitle:C.get("DrillthroughLinks_LinkTypeGroup_Drillthrough")}}function S(F,C,M,z){var g=(0,A.Dt)(F,C),L=(0,A.LM)(F,C)||g,E=!C||g,H=!!C&&2===C.type||z&&!!C&&(void 0===C.type||0===C.type);return{keepAllFilters:{disabled:E,value:L,tooltip:E&&L?M.keepAllFiltersToggleForcedOnTooltip:M.keepAllFiltersTooltip},crossReportDrillthrough:{show:H,disabled:!C,value:!!H&&(0,A.aQ)(F,C),tooltip:M.crossReportDrillthroughTooltip},linkFieldsDropZoneTitle:M.linkFieldsDropZoneTitle,linkFieldsLinkTypeGroupTitle:M.linkFieldsLinkTypeGroupTitle}}},89839:function(ie,W,c){c.d(W,{l:function(){return C}});var A=c(62458),t=c(76001),S=c(80366),F=c(94419);function C(L,E){var I=(0,S._L)((0,t.Q)(L.expr)),D=void 0!==I,x=L.interactivityOptions.dropDownItems;if(x)for(var Q=0,H=x.items;Q<H.length;Q++){var K=H[Q],X=K.key;if(X)switch(X.action){case 4:K.checked=D&&X.aggregate===I;break;case 2:K.checked=!D;break;case 8:var q=E.config.singleVisual.query.projections[L.role];K.checked=!(!q||!q.showAll);break;case 128:K.checked=M(L,K.text);break;case 16:for(var k=0,N=K.children;k<N.length;k++){var R=N[k];R.checked=g(L,R.key.showValueAs)}break;case 2048:K.checked=!1;break;default:K.checked=void 0}}}function M(L,E){var I=function(L){if(!_.isEmpty(L.hierarchyLevels)){var I=L.hierarchyLevels[0].expr;return A.fF.assert(function(){return I.arg instanceof F.jE},"hierarchyLevelExpr.arg should be instanceof powerbi.data.SQHierarchyExpr"),I.arg}}(L);if(I)return I.hierarchy===E;var D=(0,t.Q)(L.expr);return!!D&&(D.columnAggr?D.columnAggr.name===E:D.groupingColumnAggr?D.groupingColumnAggr.name===E:D.column?D.column.name===E:!!D.groupingColumn&&D.groupingColumn.name===E)}function g(L,E){var I=(0,t.Q)(L.expr);if(!I||!E)return!1;switch(E.kind){case void 0:return!I.percentOfGrandTotal&&!I.percentOfRoleTotal;case 0:return!!I.percentOfGrandTotal;case 1:var D=E;return!(!I.percentOfRoleTotal||!_.every(I.percentOfRoleTotal.roles,function(x){return _.includes(D.roles,x)}));default:return!1}}},43859:function(ie,W,c){c.d(W,{H:function(){return F}});var A=c(50423),t=c(57470),S=c(62458),F=function(){function C(){this.onActiveSection=new A.EventEmitter,this.observedTargetsMap=new Map}return C.prototype.onKeyDown=function(M){var E,z=this.options,g=this.options.sections,L=g.length;switch(M.keyCode){case 37:case 38:E=g.findIndex(function(H){return H===z.currentSection}),this.switchTab(g[(E-1+L)%L],M,!0);break;case 39:case 40:E=g.findIndex(function(H){return H===z.currentSection}),this.switchTab(g[(E+1)%L],M)}},C.prototype.switchTab=function(M,z,g){var L=this;void 0===g&&(g=void 0);var E=z.target,I=new MutationObserver(function(x){for(var Q=function(R){if("attributes"===R.type&&"tabindex"===R.attributeName&&document.activeElement===E){var G=t.M.getFirstMatchingAncestor(E,function(J){return J.hasAttribute(L.options.rootAttribute)}),ne=void 0;ne=g?t.M.getPrevTabbableMatchingSibling(E,function(J){return!!t.M.getFirstMatchingAncestor(J,function(T){return T.hasAttribute(L.options.pivotAttribute)},G,!0)},G):t.M.getNextTabbableMatchingSibling(E,function(J){return!!t.M.getFirstMatchingAncestor(J,function(T){return T.hasAttribute(L.options.pivotAttribute)},G,!0)},G),ne?.focus()}},H=0,K=x;H<K.length;H++)Q(K[H]);var q=L.observedTargetsMap.has(E);q||S.fF.assertFail("PivotTabKeyHandler does not have the correct observed target on mutation observer callback - possibly detached early"),I.disconnect();var k=L.observedTargetsMap.get(E);k>1?L.observedTargetsMap.set(E,k-1):q&&L.observedTargetsMap.delete(E)});I.observe(E,{attributes:!0,attributeFilter:["tabindex"]});var D=this.observedTargetsMap.get(E);this.observedTargetsMap.set(E,D?D+1:1),this.onActiveSection.emit({nextSection:M}),z.stopPropagation()},C.\u0275fac=function(z){return new(z||C)},C.\u0275dir=A.\u0275\u0275defineDirective({type:C,selectors:[["","pivot-tab-key-handler",""]],hostBindings:function(z,g){1&z&&A.\u0275\u0275listener("keydown",function(E){return g.onKeyDown(E)})},inputs:{options:["pivot-tab-key-handler","options"]},outputs:{onActiveSection:"onActiveSection"}}),C}()},64824:function(ie,W,c){c.d(W,{R:function(){return S}});var A=c(50423),S=function(){function F(C){this.elementRef=C}return F.prototype.ngOnChanges=function(C){if(C.sectionNumber&&!C.sectionNumber.isFirstChange()){var M=C.sectionNumber.currentValue;null!=M&&this.animateSectionSlide(M,C.sectionNumber.previousValue)}},F.prototype.animateElement=function(C,M,z){C.css(M).animate(z,200)},F.prototype.animateSectionSlide=function(C,M){this.doNotAnimateSection||(C<M?this.animateElement($(this.elementRef.nativeElement),{right:"200%"},{right:0}):C>M&&this.animateElement($(this.elementRef.nativeElement),{"margin-left":"200%"},{"margin-left":0}));var z=$(".".concat(this.navMarkerParent," .navMarker"));if(this.autoWidth){var g=0===C?"margin-left":"margin-right",L=0===C?"margin-right":"margin-left",E={};E[g]="".concat(z.width(),"px"),E[L]="auto";var I={};I[g]="0",this.animateElement(z,E,I)}else this.animateElement(z,{},{"margin-left":z.width()*C+"px"})},F.\u0275fac=function(M){return new(M||F)(A.\u0275\u0275directiveInject(A.ElementRef))},F.\u0275dir=A.\u0275\u0275defineDirective({type:F,selectors:[["","section-animation-slider",""]],inputs:{sectionNumber:"sectionNumber",navMarkerParent:"navMarkerParent",autoWidth:"autoWidth",doNotAnimateSection:"doNotAnimateSection"},features:[A.\u0275\u0275NgOnChangesFeature]}),F}()},84431:function(ie,W,c){c.d(W,{Ct:function(){return z},DR:function(){return M},KT:function(){return I},OB:function(){return L},_d:function(){return C},aT:function(){return g},kh:function(){return E}});var A=c(55201),t=c(40812),S=c(50550),F=c(45413),C=function(){function D(x,Q,H,K,X,q,k,N,R,G,ne,J,T){this.expr=x,this.role=Q,this.startIndex=H,this.endIndex=K,this.valid=X,this.displayOptions=q,this.interactivityOptions=k,this.hierarchyLevels=N,this.conditionalFormattingRepetitions=R,this.supportedOperations=67108863,this.visualContainerName=G,this.visualType=ne,this.isHiddenInVisual=J,this.supportedOperations=T}return D.prototype.equals=function(x){return this.role===x.role&&(0,F.fS)(this.expr,x.expr)&&this.startIndex===x.startIndex&&this.endIndex===x.endIndex&&this.isEditingLabel===x.isEditingLabel&&this.valid===x.valid&&(this.displayOptions===x.displayOptions||!!(this.displayOptions&&x.displayOptions&&this.displayOptions.equals&&this.displayOptions.equals(x.displayOptions)))&&(this.interactivityOptions===x.interactivityOptions||!!(this.interactivityOptions&&x.interactivityOptions&&this.interactivityOptions.equals&&this.interactivityOptions.equals(x.interactivityOptions)))&&(0,S.NF)(this.conditionalFormattingRepetitions,x.conditionalFormattingRepetitions,t.u9)&&(0,A.L)(this.hierarchyLevels,x.hierarchyLevels)&&this.visualContainerName===x.visualContainerName&&this.visualType===x.visualType&&this.isHiddenInVisual===x.isHiddenInVisual&&this.supportedOperations===x.supportedOperations},D}(),M=function(){function D(x,Q,H,K,X){this.displayName=x,this.tooltipTitle=Q,this.tooltipDescription=H,this.glyph=K,this.pbiStyle=X}return D.prototype.equals=function(x){return this.displayName===x.displayName&&this.tooltipTitle===x.tooltipTitle&&this.tooltipDescription===x.tooltipDescription&&this.glyph===x.glyph&&this.pbiStyle===x.pbiStyle},D}(),z=function(){function D(x,Q,H){this.dropDownItems=x,this.isReplaceable=Q,this.isEditableField=H,this.canAppend=!0,this.canPrepend=!0,this.hasContextMenu=!0,this.isDraggableField=!0,this.isDroppableField=!0,this.isRemovableField=!0}return D.prototype.disableInteractivity=function(){this.canAppend=!1,this.canPrepend=!1,this.hasContextMenu=!1,this.isDraggableField=!1,this.isDroppableField=!1,this.isEditableField=!1,this.isRemovableField=!1},D.prototype.equals=function(x){return this.canAppend===x.canAppend&&this.canPrepend===x.canPrepend&&_.isEqual(this.dropDownItems,x.dropDownItems)&&this.hasContextMenu===x.hasContextMenu&&this.isDraggableField===x.isDraggableField&&this.isDroppableField===x.isDroppableField&&this.isEditableField===x.isEditableField&&this.isRemovableField===x.isRemovableField&&this.isReplaceable===x.isReplaceable},D}(),g=function(){function D(x,Q,H){this.expr=x,this.displayName=Q,this.tooltipTitle=H}return D.prototype.equals=function(x){return(0,F.fS)(this.expr,x.expr)&&this.displayName===x.displayName&&this.tooltipTitle===x.tooltipTitle},D}(),L=function(){function D(x,Q,H,K,X){this.role=x,this.displayName=Q,this.properties=H,this.supportsMultipleItems=K,this.description=X}return D.prototype.equals=function(x){return this.role===x.role&&this.displayName===x.displayName&&(0,A.L)(this.properties,x.properties)&&this.supportsMultipleItems===x.supportsMultipleItems&&this.description===x.description&&(this.warning===x.warning||!!(this.warning&&x.warning&&this.warning.equals&&this.warning.equals(x.warning)))&&this.disabled===x.disabled},D}(),E=function(){function D(x,Q,H){this.glyph=x,this.title=Q,this.description=H}return D.prototype.equals=function(x){return this.glyph===x.glyph&&this.title===x.title&&this.description===x.description},D}(),I=function(){return function(x){this.buckets=x}}()},45925:function(ie,W,c){c.d(W,{e:function(){return C}});var A=c(6015),t=c(77476),S=c(17174),F=c(50423),C=function(){function M(){}return M.\u0275fac=function(g){return new(g||M)},M.\u0275mod=F.\u0275\u0275defineNgModule({type:M}),M.\u0275inj=F.\u0275\u0275defineInjector({imports:[t.CommonModule,S.u5,A.C,S.UX]}),M}()},64713:function(ie,W,c){c.d(W,{J:function(){return g}});var A=c(81337),t=c(42900),S=c(4437),F=c(73221),C=c(14172),M=c(50423),z=["*"],g=function(L){function E(I){var D=L.call(this)||this;return D.pbiButtonToggleService=I,D}return(0,A.ZT)(E,L),E.prototype.ngOnInit=function(){var I=this;this.changes$("disabled").pipe((0,C.U)(function(D){return(0,S.Ig)(D)})).subscribe(function(D){return I.pbiButtonToggleService.setDisabled(D)}),this.changes$("multiple").pipe((0,C.U)(function(D){return(0,S.Ig)(D)})).subscribe(function(D){return I.pbiButtonToggleService.setMultiple(D)})},E.\u0275fac=function(D){return new(D||E)(M.\u0275\u0275directiveInject(t.r))},E.\u0275cmp=M.\u0275\u0275defineComponent({type:E,selectors:[["pbi-button-toggle-group"]],hostAttrs:["role","group"],hostVars:4,hostBindings:function(D,x){2&D&&M.\u0275\u0275classProp("multiple",x.multiple)("disabled",x.disabled)},inputs:{disabled:"disabled",multiple:"multiple"},features:[M.\u0275\u0275ProvidersFeature([t.r]),M.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:z,decls:1,vars:0,template:function(D,x){1&D&&(M.\u0275\u0275projectionDef(),M.\u0275\u0275projection(0))},encapsulation:2,changeDetection:0}),E}(F.w)},53935:function(ie,W,c){c.d(W,{e:function(){return S}});var A=c(77476),t=c(50423),S=function(){function F(){}return F.\u0275fac=function(M){return new(M||F)},F.\u0275mod=t.\u0275\u0275defineNgModule({type:F}),F.\u0275inj=t.\u0275\u0275defineInjector({imports:[A.CommonModule]}),F}()},42900:function(ie,W,c){c.d(W,{r:function(){return S}});var A=c(33554),t=c(50423),S=function(){function F(){this.selected$=new A.t(1),this.disabled$=new A.t(1),this.multiple$=new A.t(1)}return F.prototype.select=function(C){this.selected$.next(C)},F.prototype.setDisabled=function(C){this.disabled$.next(C)},F.prototype.setMultiple=function(C){this.multiple$.next(C)},F.\u0275prov=t.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac=function(M){return new(M||F)}}),F}()},53240:function(ie,W,c){c.d(W,{I:function(){return X}});var A=c(81337),t=c(4437),S=c(50423),F=c(17174),C=c(72065),M=c(63057),z=c(14172),g=c(22318),L=c(23558),E=c(83317),I=c(59973),D=c(73805),x=c(57243),Q=c(42900),H=c(77476),K=["*"],X=function(q){function k(N){var R=q.call(this)||this;return R.pbiButtonToggleService=N,R.checked=!1,R.supportsNoSelection=!1,R.role="button",R.ariaControls=null,R.id=null,R.valueChanged=new S.EventEmitter,R.onFocus=new S.EventEmitter,R.onBlur=new S.EventEmitter,R}return(0,A.ZT)(k,q),k.prototype.ngOnInit=function(){this.isDisabled$=(0,M.T)(this.pbiButtonToggleService.disabled$,this.mergePropertyInputsAndFormControl(this.changes$("disabled").pipe((0,z.U)(function(N){return(0,t.Ig)(N)})),this.disabled$,"disabled",this.onDestroy$)).pipe((0,g.O)((0,t.Ig)(this.disabled))),this.setCheckedObservable()},k.prototype.setCheckedObservable=function(){var N=this,R=this.pbiButtonToggleService.multiple$.pipe((0,g.O)(!1)),G=this.mergePropertyInputsAndFormControl(this.changes$("checked"),this.value$,"checked",this.onDestroy$);G.subscribe(function(Z){return N.checked=Z});var ne=this.pbiButtonToggleService.selected$.pipe((0,L.M)(R),(0,E.R)(this.onDestroy$),(0,I.h)(function(Z){return!Z[1]&&N.value!==Z[0]}),(0,D.h)(!1));this.onButtonClicked=this.createEventAdapter();var J=this.onButtonClicked.$.pipe((0,L.M)(R),(0,z.U)(function(Z){var te=Z[1];return Z[0].stopPropagation(),!te&&!N.supportsNoSelection||!N.checked})),T=(0,M.T)(ne,J).pipe((0,x.d)(1));this.checked$=(0,M.T)(G,T),T.pipe((0,L.M)(this.isDisabled$),(0,I.h)(function(Z){return!Z[1]})).subscribe(function(Z){var ue=Z[0];ue&&N.pbiButtonToggleService.select(N.value),N.checked=ue,N.valueChanged.emit(N.checked),N.onValueChange(N.checked),N.onTouched()})},k.\u0275fac=function(R){return new(R||k)(S.\u0275\u0275directiveInject(Q.r))},k.\u0275cmp=S.\u0275\u0275defineComponent({type:k,selectors:[["pbi-button-toggle"]],hostVars:2,hostBindings:function(R,G){2&R&&S.\u0275\u0275classProp("checked",G.checked)},inputs:{value:"value",disabled:"disabled",checked:"checked",supportsNoSelection:"supportsNoSelection",role:"role",ariaControls:"ariaControls",id:"id",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],buttonTabIndex:"buttonTabIndex"},outputs:{valueChanged:"valueChanged",onFocus:"onFocus",onBlur:"onBlur"},features:[S.\u0275\u0275ProvidersFeature([{provide:F.JU,useExisting:(0,S.forwardRef)(function(){return k}),multi:!0}]),S.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:K,decls:5,vars:17,consts:[["type","button",3,"disabled","tabindex","click","focus","blur"]],template:function(R,G){1&R&&(S.\u0275\u0275projectionDef(),S.\u0275\u0275elementStart(0,"button",0),S.\u0275\u0275listener("click",function(J){return G.onButtonClicked.fn(J)})("focus",function(){return G.onFocus.emit()})("blur",function(){return G.onBlur.emit()}),S.\u0275\u0275pipe(1,"async"),S.\u0275\u0275pipe(2,"async"),S.\u0275\u0275pipe(3,"async"),S.\u0275\u0275projection(4),S.\u0275\u0275elementEnd()),2&R&&(S.\u0275\u0275property("disabled",S.\u0275\u0275pipeBind1(1,11,G.isDisabled$)||null)("tabindex",G.buttonTabIndex),S.\u0275\u0275attribute("value",G.value)("role",G.role)("aria-controls",G.ariaControls)("id",G.id)("aria-pressed","button"===G.role?S.\u0275\u0275pipeBind1(2,13,G.checked$):null)("aria-selected","button"!==G.role?S.\u0275\u0275pipeBind1(3,15,G.checked$):null)("aria-label",G.ariaLabel)("aria-labelledby",G.ariaLabelledby)("aria-describedby",G.ariaDescribedby))},dependencies:[H.AsyncPipe],styles:["button[_ngcontent-%COMP%]{background:transparent;overflow:hidden;border:none;margin:0;padding:0}button[_ngcontent-%COMP%]:focus{outline:none}"],changeDetection:0}),k}(C.N)},2380:function(ie,W,c){c.d(W,{O:function(){return L}});var A=c(81337),t=c(11991),S=c(37272),F=c(81905),C=c(23558),M=c(50423),z=c(26124),L=function(E){function I(D,x){return E.call(this,D,x)||this}return(0,A.ZT)(I,E),I.prototype.ngOnInit=function(){var D=this;this.changes$("pbiEmphasisBackground").pipe((0,F.w)(function(Q){return Q||S.E})).pipe((0,C.M)(this.changes$("pbiEmphasisBackgroundColor",!0))).subscribe(function(Q){var X=D.getAnimation("backgroundColor",Q[1]??"var(--globalColorBrand160)");D.emphasize(X)})},I.\u0275fac=function(x){return new(x||I)(M.\u0275\u0275directiveInject(z._j,8),M.\u0275\u0275directiveInject(M.ElementRef))},I.\u0275dir=M.\u0275\u0275defineDirective({type:I,selectors:[["","pbiEmphasisBackground",""]],inputs:{pbiEmphasisBackground:"pbiEmphasisBackground",pbiEmphasisBackgroundColor:"pbiEmphasisBackgroundColor"},features:[M.\u0275\u0275InheritDefinitionFeature]}),I}(t.A)},11991:function(ie,W,c){c.d(W,{A:function(){return F}});var A=c(81337),t=c(26124),F=function(C){function M(z,g){var L=C.call(this)||this;return L.animationBuilder=z,L.element=g,L}return(0,A.ZT)(M,C),M.prototype.emphasize=function(z){var g=this;if(this.animationBuilder){var L=function(){var I=g.animationBuilder.build(z),D=g.currentPlayer=I.create(g.element.nativeElement);D.onDestroy(function(){return g.currentPlayer=void 0}),D.play()};this.currentPlayer?(this.currentPlayer.finish(),this.currentPlayer.destroy(),this.requestedAnimationFrameId&&window.cancelAnimationFrame(this.requestedAnimationFrameId),this.requestedAnimationFrameId=window.requestAnimationFrame(function(){L(),g.requestedAnimationFrameId=void 0})):L()}},M.prototype.getAnimation=function(z,g){var L,E,I;return[(0,t.oB)((L={},L[z]="*",L)),(0,t.jt)("100ms ease-out",(0,t.oB)((E={},E[z]=g,E))),(0,t.jt)("500ms ease-out",(0,t.oB)((I={},I[z]="*",I)))]},M}(c(73221).w)},76433:function(ie,W,c){c.d(W,{d:function(){return S}});var A=c(77476),t=c(50423),S=function(){function F(){}return F.\u0275fac=function(M){return new(M||F)},F.\u0275mod=t.\u0275\u0275defineNgModule({type:F}),F.\u0275inj=t.\u0275\u0275defineInjector({imports:[A.CommonModule]}),F}()}}]);