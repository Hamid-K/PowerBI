"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["visual-container-skittles"],{14002:function(ie,z,o){o.d(z,{C:function(){return V},m:function(){return B}});var I=o(64466),y=o(62458),x=o(25512),g=o(49977),H={LeftTop:x.Iz,RightTop:x.Zz,LeftCenter:x.q6,RightCenter:x.v3,LeftBottom:x.Kb,RightBottom:x.J7,RightInsideTop:function(c,l){return{originX:"end",originY:"top",overlayX:"end",overlayY:"top",offsetX:c,offsetY:l}},RightInsideBottom:function(c,l){return{originX:"end",originY:"bottom",overlayX:"end",overlayY:"bottom",offsetX:c,offsetY:l}}},P=2;function V(n,c){y.fF.assertValue(n,"visualContainer"),y.fF.assertValue(c,"visualOverlayPosition");var l=c.getOrigin(n);if(l){if(!(l instanceof Element))return void y.fF.assertFail("Visual container origin is not of type Element");var r=document.querySelector(I.s.DisplayAreaContainerNameSelector.selector);if(!(r&&r instanceof Element))return void y.fF.assertFail("Canvas area container is not of type Element");var h=T(r,l);if(y.fF.assert(function(){return 0!==h.originWidth&&0!==h.originHeight},"visual width or height is 0 now, check how to avoid calculating skittle position before visual is rendered"),function(n){if(n.relativeY>=n.pageHeight||n.relativeY+n.originHeight<=0||n.relativeX>=n.pageWidth)return!1;var l=n.relativeX+n.originWidth;return!(l<=0)&&!(n.relativeX<0&&n.pageWidth-l<0)}(h)){var k=function(n){var d,F,C,l=n.pageWidth-(n.relativeX+n.originWidth),r=n.relativeX,h=g.Lc.width+g.Lc.marginHorizontal,k=g.Lc.childOverlayWidth+g.Lc.marginHorizontal,S=h+2*k,m=h+k;return l>=m?{skittleButtons:d="Right",firstLevelFlyout:{alignment:F="Right",maxWidth:w(n,d,F,C=l>=S?"Right":"Left")},secondLevelFlyout:{alignment:C}}:r>=m?{skittleButtons:d="Left",firstLevelFlyout:{alignment:F="Left",maxWidth:w(n,d,F,C=r>=S?"Left":"Right")},secondLevelFlyout:{alignment:C}}:l>=h?{skittleButtons:d="Right",firstLevelFlyout:{alignment:F="Left",maxWidth:w(n,d,F,C="Left")},secondLevelFlyout:{alignment:C}}:r>=h?{skittleButtons:d="Left",firstLevelFlyout:{alignment:F="Right",maxWidth:w(n,d,F,C="Right")},secondLevelFlyout:{alignment:C}}:l>=0?{skittleButtons:d="RightInside",firstLevelFlyout:{alignment:F="Left",maxWidth:w(n,d,F,C="Left")},secondLevelFlyout:{alignment:C}}:void 0}(h);if(k){var S=function(n){var k=n.relativeY/n.pageHeight*100;return{skittleButtons:(n.relativeY>=0?n.pageHeight-n.relativeY:n.pageHeight)>=(g.Lc.height+g.Lc.betweenSkittlesVerticalSpace)*P-g.Lc.betweenSkittlesVerticalSpace?"Top":"Bottom",firstLevelFlyout:k<=50?"Top":k<=75?"Center":"Bottom",secondLevelFlyout:"Center"}}(h);if(S){var m=function(n,c){var l;if("Top"===n){var r=0-c.relativeY;r>0&&(l=r)}else if("Bottom"===n){var h=c.relativeY+c.originHeight-c.pageHeight;h>0&&(l=-h)}return l}(S.skittleButtons,h);return{skittleButtons:{overlayPosition:[j(k.skittleButtons,S.skittleButtons,g.Lc.marginHorizontal,m)],buttonHeight:g.Lc.height,buttonWidth:g.Lc.width,betweenButtonMargin:g.Lc.betweenSkittlesVerticalSpace,tooltipPosition:"Left"===k.firstLevelFlyout.alignment?"after":"before"},verticalLayout:S,horizontalLayout:k}}}}}}function B(n,c,l,r){void 0===r&&(r=0);var h=n.alignment,k=n.maxWidth,S=c,m=document.querySelector(I.s.DisplayAreaContainerNameSelector.selector);if(m&&m instanceof Element){var C,d=T(m,l),F=d.pageHeight-d.relativeY-1;switch(S){case"Top":C=F-r;break;case"Center":C=2*(F-d.originHeight/2),r=document.documentElement.clientHeight-d.originY-r-1-F+r;break;case"Bottom":C=d.originY+d.originHeight-r}return{position:[j(h,S,g.Lc.marginHorizontal,r)],height:void 0,width:g.Lc.childOverlayWidth,maxHeight:C,maxWidth:k,minWidth:g.Lc.childOverlayWidth}}}function T(n,c){var l=c.getBoundingClientRect(),r=n.getBoundingClientRect();return{pageHeight:r.height,pageWidth:r.width,pageX:r.x,pageY:r.y,originHeight:l.height,originWidth:l.width,originX:l.x,originY:l.y,relativeX:l.x-r.x,relativeY:l.y-r.y}}function j(n,c,l,r){if(null==l&&null==r)return H["".concat(n).concat(c)]();var h="Left"===n||"RightInside"===n?-l:l;return H["".concat(n).concat(c)](h,r)}function w(n,c,l,r){var h=n.pageWidth,k=n.originWidth,S=n.relativeX,m=g.Lc.width+2*g.Lc.marginHorizontal,d=g.Lc.childOverlayWidth+g.Lc.marginHorizontal;if("Right"===c){if("Right"!==l)return y.fF.assert(function(){return"Left"===l&&"Left"===r},"Skittle buttons right; Should match combination in getHorizontalLayout"),S+k-d;if("Right"===r)return h-(S+k)-m-d;if("Left"===r)return h-(S+k)-m}else if("Left"===c){if("Left"===l){if("Right"===r)return S-m;if("Left"===r)return S-m-d}else if("Right"===l)return y.fF.assert(function(){return"Right"===r},"SkittlePosition left; should match combinations in getHorizontalLayout"),h-S-d}else if("RightInside"===c)return y.fF.assert(function(){return"Left"===l&&"Left"===r},"Skittle buttons are RightInside, but should match combination in getHorizontalLayout"),S+k-m-d;return g.Lc.childOverlayWidth}},33093:function(ie,z,o){o.r(z),o.d(z,{VisualContainerSkittlesModule:function(){return pe}});var I=o(21661),y=o(50423),x=o(35510),g=o(30794),H=o(59017),P=o(63057),V=o(83317),B=o(14172),T=o(77526),M=o(17653),W=o(22318),N=o(3307),j=o(6754),w=o(23558),X=o(59973),n=o(11494),c=o(39503),l=o(72262),r=o(15393),h=o(66977),k=o(9380),S=o(14463),m=o(49977),d=o(25512),F=o(86940),C=o(29866),Y=o(9215),O=o(8590),ne=o(3579),oe=o(64466),se=o(93599),Q=o(58317),A=o(47508),K=o(62458),re=o(24171),Z=o(48145),J=o(17328),G=o(21024),q=o(77200),ee=o(26691),te=o(14002),le=[A.L.textbox.name,A.L.actionButton.name,A.L.shape.name,A.L.basicShape.name,A.L.image.name],ae=function(){function u(s,e,t,i,a,v,p,f,b,$,E,L,R,D,U){this.eventBridge=s,this.explorationCapabilities=e,this.explorationNavigation=t,this.featureSwitchService=i,this.formFactor=a,this.injector=v,this.overlay=p,this.paneVisibility=f,this.scrollDispatcher=b,this.selectionService=$,this.viewModeStateService=E,this.visibilityService=L,this.visualOverlayPositionService=R,this.visualPluginOperations=D,this.visualPluginService=U,this.skittlesOverlayPosition$=new x.X(void 0),this.destroy$=new g.xQ,this.destroyForVisualContainerChange$=new g.xQ,this.destroyForOverlaySupportedTypesChange$=new g.xQ,this.destroyForPaneSupportedTypesChange$=new g.xQ,this.destroyForSkittleDisabledRecreation$=new g.xQ,this.destroyScrollMonitorSession$=new g.xQ,this.showBuildFlyout$=new x.X(null),this.overlaySupportedTypes$=new x.X(void 0),this.paneSupportedTypes$=new x.X(void 0)}return u.prototype.ngOnDestroy=function(){this.destroyForVisualContainerChange$.next(),this.destroyForVisualContainerChange$.complete(),this.destroyForOverlaySupportedTypesChange$.next(),this.destroyForOverlaySupportedTypesChange$.complete(),this.destroyForPaneSupportedTypesChange$.next(),this.destroyForPaneSupportedTypesChange$.complete(),this.destroyForSkittleDisabledRecreation$.next(),this.destroyForSkittleDisabledRecreation$.complete(),this.destroyScrollMonitorSession$.next(),this.destroyScrollMonitorSession$.complete(),this.destroy$.next(),this.destroy$.complete(),this.skittlesOverlayPosition$.next(void 0),this.skittlesOverlayPosition$.complete()},Object.defineProperty(u.prototype,"skittlesPosition$",{get:function(){return this.skittlesOverlayPosition$.asObservable()},enumerable:!1,configurable:!0}),u.prototype.startMonitoring=function(s){var e=this;this.featureSwitchService.featureSwitches.onObject&&(this.alreadyMonitoring||(this.alreadyMonitoring=!0,this.eventBridge.on(O.mSO).pipe((0,V.R)(this.destroy$)).subscribe(function(t){e.newVisual=t.visualName,e.startAuthoringOnNewVisual=t.startAuthoring}),this.boundVisualContainer$=this.eventBridge.on(O.tRg).pipe((0,B.U)(function(t){return e.getSelectedElement()}),(0,T.x)(function(t,i){return t?.name===i?.name}),(0,M.b)(function(t){e.destroyForVisualContainerChange$.next(),e.destroyScrollMonitorSession$.next(),e.monitorVisualScrolling(t)}),(0,V.R)(this.destroy$)),this.inFocusVisualContainer$=this.eventBridge.on(O.y5h).pipe((0,B.U)(function(t){return e.getInFocusedElement()}),(0,T.x)(function(t,i){return t?.name===i?.name}),(0,V.R)(this.destroy$)),(0,H.aj)([this.boundVisualContainer$.pipe((0,W.O)(void 0)),this.inFocusVisualContainer$.pipe((0,W.O)(void 0)),this.viewModeStateService.getMode$()]).pipe((0,N.T)(1),(0,T.x)(function(t,i){var a=t[0],v=t[1],p=t[2],f=i[0],b=i[1],$=i[2];return a?.name===f?.name&&v?.name===b?.name&&p===$}),(0,V.R)(this.destroy$)).subscribe(function(t){var i=t[0],a=t[1],v=t[2];e.viewMode=v;var p=e.lastOpenSkittleType;e.allowSkittlesUI(v,a??i)?a?(e.paneSupportedTypes$.next(e.getSupportedSkittleTypes(a)),e.destroyScrollMonitorSession$.next(),e.ensureSkittlesClosed(),e.showSkittlesInPaneSwitcher(p)):i?e.showSkittlesUIInEditMode({visualContainer:i,ensureNewVisualState:!0,updateSupportedTypes:!0,reopenSkittle:!0}):e.removeSkittlesFromOverlay():e.removeSkittlesUI(),e.lastOpenSkittleType=void 0}),this.visualOverlayPositionService.registeredVisualContainers$.pipe((0,V.R)(this.destroy$)).subscribe(function(t){var i=e.getSelectedElement();_.findIndex(t,function(a){return a.name===i?.name})>=0&&setTimeout(function(){e.showSkittlesUIInEditMode({visualContainer:i,ensureNewVisualState:!0,updateSupportedTypes:!0})})}),this.eventBridge.on(Q.dJ).pipe((0,V.R)(this.destroy$)).subscribe(function(){e.ensureSkittlesClosed()}),(0,P.T)(this.eventBridge.on(Q.v7),this.eventBridge.on(O.Of1)).pipe((0,V.R)(this.destroy$)).subscribe(function(){var t=e.getSelectedElement();t&&e.showSkittlesUIInEditMode({visualContainer:t,withSavedFlyoutState:!0,skipSkittleFlyoutAutoFocus:!0})}),this.eventBridge.on(O.ubE).pipe((0,M.b)(function(t){e.ensureSkittlesClosed()}),(0,j.b)(200),(0,V.R)(this.destroy$)).subscribe(function(){var t=e.getInFocusedElement(),i=e.getSelectedElement();t?(e.ensureSkittlesClosed(),null!=e.lastOpenSkittleType&&e.showSkittlesInPaneSwitcher(e.lastOpenSkittleType)):i&&e.showSkittlesOverlay({visualContainer:i,withSavedFlyoutState:!0,skipSkittleFlyoutAutoFocus:!0})}),(0,P.T)(this.eventBridge.on(O.KD7),this.eventBridge.on(O.jCS)).pipe((0,w.M)(this.boundVisualContainer$),(0,V.R)(this.destroy$)).subscribe(function(t){var i=t[0],a=t[1],v=_.isEmpty(e.overlaySupportedTypes$.value),p=e.getSupportedSkittleTypes(a);e.overlaySupportedTypes$.next(p),e.paneSupportedTypes$.next(p),function(u){return void 0!==u.affectContainer}(i)&&("DraggedToVisual"===i.fieldSource||"CheckboxTickedInFieldList"===i.fieldSource)&&p.some(function(b){return"Build"===b.type})&&e.showBuildFlyout(),_.isEmpty(p)?(e.destroyScrollMonitorSession$.next(),e.ensureSkittlesClosed()):v&&a!==e.getInFocusedElement()&&(e.monitorVisualScrolling(a),e.showSkittlesUIInEditMode({visualContainer:a}))})))},u.prototype.onFieldDragHover=function(){this.showBuildFlyout()},u.prototype.showBuildFlyout=function(){this.showBuildFlyout$.next()},u.prototype.removeSkittlesUI=function(){this.removeSkittlesFromOverlay(),this.removeSkittlesFromPaneSwitcher()},u.prototype.removeSkittlesFromOverlay=function(){this.overlaySupportedTypes$.next(void 0),this.destroyScrollMonitorSession$.next(),this.ensureSkittlesClosed()},u.prototype.removeSkittlesFromPaneSwitcher=function(){this.paneSupportedTypes$.next(void 0),this.ensurePanesClosed()},u.prototype.getSelectedElement=function(){var s=this.selectionService.getSelectedElements();if(1===_.size(s)){var e=s[0].canvasItem;if((0,Y.Vz)(e))return e}},u.prototype.getInFocusedElement=function(){return this.visibilityService.get(27)},u.prototype.showSkittlesUIInEditMode=function(s){var e,t,i,a,v,p=s.visualContainer,f=void 0!==(e=s.withSavedFlyoutState)&&e,b=void 0!==(t=s.ensureNewVisualState)&&t,$=void 0!==(i=s.skipSkittleFlyoutAutoFocus)&&i,E=void 0!==(a=s.updateSupportedTypes)&&a,L=void 0!==(v=s.reopenSkittle)&&v;if(E){var R=this.getSupportedSkittleTypes(p);this.overlaySupportedTypes$.next(R)}this.ensurePanesClosed(),this.showSkittlesOverlay({visualContainer:p,withSavedFlyoutState:f,ensureNewVisualState:b,skipSkittleFlyoutAutoFocus:$,reopenSkittle:L})},u.prototype.showSkittlesOverlay=function(s){var e,t,i,a,v=s.visualContainer,p=void 0!==(e=s.withSavedFlyoutState)&&e,f=void 0!==(t=s.ensureNewVisualState)&&t,b=void 0!==(i=s.skipSkittleFlyoutAutoFocus)&&i,$=void 0!==(a=s.reopenSkittle)&&a;this.ensureSkittlesClosed(),K.fF.assertValue(v,"Expect the given visualContainer is defined");var E=(0,te.C)(v,this.visualOverlayPositionService);if(E){var L=p?this.lastOpenSkittleType:void 0;this.skittlesOverlayPosition$.next({container:v,positions:E}),f&&this.newVisual===v.name&&(this.startAuthoringOnNewVisual&&(L="Build"),this.newVisual=void 0,this.startAuthoringOnNewVisual=!1),$&&(L=this.lastOpenSkittleType),this.destroyForOverlaySupportedTypesChange$.next();var R={visualContainer:v,withActiveSkittle:L,skipActiveSkittleFlyoutAutoFocus:b,supportedSkittleTypes$:this.overlaySupportedTypes$.pipe((0,V.R)(this.destroyForOverlaySupportedTypesChange$)),showBuildFlyout$:this.showBuildFlyout$.pipe((0,V.R)(this.destroyForOverlaySupportedTypesChange$)),fromPersonalize:0===this.viewMode},D=this.overlay.scrollStrategies.reposition(),U=this.getPositionStrategy(v);this.overlayRef=this.overlay.open({component:re.Z,data:R,options:{scrollStrategy:D,positionStrategy:U,hasBackdrop:!1,disposeOnNavigation:!0,minWidth:m.Lc.width,minHeight:m.Lc.height},closeOnBackdropClick:!1,disableCloseOnEsc:!0,disableFocusTrapSetting:{disable:!0},focusElementOnClose:null,injector:this.injector,overlayContainer:"exploreCanvasOverlay"})}else f&&this.newVisual===v.name&&(this.lastOpenSkittleType="Build")},u.prototype.showSkittlesInPaneSwitcher=function(s){var e=this;this.destroyForPaneSupportedTypesChange$.next(),this.paneSupportedTypes$.pipe((0,V.R)(this.destroyForPaneSupportedTypesChange$)).subscribe(function(t){_.find(t,function(f){return"Build"===f.type})?"Build"===s?e.paneVisibility.isPaneExpanded("suggestSkittle")||e.paneVisibility.togglePaneExpansion("suggestSkittle"):e.paneVisibility.addToPaneSwitcher("suggestSkittle"):e.paneVisibility.closePane("suggestSkittle");var i=_.find(t,function(f){return"ChartElements"===f.type});if(i){var a=i.disabled$.value,v=a?.disabled;"ChartElements"===s?e.paneVisibility.isPaneVisible("chartElementsSkittle")||e.paneVisibility.togglePaneVisibility("chartElementsSkittle",v):e.paneVisibility.addToPaneSwitcher("chartElementsSkittle",v);var p=!0;i.disabled$.pipe((0,V.R)((0,P.T)(e.destroyForVisualContainerChange$,e.destroyForSkittleDisabledRecreation$))).subscribe(function(f){p||e.paneVisibility.setPaneDisabledState("chartElementsSkittle",f?.disabled),e.paneVisibility.updatePaneTitle("chartElementsSkittle",f?.disabled?f.disabledReasonKey:"Skittles_ChartElements_Title"),p=!1})}else e.paneVisibility.closePane("chartElementsSkittle");s=void 0})},u.prototype.ensureSkittlesClosed=function(){this.overlayRef&&this.closeSkittlesOverlay()},u.prototype.ensurePanesClosed=function(){this.destroyForPaneSupportedTypesChange$.next(),this.paneVisibility.closePane("suggestSkittle"),this.paneVisibility.closePane("chartElementsSkittle")},u.prototype.closeSkittlesOverlay=function(){this.destroyForOverlaySupportedTypesChange$.next(),this.overlayRef.close(),this.overlayRef=void 0,this.skittlesOverlayPosition$.next(void 0),this.showBuildFlyout$.next(null)},u.prototype.monitorVisualScrolling=function(s){var e=this;s&&this.scrollDispatcher.scrolled().pipe((0,X.h)(function(t){var i,a=t,v=null===(i=a?.getElementRef())||void 0===i?void 0:i.nativeElement;return _.includes(v?.classList,oe.s.DisplayAreaContainerNameSelector.class)}),(0,M.b)(function(t){e.ensureSkittlesClosed()}),(0,V.R)((0,P.T)(this.destroyScrollMonitorSession$,this.destroy$)),(0,j.b)(150)).subscribe(function(){e.visualOverlayPositionService.getOrigin(s)&&(0,te.C)(s,e.visualOverlayPositionService)&&e.showSkittlesUIInEditMode({visualContainer:s,withSavedFlyoutState:!0,skipSkittleFlyoutAutoFocus:!0})})},u.prototype.allowsPersonalization=function(s){var e,t,i,a;if(K.fF.assertValue(s,"Expect the given visualContainer is defined"),this.explorationCapabilities.getCapabilities().disableInlineExplore)return!1;var p=this.explorationNavigation.getCurrentExploration();if(null===(e=p.settings)||void 0===e||!e.allowInlineExploration)return!1;var f=p.sections[p.activeSectionIndex];if(!1===(null===(i=null===(t=f?.evaluatedObjects)||void 0===t?void 0:t.personalizeVisual)||void 0===i?void 0:i.show))return!1;var $=s.config.singleVisual.evaluatedObjects;return!(!1===(null===(a=$?.visualHeader)||void 0===a?void 0:a.showPersonalizeVisualButton))},u.prototype.allowSkittlesUI=function(s,e){switch(s){case 1:case 2:return!0;case 0:return null!=e&&this.allowsPersonalization(e);default:return K.fF.assertNever(s),!1}},u.prototype.getPositionStrategy=function(s){var e=this.visualOverlayPositionService.getOrigin(s);return this.overlay.position("exploreCanvasOverlay").withinOverlayContainer(e).withMaxiumumVisibility(!0).withPositions([(0,d.Zz)(m.Lc.marginHorizontal,void 0,1),(0,d.Iz)(-m.Lc.marginHorizontal,void 0,1),(0,d.Zz)(-(m.Lc.marginHorizontal+m.Lc.width)),(0,d.Iz)(m.Lc.marginHorizontal+m.Lc.width)])},u.prototype.getSupportedSkittleTypes=function(s){var e=this,t=[];if(this.destroyForSkittleDisabledRecreation$.next(),1===this.formFactor.getCurrentLayout())return t;var v,i=(0,ne.s)(s);if(s&&(this.visualPluginOperations.isQueryVisual(i)||this.visualPluginOperations.canConvertVisual(s))){var a=new x.X({disabled:!1});a.complete(),t.push({type:"Build",disabled$:a})}return i&&_.indexOf(le,i)<0&&(this.eventBridge.on(O.jCS).pipe((0,W.O)(void 0),(0,X.h)(function(p){return void 0===p||p.affectContainer(s)}),(0,B.U)(function(p){return e.getChartElementsDisabledState(s)}),(0,T.x)(),(0,V.R)((0,P.T)(this.destroyForVisualContainerChange$,this.destroyForSkittleDisabledRecreation$))).subscribe(function(p){v?v.next(p):v=new x.X(p)}),t.push({type:"ChartElements",disabled$:v})),t},u.prototype.getChartElementsDisabledState=function(s){return(0,se.LR)(this.visualPluginService,this.visualPluginOperations,s)?{disabled:!0,disabledReasonKey:"VisualContainer_Skittle_Tooltip_ChartElement_EmptyData"}:{disabled:!1}},u.\u0275fac=function(e){return new(e||u)(y.\u0275\u0275inject(n.J),y.\u0275\u0275inject(Z.U),y.\u0275\u0275inject(c.z),y.\u0275\u0275inject(k.vZ),y.\u0275\u0275inject(J.F),y.\u0275\u0275inject(y.Injector),y.\u0275\u0275inject(F._),y.\u0275\u0275inject(G.r),y.\u0275\u0275inject(I.mF),y.\u0275\u0275inject(l.z),y.\u0275\u0275inject(q.kc),y.\u0275\u0275inject(r.w),y.\u0275\u0275inject(ee.z),y.\u0275\u0275inject(h.f),y.\u0275\u0275inject(C.D))},u.\u0275prov=y.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac}),u}(),ue={provide:"visualContainerSkittlesService",useFactory:function(u,s,e,t,i,a,v,p,f,b,$,E,L,R,D,U){var fe=new ae(s,e,t,i,a,v,p,f,b,$,E,L,R,D,U);return u.resolve(fe)},deps:[S.t,n.J,Z.U,c.z,k.vZ,J.F,y.Injector,F._,G.r,I.mF,l.z,q.kc,r.w,ee.z,h.f,C.D]},ce=o(77476),he=o(77906),pe=function(){function u(){}return u.\u0275fac=function(e){return new(e||u)},u.\u0275mod=y.\u0275\u0275defineNgModule({type:u}),u.\u0275inj=y.\u0275\u0275defineInjector({providers:[ue],imports:[ce.CommonModule,he.N]}),u}()}}]);