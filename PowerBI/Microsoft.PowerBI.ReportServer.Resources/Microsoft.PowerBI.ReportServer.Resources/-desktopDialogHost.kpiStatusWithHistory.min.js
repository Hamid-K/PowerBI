"use strict";(self.webpackChunkdesktopDialogHost=self.webpackChunkdesktopDialogHost||[]).push([["kpiStatusWithHistory"],{3352:function(Da,nt,g){g.r(nt),g.d(nt,{KPIStatusWithHistory:function(){return b}});var F=g(81337),$=g(14599),i=g(47895),p=g(90120),q=g(21181),it=g(56707),W=g(18664),U=g(32105),lt=g(33024),k=g(18765),V=g(92374),H=g(44027),M=g(97878),R=g(20486),bt=g(45296),G=g(44783),c=g(79154),w=g(62458),tt=g(38265),B=g(32041),l=g(56578),L=g(64329),st=g(58098),Y=g(38958),s=g(82755),at=g(72489),ct="powervisuals-glyph",et="foregroundNeutralDark",dt="foregroundNeutralSecondary",_t=(0,c.CH)("kpiVisual"),xt=(0,c.CH)("kpiGraphicsContext"),b=function(){function a(t){t&&(this.interactivityEnabled=t.interactivityEnabled)}return a.prototype.init=function(t){this.host=t.host,this.style=t.style,a.getLocalizedString=t.host.getLocalizedString.bind(t.host),this.rootElement=d3.select(t.element.get(0)).append("div").classed(_t.class,!0),this.svg=this.rootElement.append("svg").classed(xt.class,!0),this.interactivityEnabled&&this.svg.attr("tabindex",0).attr("focusable",!0);var r=this.svg.append("g");this.areaFill=r.append("path"),this.lastTrendAxisPointSummaryContainer=this.rootElement.append("div").classed("lastTrendAxisPointSummaryContainer",!0),this.indicatorContainer=this.lastTrendAxisPointSummaryContainer.append("div").classed("indicatorContainer",!0),this.indicatorText=this.indicatorContainer.append("div").classed("indicatorText",!0),this.indicatorIcon=this.indicatorContainer.append("div").classed("powervisuals-glyph",!0),this.goalText=this.lastTrendAxisPointSummaryContainer.append("div").classed("goalText",!0).style("color",p.v.getThemeColor(this.style,G.fA)),this.distanceText=this.lastTrendAxisPointSummaryContainer.append("div").classed("distanceText",!0),this.lastDateText=this.lastTrendAxisPointSummaryContainer.append("div").classed("lastDateText",!0),a.initDefaultLabelSettings(this.style)},a.prototype.update=function(t){if(t.dataViews&&t.dataViews[0]){var r=this.dataView=t.dataViews[0],o=t.viewport;if((!r.categorical||!r.categorical.values||r.categorical.values.length<1)&&(!r.categorical||!r.categorical.categories||r.categorical.categories.length<1))return this.svg.attr("visibility","hidden"),void this.lastTrendAxisPointSummaryContainer.attr("style","display:none");this.svg.attr("visibility","visible");var e=a.converter(r,o,a.getPropKPIDirection(r),this.style,this.host);if(this.hasGoal=!_.isEmpty(e.goals),this.interactivityEnabled){var n=""===e.formattedGoalString?"":" ".concat(e.formattedGoalString,"."),d="".concat(a.getLocalizedString("KpiValueFieldListDisplayName")," ").concat(e.formattedValue,".").concat(n);this.svg.attr("aria-label",d)}this.render(e,o)}},a.calculateHeight=function(t,r,o,e,n,d,u,m,h,S,f){var P=L.FP.fromPoint(t.indicatorFont.size.pt),v=B.b.measureSvgTextHeight({fontFamily:d,fontSize:P},r);if(t.indicatorIconShowIcon&&f){var I=L.FP.fromPoint(t.indicatorIconSize),y=B.b.measureSvgGlyphHeight(I,ct,f);v=Math.max(v,y)}var C=0,A=L.FP.fromPoint(t.distanceFont.size.pt);t.showDistanceFromGoal&&(C=B.b.measureSvgTextHeight({fontFamily:m,fontSize:A},e));var D=0,z=L.FP.fromPoint(t.goalFont.size.pt);if(t.showGoal&&(D=B.b.measureSvgTextHeight({fontFamily:u,fontSize:z},o)),S){var T=L.FP.fromPoint(t.lastDateFont.size.pt);v+=B.b.measureSvgTextHeight({fontFamily:h,fontSize:T},t.lastDateValue)}return t.showGoal&&t.showDistanceFromGoal?B.b.measureSvgTextWidth({fontFamily:u,fontSize:z},o)+B.b.measureSvgTextWidth({fontFamily:m,fontSize:A},e)>n?v=v+C+D:v+=D>C?D:C:(t.showGoal&&(v+=D),t.showDistanceFromGoal&&(v+=C)),v},a.prototype.render=function(t,r){if(this.setShowDataMissingWarning(!(t.indicatorExists&&t.trendExists)),0===t.dataPoints.length||!t.indicatorExists||!t.trendExists)return this.areaFill.attr("visibility","hidden"),this.svg.attr("visibility","hidden"),void this.lastTrendAxisPointSummaryContainer.attr("style","display:none");this.svg.attr("height",r.height).attr("width",r.width);var o=a.status.NOGOAL,e=null;t.targetExists&&t.indicatorExists&&t.trendExists&&(o=function(a,t,r){if(!t||0===t.length)return b.status.NOGOAL;var o,e;if(2===t.length){if(o=Math.max.apply(Math,t),a>=(e=Math.min.apply(Math,t))&&a<=o)return b.status.IN_BETWEEN}else o=t[0],e=t[0];switch(r){case H.i1:if(a<e)return b.status.DROP;break;case H.pd:if(a>o)return b.status.DROP}return b.status.INCREASE}(t.actual,t.goals,t.directionType));for(var h,n=t.formattedValue,d=t.showLastDate,u=t.showGoal?t.formattedGoalString+" ":"",m=t.showDistanceFromGoal?t.formattedDistanceString:"",S=0,f=a.indicatorIconContent;S<f.length;S++)if(o===(P=f[S]).status){h=P.hexCode,e=P.textId;break}var C,v=a.calculateHeight(t,n,u,m,r.width,t.indicatorFont.family,t.goalFont.family,t.distanceFont.family,t.lastDateFont.family,d,h),I="",y="";if(t.horizontalAlignment===V.D.center&&(I+="width: "+r.width+"px; text-align: center;",y+="justify-content: center"),t.horizontalAlignment===V.D.left&&(I+="left: 8px; text-align: left;",y+="justify-content: flex-start"),t.horizontalAlignment===V.D.right&&(I+="right: 5px; text-align: right;",y+="justify-content: flex-end"),t.verticalAlignment===k.Q4.middle&&(I+="top:"+(r.height-v)/2+"px"),t.verticalAlignment===k.Q4.top&&(I+="top: 5px;"),t.verticalAlignment===k.Q4.bottom&&(I+="bottom: 5px;"),this.lastTrendAxisPointSummaryContainer.attr("style",I),this.indicatorContainer.attr("style",y),C=o===a.status.NOGOAL?t.indicatorFont.color:function(a,t){switch(a){case b.status.NOGOAL:return w.fF.assertFail("should not call this function without a goal (for `callout` textClass color theme reasons)"),t.textGrey;case b.status.INCREASE:return t.good;case b.status.IN_BETWEEN:return t.neutral;case b.status.DROP:return t.bad}}(o,t.colors),this.indicatorText.styles((0,W.wB)(t.indicatorFont)).text(n),this.indicatorText.style("color",C),t.indicatorIconShowIcon&&!this.indicatorIcon?this.indicatorIcon=this.indicatorContainer.append("div").classed(ct,!0):!t.indicatorIconShowIcon&&this.indicatorIcon&&(this.indicatorIcon.remove(),this.indicatorIcon=null),this.indicatorIcon){for(var A=0,D=a.indicatorIconContent;A<D.length;A++){var P;this.indicatorIcon.classed((P=D[A]).class,o===P.status)}this.indicatorIcon.styles((0,W.wB)({size:U.B.createFromPt(t.indicatorIconSize)})),this.indicatorIcon.style("color",C),o!==a.status.NOGOAL&&this.indicatorIcon.attr("role","img").attr("aria-label",a.getLocalizedString(e))}this.goalText.styles((0,W.wB)(t.goalFont)).text(u),this.distanceText.styles((0,W.wB)(t.distanceFont)).text(" "+m);var z="";if(t.showLastDate&&(z=t.lastDateValue),this.lastDateText.styles((0,W.wB)(t.lastDateFont)).text(z),t.showTrendLine&&t.historyExists){var E=d3.area().x(function(N){return N.x}).y0(r.height).y1(function(N){return N.y}),T=function(a,t){switch(a){case b.status.NOGOAL:return t.graphGrey;case b.status.INCREASE:return t.good;case b.status.IN_BETWEEN:return t.neutral;case b.status.DROP:return t.bad}}(o,t.colors);this.areaFill.attr("d",E(t.dataPoints)).attr("stroke","none").attr("visibility","visible").attr("fill-opacity",t.indicatorTransparency/100).style("color",T).style("fill",T)}else this.areaFill.attr("visibility","hidden")},a.prototype.setShowDataMissingWarning=function(t){this.host.setWarnings(t?[new bt.EY]:[])},a.getDefaultFormatSettings=function(t){var r=(0,q.bT)({show:!0,fontSize:45,labelColor:p.v.getThemeColor(t,et),fontFamily:tt.Wn.lightSecondary.family,style:t,textClassName:"callout",bold:"normal",italic:"normal",underline:"none"}),o=(0,q.bT)({show:!0,fontSize:8,labelColor:p.v.getThemeColor(t,"foreground"),fontFamily:tt.Wn.semibold.family,style:t,textClassName:"largeLabel"}),e=(0,q.bT)({show:!0,fontSize:9,labelColor:p.v.getThemeColor(t,"foreground"),fontFamily:tt.Wn.regular.family,style:t,textClassName:"smallLabel"}),n={family:o.fontProperties.family,size:o.fontProperties.size,color:o.fontProperties.color,weight:c.AI,style:c.AI,textDecoration:c.zu},d={family:o.fontProperties.family,size:o.fontProperties.size,color:o.fontProperties.color,weight:c.AI,style:c.AI,textDecoration:c.zu},u={family:e.fontProperties.family,size:e.fontProperties.size,color:e.fontProperties.color,weight:c.AI,style:c.AI,textDecoration:c.zu};return{labelSettings:r,indicatorIconSize:U.B.createFromPx(12).pt,indicatorIconShowIcon:!0,indicatorTransparency:20,goalFont:n,distanceLabel:R.aQ,distancePrecision:2,distanceFont:d,lastDateFont:u,wordWrap:!1,horizontalAlignment:"center",verticalAlignment:"middle",bold:!1,italic:!1,underline:!1}},a.getFormatString=function(t){return w.fF.assertAnyValue(t,"column"),(0,at.EO)(t,$.e0.formatString)},a.getPropShowKPIGoal=function(t){return!t||!t.metadata||(0,s.NA)(t.metadata.objects,i.xg.showKPIGoal,!0)},a.getPropShowKPITrendLine=function(t){return!t||!t.metadata||(0,s.NA)(t.metadata.objects,i.xg.showKPITrendLine,!0)},a.getPropShowKPILastDate=function(t){return!(!t||!t.metadata)&&(0,s.NA)(t.metadata.objects,i.xg.showKPILastDate,!1)},a.getPropShowKPIDistance=function(t){return!t||!t.metadata||(0,s.NA)(t.metadata.objects,i.xg.showKPIDistance,!0)},a.getPropKPIDirection=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.directionTypeStringProp,H.i1):H.i1},a.getPropGoodColor=function(t,r){var o=p.v.getSentimentColor(r,"good",G.fA);return t&&t.metadata?p.v.create(r).getColorForPropertyWithDefaultColor(t.metadata.objects,i.xg.goodColorProp,o):o},a.getPropNeutralColor=function(t,r){var o=p.v.getSentimentColor(r,"neutral",G.fA);return t&&t.metadata?p.v.create(r).getColorForPropertyWithDefaultColor(t.metadata.objects,i.xg.neutralColorProp,o):o},a.getPropBadColor=function(t,r){var o=p.v.getSentimentColor(r,"bad",G.fA);return t&&t.metadata?p.v.create(r).getColorForPropertyWithDefaultColor(t.metadata.objects,i.xg.badColorProp,o):o},a.getPropIndicatorDisplayUnits=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorDisplayUnitsProp,a.defaultLabelSettings.displayUnits):a.defaultLabelSettings.displayUnits},a.getPropIndicatorHorizontalAlignment=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorHorizontalAlignmentProp,a.defaultCardFormatSetting.horizontalAlignment):a.defaultCardFormatSetting.horizontalAlignment},a.getPropIndicatorVerticalAlignment=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorVerticalAlignmentProp,a.defaultCardFormatSetting.verticalAlignment):a.defaultCardFormatSetting.verticalAlignment},a.getPropIndicatorPrecision=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorPrecisionProp,a.defaultLabelSettings.precision):a.defaultLabelSettings.precision},a.getPropIndicatorFontSize=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorFontSizeProp,a.defaultCardFormatSetting.labelSettings.fontProperties.size.pt):a.defaultCardFormatSetting.labelSettings.fontProperties.size.pt},a.getPropIndicatorFontFamily=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorFontFamilyProp,a.defaultCardFormatSetting.labelSettings.fontProperties.family):a.defaultCardFormatSetting.labelSettings.fontProperties.family},a.getPropIndicatorFontColor=function(t,r){var o=a.defaultCardFormatSetting.labelSettings.fontProperties.color;return t&&t.metadata?p.v.create(r).getColorForPropertyWithDefaultColor(t.metadata.objects,i.xg.indicatorFontColorProp,o):o},a.getPropIndicatorIconSize=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorIconSizeProp,a.defaultCardFormatSetting.indicatorIconSize):a.defaultCardFormatSetting.indicatorIconSize},a.getPropIndicatorShowIcon=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorIconShowIconProp,!0):a.defaultCardFormatSetting.indicatorIconShowIcon},a.getPropIndicatorTransparency=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorTransparencyProp,a.defaultCardFormatSetting.indicatorTransparency):a.defaultCardFormatSetting.indicatorTransparency},a.getPropIndicatorBold=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorBoldProp,a.defaultCardFormatSetting.bold):a.defaultCardFormatSetting.bold},a.getPropIndicatorItalic=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorItalicProp,a.defaultCardFormatSetting.italic):a.defaultCardFormatSetting.italic},a.getPropIndicatorUnderline=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.indicatorUnderlineProp,a.defaultCardFormatSetting.underline):a.defaultCardFormatSetting.underline},a.getPropGoalFontSize=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.goalFontSizeProp,a.defaultCardFormatSetting.goalFont.size.pt):a.defaultCardFormatSetting.goalFont.size.pt},a.getPropGoalBold=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.goalBoldProp,a.defaultCardFormatSetting.bold):a.defaultCardFormatSetting.bold},a.getPropGoalItalic=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.goalItalicProp,a.defaultCardFormatSetting.italic):a.defaultCardFormatSetting.italic},a.getPropGoalUnderline=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.goalUnderlineProp,a.defaultCardFormatSetting.underline):a.defaultCardFormatSetting.underline},a.getPropGoalFontFamily=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.goalFontFamilyProp,a.defaultCardFormatSetting.goalFont.family):a.defaultCardFormatSetting.goalFont.family},a.getPropGoalFontColor=function(t,r){var o=a.defaultCardFormatSetting.goalFont.color;return t&&t.metadata?p.v.create(r).getColorForPropertyWithDefaultColor(t.metadata.objects,i.xg.goalFontColorProp,o):o},a.getPropGoalText=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.goalTextProp,a.getLocalizedString("Visual_KPI_Goal_Title")):a.getLocalizedString("Visual_KPI_Goal_Title")},a.getPropDistanceLabel=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.distanceLabelProp,a.defaultCardFormatSetting.distanceLabel):a.defaultCardFormatSetting.distanceLabel},a.getPropDistancePrecision=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.distancePrecisionProp,a.defaultCardFormatSetting.distancePrecision):a.defaultCardFormatSetting.distancePrecision},a.getPropDistanceFontSize=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.distanceFontSizeProp,this.getPropGoalFontSize(t)):a.defaultCardFormatSetting.distanceFont.size.pt},a.getPropDistanceBold=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.distanceBoldProp,a.defaultCardFormatSetting.bold):a.defaultCardFormatSetting.bold},a.getPropDistanceItalic=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.distanceItalicProp,a.defaultCardFormatSetting.italic):a.defaultCardFormatSetting.italic},a.getPropDistanceUnderline=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.distanceUnderlineProp,a.defaultCardFormatSetting.underline):a.defaultCardFormatSetting.underline},a.getPropDistanceFontFamily=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.distanceFontFamilyProp,this.getPropGoalFontFamily(t)):a.defaultCardFormatSetting.distanceFont.family},a.getPropDistanceFontColor=function(t,r){var o=this.getPropGoalFontColor(t,r);return t&&t.metadata?p.v.create(r).getColorForPropertyWithDefaultColor(t.metadata.objects,i.xg.distanceFontColorProp,o):o},a.getPropDistanceDirection=function(t){var r;return t&&t.metadata?(r=this.getPropKPIDirection(t)===H.i1?M.i1:M.pd,(0,s.NA)(t.metadata.objects,i.xg.distanceDirectionTypeStringProp,r)):M.i1},a.getPropLastDateFontSize=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.lastDateFontSizeProp,a.defaultCardFormatSetting.lastDateFont.size.pt):a.defaultCardFormatSetting.lastDateFont.size.pt},a.getProplastDateBold=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.lastDateBoldProp,a.defaultCardFormatSetting.bold):a.defaultCardFormatSetting.bold},a.getProplastDateItalic=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.lastDateItalicProp,a.defaultCardFormatSetting.italic):a.defaultCardFormatSetting.italic},a.getProplastDateUnderline=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.lastDateUnderlineProp,a.defaultCardFormatSetting.underline):a.defaultCardFormatSetting.underline},a.getPropLastDateFontFamily=function(t){return t&&t.metadata?(0,s.NA)(t.metadata.objects,i.xg.lastDateFontFamilyProp,a.defaultCardFormatSetting.lastDateFont.family):a.defaultCardFormatSetting.lastDateFont.family},a.getPropLastDateFontColor=function(t,r){var o=a.defaultCardFormatSetting.lastDateFont.color;return t&&t.metadata?p.v.create(r).getColorForPropertyWithDefaultColor(t.metadata.objects,i.xg.lastDateFontColorProp,o):o},a.initDefaultLabelSettings=function(t){a.defaultCardFormatSetting=a.getDefaultFormatSettings(t),a.defaultLabelSettings=a.defaultCardFormatSetting.labelSettings},a.getFormattedValue=function(t,r,o,e,n){var d;void 0===n&&(n=st.V.WholeUnits),w.fF.assertValue(r,"theValue");var u=0===e;return(0,at.Ue)({format:null!==(d=r.formatString)&&void 0!==d?d:a.getFormatString(t),value:e,precision:o,displayUnitSystemType:n,formatSingleValues:!!u,allowFormatBeautification:!0,columnType:t?t.type:void 0}).format(r.value)},a.getFormattedLastDate=function(t,r){return(0,at.Ue)({format:a.getFormatString(t),allowFormatBeautification:!0,columnType:t?t.type:void 0}).format(r)},a.getFormattedGoalString=function(t,r,o,e,n){if(!r||0===r.length)return"";var d=a.getPropGoalText(n)+": "+a.getFormattedValue(t,r[0],o,e);return 2===r.length&&(d+=", "+a.getFormattedValue(t,r[1],o,e)),d},a.getFormattedDistanceString=function(t,r,o,e,n,d,u,m){if(!o||1!==o.length||0===o[0].value)return"";var h="+",S=r.value,f=o[0].value;switch(u){case M.i1:S<f&&(h="-");break;case M.pd:S>f&&(h="-")}var P=Math.abs(S-f),v=Math.abs(f),I=Number((100*P/v).toFixed(e)),y="",C=m.getLocalizedString("PercentFormat",h+I),D=a.getFormattedValue(t,{value:P,formatString:r.formatString},e,n);switch(d){case R.aQ:y="("+C+")";break;case R.S3:y="("+h+D+")";break;case R.Hk:y="("+h+D+" "+C+")";break;default:w.fF.assertFail("unknown kpiDistanceLabel type: ".concat(d))}return y},a.converter=function(t,r,o,e,n){var d,u,X,K,Z,m=[],h=t.categorical,S=null,f=null,P=null,v="",I="",y="",C="",A=!1,D=!1,z=!1,E=!0;t.categorical.categories||(E=!1);for(var T=h.values,Q=0,J=t.metadata.columns;Q<J.length;Q++){var j=J[Q];(0,Y.nu)(j,"Indicator")&&(D=!0,S=j),(0,Y.nu)(j,"TrendLine")&&(z=!0,P=j),(0,Y.nu)(j,"Goal")&&(A=!0,f=j)}if(a.initDefaultLabelSettings(e),!(D&&z&&T&&0!==T.length&&T[0].values&&t.categorical.values))return{dataPoints:m,directionType:o,actual:0,indicatorFont:a.defaultCardFormatSetting.labelSettings.fontProperties,indicatorIconSize:a.defaultCardFormatSetting.indicatorIconSize,indicatorIconShowIcon:a.defaultCardFormatSetting.indicatorIconShowIcon,indicatorTransparency:a.defaultCardFormatSetting.indicatorTransparency,goalFont:a.defaultCardFormatSetting.goalFont,distanceLabel:a.defaultCardFormatSetting.distanceLabel,distancePrecision:a.defaultCardFormatSetting.distancePrecision,distanceFont:a.defaultCardFormatSetting.distanceFont,distanceDirection:a.defaultCardFormatSetting.distanceDirection,lastDateFont:a.defaultCardFormatSetting.lastDateFont,goals:[],formattedGoalString:v,formattedDistanceString:I,targetExists:A,historyExists:E,indicatorExists:D,trendExists:z,formattedValue:y,lastDateValue:C,showGoal:!1,showDistanceFromGoal:!1,showTrendLine:!1,showLastDate:!1,colors:{good:p.v.getSentimentColor(e,"good",G.fA),neutral:p.v.getSentimentColor(e,"neutral",G.fA),bad:p.v.getSentimentColor(e,"bad",G.fA),graphGrey:p.v.getThemeColor(e,dt),textGrey:p.v.getThemeColor(e,et)},horizontalAlignment:a.defaultCardFormatSetting.horizontalAlignment,verticalAlignment:a.defaultCardFormatSetting.verticalAlignment};E&&(X=h.categories[0].values);for(var pt,Pt,O=[],gt=[],mt=[],ft=a.getColumnsByRole(T,"Indicator"),Lt=a.getColumnsByRole(T,"Goal"),x=0,Gt=T[0].values.length;x<Gt;x++){pt=ft[0].values[x],Pt=(0,s.NA)(null===(d=ft[0].objects)||void 0===d?void 0:d[x],$.e0.formatString);for(var vt=[],ot=0,ht=Lt;ot<ht.length;ot++){var Ft=ht[ot];vt.push({value:Ft.values[x],formatString:(0,s.NA)(null===(u=Ft.objects)||void 0===u?void 0:u[x],$.e0.formatString)})}mt.push(vt),O.push(pt),gt.push(Pt)}var Bt=Math.max.apply(Math,O),St=Math.min.apply(Math,O),Nt=1*r.height,Ct=a.getPropIndicatorPrecision(t),rt=a.getPropIndicatorDisplayUnits(t),Ot=a.getPropIndicatorFontSize(t),Kt=a.getPropIndicatorFontFamily(t),Ut=a.getPropIndicatorFontColor(t,e),Rt=+a.getPropIndicatorIconSize(t),jt=a.getPropIndicatorShowIcon(t),Wt=a.getPropIndicatorTransparency(t),Ht=a.getPropIndicatorHorizontalAlignment(t),Mt=a.getPropIndicatorVerticalAlignment(t),Qt=a.getPropIndicatorBold(t)?c.en:c.AI,wt=a.getPropIndicatorItalic(t)?c.BF:c.AI,Yt=a.getPropIndicatorUnderline(t)?c.f0:c.zu,Jt=a.getPropGoalFontSize(t),Xt=a.getPropGoalFontFamily(t),Zt=a.getPropGoalFontColor(t,e),$t=a.getPropGoalBold(t)?c.en:c.AI,qt=a.getPropGoalItalic(t)?c.BF:c.AI,kt=a.getPropGoalUnderline(t)?c.f0:c.zu,Dt=a.getPropDistanceLabel(t),It=a.getPropDistancePrecision(t),Vt=a.getPropDistanceFontSize(t),ta=a.getPropDistanceFontFamily(t),aa=a.getPropDistanceFontColor(t,e),yt=a.getPropDistanceDirection(t),ea=a.getPropDistanceBold(t)?c.en:c.AI,oa=a.getPropDistanceItalic(t)?c.BF:c.AI,ra=a.getPropDistanceUnderline(t)?c.f0:c.zu,na=a.getPropLastDateFontSize(t),ia=a.getPropLastDateFontFamily(t),la=a.getPropLastDateFontColor(t,e),sa=a.getProplastDateBold(t)?c.en:c.AI,ca=a.getProplastDateItalic(t)?c.BF:c.AI,da=a.getProplastDateUnderline(t)?c.f0:c.zu;for(x=0;x<O.length;x++)m.push({x:x*r.width/(O.length-1),y:r.height-Nt*(O[x]-St)/(Bt-St),actual:{value:O[x],formatString:gt[x]},goals:mt[x]});m.length>0&&(K=m[m.length-1].actual,Z=m[m.length-1].goals),1===m.length&&(E=!1),y=K&&a.getFormattedValue(S,K,Ct,rt,st.V.DataLabels),v=a.getFormattedGoalString(f,Z,Ct,rt,t),I=a.getFormattedDistanceString(S,K,Z,It,rt,Dt,yt,n),X.length>0&&(C=a.getFormattedLastDate(P,X[X.length-1]));var ga=a.getPropShowKPIGoal(t),ma=a.getPropShowKPIDistance(t),fa=a.getPropShowKPITrendLine(t),pa=a.getPropShowKPILastDate(t),Pa={good:a.getPropGoodColor(t,e),neutral:a.getPropNeutralColor(t,e),bad:a.getPropBadColor(t,e),graphGrey:p.v.getThemeColor(e,dt),textGrey:p.v.getThemeColor(e,et)},va={size:U.B.createFromPt(+Jt),family:Xt,color:Zt,weight:$t,style:qt,textDecoration:kt},ha={size:U.B.createFromPt(+Vt),family:ta,color:aa,weight:ea,style:oa,textDecoration:ra},Fa={size:U.B.createFromPt(+Ot),family:Kt,color:Ut,weight:Qt,style:wt,textDecoration:Yt},Sa={size:U.B.createFromPt(+na),family:ia,color:la,weight:sa,style:ca,textDecoration:da};return{dataPoints:m,directionType:o,actual:K?.value,goals:_.map(Z,function(Ca){return Ca.value}),formattedGoalString:v,formattedDistanceString:I,indicatorFont:Fa,targetExists:A,historyExists:E,indicatorExists:D,trendExists:z,formattedValue:y,showGoal:ga,indicatorIconSize:Rt,indicatorIconShowIcon:jt,indicatorTransparency:Wt,goalFont:va,showDistanceFromGoal:ma,distanceLabel:Dt,distancePrecision:It,distanceFont:ha,distanceDirection:yt,lastDateFont:Sa,showTrendLine:fa,showLastDate:pa,lastDateValue:C,colors:Pa,horizontalAlignment:Ht,verticalAlignment:Mt}},a.getColumnsByRole=function(t,r){for(var o=[],e=0,n=t;e<n.length;e++){var d=n[e];(0,Y.nu)(d.source,r)&&o.push(d)}return o},a.prototype.enumerateGoalsProperties=function(){var t=this.dataView,r=a.getPropDistanceLabel(t);return{showGoal:a.getPropShowKPIGoal(t),goalText:a.getPropGoalText(t),goalFontColor:a.getPropGoalFontColor(t,this.style),goalFontFamily:a.getPropGoalFontFamily(t),fontSize:a.getPropGoalFontSize(t),bold:a.getPropGoalBold(t),italic:a.getPropGoalItalic(t),underline:a.getPropGoalUnderline(t),showDistance:a.getPropShowKPIDistance(t),distanceLabel:a.getPropDistanceLabel(t),distanceFontColor:a.getPropDistanceFontColor(t,this.style),distanceFontFamily:a.getPropDistanceFontFamily(t),titleBold:a.getPropDistanceBold(t),titleItalic:a.getPropDistanceItalic(t),titleUnderline:a.getPropDistanceUnderline(t),titleFontSize:a.getPropDistanceFontSize(t),direction:a.getPropDistanceDirection(t),labelPrecision:r!==R.aQ?a.getPropDistancePrecision(t):void 0}},a.prototype.enumerateIndicatorProperties=function(){var t={indicatorDisplayUnits:a.getPropIndicatorDisplayUnits(this.dataView),indicatorPrecision:a.getPropIndicatorPrecision(this.dataView),fontSize:a.getPropIndicatorFontSize(this.dataView),bold:a.getPropIndicatorBold(this.dataView),italic:a.getPropIndicatorItalic(this.dataView),underline:a.getPropIndicatorUnderline(this.dataView),fontColor:a.getPropIndicatorFontColor(this.dataView,this.style),fontFamily:a.getPropIndicatorFontFamily(this.dataView),horizontalAlignment:a.getPropIndicatorHorizontalAlignment(this.dataView),verticalAlignment:a.getPropIndicatorVerticalAlignment(this.dataView)};return this.hasGoal&&delete t.fontColor,t.showIcon=a.getPropIndicatorShowIcon(this.dataView),t.showIcon&&(t.iconSize=+a.getPropIndicatorIconSize(this.dataView)),t},a.prototype.getFormattingModel=function(){var t=this,r={minValue:{type:0,value:0},maxValue:{type:1,value:it.vo}},o={minValue:{type:0,value:L.Gj},maxValue:{type:1,value:L.PR},unitSymbol:lt.tQ};return new l.Nq(function(){return t.getIndicatorCard(r)},function(){return t.getIconCard(o)},function(){return t.getTrendAxisCard()},function(){return t.getTargetLabelCard(r)},function(){return t.getDateCard()}).build()},a.prototype.getIndicatorCard=function(t){var r=this,u=(0,F.__rest)(i.Te.indicator,["showIcon","iconSize"]),m=new l.CQ(new l.lg("calloutValue"),"Visual_Gauge_CalloutValue",u,function(P){return r.host.getLocalizedString(P)});m.withDescription("Role_DisplayName_KPI_IndicatorDescription");var S=(new l.UN).withFontFamily({descriptor:u.fontFamily,value:a.getPropIndicatorFontFamily(this.dataView)}).withFontSizeProperties({descriptor:u.fontSize,value:a.getPropIndicatorFontSize(this.dataView)}).withBold({descriptor:u.bold,value:a.getPropIndicatorBold(this.dataView)}).withItalic({descriptor:u.italic,value:a.getPropIndicatorItalic(this.dataView)}).withUnderline({descriptor:u.underline,value:a.getPropIndicatorUnderline(this.dataView)}).build();return m.addGroup("values",function(f){f.addCompositeSlice("font","Font",S),r.hasGoal||f.addSimpleSlice("fontColor",new l.BT({descriptor:(0,F.__assign)((0,F.__assign)({},u.fontColor),{instanceKind:3}),value:{value:a.getPropIndicatorFontColor(r.dataView,r.style)}}).build()),f.addSimpleSlice("horizontalAlignment",new l.Gp({descriptor:u.horizontalAlignment,value:a.getPropIndicatorHorizontalAlignment(r.dataView),mode:"horizontalAlignment"}).build()).addSimpleSlice("verticalAlignment",new l.Gp({descriptor:u.verticalAlignment,value:a.getPropIndicatorVerticalAlignment(r.dataView),mode:"verticalAlignment"}).build()).addSimpleSlice("indicatorDisplayUnits",new l.uY({descriptor:u.indicatorDisplayUnits,value:a.getPropIndicatorDisplayUnits(r.dataView)}).build()).addSimpleSlice("indicatorPrecision",new l.mu({descriptor:u.indicatorPrecision,value:a.getPropIndicatorPrecision(r.dataView),options:t}).build())}),m.build()},a.prototype.getIconCard=function(t){var r=this,e=new l.CQ(new l.lg("icons"),"Visual_Tablix_Icons",[i.Te.indicator.showIcon,i.Te.indicator.iconSize],function(d){return r.host.getLocalizedString(d)});return e.addTopLevelToggle("showIcon",function(){return new l.bd({descriptor:i.Te.indicator.showIcon,value:a.getPropIndicatorShowIcon(r.dataView)}).build()}).addGroup("icons",function(n){n.withDisplayName("Visual_Tablix_Icons"),n.addSimpleSlice("iconSize",new l.mu({descriptor:i.Te.indicator.iconSize,value:a.getPropIndicatorIconSize(r.dataView),options:t}).build())}),e.build()},a.prototype.getTrendAxisCard=function(){var t=this,r=function(u){return t.host.getLocalizedString(u)},o=(0,F.__assign)((0,F.__assign)({},i.Te.trendline),i.Te.status),e=this.dataView,n=new l.CQ(new l.lg("trendAxis"),"Role_DisplayName_KPI_TrendLine",o,r);return n.withDescription("Role_DisplayName_KPI_Trendline_Description").addTopLevelToggle("show",function(){return new l.bd({descriptor:o.show,value:a.getPropShowKPITrendLine(e)}).build()}).addGroup("trendAxis",function(d){d.addSimpleSlice("direction",new l.uY({descriptor:o.direction,value:a.getPropKPIDirection(e)}).build()).addSimpleSlice("goodColor",new l.BT({descriptor:(0,F.__assign)((0,F.__assign)({},o.goodColor),{instanceKind:3}),value:{value:a.getPropGoodColor(e,t.style)}}).build()).addSimpleSlice("neutralColor",new l.BT({descriptor:(0,F.__assign)((0,F.__assign)({},o.neutralColor),{instanceKind:3}),value:{value:a.getPropNeutralColor(e,t.style)}}).build()).addSimpleSlice("badColor",new l.BT({descriptor:(0,F.__assign)((0,F.__assign)({},o.badColor),{instanceKind:3}),value:{value:a.getPropBadColor(e,t.style)}}).build()).addSimpleSlice("transparency",l.JN.getTransparencySliderBuilder({descriptor:o.transparency,value:a.getPropIndicatorTransparency(e),localize:r}).build())}),n.build()},a.prototype.getTargetLabelCard=function(t){var r=this,e=i.Te.goals,n=this.dataView,d=new l.CQ(new l.lg("targetLabel"),"Visual_Gauge_Axis_TargetLabel",e,function(P){return r.host.getLocalizedString(P)}),u=(new l.UN).withFontFamily({descriptor:e.goalFontFamily,value:a.getPropGoalFontFamily(n)}).withFontSizeProperties({descriptor:e.fontSize,value:a.getPropGoalFontSize(n)}).withBold({descriptor:e.bold,value:a.getPropGoalBold(n)}).withItalic({descriptor:e.italic,value:a.getPropGoalItalic(n)}).withUnderline({descriptor:e.underline,value:a.getPropGoalUnderline(n)}),m=(new l.UN).withFontFamily({descriptor:e.distanceFontFamily,value:a.getPropDistanceFontFamily(n)}).withFontSizeProperties({descriptor:e.titleFontSize,value:a.getPropDistanceFontSize(n)}).withBold({descriptor:e.titleBold,value:a.getPropDistanceBold(n)}).withItalic({descriptor:e.titleItalic,value:a.getPropDistanceItalic(n)}).withUnderline({descriptor:e.titleUnderline,value:a.getPropDistanceUnderline(n)}),h=u.build(),S=m.build();return d.addTopLevelToggle("showGoal",function(){return new l.bd({descriptor:e.showGoal,value:a.getPropShowKPIGoal(n)}).build()}).addGroup("values",function(f){f.withDisplayName("Role_DisplayName_Values").addCompositeSlice("font","Font",h).addSimpleSlice("fontColor",new l.BT({descriptor:(0,F.__assign)((0,F.__assign)({},e.goalFontColor),{instanceKind:3}),value:{value:a.getPropGoalFontColor(n,r.style)}}).build()).addSimpleSlice("goalText",new l.fq({descriptor:e.goalText,value:a.getPropGoalText(n),placeholder:""}).build())}).addGroup("distance",function(f){f.withDisplayName("Visual_KPI_DistanceToGoal").addTopLevelToggle("showDistance",function(){return new l.bd({descriptor:e.showDistance,value:a.getPropShowKPIDistance(n)}).build()});var P=a.getPropDistanceLabel(n);f.addSimpleSlice("style",new l.uY({descriptor:e.distanceLabel,value:P}).build(),function(v){return v.withCustomDisplayName("Style")}),P!==R.aQ&&f.addSimpleSlice("labelPrecision",new l.mu({descriptor:e.labelPrecision,value:a.getPropDistancePrecision(n),options:t}).build()),f.addSimpleSlice("direction",new l.uY({descriptor:e.direction,value:a.getPropDistanceDirection(n)}).build()).addCompositeSlice("font","Font",S).addSimpleSlice("fontColor",new l.BT({descriptor:(0,F.__assign)((0,F.__assign)({},e.distanceFontColor),{instanceKind:3}),value:{value:a.getPropDistanceFontColor(n,r.style)}}).build())}),d.build()},a.prototype.getDateCard=function(){var t=this,o=i.Te.lastDate,e=this.dataView,n=new l.CQ(new l.lg("date"),"Date",o,function(h){return t.host.getLocalizedString(h)}),u=(new l.UN).withFontFamily({descriptor:o.lastDateFontFamily,value:a.getPropLastDateFontFamily(e)}).withFontSizeProperties({descriptor:o.fontSize,value:a.getPropLastDateFontSize(e)}).withBold({descriptor:o.bold,value:a.getProplastDateBold(e)}).withItalic({descriptor:o.italic,value:a.getProplastDateItalic(e)}).withUnderline({descriptor:o.underline,value:a.getProplastDateUnderline(e)}).build();return n.withDescription("Role_DisplayName_KPI_Date_Description").addTopLevelToggle("show",function(){return new l.bd({descriptor:o.show,value:a.getPropShowKPILastDate(e)}).build()}).addGroup("date",function(m){m.addCompositeSlice("font","Font",u).addSimpleSlice("fontColor",new l.BT({descriptor:(0,F.__assign)((0,F.__assign)({},o.lastDateFontColor),{instanceKind:3}),value:{value:a.getPropLastDateFontColor(e,t.style)}}).build())}),n.build()},a.prototype.enumerateObjectInstances=function(t){var r=[],o=this.dataView,e={numberRange:{min:0,max:it.vo}},n={numberRange:{min:L.Gj,max:L.PR},unitSymbol:lt.tQ};switch(t.objectName){case"indicator":r.push({selector:null,objectName:"indicator",properties:this.enumerateIndicatorProperties(),validValues:{indicatorPrecision:e,iconSize:n},propertyInstanceKind:{fontColor:3}});break;case"trendline":r.push({selector:null,objectName:"trendline",properties:{show:a.getPropShowKPITrendLine(o),transparency:a.getPropIndicatorTransparency(o)}});break;case"goals":r.push({selector:null,objectName:"goals",properties:this.enumerateGoalsProperties(),validValues:{labelPrecision:e},propertyInstanceKind:{goalFontColor:3,distanceFontColor:3}});break;case"status":r.push({selector:null,objectName:"status",properties:{direction:a.getPropKPIDirection(o),goodColor:a.getPropGoodColor(o,this.style),neutralColor:a.getPropNeutralColor(o,this.style),badColor:a.getPropBadColor(o,this.style)},propertyInstanceKind:{goodColor:3,neutralColor:3,badColor:3}});break;case"lastDate":r.push({selector:null,objectName:"lastDate",properties:{show:a.getPropShowKPILastDate(o),lastDateFontColor:a.getPropLastDateFontColor(o,this.style),lastDateFontFamily:a.getPropLastDateFontFamily(o),fontSize:a.getPropLastDateFontSize(o),bold:a.getProplastDateBold(o),italic:a.getProplastDateItalic(o),underline:a.getProplastDateUnderline(o)},propertyInstanceKind:{lastDateFontColor:3}})}return r},a.prototype.destroy=function(){this.svg=null},a.status={INCREASE:"increase",DROP:"drop",IN_BETWEEN:"in-between",NOGOAL:"no-goal"},a.statusBandingType={Below:"BELOW",Above:"ABOVE"},a.actualTextConsts={VERTICAL_OFFSET_FROM_HALF_HEIGHT:20,FONT_WIDTH_FACTOR:14,RIGHT_MARGIN:10},a.indicatorIconContent=[{class:"checkmark",textId:"Visual_KPI_TargetMet",hexCode:"\ue718",status:a.status.INCREASE},{class:"circle-small",textId:"Visual_KPI_TargetBetween",hexCode:"\ue712",status:a.status.IN_BETWEEN},{class:"exclamation",textId:"Visual_KPI_TargetNotMet",hexCode:"\ue715",status:a.status.DROP}],a}()}}]);