"use strict";(self.webpackChunkreportServerHostModern=self.webpackChunkreportServerHostModern||[]).push([["leads-collection-dialog"],{89846:function(q,m,a){a.r(m),a.d(m,{LeadsCollectionDialogModule:function(){return K}});var y=a(16748),C=a(34214),d=a(32293),g=a(77476),T=a(79061),D=a(76966),i=a(50423),I=a(4444),b=a(59694),L=a(40580),S=a(35510),w=a(58315),P=a(18942),O=a(65181),M=a(73875),U=a(62113),x=a(58938),R=a(79685),E=a(83342),z=a(22844),N=a(50057),B=a(24326),k=["iframe"];function j(n,e){1&n&&i.\u0275\u0275element(0,"pbi-spinner",6)}var F=function(){return{"aria-label":"Close"}},c=window,Y=[{componentType:function(){function n(e,t,o,r,l,h,p,u,s){var f=this;this.frontEndUrl=e,this.sanitizer=t,this.dialogRef=o,this.localizationService=r,this.httpService=l,this.accessTokenProviderService=h,this.dialogService=p,this.userInfoService=u,this.tokenScopes=[c.microsoftGraphUrl+"/User.Read"],this.isLoading=new S.X(!0),this.baseUrl=s.featureSwitches.newLeadsUrl?"https://www.microsoft.com/":"https://powerbi.microsoft.com/",s.featureSwitches.leadsTip1&&(this.baseUrl="https://tip1.powerbi.microsoft.com/"),s.featureSwitches.leadsTip2&&(this.baseUrl="https://tip2.powerbi.microsoft.com/"),s.featureSwitches.leadsDevUrl&&(this.baseUrl="https://powerbi-frontend-tip2-eastus.azurewebsites.net/"),this.leadsCollectionUrl=this.sanitizer.bypassSecurityTrustResourceUrl(s.featureSwitches.newLeadsUrl?this.baseUrl+this.localizationService.currentLanguageLocale+"/product-leadcollection/lead-collection/":this.baseUrl+this.localizationService.currentLanguageLocale+"/lead-collection/"),this.title=this.localizationService.get("CustomerVoiceSurveyTitle"),s.featureSwitches.leadsTesting||this.isLoading.pipe((0,w.b)(1e4)).subscribe(function(v){return v?f.closeDialog(!1,"timeout"):null})}return n.prototype.ngOnInit=function(){var e=this;c.clientAuthEnabled?(this.graphTokenPromiseV2=this.accessTokenProviderService.acquireToken("LeadsCollectionDialog",this.tokenScopes),this.graphTokenPromiseV2.catch(function(t){e.closeDialog(!1,t)})):(this.graphTokenPromise=this.httpService.get((0,b.W)("{0}/graph",this.frontEndUrl),this.httpService.powerbiRequestOptions()).toPromise(),this.graphTokenPromise.catch(function(t){var o;e.closeDialog(!1,(null===(o=t?.data)||void 0===o?void 0:o.message)||t.status)})),this.isNotFirstTrial=this.userInfoService.userFreeTrialExpired||this.userInfoService.userFreeTrialDaysRemaining>=0,this.messageHandler=function(t){return e.handleMessage(t)},window.addEventListener("message",this.messageHandler)},n.prototype.postData=function(e,t){var o=(0,I.bG)().uoid,r=c.tenantId,l=e.get("Leads_Dialog_Header"),h=e.get(this.isNotFirstTrial?"Leads_Dialog_Subheader_Trial_Renewal":"Leads_Dialog_Subheader"),p=e.get(this.isNotFirstTrial?"Leads_Dialog_Button_Renewal":"Leads_Dialog_Button"),f=this.iframe.nativeElement,$=JSON.stringify({token:t,userObjId:o,headerText:l,subHeaderText:h,ctaText:p,tenantID:r,offerID:this.isNotFirstTrial?"CO-DBI-Account-PowerBI-TrialRenewal-OfferID":"CO-DBI-ACCOUNT-POWERBI-TRIALINITIATION-OFFERID",GraphUrl:c.microsoftGraphUrl});f.contentWindow.postMessage(""+$,"*")},n.prototype.ngOnDestroy=function(){window.removeEventListener("message",this.messageHandler)},n.prototype.close=function(e){this.closeDialog()},n.prototype.closeOnOverlayClicked=function(e){if(this.isNotFirstTrial){var t=(e?.target).className;t?.includes("cdk-overlay-backdrop")&&this.showNoTrialDialog()}},n.prototype.closeDialog=function(e,t){var o=this;document.getElementById("leads").remove(),this.dialogRef.close({isComplete:e,error:t}),this.isNotFirstTrial&&this.dialogRef.afterClosed().subscribe(function(){return o.showNoTrialDialog()})},n.prototype.showNoTrialDialog=function(){var e,o=(e=this.getNoTrialDialogContentByServicePlan()).title;this.dialogService.showSimpleDialog(o,e.message,{panelClass:["no-trial-dialog"],maxHeight:"min-content",maxWidth:"340px"},{url:"https://go.microsoft.com/fwlink/?linkid=2222575",text:"LearnMore",showIcon:!0},this.localizationService.get("ModalDialogButtonText_GotIt"))},n.prototype.getNoTrialDialogContentByServicePlan=function(){var e,t;return this.userInfoService.userHasProPlan?(e=this.localizationService.get("Workspace_LicenseMode_Pro"),t=this.localizationService.get("PowerBI_PremiumPerUser")):(e=this.localizationService.get("PowerBI_Free"),t=this.localizationService.get("Workspace_LicenseMode_Pro")),{title:this.localizationService.format("TrialRenewalRefused_Dialog_Title",[e]),message:this.localizationService.format("TrialRenewalRefused_Dialog_Message",[e,t])}},n.prototype.handleMessage=function(e){var t=this;if(this.isTrustedOrigin(e.origin)&&this.isTrustedSource(e.source)&&this.isTrustedData(e.data)){var o;try{o=JSON.parse(e.data)}catch(r){return void this.dialogRef.close({error:r})}if(o.Error&&2!==o.FormEvent)return void this.dialogRef.close({isComplete:6===o.FormEvent,error:o.Error});switch(o.FormEvent){case 1:c.clientAuthEnabled?this.graphTokenPromiseV2.then(function(r){t.postData(t.localizationService,r.token)}):this.graphTokenPromise.then(function(r){t.postData(t.localizationService,r.data)});break;case 4:this.isLoading.next(!1);break;case 6:this.dialogRef.close({isComplete:!0,error:o.Error})}}},n.prototype.isTrustedOrigin=function(e){return new URL(e).origin===new URL(this.baseUrl).origin},n.prototype.isTrustedSource=function(e){return e===this.iframe.nativeElement.contentWindow},n.prototype.isTrustedData=function(e){return"string"==typeof e},n.\u0275fac=function(t){return new(t||n)(i.\u0275\u0275directiveInject(L.Zp),i.\u0275\u0275directiveInject(P.H7),i.\u0275\u0275directiveInject(d.so),i.\u0275\u0275directiveInject(O.o),i.\u0275\u0275directiveInject(M.O),i.\u0275\u0275directiveInject(U.Q),i.\u0275\u0275directiveInject(x.x),i.\u0275\u0275directiveInject(R.a),i.\u0275\u0275directiveInject(E.vZ))},n.\u0275cmp=i.\u0275\u0275defineComponent({type:n,selectors:[["leads-collection-dialog"]],viewQuery:function(t,o){var r;(1&t&&i.\u0275\u0275viewQuery(k,5,i.ElementRef),2&t)&&(i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(o.iframe=r.first))},hostBindings:function(t,o){1&t&&i.\u0275\u0275listener("keyup.escape",function(l){return o.close(l)},!1,i.\u0275\u0275resolveWindow)("click",function(l){return o.closeOnOverlayClicked(l)},!1,i.\u0275\u0275resolveBody)},decls:10,vars:10,consts:[[1,"header-container"],[1,"header-actions"],["id","close-button","mat-button","","localizeTooltip","Close",1,"glyphicon","pbi-glyph-close","glyph-small","close-button",3,"localizeAttr","click"],["class","pbi-spinner-large",4,"ngIf"],["id","leads","width","100%","height","100%","frameborder","0","marginwidth","0","marginheight","0","scrolling","auto","seamless","seamless","sandbox","allow-forms allow-presentation allow-same-origin allow-scripts allow-popups","allowfullscreen","","webkitallowfullscreen","","mozallowfullscreen","","msallowfullscreen","",1,"leads-form",3,"hidden","title","src"],["iframe",""],[1,"pbi-spinner-large"]],template:function(t,o){1&t&&(i.\u0275\u0275elementStart(0,"mat-dialog-content")(1,"div",0)(2,"header")(3,"div",1)(4,"button",2),i.\u0275\u0275listener("click",function(){return o.closeDialog()}),i.\u0275\u0275elementEnd()()()(),i.\u0275\u0275template(5,j,1,0,"pbi-spinner",3),i.\u0275\u0275pipe(6,"async"),i.\u0275\u0275element(7,"iframe",4,5),i.\u0275\u0275pipe(9,"async"),i.\u0275\u0275elementEnd()),2&t&&(i.\u0275\u0275advance(4),i.\u0275\u0275property("localizeAttr",i.\u0275\u0275pureFunction0(9,F)),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",i.\u0275\u0275pipeBind1(6,5,o.isLoading)),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("title",o.title),i.\u0275\u0275property("hidden",i.\u0275\u0275pipeBind1(9,7,o.isLoading))("src",o.leadsCollectionUrl,i.\u0275\u0275sanitizeResourceUrl))},dependencies:[d.xY,g.NgIf,z.b,N.r,B.k,g.AsyncPipe],styles:["pbi-spinner[_ngcontent-%COMP%]{height:650px;background-color:var(--fluent-theme-light-gray-color, #c8c8c8);display:flex;align-items:center;justify-content:center}.mat-mdc-dialog-content[_ngcontent-%COMP%]{padding:0;height:100%;position:relative;overflow:hidden}.header-container[_ngcontent-%COMP%]{position:absolute;top:10px;width:100%}.header-container[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end;background-color:transparent}.header-container[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin:0 24px;flex-direction:column;align-items:flex-end}.header-container[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{height:32px;border:none;padding:0;background-color:transparent}.leads-form[_ngcontent-%COMP%]{border:none;max-width:100%;max-height:100%}  .no-trial-dialog mat-dialog-container .mdc-dialog__surface{padding:0 24px}  .no-trial-dialog mat-dialog-container .pbi-dialog-header{margin-bottom:16px;margin-top:16px;align-items:baseline}  .no-trial-dialog mat-dialog-container .pbi-dialog-body{margin-bottom:32px}  .no-trial-dialog mat-dialog-container .pbi-dialog-footer{padding:0!important;height:72px}"],changeDetection:0}),n}(),componentIdentifier:a(71209).Q}],K=function(){function n(){}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=i.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=i.\u0275\u0275defineInjector({imports:[d.Is,g.CommonModule,T.v,y.H,C.w,D.c.withManifest(Y)]}),n}()}}]);