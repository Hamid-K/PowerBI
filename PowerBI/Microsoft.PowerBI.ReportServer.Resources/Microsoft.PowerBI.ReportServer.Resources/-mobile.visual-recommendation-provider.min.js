"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["visual-recommendation-provider"],{49116:function(Ot,Ye,j){j.r(Ye),j.d(Ye,{VisualRecommendationProviderModule:function(){return Tt}});var ne=j(81337),ze=j(47287),ce=ze.au.tooltips,X=function(){function e(){}return e.defaultFieldCount=20,e.defaultTopNFieldCount=3,e.fieldScoreBase=1.2,e.dispreferedLegendScoreReducer=.67,e.dispreferedRoleReducer=.67,e.dispreferedSortScoreReducer=.1,e.incompleteFieldsScore=.1,e.unsureTypeFieldScore=.3,e.idOnDispreferedAxis=.3,e.incompatibleAggregate=.1,e}(),Se=function(){function e(){}return e.strong=1,e.medium=.85,e.low=.3,e}(),$e=j(18129),M=j(62458),k=j(74082),fe=j(45413),de=j(58295);function pe(e,a){var t,r,i;M.fF.assertNonEmpty(e,"groupedExprs");for(var o=[],u=0,s=e;u<s.length;u++){var n=s[u];if(1===_.size(n.exprs)&&(0,k.Lk)(n.exprs[0])){if(!n.defaultLabel)return;if(ke(n.defaultLabel,e))continue;o.push({exprs:[n.defaultLabel],type:n.type,isMeasure:n.isMeasure,entity:null===(t=n.defaultLabel.getTargetEntity())||void 0===t?void 0:t.entity,canAggregate:n.canAggregate,isFiltered:n.isFiltered,isSingleValue:n.isSingleValue,isIdentity:null===(i=null===(r=n.defaultLabel.getConceptualProperty(a))||void 0===r?void 0:r.column)||void 0===i?void 0:i.idOnEntityKey,isParameter:n.isParameter,isTooltip:n.isTooltip,showAll:n.showAll,groupMetadata:n.groupMetadata})}else o.push(n)}return o}function me(e,a,t,r,i){M.fF.assertNonEmpty(e,"exprs"),M.fF.assertValue(t,"schema"),M.fF.assertValue(r,"aggrOps"),M.fF.assertValue(i,"condition");var o=function(h){return i(h)&&1===_.size(h.exprs)&&!h.isFiltered&&!h.isSingleValue&&!h.isParameter&&!h.showAll&&h.canAggregate},u=_.filter(e,function(E){return o(E)});if(_.isEmpty(u))return{groupedExprsWithMetadata:e,query:a};for(var s=[],n=a.orderBy(),l=a,c=function(h){if(!o(h))return s.push(h),"continue";var p=h,m=r.createExprWithAggregate(p.exprs[0],t,!1,void 0);if(!m||!(0,de.k)(m))return s.push(p),"continue";var g=m.getMetadata(t);s.push({exprs:[m],isMeasure:!0,type:g&&g.type,entity:h.entity,isTooltip:h.isTooltip,groupMetadata:h.groupMetadata,isHidden:h.isHidden});var y=_.find(n,function(S){return(0,fe.fS)(S.expr,p.exprs[0])});y&&(y.expr=m)},f=0,d=e;f<d.length;f++)c(d[f]);return l=l.orderBy(n),{groupedExprsWithMetadata:s,query:l}}function ye(e){return e&&e.type&&!e.type.temporal&&(e.type.numeric||e.type.integer)}function Te(e){return(0,k.iV)(e)&&(1===e.func||2===e.func)}function z(e,a,t,r,i,o,u){i?e.addParameter(a,t):e.add(a,t,{nativeReferenceName:o,isHidden:u}),r&&!e.projections[t].showAll&&e.toggleShowAll(t)}function Fe(e,a,t,r){var i,o=_.size(null===(i=e.projections[a])||void 0===i?void 0:i.all());o<=1||e.setActiveProjections([a],t?o:null!=r?r+1:1)}function ke(e,a){var t=_.flatten(_.map(a,function(i){return i.exprs}));return!!_.find(t,function(i){return(0,fe.fS)(i,e,!1,!0)})}var ue=j(45114),b=j(47508),ie=j(95462),Sr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.card.name,b.L.multiRowCard.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){M.fF.assertNonEmpty(a,"typedExprs should not be empty"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var i=pe(a,r.schema);if(!_.isEmpty(i)){var o=_.filter(i,function(F){return!F.isMeasure}),u=_.filter(i,function(F){return F.isMeasure}),s=_.filter(u,function(F){return!F.isHidden});_.isEmpty(s)&&(i=me(i,t,r.schema,r.aggrOps,function(F){return ye(F)}).groupedExprsWithMetadata,o=_.filter(i,function(F){return!F.isMeasure}),s=_.filter(i,function(F){return F.isMeasure&&!F.isTooltip&&!F.isHidden}));for(var l=_.size(s),c=_.size(o),x=1===l&&0===c,E=_.size(_.filter(i,function(F){return F.isSingleValue}))===c?1:Math.pow(5,-c),h=0===l?X.incompleteFieldsScore:1,p=new ue.g(ie.vQ.create(),{},[]),m=0,g=s;m<g.length;m++){var V=t.selectNativeReferenceNameOf(S=(y=g[m]).exprs[0]);z(p,S,"Values",y.showAll,y.isParameter,V)}for(var P=0,A=_.filter(u,function(F){return F.isHidden});P<A.length;P++){var y;V=t.selectNativeReferenceNameOf(S=(y=A[P]).exprs[0]),z(p,S,"Values",y.showAll,y.isParameter,V,!0)}for(var Q=0,v=o;Q<v.length;Q++)for(var O=v[Q],C=0,B=O.exprs;C<B.length;C++)V=t.selectNativeReferenceNameOf(S=B[C]),z(p,S,"Values",O.showAll,O.isParameter,V);if(!x){var L=t.orderBy(),K=_.some(a,function(F){return F.isExplicitSortBy});if(_.isEmpty(L)||!K){var S,T=_.first(s);L=null!=T?[{expr:S=T.exprs[0],direction:qe(L,S,2)}]:[{expr:S=_.first(o).exprs[0],direction:qe(L,S,1)}]}p.orderBy(L)}return[{config:this.visualAuthoring.create({query:p,visualType:x?b.L.card.name:b.L.multiRowCard.name,schema:r.schema,expr:void 0}),scores:{fieldScore:E,semanticTypeScore:h}}]}},e}();function qe(e,a,t){var r,i=_.find(e,function(o){return(0,fe.fS)(o.expr,a,!0,!0)});return null!==(r=i?.direction)&&void 0!==r?r:t}var Be=j(92947),Ie=j(5616),Er=j(48766),se=j(5265),G=j(94419),Ar=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.clusteredColumnChart.name,b.L.clusteredBarChart.name,b.L.columnChart.name,b.L.barChart.name,b.L.hundredPercentStackedColumnChart.name,b.L.hundredPercentStackedBarChart.name,b.L.donutChart.name,b.L.pieChart.name,b.L.ribbonChart.name,b.L.waterfallChart.name,b.L.treemap.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){var i,o,u;M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var s=function(e){return e===b.L.waterfallChart.name?{category:Ie.IT.category,series:Ie.IT.breakdown,y:Ie.IT.y}:e===b.L.treemap.name?{category:Be.A4.group,series:Be.A4.details,y:Be.A4.values}:{category:ze.au.category,series:ze.au.series,y:ze.au.y}}(r.visualType),n=t,l=pe(a,r.schema);if(!_.isEmpty(l)){var c=1,f=1,d=new ue.g(ie.vQ.create(),{},[]),x=_.filter(l,function(W){return!W.isMeasure}),E=_.filter(l,function(W){return W.isMeasure&&!W.isTooltip}),h=_.filter(E,function(W){return!W.isHidden}),p=_.filter(l,function(W){return W.isTooltip});if(_.isEmpty(h)){var m=me(l,t,r.schema,r.aggrOps,function(W){return ye(W)});l=m.groupedExprsWithMetadata,n=m.query,x=_.filter(l,function(W){return!W.isMeasure}),h=_.filter(l,function(W){return W.isMeasure&&!W.isTooltip&&!W.isHidden})}var g=_.remove(x,function(W){return W.isSingleValue});if(_.isEmpty(x)&&(x=g),!_.some(h,function(W){return W.type&&!W.type.numeric&&!W.type.integer})){var N,y=function(e){return _.orderBy(e,function(a){return a.type&&(a.type.text||a.type.temporal)?1:a.type&&a.type.bool?2:3})}(x),S=_.chain(y).filter(function(W){return W.isIdentity}).map(function(W){return W.entity}).value(),V=_.size(h)<=1&&_.size(x)>1;if(V){var P=_.findLastIndex(y,function(W){return 1===_.size(W.exprs)&&!W.isIdentity&&_.indexOf(S,W.entity)<0});if(P>=0){var A=y[P],Q=_.findLastIndex(x,A);N=A.type&&A.type.text&&!A.type.geography&&!A.type.misc&&!A.type.temporal,x.splice(Q,1),y.splice(P,1);var O=t.selectNativeReferenceNameOf(v=A.exprs[0]);z(d,v,s.series,A.showAll,A.isParameter,O)}}for(var C=!0,B=!1,L=0,K=y;L<K.length;L++){var T=K[L];T.isIdentity&&(B=!0);var U=Se.low;if(null==T.type)return;!T.isIdentity&&!T.type.text||T.type.geography||T.type.misc||T.type.temporal||T.type.dateTime?T.type&&(T.type.bool||T.type.geography||T.type.misc)&&(U=Se.medium):U=Se.strong,f=Math.min(f,U);for(var J=!0,F=0,w=T.exprs;F<w.length;F++)O=t.selectNativeReferenceNameOf(v=w[F]),z(d,v,s.category,T.showAll,T.isParameter,O),J=J&&!_.isEmpty(v.getOrderByColumns(r.schema));C=C&&(!(null===(i=T.type)||void 0===i||!i.temporal)||J)}Fe(d,s.category,r.addDefaultFormatting,null===(u=null===(o=y?.[0])||void 0===o?void 0:o.groupMetadata)||void 0===u?void 0:u.maxProjectedIndex),V&&!N&&(f*=X.dispreferedLegendScoreReducer);for(var Z=!1,te=function(he){M.fF.assert(function(){return 1===_.size(he.exprs)});var Ae=he.exprs[0],Ze=t.selectNativeReferenceNameOf(Ae);z(d,Ae,s.y,he.showAll,he.isParameter,Ze),Z=Z||Te(Ae)},re=0,q=h;re<q.length;re++)te(D=q[re]);for(var ae=0,ve=_.filter(E,function(W){return W.isHidden});ae<ve.length;ae++){var D;O=t.selectNativeReferenceNameOf(v=(D=ve[ae]).exprs[0]),z(d,v,s.y,D.showAll,D.isParameter,O,!0)}for(var Ne=function(he){M.fF.assert(function(){return 1===_.size(he.exprs)});var Ae=he.exprs[0],Ze=t.selectNativeReferenceNameOf(Ae);z(d,Ae,ce,he.showAll,he.isParameter,Ze,he.isHidden),Z=Z||Te(Ae)},R=0,I=p;R<I.length;R++)Ne(I[R]);var $=n.orderBy(),Oe=_.some(a,function(W){return W.isExplicitSortBy});if(_.isEmpty($)||!Oe){var Le=_.first(h);if(C&&!_.isEmpty(y))$=[{expr:v=_.first(y).exprs[0],direction:Qe($,v,1)}];else if(Le)$=[{expr:v=Le.exprs[0],direction:Qe($,v,2)}];else{var v;$=[{expr:v=_.first(y).exprs[0],direction:Qe($,v,1)}]}}d.orderBy($),c=Math.pow(X.fieldScoreBase,1-_.size(x))*Math.pow(X.fieldScoreBase,1-_.size(h)),(_.isEmpty(x)||_.isEmpty(h))&&(c=X.incompleteFieldsScore);var H=r.visualType;if(!H)if(B)H=b.L.clusteredColumnChart.name;else{var le=_.first($);H=(0,de.k)(le.expr)?b.L.clusteredBarChart.name:b.L.clusteredColumnChart.name}var Re=be(this.visualAuthoring,d,b.L.clusteredBarChart.name,r.schema,B,r.addDefaultFormatting),je=be(this.visualAuthoring,d,b.L.clusteredColumnChart.name,r.schema,B,r.addDefaultFormatting),Ft=be(this.visualAuthoring,d,b.L.barChart.name,r.schema,B,r.addDefaultFormatting),Pt=be(this.visualAuthoring,d,b.L.columnChart.name,r.schema,B,r.addDefaultFormatting),Je=Z?X.incompatibleAggregate:f,gr=[{config:Re,scores:{fieldScore:c,semanticTypeScore:f}},{config:Ft,scores:{fieldScore:c,semanticTypeScore:Je}}],xr=[{config:je,scores:{fieldScore:c,semanticTypeScore:f}},{config:Pt,scores:{fieldScore:c,semanticTypeScore:Je}}],Nr=H!==b.L.clusteredColumnChart.name&&H!==b.L.columnChart.name?(0,ne.ev)((0,ne.ev)([],gr,!0),xr,!0):(0,ne.ev)((0,ne.ev)([],xr,!0),gr,!0);if(function(e){return null!=e&&e!==b.L.clusteredBarChart.name&&e!==b.L.clusteredColumnChart.name&&e!==b.L.barChart.name&&e!==b.L.columnChart.name}(r.visualType)){var Vt=be(this.visualAuthoring,d,r.visualType,r.schema,B,r.addDefaultFormatting);Nr.unshift({config:Vt,scores:{fieldScore:c,semanticTypeScore:Je}})}return Nr}}},e}();function be(e,a,t,r,i,o){var u=e.create({query:a,visualType:t,schema:r,expr:void 0});return o&&(function(e){e.singleVisual.objects={},(0,se.sO)(e.singleVisual.objects,{objectName:"categoryAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0)),(0,se.sO)(e.singleVisual.objects,{objectName:"valueAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0))}(u),i&&function(e){(0,se.sO)(e.singleVisual.objects,{objectName:"categoryAxis",propertyName:"axisType"},void 0,(0,G.fL)(Er.w.categorical))}(u)),u}function Qe(e,a,t){var r,i=_.find(e,function(o){return(0,fe.fS)(o.expr,a,!0,!0)});return null!==(r=i?.direction)&&void 0!==r?r:t}var we=j(84741),Or=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.lineStackedColumnComboChart.name,b.L.lineClusteredColumnComboChart.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){var i,o;M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var u=pe(a,r.schema);if(!_.isEmpty(u)){var s=_.filter(u,function(R){return!R.isMeasure}),n=_.filter(u,function(R){return R.isMeasure&&!R.isTooltip}),l=_.filter(n,function(R){return!R.isHidden}),c=_.filter(u,function(R){return R.isTooltip});if(_.isEmpty(l)&&(u=me(u,t,r.schema,r.aggrOps,function(R){return ye(R)}).groupedExprsWithMetadata,s=_.filter(u,function(R){return!R.isMeasure}),l=_.filter(u,function(R){return R.isMeasure&&!R.isTooltip&&!R.isHidden})),!_.some(l,function(R){return R.type&&!R.type.numeric&&!R.type.integer})){var y,O,C,d=_.size(l),x=function(e){return _.orderBy(e,function(a){return a.type&&(a.type.temporal||a.type.dateTime)?1:a.type&&(a.type.numeric||a.type.integer)?2:3})}(s),E=_.chain(x).filter(function(R){return R.isIdentity}).map(function(R){return R.entity}).value(),h=1,m=new ue.g(ie.vQ.create(),{},[]);if(_.size(s)>1&&(y=_.findLast(x,function(R){return 1===_.size(R.exprs)&&!R.isIdentity&&_.indexOf(E,R.entity)<0}))){_.remove(s,y),_.remove(x,y);var V=t.selectNativeReferenceNameOf(S=y.exprs[0]);z(m,S,we.rJ.series,y.showAll,y.isParameter,V)}for(var N=0,P=x;N<P.length;N++)for(var A=P[N],Q=0,v=A.exprs;Q<v.length;Q++){var S;V=t.selectNativeReferenceNameOf(S=v[Q]),z(m,S,we.rJ.category,A.showAll,A.isParameter,V)}Fe(m,we.rJ.category,r.addDefaultFormatting,null===(o=null===(i=x?.[0])||void 0===i?void 0:i.groupMetadata)||void 0===o?void 0:o.maxProjectedIndex),y?(O=[_.first(l)],d>1&&(C=l.splice(1,d-1))):(O=d<=1?l:l.splice(0,d-1),C=d<=1?void 0:[_.last(l)]);for(var L=0,K=_.filter(n,function(R){return R.isHidden});L<K.length;L++)O.push(K[L]);var U=!1;if(!_.isEmpty(O))for(var Y=function(I){M.fF.assert(function(){return 1===_.size(I.exprs)});var ee=I.exprs[0],$=t.selectNativeReferenceNameOf(ee);z(m,ee,we.rJ.y,I.showAll,I.isParameter,$,I.isHidden),U=U||Te(ee)},J=0,F=O;J<F.length;J++)Y(F[J]);if(!_.isEmpty(C))for(var w=function(I){M.fF.assert(function(){return 1===_.size(I.exprs)});var ee=I.exprs[0],$=t.selectNativeReferenceNameOf(ee);z(m,ee,we.rJ.y2,I.showAll,I.isParameter,$,I.isHidden)},Z=0,te=C;Z<te.length;Z++)w(te[Z]);for(var re=function(I){M.fF.assert(function(){return 1===_.size(I.exprs)});var ee=I.exprs[0],$=t.selectNativeReferenceNameOf(ee);z(m,ee,ce,I.showAll,I.isParameter,$,I.isHidden),U=U||Te(ee)},q=0,D=c;q<D.length;q++)re(D[q]);h=Math.pow(X.fieldScoreBase,1-_.size(s))*Math.pow(X.fieldScoreBase,1-_.size(l)),(_.isEmpty(s)||_.isEmpty(l))&&(h=X.incompleteFieldsScore);var ae=this.visualAuthoring.create({query:m,visualType:b.L.lineClusteredColumnComboChart.name,schema:r.schema,expr:void 0});r.addDefaultFormatting&&er(ae);var ve=this.visualAuthoring.create({query:m,visualType:b.L.lineStackedColumnComboChart.name,schema:r.schema,expr:void 0});return r.addDefaultFormatting&&er(ve),[{config:ae,scores:{fieldScore:h,semanticTypeScore:1}},{config:ve,scores:{fieldScore:h,semanticTypeScore:U?X.incompatibleAggregate:1}}]}}},e}();function er(e){e.singleVisual.objects={},(0,se.sO)(e.singleVisual.objects,{objectName:"categoryAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0)),(0,se.sO)(e.singleVisual.objects,{objectName:"valueAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0)),(0,se.sO)(e.singleVisual.objects,{objectName:"valueAxis",propertyName:"secShowAxisTitle"},void 0,(0,G.O7)(!0))}var He=j(99653),wr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.funnel.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){var i,o;M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var u=pe(a,r.schema);if(!_.isEmpty(u)){var s=_.filter(u,function(T){return!T.isMeasure}),n=_.filter(u,function(T){return T.isMeasure&&!T.isTooltip}),l=_.filter(n,function(T){return!T.isHidden}),c=_.filter(u,function(T){return T.isTooltip});if(_.isEmpty(l)&&(u=me(u,t,r.schema,r.aggrOps,function(T){return ye(T)}).groupedExprsWithMetadata,s=_.filter(u,function(T){return!T.isMeasure}),l=_.filter(u,function(T){return T.isMeasure&&!T.isTooltip&&!T.isHidden})),!_.some(l,function(T){return T.type&&!T.type.numeric&&!T.type.integer})){var d=new ue.g(ie.vQ.create(),{},[]);if(!_.isEmpty(s)){for(var x=0,E=s;x<E.length;x++)for(var h=E[x],p=0,m=h.exprs;p<m.length;p++){var y=t.selectNativeReferenceNameOf(g=m[p]);z(d,g,He.IW.category,h.showAll,h.isParameter,y)}Fe(d,He.IW.category,r.addDefaultFormatting,null===(o=null===(i=s?.[0])||void 0===i?void 0:i.groupMetadata)||void 0===o?void 0:o.maxProjectedIndex)}if(!_.isEmpty(l)){var S=_.first(l);d.orderBy([{expr:g=S.exprs[0],direction:2}]);for(var V=0,N=l;V<N.length;V++){var A=(P=N[V]).exprs[0];y=t.selectNativeReferenceNameOf(A),z(d,A,He.IW.y,P.showAll,P.isParameter,y)}}for(var v=0,O=_.filter(n,function(T){return T.isHidden});v<O.length;v++){var P;y=t.selectNativeReferenceNameOf(g=(P=O[v]).exprs[0]),z(d,g,He.IW.y,P.showAll,P.isParameter,y,!0)}for(var C=0,B=c;C<B.length;C++){var g,L=B[C];y=t.selectNativeReferenceNameOf(g=L.exprs[0]),z(d,g,ce,L.showAll,L.isParameter,y,L.isHidden)}return[{config:this.visualAuthoring.create({query:d,visualType:r.visualType,schema:r.schema,expr:void 0}),scores:{fieldScore:1,semanticTypeScore:1}}]}}},e}(),Pe=j(5719),Lr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.gauge.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var i=pe(a,r.schema);if(!_.isEmpty(i)){var o=_.filter(i,function(A){return!A.isMeasure}),u=_.filter(i,function(A){return A.isMeasure&&!A.isTooltip}),s=_.filter(u,function(A){return!A.isHidden}),n=_.filter(i,function(A){return A.isTooltip});if(_.isEmpty(s)&&(i=me(i,t,r.schema,r.aggrOps,function(A){return ye(A)}).groupedExprsWithMetadata,o=_.filter(i,function(A){return!A.isMeasure}),s=_.filter(i,function(A){return A.isMeasure&&!A.isTooltip&&!A.isHidden})),!_.isEmpty(s)&&_.isEmpty(o)&&!_.some(s,function(A){return A.type&&!A.type.numeric&&!A.type.integer})){for(var c=new ue.g(ie.vQ.create(),{},[]),f=0;f<s.length;f++){var d;d=0===f?Pe.Vd.y:1===f?Pe.Vd.targetValue:2===f?Pe.Vd.minValue:3===f?Pe.Vd.maxValue:Pe.Vd.tooltips;var x=s[f].exprs[0],E=t.selectNativeReferenceNameOf(x);z(c,x,d,u[f].showAll,u[f].isParameter,E)}for(var p=0,m=_.filter(u,function(A){return A.isHidden});p<m.length;p++){var g=m[p];E=t.selectNativeReferenceNameOf(y=g.exprs[0]),z(c,y,Pe.Vd.y,g.showAll,g.isParameter,E,!0)}for(var S=0,V=n;S<V.length;S++){var y,N=V[S];E=t.selectNativeReferenceNameOf(y=N.exprs[0]),z(c,y,ce,N.showAll,N.isParameter,E,N.isHidden)}return[{config:this.visualAuthoring.create({query:c,visualType:r.visualType,schema:r.schema,expr:void 0}),scores:{fieldScore:1,semanticTypeScore:1}}]}}},e}(),Ce=j(47895),jr=j(80366),zr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.kpi.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var i=pe(a,r.schema);if(!_.isEmpty(i)){var o=_.filter(i,function(N){return!N.isMeasure}),u=_.filter(i,function(N){return N.isMeasure}),s=_.filter(u,function(N){return!N.isHidden});_.isEmpty(s)&&(i=me(i,t,r.schema,r.aggrOps,function(N){return ye(N)}).groupedExprsWithMetadata,o=_.filter(i,function(N){return!N.isMeasure}),s=_.filter(i,function(N){return N.isMeasure&&!N.isTooltip&&!N.isHidden}));var l=_.size(s);if(!(l<=0||l>2||_.some(s,function(N){return N.type&&!N.type.numeric&&!N.type.integer}))){var c,f,d;if(1===_.size(o)&&1===_.size(o[0].exprs)){var x=o[0].type;(x.temporal||x.dateTime)&&(d=o[0].exprs[0])}l>=1&&(c=s[0].exprs[0]),2===l&&(f=s[1].exprs[0]);var E=_.chain(s).map(function(N){return N.exprs}).flatten().find(function(N){var P=N.getConceptualProperty(r.schema);return P.measure&&P.measure.kpi}).value();if(E){var h=E.getConceptualProperty(r.schema).measure.kpi;c=E,!d&&h.trend&&(d=rr(h.trend,E)),!f&&h.goal&&(f=rr(h.goal,E))}if(c&&d){var p=new ue.g(ie.vQ.create(),{},[]);p.add(c,Ce.Pn.indicator,{nativeReferenceName:t.selectNativeReferenceNameOf(c)}),p.add(d,Ce.Pn.trendLine,{nativeReferenceName:t.selectNativeReferenceNameOf(d)}),f&&p.add(f,Ce.Pn.goal,{nativeReferenceName:t.selectNativeReferenceNameOf(f)});for(var g=0,y=_.filter(u,function(N){return N.isHidden});g<y.length;g++){var S=y[g];p.add(S.exprs[0],Ce.Pn.indicator,{nativeReferenceName:t.selectNativeReferenceNameOf(S.exprs[0]),isHidden:!0})}return[{config:this.visualAuthoring.create({query:p,visualType:r.visualType,schema:r.schema,expr:void 0}),scores:{fieldScore:1,semanticTypeScore:1}}]}}}},e}();function rr(e,a){var t=a.getTargetEntity();return(0,jr.og)({measure:{schema:t.schema,entity:t.entity,name:e.name}})}var Me=j(22733),Hr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.lineChart.name,b.L.areaChart.name,b.L.stackedAreaChart.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){var i,o,u;M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var s=t,n=pe(a,r.schema);if(!_.isEmpty(n)){var l=1,c=Se.strong,f=new ue.g(ie.vQ.create(),{},[]),d=_.filter(n,function(H){return!H.isMeasure}),x=_.filter(n,function(H){return H.isMeasure&&!H.isTooltip}),E=_.filter(x,function(H){return!H.isHidden}),h=_.filter(n,function(H){return H.isTooltip});if(_.isEmpty(E)){var p=me(n,t,r.schema,r.aggrOps,function(H){return ye(H)});n=p.groupedExprsWithMetadata,s=p.query,d=_.filter(n,function(H){return!H.isMeasure}),E=_.filter(n,function(H){return H.isMeasure&&!H.isTooltip&&!H.isHidden})}var m=_.remove(d,function(H){return H.isSingleValue});if(_.isEmpty(d)&&(d=m),!_.some(E,function(H){return H.type&&!H.type.numeric&&!H.type.integer})){var g=function(e){return _.orderBy(e,function(a){return a.type&&(a.type.temporal||a.type.dateTime)?1:a.type&&(a.type.numeric||a.type.integer)?2:3})}(d),y=g[0],S=_.find(g,function(H){return H.type&&(H.type.temporal||H.type.dateTime)});if(S){for(var V=0,N=S.exprs;V<N.length;V++){var A=t.selectNativeReferenceNameOf(P=N[V]);z(f,P,Me.x.category,S.showAll,S.isParameter,A)}_.remove(g,S)}var v,O,Q=_.chain(g).filter(function(H){return H.isIdentity}).map(function(H){return H.entity}).value();_.size(E)<=1&&(S?_.size(g)>0:_.size(g)>1)&&(v=_.findLast(g,function(H){return 1===_.size(H.exprs)&&!H.isIdentity&&_.indexOf(Q,H.entity)<0}))&&(O=v.type&&v.type.text&&!v.type.misc,_.remove(d,v),_.remove(g,v),A=t.selectNativeReferenceNameOf(P=v.exprs[0]),z(f,P,Me.x.series,v.showAll,v.isParameter,A));for(var B=!0,L=!1,K=0,T=g;K<T.length;K++){var U=T[K];U.type&&!U.type.numeric&&!U.type.integer&&(c=Se.low),U.isIdentity&&U.type&&!U.type.temporal&&!U.type.dateTime&&(L=!0);for(var Y=0,J=U.exprs;Y<J.length;Y++)A=t.selectNativeReferenceNameOf(P=J[Y]),z(f,P,Me.x.category,U.showAll,U.isParameter,A),B=B&&!_.isEmpty(P.getOrderByColumns(r.schema))}Fe(f,Me.x.category,r.addDefaultFormatting,null===(u=null===(o=null===(i=(0,ne.ev)([S],g,!0))||void 0===i?void 0:i[0])||void 0===o?void 0:o.groupMetadata)||void 0===u?void 0:u.maxProjectedIndex),v&&!O&&(c*=X.dispreferedLegendScoreReducer);for(var F=!1,w=function(le){M.fF.assert(function(){return 1===_.size(le.exprs)});var Re=le.exprs[0],je=t.selectNativeReferenceNameOf(Re);z(f,Re,Me.x.y,le.showAll,le.isParameter,je),F=F||Te(Re)},Z=0,te=E;Z<te.length;Z++)w(re=te[Z]);for(var D=0,oe=_.filter(x,function(H){return H.isHidden});D<oe.length;D++){var re,P;A=t.selectNativeReferenceNameOf(P=(re=oe[D]).exprs[0]),z(f,P,Me.x.y,re.showAll,re.isParameter,A,!0)}for(var ae=function(le){M.fF.assert(function(){return 1===_.size(le.exprs)});var Re=le.exprs[0],je=t.selectNativeReferenceNameOf(Re);z(f,Re,ce,le.showAll,le.isParameter,je,le.isHidden),F=F||Te(Re)},ve=0,Ne=h;ve<Ne.length;ve++)ae(Ne[ve]);var I=s.orderBy();if(_.isEmpty(I))if(y&&(B||y.type&&(y.type.numeric||y.type.integer||y.type.dateTime||y.type.temporal)))I=[{expr:y.exprs[0],direction:1}];else{var ee=_.first(E);I=ee?[{expr:ee.exprs[0],direction:2}]:[{expr:y.exprs[0],direction:1}]}f.orderBy(I),l=Math.pow(X.fieldScoreBase,1-_.size(d))*Math.pow(X.fieldScoreBase,1-_.size(E)),L&&(l*=X.idOnDispreferedAxis),(_.isEmpty(d)||_.isEmpty(E))&&(l=X.incompleteFieldsScore);var $=this.visualAuthoring.create({query:f,visualType:b.L.lineChart.name,schema:r.schema,expr:void 0});r.addDefaultFormatting&&De($);var Oe=this.visualAuthoring.create({query:f,visualType:b.L.areaChart.name,schema:r.schema,expr:void 0});r.addDefaultFormatting&&De(Oe);var Le=this.visualAuthoring.create({query:f,visualType:b.L.stackedAreaChart.name,schema:r.schema,expr:void 0});return r.addDefaultFormatting&&De(Le),[{config:$,scores:{fieldScore:l,semanticTypeScore:c}},{config:Oe,scores:{fieldScore:l,semanticTypeScore:c}},{config:Le,scores:{fieldScore:l,semanticTypeScore:F?X.incompatibleAggregate:c}}]}}},e}();function De(e){e.singleVisual.objects={},(0,se.sO)(e.singleVisual.objects,{objectName:"categoryAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0)),(0,se.sO)(e.singleVisual.objects,{objectName:"valueAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0))}var Ve=j(98755),Br=j(52083),Ir=j(96915),Qr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.map.name,b.L.filledMap.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){var i,o;M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var u=pe(a,r.schema);if(!_.isEmpty(u)){var s=1,n=new ue.g(ie.vQ.create(),{},[]),l=_.filter(u,function(w){return!w.isMeasure});if(!_.isEmpty(l)){var c=_.filter(u,function(w){return w.isMeasure&&!w.isTooltip}),f=_.filter(c,function(w){return!w.isHidden}),d=_.filter(u,function(w){return w.isTooltip});_.isEmpty(f)&&(u=me(u,t,r.schema,r.aggrOps,function(w){return ye(w)}).groupedExprsWithMetadata,l=_.filter(u,function(w){return!w.isMeasure}),f=_.filter(u,function(w){return w.isMeasure&&!w.isTooltip&&!w.isHidden}));var E=_.remove(l,function(w){return w.isSingleValue});_.isEmpty(l)&&(l=E);var h=_.filter(l,function(w){return w.type&&w.type.geography&&!w.type.geography.latitude&&!w.type.geography.longitude}),p=_.find(l,function(w){return w.type&&w.type.geography&&w.type.geography.latitude}),m=_.find(l,function(w){return w.type&&w.type.geography&&w.type.geography.longitude}),g=_.filter(l,function(w){return w.type&&!w.type.geography&&1===_.size(w.exprs)});if(!(_.size(g)>1)){if(_.isEmpty(h)&&!p&&!m){if(!r.visualType)return;h=g,g=void 0,s=X.unsureTypeFieldScore}var y,V;if(p){var S=p.exprs[0];y=_.isEmpty(h)?S:(0,G.m_)(S,1)}if(m&&(S=m.exprs[0],V=_.isEmpty(h)?S:(0,G.m_)(S,1)),!_.isEmpty(h)){for(var N=0,P=h;N<P.length;N++)for(var A=P[N],Q=0,v=A.exprs;Q<v.length;Q++){var O=v[Q],C=t.selectNativeReferenceNameOf(O);z(n,O,Ve.aX.category,A.showAll,A.isParameter,C)}Fe(n,Ve.aX.category,r.addDefaultFormatting,null===(o=null===(i=h?.[0])||void 0===i?void 0:i.groupMetadata)||void 0===o?void 0:o.maxProjectedIndex)}y&&z(n,y,Ve.aX.y,p.showAll,p.isParameter,t.selectNativeReferenceNameOf(y),p.isHidden),V&&z(n,V,Ve.aX.x,m.showAll,m.isParameter,t.selectNativeReferenceNameOf(V),m.isHidden);var B=!1;if(!_.isEmpty(g)){var L=g[0].exprs[0];C=t.selectNativeReferenceNameOf(L),z(n,L,Ve.aX.series,g[0].showAll,g[0].isParameter,C),B=!0,(S=g[0]).type&&S.type.text&&!S.type.geography&&!S.type.misc||(s*=X.dispreferedLegendScoreReducer),S.isIdentity&&(s*=X.idOnDispreferedAxis)}if(!_.some(f,function(w){return w.type&&!w.type.numeric&&!w.type.integer})){var T=this.visualAuthoring.create({query:n.clone(),visualType:b.L.map.name,schema:r.schema,expr:void 0}),U=tr(T,t,(0,ne.ev)([],c,!0),d,B,r.allowTooltipMeasures,r.addDefaultFormatting),Y=this.visualAuthoring.create({query:n.clone(),visualType:b.L.filledMap.name,schema:r.schema,expr:void 0}),J=tr(Y,t,(0,ne.ev)([],c,!0),d,B,r.allowTooltipMeasures,r.addDefaultFormatting),F=[];if(U&&F.push({config:T,scores:{fieldScore:U,semanticTypeScore:s}}),J&&F.push({config:Y,scores:{fieldScore:J,semanticTypeScore:s}}),!_.isEmpty(F))return F}}}}},e}();function tr(e,a,t,r,i,o,u){var s=_.filter(t,function(v){return!v.isHidden}),n=_.filter(t,function(v){return v.isHidden}),l=_.size(s);if(0===l)return 1;var f=e.singleVisual.query,d=1;if(e.singleVisual.visualType===b.L.map.name){M.fF.assert(function(){return 1===_.size(s[0].exprs)},"we can only have 1 measure group");var E=a.selectNativeReferenceNameOf(x=s[0].exprs[0]);z(f,x,Ve.aX.size,s[0].showAll,s[0].isParameter,E,s[0].isHidden),s.splice(0,1),l-=1}if(0!==l&&!i&&u){M.fF.assert(function(){return 1===_.size(t[0].exprs)},"we can only have 1 measure group");var h=s[0].exprs[0];(function(e,a){e.singleVisual.objects={},(0,se.sO)(e.singleVisual.objects,{objectName:"dataPoint",propertyName:"fill"},{data:[(0,Ir.Ue)(1)]},{solid:{color:(0,G.x5)(a,(0,Br.jT)())}})})(e,h),o&&(E=a.selectNativeReferenceNameOf(h),z(f,h,ce,!1,!1,E,t[0].isHidden)),s.splice(0,1),l-=1}if(0!==l){if(!o)return;d=Math.pow(X.fieldScoreBase,-l);for(var p=function(O){M.fF.assert(function(){return 1===_.size(O.exprs)},"we can only have 1 measure group");var C=O.exprs[0],B=a.selectNativeReferenceNameOf(C);z(f,C,ce,O.showAll,O.isParameter,B,O.isHidden)},m=0,g=s;m<g.length;m++)p(y=g[m])}for(var S=0,V=n;S<V.length;S++){var y,x;E=a.selectNativeReferenceNameOf(x=(y=V[S]).exprs[0]),z(f,x,ce,y.showAll,y.isParameter,E,y.isHidden)}for(var N=function(O){M.fF.assert(function(){return 1===_.size(O.exprs)});var C=O.exprs[0],B=a.selectNativeReferenceNameOf(C);z(f,C,ce,O.showAll,O.isParameter,B,O.isHidden)},P=0,A=r;P<A.length;P++)N(A[P]);return d}var ge=j(85196),_r=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.pivotTable.name,b.L.tableEx.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var i=function(e,a){var t,r,i;M.fF.assertNonEmpty(e,"groupedExprs");for(var o=[],u=0,s=e;u<s.length;u++){var n=s[u];if(1===_.size(n.exprs)&&(0,k.Lk)(n.exprs[0])){if(!n.defaultFields)return;for(var l=0,c=n.defaultFields;l<c.length;l++){var f=c[l];if(!ke(f,e)){var d=f.getMetadata(a);o.push({exprs:[f],type:d&&d.type,isMeasure:(0,de.k)(f),entity:null===(t=f.getTargetEntity())||void 0===t?void 0:t.entity,canAggregate:!1,isIdentity:null===(i=null===(r=f.getConceptualProperty(a))||void 0===r?void 0:r.column)||void 0===i?void 0:i.idOnEntityKey,isParameter:n.isParameter,isTooltip:n.isTooltip,showAll:n.showAll})}}}else o.push(n)}return o}(a,r.schema);if(!_.isEmpty(i)){var o=_.filter(i,function(p){return!p.isMeasure}),u=_.filter(i,function(p){return p.isMeasure}),s=_.filter(u,function(p){return!p.isHidden}),n=_.chain(o).filter(function(p){return p.isIdentity}).map(function(p){return p.entity}).value(),l=2===_.size(o)&&1===_.size(s)?_.findLast(o,function(p){return 1===_.size(p.exprs)&&!p.isIdentity&&_.indexOf(n,p.entity)<0}):void 0,c=_.some(o,function(p){return p.type&&p.type.misc}),f=function(e){var a=_.chain(e).map(function(t){return t.exprs}).flatten().value();if(_.some(a,function(t){return(0,k.g5)(t)&&!_.isEmpty(t.scope)}))return!0}(s),d=!f&&function(e,a,t,r,i){for(var o=function(d){return d.isParameter||_.some(d.exprs,function(x){return(0,k.tO)(x)})},u=!1,s=0,n=e;s<n.length;s++){var l=n[s];if(_.indexOf(t,l.entity)<0&&(u=!0),o(l))return!0}if(!u||_.some(a,function(f){return o(f)}))return!0;var c=r.orderBy();return!!i&&_.some(c,function(f){return(0,de.k)(f.expr)})}(o,s,n,t,l),x=f?void 0:function(e,a,t,r,i,o,u){for(var s,n=new ue.g(ie.vQ.create(),{},[]),l=_.filter(i,function(O){return!O.isHidden}),c=0,f=r;c<f.length;c++)for(var d=f[c],x=0,E=d.exprs;x<E.length;x++){var p=e.selectNativeReferenceNameOf(h=E[x]);z(n,h,ge.r.values,d.showAll,d.isParameter,p)}for(var m=0,g=i;m<g.length;m++)for(var y=g[m],S=0,V=y.exprs;S<V.length;S++){var h;p=e.selectNativeReferenceNameOf(h=V[S]),z(n,h,ge.r.values,y.showAll,y.isParameter,p,y.isHidden)}u&&_.size(e.select())>1&&_.some(r,function(O){return O.type&&O.type.misc&&O.type.misc.webUrl})&&(0,se.sO)(s={},{objectName:"values",propertyName:"urlIcon"},void 0,(0,G.O7)(!0));var N=e.orderBy();if(_.isEmpty(N)){var P=_.first(l);if(P)N=[{expr:P.exprs[0],direction:2}];else{var A=_.find(r);A?N=[{expr:A.exprs[0],direction:1}]:M.fF.assertFail("No expr for order by. This should not happen.")}}n.orderBy(N);var Q=a.create({query:n,visualType:b.L.tableEx.name,schema:t,expr:void 0});return s&&(Q.singleVisual.objects=s),{config:Q,fieldScore:o?1:(1+_.size(r))/(2+_.size(r)),semanticScore:Se.strong}}(t,this.visualAuthoring,r.schema,o,u,c,r.addDefaultFormatting),E=d?void 0:function(e,a,t,r,i,o,u){for(var s,n=new ue.g(ie.vQ.create(),{},[]),l=_.filter(i,function(F){return!F.isHidden}),c=_.filter(i,function(F){return F.isHidden}),f=2===_.size(r)&&1===_.size(l)?_.findLast(r,function(F){return 1===_.size(F.exprs)&&!F.isIdentity&&_.indexOf(o,F.entity)<0}):void 0,d=0,x=r;d<x.length;d++)for(var E=x[d],h=E===f?ge.r.columns:ge.r.rows,p=0,m=E.exprs;p<m.length;p++){var y=e.selectNativeReferenceNameOf(g=m[p]);z(n,g,h,E.showAll,E.isParameter,y)}var S=f?1:0;if(_.size(_.flatten(_.map(r,function(F){return F.exprs})))-S>1){var V=n.getQueryRefByProjectionIndex(ge.r.rows,0);n.projections[ge.r.rows].addActiveQueryReference(V),(0,se.sO)(s={},{objectName:"rowHeaders",propertyName:"showExpandCollapseButtons"},void 0,(0,G.O7)(!0))}for(var N=0;N<l.length;N++)for(var P=0,A=l[N].exprs;P<A.length;P++){y=e.selectNativeReferenceNameOf(g=A[P]),z(n,g,ge.r.values,l[N].showAll,l[N].isParameter,y);var Q=l[N].type;(!Q||Q.numeric||Q.integer)&&u&&(V=n.getQueryRef(ge.r.values,{fieldIndex:N}),s||(s={}),(0,se.sO)(s,{objectName:"columnFormatting",propertyName:"dataBars"},{metadata:V},{axisColor:{solid:{color:(0,G.fL)("foreground")}},hideText:(0,G.O7)(!1),negativeColor:{solid:{color:(0,G.fL)("minColor")}},positiveColor:{solid:{color:(0,G.fL)("maxColor")}},reverseDirection:(0,G.O7)(!1),maxValue:void 0,minValue:void 0}))}for(var v=0,O=c;v<O.length;v++)for(var C=O[v],B=0,L=C.exprs;B<L.length;B++){var g;y=e.selectNativeReferenceNameOf(g=L[B]),z(n,g,ge.r.values,C.showAll,C.isParameter,y,!0)}var K=e.orderBy();if(_.isEmpty(K)){var T=_.first(l);if(!f&&T)K=[{expr:T.exprs[0],direction:2}];else{var U=_.find(r,function(F){return F!==f});U?K=[{expr:U.exprs[0],direction:1}]:M.fF.assertFail("No expr for order by. This should not happen.")}}n.orderBy(K);var Y=a.create({query:n,visualType:b.L.pivotTable.name,schema:t,expr:void 0});return s&&(Y.singleVisual.objects=s),{config:Y,fieldScore:(1+_.size(r))/(2+_.size(r)),semanticScore:_.isEmpty(l)?Se.medium:Se.strong}}(t,this.visualAuthoring,r.schema,o,u,n,r.addDefaultFormatting),h=[];return E&&h.push({config:E.config,scores:{fieldScore:E.fieldScore,semanticTypeScore:E.semanticScore}}),x&&h.push({config:x.config,scores:{fieldScore:x.fieldScore,semanticTypeScore:x.semanticScore}}),h}},e}(),Ee=j(14577),Gr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.scatterChart.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){var i,o,u;M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(t,"query"),M.fF.assertValue(r,"pluginConfig");var s=pe(a,r.schema);if(!_.isEmpty(s)){var n=_.filter(s,function(R){return!R.isMeasure}),l=_.filter(s,function(R){return R.isMeasure&&!R.isTooltip}),c=_.filter(l,function(R){return!R.isHidden}),f=_.filter(s,function(R){return R.isTooltip});_.isEmpty(c)&&(s=me(s,t,r.schema,r.aggrOps,function(R){return ye(R)}).groupedExprsWithMetadata,n=_.filter(s,function(R){return!R.isMeasure}),c=_.filter(s,function(R){return R.isMeasure&&!R.isTooltip&&!R.isHidden}));var x=_.remove(n,function(R){return R.isSingleValue});if(_.isEmpty(n)&&(n=x),!_.some(c,function(R){return R.type&&!R.type.numeric&&!R.type.integer})){var E=1,h=1,p=new ue.g(ie.vQ.create(),{},[]);if(Math.max(0,2-_.size(c))>0){for(var y=[],S=0,V=_.filter(n,function(R){return R.type&&(R.type.numeric||R.type.integer)&&1===_.size(R.exprs)&&!R.isIdentity});S<V.length;S++)!(P=r.aggrOps.createExprWithAggregate((N=V[S]).exprs[0],r.schema,!1,void 0))||!(0,de.k)(P)||y.push({original:N,measure:{exprs:[P],isMeasure:!0,type:null===(i=P.getMetadata(r.schema))||void 0===i?void 0:i.type,entity:P.getTargetEntity().entity,isTooltip:!1}});for(var A=0,Q=y;A<Q.length;A++){var v=Q[A];_.remove(n,v.original),c.push(v.measure)}}var O=_.findLast(n,function(R,I){return I>0&&1===_.size(R.exprs)});O&&(!(O&&O.type&&O.type.text)||O.type.geography||O.type.misc)&&(h*=X.dispreferedLegendScoreReducer);for(var B=0,L=n;B<L.length;B++)for(var N,K=(N=L[B])===O?Ee.TL.series:Ee.TL.category,T=0,U=N.exprs;T<U.length;T++){var Y=t.selectNativeReferenceNameOf(P=U[T]);z(p,P,K,N.showAll,N.isParameter,Y)}Fe(p,Ee.TL.category,r.addDefaultFormatting,null===(u=null===(o=n?.[0])||void 0===o?void 0:o.groupMetadata)||void 0===u?void 0:u.maxProjectedIndex);for(var J=function(I){M.fF.assert(function(){return 1===_.size(c[I].exprs)},"measure groups should have only 1 expr");var ee=0===I?Ee.TL.x:1===I?Ee.TL.y:2===I?Ee.TL.size:Ee.TL.tooltips,$=c[I].exprs[0],Oe=t.selectNativeReferenceNameOf($);z(p,$,ee,c[I].showAll,c[I].isParameter,Oe)},F=0;F<_.size(c);F++)J(F);for(var Z=0,te=_.filter(l,function(R){return R.isHidden});Z<te.length;Z++){var P,re=te[Z];Y=t.selectNativeReferenceNameOf(P=re.exprs[0]),z(p,P,Ee.TL.x,re.showAll,re.isParameter,Y,!0)}for(var q=function(I){M.fF.assert(function(){return 1===_.size(I.exprs)});var ee=I.exprs[0],$=t.selectNativeReferenceNameOf(ee);z(p,ee,ce,I.showAll,I.isParameter,$,I.isHidden)},D=0,oe=f;D<oe.length;D++)q(oe[D]);E=_.isEmpty(n)||_.size(c)<2?X.incompleteFieldsScore:Math.pow(X.fieldScoreBase,2-_.size(c))*Math.pow(X.fieldScoreBase,1-_.size(n)),_.some(n,function(R){return R.type&&(R.type.temporal||!R.type.text)})&&(E*=X.dispreferedLegendScoreReducer);var ve=t.orderBy();_.isEmpty(ve)||(h*=X.dispreferedSortScoreReducer);var Ne=this.visualAuthoring.create({query:p,visualType:r.visualType||b.L.scatterChart.name,schema:r.schema,expr:void 0});return r.addDefaultFormatting&&function(e){e.singleVisual.objects={},(0,se.sO)(e.singleVisual.objects,{objectName:"categoryAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0)),(0,se.sO)(e.singleVisual.objects,{objectName:"valueAxis",propertyName:"showAxisTitle"},void 0,(0,G.O7)(!0))}(Ne),[{config:Ne,scores:{fieldScore:E,semanticTypeScore:h}}]}}},e}(),Zr=j(9434),Yr=function(){function e(a){this.visualAuthoring=a}return Object.defineProperty(e.prototype,"applicableVisuals",{get:function(){return[b.L.slicer.name]},enumerable:!1,configurable:!0}),e.prototype.process=function(a,t,r){M.fF.assertNonEmpty(a,"typedExprs"),M.fF.assertValue(r,"pluginConfig");var i=pe(a,r.schema);if(!_.isEmpty(i)&&1===_.size(i)&&1===_.size(i[0].exprs)&&!i[0].isMeasure){var u=new ue.g(ie.vQ.create(),{},[]),s=i[0].exprs[0],n=t.selectNativeReferenceNameOf(s);return z(u,s,Zr.CT.value,i[0].showAll,i[0].isParameter,n),[{config:this.visualAuthoring.create({query:u,visualType:b.L.slicer.name,schema:r.schema,expr:void 0}),scores:{fieldScore:1,semanticTypeScore:1}}]}},e}(),_e=j(28199),ar=j(77435),ir=j(28107),nr=j(9380),$r=j(66794),kr=j(42614),sr=j(3579),or=j(50550),qr=j(38078),et=j(5361),rt=j(75074),ur=j(38953),lr=j(19501),We=j(45551),Ue=j(29866),xe=j(50423),cr=j(13702),st={provide:"visualRecommendationService",useFactory:function(e,a,t,r,i,o){return new Promise(function(u){u(new Ke(e,a,t,r,i,o))})},deps:[_e.C,nr.vZ,ar.q,Ue.D,ir.Q]},Ke=function(){function e(a,t,r,i,o,u){this.aggrOps=a,this.visualPlugin=i,this.visualAuthoringCore=(0,$r.Vz)(i,r,a,t,o,u),this.recommendationPlugins=[new Sr(this.visualAuthoringCore),new Ar(this.visualAuthoringCore),new Hr(this.visualAuthoringCore),new Qr(this.visualAuthoringCore),new _r(this.visualAuthoringCore),new Gr(this.visualAuthoringCore)],this.pluginsByExplicitRequestOnly=[new Or(this.visualAuthoringCore),new wr(this.visualAuthoringCore),new Lr(this.visualAuthoringCore),new zr(this.visualAuthoringCore)],this.pluginsForChartSuggestionOnly=[new Yr(this.visualAuthoringCore)]}return e.prototype.recommendVisuals=function(a,t,r){var i,o=this;M.fF.assertValue(a,"query"),M.fF.assertValue(t,"schema"),M.fF.assertValue(r,"recommendationConfig");var s,u=r.visualType,n=[];if(function(e,a){var t=e.select();return _.some(t,function(r){var i;return(0,k.tO)(r.expr)||(null===(i=_.find(a.exprMetadata,function(o){return(0,fe.fS)(o.expression,r.expr,!0,!0)}))||void 0===i?void 0:i.isParameter)})}(a,r)){var l=b.L.tableEx.name;n.push(_.find(this.recommendationPlugins,function(v){return _.indexOf(v.applicableVisuals,l)>=0})),s=u===l?void 0:"TypeRequestedNotCompatible",u=u===l?u:void 0}else if(function(e){var a=e.select();return _.some(a,function(t){return(0,k.g5)(t.expr)&&!_.isEmpty(t.expr.scope)})}(a)){var c=b.L.pivotTable.name;n.push(_.find(this.recommendationPlugins,function(v){return _.indexOf(v.applicableVisuals,c)>=0})),s=u===c?void 0:"TypeRequestedNotCompatible",u=u===c?u:void 0}else n.push.apply(n,this.recommendationPlugins),u&&(n.push.apply(n,this.pluginsByExplicitRequestOnly),n=_.filter(n,function(v){return _.indexOf(v.applicableVisuals,u)>=0}));_.isEmpty(n)&&(n=(0,ne.ev)([],this.recommendationPlugins,!0),u=void 0,s="TypeRequestedNotSupported");var f=(i=this.processInput(a,r.exprMetadata,t)).modifiedQuery,d=i.processedExprs,x=new ue.g(ie.vQ.create(),{},[]),E={visualContainers:[pr(this.visualAuthoringCore.create({query:x,visualType:u||b.L.columnChart.name,schema:t,expr:void 0}),void 0)],warning:"CouldNotGenerateResult"};if(_.isEmpty(d))return E;if(_.every(d,function(v){return v.isHidden}))return E.warning="HasOnlyHiddenFields",E;if(_.some(d,function(v){return(0,k.Lk)(v.exprs[0])&&!v.defaultLabel&&_.isEmpty(v.defaultFields)}))return E;var m={schema:t,aggrOps:this.aggrOps,addDefaultFormatting:r.addDefaultFormatting,allowTooltipMeasures:r.allowTooltipMeasures};u&&(m.visualType=u);var g=function(O){var C=o.ensureMeasures(d,f,t),B=O.process(C.groupedExprsWithMetadata,C.query,m);if(!_.isEmpty(B))return _.map(B,function(L){return{result:L,score:yt(L.scores)}})},y=kr.l.deriveFromSQFilters(f.from(),f.where(),{Select:void 0,Filters:r.filterMetadata}),S=_.chain(n).map(function(v){return g(v)}).flatten().filter(function(v){return null!=v}).value();_.isEmpty(S)&&null!=m.visualType&&(m.visualType=void 0,S=_.chain(this.recommendationPlugins).map(function(v){return g(v)}).flatten().filter(function(v){return null!=v}).value());var V=_.orderBy(S,[function(v){return v.result.config.singleVisual.visualType===m.visualType},function(v){return v.score}],["desc","desc"]);if(r.includeChartTypeOnlyAlternatives){var N=_.chain(this.pluginsForChartSuggestionOnly).map(function(v){return g(v)}).flatten().filter(function(v){return null!=v}).value();!_.isEmpty(N)&&!_.isEmpty(V)&&V.splice.apply(V,(0,ne.ev)([1,0],N,!1))}_.isFunction(r.isVisualExcluded)&&(V=_.filter(V,function(v){return!r.isVisualExcluded(v.result.config.singleVisual.visualType)})),a.hasVisualCalculations()&&(V=_.filter(V,function(v){return!o.visualPlugin.capabilities(v.result.config.singleVisual.visualType).suppressVisualCalc})),V=_.take(V,r.numberOfResults),r.filterOutLowScoringResults&&(V=_.filter(V,function(v){return v.score>.1}));var P=_.map(V,function(v){return pr(v.result.config,y)});if(!_.isEmpty(P)){var A=_.first(P),Q=(0,sr.s)(A);return null!=u&&Q!==u&&null==s&&(s="TypeRequestedNotCompatible"),{visualContainers:P,warning:s}}return E},e.prototype.processInput=function(a,t,r){var i=a.select();if(_.isEmpty(t)&&!_.isEmpty(i)){t=[];for(var o=0,u=i;o<u.length;o++)t.push({expression:u[o].expr})}var n=_.filter(t,function(f){return(0,de.k)(f.expression)});!_.isEmpty(n)&&_.every(n,function(f){return f.isTooltip})&&_.forEach(n,function(f){return f.isTooltip=!1});var l=function(e,a,t){var r=e,i=[],o=e.select();M.fF.assert(function(){return _.size(o)===_.size(a)},"each select should have metadata");for(var u=0;u<o.length;u++){var s=o[u],n=a[u];if((0,k.y3)(s.expr)){var l=s.expr,c=(0,We.wA)(t,l);if(_.isEmpty(c))i.push(n);else{c=(0,or.rY)(c),r=r.removeSelect(l);for(var f=0,d=c;f<d.length;f++){var x=d[f];r=r.addSelect(x);var E=_.clone(n);E.expression=x,i.push(E)}}}else i.push(n)}return{modifiedQuery:r,modifiedExprMetadata:i}}(a,t,r);l.modifiedQuery=fr(l.modifiedQuery),l.modifiedQuery=vr(l.modifiedQuery);var c=function(e,a,t){var r,i,o,u=[],s={},n=e.select();M.fF.assert(function(){return _.size(n)===_.size(a)},"each expr should have metadata");for(var l=function(e){for(var a=e.from(),t=e.where(),r=_.chain(t).filter(function(c){return(0,k.Hi)(c.condition)&&1===_.size(c.condition.values)&&1===_.size(c.condition.values.values)||(0,k.$Q)(c.condition)&&0===c.condition.comparison}).map(function(c){return(0,k.Hi)(c.condition)?_.first(c.condition.args):(0,k.$Q)(c.condition)?c.condition.left:void 0}).value(),i=_.map(t,function(c){return(0,k.Hi)(c.condition)&&c.condition.table&&(0,k.jv)(c.condition.table)?c.condition.table.variable:void 0}),o=0,u=i;o<u.length;o++){var s=u[o];if(s){var n=a.source(s);if(!(0,lr.y)(n)){M.fF.assertFail("should be subquery source");continue}if(1===n.subquery.top()){var l=_.map(n.subquery.select(),function(c){return c.expr});r.push.apply(r,l||[])}}}return r}(e),c=function(e){for(var a=e.where(),t=new ht,r=0,i=a;r<i.length;r++)i[r].condition.accept(t);return t.fields}(e),f=new gt,d=function(h){var p=n[h].expr;p=p.accept(f);var m=a[h],g=function(e,a){if((0,k.Lk)(e)){var t=a.schema(e.schema).entities.withName(e.entity);if(t){var r=t.defaultLabel;if(r)return(0,G.Oh)(e,r.name)}}}(p,t)||m?.defaultLabel,y=g?g.getMetadata(t):p.getMetadata(t),S=function(e,a){return a?a.geography?e?.geography?e:a:a.dateTime&&(e?.dateTime||e?.temporal)?e:a:e}(y?.type,m?.type),V=(0,de.k)(p),N=m&&!m.isGroup,P=m?.isExplicitSortBy,A=m?.isParameter,Q=null===(i=null===(r=(g??p).getConceptualProperty(t))||void 0===r?void 0:r.column)||void 0===i?void 0:i.idOnEntityKey,v=function(e,a,t){if((0,k.Lk)(e)){var r=t.schema(e.schema).entities.withName(e.entity);if(r){var i=r.defaultFields;_.isEmpty(i)&&(i=_.chain(r.properties).filter(function(c){return(c.column||c.measure)&&!c.hidden}).take(X.defaultFieldCount).value());var o=[];a&&o.push(a);for(var u=0,s=i;u<s.length;u++){var n=s[u],l=n.column?(0,G.Oh)((0,G.nw)(e.schema,e.entity),n.name):(0,G.mv)((0,G.nw)(e.schema,e.entity),n.name);a&&(0,fe.fS)(l,a,!1,!0)||o.push(l)}return o}}}(p,g,t),O=null===(o=p.getTargetEntity())||void 0===o?void 0:o.entity,C=m?.isTooltip,B=m?.showAll,L=m?.groupMetadata,K=L?.groupId,T=L?.isProjected,U=m?.isHidden,Y=function(D){var oe=_.first(p.getKeyColumns(t)),ae=g?_.first(g.getKeyColumns(t)):void 0;return(0,fe.fS)(D,p,!1,!0)||oe&&(0,fe.fS)(D,oe,!1,!0)||g&&(0,fe.fS)(D,g,!1,!0)||ae&&(0,fe.fS)(D,ae,!1,!0)},J=_.some(l,function(q){return Y(q)}),F=_.some(c,function(q){return Y(q)});g&&(g=g.accept(f));var w={exprs:[p],type:S,isMeasure:V,entity:O,isTooltip:C,canAggregate:N,defaultLabel:g,defaultFields:v,isExplicitSortBy:P,isParameter:A,isSingleValue:J,isFiltered:F,isIdentity:Q,showAll:B,groupMetadata:L?{groupId:K,maxProjectedIndex:T?0:void 0}:void 0,isHidden:U},Z=function(D){if(D){if(D.exprs.push(p),D.isSingleValue=!1,D.isFiltered=D.isFiltered||F,D.isIdentity=void 0,T){var oe=D.groupMetadata.maxProjectedIndex,ae=_.size(D.exprs)-1;D.groupMetadata.maxProjectedIndex=oe+1===ae?ae:void 0}return"Updated"}return u.push(w),"Added"};null!=K?Z(_.find(u,function(q){var D;return(null===(D=q.groupMetadata)||void 0===D?void 0:D.groupId)===K})):(0,k.ez)(p)&&(0,k.y3)(p.arg)?"Added"===Z(s[p.arg.hierarchy])&&(s[p.arg.hierarchy]=w):u.push(w)},x=0;x<n.length;x++)d(x);return u}(l.modifiedQuery,l.modifiedExprMetadata,r);return{modifiedQuery:l.modifiedQuery,processedExprs:c}},e.prototype.ensureMeasures=function(a,t,r){var i=_.filter(a,function(o){return!o.isMeasure&&!o.canAggregate});return _.isEmpty(i)?{groupedExprsWithMetadata:a,query:t}:me(a,t,r,this.aggrOps,function(o){return!o.isMeasure&&o.canAggregate&&ye(o)})},e.\u0275fac=function(t){return new(t||e)(xe.\u0275\u0275inject(_e.C),xe.\u0275\u0275inject(nr.vZ),xe.\u0275\u0275inject(ar.q),xe.\u0275\u0275inject(Ue.D),xe.\u0275\u0275inject(ir.Q),xe.\u0275\u0275inject(cr.O))},e.\u0275prov=xe.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e}();function fr(e){for(var a=dr(e,fr),t=e.where(),r=0,i=t;r<i.length;r++){var o=i[r];o.condition=o.condition.accept(new $e.u),o.condition=o.condition.accept(new $e.Y)}return e.where(t,a)}function vr(e){var a=dr(e,vr),t=e.orderBy();if(_.isEmpty(t))return e;for(var r=0,i=t;r<i.length;r++){var o=i[r];if(null==o.direction||0===o.direction){var s=(0,de.k)(o.expr);o.direction=s?2:1}}return e.from(a).orderBy(t)}function dr(e,a){var r=e.from().sources();for(var i in r){var o=r[i];if((0,lr.y)(o)){var u=a(o.subquery);r[i]=new ur.vd(u)}}return new ur.cL(r)}function yt(e){return Math.pow(e.fieldScore,1.2)*Math.pow(e.semanticTypeScore,1.5)}function pr(e,a){return{name:qr.b$.generateGuid(),config:e,filters:a}}var ht=function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return(0,ne.ZT)(a,e),a.prototype.visitColumnRef=function(t){this.fields.push(t)},a.prototype.visitHierarchyLevel=function(t){this.fields.push(t)},a.prototype.visitMeasureRef=function(t){this.fields.push(t)},a}(rt.PA),gt=function(e){function a(){return null!==e&&e.apply(this,arguments)||this}return(0,ne.ZT)(a,e),a.prototype.visitEntity=function(t){return(0,G.nw)(t.schema,t.entity)},a}(et.b),mr=j(60661),xt=j(68509),yr=j(45334),Rt={provide:"authoringVisualRecommendationInterop",useFactory:function(e,a,t,r){return new Promise(function(i){i(new St(e,a,t,r))})},deps:[_e.C,Ke,cr.O,Ue.D]},St=function(){function e(a,t,r,i){this.aggrOps=a,this.visualRecommendationService=t,this.displayNameService=r,this.visualPluginService=i}return e.prototype.updateWithRecommendation=function(a,t,r,i){var o;M.fF.assertValue(a,"visualContainer"),M.fF.assertAnyValue(t,"withChanges"),M.fF.assertValue(r,"schema");var u=(0,mr.PQ)(a);if(u){var s;(t?.toUpdate||t?.toAdd)&&(s=this.visualPluginService.capabilities(u.visualType));var l,n=hr(u,ie.vQ.create(),t?.toUpdate,i,r,s,this.displayNameService);t?.toAdd&&(l=function(e,a,t,r,i,o,u){var s,n=e.hasDefaultSort,l=null===(s=e.query)||void 0===s?void 0:s.defn.orderBy(),c=a,f=[];if((0,We.K8)(r,t))for(var d=(0,We.wA)(r,t),x=0,E=(0,or.rY)(d);x<E.length;x++)f.push(h=E[x]);else if(!yr.m.isExprValidForAggregation(t)||yr.m.discourageAggregation(t,r)||(0,de.k)(t))f.push(t);else{var h=o.createExprWithAggregate(t,r,!1,void 0);f.push(h)}var p=[];return _.forEach(f,function(m){var g=u.createUniqueNativeReference(m,r,e.query,i,void 0);c=c.addSelect(m,void 0,g),p.push(Xe(m,!1,!1,l,n,void 0))}),{query:c,exprMetadata:p}}(u,n.query,t.toAdd,r,s,this.aggrOps,this.displayNameService));var c=null!==(o=l?.query)&&void 0!==o?o:n.query,f=l?(0,ne.ev)((0,ne.ev)([],n.exprMetadata,!0),l.exprMetadata,!0):(0,ne.ev)([],n.exprMetadata,!0),d=this.visualRecommendationService.recommendVisuals(c,r,{numberOfResults:1,exprMetadata:f,filterMetadata:void 0,filterOutLowScoringResults:!0,visualType:t?.visualType,isVisualExcluded:t?.isVisualExcluded});if("CouldNotGenerateResult"!==d.warning&&"HasOnlyHiddenFields"!==d.warning&&!_.isEmpty(d?.visualContainers)){var x=d.visualContainers[0].config.singleVisual;return a.config.singleVisual.query=x.query,a.config.singleVisual.visualType=x.visualType,a.config.singleVisual.conversionSourceContext=void 0,x.visualType}}},e.prototype.getRecommendedVisualTypes=function(a,t,r,i){M.fF.assertValue(a,"visualContainer"),M.fF.assertValue(t,"schema"),M.fF.assert(function(){return r>0},"invalid number of suggestions");var o=(0,mr.PQ)(a);if(o){var u=hr(o,ie.vQ.create()),s=this.visualRecommendationService.recommendVisuals(u.query,t,{numberOfResults:r,exprMetadata:u.exprMetadata,filterMetadata:void 0,filterOutLowScoringResults:!0,isVisualExcluded:i});if("CouldNotGenerateResult"!==s.warning&&"HasOnlyHiddenFields"!==s.warning&&!_.isEmpty(s?.visualContainers))return _.map(s.visualContainers,function(n){return(0,sr.s)(n)})}},e}();function Xe(e,a,t,r,i,o,u,s){var n=!(0,de.k)(e);return{expression:e,isGroup:n,isParameter:a,isTooltip:t,isExplicitSortBy:!i&&!!_.find(r,function(l){return(0,fe.fS)(l.expr,e)}),showAll:o,groupMetadata:n?u:void 0,isHidden:s}}function hr(e,a,t,r,i,o,u){var s,n,l,c=[],f=null===(s=e.query)||void 0===s?void 0:s.projections,d=null===(n=e.query)||void 0===n?void 0:n.defn.select(),x=null===(l=e.query)||void 0===l?void 0:l.defn.orderBy(),E=e.hasDefaultSort;if(_.isEmpty(f))return{exprMetadata:c,query:a};var h=a,p=0,m=function(S){for(var V=f[S],N=V.all(),P=V.activeProjectionRefs,A=V.getFieldParameters(),Q=V.showAll,v=S===ce,O={},C=0,B=A;C<B.length;C++){var L=B[C];if(null!=L.index||null!=L.length&&L.length>0)for(var K=V.convertFieldIndexToProjectionIndex(L.index),T=0;T<L.length;T++)O[K+T]=L.expr;h=h.addSelect(L.expr),c.push(Xe(L.expr,!0,v,x,E,Q,r?{groupId:p,isProjected:!1}:void 0))}var U=function(J){var F=void 0,w=void 0;if(O[J])return"continue";var Z=_.find(d,function(q){return q.name===N[J].queryRef});if(F=Z?.expr,w=Z?.nativeReferenceName,t&&S===t.role&&J===t.index&&(F=(0,k.iV)(F)?F.arg:F,F=void 0===t.aggregateToUse?(0,xt.n)(F,i):(0,G.m_)(F,t.aggregateToUse),w=u.createUniqueNativeReference(F,i,e.query,o,void 0)),M.fF.assertValue(F,"projection has to exist as a parameter or in the query selects"),F){var te=_.indexOf(P,N[J].queryRef)>=0,re=N[J].hidden;h=h.addSelect(F,void 0,w),c.push(Xe(F,!1,v,x,E,Q,r?{groupId:p,isProjected:te}:void 0,re))}};for(T=0;T<N.length;T++)U(T);p++};for(var g in f)m(g);return{query:h,exprMetadata:c}}var At=j(77476),Tt=function(){function e(){}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=xe.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=xe.\u0275\u0275defineInjector({providers:[Rt,Ke,st],imports:[At.CommonModule]}),e}()}}]);