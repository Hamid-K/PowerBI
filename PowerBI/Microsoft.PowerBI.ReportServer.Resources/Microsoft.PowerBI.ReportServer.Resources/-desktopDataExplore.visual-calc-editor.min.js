"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["visual-calc-editor"],{48563:function(me,G,n){n.d(G,{w:function(){return L}});var h=n(17819);function L(P){return P.map(function(w){return function(P){return{name:P.Name,description:P.Description,category:H(P.Category),pushableToDQ:N(P.PushableToDirectQuery),parameters:A(P.Parameters),visualCalculationsInfo:P.VisualCalculationsInfo}}(w)})}function H(P){switch(P){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9}}function N(P){var w=0;return 1===P?w=1:2===P?w=2:3===P&&(w=3),w}function A(P){return P?P.map(function(w){return function(P){return new h.Hw(P.Name,P.Optional,P.Repeatable,P.RepeatGroup,P.Skippable)}(w)}):[]}},83269:function(me,G,n){n.r(G),n.d(G,{VisualCalcEditorModule:function(){return Vt},VisualCalcServiceLazyProvider:function(){return Ct},VisualCalcServicePromiseFactory:function(){return yt}});var h=n(77476),L=n(17174),O=n(4633),H=n(26898),N=n(83008),A=n(21024),U=n(48145),P=n(27980),w=n(22346),S=n(9380),k=n(9844),K=n(17848),te=n(82156),ne=n(79061),oe=n(93367),ge=n(14463),pe=n(15393),be=n(66890),I=n(51644),f=n(62458);function Q(o){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return f.fF.assertValue(o,"functionName"),f.fF.assertValue(t,"args"),"".concat(o).concat(I.block("(",t,")"))}var fe,q=n(50550),E=n(21571),m=n(50423),Ce=n(65181),ye=function(){function o(t){this.localizationService=t}return o.prototype.getTemplates=function(){return[new Qe(this.localizationService),new Ze(this.localizationService),new Xe(this.localizationService),new Je(this.localizationService),new Te(this.localizationService),new xe(this.localizationService,0),new xe(this.localizationService,1),new xe(this.localizationService,3),new xe(this.localizationService,2)]},o.\u0275fac=function(r){return new(r||o)(m.\u0275\u0275inject(Ce.o))},o.\u0275prov=m.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),Qe=function(){function o(t){this.localizationService=t,this.capabilities={name:"RunningSum",displayName:(0,E.V)("VisualCalcTemplate_RunningSum_DisplayName"),description:(0,E.V)("VisualCalcTemplate_RunningSum_Description"),category:"VisualCalculation",input:(0,q.z8)([{name:"Field",column:{type:{numeric:!0}},displayName:(0,E.V)("Field"),description:""}]),helpLink:-1}}return o.prototype.getExpression=function(){var t=(0,E.G)(this.capabilities.input[0].displayName,this.localizationService);return function(o){return f.fF.assertValue(o,"expression"),Q("RUNNINGSUM",o)}("[".concat(t,"]"))},o}(),Ze=function(){function o(t){this.localizationService=t,this.capabilities={name:"MovingAverage",displayName:(0,E.V)("VisualCalcTemplate_MovingAverage_DisplayName"),description:(0,E.V)("VisualCalcTemplate_MovingAverage_Description"),category:"VisualCalculation",input:(0,q.z8)([{name:"Field",column:{type:{numeric:!0}},displayName:(0,E.V)("Field"),description:""},{name:"WindowSize",constant:{type:{numeric:!0},defaultValue:1},displayName:(0,E.V)("VisualCalcTemplate_WindowSizeField"),description:""}]),helpLink:-1}}return o.prototype.getExpression=function(){var t=(0,E.G)(this.capabilities.input[0].displayName,this.localizationService),r=(0,E.G)(this.capabilities.input[1].displayName,this.localizationService);return function(o,t){return f.fF.assertValue(o,"expression"),f.fF.assertValue(t,"windowSize"),Q("MOVINGAVERAGE",o,t)}("[".concat(t,"]"),"".concat(r))},o}(),Xe=function(){function o(t){this.localizationService=t,this.capabilities={name:"PercentOfParent",displayName:(0,E.V)("VisualCalcTemplate_PercentOfParent_DisplayName"),description:(0,E.V)("VisualCalcTemplate_PercentOfParent_Description"),category:"VisualCalculation",input:(0,q.z8)([{name:"NumeratorField",column:{type:{numeric:!0}},displayName:(0,E.V)("Field"),description:""},{name:"CollapseDenominatorField",column:{},displayName:(0,E.V)("Field"),description:""},{name:"Axis",displayName:(0,E.V)("VisualCalcTemplate_AxisField"),description:""}]),helpLink:-1}}return o.prototype.getExpression=function(){var t=(0,E.G)(this.capabilities.input[0].displayName,this.localizationService),r=(0,E.G)(this.capabilities.input[1].displayName,this.localizationService),s=(0,E.G)(this.capabilities.input[2].displayName,this.localizationService);return I.divide("[".concat(t,"]"),function(o,t){return f.fF.assertValue(o,"expression"),f.fF.assertValue(t,"axis"),Q("COLLAPSE",o,t)}("[".concat(r,"]"),"".concat(s)))},o}(),Je=function(){function o(t){this.localizationService=t,this.capabilities={name:"PercentOfGrandTotal",displayName:(0,E.V)("ShowValueAs_Calculation_PercentOfGrandTotal"),description:(0,E.V)("VisualCalcTemplate_PercentOfGrandTotal_Description"),category:"VisualCalculation",input:(0,q.z8)([{name:"NumeratorField",column:{type:{numeric:!0}},displayName:(0,E.V)("Field"),description:""},{name:"CollapseAllDenominatorField",column:{},displayName:(0,E.V)("Field"),description:""},{name:"Axis",displayName:(0,E.V)("VisualCalcTemplate_AxisField"),description:""}]),helpLink:-1}}return o.prototype.getExpression=function(){var t=(0,E.G)(this.capabilities.input[0].displayName,this.localizationService),r=(0,E.G)(this.capabilities.input[1].displayName,this.localizationService),s=(0,E.G)(this.capabilities.input[2].displayName,this.localizationService);return I.divide("[".concat(t,"]"),function(o,t){return f.fF.assertValue(o,"expression"),f.fF.assertValue(t,"axis"),Q("COLLAPSEALL",o,t)}("[".concat(r,"]"),"".concat(s)))},o}(),Te=function(){function o(t){this.localizationService=t,this.capabilities={name:"AverageOfChildren",displayName:(0,E.V)("VisualCalcTemplate_AverageOfChildren_DisplayName"),description:(0,E.V)("VisualCalcTemplate_AverageOfChildren_Description"),category:"VisualCalculation",input:(0,q.z8)([{name:"Field",column:{type:{numeric:!0}},displayName:(0,E.V)("Field"),description:""},{name:"Axis",displayName:(0,E.V)("VisualCalcTemplate_AxisField"),description:""}]),helpLink:-1}}return o.prototype.getExpression=function(){var t=(0,E.G)(this.capabilities.input[0].displayName,this.localizationService),r=(0,E.G)(this.capabilities.input[1].displayName,this.localizationService);return function(o,t){return f.fF.assertValue(o,"expression"),f.fF.assertValue(t,"axis"),Q("EXPAND",o,t)}(I.average("[".concat(t,"]")),"".concat(r))},o}(),xe=function(){function o(t,r){void 0===r&&(r=3),this.localizationService=t,this.versusEnum=r;var s=o.versusToDax[this.versusEnum];this.capabilities={name:"Versus".concat(s),displayName:(0,E.V)("VisualCalcTemplate_Versus_".concat(s,"_DisplayName")),description:(0,E.V)("VisualCalcTemplate_Versus_".concat(s,"_Description")),category:"VisualCalculation",input:(0,q.z8)([{name:"Field",column:{type:{numeric:!0}},displayName:(0,E.V)("Field"),description:""},{name:"DaxFunctionField",column:{},displayName:(0,E.V)("Field"),description:""}]),helpLink:-1}}return o.prototype.getExpression=function(){var t=(0,E.G)(this.capabilities.input[0].displayName,this.localizationService),r=(0,E.G)(this.capabilities.input[1].displayName,this.localizationService),s=o.versusToDax[this.versusEnum];return"[".concat(t,"] - ").concat(Q(s,"[".concat(r,"]")))},o.versusToDax=((fe={})[3]="FIRST",fe[2]="LAST",fe[1]="NEXT",fe[0]="PREVIOUS",fe),o}(),he=n(88409),x=n(81337),_e=n(63057),Ve=n(59787),ve=n(59973),ee=n(83317),Ye=n(17653),Ie=n(81905),qe=n(48787),Be=n(15903),et=n(15783),De=n(34103),Ne=n(72080),Re=n(49217),ze=n(65302),tt=n(39681),He=n(73221),Ae=n(52570),Ee=n(61561),Me=n(30794),nt=n(35510),Se=n(23558),ot=n(22318),je=n(77526),rt=n(6663),it=n(98361),ke=n(95792),at=n(74249),st=n(26657),de=n(60661),lt=n(74082),ut=n(63731),$e=n(73027),Ue=n(8590),le=n(73202),ct=n(11494),Le=n(28894),We={provide:Be.n9,useClass:function(o){function t(r,s,l,d,p,v,b,F){var C=o.call(this,r,l,s)||this;return C.eventBridge=d,C.lazyScopeProvider=p,C.visualCalcEagerService=v,C.daxCapabilitiesService=b,C.zone=F,C.submit$=new Me.xQ,C.cancel$=new Me.xQ,C.onContentChanged$=new nt.X(void 0),C.destroy$=new Me.xQ,C}return(0,x.__extends)(t,o),t.prototype.hasUnsavedChanges=function(r){return!1},t.prototype.commitOrDeletePendingCalculation=function(r){return(0,x.__awaiter)(this,void 0,void 0,function(){return(0,x.__generator)(this,function(s){return[2,!1]})})},t.prototype.commitCalculationUpdate=function(r){return(0,x.__awaiter)(this,void 0,void 0,function(){return(0,x.__generator)(this,function(s){return this.submit$.next(r),[2]})})},t.prototype.cancel=function(r){this.cancel$.next()},t.prototype.onContentChanged=function(r){this.onContentChanged$.next(r)},t.prototype.onTemplateSelection=function(r){return(0,x.__awaiter)(this,void 0,void 0,function(){var s,l;return(0,x.__generator)(this,function(p){switch(p.label){case 0:return st.gD(r)?(s=r.getExpression(),l=(0,E.G)(r.capabilities.displayName,this.localizationService),this.formulaBarControl.isEditorEnabled?[3,3]:[4,this.lazyScopeProvider.get(Ee.w)]):(f.fF.assertFail("Selected template is not a visual calculation template"),[2]);case 1:return[4,p.sent().enterVisualCalcEditingModeWithPlaceHolder(this.visualContainer,"Template",s,l)];case 2:return p.sent(),[2];case 3:return _.isEmpty(this.formulaBarControl.getCurrentEditorText())||this.formulaBarControl.getCurrentEditorText()===this.formulaBarControl.getHighlightedText()?this.formulaBarControl.insertTextAtCurrentCursor("".concat(l," = ").concat(s)):this.formulaBarControl.insertTextAtCurrentCursor(s),[2]}})})},t.prototype.setVisualContainer=function(r){this.visualContainer=r},t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},t.prototype.registerFormulaBarControl=function(r){var s=this;this.formulaBarControl=r,this.formulaBarControl.setReadOnly(!1),this.eventBridge.on(Ue.jCS).pipe((0,ee.R)(this.destroy$),(0,ve.h)(function(l){return l.affectContainer(s.visualContainer)})).subscribe(function(){s.intellisenseService.updateFormulaContextAsync()}),this.submit$.pipe((0,ee.R)(this.destroy$)).subscribe(function(){s.visualCalcEagerService.enterViewMode("PressedSubmit")}),this.destroy$.pipe((0,Se.M)(this.onContentChanged$,this.visualCalcEagerService.onContextChange$())).subscribe(function(l){var d=l[1],p=l[2];return(0,x.__awaiter)(s,void 0,void 0,function(){return(0,x.__generator)(this,function(b){switch(b.label){case 0:switch(p.type){case"Edit":return[3,1];case"View":return[3,4]}return[3,4];case 1:return[4,this.tryToCommitContents(d,p)];case 2:return b.sent(),[4,this.tryRemoveUnchangedNewCalculation(d,p)];case 3:return b.sent(),[3,5];case 4:return[3,5];case 5:return[2]}})})}),this.cancel$.pipe((0,ee.R)(this.destroy$)).subscribe(function(){s.visualCalcEagerService.enterViewMode("PressedCancel")}),this.visualCalcEagerService.onContextChange$().pipe((0,ot.O)({type:"Edit",calculationInfo:{isNew:!1}}),(0,je.x)(function(l,d){return"Edit"===l.type&&"Edit"===d.type&&l.queryName===d.queryName}),(0,ee.R)(this.destroy$),(0,rt.G)(),(0,Se.M)(this.onContentChanged$)).subscribe(function(l){var d=l[0],p=d[0],v=d[1],b=l[1];return(0,x.__awaiter)(s,void 0,void 0,function(){var C,ce,ie;return(0,x.__generator)(this,function(Y){switch(Y.label){case 0:if("Edit"!==p.type)return[3,15];switch(v.type){case"Edit":return[3,1];case"View":return[3,4]}return[3,4];case 1:return[4,this.tryToCommitContents(b,p)];case 2:return Y.sent(),[4,this.tryRemoveUnchangedNewCalculation(b,p)];case 3:return Y.sent(),[3,15];case 4:switch(C=v.entryPoints){case"PressedCancel":return[3,5];case"PressedSubmit":return[3,9];case"DeletedCurrentCalc":return[3,12]}return[3,13];case 5:return p.calculationInfo.isNew?[4,this.lazyScopeProvider.get(Ee.w)]:[3,8];case 6:return[4,Y.sent().removeVisualCalculation(this.visualContainer,p.queryName)];case 7:Y.sent(),Y.label=8;case 8:return[3,14];case 9:return[4,this.tryRemoveUnchangedNewCalculation(b,p)];case 10:return Y.sent(),[4,this.tryToCommitContents(b,p)];case 11:return Y.sent(),[3,14];case 12:return[3,14];case 13:return f.fF.assertNever(C),[3,14];case 14:return[3,15];case 15:switch(v.type){case"Edit":return[3,16];case"View":return[3,23]}return[3,23];case 16:return(ce=(0,de.Xf)(this.visualContainer))&&ce.defn.select().withName(v.queryName)?[4,this.intellisenseService.getCalculationInfo()]:(this.visualCalcEagerService.enterViewMode("DeletedCurrentCalc"),[3,24]);case 17:switch(ie=Y.sent(),v.editingType){case"Template":return[3,18];case"Custom":return[3,20]}return[3,20];case 18:return[4,this.handleUpdateContents(!1,ie)];case 19:return Y.sent(),[3,22];case 20:return[4,this.handleUpdateContents(ie.isNew,ie)];case 21:return Y.sent(),[3,22];case 22:return[3,24];case 23:return this.resetFormulaBar(),[3,24];case 24:return[2]}})})}),this.visualCalcEagerService.onVisualCalcDeleted$().pipe((0,ee.R)(this.destroy$),(0,Se.M)(this.visualCalcEagerService.onContextChange$())).subscribe(function(l){var p=l[1];"Edit"===p.type&&l[0]===p.queryName&&s.visualCalcEagerService.enterViewMode("DeletedCurrentCalc")}),this.visualCalcEagerService.onNativeNameReferenceChange$().pipe((0,ee.R)(this.destroy$),(0,Se.M)(this.visualCalcEagerService.onContextChange$())).subscribe(function(l){var d=l[0],p=d.oldName,v=d.queryName,b=l[1];return(0,x.__awaiter)(s,void 0,void 0,function(){var F,C,g,j,W,ce,ie;return(0,x.__generator)(this,function(ae){switch(ae.label){case 0:return"Edit"!==b.type?[3,6]:(F=b.queryName,C=(0,de.Xf)(this.visualContainer),g=C?.defn.select().withName(F),g&&(0,lt.jX)(g.expr)?null==(j=C.defn.select().withName(v))?[2]:(W=this.formulaBarControl.getCurrentEditorText(),F!==v?[3,2]:[4,this.updateExpressionAfterFieldRenamed(W)]):[3,6]);case 1:return ie=ae.sent(),[3,4];case 2:return[4,this.updateExpressionAfterReferencedFieldRenamed(W,C,p,j.nativeReferenceName)];case 3:ie=ae.sent(),ae.label=4;case 4:return(ce=ie)===W?[3,6]:[4,this.updateContents(ce,void 0)];case 5:ae.sent(),this.formulaBarControl.resetModelTokens(ce),this.intellisenseService.updateFormulaContextAsync(),ae.label=6;case 6:return[2]}})})})},t.prototype.updateExpressionAfterFieldRenamed=function(r){return(0,x.__awaiter)(this,void 0,void 0,function(){var s,l,d,p,v;return(0,x.__generator)(this,function(b){switch(b.label){case 0:return s=r,[4,this.intellisenseService.getCalculationInfo()];case 1:return null!=(l=b.sent())&&(d=(0,ke.O5)(l.formulaText,!0),p=(0,ke.O5)(r),v=p.formula||" ",p.name&&p.name===r&&(v=" ".concat(r)),s="".concat(d.name," =").concat(v)),[2,s]}})})},t.prototype.updateExpressionAfterReferencedFieldRenamed=function(r,s,l,d){return(0,x.__awaiter)(this,void 0,void 0,function(){var p,v,b,F,C,g;return(0,x.__generator)(this,function(j){switch(j.label){case 0:return p=r,_.isEmpty(r)?[3,5]:null!=this.vcDaxParserService?[3,2]:(v=this,[4,this.lazyScopeProvider.get(ut.M)]);case 1:v.vcDaxParserService=j.sent(),j.label=2;case 2:return[4,this.daxCapabilitiesService.getReservedWords()];case 3:return b=j.sent(),[4,this.daxCapabilitiesService.getCapabilities()];case 4:F=j.sent(),C=s.defn.getNativeReferenceNames(!0),C=_.map(C,function(W){return W===d?l:W}),g=this.vcDaxParserService.getContext(C,b,F),p=this.vcDaxParserService.renameReference(g,r,l,d),j.label=5;case 5:return[2,p]}})})},t.prototype.handleUpdateContents=function(r,s){return(0,x.__awaiter)(this,void 0,void 0,function(){return(0,x.__generator)(this,function(l){switch(l.label){case 0:return this.formulaBarControl.clear(),[4,this.updateContents(s.formulaText,s.alertMessage)];case 1:return l.sent(),[4,this.focusWhenNotBlocked()];case 2:return l.sent(),r&&this.formulaBarControl.setSelection({startPosition:0,length:s.formulaText.length}),[2]}})})},t.prototype.resetFormulaBar=function(){this.formulaBarControl.clear(),this.formulaBarControl.resetModelTokens(""),this.formulaBarControl.setExpandCollapseState(1),this.formulaBarControl.endFormulaEdit()},t.prototype.tryToCommitContents=function(r,s){return(0,x.__awaiter)(this,void 0,void 0,function(){var l,d,p;return(0,x.__generator)(this,function(b){switch(b.label){case 0:return r&&r.doCommit&&!_.isEmpty(r.newExpression)?(d=r.newExpression,p=this.getName(r.newName,l=s.queryName),[4,this.lazyScopeProvider.get(Ee.w)]):[3,3];case 1:return[4,b.sent().updateVisualCalculation(this.visualContainer,p,d,l,s.calculationInfo.isNew)];case 2:b.sent(),b.label=3;case 3:return[2]}})})},t.prototype.tryRemoveUnchangedNewCalculation=function(r,s){return(0,x.__awaiter)(this,void 0,void 0,function(){return(0,x.__generator)(this,function(d){switch(d.label){case 0:return!s.calculationInfo.isNew||!r||r.doCommit&&_.isEmpty(r.newInvalidFormula)&&!_.isEmpty(r.newExpression)?[3,3]:[4,this.lazyScopeProvider.get(Ee.w)];case 1:return[4,d.sent().removeVisualCalculation(this.visualContainer,s.queryName)];case 2:d.sent(),d.label=3;case 3:return[2]}})})},t.prototype.getName=function(r,s){if(_.isEmpty(r)){var l=(0,de.Xf)(this.visualContainer);return le.Fo(l,s)}return r},t.\u0275fac=function(s){return new(s||t)(m.\u0275\u0275inject($e.D),m.\u0275\u0275inject(Ne.e),m.\u0275\u0275inject(Ce.o),m.\u0275\u0275inject(ct.J),m.\u0275\u0275inject(Le.H),m.\u0275\u0275inject(he.w),m.\u0275\u0275inject(at.r),m.\u0275\u0275inject(m.NgZone))},t.\u0275prov=m.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(it.e)},Ge=n(78384),pt={provide:Be.$d,useClass:function(){function o(t){this.canvasZoomService=t}return o.prototype.getZoomLevel=function(){var t=this.canvasZoomService.getCurrentZoomLevel();return f.fF.assert(function(){return t>0},"ZoomLevel should greater than 0"),this.canvasZoomService.getCurrentZoomLevel()},o.\u0275fac=function(r){return new(r||o)(m.\u0275\u0275inject(Ge.w))},o.\u0275prov=m.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}()},Oe=n(63708),we=n(68405),a=n(13080),i=n(49642),u=n(58295),c=function(o){return o[o.None=0]="None",o[o.Rows=1]="Rows",o[o.Columns=2]="Columns",o}({}),y=function(){function o(t){this.selects=t,this.containsRows=!1,this.containsColumns=!1,this.referencedItems=new Set}return o.prototype.withRestartToken=function(t){return this},o.prototype.withPrimaryWindowExpansion=function(t){return this},o.prototype.withDataVolume=function(t){return this},o.prototype.withIncludeEmptyGroups=function(t){return this},o.prototype.withHighlightFilter=function(t){return this},o.prototype.withGroupBy=function(t){return this},o.prototype.withPrimaryGrouping=function(t,r,s,l,d,p){return this.containsValidAxisGroup(t)&&(this.containsRows=!0),this},o.prototype.withPrimaryGroupingNestedByRole=function(t,r,s,l,d,p,v){return this.withPrimaryGrouping(t,r,s,l,d,p)},o.prototype.withPrimaryExpansion=function(t){return this},o.prototype.withPrimarySynchronization=function(t){return this},o.prototype.withPrimaryGroupingNested=function(t,r,s,l,d){return this.containsValidAxisGroup(t)&&(this.containsRows=!0),this},o.prototype.withSecondaryGrouping=function(t,r,s,l,d){return this.containsValidAxisGroup(t)&&(this.containsColumns=!0),this},o.prototype.withSecondaryGroupingNestedByRole=function(t,r,s,l,d,p){return this.withSecondaryGrouping(t,r,s,l,d)},o.prototype.withSecondaryExpansion=function(t){return this},o.prototype.withSecondaryGroupingNested=function(t,r,s,l,d){return this.containsValidAxisGroup(t)&&(this.containsColumns=!0),this},o.prototype.withCurrentInnermostGrouping=function(t,r,s){return this},o.prototype.withCurrentInnermostPrimaryGrouping=function(t,r,s,l){return this},o.prototype.withPrimaryDataReduction=function(t){return this},o.prototype.withScopedDataReduction=function(t,r){return this},o.prototype.withSecondaryDataReduction=function(t){return this},o.prototype.withIntersectionDataReduction=function(t){return this},o.prototype.withTopLevelAggregates=function(t){return this},o.prototype.withAdditionalProjections=function(t){return this},o.prototype.withRolesWithHierarchicalGroupingSupport=function(t){return this},o.prototype.toQueryShape=function(t){var r=c.None;return this.containsRows&&(r|=c.Rows),this.containsColumns&&(r|=c.Columns),r},o.prototype.containsValidAxisGroup=function(t){if(_.isEmpty(t))return!1;for(var r=0,s=t;r<s.length;r++){var l=s[r];if(this.referencedItems.has(l.queryName))return!0;var d=(0,q.rC)(this.selects,l.queryName);if(!(0,u.k)(d.expr))return this.referencedItems.add(l.queryName),!0}return!1},o}(),M=n(453),z=n(29866),J=n(39665),ft=n(7557),ht=n(13702),re=n(906),Pe={provide:Be.Pm,useClass:function(){function o(t,r,s,l,d,p,v,b,F,C,g){this.visualCalcEagerService=t,this.featureSwitchService=r,this.localizationService=s,this.telemetryService=l,this.visualPluginService=d,this.conceptualSchemaProxy=p,this.dataSources=v,this.displayNameService=b,this.sortService=F,this.transformPluginService=C,this.dataReaders=g}return o.prototype.setVisualContainer=function(t){this.visualContainer=t},o.prototype.init=function(t){},o.prototype.reset=function(){},o.prototype.getCalculationObject=function(){return this.findCalculationObject()},o.prototype.findCalculationObject=function(t){var r=this.visualCalcEagerService.getCurrentEditingContext();if(null==r)return{name:"",expression:"",calculationType:Oe.eN.VisualCalculation,calculationSyntaxType:Oe.Up.Formula};var s=r.calculationInfo.isNew,l=(0,de.Xf)(this.visualContainer),d=le.zd(l,r);return{name:le.Fo(l,r.queryName),expression:d,calculationType:Oe.eN.VisualCalculation,calculationSyntaxType:Oe.Up.Formula,isNew:s}},o.prototype.getDaxModeConfigInputs=function(t){return(0,x.__awaiter)(this,void 0,void 0,function(){var r,s,l,d;return(0,x.__generator)(this,function(p){switch(p.label){case 0:return r=this.visualCalcEagerService.getCurrentEditingContext(),s=(0,de.Xf)(this.visualContainer),l=le.Oq(s,r?.queryName),[4,this.getVisualAxes()];case 1:return d=p.sent(),[2,{serializableModel:le.qN(l),wireDataSourceInfo:t,axes:d}]}})})},o.prototype.getVisualAxes=function(){return(0,x.__awaiter)(this,void 0,void 0,function(){var t,r,s,l,d,p,v,b,F,C,g,j,W,ce,ie,Y;return(0,x.__generator)(this,function(Bt){switch(Bt.label){case 0:return r=(t=this.visualContainer.config.singleVisual).visualType,s={displayNameService:this.displayNameService,featureSwitchService:this.featureSwitchService,localizationService:this.localizationService,sortService:this.sortService,telemetryService:this.telemetryService,transformPluginService:this.transformPluginService,visualPluginService:this.visualPluginService},l=this.dataSources.get(),[4,this.conceptualSchemaProxy.get(l)];case 1:return d=Bt.sent(),p=(0,we.W5)(l,t.query&&t.query.defn),_.isEmpty(p)?[2,[]]:(v=this.dataReaders.queryGenerator(p),b=this.visualPluginService.capabilities(t.visualType).visualShapeDataViewMappings,!(F=(0,M.p0)(t,r,d,v,s,void 0,b,void 0,_.noop))||F.error?[2,[]]:(C=F.compiled)?(g=(0,M.Go)(C.mappings),W=(0,i.Jz)(j=C.query.defn),ce=(0,a.lr)(g,W),ie=j.select(),Y=(0,i.cd)(function(){return new y(ie)},W,ce.mapping,ie,C.additionalProjections),[2,this.convertVisualAxesTypesToStringArray(Y)]):[2,[]])}})})},o.prototype.convertVisualAxesTypesToStringArray=function(t){var r=[];return t&c.Rows&&r.push("ROWS"),t&c.Columns&&r.push("COLUMNS"),r},o.\u0275fac=function(r){return new(r||o)(m.\u0275\u0275inject(he.w),m.\u0275\u0275inject(S.vZ),m.\u0275\u0275inject(Ce.o),m.\u0275\u0275inject(O.y0),m.\u0275\u0275inject(z.D),m.\u0275\u0275inject(H.i),m.\u0275\u0275inject(N.D),m.\u0275\u0275inject(ht.O),m.\u0275\u0275inject(re.K),m.\u0275\u0275inject(J.y),m.\u0275\u0275inject(ft.A))},o.\u0275prov=m.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}()},Fe=n(56083),Ke=function(){function o(t,r){this.localizationService=t,this.tutorialService=r}return o.prototype.showTutorial=function(){var t=this.createVisualCalcTutorial();this.tutorialService.startTutorial(t)},o.prototype.createVisualCalcTutorial=function(){var t,r="VisualCalcTemplateButton",s="VisualCalcEditInFormulaBar";return{itemKeys:[r,s],items:(t={},t[r]=this.createTemplateModelItem(r),t[s]=this.createFormulaBarModelItem(s),t),isSequentialTutorial:!0}},o.prototype.createTemplateModelItem=function(t){var r='[data-unique-id="formula-bar-template-button"]';return{title:this.localizationService.get("VisualCalcTeachingCallout_Template_Title"),text:this.localizationService.get("VisualCalcTeachingCallout_Template_Description"),buttonLabel:this.localizationService.get("Next_ButtonText"),dataStoreKey:t,canShow:function(){return!!$(r)},attachTo:function(){return $(r)},preferredOrientation:"right",customClass:"trident no-icon big-popup",modalButtonClassOverride:"ok-btn white-btn",overrideCancelWithClose:!0,closeOnBackdropClick:!0}},o.prototype.createFormulaBarModelItem=function(t){var r=".formulaBarEditorContainer";return{title:this.localizationService.get("VisualCalcTeachingCallout_FormulaBar_Title"),text:this.localizationService.get("VisualCalcTeachingCallout_FormulaBar_Description"),buttonLabel:this.localizationService.get("Next_ButtonText"),dataStoreKey:t,canShow:function(){return!!$(r)},attachTo:function(){return $(r)},arrowOffset:{top:0,left:500},offset:{top:0,left:-500},preferredOrientation:"bottom",customClass:"trident no-icon big-popup",modalButtonClassOverride:"ok-btn white-btn",overrideCancelWithClose:!0,closeOnBackdropClick:!0}},o.\u0275fac=function(r){return new(r||o)(m.\u0275\u0275inject(Ce.o),m.\u0275\u0275inject(Fe.yU))},o.\u0275prov=m.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),vt=n(11934),Et=n(19086),bt=n(64018),xt=["formulaBar"],Mt=["detailVisual"];function St(o,t){if(1&o&&m.\u0275\u0275element(0,"outline-overlay-lazy",8),2&o){var r=m.\u0275\u0275nextContext();m.\u0275\u0275property("regionOutlinesData",r.regionOutlinesData)}}var Ot=function(){return{formulaBarParentClass:".visualCalcEditor",expandScaleFactor:.5,expandOffet:0,fullyExpandedTooltip:"Formula_Bar_ExpandToMultiLine"}},Pt=function(o){function t(r,s,l,d,p,v,b,F,C){var g=o.call(this)||this;return g.behaviourService=r,g.intellisenseModelService=s,g.featureSwitchService=l,g.visualCalcEagerService=d,g.visualCalcDaxTemplateService=p,g.lazyScopeProvider=v,g.visualCalcTutorialService=b,g.subSelectionOutlineManager=F,g.visualContainerSubSelectionHostServiceFactory=C,g.visualHTMLElementChanged=new m.EventEmitter,g.templateSelected=g.createEventAdapter(),g.visualCalculationTemplates=g.visualCalcDaxTemplateService.getTemplates(),g.enableSubSelection=g.featureSwitchService.featureSwitches.enableCalculationHighlighting,g.enableSubSelection&&(g.subSelectionHostService=g.visualContainerSubSelectionHostServiceFactory.create(),g.regionOutlinesData={regionOutlines$:g.subSelectionOutlineManager.getRegionOutlines$()}),g}return(0,x.__extends)(t,o),Object.defineProperty(t.prototype,"_detailVisualElementRef",{set:function(s){var l=s?.nativeElement,d=l!==this.detailVisualElement;this.detailVisualElement=l,d&&this.visualHTMLElementChanged.emit(l)},enumerable:!1,configurable:!0}),t.prototype.ngAfterViewInit=function(){var r=this,s=(0,_e.T)((0,Ve.R)(this.formulaBar.nativeElement.querySelector(".formulaBarEditorMain"),"click"),(0,Ve.R)(this.formulaBar.nativeElement.querySelector(".formulaBarEditorMain"),"keydown").pipe((0,ve.h)(function(d){return"Enter"===d.key}))),l=(0,_e.T)(this.visualCalcEagerService.onEditContextChange$(),this.templateSelected.$).pipe((0,ee.R)(this.onDestroy$));this.visualCalcEagerService.onViewContextChanged$().pipe((0,ee.R)(this.onDestroy$),(0,Ye.b)(function(){return ze.IK.focus(r.formulaBar.nativeElement.querySelector(".formulaBarEditorMain"))}),(0,Ie.w)(function(){return s.pipe((0,ee.R)(l),(0,qe.q)(1))})).subscribe(function(){return(0,x.__awaiter)(r,void 0,void 0,function(){return(0,x.__generator)(this,function(p){switch(p.label){case 0:return[4,this.lazyScopeProvider.get(Ee.w)];case 1:return[4,p.sent().enterVisualCalcEditingModeWithPlaceHolder(this.visualContainer,"Custom")];case 2:return p.sent(),[2]}})})}),this.visualCalcTutorialService.showTutorial()},t.prototype.ngOnInit=function(){var r=this;this.behaviourService.setVisualContainer(this.visualContainer),this.intellisenseModelService.setVisualContainer(this.visualContainer),this.hostServices=this.parentHostServices,this.enableSubSelection&&(this.hostServices=(0,tt.ED)(this.parentHostServices,function(s){s.getSubSelectionService=function(){return r.getVisualSubSelectionHostService()}}),this.subSelectionOutlineManager.registerVisualContainer(this.visualContainer.name,this.subSelectionHostService.regionOutlines$,"annotation"))},t.prototype.ngOnDestroy=function(){return this.enableSubSelection&&this.subSelectionOutlineManager.deregisterVisualContainer(this.visualContainer.name,"annotation"),o.prototype.ngOnDestroy.call(this)},t.prototype.onRightClick=function(r){r.stopPropagation()},t.prototype.getVisualSubSelectionHostService=function(){var r=this;return{clearAllRegionOutlines:function(){return r.subSelectionHostService.clearAllRegionOutlines()},getAllRegionOutlines:function(){return r.subSelectionHostService.getAllRegionOutlines()},getRegionOutline:function(l){return r.subSelectionHostService.getRegionOutline(l)},updateRegionOutlines:function(l){var d,p,v=null===(d=r.detailVisualComponent)||void 0===d?void 0:d.getVisualComponentBoundingClientRect();v&&r.subSelectionHostService.updateVisualRegionOutlines(l,null===(p=r.detailVisualElement)||void 0===p?void 0:p.getBoundingClientRect(),v,!1)}}},t.\u0275fac=function(s){return new(s||t)(m.\u0275\u0275directiveInject(Be.n9),m.\u0275\u0275directiveInject(Be.Pm),m.\u0275\u0275directiveInject(S.vZ),m.\u0275\u0275directiveInject(he.w),m.\u0275\u0275directiveInject(ye),m.\u0275\u0275directiveInject(Le.H),m.\u0275\u0275directiveInject(Ke),m.\u0275\u0275directiveInject(Ae.g),m.\u0275\u0275directiveInject(vt._))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["visual-calc-editor"]],viewQuery:function(s,l){if(1&s&&(m.\u0275\u0275viewQuery(xt,5,m.ElementRef),m.\u0275\u0275viewQuery(Mt,5,m.ElementRef),m.\u0275\u0275viewQuery(Re.X,5)),2&s){var d=void 0;m.\u0275\u0275queryRefresh(d=m.\u0275\u0275loadQuery())&&(l.formulaBar=d.first),m.\u0275\u0275queryRefresh(d=m.\u0275\u0275loadQuery())&&(l._detailVisualElementRef=d.first),m.\u0275\u0275queryRefresh(d=m.\u0275\u0275loadQuery())&&(l.detailVisualComponent=d.first)}},inputs:{visualContainer:"visualContainer",themeCollection:"themeCollection",viewport:"viewport",parentHostServices:"parentHostServices",detailVisualSpinnerActionCallback:"detailVisualSpinnerActionCallback"},outputs:{visualHTMLElementChanged:"visualHTMLElementChanged"},features:[m.\u0275\u0275ProvidersFeature([et.B,We,pt,De.Dz,Pe,Ne.e,Ke,Ae.g]),m.\u0275\u0275InheritDefinitionFeature],decls:8,vars:16,consts:[["data-automation-type","visualCalcEditor","role","document",1,"visualCalcEditor",3,"contextmenu"],["visualCalcEditor",""],[3,"isActive","autoHide","expandCollapseConfig","implicitEndEditingOnBlur","navMode","shouldAlwaysEnableCancelButton","daxTemplates","templateSelected"],["formulaBar",""],[1,"visualWithOutlinesOverlay"],["data-automation-type","detailVisual",3,"inVisualCalcMode","parentHostServices","visualContainer","themeCollection","viewport","detailVisualSpinnerActionCallback","applyUIThemeToVisualModern"],["detailVisual",""],["class","outlinesOverlayContainer",3,"regionOutlinesData",4,"ngIf"],[1,"outlinesOverlayContainer",3,"regionOutlinesData"]],template:function(s,l){1&s&&(m.\u0275\u0275elementStart(0,"div",0,1),m.\u0275\u0275listener("contextmenu",function(p){return l.onRightClick(p)}),m.\u0275\u0275elementStart(2,"formula-bar",2,3),m.\u0275\u0275listener("templateSelected",function(){return l.templateSelected.fn()}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(4,"div",4),m.\u0275\u0275element(5,"detail-visual",5,6),m.\u0275\u0275template(7,St,1,1,"outline-overlay-lazy",7),m.\u0275\u0275elementEnd()()),2&s&&(m.\u0275\u0275advance(2),m.\u0275\u0275property("isActive",!0)("autoHide",!1)("expandCollapseConfig",m.\u0275\u0275pureFunction0(15,Ot))("implicitEndEditingOnBlur",!1)("navMode",void 0)("shouldAlwaysEnableCancelButton",!1)("daxTemplates",l.visualCalculationTemplates),m.\u0275\u0275advance(3),m.\u0275\u0275property("inVisualCalcMode",!0)("parentHostServices",l.hostServices)("visualContainer",l.visualContainer)("themeCollection",l.themeCollection)("viewport",l.viewport)("detailVisualSpinnerActionCallback",l.detailVisualSpinnerActionCallback)("applyUIThemeToVisualModern",!0),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngIf",l.enableSubSelection))},dependencies:[h.NgIf,Re.X,Et.P,bt.L],styles:[".visualCalcEditor[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%;overflow:visible;flex-grow:1;box-sizing:border-box;border-width:10px 10px 0 10px;border-style:solid;border-color:var(--colorNeutralStroke1);background-color:var(--colorNeutralBackground1)}.visualCalcEditor[_ngcontent-%COMP%]   .visualWithOutlinesOverlay[_ngcontent-%COMP%]{position:relative;flex-basis:0;flex-grow:1;overflow:hidden;display:flex}.visualCalcEditor[_ngcontent-%COMP%]   .visualWithOutlinesOverlay[_ngcontent-%COMP%]   detail-visual[_ngcontent-%COMP%]{flex:1;height:100%;z-index:0}.visualCalcEditor[_ngcontent-%COMP%]   .visualWithOutlinesOverlay[_ngcontent-%COMP%]   .outlinesOverlayContainer[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;box-sizing:border-box;z-index:1;pointer-events:none;background:transparent}"]}),t}(He.w),_t=n(94419),gt=n(46135),Ft=function(){function o(t,r,s,l,d,p,v,b,F,C,g){this.conceptualSchemaProxy=t,this.dataSources=r,this.vcEagerService=s,this.visualAuthoring=l,this.visibilityService=d,this.panesVisibilityService=p,this.featureSwitchService=v,this.visualAuthoringOperationService=b,this.certifiedEventsService=F,this.telemetryService=C,this.explorationCapabilitiesService=g}return o.prototype.enterVisualCalcMode=function(t,r,s,l){return(0,x.__awaiter)(this,void 0,void 0,function(){var d;return(0,x.__generator)(this,function(v){switch(v.label){case 0:return 16!==t.visibility&&(t.config.singleVisual.autoSelectVisualType=!1),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return d=v.sent(),[4,this.visualAuthoring.ensureNativeReferenceName(d,t)];case 2:return v.sent(),this.panesVisibilityService.closePane("quickMeasures"),this.featureSwitchService.featureSwitches.onObject&&this.panesVisibilityService.setPaneExpansion("build",!0,!0),_.isEmpty(r)?[4,this.enterVisualCalcEditingModeWithPlaceHolder(t,"Custom",void 0,void 0,s,l)]:[3,4];case 3:return v.sent(),[3,5];case 4:this.vcEagerService.enterEditMode(r,"Custom",!1),v.label=5;case 5:return this.visibilityService.set(t,16),[2]}})})},o.prototype.updateVisualCalculation=function(t,r,s,l,d){return(0,x.__awaiter)(this,void 0,void 0,function(){var p,v,F,C;return(0,x.__generator)(this,function(g){switch(g.label){case 0:return C=(0,le.dQ)(t,l),p=C.fieldIndex,v=C.role,f.fF.assert(function(){return p>=0},"Query name of field doesn't exist"),[4,this.visualAuthoring.updateVisualCalculation({visualContainer:t,fieldIndex:p,role:v,name:r,expression:s,shouldUnhide:d,dataType:void 0},d)];case 1:return F=g.sent(),this.certifiedEventsService.logStandardizedFeatureEvent({correlationId:this.telemetryService.root.id,featureName:"VisualCalculationSubmitted",activityName:he.f,activityStatus:"Succeeded",resultCode:"",activityAttributes:{initialCreation:d}}),[2,F]}})})},o.prototype.removeVisualCalculation=function(t,r){return(0,x.__awaiter)(this,void 0,void 0,function(){var s,l,d,p;return(0,x.__generator)(this,function(v){switch(v.label){case 0:return p=(0,le.dQ)(t,r),s=p.fieldIndex,l=p.role,f.fF.assert(function(){return s>=0},"Query name of field doesn't exist"),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return d=v.sent(),[2,this.visualAuthoringOperationService.removeFieldFromRole({role:l,projOptions:{fieldIndex:s}},d,t)]}})})},o.prototype.enterVisualCalcEditingModeWithPlaceHolder=function(t,r,s,l,d,p){return(0,x.__awaiter)(this,void 0,void 0,function(){var v,b,F,C,g,j;return(0,x.__generator)(this,function(W){switch(W.label){case 0:return v=(0,de.Xf)(t),b=(0,le.ND)(v,l),F=this.dataSources.get(),C=(0,_t.YU)(b,"BLANK()"),g=!1,null==d?[3,2]:[4,this.visualAuthoring.addFieldInRole(C,d,F,t,void 0,void 0,void 0,!0,!0,p)];case 1:return g=W.sent(),[3,4];case 2:return[4,this.visualAuthoring.addFieldToVisual(C,F,t,"VisualCalculationMode",!0,!0,p)];case 3:g=W.sent(),W.label=4;case 4:return g&&(j=(0,le.oG)((0,de.Xf)(t),b),this.vcEagerService.enterEditMode(j,r,!0,s)),[2,g]}})})},o.prototype.getVisualCalcCreationInfo=function(t,r,s){var l,d;return(0,x.__awaiter)(this,void 0,void 0,function(){var p,F;return(0,x.__generator)(this,function(g){switch(g.label){case 0:return p=this.explorationCapabilitiesService.getCapabilities(),p?.disableVisualCalcAuthoring?[2,{supportVisualCalcCreation:!1}]:[4,this.vcEagerService.canSupportVisualCalc(t)];case 1:return g.sent()?(null===(d=null===(l=t?.config)||void 0===l?void 0:l.singleVisual)||void 0===d?void 0:d.autoSelectVisualType)?[2,{supportVisualCalcCreation:!0,tooltip:"NewVisualCalc"}]:!(F=_.find(r.dataRoles,function(j){return j.name===s}))||F.kind!==gt.DW.Measure&&F.kind!==gt.DW.GroupingOrMeasure?[2,{supportVisualCalcCreation:!1}]:[2,{supportVisualCalcCreation:!0,tooltip:"NewVisualCalc"}]:[2,{supportVisualCalcCreation:!1}]}})})},o.\u0275fac=function(r){return new(r||o)(m.\u0275\u0275inject(H.i),m.\u0275\u0275inject(N.D),m.\u0275\u0275inject(he.w),m.\u0275\u0275inject(be.$8),m.\u0275\u0275inject(pe.w),m.\u0275\u0275inject(A.r),m.\u0275\u0275inject(S.vZ),m.\u0275\u0275inject(P.Q),m.\u0275\u0275inject(O.ly),m.\u0275\u0275inject(O.y0),m.\u0275\u0275inject(U.U))},o.\u0275prov=m.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),Tt=[{type:Pt,componentId:"VisualCalcEditorComponentId"}],Ct={provide:"VisualCalcService",useFactory:yt,deps:[H.i,N.D,he.w,be.$8,pe.w,A.r,S.vZ,P.Q,O.ly,O.y0,ge.t,U.U]};function yt(o,t,r,s,l,d,p,v,b,F,C,g){var j=new Ft(o,t,r,s,l,d,p,v,b,F,g);return C.resolve(j)}var Vt=function(){function o(){}return o.\u0275fac=function(r){return new(r||o)},o.\u0275mod=m.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=m.\u0275\u0275defineInjector({providers:[Ct,ye],imports:[h.CommonModule,w.J,L.u5,k.j,te.N.withManifests(Tt),ne.v,oe.U,K.p]}),o}()},64018:function(me,G,n){n.d(G,{L:function(){return Oe}});var h=n(81337),L=n(15903),O=n(81892),H="padding-left",N="padding-right",A="padding-top",U="padding-bottom",P="margin-left",w="margin-right",S="margin-top",k="margin-bottom",K="border-left-width",te="border-right-width",ne="border-top-width",oe="border-bottom-width";function I(a,i){return 1===i?parseInt(a.css(H),10)+parseInt(a.css(N),10):parseInt(a.css(A),10)+parseInt(a.css(U),10)}function f(a,i){return 1===i?parseInt(a.css(P),10)+parseInt(a.css(w),10):parseInt(a.css(S),10)+parseInt(a.css(k),10)}function B(a,i){return 1===i?parseInt(a.css(K),10)+parseInt(a.css(te),10):parseInt(a.css(ne),10)+parseInt(a.css(oe),10)}function T(a){return parseInt(a.css("minWidth"),10)}function X(a,i,u){for(var c=f(a,u),y=$("html")[0],M=a.parent();M.length>0&&M[0]!==y&&M[0]!==i[0];)c=c+I(M,u)+B(M,u)+f(M,u),M=M.parent();return M[0]===i[0]?c=c+I(M,u)+B(M,u):0}var D=n(26124),e=n(50423),se=n(47786),Q=n(74249),q=n(62458),E=n(2951),m=n(25261),Ce=n(1685),fe=n(30794),ye=n(35510),Qe=n(82762),Ze=n(59017),Xe=n(77526),Je=n(14172),Te=n(83317),xe=n(64647),he=n(83309),x=n(15783),_e=n(65181),Ve=n(85270),ve=n(77476),ee=n(17174),Ye=n(59968),Ie=n(36858),qe=n(45916),Be=n(698),et=n(35756),De=n(20551),Ne=n(64716),Re=n(85721),ze=n(74913),tt=n(4715),He=n(21571),Ae=n(73221),Ee=n(4633),Me=n(64560),nt=n(25512),Se=n(48787),ot=n(5467),je=n(85102);function rt(a,i){if(1&a){var u=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",1),e.\u0275\u0275listener("click",function(y){e.\u0275\u0275restoreView(u);var M=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(M.showTemplatesMenu(y))}),e.\u0275\u0275pipe(1,"localize"),e.\u0275\u0275element(2,"tri-svg-icon",2),e.\u0275\u0275elementEnd()}2&a&&e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(1,1,"Visual_Calculation_Template_Button_Tooltip"))}var it=function(a){function i(u,c,y,M){var z=a.call(this)||this;return z.elementRef=u,z.pbiMenuService=c,z.localizationService=y,z.telemetryService=M,z.selectedTemplate=new e.EventEmitter,z.showButton$=new ye.X(!1),z}return(0,h.__extends)(i,a),i.prototype.ngOnInit=function(){var u=this;this.changes$("daxTemplates").pipe((0,Te.R)(this.onDestroy$)).subscribe(function(c){u.createTemplateMenu(c)})},i.prototype.showTemplatesMenu=function(u){var c=this;u.preventDefault();var y=this.templatingMenu;null!=y&&0!==y.items.length&&this.pbiMenuService.open({menu:y,origin:this.elementRef.nativeElement,flexibleConnectedPositions:[(0,nt.Oq)(0,0)],closeOnButtonClick:!0,menuMode:Me.Kb.Compact}).onButtonClick$.pipe((0,Se.q)(1)).subscribe(function(z){var J=z.data;c.selectedTemplate.emit(J),c.telemetryService.logEvent(tt.Zs,{templateName:J.capabilities.name})})},i.prototype.createTemplateMenu=function(u){var c=this,y=_.map(u,function(M){var z=M.capabilities;return{type:Me.iB.Button,id:z.name,text:(0,He.G)(z.displayName,c.localizationService),tooltip:(0,He.G)(z.description,c.localizationService),data:M}});this.templatingMenu={items:y},this.showButton$.next(y.length>0)},i.\u0275fac=function(c){return new(c||i)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(ot.o),e.\u0275\u0275directiveInject(_e.o),e.\u0275\u0275directiveInject(Ee.y0))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["template-button"]],inputs:{daxTemplates:"daxTemplates"},outputs:{selectedTemplate:"selectedTemplate"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","templateButton","tabindex","0",3,"pbiTooltip","click",4,"ngIf"],["tabindex","0",1,"templateButton",3,"pbiTooltip","click"],["tri-svg-icon-24","","name","math_formula_20_regular","sprite","visual-calc-icons"]],template:function(c,y){1&c&&(e.\u0275\u0275template(0,rt,3,3,"button",0),e.\u0275\u0275pipe(1,"async")),2&c&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,y.showButton$))},dependencies:[ve.NgIf,Ie.V,ze.M,ve.AsyncPipe,je.F],styles:[".templateButton[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:24px;background-color:transparent}.templateButton[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2)}.templateButton[_ngcontent-%COMP%]:hover{background:var(--colorNeutralBackground1Hover)}.templateButton[_ngcontent-%COMP%]:hover   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Hover)}.templateButton[_ngcontent-%COMP%]:active   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Pressed)}"]}),i}(Ae.w),ke=["monacoEditorHostContainer"];function at(a,i){if(1&a){var u=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"monaco-editor-host",21),e.\u0275\u0275listener("initialized",function(){e.\u0275\u0275restoreView(u);var z=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(z.onMonacoEditorInitialized())})("tabFocusMode",function(z){e.\u0275\u0275restoreView(u);var J=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(J.onTabFocusModeChanged(z))})("onContentChanged",function(z){e.\u0275\u0275restoreView(u);var J=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(J.onContentChanged(z))})("onContentHeightChanged",function(z){e.\u0275\u0275restoreView(u);var J=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(J.onContentHeightChanged(z))})("onFocus",function(){e.\u0275\u0275restoreView(u);var z=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(z.onEditorFocus())}),e.\u0275\u0275elementEnd()}if(2&a){var c=i.ngIf,y=e.\u0275\u0275nextContext();e.\u0275\u0275property("selection",y.editorHost.selection)("isReadOnly",y.isReadOnly)("formulaText",y.editorHost.text)("languageOptions",c)("hidden",!y.isEditorEnabled)}}function st(a,i){if(1&a){var u=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",22),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(u);var y=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(y.toggleTabMovesFocus())}),e.\u0275\u0275pipe(1,"localize"),e.\u0275\u0275elementEnd()}2&a&&e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(1,1,"Tab_Moves_Focus_Toggle"))}function de(a,i){if(1&a&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275element(1,"pbi-svg-use-symbol",24)(2,"tri-svg-icon",25)(3,"textarea",26),e.\u0275\u0275elementEnd()),2&a){var u=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("pbiTooltip",u.alertText)("ngModel",u.alertText),e.\u0275\u0275attribute("aria-label",u.alertText)}}function lt(a,i){if(1&a&&(e.\u0275\u0275elementStart(0,"tri-dropdown-trigger"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()),2&a){var u=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,e.\u0275\u0275pipeBind1(3,3,u.selectedEditModeOption$).displayName)," ")}}function ut(a,i){if(1&a&&(e.\u0275\u0275elementStart(0,"tri-dropdown-item",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275elementEnd()),2&a){var u=i.$implicit;e.\u0275\u0275property("value",u),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,u.displayName)," ")}}var $e="monaco-editor-host",Ue=".formulaBarButtons",We=".formulaBarController",pt=[".formulaBarEditorContainer",Ue,"ribbon [data-unique-id='clipboardGroupMlr'], ribbon [data-unique-id='clipboardGroupSlr'], .ms-Callout #FlyoutMenuId","ribbon [data-automation-type='RibbonTab'][data-unique-id='home']"],Oe=function(){function a(i,u,c,y,M,z,J,ft,ht){var re=this;this.element=i,this.highContrastCssGenerationService=u,this.formulaBarService=c,this.localizationService=y,this.screenReaderService=M,this.formulaBarInteractionService=z,this.cdr=J,this.daxCapabilitiesService=ft,this.formulaBarZoomService=ht,this.catchOutsideClickEventCallBack=function(ue){return!1},this.implicitEndEditingOnBlur=!0,this.navMode="Group",this.daxTemplates=[],this.beginEdit=new e.EventEmitter,this.endEdit=new e.EventEmitter,this.templateSelected=new e.EventEmitter,this.editorHost={},this.formulaBarDropdownConfigurations=[],this.destroy$=new fe.xQ,this._dropdownOptions$=new ye.X(void 0),this._dropdownVisible$=new ye.X(!1),this._selectedEditModeOption$=new ye.X(void 0),this.onDocumentMouseDownCapture=function(ue){re.lastCapturedMousedownEvent=ue,we(ue.target)||re.formulaBarService.hasUnsavedChanges(re.getCurrentEditorText())&&ue.stopImmediatePropagation()},this.onDocumentClickCapture=function(ue){var Pe=re.lastCapturedMousedownEvent&&re.lastCapturedMousedownEvent.target;re.lastCapturedMousedownEvent=void 0;var Fe=!Pe||we(Pe),Ke=we(ue.target);Fe||Ke||re.catchOutsideClickEventCallBack(ue)||(re.formulaBarService.hasUnsavedChanges(re.getCurrentEditorText())&&(ue.stopPropagation(),ue.preventDefault()),re.onBlur())},this.triDropdownOptions={panelClass:O.Uu},this.expandedState=1,this.languageOptions$=(0,Qe.D)(this.daxCapabilitiesService.getCapabilities())}return Object.defineProperty(a.prototype,"selectedEditModeOption$",{get:function(){return this._selectedEditModeOption$},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"editMode$",{get:function(){return this._selectedEditModeOption$.pipe((0,Xe.x)(),(0,Je.U)(function(u){return u?.key}))},enumerable:!1,configurable:!0}),a.prototype.setEditMode=function(i){var u=this.formulaBarDropdownConfigurations.findIndex(function(c){return c.key===i});(0,se.hu)(u>-1,"Invalid calculation edit mode"),this._selectedEditModeOption$.next(this.formulaBarDropdownConfigurations[u])},Object.defineProperty(a.prototype,"editModeOptions$",{get:function(){return this._dropdownOptions$.asObservable()},enumerable:!1,configurable:!0}),a.prototype.setEditModeOptions=function(i){this._dropdownOptions$.next(i),this._selectedEditModeOption$.next(void 0)},Object.defineProperty(a.prototype,"showEditModeSelector$",{get:function(){return this._dropdownVisible$.asObservable()},enumerable:!1,configurable:!0}),a.prototype.showEditModeSelector=function(i){this._dropdownVisible$.next(i)},a.prototype.ngOnInit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var i=this;return(0,h.__generator)(this,function(u){switch(u.label){case 0:return this.initializeHighContrastRules(),this.isHidden=this.autoHide,this.setReadOnly(!0),(0,Ze.aj)([this._dropdownOptions$,this._dropdownVisible$]).pipe((0,Te.R)(this.destroy$)).subscribe(function(c){var M=c[1];i.formulaBarDropdownConfigurations=c[0],i.formulaDropdownWidth=M?T($(".dropdownContainer")):0,i.recalculateOffset(),i.onResize()}),[4,this.formulaBarService.setUICulture()];case 1:return u.sent(),[2]}})})},a.prototype.ngAfterViewInit=function(){var i=this;this.formulaBarService.registerFormulaBarControl(this),this.formulaBarInteractionService.registerFormulaBarInteractionControl(this),this.resizeObserver=new ResizeObserver(function(){window.requestAnimationFrame(function(){i.onResize()})}),this.resizeObserver.observe(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass))},a.prototype.ngOnDestroy=function(){$(this.element.nativeElement).off(We),$(this.monacoEditorHostContainer.nativeElement).off(We),this.destroy$.next(),this.destroy$.complete(),this.resizeObserver&&(this.resizeObserver.unobserve(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass)),this.resizeObserver.disconnect())},a.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert, formula-bar .formulaBar .formulaBarAlert .messageAlert","{ background-color: @backgroundColor !important; color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert","{ border: 1px solid @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarEditorContainer","{ background-color: @backgroundColor !important; }")},Object.defineProperty(a.prototype,"willCollapse",{get:function(){return 0===this.nextExpandCollapseState},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isEditorEnabled",{get:function(){return!!this.lastCommittedFormulaText||this.isEditing},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"formulaBarExpanderTooltip",{get:function(){var u,c="Formula_Bar_ExpandToFull";switch(this.nextExpandCollapseState){case 0:c="Formula_Bar_CollapseToSingleLine";break;case 1:c="Formula_Bar_ExpandToFit";break;case 2:c=null!==(u=this.expandCollapseConfig.fullyExpandedTooltip)&&void 0!==u?u:"Formula_Bar_ExpandToFull"}return this.localizationService.get(c)},enumerable:!1,configurable:!0}),a.prototype.setReadOnly=function(i){this.isReadOnly=i},a.prototype.onMonacoEditorInitialized=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var i,u,c;return(0,h.__generator)(this,function(y){switch(y.label){case 0:return this.monacoEditorInitialized=!0,i=$(this.element.nativeElement),u=function(a){return parseInt(a.css("min-height"),10)}(i),c=function(a){return parseInt(a.css("max-height"),10)}(i),this.monacoEditorUtility=new E.j0(this.textEditorHost.textEditor),[4,this.textEditorHost.registerActions(this.getKeyboardActions())];case 1:return y.sent(),this.textEditorHeightOffset=this.calculateTextEditorHeightOffset(),this.recalculateOffset(),this.textEditorFullExpandHeight=c-this.textEditorHeightOffset,this.textEditorCollapsedHeight=u-this.textEditorHeightOffset,this.targetEditorHeight=this.textEditorCollapsedHeight,this.onContentHeightChanged(this.textEditorHost.textEditor.getContentHeight()),this.onResize(),this.focusOnInitialized&&this.focus(),[2]}})})},a.prototype.calculateTextEditorHeightOffset=function(){var i=$(this.element.nativeElement);return X(i.find($e),i,0)},a.prototype.onTabFocusModeChanged=function(i){this.tabMovesFocus=i},a.prototype.updateEditorExpandedHeight=function(){var i,u,c=this.alertText?20:0,y=this.expandCollapseConfig.formulaBarParentClass,M=null!==(i=this.expandCollapseConfig.expandScaleFactor)&&void 0!==i?i:1,z=null!==(u=this.expandCollapseConfig.expandOffet)&&void 0!==u?u:-80,J=M*$(this.element.nativeElement).closest(y).height()+z;this.textEditorFullExpandHeight=J-this.textEditorHeightOffset-c},a.prototype.updateFormulaBarMaxHeight=function(){var i=this.alertText?20:0,u=1e7;0===this.expandedState?u=this.textEditorCollapsedHeight+this.textEditorHeightOffset+i:1===this.expandedState&&(u=this.targetEditorHeight+this.textEditorHeightOffset+i),q.fF.assertValue(u,"maxHeight"),$(this.element.nativeElement).css("max-height",u)},a.prototype.show=function(){this.isHidden&&(this.isHidden=!1,this.cdr.detectChanges())},a.prototype.hide=function(){this.isHidden||(this.isHidden=!0)},a.prototype.clear=function(){this.setCommittedFormulaBarText(""),this.autoHide&&this.hide()},a.prototype.setSelection=function(i){this.editorHost.selection=i,this.cdr.detectChanges()},a.prototype.showAlertMessage=function(i){i=i.replace(/\n/g,""),this.alertText=i,this.screenReaderService.alert(this.localizationService.format("Formula_Bar_Warning_Aria",i)),this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},a.prototype.toggleTabMovesFocus=function(){this.textEditorHost.toggleTabMovesFocus(),this.textEditorHost.focus()},a.prototype.hideAlert=function(){this.alertText=void 0,this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},a.prototype.setCommittedFormulaBarText=function(i){this.lastCommittedFormulaText=i,this.editorHost.text=i,this.cdr.detectChanges()},a.prototype.focus=function(){this.monacoEditorInitialized?(this.textEditorHost.focus(),this.cdr.detectChanges()):this.focusOnInitialized=!0},a.prototype.scrollTop=function(){this.monacoEditorInitialized&&this.textEditorHost.scrollTop()},a.prototype.copy=function(){this.textEditorHost.copy()},a.prototype.cut=function(){this.textEditorHost.cut()},a.prototype.paste=function(i){this.textEditorHost.paste(i)},a.prototype.resetModelTokens=function(i){this.textEditorHost.resetModelTokens(i)},a.prototype.isFormulaBarActive=function(){return this.isActive},a.prototype.onToggleExpandCollapse=function(){this.setExpandCollapseState(this.nextExpandCollapseState)},a.prototype.setExpandCollapseState=function(i){switch(i){case 0:this.collapse();break;case 1:this.fitToContent();break;case 2:this.fullExpand()}this.calculateNextExpandCollapseState()},a.prototype.calculateNextExpandCollapseState=function(){switch(this.expandedState){case 0:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?2:1;break;case 1:this.nextExpandCollapseState=this.editorContentHeight>=this.textEditorFullExpandHeight?0:this.editorContentHeight<=this.textEditorCollapsedHeight||this.isEditing?2:0;break;case 2:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?1:0;break;default:q.fF.assertNever(this.expandedState)}},a.prototype.fullExpand=function(){this.expandedState=2,this.updateEditorExpandedHeight(),this.layout(void 0,this.textEditorFullExpandHeight)},a.prototype.fitToContent=function(){this.expandedState=1,this.updateEditorExpandedHeight(),this.targetEditorHeight=Math.max(this.textEditorCollapsedHeight,Math.min(this.textEditorFullExpandHeight,this.editorContentHeight)),this.layout(void 0,this.targetEditorHeight)},a.prototype.collapse=function(){this.expandedState=0,this.layout(void 0,this.textEditorCollapsedHeight)},a.prototype.layout=function(i,u){this.updateFormulaBarMaxHeight(),this.monacoEditorInitialized&&this.textEditorHost.layout(i,u)},a.prototype.recalculateOffset=function(){var i,u=$(Ue),c=$(this.element.nativeElement),y=c.find($e);this.textEditorWidthOffset=X(y,c,1)+T(u)+f(u,1)+(null!==(i=this.formulaDropdownWidth)&&void 0!==i?i:0)},a.prototype.commitFormulaBarEdit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var i;return(0,h.__generator)(this,function(u){switch(u.label){case 0:return this.endFormulaEdit(),(i=this.getCurrentEditorText())===this.lastCommittedFormulaText?[3,2]:(this.lastCommittedFormulaText=i,[4,this.formulaBarService.onSubmit(i)]);case 1:return u.sent(),[3,4];case 2:return[4,this.formulaBarService.onSubmit(i)];case 3:u.sent(),u.label=4;case 4:return[2]}})})},a.prototype.onBlur=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(i){switch(i.label){case 0:return this.implicitEndEditingOnBlur?this.endFormulaEdit():(this.removeFocus(),this.removeCatchClickOutsideFormulaBar()),this.lastCommittedFormulaText=this.monacoEditorInitialized?this.getCurrentEditorText():"",[4,this.formulaBarService.onBlur(this.lastCommittedFormulaText)];case 1:return[2,i.sent()]}})})},a.prototype.removeFocus=function(){$(document.activeElement).blur(),$(document.body).focus()},a.prototype.onContentChanged=function(i){var u=this.monacoEditorUtility.getCursorPosition();this.formulaBarService.onContentChanged(this.monacoEditorUtility.getEditorText(),u.position,u.selectionStart,i)},a.prototype.onContentHeightChanged=function(i){this.editorContentHeight=i+2,(1===this.expandedState||0===this.expandedState&&this.isEditing)&&this.fitToContent(),this.calculateNextExpandCollapseState()},a.prototype.submit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(i){switch(i.label){case 0:return[4,this.commitFormulaBarEdit()];case 1:return i.sent(),[2]}})})},a.prototype.cancel=function(){this.endFormulaEdit(),this.formulaBarService.onCancel(this.lastCommittedFormulaText),this.autoHide&&this.hide()},a.prototype.onEditorFocus=function(){this.isEditorEnabled&&(this.isReadOnly||this.isEditing?this.implicitEndEditingOnBlur||this.catchClickOutsideFormulaBar():this.beginFormulaEdit(),this.formulaBarService.onEditorFocus())},a.prototype.catchClickOutsideFormulaBar=function(){document.body.addEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.addEventListener("click",this.onDocumentClickCapture,!0),document.body.addEventListener("contextmenu",this.onDocumentClickCapture,!0)},a.prototype.removeCatchClickOutsideFormulaBar=function(){document.body.removeEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.removeEventListener("click",this.onDocumentClickCapture,!0),document.body.removeEventListener("contextmenu",this.onDocumentClickCapture,!0)},a.prototype.endFormulaEdit=function(){this.isEditing=!1,this.removeFocus(),this.removeCatchClickOutsideFormulaBar(),this.endEdit.emit()},a.prototype.beginFormulaEdit=function(){this.isEditing=!0,this.catchClickOutsideFormulaBar(),this.beginEdit.emit()},a.prototype.onResize=function(){var i,u;if(this.monacoEditorInitialized){var c;2===this.expandedState?(this.updateEditorExpandedHeight(),c=this.textEditorFullExpandHeight):1===this.expandedState&&(this.updateEditorExpandedHeight(),c=Math.min(this.textEditorFullExpandHeight,this.targetEditorHeight));var y=this.element.nativeElement.getBoundingClientRect().width||1e3,M=null!==(u=null===(i=this.formulaBarZoomService)||void 0===i?void 0:i.getZoomLevel())&&void 0!==u?u:1;this.layout(y/M-this.textEditorWidthOffset,c)}},a.prototype.selectTemplate=function(i){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(u){switch(u.label){case 0:return[4,this.formulaBarService.onTemplateSelection(i)];case 1:return u.sent(),this.templateSelected.emit(),[2]}})})},a.prototype.insertTextAtCurrentCursor=function(i){this.textEditorHost.insertTextAtCurrentCursor(i)},a.prototype.getCurrentEditorText=function(){return this.textEditorHost.getText()},a.prototype.getHighlightedText=function(){return this.textEditorHost.getHighlightedText()},a.prototype.getKeyboardActions=function(){var i=this;return[{id:"formulaBar.find",label:"Find",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.CtrlF]],run:_.noop},{id:"formulaBar.findNext",label:"Find next",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.F3]],run:_.noop},{id:"formulaBar.findPrevious",label:"Find previous",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.CtrlF3]],run:_.noop},{id:"formulaBar.replace",label:"Replace",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.CtrlH]],run:_.noop},{id:"formulaBar.errorNavigator",label:"Error navigator",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.F8]],run:_.noop},{id:"formulaBar.escape",label:"Escape",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.Escape]],run:function(){var c=i.textEditorHost.textEditor.getSelections();c.length<=1?i.cancel():i.textEditorHost.textEditor.setSelection(c[0])},keybindingContext:"!".concat(E.B6,"&&!").concat(E.HW,"&&!").concat(E.s1)},{id:"formulaBar.submit",label:"Submit",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.CtrlEnter]],run:function(){i.submit()}},{id:"formulaBar.enter",label:"Enter",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.Enter]],run:function(){i.submit()},keybindingContext:"!".concat(E.HW)},{id:"formulaBar.toggleExpandCollapse",label:"Toggle expand collapse",keybindings:[this.textEditorHost.monacoKeybindingsMap[m.f.CtrlJ]],run:function(){i.onToggleExpandCollapse()}}]},a.\u0275fac=function(u){return new(u||a)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(xe.g),e.\u0275\u0275directiveInject(x.B),e.\u0275\u0275directiveInject(_e.o),e.\u0275\u0275directiveInject(he.g),e.\u0275\u0275directiveInject(Ve.l),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Q.r),e.\u0275\u0275directiveInject(L.$d,8))},a.\u0275cmp=e.\u0275\u0275defineComponent({type:a,selectors:[["formula-bar"]],viewQuery:function(u,c){if(1&u&&(e.\u0275\u0275viewQuery(ke,7,e.ElementRef),e.\u0275\u0275viewQuery(Ce.C,5)),2&u){var y=void 0;e.\u0275\u0275queryRefresh(y=e.\u0275\u0275loadQuery())&&(c.monacoEditorHostContainer=y.first),e.\u0275\u0275queryRefresh(y=e.\u0275\u0275loadQuery())&&(c.textEditorHost=y.first)}},hostVars:1,hostBindings:function(u,c){1&u&&e.\u0275\u0275listener("desktopUIResizeFormulaBar",function(){return c.onResize()}),2&u&&e.\u0275\u0275hostProperty("hidden",c.isHidden)},inputs:{autoHide:"autoHide",isActive:"isActive",catchOutsideClickEventCallBack:"catchOutsideClickEventCallBack",expandCollapseConfig:"expandCollapseConfig",implicitEndEditingOnBlur:"implicitEndEditingOnBlur",navMode:"navMode",shouldAlwaysEnableCancelButton:"shouldAlwaysEnableCancelButton",daxTemplates:"daxTemplates"},outputs:{beginEdit:"beginEdit",endEdit:"endEdit",templateSelected:"templateSelected"},decls:29,vars:42,consts:[["keyboard-shortcuts","ctrl-F6","focus-priority","11",1,"formulaBar",3,"hidden","on-resize"],[1,"formulaBarEditorContainer"],[1,"formulaBarEditor"],["tabindex","0",1,"formulaBarEditorMain",3,"keydown.enter"],["monacoEditorHostContainer",""],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus",4,"ngIf"],["data-unique-id","formula-bar-chevron",1,"formulaBarExpander",3,"disabled","pbiTooltip","click"],["tri-svg-icon-16","","name","chevron_down_16_regular"],[1,"accessibililtyMessages"],["class","message","localize","Tab_Moves_Focus",3,"pbiTooltip","click",4,"ngIf"],["class","formulaBarAlert",4,"ngIf"],[1,"formulaBarDropdown"],[1,"dropdownContainer",3,"compact","options","isDisabled","value","valueChange"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"formulaBarButtons"],["data-unique-id","formula-bar-cancel",1,"formulaBarCancel",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","dismiss_20_regular"],["data-unique-id","formula-bar-commit",1,"formulaBarCommit",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","checkmark_20_regular"],["data-unique-id","formula-bar-template-button",3,"daxTemplates","selectedTemplate"],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus"],["localize","Tab_Moves_Focus",1,"message",3,"pbiTooltip","click"],[1,"formulaBarAlert"],["symbolId","alert","sheet","filterPaneIcons",1,"imageAlert"],["tri-svg-icon-16","","name","dismiss_circle_16_filled"],["data-unique-id","formula-bar-alert","row","1","cols","1","readonly","","pbiTooltipPosition","below",1,"messageAlert",3,"pbiTooltip","ngModel"],[3,"value"]],template:function(u,c){1&u&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275listener("on-resize",function(){return c.onResize()}),e.\u0275\u0275pipe(1,"localize"),e.\u0275\u0275elementStart(2,"div",1)(3,"div",2)(4,"div",3,4),e.\u0275\u0275listener("keydown.enter",function(){return c.focus()}),e.\u0275\u0275template(6,at,1,5,"monaco-editor-host",5),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"button",6),e.\u0275\u0275listener("click",function(){return c.onToggleExpandCollapse()}),e.\u0275\u0275element(9,"tri-svg-icon",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",8),e.\u0275\u0275template(11,st,2,3,"button",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,de,4,3,"div",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"div",11),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275elementStart(15,"tri-dropdown",12),e.\u0275\u0275listener("valueChange",function(M){return c.setEditMode(M.key)}),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275template(17,lt,4,5,"tri-dropdown-trigger",13),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275template(19,ut,3,4,"tri-dropdown-item",14),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(21,"div",15)(22,"button",16),e.\u0275\u0275listener("click",function(){return c.cancel()}),e.\u0275\u0275pipe(23,"localize"),e.\u0275\u0275element(24,"tri-svg-icon",17),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(25,"button",18),e.\u0275\u0275listener("click",function(){return c.submit()}),e.\u0275\u0275pipe(26,"localize"),e.\u0275\u0275element(27,"tri-svg-icon",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"template-button",20),e.\u0275\u0275listener("selectedTemplate",function(M){return c.selectTemplate(M)}),e.\u0275\u0275elementEnd()()()),2&u&&(e.\u0275\u0275classProp("readonly",c.isReadOnly),e.\u0275\u0275property("hidden",c.isHidden||!c.monacoEditorInitialized),e.\u0275\u0275attribute("focus-nav-mode",c.navMode)("aria-label",e.\u0275\u0275pipeBind1(1,26,"Formula_Bar")),e.\u0275\u0275advance(2),e.\u0275\u0275classProp("hasAlert",c.alertText),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,28,c.languageOptions$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!c.monacoEditorInitialized||!c.isEditorEnabled)("pbiTooltip",c.formulaBarExpanderTooltip),e.\u0275\u0275advance(1),e.\u0275\u0275property("@chevron",c.nextExpandCollapseState),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",c.tabMovesFocus&&!c.isReadOnly&&c.isEditorEnabled),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!!c.alertText),e.\u0275\u0275advance(1),e.\u0275\u0275classProp("hideFormulaBarDropdown",!e.\u0275\u0275pipeBind1(14,30,c.showEditModeSelector$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("compact",!0)("options",c.triDropdownOptions)("isDisabled",c.isReadOnly)("value",e.\u0275\u0275pipeBind1(16,32,c.selectedEditModeOption$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(18,34,c.selectedEditModeOption$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(20,36,c.editModeOptions$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(23,38,"Cancel_ButtonText"))("disabled",c.shouldAlwaysEnableCancelButton?!c.monacoEditorInitialized:!c.isEditing||!c.monacoEditorInitialized),e.\u0275\u0275advance(3),e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(26,40,"Commit_ButtonText"))("disabled",!c.isEditing||!c.monacoEditorInitialized),e.\u0275\u0275advance(3),e.\u0275\u0275property("daxTemplates",c.daxTemplates))},dependencies:[ve.NgForOf,ve.NgIf,ee.Fj,ee.JJ,ee.On,Ye.X,Ce.C,Ie.V,qe.R,Be.O,et.q,De.M3,Ne.l,Re.q,De.ii,ze.M,it,ve.AsyncPipe,je.F],styles:['[_nghost-%COMP%]{--read-only-button-foreground: var(--fluent-theme-neutral-secondary-alt-color);--read-only-background: var(--fluent-theme-neutral-tertiary-color);--read-only-border-color: var(--fluent-theme-neutral-tertiary-color);--button-background: transparent;--button-foreground: var(--gray-180);--editor-container-border-color: var(--fluent-theme-neutral-tertia-color);--editor-container-background: var(--fluent-theme-white-color);--expander-foreground-hover: var(--fluent-theme-black-color);--accessibility-message-background: var(--fluent-theme-neutral-primary-color);--accessibility-message-foreground: var(--fluent-theme-white-color);--accessibility-message-background-focus: var(--fluent-theme-neutral-tertiary-alt-color);--alert-foreground: var(--fluent-theme-black-color);--alert-background: var(--fluent-theme-warning-background-color);--alert-border: none;--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--fluent-theme-neutral-tertiary-alt-color);--submit-cancel-buttons-background: var(--fluent-theme-white-color);--cancel-button-foreground: var(--fluent-theme-error-dark-color);--commit-button-foreground: var(--fluent-theme-success-icon-color);--gray-host-background: var(--gray-20);--gray-border-color: var(--gray-60);--gray-read-only-background: var(--gray-20);--gray-read-only-border: var(--gray-40);position:relative;padding:4px;min-height:36px;max-height:36px;width:100%;box-sizing:border-box;display:flex;flex-direction:column}[data-legacy-theming=false]   [_nghost-%COMP%]{--read-only-button-foreground: var(--colorNeutralForegroundDisabled);--read-only-background: var(--colorNeutralBackgroundDisabled);--read-only-border-color: var(--colorNeutralStrokeDisabled);--button-background: transparent;--button-foreground: var(--colorNeutralForeground1);--editor-container-border-color: var(--colorNeutralStroke1);--editor-container-background: var(--colorNeutralBackground1);--expander-foreground-hover: var(--colorNeutralStrokeFocus2);--accessibility-message-background: var(--colorCompoundBrandBackground);--accessibility-message-foreground: var(--colorNeutralForegroundOnBrand);--accessibility-message-background-focus: var(--colorCompoundBrandBackgroundHover);--alert-foreground: var(--colorNeutralForeground1);--alert-background: var(--colorDangerBackground1);--alert-border: 1px solid var(--colorDangerBorder1);--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--colorNeutralStroke1);--submit-cancel-buttons-background: var(--colorNeutralBackground1);--cancel-button-foreground: var(--colorDangerForeground1);--commit-button-foreground: var(--colorSuccessForeground1);--gray-host-background: var(--colorNeutralBackground3);--gray-border-color: var(--colorNeutralStroke2);--gray-read-only-background: var(--colorNeutralBackground3);--gray-read-only-border: var(--colorNeutralStrokeDisabled)}[hidden][_nghost-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]{flex-grow:1;cursor:default;box-sizing:border-box;display:flex}[_nghost-%COMP%]   .formulaBar[hidden][_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--read-only-button-foreground)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-color:var(--read-only-border-color);background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]{background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--button-background);color:var(--button-foreground)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:currentcolor}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   [disabled][_ngcontent-%COMP%]{opacity:.4}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{order:1;flex-grow:1;height:100%;display:flex;flex-direction:column;margin-left:3px;min-height:28px;box-sizing:border-box;border:1px solid var(--editor-container-border-color);background-color:var(--editor-container-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer.hasAlert[_ngcontent-%COMP%]{min-height:48px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;padding-top:2px;padding-right:21px;display:flex;flex-direction:column;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;background-color:transparent;-webkit-user-select:none}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;width:16px;height:16px;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus:not(:disabled){color:var(--expander-foreground-hover)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-left:2px;padding:2px;background-color:var(--accessibility-message-background);color:var(--accessibility-message-foreground);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:focus{background-color:var(--accessibility-message-background-focus)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]{width:100%;height:20px;box-sizing:border-box;color:var(--alert-foreground);background-color:var(--alert-background);outline:var(--alert-border);display:flex;padding-left:2px;align-items:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--alert-icon)}[data-legacy-theming=true]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{width:16px;height:16px}[data-legacy-theming=false]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .messageAlert[_ngcontent-%COMP%]{cursor:default;flex-grow:1;height:100%;box-sizing:border-box;border:none;padding-top:2px;padding-left:4px;background-color:var(--alert-background);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:11px;resize:none;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]{margin-right:3px;font-size:14px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown.hideFormulaBarDropdown[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]{min-width:100px;height:28px;box-sizing:border-box}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]     button{min-width:inherit;height:inherit}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]{min-width:76px;flex:0;height:28px;box-sizing:border-box;border:1px solid var(--submit-cancel-buttons-border);display:flex;align-items:center;justify-content:space-evenly;background-color:var(--submit-cancel-buttons-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-content:center;justify-content:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--colorNeutralForegroundDisabled)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus:not(:disabled){background:var(--colorNeutralBackground1Hover)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--cancel-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--commit-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:none}.gray-theme   [_nghost-%COMP%]{background-color:var(--gray-host-background)}.gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-radius:2px;border-color:var(--gray-border-color)}.gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{background-color:var(--gray-read-only-background);border-color:var(--gray-read-only-border)}@media print{formula-bar[_ngcontent-%COMP%]   .formulaBar[_ngcontent-%COMP%]{display:none}}'],data:{animation:[(0,D.X$)("chevron",[(0,D.SB)("".concat(0),(0,D.oB)({transform:"rotate(180deg)"})),(0,D.SB)("".concat(2),(0,D.oB)({transform:"rotate(0deg)"})),(0,D.SB)("".concat(1),(0,D.oB)({transform:"rotate(0deg)"})),(0,D.eR)("".concat(1," => ").concat(2,", ").concat(2," => ").concat(1),[(0,D.jt)(150,(0,D.F4)([(0,D.oB)({transform:"rotate(0deg)",offset:0}),(0,D.oB)({transform:"rotate(45deg)",offset:.5}),(0,D.oB)({transform:"rotate(0deg)",offset:1})]))]),(0,D.eR)("* => ".concat(0),[(0,D.jt)(150,(0,D.F4)([(0,D.oB)({transform:"rotate(0deg)",offset:0}),(0,D.oB)({transform:"rotate(180deg)",offset:1})]))]),(0,D.eR)("".concat(0," => *"),[(0,D.jt)(150,(0,D.F4)([(0,D.oB)({transform:"rotate(180deg)",offset:0}),(0,D.oB)({transform:"rotate(0deg)",offset:1})]))])])]}}),a}();function we(a){return _.some(pt,function(i){var u=$(a),c=$(i);return c.is(u)||!!c.find(u).length})}},15903:function(me,G,n){n.d(G,{$d:function(){return H},Pm:function(){return L},n9:function(){return O}});var h=n(50423),L=new h.InjectionToken("IntellisenseModelService"),O=new h.InjectionToken("FormulaBarBehaviorService"),H=new h.InjectionToken("FormulaBarZoomService")},98361:function(me,G,n){n.d(G,{e:function(){return O}});var h=n(81337),L=n(50423),O=function(){function H(N,A,U){this.uiBlockingService=N,this.localizationService=A,this.intellisenseService=U}return H.prototype.registerFormulaBarControl=function(N){this.formulaBarControl=N,N.setEditModeOptions([])},H.prototype.focusWhenNotBlocked=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(N){switch(N.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return N.sent(),this.formulaBarControl.focus(),[2]}})})},H.prototype.updateReadOnlyState=function(N){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(A){switch(A.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return A.sent(),this.formulaBarControl.setReadOnly(N),[2]}})})},H.prototype.updateContents=function(N,A){return(0,h.__awaiter)(this,void 0,void 0,function(){var U;return(0,h.__generator)(this,function(P){switch(P.label){case 0:return[4,this.intellisenseService.getDataSourceInfo()];case 1:return U=P.sent(),(_.isEmpty(U.functionDataFromEngine)||_.isEmpty(U.reservedWords))&&!A&&(A=this.localizationService.get("DaxEditor_ErrorMessageToGetIntellisense")),[4,this.updateFormulaText(N,U)];case 2:return P.sent(),this.updateAlertText(A),[2]}})})},H.prototype.updateFormulaText=function(N,A){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(U){switch(U.label){case 0:return[4,this.intellisenseService.updateDaxContext(A)];case 1:return U.sent(),this.formulaBarControl.setCommittedFormulaBarText(N||null),this.contentChanged=!1,[2]}})})},H.prototype.updateAlertText=function(N){N?this.formulaBarControl.showAlertMessage(N):this.formulaBarControl.hideAlert()},H.\u0275fac=function(A){L.\u0275\u0275invalidFactory()},H.\u0275prov=L.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac}),H}()},15783:function(me,G,n){n.d(G,{B:function(){return P}});var h=n(81337),L=n(15903),O=n(50423),H=n(72080),N=n(83309),P=function(){function w(S,k,K,te){this.intellisenseService=S,this.screenReaderService=k,this.zone=K,this.behaviorService=te,this.suspendParseCount=0}return w.prototype.setUICulture=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(S){switch(S.label){case 0:return[4,this.intellisenseService.setUICulture()];case 1:return S.sent(),[2]}})})},w.prototype.ngOnDestroy=function(){this.behaviorService.ngOnDestroy()},Object.defineProperty(w.prototype,"mode",{get:function(){return"dax"},enumerable:!1,configurable:!0}),w.prototype.registerFormulaBarControl=function(S){this.formulaBarControl=S,this.behaviorService.registerFormulaBarControl(S),this.intellisenseService.onClientViewLoaded(this)},w.prototype.onContentChanged=function(S,k,K,te){var ne=this,oe=this.intellisenseService.analyzeFinalFormulaCommitInfo(S,!1,!1);this.behaviorService.contentChanged||(this.behaviorService.contentChanged=oe.doCommit),oe.parseErrorMessages.size&&oe.parseErrorMessages.forEach(function(ge,pe){ne.screenReaderService.alertWithDebounce("dax-error"+pe,ge)}),this.intellisenseService.onContentChanged(S,k,K,0!==this.suspendParseCount,te.length>1),this.behaviorService.onContentChanged(oe)},w.prototype.onEditorFocus=function(){this.intellisenseService.onEditorFocus()},w.prototype.hasUnsavedChanges=function(S){return this.behaviorService.hasUnsavedChanges(S)},w.prototype.onBlur=function(S){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(k){switch(k.label){case 0:return[4,this.behaviorService.commitOrDeletePendingCalculation(S)];case 1:return[2,k.sent()]}})})},w.prototype.onSubmit=function(S){return(0,h.__awaiter)(this,void 0,void 0,function(){var k;return(0,h.__generator)(this,function(K){switch(K.label){case 0:return k=this.intellisenseService.analyzeFinalFormulaCommitInfo(S,!0,!0),[4,this.behaviorService.commitCalculationUpdate(k)];case 1:return K.sent(),[2]}})})},w.prototype.onCancel=function(S){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(k){return this.behaviorService.cancel(S),[2]})})},w.prototype.onTemplateSelection=function(S){return this.behaviorService.onTemplateSelection(S)},w.prototype.setCommittedFormulaBarText=function(S){this.formulaBarControl.setCommittedFormulaBarText(S)},w.prototype.hostServiceCalculationCommitedOrDeleted=function(){this.formulaBarControl.endFormulaEdit(),this.behaviorService.contentChanged=!1},w.\u0275fac=function(k){return new(k||w)(O.\u0275\u0275inject(H.e),O.\u0275\u0275inject(N.g),O.\u0275\u0275inject(O.NgZone),O.\u0275\u0275inject(L.n9))},w.\u0275prov=O.\u0275\u0275defineInjectable({token:w,factory:w.\u0275fac}),(0,h.__decorate)([function(w,S,k){var K=k.value;k.value=function(){for(var te=[],ne=0;ne<arguments.length;ne++)te[ne]=arguments[ne];var oe=this;this.zone.run(function(){return K.apply(oe,te)})}},(0,h.__metadata)("design:type",Function),(0,h.__metadata)("design:paramtypes",[]),(0,h.__metadata)("design:returntype",void 0)],w.prototype,"hostServiceCalculationCommitedOrDeleted",null),w}()},72080:function(me,G,n){n.d(G,{e:function(){return ge}});var h=n(81337),L=n(15903),O=n(17819),H=n(63513),N=n(48563),A=n(74249),U=n(26112),P=n(62458),w=n(59694),S=n(63708),k=n(49088),K=n(50423),te=n(65181),ne=n(34103),oe=[" ","\t"],ge=function(){function I(f,B,T,R){this.localizationService=f,this.intellisenseHostService=B,this.intellisenseModelService=T,this.daxCapabilitiesService=R}return I.prototype.onClientViewLoaded=function(f){this.intellisenseHostService.onClientViewLoaded(f)},I.prototype.onContentChanged=function(f,B,T,R,V){this.intellisenseHostService.onContentChanged(f,B,T,R,V)},I.prototype.setUICulture=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var f,B;return(0,h.__generator)(this,function(T){switch(T.label){case 0:return[4,this.intellisenseHostService.getCultureInfo()];case 1:return f=T.sent(),B=(0,U.K)(f),(0,O.g5)({listSeparator:B.listSeparator,numberDecimalSeparator:B.decimalSeparator}),[2]}})})},I.prototype.onEditorFocus=function(){this.intellisenseHostService.onEditorFocus()},I.prototype.endIntellisenseSession=function(){this.intellisenseModelService.reset(),this.intellisenseHostService.endIntellisenseSession()},I.prototype.startIntellisenseSession=function(f,B,T,R){this.intellisenseModelService.init({entityName:f,propertyName:B,schemaName:T,calculationEditMode:R}),this.intellisenseHostService.startIntellisenseSession(f,B,T,R)},I.prototype.getCalculationInfo=function(f){return(0,h.__awaiter)(this,void 0,void 0,function(){var B;return(0,h.__generator)(this,function(T){return(B=this.intellisenseModelService.findCalculationObject(f))&&null!=B.expression?[2,Promise.resolve({isNew:B.isNew,alertMessage:B.expressionErrorMessage?B.expressionErrorMessage:void 0,formulaText:this.getCalculationExpression(B)})]:(P.fF.assertFail((0,w.W)("Cannot find editable Calculation: schema:{0} entity:{1} property:{2}",f?.schemaName,f?.entityName,f?.propertyName)),[2,Promise.resolve(void 0)])})})},I.prototype.getCalculationExpression=function(f){if(f.formulaOverride)return f.formulaOverride.formula;var B=O.w_.convertToUI(f.expression);return f.calculationSyntaxType===S.Up.Expression?B:(0,O.Mk)(f.name,B)},I.prototype.updateFormulaContextAsync=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var f;return(0,h.__generator)(this,function(B){switch(B.label){case 0:return[4,this.getDataSourceInfo()];case 1:return f=B.sent(),[4,this.updateDaxContext(f)];case 2:return B.sent(),[2]}})})},I.prototype.updateDaxContext=function(f){return(0,h.__awaiter)(this,void 0,void 0,function(){var X;return(0,h.__generator)(this,function(D){switch(D.label){case 0:return[4,this.intellisenseModelService.getDaxModeConfigInputs(f)];case 1:return X=D.sent(),k._.configureModel(X.serializableModel,X.wireDataSourceInfo,X.daxCalculation,X.isRestrictedMode,X.axes),[2]}})})},I.prototype.getDataSourceInfo=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var f,T,V;return(0,h.__generator)(this,function(Z){switch(Z.label){case 0:return[4,Promise.all([this.daxCapabilitiesService.getReservedWords(),this.daxCapabilitiesService.getCapabilities()])];case 1:return V=Z.sent(),f=V[0],T=(0,N.w)(V[1].Functions),[2,{reservedWords:f,functionDataFromEngine:T}]}})})},I.prototype.analyzeFinalFormulaCommitInfo=function(f,B,T){var R=this.intellisenseModelService.getCalculationObject(),V={name:void 0,expression:void 0,invalidFormula:void 0,anonymizedExpression:void 0,parseResult:void 0},Z=function(I,f,B,T){if(!T)return f.name=void 0,f.expression=void 0,f.invalidFormula=void 0,f.anonymizedExpression=void 0,!1;!function(I,f,B,T){var R=!1,V={name:void 0,expression:void 0};if((R=T.calculationSyntaxType===S.Up.Expression)?V.expression=H.uI.trimStart(I,oe):R=(0,O.Mn)(I,V,T.calculationType===S.eN.VisualCalculation),!R)return f.name=T.name||"",f.name&&!I?f.expression="":(f.invalidFormula=I,f.expression=T.expression||""),null;if(f.name=V.name,f.expression=V.expression,V.expression)if(B){(Z=k._.getContext())||P.fF.assertFail("Context should be defined");var X=new O.w_,D=new O.ss,e={finalResult:D};X.finalParse(V.expression,Z,e,O.MX.AddMissingParens|O.MX.Anonymize|O.MX.ConvertToEngine),f.expression=e.finalResult.updatedExpression,f.anonymizedExpression=e.finalResult.anonymizedExpression,f.parseResult=D}else{X=new O.w_;var Z=k._.getContext(),Q={result:new O.bp};X.parse(V.expression,0,void 0,void 0,Z,Q,void 0),f.expression=O.w_.convertToEngine(V.expression),f.parseResult=Q.result}}(I,f,B,T);var R,V=T.formulaOverride;return V&&(R=V.formula),T.name!==f.name||T.expression!==f.expression||R!==f.invalidFormula}(f,V,T,R);!Z&&B&&R&&(Z=!!R.expressionErrorMessage&&!!R.expressionOverride&&!R.formulaOverride);var e,se,Q=new Map;if(Z&&V.invalidFormula)switch(e={expression:null,formula:V.invalidFormula},R.calculationType){case S.eN.Column:se=this.localizationService.get("ReportModelInvalidColumnNameMessage");break;case S.eN.Table:se=this.localizationService.get("ReportModelInvalidCalculatedTableNameMessage");break;case S.eN.Measure:se=this.localizationService.get("ReportModelInvalidMeasureNameMessage");break;case S.eN.CalculationItem:se=this.localizationService.get("ReportModelInvalidCalcItemNameMessage");break;case S.eN.VisualCalculation:break;default:P.fF.assertFail("Unknown type "+R.calculationType)}return V.parseResult instanceof O.bp&&V.parseResult.errors.length&&V.parseResult.errors.forEach(function(q){return Q.set(q.errorCode,q.message)}),{doCommit:Z,newName:V.name,newExpression:V.expression,newInvalidFormula:V.invalidFormula,anonymizedExpression:V.anonymizedExpression,expressionOverride:e,errorMessage:se,parseErrorMessages:Q}},I.\u0275fac=function(B){return new(B||I)(K.\u0275\u0275inject(te.o),K.\u0275\u0275inject(ne.TH),K.\u0275\u0275inject(L.Pm),K.\u0275\u0275inject(A.r))},I.\u0275prov=K.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac,providedIn:"root"}),I}()},4715:function(me,G,n){n.d(G,{H2:function(){return O},Zs:function(){return U},gV:function(){return N}});var h=n(41114),L="PBI.FormulaBar.EditFormulaBarObject",O=h.cx[L]=(0,h.b1)(L),H="PBI.FormulaBar.SubmitDynamicFormatString",N=h.cx[H]=(0,h.b1)(H),A="PBI.FormulaBar.SelectTemplate",U=h.cx[A]=(0,h.b1)(A)},81892:function(me,G,n){n.d(G,{Uu:function(){return O},ZI:function(){return h},dO:function(){return L}});var h=[{displayName:"Measure",key:1},{displayName:"Format",key:2}],L=[{displayName:"Item",key:1},{displayName:"Format",key:2}],O="formulaBarDropdownPanel"}}]);