"use strict";(self.webpackChunkreportServerHostModern=self.webpackChunkreportServerHostModern||[]).push([["extension-host-access-management"],{35750:function(te,R,o){o.r(R),o.d(R,{ExtensionHostAccessManagementModule:function(){return Y}});var $=o(77476),b=o(60756),O=o(81337),D=o(59017),A=o(82762),y=o(60225),T=o(11547),h=o(81905),w=o(59973),I=o(48787),S=o(14172),W=o(17653),j=o(59822),B=o(42195),F=(o(41838),o(8697),o(50600));function x(e){return{name:"SharingNotSupportedException",message:"Sharing not supported for type ".concat(e)}}var u=o(50423),k=new u.InjectionToken("TriArtifactAccessDataService"),U=new u.InjectionToken("TriArtifactAccessDialogService"),L=new u.InjectionToken("TriArtifactDirectAccessService"),V=new u.InjectionToken("TriArtifactPermissionsService"),z=(new u.InjectionToken("TriSharingUtilsService"),function(e){return e.QuickAction="QuickAction",e.ContextMenu="ContextMenu",e.ManagePermissionPage="ManagePermissionPage",e.ManagePermissionPanel="ManagePermissionPanel",e.ExtensionClientAPI="ExtensionClientAPI",e.InArtifactComponent="InArtifactComponent",e.EditLinkPanel="EditLinkPanel",e}({})),s=(new u.InjectionToken("TriArtifactAccessRequestService"),new u.InjectionToken("TriArtifactPermissionNavigationService"),new u.InjectionToken("TriArtifactSharingService"),new u.InjectionToken("TriArtifactAccessTelemetryService"),new u.InjectionToken("TriUserPhotoService"),o(73471)),N=o(60397),g=o(17899),H=o(67758),K=o(18438),J=o(6814),Q=o(54323),X=function(){function e(m,P,Z,q,_,ee){var d=this;this.actions$=m,this.extensionManifestService=P,this.messageBroker=Z,this.telemetryService=q,this.lazyProvider=_,this.folderService=ee,this.onOpenArtifactSharingDialogReceived$=(0,b.GW)(function(){return d.actions$.pipe((0,g.pR)(s.Vm.openArtifactSharingDialog),(0,h.w)(function(t){var i=t.artifactType,c=t.artifactObjectId,r=t.linkSharing,a=t.preSelectedUserPrincipals,l=t.defaultShareOptions,p=t.customizedTitle;return(0,D.aj)([(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",k)),(0,A.D)(d.genericSharingSupported(i))]).pipe((0,h.w)(function(n){return n[1]?n[0].getArtifactDetails(i,c):(0,y._)(x(i))}),(0,w.h)(function(n){return n?.artifact}),(0,I.q)(1),(0,S.U)(function(n){var f=n.artifact;return{sharingInput:{artifactName:f.displayName,artifactType:i,artifactObjectId:c,folderObjectId:f.folderObjectId,userCorePermissions:f.permissions,userArtifactPermissions:f.artifactPermissions,preSelectedUserPrincipals:a,defaultShareOptions:l,customizedTitle:p,sharingEntryPoint:z.ExtensionClientAPI},linkSharing:r??!0}}),(0,h.w)(function(n){var f=n.sharingInput,v=n.linkSharing;return(f.userCorePermissions&s.Pl.ReShare)!==s.Pl.ReShare?(0,y._)({name:"LackOfReSharePermissionException",message:"ReShare permission is needed for this action"}):(0,T.of)({sharingInput:f,linkSharing:v})}))}),(0,W.b)(function(t){var i=t.sharingInput,c=t.linkSharing;return(0,O.mG)(d,void 0,void 0,function(){var r;return(0,O.Jh)(this,function(a){switch(a.label){case 0:return[4,this.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",U)];case 1:return r=a.sent(),c?r.openSharingDialog(i):r.openGrantAccessDialog(i),[2]}})})}),(0,j.K)(function(t){return d.telemetryService.logEvent({name:"PermissionsAPI.openArtifactSharingDialog",properties:{error:t}}),(0,y._)(t)}))},{dispatch:!1}),this.onOpenArtifactSharingDialogWithResultReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.openArtifactSharingDialogWithResult,function(t){var i=t.artifactType,c=t.artifactObjectId,r=t.linkSharing,a=t.preSelectedUserPrincipals,l=t.defaultShareOptions,p=t.customizedTitle;return(0,A.D)(d.genericSharingSupported(i)).pipe((0,h.w)(function(n){return n?(0,D.aj)([(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",k)).pipe((0,h.w)(function(f){return f.getArtifactDetails(i,c).pipe((0,w.h)(function(v){return v?.artifact}))})),(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",U))]):(0,y._)(x(i))}),(0,I.q)(1),(0,S.U)(function(n){var f=n[0].artifact;return[{sharingInput:{artifactName:f.displayName,artifactType:i,artifactObjectId:c,folderObjectId:f.folderObjectId,userCorePermissions:f.permissions,userArtifactPermissions:f.artifactPermissions,preSelectedUserPrincipals:a,defaultShareOptions:l,customizedTitle:p,sharingEntryPoint:z.ExtensionClientAPI},linkSharing:r??!0},n[1]]}),(0,h.w)(function(n){var f=n[0],v=f.sharingInput,E=f.linkSharing,M=n[1];return(v.userCorePermissions&s.Pl.ReShare)!==s.Pl.ReShare?(0,y._)({name:"LackOfReSharePermissionException",message:"ReShare permission is needed for this action"}):(0,A.D)(E?M.openSharingDialog(v):M.openGrantAccessDialog(v))}),(0,S.U)(function(n){return s.Vm.openArtifactSharingDialogWithResult.resolve(n?.sharingCompleted?n:{sharingCompleted:!1})}),(0,j.K)(function(n){return(0,T.of)(s.Vm.openArtifactSharingDialogWithResult.reject({error:n}))}))}),this.onCheckPermissionsOfArtifactReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.checkPermissionsOfArtifact,function(t){var i=t.artifactType,c=t.artifactObjectId,r=t.permissions,a=t.artifactPermissions;return(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",k)).pipe((0,h.w)(function(l){return l.getArtifactDetails(i,c)}),(0,I.q)(1),(0,S.U)(function(l){var p=l.artifact;return s.Vm.checkPermissionsOfArtifact.resolve({value:!!p&&(p.permissions&r)===r&&(p.artifactPermissions&a)===a})}),(0,j.K)(function(l){return d.telemetryService.logEvent({name:"PermissionsAPI.checkPermissionsOfArtifact",properties:{error:l,artifactType:i,artifactObjectId:c,permissions:r,artifactPermissions:a}}),(0,T.of)(s.Vm.checkPermissionsOfArtifact.reject({error:l}))}))}),this.onCheckPermissionsOfWorkspaceReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.checkPermissionsOfWorkspace,function(t){var c=t.permissions,r=d.folderService.getFolder(t.workspaceObjectId);return s.Vm.checkPermissionsOfWorkspace.resolve(r?{value:(r.contract.permissions&c)===c}:{value:!1})}),this.onGetPermissionsOfArtifactReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.getPermissionsOfArtifact,function(t){var i=t.artifactType,c=t.artifactObjectId;return(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",k)).pipe((0,h.w)(function(r){return r.getArtifactDetails(i,c)}),(0,I.q)(1),(0,S.U)(function(r){var a,l=r.artifact;return s.Vm.getPermissionsOfArtifact.resolve(l?{permissions:l.permissions,artifactPermissions:null!==(a=l.artifactPermissions)&&void 0!==a?a:0}:{permissions:s.Pl.None,artifactPermissions:0})}),(0,j.K)(function(r){return d.telemetryService.logEvent({name:"PermissionsAPI.getPermissionsOfArtifact",properties:{error:r,artifactType:i,artifactObjectId:c}}),(0,T.of)(s.Vm.getPermissionsOfArtifact.reject({error:r}))}))}),this.onGetPermissionsOfArtifactByUserReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.getPermissionsOfArtifactByUser,function(t){var i=t.artifactObjectId,c=t.userObjectIds;return(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",L)).pipe((0,h.w)(function(r){return r.getPermissionUsers(i,F.B.Artifact,void 0,!1)}),(0,I.q)(1),(0,S.U)(function(r){var a=[];return c.forEach(function(l){var p,n,f,v,E=r.filter(function(M){return M.objectId===l});a.push({userObjectId:l,permissions:null!==(n=null===(p=E[0])||void 0===p?void 0:p.permission)&&void 0!==n?n:s.Pl.None,artifactPermissions:null!==(v=null===(f=E[0])||void 0===f?void 0:f.artifactPermissions)&&void 0!==v?v:0})}),s.Vm.getPermissionsOfArtifactByUser.resolve({permissionsOfArtifactByUserList:a})}),(0,j.K)(function(r){var a={name:"PermissionsAPI.getPermissionsOfArtifactByUser",properties:{error:r,artifactObjectId:i,userObjectIds:JSON.stringify(c)}};return d.telemetryService.logEvent(a),(0,T.of)(s.Vm.getPermissionsOfArtifactByUser.reject({error:r}))}))}),this.onGetPermissionsOfWorkspaceReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.getPermissionsOfWorkspace,function(t){var c=d.folderService.getFolder(t.workspaceObjectId);return s.Vm.getPermissionsOfWorkspace.resolve(c?{permissions:c.contract.permissions}:{permissions:s.Pl.None})}),this.onCheckArtifactSharingEnabledReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.checkArtifactSharingEnabled,function(t){var i=t.artifactType,c=t.artifactObjectId;return(0,D.aj)([(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactAccess/trident-artifact-access.module#TridentArtifactAccessModule",k)).pipe((0,h.w)(function(r){return r.getArtifactDetails(i,c)}),(0,I.q)(1)),(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactPermissions/trident-artifact-permissions.module#TridentArtifactPermissionsModule",V))]).pipe((0,B.zg)(function(r){var a=r[0].artifact;return a?(0,A.D)(r[1].sharingEnabledForCurrentUser(i,a.permissions,a.artifactPermissions)).pipe((0,S.U)(function(p){return s.Vm.checkArtifactSharingEnabled.resolve({value:p})})):(0,T.of)(s.Vm.checkArtifactSharingEnabled.resolve({value:!1}))}),(0,j.K)(function(r){return d.telemetryService.logEvent({name:"PermissionsAPI.checkArtifactSharingEnabled",properties:{error:r,artifactType:i,artifactObjectId:c}}),(0,T.of)(s.Vm.checkArtifactSharingEnabled.reject({error:r}))}))}),this.onGetArtifactTypeShareablePermissionsReceived$=(0,g.Av)(this.actions$,this.messageBroker,s.Vm.getArtifactTypeShareablePermissions,function(t){var i=t.artifactType;return(0,A.D)(d.lazyProvider.get("@powerbi/TridentArtifactPermissions/trident-artifact-permissions.module#TridentArtifactPermissionsModule",V)).pipe((0,h.w)(function(c){return(0,T.of)(s.Vm.getArtifactTypeShareablePermissions.resolve({corePermissions:c.getShareableCorePermissions(i),artifactPermissions:c.getShareableArtifactPermissions(i)}))}))})}return e.prototype.genericSharingSupported=function(m){return(0,O.mG)(this,void 0,void 0,function(){return(0,O.Jh)(this,function(P){switch(P.label){case 0:return[4,this.extensionManifestService.isTridentArtifact(m)];case 1:return[2,P.sent()||["datamart","data-warehouse","lake-warehouse","mounted-warehouse"].includes(m)]}})})},e.\u0275fac=function(P){return new(P||e)(u.\u0275\u0275inject(b.eX),u.\u0275\u0275inject(H.vC),u.\u0275\u0275inject(N.u),u.\u0275\u0275inject(Q.t),u.\u0275\u0275inject(J.rn),u.\u0275\u0275inject(K.D))},e.\u0275prov=u.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e}(),Y=function(){function e(){}return e.\u0275fac=function(P){return new(P||e)},e.\u0275mod=u.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=u.\u0275\u0275defineInjector({imports:[$.CommonModule,b.sQ.forFeature([X])]}),e}()}}]);