"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["pbicopilot-web"],{80741:function(Y,M,p){p.r(M),p.d(M,{PBICopilotWebModule:function(){return V}});var a=p(77476),d=p(50423),I=p(60225),D=p(59822),l=p(14172),k=p(76746),R=p(73875),s=p(81337),N=p(58417),m=p(57243);function u(o,r,t,e){var n=new N.y(function(i){try{var c=function(o,r,t,e,n){var i=new XMLHttpRequest,c=0;return i.addEventListener("error",function(v){e.error(v),n?.reject({errorCode:"Event Listener error",errorMessage:JSON.stringify(v)}),e.complete()}),i.addEventListener("progress",function(){var v=i.response;if(200===i.status)for(var x=("\n"+v.substr(c)).split("\ndata: ").slice(1),y=0;y<x.length;y++){var E=x[y].trim();if("[DONE]"===E)return n?.resolve(),e.complete();try{e.next(JSON.parse(E)),c+=7+x[y].length}catch(b){if(y===x.length-1&&b instanceof SyntaxError)continue;n?.reject({errorCode:"Json Parse error",errorMessage:JSON.stringify(b)}),e.error(b)}}else{var q=JSON.parse(v);e.error(q),e.complete()}},!1),i.open("POST",o),i.setRequestHeader("Accept","text/event-stream"),i.setRequestHeader("content-type","application/json; charset=utf-8"),i.setRequestHeader("authorization","Bearer "+r),i.send(JSON.stringify((0,s.pi)((0,s.pi)({},t),{stream:!0}))),function(){i.readyState!==XMLHttpRequest.DONE&&i.abort()}}(r,t,o,i,e??null);return c}catch(C){i.error(C),e?.reject({errorCode:"Stream Http Request error",errorMessage:JSON.stringify(C)}),i.complete()}});return n.pipe((0,m.d)({refCount:!0}))}var f="/explore/nl2nl/completions",S=function(){function o(){this.appSettings=(0,d.inject)(k.de),this.httpService=(0,d.inject)(R.O)}return o.prototype.runScenario=function(r,t){return t?u(r,this.appSettings.clusterUri+f,this.appSettings.powerBIAccessToken).pipe((0,D.K)(function(e){var n;return(0,I._)(null!==(n=e?.error)&&void 0!==n?n:{code:"UnknownError"})})):this.httpService.post(f,r).pipe((0,l.U)(function(e){return e.data}),(0,D.K)(function(e){var n;return(0,I._)(null!==(n=e?.error)&&void 0!==n?n:{code:"UnknownError"})}))},o.\u0275prov=d.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac=function(t){return new(t||o)}}),o}(),O=p(30794),T=p(46544),U=p(56959),j=p(94853),L=p(62345),J=p(9380),F=p(83856),B=p(83019),H={top_p:1,frequency_penalty:0,presence_penalty:0},W=(0,s.pi)((0,s.pi)({},H),{max_tokens:128}),w=(0,s.pi)((0,s.pi)({},H),{maxTokens:128}),G=function(){function o(){this.onDestroy$=new O.xQ,this.completionUri="/explore/aiclient/completions",this.chatCompletionUri="/explore/aiclient/chatCompletions",this.embeddingUri="/explore/aiclient/embeddings",this.httpService=(0,d.inject)(R.O),this.telemetryService=(0,d.inject)(T.y0),this.appSettings=(0,d.inject)(k.de),this.featureSwitchService=(0,d.inject)(J.vZ),this.dialogService=(0,d.inject)(F.o)}return o.prototype.ngOnDestroy=function(){this.onDestroy$&&(this.onDestroy$.next(),this.onDestroy$.complete())},o.prototype.complete=function(r,t,e){var n;return(0,s.mG)(this,void 0,void 0,function(){var i,c,C,v,P,g,x=this;return(0,s.Jh)(this,function(y){return i=this.buildCopilotUsageRequest(r,t),C=(c=e||{}).telemetryOptions,v=(0,s._T)(c,["telemetryOptions"]),v=0===Object.keys(v).length?void 0:v,P=null===(n=i.prompt)||void 0===n?void 0:n.length,g=this.telemetryService.startEvent(B.ob,(0,s.pi)({promptLength:P},C)),[2,this.httpService.post(this.completionUri,(0,s.pi)((0,s.pi)({},W),i),v).pipe((0,l.U)(function(E){return g.resolve(),E.data}),(0,D.K)(function(E){return x.handleError(E,g),(0,I._)(E)}),(0,m.d)()).toPromise()]})})},o.prototype.complete$=function(r,t,e){var n,i=e||{},c=i.telemetryOptions,v=((0,s._T)(i,["telemetryOptions"]),null===(n=r.prompt)||void 0===n?void 0:n.length),P=this.appSettings.clusterUri+"explore/aiclient/completions",g=this.telemetryService.startEvent(B.a9,(0,s.pi)({promptLength:v},c??{}));return u(this.buildCopilotUsageRequest(r,t),P,this.appSettings.powerBIAccessToken,g).pipe((0,D.K)(function(y){return(0,I._)(y.error)}))},o.prototype.chatCompletion=function(r,t,e){return(0,s.mG)(this,void 0,void 0,function(){var i,c,C,g,x=this;return(0,s.Jh)(this,function(y){switch(y.label){case 0:return i=r,this.featureSwitchService.featureSwitches.enableCopilotPromptDebug&&this.dialogService?[4,this.dialogService.openDialog(i)]:[3,2];case 1:i=y.sent(),y.label=2;case 2:return c=this.buildCopilotUsageRequest(r,t),this.encodeMessagesIfEnabled(c),C=this.startTelemetryEventChatCompletions(r,c,e),g=(0,s._T)(e||{},["telemetryOptions"]),g=0===Object.keys(g).length?void 0:g,[2,this.httpService.post(this.chatCompletionUri,(0,s.pi)((0,s.pi)({},w),c),g).pipe((0,l.U)(function(E){return C.resolve(),E.data}),(0,D.K)(function(E){return x.handleError(E,C),(0,I._)(E)}),(0,m.d)()).toPromise()]}})})},o.prototype.chatCompletion$=function(r,t,e){var n=this.buildCopilotUsageRequest(r,t);this.encodeMessagesIfEnabled(n);var i=this.startTelemetryEventChatCompletions(r,n,e);return u((0,s.pi)((0,s.pi)({},w),n),this.appSettings.clusterUri+this.chatCompletionUri,this.appSettings.powerBIAccessToken,i).pipe((0,D.K)(function(c){return(0,I._)(c.error)}))},o.prototype.startTelemetryEventChatCompletions=function(r,t,e){var n,i=(e||{}).telemetryOptions,c=r.model,C=L.eH[null===(n=r.client_scenario)||void 0===n?void 0:n.scenario_type],v=t.messages.length,P=t.messages.map(function(g){return g.content?g.content.length:0});return this.telemetryService.startEvent(B.C_,(0,s.pi)({numberOfMessages:v,messageLengths:P,scenarioType:C,model:c},i??{}))},o.prototype.encodeMessagesIfEnabled=function(r){if(this.featureSwitchService.featureSwitches.enablePromptEncodingClientsForAIEndpoint)try{this.encodeMessages(r.messages),r.isEncoded=!0}catch(e){this.telemetryService.logEvent(U.xt,{message:"Error encoding chatCompletions messages: "+e})}},o.prototype.embedding=function(r,t,e){var n;return(0,s.mG)(this,void 0,void 0,function(){var i,c,C,v,P,g,E=this;return(0,s.Jh)(this,function(q){return i=this.buildCopilotUsageRequest(r,t),C=(c=e||{}).telemetryOptions,v=(0,s._T)(c,["telemetryOptions"]),v=0===Object.keys(v).length?void 0:v,P=null===(n=i.input)||void 0===n?void 0:n.length,g=this.telemetryService.startEvent(B.yI,(0,s.pi)({inputLength:P},C)),[2,this.httpService.post(this.embeddingUri,i,v??void 0).pipe((0,l.U)(function(b){return g.resolve(),b.data}),(0,D.K)(function(b){return E.handleError(b,g),(0,I._)(b)})).pipe((0,l.U)(function(b){return Array.isArray(b)?b?.reduce(function(Q,A){return{data:(0,s.ev)((0,s.ev)([],Q.data,!0),A.data,!0),usage:{prompt_tokens:Q.usage.prompt_tokens+A.usage.prompt_tokens,total_tokens:Q.usage.total_tokens+A.usage.total_tokens},model:A.model,object:A.object}},{data:[],usage:{prompt_tokens:0,total_tokens:0},model:"ADA2",object:"list"}):b})).toPromise()]})})},o.prototype.buildCopilotUsageRequest=function(r,t){return(0,s.pi)((0,s.pi)({},r),{copilotUsageMetadata:t})},o.prototype.encodeMessages=function(r){return r.map(function(t){if(("system"===t.role||"tool"===t.role)&&t.content){var e=btoa(t.content);t.content=e}return t})},o.prototype.handleError=function(r,t){var e=(0,j.GB)(r.error,r.status);t.reject(e)},o.\u0275prov=d.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac=function(t){return new(t||o)}}),o}(),Z=p(48787),K=p(43633),z=p(85732),X=function(){function o(r,t){this.store=r,this.httpService=t}return o.prototype.getReportTitle=function(){return(0,s.mG)(this,void 0,void 0,function(){return(0,s.Jh)(this,function(r){return[2,this.store.select(K.OX).pipe((0,Z.q)(1),(0,l.U)(function(t){return t?.displayName})).toPromise()]})})},o.prototype.getAvailableTokens=function(r){var t;return(0,s.mG)(this,void 0,void 0,function(){var e,i;return(0,s.Jh)(this,function(c){switch(c.label){case 0:e="/explore/aiclient/scenarioMetadata/"+r,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.httpService.get(e).toPromise()];case 2:return[2,c.sent().data];case 3:throw i=c.sent(),null!==(t=i?.error)&&void 0!==t?t:{code:"UnknownError"};case 4:return[2]}})})},o.\u0275fac=function(t){return new(t||o)(d.\u0275\u0275inject(z.yh),d.\u0275\u0275inject(R.O))},o.\u0275prov=d.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),V=function(){function o(){}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=d.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=d.\u0275\u0275defineInjector({providers:[{provide:"copilotScenarioProxyService",useClass:S},F.o,{provide:"copilotLLMProxyService",useClass:G},{provide:"reportContentCopilotProxyService",useClass:X}],imports:[a.CommonModule]}),o}()},83856:function(Y,M,p){p.d(M,{o:function(){return N}});var a=p(81337),d=p(32293),I=p(77476),D=p(55445),l=p(50423),k=function(){function m(h,u){this.dialogRef=h,this.data=u}return m.prototype.doTextareaValueChange=function(h){this.data.content=h.target.value},m.prototype.ok=function(){this.dialogRef.close(this.data)},m.prototype.close=function(){this.dialogRef.close()},m.\u0275fac=function(u){return new(u||m)(l.\u0275\u0275directiveInject(d.so),l.\u0275\u0275directiveInject(d.WI))},m.\u0275cmp=l.\u0275\u0275defineComponent({type:m,selectors:[["prompt-copilot-debug-dialog"]],standalone:!0,features:[l.\u0275\u0275StandaloneFeature],decls:13,vars:4,consts:[["mat-dialog-title",""],["id","id-prompt-dialog","rows","20","cols","96",1,"tri-copilot-dialog-textarea",3,"change"],["mat-button","","mat-dialog-close","",1,"tr-copilot-dialog-button",3,"click"]],template:function(u,f){1&u&&(l.\u0275\u0275elementStart(0,"h2",0),l.\u0275\u0275text(1),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(2,"mat-dialog-content")(3,"div")(4,"span"),l.\u0275\u0275text(5,"Client Scenario : "),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(6,"span"),l.\u0275\u0275text(7),l.\u0275\u0275elementEnd()(),l.\u0275\u0275elementStart(8,"textarea",1),l.\u0275\u0275listener("change",function(O){return f.doTextareaValueChange(O)}),l.\u0275\u0275text(9),l.\u0275\u0275elementEnd()(),l.\u0275\u0275elementStart(10,"mat-dialog-actions")(11,"button",2),l.\u0275\u0275listener("click",function(){return f.ok()}),l.\u0275\u0275text(12),l.\u0275\u0275elementEnd()()),2&u&&(l.\u0275\u0275advance(1),l.\u0275\u0275textInterpolate(f.data.title),l.\u0275\u0275advance(6),l.\u0275\u0275textInterpolate(f.data.clientScenario),l.\u0275\u0275advance(2),l.\u0275\u0275textInterpolate(f.data.content),l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate(f.data.okButtonText))},dependencies:[I.CommonModule,d.Is,d.ZT,d.uh,d.xY,d.H8,D.b],styles:["[_nghost-%COMP%]   .tri-copilot-dialog-textarea[_ngcontent-%COMP%]{background-color:#efe}[_nghost-%COMP%]   .tr-copilot-dialog-button[_ngcontent-%COMP%]{transition:color .2s,background-color .2s,border-color .2s;border-radius:var(--borderRadiusMedium);border:1px solid #8EBBDD;border-color:var(--button-primary-content-color, #000000);color:var(--button-primary-content-color, #000000);background-color:var(--theme-dark-color, #CDA521)}"],changeDetection:0}),m}(),N=function(){function m(h){this.matDialog=h}return m.prototype.openMessageBox=function(h){var u,f,S=(null!==(u=h.width)&&void 0!==u?u:620)+"px",O=null!==(f=h.autoFocusTarget)&&void 0!==f?f:"first-tabbable";return this.matDialog.open(k,{width:S,data:h,panelClass:"dialog-style",autoFocus:O})},m.prototype.toJSonString=function(h){var u=JSON.stringify(h,null,4);return u.replace(/("[\s\S]*?")/g,function(f,S){return S.replace(/\\n/g,"\n")})},m.prototype.toJSonObject=function(h){var u=(h||"").replace(/("[\s\S]*?")/g,function(f,S){return S.replace(/\n/g,"\\\\n")});return JSON.parse(u)},m.prototype.openDialog=function(h){return(0,a.mG)(this,void 0,void 0,function(){var u,f,S,U=this;return(0,a.Jh)(this,function(j){return f=this.toJSonString((u=h).messages),S=JSON.stringify(u.client_scenario||"",null,4),[2,this.openMessageBox({content:f,clientScenario:S,width:800,minHeight:600,title:"Prompt Debug Dialog",okButtonText:"Submit"}).afterClosed().toPromise().then(function(L){return u.messages=U.toJSonObject(L.content||"[]"),Promise.resolve(u)})]})})},m.\u0275fac=function(u){return new(u||m)(l.\u0275\u0275inject(d.uw))},m.\u0275prov=l.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac}),m}()},83019:function(Y,M,p){p.d(M,{C_:function(){return s},Cp:function(){return o},H$:function(){return z},I9:function(){return f},IS:function(){return L},Is:function(){return F},L3:function(){return H},P0:function(){return t},T4:function(){return n},TL:function(){return w},Tk:function(){return Z},a9:function(){return N},ef:function(){return O},fD:function(){return c},hi:function(){return h},ob:function(){return I},wl:function(){return X},yI:function(){return l},yg:function(){return U}});var a=p(41114),d="PBI.Copilot.CompletionEvent",I=a.cx[d]=(0,a.b1)(d),D="PBI.Copilot.EmbeddingEvent",l=a.cx[D]=(0,a.b1)(D),k="PBI.Copilot.StreamCompletionEvent",R="PBI.Copilot.ChatCompletionEvent",s=a.cx[R]=(0,a.b1)(R),N=a.cx[k]=(0,a.b1)(k),m="PBI.Copilot.GetSerializedSchema",h=a.cx[m]=(0,a.b1)(m),u="PBI.Copilot.UndoSkill",f=a.cx[u]=(0,a.b1)(u),S="PBI.Copilot.RetrySkill",O=a.cx[S]=(0,a.b1)(S),T="PBI.Copilot.ZeroPromptAction",U=a.cx[T]=(0,a.b1)(T),j="PBI.Copilot.PromptGuideAction",L=a.cx[j]=(0,a.b1)(j),J="PBI.Copilot.SkillSetExecution",F=a.cx[J]=(0,a.b1)(J),B="PBI.Copilot.UserTurn",H=a.cx[B]=(0,a.b1)(B),W="PBI.Copilot.CopilotTurn",w=a.cx[W]=(0,a.b1)(W),G="PBI.Copilot.CopilotTurnSkillExecution",Z=a.cx[G]=(0,a.b1)(G),K="PBI.Copilot.AggregationError",z=a.cx[K]=(0,a.b1)(K),$="PBI.Copilot.NonRetriableError",X=a.cx[$]=(0,a.b1)($),V="PBI.Copilot.RetriableError",o=a.cx[V]=(0,a.b1)(V),r="PBI.Copilot.FeedbackDialog",t=a.cx[r]=(0,a.b1)(r),e="PBI.Copilot.FeedbackDialogError",n=a.cx[e]=(0,a.b1)(e),i="PBI.Copilot.FeedbackDialogView",c=a.cx[i]=(0,a.b1)(i)}}]);