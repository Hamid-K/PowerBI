"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["scorecard"],{58105:function(Q,G,f){f.r(G),f.d(G,{Scorecard:function(){return X}});var c=f(81337),a=f(85619),N=f(90120),p=f(18664),U=f(28579),F=f(32105),d=f(79154),w=f(62458),A=f(65195),O=f(38265),x=f(48066),T=f(38078),I=f(46135),g=f(82755),B=function(){function o(){}return o.tokenExpiryBufferInMs=12e4,o.minTokenPollingIntervalInMs=6e4,o}(),S=function(){function o(){}return o.extractData=function(e,t){if(t&&t.originalEvent&&t.originalEvent.source===e.contentWindow&&t.originalEvent.data)return t.originalEvent.data},o.postMessage=function(e,t,r){var i,s=(0,x.en)(r),l="".concat(s.scheme,"://").concat(s.host);w.fF.assertValue(e.contentWindow,"Missing content window"),null===(i=e.contentWindow)||void 0===i||i.postMessage(t,l)},o}(),H=function(){function o(e,t,r,i){this.container=e,this.host=t,this.visualStyle=r,this.handleEmbedEvent=i,w.fF.assertValue(this.container,"container"),w.fF.assertValue(this.host,"host"),w.fF.assertValue(this.visualStyle,"visualStyle"),this.iFrame=$("<iframe>").attr(A.ZI,o.BlankPath),this.iFrame.addClass(o.IFrame.class),$(this.container).empty().append(this.iFrame),this.headers={uid:T.b$.generateGuid()}}return o.prototype.init=function(e){var t;return(0,c.__awaiter)(this,void 0,void 0,function(){var r,i,s,u=this;return(0,c.__generator)(this,function(y){switch(y.label){case 0:null===(t=this.iFrameIsLoaded)||void 0===t||t.reject(),this.iFrameIsLoaded=this.host.promiseFactory().defer(),r=this.host.authenticationService(),y.label=1;case 1:return y.trys.push([1,4,,5]),i=this,[4,r.getSignedInAccessToken()];case 2:return i.accessToken=y.sent(),[4,r.getClusterInfo()];case 3:return s=y.sent(),this.baseUrl=s.frontendUrl.replace(/\/$/,""),this.clusterUrl=s.backendUrl,[3,5];case 4:return y.sent(),[2];case 5:return this.configuration=this.generateEmbedConfiguration(this.accessToken,this.baseUrl,this.clusterUrl,e),this.configuration?(this.iFrame.attr(A.ZI,this.configuration.embedUrl),this.onLoad=function(){u.iFrame.off(A.A3,u.onLoad),u.iFrameIsLoaded.resolve(!0)},this.iFrame.on(A.A3,this.onLoad),this.onMessage=function(C){var h=S.extractData(u.iFrame.get(0),C);if(h?.url){var v="/scorecards/".concat(u.headers.uid,"/events");h.url==="".concat(v,"/navigate")?(u.scorecardId=h.body.scorecardId,u.groupId=h.body.groupId,w.fF.assertValue(u.scorecardId,"Scorecard id missing from navigation event"),u.handleEmbedEvent(1)):h.url==="".concat(v,"/cancel")?("tile"===u.configuration.settings.displayMode&&(u.scorecardId=void 0),u.handleEmbedEvent(0)):h.url==="".concat(v,"/replacescorecard")?u.handleEmbedEvent(2):h.url==="".concat(v,"/openlink")?window.open(h.body,"_blank"):h.url==="".concat(v,"/viewmodechanged")?h.body&&u.host.onSwitchFocusModeState(!0):h.url==="".concat(v,"/updatefilters")?u.goalFilters=h.body.goalFilters:h.url==="".concat(v,"/showgoals")?(u.goalIds=_.map(u.goalFilters,function(V){return V.goalId}),u.handleEmbedEvent(3)):h.url==="".concat(v,"/opengoalnotes")?u.handleEmbedEvent(4):h.url==="".concat(v,"/editgoal")?u.handleEmbedEvent(5):h.url==="".concat(v,"/clickembed")&&u.handleEmbedEvent(6)}},$(window).on(A.V,this.onMessage),[2]):[2]}})})},o.prototype.clickContainer=function(){1===this.host.getViewMode()&&!this.configuration.settings.isInFocus&&this.container.get(0).click()},o.prototype.getScorecardUrl=function(){var e;if(this.scorecardId){var t=null!==(e=this.groupId)&&void 0!==e?e:"me";return"".concat(this.baseUrl,"/groups/").concat(t,"/scorecards/").concat(this.scorecardId)}w.fF.assertFail("Scorecard not loaded")},o.prototype.destroy=function(){$(window).off(A.V,this.onMessage),this.iFrame.off(A.A3,this.onLoad)},o.prototype.embedScorecard=function(e,t){return(0,c.__awaiter)(this,void 0,void 0,function(){var r;return(0,c.__generator)(this,function(i){switch(i.label){case 0:return[4,this.isLoaded];case 1:return i.sent(),this.configuration=this.generateEmbedConfiguration(this.accessToken,this.baseUrl,this.clusterUrl,t,e),this.configuration?(r={body:this.configuration,headers:this.headers,method:o.MessagePost,url:o.UrlPathForLoad},S.postMessage(this.iFrame.get(0),r,this.configuration.embedUrl),[2]):[2]}})})},o.prototype.generateEmbedConfiguration=function(e,t,r,i,s){if(w.fF.assertValue(e,"accessToken"),w.fF.assertValue(t,"embedUrl"),(0,x.HH)(t,!1)){var l=t;return"/"!==l.slice(-1)&&(l+="/"),{accessToken:e,embedUrl:"".concat(l).concat(o.UrlPathForEmbedScorecard).concat(s),id:s,settings:i,tokenType:null,type:o.ConfigurationType,clusterUrl:r}}},o.prototype.createGoal=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var e;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.isLoaded];case 1:return t.sent(),this.host.onSwitchFocusModeState(!0),this.configuration.id=void 0,e={body:this.configuration,headers:this.headers,method:o.MessagePost,url:o.UrlPathForCreateGoal},S.postMessage(this.iFrame.get(0),e,this.configuration.embedUrl),[2]}})})},o.prototype.createScorecard=function(e){return(0,c.__awaiter)(this,void 0,void 0,function(){var t;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,this.isLoaded];case 1:return r.sent(),this.host.onSwitchFocusModeState(!0),this.configuration.id=void 0,t={body:this.configuration,headers:this.headers,method:o.MessagePost,url:e?o.UrlPathForDraftScorecard:o.UrlPathForCreateScorecard},S.postMessage(this.iFrame.get(0),t,this.configuration.embedUrl),[2]}})})},o.prototype.reset=function(e){return(0,c.__awaiter)(this,void 0,void 0,function(){var t;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,this.isLoaded];case 1:return r.sent(),this.host.onSwitchFocusModeState(e),t={body:void 0,headers:this.headers,method:o.MessagePost,url:o.UrlPathForReset},S.postMessage(this.iFrame.get(0),t,this.configuration.embedUrl),[2]}})})},o.prototype.restoreScorecard=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var e;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.isLoaded];case 1:return t.sent(),e={body:void 0,headers:this.headers,method:o.MessagePost,url:o.UrlPathForRestoreScorecard},S.postMessage(this.iFrame.get(0),e,this.configuration.embedUrl),[2]}})})},o.prototype.showPicker=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var e;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.isLoaded];case 1:return t.sent(),this.host.onSwitchFocusModeState(!0),this.configuration.id=void 0,e={body:this.configuration,headers:this.headers,method:o.MessagePost,url:o.UrlPathForPicker},S.postMessage(this.iFrame.get(0),e,this.configuration.embedUrl),[2]}})})},o.prototype.updateSettings=function(e){return(0,c.__awaiter)(this,void 0,void 0,function(){var t;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,this.isLoaded];case 1:return r.sent(),w.fF.assertValue(e,"settings"),t={body:e,headers:this.headers,method:o.MessagePatch,url:o.UrlPathForSettings},S.postMessage(this.iFrame.get(0),t,this.configuration.embedUrl),this.configuration.settings=e,[2]}})})},o.prototype.setAccessToken=function(e){return(0,c.__awaiter)(this,void 0,void 0,function(){var t;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,this.isLoaded];case 1:return r.sent(),w.fF.assertValue(e,"setAccessToken accessToken"),this.accessToken=e,this.configuration.accessToken=this.accessToken,t={body:this.accessToken,headers:this.headers,method:o.MessagePost,url:o.UrlPathForToken},S.postMessage(this.iFrame.get(0),t,this.configuration.embedUrl),[2]}})})},o.prototype.showGoalVisual=function(e){return(0,c.__awaiter)(this,void 0,void 0,function(){var t;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,this.isLoaded];case 1:return r.sent(),this.host.onSwitchFocusModeState(!1),this.configuration.settings=e,t={body:this.configuration,headers:this.headers,method:o.MessagePost,url:o.UrlPathForGoals},S.postMessage(this.iFrame.get(0),t,this.configuration.embedUrl),[2]}})})},o.prototype.openGoalNotes=function(e){return(0,c.__awaiter)(this,void 0,void 0,function(){var t;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,this.isLoaded];case 1:return r.sent(),"notes"===e.openGoalDetailsType&&(this.host.onSwitchFocusModeState(!0),e.displayMode="list"),this.configuration.settings=e,t={body:this.configuration,headers:this.headers,method:o.MessagePost,url:o.UrlPathForOpenGoalDetails},S.postMessage(this.iFrame.get(0),t,this.configuration.embedUrl),[2]}})})},Object.defineProperty(o.prototype,"isLoaded",{get:function(){return this.iFrameIsLoaded.promise},enumerable:!1,configurable:!0}),o.IFrame=(0,d.CH)("scorecardFrame"),o.BlankPath="about:blank",o.ConfigurationType="report",o.MessagePatch="PATCH",o.MessagePost="POST",o.UrlPathForCreateGoal="/scorecard/creategoal",o.UrlPathForCreateScorecard="/scorecard/createscorecard",o.UrlPathForDraftScorecard="/scorecard/provisiondraft",o.UrlPathForEmbedScorecard="scorecardEmbed?useVisualTelemetry=1&scorecardId=",o.UrlPathForGoals="/scorecard/goals",o.UrlPathForLoad="/report/load",o.UrlPathForOpenGoalDetails="/scorecard/opengoaldetails",o.UrlPathForPicker="/scorecard/showpicker",o.UrlPathForReset="/scorecard/reset",o.UrlPathForRestoreScorecard="/scorecard/restorescorecard",o.UrlPathForSettings="/scorecard/settings",o.UrlPathForToken="/scorecard/token",o}(),n=f(56578),R=function(){function o(e,t){this.host=e,this.featureSwitches=t}return o.prototype.getFormattingModel=function(e,t){var r=this;return t?("tile"!==t.displayMode?new n.Nq(function(){return r.buildConnectionCard(e)},function(){return r.buildScorecardCard(t)},function(){return r.buildHeaderCard(t)},function(){return r.buildColumnHeadersCard(t)},function(){return r.buildGoalsCard(t)},function(){return r.buildDetailsPaneCard(t)}):new n.Nq(function(){return r.buildConnectionCard(e)},function(){return r.buildGoalTileCard(t)},function(){return r.buildVisualizationCard(t)})).build():new n.Nq(function(){return r.buildConnectionCard(e)}).build()},o.prototype.buildConnectionCard=function(e){var t=this,i=new n.CQ(new n.lg("connection"),"ScorecardVisual_ConnectedScorecard",[a.A.scorecard.scorecardId],function(l){return t.host.getLocalizedString(l)});return i.addGroup("scorecard",function(s){s.addSimpleSlice("scorecardId",new n.fq({descriptor:a.A.scorecard.scorecardId,value:e,placeholder:"Scorecard"}).build())}),i.build()},o.prototype.buildScorecardCard=function(e){var t=this,i=new n.CQ(new n.lg("scorecard"),"Scorecard",[a.A.scorecard.fontFamily,a.A.scorecard.tableBackgroundColor,a.A.scorecard.showCommandBar],function(l){return t.host.getLocalizedString(l)});return i.addGroup("style",function(s){s.addCompositeSlice("fontFamily","Font",(new n.UN).withFontFamily({descriptor:a.A.scorecard.fontFamily,value:e.theme.fontFamily}).build()).addSimpleSlice("backgroundColor",new n.BT({descriptor:a.A.scorecard.tableBackgroundColor,value:{value:e.theme.tableBackgroundColor}}).build()).addSimpleSlice("showCommandBar",new n.bd({descriptor:a.A.scorecard.showCommandBar,value:!e.hideCommandBar}).build())}),i.build()},o.prototype.buildHeaderCard=function(e){var t=this,i=new n.CQ(new n.lg("header"),"ThemeDialog_SubSection_Header",[a.A.header.show,a.A.header.showCards,a.A.header.showTitle,a.A.header.showToolbar,a.A.header.foregroundColor,a.A.header.backgroundColor],function(l){return t.host.getLocalizedString(l)});return i.addTopLevelToggle("show",function(){return new n.bd({descriptor:a.A.header.show,value:!e.hideScorecardHeader}).build()}).addGroup("header",function(s){s.addSimpleSlice("showTitle",new n.bd({descriptor:a.A.header.showTitle,value:!e.hideScorecardTitle}).build()).addSimpleSlice("showToolbar",new n.bd({descriptor:a.A.header.showToolbar,value:!e.hideScorecardToolbar}).build()).addSimpleSlice("showCards",new n.bd({descriptor:a.A.header.showCards,value:!e.hideGoalCards}).build()).addSimpleSlice("foregroundColor",new n.BT({descriptor:a.A.header.foregroundColor,value:{value:e.theme.headerForegroundColor}}).build()).addSimpleSlice("backgroundColor",new n.BT({descriptor:a.A.header.backgroundColor,value:{value:e.theme.headerBackgroundColor}}).build())}),i.build()},o.prototype.buildColumnHeadersCard=function(e){var t=this,i=new n.CQ(new n.lg("columnHeaders"),"Visual_Tablix_ColumnHeaders",[a.A.columnHeaders.show,a.A.columnHeaders.foregroundColor],function(l){return t.host.getLocalizedString(l)});return i.addTopLevelToggle("show",function(){return new n.bd({descriptor:a.A.columnHeaders.show,value:!e.hideColumnHeaders}).build()}).addGroup("columnHeaders",function(s){s.addSimpleSlice("foregroundColor",new n.BT({descriptor:a.A.columnHeaders.foregroundColor,value:{value:e.theme.tableHeaderForegroundColor}}).build())}),i.build()},o.prototype.buildGoalsCard=function(e){var t=this,i=new n.CQ(new n.lg("goals"),"Metrics",[a.A.goals.foregroundColor,a.A.goals.backgroundColor],function(l){return t.host.getLocalizedString(l)});return i.addGroup("goals",function(s){s.addSimpleSlice("backgroundColor",new n.BT({descriptor:a.A.goals.backgroundColor,value:{value:e.theme.tableRowBackgroundColor}}).build()).addSimpleSlice("foregroundColor",new n.BT({descriptor:a.A.goals.foregroundColor,value:{value:e.theme.tableRowForegroundColor}}).build())}),i.build()},o.prototype.buildDetailsPaneCard=function(e){var t=this,i=new n.CQ(new n.lg("detailsPane"),"DetailsPane",[a.A.detailsPane.foregroundColor,a.A.detailsPane.backgroundColor,a.A.detailsPane.cardForegroundColor,a.A.detailsPane.cardBackgroundColor,a.A.detailsPane.chartForegroundColor,a.A.detailsPane.chartBackgroundColor],function(l){return t.host.getLocalizedString(l)});return i.addGroup("pane",function(s){s.withDisplayName("Pane").addSimpleSlice("backgroundColor",new n.BT({descriptor:a.A.detailsPane.backgroundColor,value:{value:e.theme.detailsPaneBackgroundColor}}).build()).addSimpleSlice("foregroundColor",new n.BT({descriptor:a.A.detailsPane.foregroundColor,value:{value:e.theme.detailsPaneForegroundColor}}).build())}).addGroup("chart",function(s){s.withDisplayName("Chart").addSimpleSlice("backgroundColor",new n.BT({descriptor:a.A.detailsPane.chartBackgroundColor,value:{value:e.theme.detailsPaneChartBackgroundColor}}).build(),function(l){return l.withCustomDisplayName("Background_Color")}).addSimpleSlice("foregroundColor",new n.BT({descriptor:a.A.detailsPane.chartForegroundColor,value:{value:e.theme.detailsPaneChartForegroundColor}}).build(),function(l){return l.withCustomDisplayName("Visual_FontColor")})}).addGroup("card",function(s){s.withDisplayName("Cards").addSimpleSlice("backgroundColor",new n.BT({descriptor:a.A.detailsPane.cardBackgroundColor,value:{value:e.theme.detailsPaneCardBackgroundColor}}).build(),function(l){return l.withCustomDisplayName("Background_Color")}).addSimpleSlice("foregroundColor",new n.BT({descriptor:a.A.detailsPane.cardForegroundColor,value:{value:e.theme.detailsPaneCardForegroundColor}}).build(),function(l){return l.withCustomDisplayName("Visual_FontColor")})}),i.build()},o.prototype.buildGoalTileCard=function(e){var t=this,i=new n.CQ(new n.lg("metric"),"MetricsName_New_Singular",[a.A.visualization.showScorecardName,a.A.visualization.scorecardNameFontFamily,a.A.visualization.scorecardNameFontSize,a.A.visualization.scorecardNameFontColor,a.A.visualization.scorecardNameBold,a.A.visualization.scorecardNameItalic,a.A.visualization.scorecardNameUnderline,a.A.visualization.currentValueFontFamily,a.A.visualization.currentValueFontSize,a.A.visualization.currentValueFontColor,a.A.visualization.currentValueBold,a.A.visualization.currentValueItalic,a.A.visualization.currentValueUnderline,a.A.visualization.targetValueFontFamily,a.A.visualization.targetValueFontSize,a.A.visualization.targetValueFontColor,a.A.visualization.targetValueBold,a.A.visualization.targetValueItalic,a.A.visualization.targetValueUnderline,a.A.visualization.showGrowth,a.A.visualization.growthFontFamily,a.A.visualization.growthFontSize,a.A.visualization.growthFontColor,a.A.visualization.growthBold,a.A.visualization.growthItalic,a.A.visualization.growthUnderline,a.A.visualization.showOwner,a.A.visualization.ownerPhotoSize,a.A.visualization.showGoalName,a.A.visualization.goalNameFontFamily,a.A.visualization.goalNameFontSize,a.A.visualization.goalNameFontColor,a.A.visualization.goalNameBold,a.A.visualization.goalNameItalic,a.A.visualization.goalNameUnderline,a.A.visualization.showDueDate,a.A.visualization.dueDateFontFamily,a.A.visualization.dueDateFontSize,a.A.visualization.dueDateFontColor,a.A.visualization.dueDateBold,a.A.visualization.dueDateItalic,a.A.visualization.dueDateUnderline,a.A.visualization.showStatus,a.A.visualization.showNotes,a.A.visualization.notesFontSize,a.A.visualization.notesFontColor,a.A.visualization.backgroundColor],function(l){return t.host.getLocalizedString(l)});return i.addGroup("scorecard name",function(s){s.addTopLevelToggle("showScorecardName",function(){return new n.bd({descriptor:a.A.visualization.showScorecardName,value:e.showGoalVisualScorecardName}).build()}).withCollapsible(!0).withDisplayName("ScorecardDialog_Name"),s.addCompositeSlice("scorecardName_font","Font",t.getFontControl(a.A.visualization.scorecardNameFontFamily,a.A.visualization.scorecardNameFontSize,a.A.visualization.scorecardNameBold,a.A.visualization.scorecardNameItalic,a.A.visualization.scorecardNameUnderline,e.theme.goalVisualScorecardName)),s.addSimpleSlice("scorecardName_color",new n.BT({descriptor:a.A.visualization.scorecardNameFontColor,value:{value:e.theme.goalVisualScorecardName.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.addGroup("current value",function(s){s.withCollapsible(!0).withDisplayName("CurrentValue"),s.addCompositeSlice("currentValue_font","Font",t.getFontControl(a.A.visualization.currentValueFontFamily,a.A.visualization.currentValueFontSize,a.A.visualization.currentValueBold,a.A.visualization.currentValueItalic,a.A.visualization.currentValueUnderline,e.theme.goalVisualCurrentValue)),s.addSimpleSlice("currentValue_color",new n.BT({descriptor:a.A.visualization.currentValueFontColor,value:{value:e.theme.goalVisualCurrentValue.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.addGroup("target value",function(s){s.withCollapsible(!0).withDisplayName("Role_DisplayName_TargetValue"),s.addCompositeSlice("targetValue_font","Font",t.getFontControl(a.A.visualization.targetValueFontFamily,a.A.visualization.targetValueFontSize,a.A.visualization.targetValueBold,a.A.visualization.targetValueItalic,a.A.visualization.targetValueUnderline,e.theme.goalVisualTargetValue)),s.addSimpleSlice("targetValue_color",new n.BT({descriptor:a.A.visualization.targetValueFontColor,value:{value:e.theme.goalVisualTargetValue.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.addGroup("growth",function(s){s.addTopLevelToggle("showGrowth",function(){return new n.bd({descriptor:a.A.visualization.showGrowth,value:e.showGoalVisualGrowth}).build()}).withCollapsible(!0).withDisplayName("ScorecardVisual_Growth"),s.addCompositeSlice("growth_font","Font",t.getFontControl(a.A.visualization.growthFontFamily,a.A.visualization.growthFontSize,a.A.visualization.growthBold,a.A.visualization.growthItalic,a.A.visualization.growthUnderline,e.theme.goalVisualGrowth)),s.addSimpleSlice("growth_color",new n.BT({descriptor:a.A.visualization.growthFontColor,value:{value:e.theme.goalVisualGrowth.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.addGroup("owner",function(s){s.addTopLevelToggle("showOwner",function(){return new n.bd({descriptor:a.A.visualization.showOwner,value:e.showGoalVisualOwner}).build()}).withCollapsible(!0).withDisplayName("Owner_Lowercase"),s.addSimpleSlice("owner_photo_size",new n.mu({descriptor:a.A.visualization.ownerPhotoSize,value:e.goalVisualOwnerPhotoSize,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60},required:{type:2}}}).build())}),i.addGroup("goal name",function(s){s.addTopLevelToggle("showGoalName",function(){return new n.bd({descriptor:a.A.visualization.showGoalName,value:e.showGoalVisualGoalName}).build()}).withCollapsible(!0).withDisplayName("MetricName"),s.addCompositeSlice("goalName_font","Font",t.getFontControl(a.A.visualization.goalNameFontFamily,a.A.visualization.goalNameFontSize,a.A.visualization.goalNameBold,a.A.visualization.goalNameItalic,a.A.visualization.goalNameUnderline,e.theme.goalVisualGoalName)),s.addSimpleSlice("currentValue_color",new n.BT({descriptor:a.A.visualization.goalNameFontColor,value:{value:e.theme.goalVisualGoalName.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.addGroup("status",function(s){s.addTopLevelToggle("showStatus",function(){return new n.bd({descriptor:a.A.visualization.showStatus,value:e.showGoalVisualStatus}).build()}).withCollapsible(!1).withDisplayName("Status")}),i.addGroup("due date",function(s){s.addTopLevelToggle("showDueDate",function(){return new n.bd({descriptor:a.A.visualization.showDueDate,value:e.showGoalVisualDueDate}).build()}).withCollapsible(!0).withDisplayName("DueDate"),s.addCompositeSlice("dueDate_font","Font",t.getFontControl(a.A.visualization.dueDateFontFamily,a.A.visualization.dueDateFontSize,a.A.visualization.dueDateBold,a.A.visualization.dueDateItalic,a.A.visualization.dueDateUnderline,e.theme.goalVisualDueDate)),s.addSimpleSlice("dueDate_color",new n.BT({descriptor:a.A.visualization.dueDateFontColor,value:{value:e.theme.goalVisualDueDate.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.addGroup("notes",function(s){s.addTopLevelToggle("showNotes",function(){return new n.bd({descriptor:a.A.visualization.showNotes,value:e.showGoalVisualNotes}).build()}).withCollapsible(!0).withDisplayName("Notes"),s.addSimpleSlice("notes_size",new n.mu({descriptor:a.A.visualization.notesFontSize,value:e.theme.goalVisualNotes.size.pt,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60},required:{type:2}}}).build(),function(l){return l.withCustomDisplayName("Role_DisplayName_Size")}),s.addSimpleSlice("notes_color",new n.BT({descriptor:a.A.visualization.notesFontColor,value:{value:e.theme.goalVisualNotes.color}}).build(),function(l){return l.withCustomDisplayName("Visual_FontColor")})}),i.addGroup("background",function(s){s.withCollapsible(!0).withDisplayName("Visual_Background"),s.addSimpleSlice("background_color",new n.BT({descriptor:a.A.visualization.backgroundColor,value:{value:e.theme.goalVisualBackgroundColor}}).build(),function(l){return l.withCustomDisplayName("Generic_Color")})}),i.build()},o.prototype.buildVisualizationCard=function(e){var t=this,i=new n.CQ(new n.lg("visualization"),"Visualization",[a.A.visualization.showVisualization,a.A.visualization.showLegends,a.A.visualization.showTargetLine,a.A.visualization.targetLineColor,a.A.visualization.currentLineColor,a.A.visualization.currentAreaShaded,a.A.visualization.showXAxis,a.A.visualization.xAxisFontFamily,a.A.visualization.xAxisFontSize,a.A.visualization.xAxisFontColor,a.A.visualization.xAxisBold,a.A.visualization.xAxisItalic,a.A.visualization.xAxisUnderline,a.A.visualization.showYAxis,a.A.visualization.yAxisFontFamily,a.A.visualization.yAxisFontSize,a.A.visualization.yAxisFontColor,a.A.visualization.yAxisBold,a.A.visualization.yAxisItalic,a.A.visualization.yAxisUnderline],function(l){return t.host.getLocalizedString(l)});return i.addTopLevelToggle("show",function(){var s;return new n.bd({descriptor:a.A.visualization.showVisualization,value:null===(s=e.showVisualization)||void 0===s||s}).build()}),i.addGroup("legends",function(s){s.addTopLevelToggle("showLegends",function(){return new n.bd({descriptor:a.A.visualization.showLegends,value:e.showGoalVisualLegends}).build()}).withCollapsible(!1).withDisplayName("Visual_Legend")}),i.addGroup("target line",function(s){s.addTopLevelToggle("showTargetLine",function(){return new n.bd({descriptor:a.A.visualization.showTargetLine,value:e.showGoalVisualTargetLine}).build()}).withCollapsible(!0).withDisplayName("ScorecardVisual_TargetLine"),s.addSimpleSlice("targetLine_color",new n.BT({descriptor:a.A.visualization.targetLineColor,value:{value:e.theme.goalVisualTargetLineColor}}).build(),function(l){return l.withCustomDisplayName("Generic_Color")})}),i.addGroup("current line",function(s){s.withCollapsible(!0).withDisplayName("ScorecardVisual_CurrentLine"),s.addSimpleSlice("currentLine_color",new n.BT({descriptor:a.A.visualization.currentLineColor,value:{value:e.theme.goalVisualCurrentLineColor}}).build(),function(l){return l.withCustomDisplayName("Generic_Color")}),s.addSimpleSlice("shade current area",new n.bd({descriptor:a.A.visualization.currentAreaShaded,value:e.currentAreaShaded}).build(),function(l){return l.withCustomDisplayName("Visual_Shapes_ShadeArea")})}),i.addGroup("x axis",function(s){s.addTopLevelToggle("showXAxis",function(){return new n.bd({descriptor:a.A.visualization.showXAxis,value:e.showGoalVisualXAxis}).build()}).withCollapsible(!0).withDisplayName("Visual_XAxis_Hyphen"),s.addCompositeSlice("xAxis_font","Font",t.getFontControl(a.A.visualization.xAxisFontFamily,a.A.visualization.xAxisFontSize,a.A.visualization.xAxisBold,a.A.visualization.xAxisItalic,a.A.visualization.xAxisUnderline,e.theme.goalVisualXAxis)),s.addSimpleSlice("xAxis_color",new n.BT({descriptor:a.A.visualization.xAxisFontColor,value:{value:e.theme.goalVisualXAxis.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.addGroup("y axis",function(s){s.addTopLevelToggle("showYAxis",function(){return new n.bd({descriptor:a.A.visualization.showYAxis,value:e.showGoalVisualYAxis}).build()}).withCollapsible(!0).withDisplayName("Visual_YAxis_Hyphen"),s.addCompositeSlice("yAxis_font","Font",t.getFontControl(a.A.visualization.yAxisFontFamily,a.A.visualization.yAxisFontSize,a.A.visualization.yAxisBold,a.A.visualization.yAxisItalic,a.A.visualization.yAxisUnderline,e.theme.goalVisualYAxis)),s.addSimpleSlice("yAxis_color",new n.BT({descriptor:a.A.visualization.yAxisFontColor,value:{value:e.theme.goalVisualYAxis.color}}).build(),function(l){return l.withCustomDisplayName("Text")})}),i.build()},o.prototype.getFontControl=function(e,t,r,i,s,l){return(new n.UN).withFontFamily({descriptor:e,value:l.family}).withFontSizeProperties({descriptor:t,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60}},value:l.size.pt}).withBold({descriptor:r,value:l.weight===d.en}).withItalic({descriptor:i,value:l.style===d.BF}).withUnderline({descriptor:s,value:l.textDecoration===d.f0}).build()},o}(),X=function(){function o(e){e&&(this.scorecardSettingsOverride=e.scorecardSettingsOverride)}return Object.defineProperty(o.prototype,"isSingleGoalVisual",{get:function(){var t,r;return"tile"===(null===(t=this.settings)||void 0===t?void 0:t.displayMode)||(null===(r=this.settings)||void 0===r?void 0:r.restoreGoalTile)},enumerable:!1,configurable:!0}),o.prototype.init=function(e){w.fF.assertValue(e,"options"),this.featureSwitches=e.featureSwitches,this.container=$("<div>").addClass(o.ScorecardContainer.class),this.host=e.host,this.authenticationService=this.host.authenticationService(),this.style=e.style,this.subscriptions=[],e.element.append(this.container),this.scorecardEmbed=new H(this.container,e.host,e.style,this.handleEmbedEvent.bind(this)),this.settings=this.generateScorecardSettings(void 0),this.scorecardEmbed.init(this.settings),this.buildSignInOverlay(),this.featureSwitches.singleGoalVisual?(this.buildEmptyStateOverlay(),this.buildDisplayModePickerOverlay()):this.buildAddScorecardOverlay(),this.getSignInReady()},o.prototype.destroy=function(){for(var e=0,t=this.subscriptions;e<t.length;e++)t[e].unsubscribe();this.scorecardEmbed.destroy(),clearTimeout(this.tokenRefreshTimeoutId)},o.prototype.update=function(e){switch(e.type){case I.EP.ViewMode:this.viewModeChanged(e.viewMode);break;case I.EP.Data:this.dataChanged(e),this.viewModeChanged(e.viewMode);break;case I.EP.Resize:this.isInFocus&&!e.isInFocus&&(this.scorecardEmbed.scorecardId?_.isEmpty(this.scorecardEmbed.goalIds)?"tile"===this.settings.displayMode?this.showSplashScreen(e.isInFocus):(this.scorecardEmbed.restoreScorecard(),this.setVisualState(1)):this.isSingleGoalVisual&&"notes"===this.settings.openGoalDetailsType&&(this.updateSettings({isEditingGoal:!1,openGoalDetailsType:void 0},!0),this.scorecardEmbed.showGoalVisual(this.settings)):this.showSplashScreen(e.isInFocus)),this.isInFocus=e.isInFocus,this.settings.isInFocus!==this.isInFocus&&this.updateSettings({isInFocus:this.isInFocus},!0),this.viewModeChanged(e.viewMode)}},o.prototype.dataChanged=function(e){var t,r;w.fF.assertValue(e,"options");var i=_.first(e.dataViews);if(i){var s=i.metadata&&i.metadata.objects,l=(0,g.NA)(s,a.A.scorecard.scorecardReference);this.scorecardId=null===(t=l?.byReference)||void 0===t?void 0:t.itemId;var m=this.scorecardId;this.settings=this.generateScorecardSettings(s),this.scorecardEmbed.goalIds=_.map(this.settings.filters,function(u){return u.goalId}),m&&_.isEmpty(this.scorecardEmbed.goalIds)&&"list"!==this.settings.displayMode&&(this.settings.displayMode="list",this.persistDisplayMode("list")),this.displayMode=this.featureSwitches.singleGoalVisual?null!==(r=this.settings.displayMode)&&void 0!==r?r:"tile":"list",this.updateDisplayPickerOption(this.displayMode),m?(m!==this.scorecardEmbed.scorecardId?this.scorecardEmbed.embedScorecard(m,this.settings):this.scorecardEmbed.updateSettings(this.settings),this.setVisualState(1)):(this.scorecardEmbed.embedScorecard(void 0,this.settings),this.showSplashScreen(this.isInFocus)),this.scorecardEmbed.scorecardId=m}},o.prototype.viewModeChanged=function(e){var t,r;if(1===e?(null===(t=this.emptyStateOverlay)||void 0===t||t.find(".overlayButton").removeAttr("disabled"),this.splashScreenOverlay.find(".overlayButton").removeAttr("disabled")):(null===(r=this.emptyStateOverlay)||void 0===r||r.find(".overlayButton").attr("disabled",1),this.splashScreenOverlay.find(".overlayButton").attr("disabled",1)),this.settings){var i=!1,s=1===e;!this.isSingleGoalVisual&&this.settings.showReplaceScorecard!==s&&(this.settings.showReplaceScorecard=s,i=!0);var l=1!==e;this.settings.disableEdit!==l&&(this.settings.disableEdit=l,i=!0),i&&this.scorecardEmbed.updateSettings(this.settings),this.isSingleGoalVisual||this.configureCommandBarForScorecardVisual(e)}},o.prototype.configureCommandBarForScorecardVisual=function(e){var t=1!==e&&this.shouldHideCommandBarInReadModeObject;this.settings.hideCommandBar!==t&&this.scorecardEmbed.updateSettings((0,c.__assign)((0,c.__assign)({},this.settings),{hideCommandBar:t}))},o.prototype.generateScorecardSettings=function(e){var t=N.v.create(this.style),r=(0,p.Zi)(e?.scorecard,{color:"foregroundColor",family:"fontFamily",size:"fontSize"},t,this.style,"foreground","label",{color:N.v.getThemeColor(this.style,"foreground"),size:F.B.createFromPt(9),family:O.Wn.regular.family}),i={backgroundColor:t.getColorForProperty(e,a.A.scorecard.backgroundColor,"background"),neutralPrimaryColor:r.color,fontFamily:r.family,tableBackgroundColor:t.getColorForProperty(e,a.A.scorecard.tableBackgroundColor,"backgroundLight")};i.headerForegroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.header.foregroundColor,i.neutralPrimaryColor),i.headerBackgroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.header.backgroundColor,i.backgroundColor),i.tableHeaderForegroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.columnHeaders.foregroundColor,i.neutralPrimaryColor),i.tableRowBackgroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.goals.backgroundColor,i.backgroundColor),i.tableRowForegroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.goals.foregroundColor,i.neutralPrimaryColor),i.tableRowLinkColor=N.v.getThemeColor(this.style,"hyperlink"),i.detailsPaneBackgroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.detailsPane.backgroundColor,i.backgroundColor),i.detailsPaneForegroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.detailsPane.foregroundColor,i.neutralPrimaryColor),i.detailsPaneCardBackgroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.detailsPane.cardBackgroundColor,i.backgroundColor),i.detailsPaneCardForegroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.detailsPane.cardForegroundColor,i.neutralPrimaryColor),i.detailsPaneChartBackgroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.detailsPane.chartBackgroundColor,i.backgroundColor),i.detailsPaneChartForegroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.detailsPane.chartForegroundColor,i.neutralPrimaryColor),i.goalVisualBackgroundColor=t.getColorForPropertyWithDefaultColor(e,a.A.visualization.backgroundColor,i.backgroundColor),i.goalVisualTargetLineColor=t.getColorForPropertyWithDefaultColor(e,a.A.visualization.targetLineColor,"#8A8886"),i.goalVisualCurrentLineColor=t.getColorForProperty(e,a.A.visualization.currentLineColor,void 0);var s=this.host.getViewMode(),l=(0,g.NA)(e,a.A.scorecard.goalIds,void 0),m=l&&_.split(l,",");i.goalVisualScorecardName=(0,p.Zi)(e?.visualization,{color:"scorecardNameFontColor",family:"scorecardNameFontFamily",size:"scorecardNameFontSize",bold:"scorecardNameBold",italic:"scorecardNameItalic",underline:"scorecardNameUnderline"},t,this.style,"foregroundNeutralSecondary","smallLabel",{family:r.family,size:F.B.createFromPt(12)},!0),i.goalVisualScorecardName=(0,p.xH)(i.goalVisualScorecardName);var u=(0,p.Zi)(e?.visualization,{color:"currentValueFontColor",family:"currentValueFontFamily",size:"currentValueFontSize",bold:"currentValueBold",italic:"currentValueItalic",underline:"currentValueUnderline"},t,this.style,"foreground",void 0,{family:i.fontFamily,size:F.B.createFromPt(14),weight:d.AI,style:d.AI,textDecoration:d.zu},!0);u=(0,p.xH)(u);var y=(0,g.NA)(e,a.A.visualization.currentValueBold,void 0);i.goalVisualCurrentValue=_.isUndefined(y)?(0,c.__assign)((0,c.__assign)({},u),{weight:d.en}):u,i.goalVisualTargetValue=(0,p.Zi)(e?.visualization,{color:"targetValueFontColor",family:"targetValueFontFamily",size:"targetValueFontSize",bold:"targetValueBold",italic:"targetValueItalic",underline:"targetValueUnderline"},t,this.style,"foreground",void 0,{family:i.fontFamily,size:F.B.createFromPt(11),weight:d.AI,style:d.AI,textDecoration:d.zu},!0),i.goalVisualTargetValue=(0,p.xH)(i.goalVisualTargetValue),i.goalVisualGrowth=(0,p.Zi)(e?.visualization,{color:"growthFontColor",family:"growthFontFamily",size:"growthFontSize",bold:"growthBold",italic:"growthItalic",underline:"growthUnderline"},t,this.style,"foreground","smallLabel",{family:r.family,size:r.size},!0),i.goalVisualGrowth=(0,p.xH)(i.goalVisualGrowth);var C=(0,p.Zi)(e?.visualization,{color:"goalNameFontColor",family:"goalNameFontFamily",size:"goalNameFontSize",bold:"goalNameBold",italic:"goalNameItalic",underline:"goalNameUnderline"},t,this.style,"foreground","smallLabel",{family:r.family,size:r.size},!0);C=(0,p.xH)(C);var h=(0,g.NA)(e,a.A.visualization.goalNameBold,void 0);i.goalVisualGoalName=_.isUndefined(h)?(0,c.__assign)((0,c.__assign)({},C),{weight:d.en}):C,i.goalVisualDueDate=(0,p.Zi)(e?.visualization,{color:"dueDateFontColor",family:"dueDateFontFamily",size:"dueDateFontSize",bold:"dueDateBold",italic:"dueDateItalic",underline:"dueDateUnderline"},t,this.style,"foreground","smallLabel",{family:r.family,size:r.size},!0),i.goalVisualDueDate=(0,p.xH)(i.goalVisualDueDate),i.goalVisualNotes=(0,p.Zi)(e?.visualization,{color:"notesFontColor",size:"notesFontSize"},t,this.style,"foreground","largeLabel",{size:F.B.createFromPt(12)},!0),i.goalVisualNotes=(0,p.xH)(i.goalVisualNotes),i.goalVisualXAxis=(0,p.Zi)(e?.visualization,{color:"xAxisFontColor",family:"xAxisFontFamily",size:"xAxisFontSize",bold:"xAxisBold",italic:"xAxisItalic",underline:"xAxisUnderline"},t,this.style,"foreground","smallLightLabel",{family:r.family,size:r.size},!0),i.goalVisualXAxis=(0,p.xH)(i.goalVisualXAxis),i.goalVisualYAxis=(0,p.Zi)(e?.visualization,{color:"yAxisFontColor",family:"yAxisFontFamily",size:"yAxisFontSize",bold:"yAxisBold",italic:"yAxisItalic",underline:"yAxisUnderline"},t,this.style,"foreground","smallLightLabel",{family:r.family,size:r.size},!0),i.goalVisualYAxis=(0,p.xH)(i.goalVisualYAxis),this.shouldHideCommandBarInReadModeObject=!(0,g.NA)(e,a.A.scorecard.showCommandBar,!0);var b={showReplaceScorecard:1===s,disableEdit:1!==s,dockCommandBarToBottom:!0,allowMissingId:!0,alwaysMaximize:!0,autoHideCommandBar:!0,handleExternalLinks:!0,hideCommandBar:this.shouldHideCommandBarInReadModeObject,hideChatInTeams:!0,hideShare:!0,hideAddFavorite:!0,hideScorecardHeader:!(0,g.NA)(e,a.A.header.show,!0),hideGoalCards:!(0,g.NA)(e,a.A.header.showCards,!0),hideScorecardTitle:!(0,g.NA)(e,a.A.header.showTitle,!0),hideScorecardToolbar:!(0,g.NA)(e,a.A.header.showToolbar,!0),hideColumnHeaders:!(0,g.NA)(e,a.A.columnHeaders.show,!0),hidePowerAutomate:!1,hideFileMenu:!0,showOpenInService:!0,showTutorialDialogs:!0,theme:i,displayMode:(0,g.NA)(e,a.A.scorecard.displayMode),filters:_.map(m,function(V){return{goalId:V}}),showGoalVisualScorecardName:(0,g.NA)(e,a.A.visualization.showScorecardName,!1),showGoalVisualGrowth:(0,g.NA)(e,a.A.visualization.showGrowth,!1),showGoalVisualGoalName:(0,g.NA)(e,a.A.visualization.showGoalName,!0),showGoalVisualOwner:(0,g.NA)(e,a.A.visualization.showOwner,!0),goalVisualOwnerPhotoSize:(0,g.NA)(e,a.A.visualization.ownerPhotoSize,20),showGoalVisualDueDate:(0,g.NA)(e,a.A.visualization.showDueDate,!0),showGoalVisualStatus:(0,g.NA)(e,a.A.visualization.showStatus,!0),showGoalVisualNotes:(0,g.NA)(e,a.A.visualization.showNotes,!0),currentAreaShaded:(0,g.NA)(e,a.A.visualization.currentAreaShaded,!0),showVisualization:(0,g.NA)(e,a.A.visualization.showVisualization,!0),showGoalVisualLegends:(0,g.NA)(e,a.A.visualization.showLegends,!1),showGoalVisualTargetLine:(0,g.NA)(e,a.A.visualization.showTargetLine,!1),showGoalVisualXAxis:(0,g.NA)(e,a.A.visualization.showXAxis,!0),showGoalVisualYAxis:(0,g.NA)(e,a.A.visualization.showYAxis,!0),layoutTheme:null};return(0,c.__assign)((0,c.__assign)({},b),this.scorecardSettingsOverride)},o.prototype.enumerateObjectInstances=function(e){if(this.settings){var t=new U.G;switch(e.objectName){case"scorecard":t.pushInstance({objectName:"scorecard",properties:{scorecardId:this.scorecardId,fontFamily:this.settings.theme.fontFamily,tableBackgroundColor:this.settings.theme.tableBackgroundColor,showCommandBar:!this.settings.hideCommandBar},selector:null});break;case"header":t.pushInstance({objectName:"header",properties:{show:!this.settings.hideScorecardHeader,showTitle:!this.settings.hideScorecardTitle,showToolbar:!this.settings.hideScorecardToolbar,showCards:!this.settings.hideGoalCards,backgroundColor:this.settings.theme.headerBackgroundColor,foregroundColor:this.settings.theme.headerForegroundColor},selector:null});break;case"columnHeaders":t.pushInstance({objectName:"columnHeaders",properties:{show:!this.settings.hideColumnHeaders,foregroundColor:this.settings.theme.tableHeaderForegroundColor},selector:null});break;case"goals":t.pushInstance({objectName:"goals",properties:{backgroundColor:this.settings.theme.tableRowBackgroundColor,foregroundColor:this.settings.theme.tableRowForegroundColor},selector:null});break;case"detailsPane":t.pushInstance({objectName:"detailsPane",properties:{backgroundColor:this.settings.theme.detailsPaneBackgroundColor,foregroundColor:this.settings.theme.detailsPaneForegroundColor,chartBackgroundColor:this.settings.theme.detailsPaneChartBackgroundColor,chartForegroundColor:this.settings.theme.detailsPaneChartForegroundColor,cardBackgroundColor:this.settings.theme.detailsPaneCardBackgroundColor,cardForegroundColor:this.settings.theme.detailsPaneCardForegroundColor},selector:null});break;case"visualization":t.pushInstance({objectName:"visualization",properties:{backgroundColor:this.settings.theme.goalVisualBackgroundColor,showScorecardName:this.settings.showGoalVisualScorecardName,scorecardNameFontFamily:this.settings.theme.goalVisualScorecardName.family,scorecardNameFontSize:this.settings.theme.goalVisualScorecardName.size,scorecardNameFontColor:this.settings.theme.goalVisualScorecardName.color,scorecardNameBold:this.settings.theme.goalVisualScorecardName.weight===d.en,scorecardNameItalic:this.settings.theme.goalVisualScorecardName.style===d.BF,scorecardNameUnderline:this.settings.theme.goalVisualScorecardName.textDecoration===d.f0,currentValueFontFamily:this.settings.theme.goalVisualCurrentValue.family,currentValueFontSize:this.settings.theme.goalVisualCurrentValue.size,currentValueFontColor:this.settings.theme.goalVisualCurrentValue.color,currentValueBold:this.settings.theme.goalVisualCurrentValue.weight,currentValueItalic:this.settings.theme.goalVisualCurrentValue.style===d.BF,currentValueUnderline:this.settings.theme.goalVisualCurrentValue.textDecoration===d.f0,targetValueFontFamily:this.settings.theme.goalVisualTargetValue.family,targetValueFontSize:this.settings.theme.goalVisualTargetValue.size,targetValueFontColor:this.settings.theme.goalVisualTargetValue.color,targetValueBold:this.settings.theme.goalVisualTargetValue.weight===d.en,targetValueItalic:this.settings.theme.goalVisualTargetValue.style===d.BF,targetValueUnderline:this.settings.theme.goalVisualTargetValue.textDecoration===d.f0,showGrowth:this.settings.showGoalVisualGrowth,growthFontFamily:this.settings.theme.goalVisualGrowth.family,growthFontSize:this.settings.theme.goalVisualGrowth.size,growthFontColor:this.settings.theme.goalVisualGrowth.color,growthBold:this.settings.theme.goalVisualGrowth.weight===d.en,growthItalic:this.settings.theme.goalVisualGrowth.style===d.BF,growthUnderline:this.settings.theme.goalVisualGrowth.textDecoration===d.f0,showGoalName:this.settings.showGoalVisualGoalName,goalNameFontFamily:this.settings.theme.goalVisualGoalName.family,goalNameFontSize:this.settings.theme.goalVisualGoalName.size,goalNameFontColor:this.settings.theme.goalVisualGoalName.color,goalNameBold:this.settings.theme.goalVisualGoalName.weight===d.en,goalNameItalic:this.settings.theme.goalVisualGoalName.style===d.BF,goalNameUnderline:this.settings.theme.goalVisualGoalName.textDecoration===d.f0,showOwner:this.settings.showGoalVisualOwner,ownerPhotoSize:this.settings.goalVisualOwnerPhotoSize,showDueDate:this.settings.showGoalVisualDueDate,dueDateFontFamily:this.settings.theme.goalVisualDueDate.family,dueDateFontSize:this.settings.theme.goalVisualDueDate.size,dueDateFontColor:this.settings.theme.goalVisualDueDate.color,dueDateBold:this.settings.theme.goalVisualDueDate.weight===d.en,dueDateItalic:this.settings.theme.goalVisualDueDate.style===d.BF,dueDateUnderline:this.settings.theme.goalVisualDueDate.textDecoration===d.f0,showStatus:this.settings.showGoalVisualStatus,showNotes:this.settings.showGoalVisualNotes,notesFontSize:this.settings.theme.goalVisualNotes.size,notesFontColor:this.settings.theme.goalVisualNotes.color,showVisualization:this.settings.showVisualization,showLegends:this.settings.showGoalVisualLegends,showTargetLine:this.settings.showGoalVisualTargetLine,targetLineColor:this.settings.theme.goalVisualTargetLineColor,currentLineColor:this.settings.theme.goalVisualCurrentLineColor,currentAreaShaded:this.settings.currentAreaShaded,showXAxis:this.settings.showGoalVisualXAxis,xAxisFontFamily:this.settings.theme.goalVisualXAxis.family,xAxisFontSize:this.settings.theme.goalVisualXAxis.size,xAxisFontColor:this.settings.theme.goalVisualXAxis.color,xAxisBold:this.settings.theme.goalVisualXAxis.weight===d.en,xAxisItalic:this.settings.theme.goalVisualXAxis.style===d.BF,xAxisUnderline:this.settings.theme.goalVisualXAxis.textDecoration===d.f0,showYAxis:this.settings.showGoalVisualYAxis,yAxisFontFamily:this.settings.theme.goalVisualYAxis.family,yAxisFontSize:this.settings.theme.goalVisualYAxis.size,yAxisFontColor:this.settings.theme.goalVisualYAxis.color,yAxisBold:this.settings.theme.goalVisualYAxis.weight===d.en,yAxisItalic:this.settings.theme.goalVisualYAxis.style===d.BF,yAxisUnderline:this.settings.theme.goalVisualYAxis.textDecoration===d.f0},selector:null})}return t.complete()}},o.prototype.getFormattingModel=function(){return new R(this.host,this.featureSwitches).getFormattingModel(this.scorecardId,this.settings)},o.prototype.onDataViewObjectChanged=function(e,t){return e&&1===e.length&&e[0].objectName===a.A.scorecard.scorecardId.objectName&&e[0].propertyName===a.A.scorecard.scorecardId.propertyName?[{objectName:a.A.scorecard.scorecardReference.objectName,propertyName:a.A.scorecard.scorecardReference.propertyName,propertyType:{itemLocation:{}},propertyValue:{byReference:{itemId:M(e[0].propertyValue)}}}]:e},o.prototype.getSettings=function(){return this.settings},Object.defineProperty(o.prototype,"scorecardVisualType",{get:function(){switch(this.settings.displayMode){case"list":return"SingleMetricVisual";case"tile":return"MultipleMetricsVisual";default:return w.fF.assertNever(this.settings.displayMode),""}},enumerable:!1,configurable:!0}),o.prototype.showSplashScreen=function(e){this.scorecardEmbed.reset(e),this.setVisualState(this.featureSwitches.singleGoalVisual&&!e?2:0)},o.prototype.buildSignInOverlay=function(){var e={actions:[],description:this.host.getLocalizedString("ScorecardVisual_SignRequired_Info"),title:this.host.getLocalizedString("Desktop_FileMenu_SignInDescription")};this.featureSwitches.singleGoalVisual&&(e.description=void 0,e.title=this.host.getLocalizedString("ScorecardVisual_SignRequired_ForMetricVisual_Info")),this.signInOverlay=this.buildOverlay(o.SignInOverlay,e)},o.prototype.buildAddScorecardOverlay=function(){var e=this,i={actions:[{action:function(){e.setVisualState(1),e.scorecardEmbed.createScorecard(e.featureSwitches.goalsDraftScorecards)},isPrimary:!0,text:this.host.getLocalizedString("ScorecardVisual_CreateNewScorecard")},{action:function(){e.setVisualState(1),e.scorecardEmbed.showPicker()},isPrimary:!1,text:this.host.getLocalizedString("ScorecardVisual_ConnectToScorecard")}],description:this.host.getLocalizedString("ScorecardVisual_AddScorecard_Description"),title:this.host.getLocalizedString("ScorecardVisual_AddScorecard")};this.splashScreenOverlay=this.buildOverlay(o.AddScorecardOverlay,i)},o.prototype.buildDisplayModePickerOverlay=function(){var e=this,s={actions:[{action:function(){e.setVisualState(1),e.persistDisplayMode(e.displayMode),e.updateSettings({displayMode:e.displayMode,showPickerToolbar:"tile"===e.displayMode,disableEdit:"tile"===e.displayMode},!0),e.host.telemetry().trace(2,"ScorecardBrowseFor".concat(e.scorecardVisualType)),e.scorecardEmbed.showPicker()},isPrimary:!1,text:this.host.getLocalizedString("Scorecard_ViewMode_BrowseMetrics")},{action:function(){switch(e.setVisualState(1),e.persistDisplayMode(e.displayMode),e.updateSettings({displayMode:e.displayMode},!0),e.host.telemetry().trace(2,"ScorecardCreate".concat(e.scorecardVisualType)),e.settings.displayMode){case"list":e.scorecardEmbed.createScorecard(e.featureSwitches.goalsDraftScorecards);break;case"tile":e.scorecardEmbed.createGoal();break;default:w.fF.assertNever(e.settings.displayMode)}},isPrimary:!0,text:this.host.getLocalizedString("Scorecard_ViewMode_CreateNew")},{action:function(){e.host.telemetry().trace(2,"ScorecardDisplayModePickerCanceled"),e.host.onSwitchFocusModeState(!1)},isPrimary:!1,text:this.host.getLocalizedString("PBI_Button_Label_Cancel")}],description:this.host.getLocalizedString("Scorecard_ViewMode_Description"),title:this.host.getLocalizedString("Scorecard_ViewMode_Title")},l=$("<div>").addClass("content"),m=$("<div>").addClass("display-mode-option").on("click",function(){e.displayMode="tile"}),u=T.b$.generateGuid(),y=$('<input type="radio" name="displayMode" class="display-mode-option-radio" checked="true">').attr("id",u).attr("value","tile");m.append(y);var C=$("<label>").addClass("display-mode-option-label").attr("for",u);m.append(C);var h=$("<div>").addClass("sample-visual-background-image sample-single-goal-background");C.append(h);var b,v=$("<div>").addClass("sample-image single-goal-sample-image");h.append(v),b=this.host.getLocalizedString(this.featureSwitches.multipleGoalTilesVisual?"ScorecardVisual_DisplayModeOption_AddMetricVisual":"ScorecardVisual_DisplayModeOption_AddSingleMetric");var V=$('<p class="display-mode-option-label-text">').text(b);C.append(V),l.append(m);var D=$("<div>").addClass("display-mode-option").on("click",function(){e.displayMode="list"}),L=T.b$.generateGuid(),k=$('<input type="radio" name="displayMode" class="display-mode-option-radio">').attr("id",L).attr("value","list");D.append(k);var P=$("<label>").addClass("display-mode-option-label").attr("for",L);D.append(P);var E=$("<div>").addClass("sample-visual-background-image sample-multiple-goals-background");P.append(E);var Y=$("<div>").addClass("sample-image multiple-goals-sample-image");E.append(Y);var W=this.host.getLocalizedString("ScorecardVisual_DisplayModeOption_AddMetricsList"),Z=$('<p class="display-mode-option-label-text">').text(W);P.append(Z),l.append(D),this.splashScreenOverlay=this.buildOverlay(o.DisplayModePickerOverlay,s,l),this.featureSwitches.singleGoalVisual||(m.hide(),k.hide()),this.updateDisplayPickerOption=function(z){return"tile"===z?y.attr("checked","true"):k.attr("checked","true")}},o.prototype.buildEmptyStateOverlay=function(){var e=this,t=$("<div>").addClass(o.EmptyStateOverlay.class),r=$("<div>").addClass("sample-visual-background-image");t.append(r);var i=$("<div>").addClass("thumbnail-metric-image");r.append(i);var s=$("<div>").addClass("content");t.append(s);var l=$("<div>").addClass("title").text(this.host.getLocalizedString("Scorecard_MetricVisual_TrackMetrics"));s.append(l);var m=$("<span>").addClass("description").text(this.host.getLocalizedString("ScorecardVisual_AddScorecard_Description"));s.append(m);var y=$("<button>").text(this.host.getLocalizedString("Scorecard_MetricVisual_AddMetrics")).addClass("pbi-fluent-button overlayButton primary").attr("disabled",1).on(A.G6,function(){e.host.telemetry().trace(2,"ScorecardVisualWorkflowStarted"),e.showSplashScreen(!0)});s.append(y),t.hide(),this.container.append(t),this.emptyStateOverlay=t},o.prototype.getSignInReady=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var e,t=this;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return[4,this.refreshToken()];case 1:return r.sent(),this.authenticationService.signInStatus$&&(e=this.authenticationService.signInStatus$.subscribe(function(i){return t.onSignInChange(i)}),this.subscriptions.push(e)),[2]}})})},o.prototype.refreshToken=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var e;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.authenticationService.getSignedInAccessToken()];case 1:return e=r.sent(),this.scorecardEmbed.setAccessToken(e),this.setupTokenRefresh(e),[3,3];case 2:return r.sent(),[3,3];case 3:return(_.isUndefined(this.isSignedIn)||this.isSignedIn===!e)&&this.updateSignInVisualState(!!e),[2]}})})},o.prototype.setupTokenRefresh=function(e){var t=this;if(null!=e){var r=this.getParsedJwt(e);if(void 0!==r&&null!=r.exp){clearTimeout(this.tokenRefreshTimeoutId);var i=1e3*r.exp-(new Date).getTime()-B.tokenExpiryBufferInMs;this.tokenRefreshTimeoutId=setTimeout(function(){t.refreshToken()},Math.max(i,B.minTokenPollingIntervalInMs))}}},o.prototype.onSignInChange=function(e){var t=e.accessToken;e.isSignedIn?(this.isSignedIn||this.scorecardEmbed.init(this.settings),this.scorecardEmbed.setAccessToken(t),this.setupTokenRefresh(t)):clearTimeout(this.tokenRefreshTimeoutId),this.updateSignInVisualState(e.isSignedIn)},o.prototype.getParsedJwt=function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch{return}},o.prototype.updateSignInVisualState=function(e){this.isSignedIn=e,this.scorecardEmbed.scorecardId?(this.scorecardEmbed.embedScorecard(this.scorecardEmbed.scorecardId,this.settings),this.setVisualState(1)):this.showSplashScreen(this.isInFocus)},o.prototype.setVisualState=function(e){var t,r,i,s;if(!this.isSignedIn)return this.signInOverlay.show(),this.splashScreenOverlay.hide(),null===(t=this.emptyStateOverlay)||void 0===t||t.hide(),void this.scorecardEmbed.iFrame.hide();switch(e){case 0:this.splashScreenOverlay.show(),this.scorecardEmbed.iFrame.hide(),this.signInOverlay.hide(),null===(r=this.emptyStateOverlay)||void 0===r||r.hide();break;case 1:this.scorecardEmbed.iFrame.show(),this.splashScreenOverlay.hide(),this.signInOverlay.hide(),null===(i=this.emptyStateOverlay)||void 0===i||i.hide();break;case 2:null===(s=this.emptyStateOverlay)||void 0===s||s.show(),this.scorecardEmbed.iFrame.hide(),this.splashScreenOverlay.hide(),this.signInOverlay.hide()}},o.prototype.buildOverlay=function(e,t,r){var i=$("<div>").addClass(e.class),s=$("<p>").addClass("title").text(t.title);i.append(s);var l=$("<p>").addClass("description").text(t.description);i.append(l);var m=$("<a>",{text:this.host.getLocalizedString("Scorecard_Visual_LearnMore"),target:"_blank",href:"https://go.microsoft.com/fwlink/?linkid=2201389"});l.append(m);var u=$("<div>").addClass("overlayButtons");r&&(i.append(r),u.addClass("with-top-border")),i.append(u);for(var y=0,C=t.actions;y<C.length;y++){var h=C[y],v=$("<button>").text(h.text).attr("disabled",1).addClass("pbi-fluent-button overlayButton").on(A.G6,h.action);v.addClass(h.isPrimary?"primary":"nonPrimary"),u.append(v)}return i.hide(),this.container.append(i),i},o.prototype.handleEmbedEvent=function(e){var t,r;switch(e){case 0:this.scorecardEmbed.scorecardId=void 0,this.host.onSwitchFocusModeState(!1),this.showSplashScreen(!1);break;case 1:this.scorecardId=M(this.scorecardEmbed.getScorecardUrl());var i={merge:[{objectName:a.A.scorecard.scorecardReference.objectName,properties:(t={},t[a.A.scorecard.scorecardReference.propertyName]={byReference:{itemId:this.scorecardId}},t),selector:null}]};this.host.persistProperties(i);break;case 2:this.scorecardEmbed.showPicker(),this.setVisualState(1);break;case 3:var l={merge:[{objectName:a.A.scorecard.goalIds.objectName,properties:(r={},r[a.A.scorecard.goalIds.propertyName]=this.scorecardEmbed.goalIds.toString(),r),selector:null}]};this.host.persistProperties(l),this.updateSettings({filters:_.map(this.scorecardEmbed.goalIds,function(m){return{goalId:m}}),restoreGoalTile:!0},!0),this.scorecardEmbed.showGoalVisual(this.settings);break;case 4:this.host.onSwitchFocusModeState(!0),this.updateSettings({displayMode:"list",openGoalDetailsType:"notes",restoreGoalTile:!0,hideCommandBar:!1,showReplaceScorecard:!1,hidePowerAutomate:!0,showPickerToolbar:!0},!0),this.scorecardEmbed.openGoalNotes(this.settings);break;case 5:this.host.onSwitchFocusModeState(!0),this.updateSettings({isEditingGoal:!0,displayMode:"list",restoreGoalTile:!0,hideCommandBar:!1,showReplaceScorecard:!1,hidePowerAutomate:!0,showPickerToolbar:!0},!0),this.scorecardEmbed.restoreScorecard();break;case 6:this.scorecardEmbed.clickContainer()}},o.prototype.updateSettings=function(e,t){void 0===t&&(t=!0),e=e||{},this.settings=t?(0,c.__assign)((0,c.__assign)({},this.settings),e):e,this.scorecardEmbed.updateSettings(this.settings)},o.prototype.persistDisplayMode=function(e){var t,r={merge:[{objectName:a.A.scorecard.displayMode.objectName,properties:(t={},t[a.A.scorecard.displayMode.propertyName]=e,t),selector:null}]};this.host.persistProperties(r)},o.ScorecardContainer=(0,d.CH)("scorecardContainer"),o.SignInOverlay=(0,d.CH)("signInOverlay"),o.AddScorecardOverlay=(0,d.CH)("addScorecardOverlay"),o.DisplayModePickerOverlay=(0,d.CH)("displayModePickerOverlay"),o.EmptyStateOverlay=(0,d.CH)("emptyStateOverlay"),o}();function M(o){var e=_.toLower(_.trim(o));return(0,x.HH)(e,!1)?e.split("/scorecards/")[1]:e}}}]);