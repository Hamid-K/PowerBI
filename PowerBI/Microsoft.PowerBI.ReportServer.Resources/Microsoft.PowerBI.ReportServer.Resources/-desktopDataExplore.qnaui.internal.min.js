"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["qnaui.internal"],{70940:function(rt,be,u){u.d(be,{s:function(){return H}});var m=u(47508),A=u(45034),K=new A.o(function(){var P={};return P[3]=m.L.card,P[13]=m.L.lineClusteredColumnComboChart,P[29]=m.L.multiRowCard,P[7]=m.L.clusteredBarChart,P[10]=m.L.clusteredColumnChart,P[20]=m.L.donutChart,P[16]=m.L.funnel,P[30]=m.L.gauge,P[22]=m.L.heatMap,P[9]=m.L.hundredPercentStackedBarChart,P[12]=m.L.hundredPercentStackedColumnChart,P[4]=m.L.lineChart,P[1]=m.L.map,P[19]=m.L.filledMap,P[2]=m.L.pivotTable,P[5]=m.L.pieChart,P[6]=m.L.scatterChart,P[8]=m.L.barChart,P[11]=m.L.columnChart,P[0]=m.L.tableEx,P[17]=m.L.treemap,P[23]=m.L.waterfallChart,P[26]=m.L.stackedAreaChart,P[27]=m.L.hundredPercentStackedAreaChart,P[32]=m.L.areaChart,P[33]=m.L.ribbonChart,P[34]=m.L.kpi,P[35]=m.L.decompositionTreeVisual,P});function H(P){return K.getValue()[P]}new A.o(function(){var P={};return P[m.L.card.name]=3,P[m.L.lineClusteredColumnComboChart.name]=13,P[m.L.multiRowCard.name]=29,P[m.L.clusteredBarChart.name]=7,P[m.L.clusteredColumnChart.name]=10,P[m.L.donutChart.name]=20,P[m.L.funnel.name]=16,P[m.L.gauge.name]=30,P[m.L.heatMap.name]=22,P[m.L.hundredPercentStackedBarChart.name]=9,P[m.L.hundredPercentStackedColumnChart.name]=12,P[m.L.lineChart.name]=4,P[m.L.map.name]=1,P[m.L.filledMap.name]=19,P[m.L.matrix.name]=2,P[m.L.pivotTable.name]=2,P[m.L.pieChart.name]=5,P[m.L.scatterChart.name]=6,P[m.L.barChart.name]=8,P[m.L.columnChart.name]=11,P[m.L.table.name]=0,P[m.L.tableEx.name]=0,P[m.L.treemap.name]=17,P[m.L.waterfallChart.name]=23,P[m.L.stackedAreaChart.name]=26,P[m.L.hundredPercentStackedAreaChart.name]=27,P[m.L.areaChart.name]=32,P[m.L.ribbonChart.name]=33,P[m.L.kpi.name]=34,P[m.L.decompositionTreeVisual.name]=35,P})},30669:function(rt,be,u){u.r(be),u.d(be,{QnaUIInternalModule:function(){return wa}});var m=u(77476),A=u(52910),K=u(76966),W=u(558),H=u(22346),z=u(76521),P=u(82156),Pe=u(79061),J=u(20914),he=u(35911),ce=u(16095),Be=u(22760),Oe=u(1931),ue=u(4633),$e=u(47768),We=u(90938),dt=u(47231),b=u(81337),de=u(14172),oe=u(83317),Xe=u(30794),q=u(73446),C=u(62458),e=u(50423),te=u(43286),le=u(37320),L=u(16808),M=u(72129),w=u(282),F=u(48787),B=u(17653),G=u(57243),N=u(77526),X=u(83495),ie=u(18353),ne=u(59973),me=u(81905),ze=u(46358),Ne=u(23558),Y=u(35510),Te=u(59787),xe=u(11547),Ue=u(59017),Ae=u(40133),De=u(82762),Ve=u(63057),pt=u(35988),gt=u(1521),xt=u(87632),It=u(59107),tt=u(32105),$t=u(65947),Ft=u(12123),ln=u(87974),Me=u(38078);function Kt(i){i.remove?i.remove():i.parentNode&&i.parentNode.removeChild?i.parentNode.removeChild(i):C.fF.assertFail("No remove element API found")}function Bt(i){return i.isComposing||229===i.keyCode}function cn(i){if(C.fF.assertValue(i,"response"),!_.isEmpty(i.utterance)){for(var n=i.utterance,t=[],o=0,r=_.first(i.results),s=0,l=r&&r.spans||[];s<l.length;s++){var g=l[s];if(o<g.startIndex){var c=v(n,o,g.startIndex);t.push.apply(t,c||[])}t.push(g),o=g.endExcludingIndex}if(o<n.length){var p=v(n,o,n.length);t.push.apply(t,p||[])}return t}}function Ke(i){return i&&i.replace(/\s/g," ")}function d(i,n){if(i){if(i.nodeType===Node.TEXT_NODE)return i;for(var t=i.childNodes,o=_.size(t),a=0,s=n?_.range(0,o):_.range(o-1,-1,-1);a<s.length;a++){var c=d(t[s[a]],n);if(c)return c}}}function v(i,n,t){for(var o=[],r=n;r<t;){var a=r,s=void 0,l=void 0;if(/\s/.test(i.charAt(r)))l=!0,s=a+1,r++;else{l=!1;var g=i.indexOf(" ",r);s=g=g>-1?Math.min(g,t):t,r=g}var c=i.substring(a,s);o.push({startIndex:a,endExcludingIndex:s,text:c,isWhiteSpace:l,isOverlapping:!1,isCorrected:!1,isUnknown:!1,isUsed:!1,state:"none"})}return o}function S(i,n){if(C.fF.assertValue(i,"The given node must be defined"),C.fF.assertValue(n>=0,"The given nodeTextContentOffset must be >= 0"),C.fF.assert(function(){return i.nodeType!==Node.COMMENT_NODE},"Expect the given node is NOT a comment node"),0===n)return{node:d(i,!0)||i,textOrChildNodesOffset:0};if(n>i.textContent.length)return{node:void 0,textOrChildNodesOffset:-1};if(_.isEmpty(i.childNodes))return C.fF.assert(function(){return i.nodeType===Node.TEXT_NODE},"0 < nodeTextContentOffset <= node.textContent.length, and node has no childNodes, then node should be a TEXT_NODE"),{node:i,textOrChildNodesOffset:n};for(var r=n,a=0;a<i.childNodes.length;a++){var s=i.childNodes.item(a);if(s.nodeType!==Node.COMMENT_NODE){var l=s.textContent.length;if(r>l){r-=l;continue}if(s.nodeType===Node.TEXT_NODE)return{node:s,textOrChildNodesOffset:r};if(r===l){var g=d(s,!1);return g?{node:g,textOrChildNodesOffset:g.textContent.length}:{node:i,textOrChildNodesOffset:a+1}}return S(s,r)}}C.fF.assertFail("nodeTextContentOffset <= node.textContent.length, there should be a descendant (or same) Node that the given position lands on")}function O(i,n){return!(!i||!n)&&(i===n||(n.nodeType===Node.ELEMENT_NODE?i.contains(n):O(i,n.parentNode)))}var pe=u(41114),ge="PBI.QnaVisual.Initialized",Qe=pe.cx[ge]=(0,pe.b1)(ge,{logExpAssignment:!0}),vt="PBI.QnaAutoComplete.Initialized",nt=pe.cx[vt]=(0,pe.b1)(vt),at="PBI.QnaAutoComplete.DropdownSelected",ht=pe.cx[at]=(0,pe.b1)(at),Ct="PBI.ImproveLsdlBackground.Login",dn=pe.cx[Ct]=(0,pe.b1)(Ct),pn="PBI.ImproveLsdlBackground.Prompt",gn=pe.cx[pn]=(0,pe.b1)(pn),Ye="PBI.ImproveLsdlBackground.Result",ft=pe.cx[Ye]=(0,pe.b1)(Ye);function hn(i,n){var t=0,o=[];return _.forEach(i,function(r,a){var s;r.title&&t++;var l=n-t;return l<=0?_.take(i,a):_.size(r.groupItems)<=l?(t+=_.size(r.groupItems),void o.push({title:r.title,groupItems:(0,b.__spreadArray)([],null!==(s=r?.groupItems)&&void 0!==s?s:[],!0)})):(o.push({title:r.title,groupItems:_.take(r.groupItems,l)}),o)}),o}function ot(i,n,t,o,r){C.fF.assert(function(){return!_.isEmpty(t)},"Expect the given bindingCategories NOT empty!"),C.fF.assertValue(o,"uniqueItemsTextList must be defined already");var a=i[n];C.fF.assertValue(a,"spans[selectedSpanIndex] must be defined!");var s=[];return _.forEach(t,function(l){var g=function(i,n){var t=i.replacementBindings;switch(n){case 1:return t&&t.alternates;case 2:return t&&t.phraseCompletions;case 3:return t&&t.suggestedReplacements;case 0:return i.binding?[i.binding]:[];case 4:return t&&t.phraseExtensions;default:return void C.fF.assertFail("Unhandled SpanBindingCategory value")}}(a,l),c=[];_.forEach(g,function(p){c.push({segments:p.textSegmentsWithMatchInfo,score:p.score,bindingCategory:l})}),c.sort(function(p,f){return f.score-p.score}),s.push.apply(s,c)}),mt(i,n,s,o,r)}function mt(i,n,t,o,r){var a=[],s=i[n];if(_.forEach(t,function(y){var E=[];_.forEach(i,function(D,k){k!==n?E.push({text:D.text,isMatched:!0}):(C.fF.assertValue(_.isEmpty(y)||y.segments,"selectedSpanOneBindingText.segments"),_.isEmpty(y)||E.push.apply(E,y.segments||[]))}),yt(E,a,o,y.score)}),!(_.findIndex(t,function(y){return 0===y.bindingCategory})>=0||_.isEmpty(s.overlapSpans))){var g=Math.max(0,_.findLastIndex(t,function(y){return 1===y.bindingCategory})),c=function(i,n,t,o){var r=[],a=_.map(i,function(g){return g.text}).join("");return _.isEmpty(i[n].overlapSpans)||(i[n].overlapSpans=_.filter(i[n].overlapSpans,function(g){return _.inRange(o,g.startIndex,g.endExcludingIndex+1)})),_.forEach(i[n].overlapSpans,function(g){var c=[],p=0;_.forEach(i,function(y){y.endExcludingIndex<=g.startIndex?(c.push({text:y.text,isMatched:!0}),p++):y.startIndex<g.endExcludingIndex?(y.startIndex<g.startIndex&&(c.push({text:a.substring(y.startIndex,g.startIndex),isMatched:!0}),p++),g.endExcludingIndex<y.endExcludingIndex&&c.push({text:a.substring(g.endExcludingIndex,y.endExcludingIndex),isMatched:!0})):c.push({text:y.text,isMatched:!0})}),_.forEach(g.replacementBindings&&g.replacementBindings.alternates,function(y){for(var E=_.cloneDeep(c),D=y.textSegmentsWithMatchInfo,k=D.length-1;k>=0;k--)E.splice(p,0,D[k]);yt(E,r,t,y.score)})}),r}(i,n,o,r),p=_.slice(a,0,g),f=(0,b.__spreadArray)((0,b.__spreadArray)([],p,!0),c,!0);f.sort(function(y,E){return E.score-y.score}),a=(0,b.__spreadArray)((0,b.__spreadArray)([],f,!0),_.slice(a,g),!0)}return a}function yt(i,n,t,o){var r=_.map(i,function(a){return a.text}).join("");-1===_.indexOf(t,r)&&(t.push(r),n.push({textSegments:i,text:r,score:o}))}var At=new e.InjectionToken("QnaUnknownTermService"),Jt=u(64647),Xt=u(83309),bt=u(65181),Vt=u(59968),Ut=u(44581),Yt=function(n,t,o,r,a){return{"font-size":n,"font-family":t,"font-weight":o,"font-style":r,"text-decoration":a}};function Qt(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"h4",7),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction5(2,Yt,o.presentation.value.questionFontProperties.size.px+"px",o.presentation.value.questionFontProperties.family,o.presentation.value.questionFontProperties.bold,o.presentation.value.questionFontProperties.italic,o.presentation.value.questionFontProperties.underline)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.title)}}var kt=function(n){return{matchedSegment:n}};function Lt(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",15),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){var t=n.$implicit;e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(3,kt,!t.isMatched)),e.\u0275\u0275attribute("aria-hidden",!0),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.text)}}function ae(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",13),e.\u0275\u0275template(1,Lt,2,5,"span",14),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.textSegments)}}function Bn(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",16),e.\u0275\u0275element(1,"span",17),e.\u0275\u0275elementEnd())}var Dn=function(n,t,o,r,a,s){return{backgroundColor:n,"font-size":t,"font-family":o,"font-weight":r,"font-style":a,"text-decoration":s}},Sn=function(n,t,o,r){return{selected:n,themableBackgroundColorSelected:t,showMoreItem:o,showAsGroupTitle:r}};function j(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"li",10),e.\u0275\u0275listener("mouseenter",function(){var c=e.\u0275\u0275restoreView(t).index,p=e.\u0275\u0275nextContext(2).index,f=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(f.updateHoverItemIndex(p,c))})("accessible-click",function(){var c=e.\u0275\u0275restoreView(t).$implicit,p=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(p.selectDropdownItem(c))}),e.\u0275\u0275template(1,ae,2,1,"div",11),e.\u0275\u0275template(2,Bn,2,0,"div",12),e.\u0275\u0275elementEnd()}if(2&i){var o=n.$implicit,r=n.index,a=e.\u0275\u0275nextContext(2).index,s=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction6(5,Dn,s.presentation.value.useShellTheme?"":r===s.selectedSpanIndex&&a===s.selectedGroupIndex||r===s.hoverSpanIndex&&a===s.hoverGroupIndex?s.presentation.value.hoverColor:s.presentation.value.backgroundColor,s.presentation.value.questionFontProperties.size.px+"px",s.presentation.value.questionFontProperties.family,s.presentation.value.questionFontProperties.bold,s.presentation.value.questionFontProperties.italic,s.presentation.value.questionFontProperties.underline))("ngClass",e.\u0275\u0275pureFunction4(12,Sn,r===s.selectedSpanIndex&&a===s.selectedGroupIndex||r===s.hoverSpanIndex&&a===s.hoverGroupIndex,r===s.selectedSpanIndex&&a===s.selectedGroupIndex||r===s.hoverSpanIndex&&a===s.hoverGroupIndex,o.isShowMore,o.isShowMore&&s.hasGroupTitle)),e.\u0275\u0275attribute("aria-selected",r===s.selectedSpanIndex&&a===s.selectedGroupIndex?"true":"false"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!o.isShowMore),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.isShowMore)}}function h(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"ul",8),e.\u0275\u0275template(1,j,3,17,"li",9),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.groupItems)}}function x(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"li",4),e.\u0275\u0275template(1,Qt,2,8,"h4",5),e.\u0275\u0275template(2,h,2,1,"ul",6),e.\u0275\u0275elementEnd()),2&i){var t=n.$implicit,o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction5(3,Yt,o.presentation.value.questionFontProperties.size.px+"px",o.presentation.value.questionFontProperties.family,o.presentation.value.questionFontProperties.bold,o.presentation.value.questionFontProperties.italic,o.presentation.value.questionFontProperties.underline)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.title&&(null==t.groupItems?null:t.groupItems.length)>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.groupItems)}}var I=function(n,t){return{link:n,fixRequestedText:t}},R=function(n){return{"border-top-color":n}};function U(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"span",20),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.performActionsInUnknownSpanHeader())}),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(3,I,!o.disableUnknownSpanHeaderSubtitleAction,o.isUnknownSpanHeaderForFixRequested))("innerHTML",o.unknownSpanHeaderSubtitle,e.\u0275\u0275sanitizeHtml)("ngStyle",e.\u0275\u0275pureFunction1(6,R,o.presentation.value.useShellTheme?"":o.presentation.value.questionFontProperties.color))}}function T(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"h4",18)(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,U,1,8,"span",19),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction5(3,Yt,t.presentation.value.questionFontProperties.size.px+"px",t.presentation.value.questionFontProperties.family,t.presentation.value.questionFontProperties.bold,t.presentation.value.questionFontProperties.italic,t.presentation.value.questionFontProperties.underline)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.unknownSpanHeaderTitle),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.unknownSpanHeaderSubtitle)}}var Z=function(n,t){return{backgroundColor:n,color:t}};function ee(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"ul",1),e.\u0275\u0275template(1,x,3,9,"li",2),e.\u0275\u0275template(2,T,4,9,"h4",3),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction2(3,Z,t.presentation.value.useShellTheme?"":t.presentation.value.backgroundColor,t.presentation.value.useShellTheme?"":t.presentation.value.questionFontProperties.color)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.autoCompleteViewModel.dropdownGroups),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.showUnknownSpanHeader)}}var ve=/\u00a0/g,re="qna_autocomplete_open",Q="qna_autocomplete_item",we=function(){function i(n,t,o,r,a){this.highContrastCssGenerationService=n,this.localizationService=t,this.screenReaderService=o,this.telemetryService=r,this.unknownTermService=a,this.utteranceSelected=new e.EventEmitter,this.fullyExpanded=new e.EventEmitter,this.destroy$=new Xe.xQ,this.resetSelectedIndices(),this.resetHoverIndices(),this.initializeHighContrastRules()}return i.prototype.ngOnInit=function(){var n=this;this.maxItemCountInFullExpansion=this.maxItemCountInFullExpansion>0?this.maxItemCountInFullExpansion:10,this.maxItemCountInPartialExpansion=this.maxItemCountInPartialExpansion>0?this.maxItemCountInPartialExpansion:4,C.fF.assert(function(){return n.maxItemCountInFullExpansion>=n.maxItemCountInPartialExpansion},"maxItemCountInFullExpansion is less than maxItemCountInPartialExpansion. It does not make sense so we are setting maxItemCountInFullExpansion to be maxItemCountInPartialExpansion now."),this.maxItemCountInFullExpansion=Math.max(this.maxItemCountInFullExpansion,this.maxItemCountInPartialExpansion),this.params.pipe((0,oe.R)(this.destroy$)).subscribe(function(t){return n.generateDropdownItems(t)}),this.selectPrevious.pipe((0,oe.R)(this.destroy$)).subscribe(function(){return n.moveSelectionUp()}),this.selectNext.pipe((0,oe.R)(this.destroy$)).subscribe(function(){return n.moveSelectionDown()}),this.confirmSelection.pipe((0,oe.R)(this.destroy$)).subscribe(function(){return n.selectCurrentDropdownItem()}),this.initializedTelemetryEvent=this.telemetryService.logEvent(nt),this.isInitialized=!0},i.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete(),this.screenReaderService.cancelDebounce(Q)},i.prototype.updateHoverItemIndex=function(n,t){this.resetSelectedIndices(),this.hoverGroupIndex=n,this.hoverSpanIndex=t,this.screenReaderCurrentDropdownSelection(n,t)},i.prototype.selectDropdownItem=function(n){if(this.isInitialized){if(n.isShowMore)return void this.expandAllItems();n&&n.textSegments&&(this.utteranceSelected.emit({utterance:n.text,tags:["Dropdown","Committed"]}),this.telemetryService.logChildEvent(this.initializedTelemetryEvent,ht,{spanState:this.selectedSpan.state}))}},i.prototype.performActionsInUnknownSpanHeader=function(){var n,t;return(0,b.__awaiter)(this,void 0,void 0,function(){var o,r;return(0,b.__generator)(this,function(a){switch(a.label){case 0:return this.disableUnknownSpanHeaderSubtitleAction?[2]:(o=_.map(this.params.value.spans,function(s){return s.text}).join(""),[4,this.unknownTermService.handleUnknownTerm(o,this.selectedSpan.text,this.params.value.dataSourceArray,this.params.value.exploration,null===(t=null===(n=this.params.value.config.header)||void 0===n?void 0:n.unknownSpanHeaderConfig)||void 0===t?void 0:t.actionType)]);case 1:return 0===(r=a.sent())?(this.unknownSpanHeaderSubtitle=this.localizationService.get("Qna_AutoComplete_FixRequestedLabelText"),this.disableUnknownSpanHeaderSubtitleAction=!0,this.isUnknownSpanHeaderForFixRequested=!0,this.utteranceSelected.emit({utterance:o,tags:["Dropdown","AskToAdd","Committed"],showDropdown:!0,action:r})):this.utteranceSelected.emit({utterance:void 0,action:r}),[2]}})})},Object.defineProperty(i.prototype,"hasGroupTitle",{get:function(){var t;return _.some(null===(t=this.autoCompleteViewModel)||void 0===t?void 0:t.dropdownGroups,function(o){return!_.isEmpty(o.title)})},enumerable:!1,configurable:!0}),i.prototype.expandAllItems=function(){var n=this;C.fF.assertValue(this.shouldDisplayShowMore,"Expect this be called only when this.shouldDisplayShowMore is true"),C.fF.assertValue(this.autoCompleteViewModel,"Expect this.autoCompleteViewModel to be defined"),this.shouldDisplayShowMore=!1,C.fF.assert(function(){return _.last(_.last(n.autoCompleteViewModel.dropdownGroups).groupItems).isShowMore},"last group should be for showMore item");var t=_.size(this.autoCompleteViewModel.dropdownGroups)-2;C.fF.assert(function(){return t>=0},"expect lastVisibleGroupIndex>=0 before click ShowMore");var o=_.size(this.autoCompleteViewModel.dropdownGroups[t].groupItems)-1;C.fF.assert(function(){return o>=0},"expect lastVisiableItemIndex>=0 before click ShowMore"),this.autoCompleteViewModel.dropdownGroups=this.allDropdownGroups;var r=Le(this.autoCompleteViewModel.dropdownGroups,{groupIndex:t,itemIndex:o});this.selectedGroupIndex=r.groupIndex,this.selectedSpanIndex=r.itemIndex,this.screenReaderCurrentDropdownSelection(this.selectedGroupIndex,this.selectedSpanIndex),this.fullyExpanded.emit()},i.prototype.moveSelectionUp=function(){var t,o,n=this;if(this.isInitialized&&(!this.selectPrevious||void 0!==this.selectPrevious.value)&&null!==(t=this.autoCompleteViewModel)&&void 0!==t&&t.dropdownGroups){if(C.fF.assert(function(){return n.selectedSpanIndex>=0},"Expect selectedSpanIndex >= 0"),this.selectedSpanIndex>0)this.selectedSpanIndex--;else if(0===this.selectedSpanIndex)if(this.selectedGroupIndex>0)this.selectedGroupIndex--,this.selectedSpanIndex=this.autoCompleteViewModel.dropdownGroups[this.selectedGroupIndex].groupItems.length-1;else if(0===this.selectedGroupIndex)this.selectedGroupIndex--;else{this.selectedGroupIndex=this.autoCompleteViewModel.dropdownGroups.length-1;var r=null===(o=this.autoCompleteViewModel.dropdownGroups[this.selectedGroupIndex])||void 0===o?void 0:o.groupItems;_.isEmpty(r)||(this.selectedSpanIndex=r.length-1)}this.resetHoverIndices(),this.screenReaderCurrentDropdownSelection(this.selectedGroupIndex,this.selectedSpanIndex)}},i.prototype.moveSelectionDown=function(){var n;if(this.isInitialized&&(!this.selectNext||void 0!==this.selectNext.value)&&null!==(n=this.autoCompleteViewModel)&&void 0!==n&&n.dropdownGroups){var t=Le(this.autoCompleteViewModel.dropdownGroups,{groupIndex:this.selectedGroupIndex,itemIndex:this.selectedSpanIndex});this.selectedGroupIndex=t.groupIndex,this.selectedSpanIndex=t.itemIndex,this.resetHoverIndices(),this.screenReaderCurrentDropdownSelection(this.selectedGroupIndex,this.selectedSpanIndex)}},i.prototype.selectCurrentDropdownItem=function(){var n,t;if(this.isInitialized&&(!this.confirmSelection||void 0!==this.confirmSelection.value)){var o=null===(n=this.autoCompleteViewModel)||void 0===n?void 0:n.dropdownGroups,r=o&&(null===(t=o[this.selectedGroupIndex])||void 0===t?void 0:t.groupItems);r&&r[this.selectedSpanIndex]?this.selectDropdownItem(r[this.selectedSpanIndex]):this.utteranceSelected.emit({utterance:void 0})}},i.prototype.currentDropdownString=function(n,t){var o,r=null===(o=this.autoCompleteViewModel.dropdownGroups[n])||void 0===o?void 0:o.groupItems,a=r&&r[t];if(a)return a.isShowMore?a.text:_.map(a.textSegments,function(s){return s.text}).join("").replace(ve," ")},i.prototype.screenReaderCurrentDropdownSelection=function(n,t){var o=this.currentDropdownString(n,t);if(o){var r=this.autoCompleteViewModel.dropdownGroups[n].title;this.screenReaderService.alertWithDebounce(Q,r?r+" "+o:o)}},i.prototype.generateDropdownItems=function(n){if(n){var t=n.spans,o=n.cursorPosition;this.resetSelectedIndices(),this.resetHoverIndices();var r=function(i,n){var t=0;if(_.isEmpty(i))return-1;if(0===n)return t;if(n>i[i.length-1].endExcludingIndex)return-1;for(t=i.length-1;t>=0;t--){var r=i[t],a=t>0?i[t-1]:void 0,s=n===r.startIndex&&_.isEmpty(r.text),l=a&&a.isWhiteSpace,g=r.startIndex<=n&&n<=r.endExcludingIndex;if(s){var c=r.replacementBindings,p=!_.isEmpty(c&&c.phraseExtensions),f=!_.isEmpty(c&&c.phraseCompletions);if((p||f)&&l)return t}else if(g&&!r.isWhiteSpace)return t}return t}(t,o);if(-1===r)return void(this.showAutoCompleteDropdown=!1);this.unknownSpanHeaderTitle=void 0,this.unknownSpanHeaderSubtitle=void 0,this.selectedSpan=t[r],this.showUnknownSpanHeader=!1,this.disableUnknownSpanHeaderSubtitleAction=!1,this.isUnknownSpanHeaderForFixRequested=!1;var a=function(i,n,t){var o,r,Ot,a=function(i){return _.map(i,function(n){return{text:n.text,correctedStartIndex:n.correctedStartIndex,correctedEndExcludingIndex:n.correctedEndExcludingIndex,isOverlapping:n.isOverlapping,tokens:n.tokens,binding:n.binding,replacementBindings:n.replacementBindings,inferredTermBindings:n.inferredTermBindings,overlapSpans:n.overlapSpans,inferredTermBindingsUnsupported:n.inferredTermBindingsUnsupported,isWhiteSpace:n.isWhiteSpace,isCorrected:n.isCorrected,isUsed:n.isUsed,isUnknown:n.isUnknown,state:n.state,startIndex:n.startIndex,endExcludingIndex:n.endExcludingIndex}})}(i.spans),s=i.config,l=i.cursorPosition,g=a[n],c=g.isUnknown,p=!!g.binding,f=!_.isEmpty(a[n].overlapSpans),y=g.replacementBindings,E=!_.isEmpty(y&&y.alternates),D=!_.isEmpty(y&&y.phraseExtensions),k=!_.isEmpty(y&&y.phraseCompletions),Se=!_.isEmpty(y&&y.suggestedReplacements),ke=p||E||D||k||Se||f,qe=null===(o=s.header)||void 0===o?void 0:o.show,Pt=[],Ht=[];if("accepted"===g.state||"none"===g.state){if(!_.isEmpty(g.text)){var Fn=ot(a,n,[0],Ht,l);_.isEmpty(Fn)||Pt.push({groupItems:Fn})}(E||f||k||D||Se)&&(Ot=ot(a,n,[1,2,4,3],Ht,l),_.isEmpty(Ot)||Pt.push({groupItems:Ot,title:qe&&p?t.get("Qna_YouCouldAlsoTry_LabelText"):void 0}))}else c&&qe&&"none"!==s.header.unknownSpanHeaderConfig.actionType?(C.fF.assert(function(){return null!=s.header.unknownSpanHeaderConfig.actionType},"when config.header.show is true, config.header.unknownSpanHeaderConfig.actionType must be defined"),Pt.push({title:t.get("Qna_AutoComplete_UnknowTermWithNoAlternatesTitle")})):ke?(p&&Pt.push({groupItems:ot(a,n,[0],Ht,l)}),(E||f)&&(Ot=ot(a,n,[1],Ht,l),_.isEmpty(Ot)||Pt.push({groupItems:Ot,title:qe?t.get(p?"Qna_YouCouldAlsoTry_LabelText":"Qna_DidYouMean_LabelTextWithColon"):void 0}))):Pt.push({groupItems:mt(a,n,[{segments:[{text:g.text,isMatched:!0}],score:null===(r=g.binding)||void 0===r?void 0:r.score}],Ht,l)});return{dropdownGroups:Pt}}(n,r,this.localizationService);if(this.allDropdownGroups=hn(a.dropdownGroups,this.maxItemCountInFullExpansion),this.autoCompleteViewModel=_.merge({},a,{dropdownGroups:this.allDropdownGroups}),this.showAutoCompleteDropdown=!_.isEmpty(this.allDropdownGroups),this.generateUnknownSpanTitle(n,r),this.resetExpansionState(),this.showAutoCompleteDropdown){var s=_.sum(this.autoCompleteViewModel.dropdownGroups.map(function(g){return _.size(g.groupItems)}));this.shouldDisplayShowMore&&s--;var l=this.localizationService.format("Qna_ScreenReader_SuggestionsOpened_NoTerm",["".concat(s)]);this.screenReaderService.alertWithDebounce(re,l)}else this.screenReaderService.cancelDebounce(re)}},i.prototype.generateUnknownSpanTitle=function(n,t){var r,a,s,l,o=this;if("none"===(null===(a=null===(r=n.config.header)||void 0===r?void 0:r.unknownSpanHeaderConfig)||void 0===a?void 0:a.actionType))return this.showUnknownSpanHeader=!1,this.unknownSpanHeaderTitle=void 0,void(this.unknownSpanHeaderSubtitle=void 0);var g=n.spans,c=_.last(this.allDropdownGroups);if(c?.title&&this.unknownTermService){var p=_.map(g,function(D){return D.text}).join(""),f=null===(l=null===(s=n.config.header)||void 0===s?void 0:s.unknownSpanHeaderConfig)||void 0===l?void 0:l.actionType;if(c.title===this.localizationService.get("Qna_DidYouMean_LabelTextWithColon"))C.fF.assert(function(){var D;return null===(D=n.config.header)||void 0===D?void 0:D.show},"Expect params.config.header?.show to be true when lastDropdownGroup.title is not empty"),"textOnlyHeader"!==f&&!this.unknownTermService.wasUtteranceAdded(p,this.selectedSpan.text)&&(this.unknownSpanHeaderTitle=this.localizationService.get("Qna_AutoComplete_UnusedTermWithAlternatesTitle"),this.unknownSpanHeaderSubtitle=this.unknownTermService.getLabel(g[t],f,n.modelOwner),this.showUnknownSpanHeader=!0);else if(c.title===this.localizationService.get("Qna_AutoComplete_UnknowTermWithNoAlternatesTitle"))if(C.fF.assert(function(){var D;return null===(D=n.config.header)||void 0===D?void 0:D.show},"Expect params.config.header?.show to be true when lastDropdownGroup.title is not empty"),this.showUnknownSpanHeader=!0,"textOnlyHeader"===f){this.unknownSpanHeaderTitle=void 0;var y=n.config.header.unknownSpanHeaderConfig.textOnlyTemplate;if(y){var E=_.map(y.variables,function(D){var k=1===D.type?o.selectedSpan.text:D.text;return D.isBold?function(i){return"<b>"+i+"</b>"}(k):k});this.unknownSpanHeaderSubtitle=this.localizationService.format(y.template,E)}else this.unknownSpanHeaderSubtitle=this.localizationService.get("Qna_AutoComplete_UnknowTermWithNoAlternatesTitle");this.disableUnknownSpanHeaderSubtitleAction=!0}else this.unknownTermService.wasUtteranceAdded(p,this.selectedSpan.text)?(this.unknownSpanHeaderTitle=this.localizationService.get("Qna_AutoComplete_UnknowTermHasAlreadyBeenAdded"),this.disableUnknownSpanHeaderSubtitleAction=!0,this.isUnknownSpanHeaderForFixRequested=!0):(C.fF.assert(function(){return"askToAdd"===f||"defineInTooling"===f},"Expect the actionType is either AskToAdd or DefineInTooling"),this.unknownSpanHeaderTitle=this.localizationService.get("Qna_AutoComplete_UnknowTermWithNoAlternatesTitle"),this.unknownSpanHeaderSubtitle=this.unknownTermService.getLabel(g[t],f,n.modelOwner))}},i.prototype.resetExpansionState=function(){var n,t;C.fF.assertValue(this.autoCompleteViewModel,"Expect this.autoCompleteViewModel to be defined"),this.autoCompleteViewModel.dropdownGroups=hn(this.allDropdownGroups,this.showUnknownSpanHeader?this.maxItemCountInPartialExpansion-1:this.maxItemCountInPartialExpansion),this.shouldDisplayShowMore=_.size(this.autoCompleteViewModel.dropdownGroups)<_.size(this.allDropdownGroups)||_.size(null===(n=_.last(this.autoCompleteViewModel.dropdownGroups))||void 0===n?void 0:n.groupItems)<_.size(null===(t=_.last(this.allDropdownGroups))||void 0===t?void 0:t.groupItems),this.shouldDisplayShowMore&&this.autoCompleteViewModel.dropdownGroups.push({groupItems:[{isShowMore:!0,text:this.localizationService.get("ShowMore"),textSegments:[],score:0}]})},i.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule(".themeableElement .link","{ color: var(--link-color) !important; opacity: 1 !important; }")},i.prototype.resetHoverIndices=function(){this.hoverGroupIndex=-1,this.hoverSpanIndex=0},i.prototype.resetSelectedIndices=function(){this.selectedGroupIndex=-1,this.selectedSpanIndex=0},i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Jt.g),e.\u0275\u0275directiveInject(bt.o),e.\u0275\u0275directiveInject(Xt.g),e.\u0275\u0275directiveInject(ue.y0),e.\u0275\u0275directiveInject(At,8))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["qna-autocomplete"]],inputs:{maxItemCountInFullExpansion:"maxItemCountInFullExpansion",maxItemCountInPartialExpansion:"maxItemCountInPartialExpansion",params:"params",presentation:"presentation",selectPrevious:"selectPrevious",selectNext:"selectNext",confirmSelection:"confirmSelection"},outputs:{utteranceSelected:"utteranceSelected",fullyExpanded:"fullyExpanded"},decls:1,vars:1,consts:[["id","qnaAutoComplete","role","listbox","class","qnaAutoComplete themeableElement highContrastBorder",3,"ngStyle",4,"ngIf"],["id","qnaAutoComplete","role","listbox",1,"qnaAutoComplete","themeableElement","highContrastBorder",3,"ngStyle"],["class","groupItem","drag-resize-disabled","true",3,"ngStyle",4,"ngFor","ngForOf"],["class","unknownTermTitle",3,"ngStyle",4,"ngIf"],["drag-resize-disabled","true",1,"groupItem",3,"ngStyle"],["class","dropdownGroupTitle",3,"ngStyle",4,"ngIf"],["class","dropdownGroupItems",4,"ngIf"],[1,"dropdownGroupTitle",3,"ngStyle"],[1,"dropdownGroupItems"],["class","singleDropdownItem","role","option","data-testid","single-dropdown-item",3,"ngStyle","ngClass","mouseenter","accessible-click",4,"ngFor","ngForOf"],["role","option","data-testid","single-dropdown-item",1,"singleDropdownItem",3,"ngStyle","ngClass","mouseenter","accessible-click"],["class","singleDropdownItemTextContainer",4,"ngIf"],["class","singleDropdownItemTextContainer showMoreItem",4,"ngIf"],[1,"singleDropdownItemTextContainer"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"singleDropdownItemTextContainer","showMoreItem"],["localize","ShowMore"],[1,"unknownTermTitle",3,"ngStyle"],["tabindex","0","drag-resize-disabled","true",3,"ngClass","innerHTML","ngStyle","accessible-click",4,"ngIf"],["tabindex","0","drag-resize-disabled","true",3,"ngClass","innerHTML","ngStyle","accessible-click"]],template:function(t,o){1&t&&e.\u0275\u0275template(0,ee,3,6,"ul",0),2&t&&e.\u0275\u0275property("ngIf",o.showAutoCompleteDropdown)},dependencies:[m.NgClass,m.NgForOf,m.NgIf,m.NgStyle,Vt.X,Ut.t],styles:['.qnaAutoComplete[_ngcontent-%COMP%]{display:block;position:absolute;left:0;width:100%;border-radius:2px;box-shadow:0 1.2px 3.6px rgba(0,0,0,.11),0 6.4px 14.4px rgba(0,0,0,.13);background-color:var(--colorNeutralBackground1);color:var(--colorNeutralForeground1)}.qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupTitle[_ngcontent-%COMP%], .qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%], .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem.showMoreItem.showAsGroupTitle[_ngcontent-%COMP%]{font-family:Segoe UI Semibold,wf_segoe-ui_semibold,helvetica,arial,sans-serif;background-color:transparent;margin:0;white-space:pre-wrap}html:not([dir="rtl"])[_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupTitle[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupTitle[_ngcontent-%COMP%], html:not([dir="rtl"])[_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%], html:not([dir="rtl"])[_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem.showMoreItem.showAsGroupTitle[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem.showMoreItem.showAsGroupTitle[_ngcontent-%COMP%]{padding:4px 8px 8px}html[dir="rtl"][_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupTitle[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupTitle[_ngcontent-%COMP%], html[dir="rtl"][_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%], html[dir="rtl"][_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem.showMoreItem.showAsGroupTitle[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem.showMoreItem.showAsGroupTitle[_ngcontent-%COMP%]{padding:4px 8px 8px}.qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%]{background-color:var(--colorNeutralBackground1)}.qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem.selected[_ngcontent-%COMP%]{background-color:var(--colorNeutralBackground1Hover)}.qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%]{font-weight:400!important;border-top-color:var(--colorNeutralForeground1)}.qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{color:var(--colorBrandForegroundLink);text-decoration:none;cursor:pointer!important}.qnaAutoComplete[_ngcontent-%COMP%]   .unknownTermTitle[_ngcontent-%COMP%]   .fixRequestedText[_ngcontent-%COMP%]{font-weight:700!important}.qnaAutoComplete[_ngcontent-%COMP%]   .groupItem[_ngcontent-%COMP%]{display:block;text-decoration:none}.qnaAutoComplete[_ngcontent-%COMP%]   .groupItem[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]{list-style:none;z-index:2;cursor:pointer;display:block;position:relative;margin-top:0!important;overflow:visible;white-space:pre-wrap}.qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:0;background-color:transparent;overflow-wrap:break-word}html:not([dir="rtl"])[_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%]{padding:4px 0 8px 16px}html[dir="rtl"][_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%]{padding:4px 16px 8px 0}.qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:-1px}.qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem[_ngcontent-%COMP%]   .singleDropdownItemTextContainer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline}.qnaAutoComplete[_ngcontent-%COMP%]   .dropdownGroupItems[_ngcontent-%COMP%]   .singleDropdownItem.showMoreItem[_ngcontent-%COMP%]{color:var(--colorBrandForegroundLink)}.qnaAutoComplete[_ngcontent-%COMP%]   .matchedSegment[_ngcontent-%COMP%]{font-weight:700}']}),i}();function Le(i,n){var t;C.fF.assertValue(i,"Expect dropdownGroups to be defined"),C.fF.assert(function(){return n.itemIndex>=0},"Expect currentIndices.itemIndex >= 0");var o=n.groupIndex,r=n.itemIndex,a=null===(t=i[o])||void 0===t?void 0:t.groupItems;return a&&r===a.length-1?o>=i.length-1?{groupIndex:-1,itemIndex:0}:{groupIndex:o+1,itemIndex:0}:o<0?{groupIndex:0,itemIndex:0}:{groupIndex:o,itemIndex:r+1}}var Ce=u(26898),He=u(83008),Re=u(39503),et=u(9380),it=u(76072),Ze=u(84281),Mt=u(52298),st=u(22844),Je=u(1240),en=["contentElementExtraContainer"],tn=["deleteButton"],nn=["commitButton"],on=["autoComplete"],Rt=["contentElement"],rn=["qnaInputContainer"],Ee=["beginGripper"],lt=["endGripper"],_e=["spanElement"],Ie=function(n,t,o,r){return{width:n,height:t,right:o,top:r}},St=function(n){return{"stroke-width":n}};function Pn(i,n){if(1&i&&(e.\u0275\u0275namespaceSVG(),e.\u0275\u0275elementStart(0,"svg",19),e.\u0275\u0275element(1,"circle",20),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext().ngIf,o=e.\u0275\u0275nextContext(3).ngIf;e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction4(7,Ie,t.meatball.width+"px",t.meatball.height+"px",t.meatball.right+"px",t.meatball.top+"px")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(12,St,t.meatball.strokeWidth+"px")),e.\u0275\u0275attribute("stroke",t.meatball.strokeColor)("fill",o.useShellTheme?"":t.meatball.fillColor)("r",t.meatball.r)("cx",t.meatball.cx)("cy",t.meatball.cy)}}var fn=function(n,t,o){return{notClickable:n,loadingIcon:t,warningIcon:o}},An=function(n,t){return{color:n,"font-size":t}};function xn(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"span",17),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var g=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(g.resetAllState())}),e.\u0275\u0275template(1,Pn,2,14,"svg",18),e.\u0275\u0275elementEnd()}if(2&i){var o=n.ngIf,r=e.\u0275\u0275nextContext(2).ngIf,a=e.\u0275\u0275nextContext().ngIf,s=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction3(6,fn,s.noResetAllActionIndication,"loading"===o.state,"warning"===o.state))("ngStyle",e.\u0275\u0275pureFunction2(10,An,a.useShellTheme?"":a.questionFontProperties.color,r.iconFontSize+"px"))("pbi-tooltip",o.tooltipConfig),e.\u0275\u0275attribute("aria-label",o.ariaLabel)("role","normal"!==o.state?"alert":"button"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","normal"!==o.state)}}var mn=function(n){return{width:n}},zt=function(n){return{"font-size":n}},Vn=function(n,t,o,r){return{state:n,ariaLabel:t,tooltipConfig:o,meatball:r}};function Oo(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",14)(2,"span",15),e.\u0275\u0275text(3,"\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,xn,2,13,"span",16),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext().ngIf,o=e.\u0275\u0275nextContext().ngIf,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(11,mn,null!=r.fullConfig&&r.fullConfig.showQuestionIcon?t.iconFontSize+"px":0)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(13,zt,o.questionFontProperties.size.px+"px")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction4(15,Vn,e.\u0275\u0275pipeBind1(5,3,r.questionIconProperties.state$),e.\u0275\u0275pipeBind1(6,5,r.questionIconProperties.ariaLabel$),e.\u0275\u0275pipeBind1(7,7,r.questionIconProperties.tooltipConfig$),e.\u0275\u0275pipeBind1(8,9,r.questionIconProperties.loadingWarningPresentation$)))}}function To(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",32,33),e.\u0275\u0275listener("keyup",function(a){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(2).$implicit,l=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(l.gripperKeyUp(a,s,"beginGripper"))})("cdkDragStarted",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(8);return e.\u0275\u0275resetView(a.beginGripperDragStarted())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275elementStart(2,"svg",34),e.\u0275\u0275element(3,"rect"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"svg",35),e.\u0275\u0275element(5,"circle"),e.\u0275\u0275elementEnd()()}if(2&i){var o=e.\u0275\u0275nextContext(7).ngIf;e.\u0275\u0275property("cdkDragData","beginGripper"),e.\u0275\u0275advance(3),e.\u0275\u0275attribute("fill",o.errorUnderlineColor),e.\u0275\u0275advance(2),e.\u0275\u0275attribute("stroke",o.errorUnderlineColor)("fill",o.backgroundColor)}}function Fo(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",36,37),e.\u0275\u0275listener("keyup",function(a){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(2).$implicit,l=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(l.gripperKeyUp(a,s,"endGripper"))})("cdkDragStarted",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(8);return e.\u0275\u0275resetView(a.endGripperDragStarted())}),e.\u0275\u0275namespaceSVG(),e.\u0275\u0275elementStart(2,"svg",38),e.\u0275\u0275element(3,"rect"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"svg",35),e.\u0275\u0275element(5,"circle"),e.\u0275\u0275elementEnd()()}if(2&i){var o=e.\u0275\u0275nextContext(7).ngIf;e.\u0275\u0275property("cdkDragData","endGripper"),e.\u0275\u0275advance(3),e.\u0275\u0275attribute("fill",o.errorUnderlineColor),e.\u0275\u0275advance(2),e.\u0275\u0275attribute("stroke",o.errorUnderlineColor)("fill",o.backgroundColor)}}var Bo=function(n,t,o,r,a,s,l,g,c){return{dropZoneLocatedBeforeToken:n,dropZoneLocatedAfterToken:t,noGripperOnDragging:o,beginGripperOnDragging:r,endGripperOnDragging:a,serveBeginGripper:s,serveEndGripper:l,hasBeginGripper:g,hasEndGripper:c}};function Do(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275listener("cdkDropListEntered",function(g){e.\u0275\u0275restoreView(t);var c=e.\u0275\u0275nextContext(7);return e.\u0275\u0275resetView(c.gripperEnter(g))})("cdkDropListDropped",function(g){e.\u0275\u0275restoreView(t);var c=e.\u0275\u0275nextContext(7);return e.\u0275\u0275resetView(c.dropGripper(g))}),e.\u0275\u0275template(1,To,6,4,"div",30),e.\u0275\u0275template(2,Fo,6,4,"div",31),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2).$implicit,a=e.\u0275\u0275nextContext(2).ngIf,s=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunctionV(5,Bo,[o===(null==r.dropZonesInfo?null:r.dropZonesInfo.zoneLocatedBeforeInfo),o===(null==r.dropZonesInfo?null:r.dropZonesInfo.zoneLocatedAfterInfo),"none"===a.gripperOnDragging,"beginGripper"===a.gripperOnDragging,"endGripper"===a.gripperOnDragging,!!o.beginGripperOf,!!o.endGripperOf,!!o.hasBeginGripper,!!o.hasEndGripper]))("cdkDropListData",o)("cdkDropListEnterPredicate",s.dropZonePredicate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.hasBeginGripper),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.hasEndGripper)}}function Ao(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Do,3,15,"div",28),e.\u0275\u0275elementContainerEnd()),2&i){var t=n.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}var Vo=function(n,t){return[n,t]};function Uo(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Ao,2,1,"ng-container",27),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pureFunction2(1,Vo,null==t.dropZonesInfo?null:t.dropZonesInfo.zoneLocatedBeforeInfo,null==t.dropZonesInfo?null:t.dropZonesInfo.zoneLocatedAfterInfo))}}var Qo=function(n,t,o,r){return{space:n,filler:t,isBetweenDroppedGrippers:o,isBetweenOnDraggingGrippers:r}};function ko(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",26),e.\u0275\u0275text(1),e.\u0275\u0275template(2,Uo,2,4,"ng-container",0),e.\u0275\u0275elementEnd()),2&i){var t=n.$implicit,o=e.\u0275\u0275nextContext(4);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction4(4,Qo,t.isWhiteSpace,t.isFillerText,t.isBetweenDroppedGrippers,t.isBetweenOnDraggingGrippers)),e.\u0275\u0275attribute("aria-hidden",t.isWhiteSpace),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.text),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==o.fullConfig?null:o.fullConfig.supportTokenGrippers)}}var Lo=function(n,t){return{height:n,bottom:t,left:0}};function Ro(i,n){if(1&i&&(e.\u0275\u0275namespaceSVG(),e.\u0275\u0275elementStart(0,"svg",39),e.\u0275\u0275element(1,"line",40),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(3).ngIf;e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction2(7,Lo,2*t.singleUnderlineThickness+"px",-.5*t.singleUnderlineSpace+-1.5*t.singleUnderlineThickness+"px")),e.\u0275\u0275advance(1),e.\u0275\u0275attribute("x1",t.singleUnderlineThickness)("y1",t.singleUnderlineThickness)("y2",t.singleUnderlineThickness)("stroke-width",t.singleUnderlineThickness)("stroke-dasharray","1 "+(t.singleUnderlineThickness+2))("stroke",t.warningUnderlineColor)}}var zo=function(n,t,o,r,a,s){return{unused:n,space:t,corrected:o,showAcceptedUnderline:r,showErrorUnderline:a,showWarningUnderline:s}},Un=function(n){return{"background-color":n}},qo=function(n,t){return{hasMultipleTokens:n,unused:t}},No=function(n,t,o,r){return{color:n,"border-bottom-color":t,"border-bottom-style":o,"border-bottom-width":r}};function Ho(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"span",21,22),e.\u0275\u0275listener("mouseover",function(){var l=e.\u0275\u0275restoreView(t).$implicit,g=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(g.onSpanMouseEnter(l))})("mouseleave",function(){var l=e.\u0275\u0275restoreView(t).$implicit,g=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(g.onSpanMouseLeave(l))}),e.\u0275\u0275elementStart(2,"span",23),e.\u0275\u0275template(3,ko,3,9,"span",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Ro,2,10,"svg",25),e.\u0275\u0275elementEnd()}if(2&i){var o=n.$implicit,r=e.\u0275\u0275nextContext(2).ngIf;e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction6(7,zo,o.isUnused,o.isWhiteSpace,o.isCorrected,o.shouldShowAcceptedUnderline,o.shouldShowErrorUnderline,o.shouldShowWarningUnderline))("ngStyle",e.\u0275\u0275pureFunction1(14,Un,r.useShellTheme?"":o.backgroundColor)),e.\u0275\u0275attribute("aria-hidden",o.isWhiteSpace),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(16,qo,(null==o.tokens?null:o.tokens.length)>1,o.isUnused))("ngStyle",e.\u0275\u0275pureFunction4(19,No,r.useShellTheme?"":o.isUnused?r.droppedFontColor:r.questionFontProperties.color,r.useShellTheme?"":o.shouldShowAcceptedUnderline?r.acceptedUnderlineColor:o.shouldShowErrorUnderline?r.errorUnderlineColor:r.warningUnderlineColor,o.shouldShowAcceptedUnderline?"solid":o.shouldShowErrorUnderline?"double":"unset",(o.shouldShowAcceptedUnderline?r.singleUnderlineThickness:o.shouldShowErrorUnderline?2*r.singleUnderlineThickness:0)+"px")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",null==o?null:o.tokens),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.shouldShowWarningUnderline)}}var jn=function(n,t){return{disabled:n,usingShellTheme:t}},Go=function(){return{tooltipLocalizeDescription:"Clear",tooltipShowOnFocus:!0}},Kn=function(n,t){return{"font-size":n,color:t}};function $o(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",43)(1,"button",44,45),e.\u0275\u0275listener("accessible-click",function(s){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(l.clearButtonClicked(s))}),e.\u0275\u0275elementStart(3,"div",46)(4,"span",20),e.\u0275\u0275text(5,"\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",47),e.\u0275\u0275element(7,"i",48),e.\u0275\u0275elementEnd()()()()}if(2&i){var o=e.\u0275\u0275nextContext(4).ngIf,r=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(6,jn,o.isUtteranceEmpty,r.useShellTheme))("pbi-tooltip",e.\u0275\u0275pureFunction0(9,Go))("ngStyle",e.\u0275\u0275pureFunction1(10,Un,r.useShellTheme?"":r.backgroundColor)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(12,zt,r.questionFontProperties.size.px+"px")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(14,zt,r.questionFontProperties.size.px+"px")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction2(16,Kn,o.iconFontSize+"px",r.useShellTheme?"":r.questionFontProperties.color))}}var Wo=function(n){return{"aria-label":n}},jo=function(n){return{tooltipLocalizeDescription:n,tooltipShowOnFocus:!0}};function Ko(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",43)(1,"button",49,50),e.\u0275\u0275listener("accessible-click",function(l){e.\u0275\u0275restoreView(t);var g=e.\u0275\u0275nextContext(7);return e.\u0275\u0275resetView(g.commitButtonClicked(l))}),e.\u0275\u0275elementStart(3,"div",46)(4,"span",20),e.\u0275\u0275text(5,"\xa0"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",47),e.\u0275\u0275element(7,"i",51),e.\u0275\u0275elementEnd()()()()}if(2&i){var o=e.\u0275\u0275nextContext().ngIf,r=e.\u0275\u0275nextContext(4).ngIf,a=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(7,jn,!o.isTrue,a.useShellTheme))("localizeAttr",e.\u0275\u0275pureFunction1(10,Wo,o.isTrue?"Submit":"Qna_Input_SubmitQuestion_Disabled_Description"))("pbi-tooltip",e.\u0275\u0275pureFunction1(12,jo,o.isTrue?"Submit":"Qna_Input_SubmitQuestion_Disabled_Description"))("ngStyle",e.\u0275\u0275pureFunction1(14,Un,a.useShellTheme?"":a.commitButtonBackgroundColor)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(16,zt,a.questionFontProperties.size.px+"px")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(18,zt,a.questionFontProperties.size.px+"px")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction2(20,Kn,r.iconFontSize+"px",a.useShellTheme?"":a.commitButtonForegroundColor))}}function Zo(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Ko,8,23,"div",42),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext(2).ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.commitVisible)}}var Jo=function(n){return{isTrue:n}};function Xo(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",41),e.\u0275\u0275listener("click",function(l){e.\u0275\u0275restoreView(t);var g=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(g.actionButtonsContainerClicked(l))}),e.\u0275\u0275template(2,$o,8,19,"div",42),e.\u0275\u0275template(3,Zo,2,1,"ng-container",0),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&i){var o=e.\u0275\u0275nextContext().ngIf,r=e.\u0275\u0275nextContext(2).ngIf,a=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(5,mn,(r.iconFontSize+16)*(!a.inCommitOnDemandMode||null!=a.fullConfig.commitOnDemandConfigs&&a.fullConfig.commitOnDemandConfigs.hideCommitActionUI?1:2)+"px")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.deleteVisible),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction1(7,Jo,e.\u0275\u0275pipeBind1(4,3,a.hasUncommittedQuestion$)))}}function Yo(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Xo,5,9,"ng-container",0),e.\u0275\u0275elementContainerEnd()),2&i){var t=n.ngIf,o=e.\u0275\u0275nextContext(2).ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!o.isUtteranceEmpty||t.commitVisible||t.deleteVisible)}}var ei=function(n,t){return{commitVisible:n,deleteVisible:t}};function ti(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Yo,2,1,"ng-container",0),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction2(5,ei,e.\u0275\u0275pipeBind1(2,1,t.commitActionVisible$),e.\u0275\u0275pipeBind1(3,3,t.clearActionVisible$)))}}function ni(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"qna-autocomplete",52,53),e.\u0275\u0275listener("utteranceSelected",function(s){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(l.autoCompleteDropdownItemSelected(s))})("fullyExpanded",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(s.autoCompleteFullyExpanded())}),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext(2).ngIf,r=e.\u0275\u0275nextContext();e.\u0275\u0275classProp("withTopSeparator",o.height),e.\u0275\u0275property("params",r.autoCompleteInputArgs.params)("presentation",r.autoCompleteInputArgs.presentation)("selectPrevious",r.autoCompleteInputArgs.selectPrevious)("selectNext",r.autoCompleteInputArgs.selectNext)("confirmSelection",r.autoCompleteInputArgs.confirmSelection)}}var oi=function(n,t,o,r){return{withBorder:n,withShadow:t,authoringDisabled:o,showDisabled:r}},ii=function(n,t,o,r,a,s,l,g,c){return{"background-color":n,color:t,"font-size":o,"font-family":r,"border-color":a,"font-weight":s,"font-style":l,"text-decoration":g,height:c}},ri=function(n){return{height:n}},ai=function(n,t){return{withFixedHeight:n,allowContentHorizontalScroll:t}},si=function(n){return{"max-height":n}},li=function(n){return{withMaxHeight:n}},ui=function(n){return{isGripperOnDragging:n}};function ci(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275template(1,Oo,9,20,"ng-container",0),e.\u0275\u0275elementStart(2,"div",4,5)(4,"div",6)(5,"div",7)(6,"div",8,9)(8,"div",10,11),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275template(11,Ho,5,24,"span",12),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(13,ti,4,8,"ng-container",0),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(14,ni,2,7,"qna-autocomplete",13),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275elementEnd()()()),2&i){var t=n.ngIf,o=e.\u0275\u0275nextContext().ngIf,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==r.fullConfig?null:r.fullConfig.showQuestionIcon),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction4(20,oi,o.withBorder,o.withShadow,null==r.fullConfig?null:r.fullConfig.disableAuthoring,null==r.fullConfig?null:r.fullConfig.displayDisabledStateVisually))("ngStyle",e.\u0275\u0275pureFunctionV(25,ii,[o.useShellTheme?"":o.backgroundColor,o.useShellTheme?"":o.questionFontProperties.color,o.questionFontProperties.size.px+"px",o.questionFontProperties.family,o.useShellTheme?"":o.borderColor,o.questionFontProperties.weight,o.questionFontProperties.style,o.questionFontProperties.textDecoration,o.height?o.height+"px":"auto"])),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(35,ri,o.height?o.height+"px":"auto"))("ngClass",e.\u0275\u0275pureFunction2(37,ai,o.height,o.allowContentHorizontalScroll)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(40,si,o.height?o.height+"px":"unset"))("ngClass",e.\u0275\u0275pureFunction1(42,li,o.height)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(44,ui,"none"!==t.gripperOnDragging)),e.\u0275\u0275attribute("contenteditable",r.isEditable())("placeholder",e.\u0275\u0275pipeBind1(10,14,r.placeholder$))("aria-label",r.ariaLabel),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(12,16,r.uiSpans$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null==r.fullConfig?null:r.fullConfig.showActionButtons),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(15,18,r.shouldShowAutoComplete$))}}var di=function(n){return{corrected:n}};function pi(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",58),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){var t=n.$implicit;e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(2,di,t.isCorrected)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.text)}}var gi=function(n,t,o){return{color:n,"font-size":t,"font-family":o}};function hi(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",54)(1,"span",55),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",56),e.\u0275\u0275listener("accessible-click",function(){var l=e.\u0275\u0275restoreView(t).ngIf,g=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(g.replaceWithCorrectedUtterance(l.replacementUtterance,l.state))}),e.\u0275\u0275template(4,pi,2,4,"span",57),e.\u0275\u0275elementEnd()()}if(2&i){var o=n.ngIf,r=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction3(4,gi,r.restatementFontProperties.color,r.restatementFontProperties.size.px+"px",r.restatementFontProperties.family)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o.label),e.\u0275\u0275advance(1),e.\u0275\u0275attribute("aria-label",o.replacementUtterance),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",o.spans)}}var fi=function(n,t,o){return{gripperOnDragging:n,isUtteranceEmpty:t,iconFontSize:o}};function mi(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ci,16,46,"div",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,hi,5,8,"div",2),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction3(10,fi,e.\u0275\u0275pipeBind1(2,2,null==t.grippersInfo?null:t.grippersInfo.gripperOnDragging$),e.\u0275\u0275pipeBind1(3,4,t.isDisplayedUtteranceEmpty$),e.\u0275\u0275pipeBind1(4,6,t.iconFontSize$))),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,8,t.currentUtteranceAutoCorrectionInfo$))}}var Zn={withBorder:!1,withShadow:!1,backgroundColor:"#FFFFFF",borderColor:"#A19F9D",questionFontProperties:{color:"#323130",size:tt.B.createFromPt(10),family:"'Segoe UI', wf_segoe- ui_normal, helvetica, arial, sans- serif"},acceptedUnderlineColor:"#0078D4",errorUnderlineColor:"#FF0000",warningUnderlineColor:"#0078D4",singleUnderlineThickness:2,singleUnderlineSpace:1,droppedFontColor:"#A19F9D",hoverColor:"#EEEEEE",restatementFontProperties:{color:"#323130",size:tt.B.createFromPt(9),family:"'Segoe UI', wf_segoe- ui_normal, helvetica, arial, sans- serif"},commitButtonBackgroundColor:"#F3F2F1",commitButtonForegroundColor:"#323130",allowContentHorizontalScroll:!1},Ci={sendPausedTagTimeout:3e3,showErrorWarningUnderlineTimeout:1500,showActionButtons:!0,showPlaceholderText:!0,showQuestionIcon:!0,showWarningIcon:!0,showLoadingIcon:!0,showCorrectedUtterance:!0,customPlaceholderText:"",autoFocusOnInit:!1,disableAuthoring:!1,disableAuthoringMessage:"",displayDisabledStateVisually:!0,disableSendingServiceTags:!1,supportTokenGrippers:!1,supportsPodQueries:!1,supportsInsightsQueries:!1,inferUnknownModelTerms:!1,singleAnswerBias:!1,hostSupportsUndo:!1,spanDropdownHeaderConfig:{show:!0,unknownSpanHeaderConfig:{actionType:"none"}},calculation:void 0,considerDroppedSpans:!0,considerErrorSpans:!0,considerWarningSpans:!0,commitOnDemandForcedMode:void 0,commitOnDemandConfigs:{hideCommitActionUI:!1,noCommitOnDropdownSelection:!1,noCommitOnInitialUtterance:!1}},Qn="\xa0",bn=function(){function i(n,t,o,r,a,s,l,g,c,p,f,y,E){this.changeDetectorRef=n,this.conceptualSchemaProxy=t,this.dataSourcesService=o,this.explorationNavigationService=r,this.featureSwitchService=a,this.highContrastCssGenerationService=s,this.lazyProvider=l,this.localizationService=g,this.screenReaderService=c,this.undoRedoService=p,this.linguisticSchemaProxy=f,this.qnaProxyPathToken=y,this.qnaModelUtilsPathToken=E,this.grippersDefinedTextRangeChanged=new e.EventEmitter,this.enterKeyPressed=new e.EventEmitter,this.initialized=new e.EventEmitter,this.toolingLaunched=new e.EventEmitter,this.inputBoxFocused=new e.EventEmitter,this.displayedUtteranceInternal$=new Y.X(void 0),this.distinctDisplayedUtterance$=new Y.X(void 0),this.hasUncommittedQuestion$=new Y.X(!1),this.loadingStateTooltipConfig$=new Y.X(void 0),this.warningStateTooltipConfig$=new Y.X(void 0),this.hasFocus$=new Y.X(void 0),this.cursorLocation$=new Y.X(-1),this.uiSpanWithMouseHover$=new Y.X(void 0),this.tokensGripperLocInfoUpdated$=new Y.X(void 0),this.delayedSpanUnderlineStyleUpdated$=new Y.X(void 0),this.contentElementAngularCommentNodes=[],this.destroy$=new Xe.xQ,this.firstTimeLoad=!0,this.componentUniqueId=Me.b$.generateGuid(),this.interpretRequestSequenceNumber=-1,this.initializeHighContrastRules(),C.fF.assert(function(){return!(0,L.rO)()},"Expect input box never get created if it is in IE browser.")}return Object.defineProperty(i.prototype,"autoCompleteElementRef",{set:function(t){t&&(this.autoCompleteElement=t.nativeElement)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"contentElementRef",{set:function(t){var o=this;if(t&&(this.contentElement=t.nativeElement,this.firstTimeLoad)){this.firstTimeLoad=!1;var r=!1;this.contentElement&&this.isEditable()&&this.fullConfig.autoFocusOnInit&&(r=!0),this.contentElementAngularCommentNodes=_.takeWhile(this.contentElement.childNodes,function(a){return a.nodeType===Node.COMMENT_NODE}),_.isEmpty(this.contentElementAngularCommentNodes)&&(this.contentElementAngularCommentNodes=_.takeRightWhile(this.contentElement.childNodes,function(a){return a.nodeType===Node.COMMENT_NODE})),this.addEventListeners(),C.fF.assert(function(){return!o.initialUtteranceFromSaved||!_.isEmpty(o.initialUtterance)},"initialUtteranceFromSaved is true, then there must be an initialUtterance"),_.isEmpty(this.initialUtterance)?r&&setTimeout(function(){o.contentElement.focus()}):setTimeout(function(){var a,s;C.fF.assertValue(o.fullConfig,"this.fullConfig should already been set"),o.interpretUtteranceRequest$.next({utterance:o.initialUtterance,uniqueId:Me.b$.generateGuid(),utteranceUITextAlreadyEnsured:!1,suppressSuggestions:!0,requireCursorAtEndIfFocused:!0,enforceFocus:r,delayError:!1,linguisticSchemaJson:o.linguisticInfo&&o.linguisticInfo.linguisticSchemaJson,inferredTermBinding:o.linguisticInfo&&o.linguisticInfo.inferredTermBinding,incomingTags:o.initialUtteranceFromSaved?["SavedQuestion"]:void 0,specifiedSpans:void 0,isCommitInCommitQuestionOnDemandMode:!(null!==(s=null===(a=o.fullConfig)||void 0===a?void 0:a.commitOnDemandConfigs)&&void 0!==s&&s.noCommitOnInitialUtterance)})})}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"spanElementRefs",{set:function(t){var o=this;_.forEach(t.toArray(),function(r){(0,Te.R)(r.nativeElement,"click").pipe((0,oe.R)(o.destroy$)).subscribe(function(a){var s=o.getUtteranceSelection();o.cursorLocation$.next(qt(1,s)),o.flushUnderlineDelayApply(),Ge(a);var l=qt(0,s);-1!==l&&o.showDropdownAtPosition(1,l)})})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"qnaInputContainerElementRef",{set:function(t){var o=this;t&&(this.qnaInputContainerElement=t.nativeElement,(0,Te.R)(t.nativeElement,"focusout").pipe((0,oe.R)(this.destroy$)).subscribe(function(r){var a=r.relatedTarget,s=r.target,l=!!s&&O(o.autoCompleteElement,s),g=!1;(!a&&!l||a&&!O(o.qnaInputContainerElement,a))&&(g=!0),g&&o.showHideDropdown(!1,{utterance:o.getCurrentUtteranceSpaceNormalized()})}))},enumerable:!1,configurable:!0}),i.prototype.ngOnInit=function(){var n;return(0,b.__awaiter)(this,void 0,void 0,function(){var t,r,a,s,l=this;return(0,b.__generator)(this,function(g){switch(g.label){case 0:return this.qnaProxyPath=this.qnaProxyPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule",t=this,[4,this.lazyProvider.get(this.qnaProxyPath,"InterpretServiceModern")];case 1:return t.interpretService=g.sent(),r=this,[4,this.lazyProvider.get(this.qnaModelUtilsPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaModelUtilsService")];case 2:return r.qnaModelUtils=g.sent(),this.fullConfig=_.merge({},Ci,this.configs),[4,this.updateCommitOnDemandMode()];case 3:return g.sent(),this.placeholder$=this.fullConfig.showPlaceholderText?_.isEmpty(this.fullConfig.customPlaceholderText)?this.interpretService.getPlaceholderText(this.qnaSupportedScopes).pipe((0,F.q)(1),(0,de.U)(function(c){return c.result})):(0,xe.of)(this.fullConfig.customPlaceholderText):(0,xe.of)(""),this.fullConfig.showLoadingIcon&&this.interpretListener.getObservable().subscribe(function(c){if(c&&1===c.resultType&&null!=c.retryWarning){var p=no([c.retryWarning],l.qnaProxyPath,l.localizationService);if(C.fF.assert(function(){return!_.isEmpty(p)},"Unmapped retry warning"),!_.isEmpty(p)){var f={tooltipShowOnFocus:!0,tooltipDescription:p,tooltipDelay:0,tooltipHideDelay:0,tooltipArrowPosition:l.getWarningLoadingIconTooltipArrowPosition()};l.loadingStateTooltipConfig$.next(f)}}}),this.ariaLabel=this.screenReaderService.concatMessages([this.fullConfig.customAriaLabel?this.fullConfig.customAriaLabel:this.localizationService.get("Qna_ScreenReader_TextboxLabel"),this.localizationService.get("Qna_ScreenReader_InitialInstruction")]),this.resetTags(),this.presentationSubject$=new Y.X(this.presentationArgs),this.interpretUtteranceRequest$=new Y.X(void 0),this.fullPresentation$=this.presentationSubject$.pipe((0,de.U)(function(c){var p=_.merge({},Zn,c);return p.singleUnderlineThickness=2+Math.floor(p.questionFontProperties.size.px/20),p}),(0,B.b)(function(c){l.autoCompleteInputArgs.presentation.next(c),l.errorBackgroundColorString=(0,gt.Et)(c.errorUnderlineColor,.15),l.warningBackgroundColorString=(0,gt.Et)(c.warningUnderlineColor,.15),l.acceptedBackgroundColorString=(0,gt.Et)(c.acceptedUnderlineColor,.15)}),(0,G.d)()),this.fullConfig.showWarningIcon&&this.fullConfig.disableAuthoring&&!_.isEmpty(this.fullConfig.disableAuthoringMessage)&&this.warningStateTooltipConfig$.next({tooltipShowOnFocus:!0,tooltipDescription:this.fullConfig.disableAuthoringMessage,tooltipDelay:0,tooltipHideDelay:0,tooltipArrowPosition:this.getWarningLoadingIconTooltipArrowPosition()}),this.displayedUtteranceInternal$.pipe((0,oe.R)(this.destroy$),(0,N.x)()).subscribe(function(c){l.distinctDisplayedUtterance$.next(c)}),this.isDisplayedUtteranceEmpty$=this.distinctDisplayedUtterance$.pipe((0,oe.R)(this.destroy$),(0,de.U)(function(c){return _.isEmpty(c)}),(0,N.x)(),(0,G.d)(1)),this.fullConfig.showActionButtons?this.inCommitOnDemandMode?(this.interpretUtteranceRequest$.pipe((0,oe.R)(this.destroy$),(0,de.U)(function(c){return null!=c&&!c.isCommitInCommitQuestionOnDemandMode}),(0,N.x)()).subscribe(function(c){l.hasUncommittedQuestion$.next(c)}),a=(0,Ue.aj)([this.hasFocus$,this.isDisplayedUtteranceEmpty$,this.hasUncommittedQuestion$]).pipe((0,oe.R)(this.destroy$),(0,de.U)(function(c){return!!c[2]||c[0]&&!c[1]}),(0,N.x)(),(0,X.B)()),this.commitActionVisible$=null!==(n=this.fullConfig.commitOnDemandConfigs)&&void 0!==n&&n.hideCommitActionUI?(0,xe.of)(!1):a.pipe((0,oe.R)(this.destroy$)),this.clearActionVisible$=a.pipe((0,oe.R)(this.destroy$))):(this.commitActionVisible$=(0,xe.of)(!1),this.clearActionVisible$=(0,Ue.aj)([this.hasFocus$,this.isDisplayedUtteranceEmpty$]).pipe((0,oe.R)(this.destroy$),(0,de.U)(function(c){return c[0]&&!c[1]}),(0,N.x)())):(this.commitActionVisible$=(0,xe.of)(!1),this.clearActionVisible$=(0,xe.of)(!1),this.noResetAllActionIndication=!0),this.isDisplayedUtteranceEmpty$.pipe((0,oe.R)(this.destroy$)).subscribe(function(c){c&&(!_.isEmpty(l.utteranceSuggestions)&&l.isInputBoxFocused()?l.showUtteranceSuggestions():l.contentElement&&(l.updateAutoCompleteArgsCommand$.next(void 0),l.showHideDropdown(!1),l.resetPausedTagTimeoutHandler(!1)))}),this.interpretResponse$=this.interpretUtteranceRequest$.pipe((0,ie.R)(function(c,p){return c.push(p),c.slice(-2)},[]),(0,ne.h)(function(c){var p,f,y=_.last(c);if(!y)return!1;var E=null!==(p=Ke(y.utterance))&&void 0!==p?p:"",D=null!==(f=l.initialUtterance)&&void 0!==f?f:"";return C.fF.assert(function(){return null!=l.contentElement||D===E},"If an interpret request sent in before this.contentElement is even initialized, we expect its utterance to be the same as 'initialUtterance' but now it's not. Re-check this assumption and fix accordingly."),!(null==l.contentElement&&D===E)}),(0,B.b)(function(c){_.nth(c,0)&&_.nth(c,1)&&!Yn(c[0].utterance,c[1].utterance)&&l.showGrippersAroundTextRangeRequest$.next(void 0)}),(0,de.U)(function(c){var p=_.last(c);if(!p.utteranceUITextAlreadyEnsured){var f=Ke(p.utterance),y=l.getUtteranceSelection(),E=l.ensureContentElementUtteranceText(f);l.displayedUtteranceInternal$.next(f);var D=!1;if(E?(y||p.enforceFocus)&&(y&&l.isValidRange(y)?l.setUtteranceSelection(y):D=!0):!y&&p.enforceFocus&&(D=!0),D){var k=p.utterance.length;l.setUtteranceSelection({normalizedAnchor:k,normalizedFocus:k})}}return p}),(0,ne.h)(function(c){return!!c}),(0,B.b)(function(c){l.displayedUtteranceInternal$.next(Ke(c.utterance))}),(0,me.w)(function(c){return l.interpretInternal(c)})),this.currentUtteranceInterpretResponse$=(0,Ue.aj)([this.interpretUtteranceRequest$,this.interpretResponse$]).pipe((0,de.U)(function(c){var p=c[0],f=c[1];if(f&&p&&f.interpretRequestId===p.uniqueId&&Ke(p.utterance)===l.getCurrentUtteranceSpaceNormalized())return(0,b.__assign)((0,b.__assign)({},f),{suppressSuggestions:p.suppressSuggestions,requireCursorAtEndIfFocused:p.requireCursorAtEndIfFocused,enforceFocus:p.enforceFocus,delayError:p.delayError,isFromInputEvent:p.isFromInputEvent})}),(0,ne.h)(function(c){return!!c}),(0,oe.R)(this.destroy$),(0,X.B)()),this.currentUtteranceInterpretResponseProcessed$=this.currentUtteranceInterpretResponse$.pipe((0,B.b)(function(c){if(l.loadingStateTooltipConfig$.next(void 0),l.fullConfig.showWarningIcon){var p=c?.warnings,f=no(p,l.qnaProxyPath,l.localizationService);if(!_.isEmpty(f)){var E={tooltipShowOnFocus:!0,tooltipDescription:_.isEmpty(l.fullConfig.disableAuthoringMessage)?f:l.localizationService.format("Qna_Input_Warning_AuthoringDisabled_Plus_AnotherWarning",[l.fullConfig.disableAuthoringMessage,f]),tooltipDelay:0,tooltipHideDelay:0,tooltipArrowPosition:l.getWarningLoadingIconTooltipArrowPosition()};l.warningStateTooltipConfig$.next(E)}}}),(0,ne.h)(function(c){return c&&!(_.isEmpty(c.utterance)&&!c.results)}),(0,de.U)(function(c){var p;return{utterance:c.utterance,fullCoverageSpans:cn(c),modelOwner:null===(p=_.first(c.results))||void 0===p?void 0:p.modelOwner,suppressSuggestions:c.suppressSuggestions,requireCursorAtEndIfFocused:c.requireCursorAtEndIfFocused,enforceFocus:c.enforceFocus,delayError:c.delayError,isFromInputEvent:c.isFromInputEvent}}),(0,B.b)(function(c){var p=l.getUtteranceSelectionAnchor();c.suppressSuggestions?l.showHideDropdown(!1):l.updateAutoCompleteArgsCommand$.next({matchingUtterance:c.utterance,cursorPosition:Math.max(p,0),triggerSource:0,spans:c.fullCoverageSpans})}),(0,X.B)()),s=_.merge({},Zn,this.presentationArgs),this.setupAutoCompleteRelatedPipes(s),this.uiSpans$=this.currentUtteranceInterpretResponseProcessed$.pipe((0,ze.D)(function(c){return(0,Ae.H)(c.isFromInputEvent?200:0)}),(0,ne.h)(function(c){return Ke(c.utterance)===l.getCurrentUtteranceSpaceNormalized()}),(0,de.U)(function(c){return{response:c,currentSelection:l.contentElement?l.getUtteranceSelection():void 0}}),(0,B.b)(function(c){var p=Ke(c.response&&c.response.utterance),f=c.currentSelection;l.cleanContentElement(),l.cursorLocation$.next(-1),l.ensureAngularCommentNodes(),l.contentElement.contentEditable="false";var y=c.response;setTimeout(function(){l.changeDetectorRef.detectChanges();var E=l.getCurrentUtteranceSpaceNormalized();if(f){var D=!1;y.requireCursorAtEndIfFocused||p===E&&(D=!0),l.setUtteranceSelection(D?f:{normalizedAnchor:k=E.length,normalizedFocus:k})}else if(l.isInputBoxFocused()||y.enforceFocus){var k;l.setUtteranceSelection({normalizedAnchor:k=E.length,normalizedFocus:k})}l.isInputBoxFocused()&&l.cursorLocation$.next(l.getUtteranceCursorPosition()),l.contentElement.contentEditable="true"},1)}),(0,de.U)(function(c){var p=c.response;return{uiSpans:yi(p.fullCoverageSpans,l.fullConfig),delayError:p.delayError,cursorPosition:c.currentSelection?c.currentSelection.normalizedFocus:-1}}),(0,B.b)(function(c){if(l.cancelUnderlineDelayApply(),c.delayError){var f,y,p=c.cursorPosition;-1!==p&&(f=_.find(c.uiSpans,function(E){return!E.isWhiteSpace&&p>=E.startIndex&&p<=E.endExcludingIndex})),f||(f=_.last(c.uiSpans)),f&&(f.shouldShowErrorUnderline||f.shouldShowWarningUnderline)&&(f.shouldShowErrorUnderline?(f.shouldShowErrorUnderline=!1,y=function(){f.shouldShowErrorUnderline=!0}):(f.shouldShowWarningUnderline=!1,y=function(){f.shouldShowWarningUnderline=!0}),l.underlineDelayApplyInfo={timeoutHandler:setTimeout(function(){y(),l.delayedSpanUnderlineStyleUpdated$.next(!0)},l.fullConfig.showErrorWarningUnderlineTimeout),apply:y})}}),(0,de.U)(function(c){return c.uiSpans}),(0,X.B)()),this.uiSpanWithCursor$=(0,Ue.aj)([this.uiSpans$,this.cursorLocation$]).pipe((0,oe.R)(this.destroy$),(0,de.U)(function(c){var f=c[1];if(!(f<0))for(var y=0,E=c[0]||[];y<E.length;y++){var D=E[y];if(!D.isWhiteSpace&&D.text.length>0&&f>=D.startIndex&&f<=D.endExcludingIndex)return D}}),(0,X.B)()),this.uiSpanWithCursor$.pipe((0,oe.R)(this.destroy$),(0,ne.h)(function(c){return!!c})).subscribe(function(c){c.shouldShowErrorUnderline&&l.showGrippersAroundTextRangeRequest$.next({startIndex:c.startIndex,endExcludingIndex:c.endExcludingIndex})}),this.setupCorrectionRelatedPipes(),this.setupGrippersRelatedPipes(),(0,Ue.aj)([this.uiSpans$,this.uiSpanWithCursor$,this.uiSpanWithMouseHover$,this.grippersInfo.grippersLocationDuringDragging$,this.tokensGripperLocInfoUpdated$,this.delayedSpanUnderlineStyleUpdated$]).pipe((0,oe.R)(this.destroy$)).subscribe(function(c){var p=c[0],f=c[1],y=c[2],E=c[3],D=E?.associatedUISpans===p&&!!E?.begin&&!!E?.end;_.forEach(p,function(k){var Se=l.getUISpanBackgroundState(k,k===f,k===y,D);k.backgroundColor="error"===Se?l.errorBackgroundColorString:"warning"===Se?l.warningBackgroundColorString:"accepted"===Se?l.acceptedBackgroundColorString:"transparent"})}),this.iconFontSize$=this.fullPresentation$.pipe((0,de.U)(function(c){return l.getIconFontSizePx(c)})),this.questionIconProperties={state$:new Y.X("normal"),ariaLabel$:new Y.X(this.localizationService.get("Qna_ScreenReader_TextboxIcon")),tooltipConfig$:new Y.X(void 0),loadingWarningPresentation$:new Y.X(void 0)},(0,Ue.aj)([this.loadingStateTooltipConfig$,this.warningStateTooltipConfig$]).pipe((0,oe.R)(this.destroy$)).subscribe(function(c){var p=c[0],f=c[1],y=p??f;l.questionIconProperties.state$.next(p?"loading":f?"warning":"normal");var E=[l.localizationService.get("Qna_ResetAllStates_Tooltip")];y?.tooltipDescription&&E.push(y?.tooltipDescription);var D=E.join("\n\n"),k=(0,b.__assign)({},y??{tooltipShowOnFocus:!0,tooltipDescription:"",tooltipDelay:0,tooltipHideDelay:0,tooltipArrowPosition:l.getWarningLoadingIconTooltipArrowPosition()});k.tooltipDescription=D,l.questionIconProperties.tooltipConfig$.next(k),l.questionIconProperties.ariaLabel$.next(k.tooltipDescription)}),this.fullPresentation$.pipe((0,oe.R)(this.destroy$)).subscribe(function(c){var p=l.getQuestionIconWarningCirleRadius(c);l.questionIconProperties.loadingWarningPresentation$.next({width:2*p,height:2*p,right:1-p+1,top:1-p+1,r:p,cx:p,cy:p,strokeColor:c.backgroundColor,strokeWidth:1,fillColor:c.commitButtonBackgroundColor})}),this.hasInitialized=!0,this.initialized&&this.initialized.emit(),[2]}})})},i.prototype.ngOnChanges=function(n){if(this.hasInitialized){var t=n.presentationArgs&&n.presentationArgs.currentValue;if(t){var o=n.presentationArgs.previousValue,r=o?_.merge({},o,t):t;this.presentationSubject$.next(r)}var a=n.configs&&n.configs.currentValue;if(a){var s=n.configs.previousValue;r=s?_.merge({},s,a):a,C.fF.assertValue(this.fullConfig,"this.fullConfig should have been initialized inside ngOnInit, since it comes here only if this.hasInitialized."),this.fullConfig=_.merge({},this.fullConfig,r)}}},i.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},Object.defineProperty(i.prototype,"currentDisplayedUtterance",{get:function(){return this.distinctDisplayedUtterance$.value},enumerable:!1,configurable:!0}),i.prototype.isEditable=function(){return!this.fullConfig.disableAuthoring},i.prototype.focus=function(){var n;if(this.contentElement&&(null===(n=this.fullConfig)||void 0===n||!n.disableAuthoring))return this.contentElement.focus(),!0},i.prototype.actionButtonsContainerClicked=function(){this.focus()},i.prototype.clearButtonClicked=function(n){Ge(n),this.clearUtterance(!0)},i.prototype.commitButtonClicked=function(n){Ge(n),this.hasUncommittedQuestion$.value&&this.commitUtterance()},i.prototype.showGrippersAroundTextRange=function(n){var t=this;C.fF.assert(function(){return t.fullConfig.supportTokenGrippers},"this should be called only when this.fullConfig.supportTokenGrippers is true"),this.showGrippersAroundTextRangeRequest$.next(n)},i.prototype.interpretUtterance=function(n){var t=n.utterance,o=n.isCommitInCommitQuestionOnDemandMode,r=n.specifiedSpans;if(this.inCommitOnDemandMode)if(n.useUncommittedUtterance&&this.hasUncommittedQuestion$.value){var a=this.getCurrentUtteranceSpaceNormalized();a!==t&&(t=a,o=!0,r=void 0)}else!this.hasUncommittedQuestion$.value&&n.utterance===this.getCurrentUtteranceSpaceNormalized()&&(o=!0);this.interpretUtteranceRequest$.next({utterance:t,uniqueId:Me.b$.generateGuid(),isCommitInCommitQuestionOnDemandMode:o,utteranceUITextAlreadyEnsured:!1,delayError:!1,enforceFocus:n.enforceFocus,requireCursorAtEndIfFocused:n.requireCursorAtEndIfFocused,suppressSuggestions:n.suppressSuggestions,incomingTags:n.incomingTags,linguisticSchemaJson:this.linguisticInfo&&this.linguisticInfo.linguisticSchemaJson,inferredTermBinding:this.linguisticInfo&&this.linguisticInfo.inferredTermBinding,specifiedSpans:r})},i.prototype.clearUtterance=function(n,t){var o=this;void 0===t&&(t=!1),this.undoRedoService.register(this.inCommitOnDemandMode&&t?"Reset Qna state":"Clear QnA utterance",function(){var a=!!o.inCommitOnDemandMode&&t;o.interpretUtteranceRequest$.next({uniqueId:Me.b$.generateGuid(),utterance:"",utteranceUITextAlreadyEnsured:!1,delayError:!1,enforceFocus:!!n,requireCursorAtEndIfFocused:!1,suppressSuggestions:!0,linguisticSchemaJson:void 0,inferredTermBinding:void 0,incomingTags:void 0,specifiedSpans:void 0,isCommitInCommitQuestionOnDemandMode:a})})},i.prototype.commitUtterance=function(){var n=this;C.fF.assert(function(){return n.inCommitOnDemandMode},"expect this.inCommitOnDemandMode to be true"),this.undoRedoService.register("Commit QnA utterance",function(){n.interpretUtteranceRequest$.next({uniqueId:Me.b$.generateGuid(),utterance:n.displayedUtteranceInternal$.value,isCommitInCommitQuestionOnDemandMode:!0,utteranceUITextAlreadyEnsured:!0,delayError:!1,enforceFocus:!0,requireCursorAtEndIfFocused:!1,suppressSuggestions:!0,linguisticSchemaJson:void 0,inferredTermBinding:void 0,incomingTags:["Committed"],specifiedSpans:void 0})})},i.prototype.resetAllState=function(){this.clearUtterance(!0,!0)},i.prototype.replaceWithCorrectedUtterance=function(n,t){if(1===t||2===t){var o=1===t?["DidYouMean"]:["ShowingResultsFor"];return o.push("Committed"),void this.replaceWithUtterance(n,!0,!0,!0,o)}C.fF.assertFail("this should only be called for didYouMean or showingResultsFor")},i.prototype.onSpanMouseEnter=function(n){this.uiSpanWithMouseHover$.next(n)},i.prototype.onSpanMouseLeave=function(n){this.uiSpanWithMouseHover$.value===n&&this.uiSpanWithMouseHover$.next(void 0)},i.prototype.gripperKeyUp=function(n,t,o){var r=this,a="beginGripper"===o;if(a||"endGripper"===o){if("Escape"===n.key)return Ge(n),ut(n),this.setUtteranceSelection({normalizedAnchor:t.position,normalizedFocus:t.position}),void this.updateAutoCompleteArgsCommand$.next({matchingUtterance:this.getCurrentUtteranceSpaceNormalized(),cursorPosition:t.position,triggerSource:2,spans:void 0});if("ArrowDown"===n.key)return Ge(n),ut(n),this.setUtteranceSelection({normalizedAnchor:t.position,normalizedFocus:t.position}),void this.arrowDownOnInputboxHanlder();var l="ArrowLeft"===n.key;(l||"ArrowRight"===n.key)&&(Ge(n),ut(n),this.showHideDropdown(!1),this.tryDropGripperInZone(o,a?l?t.previousBeginGripperZoneInfo:t.nextBeginGripperZoneInfo:l?t.previousEndGripperZoneInfo:t.nextEndGripperZoneInfo)&&setTimeout(function(){var p,f,y=a?null===(p=r.beginGripperElementRef)||void 0===p?void 0:p.nativeElement:null===(f=r.endGripperElementRef)||void 0===f?void 0:f.nativeElement;y&&y.focus()}))}},i.prototype.getWarningLoadingIconTooltipArrowPosition=function(){return xt.xI.arrowBottomLeft},i.prototype.getIconFontSizePx=function(n){return Math.max(n.questionFontProperties.size.px,14)},i.prototype.getQuestionIconWarningCirleRadius=function(n){var t=this.getIconFontSizePx(n);return 3+.5*(Math.floor(t/4)-4)+1},i.prototype.updateCommitOnDemandMode=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,t,o;return(0,b.__generator)(this,function(r){switch(r.label){case 0:return C.fF.assertValue(this.fullConfig,"this.fullConfig should already been set"),null!=(n=this.fullConfig.commitOnDemandForcedMode)?(this.inCommitOnDemandMode="AlwaysOn"===n,[2]):(this.inCommitOnDemandMode=!1,t=_.map(this.qnaSupportedScopes,function(a){return a.model}),o=this,[4,(0,ln.U)(_.map(t,function(a){return{datasetName:a.dbName,datasetId:a.id}}),this.qnaModelUtils,this.featureSwitchService)]);case 1:return o.inCommitOnDemandMode=r.sent(),[2]}})})},i.prototype.getCurrentUtteranceSpaceNormalized=function(){return this.contentElement?Ke(this.contentElement.textContent):void 0},i.prototype.getUISpanBackgroundState=function(n,t,o,r){return n.shouldShowAcceptedUnderline||n.shouldShowErrorUnderline||n.shouldShowWarningUnderline?((t||o)&&(a=!r&&!_.some(n.tokens,function(s){return s.isBetweenOnDraggingGrippers||s.isBetweenDroppedGrippers})),a?n.shouldShowErrorUnderline?"error":n.shouldShowWarningUnderline?"warning":"accepted":"normal"):"normal";var a},i.prototype.replaceWithUtterance=function(n,t,o,r,a){var s=this;this.undoRedoService.register("Replace QnA utterance",function(){var l,g;s.interpretUtteranceRequest$.next({uniqueId:Me.b$.generateGuid(),utterance:n,utteranceUITextAlreadyEnsured:!1,suppressSuggestions:t,requireCursorAtEndIfFocused:!0,enforceFocus:o,delayError:!1,linguisticSchemaJson:null===(l=s.linguisticInfo)||void 0===l?void 0:l.linguisticSchemaJson,inferredTermBinding:null===(g=s.linguisticInfo)||void 0===g?void 0:g.inferredTermBinding,incomingTags:a,specifiedSpans:void 0,isCommitInCommitQuestionOnDemandMode:r})})},i.prototype.autoCompleteDropdownItemSelected=function(n){var t,o=this.getCurrentUtteranceSpaceNormalized();1===n.action&&this.toolingLaunched.emit();var r=!(null!==(t=this.fullConfig.commitOnDemandConfigs)&&void 0!==t&&t.noCommitOnDropdownSelection);_.isEmpty(n.utterance)||Ke(n.utterance)===o?this.showHideDropdown(!!n.showDropdown,{incomingTags:n.tags,utterance:o}):(this.resetPausedTagTimeoutHandler(!1),this.replaceWithUtterance(Ke(n.utterance),!0,!0,r,n.tags),this.showHideDropdown(!1)),this.inCommitOnDemandMode&&r&&this.hasUncommittedQuestion$.value&&this.commitUtterance()},i.prototype.autoCompleteFullyExpanded=function(){C.fF.assertValue(this.utteranceSelectionAtLastAutoCompleteInputUpdate,"autocomplete fully expanded, this.utteranceSelectionAtLastAutoCompleteInputUpdate should be defined"),this.utteranceSelectionAtLastAutoCompleteInputUpdate?this.setUtteranceSelection(this.utteranceSelectionAtLastAutoCompleteInputUpdate):this.focus()},i.prototype.getTokenZoneInfo=function(n,t){var o=n.dropZonesInfo;if(o)return t?o.zoneLocatedBeforeInfo:o.zoneLocatedAfterInfo},i.prototype.dropZonePredicate=function(n,t){return"beginGripper"===n.data?!!t.data.beginGripperOf:!!t.data.endGripperOf},i.prototype.beginGripperDragStarted=function(){this.oneGripperDragStarted("beginGripper")},i.prototype.endGripperDragStarted=function(){this.oneGripperDragStarted("endGripper")},i.prototype.gripperEnter=function(n){var t,o;eo(null===(t=n.item)||void 0===t?void 0:t.data,null===(o=n.container)||void 0===o?void 0:o.data,this.grippersInfo.grippersLocationDuringDragging$)},i.prototype.dropGripper=function(n){var t,o,r=null===(t=n.item)||void 0===t?void 0:t.data,a=null===(o=n.container)||void 0===o?void 0:o.data;this.tryDropGripperInZone(r,a)},i.prototype.tryDropGripperInZone=function(n,t){var o;return this.grippersInfo.gripperOnDragging$.next("none"),C.fF.assertValue(null===(o=this.grippersInfo.grippersLocationDuringDragging$.value)||void 0===o?void 0:o.associatedUISpans,"this.grippersInfo.grippersLocationDuringDragging$.value.associatedUISpans should be defined"),this.grippersInfo.grippersLocationDuringDragging$.next({associatedUISpans:this.grippersInfo.grippersLocationDuringDragging$.value.associatedUISpans,begin:void 0,end:void 0}),eo(n,t,this.grippersInfo.grippersLocationDropped$)},i.prototype.sendFeedback=function(n,t){return C.fF.assertValue(n,"invalid feedback"),C.fF.assertValue(t,"invalid feedback utterance"),this.interpretService.sendFeedback(n,t,this.qnaSupportedScopes,this.tags)},i.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule(".qnaInputV2Container svg *","{ stroke: @foregroundColor !important; fill: @foregroundColor !important; opacity: 1 !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .qnaInputV2Container *.disabled, .themeableElement .qnaInputV2Container *.disabled *","{ color: @disabledTextColor !important; border-color: @disabledTextColor !important; opacity: 1 !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .inputBox .qnaInputV2Container .inputWithoutAutoCompleteContainer button.actionButton.disabled:hover, .themeableElement .inputBox .qnaInputV2Container .inputWithoutAutoCompleteContainer button.actionButton.disabled:hover * ","{ background-color: transparent !important; color: @disabledTextColor !important; }"),this.highContrastCssGenerationService.addRule('html[data-focus-source="key"] .inputBox .qnaInputV2Container .beginGripper:focus, html[data-focus-source="key"] .inputBox .qnaInputV2Container .endGripper:focus',"{ outline-color: @foregroundColor; outline-offset: 4px; outline-style: dashed }")},i.prototype.showUtteranceSuggestions=function(){if(!_.isEmpty(this.utteranceSuggestions)){var n={startIndex:0,endExcludingIndex:0,text:"",isUnknown:!1,isCorrected:!1,state:"accepted",isOverlapping:!1,isWhiteSpace:!1,isUsed:!1,replacementBindings:{alternates:_.map(this.utteranceSuggestions,function(o){return{type:10,text:o,textSegmentsWithMatchInfo:[{text:o,isMatched:!1}],score:0}})}};this.showHideDropdown(!0),this.autoCompleteInputArgs.params.next({spans:[n],cursorPosition:0,config:{header:{show:!1}}}),this.resetPausedTagTimeoutHandler(!1)}},i.prototype.resetTags=function(){this.tags=[this.entryPoint]},i.prototype.flushUnderlineDelayApply=function(){if(this.underlineDelayApplyInfo){var n=this.underlineDelayApplyInfo.apply;this.cancelUnderlineDelayApply(),n()}},i.prototype.cancelUnderlineDelayApply=function(){this.underlineDelayApplyInfo&&(clearTimeout(this.underlineDelayApplyInfo.timeoutHandler),this.underlineDelayApplyInfo.timeoutHandler=void 0,this.underlineDelayApplyInfo=void 0)},i.prototype.showDropdownAtCurrentPosition=function(n){var t=this.getUtteranceSelectionAnchor();this.showDropdownAtPosition(n,t)},i.prototype.showDropdownAtPosition=function(n,t){C.fF.assert(function(){return-1!==t},"the given cursorPosition should not be -1.");var o=this.getCurrentUtteranceSpaceNormalized();C.fF.assert(function(){return t<=_.size(o)},"the given cursorPosition should not be > current displayed utterance's length."),-1!==t&&this.updateAutoCompleteArgsCommand$.next({matchingUtterance:o,cursorPosition:t,triggerSource:n,spans:void 0}),this.showHideDropdown(!0)},i.prototype.setupAutoCompleteRelatedPipes=function(n){var t=this;this.isDropdownOn$=new Y.X(!1),this.updateAutoCompleteArgsCommand$=new Y.X(void 0),this.autoCompleteInputArgs={params:new Y.X(void 0),presentation:new Y.X(n),selectPrevious:new Y.X(void 0),selectNext:new Y.X(void 0),confirmSelection:new Y.X(void 0)},this.fullConfig.disableAuthoring?this.shouldShowAutoComplete$=(0,xe.of)(!1):((0,Ue.aj)([this.updateAutoCompleteArgsCommand$,this.currentUtteranceInterpretResponseProcessed$]).pipe((0,de.U)(function(o){var r=o[0],a=o[1];if(r&&a&&Yn(r.matchingUtterance,a.utterance))return{command:r,response:a}}),(0,ne.h)(function(o){return!!o}),(0,N.x)(function(o,r){if(o.command.matchingUtterance===r.command.matchingUtterance&&o.command.cursorPosition===r.command.cursorPosition)return!0}),(0,de.U)(function(o){var r,a,s=o.command,l=o.response,g=t.getCurrentUtteranceSpaceNormalized(),c={spans:s.spans||l.fullCoverageSpans,cursorPosition:s.cursorPosition,config:{header:{show:(null===(r=t.fullConfig.spanDropdownHeaderConfig)||void 0===r?void 0:r.show)&&0!==s.triggerSource&&s.cursorPosition<g.length}},modelOwner:l.modelOwner,dataSourceArray:t.dataSourcesService.get(),exploration:t.explorationNavigationService.getCurrentExploration()};return c.config.header.show&&(c.config.header.unknownSpanHeaderConfig=null===(a=t.fullConfig.spanDropdownHeaderConfig)||void 0===a?void 0:a.unknownSpanHeaderConfig),{params:c,utterance:s.matchingUtterance}}),(0,oe.R)(this.destroy$)).subscribe(function(o){t.autoCompleteInputArgs.params.next(o.params);var r=!_.isEmpty(o.utterance)&&!!o.params;t.resetPausedTagTimeoutHandler(r,o.utterance);var a=!_.isEmpty(o.utterance)&&!t.escapedDropdown;t.showHideDropdown(a)}),this.shouldShowAutoComplete$=(0,Ue.aj)([this.isDropdownOn$,this.autoCompleteInputArgs.params]).pipe((0,de.U)(function(o){return!!o[1]&&!!o[0]}),(0,B.b)(function(o){t.utteranceSelectionAtLastAutoCompleteInputUpdate=o?t.getUtteranceSelection():void 0}),(0,N.x)(),(0,oe.R)(this.destroy$)))},i.prototype.setupCorrectionRelatedPipes=function(){var n=this;this.currentUtteranceAutoCorrectionInfo$=this.fullConfig.showCorrectedUtterance?this.currentUtteranceInterpretResponse$.pipe((0,ne.h)(function(o){return!o.isQuestionUnCommitted}),(0,de.U)(function(o){var s,l,r=_.first(o?.results),a=r?.correctionInfo;if(a&&0!==a.state)return function(i){return"correctedTextSegments"in i}(a)?(s=a.correctedUtterance,l=function(i){if(i){var n=i.correctedUtterance,t=i.correctedTextSegments,o=[];if(!_.isEmpty(t)){var r=0;return _.forEach(t,function(a){r<a.startIndex&&o.push({text:n.substring(r,a.startIndex),isCorrected:!1}),o.push({text:n.substring(a.startIndex,a.endExcludingIndex),isCorrected:!0}),r=a.endExcludingIndex}),r<n.length&&o.push({text:n.substring(r),isCorrected:!1}),o}}}(a)):(s=a.replacementUtterance,l=function(i,n){if(n){for(var t=n.correctedUtterance,o=[],r=0,a=0,s=0,l=0,g=i;l<g.length;l++){var c=g[l];if(!_.isEmpty(c.text)&&(r=s,null!=c.correctedStartIndex&&null!=c.correctedEndExcludingIndex?(a=c.correctedStartIndex,s=c.correctedEndExcludingIndex):s=(a=t.indexOf(c.text,r))+(c.endExcludingIndex-c.startIndex),c.isUsed)){if(r!==a){var p=t.substring(r,a);(!_.isEmpty(_.trim(p))||!_.isEmpty(o))&&o.push({text:t.substring(r,a),isCorrected:!1})}o.push({text:t.substring(a,s),isCorrected:c.isCorrected})}}return o}}(r.spans,a)),{label:Pi(a.state,n.localizationService),spans:l,replacementUtterance:s,state:a.state}})):(0,xe.of)(void 0)},i.prototype.setupGrippersRelatedPipes=function(){var n=this;this.grippersInfo={grippersLocationDropped$:new Y.X(void 0),grippersLocationDuringDragging$:new Y.X(void 0),gripperOnDragging$:new Y.X("none")},this.showGrippersAroundTextRangeRequest$=new Y.X(void 0),this.fullConfig.supportTokenGrippers&&((0,Ue.aj)([this.uiSpans$,this.showGrippersAroundTextRangeRequest$]).pipe((0,oe.R)(this.destroy$)).subscribe(function(t){var o=t[0],r=t[1],a=-1;r&&(a=_.findIndex(o,function(l){return l.startIndex===r.startIndex&&l.endExcludingIndex===r.endExcludingIndex})),n.grippersInfo.grippersLocationDropped$.next(-1===a?{associatedUISpans:o,begin:void 0,end:void 0}:{associatedUISpans:o,begin:{spanIndex:a,tokenIndex:0},end:{spanIndex:a,tokenIndex:_.size(o[a].tokens)-1}}),n.grippersInfo.grippersLocationDuringDragging$.next({associatedUISpans:o,begin:void 0,end:void 0}),n.grippersInfo.gripperOnDragging$.next("none")}),(0,Ue.aj)([this.uiSpans$,this.grippersInfo.grippersLocationDuringDragging$]).pipe((0,oe.R)(this.destroy$),(0,N.x)(function(t,o){return t[0]===o[0]&&_.isEqual(t[1],o[1])})).subscribe(function(t){var o=t[0],r=t[1];r&&r.associatedUISpans!==o||(_.forEach(o,function(a,s){_.forEach(a.tokens,function(l,g){l.isBetweenOnDraggingGrippers=!!r&&to(s,g,n.grippersInfo.grippersLocationDuringDragging$.value)})}),n.tokensGripperLocInfoUpdated$.next(!0))}),(0,Ue.aj)([this.uiSpans$,this.grippersInfo.grippersLocationDropped$]).pipe((0,oe.R)(this.destroy$),(0,N.x)(function(t,o){return t[0]===o[0]&&_.isEqual(t[1],o[1])})).subscribe(function(t){var o=t[0],r=t[1];if(!r||r.associatedUISpans===o)if(_.forEach(o,function(p,f){_.forEach(p.tokens,function(y,E){var D=y.dropZonesInfo;if(r?.begin&&r?.end){if(D){var k=D.zoneLocatedBeforeInfo;k.hasBeginGripper=Mn(y,!0,"beginGripper",r),k.hasEndGripper=Mn(y,!0,"endGripper",r);var Se=D.zoneLocatedAfterInfo;Se.hasBeginGripper=Mn(y,!1,"beginGripper",r),Se.hasEndGripper=Mn(y,!1,"endGripper",r)}y.isBetweenDroppedGrippers=to(f,E,n.grippersInfo.grippersLocationDropped$.value)}else D&&(D.zoneLocatedBeforeInfo.hasBeginGripper=!1,D.zoneLocatedBeforeInfo.hasEndGripper=!1,D.zoneLocatedAfterInfo.hasBeginGripper=!1,D.zoneLocatedAfterInfo.hasEndGripper=!1),y.isBetweenDroppedGrippers=!1})}),n.tokensGripperLocInfoUpdated$.next(!0),r?.begin&&r?.end){var a=r.begin,l=r.end,g=o[l.spanIndex].tokens[l.tokenIndex];n.grippersDefinedTextRangeChanged.emit({startIndex:o[a.spanIndex].tokens[a.tokenIndex].startIndex,endExcludingIndex:g.startIndex+g.text.length})}else n.grippersDefinedTextRangeChanged.emit(void 0)}))},i.prototype.interpretInternal=function(n){var t=this;this.fullConfig.showWarningIcon&&!_.isEmpty(this.fullConfig.disableAuthoringMessage)?this.warningStateTooltipConfig$.next({tooltipShowOnFocus:!0,tooltipDescription:this.fullConfig.disableAuthoringMessage,tooltipDelay:0,tooltipHideDelay:0}):this.warningStateTooltipConfig$.next(void 0),this.loadingStateTooltipConfig$.next(void 0);var o=!0;this.inCommitOnDemandMode&&(o=!!n.isCommitInCommitQuestionOnDemandMode),this.escapedDropdown=!1;var r={utterance:"",interpretRequestId:n.uniqueId,isQuestionCommitted:!0};if(_.isEmpty(n.utterance))return o&&this.interpretListener.onInterpretResultCleared(),this.resetTags(),(0,xe.of)(r);var a=_.union(this.tags,n.incomingTags);this.resetTags();var s=this.fullConfig.calculation;return s&&o&&(s=(0,b.__assign)((0,b.__assign)({},s),{isCommitted:!0})),this.interpretRequestSequenceNumber++,this.getReportMetadata().pipe((0,me.w)(function(g){return t.interpretService.interpret({groupId:t.componentUniqueId,groupSequenceNumber:t.interpretRequestSequenceNumber},n.utterance,t.entryPoint,t.qnaSupportedScopes,t.interpretListener,{supportsPodQueries:t.fullConfig.supportsPodQueries,supportsInsightsQueries:t.fullConfig.supportsInsightsQueries,inferUnknownModelTerms:t.fullConfig.inferUnknownModelTerms,singleAnswerBias:t.fullConfig.singleAnswerBias,supportsCalculation:!!s},{isQuestionNotCommitted:!o,specifiedSpans:n.specifiedSpans,linguisticSchemaJson:n.linguisticSchemaJson,inferredTermBinding:n.inferredTermBinding,tags:a,calculation:s},g).pipe((0,F.q)(1),(0,de.U)(function(c){return _.merge({},c,{interpretRequestId:n.uniqueId,isQuestionUnCommitted:!o})}))}))},i.prototype.getReportMetadata=function(){var n=this;if("@powerbi/Qna/qnadesktop.module#QnaDesktopModule"!==this.qnaProxyPath||!this.fullConfig.supportsPodQueries||!this.linguisticSchemaProxy)return(0,xe.of)(void 0);var t=this.explorationNavigationService.getCurrentExploration();return t?(0,De.D)(this.conceptualSchemaProxy.get(this.dataSourcesService.get())).pipe((0,de.U)(function(r){var a=n.linguisticSchemaProxy.getSchema(-1);if(a?.content)return{linguisticSchema:a.content,pods:_.map(t.pods,function(s){return{name:s.name,parameters:_.chain(s.parameters).map(function(l){var g=function(i,n,t,o){var r=_.find(t.sections,function(l){return l.name===n});if(r){var a=_.find(r.filters,function(l){return l.name===i});if(a?.expression){var s=a.expression.getConceptualProperty(o);return s?{column:s.name,entity:a.expression.getTargetEntity().entity}:void 0}C.fF.assertFail("filter should be part of the section and have an expression")}else C.fF.assertFail("pod section should be part of the exploration")}(l.boundFilter,s.boundSection,t,r);if(g)return{name:l.name,targetColumn:g.column,targetEntity:g.entity}}).filter(function(l){return!!l}).value(),cortanaEnabled:s.cortanaEnabled}})}})):(0,xe.of)(void 0)},i.prototype.resetPausedTagTimeoutHandler=function(n,t){var o=this;this.fullConfig.disableSendingServiceTags||(null!=this.pausedTagTimeoutHandler&&(clearTimeout(this.pausedTagTimeoutHandler),this.pausedTagTimeoutHandler=null),n&&(C.fF.assert(function(){return!_.isEmpty(t)},"Expect the given utteranceIfRestart not to be empty."),this.pausedTagTimeoutHandler=setTimeout(function(){o.sendTags(["Paused"],t),o.pausedTagTimeoutHandler=void 0},this.fullConfig.sendPausedTagTimeout)))},i.prototype.showHideDropdown=function(n,t){if(!this.fullConfig.disableAuthoring){var o=this.isDropdownOn$.value;if(this.escapedDropdown=!n,(o!==n||n)&&(this.isDropdownOn$.next(n),t)){var r=void 0;_.isEmpty(this.getCurrentUtteranceSpaceNormalized())?r=_.union(t.incomingTags,["Dropdown:Suggested","Committed"]):(C.fF.assert(function(){return!_.isEmpty(t.utterance)},"Going to send tags for dropdown commit, expect its associated utterance not empty"),r=_.union(t.incomingTags,["Committed"])),this.resetPausedTagTimeoutHandler(!1),this.sendTags(r,t.utterance)}}},i.prototype.sendTags=function(n,t){return(0,b.__awaiter)(this,void 0,void 0,function(){var o;return(0,b.__generator)(this,function(r){switch(r.label){case 0:return o=_.union(this.tags,n),this.resetTags(),_.isEmpty(o)?[2]:[4,this.interpretService.sendTags(o,t,this.entryPoint,this.qnaSupportedScopes,{supportsPodQueries:this.fullConfig.supportsPodQueries,supportsInsightsQueries:this.fullConfig.supportsInsightsQueries,inferUnknownModelTerms:this.fullConfig.inferUnknownModelTerms,singleAnswerBias:this.fullConfig.singleAnswerBias})];case 1:return r.sent(),[2]}})})},i.prototype.isInputBoxFocused=function(){return this.contentElement&&O(this.contentElement,document.activeElement)},i.prototype.getUtteranceSelection=function(){if(C.fF.assertValue(this.contentElement,"this.contentElement"),this.isInputBoxFocused())return function(i){if(i&&window.getSelection){var n=window.getSelection();if(n.rangeCount&&O(i,n.anchorNode)&&O(i,n.focusNode)){var t=n.getRangeAt(0),o=t.cloneRange();o.selectNodeContents(i),o.setEnd(t.startContainer,t.startOffset);var r=o.toString().length;if(n.isCollapsed)return{normalizedAnchor:r,normalizedFocus:r};o.setEnd(t.endContainer,t.endOffset);var a=o.toString().length,s=n.anchorNode===t.startContainer;return{normalizedAnchor:s?r:a,normalizedFocus:s?a:r}}}}(this.contentElement)},i.prototype.isValidRange=function(n){var t=_.size(this.contentElement.textContent);return _.inRange(n.normalizedAnchor,0,t+1)&&_.inRange(n.normalizedFocus,0,t+1)},i.prototype.setUtteranceSelection=function(n){C.fF.assertValue(n,"selection"),C.fF.assertValue(this.contentElement,"this.contentElement"),function(i,n){C.fF.assertValue(i,"Expect the given node to be defined."),C.fF.assertValue(n,"Expect the given selectionRange to be defined."),C.fF.assert(function(){return _.inRange(n.normalizedAnchor,0,_.size(i.textContent)+1)},"Expect the given selectionRange.anchor is a valid position inside the given node"),C.fF.assert(function(){return _.inRange(n.normalizedFocus,0,_.size(i.textContent)+1)},"Expect the given selectionRange.focus is a valid position inside the given node");var t=_.size(i.textContent);if(i&&n&&_.inRange(n.normalizedAnchor,0,t+1)&&_.inRange(n.normalizedFocus,0,t+1)){var o=window.getSelection&&window.getSelection();if(o){var r=n.normalizedAnchor,a=n.normalizedFocus,s=S(i,r);if(C.fF.assertValue(s,"Expect to find the NodeAndOffset for character position "+r+" inside the node"),s){var l=a===r?s:S(i,a);if(C.fF.assertValue(s,"Expect to find the NodeAndOffset for character position "+a+" inside the node"),l){var g=s.node,c=s.textOrChildNodesOffset,p=l.node,f=l.textOrChildNodesOffset;if(o.anchorNode!==g||o.focusNode!==p||o.anchorOffset!==c||o.focusOffset!==f){i instanceof HTMLElement&&i.focus();var y=document.createRange();y.setStart(g,c),y.setEnd(p,f),o.removeAllRanges(),o.addRange(y)}}}}}}(this.contentElement,n)},i.prototype.getUtteranceCursorPosition=function(){var n=this.getUtteranceSelection();return n?n.normalizedFocus:-1},i.prototype.getUtteranceSelectionAnchor=function(){return qt(0,this.getUtteranceSelection())},i.prototype.addEventListeners=function(){var n=this;(0,Te.R)(this.contentElement,"click").pipe((0,oe.R)(this.destroy$),(0,X.B)()).subscribe(function(p){var f=n.getUtteranceSelection(),y=qt(1,f);n.cursorLocation$.next(y),n.flushUnderlineDelayApply(),Ge(p);var E=n.getCurrentUtteranceSpaceNormalized(),D=qt(0,f);_.isEmpty(E)||-1!==D&&n.updateAutoCompleteArgsCommand$.next({matchingUtterance:E,cursorPosition:D,triggerSource:1,spans:void 0})});var o=(0,Te.R)(this.contentElement,"paste").pipe((0,de.U)(function(p){return{event:p,beforePastedContentElementText:n.contentElement.textContent}}),(0,B.b)(function(p){if(ut(p.event),Ge(p.event),window.getSelection){var f=(n.getCurrentUtteranceSpaceNormalized()||"").length,y=n.getUtteranceSelection();y&&(f-=Math.abs(y.normalizedAnchor-y.normalizedFocus));var E=(function(i){var n=i.originalEvent||i;return n.clipboardData&&n.clipboardData.getData?n.clipboardData.getData("text/plain"):window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):void 0}(p.event)||"").substr(0,200-f);!function(i){C.fF.assertValue(window.getSelection,"Expecting window.getSelection is defined");var n=window.getSelection();if(n.rangeCount){var t=n.getRangeAt(0);if(t.deleteContents(),i){var o=document.createTextNode(i);t.insertNode(o),t.setStart(o,i.length),t.collapse(!0)}}}(E)}}),(0,ne.h)(function(p){return p.beforePastedContentElementText!==n.contentElement.textContent})),r=(0,Te.R)(this.contentElement,"compositionend").pipe((0,X.B)()),a=(0,Te.R)(this.contentElement,"keyup").pipe((0,oe.R)(this.destroy$),(0,ne.h)(function(p){return!Bt(p)}),(0,X.B)());a.pipe((0,oe.R)(this.destroy$),(0,ne.h)(function(p){return"Backspace"===p.key||"Delete"===p.key})).subscribe(function(p){_.isEmpty(n.getCurrentUtteranceSpaceNormalized())&&n.cleanContentElement()}),a.pipe((0,oe.R)(this.destroy$),(0,ne.h)(function(p){return _.includes(["Home","End","ArrowLeft","ArrowRight"],p.key)})).subscribe(function(p){kn(p)||n.cursorLocation$.next(n.getUtteranceCursorPosition())});var s=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Backspace","Delete","Home","End","Enter","Escape","Tab"],l=["A","X","C","Z","a","x","c","z"],g=(0,Te.R)(this.contentElement,"keydown").pipe((0,oe.R)(this.destroy$),(0,ne.h)(function(p){return!Bt(p)}),(0,B.b)(function(p){!kn(p)&&!_.includes(s,p.key)&&(!p.ctrlKey||!_.includes(l,p.key))&&n.getCurrentUtteranceSpaceNormalized().length>=200&&ut(p)}),(0,X.B)());(0,Te.R)(this.contentElement,"focus").pipe((0,oe.R)(this.destroy$),(0,Ne.M)(this.distinctDisplayedUtterance$)).subscribe(function(p){var y=p[1];n.inputBoxFocused.emit(p[0]),n.hasFocus$.next(!0),n.cursorLocation$.next(n.getUtteranceCursorPosition()),!n.isAutoCompleteDropdownShown()&&_.isEmpty(y)&&n.showUtteranceSuggestions()}),(0,Te.R)(this.contentElement,"blur").pipe((0,oe.R)(this.destroy$)).subscribe(function(p){var f=p.relatedTarget;n.deleteButtonElementRef&&n.deleteButtonElementRef.nativeElement.contains(f)||n.commitButtonElementRef&&n.commitButtonElementRef.nativeElement.contains(f)||n.hasFocus$.next(!1),n.cursorLocation$.next(-1),n.flushUnderlineDelayApply();var D=window.getSelection?window.getSelection():void 0;D&&D.removeAllRanges()});var c=(0,Te.R)(this.contentElement,"input").pipe((0,ne.h)(function(p){return!p.isComposing}));(0,Ve.T)(c,r,o).pipe((0,oe.R)(this.destroy$),(0,de.U)(function(p){return n.getCurrentUtteranceSpaceNormalized()}),(0,B.b)(function(p){n.displayedUtteranceInternal$.next(p)})).subscribe(function(p){n.interpretUtteranceRequest$.next({uniqueId:Me.b$.generateGuid(),utterance:p,utteranceUITextAlreadyEnsured:!0,delayError:!0,enforceFocus:!1,suppressSuggestions:!1,requireCursorAtEndIfFocused:!1,linguisticSchemaJson:n.linguisticInfo&&n.linguisticInfo.linguisticSchemaJson,inferredTermBinding:n.linguisticInfo&&n.linguisticInfo.inferredTermBinding,incomingTags:void 0,specifiedSpans:void 0,isFromInputEvent:!0})}),g.pipe((0,oe.R)(this.destroy$),(0,ne.h)(function(p){return!Bt(p)})).subscribe(function(p){if(kn(p)&&!_.includes(["Tab","Enter"],p.key))return _.includes(["ArrowLeft","ArrowRight","Escape","ArrowDown"],p.key)?(Ge(p),void ut(p)):void 0;var f=n.getCurrentUtteranceSpaceNormalized();switch(p.key){case"z":case"Z":It.M.isCtrlOrMeta(p)&&(ut(p),n.fullConfig.hostSupportsUndo?n.contentElement.blur():Ge(p));break;case"ArrowLeft":n.flushUnderlineDelayApply(),Ge(p),_.isEmpty(f)||-1!==(E=qt(0,y=n.getUtteranceSelection()))&&n.updateAutoCompleteArgsCommand$.next({matchingUtterance:f,cursorPosition:y.normalizedAnchor!==y.normalizedFocus?E:Math.max(0,E-1),triggerSource:2,spans:void 0});break;case"ArrowRight":case"Right":var y,E;n.flushUnderlineDelayApply(),Ge(p),_.isEmpty(f)||-1!==(E=qt(0,y=n.getUtteranceSelection()))&&n.updateAutoCompleteArgsCommand$.next({matchingUtterance:f,cursorPosition:y.normalizedAnchor!==y.normalizedFocus?E:Math.min(E+1,f.length),triggerSource:2,spans:void 0});break;case"ArrowUp":n.flushUnderlineDelayApply(),Ge(p),ut(p),n.autoCompleteInputArgs.selectPrevious.next(!0);break;case"ArrowDown":n.flushUnderlineDelayApply(),Ge(p),ut(p),n.arrowDownOnInputboxHanlder();break;case"Enter":n.flushUnderlineDelayApply(),Ge(p),n.isAutoCompleteDropdownShown()?n.autoCompleteInputArgs.confirmSelection.next(!0):(n.enterKeyPressed&&n.enterKeyPressed.emit(),n.inCommitOnDemandMode&&n.hasUncommittedQuestion$.value&&n.commitUtterance()),ut(p);break;case"Backspace":"false"===n.contentElement.contentEditable&&ut(p);case"Delete":Ge(p);break;case"Escape":n.flushUnderlineDelayApply();var D=n.isAutoCompleteDropdownShown();n.showHideDropdown(!1,{utterance:f}),D&&(ut(p),Ge(p));break;case"Home":_.isEmpty(f)||n.updateAutoCompleteArgsCommand$.next({matchingUtterance:f,cursorPosition:0,triggerSource:2,spans:void 0});break;case"End":_.isEmpty(f)||n.updateAutoCompleteArgsCommand$.next({matchingUtterance:f,cursorPosition:f.length,triggerSource:2,spans:void 0})}})},i.prototype.cleanContentElement=function(){this.contentElement&&_.filter(this.contentElement.childNodes,function(t){return t.nodeType!==Node.COMMENT_NODE}).forEach(function(t){Kt(t)})},i.prototype.isAutoCompleteDropdownShown=function(){var n;return null===(n=this.autoCompleteComponent)||void 0===n?void 0:n.showAutoCompleteDropdown},i.prototype.ensureAngularCommentNodes=function(){var n=this;""===this.contentElement.textContent&&(this.contentElement.innerHTML="");var t=[];_.forEach(this.contentElement.childNodes,function(g){g.nodeType===Node.COMMENT_NODE&&_.includes(n.contentElementAngularCommentNodes,g)&&t.push(g)});var o=_.size(this.contentElementAngularCommentNodes);if(_.size(t)!==o){_.forEach(t,function(g){return Kt(g)});var r=_.first(this.contentElement.childNodes);if(r)for(var a=r,s=void 0,l=o-1;l>=0;l--)this.contentElement.insertBefore(s=this.contentElementAngularCommentNodes[l],a),a=s;else _.forEach(this.contentElementAngularCommentNodes,function(g){n.contentElement.appendChild(g)})}},i.prototype.ensureContentElementUtteranceText=function(n){return Ke(n)!==this.getCurrentUtteranceSpaceNormalized()&&(this.cleanContentElement(),n&&this.contentElement.appendChild(document.createTextNode(n)),!0)},i.prototype.oneGripperDragStarted=function(n){C.fF.assert(function(){return"none"!==n},"Expect this not to be called with GripperIdentifier.None");var t=this.grippersInfo.grippersLocationDropped$.value;C.fF.assertValue(t,"this.grippersInfo.grippersLocationDropped$.value should be defined"),this.grippersInfo.grippersLocationDuringDragging$.next({associatedUISpans:t.associatedUISpans,begin:t.begin,end:t.end}),this.grippersInfo.gripperOnDragging$.next(n)},i.prototype.arrowDownOnInputboxHanlder=function(){this.showDropdownAtCurrentPosition(2),this.autoCompleteInputArgs.selectNext.next(!0)},i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Ce.i),e.\u0275\u0275directiveInject(He.D),e.\u0275\u0275directiveInject(Re.z),e.\u0275\u0275directiveInject(et.vZ),e.\u0275\u0275directiveInject(Jt.g),e.\u0275\u0275directiveInject(it.E),e.\u0275\u0275directiveInject(bt.o),e.\u0275\u0275directiveInject(Xt.g),e.\u0275\u0275directiveInject(Ze.z),e.\u0275\u0275directiveInject(Mt.e,8),e.\u0275\u0275directiveInject(Ft.n,8),e.\u0275\u0275directiveInject($t.z,8))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["qna-input-v2"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(en,5,e.ElementRef),e.\u0275\u0275viewQuery(tn,5,e.ElementRef),e.\u0275\u0275viewQuery(nn,5,e.ElementRef),e.\u0275\u0275viewQuery(on,5,e.ElementRef),e.\u0275\u0275viewQuery(Rt,5,e.ElementRef),e.\u0275\u0275viewQuery(we,5),e.\u0275\u0275viewQuery(rn,5,e.ElementRef),e.\u0275\u0275viewQuery(Ee,5,e.ElementRef),e.\u0275\u0275viewQuery(lt,5,e.ElementRef),e.\u0275\u0275viewQuery(_e,5,e.ElementRef)),2&t){var r=void 0;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.contentElementExtraContainer=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.deleteButtonElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.commitButtonElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.autoCompleteElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.contentElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.autoCompleteComponent=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.qnaInputContainerElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.beginGripperElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.endGripperElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.spanElementRefs=r)}},hostVars:1,hostBindings:function(t,o){2&t&&e.\u0275\u0275attribute("tabindex",null!=o.fullConfig&&o.fullConfig.disableAuthoring?null:-1)},inputs:{entryPoint:"entryPoint",presentationArgs:"presentationArgs",configs:"configs",qnaSupportedScopes:"qnaSupportedScopes",interpretListener:"interpretListener",linguisticInfo:"linguisticInfo",initialUtterance:"initialUtterance",initialUtteranceFromSaved:"initialUtteranceFromSaved",utteranceSuggestions:"utteranceSuggestions"},outputs:{grippersDefinedTextRangeChanged:"grippersDefinedTextRangeChanged",enterKeyPressed:"enterKeyPressed",initialized:"initialized",toolingLaunched:"toolingLaunched",inputBoxFocused:"inputBoxFocused"},features:[e.\u0275\u0275NgOnChangesFeature],decls:2,vars:3,consts:[[4,"ngIf"],["class","resetButtonAndInputV2Container",4,"ngIf"],["class","qnaAutoCorrection",3,"ngStyle",4,"ngIf"],[1,"resetButtonAndInputV2Container"],["data-testId","qna-input-v2-container","role","application",1,"qnaInputV2Container",3,"ngClass","ngStyle"],["qnaInputContainer",""],[1,"inputAndAutoCompleteContainer",3,"ngStyle","ngClass"],[1,"inputWithoutAutoCompleteContainer",3,"ngStyle","ngClass"],["contenteditable","false","tabindex","-1",1,"utteranceContentExtraContainer"],["contentElementExtraContainer",""],["data-testId","qna-input-box","tabindex","0","cdkDropListGroup","","role","textbox","aria-autocomplete","list","spellcheck","false",1,"utteranceContent",3,"ngClass"],["contentElement",""],["class","term",3,"ngClass","ngStyle","mouseover","mouseleave",4,"ngFor","ngForOf"],[3,"withTopSeparator","params","presentation","selectPrevious","selectNext","confirmSelection","utteranceSelected","fullyExpanded",4,"ngIf"],[1,"beforeUtteranceOneLineHeightContainer",3,"ngStyle"],["aria-hidden","true",2,"width","1px",3,"ngStyle"],["class","questionIcon glyphicon pbi-glyph-qna",3,"ngClass","ngStyle","pbi-tooltip","accessible-click",4,"ngIf"],[1,"questionIcon","glyphicon","pbi-glyph-qna",3,"ngClass","ngStyle","pbi-tooltip","accessible-click"],["class","questionIconWarningLoadingCircle","preserveAspectRatio","none","style","position: absolute;",3,"ngStyle",4,"ngIf"],["preserveAspectRatio","none",1,"questionIconWarningLoadingCircle",2,"position","absolute",3,"ngStyle"],[3,"ngStyle"],[1,"term",3,"ngClass","ngStyle","mouseover","mouseleave"],["spanElement",""],[1,"term-main",3,"ngClass","ngStyle"],["class","token",3,"ngClass",4,"ngFor","ngForOf"],["style","position: absolute;",3,"ngStyle",4,"ngIf"],[1,"token",3,"ngClass"],[4,"ngFor","ngForOf"],["cdkDropList","","class","dropZone","contenteditable","false",3,"ngClass","cdkDropListData","cdkDropListEnterPredicate","cdkDropListEntered","cdkDropListDropped",4,"ngIf"],["cdkDropList","","contenteditable","false",1,"dropZone",3,"ngClass","cdkDropListData","cdkDropListEnterPredicate","cdkDropListEntered","cdkDropListDropped"],["cdkDrag","","class","beginGripper","cdkDragBoundary",".utteranceContent","tabindex","0",3,"cdkDragData","keyup","cdkDragStarted",4,"ngIf"],["cdkDrag","","class","endGripper","cdkDragBoundary",".utteranceContent","tabindex","0",3,"cdkDragData","keyup","cdkDragStarted",4,"ngIf"],["cdkDrag","","cdkDragBoundary",".utteranceContent","tabindex","0",1,"beginGripper",3,"cdkDragData","keyup","cdkDragStarted"],["beginGripper",""],["preserveAspectRatio","none",1,"line"],["preserveAspectRatio","none",1,"circle"],["cdkDrag","","cdkDragBoundary",".utteranceContent","tabindex","0",1,"endGripper",3,"cdkDragData","keyup","cdkDragStarted"],["endGripper",""],[1,"line"],[2,"position","absolute",3,"ngStyle"],["x2","100%","stroke-linecap","round"],[1,"actionButtonsInputBoxFullHeightContainer",3,"ngStyle","click"],["class","singleButtonContainer",4,"ngIf"],[1,"singleButtonContainer"],["role","button",1,"actionButton","deleteButton",3,"ngClass","pbi-tooltip","ngStyle","accessible-click"],["deleteButton",""],[1,"actionButtonsInputBoxOneLineHeightContainer",3,"ngStyle"],[1,"buttonIconContainer"],[1,"glyphicon","pbi-glyph-exit",3,"ngStyle"],["role","button","data-testId","qna-submit-button",1,"actionButton","commitButton",3,"ngClass","localizeAttr","pbi-tooltip","ngStyle","accessible-click"],["commitButton",""],[1,"glyphicon","pbi-glyph-rightarrow",3,"ngStyle"],[3,"params","presentation","selectPrevious","selectNext","confirmSelection","utteranceSelected","fullyExpanded"],["autoComplete",""],[1,"qnaAutoCorrection",3,"ngStyle"],[1,"correctedUtteranceLabel"],["tabindex","0",1,"correctedUtteranceContentContainer",3,"accessible-click"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(t,o){1&t&&(e.\u0275\u0275template(0,mi,7,14,"ng-container",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,o.fullPresentation$))},dependencies:[m.NgClass,m.NgForOf,m.NgIf,m.NgStyle,W.Wj,W.Fd,W.Zt,st.b,Je.i,Ut.t,we,m.AsyncPipe],styles:["@keyframes _ngcontent-%COMP%_pulse{0%{opacity:.2}50%{opacity:1}to{opacity:.2}}html[data-focus-source=key][_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]:focus{outline:none}.resetButtonAndInputV2Container[_ngcontent-%COMP%]{display:flex}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .beforeUtteranceOneLineHeightContainer[_ngcontent-%COMP%]{margin-right:8px;padding:6px 0;background-color:transparent;position:relative;height:fit-content}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .beforeUtteranceOneLineHeightContainer[_ngcontent-%COMP%]   .glyphicon[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-40%)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .beforeUtteranceOneLineHeightContainer[_ngcontent-%COMP%]   .questionIcon[_ngcontent-%COMP%]{cursor:pointer;color:var(--colorNeutralForeground1)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .beforeUtteranceOneLineHeightContainer[_ngcontent-%COMP%]   .questionIcon[_ngcontent-%COMP%]   .questionIconWarningLoadingCircle[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{fill:var(--colorBrandBackground)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .beforeUtteranceOneLineHeightContainer[_ngcontent-%COMP%]   .questionIcon.notClickable[_ngcontent-%COMP%]{cursor:default;pointer-events:none}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .beforeUtteranceOneLineHeightContainer[_ngcontent-%COMP%]   .loadingIcon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 1s linear .5s infinite}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]{flex:1;display:flex;display:-ms-flexbox;flex-flow:column;align-items:flex-start;position:relative;cursor:text;margin:0;background-color:var(--colorNeutralBackground1);color:var(--colorNeutralForeground1);border-color:var(--colorNeutralStrokeAccessible);--inputContainerBackgroundColor: inherit;--inputContainerColor: inherit}[data-legacy-theming=false][_ngcontent-%COMP%]   .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]{--inputContainerBackgroundColor: var(--colorNeutralForegroundInverted);--inputContainerColor: var(--colorNeutralForeground1)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]{pointer-events:none}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .inputAndAutoCompleteContainer[_ngcontent-%COMP%]{width:100%;overflow-y:hidden}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .inputAndAutoCompleteContainer.withFixedHeight[_ngcontent-%COMP%]{overflow-y:auto}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .inputAndAutoCompleteContainer[_ngcontent-%COMP%]   .inputWithoutAutoCompleteContainer[_ngcontent-%COMP%]{width:100%;overflow-y:visible;display:flex;display:-ms-flexbox;flex-direction:column}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .inputAndAutoCompleteContainer.allowContentHorizontalScroll[_ngcontent-%COMP%]{overflow-x:auto}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .inputAndAutoCompleteContainer.allowContentHorizontalScroll[_ngcontent-%COMP%]   .inputWithoutAutoCompleteContainer[_ngcontent-%COMP%]{min-width:100%;width:fit-content}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.withBorder[_ngcontent-%COMP%]{border:1px solid;border-radius:2px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.withShadow[_ngcontent-%COMP%]{box-shadow:var(--fluent-shadow-depth4, 0px 0px 2px var(--colorNeutralShadowAmbient), 0px 2px 4px var(--colorNeutralShadowKey))}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]{flex:1;-ms-flex:1 1 auto;position:relative;display:inline-flex;display:-ms-inline-flexbox;background-color:var(--inputContainerBackgroundColor)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]{flex:1;-ms-flex:1 1 0px;margin-left:10px;display:block;padding:6px;outline:none;box-sizing:border-box;white-space:pre-wrap;pointer-events:auto;-ms-user-select:text;user-select:text;-webkit-user-select:text;color:var(--inputContainerColor)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-moz-selection, .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::selection{background:var(--fluent-theme-neutral-lighter-secondary-color, #E5E5E5)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]:empty:before{content:attr(placeholder);color:var(--fluent-theme-neutral-tertiary-alt-color, #C8C6C4)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent.isGripperOnDragging[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent.isGripperOnDragging[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent.isGripperOnDragging[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent.isGripperOnDragging[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent.isGripperOnDragging[_ngcontent-%COMP%]   .dropZone[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent.isGripperOnDragging[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent.isGripperOnDragging[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]{cursor:grabbing!important}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]{display:inline}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]{position:static;display:inline;cursor:text;margin:0;min-height:6px;color:var(--inputContainerColor)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main.hasMultipleTokens[_ngcontent-%COMP%]{white-space:nowrap}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main.unused[_ngcontent-%COMP%]{color:var(--colorNeutralForegroundDisabled)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]{position:relative;display:inline}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token.space[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token.filler[_ngcontent-%COMP%]{pointer-events:none}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token.isBetweenDroppedGrippers[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token.isBetweenOnDraggingGrippers[_ngcontent-%COMP%]{background-color:rgba(254,217,204,.5)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]{pointer-events:auto;cursor:grab;width:6px;height:100%;box-sizing:border-box;background:transparent}  html[data-focus-source=key] .resetButtonAndInputV2Container .qnaInputV2Container .utteranceContentExtraContainer .utteranceContent .term .term-main .token .beginGripper:focus,   html[data-focus-source=key] .resetButtonAndInputV2Container .qnaInputV2Container .utteranceContentExtraContainer .utteranceContent .term .term-main .token .endGripper:focus{outline-offset:2px;outline-style:dashed}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%]   svg.line[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]   svg.line[_ngcontent-%COMP%]{width:2px;height:calc(100% - 12px)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%]   svg.line[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]   svg.line[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%]{width:100%;height:100%}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%]   svg.circle[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]   svg.circle[_ngcontent-%COMP%]{width:8px;height:8px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%]   svg.circle[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]   svg.circle[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{cx:4px;cy:4px;r:3px;stroke-width:2px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZone[_ngcontent-%COMP%]{pointer-events:auto;cursor:default;background-color:transparent;position:absolute}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZone.noGripperOnDragging[_ngcontent-%COMP%]{pointer-events:none}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZone.endGripperOnDragging[_ngcontent-%COMP%]:not(.serveEndGripper):not(.hasBeginGripper), .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZone.beginGripperOnDragging[_ngcontent-%COMP%]:not(.serveBeginGripper):not(.hasEndGripper){visibility:hidden;width:0;height:0}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedBeforeToken[_ngcontent-%COMP%]{position:absolute;width:calc(50% + 2px);left:-2px;height:calc(100% + 14px);top:unset;bottom:-2px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedBeforeToken[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%]{position:absolute;left:0}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedBeforeToken[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%]   svg.line[_ngcontent-%COMP%]{position:absolute;left:0;bottom:2px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedBeforeToken[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%]   svg.circle[_ngcontent-%COMP%]{position:absolute;left:-3px;top:2px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedAfterToken[_ngcontent-%COMP%]{position:absolute;right:-2px;height:calc(100% + 16px);width:calc(50% + 2px);top:-2px;bottom:unset}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedAfterToken[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]{position:absolute;right:0}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedAfterToken[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]   svg.line[_ngcontent-%COMP%]{position:absolute;right:0;top:2px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZoneLocatedAfterToken[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%]   svg.circle[_ngcontent-%COMP%]{position:absolute;right:-3px;bottom:2px}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.unused[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]{color:var(--fluent-theme-neutral-tertiary-color, #A19F9D)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showAcceptedUnderline[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]{cursor:pointer;padding-bottom:1px;border-bottom-color:var(--colorSuccessForeground1)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showAcceptedUnderline[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--colorSuccessForeground1) 15%,transparent)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showWarningUnderline[_ngcontent-%COMP%]{position:relative}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showWarningUnderline[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]{cursor:pointer;border-bottom-color:var(--colorSuccessForeground1)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showWarningUnderline[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--colorSuccessForeground1) 15%,transparent)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showWarningUnderline[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;width:100%}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showErrorUnderline[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]{cursor:pointer;padding-bottom:1px;border-bottom-color:var(--colorDangerForeground1)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .term.showErrorUnderline[_ngcontent-%COMP%]   .term-main[_ngcontent-%COMP%]:hover{background-color:color-mix(in srgb,var(--colorDangerForeground1) 15%,transparent)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]{display:flex;display:-ms-flexbox;position:relative;margin-left:2px;padding:1px 0}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]{flex:1;-ms-flex:1 1 auto;position:relative}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton[_ngcontent-%COMP%]{width:100%;position:absolute;top:0;padding:0;margin:0;border:none}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton[_ngcontent-%COMP%]{left:0}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton[_ngcontent-%COMP%]{right:0}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton[_ngcontent-%COMP%]:not(.usingShellTheme).disabled, .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton[_ngcontent-%COMP%]:not(.usingShellTheme).disabled{opacity:.5;cursor:default}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton[_ngcontent-%COMP%]:not(.usingShellTheme):hover:not(.disabled), .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton[_ngcontent-%COMP%]:not(.usingShellTheme):hover:not(.disabled){filter:brightness(90%)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton[_ngcontent-%COMP%]:not(.usingShellTheme):active:not(.disabled), .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton[_ngcontent-%COMP%]:not(.usingShellTheme):active:not(.disabled){filter:brightness(80%)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton.usingShellTheme[_ngcontent-%COMP%]{background-color:var(--colorNeutralBackground1);color:var(--colorNeutralForeground1)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton.usingShellTheme.disabled[_ngcontent-%COMP%]{color:var(--colorNeutralForegroundDisabled);cursor:default}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton.usingShellTheme[_ngcontent-%COMP%]:hover:not(.disabled){background-color:var(--colorNeutralBackground1Hover)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.deleteButton.usingShellTheme[_ngcontent-%COMP%]:active:not(.disabled){background-color:var(--colorNeutralBackground1Pressed)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton.usingShellTheme[_ngcontent-%COMP%]{background-color:var(--colorBrandBackground);color:var(--colorNeutralForegroundOnBrand)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton.usingShellTheme.disabled[_ngcontent-%COMP%]{background-color:var(--colorNeutralBackgroundDisabled);color:var(--colorNeutralForegroundDisabled);cursor:default}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton.usingShellTheme[_ngcontent-%COMP%]:hover:not(.disabled){background-color:var(--colorBrandBackgroundHover)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton.commitButton.usingShellTheme[_ngcontent-%COMP%]:active:not(.disabled){background-color:var(--colorBrandBackgroundPressed)}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton[_ngcontent-%COMP%]   .actionButtonsInputBoxOneLineHeightContainer[_ngcontent-%COMP%]{padding:5px 0;width:100%}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .actionButtonsInputBoxFullHeightContainer[_ngcontent-%COMP%]   .singleButtonContainer[_ngcontent-%COMP%]   .actionButton[_ngcontent-%COMP%]   .actionButtonsInputBoxOneLineHeightContainer[_ngcontent-%COMP%]   .buttonIconContainer[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;display:flex;display:-ms-flexbox;align-items:center;justify-content:center}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{pointer-events:none}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .token.space[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .token.filler[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .beginGripper[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .endGripper[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled[_ngcontent-%COMP%]   .utteranceContentExtraContainer[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]   .token[_ngcontent-%COMP%]   .dropZone[_ngcontent-%COMP%]{pointer-events:none!important}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled.showDisabled[_ngcontent-%COMP%]   .questionIcon[_ngcontent-%COMP%], .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container.authoringDisabled.showDisabled[_ngcontent-%COMP%]   .utteranceContent[_ngcontent-%COMP%]{opacity:.6}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]     ul.qnaAutoComplete, .resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]     .qnaAutoComplete ul{text-decoration:none;list-style:none;margin-top:4px!important;z-index:101;white-space:pre;max-height:400px;overflow-y:auto;padding:0}.resetButtonAndInputV2Container[_ngcontent-%COMP%]   .qnaInputV2Container[_ngcontent-%COMP%]     .withTopSeparator ul.qnaAutoComplete{border-top:solid 1px var(--fluent-theme-neutral-tertiary-alt-color, #C8C6C4)}.qnaAutoCorrection[_ngcontent-%COMP%]{margin-top:8px;display:flex;display:-ms-flexbox}.qnaAutoCorrection[_ngcontent-%COMP%]   .correctedUtteranceContentContainer[_ngcontent-%COMP%]{margin-left:4px;cursor:pointer;font-style:italic;text-decoration:underline}.qnaAutoCorrection[_ngcontent-%COMP%]   .correctedUtteranceContentContainer[_ngcontent-%COMP%]   .corrected[_ngcontent-%COMP%]{font-weight:600}"]}),i}();function yi(i,n){if(i){var t=_.map(i,function(o){if(!_.isEmpty(o.text))return{text:o.isWhiteSpace?o.text:o.text.replace(" ",Qn),startIndex:o.startIndex,endExcludingIndex:o.endExcludingIndex,tokens:Si(o),isCorrected:o.isCorrected,isUnused:!o.isUsed&&n.considerDroppedSpans,isWhiteSpace:o.isWhiteSpace,shouldShowAcceptedUnderline:"accepted"===o.state,shouldShowErrorUnderline:"error"===o.state&&n.considerErrorSpans,shouldShowWarningUnderline:"warning"===o.state&&n.considerWarningSpans}}).filter(function(o){return!!o});return n.supportTokenGrippers&&function(i){var n,t;_.forEach(i,function(o,r){_.forEach(o.tokens,function(a,s){var l=i[r].tokens[s];if(!_.isEmpty(l.text)&&!l.isWhiteSpace){var g={position:a.startIndex,beginGripperOf:{spanIndex:r,tokenIndex:s},hasBeginGripper:!1,hasEndGripper:!1,previousBeginGripperZoneInfo:n,previousEndGripperZoneInfo:t},c={position:a.endExcludingIndex,endGripperOf:{spanIndex:r,tokenIndex:s},hasBeginGripper:!1,hasEndGripper:!1,previousBeginGripperZoneInfo:n,previousEndGripperZoneInfo:t};n&&(n.nextBeginGripperZoneInfo=g,n.nextEndGripperZoneInfo=c),t&&(t.nextBeginGripperZoneInfo=g,t.nextEndGripperZoneInfo=c),n=g,t=c,a.dropZonesInfo={zoneLocatedBeforeInfo:g,zoneLocatedAfterInfo:c}}})})}(t),t}}function Si(i){for(var n=[],t=0,o=function(p){var f=p.startIndex-i.startIndex,y=p.endExcludingIndex-p.startIndex;if(C.fF.assert(function(){return _.inRange(f,0,_.size(i.text))},"Expect each token.startIndex is a valid index with the given spanText and spanStartIndex"),C.fF.assert(function(){return!_.isEmpty(_.trim(i.text.substr(f,y)))},"Expect no Token being pure space"),t<f){var E=Xn(i.startIndex,i.text,t,f,i.isWhiteSpace);n.push.apply(n,E||[])}n.push({text:p.text.replace(" ",Qn),startIndex:p.startIndex,endExcludingIndex:p.endExcludingIndex,isFillerText:!1,isWhiteSpace:!1}),t=f+y},r=0,a=i.tokens||[];r<a.length;r++)o(a[r]);var l=_.size(i.text);if(t<l){var g=Xn(i.startIndex,i.text,t,l,i.isWhiteSpace);n.push.apply(n,g||[])}return n}function Xn(i,n,t,o,r){C.fF.assert(function(){return _.inRange(t,0,_.size(n))},"Expect the given startIndexInSpan is a valid index in the given spanText"),C.fF.assert(function(){return _.inRange(o,0,_.size(n)+1)},"Expect the given notIncludingEndIndexInSpan is a valid index in the given spanText or equals to spanText.length+1");for(var a=[],s=/\s/.test(n.charAt(t)),l=t,g=t+1;g<=o;g++){var c=/\s/.test(n.charAt(g));if(g===o||s!==c){var p=g-l,f=s&&!r?_.repeat(Qn,p):n.substr(l,p);a.push({text:f,startIndex:i+l,endExcludingIndex:i+l+p,isFillerText:!0,isWhiteSpace:s}),s=c,l=g}}return a}function Pi(i,n){if(i){if(1===i)return n.get("Qna_DidYouMean_LabelText");if(2===i)return n.get("Qna_ShowingResultsFor_LabelText")}}function ut(i){i.preventDefault&&i.preventDefault()}function Ge(i){i.stopPropagation&&i.stopPropagation()}function Yn(i,n){return null==i?null==n:null==n?null==i:Ke(i)===Ke(n)}function eo(i,n,t){var o,r,a,s;if(!n)return!1;if("beginGripper"===i&&n.beginGripperOf){var l=_.cloneDeep(t.value.end);if(n.beginGripperOf.spanIndex<l.spanIndex||n.beginGripperOf.spanIndex===l.spanIndex&&n.beginGripperOf.tokenIndex<=l.tokenIndex){var g=n.beginGripperOf;return C.fF.assertValue(null===(o=t.value)||void 0===o?void 0:o.associatedUISpans,"grippersPairLocation$.value.associatedUISpans should be defined"),t.next({associatedUISpans:null===(r=t.value)||void 0===r?void 0:r.associatedUISpans,begin:g,end:l}),!0}}else if("endGripper"===i&&n.endGripperOf){var c=_.cloneDeep(t.value.begin);if(n.endGripperOf.spanIndex>c.spanIndex||n.endGripperOf.spanIndex===c.spanIndex&&n.endGripperOf.tokenIndex>=c.tokenIndex){var p=n.endGripperOf;return C.fF.assertValue(null===(a=t.value)||void 0===a?void 0:a.associatedUISpans,"grippersPairLocation$.value.associatedUISpans should be defined"),t.next({associatedUISpans:null===(s=t.value)||void 0===s?void 0:s.associatedUISpans,begin:c,end:p}),!0}}return!1}function Mn(i,n,t,o){if(!o?.begin||!o?.end||!i.dropZonesInfo)return!1;var r=n?i.dropZonesInfo.zoneLocatedBeforeInfo:i.dropZonesInfo.zoneLocatedAfterInfo;C.fF.assert(function(){return"none"!==t},"The given gripper should not be GripperIdentifier.None");var a="beginGripper"===t?o.begin:o.end,s="beginGripper"===t?r.beginGripperOf:r.endGripperOf;return a.spanIndex===(s&&s.spanIndex)&&a.tokenIndex===(s&&s.tokenIndex)}function to(i,n,t){if(!t?.begin||!t?.end)return!1;var o=t.begin,a=t.end;return(i!==o.spanIndex?i>o.spanIndex:n>=o.tokenIndex)&&(i!==a.spanIndex?i<a.spanIndex:n<=a.tokenIndex)}function kn(i){var n;return _.some(null===(n=i?.target)||void 0===n?void 0:n.classList,function(t){return"beginGripper"===t||"endGripper"===t})}function no(i,n,t){var o=pt.Tm(i,n);return _.map(o,function(a){return t.get(a)}).join("\n\n")}function qt(i,n){return n?0===i?n.normalizedAnchor:n.normalizedFocus:-1}var oo=new e.InjectionToken("QnaToolingDialogLauncherService"),Nt=u(46135),io=u(98136),ro=u(77200),Ii=u(55232),ao=u(28894),bi=u(73425),so=u(98885),Mi=u(46101),wi=u(36858),Ei=u(21548),ct=function(n){return{color:n}},Ln=function(){return{"aria-label":"Qna_FeedbackDialog_ThumbsUp"}},Rn=function(){return{"aria-label":"Qna_FeedbackDialog_ThumbsDown"}};function Oi(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275element(1,"span",4),e.\u0275\u0275elementStart(2,"button",5),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.feedbackIconClick(!0))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"button",6),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.feedbackIconClick(!1))}),e.\u0275\u0275elementEnd()()}if(2&i){var o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(5,ct,o.fontColor)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(7,ct,o.fontColor))("localizeAttr",e.\u0275\u0275pureFunction0(9,Ln)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(10,ct,o.fontColor))("localizeAttr",e.\u0275\u0275pureFunction0(12,Rn))}}function Ti(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",3)(1,"a",7),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.launchFeedbackDialog(!0))}),e.\u0275\u0275element(2,"span",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"button",9),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(3,ct,o.fontColor)),e.\u0275\u0275advance(2),e.\u0275\u0275property("localizeAttr",e.\u0275\u0275pureFunction0(5,Ln))("ngStyle",e.\u0275\u0275pureFunction1(6,ct,o.fontColor))}}function Fi(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",3)(1,"a",10),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.launchFeedbackDialog(!1))}),e.\u0275\u0275element(2,"span",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"button",12),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(3,ct,o.fontColor)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(5,ct,o.fontColor))("localizeAttr",e.\u0275\u0275pureFunction0(7,Rn))}}function Bi(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275element(1,"span",13)(2,"button",9),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(3,ct,t.fontColor)),e.\u0275\u0275advance(1),e.\u0275\u0275property("localizeAttr",e.\u0275\u0275pureFunction0(5,Ln))("ngStyle",e.\u0275\u0275pureFunction1(6,ct,t.fontColor))}}function Di(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",3),e.\u0275\u0275element(1,"span",13)(2,"button",14),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(3,ct,t.fontColor)),e.\u0275\u0275advance(1),e.\u0275\u0275property("localizeAttr",e.\u0275\u0275pureFunction0(5,Rn))("ngStyle",e.\u0275\u0275pureFunction1(6,ct,t.fontColor))}}var zn=function(){function i(n,t,o,r){this.core=n,this.localizationService=t,this.qnaFeedbackStateService=o,this.screenReaderService=r}return i.prototype.ngOnInit=function(){this.utterance=this.core.getCurrentUtteranceTrimmed()},i.prototype.feedbackIconClick=function(n){var t={sentiment:n?1:-1,reason:void 0,comment:void 0};this.updateState(n?"PositiveChecked":"NegativeChecked"),this.sendFeedbackInterpretRequest(t)},i.prototype.getState=function(){return this.qnaFeedbackStateService.getState(this.utterance)},i.prototype.announceDescription=function(){var n=this.getState(),t=this.localizationService.get("Qna_FeedbackState_"+n);C.fF.assertValue(t,"no strings for current feedback state"),this.screenReaderService.alert(t)},i.prototype.launchFeedbackDialog=function(n){return(0,b.__awaiter)(this,void 0,void 0,function(){return(0,b.__generator)(this,function(t){return this.core.launchFeedbackDialog(n?1:-1,!0),[2]})})},i.prototype.sendFeedbackInterpretRequest=function(n){return C.fF.assertValue(n,"invalid feedback"),this.core.sendFeedback(n)},i.prototype.updateState=function(n){this.qnaFeedbackStateService.updateState(this.utterance,n)},i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(w.D),e.\u0275\u0275directiveInject(bt.o),e.\u0275\u0275directiveInject(Ei.B),e.\u0275\u0275directiveInject(Xt.g))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["qna-feedback"]],inputs:{fontColor:"fontColor"},features:[e.\u0275\u0275ProvidersFeature([q.Q,io.Z])],decls:7,vars:6,consts:[["focus-nav-mode","Hierarchy",1,"qnnFeedback",3,"focusin"],[3,"ngSwitch"],["class","textAndIcons",4,"ngSwitchCase"],[1,"textAndIcons"],["localize","Qna_FeedbackState_Unchosen",1,"descriptionText",3,"ngStyle"],[1,"feedbackIcon","glyphicon","glyph-small","pbi-glyph-like",3,"ngStyle","localizeAttr","accessible-click"],[1,"feedbackIcon","glyphicon","glyph-small","pbi-glyph-dislike",3,"ngStyle","localizeAttr","accessible-click"],["href","javascript:void(0);",1,"descriptionText",3,"ngStyle","accessible-click"],["localize","Qna_FeedbackState_PositiveChecked"],[1,"feedbackIcon","glyphicon","glyph-small","pbi-glyph-likesolid",3,"localizeAttr","ngStyle"],["href","javascript:void(0);",1,"descriptionText",3,"accessible-click"],["localize","Qna_FeedbackState_NegativeChecked",3,"ngStyle"],[1,"feedbackIcon","glyphicon","glyph-small","pbi-glyph-dislikesolid",3,"ngStyle","localizeAttr"],["localize","Qna_FeedbackState_FeedbackDetailSubmitted",1,"descriptionText",3,"ngStyle"],[1,"feedbackIcon","glyphicon","glyph-small","pbi-glyph-dislikesolid",3,"localizeAttr","ngStyle"]],template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275listener("focusin",function(){return o.announceDescription()}),e.\u0275\u0275elementStart(1,"div",1),e.\u0275\u0275template(2,Oi,4,13,"div",2),e.\u0275\u0275template(3,Ti,4,8,"div",2),e.\u0275\u0275template(4,Fi,4,8,"div",2),e.\u0275\u0275template(5,Bi,3,8,"div",2),e.\u0275\u0275template(6,Di,3,8,"div",2),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitch",o.getState()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","Unchosen"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","PositiveChecked"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","NegativeChecked"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","PositiveDetailSubmitted"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","NegativeDetailSubmitted"))},dependencies:[m.NgStyle,m.NgSwitch,m.NgSwitchCase,Vt.X,st.b,Ut.t],styles:['.qnnFeedback[_ngcontent-%COMP%]{height:100%}.qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]{display:flex;flex-direction:row}html:not([dir="rtl"])[_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .descriptionText[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .descriptionText[_ngcontent-%COMP%]{margin-right:10px}html[dir="rtl"][_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .descriptionText[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .descriptionText[_ngcontent-%COMP%]{margin-left:10px}.qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .feedbackIcon[_ngcontent-%COMP%]{background-color:transparent}html:not([dir="rtl"])[_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .feedbackIcon[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .feedbackIcon[_ngcontent-%COMP%]{margin-left:2px;margin-right:2px}html[dir="rtl"][_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .feedbackIcon[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .feedbackIcon[_ngcontent-%COMP%]{margin-left:2px;margin-right:2px}.qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .feedbackIcon.pbi-glyph-likesolid[_ngcontent-%COMP%], .qnnFeedback[_ngcontent-%COMP%]   .textAndIcons[_ngcontent-%COMP%]   .feedbackIcon.pbi-glyph-dislikesolid[_ngcontent-%COMP%]{cursor:default}']}),i}(),wn=u(59694),Ai=u(73221),Vi=u(45769);function Ui(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tri-message-bar",2),e.\u0275\u0275listener("hideMessageBar",function(){var s=e.\u0275\u0275restoreView(t).$implicit,l=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(l.onDismissBanner(s.id))}),e.\u0275\u0275elementEnd()}2&i&&e.\u0275\u0275property("viewModel",n.$implicit)}function Qi(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Ui,1,1,"tri-message-bar",1),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t)}}function ki(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Qi,2,1,"ng-container",0),e.\u0275\u0275elementContainerEnd()),2&i){var t=n.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.length>0)}}var qn=function(i){function n(){var t=i.call(this)||this;return t.onDismiss=new e.EventEmitter,t}return(0,b.__extends)(n,i),n.prototype.ngOnInit=function(){var t=this;this.messageBarModels$=this.changes$("bannerContent").pipe((0,de.U)(function(o){return _.chain(o.banners).filter(function(a){return a.isVisible}).map(function(a){var s,l;return{id:a.id,bannerType:t.mapToMessageBarType(a.bannerType),message:t.mapToMessageBarText(a.message),barButtons:_.chain(a.actions).map(function(g){return t.mapToMessageBarAction(g,a.data)}).filter(function(g){return!!g}).value(),allowDismiss:a.allowDismiss,isRoundedCorners:!0,isMultiline:!0,link:null===(s=a.link)||void 0===s?void 0:s.href,linkDisplayName:null===(l=a.link)||void 0===l?void 0:l.text}}).value()}))},n.prototype.onDismissBanner=function(t){C.fF.assertValue(t,"bannerId"),this.onDismiss.emit(t)},n.prototype.mapToMessageBarType=function(t){switch(t){case"copilot":return 6;case"error":return 1;case"info":return 0;case"warning":return 2;default:C.fF.assertFail("unknown bannerType ".concat(t))}},n.prototype.mapToMessageBarText=function(t){return C.fF.assert(function(){return!(0,wn.g)(t.text)},"banner message should be defined and non empty"),t.emphasis?"<b>".concat(t.emphasis,"</b> ").concat(t.text):t.text},n.prototype.mapToMessageBarAction=function(t,o){var r=this,a=(0,wn.g)(t.text);if(C.fF.assert(function(){return!a},"banner action text should be defined and non empty"),!a)return{buttonText:t.text,buttonAction:function(){return function(g){if("noop"!==g){var c=r.bannerContent.actionHandlers.get(g);C.fF.assertValue(c,"handler with actionId ".concat(g)),null!=o?c(o):c()}}(t.id)},buttonAppearance:"primary"===t.actionAppearance?"primary":void 0,isLoading:"loading"===t.actionAppearance,isDisabled:"loading"===t.actionAppearance}},n.\u0275fac=function(o){return new(o||n)},n.\u0275cmp=e.\u0275\u0275defineComponent({type:n,selectors:[["qna-banner"]],inputs:{bannerContent:"bannerContent"},outputs:{onDismiss:"onDismiss"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[[4,"ngIf"],["style","margin-bottom: 4px;",3,"viewModel","hideMessageBar",4,"ngFor","ngForOf"],[2,"margin-bottom","4px",3,"viewModel","hideMessageBar"]],template:function(o,r){1&o&&(e.\u0275\u0275template(0,ki,2,1,"ng-container",0),e.\u0275\u0275pipe(1,"async")),2&o&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,r.messageBarModels$))},dependencies:[m.NgForOf,m.NgIf,Vi.h,m.AsyncPipe],styles:["[_nghost-%COMP%]     tri-message-bar .message-banner{border-top-color:transparent;border-right-color:transparent;border-left-color:transparent}"]}),n}(Ai.w),Li=u(85102),Ri=["bannerMainMessageTextContainer"],zi=["contentContainer"];function qi(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",8)(1,"div",9),e.\u0275\u0275element(2,"spinner",10)(3,"span",11),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("delay",0))}function Ni(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"canvas-visual-error-overlay",12),e.\u0275\u0275listener("showErrorDetails",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(a.showQnaVisualErrorDetails())}),e.\u0275\u0275elementEnd()()}if(2&i){var o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("errorInfo",o.viewModel.error)("viewport",o.viewModel.viewport)}}function Hi(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"qna-banner",20),e.\u0275\u0275listener("onDismiss",function(a){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(s.onBannerDismiss(a))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&i){var o=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("bannerContent",o)}}function Gi(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Hi,2,1,"ng-container",19),e.\u0275\u0275elementContainerEnd()),2&i){var t=n.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.showBanners)}}function $i(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Gi,2,1,"ng-container",19),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,1,t.bannerContent$))}}var Wi=function(){return{"aria-label":"VisualContainer_QnaVisual_Promotion_HideAction"}};function ji(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",22),e.\u0275\u0275element(1,"i",23)(2,"span",24,25),e.\u0275\u0275elementStart(4,"button",26),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.performBannerMainAction())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",27),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.dismissBanner())}),e.\u0275\u0275pipe(6,"localize"),e.\u0275\u0275elementEnd()()}if(2&i){var o=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275property("pbiTooltip",o.bannerMainMessageTooltip)("localize","VisualContainer_QnaVisual_Promotion_MainMessage"),e.\u0275\u0275advance(2),e.\u0275\u0275property("localize","VisualContainer_QnaVisual_Promotion_ActionText"),e.\u0275\u0275advance(1),e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(6,5,"VisualContainer_QnaVisual_Promotion_HideAction"))("localizeAttr",e.\u0275\u0275pureFunction0(7,Wi))}}function Ki(i,n){if(1&i&&e.\u0275\u0275template(0,ji,7,8,"div",21),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngIf",t.showLegacyBanner)}}var Zi=function(n){return{disabled:n}},Ji=function(){return{"aria-label":"Qna_ConvertDescription"}},lo=function(n,t){return{color:n,"font-size":t}};function Xi(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"i",28),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.convertVisualClicked())}),e.\u0275\u0275pipe(1,"localize"),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(6,Zi,!o.viewModel.result||"Visual"!==o.viewModel.result.type&&"QueryError"!==o.viewModel.result.type))("pbiTooltip",e.\u0275\u0275pipeBind1(1,4,"Qna_ConvertDescription"))("localizeAttr",e.\u0275\u0275pureFunction0(8,Ji))("ngStyle",e.\u0275\u0275pureFunction2(9,lo,null==o.inputPresentation||null==o.inputPresentation.restatementFontProperties?null:o.inputPresentation.restatementFontProperties.color,(null==o.inputPresentation||null==o.inputPresentation.questionFontProperties?null:o.inputPresentation.questionFontProperties.size.px)+"px"))}}var Yi=function(){return{"aria-label":"Qna_ToolingDescription"}};function er(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"i",29),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.showTooling("VisualTooling"))}),e.\u0275\u0275pipe(1,"localize"),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(1,3,"Qna_ToolingDescription"))("localizeAttr",e.\u0275\u0275pureFunction0(5,Yi))("ngStyle",e.\u0275\u0275pureFunction2(6,lo,null==o.inputPresentation||null==o.inputPresentation.restatementFontProperties?null:o.inputPresentation.restatementFontProperties.color,(null==o.inputPresentation||null==o.inputPresentation.questionFontProperties?null:o.inputPresentation.questionFontProperties.size.px)+"px"))}}var tr=function(n){return{hasBanner:n}};function nr(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,$i,3,3,"ng-container",13),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Ki,1,1,"ng-template",null,14,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(5,"div",15)(6,"qna-input-v2",16),e.\u0275\u0275listener("inputBoxFocused",function(s){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(l.onInputBoxFocused(s))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Xi,2,12,"i",17),e.\u0275\u0275template(8,er,2,9,"i",18),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&i){var o=e.\u0275\u0275reference(4),r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,12,r.allowTooling&&r.isCopilotSynonymsEnabled$))("ngIfElse",o),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(14,tr,r.showLegacyBanner)),e.\u0275\u0275advance(1),e.\u0275\u0275property("entryPoint",r.viewModel.qnaInputConfiguration.entryPoint)("qnaSupportedScopes",r.viewModel.qnaInputConfiguration.qnaSupportedScopes)("interpretListener",r.viewModel.qnaInputConfiguration.interpretListener)("presentationArgs",r.inputPresentation)("configs",r.viewModel.qnaInputConfiguration.configs)("initialUtterance",r.viewModel.qnaInputConfiguration.initialUtterance)("initialUtteranceFromSaved",r.viewModel.qnaInputConfiguration.initialUtteranceFromSaved),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.config.canEdit),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.allowTooling)}}var or=function(n){return{color:n}};function ir(i,n){if(1&i&&e.\u0275\u0275element(0,"i",30),2&i){var t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(3,or,null==t.inputPresentation||null==t.inputPresentation.restatementFontProperties?null:t.inputPresentation.restatementFontProperties.color))("pbiTooltip",t.displayedRestatement),e.\u0275\u0275attribute("aria-label",t.displayedRestatement.tooltipDescription)}}var rr=function(n,t,o,r,a,s,l){return{"background-color":n,color:t,"font-size":o,"font-family":r,"font-weight":a,"font-style":s,"text-decoration":l}};function ar(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",45),e.\u0275\u0275listener("accessible-click",function(){var l=e.\u0275\u0275restoreView(t).$implicit,g=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(g.interpretSuggestedQuestion(l.content))}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&i){var o=n.$implicit,r=e.\u0275\u0275nextContext(4);e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction7(3,rr,null==r.suggestionsPresentation?null:r.suggestionsPresentation.backgroundColor,null==r.suggestionsPresentation||null==r.suggestionsPresentation.cardFontProperties?null:r.suggestionsPresentation.cardFontProperties.color,(null==r.suggestionsPresentation||null==r.suggestionsPresentation.cardFontProperties||null==r.suggestionsPresentation.cardFontProperties.size?null:r.suggestionsPresentation.cardFontProperties.size.px)+"px",null==r.suggestionsPresentation||null==r.suggestionsPresentation.cardFontProperties?null:r.suggestionsPresentation.cardFontProperties.family,null==r.suggestionsPresentation||null==r.suggestionsPresentation.cardFontProperties?null:r.suggestionsPresentation.cardFontProperties.weight,null==r.suggestionsPresentation||null==r.suggestionsPresentation.cardFontProperties?null:r.suggestionsPresentation.cardFontProperties.style,null==r.suggestionsPresentation||null==r.suggestionsPresentation.cardFontProperties?null:r.suggestionsPresentation.cardFontProperties.textDecoration)),e.\u0275\u0275attribute("aria-label",o.accessibilityLabel),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",o.content," ")}}var sr=function(n,t,o,r,a,s){return{color:n,"font-size":t,"font-family":o,"font-weight":r,"font-style":a,"text-decoration":s}},lr=function(n){return{"aria-label":n}};function ur(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",40),e.\u0275\u0275element(1,"div",41),e.\u0275\u0275elementStart(2,"div",42),e.\u0275\u0275template(3,ar,2,11,"div",43),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",44),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.toggleShowAllSuggestions())}),e.\u0275\u0275elementEnd()()}if(2&i){var o=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction6(4,sr,null==o.suggestionsPresentation||null==o.suggestionsPresentation.headerFontProperties?null:o.suggestionsPresentation.headerFontProperties.color,(null==o.suggestionsPresentation||null==o.suggestionsPresentation.headerFontProperties||null==o.suggestionsPresentation.headerFontProperties.size?null:o.suggestionsPresentation.headerFontProperties.size.px)+"px",null==o.suggestionsPresentation||null==o.suggestionsPresentation.headerFontProperties?null:o.suggestionsPresentation.headerFontProperties.family,null==o.suggestionsPresentation||null==o.suggestionsPresentation.headerFontProperties?null:o.suggestionsPresentation.headerFontProperties.weight,null==o.suggestionsPresentation||null==o.suggestionsPresentation.headerFontProperties?null:o.suggestionsPresentation.headerFontProperties.style,null==o.suggestionsPresentation||null==o.suggestionsPresentation.headerFontProperties?null:o.suggestionsPresentation.headerFontProperties.textDecoration)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",o.viewModel.result.suggestions),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("localize",o.viewModel.result.showAllSuggestions?"Visual_Qna_SuggestionsLess":"Visual_Qna_SuggestionsAll"),e.\u0275\u0275property("localizeAttr",e.\u0275\u0275pureFunction1(11,lr,o.viewModel.result.showAllSuggestions?"Visual_Qna_SuggestionsLess":"Visual_Qna_SuggestionsAll"))}}var uo=function(n,t,o,r,a){return{color:n,"font-family":t,"font-weight":o,"font-style":r,"text-decoration":a}};function cr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"span",46),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction5(2,uo,null==t.inputPresentation||null==t.inputPresentation.restatementFontProperties?null:t.inputPresentation.restatementFontProperties.color,null==t.inputPresentation||null==t.inputPresentation.restatementFontProperties?null:t.inputPresentation.restatementFontProperties.family,null==t.suggestionsPresentation||null==t.suggestionsPresentation.restatementFontProperties?null:t.suggestionsPresentation.restatementFontProperties.weight,null==t.suggestionsPresentation||null==t.suggestionsPresentation.restatementFontProperties?null:t.suggestionsPresentation.restatementFontProperties.style,null==t.suggestionsPresentation||null==t.suggestionsPresentation.restatementFontProperties?null:t.suggestionsPresentation.restatementFontProperties.textDecoration)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.viewModel.result.failedToLoadSuggestionsMessage," ")}}function dr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",37),e.\u0275\u0275template(1,ur,5,13,"div",38),e.\u0275\u0275template(2,cr,2,8,"span",39),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.viewModel.result.suggestions.length>0&&t.suggestionsPresentation.show),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.viewModel.result.failedToLoadSuggestionsMessage&&t.suggestionsPresentation.show)}}function pr(i,n){1&i&&e.\u0275\u0275element(0,"spinner",52),2&i&&e.\u0275\u0275property("delay",0)}function gr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",49),e.\u0275\u0275template(1,pr,1,1,"spinner",50),e.\u0275\u0275element(2,"single-visual-host",51),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.viewModel.result.isLoading),e.\u0275\u0275advance(1),e.\u0275\u0275property("visual",t.viewModel.result.visual)("visualViewport",t.viewModel.viewport)("themeCollection",t.viewModel.themeCollection)("config",t.core.singleVisualHostConfig)}}function hr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",47),e.\u0275\u0275template(1,gr,3,5,"div",48),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.viewModel.result.visual&&t.core.singleVisualHostConfig)}}function fr(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"a",57),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(r.launchFeedbackDialog(-1,!1))}),e.\u0275\u0275element(1,"span",58),e.\u0275\u0275elementEnd()}}function mr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",53)(1,"div",54)(2,"div")(3,"span",55),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,fr,2,0,"a",56),e.\u0275\u0275elementEnd()()()),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction5(3,uo,null==t.inputPresentation||null==t.inputPresentation.restatementFontProperties?null:t.inputPresentation.restatementFontProperties.color,null==t.inputPresentation||null==t.inputPresentation.restatementFontProperties?null:t.inputPresentation.restatementFontProperties.family,null==t.suggestionsPresentation||null==t.suggestionsPresentation.restatementFontProperties?null:t.suggestionsPresentation.restatementFontProperties.weight,null==t.suggestionsPresentation||null==t.suggestionsPresentation.restatementFontProperties?null:t.suggestionsPresentation.restatementFontProperties.style,null==t.suggestionsPresentation||null==t.suggestionsPresentation.restatementFontProperties?null:t.suggestionsPresentation.restatementFontProperties.textDecoration)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(t.viewModel.result.message),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.allowFeedback&&t.core.shouldShowdoNotUnderstandMessageFeedbackLink())}}function vr(i,n){1&i&&e.\u0275\u0275elementContainer(0)}function Cr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",59),e.\u0275\u0275template(1,vr,1,0,"ng-container",60),e.\u0275\u0275elementEnd()),2&i){e.\u0275\u0275nextContext();var t=e.\u0275\u0275reference(7);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",t)}}function _r(i,n){1&i&&e.\u0275\u0275elementContainer(0)}function yr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",59),e.\u0275\u0275template(1,_r,1,0,"ng-container",60),e.\u0275\u0275elementEnd()),2&i){e.\u0275\u0275nextContext();var t=e.\u0275\u0275reference(7);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngTemplateOutlet",t)}}function Sr(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"a",57),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var r=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(r.launchFeedbackDialog(-1,!1))}),e.\u0275\u0275element(1,"span",58),e.\u0275\u0275elementEnd()}}function Pr(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"canvas-visual-error-overlay",12),e.\u0275\u0275listener("showErrorDetails",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.showResultErrorDetails())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(1,Sr,2,0,"a",56)}if(2&i){var o=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("errorInfo",o.viewModel.result)("viewport",o.viewModel.viewport),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.allowFeedback&&o.core.shouldShowdoNotUnderstandMessageFeedbackLink())}}function xr(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0,31),e.\u0275\u0275template(1,dr,3,2,"div",32),e.\u0275\u0275template(2,hr,2,1,"div",33),e.\u0275\u0275template(3,mr,6,9,"div",34),e.\u0275\u0275template(4,Cr,2,1,"div",35),e.\u0275\u0275template(5,yr,2,1,"div",35),e.\u0275\u0275template(6,Pr,2,3,"ng-template",null,36,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngSwitch",t.viewModel.result.type),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","Suggestions"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","Visual"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","DoNotUnderstand"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","Error"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","QueryError")}}function Ir(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",64),e.\u0275\u0275element(1,"qna-feedback",65),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("fontColor",null==t.inputPresentation||null==t.inputPresentation.restatementFontProperties?null:t.inputPresentation.restatementFontProperties.color)}}function br(i,n){1&i&&(e.\u0275\u0275elementStart(0,"div",66),e.\u0275\u0275element(1,"span",67)(2,"a",68),e.\u0275\u0275elementEnd())}function Mr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",61),e.\u0275\u0275template(1,Ir,2,1,"div",62),e.\u0275\u0275template(2,br,3,0,"div",63),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.allowFeedback&&t.core.showFeedbackForCurrentQuestion()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(3,2,t.isCopilotSynonymsEnabled$)&&"Visual"===(null==t.viewModel.result?null:t.viewModel.result.type))}}var wr=function(n,t){return{contentReady:n,suggestionContent:t}},Nn=function(){function i(n,t,o,r,a,s,l,g,c,p){this.dataSources=n,this.explorationNavigation=t,this.featureSwitchService=o,this.lazyScoped=r,this.viewModeState=a,this.telemetryService=s,this.core=l,this.highContrastCssGenerationService=g,this.settingsService=c,this.qnaToolingDialogLauncher=p,this.inputBoxFocused=new e.EventEmitter,this.utteranceUpdated=new e.EventEmitter,this.convertVisual=new e.EventEmitter,this.destroy$=new Xe.xQ,this.viewModel=this.core.viewModel,C.fF.assert(function(){return!(0,L.rO)()},"Expect qna.component never get created if it is in IE browser."),this.highContrastCssGenerationService.addRule('html[data-focus-source="key"] .themeableElement .qnaVisual *:focus',"{ outline: 2px solid @selectedBackgroundColor; }")}return Object.defineProperty(i.prototype,"inputComponent",{set:function(t){var o=this;this.qnaInputComponent=t,this.core.setGetQnaInputComponentFunc(function(){return o.qnaInputComponent})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_bannerMessageElementRef",{set:function(t){this.bannerMainMessageTextContainerElementRef=t,t&&this.updateBannerMainMessageTooltipConfig()},enumerable:!1,configurable:!0}),i.prototype.ngOnInit=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,t,o,r,s,l=this;return(0,b.__generator)(this,function(g){switch(g.label){case 0:return n=0!==this.viewModeState.getMode(),this.initializedTelemetryEvent=this.telemetryService.logEvent(Qe,{isAuthoring:n,entryPoint:this.entryPoint}),C.fF.assertValue(this.config,"Expect this.config to be defined"),t=_.cloneDeep(this.config),t=_.merge({},t,{hostHandlesUndo:!0}),[4,this.core.initialize(this.models,t,this.hostServices,this.entryPoint,this.utteranceUpdated,this.convertVisual,this.initializedTelemetryEvent,this.contentContainerElement,void 0)];case 1:return g.sent(),this.isCopilotSynonymsEnabled$=this.featureSwitchService.featureSwitches$.pipe((0,de.U)(function(c){return c.qnaImproveLsdlCopilot})),o=this,[4,this.core.shouldShowThumbsUpDown()];case 2:return o.allowFeedback=g.sent(),r=this,[4,this.core.allowTooling()];case 3:return r.allowTooling=g.sent(),this.allowTooling?[4,this.lazyScoped.get("improveLsdlBackgroundService")]:[3,7];case 4:return[4,g.sent().tryImproveLsdl("qnaVisual")];case 5:return g.sent(),s=this,[4,this.lazyScoped.get("qnaBannerService")];case 6:s.qnaBannerService=g.sent(),this.bannerContent$=this.qnaBannerService.getBannerContent("Visual"),g.label=7;case 7:return this.showLegacyBanner=this.shouldShowBanner(),this.settingsService.settingChanged$.pipe((0,oe.R)(this.destroy$)).subscribe(function(c){"ShowQnaVisualBanner"===c&&(l.showLegacyBanner=l.shouldShowBanner())}),[2]}})})},i.prototype.ngAfterViewInit=function(){this.core.updateViewport()},i.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},i.prototype.onBannerDismiss=function(n){var t;null===(t=this.qnaBannerService)||void 0===t||t.dismissBanner("Visual",n)},i.prototype.update=function(n){(0,te.yE)(n.type,Nt.EP.Resize)&&this.updateBannerMainMessageTooltipConfig(),this.core.update(n)},i.prototype.enumerateObjectInstances=function(n){return this.core.enumerateObjectInstances(n)},i.prototype.getFormattingModel=function(){return this.core.getFormattingModel()},i.prototype.focus=function(){if(this.qnaInputComponent)return this.qnaInputComponent.focus(),!0},i.prototype.onInputBoxFocused=function(n){this.inputBoxFocused.emit(n)},i.prototype.getCurrentVisual=function(){return this.core.getCurrentVisual()},i.prototype.convertVisualClicked=function(){this.core.convertVisualClicked()},i.prototype.dismissBanner=function(){this.settingsService.setShowQnaVisualBanner(!1),this.showLegacyBanner=!1},i.prototype.performBannerMainAction=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n=this;return(0,b.__generator)(this,function(t){switch(t.label){case 0:return C.fF.assert(function(){return n.showLegacyBanner},"This should only be called when showBanner is true"),[4,this.showTooling("VisualBanner","bulkEditing")];case 1:return t.sent(),[2]}})})},Object.defineProperty(i.prototype,"inputPresentation",{get:function(){if(this.viewModel)return this.viewModel.presentationViewModel.inputBox},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"suggestionsPresentation",{get:function(){if(this.viewModel)return this.viewModel.presentationViewModel.suggestions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayedRestatement",{get:function(){if("Ready"!==this.viewModel.state)return null;var t=this.viewModel.result;return t?(0,M.mn)(t)||(0,M.fU)(t)||(0,M.lP)(t)?t.restatement:void 0:null},enumerable:!1,configurable:!0}),i.prototype.showTooling=function(n,t){return(0,b.__awaiter)(this,void 0,void 0,function(){var o,r,a=this;return(0,b.__generator)(this,function(s){switch(s.label){case 0:return C.fF.assert(function(){return a.allowTooling},"this should be called only when this.allowTooling is true"),this.allowTooling?(o=this.dataSources.get(),r=this.explorationNavigation.getCurrentExploration(),[4,this.qnaToolingDialogLauncher.showToolingDialog({dataSources:o,exploration:r,entryPoint:n,entryContentType:t,entryQuestion:this.core.getCurrentUtteranceTrimmed()})]):[2];case 1:return s.sent(),[2]}})})},i.prototype.interpretSuggestedQuestion=function(n){this.core.interpretSuggestedQuestion(n)},i.prototype.toggleShowAllSuggestions=function(){this.core.toggleShowAllSuggestions()},i.prototype.showQnaVisualErrorDetails=function(){this.core.showQnaVisualErrorDetails()},i.prototype.showResultErrorDetails=function(){this.core.showResultErrorDetails()},i.prototype.launchFeedbackDialog=function(n,t){this.core.launchFeedbackDialog(n,t)},i.prototype.shouldShowBanner=function(){var n=this;return C.fF.assert(function(){return null!=n.allowTooling},"this.allowTooling value should already been set to be true or false"),this.allowTooling&&this.settingsService.getShowQnaVisualBanner()},i.prototype.updateBannerMainMessageTooltipConfig=function(){if(this.bannerMainMessageTextContainerElementRef){var n=this.bannerMainMessageTextContainerElementRef.nativeElement,t=n&&n.offsetWidth<n.scrollWidth;!this.bannerMainMessage!=!t&&(this.bannerMainMessage=t?n.textContent:null)}},i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(He.D),e.\u0275\u0275directiveInject(Re.z),e.\u0275\u0275directiveInject(et.vZ),e.\u0275\u0275directiveInject(ao.H),e.\u0275\u0275directiveInject(ro.kc),e.\u0275\u0275directiveInject(ue.y0),e.\u0275\u0275directiveInject(w.D),e.\u0275\u0275directiveInject(Jt.g),e.\u0275\u0275directiveInject(Ii.g),e.\u0275\u0275directiveInject(oo,8))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["qna-host"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(bn,5),e.\u0275\u0275viewQuery(Ri,5,e.ElementRef),e.\u0275\u0275viewQuery(zi,7,e.ElementRef)),2&t){var r=void 0;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.inputComponent=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o._bannerMessageElementRef=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.contentContainerElement=r.first)}},inputs:{models:"models",config:"config",hostServices:"hostServices",entryPoint:"entryPoint"},outputs:{inputBoxFocused:"inputBoxFocused",utteranceUpdated:"utteranceUpdated",convertVisual:"convertVisual"},features:[e.\u0275\u0275ProvidersFeature([le.y,q.Q,io.Z,w.D])],decls:9,vars:11,consts:[[1,"qnaVisual",3,"ngSwitch"],["class","loadingContainer",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","glyphicon icon glyph-small pbi-glyph-info restatementIcon","tabindex","0",3,"ngStyle","pbiTooltip",4,"ngIf"],[1,"content",3,"ngClass"],["contentContainer",""],[3,"ngSwitch",4,"ngIf"],["class","footer",4,"ngIf"],[1,"loadingContainer"],[1,"loading"],["size","large",3,"delay"],["localize","Qna_InitialLoading"],[3,"errorInfo","viewport","showErrorDetails"],[4,"ngIf","ngIfElse"],["legacyBanner",""],[1,"header",3,"ngClass"],["drag-resize-disabled","true","tabindex","-1",1,"inputBox",3,"entryPoint","qnaSupportedScopes","interpretListener","presentationArgs","configs","initialUtterance","initialUtteranceFromSaved","inputBoxFocused"],["class","glyphicon icon glyph-small pbi-glyph-dependencyadd qnaAction","role","button",3,"ngClass","pbiTooltip","localizeAttr","ngStyle","accessible-click",4,"ngIf"],["class","glyphicon icon glyph-small pbi-glyph-settings qnaAction","role","button",3,"pbiTooltip","localizeAttr","ngStyle","accessible-click",4,"ngIf"],[4,"ngIf"],[3,"bannerContent","onDismiss"],["class","banner",4,"ngIf"],[1,"banner"],[1,"glyphicon","glyph-small","pbi-glyph-info"],[1,"mainMessage",3,"pbiTooltip","localize"],["bannerMainMessageTextContainer",""],["mat-button","",1,"mainAction",3,"localize","accessible-click"],["mat-button","",1,"dismiss","glyphicon","pbi-glyph-close","glyph-mini",3,"pbiTooltip","localizeAttr","accessible-click"],["role","button",1,"glyphicon","icon","glyph-small","pbi-glyph-dependencyadd","qnaAction",3,"ngClass","pbiTooltip","localizeAttr","ngStyle","accessible-click"],["role","button",1,"glyphicon","icon","glyph-small","pbi-glyph-settings","qnaAction",3,"pbiTooltip","localizeAttr","ngStyle","accessible-click"],["tabindex","0",1,"glyphicon","icon","glyph-small","pbi-glyph-info","restatementIcon",3,"ngStyle","pbiTooltip"],[3,"ngSwitch"],["class","suggestionsContainer",4,"ngSwitchCase"],["class","visualResultContainer",4,"ngSwitchCase"],["class","doNotUnderstandContainer",4,"ngSwitchCase"],["class","resultErrorContainer",4,"ngSwitchCase"],["errorOverlayTemplate",""],[1,"suggestionsContainer"],["class","suggestions",4,"ngIf"],["class","suggestionsWarning",3,"ngStyle",4,"ngIf"],[1,"suggestions"],["localize","Visual_Qna_SuggestionsHeader",1,"suggestionTitle",3,"ngStyle"],["data-testid","qna-suggestions",1,"suggestionsList"],["class","suggestion themeableElement","tabindex","0","role","button","data-testid","qna-suggestion",3,"ngStyle","accessible-click",4,"ngFor","ngForOf"],["tabindex","0","role","button","data-testid","qna-show-all-suggestions-btn",1,"showAllToggle",3,"localize","localizeAttr","accessible-click"],["tabindex","0","role","button","data-testid","qna-suggestion",1,"suggestion","themeableElement",3,"ngStyle","accessible-click"],[1,"suggestionsWarning",3,"ngStyle"],[1,"visualResultContainer"],["class","singleVisualHostContainer",4,"ngIf"],[1,"singleVisualHostContainer"],["class","loadingSpinner","size","small",3,"delay",4,"ngIf"],["tabindex","0","focus-nav-mode","Hierarchy","data-testid","qna-visual",3,"visual","visualViewport","themeCollection","config"],["size","small",1,"loadingSpinner",3,"delay"],[1,"doNotUnderstandContainer"],[1,"showDoNotUnderstandMessage",3,"ngStyle"],[1,"message"],["class","tellUsMore","href","javascript:void(0);",3,"accessible-click",4,"ngIf"],["href","javascript:void(0);",1,"tellUsMore",3,"accessible-click"],["localize","Qna_Feedback_TellUsMore"],[1,"resultErrorContainer"],[4,"ngTemplateOutlet"],[1,"footer"],["class","feedback",4,"ngIf"],["class","disclaimer",4,"ngIf"],[1,"feedback"],[3,"fontColor"],[1,"disclaimer"],["localize","Copilot_Disclaimer_Short"],["href","https://go.microsoft.com/fwlink/?linkid=2243166","localize","CopilotInline_PreviewLink","target","_blank",1,"pbi-external-link","fluentTheme-sm-reg"]],template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,qi,4,1,"div",1),e.\u0275\u0275template(2,Ni,2,2,"div",2),e.\u0275\u0275template(3,nr,9,16,"ng-container",2),e.\u0275\u0275template(4,ir,1,5,"i",3),e.\u0275\u0275elementStart(5,"div",4,5),e.\u0275\u0275template(7,xr,8,6,"ng-container",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Mr,4,4,"div",7),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275property("ngSwitch",o.viewModel.state),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","Loading"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","Error"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase","Ready"),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.displayedRestatement),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(8,wr,"Ready"===o.viewModel.state,o.viewModel.result&&"Suggestions"===o.viewModel.result.type)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.viewModel.result),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","Ready"===o.viewModel.state))},dependencies:[m.NgClass,m.NgForOf,m.NgIf,m.NgTemplateOutlet,m.NgStyle,m.NgSwitch,m.NgSwitchCase,Vt.X,st.b,bi.O,so.f,Mi.v,Ut.t,wi.V,bn,zn,qn,m.AsyncPipe,Li.F],styles:['.qnaVisual[_ngcontent-%COMP%]{font-size:12px;height:100%;display:flex;flex-direction:column}  html[data-focus-source=key] .qnaVisual:focus,   html[data-focus-source=key] .qnaVisual *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}  html[data-focus-source=mouse] .qnaVisual:focus,   html[data-focus-source=mouse] .qnaVisual *:focus,   html[data-focus-source=program] .qnaVisual:focus,   html[data-focus-source=program] .qnaVisual *:focus{outline:none}.qnaVisual[_ngcontent-%COMP%]     .powerbi-spinner{position:unset!important;margin-right:12px}.qnaVisual[_ngcontent-%COMP%]   .pbi-glyph-info[_ngcontent-%COMP%]:before{content:"\\e946"!important}.qnaVisual[_ngcontent-%COMP%]   .loadingContainer[_ngcontent-%COMP%]{display:flex;flex:1;align-items:center;justify-content:center}.qnaVisual[_ngcontent-%COMP%]   .loadingContainer[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.qnaVisual[_ngcontent-%COMP%]   .loadingContainer[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;text-align:center;margin:12px}.qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{display:flex;flex-direction:row;background-color:var(--gray-20, #F3F2F1);padding:0 12px;margin:8px 4px 4px;color:var(--gray-160, #323130);align-items:center}.qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .glyphicon[_ngcontent-%COMP%]{margin:8px 0}.qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .mainMessage[_ngcontent-%COMP%]{margin:4px 8px;flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .mainAction[_ngcontent-%COMP%]{margin:0;padding:2px 20px;background:var(--white-color, #FFF);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--md-font-size, 14px);font-weight:var(--font-weight-semi-bold, 600);border:1px solid var(--gray-110, #8A8886);box-sizing:border-box;border-radius:2px;height:fit-content}.qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .glyphicon.dismiss[_ngcontent-%COMP%]{padding:0}html:not([dir="rtl"])[_nghost-%COMP%]   .qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .glyphicon.dismiss[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .glyphicon.dismiss[_ngcontent-%COMP%]{margin:0 0 0 12px}html[dir="rtl"][_nghost-%COMP%]   .qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .glyphicon.dismiss[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .qnaVisual[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]   .glyphicon.dismiss[_ngcontent-%COMP%]{margin:0 12px 0 0}.qnaVisual[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-direction:row;min-height:44px;position:relative;margin-top:16px}.qnaVisual[_ngcontent-%COMP%]   .header.hasBanner[_ngcontent-%COMP%]{margin-top:0}.qnaVisual[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .inputBox[_ngcontent-%COMP%]{flex:1;margin:4px}.qnaVisual[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .qnaAction[_ngcontent-%COMP%]{margin:12px 4px 0;cursor:pointer;height:16px}.qnaVisual[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .qnaAction.disabled[_ngcontent-%COMP%]{color:var(--fluent-theme-neutral-tertiary-color, #A19F9D)!important;cursor:default}.qnaVisual[_ngcontent-%COMP%]   .restatementIcon[_ngcontent-%COMP%]{align-self:flex-end;cursor:default}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{margin:4px;flex:0}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .suggestionTitle[_ngcontent-%COMP%]{margin:1px 1px 12px 4px}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .suggestionsList[_ngcontent-%COMP%]{padding:0 4px;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));grid-template-rows:repeat(auto-fit,minmax(32px,1fr))}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .suggestionsList[_ngcontent-%COMP%]   .suggestion[_ngcontent-%COMP%]{font-size:14px;padding:12px 20px;border-radius:2px;box-shadow:var(--fluent-shadow-depth4, 0px 0px 2px var(--colorNeutralShadowAmbient), 0px 2px 4px var(--colorNeutralShadowKey));border:1px solid transparent;box-sizing:border-box;cursor:pointer;margin:0 12px 12px 0}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .showAllToggle[_ngcontent-%COMP%]{font-size:14px;color:var(--fluent-theme-link-color, #0078D4);margin:12px 4px;cursor:pointer;align-self:flex-end}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .visualResultContainer[_ngcontent-%COMP%]{position:relative;height:100%}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .visualResultContainer[_ngcontent-%COMP%]   .singleVisualHostContainer[_ngcontent-%COMP%]{height:100%}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .visualResultContainer[_ngcontent-%COMP%]   .singleVisualHostContainer[_ngcontent-%COMP%]   spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .visualResultContainer[_ngcontent-%COMP%]   .singleVisualHostContainer[_ngcontent-%COMP%]   single-visual-host[_ngcontent-%COMP%]{position:relative;display:block;height:100%;background-color:transparent}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .visualResultContainer[_ngcontent-%COMP%]   .singleVisualHostContainer[_ngcontent-%COMP%]   single-visual-host[_ngcontent-%COMP%]     .visual{height:100%}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .doNotUnderstandContainer[_ngcontent-%COMP%]{display:flex;justify-content:center;height:100%}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .doNotUnderstandContainer[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-right:4px}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .doNotUnderstandContainer[_ngcontent-%COMP%]   .showDoNotUnderstandMessage[_ngcontent-%COMP%], .qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .suggestionsContainer[_ngcontent-%COMP%]   .suggestionsWarning[_ngcontent-%COMP%]{display:flex;text-align:center;align-items:center;font-size:14px;max-width:450px;padding:20px;width:100%;box-sizing:border-box}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .resultErrorContainer[_ngcontent-%COMP%]{height:100%;position:relative;background-color:var(--neutral-lighter-color, #F4F4F4);display:flex;flex-direction:column;justify-content:center}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .resultErrorContainer[_ngcontent-%COMP%]   canvas-visual-error-overlay[_ngcontent-%COMP%]{position:relative;height:auto}.qnaVisual[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .resultErrorContainer[_ngcontent-%COMP%]   .tellUsMore[_ngcontent-%COMP%]{text-align:center;font-size:14px}.qnaVisual[_ngcontent-%COMP%]   .content.contentReady[_ngcontent-%COMP%]{flex:1;overflow:hidden}.qnaVisual[_ngcontent-%COMP%]   .content.suggestionContent[_ngcontent-%COMP%]{overflow-y:auto}.qnaVisual[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   .feedback[_ngcontent-%COMP%]{flex:0;padding-top:2px}.qnaVisual[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]   .feedback[_ngcontent-%COMP%]   qna-feedback[_ngcontent-%COMP%]{float:right}']}),i}(),Or=u(97999),Tr=u(8898),Fr=u(14463),vn=u(8590),co=u(3579),po=u(60661),Br=u(91615),Dr=u(73058),Ar=u(32640),Vr=u(82755),go=u(5265),Ur=u(99917),Qr=u(4541),kr=u(69838),Lr=u(64546),En=u(74857),ho=u(91592),Rr=u(11494),fo=u(48145),zr=u(94717),qr=u(39631),Nr=u(66890),Hr=u(81213),Gr=u(29866),$r=u(72262),Wr=u(28107),jr=u(67660),Kr=u(35756),Zr=["qnaVisual"],Jr=function(){return{"aria-label":"Qna_MessageDialog_EnableQnaButtonText"}};function Xr(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275listener("accessible-click",function(){e.\u0275\u0275restoreView(t);var r=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(r.enableQna())}),e.\u0275\u0275elementEnd()}2&i&&e.\u0275\u0275property("localizeAttr",e.\u0275\u0275pureFunction0(2,Jr))("localize","Qna_MessageDialog_EnableQnaButtonText")}function Yr(i,n){if(1&i&&(e.\u0275\u0275elementStart(0,"div",7),e.\u0275\u0275element(1,"div",8),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Xr,1,3,"button",10),e.\u0275\u0275elementEnd()),2&i){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(2),e.\u0275\u0275attribute("aria-label",t.disallowQnaDetails.notEnabledDetails.message),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.disallowQnaDetails.notEnabledDetails.message),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.disallowQnaDetails.notEnabledDetails.canEnable)}}function ea(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"canvas-visual-error-overlay",12),e.\u0275\u0275listener("showErrorDetails",function(){e.\u0275\u0275restoreView(t);var a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.showVisualErrorDetails())}),e.\u0275\u0275elementEnd()}if(2&i){var o=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("errorInfo",o.disallowQnaDetails.otherReasonErrorDetails)("viewport",o.currentViewport)}}function ta(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Yr,5,3,"div",5),e.\u0275\u0275template(2,ea,1,2,"canvas-visual-error-overlay",6),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","qnaNotEnabled"===t.disallowQnaDetails.reason),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","qnaNotEnabled"!==t.disallowQnaDetails.reason)}}function na(i,n){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ta,3,2,"ng-container",4),e.\u0275\u0275elementContainerEnd()),2&i){var t=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(4);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.disallowQna)("ngIfElse",o)}}function oa(i,n){if(1&i){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",13)(1,"qna-host",14,15),e.\u0275\u0275listener("utteranceUpdated",function(a){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.utteranceUpdated(a))})("convertVisual",function(a){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.convertVisual(a))})("inputBoxFocused",function(a){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onInputBoxFocused(a))}),e.\u0275\u0275elementEnd()()}if(2&i){var o=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("config",o.config)("models",o.models)("hostServices",o.hostServices)("entryPoint",o.entryPoint)}}var ia=function(n,t){return{hasDisallowQnaContent:n,customPadding:t}},mo="hiddenProperties",vo="savedUtterance",Co=function(){function i(n,t,o,r,a,s,l,g,c,p,f,y,E,D,k,Se,ke,qe,Pt,Ht,Ot,Fn){var Wn=this;this.changeDetectorRef=n,this.conceptualSchemaProxy=t,this.dataSources=o,this.errorService=r,this.eventBridge=a,this.explorationCapabilitiesService=s,this.explorationNavigation=l,this.filterGenerator=g,this.lazyProvider=c,this.localizationService=p,this.pauseQueriesService=f,this.visualPlugin=y,this.featureSwitchService=E,this.selection=D,this.telemetryService=k,this.themeService=Se,this.viewModeState=ke,this.visualAuthoring=qe,this.visualAuthoringCustomizeOperations=Pt,this.promiseFactory=Ht,this.qnaProxyPath=Fn,this.visualReady=new e.EventEmitter,this.inputBoxFocused=new e.EventEmitter,this.subscriptionManager=this.eventBridge.createChannelSubscriptionManager().subscribe(vn.CCe,function(){return(0,b.__awaiter)(Wn,void 0,void 0,function(){return(0,b.__generator)(this,function(Eo){switch(Eo.label){case 0:return[4,this.onModelChanged()];case 1:return Eo.sent(),[2]}})})}),this.subscriptions=new Or.g4(Ot),this.isReportPausedSubscription=this.pauseQueriesService.isReportPaused$().subscribe(function(){Wn.visualContainer&&Wn.reInitializeComponent()})}return i.prototype.ngOnInit=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){return(0,b.__generator)(this,function(n){return this.reInitializeComponent(),[2]})})},i.prototype.ngOnDestroy=function(){this.subscriptionManager.unsubscribeAll(),this.subscriptions.unsubscribeAll(),this.settingsChangedSubscription&&this.settingsChangedSubscription.unsubscribe(),this.isReportPausedSubscription&&this.isReportPausedSubscription.unsubscribe(),this.visualAuthoringCustomizeOperations.requiresCustomizeConvert(this.visualContainer)&&this.visualAuthoringCustomizeOperations.removeCustomizeFrom(this.visualContainer)},i.prototype.ngDoCheck=function(){var n=this.visualDefinition.viewport;(!this.currentViewport||n.height!==this.currentViewport.height||n.width!==this.currentViewport.width||n.scale!==this.currentViewport.scale)&&(this.currentViewport={width:n.width,height:n.height,scale:n.scale},this.setNewViewport(n),this.qnaHost&&!this.disallowQna&&this.qnaHost.update({type:Nt.EP.Resize,viewport:this.currentViewport}))},i.prototype.init=function(n){var t=this,o=this.extractObjects(this.visualContainer),r=(0,Vr.NA)(o,{objectName:mo,propertyName:vo},"");this.config={canEdit:this.getCanEdit(),canShowPods:!1,canShowVisuals:!0,canShowDidYouMean:!0,initialUtterance:r,initialUtteranceFromSaved:!_.isEmpty(r)};var a=_.find(this.dataSources.get(),function(s){return s.type===Dr.nKy});this.models=[{vsName:a.dsr.vsName,dbName:a.dsr.dbName,qnaSupported:!0,id:a.id}],this.entryPoint="Visual",this.hostServices=n.host,this.isLoading=!1,this.setNewViewport(n.viewport),this.changeDetectorRef.detectChanges(),this.onVisualContainerUpdate(!0),this.visualAuthoringCustomizeOperations.registerCustomizeFrom(this.visualContainer,function(s){return t.customizeConvertFrom(s)})},i.prototype.update=function(n){!(0,te.yE)(n.type,Nt.EP.Resize)||!this.qnaHost||(this.setNewViewport(n.viewport),this.qnaHost.update({type:Nt.EP.Resize,viewport:n.viewport}))},i.prototype.onViewModeChanged=function(n){this.config.canEdit=this.getCanEdit()},i.prototype.enumerateObjectInstances=function(n){if(this.qnaHost)return this.qnaHost.enumerateObjectInstances(n)},i.prototype.getFormattingModel=function(){if(this.qnaHost)return this.qnaHost.getFormattingModel()},Object.defineProperty(i.prototype,"supportsCustomPadding",{get:function(){var t;return null===(t=this.featureSwitchService)||void 0===t?void 0:t.featureSwitches.vcPadding},enumerable:!1,configurable:!0}),i.prototype.focus=function(){if(this.qnaHost)return this.qnaHost.focus()},i.prototype.utteranceUpdated=function(n){var t;if(null!=n){var o={merge:[{objectName:mo,selector:void 0,properties:(t={},t[vo]=n,t)}]};this.hostServices.persistProperties(o,!0)}},i.prototype.convertVisual=function(n){return(0,b.__awaiter)(this,void 0,void 0,function(){var t,r,a=this;return(0,b.__generator)(this,function(s){switch(s.label){case 0:return t=(0,co.s)(n),[4,this.visualAuthoring.convert(this.visualContainer,this.dataSources.get(),t,void 0)];case 1:return s.sent()&&(r=this.selection.getSelectedElements().find(function(l){return l.canvasItem.name===a.visualContainer.name}))&&this.eventBridge.publishToChannel(vn.MEZ,{affectContainer:function(g){return g===r.canvasItem},preventScroll:!0}),[2]}})})},i.prototype.onInputBoxFocused=function(n){this.inputBoxFocused.emit(n)},i.prototype.customizeConvertFrom=function(n){C.fF.assertValue(n,"visualContainer");var t=this.qnaHost&&this.qnaHost.getCurrentVisual();t&&(n.config.singleVisual.query=t.config.singleVisual.query,n.config.singleVisual.visualType=t.config.singleVisual.visualType,n.config.singleVisual.objects=(0,b.__assign)((0,b.__assign)({},n.config.singleVisual.objects||{}),t.config.singleVisual.objects||{}),n.filters=t.filters,n.config.singleVisual.conversionSourceContext=void 0)},i.prototype.enableQna=function(){var n=this;C.fF.assert(function(){var t,o;return n.disallowQna&&(null===(o=null===(t=n.disallowQnaDetails)||void 0===t?void 0:t.notEnabledDetails)||void 0===o?void 0:o.canEnable)},"Expect this is called only when this.disallowQna && this.disallowQnaDetails.becauseNotEnabledDetails.canEnable is true"),this.qnaSupportabilityService.enableQna()},i.prototype.showVisualErrorDetails=function(){var n=this;C.fF.assert(function(){var t;return n.disallowQna&&!(null===(t=n.disallowQnaDetails)||void 0===t||!t.otherReasonErrorDetails)},"Expect this to be called only when this.disallowQna && this.disallowQnaDetails.becauseOtherReasonErrorDetails is defined"),(0,En.aZ)(this.disallowQnaDetails.otherReasonErrorDetails,this.errorService,this.localizationService)},i.prototype.reInitializeComponent=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,t,o,r=this;return(0,b.__generator)(this,function(a){switch(a.label){case 0:return this.isLoading=!0,this.visualContainer.filters=void 0,[4,this.ensureQnaSupportabilityService()];case 1:return a.sent(),this.settingsChangedSubscription||(this.settingsChangedSubscription=this.qnaSupportabilityService.qnaSettingsChanged$.subscribe(function(){return r.reInitializeComponent()})),[4,this.checkIsQnaAllowed()];case 2:return a.sent(),this.disallowQna?(this.isLoading=!1,[2]):(this.wasQnaAllowedBefore?this.visualDefinition.visual.destroy():(this.currentViewport=this.visualDefinition.viewport,n=this.visualPlugin.getPlugin(this.visualDefinition.type),this.visualDefinition.visual=(0,Lr.nm)(n,n.create,this.promiseFactory,this.telemetryService,{createQnaVisual:function(){return r}}),this.subscriptionManager.subscribe(vn.jCS,function(s,l){l&&l.affectContainer(r.visualContainer)&&r.onVisualContainerUpdate()}).subscribe(Br.kx,function(){return(0,b.__awaiter)(r,void 0,void 0,function(){return(0,b.__generator)(this,function(s){switch(s.label){case 0:return[4,this.onVisualContainerUpdate()];case 1:return[2,s.sent()]}})})}).subscribe(vn.Tuj,function(){return(0,b.__awaiter)(r,void 0,void 0,function(){return(0,b.__generator)(this,function(s){switch(s.label){case 0:return[4,this.onVisualContainerUpdate()];case 1:return[2,s.sent()]}})})}),this.subscriptions.subscribe("LuciaDomainModelChangedEvent",function(){return r.onVisualContainerUpdate()})),this.wasQnaAllowedBefore=!0,t=(0,En.Su)(this.explorationNavigation,this.featureSwitchService),o={element:{empty:function(){},get:function(){}},host:this.visualDefinition.hostServices,visualAdapterHostServices:this.visualDefinition.visualAdapterHostServices,style:this.themeService&&this.themeService.getVisualStyle(t),viewport:this.visualDefinition.viewport,animation:{transitionImmediate:!1},featureSwitches:(0,b.__assign)({},this.featureSwitchService.featureSwitches)},[2,this.visualDefinition.visual.init(o)])}})})},i.prototype.getCanEdit=function(){return 0!==this.viewModeState.getMode()},i.prototype.onModelChanged=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){return(0,b.__generator)(this,function(n){switch(n.label){case 0:return[4,this.reInitializeComponent()];case 1:return n.sent(),[2]}})})},i.prototype.checkIsQnaAllowed=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,o,r;return(0,b.__generator)(this,function(a){switch(a.label){case 0:if(this.pauseQueriesService.isReportPaused())return this.disallowQna=!0,this.disallowQnaDetails={reason:"qnaNotSupported",otherReasonErrorDetails:sa(this.localizationService)},[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),[2];case 4:if(o=this.explorationCapabilitiesService.getCapabilities(),r=(0,ho.H)(o,n,this.qnaSupportabilityService),this.disallowQna=!r.isAllowed,r.isAllowed)return[2];switch(r.disallowedReason){case"featureDisabledInIE":this.disallowQnaDetails={reason:"featureDisabledInIE",otherReasonErrorDetails:(0,En.ET)(this.localizationService)};break;case"featureDisabledInApp":C.fF.assertFail("Expect the code of generating a qna visual never be called if app doesn't allow qna feature");break;case"noModel":this.disallowQnaDetails={reason:"noModel",otherReasonErrorDetails:ra(this.localizationService)};break;case"qnaNotSupported":this.disallowQnaDetails={reason:"qnaNotSupported",otherReasonErrorDetails:aa(this.localizationService)};break;case"qnaNotEnabled":this.disallowQnaDetails={reason:"qnaNotEnabled",notEnabledDetails:{message:this.qnaSupportabilityService.modelHasQnaDisabledMessage,canEnable:this.qnaSupportabilityService.canAnyUserEnableQna()}};break;default:C.fF.assertNever(r.disallowedReason)}return[2]}})})},i.prototype.onVisualContainerUpdate=function(n){return void 0===n&&(n=!1),(0,b.__awaiter)(this,void 0,void 0,function(){var t,o,r,a,s=this;return(0,b.__generator)(this,function(l){switch(l.label){case 0:return this.isLoading?[2]:[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return t=l.sent(),o=this.filterGenerator.calculateVisualContainerFilter(this.explorationNavigation.getCurrentExploration(),this.explorationNavigation.getCurrentSection(),this.visualContainer,t),r=this.extractObjects(this.visualContainer),a=Nt.EP.Style|Nt.EP.Data,n&&(a|=Nt.EP.Resize),this.qnaHost&&(this.qnaHost.update({type:a,filters:o,objects:r,firstUpdate:n,viewport:this.currentViewport}),this.visualAuthoringCustomizeOperations.registerCustomizeFrom(this.visualContainer,function(g){return s.customizeConvertFrom(g)})),this.eventBridge.publishToChannel(vn.D1A,this.visualContainer),this.visualReady.emit(),[2]}})})},i.prototype.extractObjects=function(n){var t=(0,po.GQ)(n);t||(t={}),t=(0,go.d9)(t);var o=(0,En.Su)(this.explorationNavigation,this.featureSwitchService),r=this.themeService.getVisualObjects(o,(0,co.s)(n),void 0,Ar.OF.objects,!1);(0,go.l7)(t,r);var a=[];for(var s in t)a.push({name:s,properties:t[s][0].properties});var l=(0,po.cj)(n,this.visualPlugin),g=l?.objects;if(g){var c=this.themeService.getVisualStyle(o),p=(0,kr.X)(),f=new Qr.Q(this.featureSwitchService.featureSwitches,c);return(0,Ur.PJ)(f,p,g,a)}},i.prototype.setNewViewport=function(n){var t=this.qnaVisualElement.nativeElement;$(t).height(n.height),$(t).width(n.width)},i.prototype.ensureQnaSupportabilityService=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n;return(0,b.__generator)(this,function(t){switch(t.label){case 0:return this.qnaSupportabilityService?[2]:(n=this,[4,this.lazyProvider.get(this.qnaProxyPath||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaSupportabilityService")]);case 1:return n.qnaSupportabilityService=t.sent(),[2]}})})},i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Ce.i),e.\u0275\u0275directiveInject(He.D),e.\u0275\u0275directiveInject(Hr.T),e.\u0275\u0275directiveInject(Rr.J),e.\u0275\u0275directiveInject(fo.U),e.\u0275\u0275directiveInject(Re.z),e.\u0275\u0275directiveInject(zr.r),e.\u0275\u0275directiveInject(it.E),e.\u0275\u0275directiveInject(bt.o),e.\u0275\u0275directiveInject(qr.F),e.\u0275\u0275directiveInject(Gr.D),e.\u0275\u0275directiveInject(et.vZ),e.\u0275\u0275directiveInject($r.z),e.\u0275\u0275directiveInject(ue.y0),e.\u0275\u0275directiveInject(jr.f),e.\u0275\u0275directiveInject(ro.kc),e.\u0275\u0275directiveInject(Nr.$8),e.\u0275\u0275directiveInject(Wr.Q),e.\u0275\u0275directiveInject(Fr.t),e.\u0275\u0275directiveInject(Tr.x,8),e.\u0275\u0275directiveInject(Ft.n,8))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["qna-visual-host"]],viewQuery:function(t,o){if(1&t&&(e.\u0275\u0275viewQuery(Zr,7,e.ElementRef),e.\u0275\u0275viewQuery(Be.Pl,7),e.\u0275\u0275viewQuery(Nn,5)),2&t){var r=void 0;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.qnaVisualElement=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.portalOutlet=r.first),e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(o.qnaHost=r.first)}},inputs:{visualDefinition:"visualDefinition",visualContainer:"visualContainer"},outputs:{visualReady:"visualReady",inputBoxFocused:"inputBoxFocused"},decls:5,vars:6,consts:[["keyboard-shortcuts","ctrl-ArrowRight scoped",1,"visual","visual-qnaVisual",3,"ngClass"],["qnaVisual",""],[4,"ngIf"],["showQna",""],[4,"ngIf","ngIfElse"],["class","qnaNotEnabledContainer",4,"ngIf"],[3,"errorInfo","viewport","showErrorDetails",4,"ngIf"],[1,"qnaNotEnabledContainer"],[1,"glyphicon","pbi-glyph-blocked2","glyph-med"],["tabindex","0",1,"message"],["class","btn primary",3,"localizeAttr","localize","accessible-click",4,"ngIf"],[1,"btn","primary",3,"localizeAttr","localize","accessible-click"],[3,"errorInfo","viewport","showErrorDetails"],[1,"qnaVisualContent"],[3,"config","models","hostServices","entryPoint","utteranceUpdated","convertVisual","inputBoxFocused"],["qnaHost",""]],template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"div",0,1),e.\u0275\u0275template(2,na,2,2,"ng-container",2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,oa,3,4,"ng-template",null,3,e.\u0275\u0275templateRefExtractor)),2&t&&(e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(3,ia,o.disallowQna,o.supportsCustomPadding)),e.\u0275\u0275attribute("focus-nav-mode","Group"),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!o.isLoading))},dependencies:[m.NgClass,m.NgIf,Vt.X,st.b,so.f,Ut.t,Kr.q,Nn],styles:[".visual-qnaVisual.hasDisallowQnaContent[_ngcontent-%COMP%]{width:100%!important;height:100%!important}  html[data-focus-source=key] .visual-qnaVisual:focus,   html[data-focus-source=key] .visual-qnaVisual *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}  html[data-focus-source=mouse] .visual-qnaVisual:focus,   html[data-focus-source=mouse] .visual-qnaVisual *:focus,   html[data-focus-source=program] .visual-qnaVisual:focus,   html[data-focus-source=program] .visual-qnaVisual *:focus{outline:none}.visual-qnaVisual[_ngcontent-%COMP%]   .qnaNotEnabledContainer[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;box-sizing:border-box;padding:20px;background-color:var(--fluent-theme-neutral-lighter-color, #F3F2F1);font-size:14px;text-align:center}.visual-qnaVisual[_ngcontent-%COMP%]   .qnaNotEnabledContainer[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-top:12px;max-width:300px}.visual-qnaVisual[_ngcontent-%COMP%]   .qnaNotEnabledContainer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:12px}.visual-qnaVisual[_ngcontent-%COMP%]   .qnaVisualContent[_ngcontent-%COMP%]{height:100%}"]}),i}();function ra(i){return{code:"qnaNotAllowedWithoutModel",fixableError:0,hideSeeDetails:!0,details:{message:i.get("Qna_NotAllowedForReport_WithoutModel"),displayableErrorInfo:void 0},source:"User"}}function aa(i){var o=[{errorInfoKey:i.get("VisualContainer_QnaVisual_NotSupportedTitle"),errorInfoValue:i.get("VisualContainer_QnaVisual_NotSupportedMessage")}];return{code:"qnaNotSupported",fixableError:0,hideSeeDetails:!1,details:{message:i.get("Qna_NotAllowedForReport_QnaNotSupported"),displayableErrorInfo:o},source:"User"}}function sa(i){return{code:"qnaNotSupported",fixableError:0,hideSeeDetails:!0,details:{message:i.get("Qna_NotAllowedForReport_Paused"),displayableErrorInfo:void 0},source:"User"}}var _o=u(67489),la=u(96777),yo=function(){function i(n){this.templateDialogPayload=n}return i.prototype.ngOnInit=function(){var n,t=(n=this.templateDialogPayload.input).errorCode,o=n.errorMessage;C.fF.assertValue(t,"diagnostic dialog error code"),this.diagnosticMessage=(0,wn.g)(o)?t:"".concat(t," ").concat(o)},i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(_o.x))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["qna-diagnostic-dialog"]],features:[e.\u0275\u0275ProvidersFeature([_o.x])],decls:3,vars:1,consts:[[2,"min-width","400px"]],template:function(t,o){1&t&&(e.\u0275\u0275elementStart(0,"template-dialog")(1,"p",0),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(o.diagnosticMessage))},dependencies:[la.J],encapsulation:2,changeDetection:0}),i}(),ua=u(92060),ca=u(96278),Hn=u(14714),da=u(68082),Gn=u(65966),pa=u(58938),wt=u(34100),an=u(14251),Et=function(){function i(n){this.deferredPromise=n}return i.prototype.signalCompletion=function(){this.deferredPromise.resolve()},i.prototype.getDeferredPromise=function(){return this.deferredPromise.promise},i}();function So(i,n,t){var o;switch(C.fF.assert(function(){return!_.isEmpty(i)},"lsdlAgents should be defined and non empty"),C.fF.assertValue(n,"localizationService"),C.fF.assertValue(t,"target should be defined"),t){case"Synonyms":var r=_.includes(i,"PowerBI.AzureOpenAISynonyms"),a=_.includes(i,"PowerBI.OrganizationLsdlSharing");C.fF.assert(function(){return r||a},"target: Synonyms should contain AzureOpenAISynonyms or OrganizationLsdlSharing agent or both in the improve lsdl flow"),o=Po(r,a,n);break;case"Phrasings":C.fF.assert(function(){return _.includes(i,"PowerBI.AzureOpenAIPhrasings")},"target: Phrasings should contain AzureOpenAIPhrasings agent in the improve lsdl flow"),o=xo(n);break;default:C.fF.assertFail("target should be synonyms or phrasings")}return o}function Po(i,n,t){return{emphasis:t.get(i&&n?"Qna_ImproveLsdl_Synonyms_Copilot_Org":i?"Qna_ImproveLsdl_Synonyms_Copilot":"Qna_ImproveLsdl_Synonyms_Org"),text:t.get(i?"Qna_ImproveLsdl_Copilot_Disclaimer":"Qna_ImproveLsdl_Synonyms_Org_Message")}}function xo(i){var n=i.format("Qna_ImproveLsdl_Copilot_Phrasings_Prompt",[i.get("Qna_ImproveLsdl_Copilot_Disclaimer")]);return{emphasis:i.get("Qna_ImproveLsdl_Phrasings_Copilot"),text:n}}function $n(i,n,t){void 0===t&&(t=!1);var o=n.getAgents(i),r=_.chain(o).filter(function(a){var s="Enabled"===a.state,l=(0,wn.g)(a.lastModified);return t?s:s&&l}).map(function(a){return a.name}).value();return"oaiPhrasings"!==i||_.find(o,function(a){return"PowerBI.AzureOpenAIPhrasings"===a.name})?"externalSynonyms"===i&&(_.find(o,function(a){return"PowerBI.AzureOpenAISynonyms"===a.name})||r.push("PowerBI.AzureOpenAISynonyms"),_.find(o,function(a){return"PowerBI.OrganizationLsdlSharing"===a.name})||r.push("PowerBI.OrganizationLsdlSharing")):r.push("PowerBI.AzureOpenAIPhrasings"),r}var ga=function(i){function n(t,o,r,a,s,l,g){var c=i.call(this,g)||this;return c.featureSwitchService=t,c.conceptualSchemaProxy=o,c.dataModelService=r,c.dataSourcesService=a,c.explorationCapabilitiesService=s,c.qnaSupportabilityService=l,c}return(0,b.__extends)(n,i),n.prototype.execute=function(){var t;return(0,b.__awaiter)(this,void 0,void 0,function(){var r,a,s;return(0,b.__generator)(this,function(l){switch(l.label){case 0:return[4,this.featureSwitchService.getFeatureSwitches()];case 1:return l.sent().qnaCopilotPhrasings?[4,this.dataModelService.getLinguisticSchema()]:(this.signalCompletion(),[2,this.getDeferredPromise()]);case 2:return r=l.sent(),[4,(0,wt.NP)(this.conceptualSchemaProxy,this.dataSourcesService,this.explorationCapabilitiesService,this.qnaSupportabilityService,r)];case 3:return l.sent()?(a=new an.X(r),s=$n("oaiPhrasings",a),_.includes(s,"PowerBI.AzureOpenAIPhrasings")&&this.doneOAISynonyms(a)&&this.hasAuthoredTerm(a)?(null===(t=this.next)||void 0===t||t.execute(s),[2,this.getDeferredPromise()]):(this.signalCompletion(),[2,this.getDeferredPromise()])):(this.signalCompletion(),[2,this.getDeferredPromise()])}})})},n.prototype.doneOAISynonyms=function(t){var o=$n("externalSynonyms",t);return!_.includes(o,"PowerBI.AzureOpenAISynonyms")},n.prototype.hasAuthoredTerm=function(t){var o=t.getEntities();return _.some(o,function(r){return _.some(r.terms,function(a){return a.isAuthored})})},n}(Et),ha=function(i){function n(t,o,r,a,s,l){var g=i.call(this,l)||this;return g.conceptualSchemaProxy=t,g.dataModelService=o,g.dataSourcesService=r,g.explorationCapabilitiesService=a,g.qnaSupportabilityService=s,g}return(0,b.__extends)(n,i),n.prototype.execute=function(){var t;return(0,b.__awaiter)(this,void 0,void 0,function(){var o,r,a;return(0,b.__generator)(this,function(s){switch(s.label){case 0:return[4,this.dataModelService.getLinguisticSchema()];case 1:return o=s.sent(),[4,(0,wt.NP)(this.conceptualSchemaProxy,this.dataSourcesService,this.explorationCapabilitiesService,this.qnaSupportabilityService,o)];case 2:return s.sent()?(r=new an.X(o),a=$n("externalSynonyms",r),_.isEmpty(a)?this.signalCompletion():null===(t=this.next)||void 0===t||t.execute(a),[2,this.getDeferredPromise()]):(this.signalCompletion(),[2,this.getDeferredPromise()])}})})},n}(Et),ma={provide:"qnaBannerService",useFactory:function(){return(0,b.__awaiter)(this,void 0,void 0,function(){return(0,b.__generator)(this,function(i){return[2,new va]})})},deps:[]},Fe={showBanners:!1,banners:[]},va=function(){function i(){var n;this.bannerContent$=new Y.X(((n={}).ToolingHome=Fe,n.ToolingSynonyms=Fe,n.ToolingPhrasings=Fe,n.Visual=Fe,n))}return i.prototype.setContent=function(n){C.fF.assertValue(n,"bannersBySurface"),_.forEach(n,function(t){C.fF.assertValue(t,"banner content should not be null")}),this.bannerContent$.next(n)},i.prototype.updateContent=function(n,t){C.fF.assertValue(n,"qnaBannerSurface"),C.fF.assertValue(t,"updatedContent");var o=this.bannerContent$.value;o[n]=t,this.bannerContent$.next(o)},i.prototype.getBannerContent=function(n){return C.fF.assertValue(n,"qnaBannerSurface"),this.bannerContent$.asObservable().pipe((0,de.U)(function(t){return t[n]}))},i.prototype.dismissBanner=function(n,t){C.fF.assertValue(n,"qnaBannerSurface"),C.fF.assertValue(t,"qnaBannerId");var r=(0,b.__assign)({},this.bannerContent$.value[n]),a=_.find(r.banners,function(s){return s.id===t});null!=a?(a.isVisible=!1,r.banners=(0,b.__spreadArray)([],r.banners,!0),this.updateContent(n,r),1===_.size(r.banners)&&r.onDismissAllBanners&&r.onDismissAllBanners()):C.fF.assertFail("banner with id: ".concat(t," not found"))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac=function(t){return new(t||i)}}),i}(),Io=function(i){function n(t,o,r,a,s,l,g,c,p){var f=i.call(this,p)||this;return f.accountService=t,f.dataSourcesService=o,f.explorationNavigationService=r,f.qnaBannerService=a,f.qnaToolingLauncher=s,f.localizationService=l,f.improveLsdlBackgroundTelemetry=g,f.target=c,f}return(0,b.__extends)(n,i),n.prototype.execute=function(t){var o;return(0,b.__awaiter)(this,void 0,void 0,function(){var a,s,l,g,c,p,f=this;return(0,b.__generator)(this,function(y){switch(y.label){case 0:return[4,this.accountService.isSignedInAsync()];case 1:return y.sent()?(this.clearBannerContent(),null===(o=this.next)||void 0===o||o.execute(t),[2,this.getDeferredPromise()]):(a=this.localizationService.get("Synonyms"===this.target?"Qna_ImproveLsdl_Synonyms_LoginMessage":"Qna_ImproveLsdl_Phrasings_LoginMessage"),s={emphasis:this.localizationService.get("Qna_ImproveLsdl_Login"),text:a},l=this.localizationService.get("SignInButton"),g=this.localizationService.get("Synonyms"===this.target?"Qna_ImproveLsdl_Synonyms_AddYourOwnButton":"Qna_ImproveLsdl_Phrasings_AddYourOwnButton"),c=function(D){f.improveLsdlBackgroundTelemetry.logSigninEvent({surface:D,type:f.target,action:"Login"}),f.accountService.trySignInAsync()},this.qnaBannerService.setContent(((p={}).Visual={showBanners:!0,banners:[{id:Me.b$.generateGuid(),message:s,isVisible:!0,allowDismiss:!0,bannerType:"copilot",actions:[{id:"login",text:l,actionAppearance:"primary"},{id:"launchTooling",text:g,actionAppearance:"secondary"}]}],actionHandlers:new Map([["login",function(){return c("Visual")}],["launchTooling",function(){f.improveLsdlBackgroundTelemetry.logSigninEvent({surface:"Visual",type:f.target,action:"AddYourOwn"}),f.qnaToolingLauncher.showToolingDialog({dataSources:f.dataSourcesService.get(),exploration:f.explorationNavigationService.getCurrentExploration(),entryPoint:"VisualBanner",entryContentType:"Synonyms"===f.target?"bulkEditing":"managePhrasings"})}]])},p.ToolingHome={showBanners:!0,banners:[{id:Me.b$.generateGuid(),message:s,isVisible:!0,allowDismiss:!0,bannerType:"copilot",actions:[{id:"login",text:l,actionAppearance:"primary"},{id:"Synonyms"===this.target?"switchToSynonymsPage":"switchToPhrasingsPage",text:g,actionAppearance:"secondary"}]}],actionHandlers:new Map([["login",function(){return c("ToolingHome")}],["switchToSynonymsPage",void 0],["switchToPhrasingsPage",void 0]])},p.ToolingSynonyms="Synonyms"===this.target?{showBanners:!0,banners:[{id:Me.b$.generateGuid(),message:s,isVisible:!0,allowDismiss:!0,bannerType:"copilot",actions:[{id:"login",text:l,actionAppearance:"primary"}]}],actionHandlers:new Map([["login",function(){return c("ToolingSynonyms")}]])}:Fe,p.ToolingPhrasings="Phrasings"===this.target?{showBanners:!0,banners:[{id:Me.b$.generateGuid(),message:s,isVisible:!0,allowDismiss:!0,bannerType:"copilot",actions:[{id:"login",text:l,actionAppearance:"primary"}]}],actionHandlers:new Map([["login",function(){return c("ToolingPhrasings")}]])}:Fe,p)),[2,this.getDeferredPromise()])}})})},n.prototype.clearBannerContent=function(){var t;this.qnaBannerService.setContent(((t={}).Visual=Fe,t.ToolingHome=Fe,t.ToolingSynonyms=Fe,t.ToolingPhrasings=Fe,t))},n}(Et),Ca=u(53439),sn=u(94759),On="https://go.microsoft.com/fwlink/?linkid=2243166",Tn=function(i){function n(t,o,r,a,s,l,g,c,p,f,y,E,D){var k=i.call(this,D)||this;return k.dataModelService=t,k.dataSourcesService=o,k.explorationNavigationService=r,k.featureSwitchService=a,k.qnaBannerService=s,k.qnaToolingLauncher=l,k.modelAuthoringService=g,k.localizationService=c,k.dialogService=p,k.improveLsdlExecutionHandler=f,k.improveLsdlBackgroundTelemetry=y,k.target=E,k.underExecution=!1,k}return(0,b.__extends)(n,i),n.prototype.execute=function(t){var o=t.response,r=t.requestedAgents,a=t.copilotWorkspaceId;return(0,b.__awaiter)(this,void 0,void 0,function(){var s,l,g,c,p,f,y,E,D,k,Se=this;return(0,b.__generator)(this,function(ke){switch(ke.label){case 0:return null==o.result?[3,1]:(s=new an.X(o.result.lsdlObject),[3,3]);case 1:return[4,this.dataModelService.getLinguisticSchema()];case 2:l=ke.sent(),s=new an.X(l),ke.label=3;case 3:return[4,this.featureSwitchService.getFeatureSwitches()];case 4:if(g=ke.sent(),c=(0,wt.J8)(g),p=!1,c&&(s.setRuntimeUnderstanding("Full"),p=s.commit()),null==o.result&&!p)return[3,8];ke.label=5;case 5:return ke.trys.push([5,7,,8]),[4,this.modelAuthoringService.apply({changes:[{updateLinguisticMetadata:{linguisticSchemaJson:s.toJsonString()}}]})];case 6:return ke.sent(),[3,8];case 7:return f=ke.sent(),C.fF.assertFail(f),[3,8];case 8:return(D={}).Visual=[],D.ToolingHome=[],D.ToolingSynonyms=[],D.ToolingPhrasings=[],y=D,null!=o.result&&(y=this.getSuccessBanners(s,r)),E=[],!_.isEmpty(o.errors)&&null==_.find(o.errors,function(qe){return"OperationCancelled"===qe.code})&&(E=n.getErrorBanners(o.errors,this.localizationService,this.target)),this.qnaBannerService.setContent(((k={}).Visual={showBanners:!0,banners:(0,b.__spreadArray)((0,b.__spreadArray)([],y.Visual,!0),E,!0),onDismissAllBanners:function(){return Se.signalCompletion()},actionHandlers:new Map([["launchTooling",function(){var qe=_.first(y.Visual);Se.qnaBannerService.dismissBanner("Visual",qe.id),Se.improveLsdlBackgroundTelemetry.logResultEvent({surface:"Visual",type:Se.target,action:"ReviewResults",resultType:"Success"}),Se.qnaToolingLauncher.showToolingDialog({dataSources:Se.dataSourcesService.get(),exploration:Se.explorationNavigationService.getCurrentExploration(),entryPoint:"VisualBanner",entryContentType:"Synonyms"===Se.target?"bulkEditing":"managePhrasings"}),Se.signalCompletion()}],["errorDetails",this.getErrorDetailsHandler("Visual")],["retry",this.getRetryHandler("Visual",r,a)]])},k.ToolingHome={showBanners:!0,banners:(0,b.__spreadArray)((0,b.__spreadArray)([],y.ToolingHome,!0),E,!0),onDismissAllBanners:function(){return Se.signalCompletion()},actionHandlers:"Synonyms"===this.target?new Map([["switchToSynonymsPage",void 0],["errorDetails",this.getErrorDetailsHandler("ToolingHome")],["retry",this.getRetryHandler("ToolingHome",r,a)]]):new Map([["switchToPhrasingsPage",void 0],["errorDetails",this.getErrorDetailsHandler("ToolingHome")],["retry",this.getRetryHandler("ToolingHome",r,a)]])},k.ToolingSynonyms="Synonyms"===this.target?{showBanners:!0,banners:E,onDismissAllBanners:function(){return Se.signalCompletion()},actionHandlers:new Map([["errorDetails",this.getErrorDetailsHandler("ToolingSynonyms")],["retry",void 0]])}:Fe,k.ToolingPhrasings="Phrasings"===this.target?{showBanners:!0,banners:E,onDismissAllBanners:function(){return Se.signalCompletion()},actionHandlers:new Map([["errorDetails",this.getErrorDetailsHandler("ToolingPhrasings")],["retry",void 0]])}:Fe,k)),[2,this.getDeferredPromise()]}})})},n.getErrorBanners=function(t,o,r){var a=this,s=_.filter(t,function(p){return null!=p.agent}),l=_.filter(t,function(p){return null==p.agent}),g=new Map;_.forEach(s,function(p){if(g.has(p.code)){var f=g.get(p.code);f.agents.push(p.agent),g.set(p.code,f)}else g.set(p.code,{agents:[p.agent],originalError:p})});var c=[];return g.forEach(function(p){var E=a.generateErrorBanner(p.originalError,o,r,p.agents);c.push(E)}),_.forEach(l,function(p){var f=a.generateErrorBanner(p,o,r);c.push(f)}),c},n.generateErrorBanner=function(t,o,r,a){void 0===a&&(a=[]);var s=this.getErrorConfig(t.code,o,r,a),l=s.text,g=s.bannerType,c=s.actions;return{id:Me.b$.generateGuid(),message:{text:l},isVisible:!0,allowDismiss:!0,bannerType:g,data:t,actions:c}},n.prototype.getSuccessBanners=function(t,o){var r,l,a=t.getAgents("Synonyms"===this.target?"externalSynonyms":"oaiPhrasings"),s=_.chain(a).filter(function(f){return null!=f.lastModified}).map(function(f){return f.name}).value();l="Synonyms"===this.target?Po(_.includes(s,"PowerBI.AzureOpenAISynonyms")&&_.includes(o,"PowerBI.AzureOpenAISynonyms"),_.includes(s,"PowerBI.OrganizationLsdlSharing")&&_.includes(o,"PowerBI.OrganizationLsdlSharing"),this.localizationService):xo(this.localizationService);var p=this.localizationService.get("Synonyms"===this.target?"Qna_ImproveLsdl_Synonyms_Review":"Qna_ImproveLsdl_Phrasings_Review");return(r={}).Visual=[{id:Me.b$.generateGuid(),message:l,link:{href:On,text:this.localizationService.get("CopilotInline_PreviewLink")},isVisible:!0,allowDismiss:!0,bannerType:"copilot",actions:[{id:"launchTooling",text:p,actionAppearance:"primary"}]}],r.ToolingHome=[{id:Me.b$.generateGuid(),message:l,link:{href:On,text:this.localizationService.get("CopilotInline_PreviewLink")},isVisible:!0,allowDismiss:!0,bannerType:"copilot",actions:[{id:"Synonyms"===this.target?"switchToSynonymsPage":"switchToPhrasingsPage",text:p,actionAppearance:"primary"}]}],r.ToolingSynonyms=[],r.ToolingPhrasings=[],r},n.getErrorConfig=function(t,o,r,a){var s;void 0===a&&(a=[]);var l,f,g=n.getErrorMessageConfig(t,o,r);if("copilotAndOrg"===g.possibleSources){C.fF.assert(function(){return"Synonyms"===r},"target can only be synonyms when the sources are copilot and org");var c=_.includes(a,"PowerBI.AzureOpenAISynonyms"),p=_.includes(a,"PowerBI.OrganizationLsdlSharing");l=c&&p?g.copilotAndOrg:c?g.copilot:g.org}else"copilotOnly"===g.possibleSources?l=g.copilot:"orgOnly"===g.possibleSources?(C.fF.assert(function(){return"Synonyms"===r},"target can only be synonyms when the source is org"),l=g.org):"agnostic"===g.possibleSources?l=g.agnostic:C.fF.assertFail("possibleSources not handled");switch(t){case"NoLsdlIndexAvailable":case"NoLsdlSharingModelsAvailable":f="info";break;case"RequestThrottled":case"RequestTimeOut":f="blocked";break;case"UnsafeContentDetectedInRequest":case"UnsafeContentDetectedInResponse":case"PartiallySuccessful":f="warning";break;case"FeatureNotAvailable":f="info";break;case"FailedToOpenLsdlIndexSearcher":f="info";case"UnsupportedLanguage":C.fF.assertFail("Unexpected improve lsdl error ".concat("UnsupportedLanguage"));default:f="error"}return{text:o.get(l),bannerType:f,actions:null!==(s=g.availableActions)&&void 0!==s?s:[]}},n.getErrorMessageConfig=function(t,o,r){var a={id:"retry",text:o.get("IntermittentFailureRetryButton"),actionAppearance:"primary"},s={id:"errorDetails",text:o.get("View_Details"),actionAppearance:"secondary"},l="Synonyms"===r,c=l?{possibleSources:"copilotAndOrg",copilotAndOrg:"Qna_ImproveLsdl_Synonyms_Error_Generic_Copilot_Org",copilot:"Qna_ImproveLsdl_Synonyms_Error_Generic_Copilot",org:"Qna_ImproveLsdl_Synonyms_Error_Generic_Org",availableActions:[s]}:"Phrasings"===r?{possibleSources:"copilotOnly",copilot:"Qna_ImproveLsdl_Phrasings_Error_Generic_Copilot",availableActions:[s]}:{possibleSources:"copilotOnly",copilot:"Qna_FuzzyMatching_PickWorkspace_Error_Generic",availableActions:[s]};switch(t){case"GenericError":case"FailedToParseLsdlFromRequest":case"FailedToParseLsdlFromRequest":case"UnsupportedLanguage":case"NoKnownAgentsRequested":case"GenericFailure":return c;case"NetworkConnectionIssue":return{possibleSources:"agnostic",agnostic:l?"Qna_ImproveLsdl_Error_NetworkIssue_Synonyms":"Qna_ImproveLsdl_Error_NetworkIssue_Phrasings",availableActions:[a]};case"NoLsdlIndexAvailable":return C.fF.assert(function(){return l},"NoLsdlIndexAvailable error code is only applicable to synonyms"),{possibleSources:"orgOnly",org:"Qna_ImproveLsdl_Error_NoLsdlIndexAvailable"};case"NoLsdlSharingModelsAvailable":return C.fF.assert(function(){return l},"NoLsdlSharingModelsAvailable error code is only applicable to synonyms"),{possibleSources:"orgOnly",org:"Qna_ImproveLsdl_Error_NoLsdlSharingModelsAvailable"};case"InvalidRequestVersion":case"RequiresNewerVersion":return{possibleSources:"agnostic",agnostic:"Qna_ImproveLsdl_Error_RequiresNewerVersion"};case"FailedToOpenLsdlIndexSearcher":return C.fF.assert(function(){return l},"FailedToOpenLsdlIndexSearcher error code is only applicable to synonyms"),{possibleSources:"orgOnly",org:"Qna_ImproveLsdl_Error_FailedToOpenLsdlIndexSearcher"};case"FeatureNotAvailable":case"FeatureNotAvailable":return{possibleSources:"copilotOnly",copilot:l?"Qna_ImproveLsdl_Error_Copilot_Tenant_Disabled_Synonyms":"Qna_ImproveLsdl_Error_Copilot_Tenant_Disabled_Phrasings"};case"UnsupportedUser":return{possibleSources:"copilotOnly",copilot:"CopilotCapability_NoEligibleWorkspace_Message"};case"PartiallySuccessful":return l?{possibleSources:"copilotAndOrg",copilotAndOrg:"Qna_ImproveLsdl_Error_PartialSuccess_Copilot_Org_Synonyms",copilot:"Qna_ImproveLsdl_Error_PartialSuccess_Copilot_Synonyms",org:"Qna_ImproveLsdl_Error_PartialSuccess_Org_Synonyms",availableActions:[a]}:{possibleSources:"copilotOnly",copilot:"Qna_ImproveLsdl_Error_PartialSuccess_Copilot_Phrasings",availableActions:[a]};case"UnsafeContentDetectedInRequest":case"UnsafeContentDetectedInResponse":return l?{possibleSources:"copilotAndOrg",copilotAndOrg:"Qna_ImproveLsdl_Error_PartialSuccess_Copilot_Org_Synonyms",copilot:"Qna_ImproveLsdl_Error_PartialSuccess_Copilot_Synonyms",org:"Qna_ImproveLsdl_Error_PartialSuccess_Org_Synonyms",availableActions:[a]}:{possibleSources:"copilotOnly",copilot:"Qna_ImproveLsdl_Error_Unsafe_Content_Copilot",availableActions:[s]};case"RequestThrottled":return l?{possibleSources:"copilotAndOrg",copilotAndOrg:"Qna_ImproveLsdl_Error_Throttle_Copilot_Org_Synonyms",copilot:"Qna_ImproveLsdl_Error_Throttle_Copilot_Synonyms",org:"Qna_ImproveLsdl_Error_Throttle_Org_Synonyms",availableActions:[a]}:{possibleSources:"copilotOnly",copilot:"Qna_ImproveLsdl_Error_Throttle_Copilot_Phrasings",availableActions:[a]};case"RequestTimeOut":return l?{possibleSources:"copilotAndOrg",copilotAndOrg:"Qna_ImproveLsdl_Error_Timeout_Copilot_Org_Synonyms",copilot:"Qna_ImproveLsdl_Error_Timeout_Copilot_Synonyms",org:"Qna_ImproveLsdl_Error_Timeout_Org_Synonyms",availableActions:[a]}:{possibleSources:"copilotOnly",copilot:"Qna_ImproveLsdl_Error_Timeout_Copilot_Phrasings",availableActions:[a]};case"DisallowedForCrossGeo":return{possibleSources:"copilotOnly",copilot:l?"Qna_ImproveLsdl_Error_Copilot_CrossGeo_Disallowed_Synonyms":"Qna_ImproveLsdl_Error_Copilot_CrossGeo_Disallowed_Phrasings"};default:return C.fF.assertFail("unhandled improveLsdlErrorCode ".concat(t)),c}},n.prototype.getRetryHandler=function(t,o,r){var a=this;return function(){return(0,b.__awaiter)(a,void 0,void 0,function(){return(0,b.__generator)(this,function(s){switch(s.label){case 0:return this.underExecution?[2]:(this.underExecution=!0,this.improveLsdlBackgroundTelemetry.logResultEvent({surface:t,type:this.target,action:"Retry",resultType:"Failure"}),[4,this.improveLsdlExecutionHandler.execute({requestedAgents:o,copilotWorkspaceId:r})]);case 1:return s.sent(),this.underExecution=!1,[2]}})})}},n.prototype.getErrorDetailsHandler=function(t){var o=this;return function(r){C.fF.assertValue(r,"improve lsdl error"),o.improveLsdlBackgroundTelemetry.logResultEvent({surface:t,type:o.target,action:"ShowErrorDetails",resultType:"Failure"}),o.dialogService.showTemplateDialog("QnaDiagnosticDialogComponentId",{title:o.localizationService.get("Qna_Explore_ErrorMessage"),hideCancelButton:!0,input:{errorCode:r.code,errorMessage:r.diagnosticMessage}})}},n}(Et),ya=function(i){function n(t,o,r,a,s){var l=i.call(this,s)||this;return l.copilotRequirementsService=t,l.localizationService=o,l.modelAuthoringService=r,l.qnaBannerService=a,l}return(0,b.__extends)(n,i),n.prototype.execute=function(t){return(0,b.__awaiter)(this,void 0,void 0,function(){var o,a,s=this;return(0,b.__generator)(this,function(l){return o="pickWorkspace",this.qnaBannerService.setContent(((a={}).Visual={showBanners:!0,banners:[{id:Me.b$.generateGuid(),message:{text:s.localizationService.get("Qna_Enhance_WithCopilot_FromSelectWorkspace_Disclaminer"),emphasis:s.localizationService.get("Qna_Enhance_WithCopilot")},link:{href:"https://go.microsoft.com/fwlink/?linkid=2258254",text:s.localizationService.get("LearnMore")},isVisible:!0,allowDismiss:!0,bannerType:"copilot",actions:[{id:o,text:s.localizationService.get("WorkspacesSelect_Label_Text"),actionAppearance:"primary"}]}],onDismissAllBanners:function(){return s.signalCompletion()},actionHandlers:new Map([[o,s.pickWorkspace(t)]])},a.ToolingHome=Fe,a.ToolingSynonyms=Fe,a.ToolingPhrasings=Fe,a)),[2,this.getDeferredPromise()]})})},n.prototype.pickWorkspace=function(t){var o=this;return function(){return(0,b.__awaiter)(o,void 0,void 0,function(){var r,a,s,l,c,p;return(0,b.__generator)(this,function(f){switch(f.label){case 0:return[4,this.copilotRequirementsService.validateRequirements({showLoadingDialog:!1})];case 1:if(!(r=f.sent()).copilotStatus.enabled||_.isEmpty(r.copilotRequirements.workspaceId))return[3,6];if(a=JSON.parse(JSON.stringify(t)),(s=new an.X(a)).setRuntimeUnderstanding("Full"),!s.commit())return[3,5];f.label=2;case 2:return f.trys.push([2,4,,5]),[4,this.modelAuthoringService.apply({changes:[{updateLinguisticMetadata:{linguisticSchemaJson:s.toJsonString()}}]})];case 3:return f.sent(),[3,5];case 4:return l=f.sent(),C.fF.assertFail(l),[3,5];case 5:return this.qnaBannerService.setContent(((p={}).Visual=Fe,p.ToolingHome=Fe,p.ToolingSynonyms=Fe,p.ToolingPhrasings=Fe,p)),this.signalCompletion(),[3,7];case 6:if(r.copilotStatus.reason===sn.Hm.NoWorkspaceId)return[2];c=Tn.getErrorBanners([{category:"powerbi",code:"UnsupportedUser"}],this.localizationService,"fuzzyMatchWorkspace"),this.qnaBannerService.updateContent("Visual",{showBanners:!0,banners:c}),f.label=7;case 7:return[2]}})})}},n}(Et),Sa=function(i){function n(t,o,r,a,s,l,g,c,p){var f=i.call(this,p)||this;return f.qnaProxyPath=t,f.conceptualSchemaProxy=o,f.copilotCapabilityService=r,f.dataModelService=a,f.dataSourcesService=s,f.explorationCapabilitiesService=l,f.featureSwitchService=g,f.qnaSupportabilityService=c,f}return(0,b.__extends)(n,i),n.prototype.execute=function(){var t,o;return(0,b.__awaiter)(this,void 0,void 0,function(){var r,s,l,c,f,y,E,D;return(0,b.__generator)(this,function(k){switch(k.label){case 0:return"@powerbi/Qna/qnadesktop.module#QnaDesktopModule"!==this.qnaProxyPath?(this.signalCompletion(),[2,this.getDeferredPromise()]):[4,this.featureSwitchService.getFeatureSwitches()];case 1:return r=k.sent(),(0,wt.J8)(r)?[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]:(this.signalCompletion(),[2,this.getDeferredPromise()]);case 2:return s=k.sent(),l=this.explorationCapabilitiesService.getCapabilities(),(0,ho.H)(l,s,this.qnaSupportabilityService).isAllowed&&this.qnaSupportabilityService.allowsLinguisticSchemaEdit()?[4,this.copilotCapabilityService.getCopilotEnablementStatus()]:(this.signalCompletion(),[2,this.getDeferredPromise()]);case 3:return c=k.sent(),f=_.includes([sn.Hm.NoWorkspaceId,sn.Hm.WorkspaceNotFound,sn.Hm.UserNotSignedIn],c.copilotStatus.reason),[4,this.dataModelService.getLinguisticSchema()];case 4:return y=k.sent(),E=null===(t=y.DynamicImprovement)||void 0===t?void 0:t.RuntimeUnderstanding,D=null==E||"Default"===E||"Full"===E,f&&D?[2,null===(o=this.next)||void 0===o?void 0:o.execute(y)]:[2]}})})},n}(Et),Pa=u(40682),bo=function(){function i(n,t){this.certifiedEventsService=n,this.telemetryService=t,this.featureName="Qna - Improve LSDL Feature"}return i.prototype.logSigninEvent=function(n){this.telemetryService.logEvent(dn,n),this.logCertifiedEvent(Ct,(0,b.__assign)({},n))},i.prototype.logPromptEvent=function(n){this.telemetryService.logEvent(gn,n),this.logCertifiedEvent(pn,(0,b.__assign)({},n))},i.prototype.logResultEvent=function(n){this.telemetryService.logEvent(ft,n),this.logCertifiedEvent(Ye,(0,b.__assign)({},n))},i.prototype.logCertifiedEvent=function(n,t){this.certifiedEventsService.logStandardizedFeatureEvent({correlationId:this.telemetryService.root.id,activityName:n,activityAttributes:t,resultCode:"",featureName:this.featureName,activityStatus:"Succeeded"},{normalizeHierarchicalSeparators:!0})},i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(Pa.l),e.\u0275\u0275inject(ue.y0))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i}(),Mo=function(i){function n(t,o,r,a,s,l){var g=i.call(this,l)||this;return g.improveLsdlService=t,g.dataModelService=o,g.localizationService=r,g.qnaBannerService=a,g.target=s,g}return(0,b.__extends)(n,i),n.prototype.execute=function(t){var o=t.requestedAgents,r=t.copilotWorkspaceId;return(0,b.__awaiter)(this,void 0,void 0,function(){var a,s,l;return(0,b.__generator)(this,function(g){switch(g.label){case 0:return _.isEmpty(o)?(C.fF.assertFail("requestable agents should be defined and non empty"),this.signalCompletion(),[2,this.getDeferredPromise()]):(0,wt.J_)(o)&&_.isEmpty(r)?(C.fF.assertFail("copilotWorkspaceId should be defined for copilot agents"),this.signalCompletion(),[2,this.getDeferredPromise()]):[4,this.dataModelService.getLinguisticSchema()];case 1:return a=g.sent(),s=new an.X(a),this.setLoadingBanner(o),[4,this.improveLsdlService.improveLinguisticSchema({requestedAgents:o,requestPriority:"Background",lsdlJson:s.toJsonString(),copilotWorkspaceId:r})];case 2:return l=g.sent(),[4,this.next.execute({response:l,requestedAgents:o})];case 3:return g.sent(),[2,this.getDeferredPromise()]}})})},n.prototype.setLoadingBanner=function(t){var o,r=this,a=So(t,this.localizationService,this.target),s=function(Se,ke){r.improveLsdlService.cancelImproveLinguisticSchema(),r.qnaBannerService.dismissBanner(ke,Se)},l=this.localizationService.get("Synonyms"===this.target?"Qna_ImproveLsdl_Loading_Synonyms":"Qna_ImproveLsdl_Loading_Relationships"),g=this.localizationService.get("PBI_Button_Label_Cancel"),c=(0,wt.J_)(t)?"copilot":"info",p=Me.b$.generateGuid(),f=Me.b$.generateGuid(),y=Me.b$.generateGuid(),D={showBanners:!0,banners:[{id:y,message:a,isVisible:!0,allowDismiss:!1,bannerType:c,actions:[{id:"noop",text:l,actionAppearance:"loading"},{id:"cancelImproveLsdl",text:g,actionAppearance:"secondary"}]}],actionHandlers:new Map([["noop",void 0],["cancelImproveLsdl","Synonyms"===this.target?function(){return s(y,"ToolingSynonyms")}:function(){return s(y,"ToolingPhrasings")}]])};this.qnaBannerService.setContent(((o={}).Visual={showBanners:!0,banners:[{id:p,message:a,link:{href:On,text:this.localizationService.get("CopilotInline_PreviewLink")},isVisible:!0,allowDismiss:!0,bannerType:c,actions:[{id:"noop",text:l,actionAppearance:"loading"},{id:"cancelImproveLsdl",text:g,actionAppearance:"secondary"}]}],actionHandlers:new Map([["noop",void 0],["cancelImproveLsdl",function(){return s(p,"Visual")}]])},o.ToolingHome={showBanners:!0,banners:[{id:f,message:a,isVisible:!0,allowDismiss:!0,bannerType:c,actions:[{id:"noop",text:l,actionAppearance:"loading"},{id:"cancelImproveLsdl",text:g,actionAppearance:"secondary"}]}],actionHandlers:new Map([["noop",void 0],["cancelImproveLsdl",function(){return s(f,"ToolingHome")}]])},o.ToolingSynonyms="Synonyms"===this.target?D:Fe,o.ToolingPhrasings="Phrasings"===this.target?D:Fe,o))},n}(Et),wo=function(i){function n(t,o,r,a,s,l){var g=i.call(this,l)||this;return g.qnaBannerService=t,g.localizationService=o,g.improveLsdlBackgroundTelemetry=r,g.copilotRequirementsService=a,g.target=s,g.underExecution=!1,g}return(0,b.__extends)(n,i),n.prototype.execute=function(t){return(0,b.__awaiter)(this,void 0,void 0,function(){var o,r,a,s=this;return(0,b.__generator)(this,function(l){return C.fF.assertNonEmpty(t,"requestableAgents"),o="Synonyms"===this.target?"generateSynonyms":"generatePhrasings",this.qnaBannerService.setContent(((a={}).Visual=(r=function(c){return{showBanners:!0,banners:[{id:Me.b$.generateGuid(),message:So(t,s.localizationService,s.target),link:{href:On,text:s.localizationService.get("CopilotInline_PreviewLink")},isVisible:!0,allowDismiss:!0,bannerType:(0,wt.J_)(t)?"copilot":"info",actions:[{id:o,text:s.localizationService.get("Synonyms"===s.target?"Add_Synonyms":"Add_Relationships"),actionAppearance:"primary"}]}],actionHandlers:new Map([[o,s.getGenerationHandler(t,s.target,c)]])}})("Visual"),a.ToolingHome=r("ToolingHome"),a.ToolingSynonyms="Synonyms"===this.target?r("ToolingSynonyms"):Fe,a.ToolingPhrasings="Phrasings"===this.target?r("ToolingPhrasings"):Fe,a)),[2,this.getDeferredPromise()]})})},n.prototype.getGenerationHandler=function(t,o,r){var a=this;return function(){return(0,b.__awaiter)(a,void 0,void 0,function(){var s,l,c;return(0,b.__generator)(this,function(p){switch(p.label){case 0:return this.underExecution?[2]:(this.underExecution=!0,this.improveLsdlBackgroundTelemetry.logPromptEvent({surface:r,type:o}),(0,wt.J_)(t)?[3,2]:[4,this.next.execute({requestedAgents:t})]);case 1:return p.sent(),this.underExecution=!1,[2];case 2:return[4,this.copilotRequirementsService.validateRequirements({showLoadingDialog:!1})];case 3:return(s=p.sent()).copilotStatus.enabled&&!_.isEmpty(s.copilotRequirements.workspaceId)?[4,this.next.execute({requestedAgents:t,copilotWorkspaceId:s.copilotRequirements.workspaceId})]:[3,5];case 4:return p.sent(),this.underExecution=!1,[2];case 5:if(s.copilotStatus.reason===sn.Hm.NoWorkspaceId)return this.underExecution=!1,[2];p.label=6;case 6:return l=_.filter(t,function(f){return"PowerBI.AzureOpenAISynonyms"!==f&&"PowerBI.AzureOpenAIPhrasings"!==f}),_.isEmpty(l)?[3,8]:[4,this.next.execute({requestedAgents:l})];case 7:return p.sent(),this.underExecution=!1,[2];case 8:return c=Tn.getErrorBanners([{category:"powerbi",code:s.copilotStatus.reason===sn.Hm.DisabledForCrossGeo?"DisallowedForCrossGeo":"UnsupportedUser",agent:"Synonyms"===o?"PowerBI.AzureOpenAISynonyms":"PowerBI.AzureOpenAIPhrasings"}],this.localizationService,o),this.qnaBannerService.updateContent(r,{showBanners:!0,banners:c}),this.underExecution=!1,[2]}})})}},n}(Et),Ia={provide:"improveLsdlBackgroundService",useFactory:function(i,n,t,o,r,a,s,l,g,c,p,f,y,E,D,k,Se){return(0,b.__awaiter)(this,void 0,void 0,function(){var ke;return(0,b.__generator)(this,function(qe){switch(qe.label){case 0:return[4,o.get(g||"@powerbi/Qna/qnadesktop.module#QnaDesktopModule","qnaSupportabilityService")];case 1:return ke=qe.sent(),C.fF.assertValue(ke,"qna supportability service should be provided"),[2,new ba(i,n,t,r,a,s,l,ke,c,p,f,y,g,E,D,k,Se)]}})})},deps:[Ce.i,He.D,ao.H,it.E,bt.o,fo.U,Re.z,et.vZ,Ft.n,pa.x,bo,ca.g,Hn.I_,ua.F,oo,da.n,Ca.S,Hn.Dt,Hn.vb]},ba=function(){function i(n,t,o,r,a,s,l,g,c,p,f,y,E,D,k,Se,ke){var qe=this;this.conceptualSchemaProxy=n,this.dataSourcesService=t,this.lazyScoped=o,this.localizationService=r,this.explorationCapabilities=a,this.explorationNavigation=s,this.featureSwitchService=l,this.qnaSupportabilityService=g,this.dialogService=c,this.improveLsdlBackgroundTelemetry=p,this.copilotRequirementsService=f,this.copilotCapabilityService=y,this.qnaProxyPath=E,this.accountService=D,this.qnaToolingDialogLauncher=k,this.dataModelService=Se,this.modelAuthoringService=ke,this.manualImproveLsdlTriggered$=new Xe.xQ,this.improveLsdlBackground$=(0,Ve.T)(this.qnaSupportabilityService.qnaSettingsChanged$.asObservable(),this.manualImproveLsdlTriggered$.asObservable()).pipe((0,me.w)(function(){return qe.tryImproveLsdlCore()}))}return i.prototype.tryImproveLsdl=function(n){return(0,b.__awaiter)(this,void 0,void 0,function(){return(0,b.__generator)(this,function(o){switch(o.label){case 0:return[4,this.featureSwitchService.getFeatureSwitches()];case 1:return o.sent().qnaImproveLsdlCopilot&&null==this.improveLsdlBackgroundSub?(this.improveLsdlBackgroundSub=this.improveLsdlBackground$.subscribe(),this.manualImproveLsdlTriggered$.next(n),[2]):[2]}})})},i.prototype.ngOnDestroy=function(){var n;null===(n=this.improveLsdlBackgroundSub)||void 0===n||n.unsubscribe()},i.prototype.tryImproveLsdlCore=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,o,r;return(0,b.__generator)(this,function(a){switch(a.label){case 0:return[4,this.ensureLazyScopedServices()];case 1:return a.sent(),n=new Gn.B,this.constructSynonymsBannerTree(n),[4,this.improveSynonymsBannerTree.execute()];case 2:return a.sent(),o=new Gn.B,this.constructPhrasingsBannerTree(o),[4,this.improvePhrasingsBannerTree.execute()];case 3:return a.sent(),r=new Gn.B,this.constructWorkspacePickerBannerTree(r),[2,this.workspacePickerBannerTree.execute()]}})})},i.prototype.constructSynonymsBannerTree=function(n){this.improveSynonymsBannerTree=new ha(this.conceptualSchemaProxy,this.dataModelService,this.dataSourcesService,this.explorationCapabilities,this.qnaSupportabilityService,n);var t=new Io(this.accountService,this.dataSourcesService,this.explorationNavigation,this.qnaBannerService,this.qnaToolingDialogLauncher,this.localizationService,this.improveLsdlBackgroundTelemetry,"Synonyms",n),o=new wo(this.qnaBannerService,this.localizationService,this.improveLsdlBackgroundTelemetry,this.copilotRequirementsService,"Synonyms",n),r=new Mo(this.improveLsdlService,this.dataModelService,this.localizationService,this.qnaBannerService,"Synonyms",n),a=new Tn(this.dataModelService,this.dataSourcesService,this.explorationNavigation,this.featureSwitchService,this.qnaBannerService,this.qnaToolingDialogLauncher,this.modelAuthoringService,this.localizationService,this.dialogService,r,this.improveLsdlBackgroundTelemetry,"Synonyms",n);this.improveSynonymsBannerTree.next=t,t.next=o,o.next=r,r.next=a},i.prototype.constructPhrasingsBannerTree=function(n){this.improvePhrasingsBannerTree=new ga(this.featureSwitchService,this.conceptualSchemaProxy,this.dataModelService,this.dataSourcesService,this.explorationCapabilities,this.qnaSupportabilityService,n);var t=new Io(this.accountService,this.dataSourcesService,this.explorationNavigation,this.qnaBannerService,this.qnaToolingDialogLauncher,this.localizationService,this.improveLsdlBackgroundTelemetry,"Phrasings",n),o=new wo(this.qnaBannerService,this.localizationService,this.improveLsdlBackgroundTelemetry,this.copilotRequirementsService,"Phrasings",n),r=new Mo(this.improveLsdlService,this.dataModelService,this.localizationService,this.qnaBannerService,"Phrasings",n),a=new Tn(this.dataModelService,this.dataSourcesService,this.explorationNavigation,this.featureSwitchService,this.qnaBannerService,this.qnaToolingDialogLauncher,this.modelAuthoringService,this.localizationService,this.dialogService,r,this.improveLsdlBackgroundTelemetry,"Phrasings",n);this.improvePhrasingsBannerTree.next=t,t.next=o,o.next=r,r.next=a},i.prototype.constructWorkspacePickerBannerTree=function(n){this.workspacePickerBannerTree=new Sa(this.qnaProxyPath,this.conceptualSchemaProxy,this.copilotCapabilityService,this.dataModelService,this.dataSourcesService,this.explorationCapabilities,this.featureSwitchService,this.qnaSupportabilityService,n);var t=new ya(this.copilotRequirementsService,this.localizationService,this.modelAuthoringService,this.qnaBannerService,n);this.workspacePickerBannerTree.next=t},i.prototype.ensureLazyScopedServices=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,t;return(0,b.__generator)(this,function(o){switch(o.label){case 0:return this.qnaBannerService?[3,2]:(n=this,[4,this.lazyScoped.get("qnaBannerService")]);case 1:n.qnaBannerService=o.sent(),C.fF.assertValue(this.qnaBannerService,"qna banner service should be provided"),o.label=2;case 2:return this.improveLsdlService?[3,4]:(t=this,[4,this.lazyScoped.get("improveLsdlService")]);case 3:t.improveLsdlService=o.sent(),C.fF.assertValue(this.improveLsdlService,"improve lsdl service should be provided"),o.label=4;case 4:return[2]}})})},i.\u0275fac=function(t){e.\u0275\u0275invalidFactory()},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i}(),Ma=[{type:Co,componentId:"QnaVisualHostComponentId"},{type:we,componentId:"QnaAutocompleteComponentId"},{type:bn,componentId:"QnaInputV2ComponentId"},{type:zn,componentId:"QnaFeedbackComponentId"},{type:qn,componentId:"QnaBannerComponentId"}],wa=function(){function i(){}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[Ia,ma,bo],imports:[P.N.withManifests(Ma),K.c.withManifest([{componentIdentifier:"QnaDiagnosticDialogComponentId",componentType:yo}]),m.CommonModule,W._t,Pe.v,We.g,he.gd,Be.eL,H.J,dt.c,z.A3,A.O,ue.e3,J._,Oe.T,ce.Z,$e.I]}),i}()},1931:function(rt,be,u){u.d(be,{T:function(){return $e}});var m=u(77476),A=u(52910),K=u(13052),W=u(31109),H=u(22346),z=u(76521),P=u(40516),Pe=u(84497),J=u(79061),he=u(4633),ce=u(90938),Be=u(47231),Oe=u(50423),$e=function(){function We(){}return We.\u0275fac=function(b){return new(b||We)},We.\u0275mod=Oe.\u0275\u0275defineNgModule({type:We}),We.\u0275inj=Oe.\u0275\u0275defineInjector({imports:[m.CommonModule,A.O,K.T,W.F,H.J,z.A3,P.h,Pe.L,J.v,he.e3,ce.g,Be.c]}),We}()},37320:function(rt,be,u){u.d(be,{y:function(){return q}});var m=u(81337),A=u(35510),K=u(74804),W=u(62458),H=u(58291),z=u(57871),P=u(42614),Pe=u(3579),J=u(38953),he=u(54834),ce=u(35988),Be=u(74857),Oe=u(50423),ue=u(26898),$e=u(83008),We=u(8586),dt=u(21436),b=u(28894),de=u(84916),oe=u(29866),q=function(){function L(M,w,F,B,G,N,X){this.conceptualSchemaProxy=M,this.dataSources=w,this.explorationSerializer=F,this.lazyScoped=B,this.podExplorationResolver=G,this.resourcePackage=N,this.visualPlugin=X}return L.prototype.createInterpretListener=function(M,w){return void 0===w&&(w=500),new C(this.conceptualSchemaProxy,this.dataSources,this.explorationSerializer,this.lazyScoped,this.podExplorationResolver,this.resourcePackage,this.visualPlugin,M,w)},L.\u0275fac=function(w){return new(w||L)(Oe.\u0275\u0275inject(ue.i),Oe.\u0275\u0275inject($e.D),Oe.\u0275\u0275inject(We.L),Oe.\u0275\u0275inject(b.H),Oe.\u0275\u0275inject(dt.Bl),Oe.\u0275\u0275inject(de.o),Oe.\u0275\u0275inject(oe.D))},L.\u0275prov=Oe.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac}),L}(),C=function(){function L(M,w,F,B,G,N,X,ie,ne){this.conceptualSchemaProxy=M,this.dataSources=w,this.explorationSerializer=F,this.lazyScoped=B,this.podExplorationResolver=G,this.resourcePackage=N,this.visualPlugin=X,this.setupParams=ie,this.timeout=ne,W.fF.assertValue(ie,"setupParams"),this.updateManager=new le(this.timeout),this.setupParams=ie}return L.prototype.getObservable=function(){return this.updateManager.getObservable()},L.prototype.onInterpretIssued=function(){this.cancelErrorThrottler(),this.updateManager.pushUpdate({resultType:0})},L.prototype.onInterpretRetry=function(M){this.updateManager.pushUpdate({resultType:1,retryWarning:M})},L.prototype.onInterpretResultCleared=function(){this.cancelErrorThrottler(),this.updateManager.pushUpdate({resultType:4,utterance:""})},L.prototype.onInterpretResult=function(M,w){var F;return(0,m.__awaiter)(this,void 0,void 0,function(){var B,G;return(0,m.__generator)(this,function(N){return B=!!w.error||!this.setupParams.forTrainingTermBinding&&_.isEmpty(w.results)||this.setupParams.forTrainingTermBinding&&_.every(w.results,function(X){return!X.command})&&!function(L){return!L||!!_.find(L,function(M){return 2===M||8===M||11===M||12===M||9===M||10===M||24===M})}(w.warnings),B?(G=_.first(w.results),this.onInterpretErrorV2(w.utterance,M,w.error,G?.spans,null===(F=G?.correctionInfo)||void 0===F?void 0:F.correctedUtterance),[2]):[2,this.onInterpretSuccessV2(w,M)]})})},L.prototype.onInterpretSuccessV2=function(M,w){var F,B;return(0,m.__awaiter)(this,void 0,void 0,function(){var G,N;return(0,m.__generator)(this,function(ie){switch(ie.label){case 0:return W.fF.assertValue(M,"interpretResponse"),this.cancelErrorThrottler(),null!==(F=w?.intent)&&void 0!==F&&F.defineCalculation?[4,this.handleCalculationResult(M,w)]:[3,2];case 1:return ie.sent(),[3,6];case 2:return G=_.first(M.results),(N=null===(B=G?.command)||void 0===B?void 0:B.query)&&_.find(N.from().sources(),function(ne){return(0,J.Yg)(ne)})?[4,this.handlePodPageResult(M,w)]:[3,4];case 3:return ie.sent(),[3,6];case 4:return[4,this.handleVisualResult(M,w)];case 5:ie.sent(),ie.label=6;case 6:return[2]}})})},L.prototype.onInterpretErrorV2=function(M,w,F,B,G){var N=this;W.fF.assertValue(M,"utterance"),this.cancelErrorThrottler();var X=this.setupParams.forTrainingTermBinding?{spans:B,correctedUtterance:G}:void 0;this.errorThrottler=setTimeout(function(){N.updateManager.pushThrottledUpdate({request:w,resultType:3,interpretError:F,utterance:M,termBindingsTrainingInfo:X,doNotShowResult:!0}),N.errorThrottler=void 0},this.timeout)},L.prototype.cancelErrorThrottler=function(){this.errorThrottler&&clearTimeout(this.errorThrottler),this.errorThrottler=void 0},L.prototype.handlePodPageResult=function(M,w){return(0,m.__awaiter)(this,void 0,void 0,function(){var F,B,G,N,X,ie,ne,me,ze,Ne,Y,Te,xe,Ue,Ae,De,Ve,pt,gt,xt;return(0,m.__generator)(this,function(tt){switch(tt.label){case 0:if(F=_.first(M?.results),W.fF.assertValue(F,"query interpretResult must be defined for handling pod result"),B=M.utterance,G=e(F),this.setupParams.forTrainingTermBinding)return this.updateManager.pushThrottledUpdate({request:w,resultType:2,utterance:B,termBindingsTrainingInfo:G,doNotShowResult:!1}),[2];if(!this.setupParams.canShowPods)return this.updateManager.pushThrottledUpdate({request:w,resultType:5,utterance:B}),[2];N=F?.command,X=N?.query,W.fF.assertValue(X,"interpretResult command must have a defined query for handling pod result"),ie=_.find(X.from().sources(),function(je){return(0,J.Yg)(je)}),W.fF.assertValue(ie,"expect there is a pod entity"),ne=this.podExplorationResolver.getReportId(ie.schema),tt.label=1;case 1:return tt.trys.push([1,3,,4]),Ne=(ze=this.explorationSerializer).deepCopyExploration,[4,this.podExplorationResolver.getExploration(ne)];case 2:return me=Ne.apply(ze,[tt.sent()]),Y=_.find(me.pods,function(je){return je.name===ie.pod}),Te=Y&&Y.boundSection,xe=_.find(me.sections,function(je){return Te===je.name}),Y&&Te&&xe?(P.l.mergeExplorationSectionFilters(me,xe),Ue=(0,Be.Nj)(N?.queryMetadata),Ae=he.ib.serializeQuery(X),_.isEmpty(Ae.Where)||(De=P.l.extractParameterFilters(Ae,Ue),P.l.applySectionParameterFilters(xe,Y,void 0,De)),Ve=_.filter(me.resourcePackages,function(je){return _.some(xe.visualContainers,function(Tt){return(0,Pe.s)(Tt)===je.name})}),_.isEmpty(Ve)||(this.resourcePackage.registerPackages(Ve),this.visualPlugin.ensurePlugins(Ve)),xe.size.displayOption=1,me.activeSectionIndex=_.findIndex(me.sections,function(je){return je.name===xe.name}),pt=this.getModelFromResult(F),this.ensureDataSources(pt,me),gt=pt.id,xt=this.getNotShowLowConfidenceResult(F),this.updateManager.pushThrottledUpdate({request:w,resultType:2,modelId:gt,utterance:B,exploration:me,restatement:F.restatement,doNotShowResult:xt,usedAgents:F?.usedAgents}),[3,4]):(this.updateManager.pushThrottledUpdate({request:w,resultType:6,utterance:B}),[2]);case 3:return tt.sent(),this.updateManager.pushThrottledUpdate({request:w,resultType:6,utterance:B}),[3,4];case 4:return[2]}})})},L.prototype.handleVisualResult=function(M,w){return(0,m.__awaiter)(this,void 0,void 0,function(){var F,B,G,N,X,ie,ne,me,Y,Te,xe;return(0,m.__generator)(this,function(Ae){switch(Ae.label){case 0:if(W.fF.assertValue(M,"interpretResponse"),F=M.utterance,B=_.first(M?.results),!this.setupParams.canShowVisuals)return this.updateManager.pushThrottledUpdate(this.setupParams.forTrainingTermBinding?{request:w,resultType:2,utterance:F,termBindingsTrainingInfo:e(B),doNotShowResult:!1}:{request:w,resultType:5,utterance:F}),[2];G=this.setupParams.forTrainingTermBinding?e(B):void 0,Ae.label=1;case 1:return Ae.trys.push([1,4,,5]),N=(0,ce.vr)(M?.warnings),X=_.uniq(_.map(N,function(De){return De.messageKey})),ie=!_.isEmpty(N),ne=void 0,(me=B&&B.command)&&me.query?_.isEmpty(N)?(Y=this.getModelFromResult(B),this.ensureDataSources(Y,void 0),[4,this.lazyScoped.get("visualRecommendationService")]):(this.updateManager.pushThrottledUpdate({request:w,resultType:2,utterance:F,termBindingsTrainingInfo:G,doNotShowResult:!0,doNotShowResultCustomMessageKeys:X}),[2]):(this.updateManager.pushThrottledUpdate({request:w,resultType:this.setupParams.forTrainingTermBinding?2:3,utterance:F,termBindingsTrainingInfo:G,doNotShowResult:!this.setupParams.forTrainingTermBinding||ie,doNotShowResultCustomMessageKeys:ie?X:void 0}),[2]);case 2:return Te=Ae.sent(),[4,(0,Be.y_)(B,this.conceptualSchemaProxy,this.dataSources,Te)];case 3:return(ne=Ae.sent())?(xe=this.getNotShowLowConfidenceResult(B),this.updateManager.pushThrottledUpdate({request:w,resultType:2,modelId:Y.id,utterance:F,restatement:B&&B.restatement,termBindingsTrainingInfo:G,visualContainer:ne,doNotShowResult:xe,usedAgents:B?.usedAgents})):this.updateManager.pushThrottledUpdate({request:w,resultType:6,utterance:F,termBindingsTrainingInfo:G}),[3,5];case 4:return Ae.sent(),this.updateManager.pushThrottledUpdate({request:w,resultType:6,utterance:F,termBindingsTrainingInfo:G}),[3,5];case 5:return[2]}})})},L.prototype.handleCalculationResult=function(M,w){var F;return(0,m.__awaiter)(this,void 0,void 0,function(){var B,G,X,ie,ne;return(0,m.__generator)(this,function(me){for(B=M.utterance,this.setupParams.canShowCalculations||this.updateManager.pushThrottledUpdate({request:w,resultType:5,utterance:B}),G=[],X=0,ie=M.results;X<ie.length;X++)null!==(F=(ne=ie[X]).command)&&void 0!==F&&F.defineCalculation&&!this.getNotShowLowConfidenceResult(ne)&&G.push((0,m.__assign)((0,m.__assign)({},ne.command.defineCalculation),{restatement:ne.restatement}));return _.isEmpty(G)?this.updateManager.pushThrottledUpdate({request:w,resultType:3,utterance:B}):this.updateManager.pushThrottledUpdate({request:w,resultType:2,utterance:B,restatement:void 0,doNotShowResult:!1,calculations:G}),[2]})})},L.prototype.getNotShowLowConfidenceResult=function(M){if(!M?.command)return!0;var w=M.correctionInfo&&M.correctionInfo.state;return 0===w||1===w&&this.setupParams.canShowDidYouMean},L.prototype.getModelFromResult=function(M){var w=1===_.size(this.setupParams.models)?this.setupParams.models[0]:_.find(this.setupParams.models,function(F){return F.dbName===M.databaseName&&F.vsName===M.virtualServerName});return W.fF.assertValue(w,"There are multiple models for interpret, one of them should match the model that the interpret result is from"),w},L.prototype.ensureDataSources=function(M,w){if(M&&this.setupParams.resetDataSources){var F=(0,K.CD)(M),B=(0,K.yd)([F]);if(!_.isEmpty(w?.modelExtensions)){var G=z.eM,N=F.name;B.push({type:H.K,id:void 0,name:G,extends:N,exploration:{schemaName:G,extends:N,getModelExtensions:function(){return w.modelExtensions},getDataSourceVariables:function(){return w.dataSourceVariables}}})}this.dataSources.set(B)}},L}();function e(L){if(L){var M=L.command;return{spans:L.spans,correctedUtterance:L.correctionInfo&&L.correctionInfo.correctedUtterance,linguisticSchemaJson:M&&M.linguisticSchemaJson,linguisticSchemaItems:M&&M.linguisticSchemaItems,inferredTermMetadata:M&&M.inferredTermMetadata}}}var le=function(){function L(M){this.timeout=M,this.interpretResult$=new A.X(void 0)}return L.prototype.getObservable=function(){return this.interpretResult$.asObservable()},L.prototype.pushUpdate=function(M){this.throttler&&clearTimeout(this.throttler),this.throttler=void 0,this.throttledUpdate=void 0,this.interpretResult$.next(M),this.throttler=this.startThrottler()},L.prototype.pushThrottledUpdate=function(M){this.throttler?this.throttledUpdate=M:(this.interpretResult$.next(M),this.throttler=this.startThrottler())},L.prototype.startThrottler=function(){var M=this;return setTimeout(function(){M.throttledUpdate?(M.interpretResult$.next(M.throttledUpdate),M.throttledUpdate=void 0,M.throttler=M.startThrottler()):M.throttler=void 0},this.timeout)},L}()},72129:function(rt,be,u){function m(P){return"Suggestions"===P?.type}function A(P){return"Visual"===P?.type}function K(P){return"VisualAsExploration"===P?.type}function W(P){return"Pod"===P?.type}function H(P){return"Error"===P?.type}function z(P){return"QueryError"===P?.type}u.d(be,{Ew:function(){return m},fU:function(){return K},lP:function(){return W},mn:function(){return A},uT:function(){return H},wp:function(){return z}})},282:function(rt,be,u){u.d(be,{D:function(){return Dn}});var m=u(81337),A=u(50423),K=u(48787),W=u(92060),H=u(79154),z=u(94419),P=u(80981),Pe=u(90120),J=u(56578),he=u(1521),ce=u(61903),Be=u(18664),Oe=u(47245),ue=u(62458),$e=u(73058),We=u(2931),dt=u(50550),b=u(11077),de=u(32105),oe=u(35911),Xe=u(18503),q=u(82755),C=u(3579),e=u(60661),te=u(76045),le=u(43286),L=u(39681),M=u(16808),w=u(28579),F=u(14463),B=u(78778),G=new A.InjectionToken("QnaLiveConnectService"),N=u(65947),X=u(12123),ie=u(32640),ne=u(21728),me=u(80952),ze=u(4633),Ne=u(9410),Y=u(38078),Te=u(46135),xe=u(8590),Ue=u(80318),Ae=u(5894),De=u(72129),Ve=u(74857),pt=u(35988),gt=u(87974),xt=u(29866),It=u(18363),tt=u(26898),je=u(83008),Tt=u(48145),Gt=u(39503),$t=u(11494),Ft=u(77200),ln=u(27980),Me=u(58938),Wt=u(67660),un=u(69474),jt=u(8586),Kt=u(79006),Bt=u(72262),cn=u(906),Ke=u(84281),d=u(80277),v=u(9380),S=u(21548),O=u(76072),V=u(2330),se=u(40956),pe=u(58991),ge=u(65181),Qe=u(81213),vt=u(83309),nt=u(37320),at=u(20066),gn="qnaVisualContainer",Ye="inputBox",ft="suggestions",Cn="hiddenProperties",hn="background",_t="header",yn="cardBackground",ot="card",mt="question",Zt="restatement",yt="FontColor",Dt="FontSize",At="FontFamily",Jt="hoverColor",Xt="acceptedColor",bt="errorColor",Vt="warningColor",Yt="commitButtonBackgroundColor",Qt="Bold",kt="Italic",Lt="Underline",ae={withBorder:!0,showSuggestions:!0,acceptedColor:"#0078D4",errorColor:"#FF0000",warningColor:"#0078D4",borderColor:"#A19F9D",fontColor:"#323130",darkFontColor:"#252423",lightFontColor:"#FFFFFF",inputBoxBackgroundColor:"#FFFFFF",suggestionBackgroundColor:"#F3F2F1",hoverColor:"#EEEEEE",semiboldFont:"'Segoe UI Semibold', wf_segoe-ui_semibold, helvetica, arial, sans-serif",regularFont:"'Segoe UI', wf_segoe-ui_normal, helvetica, arial, sans-serif",smallFontSize:de.B.createFromPt(9),mediumFontSize:de.B.createFromPt(10),largeFontSize:de.B.createFromPt(12),defaultBIUValue:!1},Bn={spanDropdownHeaderConfig:{show:!0,unknownSpanHeaderConfig:{actionType:"none"}}},Dn=function(){function j(h,x,I,R,U,T,Z,ee,ve,re,Q,fe,ye,we,Le,Ce,He,Re,et,it,Ze,Mt,st,Je,en,tn,nn,on,Rt,rn,Ee,lt,_e,Ie,St,Pn,fn,An){if(this.visualPlugin=h,this.changeDetectorRef=x,this.conceptualSchemaProxy=I,this.dataSources=R,this.dialogService=U,this.explorationActivity=T,this.explorationCapabilities=Z,this.explorationNavigation=ee,this.explorationSerializer=ve,this.eventBridge=re,this.featureSwitchService=Q,this.qnaFeedbackStateService=fe,this.lazyProvider=ye,this.themeService=we,this.expandCollapse=Le,this.geocoder=Ce,this.geolocationService=He,this.moduleLoader=Re,this.localizationService=et,this.errorService=it,this.telemetryService=Ze,this.resourceLoader=Mt,this.screenReaderService=st,this.interpretListenerFactory=Je,this.selectionService=en,this.sortService=tn,this.undoRedoService=nn,this.viewModeState=on,this.visualAuthoringOpService=Rt,this.azureMapTokenCache=rn,this.azureMapsEndpoint=Ee,this.geocoderIndexedDB=lt,this.visualHostTooltipServiceFactory=_e,this.promiseFactory=Ie,this.accountService=St,this.qnaProxyPathToken=Pn,this.qnaModelUtilsPathToken=fn,this.qnaLiveConnectService=An,this.utteranceUpdated=new A.EventEmitter,this.pinnableContentDefinitionUpdated=new A.EventEmitter,this.convertVisual=new A.EventEmitter,this.utteranceRestated=new A.EventEmitter,this.interpretationError=new A.EventEmitter,this.isBrowserIE=(0,M.rO)(),this.isBrowserIE)this.viewModel={state:"Error",error:(0,Ve.ET)(et),qnaInputConfiguration:void 0,themeCollection:void 0,viewport:void 0,presentationViewModel:void 0};else{this.pendingSuggestedQuestionsRequests=0;var xn=(0,Ve.Su)(this.explorationNavigation,this.featureSwitchService),mn=this.themeService.getVisualStyle(xn).colorPalette.dataColors.getColorByIndex(0).value,zt={withBorder:ae.withBorder,borderColor:ae.borderColor,backgroundColor:ae.inputBoxBackgroundColor,questionFontProperties:{color:ae.fontColor,size:ae.mediumFontSize,family:ae.regularFont},acceptedUnderlineColor:ae.acceptedColor,errorUnderlineColor:ae.errorColor,warningUnderlineColor:ae.warningColor,hoverColor:ae.hoverColor,restatementFontProperties:{color:ae.fontColor,size:ae.smallFontSize,family:ae.regularFont},commitButtonBackgroundColor:mn,commitButtonForegroundColor:Sn(mn)};this.viewModel={state:"Loading",qnaInputConfiguration:void 0,themeCollection:xn,viewport:void 0,presentationViewModel:{inputBox:zt,suggestions:{backgroundColor:ae.suggestionBackgroundColor,show:ae.showSuggestions,cardFontProperties:{color:ae.fontColor,size:ae.mediumFontSize,family:ae.regularFont},headerFontProperties:{color:ae.fontColor,size:ae.largeFontSize,family:ae.semiboldFont}}}}}}return j.prototype.initialize=function(h,x,I,R,U,T,Z,ee,ve,re,Q,fe,ye){var we;return void 0===ye&&(ye=!1),(0,m.__awaiter)(this,void 0,void 0,function(){var Ce,Re,et,it,Ze,Mt,st,Je,en,nn,on,Rt,Ee=this;return(0,m.__generator)(this,function(lt){switch(lt.label){case 0:return this.isBrowserIE?[2]:(this.models=h,this.config=x,this.hostServices=I,this.entryPoint=R,this.utteranceUpdated=U,this.convertVisual=T,this.utteranceRestated=re,this.interpretationError=Q,this.initializedTelemetryEvent=Z,this.contentElement=ee,ve&&(this.pinnableContentDefinitionUpdated=ve),Ce=this,[4,this.lazyProvider.get(this.qnaProxyPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule","InterpretServiceModern")]);case 1:return Ce.interpretService=lt.sent(),Re=this,[4,this.lazyProvider.get(this.qnaModelUtilsPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaModelUtilsService")];case 2:return Re.qnaModelUtils=lt.sent(),et=_.map(this.models,function(_e){return{datasetName:_e.dbName,datasetId:_e.id}}),it=this,[4,(0,gt.U)(et,this.qnaModelUtils,this.featureSwitchService)];case 3:return it.inCommitQuestionOnDemandMode=lt.sent(),this.interpretListener=this.interpretListenerFactory.createInterpretListener({forTrainingTermBinding:!1,canShowPods:this.config.canShowPods,canShowVisuals:this.config.canShowVisuals,canShowDidYouMean:this.config.canShowDidYouMean,models:this.models,resetDataSources:this.config.resetDataSources}),this.interpretListener.getObservable().subscribe(function(_e){return Ee.onResultAvailable(_e)}),Ze=_.find(this.dataSources.get(),function(_e){return _e.type===$e.nKy}),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 4:return Mt=lt.sent(),st=Ze&&Mt&&Mt.schema(Ze.name).capabilities,(Je=(null===(we=this.viewModel.qnaInputConfiguration)||void 0===we?void 0:we.configs)||{}).supportsPodQueries=!!x.canShowPods,null!=x.focusOnInit&&(Je.autoFocusOnInit=x.focusOnInit),null!=x.disableQnaInputAuthoring&&(Je.disableAuthoring=x.disableQnaInputAuthoring,Je.displayDisabledStateVisually=x.disableQnaInputAuthoring),null!=x.disableQnaInputAuthoringMessage&&(Je.disableAuthoringMessage=x.disableQnaInputAuthoringMessage),null!=x.hostHandlesUndo&&(Je.hostSupportsUndo=x.hostHandlesUndo),null!=x.showTermDropdownHeader&&(Je.spanDropdownHeaderConfig={show:x.showTermDropdownHeader}),x.showUnknownTermDropdownHeaderTextOnly&&(Je.spanDropdownHeaderConfig||(Je.spanDropdownHeaderConfig={show:void 0}),Je.spanDropdownHeaderConfig.unknownSpanHeaderConfig={actionType:"textOnlyHeader",textOnlyTemplate:x.unknownTermDropdownHeaderTextOnlyTemplate}),this.viewModel.themeCollection=(0,Ve.Su)(this.explorationNavigation,this.featureSwitchService),this.viewModel.qnaInputConfiguration={entryPoint:this.entryPoint,interpretListener:this.interpretListener,qnaSupportedScopes:_.map(this.models,function(_e){return{model:_e}}),configs:Je,presentation:this.viewModel.presentationViewModel.inputBox,initialUtterance:this.config.initialUtterance||"",initialUtteranceFromSaved:this.config.initialUtteranceFromSaved},this.viewModel.presentationViewModel.inputBox.useShellTheme=ye,en=this,[4,this.getIsModelEditable()];case 5:return en.isModelEditable=lt.sent(),[4,this.updateUnknownSpanHeaderConfig()];case 6:return lt.sent(),nn=_.map(fe,function(_e,Ie){return{name:"TempFilter"+Ie,filter:_e}}),on=this.getCurrentVisual(),Rt=(0,L.ED)((0,Oe.q)({geocoder:this.geocoder,geolocation:this.geolocationService,localizationService:this.localizationService,moduleLoader:this.moduleLoader,promiseFactory:this.promiseFactory,visualHostTooltipService:this.visualHostTooltipServiceFactory.createFromVisualContract(on),getAzureMapToken:function(){return Ee.azureMapTokenCache.getAzureMapToken()},azureMapsEndpoint:this.azureMapsEndpoint,geocoderIndexedDB:this.geocoderIndexedDB}),function(_e){_e.getLocalizedString=Ee.hostServices.getLocalizedString,_e.tooltips=Ee.hostServices.tooltips,_e.canSelect=Ee.hostServices.canSelect,_e.onSelecting=Ee.hostServices.onSelecting,_e.onSelect=Ee.hostServices.onSelect,_e.onCustomSort=function(Ie){return Ee.onCustomSort(Ie.sortDescriptors)},_e.geocoder=Ee.hostServices.geocoder,_e.launchUrl=Ee.hostServices.launchUrl,_e.canExpandCollapse=function(Ie){return st&&st.supportsInstanceFilters},_e.setNodeExpansionState=function(Ie){var St=Ee.getCurrentVisual();St&&(Ie.isCollapse?Ee.expandCollapse.collapseNode(St,Ie.dataRoles,Ie.data):Ee.expandCollapse.expandNode(St,Ie.dataRoles,Ie.data),Ee.eventBridge.publishToChannel(xe.jCS,{affectContainer:function(fn){return fn.name===gn}}))},_e.telemetry=Ee.hostServices.telemetry}),Object.defineProperty(Rt,"instanceId",{value:Y.b$.generateGuid()}),this.singleVisualHostConfig={notifyStart:_.noop,notifyEnd:function(){var Ie;De.mn(null===(Ie=Ee.viewModel)||void 0===Ie?void 0:Ie.result)&&(Ee.viewModel.result.isLoading=!1)},clearQueryErrors:_.noop,handleQueryErrors:function(Ie){return Ee.handleQueryErrors(Ie)},handleQueryWarnings:_.noop,queryVisualHostServices:{getFilters:function(){var Ie=Ee.getCurrentVisual();if(Ie){var St=_.union(Ie&&Ie.filters,nn);return Ee.createVisualContainerFilters(Ie,St)}},getDataSourceVariables:function(){var Ie=Ee.explorationNavigation.getCurrentExploration();return Ie&&Ie.dataSourceVariables},disableAnchorTime:!0},visualHostServices:Rt,interactivityOptions:{selection:!0},additionalObjectUpdates:void 0,disableQueryCacheUpdates:!1,noLoadMore:!1},[4,this.setSuggestedQuestions()];case 7:return lt.sent(),_.isEmpty(this.config.initialUtterance)&&this.setSuggestionsViewModel(),[2]}})})},j.prototype.onCustomSort=function(h){var x=this.getCurrentVisual();(0,Ve.fI)(x,this.sortHelper,h)},j.prototype.ngAfterViewInit=function(){this.updateViewport()},j.prototype.update=function(h){var x;return(0,m.__awaiter)(this,void 0,void 0,function(){var I,R,U,T,Z,ee,ve,re,Q,fe,ye,we,Le,Ce,He,Re,et,it;return(0,m.__generator)(this,function(Ze){switch(Ze.label){case 0:return I=this,[4,this.getIsModelEditable()];case 1:return I.isModelEditable=Ze.sent(),(0,le.yE)(h.type,Te.EP.Style)&&!this.isBrowserIE?(ue.fF.assertValue(this.viewModel,"viewModel should be defined"),R=(0,Ve.Su)(this.explorationNavigation,this.featureSwitchService),this.viewModel.themeCollection=R,U=R&&this.themeService.getVisualStyle(R),T=U&&U.colorPalette.background.value||ae.inputBoxBackgroundColor,Z=U&&U.colorPalette.backgroundNeutral.value||ae.hoverColor,ee=ae.acceptedColor,ve=ae.errorColor,re=ae.warningColor,Q=U&&Pe.v.create(U),fe=this.themeService.getVisualStyle(this.viewModel.themeCollection).colorPalette.dataColors.getColorByIndex(0).value,ye=(0,he.um)(fe)>.6?ae.darkFontColor:ae.lightFontColor,we=(0,q.W7)(h.objects,{objectName:Ye,propertyName:hn},T),Le=this.createFontProperties(h.objects,Ye,mt,"label",ae.mediumFontSize,!1,Q,U),Ce=(0,q.W7)(h.objects,{objectName:Ye,propertyName:Yt},fe),He={withBorder:ae.withBorder,borderColor:ae.borderColor,backgroundColor:we,questionFontProperties:Le,acceptedUnderlineColor:(0,q.W7)(h.objects,{objectName:Ye,propertyName:Xt},ee),errorUnderlineColor:(0,q.W7)(h.objects,{objectName:Ye,propertyName:bt},ve),warningUnderlineColor:(0,q.W7)(h.objects,{objectName:Ye,propertyName:Vt},re),hoverColor:(0,q.W7)(h.objects,{objectName:Ye,propertyName:Jt},Z),restatementFontProperties:this.createFontProperties(h.objects,Ye,Zt,"smallLabel",ae.smallFontSize,!1,Q,U),commitButtonBackgroundColor:Ce,commitButtonForegroundColor:Sn(Ce)},this.viewModel.presentationViewModel.inputBox=He,Re=this.createFontProperties(h.objects,ft,ot,"label",ae.mediumFontSize,!1,Q,U),(!h.objects||!h.objects[ft]||!h.objects[ft][ot+yt])&&(Re.color=ye),et={show:(0,q.NA)(h.objects,{objectName:ft,propertyName:"show"},!0),backgroundColor:(0,q.W7)(h.objects,{objectName:ft,propertyName:yn},fe),cardFontProperties:Re,headerFontProperties:this.createFontProperties(h.objects,ft,_t,"largeLabel",ae.largeFontSize,!1,Q,U)},this.viewModel.presentationViewModel.suggestions=et,this.viewModel.qnaInputConfiguration||(this.viewModel.qnaInputConfiguration={entryPoint:this.entryPoint,qnaSupportedScopes:void 0,configs:Bn}),[4,this.updateUnknownSpanHeaderConfig()]):[3,3];case 2:Ze.sent(),Ze.label=3;case 3:return(0,le.yE)(h.type,Te.EP.Data)?(this.inheritedFilters=h.filters,null!==(x=this.viewModel.qnaInputConfiguration)&&void 0!==x&&x.qnaSupportedScopes?[4,this.setSuggestedQuestions()]:[3,6]):[3,7];case 4:return Ze.sent(),De.Ew(this.viewModel.result)&&this.setSuggestionsViewModel(),[4,this.updateUnknownSpanHeaderConfig()];case 5:Ze.sent(),Ze.label=6;case 6:this.eventBridge.publishToChannel(xe.jCS,{affectContainer:function(st){return st.name===gn}}),Ze.label=7;case 7:return(0,le.yE)(h.type,Te.EP.Resize)&&(this.visualContainerViewport=h.viewport,this.updateViewport(),!this.isBrowserIE&&De.Ew(this.viewModel.result)&&this.setSuggestionsViewModel()),this.isBrowserIE||h.firstUpdate||h.objects&&h.objects[Cn]&&(it=(0,q.NA)(h.objects,{objectName:Cn,propertyName:"savedUtterance"},""),this.qnaInputComponent&&this.qnaInputComponent.interpretUtterance({utterance:it,suppressSuggestions:!0,incomingTags:["Committed"],useUncommittedUtterance:!0})),[2]}})})},j.prototype.enumerateObjectInstances=function(h){var x,I,R=this;if(ue.fF.assert(function(){return!R.isBrowserIE},"Expect this not to be called if it is inside IE browser"),!this.isBrowserIE){var U=new w.G,T=this.viewModel.presentationViewModel;switch(h.objectName){case Ye:var Z=((x={})[hn]=T.inputBox.backgroundColor,x[mt+yt]=T.inputBox.questionFontProperties.color,x[mt+Dt]=T.inputBox.questionFontProperties.size.pt,x);Z[mt+Qt]=T.inputBox.questionFontProperties.weight===H.en,Z[mt+kt]=T.inputBox.questionFontProperties.style===H.BF,Z[mt+Lt]=T.inputBox.questionFontProperties.textDecoration===H.f0,Z[mt+At]=T.inputBox.questionFontProperties.family,Z[Xt]=T.inputBox.acceptedUnderlineColor,Z[bt]=T.inputBox.errorUnderlineColor,Z[Vt]=T.inputBox.warningUnderlineColor,Z[Jt]=T.inputBox.hoverColor,Z[Zt+yt]=T.inputBox.restatementFontProperties.color,Z[Zt+Dt]=T.inputBox.restatementFontProperties.size.pt,Z[Zt+At]=T.inputBox.restatementFontProperties.family,this.inCommitQuestionOnDemandMode&&(Z[Yt]=T.inputBox.commitButtonBackgroundColor),U.pushInstance({selector:null,properties:Z,objectName:Ye});break;case ft:var ee=((I={}).show=T.suggestions.show,I[_t+yt]=T.suggestions.headerFontProperties.color,I[_t+Dt]=T.suggestions.headerFontProperties.size.pt,I);ee[_t+Qt]=T.suggestions.headerFontProperties.weight===H.en,ee[_t+kt]=T.suggestions.headerFontProperties.style===H.BF,ee[_t+Lt]=T.suggestions.headerFontProperties.textDecoration===H.f0,ee[_t+At]=T.suggestions.headerFontProperties.family,ee[yn]=T.suggestions.backgroundColor,ee[ot+yt]=T.suggestions.cardFontProperties.color,ee[ot+Dt]=T.suggestions.cardFontProperties.size.pt,ee[ot+Qt]=T.suggestions.cardFontProperties.weight===H.en,ee[ot+kt]=T.suggestions.cardFontProperties.style===H.BF,ee[ot+Lt]=T.suggestions.cardFontProperties.textDecoration===H.f0,ee[ot+At]=T.suggestions.cardFontProperties.family,U.pushInstance({selector:null,properties:ee,objectName:ft})}return U.complete()}},j.prototype.getFormattingModel=function(){var h=this;if(ue.fF.assert(function(){return!h.isBrowserIE},"Expect this not to be called if it is inside IE browser"),!this.isBrowserIE){var x=this.viewModel.presentationViewModel;return new J.Nq(function(){return h.buildInputBoxFormattingCard(x)},function(){return h.buildRestatementFormattingCard(x)},function(){return h.buildSuggestionsFormattingCard(x)}).build()}},j.prototype.getCurrentVisual=function(){var h,x=null===(h=this.viewModel)||void 0===h?void 0:h.result;return De.mn(x)?x.visual:De.fU(x)?_.first(x.exploreCanvas.contract.visualContainers):De.wp(x)?x.visualWithError:void 0},j.prototype.getCurrentUtteranceTrimmed=function(){return _.trim(this.getCurrentUtteranceUntrimmed())},j.prototype.setGetQnaInputComponentFunc=function(h){ue.fF.assertValue(h,"getQnaInputComponent must be defined."),this.getQnaInputComponent=h},j.prototype.convertVisualClicked=function(){var h=this.getCurrentVisual();if(h){var x=(0,C.s)(h);this.telemetryService.logChildEvent(this.initializedTelemetryEvent,Ae.dN,{visualType:x}),this.convertVisual.emit(h)}},j.prototype.interpretSuggestedQuestion=function(h){var x=this;this.telemetryService.logChildEvent(this.initializedTelemetryEvent,Ae.WW,{isAutoSuggestion:!0}),this.qnaInputComponent&&this.undoRedoService.register("Commit suggested QnA utterance",function(){x.qnaInputComponent.interpretUtterance({utterance:h,suppressSuggestions:!0,incomingTags:["SuggestedUtterance","Committed"],requireCursorAtEndIfFocused:!0,enforceFocus:!0,isCommitInCommitQuestionOnDemandMode:!0})})},j.prototype.toggleShowAllSuggestions=function(){if(De.Ew(this.viewModel.result)){var h=this.viewModel.result;h.showAllSuggestions=!h.showAllSuggestions,this.setSuggestionsViewModel()}},j.prototype.showQnaVisualErrorDetails=function(){(0,Ve.aZ)(this.viewModel.error,this.errorService,this.localizationService)},j.prototype.showResultErrorDetails=function(){(De.uT(this.viewModel.result)||De.wp(this.viewModel.result))&&(0,Ve.aZ)(this.viewModel.result,this.errorService,this.localizationService)},j.prototype.updateViewport=function(){if(!this.isBrowserIE){var h=this.contentElement.nativeElement;this.viewport={scale:1,height:h.clientHeight-10,width:h.clientWidth-10},this.viewModel.viewport=this.viewport}},j.prototype.getUnknownSpanDropdownHeaderActionType=function(){return(0,m.__awaiter)(this,void 0,void 0,function(){return(0,m.__generator)(this,function(h){switch(h.label){case 0:return this.qnaLiveConnectService?this.qnaLiveConnectService.allowsLinguisticSchemaFeedback()?[2,"askToAdd"]:[3,1]:[2,"askToAdd"];case 1:return[4,this.allowTooling()];case 2:return h.sent()?[2,"defineInTooling"]:[2,"none"];case 3:return[2]}})})},j.prototype.allowTooling=function(){var h;return(0,m.__awaiter)(this,void 0,void 0,function(){var x,I,R;return(0,m.__generator)(this,function(U){switch(U.label){case 0:return null==(x=null===(h=this.config)||void 0===h?void 0:h.canEdit)&&(x=0!==this.viewModeState.getMode()),x?(I=this.explorationCapabilities.getCapabilities(),I?.allowQnaTooling?null!=this.isModelEditable?[3,2]:(R=this,[4,this.getIsModelEditable()]):[2,!1]):[2,!1];case 1:R.isModelEditable=U.sent(),U.label=2;case 2:return this.isModelEditable?[2,!0]:[2,!1]}})})},j.prototype.shouldShowThumbsUpDown=function(){return(0,m.__awaiter)(this,void 0,void 0,function(){return(0,m.__generator)(this,function(x){switch(x.label){case 0:return this.isBrowserIE?[2,!1]:this.featureSwitchService.featureSwitches.qnaThumbsUpDown?[4,this.getIsModelEditable()]:[2,!1];case 1:return[2,!x.sent()]}})})},j.prototype.showFeedbackForCurrentQuestion=function(){var x,h=this;if(ue.fF.assert(function(){return!h.isBrowserIE},"Expect this never get called if it is inside IE browser"),this.isBrowserIE)return!1;var I=null===(x=this.viewModel)||void 0===x?void 0:x.result;return!!I&&(De.mn(I)||De.lP(I)||De.fU(I))},j.prototype.sendFeedback=function(h){return this.logFeedbackTelemetry(h),this.qnaInputComponent.sendFeedback(h,this.getCurrentUtteranceTrimmed())},j.prototype.launchFeedbackDialog=function(h,x){return(0,m.__awaiter)(this,void 0,void 0,function(){var R,U=this;return(0,m.__generator)(this,function(T){switch(T.label){case 0:return T.trys.push([0,2,,3]),[4,this.dialogService.openHostDialog({bindings:{sentiment:h,showOptions:x},componentName:B.Xr,config:{minWidth:"600px",panelClass:["no-padding"]},dialogName:"QnaFeedbackDialog"})];case 1:return T.sent().afterClosed().pipe((0,K.q)(1)).subscribe(function(Z){if(Z&&(!_.isEmpty(Z.reason)||!_.isEmpty(Z.comment))){U.sendFeedback(Z);var ee=1===h?"PositiveDetailSubmitted":"NegativeDetailSubmitted";U.qnaFeedbackStateService.updateState(U.getCurrentUtteranceTrimmed(),ee)}}),[3,3];case 2:return R=T.sent(),ue.fF.assertFail("Qna Feedback dialog failed to open"),ue.fF.log(R),[3,3];case 3:return[2]}})})},j.prototype.updateUnknownSpanHeaderConfig=function(){var h;return(0,m.__awaiter)(this,void 0,void 0,function(){var x,R,U;return(0,m.__generator)(this,function(T){switch(T.label){case 0:return ue.fF.assertValue(this.viewModel.qnaInputConfiguration.configs,"Expect this.viewModel.qnaInputConfiguration.configs has already been defined"),x=this.viewModel.qnaInputConfiguration.configs.spanDropdownHeaderConfig,"textOnlyHeader"===(null===(h=x?.unknownSpanHeaderConfig)||void 0===h?void 0:h.actionType)?[3,2]:(this.viewModel.qnaInputConfiguration.configs.spanDropdownHeaderConfig||(this.viewModel.qnaInputConfiguration.configs.spanDropdownHeaderConfig={show:void 0}),R=this.viewModel.qnaInputConfiguration.configs.spanDropdownHeaderConfig,U={},[4,this.getUnknownSpanDropdownHeaderActionType()]);case 1:R.unknownSpanHeaderConfig=(U.actionType=T.sent(),U),T.label=2;case 2:return[2]}})})},j.prototype.logFeedbackTelemetry=function(h){this.telemetryService.logChildEvent(this.initializedTelemetryEvent,Ae.v5,{senitment:this.mapToTelemetryFeedbackSentiment(h.sentiment),reason:h.reason})},j.prototype.mapToTelemetryFeedbackSentiment=function(h){return ue.fF.assert(function(){return 1===h||-1===h},"unexpected telemetry sentiment"),1===h?"Positive":"Negative"},j.prototype.shouldShowdoNotUnderstandMessageFeedbackLink=function(){var h=this.getCurrentUtteranceTrimmed();return"NegativeDetailSubmitted"!==this.qnaFeedbackStateService.getState(h)},Object.defineProperty(j.prototype,"qnaInputComponent",{get:function(){return this.getQnaInputComponent&&this.getQnaInputComponent()},enumerable:!1,configurable:!0}),j.prototype.getIsModelEditable=function(){return(0,m.__awaiter)(this,void 0,void 0,function(){var h,x,I;return(0,m.__generator)(this,function(R){switch(R.label){case 0:return h=_.find(this.dataSources.get(),function(U){return U.type===$e.nKy}),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return x=R.sent(),I=h&&x?.schema(h.name).capabilities,[2,I?.canEdit]}})})},j.prototype.getCurrentUtteranceUntrimmed=function(){return this.qnaInputComponent&&this.qnaInputComponent.currentDisplayedUtterance},j.prototype.setSuggestedQuestions=function(){return(0,m.__awaiter)(this,void 0,void 0,function(){var h,x,I,R,U,Z=this;return(0,m.__generator)(this,function(ee){switch(ee.label){case 0:return ue.fF.assert(function(){return!!Z.interpretService},"interpretService should be defined"),this.pendingSuggestedQuestionsRequests++,[4,this.interpretService.getSuggestedQuestions(this.convertRequestScopes(this.viewModel.qnaInputConfiguration.qnaSupportedScopes)).toPromise()];case 1:if(h=ee.sent(),this.pendingSuggestedQuestionsRequests--,x=h.result,"Loading"===this.viewModel.state&&this.pendingSuggestedQuestionsRequests>0&&!h.error&&_.isEmpty(x?.utterances))return[2];if(h.error)return this.viewModel.error=this.getErrorDetailsFromError(h.error),this.viewModel.state="Error",[2];if(I=_.chain(this.models).map(function(ve){return _.map(ve.featuredQuestions,function(re){return re.utterance})}).flatten().value(),_.isEmpty(I))for(I=[],R=0,U=x.utterances;R<U.length;R++)I.push(U[R].text);return ue.fF.assert(function(){return!_.isEmpty(x.utterances)||!_.isEmpty(x.warnings)},"No suggested question but no warning? something is wrong."),this.suggestions={questions:I,hasWarnings:!_.isEmpty(x.warnings)},this.viewModel.state="Ready",[2]}})})},j.prototype.getErrorDetailsFromError=function(h){ue.fF.assertValue(h,"Expect the given error to be defined.");var R,x=(0,pt.AU)(h.errorCode,this.localizationService),I=h.errorCode,U=[],T=[];if("SchemaLanguageNotSupported"===h.errorCode)R=!1,U=[{errorInfoKey:this.localizationService.get("VisualContainer_QnaVisual_NotSupportedTitle"),errorInfoValue:this.localizationService.get("VisualContainer_QnaVisual_NotSupportedMessage")}];else if(!(R="GenericRequestFailure"!==I))if(h.sourceServiceError){var re=new me.sI(h.sourceServiceError).getDetails(this.localizationService);U=re.displayableErrorInfo,T=re.debugErrorInfo}else _.isEmpty(h.message)||T.push({errorInfoKey:We.Bm,errorInfoValue:h.message}),_.isEmpty(h.stackTrace)||T.push({errorInfoKey:We.RU,errorInfoValue:h.stackTrace});var Q={code:I,fixableError:0,hideSeeDetails:R,details:{message:x,displayableErrorInfo:U,debugErrorInfo:T},source:h.source};return"DataIndexMissingAllStatistics"===h.errorCode&&(Q.details.helpLink="https://go.microsoft.com/fwlink/?LinkId=786785",Q.details.helpLinkType=1,Q.details.errorType=1),ue.fF.assert(function(){return!_.isEmpty(Q.code)},"telemetryCode should not be empty"),ue.fF.assert(function(){return null!=Q.hideSeeDetails},"hideSeeDetails should not be null"),ue.fF.assert(function(){return!_.isEmpty(Q.details.message)},"mainMessage should not be empty"),ue.fF.assert(function(){return null!=Q.source},"errorSource should not be null"),Q},j.prototype.setSuggestionsViewModel=function(){var x,I,R,h=this;ue.fF.assert(function(){return!h.isBrowserIE},"Expect this never get called if it is inside IE browser");var U=_.size(null===(x=this.suggestions)||void 0===x?void 0:x.questions),T=this.viewModel.result,Z=!!De.Ew(T)&&T.showAllSuggestions;U>0&&!Z&&(U=Math.floor(this.contentElement.nativeElement.clientWidth/200))<=1&&(U=5);var re=_.take(null===(I=this.suggestions)||void 0===I?void 0:I.questions,U),Q=_.size(re);this.viewModel.result={type:"Suggestions",suggestions:_.map(re,function(fe,ye){return{content:fe,accessibilityLabel:h.localizationService.format("Visual_Qna_SuggestedQuestion_AccessibilityLabel",ye+1,Q,fe)}}),showAllSuggestions:Z,failedToLoadSuggestionsMessage:0===U&&null!==(R=this.suggestions)&&void 0!==R&&R.hasWarnings?this.localizationService.get("QnaStart_ErrorLoadingSuggestions"):void 0}},j.prototype.onResultAvailable=function(h){var x,I,R;return(0,m.__awaiter)(this,void 0,void 0,function(){var U,T,Z,ee,ve,re,Q,fe,ye,we=this;return(0,m.__generator)(this,function(Le){switch(Le.label){case 0:return h&&1===h.resultType?[2]:h?(this.showQuestionProblematicResultTimeout&&(clearTimeout(this.showQuestionProblematicResultTimeout),this.showQuestionProblematicResultTimeout=void 0),_.includes(h.usedAgents,"PowerBI.AzureOpenAISynonyms")?[4,this.logInterpretCopilotTelemetry()]:[3,2]):(this.pinnableContentDefinitionUpdated.emit(void 0),this.viewModel.result=void 0,[2]);case 1:Le.sent(),Le.label=2;case 2:return null!=h.utterance&&this.utteranceUpdated.emit(h.utterance),this.updateViewport(),4===h.resultType&&this.setSuggestionsViewModel(),4!==h.resultType&&6!==h.resultType&&0!==h.resultType&&h.doNotShowResult&&(this.showQuestionProblematicResultTimeout=setTimeout(function(){var Ce=h.interpretError;if(Ce)we.interpretationError&&we.interpretationError.emit(),we.viewModel.result=(0,m.__assign)({type:"Error"},we.getErrorDetailsFromError(Ce));else{var He=we.localizationService.get("Qna_NoVisual_Message");we.viewModel.result={type:"DoNotUnderstand",message:_.isEmpty(h.doNotShowResultCustomMessageKeys)?He:_.map(h.doNotShowResultCustomMessageKeys,function(Re){return we.localizationService.get(Re)}).join("\n\n")},we.screenReaderService.alert(He)}},1500)),4===h.resultType||6===h.resultType||h.doNotShowResult||2!==h.resultType||!h.visualContainer&&!h.exploration?(this.pinnableContentDefinitionUpdated.emit(void 0),this.cancelVisualUpdateAlert(),[2]):(this.utteranceRestated&&this.utteranceRestated.emit(h.restatement),ue.fF.assertValue(h.visualContainer||h.exploration,"result should contain either visualContainer or exploration"),h.visualContainer&&(h.visualContainer.name=gn),U=h.restatement,_.startsWith(U,"Show ")&&(U=_.replace(U,"Show ",h.visualContainer?"This visual is showing ":"Showing ")),T=h.modelId,h.visualContainer?(ue.fF.assert(function(){var Ce;return!(null===(Ce=h.visualContainer.config)||void 0===Ce||!Ce.singleVisual)},"single visual is not defined"),this.config.showVisualsAsExploration?(Z="QnaSection",h.visualContainer.layouts=(0,dt.Br)([{id:0,position:{x:0,y:0,height:this.viewport.height,width:this.viewport.width}}]),(ee=null!==(x=(0,e.PQ)(h.visualContainer).vcObjects)&&void 0!==x?x:{}).title=[{properties:{show:(0,z.O7)(!1)}}],h.visualContainer.config.singleVisual.vcObjects=ee,ve={name:Z,displayName:Z,size:{displayOption:0,width:this.viewport.width,height:this.viewport.height},visualContainers:[h.visualContainer],visualContainerGroups:[h.visualContainer],filters:[]},Q={themeCollection:(0,Ve.D4)(this.featureSwitchService),dataSources:this.dataSources.get(),sections:[ve],settings:{useNewFilterPaneExperience:!0,allowChangeFilterTypes:!0}},this.explorationNavigation.loadExploration(Q),this.explorationNavigation.goto(ve),this.viewModel.result={type:"VisualAsExploration",restatement:U,exploreCanvas:(0,ce.T8)(Q,ve,0),modelId:T},ne.UP.selectCanvasItem(h.visualContainer,this.selectionService),this.explorationActivity.sendExplorationContainerReady({parentActivity:void 0})):(this.viewModel.result=void 0,setTimeout(function(){return(0,m.__awaiter)(we,void 0,void 0,function(){var Ce,He=this;return(0,m.__generator)(this,function(Re){switch(Re.label){case 0:return this.viewModel.result={type:"Visual",restatement:U,visual:h.visualContainer,modelId:T,isLoading:!0},Ce=(0,e.oJ)(h.visualContainer),_.isEmpty(Ce)?[3,2]:[4,this.createSortHelper(h.visualContainer)];case 1:Re.sent(),Re.label=2;case 2:return this.changeDetectorRef.detectChanges(),this.eventBridge.publishToChannel(xe.jCS,{affectContainer:function(it){return it.name===h.visualContainer.name}}),setTimeout(function(){return He.updateViewport()}),[2]}})})})),re=(0,P.d9)(h.visualContainer,this.explorationSerializer),null!=(null===(R=null===(I=re?.config)||void 0===I?void 0:I.singleVisual)||void 0===R?void 0:R.vcObjects)&&(re.config.singleVisual.vcObjects=void 0),this.pinnableContentDefinitionUpdated.emit({pinVisualArgs:{dataSources:this.dataSources.get(),filters:this.createVisualContainerFilters(h.visualContainer,h.visualContainer.filters),modelId:T,resourcePackages:void 0,themeCollection:this.viewModel.themeCollection,utterance:h.utterance,visualContainer:re}}),this.alertVisualUpdate(this.getCurrentUtteranceTrimmed(),(0,C.s)(h.visualContainer)),[3,6]):[3,3]);case 3:return h.exploration?(this.updateViewport(),h.exploration.themeCollection?[4,Ne.P.loadThemeAndBaseTheme(this.promiseFactory,this.resourceLoader,this.themeService,h.exploration.resourcePackages,h.exploration.themeCollection)]:[3,5]):[3,6];case 4:Le.sent(),Le.label=5;case 5:fe=(Q=h.exploration).sections[Q.activeSectionIndex],this.explorationNavigation.loadExploration(Q),this.explorationNavigation.goto(fe),this.viewModel.result={type:"Pod",restatement:U,exploreCanvas:(0,ce.T8)(Q,fe,0),modelId:T},ye=_.find(this.models,function(Ce){return Ce.id===T}),this.pinnableContentDefinitionUpdated.emit({pinReportPageArgs:{exploration:(0,ce.vi)(Q,0,Q.activeSectionIndex,void 0,this.localizationService),section:fe,reportId:Q.reportId,modelId:T,packageId:ye&&ye.packageId,action:{action:$e.RCq},utterance:h.utterance,pod:_.find(h.exploration.pods,function(Ce){return Ce.boundSection===fe.name}).name,filters:fe.filters}}),this.cancelVisualUpdateAlert(),Le.label=6;case 6:return[2]}})})},j.prototype.createSortHelper=function(h){return(0,m.__awaiter)(this,void 0,void 0,function(){var x;return(0,m.__generator)(this,function(I){switch(I.label){case 0:return x=this,[4,(0,Ve.Vq)(h,this.conceptualSchemaProxy,this.dataSources,this.sortService,this.undoRedoService,this.visualAuthoringOpService,this.visualPlugin)];case 1:return x.sortHelper=I.sent(),[2]}})})},j.prototype.createFontProperties=function(h,x,I,R,U,T,Z,ee){var ve=h&&h[x],re="".concat(I).concat(Qt),Q="".concat(I).concat(kt),fe="".concat(I).concat(Lt),ye=(0,te.N)(ve,re),we=(0,te.N)(ve,Q),Le=(0,te.N)(ve,fe),Ce={color:"".concat(I).concat(yt),family:"".concat(I).concat(At),size:"".concat(I).concat(Dt)};return ye&&(Ce.bold="".concat(I).concat(Qt)),we&&(Ce.italic="".concat(I).concat(kt)),Le&&(Ce.underline="".concat(I).concat(Lt)),(0,Be.Zi)(h&&h[x],Ce,Z,ee,"foreground",R,{color:ae.fontColor,family:T?ae.semiboldFont:ae.regularFont,size:U,weight:H.AI,style:H.AI,textDecoration:H.zu})},j.prototype.createVisualContainerFilters=function(h,x){var I=_.isEmpty(x)?[]:_.chain(x).filter(function(fe){return fe.filter}).map(function(fe){return fe.filter}).value();this.inheritedFilters&&this.inheritedFilters.dataFilter&&I.push.apply(I,_.map(this.inheritedFilters.dataFiltersUnmerged,function(fe){return fe.filter}));for(var R=new b.ME,U=0,T=I;U<T.length;U++)R.addVisualFilter({filter:T[U]});var ee=(0,C.s)(h),ve=ee&&this.visualPlugin.capabilities(ee),re=ve&&ve.supportsHighlight;!re&&this.inheritedFilters&&this.inheritedFilters.highlightFilter&&R.addVisualFilter({filter:this.inheritedFilters.highlightFilter});var Q=R.getFilters(!1);return{dataFilter:Q.dataFilter,dataFiltersUnmerged:Q.dataFiltersUnmerged,highlightFilter:re&&this.inheritedFilters?this.inheritedFilters.highlightFilter:void 0,highlightFiltersUnmerged:re&&this.inheritedFilters?this.inheritedFilters.highlightFiltersUnmerged:void 0}},j.prototype.handleQueryErrors=function(h){if(!h.ignorable){var x=h.getDetails(this.localizationService),I=(0,Xe.fe)(h.code);this.viewModel.result={type:"QueryError",visualWithError:this.getCurrentVisual(),details:x,code:h.code,fixableError:0,hideSeeDetails:(0,Xe.O6)(h.code),overlayType:I,requestId:h.requestId,source:x.source||h.source||"PowerBI"},this.cancelVisualUpdateAlert()}},j.prototype.alertVisualUpdate=function(h,x){if(h){var I=x?this.localizationService.format("Qna_ScreenReader_VisualUpdatedWithChartType",[h,x]):this.localizationService.format("Qna_ScreenReader_VisualUpdated",[h]);this.screenReaderService.alertWithDebounce("qna_visual_update",I)}},j.prototype.cancelVisualUpdateAlert=function(){this.screenReaderService.cancelDebounce("qna_visual_update")},j.prototype.logInterpretCopilotTelemetry=function(){var h;return(0,m.__awaiter)(this,void 0,void 0,function(){var x,I,R;return(0,m.__generator)(this,function(T){switch(T.label){case 0:return x=null!==(h=this.qnaProxyPathToken)&&void 0!==h?h:"@powerbi/Qna/qnaweb.module#QnaWebModule",[4,this.ensureInterpretCopilotTelemetry(x)];case 1:return T.sent(),[4,this.accountService.isSignedInAsync()];case 2:return I=T.sent(),R=this.viewModeState.getMode(),this.interpretCopilotTelemetry.logInterpretWithCopilotEvent("@powerbi/Qna/qnaweb.module#QnaWebModule"===this.qnaProxyPathToken?"service":"desktop",I,R),[2]}})})},j.prototype.ensureInterpretCopilotTelemetry=function(h){return(0,m.__awaiter)(this,void 0,void 0,function(){var x;return(0,m.__generator)(this,function(I){switch(I.label){case 0:return null!=this.interpretCopilotTelemetry?[2]:(x=this,[4,this.lazyProvider.get(h,"interpretCopilotTelemetryService")]);case 1:return x.interpretCopilotTelemetry=I.sent(),[2]}})})},j.prototype.convertRequestScopes=function(h){return _.map(h,function(x){return{model:x.model,reportIds:x.reportIds}})},j.prototype.buildInputBoxFormattingCard=function(h){var x=this,I=ie.Fp.inputBox,R=new J.CQ(new J.lg("inputBox"),"Visual_Qna_QuestionBox",I,function(re){return x.localizationService.get(re)}),U=h.inputBox.questionFontProperties.weight===H.en,T=h.inputBox.questionFontProperties.style===H.BF,Z=h.inputBox.questionFontProperties.textDecoration===H.f0,ve=(new J.UN).withFontFamily({descriptor:I.questionFontFamily,value:h.inputBox.questionFontProperties.family}).withFontSizeProperties({descriptor:I.questionFontSize,value:h.inputBox.questionFontProperties.size.pt}).withBold({descriptor:I.questionBold,value:U}).withItalic({descriptor:I.questionItalic,value:T}).withUnderline({descriptor:I.questionUnderline,value:Z}).build();return R.addGroup("text",function(re){re.withDisplayName("Text").addCompositeSlice("fontselector","Font",ve).addSimpleSlice("color",function(){return new J.BT({descriptor:I.questionFontColor,value:{value:h.inputBox.questionFontProperties.color}}).build()},function(Q){return Q.withCustomDisplayName("Generic_Color")})}),R.addGroup("background",function(re){re.withDisplayName("Visual_Background").addSimpleSlice("defaultColor",function(){return new J.BT({descriptor:I.background,value:{value:h.inputBox.backgroundColor}}).build()},function(Q){return Q.withCustomDisplayName("Visual_Qna_QuestionBackgroundColor")}).addSimpleSlice("hoverColor",function(){return new J.BT({descriptor:I.hoverColor,value:{value:h.inputBox.hoverColor}}).build()},function(Q){return Q.withCustomDisplayName("Visual_Qna_QuestionBackgroundHoverColor")})}),R.addGroup("underlines",function(re){re.withDisplayName("Underline").addSimpleSlice("acceptedColor",function(){return new J.BT({descriptor:I.acceptedColor,value:{value:h.inputBox.acceptedUnderlineColor}}).build()},function(Q){return Q.withCustomDisplayName("AcceptedColor")}).addSimpleSlice("errorColor",function(){return new J.BT({descriptor:I.errorColor,value:{value:h.inputBox.errorUnderlineColor}}).build()},function(Q){return Q.withCustomDisplayName("Error_Color")}).addSimpleSlice("warningColor",function(){return new J.BT({descriptor:I.warningColor,value:{value:h.inputBox.warningUnderlineColor}}).build()},function(Q){return Q.withCustomDisplayName("Warning_TitleColor")})}),R.addGroup("submitButton",function(re){re.withDisplayName("Visual_Qna_CommitButtonBackground").addSimpleSlice("submitButtonColor",function(){return new J.BT({descriptor:I.commitButtonBackgroundColor,value:{value:h.inputBox.commitButtonBackgroundColor}}).build()},function(Q){return Q.withCustomDisplayName("Background_Color")})}),R.build()},j.prototype.buildRestatementFormattingCard=function(h){var x=this,I=ie.Fp.inputBox,R=new J.CQ(new J.lg("restatement"),"Visual_Qna_Restatement",I,function(Z){return x.localizationService.get(Z)}),T=(new J.UN).withFontFamily({descriptor:I.restatementFontFamily,value:h.inputBox.restatementFontProperties.family}).withFontSizeProperties({descriptor:I.restatementFontSize,value:h.inputBox.restatementFontProperties.size.pt}).build();return R.addGroup("text",function(Z){Z.addCompositeSlice("fontselector","Font",T).addSimpleSlice("color",function(){return new J.BT({descriptor:I.restatementFontColor,value:{value:h.inputBox.restatementFontProperties.color}}).build()},function(ee){return ee.withCustomDisplayName("Generic_Color")})}),R.build()},j.prototype.buildSuggestionsFormattingCard=function(h){var x=this,I=ie.Fp.suggestions,R=new J.CQ(new J.lg("suggestions"),"Suggestions",I,function(fe){return x.localizationService.get(fe)});R.addTopLevelToggle("show",function(){return new J.bd({descriptor:I.show,value:h.suggestions.show}).build()});var U=h.suggestions.headerFontProperties.weight===H.en,T=h.suggestions.headerFontProperties.style===H.BF,Z=h.suggestions.headerFontProperties.textDecoration===H.f0,ve=(new J.UN).withFontFamily({descriptor:I.headerFontFamily,value:h.suggestions.headerFontProperties.family}).withFontSizeProperties({descriptor:I.headerFontSize,value:h.suggestions.headerFontProperties.size.pt}).withBold({descriptor:I.headerBold,value:U}).withItalic({descriptor:I.headerItalic,value:T}).withUnderline({descriptor:I.headerUnderline,value:Z}).build();R.addGroup("header",function(fe){fe.withDisplayName("Visual_Qna_SuggestionsCardHeader").addCompositeSlice("fontselector","Font",ve).addSimpleSlice("color",function(){return new J.BT({descriptor:I.headerFontColor,value:{value:h.suggestions.headerFontProperties.color}}).build()},function(ye){return ye.withCustomDisplayName("Generic_Color")})}),U=h.suggestions.cardFontProperties.weight===H.en,T=h.suggestions.cardFontProperties.style===H.BF,Z=h.suggestions.cardFontProperties.textDecoration===H.f0;var Q=(new J.UN).withFontFamily({descriptor:I.cardFontFamily,value:h.suggestions.cardFontProperties.family}).withFontSizeProperties({descriptor:I.cardFontSize,value:h.suggestions.cardFontProperties.size.pt}).withBold({descriptor:I.cardBold,value:U}).withItalic({descriptor:I.cardItalic,value:T}).withUnderline({descriptor:I.cardUnderline,value:Z}).build();return R.addGroup("cards",function(fe){fe.withDisplayName("Cards").addCompositeSlice("fontselector","Font",Q).addSimpleSlice("text",function(){return new J.BT({descriptor:I.cardFontColor,value:{value:h.suggestions.cardFontProperties.color}}).build()},function(ye){return ye.withCustomDisplayName("Text_Color")}).addSimpleSlice("background",function(){return new J.BT({descriptor:I.cardBackground,value:{value:h.suggestions.backgroundColor}}).build()},function(ye){return ye.withCustomDisplayName("Background_Color")})}),R.build()},j.\u0275fac=function(x){return new(x||j)(A.\u0275\u0275inject(xt.D),A.\u0275\u0275inject(A.ChangeDetectorRef),A.\u0275\u0275inject(tt.i),A.\u0275\u0275inject(je.D),A.\u0275\u0275inject(Me.x),A.\u0275\u0275inject(un.Z),A.\u0275\u0275inject(Tt.U),A.\u0275\u0275inject(Gt.z),A.\u0275\u0275inject(jt.L),A.\u0275\u0275inject($t.J),A.\u0275\u0275inject(v.vZ),A.\u0275\u0275inject(S.B),A.\u0275\u0275inject(O.E),A.\u0275\u0275inject(Wt.f),A.\u0275\u0275inject(Kt.v),A.\u0275\u0275inject(se.i),A.\u0275\u0275inject(oe._1),A.\u0275\u0275inject(V.m),A.\u0275\u0275inject(ge.o),A.\u0275\u0275inject(Qe.T),A.\u0275\u0275inject(ze.y0),A.\u0275\u0275inject(It.l6),A.\u0275\u0275inject(vt.g),A.\u0275\u0275inject(nt.y),A.\u0275\u0275inject(Bt.z),A.\u0275\u0275inject(cn.K),A.\u0275\u0275inject(Ke.z),A.\u0275\u0275inject(Ft.kc),A.\u0275\u0275inject(ln.Q),A.\u0275\u0275inject(d.o),A.\u0275\u0275inject(pe.A),A.\u0275\u0275inject(at.W),A.\u0275\u0275inject(Ue.A),A.\u0275\u0275inject(F.t),A.\u0275\u0275inject(W.F),A.\u0275\u0275inject(X.n,8),A.\u0275\u0275inject(N.z,8),A.\u0275\u0275inject(G,8))},j.\u0275prov=A.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac}),j}();function Sn(j){return(0,he.um)(j)>.6?ae.darkFontColor:ae.lightFontColor}},21548:function(rt,be,u){u.d(be,{B:function(){return A}});var m=u(50423),A=function(){function K(){this.states={}}return K.prototype.updateState=function(W,H){this.states[W.toLocaleLowerCase()]=H},K.prototype.getState=function(W){var H;return null!==(H=this.states[W.toLocaleLowerCase()])&&void 0!==H?H:"Unchosen"},K.\u0275prov=m.\u0275\u0275defineInjectable({token:K,factory:K.\u0275fac=function(H){return new(H||K)},providedIn:"root"}),K}()},5894:function(rt,be,u){u.d(be,{Nt:function(){return Be},WW:function(){return K},dN:function(){return H},v5:function(){return J},yP:function(){return P},yp:function(){return Oe}});var m=u(41114),A="PBI.QnaVisual.SuggestionCardClicked",K=m.cx[A]=(0,m.b1)(A),W="PBI.QnaVisual.VisualConverted",H=m.cx[W]=(0,m.b1)(W),z="PBI.QnA.INAQ",P=m.cx[z]=(0,m.b1)(z,{logExpAssignment:!0}),Pe="PBI.QnA.Feedback",J=m.cx[Pe]=(0,m.b1)(Pe),he="PBI.QnA.UpdateLsdlSharingPermission",Be=(m.cx[he]=(0,m.b1)(he),"PBI.QnaTooling.ImproveLsdlRequest"),Oe=m.cx[Be]=(0,m.b1)(Be)},34100:function(rt,be,u){u.d(be,{J8:function(){return H},J_:function(){return W},NP:function(){return K}});var m=u(81337),A=u(91592);function K(z,P,Pe,J,he){var ce;return(0,m.__awaiter)(this,void 0,void 0,function(){var Be,Oe;return(0,m.__generator)(this,function($e){switch($e.label){case 0:return[4,z.get(P.get())];case 1:return Be=$e.sent(),Oe=Pe.getCapabilities(),(0,A.H)(Oe,Be,J).isAllowed&&J.allowsLinguisticSchemaEdit()&&"None"!==(null===(ce=he.DynamicImprovement)||void 0===ce?void 0:ce.Schema)?[2,!0]:[2,!1]}})})}function W(z){return _.includes(z,"PowerBI.AzureOpenAISynonyms")||_.includes(z,"PowerBI.AzureOpenAIPhrasings")}function H(z){return z.qnaImproveLsdlCopilot&&z.qnaSupportCommitQuestionOnDemandForAll&&z.qnaFuzzyMatch}},87974:function(rt,be,u){u.d(be,{U:function(){return A}});var m=u(81337);function A(K,W,H){return(0,m.__awaiter)(this,void 0,void 0,function(){var z,P;return(0,m.__generator)(this,function(J){switch(J.label){case 0:if(H.featureSwitches.qnaSupportCommitQuestionOnDemandForAll)return[2,!0];z=0,P=K??[],J.label=1;case 1:return z<P.length?[4,W.isDQOrLiveConnectToOnPrem(P[z])]:[3,4];case 2:if(J.sent())return[2,!0];J.label=3;case 3:return z++,[3,1];case 4:return[2,!1]}})})}},91592:function(rt,be,u){u.d(be,{H:function(){return A}});var m=u(16808);function A(W,H,z){return(0,m.rO)()?{isAllowed:!1,disallowedReason:"featureDisabledInIE"}:z.appShouldHideQnaFeature()?{isAllowed:!1,disallowedReason:"featureDisabledInApp"}:_.some(H?.schemas,function(J){return!J.isExtensionSchema&&!_.isEmpty(J.entities)})?z.modelSupportsQna(H,W)?z.modelHasQnaEnabled(H,W)?{isAllowed:!0}:{isAllowed:!1,disallowedReason:"qnaNotEnabled"}:{isAllowed:!1,disallowedReason:"qnaNotSupported"}:{isAllowed:!1,disallowedReason:"noModel"}}},74857:function(rt,be,u){u.d(be,{D4:function(){return ue},ET:function(){return Pe},Nj:function(){return ce},Su:function(){return Oe},Vq:function(){return dt},aZ:function(){return Be},fI:function(){return b},y_:function(){return $e}});var m=u(81337),A=u(62458),K=u(38701),W=u(60661),H=u(18503),z=u(50547),P=u(2240);function Pe(q){return{code:"qnaNotAllowedInIE",fixableError:0,hideSeeDetails:!0,details:{message:q.get("Qna_NotSupportedInIE"),displayableErrorInfo:void 0},source:"User"}}function ce(q){if(q)return{Filters:_.map(q.filters,function(C){return{Restatement:C.Restatement,type:void 0}}),Select:_.map(q.selects,function(C){return{Restatement:C.restatement}})}}function Be(q,C,e){A.fF.assertValue(q,"Expect this to be called only when the given error is defined.");var te=q.details;if(te){var le=(0,H.jx)(te),L=e.get("ServiceError_CannotLoadVisual"),M=te.message,w=[];if(le&&(L=te.displayableErrorInfo[0].errorInfoKey,M=te.displayableErrorInfo[0].errorInfoValue,te.displayableErrorInfo.length>1))for(var F=1;F<te.displayableErrorInfo.length;F++)w.push(te.displayableErrorInfo[F]);A.fF.assert(function(){return null!=q.source},"Expect error.source is not null."),C.error(M,q.code,{debugErrorInfo:te.debugErrorInfo,displayableErrorInfo:w,title:L,source:q.source,level:z.U.Error})}}function Oe(q,C){var e=q.getCurrentExploration(),te=e?.themeCollection;return _.isEmpty(te)?ue(C):te}function ue(q){return{baseTheme:(0,K.DC)(q)}}function $e(q,C,e,te){return(0,m.__awaiter)(this,void 0,void 0,function(){var le,L,M,w,F,B,G,N;return(0,m.__generator)(this,function(X){switch(X.label){case 0:return le=q?.command,L=le?.query,L?(M=L.select(),w=le.queryMetadata,F=_.map(w?.selects,function(ie,ne){return{expression:M[ne].expr,type:ie.type,isGroup:ie.isGroup,defaultLabel:ie.defaultLabel,isExplicitSortBy:ie.isExplicitSortBy}}),B=w?.filters,[4,C.get(e.get())]):[2];case 1:return G=X.sent(),(N=te.recommendVisuals(L,G,{numberOfResults:1,visualType:_.first(le.suggestedVisualTypes),filterMetadata:B,exprMetadata:F,addDefaultFormatting:!0,allowTooltipMeasures:!0}))?(A.fF.assert(function(){return 1===_.size(N.visualContainers)},"Expected 1 result"),[2,N.visualContainers[0]]):[2]}})})}function dt(q,C,e,te,le,L,M){return(0,m.__awaiter)(this,void 0,void 0,function(){var w,F;return(0,m.__generator)(this,function(B){switch(B.label){case 0:return[4,oe(q,C,e,te)];case 1:return w=B.sent(),F={defaultSortBehavior:de(q,M),sortableFields:w?.sortableFields,sortGroups:w?.sortGroups},[2,new P.B(F,q,te,le,L)]}})})}function b(q,C,e){if(!_.isEmpty(e)){var te=(0,W.oJ)(q);_.isEmpty(te)||C.applySortByFields(e)}}function de(q,C){var e,te=(0,W.cj)(q,C);return!!te&&!(null===(e=te.sorting)||void 0===e||!e.default)}function oe(q,C,e,te){return(0,m.__awaiter)(this,void 0,void 0,function(){var le,L,M,w;return(0,m.__generator)(this,function(B){switch(B.label){case 0:if(!(le=e.get()))return[2];B.label=1;case 1:return B.trys.push([1,3,,4]),L=(0,W.PQ)(q),M=(0,W.Xf)(q),[4,C.get(le)];case 2:return w=B.sent(),[2,te.getSortableFields({query:M,schema:w,visualType:L.visualType,columnProperties:L.columnProperties,compiledMappings:[]})];case 3:return B.sent(),[3,4];case 4:return[2]}})})}},35988:function(rt,be,u){u.d(be,{AU:function(){return Ue},B4:function(){return Xe},C2:function(){return Y},Cb:function(){return e},Fm:function(){return le},NG:function(){return X},R1:function(){return q},Tm:function(){return xe},hj:function(){return B},qV:function(){return L},tc:function(){return ie},vr:function(){return Te}});var z,P,Pe,J,he,ce,m=u(70940),A=u(54834),K=u(62458),W=u(43286),H=u(80777),Be=((z={}).GeneratedLinguisticSchema=0,z.DataIndexBuildingCancelled=16,z.DataIndexMissingStatistics=17,z.DataIndexNotReady=8,z.DataIndexSizeLimitReached=15,z.DataIndexUpdateFailure=10,z.DomainModelNotReady=2,z.DomainModelPartialLoad=3,z.DomainModelUpdateFailure=9,z.EmptyLinguisticSchema=1,z.InterpretationSemanticError=4,z.InterpretationSemanticWarning=5,z.InterpretCancelled=18,z.InvalidTextualEntity=6,z.LinguisticSchemaTruncated=14,z.MissingOrInvalidPodParameters=13,z.QueryAggregateNotSupported=19,z.QueryMedianNotSupported=20,z.QueryPercentileNotSupported=21,z.QueryScopedEvalNotSupported=22,z.QuerySubqueryRegroupingNotSupported=23,z.StaleDataIndex=12,z.StaleDomainModel=11,z.RequiresNewerVersion=7,z.DataIndexVersionIsOld=24,z.QueryGroupByTableNotSupported=25,z.QueryNotSupported=26,z.NextBestInterpretation=27,z),Oe=((P={}).ActivationFailure="ActivationFailure",P.CloudRlsModelAccessDenied="CloudRlsModelAccessDenied",P.DataIndexBuildFailure="DataIndexBuildFailure",P.DomainModelLoadFailure="DomainModelLoadFailure",P.ExternalModelAccessDenied="ExternalModelAccessDenied",P.GenericRequestFailure="GenericRequestFailure",P.LinguisticSchemaLoadFailure="LinguisticSchemaLoadFailure",P.ModelNotFound="ModelNotFound",P.ModelQnaNotEnabled="ModelQnaNotEnabled",P.ModelQnaNotSupported="ModelQnaNotSupported",P.RequiresNewerVersion="RequiresNewerVersion",P.SchemaLanguageNotSupported="SchemaLanguageNotSupported",P.MissingRuntimeModule="MissingRuntimeModule",P.VerifyRuntimeFailure="VerifyRuntimeFailure",P.DataIndexMissingAllStatistics="DataIndexMissingAllStatistics",P),ue=((Pe={})[16]="Qna_Warning_DataIndexIncomplete_Desktop",Pe[15]="Qna_Warning_DataIndexIncomplete_Desktop",Pe[14]="Qna_Warning_LinguisticSchemaTruncated_Desktop",Pe),$e=((J={})[16]="Qna_Warning_DataIndexIncomplete_Service",J[15]="Qna_Warning_DataIndexIncomplete_Service",J[14]="Qna_Warning_LinguisticSchemaTruncated_Service",J),We=[2,8,11,12,24],dt=[2,8],b=((he={})[1]="Qna_NotAllowedForReport_WithoutModel",he[2]="Qna_Explore_WarningBuildingLanguageModel",he[7]="Qna_Warning_RequiresNewerVersion",he[8]="Qna_Explore_WarningIndexing",he[9]="Qna_Warning_ModelUpdateFailure",he[10]="Qna_Warning_DataIndexUpdateFailure",he[11]="Qna_Warning_StaleModel",he[12]="Qna_Warning_StaleIndex",he[17]="Qna_Warning_DataIndexMissingStatistics",he[19]="Qna_Warning_UnsupportedFunction",he[20]="Qna_Warning_UnsupportedFunction",he[21]="Qna_Warning_UnsupportedFunction",he[22]="Qna_Warning_UnsupportedFunction",he[23]="Qna_Warning_UnsupportedFunction",he[25]="Qna_Warning_QueryGroupByTableNotSupported",he[26]="Qna_Warning_QueryNotSupported",he[27]="Qna_Warning_NextBestInterpretation",he),de=((ce={}).FeatureNotAvailable="Qna_Error_GenericRequestFailure",ce.NetworkConnectionIssue="Qna_Error_NetworkIssue",ce.RequiresNewerVersion="Qna_Error_RequiresNewerVersion",ce.ModelNotFound="Qna_Error_ModelNotFound",ce.ModelQnaNotEnabled="Qna_Error_ModelQnaNotEnabled",ce.ModelQnaNotSupported="Qna_Error_ModelQnaNotSupported",ce.MissingRuntimeModule="Qna_Explore_MissingBinaries",ce.VerifyRuntimeFailure="Qna_Explore_MissingBinaries",ce.SchemaLanguageNotSupported="Qna_NotAllowedForReport_QnaNotSupported",ce.SessionIsInactive="Qna_Error_GenericRequestFailure",ce.GenericRequestFailure="Qna_Error_GenericRequestFailure",ce.DataIndexBuildFailure="Qna_Explore_WarningFailedIndexing",ce.CloudRlsModelAccessDenied="Tile_RLS_NoAccess",ce.ExternalModelAccessDenied="Qna_Explore_ModelAccessDenied_WithoutSpecifyOwner",ce.DataIndexMissingAllStatistics="Qna_Error_DataIndexMissingAllStatistics",ce),oe=[19,20,22,21,23,25,26];function Xe(d){K.fF.assertValue(d,"Expect the given wireV3Response to be defined");var v=Ae(d);if(v)return{error:v};var S=_.first(d.Results),O=_.first(S?.Interpretations);return{result:{utterances:_.map(O?.SuggestedUtterances,function(V){return{text:V.Text,source:V.Source}}),warnings:Ve(S?.DiagnosticMessages)}}}function q(d,v,S,O){K.fF.assertValue(O,"Expect the given wireV3Response to be defined");var se,pe,V=Ae(O);if(!V){var ge=_.first(O.Results);pe=Ve(ge?.DiagnosticMessages);var Qe=v??1,vt=_.take(ge?.Interpretations,Qe);_.isEmpty(vt)||(se=_.map(vt,function(nt){var at,ht,Ct;return{restatement:nt.Restatement,databaseName:null===(at=ge.Context)||void 0===at?void 0:at.DatabaseName,virtualServerName:null===(ht=ge.Context)||void 0===ht?void 0:ht.VirtualServerName,command:gt(nt.Command),correctionInfo:Bt(nt),spans:F(d,nt.Spans),language:ge.Language,modelLanguage:ge.ModelLanguage,modelOwner:null===(Ct=ge.Context)||void 0===Ct?void 0:Ct.ModelOwner,usedAgents:_.map(nt.UsedAgents,function(dn){return dn}),score:nt.Score,relevantSchemaElements:C(ge.RelevantSchemaElements)}}))}return{utterance:d,requestId:S,error:V,results:se,warnings:pe}}function C(d){if(null!=d&&(null!=d.Entities||null!=d.Relationships)){var v=function(O){return{description:O.Description,score:O.Score}};return{entities:_.map(d.Entities,v),relationships:_.map(d.Relationships,v)}}}function e(d){K.fF.assertValue(d,"Expect the given wireV3Response to be defined");var v=Ae(d);if(v)return{error:v};var S=_.first(d.Results);return{results:_.map(S?.Interpretations,function(V){return{language:S.Language}})}}function te(d){K.fF.assertValue(d,"Expect the given wireV3Response to be defined");var v=_.first(d.Results);return Ve(v?.DiagnosticMessages)}function le(d){K.fF.assertValue(d,"Expect the given wireResponse to be defined");var v=te(d);return _.find(We,function(S){return _.includes(v,S)})}function L(d){return K.fF.assertValue(d,"Expect the given wireResponse to be defined"),function(d){K.fF.assertValue(d,"Expect the given wireResponse to be defined");var v=te(d);return _.find(dt,function(S){return _.includes(v,S)})}(d)}function F(d,v){if(K.fF.assertValue(d,"utterance"),K.fF.assertAnyValue(v,"wireSpans"),v){_.isEmpty(d)&&K.fF.assert(function(){return _.every(v,function(V){return 0===V.Length})},"utterance is empty, every span should have zero length");var S=[],O=[];return _.forEach(v,function(V){5!==V.Resolution||V.Binding?S.push(new pt(d,V,!1)):O.push(new pt(d,V,!0))}),_.isEmpty(O)||_.forEach(O,function(V){_.forEach(S,function(se){if(function(d,v){return v.startIndex<=d.startIndex&&v.endExcludingIndex>d.startIndex||v.startIndex<d.endExcludingIndex&&v.endExcludingIndex>d.endExcludingIndex||d.startIndex<=v.startIndex&&d.endExcludingIndex>=v.endExcludingIndex||v.startIndex<=d.startIndex&&v.endExcludingIndex>=d.endExcludingIndex}(se,V))se.overlapSpans.push(V);else if(V.endExcludingIndex<se.startIndex)return})}),S}}function B(d){return"BadGateway"===d||"ConnectFailure"===d||"ConnectionClosed"===d||"GatewayTimeout"===d||"KeepAliveFailure"===d||"NameResolutionFailure"===d||"NetworkUnavailable"===d||"ProxyAuthenticationRequired"===d||"ProxyNameResolutionFailure"===d||"RequestTimeout"===d||"ServiceUnvailable"===d||"Timeout"===d||"AccessDenied"===d?"NetworkConnectionIssue":"FeatureNotAvailableError"===d?"FeatureNotAvailable":"GenericRequestFailure"}function G(d){return _.map(d,function(v){return{startIndex:v.StartIndex,endExcludingIndex:v.StartIndex+v.Length}})}function X(d){var v=me(d);return d&&(v.Context={ReportMetadata:un(d.reportMetadata)}),v}function ie(d,v,S){var O=me(d);return O.Context={ModelScopes:[{VirtualServerName:v,DatabaseName:S}],Tags:d?.tags,ImpersonatedUserPrincipalName:d?.impersonatedUserPrincipalName,ImpersonatedRoles:d?.impersonatedRoles,Feedback:Wt(d?.feedback)},O.Options||(O.Options={}),O}function me(d){return d?{Version:"3.3.0",Utterance:d.utterance,Spans:_.map(d.spans,function(v){var S={StartIndex:v.startIndex,Length:v.endExcludingIndex-v.startIndex};return v.inferredTerm&&(S.Binding={InferredTerm:jt(v.inferredTerm)}),S}),Options:Ne(d),LinguisticSchemaJson:d.linguisticSchemaJson,InferredTermBinding:jt(d.inferredTermBinding),Intent:ze(d.intent),IsCommitted:d.isCommitted,DesiredInterpretationsCount:d.desiredInterpretationsCount,GroupId:d.groupId,GroupSequenceNumber:d.groupSequenceNumber}:{Version:"3.3.0",Utterance:""}}function ze(d){if(d?.defineCalculation)return{DefineCalculation:{Language:d.defineCalculation.language,Options:d.defineCalculation.options}}}function Ne(d){return null==d?.options?{}:{QueryMetadata:(0,W.yE)(d.options,2),VisualConfiguration:(0,W.yE)(d.options,4),SupportPodQueries:(0,W.yE)(d.options,8),IncludeRelevantSchemaElements:(0,W.yE)(d.options,32),Spans:(0,W.yE)(d.options,64),Diagnostics:(0,W.yE)(d.options,128),FrameTree:!1,AllowFollowUpQuestion:!1,AllowInsightQueries:(0,W.yE)(d.options,512),InferUnknownModelTerms:(0,W.yE)(d.options,4096),AllowPlaceholderSuggestions:!1,SuggestFollowUp:!1,SuggestedUtterances:(0,W.yE)(d.options,2048),SkipCompletion:d.skipCompletion,SingleAnswerBias:(0,W.yE)(d.options,8192),SuggestedDefineCalculationUtterances:(0,W.yE)(d.options,16384),UseLlmParser:(0,W.yE)(d.options,65536)}}function Y(d){return _.map(d,function(v){var S,O;return{VirtualServerName:null===(S=v.model)||void 0===S?void 0:S.vsName,DatabaseName:null===(O=v.model)||void 0===O?void 0:O.dbName,ReportIds:v.reportIds}})}function Te(d){if(_.indexOf(d,27)>=0)return[];var v=_.intersection(d,oe);return _.map(v,function(S){return{warning:S,messageKey:b[S]}})}function xe(d,v){if(!_.isEmpty(d)){K.fF.assert(function(){return!_.isEmpty(v)},"Must provide a valid qnaProxyPath");for(var S=[],O="@powerbi/Qna/qnadesktop.module#QnaDesktopModule"===v?ue:$e,V=0,se=d;V<se.length;V++){var pe=se[V];if(O){var ge=O[pe];if(ge){S.push(ge);continue}}var Qe=b[pe];Qe&&S.push(Qe)}return _.uniq(S)}}function Ue(d,v){return v.get(de[d]||"Qna_Error_GenericRequestFailure")}function Ae(d){var v,S;if(K.fF.assertValue(d,"Expect the given wireV3Response to be defined"),"3.3.0"!==d.Version)v="RequiresNewerVersion";else{var O=_.first(d.Results);if(!O)return;S=_.find(O.DiagnosticMessages,function(pe){return 1===pe.Severity}),v=S?.Code}if(null!=v){var V=function(d){var v=Oe[d];return K.fF.assert(function(){return null!=v},"InterpretDiagnosticCodeToQnaErrorCodeMappings should contain key "+d),v||(v="NoClientHandling"),v}(v),se={errorCode:V,source:"GenericRequestFailure"===V?"PowerBI":"User",message:S?.Message,stackTrace:S?.StackTrace};return"NoClientHandling"===se.errorCode&&(se.message=_.isEmpty(se.message)?v+".":v+". "+se.message),se}}function Ve(d){if(!_.isEmpty(d)){for(var v=[],O=function(Qe){K.fF.assert(function(){return null!=Be[Qe.Code]},'unknown mapping to convert InterpretDiagnosticMessage "'+Qe.Code+'" to client interpret warning code'),Be[Qe.Code]&&v.push(Be[Qe.Code])},V=0,se=d.filter(function(ge){return 2===ge.Severity});V<se.length;V++)O(se[V]);return v}}var pt=function(){return function(v,S,O){this.utterance=v,this.wireSpan=S,this.isOverlappingSpan=O,this.startIndex=S.StartIndex,this.endExcludingIndex=S.StartIndex+S.Length,this.text=v.substr(S.StartIndex,S.Length),this.correctedStartIndex=S.CorrectedStartIndex,this.correctedEndExcludingIndex=null!=S.CorrectedStartIndex?S.CorrectedStartIndex+S.CorrectedLength:void 0,this.resolution=S.Resolution,this.isOverlapping=O,this.tokens=function(d,v,S){return _.map(S,function(O){var V=O.StartIndex-v;return K.fF.assert(function(){return _.inRange(V,0,_.size(d))},"Expect each token.StartIndex is a valid index with the given spanText and spanStartIndex"),K.fF.assert(function(){return!_.isEmpty(_.trim(d.substr(V,O.Length)))},"Expect no WireToken being pure space"),{startIndex:O.StartIndex,endExcludingIndex:O.StartIndex+O.Length,text:d.substr(V,O.Length)}})}(this.text,this.startIndex,S.Tokens);var V=$t(this.text,S.Binding);this.binding=V&&V.bindingInfo,this.isCorrected=!(!this.binding||!V.isCorrected);var se=Me(this.text,S.AlternateBindings),pe=Me(this.text,S.PhraseCompletions),ge=Me(this.text,S.PhraseExtensions),Qe=Me(this.text,S.SuggestedReplacements);(!_.isEmpty(se)||!_.isEmpty(pe)||!_.isEmpty(ge)||!_.isEmpty(Qe))&&(this.replacementBindings={alternates:se,phraseCompletions:pe,phraseExtensions:ge,suggestedReplacements:Qe}),this.inferredTermBindings=_.map(S.InferredTermBindings,function(ht){return{inferredBindingType:(d=ht.InferredTerm).Type,definitionPrompt:d.DefinitionPrompt,definitionText:d.DefinitionText,prefixText:d.PrefixText,suffixText:d.SuffixText,hintText:d.HintText,alternateDefinitionTexts:d.AlternateDefinitionTexts,linguisticSchemaItems:d.LinguisticSchemaItems,definedTerm:d.DefinedTerm,targetRole:d.TargetRole,metadata:d.Metadata};var d}),this.inferredTermBindingsUnsupported=S.InferredTermBindingsUnsupported,this.hasBinding=null!=this.binding||null!=this.replacementBindings||!_.isEmpty(this.inferredTermBindings),this.isWhiteSpace=!_.isEmpty(this.text)&&_.isEmpty(_.trim(this.text)),this.isUsed=!this.isOverlapping&&(null==this.resolution||0===this.resolution||4===this.resolution),this.isUnknown=3===this.resolution,this.isInferred=4===this.resolution,this.overlapSpans=[];var d,nt=!((d=this).isOverlapping||_.isEmpty(d.text)||tt(d)||je(d)||Gt(d))&&d.hasBinding&&d.isUsed,at=Gt(this);K.fF.assert(function(){return!(nt&&at)},"A span can not be definedWithOptions and undefinedWithOptions at the same time."),this.state=nt?"accepted":at&&this.isUsed?"warning":at?"error":"none"}}();function gt(d){if(d){var v=d.Query?A.ib.deserializeQuery(d.Query):void 0;return{query:v,queryMetadata:It(v,d.QueryMetadata),data:d.Data,binding:d.Binding,visualConfigurations:_.map(d.VisualConfigurations,function(O){var V=O.Query?A.ib.deserializeQuery(O.Query):void 0;return{visualizationType:O.VisualizationType,dataShapeBinding:O.DataShapeBinding,visualElements:O.VisualElements,query:V,queryMetadata:It(v,O.QueryMetadata)}}),suggestedVisualTypes:_.map(d.SuggestedVisualizations,function(O){return(0,m.s)(O.VisualizationType).name}),linguisticSchemaJson:d.LinguisticSchemaJson,linguisticSchemaItems:d.LinguisticSchemaItems,inferredTermMetadata:d.InferredTermMetadata,defineCalculation:xt(d.DefineCalculation)}}}function xt(d){if(d)return{expression:d.Expression,homeTable:d.HomeTable,format:d.Format}}function It(d,v){if(d&&v){var S=_.filter(v.Filters,function(V){return!!V}),O=_.filter(v.Select,function(V){return!!V});return{filters:_.map(S,function(V){return{Restatement:V.Restatement,type:void 0}}),selects:_.map(O,function(V){return{restatement:V.Restatement,valueType:cn(V.DefaultLabel?V.DefaultLabel.SemanticType:V.SemanticType),isGroup:V.IsGroup,defaultLabel:V.DefaultLabel?Ke(V.DefaultLabel.Expression,d):void 0,isExplicitSortBy:V.IsExplicitSortBy}})}}}function tt(d){var v,S;return 7===(null===(v=d.binding)||void 0===v?void 0:v.type)&&!d.isCorrected&&_.isEmpty(null===(S=d.replacementBindings)||void 0===S?void 0:S.suggestedReplacements)&&_.isEmpty(d.inferredTermBindings)}function je(d){var v,S;return 8===(null===(v=d.binding)||void 0===v?void 0:v.type)&&!d.isCorrected&&2===d.resolution&&_.isEmpty(null===(S=d.replacementBindings)||void 0===S?void 0:S.suggestedReplacements)&&_.isEmpty(d.inferredTermBindings)}function Gt(d){return!(d.isOverlapping||_.isEmpty(d.text)||tt(d)||je(d)||!(d.isCorrected||3===d.resolution||d.hasBinding&&!d.isUsed))}function $t(d,v){if(v&&!v.InferredTerm){var S,O;if(v.Table)S=v.Table,O=0;else if(v.Pod)S=v.Pod,O=1;else if(v.Property)S=v.Property,O=2;else if(v.Value)S=v.Value,O=3;else if(v.Range)S=v.Range,O=4;else if(v.VisType)S=v.VisType,O=5;else if(v.Composite)S=v.Composite,O=6;else if(v.Core)S=v.Core,O=7;else if(v.Phrasing)S=v.Phrasing,O=8;else if(v.TextualEntity)S=v.TextualEntity,O=9;else{if(!v.AnyEntity){var V=v;return void K.fF.assert(function(){return!!V.Literal},"Has binding type that is unhandled by client right now. Known unhandled types are: [Literal] and this is not a known type. Check to either update the known unhandled type list, or handle it on the client side.")}S=v.AnyEntity,O=10}return{bindingInfo:{type:O,text:S.Text,textSegmentsWithMatchInfo:ln(d,S.Text,S.MatchedSegments),matchType:S.MatchType,score:S.Score},isCorrected:S.Corrected}}}function ln(d,v,S){if(_.isEmpty(d)||_.isEmpty(S))return[{text:v,isMatched:!1}];for(var O=[],V=0,se=0,pe=S;se<pe.length;se++){var ge=pe[se];V<ge.StartIndex&&O.push({text:v.substring(V,ge.StartIndex),isMatched:!1}),O.push({text:v.substr(ge.StartIndex,ge.Length),isMatched:!0}),V=ge.StartIndex+ge.Length}return V<_.size(v)&&O.push({text:v.substring(V),isMatched:!1}),O}function Me(d,v){if(v){for(var S=[],O=0,V=v;O<V.length;O++){var pe=$t(d,V[O]);pe&&S.push(pe.bindingInfo)}return S}}function Wt(d){return d?{Sentiment:d.sentiment,Reason:d.reason,Comment:d.comment}:void 0}function un(d){return d?{LinguisticSchema:d.linguisticSchema,Pods:_.map(d.pods,function(v){return{Name:v.name,CortanaEnabled:v.cortanaEnabled,Parameters:_.map(v.parameters,function(S){return{Name:S.name,TargetColumn:S.targetColumn,TargetEntity:S.targetEntity}})}})}:void 0}function jt(d){return null==d?void 0:{Type:d.inferredBindingType,DefinitionPrompt:d.definitionPrompt,DefinitionText:d.definitionText,PrefixText:d.prefixText,SuffixText:d.suffixText,HintText:d.hintText,AlternateDefinitionTexts:d.alternateDefinitionTexts,LinguisticSchemaItems:d.linguisticSchemaItems,DefinedTerm:d.definedTerm,TargetRole:d.targetRole,Metadata:d.metadata}}function Bt(d){K.fF.assertValue(d,"result");var v=d.CorrectedUtterance;if(!_.isEmpty(v)){var O=d.ReplacementUtterance,V=2;return!!d.Command||(d.ConfidenceLevel<=5?V=0:d.ConfidenceLevel<=20&&(V=1)),_.isEmpty(d.CorrectedUtteranceTextSegments)?{correctedUtterance:v,replacementUtterance:O||v,state:V}:{correctedUtterance:v,correctedTextSegments:G(d.CorrectedUtteranceTextSegments),state:V}}}function cn(d){switch(d){case 0:case 1:case 2:case 3:return;case 4:return H.Ge.fromExtendedType(7078913);case 5:return H.Ge.fromDescriptor({dateTime:!0});case 6:return H.Ge.fromDescriptor({numeric:!0})}}function Ke(d,v){var S=A.ib.serializeQuery(v);S.Select.push(d);var O=A.ib.deserializeQuery(S);return _.last(O.select()).expr}}}]);