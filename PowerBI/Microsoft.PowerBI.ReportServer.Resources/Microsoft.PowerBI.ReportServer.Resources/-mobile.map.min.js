"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["map"],{74591:function(Ve,jt,c){c.r(jt),c.d(jt,{Map:function(){return Ye},callSafely:function(){return re},mapsModule:function(){return W},timeoutWrapped:function(){return Gt},unwrap:function(){return $e},wrap:function(){return Le},wrappedSetInterval:function(){return kt},wrappedSetTimeout:function(){return Ot}});var T=c(81337),tt=c(61160),M=c(98755),Vt=c(32554),pt=c(90120),et=c(56707),wt=c(54522),Tt=c(21181),Lt=c(18664),v=c(5962),Ut=c(11745),I=c(86108),N=c(33024),G=c(51129),Y=c(79811),H=c(86727),nt=c(77686),at=c(65741),it=c(72902),Te=c(40739),Re=c(11305),Xt=c(34002),Rt=c(74988),ge=c(56919),gt=c(90700),Kt=c(45296),st=c(64067),Ne=c(44783),Ge=c(38308),k=c(62458),Ie=c(15621),Be=c(88987),Jt=c(12913),ze=c(58778),B=c(56578),Ae=c(38078),me=c(38958),P=c(82755),lt=c(72489),ee=c(26543),ut=c(60066),Yt=c(5381),ye=c(49203),Ze=c(63972),ft=c(92379),Zt=c(32041),ae=c(59107),ie=c(10389),Oe=c(66232),ke=c(57952),He=c(79154),be=function(){function o(t,e,a){void 0===a&&(a=!0),this.mapControl=t,this.tooltipService=e,this.inertia=new ke.r(null,a),this.inertia.callback=function(i,r){return(0,v.M_)(t,i,r)}}return o.prototype.onMouseDown=function(t){var e=this,i=this.getMousePosition(),r=d3.select(t),n=!1,s=0,l=this.inertia;l.hasStarted()&&l.stop();var u=d3.select(window).on(o.Events.mouseMove,function(){var d,p=e.getMousePosition(),f=(d=o.getDelta(i,p))[0],m=d[1];n||(s+=Math.abs(f)+Math.abs(m))>o.DragPixelThreshold&&(n=!0,r.classed(o.DraggingCSS.class,!0),e.tooltipService.hide()),l.addPoint(p[0],p[1]),(0,v.M_)(e.mapControl,f,m),i=p}).on(o.Events.mouseup,function(){if(u.on(o.Events.mouseMove,null).on(o.Events.mouseup,null),n){var d=e.getMousePosition();l.addPoint(d[0],d[1]),r.classed(o.DraggingCSS.class,!1);var p=d3.event;p.target===r.node()&&r.on(o.Events.click,function(){(0,Oe.n)(p),r.on(o.Events.click,null)}),l.start()}})},o.prototype.getMousePosition=function(){var t=o.BodyNode=o.BodyNode||d3.select("body").node();return d3.mouse(t)},o.getDelta=function(t,e){return[e[0]-t[0],e[1]-t[1]]},o.DragPixelThreshold=5,o.Events={mouseDown:"mousedown.mapDrag",mouseMove:"mousemove.mapDrag",mouseup:"mouseup.mapDrag",click:"click.mapDrag"},o.DraggingCSS=(0,He.CH)("dragging-cursor"),o}(),We=function(){function o(t){this.navigationStrategy=it.jN.CategoryFirst,this.tooltipsEnabled=t}return o.prototype.init=function(t,e,a,i,r,n,s,l){this.host=s,this.mapControl=t,this.eventManager=l,this.pointLabelText=this.host.getLocalizedString("Generic_Point");var u=this.root=d3.select(e[0]);u.attr("drag-resize-disabled","true").style("display","inline-block").attr("tabindex",-1).attr("focusable",!1);var d=ae.M.isInternetExplorerOrEdge(),p=this.svg=u.append("svg").style("position","absolute").style("pointer-events","none").classed(v.nv,!d);n&&p.attr("tabindex",0).attr("focusable",!0).attr("aria-label",s.getLocalizedString("Visual_Plot")).attr("focus-nav-mode","Hierarchy").attr("aria-multiselectable","true").attr("role","listbox").classed(ut.Pg,!d),a&&(this.clearCapture=u),this.bubbleGraphicsContext=p.append("g").classed("mapBubbles",!0),this.sliceGraphicsContext=p.append("g").classed("mapSlices",!0),this.labelBackgroundGraphicsContext=p.append("g").classed(et.u9.class,!0),this.labelGraphicsContext=p.append("g").classed(et.ZL.class,!0),this.sliceLayout=d3.pie().value(function(f){return f.value}),this.arc=d3.arc(),this.style=r,this.clearMaxDataPointRadius(),this.dataLabelsSettings=(0,v.BP)(this.style),this.tooltipService=i},o.prototype.clearHeatMap=function(){this.mapControl&&this.mapControl.layers.clear(),this.heatMapLayer&&(this.heatMapLayer.clear(),this.heatMapLayer.dispose(),this.heatMapLayer=void 0)},o.prototype.setData=function(t){this.mapData=t},o.prototype.clearDataPoints=function(){this.style&&(this.mapData=(0,v.IG)(this.style),this.clearHeatMap())},o.prototype.hideDataPoints=function(){this.svg.style("display","none")},o.prototype.showDataPoints=function(){this.svg.style("display","")},o.prototype.getDataPointCount=function(){return this.mapData?_.filter(this.mapData.dataPoints,function(t){return!!t.location}).length:0},o.prototype.getDataPointPadding=function(){return 2*this.maxDataPointRadius},o.prototype.clearMaxDataPointRadius=function(){this.maxDataPointRadius=0},o.prototype.setMaxDataPointRadius=function(t){this.maxDataPointRadius=Math.max(t,this.maxDataPointRadius)},o.prototype.converter=function(t,e,a,i){void 0===i&&(i=!0);var r=this.mapControl,n=t.width/2,s=t.height/2;this.dataLabelsSettings=e;var u=Math.min(t.width,t.height)/384;this.clearMaxDataPointRadius();var d=[],p=[],f=this.mapData?this.mapData.dataPoints:[],m=this.mapData&&this.mapData.hasSize;this.navigableDataPoints=void 0;for(var g=0,S=f.length;g<S;g++){var x=f[g],E=x.categoryValue,b=x.location;if(b){if((0,v.N2)(b,!0))continue;var R=r.tryLocationToPixel(new Microsoft.Maps.Location(b.latitude,b.longitude));if(!R){k.fF.assertFail("tryLocationToPixel failed with the following location: "+JSON.stringify(b));continue}var C=R.x+n,w=R.y+s,h=x.radius*u;this.setMaxDataPointRadius(h);var L=x.subDataPoints,X=L.length;if(1===X)d.push({x:C,y:w,labeltext:E,radius:h,fill:(F=L[0]).fill,stroke:F.stroke,strokeWidth:1,tooltipInfo:F.tooltipInfo,identity:F.identity,selected:!1,labelFill:e.fontProperties.color,categoryIndex:g,seriesIndex:F.seriesIndex});else{for(var j=[],U=0;U<X;U++){var F;k.fF.assertValue(F=L[U],"Map's subdataPoint array should not be sparse."),j.push({x:C,y:w,labeltext:E,radius:h,fill:F.fill,stroke:F.stroke,strokeWidth:1,value:m?F.value:1,tooltipInfo:F.tooltipInfo,identity:F.identity,selected:!1,labelFill:e.fontProperties.color,categoryIndex:g,seriesIndex:F.seriesIndex})}a&&a.applySelectionStateToData(j),p.push(j)}}}return a&&a.applySelectionStateToData(d),{bubbleData:d,sliceData:p}},o.prototype.updateInternal=function(t,e,a,i,r,n){return k.fF.assertValue(e,"viewport"),this.mapRendererData=t,this.svg&&this.svg.style("width",e.width.toString()+"px").style("height",e.height.toString()+"px"),this.mapData&&this.mapData.properties.showHeatMap?this.renderHeatMapLayer(t):this.render(t,e,a,i,r)},o.getHeatMapLocations=function(t,e){var a=[],i=!1,r=_.filter(t,function(S){return null!=S.value});if(!_.isEmpty(r)){var n=_.map(r,function(S){return S.value}),s=_.min(n),u=_.max(n)-s;if(u>0){e.intensity=.1;for(var d=_.map(r,function(S){return Math.round((S.value-s)/u*9+1)}),p=0;p<r.length;p++)for(var f=r[p],m=d[p],g=0;g<m;g++)a.push(new Microsoft.Maps.Location(f.location.latitude,f.location.longitude));i=!0}}return i||(a=_.map(t,function(S){return new Microsoft.Maps.Location(S.location.latitude,S.location.longitude)})),a},o.prototype.getPlotAreaLassoSurface=function(){return this.svg},o.prototype.renderHeatMapLayer=function(t){var a,e=this;this.hideDataPoints(),this.mapData.properties.heatMapOptions&&((a=_.clone(this.mapData.properties.heatMapOptions)).intensity=.5);var i=_.filter(this.mapData.dataPoints,function(s){return null!=s.location}),r=o.getHeatMapLocations(i,a);return Microsoft.Maps.loadModule("Microsoft.Maps.HeatMap",function(){e.heatMapLayer?(e.heatMapLayer.clear(),e.heatMapLayer.setLocations(r),e.heatMapLayer.setOptions(a)):(e.heatMapLayer=new Microsoft.Maps.HeatMapLayer(r,a),e.mapControl.layers.insert(e.heatMapLayer))}),{bubbleEventGroup:this.bubbleGraphicsContext,sliceEventGroup:this.sliceGraphicsContext,bubbles:null,slices:null,clearCapture:this.clearCapture,dataPoints:null,root:this.root,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,eventManager:this.eventManager,hostServices:this.host}},o.prototype.render=function(t,e,a,i,r){var n=this.arc,s=i&&i.hasSelection(),l=ae.M.isInternetExplorerOrEdge();this.heatMapLayer&&this.heatMapLayer.clear(),this.showDataPoints();var u=this.bubbleGraphicsContext.selectAll(".bubble").data(t.bubbleData,function(h){return h.identity.getKey()}),d=new be(this.mapControl,this.tooltipService),p=u.enter().append("circle").classed("bubble",!0).merge(u);p.classed(ut.Pg,!l&&!!i).attr("cx",function(h){return h.x}).attr("cy",function(h){return h.y}).attr("r",function(h){return h.radius}).attr("tabindex",i?0:null).attr("focusable",!!i).attr("aria-selected",function(h){return h.selected}).attr("role","option").attr("aria-label",this.pointLabelText).style("fill",function(h){return h.fill}).style("stroke",function(h){return h.stroke}).style("fill-opacity",function(h){return(0,ut.eR)(h.selected,!1,s,!1)}).style("strokeWidth",function(h){return h.strokeWidth}).style("stroke-opacity",function(h){return(0,ut.eR)(h.selected,!1,s,!1)}).on("mousedown.drag",function(){return d.onMouseDown(d3.event.target)}),u.exit().remove(),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.bubbleGraphicsContext,function(h){return k.fF.assertValue(h.data,"Bubble map data for tooltip"),h.data&&h.data.tooltipInfo},function(h){return h.data&&h.data.identity&&[h.data.identity]}),p.style("pointer-events","all"));var f=t.sliceData,m=this.sliceGraphicsContext.selectAll(".sliceContainer").data(f),g=m.enter().append("g").classed("sliceContainer",!0).merge(m);m.exit().remove();var S=this.sliceLayout,x=g.selectAll(".slice").data(function(h){return S(h)},function(h){return h.data.identity.getKey()}),E=x.enter().append("path").classed("slice",!0).merge(x);E.classed(ut.Pg,!l&&!!i).style("fill",function(h){return h.data.fill}).style("fill-opacity",function(h){return(0,ut.eR)(h.data.selected,!1,s,!1)}).style("stroke",function(h){return h.data.stroke}).style("strokeWidth",function(h){return h.data.strokeWidth}).style("stroke-opacity",function(h){return(0,ut.eR)(h.data.selected,!1,s,!1)}).style("cursor","default").attr("transform",function(h){return(0,ie.Iu)(h.data.x,h.data.y)}).attr("d",function(h){return n.innerRadius(0).outerRadius(function(L){return L.data.radius})(h)}).attr("tabindex",i?0:null).attr("focusable",!!i).on("mousedown.drag",function(){return d.onMouseDown(d3.event.target)}),x.exit().remove(),this.updateInternalDataLabels(e,r),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.sliceGraphicsContext,function(h){return k.fF.assertValue(h.data,"Bubble map slice data for tooltip"),h.data&&h.data.data&&h.data.data.tooltipInfo},function(h){return h.data&&h.data.data&&[h.data.data.identity]}),E.style("pointer-events","all"));for(var b=t.bubbleData.slice(),R=0,C=f.length;R<C;R++)b.push.apply(b,f[R]);return{root:this.root,bubbleEventGroup:this.bubbleGraphicsContext,sliceEventGroup:this.sliceGraphicsContext,bubbles:_.isEmpty(t.bubbleData)?null:p,slices:_.isEmpty(t.sliceData)?null:E,clearCapture:this.clearCapture,dataPoints:b,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,hitTester:new je({dataPoints:b}),eventManager:this.eventManager,hostServices:this.host}},o.prototype.updateInternalDataLabels=function(t,e){var a=this.dataLabelsSettings,i=[];if(a&&(a.show||a.showCategory)){var r=this.createLabelDataPoints();i=new Ze.nu({maximumOffset:et.wh,startingOffset:et.ki}).layout([{labelDataPoints:r,maxNumberOfLabels:r.length}],{width:t.width,height:t.height})}(0,Yt.gm)({labelContext:this.labelGraphicsContext,dataLabels:i,backgroundContext:this.labelBackgroundGraphicsContext,numeric:!1,formatMode:!1,onObject:!1})},o.prototype.createLabelDataPoints=function(){var t=this.mapRendererData,e=[],a=t.bubbleData;a=a.concat(_.map(t.sliceData,function(g){return g[0]}));for(var i=this.dataLabelsSettings,r=pt.v.getThemeColor(this.style,et.pl),n=0,s=a;n<s.length;n++){var l=s[n];k.fF.assertValue(l,"dataPoint should never be null/undefined");var u=l.labeltext,d=i.fontProperties,p=(0,Lt.qk)(d,u),f=Zt.b.measureSvgTextWidth(p),m=Zt.b.estimateSvgTextHeight(p);e.push({isPreferred:!0,text:u,textSize:{width:f,height:m},outsideFill:d.color?d.color:r,insideFill:d.color?d.color:r,parentType:0,parentShape:{point:{x:l.x,y:l.y},radius:l.radius,validPositions:o.validLabelPositions},fontProperties:d,identity:void 0,hasBackground:i.enableBackground,backgroundColor:i.backgroundColor,backgroundTransparency:i.backgroundTransparency})}return e},o.prototype.getNavigationOptions=function(){return{helper:this,navigationStrategy:this.navigationStrategy}},o.prototype.getFirstElement=function(){this.navigableDataPoints=this.flattenViewModel();var t=_.find(this.navigableDataPoints,function(e){return!!e});return{element:this.getHtmlElementFromDataPoint(t)}},o.prototype.getNextDataPoint=function(t,e,a){_.isEmpty(this.navigableDataPoints)&&(this.navigableDataPoints=this.flattenViewModel());var i=(0,ye.R)(this.navigableDataPoints,t,e,it.jN.CategoryFirst,a);return{element:this.getHtmlElementFromDataPoint(i)}},o.prototype.flattenViewModel=function(){var t=[];if(this.mapRendererData.bubbleData&&!_.isEmpty(this.mapRendererData.bubbleData)){for(var e=0,a=this.mapRendererData.bubbleData;e<a.length;e++){var i=a[e];t.push({categoryIndex:i.categoryIndex,seriesIndex:i.seriesIndex})}return t}if(this.mapRendererData.sliceData&&!_.isEmpty(this.mapRendererData.sliceData)){for(var r=0,n=this.mapRendererData.sliceData;r<n.length;r++)for(var l=0,u=n[r];l<u.length;l++){var d=u[l];t.push({categoryIndex:d.categoryIndex,seriesIndex:d.seriesIndex})}return t}},o.prototype.getHtmlElementFromDataPoint=function(t){return this.bubbleGraphicsContext.selectAll(".bubble").filter(function(n){return n.seriesIndex===t.seriesIndex&&n.categoryIndex===t.categoryIndex}).node()||this.sliceGraphicsContext.selectAll(".slice").filter(function(n){return n.data.seriesIndex===t.seriesIndex&&n.data.categoryIndex===t.categoryIndex}).node()||(k.fF.assertFail("An html element couldn't be found for the given data point in MapBubbleDataPointRenderer.getHtmlElementFromDataPoint()."),null)},o.validLabelPositions=[1,2,4,8],o}(),je=function(){function o(t){this.dataPoints=t.dataPoints}return o.prototype.queryRegion=function(t){return _.filter(this.dataPoints,function(e){return ft.m.circleRectangleOverlap(t,{x:e.x,y:e.y},e.radius)})},o}(),Ue=c(65673),Xe=c(72494),Me=c(47316);function Ce(o,t,e,a){k.fF.assert(function(){return 8===e.length},"Array length should be 8 to match a rectangular shape"),k.fF.assert(function(){return!a||8===a.length},"Array length should be 8 to match a rectangular shape");for(var i=!0,r=[o.left,o.right],n=[o.top,o.bottom],l=0;l<r.length;l++)for(var u=0;u<n.length;u++)t(r[l],n[(g=l,S=u,0===g?S:1-S)],4*l+2*u,e,a)||(i=!1);var g,S;return i}function Se(o){var t=new Float64Array(8);return Ce(o,function(i,r,n,s){return s[n]=i,s[n+1]=r,!0},t),new ft.m(t)}var De=function(){function o(t,e){this.navigationStrategy=it.jN.CategoryFirst,this.filledMapDataLabelsEnabled=t,this.tooltipsEnabled=e}return o.buildPaths=function(t){var e=[];if(!_.isEmpty(t))for(var a=0,i=t;a<i.length;a++){var r=i[a],n=r.geographic;n&&n.length>2&&e.push(r)}return e},o.prototype.init=function(t,e,a,i,r,n,s,l){this.host=s,this.mapControl=t,this.polygonInfo=new v.n9;var u=ae.M.isInternetExplorerOrEdge();this.eventManager=l,this.pointLabelText=this.host.getLocalizedString("Generic_Point");var d=this.root=d3.select(e[0]);d.attr("drag-resize-disabled","true").attr("tabindex",-1).attr("focusable",!1);var p=this.svg=d.append("svg").style("position","absolute").style("pointer-events","none").classed(v.nv,!u);n&&p.attr("tabindex",0).attr("focusable",!0).attr("aria-label",s.getLocalizedString("Visual_Plot")).attr("focus-nav-mode","Hierarchy").attr("aria-multiselectable","true").attr("role","listbox").classed(ut.Pg,!u),a&&(this.clearCapture=d),this.shapeGraphicsContext=p.append("g").classed("mapShapes",!0),this.labelGraphicsContext=p.append("g").classed(et.ZL.class,!0),this.style=r,this.clearMaxShapeDimension(),this.dataLabelsSettings=(0,v.BP)(this.style),this.tooltipService=i},o.prototype.setData=function(t){this.mapData=t},o.prototype.clearDataPoints=function(){this.style&&(this.mapData=(0,v.IG)(this.style))},o.prototype.hideDataPoints=function(){this.svg.style("display","none")},o.prototype.showDataPoints=function(){this.svg.style("display","")},o.prototype.getDataPointCount=function(){return this.mapData?_.filter(this.mapData.dataPoints,function(t){return!!t.paths}).length:0},o.prototype.converter=function(t,e,a,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),!r&&this.mapRendererData)return this.mapRendererData;this.navigableDataPoints=void 0,this.clearMaxShapeDimension(),this.dataLabelsSettings=e;for(var s=[],l=this.mapData?this.mapData.dataPoints:[],u=0,d=l.length;u<d;u++){var p=l[u],f=p.subDataPoints[0],m=p.paths;if(!_.isEmpty(m)){for(var g=p.value,S=p.categoryValue,x=f.identity,E=x.getKey(),b=void 0,R=void 0,C=m.length;C-- >0;){var w=m[C];if(w&&w.absoluteBounds){this.setMaxShapeDimension(w.absoluteBounds.width,w.absoluteBounds.height);var h={left:w.absoluteBounds.left,top:w.absoluteBounds.top,right:w.absoluteBounds.left+w.absoluteBounds.width,bottom:w.absoluteBounds.top+w.absoluteBounds.height};b?(h.left<b.left&&(b.left=h.left),h.top<b.top&&(b.top=h.top),h.right>b.right&&(b.right=h.right),h.bottom>b.bottom&&(b.bottom=h.bottom)):(b={left:h.left,top:h.top,right:h.right,bottom:h.bottom},R=[]),R.push({boundingRect:h,path:w.absolute})}else k.fF.assertFail("MapShapeRenderer.converter encountered an invalid path"),m.splice(C,1)}if(_.isEmpty(m))continue;var L=m[o.getIndexOfLargestShape(m)].absolute,X=_.map(m,function(A){return(0,ie.Ay)(A.absolute)}).join(" "),F=void 0;this.mapData.properties.showStroke&&(F=_.map(m,function(A){return(0,ie.fg)(A.absolute,o.ReducedPathScale)}).join(" ")),s.push({mainShapePointArray:L,path:X,reducedPath:F,fill:f.fill,stroke:f.stroke,strokeWidth:1,tooltipInfo:f.tooltipInfo,identity:x,selected:!1,key:JSON.stringify({id:E}),labeltext:S,catagoryLabeltext:g?.toString(),categoryIndex:u,seriesIndex:f.seriesIndex,absoluteCenter:{x:(b.left+b.right)/2,y:(b.top+b.bottom)/2},globalBoundingRect:b,pathsWithBounds:R})}}return a&&a.applySelectionStateToData(s),{shapeData:s}},o.prototype.useReducedPaths=function(t){return this.mapData.properties.showStroke&&t<o.ReducedPathScaleLimit},o.prototype.updateInternal=function(t,e,a,i,r,n){k.fF.assertValue(e,"viewport"),this.mapRendererData=t,this.svg&&this.svg.style("width",e.width.toString()+"px").style("height",e.height.toString()+"px"),this.polygonInfo.reCalc(this.mapControl,e.width,e.height);var s=this.polygonInfo.scale,l=this.polygonInfo.transform,u=(0,v.oT)(),d=l,p=u,f=this.useReducedPaths(s);if(f){var m=_.clone(d.matrix);m.m00=m.m11=s/o.ReducedPathScale,d=new Ue.wx(m),p=(0,v.x6)(o.ReducedPathZoomLevel)}this.shapeGraphicsContext.attr("transform",this.polygonInfo.transformToString(d));var g=function(V,J,Q){return V?-Q:J?Q:0},S=e.width/2,x=function(V,J,Q){var vt=l.applyToPoint(V.absoluteCenter),ct=l.applyToPoint({x:V.absoluteCenter.x-J,y:V.absoluteCenter.y}),dt=l.applyToPoint({x:V.absoluteCenter.x+J,y:V.absoluteCenter.y}),mt=Math.abs(vt.x-S),yt=Math.abs(ct.x-S),ht=Math.abs(dt.x-S);return g(yt<mt,ht<mt,Q)},E=this.shapeGraphicsContext.selectAll("path").data(t.shapeData,function(D){return D.key}).style("transform",function(D){return"translateX(".concat(x(D,u,p),"px)")}),b=f?function(D){return D.reducedPath}:function(D){return D.path},R=new be(this.mapControl,this.tooltipService),C=E.enter().append("path").classed("shape",!0).attr("aria-selected",function(D){return D.selected}).attr("role","option").attr("aria-label",this.pointLabelText).attr("d",b).on("mousedown.drag",function(){return R.onMouseDown(d3.event.target)}).merge(E),w=f?s/o.ReducedPathScale:this.polygonInfo.scale,h=i&&i.hasSelection();C.classed(ut.Pg,!!i).attr("tabindex",i?0:null).attr("focusable",!!i).style("fill",function(D){return D.fill}).style("fill-opacity",function(D){return(0,ut.eR)(D.selected,!1,h,!1)}).style("outline-width","".concat(1/w,"px"));var F,A,L=this.mapData.properties.strokeColor,X=this.mapData.properties.strokeWidth;this.style.isHighContrast?(F=function(V){return V.stroke},A=function(V){return V.strokeWidth/w}):this.mapData.properties.showStroke?(F=function(V){return L||V.stroke},A=function(V){return(X||V.strokeWidth)/w}):(F=null,A=null),C.style("stroke",F).style("stroke-width",A),(a||this.lastRenderUsedReducedPaths!==f)&&C.attr("d",b),this.lastRenderUsedReducedPaths=f,E.exit().remove(),this.updateInternalDataLabels(e,r);var U=new Ke({absMapSize:u,applyOffset:g,dataPoints:t.shapeData,mapControl:this.mapControl,offset:p,transform:d,translateX:x,viewport:e});if(a)return this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.shapeGraphicsContext,function(D){return k.fF.assertValue(D.data,"Filled map data for tooltip"),D.data&&D.data.tooltipInfo},function(D){return D.data&&D.data.identity&&[D.data.identity]}),C.style("pointer-events","all")),{root:this.root,shapeEventGroup:this.shapeGraphicsContext,shapes:C,clearCapture:this.clearCapture,dataPoints:t.shapeData,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,hitTester:U,eventManager:this.eventManager,hostServices:this.host,widthDivisor:w};n&&n.bindHitTester(U)},o.prototype.getDataPointPadding=function(){return 12},o.prototype.getEnclosingBounds=function(){var t,e=this.mapData&&this.mapData.dataPoints;if(!_.isEmpty(e))for(var a=0,i=e;a<i.length;a++){var n=i[a].paths;if(!_.isEmpty(n))for(var s=0,l=n;s<l.length;s++){var u=l[s];u.geographic&&(t=(0,v.wu)(t,u.adjustedBounds))}}return t},o.getIndexOfLargestShape=function(t){for(var e=0,a=0,i=0,r=t.length;i<r;i++){var s=new ft.m(t[i].absolute),l=Math.abs(ft.m.calculateAbsolutePolygonArea(s.polygonPoints));l>a&&(e=i,a=l)}return e},o.prototype.updateInternalDataLabels=function(t,e){var a=this.dataLabelsSettings,i=[];if(a&&(a.show||a.showCategory)){var r=this.createLabelDataPoints();void 0===this.labelLayout&&(this.labelLayout=new Xe.Q),i=this.labelLayout.layout(r,{width:t.width,height:t.height},this.polygonInfo.transform,e)}this.drawLabelStems(this.labelGraphicsContext,i),(0,Yt.ng)({context:this.labelGraphicsContext,dataLabels:i,onObject:!1}),(0,Yt.x5)({labelContext:this.labelGraphicsContext,dataLabels:i,twoRows:a.show&&a.showCategory,formatMode:!1,onObject:!1})},o.prototype.getPlotAreaLassoSurface=function(){return this.svg},o.prototype.clearMaxShapeDimension=function(){this.maxShapeDimension=0},o.prototype.setMaxShapeDimension=function(t,e){this.maxShapeDimension=Math.max(t,this.maxShapeDimension),this.maxShapeDimension=Math.max(e,this.maxShapeDimension)},o.prototype.createLabelDataPoints=function(){var e=[];if(this.filledMapDataLabelsEnabled)for(var i=this.dataLabelsSettings,r=0,n=this.mapRendererData.shapeData;r<n.length;r++){var s=n[r],l=void 0,u=void 0,d=0,p=!1;if(this.dataLabelsSettings.show&&!this.dataLabelsSettings.showCategory){if(void 0===(l=s.catagoryLabeltext))continue}else if(this.dataLabelsSettings.showCategory&&!this.dataLabelsSettings.show){if(void 0===(l=s.labeltext))continue}else if(this.dataLabelsSettings.showCategory&&this.dataLabelsSettings.show){if(u=s.labeltext,void 0===(l=s.catagoryLabeltext)&&void 0===u)continue;p=!0}var f=(0,Tt.bT)({style:this.style,textClassName:"smallLightLabel",noColor:!0}).fontProperties;if(p){var m=(0,Lt.qk)(f,u);d=Zt.b.measureSvgTextWidth(m)}var g=(0,Lt.qk)(f,l),S=Zt.b.measureSvgTextWidth(g),x=Zt.b.estimateSvgTextHeight(g);u&&void 0!==s.labeltext&&void 0!==s.catagoryLabeltext&&(x*=2);var E=pt.v.getThemeColor(this.style,et.pl),b={parentType:2,parentShape:{polygon:new ft.m(s.mainShapePointArray),validPositions:o.validLabelPolygonPositions},text:l,secondRowText:u,textSize:{width:Math.max(S,d),height:x},insideFill:i.fontProperties.color,outsideFill:i.fontProperties.color?i.fontProperties.color:E,isPreferred:!1,identity:void 0,hasBackground:!0,fontProperties:i.fontProperties};e.push(b)}return e},o.prototype.drawLabelStems=function(t,e){var i=pt.v.getThemeColor(this.style,v.jj);e.map(function(r){r.leaderLine={strokeShow:!0,strokeColor:i,strokeWidth:1,strokeTransparency:50,strokePattern:Me.Dv.solid,strokeAutoScale:!1,strokeDashCap:Me.qH.none,strokeDashArray:null}}),(0,Yt.z8)(t,e,function(n,s){return n.identity?n.identity.getKeyWithoutHighlight():s})},o.prototype.getNavigationOptions=function(){return{helper:this,navigationStrategy:this.navigationStrategy}},o.prototype.getFirstElement=function(){this.navigableDataPoints=this.flattenViewModel();var t=_.find(this.navigableDataPoints,function(e){return!!e});return{element:this.getHtmlElementFromDataPoint(t)}},o.prototype.getNextDataPoint=function(t,e,a){_.isEmpty(this.navigableDataPoints)&&(this.navigableDataPoints=this.flattenViewModel());var i=(0,ye.R)(this.navigableDataPoints,t,e,it.jN.CategoryFirst,a);return{element:this.getHtmlElementFromDataPoint(i)}},o.prototype.flattenViewModel=function(){var t=[];if(this.mapRendererData.shapeData)for(var e=0,a=this.mapRendererData.shapeData;e<a.length;e++){var i=a[e];t.push({categoryIndex:i.categoryIndex,seriesIndex:i.seriesIndex})}return t},o.prototype.getHtmlElementFromDataPoint=function(t){return this.shapeGraphicsContext.selectAll(".shape").filter(function(i){return i.categoryIndex===t.categoryIndex&&i.seriesIndex===t.seriesIndex}).node()||(k.fF.assertFail("An html element couldn't be found for the given data point in MapShapeDataPointRenderer.getHtmlElementFromDataPoint()."),null)},o.validLabelPolygonPositions=[256,2,1,8,4,16,32,64,128],o.ReducedPathScale=.0078125,o.ReducedPathScaleLimit=.03125,o.ReducedPathZoomLevel=4,o}(),Ke=function(){function o(t){this.absMapSize=t.absMapSize,this.applyOffset=t.applyOffset,this.lazyCalculateTranslations=!1,this.mapControl=t.mapControl,this.offset=t.offset,this.originalDataPoints=t.dataPoints,this.transform=t.transform,this.translateX=t.translateX,this.viewport=t.viewport}return o.prototype.queryRegion=function(t){var e=this.transformAndTranslateSelectionRectangle(t);if(!e)return[];this.lazyCalculateTranslations||(this.dataPoints=this.calculateTranslations(this.originalDataPoints),this.lazyCalculateTranslations=!0);for(var a=[],i=0,r=this.dataPoints;i<r.length;i++){var n=r[i],s=ft.m.translateX(e,-n.translation);if(ft.m.polygonBoundsOverlap(s,Se(n.mapShape.globalBoundingRect)))for(var l=0,u=n.mapShape.pathsWithBounds;l<u.length;l++){var d=u[l];if(ft.m.polygonBoundsOverlap(s,Se(d.boundingRect))&&s.overlapPath(d.path)){a.push(n.mapShape);break}}}return a},o.prototype.transformAndTranslateSelectionRectangle=function(t){var e=this,a=new Float64Array(8),i=new Float64Array(8),r={x:0,y:0},n=this.transform.applyToPoint(r).x;r.x+=this.absMapSize;var s=this.transform.applyToPoint(r).x;if(!Ce(t,function(f,m,g,S,x){var R=new Microsoft.Maps.Point(f-e.viewport.width/2,m-e.viewport.height/2),C=e.mapControl.tryPixelToLocation(R,Microsoft.Maps.PixelReference.viewport);if(!C)return!1;a[g]=C.latitude,a[g+1]=C.longitude;var w=e.applyOffset(f<n,f>s,e.offset);return x[g]=w,x[g+1]=0,!0},a,i))return null;for(var u=(0,v.Sc)(a,this.absMapSize),d=0;d<u.length;d++)u[d]+=i[d];return new ft.m(u)},o.prototype.calculateTranslations=function(t){for(var e=[],a=0,i=t;a<i.length;a++){var r=i[a];e.push({mapShape:r,translation:this.translateX(r,this.absMapSize,this.offset)})}return e},o}(),Nt=Ae.b$.parseNumber,Ye=function(){function o(t){this.isDestroyed=!1,this.warnings=[],this.maxLevelOfDetail=v.Ch,this.minLevelOfDetail=v.z8,t.filledMap?(this.dataPointRenderer=new De(t.filledMapDataLabelsEnabled,t.tooltipsEnabled),this.filledMapDataLabelsEnabled=t.filledMapDataLabelsEnabled,this.isFilledMap=!0):(this.dataPointRenderer=new We(t.tooltipsEnabled),this.isFilledMap=!1),this.mapCredentials=v.Zr.BingKey,this.mapControlFactory=t.mapControlFactory,this.behavior=t.behavior,this.tooltipsEnabled=t.tooltipsEnabled,this.disableZooming=t.disableZooming,this.disablePanning=t.disablePanning,this.isLegendScrollable=!!t.behavior,this.viewChangeThrottleInterval=t.viewChangeThrottleInterval,this.boundsHaveBeenUpdated=!1,this.rescaleMap=t.rescaleMap,this.shouldSetSavedLocation=!0,this.dataPointLassoSelect=t.dataPointLassoSelect}return o.prototype.init=function(t){k.fF.assertValue(t,"options");var e=this.element=t.element;this.pendingGeocodingRender=0,this.eventManager=new ze.B(d3.select(e.get(0))),this.featureSwitches=t.featureSwitches,this.currentViewport=t.viewport,this.currentViewport.scale=this.currentViewport.scale||1,t.style||Jt.f.assertFail("Map style is missing"),this.style=t.style,this.host=t.host,this.behavior&&(this.interactivityService=(0,it.ub)(this.host,this.featureSwitches)),this.legend=(0,at.OG)(e,!1,this.interactivityService,this.isLegendScrollable,void 0,this.style,this.host),this.geoTaggingAnalyzerService=(0,Ie.P)().create(t.host.getLocalizedString.bind(t.host)),this.tooltipService=(0,Te.r)(this.host),this.host.locale&&(this.locale=this.host.locale()),this.geocoder=this.host.geocoder(),this.promiseFactory=this.host.promiseFactory(),this.mapTheme=Xt.uH,this.resetBounds(),this.isDestroyed=!1},o.prototype.destroy=function(){this.isDestroyed=!0;var t=this.mapControl;t&&(this.mapControl=void 0,setTimeout(function(){return t.dispose()},o.MapControlDisposeDelay)),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null)},o.prototype.addDataPoint=function(t,e){if(t===this.geocodingContext){var a;if(--t.dataPointsRemaining,!_.isEmpty(e.paths))for(var i=0,r=e.paths;i<r.length;i++)a=(0,v.wu)(a,r[i].adjustedBounds);if(!a){var s=e.location;a={west:s.longitude,east:s.longitude,north:s.latitude,south:s.latitude}}this.updateBounds(a),this.scheduleRedraw()}},o.prototype.geocodingFailed=function(t){!this.isDestroyed&&t===this.geocodingContext&&--t.dataPointsRemaining<=0&&this.scheduleRedraw()},o.prototype.scheduleRedraw=function(){var t=this;k.fF.assert(function(){return t.geocodingContext.dataPointsRemaining>=0},"geocodingContext.dataPointsRemaining underflow"),this.pendingGeocodingRender&&this.geocodingContext.dataPointsRemaining<=0&&(clearTimeout(this.pendingGeocodingRender),this.pendingGeocodingRender=0),!this.pendingGeocodingRender&&this.mapControl&&(this.pendingGeocodingRender=setTimeout(function(){t.updateInternal(!0,!0),t.pendingGeocodingRender=0},this.geocodingContext.dataPointsRemaining<=0?0:o.ScheduleRedrawInterval))},o.prototype.enqueueGeoCode=function(t,e,a){var i=this,r=function(s){i.completeGeoCode(t,e,s)};this.geocoder.tryGeocodeImmediate(e.queryLocation,0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(n){i.initiateGeocoding(n,r,e,t,a)},function(n){i.initiateGeocoding(void 0,r,e,t,a)})},o.prototype.completeGeoCode=function(t,e,a){e.location=a,this.addDataPoint(t,e)},o.prototype.enqueueGeoCodeAndGeoShape=function(t,e,a,i){var r=this,n=function(l){r.completeGeoCodeAndGeoShape(t,e,a,l)};this.geocoder.tryGeocodeImmediate(e.queryLocation,0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(s){r.initiateGeocoding(s,n,e,t,i)},function(s){r.initiateGeocoding(void 0,n,e,t,i)})},o.prototype.completeGeoCodeAndGeoShape=function(t,e,a,i){e.location=i,this.enqueueGeoShape(t,e,a)},o.prototype.initiateGeocoding=function(t,e,a,i,r){var n=this;t?void 0===t.latitude||void 0===t.longitude?this.geocodingFailed(i):e(t):this.geocoder.geocode(a.queryLocation,0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB(),{timeout:i.timeout.promise,credentials:this.mapCredentials}).then(function(s){!n.isDestroyed&&i===n.geocodingContext&&((0,v.N2)(s,!0)?(n.warningsSet&&!r.invalidLatLongCoordinatesFound&&(n.warnings.push(new Kt.zI),n.host.setWarnings(n.warnings)),r.invalidLatLongCoordinatesFound=!0,n.geocodingFailed(i)):e(s))},function(s){return n.geocodingFailed(i)})},o.prototype.enqueueGeoShape=function(t,e,a){var i=this;k.fF.assertValue(e.location,"cachedLocation"),this.geocoder.tryGeocodeBoundaryImmediate({latitude:e.location.latitude,longitude:e.location.longitude,category:this.geocodingCategory,levelOfDetail:a.level,maxGeoData:a.maxPolygons,entityType:e.location.entityType},0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(r){i.initiateGeoboundary(r,e,t,a)},function(r){i.initiateGeoboundary(void 0,e,t,a)})},o.prototype.initiateGeoboundary=function(t,e,a,i){var r=this;t?this.completeGeoShape(a,e,i,t):this.geocoder.geocodeBoundary({latitude:e.location.latitude,longitude:e.location.longitude,category:this.geocodingCategory,levelOfDetail:i.level,maxGeoData:i.maxPolygons,entityType:e.location.entityType},0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB(),{timeout:a.timeout.promise,credentials:this.mapCredentials}).then(function(n){!r.isDestroyed&&n&&a===r.geocodingContext&&r.completeGeoShape(a,e,i,n)},function(n){return r.geocodingFailed(a)})},o.prototype.completeGeoShape=function(t,e,a,i){(0,v.Yb)(i.locations),e.paths=De.buildPaths(i.locations),this.addDataPoint(t,e)},o.prototype.getOptimumLevelOfDetail=function(t,e,a){var i=this.dataPointRenderer.getDataPointCount();if(0===i)return this.minLevelOfDetail;var r=this.dataPointRenderer.getDataPointPadding(),n=this.dataPointRenderer.getEnclosingBounds&&this.dataPointRenderer.getEnclosingBounds();if(n)n.west=a.west,n.east=a.east;else if(1===i){var s;switch(this.geocodingCategory){case v.yV.Continent:s=130;break;case v.yV.CountryRegion:s=90;break;case v.yV.StateOrProvince:s=25;break;case v.yV.County:s=3;break;case v.yV.City:s=.7;break;case v.yV.PostalCode:s=.3;break;case v.yV.Place:s=.1;break;default:s=.04}n={west:a.west-s/2,north:this.maxLatitude,east:a.east+s/2,south:this.minLatitude}}else n={west:a.west,north:this.maxLatitude,east:a.east,south:this.minLatitude};for(var l=v.Ch;l>=v.z8;l--){var u=(0,v.Jy)(n.north,n.west,l,{unconstrained:!0}),d=(0,v.Jy)(n.south,n.east,l,{unconstrained:!0});if(Math.abs(d.x-u.x)+r<=t&&Math.abs(u.y-d.y)+r<=e)return l}return this.minLevelOfDetail},o.prototype.getMapView=function(t,e){var a=this.getSmallestEnclosingLongitudeRange(),i=(0,v.q1)((a.west+a.east)/2),r=this.getOptimumLevelOfDetail(t,e,a);r<=v.z8&&(i=0);var n=(0,v.Jy)(this.maxLatitude,i,r),s=(0,v.Jy)(this.minLatitude,i,r);return{center:(0,v.n8)((n.x+s.x)/2,(s.y+n.y)/2,r),levelOfDetail:r}},o.prototype.getSmallestEnclosingLongitudeRange=function(){var t=this.longitudes;if(_.isEmpty(t))return{west:0,east:0};if(1===t.length)return{west:t[0].west,east:t[0].east};t.sort(function(u,d){return u.west-d.west});var e=t[0].west,a=_.maxBy(t,function(u){return u.east}).east;if(a-e<=180)return{west:e,east:a};for(var i=e,r=a,n=r-i,s=1;s<t.length;++s){e=t[s].west;var l=(a=Math.max(a,t[s-1].east+360))-e;l<n&&(i=e,r=a,n=l)}return{west:i,east:r}},o.prototype.resetBounds=function(){this.boundsHaveBeenUpdated=!1,this.minLatitude=v.w6,this.maxLatitude=v.jv,this.longitudes=[]},o.prototype.updateBounds=function(t){var e=t.west,a=t.east,i=t.south,r=t.north,n=a-e;e=(0,v.q1)(e),this.longitudes.push({west:e,east:a=e+n}),this.boundsHaveBeenUpdated=!0,i<this.minLatitude&&(this.minLatitude=i),r>this.maxLatitude&&(this.maxLatitude=r)},o.prototype.renderLegend=function(t){this.legend.setPosition(t.position),this.legend.drawLegend({data:t,parentViewport:this.currentViewport})},o.calculateGroupSizes=function(t,e,a,i,r){for(var s=e.length,l=0,u=t.values[0].values.length;l<u;++l){var d=null;if(i>=0)for(var p=0;p<s;++p){var f=e[p].values[i].values[l];f&&(null===d?d=f:d+=f)}a.push(d),d&&(r?(r.min=Math.min(r.min,d),r.max=Math.max(r.max,d)):r={min:d,max:d})}return r},o.calculateRadius=function(t,e,a,i){var r,n;if(void 0===i&&(i=1),null==t||null==e)return i*o.MarkerRadiusDefault;var l=a===gt.Dl.deprecated?o.MarkerRadiusDefault:o.MarkerRadiusMin;a===gt.Dl.auto&&(a=e.min>=0||e.max<=0?gt.Dl.magnitude:gt.Dl.dataRange),a===gt.Dl.magnitude&&(t&&(t=Math.abs(t)),e={min:0,max:Math.max(null!==(r=Math.abs(e.max))&&void 0!==r?r:0,null!==(n=Math.abs(e.min))&&void 0!==n?n:0)});var d=((t=Math.min(Math.max(t,e.min),e.max))-e.min)/(e.max-e.min||1);return k.fF.assert(function(){return d>=0&&d<=1},"valueRatio must be between 0 and 1"),i*((o.MarkerRadiusMax-l)*Math.sqrt(d)+l)},o.getGeocodingCategory=function(t,e){var a;if(a=e.getFieldTypeFromDescriptor(t.type))return a;if(a=e.getFieldType(t.displayName))return a;var n=t.roles;if(n)for(var s=Object.keys(n),l=0,u=s.length;l<u;++l){var d=e.getFieldType(s[l]);if(d)return d}},o.hasSizeField=function(t,e){if(_.isEmpty(t))return!1;for(var a=0,i=t.length;a<i;a++){var r=t[a].source.roles;if(!r&&a===e&&t[a].source.type.numeric)return!0;if(r)for(var n=Object.keys(r),s=0,l=n.length;s<l;s++)if("Size"===n[s])return!0}return!1},o.shouldEnumerateDataPoints=function(t,e,a){var i=(0,me.c5)(t,"Series"),n=(0,me.c5)(t,e?"Size":"Gradient");return(i||!n)&&!(a&&a.showHeatMap)},o.shouldEnumerateHeatMap=function(t,e){return!(t&&t.dataPoints&&t.dataPoints.length>1||e)},o.shouldEnumerateCategoryLabels=function(t,e,a){return(!t||e)&&!(a&&a.showHeatMap)},o.prototype.getMapSettingsCard=function(t,e){var a=this,n=M.jM.mapStyles,s=(0,T.pi)((0,T.pi)({},M.jM.mapControls),n),l=new B.CQ(new B.lg("mapSettings"),"Visual_AzureMapsMapSettings",s,function(d){return t.getLocalizedString(d)});return l.addGroup("style",function(u){u.withDisplayName("Style"),u.addSimpleSlice("style",new B.uY({descriptor:s.mapTheme,value:e.mapTheme}).build(),function(d){return d.withCustomDisplayName("Style")}).addSimpleSlice("showLabels",new B.bd({descriptor:s.showLabels,value:e.showLabels}).build())}),l.addGroup("controls",function(u){u.withDisplayName("Controls"),u.addSimpleSlice("autoZoom",new B.bd({descriptor:s.autoZoom,value:e.autoZoomEnabled}).build()).addSimpleSlice("showZoomButtons",new B.bd({descriptor:s.showZoomButtons,value:e.showZoomButtons}).build());var d=o.shouldEnumerateHeatMap(a.data&&a.data.legendData,a.isFilledMap);a.plotLassoManager&&(!d||!e.showHeatMap)&&u.addSimpleSlice("showLassoButton",new B.bd({descriptor:s.showLassoButton,value:e.showLassoButton}).build()),u.addSimpleSlice("geocodingCulture",new B.uY({descriptor:s.geocodingCulture,value:e.geocodingCulture||ge.gA}).build())}),l.build()},o.prototype.getLegendCard=function(t,e,a,i){return(0,H.ZF)({legendData:e},t,i,!a)},o.prototype.getBubblesCard=function(t){var e=this,a=function(u){return e.host.getLocalizedString(u)},i=M.jM.bubbles,r=M.jM.dataPoint,n=[r.fill,r.showAllDataPoints,r.defaultColor,i.bubbleSize,i.markerRangeType],s=new B.CQ(new B.lg("bubbles"),"Visual_Bubbles",n,a);return s.withDescription("Visual_BubblesDescription"),t&&!t.showHeatMap&&s.addGroup("size",function(l){var u;l.withDisplayName("Role_DisplayName_Size");var d={get:function(g){return e.host.getLocalizedString(g)},getOptional:function(g){return e.host.getLocalizedString(g)},format:function(g){return e.host.getLocalizedString(g)}},p=_.map(gt.Yu,function(m){return(0,T.pi)((0,T.pi)({},m),{displayName:m.displayName(d)})}),f=null!==(u=p.find(function(m){return m.value===t.markerRangeType}))&&void 0!==u?u:{value:gt.Dl.deprecated,displayName:e.host.getLocalizedString("Visual_MarkerRangeType_Deprecated")};l.addSimpleSlice("markerRangeType",new B.uY({descriptor:i.markerRangeType,items:p,value:f}).build(),function(m){var g;return m.withDisabled(!(null!==(g=e.data)&&void 0!==g&&g.hasSize))}),l.addSimpleSlice("size",new B.JN({descriptor:i.bubbleSize,value:(0,I.yn)(t.bubbleSizeMultiplier),localize:a,options:{minValue:{type:0,value:I.Ad.min},maxValue:{type:1,value:I.Ad.max}}}).build())}),this.addDataPointsDetails(t,s,a),s.build()},o.prototype.getFillColorsCard=function(t){var e=this,a=function(l){return e.host.getLocalizedString(l)},i=M.jM.dataPoint,r=[i.fill,i.showAllDataPoints,i.defaultColor],n=new B.CQ(new B.lg("fillcolors"),"Visual_FillColors",r,a);return this.addDataPointsDetails(t,n,a),n.build()},o.prototype.addDataPointsDetails=function(t,e,a){var i=this,r=this.data;!r||!o.shouldEnumerateDataPoints(this.dataView,this.isFilledMap,t)||e.addGroup("colors",function(n){if(n.withDisplayName("Visual_Colors"),r.hasSeries){var s={groupBuilder:n,dataPoints:(0,H.l3)(r.legendData),seriesColorProps:M.jM.dataPoint,localize:a,featureSwitches:i.featureSwitches};return(0,Vt.y0)(s)}var l={groupBuilder:n,colorProps:M.jM.dataPoint,featureSwitches:i.featureSwitches,hostService:i.host,options:{dataView:i.dataView,style:i.style,categories:_.map(r.dataPoints,function(u){var d=u.subDataPoints[0];return{color:(0,st.ci)(d.fill),displayName:u.categoryValue,identity:d.identity}}),fillInstanceKind:3}};(0,Vt.jN)(l)})},o.prototype.getCategoryLabelCard=function(t,e,a,i){if(o.shouldEnumerateCategoryLabels(this.isFilledMap,this.filledMapDataLabelsEnabled,a)){var r=M.jM.categoryLabels;return(0,Tt.Zu)({cardName:"Visual_CategoryLabels",dataLabelSettings:e,isShowCategory:!1,localize:function(l){return t.getLocalizedString(l)},props:r,revertToDefaultProps:r,showBackground:!0,showValueColor:!0,style:i})}},o.prototype.getHeatMapCard=function(){var e,t=this;if(this.data&&o.shouldEnumerateHeatMap(this.data.legendData,this.isFilledMap)&&(!this.data.legendData||_.isEmpty(this.data.legendData.dataPoints))){var i=this.data.properties,r=function(d){return t.host.getLocalizedString(d)},n=M.jM.heatMap,s=new B.CQ(new B.lg("heatmap"),"Visual_HeatMap",n,r),l=Rt.XT;return!(null===(e=i.heatMapOptions)||void 0===e)&&e.unit&&i.heatMapOptions.unit===Rt.zH&&(l=Rt.dw),s.addTopLevelToggle("show",function(){return new B.bd({descriptor:(0,T.pi)((0,T.pi)({},n.show),{selector:null}),value:i.showHeatMap}).build()}).addGroup("colors",function(u){var d,p,f;u.withDisplayName("Visual_Colors").addSimpleSlice("color0",new B.BT({descriptor:(0,T.pi)((0,T.pi)({},n.color0),{selector:null,instanceKind:1}),value:{value:null===(d=i.heatMapOptions)||void 0===d?void 0:d.colorGradient["0.20"]}}).build()).addSimpleSlice("color50",new B.BT({descriptor:(0,T.pi)((0,T.pi)({},n.color50),{selector:null,instanceKind:1}),value:{value:null===(p=i.heatMapOptions)||void 0===p?void 0:p.colorGradient[.65]}}).build()).addSimpleSlice("color100",new B.BT({descriptor:(0,T.pi)((0,T.pi)({},n.color100),{selector:null,instanceKind:1}),value:{value:null===(f=i.heatMapOptions)||void 0===f?void 0:f.colorGradient["1.00"]}}).build())}).addGroup("options",function(u){var d,p;u.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice("radius",new B.JN({descriptor:(0,T.pi)((0,T.pi)({},n.filterRadius),{selector:null}),value:null===(d=i.heatMapOptions)||void 0===d?void 0:d.radius,localize:r,options:{minValue:{type:0,value:1},maxValue:{type:1,value:l},unitSymbol:N.e_}}).build()).addSimpleSlice("displayUnits",new B.uY({descriptor:(0,T.pi)((0,T.pi)({},n.unit),{selector:null}),value:null===(p=i.heatMapOptions)||void 0===p?void 0:p.unit}).build(),function(f){return f.withCustomDisplayName("Visual_DisplayUnits").withAliasName("Decimal")}).addSimpleSlice("transparency",B.JN.getTransparencySliderBuilder({descriptor:(0,T.pi)((0,T.pi)({},n.transparency),{selector:null}),value:i.heatMapOptions&&Math.round(100*(1-i.heatMapOptions.opacity)),localize:r}).build())}),s.build()}},o.prototype.getFormattingModel=function(){var t=this,e=this.data?this.data.dataLabelSettings:(0,v.BP)(this.style),a=this.data?this.data.properties:(0,v.IG)(this.style).properties;return new B.Nq(function(){return t.getMapSettingsCard(t.host,a)},function(){return t.getLegendCard(t.host,t.data&&t.data.legendData,t.hasSeries,t.featureSwitches)},function(){return t.isFilledMap?t.getFillColorsCard(a):t.getBubblesCard(a)},function(){return t.getCategoryLabelCard(t.host,e,a,t.style)},function(){return t.getHeatMapCard()}).build()},o.prototype.update=function(t){return(0,T.mG)(this,void 0,void 0,function(){return(0,T.Jh)(this,function(e){switch(e.label){case 0:return null==t.resizeMode?[3,1]:(this.onResizingInternal(t),[3,3]);case 1:return[4,this.onDataChangedInternal(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},o.prototype.onDataChangedInternal=function(t,e){return void 0===e&&(e=!0),(0,T.mG)(this,void 0,void 0,function(){var a,i,r,n,s,l,d,p,f,m,g,S,x=this;return(0,T.Jh)(this,function(E){switch(E.label){case 0:return k.fF.assertValue(t,"options"),this.viewMode=t&&t.viewMode,this.resetBounds(),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null),this.geocodingContext={timeout:this.promiseFactory.defer(),dataPointsRemaining:0},a=this.geocodingContext,this.behavior&&this.behavior.resetZoomPan(),i=this.dataView=t&&t.dataViews&&t.dataViews[0],r=this.isFilledMap,this.warnings=[],this.warningsSet=!1,n=(0,v.IG)(this.style),i?(n=this.data=o.converter({dataView:i,geoTaggingAnalyzerService:this.geoTaggingAnalyzerService,isFilledMap:r,style:this.style,warnings:this.warnings}),this.dataPointRenderer.setData(n),this.hasSeries=n.hasSeries,[4,this.ensureMap()]):[3,2];case 1:if(E.sent(),this.isDestroyed)return[2];if(this.mapControl){if((s=n.properties.mapTheme)!==this.mapTheme&&(this.mapControl.setMapType((0,v.N0)(s)),this.mapTheme=s),(l=this.mapControl.getOptions()).showZoomButtons!==n.properties.showZoomButtons||n.properties.minZoom&&l.minZoom!==n.properties.minZoom||n.properties.maxZoom&&l.maxZoom!==n.properties.maxZoom)return d=this.mapControl,this.mapControl=void 0,this.dataPointRenderer.clearDataPoints(),d.dispose(),setTimeout(function(){x.root.empty(),x.initializeMapControl(),e&&setTimeout(function(){return x.onDataChangedInternal(t,!1)},250)},o.MapControlDisposeDelay),[2];if(n.properties.autoZoomEnabled&&!this.autoZoomWasEnabled?(n.properties.savedLatitude=void 0,n.properties.savedLongitude=void 0,n.properties.savedZoomLevel=void 0,this.persistZoomPanState(!0)):!n.properties.autoZoomEnabled&&this.autoZoomWasEnabled&&(this.updateZoomPanStateFromControl(),this.persistZoomPanState(!0)),this.autoZoomWasEnabled=n.properties.autoZoomEnabled,this.renderLegend(this.data.legendData),this.geocodingCategory=n.geocodingCategory,this.isDestroyed||a!==this.geocodingContext)return[2];for(p=void 0,r&&(p=(0,v.o)(this.geocodingCategory,n.dataPoints.length)),a.dataPointsRemaining=n.dataPoints.length,f=0,m=n.dataPoints;f<m.length;f++)(g=m[f]).location?r&&!g.paths?this.enqueueGeoShape(a,g,p):this.addDataPoint(a,g):null!=(S=g.categoryValue)&&""!==S?r?this.enqueueGeoCodeAndGeoShape(a,g,p,n):this.enqueueGeoCode(a,g,n):this.geocodingFailed(a);this.updateInternal(!0,!0)}return r&&(!this.geocodingCategory||!this.geoTaggingAnalyzerService.isGeoshapable(this.geocodingCategory))&&this.warnings.push(new Kt.Gh),n.invalidLatLongCoordinatesFound&&this.warnings.push(new Kt.zI),[3,3];case 2:this.clearDataPoints(),this.renderLegend((0,Y.Fe)(this.style)),this.dataPointRenderer.setData(n),this.updateInternal(!0,!0),E.label=3;case 3:return this.host.setWarnings(this.warnings),this.warningsSet=!0,[2]}})})},o.converter=function(t){if(o.isMatrixCase(t.dataView))return o.convertMatrix(t);var e=t.style,a=M.jM.general.formatString,i=(0,G.G)(t.dataView,{colorOptions:{valueRole:"Size",visualStyle:e},formatStringProp:a}),r=i.data,n=i.objects,s=[],l=r.hasSeries(),u=r.hasValues("Size"),d=null,p=i.objects.getStaticObjects(),f=(100-(0,P.NA)(p,M.jM.dataPoint.transparency,100*(1-o.innerGeometryAlpha)))/100,m=t.isFilledMap,g=!1,S=o.getMapPropertiesFromObjects(p,e,!l,t);if(r.hasCategories()){var x=[],E=void 0;if(u){for(var b=void 0,R=void 0,C=0,w=r.getCategoryCount();C<w;C++){for(var h=void 0,L=0,X=r.getSeriesCount();L<X;L++){var F=r.getValue("Size",C,L);null==h&&null!=F&&(h=0),null!=h&&(h+=F)}x.push(h),null!=h&&((void 0===b||h<b)&&(b=h),(void 0===R||h>R)&&(R=h))}E=void 0!==b&&void 0!==R?{max:R,min:b}:void 0}var A=r.hasCompositeCategories()&&r.hasCategoryWithRole("X")&&r.hasCategoryWithRole("Y"),j=r.hasCategoryWithRole("Category");if(j&&(d=o.getGeocodingCategory(_.last(t.dataView.categorical.categories).source,t.geoTaggingAnalyzerService)),A||j)for(C=0,w=r.getCategoryCount();C<w;C++){var U={components:[],culture:S.geocodingCulture},K=void 0,D=void 0,V=[],J=void 0,Q=void 0,vt=void 0,ct=void 0,dt=void 0;if(j){for(var mt=r.getAllCategoryDisplayNamesForRole("Category"),yt=r.getAllCategoryValuesForRole("Category",C),ht=n.getAllCategoryFormatStringsForRole("Category"),It=_.map(t.dataView.categorical.categories,function(te){return o.getGeocodingCategory(te.source,t.geoTaggingAnalyzerService)}),Bt=[],bt=0;bt<yt.length;++bt){var Pt=mt[bt],Mt=yt[bt],Ct=It[bt],O=(0,lt.WU)(Mt,ht[bt]);Bt.unshift(O),U.components.push({query:Mt&&O,category:Ct}),V.push({displayName:Pt,value:O})}if(K=Bt.join(", "),r.hasValues("Y")&&r.hasValues("X")){var Z=Nt(r.getFirstNonNullValueForCategory("Y",C)),q=Nt(r.getFirstNonNullValueForCategory("X",C));null!=Z&&_.isFinite(Z)&&null!=q&&_.isFinite(q)&&(D={latitude:Z,longitude:q}),J={displayName:r.getValueDisplayName("Y"),value:(0,lt.WU)(Z,n.getValueFormatString("Y"))},Q={displayName:r.getValueDisplayName("X"),value:(0,lt.WU)(q,n.getValueFormatString("X"))}}}else{Z=Nt(r.getCategoryValue("Y",C));var rt=(0,lt.WU)(Z,n.getCategoryFormatString("Y")),qt=(q=Nt(r.getCategoryValue("X",C)),(0,lt.WU)(q,n.getCategoryFormatString("X")));we(Z,q)&&(K=rt+", "+qt,D={latitude:Z,longitude:q},J={displayName:r.getCategoryDisplayName("Y"),value:rt},Q={displayName:r.getCategoryDisplayName("X"),value:qt})}var zt=u?x[C]:void 0;if((0,v.N2)(D,A))g=!0;else{var At=[];for(X=r.getSeriesCount(),!u&&!l&&(X=1),L=0;L<X;L++){var oe=l?r.getSeriesName(L):void 0;if(!l||u||!o.hasNoValuesAtInteresection(i,["Tooltips","X","Y"],C,L)){var Ht=i.colors.createBySeries(L,C),xt=(0,st.WV)(Ht);xt||(Ht=i.colors.createBySeries(L,C,void 0,!0),xt=(0,st.WV)(Ht));var St=o.getSubDataPointStrokeColor(xt,e),ne=(0,st.U8)(o.adjustSubDataPointFillColor(xt,e,f));l&&(vt={displayName:r.getSeriesDisplayName(),value:(0,lt.WU)(oe,n.getSeriesFormatString())});var Ft=void 0;if(u){Ft=r.getValue("Size",C,L);var se=r.getFormatString("Size",C,L)||i.objects.getValueFormatString("Size");ct={displayName:r.getValueDisplayName("Size"),value:(0,lt.WU)(Ft,se)}}if(r.hasValues("Gradient")){var le=r.getValue("Gradient",C,L),Wt=i.objects.getValueFormatString("Gradient");dt={displayName:r.getValueDisplayName("Gradient"),value:(0,lt.WU)(le,Wt)}}var z=[];_.isEmpty(V)||z.push.apply(z,V||[]),vt&&z.push(vt),J&&z.push(J),Q&&z.push(Q),ct&&z.push(ct),dt&&z.push(dt),(0,Re.VT)(i,z,C,L,a);var _t=i.identities.createForDataPoint(C,L,u?["Size"]:void 0);(Ft||!u||0===Ft&&m)&&At.push({value:Ft,fill:ne,stroke:St,identity:_t,tooltipInfo:z,seriesIndex:L})}}(zt||!u||0===zt&&m)&&At.length>0&&s.push({queryLocation:U,value:zt,categoryValue:K,subDataPoints:At,radius:o.calculateRadius(zt,E,S.markerRangeType,S.bubbleSizeMultiplier),location:D})}}}var ot={dataPoints:s,geocodingCategory:d,hasSeries:l,hasSize:u,properties:S,dataLabelSettings:o.calculateDataLabelSettings(t.dataView,m,e),legendData:(0,Y.pq)({dataView:t.dataView,style:e,showByDefault:!0}),invalidLatLongCoordinatesFound:g},ue=pt.v.getDataColorByIndex(e,0),Dt=(0,st.X6)(ue,.33);return ot.properties.heatMapOptions={opacity:1-(0,P.NA)(p,M.jM.heatMap.transparency,0)/100,radius:(0,P.NA)(p,M.jM.heatMap.filterRadius,10),unit:(0,P.NA)(p,M.jM.heatMap.unit,Rt.aA),colorGradient:{"0.20":(0,P.W7)(p,M.jM.heatMap.color0,Dt(0)),.65:(0,P.W7)(p,M.jM.heatMap.color50,Dt(.5)),"1.00":(0,P.W7)(p,M.jM.heatMap.color100,Dt(1))}},ot.properties.heatMapOptions.radius="meters"===ot.properties.heatMapOptions.unit?Math.min(ot.properties.heatMapOptions.radius,Rt.dw):Math.min(ot.properties.heatMapOptions.radius,Rt.XT),ot},o.getMapPropertiesFromObjects=function(t,e,a,i){var r={bubbleSizeMultiplier:(0,I.HN)((0,P.NA)(t,M.jM.bubbles.bubbleSize,1)),markerRangeType:(0,P.NA)(t,M.jM.bubbles.markerRangeType,gt.Dl.deprecated),autoZoomEnabled:(0,P.NA)(t,M.jM.mapControls.autoZoom,!0),savedLatitude:(0,P.NA)(t,M.jM.mapControls.centerLatitude),savedLongitude:(0,P.NA)(t,M.jM.mapControls.centerLongitude),savedZoomLevel:(0,P.NA)(t,M.jM.mapControls.zoomLevel),defaultDataPointColor:(0,P.W7)(t,M.jM.dataPoint.defaultColor,e.colorPalette.dataColors.getColorByIndex(0).value),fill:(0,P.W7)(t,M.jM.dataPoint.fill,e.colorPalette.dataColors.getColorByIndex(0).value),mapTheme:o.getMapThemeFromObjects(t,e),showHeatMap:a&&(0,P.NA)(t,M.jM.heatMap.show),showZoomButtons:(0,P.NA)(t,M.jM.mapControls.showZoomButtons,!1),showLassoButton:(0,P.NA)(t,M.jM.mapControls.showLassoButton,!1),minZoom:(0,P.NA)(t,M.jM.mapControls.minZoom,void 0),maxZoom:(0,P.NA)(t,M.jM.mapControls.maxZoom,void 0),showLabels:(0,P.NA)(t,M.jM.mapStyles.showLabels,!0),showStroke:(0,P.NA)(t,tt.Vh.stroke.show,!1),strokeColor:(0,P.W7)(t,tt.Vh.stroke.color,void 0),strokeWidth:(0,P.NA)(t,tt.Vh.stroke.width,void 0),geocodingCulture:(0,P.NA)(t,M.jM.mapControls.geocodingCulture,void 0)};return r.geocodingCulture&&!(0,ge._h)(r.geocodingCulture)&&(r.geocodingCulture=void 0,i.warnings.push(new Kt.aV)),r},o.convertMatrix=function(t){var e=t.dataView.metadata.objects,a=t.dataView.matrix,i=t.style,r=[],n=a.rows.root.children;if(!n)return(0,v.IG)(i);var b,s=(100-(0,P.NA)(e,M.jM.dataPoint.transparency,100*(1-o.innerGeometryAlpha)))/100,l=n.length,u={},d=0,p=a.rows.root.childIdentityFields,f=a.rows.levels[0].sources[0],m=M.jM.general.formatString,g=pt.v.create(i,M.jM.dataPoint.fill),S=!1,x=o.getMapPropertiesFromObjects(e,i,!1,t),E=o.calculateRadius(void 0,void 0,x.markerRangeType,x.bubbleSizeMultiplier);if(!_.isEmpty(a.valueSources)){b=[];for(var R=0;R<a.valueSources.length;++R){var C=a.valueSources[R];C.roles.Tooltips&&b.push({displayName:C.displayName,valueIndex:R})}}var w,h,L,X,F,A=a.rows.levels[1];if(null!=A&&!_.isEmpty(A.sources)&&(w=A.sources,A.sources.length>=2)){var j=A.sources[0],U=A.sources[1];j&&j.roles.X?(h=j,X=0):j&&j.roles.Y&&(L=j,F=0),U&&U.roles.X?(h=U,X=1):U&&U.roles.Y&&(L=U,F=1)}for(var K,D=0;D<l;D++){var V=n[D],J=V.children,Q=V.value,vt=(0,wt.xq)(Q,f,M.jM.general.formatString),ct=g.getColorForSeriesValue(V.objects,p,Q),dt=(0,st.WV)(ct);dt||(ct=g.getColorForSeriesValue(V.objects,p,Q,void 0,!0),dt=(0,st.WV)(ct));var mt=o.getSubDataPointStrokeColor(dt,i),yt=(0,st.U8)(o.adjustSubDataPointFillColor(dt,i,s)),ht={displayName:f.displayName,value:vt};if(w&&w[0].roles.Category){var It=w[w.length-1];K=o.getGeocodingCategory(It,t.geoTaggingAnalyzerService);for(var Bt=0,bt=J.length;Bt<bt;Bt++){var Pt=J[Bt],$t=(Mt=(new ee.dw).withColumnIdentity(Pt.identity,It.queryName)).createSelectionId().getKey(),Ct=Mt.withColumnIdentity(V.identity,f.queryName).createSelectionId();null==(O=u[$t])&&(O=d++,u[$t]=O);var Z=[],q={components:[],culture:x.geocodingCulture},rt=void 0;if(Pt.levelValues&&1!==Pt.levelValues.length){for(var zt=_.map(w,function(Et){return Et.displayName}),At=_.map(Pt.levelValues,function(Et){return Et.value}),oe=_.map(w,function(Et){return(0,P.NA)(Et.objects,{objectName:"general",propertyName:"formatString"})}),Ht=_.map(w,function(Et){return o.getGeocodingCategory(Et,t.geoTaggingAnalyzerService)}),xt=[],St=0;St<At.length;++St){var ne=zt[St],le=Ht[St],Wt=(0,lt.WU)(At[St],oe[St]);xt.unshift(Wt),q.components.push({query:Wt,category:le}),Z.push({displayName:ne,value:Wt})}rt=xt.join(", ")}else rt=(0,wt.xq)(Pt.value,It,m),Z.push({displayName:It.displayName,value:rt}),q.components.push({query:rt,category:K});(z=r[O])||(r[O]=z={categoryValue:rt,queryLocation:q,radius:E,subDataPoints:[],value:void 0}),ht&&Z.push(ht),z.subDataPoints.push({fill:yt,stroke:mt,identity:Ct,value:void 0,tooltipInfo:Z,seriesIndex:D})}}else if(f&&f.roles.Category&&f.roles.Series){K=o.getGeocodingCategory(f,t.geoTaggingAnalyzerService);var _t=(Ct=(new ee.dw).withColumnIdentity(V.identity,f.queryName).createSelectionId()).getKey();null==(O=u[_t])&&(O=d++,u[_t]=O),(z=r[O])||(r[O]=z={categoryValue:vt,queryLocation:{components:[{query:vt,category:K}]},radius:E,subDataPoints:[],value:void 0}),Z=[],ht&&Z.push(ht),z.subDataPoints.push({fill:yt,stroke:mt,identity:Ct,value:void 0,tooltipInfo:Z,seriesIndex:D})}else{if(!(h&&h.roles.X&&L&&L.roles.Y))return(0,v.IG)(i);for(var ot=0,ue=J.length;ot<ue;ot++){var Dt=J[ot],de=Nt(Dt.levelValues[X].value),he=Nt(Dt.levelValues[F].value);if(we(he,de)){var pe,fe,ve,Mt,O,z,Pe=(0,wt.xq)(de,h,m),te=(0,wt.xq)(he,L,m),xe=(Z=[],rt=te+", "+Pe,(Mt=(new ee.dw).withColumnIdentity(Dt.identity,L.queryName)).createSelectionId().getKey());if(Ct=Mt.withColumnIdentity(V.identity,f.queryName).createSelectionId(),(0,v.N2)(ve={latitude:he,longitude:de},!0)){S=!0;continue}if(pe={displayName:L.displayName,value:te},fe={displayName:h.displayName,value:Pe},null==(O=u[xe])&&(O=d++,u[xe]=O),(z=r[O])||(r[O]=z={categoryValue:rt,queryLocation:{components:[{query:rt,category:K}]},radius:E,subDataPoints:[],value:void 0,location:ve}),ht&&Z.push(ht),pe&&Z.push(pe),fe&&Z.push(fe),!_.isEmpty(b))for(var ce=0,Fe=b;ce<Fe.length;ce++){var Ee=Fe[ce];Z.push({displayName:Ee.displayName,value:(0,lt.WU)(Dt.values[Ee.valueIndex].value)})}z.subDataPoints.push({fill:yt,stroke:mt,identity:Ct,value:void 0,tooltipInfo:Z,seriesIndex:D})}}}}return{dataPoints:r,hasSeries:!0,geocodingCategory:K,hasSize:!1,properties:x,dataLabelSettings:o.calculateDataLabelSettings(t.dataView,t.isFilledMap,i),legendData:(0,Y.PP)({dataView:t.dataView,colorHelper:g,style:i,formatStringProp:m,showByDefault:!0}),invalidLatLongCoordinatesFound:S}},o.getMapThemeFromObjects=function(t,e){return e.isHighContrast?Xt.IZ:(0,P.NA)(t,M.jM.mapStyles.mapTheme,Xt.uH)},o.adjustSubDataPointFillColor=function(t,e,a){return void 0===a&&(a=o.innerGeometryAlpha),t.A=e.isHighContrast?void 0:a,t},o.getSubDataPointStrokeColor=function(t,e){return e.isHighContrast?pt.v.getThemeColor(e,Ne.fA):(0,st.Bx)((0,st._j)(t,o.StrokeDarkenColorValue))},o.isMatrixCase=function(t){return t.matrix&&!t.categorical},o.calculateDataLabelSettings=function(t,e,a){var i=(0,v.BP)(a),r=t.metadata&&t.metadata.objects;if(!r)return i;if(i.showCategory=(0,P.NA)(r,tt.Vh.categoryLabels.show,i.showCategory),e){i.precision=(0,P.NA)(r,tt.Vh.labels.labelPrecision,i.precision),i.precision=i.precision!==et.NZ&&i.precision<0?0:i.precision,i.displayUnits=(0,P.NA)(r,tt.Vh.labels.labelDisplayUnits,i.displayUnits);var n=r.labels;n&&(i.show=void 0!==n.show?n.show:i.show,void 0!==n.color&&(i.fontProperties=(0,Lt.ED)(i.fontProperties,{color:n.color.solid.color})))}else{var s=r.categoryLabels;s&&(0,Tt.ww)(s,i,void 0,a)}var l=pt.v.create(a);return i.enableBackground=(0,P.NA)(r,M.jM.categoryLabels.enableBackground,!0),i.backgroundColor=l.getColorForProperty(r,M.jM.categoryLabels.backgroundColor,et.lp),i.backgroundTransparency=(0,P.NA)(r,M.jM.categoryLabels.backgroundTransparency,100*v.Bz)/100,i},o.hasNoValuesAtInteresection=function(t,e,a,i){for(var r=!1,n=0,s=e;n<s.length;n++){var l=s[n];if(t.data.hasValues(l)&&(r=!0,!_.every(t.data.getAllValuesForRole(l,a,i),function(u){return null==u})))return!1}return r},o.prototype.swapLogoContainerChildElement=function(){var t=this.element.find(".LogoContainer");if(t){var e=t.find("a");if(null==e)return;var a=$("<div>");e.children().clone().appendTo(a),e.remove(),a.appendTo(t)}},o.prototype.onResizingInternal=function(t){var e=t.viewport;e.scale=e.scale||1,(this.currentViewport.width!==e.width||this.currentViewport.height!==e.height||this.currentViewport.scale!==e.scale)&&(this.currentViewport=e,this.data&&this.data.legendData&&this.mapControl&&(this.renderLegend(this.data.legendData),this.updateInternal(!1,!1),(0,v.ml)(this.mapControl)))},o.prototype.ensureMap=function(){var t=this;return this.ensuringMap?this.ensuringMap.promise:(this.ensuringMap=(0,Be.p)().defer(),this.mapControlFactory||(this.mapControlFactory=(0,v.$f)(this.promiseFactory,this.host.loader())),this.mapControlFactory.ensureMap(this.locale).then(function(){t.isDestroyed||(Le(),t.initializeMapControl())}))},o.prototype.createMapControl=function(t,e){var a={credentials:v.Zr.BingKey,mapTypeId:(0,v.N0)(this.mapTheme),disableZooming:this.disableZooming,disablePanning:this.disablePanning,enableClickableLogo:!1,showDashboard:!0,showMapTypeSelector:!1,showLocateMeButton:!1,showZoomButtons:!1,showScalebar:!1,showTrafficButton:!1,allowHidingLabelsOfRoad:!0,enableInertia:!1};e&&(a=(0,T.pi)((0,T.pi)({},a),e));var i=this.mapControlFactory.createMapControl(t,a),r=i.getZoomRange();return r&&(null!=r.min&&r.min>this.minLevelOfDetail&&(this.minLevelOfDetail=r.min),null!=r.max&&r.max<this.maxLevelOfDetail&&(this.maxLevelOfDetail=r.max)),i},o.prototype.initializeMapControl=function(){var e,t=this,a=null===(e=this.data)||void 0===e?void 0:e.properties,i=this.data?{showZoomButtons:a.showZoomButtons,mapTypeId:(0,v.N0)(a.mapTheme),minZoom:a.minZoom,maxZoom:a.maxZoom}:null;if(!this.root&&(this.root=(0,Ge.hi)().addClass(o.MapContainer.cssClass).css("position","absolute").appendTo(this.element[0]),!this.disableZooming)){var n,r=!1,l=function(){r&&(t.mapControl.setOptions({disableZooming:!1}),r=!1)},u=this.root[0];u.addEventListener("mouseup",function(g){0!==t.viewMode&&g.target.classList.contains("MicrosoftMap")&&(t.mapControl.setOptions({disableZooming:!0}),r=!0,n||(n=setTimeout(function(){n=void 0,l()})))},!0),u.addEventListener("mouseup",l,!1)}var d=this.root,p=this.createMapControl(d[0],i);if(this.data&&a.mapTheme&&(this.mapTheme=a.mapTheme),this.data&&null!=a.autoZoomEnabled&&(this.autoZoomWasEnabled=a.autoZoomEnabled),this.mapControl=p,this.streetsideManager=new Qe(p,function(g){if(g)t.dataPointRenderer.hideDataPoints();else{t.updateInternal(!0,!0),t.dataPointRenderer.showDataPoints(),t.updateZoomPanStateFromControl();var S=t.data.properties;S&&t.updateMapView(new Microsoft.Maps.Location(S.savedLatitude,S.savedLongitude),S.savedZoomLevel)}}),this.dataPointRenderer.init(p,d,!!this.behavior,this.tooltipService,this.style,this.interactivityService,this.host,this.eventManager),this.behavior&&this.dataPointLassoSelect&&this.dataPointRenderer.getPlotAreaLassoSurface){var f=this.dataPointRenderer.getPlotAreaLassoSurface(),m=d3.select(d[0]);this.plotLassoManager=new Ut.oW(!0),this.plotLassoManager.init([f,m],f,this.host,this.featureSwitches),this.lassoSelectionBehavior=new Ut.lk(this.behavior),this.plotLassoManager.behaviors.push(this.lassoSelectionBehavior),this.plotLassoManager.setUiScale(this.currentViewport.scale)}this.updateMapView(new Microsoft.Maps.Location(25,0),this.minLevelOfDetail),void 0!==this.viewChangeThrottleInterval?Microsoft.Maps.Events.addThrottledHandler(p,"viewchange",function(){t.onViewChanged()},this.viewChangeThrottleInterval):Microsoft.Maps.Events.addHandler(p,"viewchange",function(){t.onViewChanged()}),Microsoft.Maps.Events.addHandler(p,"viewchangeend",function(){t.onViewChangeEnded()}),this.streetsideManager.start(),this.pendingGeocodingRender||this.updateInternal(!0,!0),this.ensuringMap.resolve()},o.prototype.onViewChanged=function(){!this.mapControl||this.streetsideManager.InStreetsideMode||this.data&&this.data.properties.showHeatMap||(this.updateOffsets(!1,!1),this.behavior&&this.behavior.viewChanged(),this.swapLogoContainerChildElement())},o.prototype.onViewChangeEnded=function(){!this.mapControl||this.streetsideManager.InStreetsideMode||(this.onViewChanged(),this.data&&!1===this.data.properties.autoZoomEnabled&&(this.updateZoomPanStateFromControl(),this.persistZoomPanState(!1)),this.dataPointRenderer.updateInternalDataLabels(this.currentViewport,!0))},o.prototype.getMapViewPort=function(){var t=this.currentViewport,e=this.legend.getMargins();if(this.rescaleMap){var i=this.currentViewport.scale;if(i)return{width:(t.width-e.width)*i,height:(t.height-e.height)*i}}return{width:t.width-e.width,height:t.height-e.height}},o.prototype.updateInternal=function(t,e){var a,i=this.data&&this.data.properties;if(this.mapControl&&i){var r=this.element.children(o.MapContainer.selector),n=this.getMapViewPort();if(r.height(n.height),r.width(n.width),this.rescaleMap&&(r.css("transform","scale("+1/this.currentViewport.scale+")"),r.css("transform-origin","left top")),this.updateOffsets(t,e),this.behavior&&this.behavior.mapKeyboardAccessibility(this.host,this.data.properties.showZoomButtons),!this.behavior||!this.behavior.hasReceivedZoomOrPanEvent())if(this.shouldSetSavedLocation&&!1===i.autoZoomEnabled&&null!=i.savedLatitude&&null!=i.savedLongitude&&null!=i.savedZoomLevel)this.updateMapView(new Microsoft.Maps.Location(i.savedLatitude,i.savedLongitude),i.savedZoomLevel),this.shouldSetSavedLocation=!1;else if(this.boundsHaveBeenUpdated&&!0===i.autoZoomEnabled){var s=(a=this.getMapView(n.width,n.height)).center;this.updateMapView(s,a.levelOfDetail),this.shouldSetSavedLocation=!0}}},o.prototype.updateMapView=function(t,e){this.mapControl&&(e=Math.min(Math.max(e,this.minLevelOfDetail),this.maxLevelOfDetail),this.mapControl.setView({center:t,zoom:e,animate:!0,labelOverlay:this.data.properties.showLabels?Microsoft.Maps.LabelOverlay.visible:Microsoft.Maps.LabelOverlay.hidden}))},o.prototype.updateMapViewOnFocus=function(){var t,e=this.getMapViewPort(),a=(t=this.getMapView(e.width,e.height)).center;this.updateMapView(a,t.levelOfDetail)},o.prototype.updateOffsets=function(t,e){var a=this;if(!this.streetsideManager.InStreetsideMode){var r,i=this.dataView,n=this.getMapViewPort();r=i?this.dataPointRenderer.converter(n,this.data.dataLabelSettings,this.interactivityService,this.tooltipsEnabled,t):{bubbleData:[],shapeData:[],sliceData:[]};var s=this.dataPointRenderer.updateInternal(r,n,t,this.interactivityService,e,this.behavior);if(this.plotLassoManager&&(this.plotLassoManager.setUiScale(this.currentViewport.scale),this.syncLassoButton()),s&&(s.focusCallback=function(){a.updateMapViewOnFocus()}),(0,nt.xz)(d3.select(this.root[0]),this.legend),this.interactivityService&&s){var l=this.dataPointRenderer.getNavigationOptions();this.interactivityService.bind(s.dataPoints,this.behavior,s,{navigationOptions:l,pointSourceKey:"map"})}}},o.prototype.onClearSelection=function(){this.interactivityService.clearSelection(),this.updateOffsets(!1,!1)},o.prototype.onRestoreSelection=function(t){return!!this.interactivityService&&this.interactivityService.restoreSelection(t.selection)},o.prototype.clearDataPoints=function(){this.dataPointRenderer.clearDataPoints(),this.legend.drawLegend({data:(0,Y.Fe)(this.style),parentViewport:this.currentViewport})},o.prototype.updateZoomPanStateFromControl=function(){var t=this.data&&this.data.properties;if(t){var e=this.mapControl.getCenter();t.savedLatitude=e.latitude,t.savedLongitude=e.longitude,t.savedZoomLevel=this.mapControl.getZoom()}},o.prototype.persistZoomPanState=function(t){var e=this.data&&this.data.properties,a=e&&e.autoZoomEnabled,i=e&&e.showZoomButtons,r=e&&e.showLassoButton;k.fF.assert(function(){return null!=a},"autoZoom state should be resolved"),e&&0!==this.viewMode&&(a||k.fF.assert(function(){return _.isFinite(e.savedLatitude)&&_.isFinite(e.savedLongitude)&&_.isFinite(e.savedZoomLevel)},"valid zoom/pan values"),this.host.persistProperties({replace:[{objectName:"mapControls",selector:null,properties:a?{autoZoom:!0,showZoomButtons:i,showLassoButton:r}:{autoZoom:!1,showZoomButtons:i,centerLatitude:e.savedLatitude,centerLongitude:e.savedLongitude,zoomLevel:e.savedZoomLevel,showLassoButton:r}}]},t))},o.prototype.syncLassoButton=function(){var t=this,a=d3.select(this.root[0]).select(v.PN);if(!a.empty()){var i=[];this.lassoButtonShouldExist()&&i.push(1);var r=a.selectAll(v.Kq).data(i),n=r.enter().append("a").classed(v.mS,!0).classed(v.Gs,!0).attr("id",v.eP).attr("title",this.host.getLocalizedString(v.TM)).attr("role","button").attr("aria-label",this.host.getLocalizedString(v.TM)).on("click",function(){t.plotLassoManager.setForceLasso(!0),d3.event.stopPropagation()});n.append("div").classed(v.RR,!0).classed(v.tE,this.style.isHighContrast),n.merge(r).classed(v.tE,this.style.isHighContrast||this.data&&(0,Xt.VW)(this.data.properties.mapTheme)),r.exit().remove()}},o.prototype.lassoButtonShouldExist=function(){var t,e=null===(t=this.data)||void 0===t?void 0:t.properties;return this.data&&!e.showHeatMap&&e.showLassoButton},o.MapContainer={cssClass:"mapControl",selector:".mapControl"},o.innerGeometryAlpha=.6,o.StrokeDarkenColorValue=63.75,o.ScheduleRedrawInterval=3e3,o.MapControlDisposeDelay=1e3,o.MarkerRadiusMin=2,o.MarkerRadiusDefault=6,o.MarkerRadiusMax=20,o}();function we(o,t){return null!=o&&_.isFinite(o)&&null!=t&&_.isFinite(t)}var Gt,W,Ot,kt,Qe=function(){function o(t,e){this.mapControl=t,this.changedMode=e,this.InStreetsideMode=this.mapControl.getMapTypeId()===Microsoft.Maps.MapTypeId.streetside}return o.prototype.start=function(){var t=this;Microsoft.Maps.Events.addHandler(this.mapControl,"maptypechanged",function(e){return t.mapTypeChanged(e)})},o.prototype.mapTypeChanged=function(t){if(t.newMapTypeId===Microsoft.Maps.MapTypeId.streetside){if(this.InStreetsideMode)return;this.changeMode(!0)}else{if(!this.InStreetsideMode)return;this.startTransitionToRoadTimeout()}},o.prototype.cancelTransitionToRoadTimeout=function(){this.transitionToRoadTimeout&&(clearInterval(this.transitionToRoadTimeout),this.transitionToRoadTimeout=void 0)},o.prototype.startTransitionToRoadTimeout=function(){var t=this;this.transitionToRoadTimeout||(this.transitionToRoadTimeout=setInterval(function(){t.mapControl.getMapTypeId()!==Microsoft.Maps.MapTypeId.streetside?null!=t.mapControl.tryLocationToPixel(new Microsoft.Maps.Location(0,0))&&t.changeMode(!1):t.cancelTransitionToRoadTimeout()},v.h$))},o.prototype.changeMode=function(t){this.InStreetsideMode=t,this.cancelTransitionToRoadTimeout(),this.changedMode(t)},o}();function $e(){Gt&&(W.setTimeout=Ot,W.setInterval=kt,W=void 0,Gt=void 0)}function Le(){if(void 0===Gt){Gt=!1,W=Microsoft.Maps;var o=_.isFunction(W&&W.setTimeout),t=_.isFunction(W&&W.setInterval);if(W&&o&&t)try{Ot=W.setTimeout,kt=W.setInterval,W.setTimeout=function(e,a){return Ot.apply(this,[function(){return re(e)},a])},W.setInterval=function(e,a){return kt.apply(this,[function(){return re(e)},a])},Gt=!0}catch(e){W.setTimeout=Ot,W.setInterval=kt,Jt.f.error("Unable to wrap Microsoft.Maps.setTimeout",!1,void 0,{error:e&&e.stack||JSON.stringify(e)})}else Jt.f.error("Unable to wrap Microsoft.Maps.setTimeout",!1,void 0,{gotMapsModule:!!W,setTimeoutIsFunction:o,setIntervalIsFunction:t})}}function re(o){try{return o.apply(null)}catch(t){Jt.f.error("Exception in Microsoft.Maps timeout callback",!1,void 0,{error:t&&t.stack||JSON.stringify(t)})}}},58778:function(Ve,jt,c){c.d(jt,{B:function(){return pt}});var T=c(62458),tt=c(38078),M="BubblingEventListeners",Vt="BubblingEventManager",pt=function(){function I(N){this.root=N,this.registeredBubblingEvents={},this.registeredCapturedEvents={},this.rootNode=N.node(),(0,tt.aT)(this.rootNode,Vt,this)}return I.prototype.ensureEventRegistered=function(N,G){var Y=this,H=G?this.registeredCapturedEvents:this.registeredBubblingEvents;if(!H[N]){H[N]=!0;var nt=G?v:Ut,at="".concat(N,".").concat(Vt);G&&(at+="Capture"),this.root.on(at,function(){nt(Y.root)},G)}},I.prototype.on=function(N,G,Y,H){var nt=function(I){var N=I.indexOf(".");return-1===N?I:I.substr(0,N)}(G);this.ensureEventRegistered(nt,!!H);var at=wt(N,!0);if(at){var it=at[nt];it||(at[nt]=it={bubbling:{},captured:{}}),(H?it.captured:it.bubbling)[G]=Y}},I}();function wt(I,N){var G=(0,tt.aT)(I,M);if(!G){if(!N)return;(0,tt.aT)(I,M,G={})}return G}function Tt(I){for(var N in I){var G=I[N];G&&G()}}function Lt(I,N){for(var G=I.node(),Y=d3.event,H=Y.target;H;){var nt=wt(H,!1);if(nt){var at=nt[Y.type];at&&N(at)}if(H===G)break;T.fF.assert(function(){return!(0,tt.aT)(H,Vt)},"BubblingEventManagers cannot overlap"),H=H.parentElement}}function v(I){var N=[];Lt(I,function(Y){var H=Y.captured;H&&N.push(H)});for(var G=N.length;G-- >0;)Tt(N[G])}function Ut(I){Lt(I,function(N){var G=N.bubbling;G&&Tt(G)})}}}]);