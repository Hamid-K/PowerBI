"use strict";(self.webpackChunkreportServerHostModern=self.webpackChunkreportServerHostModern||[]).push([["drill-through"],{10778:function(pt,L,c){c.r(L),c.d(L,{DrillThroughModule:function(){return ht}});var p=c(81337),b=c(26898),W=c(39503),B=c(49080),H=c(83008),C=c(50423),R=function(){function r(){}return r.prototype.getNavigators=function(){return[]},r.\u0275prov=C.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac=function(e){return new(e||r)},providedIn:"root"}),r}(),U=c(11494),Z=c(83342),X=c(8590),T=c(87790),Y=c(42614),$=c(74642),h=c(62458),K=c(26743),O=c(95462),J=c(94419),w=c(30351),k=c(74082),q=c(45413);function rt(r,t,e,i){return h.fF.assertValue(r,"matchedSection"),h.fF.assertAnyValue(t,"selectorColumnValuePairs"),h.fF.assertAnyValue(e,"visualContainerAppliedFilters"),h.fF.assertValue(i,"schema"),{targetSectionName:r.sectionName,targetReportGuid:r.reportObjectId?r.reportObjectId:void 0,sectionDisplayName:r.sectionDisplayName,reportDisplayName:r.reportDisplayName?r.reportDisplayName:void 0,getFilterContext:function(){return function(r,t,e,i){for(var n=[],a=[],u=0,o=r.matchedLinkFields;u<o.length;u++){var s=o[u],l=s.fieldExpr;if(!s.asAggregation&&!(0,k.kb)(l)){for(var f=l.getKeyColumns(i),v=[],d=[],m=function(V){var F=_.findIndex(t,function(G){return(0,q.fS)(G.column,V)});h.fF.assert(function(){return-1!==F},"Expect every groupOn key of a matched section's column-type link field has a match in the selectors"),a.push(F),v.push(t[F].column),d.push(t[F].value)},x=0,N=f;x<N.length;x++)m(N[x]);var y=O.yl.fromSQExpr((0,J.Sh)(v,[d]));n.push({filterExpressionMetadata:{expressions:[l]},filter:y,isTransient:!1})}}if(1===r.allowedFiltersFromSource||2===r.allowedFiltersFromSource){if(!_.isEmpty(e)){var j=Y.l.getFiltersToApplyFromVisualQueryFilterContext(e);2!==r.allowedFiltersFromSource&&_.remove(j,function(I){return 2===I.scope});for(var S=0,A=j;S<A.length;S++){var D=A[S];n.push({filter:D.filter,isTransient:!0,filterExpressionMetadata:D.filterExpressionMetadata,restatement:D.restatement,type:D.type,displayName:D.displayName})}}for(var E=new $.L(i),g=function(V){if(_.includes(a,V))return"continue";var F=t[V],G=O.yl.fromSQExpr((0,J.qu)(0,F.column,F.value)),z=O.yl.fromSQExpr((0,J.Sh)([F.column],[[F.value]]));if(!_.find(n,function(Q){return O.yl.isSameFilter(Q.filter,G)||O.yl.isSameFilter(Q.filter,z)})){var vt=F.column.accept(E);n.push({filterExpressionMetadata:{expressions:[vt]},filter:z,isTransient:!0})}},P=0;P<t.length;P++)g(P)}return n}(r,t,e,i)},applyState:r.applyState}}var at={provide:"drillthrough",useFactory:function(r,t,e,i,n,a,u){var o=new st(r,t,e,i,n,u),s=[];if(s.push(o),a){var l=a.getNavigators();l&&s.push.apply(s,l||[])}return new Promise(function(f){f(new ot(t,e,u,o,s))})},deps:[U.J,b.i,H.D,W.z,B.J,R,Z.vZ]},ot=function(){function r(t,e,i,n,a){this.conceptualSchemaProxy=t,this.dataSources=e,this.featureSwitchService=i,this.defaultNavigator=n,this.drillthroughNavigators=a}return r.prototype.getMatchedSectionsInfo=function(t,e,i,n,a){return(0,p.mG)(this,void 0,void 0,function(){var u;return(0,p.Jh)(this,function(o){switch(o.label){case 0:return[4,this.getMatchedSections(t,void 0,e,i,n,a)];case 1:return u=o.sent(),[2,_.map(u,function(s){return _.extend(s.sectionInfo,{getFilterContext:s.action.getFilterContext})})]}})})},r.prototype.getForcedMatchSectionInfo=function(t,e,i,n,a,u){return(0,p.mG)(this,void 0,void 0,function(){var o,s,l;return(0,p.Jh)(this,function(f){switch(f.label){case 0:return[4,this.getMatchedSections(t,e,i,n,a,u)];case 1:return o=f.sent(),s=_.size(o),h.fF.assert(function(){return s<=1},"The target section name is given, at most 1 matching section might be found."),s<1?[2]:(l=o[0],[2,_.extend(l.sectionInfo,{getFilterContext:l.action.getFilterContext})])}})})},r.prototype.getDrillthroughActions=function(t,e,i,n){return(0,p.mG)(this,void 0,void 0,function(){var a;return(0,p.Jh)(this,function(u){switch(u.label){case 0:return[4,this.getMatchedSections(this.featureSwitchService.featureSwitches.onObject?2:0,void 0,t,e,i,n)];case 1:return a=u.sent(),[2,_.map(a,function(o){return o.action})]}})})},r.prototype.applyDrillthroughState=function(t,e){return void 0===e&&(e=!0),(0,p.mG)(this,void 0,void 0,function(){return(0,p.Jh)(this,function(i){return h.fF.assertValue(t,"action"),[2,t.applyState(t,e)]})})},r.prototype.getDrillthroughParameters=function(t){for(var e=[],i=0,n=this.drillthroughNavigators;i<n.length;i++){var u=n[i].getDrillthroughParameters(t);_.isEmpty(u)||e.push.apply(e,u||[])}return e},r.prototype.getMatchedSections=function(t,e,i,n,a,u){return(0,p.mG)(this,void 0,void 0,function(){var o,s,l,f,v,d,m,N;return(0,p.Jh)(this,function(M){switch(M.label){case 0:return 1!==_.size(a)?[2]:(o=function(r){h.fF.assertValue(r,"selectors");for(var t=[],e=0,i=r;e<i.length;e++){var n=i[e];if(n.dataMap)for(var a in n.dataMap)for(var u=0,o=n.dataMap[a];u<o.length;u++){var s=o[u];if(s){var f=s.expr;if(f){var v=(0,K.FD)(f);t.push(v)}}}}return t}(a),s=function(r){if(r){for(var t=[],e=function(o){o&&!_.isEmpty(o.args)&&1===o.values.length&&_.every(o.args,function(s,l){return t.push({column:s,value:o.values[0][l]})})},i=0,n=r;i<n.length;i++)e(n[i]);return t}}(o),0===_.size(s)&&0!==_.size(o)?[2]:(l=_.map(s,function(y){return y.column}),[4,this.conceptualSchemaProxy.get(this.dataSources.get())]));case 1:f=M.sent(),v=[],d=0,m=this.drillthroughNavigators,M.label=2;case 2:return d<m.length?[4,m[d].getMatchedSections(t,e,i,l,n,a,f)]:[3,5];case 3:N=M.sent(),_.isEmpty(N)||v.push.apply(v,N||[]),M.label=4;case 4:return d++,[3,2];case 5:return[2,_.map(v,function(y){return{sectionInfo:y,action:rt(y,s,u,f)}})]}})})},r.\u0275fac=function(e){C.\u0275\u0275invalidFactory()},r.\u0275prov=C.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(),st=function(){function r(t,e,i,n,a,u){this.eventBridge=t,this.conceptualSchemaProxy=e,this.dataSources=i,this.explorationNavigationService=n,this.explorationStateManager=a,this.featureSwitchService=u}return r.prototype.getMatchedSections=function(t,e,i,n,a,u,o){return(0,p.mG)(this,void 0,void 0,function(){var s,l,v;return(0,p.Jh)(this,function(d){return h.fF.assertValue(t,"targetSectionType"),h.fF.assertAnyValue(e,"targetSectionName"),h.fF.assert(function(){return!_.isEmpty(i)},"sourceSectionName should not be empty."),h.fF.assertAnyValue(n,"selectorColumnExprs"),h.fF.assertValue(a,"visualContainer"),h.fF.assertAnyValue(u,"selectors"),h.fF.assertValue(o,"schema"),(s=this.featureSwitchService.featureSwitches.onObject)&&0===t?(h.fF.assertFail("We do NOT expect calling getMatchedSections with targetSectionType being SectionType.Regular when onObject FS is on"),[2,[]]):s||2!==t?(l=T.W.getMeasuresFromSelectors(u,a,o),v=this.getMatchedSectionInfoImpl(1===t?2:1,e,i,n,l,o),_.isEmpty(v)?[2]:[2,v]):(h.fF.assertFail("We do NOT expect calling getMatchedSections with targetSectionType being SectionType.Drillthrough when onObject FS is off"),[2,[]])})})},r.prototype.applyDrillthroughState=function(t,e){return(0,p.mG)(this,void 0,void 0,function(){var i,n,a,u,o;return(0,p.Jh)(this,function(s){switch(s.label){case 0:if(h.fF.assertValue(t,"action"),!(i=this.explorationNavigationService.getSectionByName(t.targetSectionName)))return[2];if(!(n=T.W.getApplyStateInfoForInternallDrillthrough(i,t.getFilterContext(),e)))return[2];a=this.explorationStateManager.createApplyBookmarkActivity("DrillThroughFilters"),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return u=s.sent(),this.explorationStateManager.apply(n.state,u,n.options,a),e&&this.eventBridge.publishToChannel(X.t4l,{explorationContentChanged:!0}),a.resolve(),[3,4];case 3:return o=s.sent(),a.reject(o),[3,4];case 4:return[2]}})})},r.prototype.getDrillthroughParameters=function(t){if(_.isEmpty(t))return[];var e=this.explorationNavigationService.getCurrentExploration(),n=_.find(e.pods,function(a){return a.boundSection===t&&1===a.type});return n?n.parameters:[]},r.prototype.getMatchedSectionInfoImpl=function(t,e,i,n,a,u){var o=this;if(h.fF.assert(function(){return!_.isEmpty(i)},"fromSectionName should not be empty."),h.fF.assertAnyValue(n,"selectorColumnExprs"),h.fF.assertAnyValue(a,"selectorAggAndMeasureSQExprs"),h.fF.assertValue(u,"schema"),!_.isEmpty(n)||!_.isEmpty(a)){var s=this.explorationNavigationService.getCurrentExploration();h.fF.assertValue(s,"exploration");var f,l=s.pods;f=_.filter(l,function(E){return E.boundSection!==i&&(g=E,_.isEmpty(e)||g.boundSection===e)&&function(g){return g.type===t}(E);var g});for(var m=[],x=this.explorationNavigationService.getAllSections(),N=function(g){var P=_.find(x,function(V){return V.name===g.boundSection}),I=M.getMatchedInfoFromPod(g,P,n,a,u);I&&m.push(I)},M=this,y=0,j=f;y<j.length;y++)N(S=j[y]);if(!_.isEmpty(e)&&_.isEmpty(m)){var A=_.find(x,function(g){return g.name===e});if(!A||!this.isMatchingType(A.type,t))return;var S,D=1;(S=_.find(l,function(g){return g.boundSection===e}))&&1===S.config.acceptsFilterContext&&!(0,w.i)(S.type,S.parameters)&&(D=0),m.push({sectionDisplayName:A.displayName,sectionName:A.name,matchedLinkFields:[],allowedFiltersFromSource:D,applyState:function(P,I){return o.applyDrillthroughState(P,I)}})}return m}},r.prototype.getMatchedInfoFromPod=function(t,e,i,n,a){var u=this,o=_.filter(t.parameters,function(f){return!f.isLegacySingleSelection});if(!_.isEmpty(o)){var s=T.W.getMatchedLinkFieldsFromParameters(o,i,n,a);if(!_.isEmpty(s)){var l=0===t.config.acceptsFilterContext||(0,w.i)(t.type,t.parameters);return{sectionDisplayName:e.displayName,sectionName:e.name,matchedLinkFields:s,allowedFiltersFromSource:l?1:0,applyState:function(v,d){return u.applyDrillthroughState(v,d)}}}}},r.prototype.isMatchingType=function(t,e){return void 0===t||0===t?this.featureSwitchService.featureSwitches.onObject?0===e:1===e:2===t?1===e:1===t&&2===e},r}(),ut=c(77476),lt=c(52910),ct=c(82156),ht=function(){function r(){}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=C.\u0275\u0275defineNgModule({type:r}),r.\u0275inj=C.\u0275\u0275defineInjector({providers:[at],imports:[ut.CommonModule,lt.O,ct.N]}),r}()}}]);