"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["quick-measures-lazy"],{48563:function(Oe,de,a){a.d(de,{w:function(){return j}});var p=a(17819);function j(D){return D.map(function(oe){return function(D){return{name:D.Name,description:D.Description,category:$(D.Category),pushableToDQ:c(D.PushableToDirectQuery),parameters:W(D.Parameters),visualCalculationsInfo:D.VisualCalculationsInfo}}(oe)})}function $(D){switch(D){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9}}function c(D){var oe=0;return 1===D?oe=1:2===D?oe=2:3===D&&(oe=3),oe}function W(D){return D?D.map(function(oe){return function(D){return new p.Hw(D.Name,D.Optional,D.Repeatable,D.RepeatGroup,D.Skippable)}(oe)}):[]}},12846:function(Oe,de,a){a.d(de,{p:function(){return q}});var p=a(81337),j=a(15903),e=a(95867),$=a(5207);function W(d){return d.tables.filter(function(C){return C.schemaName!==$._.DataWarehouseSchema})}function h(d){return d.relationships.filter(function(C){return C.fromTable.schemaName!==$._.DataWarehouseSchema&&C.toTable.schemaName!==$._.DataWarehouseSchema})}function Y(d){if(d.variations&&d.variations.length>0)return d.variations[0].relationship.toTable.name}function Se(d){switch(d){case"Many":case"None":return"many";case"One":return"one"}}var be=a(68082),le=a(63708),Me=a(50423),q={provide:j.Pm,useClass:function(){function d(C){this.dataModelService=C}return d.prototype.init=function(C){this.calculationObjectInfo=(0,p.__assign)({},C)},d.prototype.reset=function(){this.calculationObjectInfo=void 0},d.prototype.getDaxModeConfigInputs=function(C){var x=function(d){return{tables:W(d).map(function(C){return function(d){return{name:d.name,isUserTable:(0,e.$i)(d),description:d.description,columns:d.columns?d.columns.map(function(C){return function(d){return{name:d.name,isUserColumn:(0,e.rh)(d),description:d.description,variationTable:Y(d)}}(C)}):[],measures:d.measures?d.measures.map(function(C){return function(d){return{name:d.name,description:d.description,expression:d.expression,isExternal:!!d.sourceLineageTag}}(C)}):[],calendars:d.calendars?d.calendars.map(function(C){return function(d){return{name:d.name}}(C)}):[]}}(C)}),relationships:d.relationships?h(d).map(function(C){return function(d){return{active:d.isActive,from:{table:d.fromTable.name,column:d.fromColumn?d.fromColumn.name:void 0,cardinality:Se(d.fromCardinality)},to:{table:d.toTable.name,column:d.toColumn?d.toColumn.name:void 0,cardinality:Se(d.toCardinality)}}}(C)}):[]}}(this.dataModelService.getDataModel()),T=this.isFunctionRestrictedMode(),S=this.getDaxCalculation(),N=this.filterWireDataSourceInfo(C);return Promise.resolve({serializableModel:x,wireDataSourceInfo:N,daxCalculation:S,isRestrictedMode:T})},d.prototype.getCalculationObject=function(){return this.calculationObjectInfo&&this.findCalculationObject({entityName:this.calculationObjectInfo.entityName,propertyName:this.calculationObjectInfo.propertyName,schemaName:this.calculationObjectInfo.schemaName,calculationEditMode:this.calculationObjectInfo.calculationEditMode})},d.prototype.findCalculationObject=function(C){var x,T=C.schemaName,S=C.entityName,N=C.propertyName,k=C.calculationEditMode;if(S){var M=(0,e.Lc)(this.dataModelService.getDataModel(),T,S,N);if(!M)return;var m=M.expression,g=M.expressionErrorMessage;if(2===k){var y=M.formatStringDefinition;m=null!==(x=y?.expression)&&void 0!==x?x:"",g=y?.errorMessage}var I={name:M.name,expression:m,schemaName:M.schemaName,calculationType:this.getCalculationType(M),calculationSyntaxType:d.getCalculationSyntaxType(k),expressionErrorMessage:g};return _.isEmpty(M.annotations)||(I=(0,p.__assign)((0,p.__assign)({},I),{expressionOverride:(0,e.MZ)(M),formulaOverride:(0,e.CE)(M),isNew:(0,e.e_)(M)})),I}},d.prototype.getDaxCalculation=function(){var C,x=this.calculationObjectInfo;if(x){var T=(C=this.calculationObjectInfo).schemaName,S=C.entityName,N=C.propertyName,k=(0,e.Lc)(this.dataModelService.getDataModel(),T,S,N);if(k){var M=this.getCalculationType(k),m=d.getCalculationSyntaxType(x.calculationEditMode);return{tableName:x.entityName,calculationName:x.propertyName,type:M,syntaxType:m}}}},d.prototype.isFunctionRestrictedMode=function(){if(!this.calculationObjectInfo)return!1;var x=this.calculationObjectInfo.entityName,T=(0,e.AG)(this.dataModelService.getDataModel(),x);return!!T&&T.capabilities.requirePushableToDirectQueryDax},d.prototype.getCalculationType=function(C){if(C)switch(C.objectType){case"Column":return le.eN.Column;case"Table":return le.eN.Table;case"Measure":return le.eN.Measure;case"CalculationItem":return le.eN.CalculationItem;default:return}},d.prototype.filterWireDataSourceInfo=function(C){return{functionDataFromEngine:C.functionDataFromEngine.filter(function(S){return!S.visualCalculationsInfo||0===S.visualCalculationsInfo}),reservedWords:C.reservedWords}},d.getCalculationSyntaxType=function(C){return 2===C?le.Up.Expression:le.Up.Formula},d.\u0275fac=function(x){return new(x||d)(Me.\u0275\u0275inject(be.n))},d.\u0275prov=Me.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac}),d}()}},15903:function(Oe,de,a){a.d(de,{$d:function(){return $},Pm:function(){return j},n9:function(){return e}});var p=a(50423),j=new p.InjectionToken("IntellisenseModelService"),e=new p.InjectionToken("FormulaBarBehaviorService"),$=new p.InjectionToken("FormulaBarZoomService")},72080:function(Oe,de,a){a.d(de,{e:function(){return le}});var p=a(81337),j=a(15903),e=a(17819),$=a(63513),c=a(48563),W=a(74249),h=a(26112),D=a(62458),oe=a(59694),Y=a(63708),ne=a(49088),me=a(50423),ve=a(65181),Se=a(34103),be=[" ","\t"],le=function(){function q(d,C,x,T){this.localizationService=d,this.intellisenseHostService=C,this.intellisenseModelService=x,this.daxCapabilitiesService=T}return q.prototype.onClientViewLoaded=function(d){this.intellisenseHostService.onClientViewLoaded(d)},q.prototype.onContentChanged=function(d,C,x,T,S){this.intellisenseHostService.onContentChanged(d,C,x,T,S)},q.prototype.setUICulture=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var d,C;return(0,p.__generator)(this,function(x){switch(x.label){case 0:return[4,this.intellisenseHostService.getCultureInfo()];case 1:return d=x.sent(),C=(0,h.K)(d),(0,e.g5)({listSeparator:C.listSeparator,numberDecimalSeparator:C.decimalSeparator}),[2]}})})},q.prototype.onEditorFocus=function(){this.intellisenseHostService.onEditorFocus()},q.prototype.endIntellisenseSession=function(){this.intellisenseModelService.reset(),this.intellisenseHostService.endIntellisenseSession()},q.prototype.startIntellisenseSession=function(d,C,x,T){this.intellisenseModelService.init({entityName:d,propertyName:C,schemaName:x,calculationEditMode:T}),this.intellisenseHostService.startIntellisenseSession(d,C,x,T)},q.prototype.getCalculationInfo=function(d){return(0,p.__awaiter)(this,void 0,void 0,function(){var C;return(0,p.__generator)(this,function(x){return(C=this.intellisenseModelService.findCalculationObject(d))&&null!=C.expression?[2,Promise.resolve({isNew:C.isNew,alertMessage:C.expressionErrorMessage?C.expressionErrorMessage:void 0,formulaText:this.getCalculationExpression(C)})]:(D.fF.assertFail((0,oe.W)("Cannot find editable Calculation: schema:{0} entity:{1} property:{2}",d?.schemaName,d?.entityName,d?.propertyName)),[2,Promise.resolve(void 0)])})})},q.prototype.getCalculationExpression=function(d){if(d.formulaOverride)return d.formulaOverride.formula;var C=e.w_.convertToUI(d.expression);return d.calculationSyntaxType===Y.Up.Expression?C:(0,e.Mk)(d.name,C)},q.prototype.updateFormulaContextAsync=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var d;return(0,p.__generator)(this,function(C){switch(C.label){case 0:return[4,this.getDataSourceInfo()];case 1:return d=C.sent(),[4,this.updateDaxContext(d)];case 2:return C.sent(),[2]}})})},q.prototype.updateDaxContext=function(d){return(0,p.__awaiter)(this,void 0,void 0,function(){var k;return(0,p.__generator)(this,function(M){switch(M.label){case 0:return[4,this.intellisenseModelService.getDaxModeConfigInputs(d)];case 1:return k=M.sent(),ne._.configureModel(k.serializableModel,k.wireDataSourceInfo,k.daxCalculation,k.isRestrictedMode,k.axes),[2]}})})},q.prototype.getDataSourceInfo=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var d,x,S;return(0,p.__generator)(this,function(N){switch(N.label){case 0:return[4,Promise.all([this.daxCapabilitiesService.getReservedWords(),this.daxCapabilitiesService.getCapabilities()])];case 1:return S=N.sent(),d=S[0],x=(0,c.w)(S[1].Functions),[2,{reservedWords:d,functionDataFromEngine:x}]}})})},q.prototype.analyzeFinalFormulaCommitInfo=function(d,C,x){var T=this.intellisenseModelService.getCalculationObject(),S={name:void 0,expression:void 0,invalidFormula:void 0,anonymizedExpression:void 0,parseResult:void 0},N=function(q,d,C,x){if(!x)return d.name=void 0,d.expression=void 0,d.invalidFormula=void 0,d.anonymizedExpression=void 0,!1;!function(q,d,C,x){var T=!1,S={name:void 0,expression:void 0};if((T=x.calculationSyntaxType===Y.Up.Expression)?S.expression=$.uI.trimStart(q,be):T=(0,e.Mn)(q,S,x.calculationType===Y.eN.VisualCalculation),!T)return d.name=x.name||"",d.name&&!q?d.expression="":(d.invalidFormula=q,d.expression=x.expression||""),null;if(d.name=S.name,d.expression=S.expression,S.expression)if(C){(N=ne._.getContext())||D.fF.assertFail("Context should be defined");var k=new e.w_,M=new e.ss,m={finalResult:M};k.finalParse(S.expression,N,m,e.MX.AddMissingParens|e.MX.Anonymize|e.MX.ConvertToEngine),d.expression=m.finalResult.updatedExpression,d.anonymizedExpression=m.finalResult.anonymizedExpression,d.parseResult=M}else{k=new e.w_;var N=ne._.getContext(),y={result:new e.bp};k.parse(S.expression,0,void 0,void 0,N,y,void 0),d.expression=e.w_.convertToEngine(S.expression),d.parseResult=y.result}}(q,d,C,x);var T,S=x.formulaOverride;return S&&(T=S.formula),x.name!==d.name||x.expression!==d.expression||T!==d.invalidFormula}(d,S,x,T);!N&&C&&T&&(N=!!T.expressionErrorMessage&&!!T.expressionOverride&&!T.formulaOverride);var m,g,y=new Map;if(N&&S.invalidFormula)switch(m={expression:null,formula:S.invalidFormula},T.calculationType){case Y.eN.Column:g=this.localizationService.get("ReportModelInvalidColumnNameMessage");break;case Y.eN.Table:g=this.localizationService.get("ReportModelInvalidCalculatedTableNameMessage");break;case Y.eN.Measure:g=this.localizationService.get("ReportModelInvalidMeasureNameMessage");break;case Y.eN.CalculationItem:g=this.localizationService.get("ReportModelInvalidCalcItemNameMessage");break;case Y.eN.VisualCalculation:break;default:D.fF.assertFail("Unknown type "+T.calculationType)}return S.parseResult instanceof e.bp&&S.parseResult.errors.length&&S.parseResult.errors.forEach(function(I){return y.set(I.errorCode,I.message)}),{doCommit:N,newName:S.name,newExpression:S.expression,newInvalidFormula:S.invalidFormula,anonymizedExpression:S.anonymizedExpression,expressionOverride:m,errorMessage:g,parseErrorMessages:y}},q.\u0275fac=function(C){return new(C||q)(me.\u0275\u0275inject(ve.o),me.\u0275\u0275inject(Se.TH),me.\u0275\u0275inject(j.Pm),me.\u0275\u0275inject(W.r))},q.\u0275prov=me.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac,providedIn:"root"}),q}()},70940:function(Oe,de,a){a.d(de,{s:function(){return c}});var p=a(47508),j=a(45034),e=new j.o(function(){var h={};return h[3]=p.L.card,h[13]=p.L.lineClusteredColumnComboChart,h[29]=p.L.multiRowCard,h[7]=p.L.clusteredBarChart,h[10]=p.L.clusteredColumnChart,h[20]=p.L.donutChart,h[16]=p.L.funnel,h[30]=p.L.gauge,h[22]=p.L.heatMap,h[9]=p.L.hundredPercentStackedBarChart,h[12]=p.L.hundredPercentStackedColumnChart,h[4]=p.L.lineChart,h[1]=p.L.map,h[19]=p.L.filledMap,h[2]=p.L.pivotTable,h[5]=p.L.pieChart,h[6]=p.L.scatterChart,h[8]=p.L.barChart,h[11]=p.L.columnChart,h[0]=p.L.tableEx,h[17]=p.L.treemap,h[23]=p.L.waterfallChart,h[26]=p.L.stackedAreaChart,h[27]=p.L.hundredPercentStackedAreaChart,h[32]=p.L.areaChart,h[33]=p.L.ribbonChart,h[34]=p.L.kpi,h[35]=p.L.decompositionTreeVisual,h});function c(h){return e.getValue()[h]}new j.o(function(){var h={};return h[p.L.card.name]=3,h[p.L.lineClusteredColumnComboChart.name]=13,h[p.L.multiRowCard.name]=29,h[p.L.clusteredBarChart.name]=7,h[p.L.clusteredColumnChart.name]=10,h[p.L.donutChart.name]=20,h[p.L.funnel.name]=16,h[p.L.gauge.name]=30,h[p.L.heatMap.name]=22,h[p.L.hundredPercentStackedBarChart.name]=9,h[p.L.hundredPercentStackedColumnChart.name]=12,h[p.L.lineChart.name]=4,h[p.L.map.name]=1,h[p.L.filledMap.name]=19,h[p.L.matrix.name]=2,h[p.L.pivotTable.name]=2,h[p.L.pieChart.name]=5,h[p.L.scatterChart.name]=6,h[p.L.barChart.name]=8,h[p.L.columnChart.name]=11,h[p.L.table.name]=0,h[p.L.tableEx.name]=0,h[p.L.treemap.name]=17,h[p.L.waterfallChart.name]=23,h[p.L.stackedAreaChart.name]=26,h[p.L.hundredPercentStackedAreaChart.name]=27,h[p.L.areaChart.name]=32,h[p.L.ribbonChart.name]=33,h[p.L.kpi.name]=34,h[p.L.decompositionTreeVisual.name]=35,h})},1931:function(Oe,de,a){a.d(de,{T:function(){return be}});var p=a(77476),j=a(52910),e=a(13052),$=a(31109),c=a(22346),W=a(76521),h=a(40516),D=a(84497),oe=a(79061),Y=a(4633),ne=a(90938),me=a(47231),ve=a(50423),be=function(){function le(){}return le.\u0275fac=function(Ee){return new(Ee||le)},le.\u0275mod=ve.\u0275\u0275defineNgModule({type:le}),le.\u0275inj=ve.\u0275\u0275defineInjector({imports:[p.CommonModule,j.O,e.T,$.F,c.J,W.A3,h.h,D.L,oe.v,Y.e3,ne.g,me.c]}),le}()},37320:function(Oe,de,a){a.d(de,{y:function(){return x}});var p=a(81337),j=a(35510),e=a(74804),$=a(62458),c=a(58291),W=a(57871),h=a(42614),D=a(3579),oe=a(38953),Y=a(54834),ne=a(35988),me=a(74857),ve=a(50423),Se=a(26898),be=a(83008),le=a(8586),Me=a(21436),Ee=a(28894),q=a(84916),d=a(29866),x=function(){function M(m,g,y,I,Q,H,J){this.conceptualSchemaProxy=m,this.dataSources=g,this.explorationSerializer=y,this.lazyScoped=I,this.podExplorationResolver=Q,this.resourcePackage=H,this.visualPlugin=J}return M.prototype.createInterpretListener=function(m,g){return void 0===g&&(g=500),new T(this.conceptualSchemaProxy,this.dataSources,this.explorationSerializer,this.lazyScoped,this.podExplorationResolver,this.resourcePackage,this.visualPlugin,m,g)},M.\u0275fac=function(g){return new(g||M)(ve.\u0275\u0275inject(Se.i),ve.\u0275\u0275inject(be.D),ve.\u0275\u0275inject(le.L),ve.\u0275\u0275inject(Ee.H),ve.\u0275\u0275inject(Me.Bl),ve.\u0275\u0275inject(q.o),ve.\u0275\u0275inject(d.D))},M.\u0275prov=ve.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac}),M}(),T=function(){function M(m,g,y,I,Q,H,J,Z,ce){this.conceptualSchemaProxy=m,this.dataSources=g,this.explorationSerializer=y,this.lazyScoped=I,this.podExplorationResolver=Q,this.resourcePackage=H,this.visualPlugin=J,this.setupParams=Z,this.timeout=ce,$.fF.assertValue(Z,"setupParams"),this.updateManager=new k(this.timeout),this.setupParams=Z}return M.prototype.getObservable=function(){return this.updateManager.getObservable()},M.prototype.onInterpretIssued=function(){this.cancelErrorThrottler(),this.updateManager.pushUpdate({resultType:0})},M.prototype.onInterpretRetry=function(m){this.updateManager.pushUpdate({resultType:1,retryWarning:m})},M.prototype.onInterpretResultCleared=function(){this.cancelErrorThrottler(),this.updateManager.pushUpdate({resultType:4,utterance:""})},M.prototype.onInterpretResult=function(m,g){var y;return(0,p.__awaiter)(this,void 0,void 0,function(){var I,Q;return(0,p.__generator)(this,function(H){return I=!!g.error||!this.setupParams.forTrainingTermBinding&&_.isEmpty(g.results)||this.setupParams.forTrainingTermBinding&&_.every(g.results,function(J){return!J.command})&&!function(M){return!M||!!_.find(M,function(m){return 2===m||8===m||11===m||12===m||9===m||10===m||24===m})}(g.warnings),I?(Q=_.first(g.results),this.onInterpretErrorV2(g.utterance,m,g.error,Q?.spans,null===(y=Q?.correctionInfo)||void 0===y?void 0:y.correctedUtterance),[2]):[2,this.onInterpretSuccessV2(g,m)]})})},M.prototype.onInterpretSuccessV2=function(m,g){var y,I;return(0,p.__awaiter)(this,void 0,void 0,function(){var Q,H;return(0,p.__generator)(this,function(Z){switch(Z.label){case 0:return $.fF.assertValue(m,"interpretResponse"),this.cancelErrorThrottler(),null!==(y=g?.intent)&&void 0!==y&&y.defineCalculation?[4,this.handleCalculationResult(m,g)]:[3,2];case 1:return Z.sent(),[3,6];case 2:return Q=_.first(m.results),(H=null===(I=Q?.command)||void 0===I?void 0:I.query)&&_.find(H.from().sources(),function(ce){return(0,oe.Yg)(ce)})?[4,this.handlePodPageResult(m,g)]:[3,4];case 3:return Z.sent(),[3,6];case 4:return[4,this.handleVisualResult(m,g)];case 5:Z.sent(),Z.label=6;case 6:return[2]}})})},M.prototype.onInterpretErrorV2=function(m,g,y,I,Q){var H=this;$.fF.assertValue(m,"utterance"),this.cancelErrorThrottler();var J=this.setupParams.forTrainingTermBinding?{spans:I,correctedUtterance:Q}:void 0;this.errorThrottler=setTimeout(function(){H.updateManager.pushThrottledUpdate({request:g,resultType:3,interpretError:y,utterance:m,termBindingsTrainingInfo:J,doNotShowResult:!0}),H.errorThrottler=void 0},this.timeout)},M.prototype.cancelErrorThrottler=function(){this.errorThrottler&&clearTimeout(this.errorThrottler),this.errorThrottler=void 0},M.prototype.handlePodPageResult=function(m,g){return(0,p.__awaiter)(this,void 0,void 0,function(){var y,I,Q,H,J,Z,ce,F,P,R,U,V,L,K,B,z,A,re,X,_e;return(0,p.__generator)(this,function(pe){switch(pe.label){case 0:if(y=_.first(m?.results),$.fF.assertValue(y,"query interpretResult must be defined for handling pod result"),I=m.utterance,Q=S(y),this.setupParams.forTrainingTermBinding)return this.updateManager.pushThrottledUpdate({request:g,resultType:2,utterance:I,termBindingsTrainingInfo:Q,doNotShowResult:!1}),[2];if(!this.setupParams.canShowPods)return this.updateManager.pushThrottledUpdate({request:g,resultType:5,utterance:I}),[2];H=y?.command,J=H?.query,$.fF.assertValue(J,"interpretResult command must have a defined query for handling pod result"),Z=_.find(J.from().sources(),function(xe){return(0,oe.Yg)(xe)}),$.fF.assertValue(Z,"expect there is a pod entity"),ce=this.podExplorationResolver.getReportId(Z.schema),pe.label=1;case 1:return pe.trys.push([1,3,,4]),R=(P=this.explorationSerializer).deepCopyExploration,[4,this.podExplorationResolver.getExploration(ce)];case 2:return F=R.apply(P,[pe.sent()]),U=_.find(F.pods,function(xe){return xe.name===Z.pod}),V=U&&U.boundSection,L=_.find(F.sections,function(xe){return V===xe.name}),U&&V&&L?(h.l.mergeExplorationSectionFilters(F,L),K=(0,me.Nj)(H?.queryMetadata),B=Y.ib.serializeQuery(J),_.isEmpty(B.Where)||(z=h.l.extractParameterFilters(B,K),h.l.applySectionParameterFilters(L,U,void 0,z)),A=_.filter(F.resourcePackages,function(xe){return _.some(L.visualContainers,function(Ie){return(0,D.s)(Ie)===xe.name})}),_.isEmpty(A)||(this.resourcePackage.registerPackages(A),this.visualPlugin.ensurePlugins(A)),L.size.displayOption=1,F.activeSectionIndex=_.findIndex(F.sections,function(xe){return xe.name===L.name}),re=this.getModelFromResult(y),this.ensureDataSources(re,F),X=re.id,_e=this.getNotShowLowConfidenceResult(y),this.updateManager.pushThrottledUpdate({request:g,resultType:2,modelId:X,utterance:I,exploration:F,restatement:y.restatement,doNotShowResult:_e,usedAgents:y?.usedAgents}),[3,4]):(this.updateManager.pushThrottledUpdate({request:g,resultType:6,utterance:I}),[2]);case 3:return pe.sent(),this.updateManager.pushThrottledUpdate({request:g,resultType:6,utterance:I}),[3,4];case 4:return[2]}})})},M.prototype.handleVisualResult=function(m,g){return(0,p.__awaiter)(this,void 0,void 0,function(){var y,I,Q,H,J,Z,ce,F,U,V,L;return(0,p.__generator)(this,function(B){switch(B.label){case 0:if($.fF.assertValue(m,"interpretResponse"),y=m.utterance,I=_.first(m?.results),!this.setupParams.canShowVisuals)return this.updateManager.pushThrottledUpdate(this.setupParams.forTrainingTermBinding?{request:g,resultType:2,utterance:y,termBindingsTrainingInfo:S(I),doNotShowResult:!1}:{request:g,resultType:5,utterance:y}),[2];Q=this.setupParams.forTrainingTermBinding?S(I):void 0,B.label=1;case 1:return B.trys.push([1,4,,5]),H=(0,ne.vr)(m?.warnings),J=_.uniq(_.map(H,function(z){return z.messageKey})),Z=!_.isEmpty(H),ce=void 0,(F=I&&I.command)&&F.query?_.isEmpty(H)?(U=this.getModelFromResult(I),this.ensureDataSources(U,void 0),[4,this.lazyScoped.get("visualRecommendationService")]):(this.updateManager.pushThrottledUpdate({request:g,resultType:2,utterance:y,termBindingsTrainingInfo:Q,doNotShowResult:!0,doNotShowResultCustomMessageKeys:J}),[2]):(this.updateManager.pushThrottledUpdate({request:g,resultType:this.setupParams.forTrainingTermBinding?2:3,utterance:y,termBindingsTrainingInfo:Q,doNotShowResult:!this.setupParams.forTrainingTermBinding||Z,doNotShowResultCustomMessageKeys:Z?J:void 0}),[2]);case 2:return V=B.sent(),[4,(0,me.y_)(I,this.conceptualSchemaProxy,this.dataSources,V)];case 3:return(ce=B.sent())?(L=this.getNotShowLowConfidenceResult(I),this.updateManager.pushThrottledUpdate({request:g,resultType:2,modelId:U.id,utterance:y,restatement:I&&I.restatement,termBindingsTrainingInfo:Q,visualContainer:ce,doNotShowResult:L,usedAgents:I?.usedAgents})):this.updateManager.pushThrottledUpdate({request:g,resultType:6,utterance:y,termBindingsTrainingInfo:Q}),[3,5];case 4:return B.sent(),this.updateManager.pushThrottledUpdate({request:g,resultType:6,utterance:y,termBindingsTrainingInfo:Q}),[3,5];case 5:return[2]}})})},M.prototype.handleCalculationResult=function(m,g){var y;return(0,p.__awaiter)(this,void 0,void 0,function(){var I,Q,J,Z,ce;return(0,p.__generator)(this,function(F){for(I=m.utterance,this.setupParams.canShowCalculations||this.updateManager.pushThrottledUpdate({request:g,resultType:5,utterance:I}),Q=[],J=0,Z=m.results;J<Z.length;J++)null!==(y=(ce=Z[J]).command)&&void 0!==y&&y.defineCalculation&&!this.getNotShowLowConfidenceResult(ce)&&Q.push((0,p.__assign)((0,p.__assign)({},ce.command.defineCalculation),{restatement:ce.restatement}));return _.isEmpty(Q)?this.updateManager.pushThrottledUpdate({request:g,resultType:3,utterance:I}):this.updateManager.pushThrottledUpdate({request:g,resultType:2,utterance:I,restatement:void 0,doNotShowResult:!1,calculations:Q}),[2]})})},M.prototype.getNotShowLowConfidenceResult=function(m){if(!m?.command)return!0;var g=m.correctionInfo&&m.correctionInfo.state;return 0===g||1===g&&this.setupParams.canShowDidYouMean},M.prototype.getModelFromResult=function(m){var g=1===_.size(this.setupParams.models)?this.setupParams.models[0]:_.find(this.setupParams.models,function(y){return y.dbName===m.databaseName&&y.vsName===m.virtualServerName});return $.fF.assertValue(g,"There are multiple models for interpret, one of them should match the model that the interpret result is from"),g},M.prototype.ensureDataSources=function(m,g){if(m&&this.setupParams.resetDataSources){var y=(0,e.CD)(m),I=(0,e.yd)([y]);if(!_.isEmpty(g?.modelExtensions)){var Q=W.eM,H=y.name;I.push({type:c.K,id:void 0,name:Q,extends:H,exploration:{schemaName:Q,extends:H,getModelExtensions:function(){return g.modelExtensions},getDataSourceVariables:function(){return g.dataSourceVariables}}})}this.dataSources.set(I)}},M}();function S(M){if(M){var m=M.command;return{spans:M.spans,correctedUtterance:M.correctionInfo&&M.correctionInfo.correctedUtterance,linguisticSchemaJson:m&&m.linguisticSchemaJson,linguisticSchemaItems:m&&m.linguisticSchemaItems,inferredTermMetadata:m&&m.inferredTermMetadata}}}var k=function(){function M(m){this.timeout=m,this.interpretResult$=new j.X(void 0)}return M.prototype.getObservable=function(){return this.interpretResult$.asObservable()},M.prototype.pushUpdate=function(m){this.throttler&&clearTimeout(this.throttler),this.throttler=void 0,this.throttledUpdate=void 0,this.interpretResult$.next(m),this.throttler=this.startThrottler()},M.prototype.pushThrottledUpdate=function(m){this.throttler?this.throttledUpdate=m:(this.interpretResult$.next(m),this.throttler=this.startThrottler())},M.prototype.startThrottler=function(){var m=this;return setTimeout(function(){m.throttledUpdate?(m.interpretResult$.next(m.throttledUpdate),m.throttledUpdate=void 0,m.throttler=m.startThrottler()):m.throttler=void 0},this.timeout)},M}()},91592:function(Oe,de,a){a.d(de,{H:function(){return j}});var p=a(16808);function j($,c,W){return(0,p.rO)()?{isAllowed:!1,disallowedReason:"featureDisabledInIE"}:W.appShouldHideQnaFeature()?{isAllowed:!1,disallowedReason:"featureDisabledInApp"}:_.some(c?.schemas,function(oe){return!oe.isExtensionSchema&&!_.isEmpty(oe.entities)})?W.modelSupportsQna(c,$)?W.modelHasQnaEnabled(c,$)?{isAllowed:!0}:{isAllowed:!1,disallowedReason:"qnaNotEnabled"}:{isAllowed:!1,disallowedReason:"qnaNotSupported"}:{isAllowed:!1,disallowedReason:"noModel"}}},74857:function(Oe,de,a){a.d(de,{D4:function(){return Se},ET:function(){return D},Nj:function(){return ne},Su:function(){return ve},Vq:function(){return Me},aZ:function(){return me},fI:function(){return Ee},y_:function(){return be}});var p=a(81337),j=a(62458),e=a(38701),$=a(60661),c=a(18503),W=a(50547),h=a(2240);function D(x){return{code:"qnaNotAllowedInIE",fixableError:0,hideSeeDetails:!0,details:{message:x.get("Qna_NotSupportedInIE"),displayableErrorInfo:void 0},source:"User"}}function ne(x){if(x)return{Filters:_.map(x.filters,function(T){return{Restatement:T.Restatement,type:void 0}}),Select:_.map(x.selects,function(T){return{Restatement:T.restatement}})}}function me(x,T,S){j.fF.assertValue(x,"Expect this to be called only when the given error is defined.");var N=x.details;if(N){var k=(0,c.jx)(N),M=S.get("ServiceError_CannotLoadVisual"),m=N.message,g=[];if(k&&(M=N.displayableErrorInfo[0].errorInfoKey,m=N.displayableErrorInfo[0].errorInfoValue,N.displayableErrorInfo.length>1))for(var y=1;y<N.displayableErrorInfo.length;y++)g.push(N.displayableErrorInfo[y]);j.fF.assert(function(){return null!=x.source},"Expect error.source is not null."),T.error(m,x.code,{debugErrorInfo:N.debugErrorInfo,displayableErrorInfo:g,title:M,source:x.source,level:W.U.Error})}}function ve(x,T){var S=x.getCurrentExploration(),N=S?.themeCollection;return _.isEmpty(N)?Se(T):N}function Se(x){return{baseTheme:(0,e.DC)(x)}}function be(x,T,S,N){return(0,p.__awaiter)(this,void 0,void 0,function(){var k,M,m,g,y,I,Q,H;return(0,p.__generator)(this,function(J){switch(J.label){case 0:return k=x?.command,M=k?.query,M?(m=M.select(),g=k.queryMetadata,y=_.map(g?.selects,function(Z,ce){return{expression:m[ce].expr,type:Z.type,isGroup:Z.isGroup,defaultLabel:Z.defaultLabel,isExplicitSortBy:Z.isExplicitSortBy}}),I=g?.filters,[4,T.get(S.get())]):[2];case 1:return Q=J.sent(),(H=N.recommendVisuals(M,Q,{numberOfResults:1,visualType:_.first(k.suggestedVisualTypes),filterMetadata:I,exprMetadata:y,addDefaultFormatting:!0,allowTooltipMeasures:!0}))?(j.fF.assert(function(){return 1===_.size(H.visualContainers)},"Expected 1 result"),[2,H.visualContainers[0]]):[2]}})})}function Me(x,T,S,N,k,M,m){return(0,p.__awaiter)(this,void 0,void 0,function(){var g,y;return(0,p.__generator)(this,function(I){switch(I.label){case 0:return[4,d(x,T,S,N)];case 1:return g=I.sent(),y={defaultSortBehavior:q(x,m),sortableFields:g?.sortableFields,sortGroups:g?.sortGroups},[2,new h.B(y,x,N,k,M)]}})})}function Ee(x,T,S){if(!_.isEmpty(S)){var N=(0,$.oJ)(x);_.isEmpty(N)||T.applySortByFields(S)}}function q(x,T){var S,N=(0,$.cj)(x,T);return!!N&&!(null===(S=N.sorting)||void 0===S||!S.default)}function d(x,T,S,N){return(0,p.__awaiter)(this,void 0,void 0,function(){var k,M,m,g;return(0,p.__generator)(this,function(I){switch(I.label){case 0:if(!(k=S.get()))return[2];I.label=1;case 1:return I.trys.push([1,3,,4]),M=(0,$.PQ)(x),m=(0,$.Xf)(x),[4,T.get(k)];case 2:return g=I.sent(),[2,N.getSortableFields({query:m,schema:g,visualType:M.visualType,columnProperties:M.columnProperties,compiledMappings:[]})];case 3:return I.sent(),[3,4];case 4:return[2]}})})}},35988:function(Oe,de,a){a.d(de,{AU:function(){return K},B4:function(){return C},C2:function(){return U},Cb:function(){return S},Fm:function(){return k},NG:function(){return J},R1:function(){return x},Tm:function(){return L},hj:function(){return I},qV:function(){return M},tc:function(){return Z},vr:function(){return V}});var W,h,D,oe,Y,ne,p=a(70940),j=a(54834),e=a(62458),$=a(43286),c=a(80777),me=((W={}).GeneratedLinguisticSchema=0,W.DataIndexBuildingCancelled=16,W.DataIndexMissingStatistics=17,W.DataIndexNotReady=8,W.DataIndexSizeLimitReached=15,W.DataIndexUpdateFailure=10,W.DomainModelNotReady=2,W.DomainModelPartialLoad=3,W.DomainModelUpdateFailure=9,W.EmptyLinguisticSchema=1,W.InterpretationSemanticError=4,W.InterpretationSemanticWarning=5,W.InterpretCancelled=18,W.InvalidTextualEntity=6,W.LinguisticSchemaTruncated=14,W.MissingOrInvalidPodParameters=13,W.QueryAggregateNotSupported=19,W.QueryMedianNotSupported=20,W.QueryPercentileNotSupported=21,W.QueryScopedEvalNotSupported=22,W.QuerySubqueryRegroupingNotSupported=23,W.StaleDataIndex=12,W.StaleDomainModel=11,W.RequiresNewerVersion=7,W.DataIndexVersionIsOld=24,W.QueryGroupByTableNotSupported=25,W.QueryNotSupported=26,W.NextBestInterpretation=27,W),ve=((h={}).ActivationFailure="ActivationFailure",h.CloudRlsModelAccessDenied="CloudRlsModelAccessDenied",h.DataIndexBuildFailure="DataIndexBuildFailure",h.DomainModelLoadFailure="DomainModelLoadFailure",h.ExternalModelAccessDenied="ExternalModelAccessDenied",h.GenericRequestFailure="GenericRequestFailure",h.LinguisticSchemaLoadFailure="LinguisticSchemaLoadFailure",h.ModelNotFound="ModelNotFound",h.ModelQnaNotEnabled="ModelQnaNotEnabled",h.ModelQnaNotSupported="ModelQnaNotSupported",h.RequiresNewerVersion="RequiresNewerVersion",h.SchemaLanguageNotSupported="SchemaLanguageNotSupported",h.MissingRuntimeModule="MissingRuntimeModule",h.VerifyRuntimeFailure="VerifyRuntimeFailure",h.DataIndexMissingAllStatistics="DataIndexMissingAllStatistics",h),Se=((D={})[16]="Qna_Warning_DataIndexIncomplete_Desktop",D[15]="Qna_Warning_DataIndexIncomplete_Desktop",D[14]="Qna_Warning_LinguisticSchemaTruncated_Desktop",D),be=((oe={})[16]="Qna_Warning_DataIndexIncomplete_Service",oe[15]="Qna_Warning_DataIndexIncomplete_Service",oe[14]="Qna_Warning_LinguisticSchemaTruncated_Service",oe),le=[2,8,11,12,24],Me=[2,8],Ee=((Y={})[1]="Qna_NotAllowedForReport_WithoutModel",Y[2]="Qna_Explore_WarningBuildingLanguageModel",Y[7]="Qna_Warning_RequiresNewerVersion",Y[8]="Qna_Explore_WarningIndexing",Y[9]="Qna_Warning_ModelUpdateFailure",Y[10]="Qna_Warning_DataIndexUpdateFailure",Y[11]="Qna_Warning_StaleModel",Y[12]="Qna_Warning_StaleIndex",Y[17]="Qna_Warning_DataIndexMissingStatistics",Y[19]="Qna_Warning_UnsupportedFunction",Y[20]="Qna_Warning_UnsupportedFunction",Y[21]="Qna_Warning_UnsupportedFunction",Y[22]="Qna_Warning_UnsupportedFunction",Y[23]="Qna_Warning_UnsupportedFunction",Y[25]="Qna_Warning_QueryGroupByTableNotSupported",Y[26]="Qna_Warning_QueryNotSupported",Y[27]="Qna_Warning_NextBestInterpretation",Y),q=((ne={}).FeatureNotAvailable="Qna_Error_GenericRequestFailure",ne.NetworkConnectionIssue="Qna_Error_NetworkIssue",ne.RequiresNewerVersion="Qna_Error_RequiresNewerVersion",ne.ModelNotFound="Qna_Error_ModelNotFound",ne.ModelQnaNotEnabled="Qna_Error_ModelQnaNotEnabled",ne.ModelQnaNotSupported="Qna_Error_ModelQnaNotSupported",ne.MissingRuntimeModule="Qna_Explore_MissingBinaries",ne.VerifyRuntimeFailure="Qna_Explore_MissingBinaries",ne.SchemaLanguageNotSupported="Qna_NotAllowedForReport_QnaNotSupported",ne.SessionIsInactive="Qna_Error_GenericRequestFailure",ne.GenericRequestFailure="Qna_Error_GenericRequestFailure",ne.DataIndexBuildFailure="Qna_Explore_WarningFailedIndexing",ne.CloudRlsModelAccessDenied="Tile_RLS_NoAccess",ne.ExternalModelAccessDenied="Qna_Explore_ModelAccessDenied_WithoutSpecifyOwner",ne.DataIndexMissingAllStatistics="Qna_Error_DataIndexMissingAllStatistics",ne),d=[19,20,22,21,23,25,26];function C(n){e.fF.assertValue(n,"Expect the given wireV3Response to be defined");var u=B(n);if(u)return{error:u};var f=_.first(n.Results),b=_.first(f?.Interpretations);return{result:{utterances:_.map(b?.SuggestedUtterances,function(O){return{text:O.Text,source:O.Source}}),warnings:A(f?.DiagnosticMessages)}}}function x(n,u,f,b){e.fF.assertValue(b,"Expect the given wireV3Response to be defined");var ee,he,O=B(b);if(!O){var se=_.first(b.Results);he=A(se?.DiagnosticMessages);var Te=u??1,ze=_.take(se?.Interpretations,Te);_.isEmpty(ze)||(ee=_.map(ze,function(we){var Ve,Be,Qe;return{restatement:we.Restatement,databaseName:null===(Ve=se.Context)||void 0===Ve?void 0:Ve.DatabaseName,virtualServerName:null===(Be=se.Context)||void 0===Be?void 0:Be.VirtualServerName,command:X(we.Command),correctionInfo:Je(we),spans:y(n,we.Spans),language:se.Language,modelLanguage:se.ModelLanguage,modelOwner:null===(Qe=se.Context)||void 0===Qe?void 0:Qe.ModelOwner,usedAgents:_.map(we.UsedAgents,function(Ye){return Ye}),score:we.Score,relevantSchemaElements:T(se.RelevantSchemaElements)}}))}return{utterance:n,requestId:f,error:O,results:ee,warnings:he}}function T(n){if(null!=n&&(null!=n.Entities||null!=n.Relationships)){var u=function(b){return{description:b.Description,score:b.Score}};return{entities:_.map(n.Entities,u),relationships:_.map(n.Relationships,u)}}}function S(n){e.fF.assertValue(n,"Expect the given wireV3Response to be defined");var u=B(n);if(u)return{error:u};var f=_.first(n.Results);return{results:_.map(f?.Interpretations,function(O){return{language:f.Language}})}}function N(n){e.fF.assertValue(n,"Expect the given wireV3Response to be defined");var u=_.first(n.Results);return A(u?.DiagnosticMessages)}function k(n){e.fF.assertValue(n,"Expect the given wireResponse to be defined");var u=N(n);return _.find(le,function(f){return _.includes(u,f)})}function M(n){return e.fF.assertValue(n,"Expect the given wireResponse to be defined"),function(n){e.fF.assertValue(n,"Expect the given wireResponse to be defined");var u=N(n);return _.find(Me,function(f){return _.includes(u,f)})}(n)}function y(n,u){if(e.fF.assertValue(n,"utterance"),e.fF.assertAnyValue(u,"wireSpans"),u){_.isEmpty(n)&&e.fF.assert(function(){return _.every(u,function(O){return 0===O.Length})},"utterance is empty, every span should have zero length");var f=[],b=[];return _.forEach(u,function(O){5!==O.Resolution||O.Binding?f.push(new re(n,O,!1)):b.push(new re(n,O,!0))}),_.isEmpty(b)||_.forEach(b,function(O){_.forEach(f,function(ee){if(function(n,u){return u.startIndex<=n.startIndex&&u.endExcludingIndex>n.startIndex||u.startIndex<n.endExcludingIndex&&u.endExcludingIndex>n.endExcludingIndex||n.startIndex<=u.startIndex&&n.endExcludingIndex>=u.endExcludingIndex||u.startIndex<=n.startIndex&&u.endExcludingIndex>=n.endExcludingIndex}(ee,O))ee.overlapSpans.push(O);else if(O.endExcludingIndex<ee.startIndex)return})}),f}}function I(n){return"BadGateway"===n||"ConnectFailure"===n||"ConnectionClosed"===n||"GatewayTimeout"===n||"KeepAliveFailure"===n||"NameResolutionFailure"===n||"NetworkUnavailable"===n||"ProxyAuthenticationRequired"===n||"ProxyNameResolutionFailure"===n||"RequestTimeout"===n||"ServiceUnvailable"===n||"Timeout"===n||"AccessDenied"===n?"NetworkConnectionIssue":"FeatureNotAvailableError"===n?"FeatureNotAvailable":"GenericRequestFailure"}function Q(n){return _.map(n,function(u){return{startIndex:u.StartIndex,endExcludingIndex:u.StartIndex+u.Length}})}function J(n){var u=F(n);return n&&(u.Context={ReportMetadata:Xe(n.reportMetadata)}),u}function Z(n,u,f){var b=F(n);return b.Context={ModelScopes:[{VirtualServerName:u,DatabaseName:f}],Tags:n?.tags,ImpersonatedUserPrincipalName:n?.impersonatedUserPrincipalName,ImpersonatedRoles:n?.impersonatedRoles,Feedback:We(n?.feedback)},b.Options||(b.Options={}),b}function F(n){return n?{Version:"3.3.0",Utterance:n.utterance,Spans:_.map(n.spans,function(u){var f={StartIndex:u.startIndex,Length:u.endExcludingIndex-u.startIndex};return u.inferredTerm&&(f.Binding={InferredTerm:$e(u.inferredTerm)}),f}),Options:R(n),LinguisticSchemaJson:n.linguisticSchemaJson,InferredTermBinding:$e(n.inferredTermBinding),Intent:P(n.intent),IsCommitted:n.isCommitted,DesiredInterpretationsCount:n.desiredInterpretationsCount,GroupId:n.groupId,GroupSequenceNumber:n.groupSequenceNumber}:{Version:"3.3.0",Utterance:""}}function P(n){if(n?.defineCalculation)return{DefineCalculation:{Language:n.defineCalculation.language,Options:n.defineCalculation.options}}}function R(n){return null==n?.options?{}:{QueryMetadata:(0,$.yE)(n.options,2),VisualConfiguration:(0,$.yE)(n.options,4),SupportPodQueries:(0,$.yE)(n.options,8),IncludeRelevantSchemaElements:(0,$.yE)(n.options,32),Spans:(0,$.yE)(n.options,64),Diagnostics:(0,$.yE)(n.options,128),FrameTree:!1,AllowFollowUpQuestion:!1,AllowInsightQueries:(0,$.yE)(n.options,512),InferUnknownModelTerms:(0,$.yE)(n.options,4096),AllowPlaceholderSuggestions:!1,SuggestFollowUp:!1,SuggestedUtterances:(0,$.yE)(n.options,2048),SkipCompletion:n.skipCompletion,SingleAnswerBias:(0,$.yE)(n.options,8192),SuggestedDefineCalculationUtterances:(0,$.yE)(n.options,16384),UseLlmParser:(0,$.yE)(n.options,65536)}}function U(n){return _.map(n,function(u){var f,b;return{VirtualServerName:null===(f=u.model)||void 0===f?void 0:f.vsName,DatabaseName:null===(b=u.model)||void 0===b?void 0:b.dbName,ReportIds:u.reportIds}})}function V(n){if(_.indexOf(n,27)>=0)return[];var u=_.intersection(n,d);return _.map(u,function(f){return{warning:f,messageKey:Ee[f]}})}function L(n,u){if(!_.isEmpty(n)){e.fF.assert(function(){return!_.isEmpty(u)},"Must provide a valid qnaProxyPath");for(var f=[],b="@powerbi/Qna/qnadesktop.module#QnaDesktopModule"===u?Se:be,O=0,ee=n;O<ee.length;O++){var he=ee[O];if(b){var se=b[he];if(se){f.push(se);continue}}var Te=Ee[he];Te&&f.push(Te)}return _.uniq(f)}}function K(n,u){return u.get(q[n]||"Qna_Error_GenericRequestFailure")}function B(n){var u,f;if(e.fF.assertValue(n,"Expect the given wireV3Response to be defined"),"3.3.0"!==n.Version)u="RequiresNewerVersion";else{var b=_.first(n.Results);if(!b)return;f=_.find(b.DiagnosticMessages,function(he){return 1===he.Severity}),u=f?.Code}if(null!=u){var O=function(n){var u=ve[n];return e.fF.assert(function(){return null!=u},"InterpretDiagnosticCodeToQnaErrorCodeMappings should contain key "+n),u||(u="NoClientHandling"),u}(u),ee={errorCode:O,source:"GenericRequestFailure"===O?"PowerBI":"User",message:f?.Message,stackTrace:f?.StackTrace};return"NoClientHandling"===ee.errorCode&&(ee.message=_.isEmpty(ee.message)?u+".":u+". "+ee.message),ee}}function A(n){if(!_.isEmpty(n)){for(var u=[],b=function(Te){e.fF.assert(function(){return null!=me[Te.Code]},'unknown mapping to convert InterpretDiagnosticMessage "'+Te.Code+'" to client interpret warning code'),me[Te.Code]&&u.push(me[Te.Code])},O=0,ee=n.filter(function(se){return 2===se.Severity});O<ee.length;O++)b(ee[O]);return u}}var re=function(){return function(u,f,b){this.utterance=u,this.wireSpan=f,this.isOverlappingSpan=b,this.startIndex=f.StartIndex,this.endExcludingIndex=f.StartIndex+f.Length,this.text=u.substr(f.StartIndex,f.Length),this.correctedStartIndex=f.CorrectedStartIndex,this.correctedEndExcludingIndex=null!=f.CorrectedStartIndex?f.CorrectedStartIndex+f.CorrectedLength:void 0,this.resolution=f.Resolution,this.isOverlapping=b,this.tokens=function(n,u,f){return _.map(f,function(b){var O=b.StartIndex-u;return e.fF.assert(function(){return _.inRange(O,0,_.size(n))},"Expect each token.StartIndex is a valid index with the given spanText and spanStartIndex"),e.fF.assert(function(){return!_.isEmpty(_.trim(n.substr(O,b.Length)))},"Expect no WireToken being pure space"),{startIndex:b.StartIndex,endExcludingIndex:b.StartIndex+b.Length,text:n.substr(O,b.Length)}})}(this.text,this.startIndex,f.Tokens);var O=Re(this.text,f.Binding);this.binding=O&&O.bindingInfo,this.isCorrected=!(!this.binding||!O.isCorrected);var ee=ye(this.text,f.AlternateBindings),he=ye(this.text,f.PhraseCompletions),se=ye(this.text,f.PhraseExtensions),Te=ye(this.text,f.SuggestedReplacements);(!_.isEmpty(ee)||!_.isEmpty(he)||!_.isEmpty(se)||!_.isEmpty(Te))&&(this.replacementBindings={alternates:ee,phraseCompletions:he,phraseExtensions:se,suggestedReplacements:Te}),this.inferredTermBindings=_.map(f.InferredTermBindings,function(Be){return{inferredBindingType:(n=Be.InferredTerm).Type,definitionPrompt:n.DefinitionPrompt,definitionText:n.DefinitionText,prefixText:n.PrefixText,suffixText:n.SuffixText,hintText:n.HintText,alternateDefinitionTexts:n.AlternateDefinitionTexts,linguisticSchemaItems:n.LinguisticSchemaItems,definedTerm:n.DefinedTerm,targetRole:n.TargetRole,metadata:n.Metadata};var n}),this.inferredTermBindingsUnsupported=f.InferredTermBindingsUnsupported,this.hasBinding=null!=this.binding||null!=this.replacementBindings||!_.isEmpty(this.inferredTermBindings),this.isWhiteSpace=!_.isEmpty(this.text)&&_.isEmpty(_.trim(this.text)),this.isUsed=!this.isOverlapping&&(null==this.resolution||0===this.resolution||4===this.resolution),this.isUnknown=3===this.resolution,this.isInferred=4===this.resolution,this.overlapSpans=[];var n,we=!((n=this).isOverlapping||_.isEmpty(n.text)||pe(n)||xe(n)||Ne(n))&&n.hasBinding&&n.isUsed,Ve=Ne(this);e.fF.assert(function(){return!(we&&Ve)},"A span can not be definedWithOptions and undefinedWithOptions at the same time."),this.state=we?"accepted":Ve&&this.isUsed?"warning":Ve?"error":"none"}}();function X(n){if(n){var u=n.Query?j.ib.deserializeQuery(n.Query):void 0;return{query:u,queryMetadata:ie(u,n.QueryMetadata),data:n.Data,binding:n.Binding,visualConfigurations:_.map(n.VisualConfigurations,function(b){var O=b.Query?j.ib.deserializeQuery(b.Query):void 0;return{visualizationType:b.VisualizationType,dataShapeBinding:b.DataShapeBinding,visualElements:b.VisualElements,query:O,queryMetadata:ie(u,b.QueryMetadata)}}),suggestedVisualTypes:_.map(n.SuggestedVisualizations,function(b){return(0,p.s)(b.VisualizationType).name}),linguisticSchemaJson:n.LinguisticSchemaJson,linguisticSchemaItems:n.LinguisticSchemaItems,inferredTermMetadata:n.InferredTermMetadata,defineCalculation:_e(n.DefineCalculation)}}}function _e(n){if(n)return{expression:n.Expression,homeTable:n.HomeTable,format:n.Format}}function ie(n,u){if(n&&u){var f=_.filter(u.Filters,function(O){return!!O}),b=_.filter(u.Select,function(O){return!!O});return{filters:_.map(f,function(O){return{Restatement:O.Restatement,type:void 0}}),selects:_.map(b,function(O){return{restatement:O.Restatement,valueType:He(O.DefaultLabel?O.DefaultLabel.SemanticType:O.SemanticType),isGroup:O.IsGroup,defaultLabel:O.DefaultLabel?Ze(O.DefaultLabel.Expression,n):void 0,isExplicitSortBy:O.IsExplicitSortBy}})}}}function pe(n){var u,f;return 7===(null===(u=n.binding)||void 0===u?void 0:u.type)&&!n.isCorrected&&_.isEmpty(null===(f=n.replacementBindings)||void 0===f?void 0:f.suggestedReplacements)&&_.isEmpty(n.inferredTermBindings)}function xe(n){var u,f;return 8===(null===(u=n.binding)||void 0===u?void 0:u.type)&&!n.isCorrected&&2===n.resolution&&_.isEmpty(null===(f=n.replacementBindings)||void 0===f?void 0:f.suggestedReplacements)&&_.isEmpty(n.inferredTermBindings)}function Ne(n){return!(n.isOverlapping||_.isEmpty(n.text)||pe(n)||xe(n)||!(n.isCorrected||3===n.resolution||n.hasBinding&&!n.isUsed))}function Re(n,u){if(u&&!u.InferredTerm){var f,b;if(u.Table)f=u.Table,b=0;else if(u.Pod)f=u.Pod,b=1;else if(u.Property)f=u.Property,b=2;else if(u.Value)f=u.Value,b=3;else if(u.Range)f=u.Range,b=4;else if(u.VisType)f=u.VisType,b=5;else if(u.Composite)f=u.Composite,b=6;else if(u.Core)f=u.Core,b=7;else if(u.Phrasing)f=u.Phrasing,b=8;else if(u.TextualEntity)f=u.TextualEntity,b=9;else{if(!u.AnyEntity){var O=u;return void e.fF.assert(function(){return!!O.Literal},"Has binding type that is unhandled by client right now. Known unhandled types are: [Literal] and this is not a known type. Check to either update the known unhandled type list, or handle it on the client side.")}f=u.AnyEntity,b=10}return{bindingInfo:{type:b,text:f.Text,textSegmentsWithMatchInfo:Fe(n,f.Text,f.MatchedSegments),matchType:f.MatchType,score:f.Score},isCorrected:f.Corrected}}}function Fe(n,u,f){if(_.isEmpty(n)||_.isEmpty(f))return[{text:u,isMatched:!1}];for(var b=[],O=0,ee=0,he=f;ee<he.length;ee++){var se=he[ee];O<se.StartIndex&&b.push({text:u.substring(O,se.StartIndex),isMatched:!1}),b.push({text:u.substr(se.StartIndex,se.Length),isMatched:!0}),O=se.StartIndex+se.Length}return O<_.size(u)&&b.push({text:u.substring(O),isMatched:!1}),b}function ye(n,u){if(u){for(var f=[],b=0,O=u;b<O.length;b++){var he=Re(n,O[b]);he&&f.push(he.bindingInfo)}return f}}function We(n){return n?{Sentiment:n.sentiment,Reason:n.reason,Comment:n.comment}:void 0}function Xe(n){return n?{LinguisticSchema:n.linguisticSchema,Pods:_.map(n.pods,function(u){return{Name:u.name,CortanaEnabled:u.cortanaEnabled,Parameters:_.map(u.parameters,function(f){return{Name:f.name,TargetColumn:f.targetColumn,TargetEntity:f.targetEntity}})}})}:void 0}function $e(n){return null==n?void 0:{Type:n.inferredBindingType,DefinitionPrompt:n.definitionPrompt,DefinitionText:n.definitionText,PrefixText:n.prefixText,SuffixText:n.suffixText,HintText:n.hintText,AlternateDefinitionTexts:n.alternateDefinitionTexts,LinguisticSchemaItems:n.linguisticSchemaItems,DefinedTerm:n.definedTerm,TargetRole:n.targetRole,Metadata:n.metadata}}function Je(n){e.fF.assertValue(n,"result");var u=n.CorrectedUtterance;if(!_.isEmpty(u)){var b=n.ReplacementUtterance,O=2;return!!n.Command||(n.ConfidenceLevel<=5?O=0:n.ConfidenceLevel<=20&&(O=1)),_.isEmpty(n.CorrectedUtteranceTextSegments)?{correctedUtterance:u,replacementUtterance:b||u,state:O}:{correctedUtterance:u,correctedTextSegments:Q(n.CorrectedUtteranceTextSegments),state:O}}}function He(n){switch(n){case 0:case 1:case 2:case 3:return;case 4:return c.Ge.fromExtendedType(7078913);case 5:return c.Ge.fromDescriptor({dateTime:!0});case 6:return c.Ge.fromDescriptor({numeric:!0})}}function Ze(n,u){var f=j.ib.serializeQuery(u);f.Select.push(n);var b=j.ib.deserializeQuery(f);return _.last(b.select()).expr}},64648:function(Oe,de,a){a.d(de,{_:function(){return p}});var p=function(j){return j[j.Number=0]="Number",j[j.Enum=1]="Enum",j[j.Boolean=2]="Boolean",j[j.Field=3]="Field",j[j.Instance=4]="Instance",j}({})},92630:function(Oe,de,a){a.d(de,{Xy:function(){return H}});var p=a(81337),j=a(64648),e=a(96739),$=a(3011),c=function(){function F(){}return F.rewrite=function(P,R,U,V){if(P){var L=(0,$.vH)(R),K={},B=new F;for(var z in P){var A=P[z].input;K[z]=P[z],A&&(e.M.isColumnOrMeasure(A)?K[z].input=B.rewriteField(A,L,U,V):e.M.isInstance(A)&&(K[z].input=B.rewriteInstance(A,L,U,V)))}return K}},F.prototype.rewriteField=function(P,R,U,V){for(var L=P.value,K=0,B=R;K<B.length;K++){var z=B[K];L=L?.accept(z)}return _.isEmpty(L?.validate(U,V))||(L=void 0),(0,p.__assign)((0,p.__assign)({},P),{value:L})},F.prototype.rewriteInstance=function(P,R,U,V){for(var L,K,B=null===(L=P.value)||void 0===L?void 0:L.field,z=null===(K=P.value)||void 0===K?void 0:K.filter,A=0,re=R;A<re.length;A++){var X=re[A];B=B?.accept(X),z=z?.rewrite(X)}return _.isEmpty(B?.validate(U,V))||(B=void 0,z=void 0),(0,p.__assign)((0,p.__assign)({},P),{value:B?{field:B,filter:z}:void 0})},F}(),W=a(54834),h=a(8590),D=a(62458),oe=a(21571),Y=a(95462),ne=a(94419),me=a(35510),ve=a(30794),Se=a(82762),be=a(22318),le=a(77526),Me=a(81905),Ee=a(59973),q=a(14172),d=a(73805),C=a(57243),x=a(83317),T=a(74082),S=a(50423),N=a(28199),k=a(26898),M=a(83008),m=a(11494),g=a(80435),y=a(57151),I=a(96899),Q=a(65181),H=function(){function F(P,R,U,V,L,K,B,z){var A=this;this.aggrOps=P,this.conceptualSchemaProxy=R,this.dataSourcesService=U,this.daxCapabilitiesService=V,this.daxTemplateService=L,this.daxTemplateTelemetry=K,this.eventBridge=B,this.localizationService=z,this.templatesModelStore$=new me.X({selectedTemplate:void 0,flattenedTemplatesAndCategory:[]}),this.parametersStore$=new me.X(void 0),this.validation$=this.parameters$.pipe((0,be.O)(null)).pipe((0,le.x)(),(0,Me.w)(function(re){return A.validateParameters(re,A.templatesModelStore$.value.selectedTemplate)})),this.selectedTemplate$=this.templatesModel$.pipe((0,Ee.h)(function(re){return!!re.selectedTemplate}),(0,q.U)(function(re){return re.selectedTemplate}),(0,le.x)()),this.isTemplateSelected$=this.selectedTemplate$.pipe((0,d.h)(!0),(0,be.O)(!1),(0,le.x)(),(0,C.d)(1)),this.subscriptionManager=this.eventBridge.createChannelSubscriptionManager().subscribe(h.CCe,function(re,X){return A.onModelChanged(X.result)})}return Object.defineProperty(F.prototype,"templatesModel$",{get:function(){return this.templatesModelStore$.asObservable()},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"parameters$",{get:function(){return this.parametersStore$.asObservable()},enumerable:!1,configurable:!0}),F.prototype.ngOnDestroy=function(){this.subscriptionManager.unsubscribeAll()},F.prototype.initialize=function(P){var R=P.selects,U=P.schemaName,V=P.openDaxTemplateEvent,L=P.targetEntity;return(0,p.__awaiter)(this,void 0,void 0,function(){var K,B=this;return(0,p.__generator)(this,function(z){switch(z.label){case 0:return this.destroy$=new ve.xQ,this.schemaName=U,this.targetEntity=L,this.sourceExpressions=_.map(R,function(A){return W.ib.deserializeExpr(A)}),[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())];case 1:return K=z.sent(),[4,this.initializeTemplates(K)];case 2:return z.sent(),V&&(this.openDaxTemplateEvent=V,this.daxTemplateTelemetry.startTemplateSelectedEvent(V,"Select a measure")),this.selectedTemplate$.pipe((0,x.R)(this.destroy$),(0,Me.w)(function(A){return(0,Se.D)(B.conceptualSchemaProxy.get(B.dataSourcesService.get())).pipe((0,q.U)(function(re){return{template:A,schema:re}}))})).subscribe(function(A){var re=B.getParameters(A.template,B.parametersStore$.value,A.schema);B.parametersStore$.next(re)}),[2]}})})},F.prototype.updateSelectedTemplate=function(P){this.templatesModelStore$.next((0,p.__assign)((0,p.__assign)({},this.templatesModelStore$.value),{selectedTemplate:P})),this.daxTemplateTelemetry.resolveTemplateSelectedEvent(),this.daxTemplateTelemetry.startTemplateSelectedEvent(this.openDaxTemplateEvent,P.capabilities.name)},F.prototype.updateParameters=function(P,R){if(D.fF.assertValue(P,"parameterInput"),D.fF.assertValue(R,"parameterKey"),P&&R&&_.has(this.parametersStore$.value,R)){var U=_.clone(this.parametersStore$.value),V=U[R];e.M.isInstance(P)&&!P.value.field&&(P.value.filter=void 0,V.hasBeenSet=!0),V.input=P,V.hasBeenSet=V.hasBeenSet||function(F){var P;return e.M.isInstance(F)?!(null===(P=F.value)||void 0===P||!P.filter):!!F.value}(V.input),this.parametersStore$.next(U)}},F.prototype.getNewMeasureResult=function(){return(0,p.__awaiter)(this,void 0,void 0,function(){var P,R,U,V,L;return(0,p.__generator)(this,function(K){switch(K.label){case 0:return[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())];case 1:return P=K.sent(),R=this.templatesModelStore$.value.selectedTemplate,U=Z(this.parametersStore$.value,P,this.daxTemplateService.utils),[4,this.getNewMeasureMetadata(U,R,P)];case 2:return(V=K.sent())&&(L={template:R?.capabilities,parameters:_.mapValues(U,function(B){return{expression:W.ib.serializeExpr(B.expression)}}),newMeasureMetadata:V}),[2,L]}})})},F.prototype.destroy=function(){this.destroy$.next(),this.destroy$.complete()},F.prototype.updateTemplates=function(P){var R=this.flattenAndOrderTemplatesByCategory(P);this.templatesModelStore$.next({selectedTemplate:void 0,flattenedTemplatesAndCategory:R})},F.prototype.initializeTemplates=function(P){return(0,p.__awaiter)(this,void 0,void 0,function(){var R,U;return(0,p.__generator)(this,function(V){switch(V.label){case 0:return[4,this.daxCapabilitiesService.getCapabilities()];case 1:return R=V.sent(),U=this.daxTemplateService.getTemplates(P,R,this.schemaName,1),this.updateTemplates(U),[2]}})})},F.prototype.flattenAndOrderTemplatesByCategory=function(P){var R=this,U=_.groupBy(P,function(A){return(0,oe.G)(A.capabilities.category,R.localizationService)}),V=[];for(var L in U){V.push({kind:"category",value:L});for(var K=0,B=U[L];K<B.length;K++)V.push({kind:"daxTemplate",value:B[K]})}return V},F.prototype.validateParameters=function(P,R){return(0,p.__awaiter)(this,void 0,void 0,function(){var U,V,L,K,B,z;return(0,p.__generator)(this,function(A){switch(A.label){case 0:return R&&P?[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]:[2,{result:{errors:{},warnings:{}},allParametersSet:!1}];case 1:return U=A.sent(),L=Z(P,U,V=this.daxTemplateService.utils),[4,this.daxCapabilitiesService.getCapabilities()];case 2:return K=A.sent(),B=!0,z=V.validateIfNeeded(R,U,K,{schemaName:this.schemaName,inputValues:L}),_.forEach(R.capabilities.input,function(re){var X=re.name,_e=P[X],ie=L[X];_e?.hasBeenSet?(!V.isValidValueForInput(ie,re,U)||re.instance&&ie.expression&&V.isDefaultValueFilter(ie.expression))&&(z.errors[X]="DaxTemplateDialog_ParameterRequired"):B=!1}),[2,{result:z,allParametersSet:B}]}})})},F.prototype.getParameters=function(P,R,U){var V=this.daxTemplateService.utils,L=Z(R,U,V),K=_.map(L,function(A){return A.expression});K.push.apply(K,this.sourceExpressions||[]);var z=function(F,P,R,U){for(var V={},K=function(X){var _e=P?P[X.name]:void 0,ie=void 0;_e&&(ie=_e.expression);var pe={name:X.name,displayName:(0,oe.G)(X.displayName,R),description:(0,oe.G)(X.description,R),hasBeenSet:!!ie,input:void 0};if(X.column)pe.input={kind:j._.Field,value:ie,validationInfo:{field:{kind:0,type:X.column.type}}};else if(X.measure)pe.input={kind:j._.Field,value:ie,validationInfo:{field:{kind:1,type:X.measure.type}}};else if(X.instance){var xe=void 0,Ie=void 0;ie&&(0,T.Hi)(ie)&&!_.isEmpty(ie.args)&&(xe=ie.args[0],U.isDefaultValueFilter(ie)||(Ie=ie)),pe.input={kind:j._.Instance,value:{field:xe,filter:Ie&&Y.yl.fromSQExpr(Ie)},validationInfo:{field:{kind:0,type:X.instance.column.type}}},pe.hasBeenSet=!!Ie}else if(X.constant)if(X.constant.type.numeric)pe.input={kind:j._.Number,value:ie&&(0,T.VC)(ie)&&ie.value,type:X.constant.type,validationInfo:{decimal:!0,integer:!0}};else if(X.constant.type.enumeration){var Ne=X.constant.type.enumeration.members(),Re=ie&&(0,T.VC)(ie)&&ie.value;pe.input={kind:j._.Enum,value:null!=Re?_.find(Ne,function(Ue){return Ue.value===Re}):void 0,type:X.constant.type,selectionOptions:Ne}}else X.constant.type.bool&&(pe.input={kind:j._.Boolean,value:ie&&(0,T.VC)(ie)&&ie.value});V[X.name]=pe},B=0,z=F.capabilities.input;B<z.length;B++)K(z[B]);return V}(P,V.generateValuesFromExpressions(P.capabilities.input,K,U),this.localizationService,V);return z},F.prototype.getNewMeasureMetadata=function(P,R,U){var V;return(0,p.__awaiter)(this,void 0,void 0,function(){var L,K,B,z,A=this;return(0,p.__generator)(this,function(re){switch(re.label){case 0:return L=R?.capabilities,L?[4,this.daxCapabilitiesService.getCapabilities()]:[2];case 1:return K=re.sent(),B=R?.getMeasureName(U,K,{schemaName:this.schemaName,inputValues:P}),(z={measureName:B}).formatType=null===(V=L.output)||void 0===V?void 0:V.format,_.forEach(L.input,function(X){var _e,ie,pe,xe,Ie;if(z.formatSource&&z.entity)return!1;if(X.measure||X.column){var Ne=null===(_e=P[X.name])||void 0===_e?void 0:_e.expression;D.fF.assertValue(Ne,"input expression should be defined");var Re=(null===(ie=X.measure)||void 0===ie?void 0:ie.shouldUseForEntitySource)||(null===(pe=X.column)||void 0===pe?void 0:pe.shouldUseForEntitySource),Ue=null===(xe=X.measure)||void 0===xe?void 0:xe.shouldUseForFormatting;if(Re){var Fe=(null===(Ie=A.targetEntity)||void 0===Ie?void 0:Ie.SourceRef)&&W.ib.deserializeExpr(A.targetEntity),ye=void 0;Fe&&(0,T.Lk)(Fe)&&(ye=Fe),(ye=ye??Ne.getTargetEntity())&&(z.entity=ye.entity,z.schema=A.schemaName)}Ue&&null==z.formatType&&(z.formatSource=W.ib.serializeExpr(Ne))}}),[2,z]}})})},F.prototype.onModelChanged=function(P){return(0,p.__awaiter)(this,void 0,void 0,function(){var R,U;return(0,p.__generator)(this,function(V){switch(V.label){case 0:return[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())];case 1:return R=V.sent(),U=c.rewrite(this.parametersStore$.value,P.changes,R,this.aggrOps),this.parametersStore$.next(U),[2]}})})},F.\u0275fac=function(R){return new(R||F)(S.\u0275\u0275inject(N.C),S.\u0275\u0275inject(k.i),S.\u0275\u0275inject(M.D),S.\u0275\u0275inject(g.r3),S.\u0275\u0275inject(y.c),S.\u0275\u0275inject(I.W),S.\u0275\u0275inject(m.J),S.\u0275\u0275inject(Q.o))},F.\u0275prov=S.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac}),F}();function Z(F,P,R){var U,V,L,K={};if(null==F)return K;for(var B in F){var z=void 0,A=null===(U=F[B])||void 0===U?void 0:U.input;if(A){if(e.M.isColumnOrMeasure(A))z=A.value;else if(e.M.isNumber(A))z=(0,ne.kQ)(A.value,A.type);else if(e.M.isEnum(A))z=(0,ne.kQ)(A.value.value,A.type);else if(e.M.isBoolean(A))z=(0,ne.O7)(A.value);else if(e.M.isInstance(A)&&null!==(V=A.value)&&void 0!==V&&V.filter&&null!==(L=A.value)&&void 0!==L&&L.field){var re=A.value,X=re.field,_e=re.filter,ie=X.getTargetColumnRef(P);_.isEmpty(_e.where())||(z=R.replacerRewrite(_e.where()[0].condition,ie,X))}z&&(K[B]={expression:z})}}return K}},96739:function(Oe,de,a){a.d(de,{M:function(){return e}});var p=a(64648),j=a(62458),e=function(){function $(){}return $.isNumber=function(c){return j.fF.assertValue(c,"daxTemplateParameter input"),c.kind===p._.Number},$.isEnum=function(c){return j.fF.assertValue(c,"daxTemplateParameter input"),c.kind===p._.Enum},$.isBoolean=function(c){return j.fF.assertValue(c,"daxTemplateParameter input"),c.kind===p._.Boolean},$.isColumnOrMeasure=function(c){return j.fF.assertValue(c,"daxTemplateParameter input"),c.kind===p._.Field},$.isInstance=function(c){return j.fF.assertValue(c,"daxTemplateParameter input"),c.kind===p._.Instance},$}()},51779:function(Oe,de,a){a.r(de),a.d(de,{QuickMeasuresLazyModule:function(){return Rn}});var p=a(52364),j=a(40645),e=a(50423),$=function(){function o(){}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({providers:[p.t,j.z]}),o}(),c=a(81337),W=a(95281),h=a(73058),D=a(62458),oe=a(72489),Y=a(94419),ne=a(9936),me=a(82762),ve=a(11547),Se=a(59973),be=a(17653),le=a(14172),Me=a(77526),Ee=a(83317),q=a(59822),d=a(48787),C=a(98513),x=a(83008),T=a(26898),S=a(37320),N=a(28894),k=a(76072),M=a(65181),m=a(72080),g=a(35911),y=a(54834),I=a(74082),Q=a(12985),H=a(58295),J=a(57151),Z=a(80435),ce=a(66890),F=a(21024),P=a(4633),R=a(38078),U=a(29804),V=a(94759),L=a(41114),K="PBI.QuickMeasuresPane.OpenPane",B=L.cx[K]=(0,L.b1)(K),z="PBI.QuickMeasuresPane.PivotSelected",A=L.cx[z]=(0,L.b1)(z),re="PBI.QuickMeasuresPane.UtteranceSubmitted",X=L.cx[re]=(0,L.b1)(re),_e="PBI.QuickMeasuresPane.DaxSaved",ie=L.cx[_e]=(0,L.b1)(_e),pe=function(){function o(r,t){this.certifiedEventsService=r,this.telemetryService=t,this.featureName="QuickMeasuresPane",this.utteranceSubmissionEventMap=new Map}return o.prototype.logOpenPaneEvent=function(r){return D.fF.assertValue(r,"entryPoint"),this.logCertifiedEvent(K,{entryPoint:r},"Succeeded"),this.telemetryService.logEvent(B,{entryPoint:r})},o.prototype.logPivotSelectedEvent=function(r,t){return D.fF.assertValue(r,"parentEvent"),D.fF.assertValue(t,"pivot"),this.logCertifiedEvent(z,{pivot:t},"Succeeded"),this.telemetryService.logChildEvent(r,A,{pivot:t})},o.prototype.startUtteranceSubmittedEvent=function(r){D.fF.assertValue(r,"parentEvent");var t=this.telemetryService.startChildEvent(r,X),i=this.certifiedEventsService.startTimedStandardizedFeatureEvent(this.featureName,re,this.telemetryService.root.id),s=(0,U.z)();return this.utteranceSubmissionEventMap.set(t.event.id,{featureEvent:i,copilotEventStartTime:s}),t},o.prototype.resolveUtteranceSubmittedEvent=function(r,t){D.fF.assertValue(r,"utteranceSubmittedEvent"),D.fF.assertValue(t,"eventArgs");var i=r.event.info;i.cancelled=t.cancelled,i.numberOfResults=t.numberOfResults,i.numberOfResultsShown=t.numberOfResultsShown,i.usesInitialSuggestion=t.usesInitialSuggestion,r.resolve();var s=this.utteranceSubmissionEventMap.get(r.event.id),l=s?.copilotEventStartTime,v=s?.featureEvent;if(D.fF.assertValue(v,"utteranceSubmissionCertifiedEvent"),D.fF.assertValue(l,"copilotUtteranceSubmissionCertifiedEventStartTime"),v&&l){var w="Succeeded";t.cancelled?w="Cancelled":0===t.numberOfResultsShown&&(w="Failed"),v.setAttribute("cancelled",t.cancelled),v.setAttribute("numberOfResults",t.numberOfResults),v.setAttribute("numberOfResultsShown",t.numberOfResultsShown),v.setAttribute("usesInitialSuggestion",t.usesInitialSuggestion),this.certifiedEventsService.logTimedStandardizedFeatureEvent({correlationId:R.b$.generateGuid(),originatingService:V.F1,activityName:"NlToDax",resultCode:"",featureName:(0,V.mN)("Usage","NlToDax"),activityStatus:w,operationStartTime:l,operationEndTime:(0,U.z)(),activityAttributes:{IsSignedIn:!0,Location:"Desktop",ContentMode:"Edit",Persona:"BI Developer"}}),v.complete(w),this.utteranceSubmissionEventMap.delete(r.event.id)}},o.prototype.logDaxSavedEvent=function(r,t){return D.fF.assertValue(r,"parentEvent"),D.fF.assertValue(t,"typeOfMeasure"),this.logCertifiedEvent(_e,{typeOfMeasure:t},"Succeeded"),this.telemetryService.logChildEvent(r,ie,{typeOfMeasure:t})},o.prototype.logCertifiedEvent=function(r,t,i){this.certifiedEventsService.logStandardizedFeatureEvent({correlationId:this.telemetryService.root.id,activityName:r,activityAttributes:t,resultCode:"",featureName:this.featureName,activityStatus:i},{normalizeHierarchicalSeparators:!0})},o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(P.ly),e.\u0275\u0275inject(P.y0))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),xe=function(o){function r(t){return o.call(this,t)||this}return(0,c.__extends)(r,o),r}(g.sH),Ie=function(){function o(r,t,i,s,l,v,w,G){this.daxTemplateService=r,this.daxCapabilitiesService=t,this.conceptualSchemaProxy=i,this.dataSources=s,this.quickMeasureTelemetryService=l,this.visualAuthoringService=v,this.lazyScoped=w,this.panesVisibilityService=G}return o.prototype.saveNewMeasure=function(r,t){return(0,c.__awaiter)(this,void 0,void 0,function(){var i,s,l,v,w,G=this;return(0,c.__generator)(this,function(ue){switch(ue.label){case 0:return D.fF.assertValue(r,"newMeasureArgs"),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return i=ue.sent(),s=r.visualContainerContext,function(o){return"DaxTemplate"===o.originType}(r)?(this.quickMeasureTelemetryService.logDaxSavedEvent(t,r.result.template.name),[4,this.createNewDaxTemplateMeasure(r,i)]):[3,3];case 2:return l=ue.sent(),[3,6];case 3:return function(o){return"NlToDax"===o.originType}(r)?(this.quickMeasureTelemetryService.logDaxSavedEvent(t,r.originType),[4,this.createNewNlToDaxMeasure(r,i)]):[3,5];case 4:return l=ue.sent(),[3,6];case 5:D.fF.assertFail("unknown quick measure args"),ue.label=6;case 6:return l&&this.expandDataPaneAfterNewMeasureCreated(),s&&(v=this.dataSources.get(),w=(0,Y.mv)((0,Y.nw)(l.schema,l.entity),l.name),this.visualAuthoringService.addFieldToVisual(w,v,s.visualContainer).catch(function(){return r.originalExpression&&!(0,H.k)(r.originalExpression)?Promise.reject("Original expression is not a measure"):G.visualAuthoringService.replaceField(w,s.role,s.index,s.visualContainer,v)})),[2]}})})},o.prototype.createNewNlToDaxMeasure=function(r,t){return(0,c.__awaiter)(this,void 0,void 0,function(){var i,l=this;return(0,c.__generator)(this,function(v){switch(v.label){case 0:return i={entity:r.targetEntityName,measureName:r.measureName,schema:Ue(t),formatString:r.formatString},[4,this.lazyScoped.get("quickCalcModern")];case 1:return[4,v.sent().createNewQuickMeasure(i.entity,i.schema,i.measureName,r.measureExpression,"NLtoDAX",function(w){return l.getFormattingSchemaChange(i,w,t)})];case 2:return[2,v.sent()]}})})},o.prototype.createNewDaxTemplateMeasure=function(r,t){return(0,c.__awaiter)(this,void 0,void 0,function(){var i,s,l,v,w,G,ue,fe,ge=this;return(0,c.__generator)(this,function(Ce){switch(Ce.label){case 0:return i=r.schemaName,(s=r.result)?[4,this.daxCapabilitiesService.getCapabilities()]:[2];case 1:return l=Ce.sent(),v=this.daxTemplateService.getTemplates(t,l,i,1),(w=_.find(v,function(E){return E.capabilities.name===s.template.name}))?(G=s.newMeasureMetadata,ue=_.mapValues(s.parameters,function(E){return{expression:y.ib.deserializeExpr(E.expression)}}),fe=w.apply(t,l,{schemaName:G.schema,inputValues:ue}),[4,this.lazyScoped.get("quickCalcModern")]):[2,Promise.reject(new xe("Dax template undefined"))];case 2:return[4,Ce.sent().createNewQuickMeasure(G.entity,G.schema,G.measureName,fe.dax,w.capabilities.name,function(E){return ge.getFormattingSchemaChange(G,E,t)})];case 3:return[2,Ce.sent()]}})})},o.prototype.getFormattingSchemaChange=function(r,t,i){if(null!=r.formatString)return{setCustomFormatStringInfo:{formatString:r.formatString,modelObject:Q.X6.getMeasureUrn(r.entity,t,r.schema)}};if(null!=r.formatType){var s=this.convertFormatToFormatKind(r.formatType);if(s)return{setFormatting:{format:s,modelObject:Q.X6.getMeasureUrn(r.entity,t,r.schema)}}}else if(r.formatSource){var l=this.getActualFormattingSource(r.formatSource,i);if(l)return{copyFormatting:{sourceSchema:l.schema,sourceEntity:l.entity,sourceProperty:l.property,schema:r.schema,targetEntity:r.entity,targetProperty:t,objectType:"Measure"}}}},o.prototype.getActualFormattingSource=function(r,t){var i=y.ib.deserializeExpr(r);if((0,I.kb)(i))return(s=i.source.getTargetEntity())&&{schema:s.schema,entity:s.entity,property:i.ref};if((0,I.iV)(i)){var l=i.arg.getTargetColumnRef(t);if(!l)return;var v=i.getMetadata(t),w=l.getMetadata(t),s=l.source.getTargetEntity();return v&&w&&s&&v.type.isCompatibleFrom(w.type)&&{schema:s.schema,entity:s.entity,property:l.ref}}},o.prototype.convertFormatToFormatKind=function(r){if(0===r)return"Percentage"},o.prototype.expandDataPaneAfterNewMeasureCreated=function(){this.panesVisibilityService.isPaneExpanded("data")||this.panesVisibilityService.setPaneExpansion("data",!0,!0)},o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(J.c),e.\u0275\u0275inject(Z.r3),e.\u0275\u0275inject(T.i),e.\u0275\u0275inject(x.D),e.\u0275\u0275inject(pe),e.\u0275\u0275inject(ce.$8),e.\u0275\u0275inject(N.H),e.\u0275\u0275inject(F.r))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}();function Ue(o){for(var r=0,t=o.schemas;r<t.length;r++){var i=t[r];if(i.capabilities.canEdit)return i.name}}var Fe=a(9380),ye=function(o){return o[o.Initial=0]="Initial",o[o.Loading=1]="Loading",o[o.Success=2]="Success",o[o.Error=3]="Error",o}({}),We={type:ye.Initial},Xe={inputBox:void 0,content:We,utterance:void 0,committedUtterance:void 0,loading:!0,validCalculations:void 0,activationRequired:void 0,isGenerateDaxDisabled:!0,isLoginButtonDisabled:!1},Ke=function(o){function r(t,i,s,l,v,w,G,ue,fe,De,ge,Ce){var E=o.call(this,Xe)||this;return E.adhocQueryRunner=t,E.conceptualSchemaProxy=i,E.dataSources=s,E.formatStringConverter=l,E.interpretListenerFactory=v,E.lazyScoped=w,E.localizationService=G,E.intellisenseService=ue,E.quickMeasurePreserver=fe,E.lazyProvider=De,E.featureSwitchService=ge,E.quickMeasureTelemetryService=Ce,E.viewModel$=E.state$,E.getDAXResults=E.effect(function(te){return te.pipe((0,Se.h)(function(){return!_.isEmpty(E.utterance)}),(0,be.b)(function(ae){if(E.utteranceSubmittedEvent){var Pe=_.includes(E.inputBox.initialSuggestions,E.utterance);E.resolveSubmittedUtteranceEvent(!0,0,0,Pe)}E.utteranceSubmittedEvent=E.quickMeasureTelemetryService.startUtteranceSubmittedEvent(E.parentEvent),E.updateCommittedUtterance(E.utterance),E.interpret(E.utterance,ae)}))}),E.reInterpretCommittedUtterance=E.effect(function(te){return te.pipe((0,Se.h)(function(){return!_.isEmpty(E.committedUtterance)}),(0,be.b)(function(ae){return E.interpret(E.committedUtterance,ae)}))}),E.monitorEmptyUtterance=E.effect(function(te){return te.pipe((0,Se.h)(function(ae){return void 0!==ae}),(0,le.U)(function(ae){return _.isEmpty(ae)}),(0,Me.x)(),(0,be.b)(function(ae){ae&&(E.utteranceSubmittedEvent&&E.resolveSubmittedUtteranceEvent(!0,0,0,!1),E.updateCommittedUtterance(""),E.setInitialContent()),E.setIsGenerateDaxDisabled(ae)}))}),E.setActivationRequired=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{activationRequired:ae})}),E.updateUtterance=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{utterance:ae})}),E.updateCommittedUtterance=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{committedUtterance:ae})}),E.updateLoadingShell=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{loading:ae})}),E.updateInputBoxVM=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{inputBox:ae})}),E.setIsGenerateDaxDisabled=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{isGenerateDaxDisabled:ae})}),E.setIsLoginButtonDisabled=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{isLoginButtonDisabled:ae})}),E.setLoadingContent=E.updater(function(te){return(0,c.__assign)((0,c.__assign)({},te),{content:{type:ye.Loading}})}),E.setInitialContent=E.updater(function(te){return(0,c.__assign)((0,c.__assign)({},te),{content:{type:ye.Initial}})}),E.setErrorContent=E.updater(function(te){return(0,c.__assign)((0,c.__assign)({},te),{content:{type:ye.Error}})}),E.setSuccessContent=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{content:ae})}),E.setValidCalculations=E.updater(function(te,ae){return(0,c.__assign)((0,c.__assign)({},te),{validCalculations:ae})}),E}return(0,c.__extends)(r,o),Object.defineProperty(r.prototype,"inputBox",{get:function(){return this.get().inputBox},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"content",{get:function(){return this.get().content},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"utterance",{get:function(){return this.get().utterance},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"result",{get:function(){return this.get().validCalculations},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"committedUtterance",{get:function(){return this.get().committedUtterance},enumerable:!1,configurable:!0}),r.prototype.initializeState=function(t,i){var s;return(0,c.__awaiter)(this,void 0,void 0,function(){var l,v,w,G;return(0,c.__generator)(this,function(ge){switch(ge.label){case 0:return this.parentEvent=i,l=1===t,D.fF.assert(function(){return!l},"nlToDax should be disabled"),l?[2]:[4,this.updateFormulaContext()];case 1:return ge.sent(),void 0!==(v=this.inputBox)?[3,3]:[4,this.initializeInputBox()];case 2:v=ge.sent(),ge.label=3;case 3:return[4,this.featureSwitchService.getFeatureSwitches()];case 4:return w=ge.sent(),G=w.quickMeasureInitialSuggestions,w.quickMeasureInitialSuggestions?_.isEmpty(v.initialSuggestions)?[4,this.updateInitialUtteranceSuggestions(v)]:[3,6]:[3,7];case 5:ge.sent(),ge.label=6;case 6:G=!1,ge.label=7;case 7:return this.setState({inputBox:v,content:this.content.type===ye.Loading?We:this.content,utterance:this.utterance,committedUtterance:this.committedUtterance,loading:G,validCalculations:null!==(s=this.result)&&void 0!==s?s:[],activationRequired:2===t,isGenerateDaxDisabled:_.isEmpty(this.utterance),isLoginButtonDisabled:!1}),[2]}})})},r.prototype.setupUtteranceListener=function(t){this.updateUtterance(t),this.monitorEmptyUtterance(t)},r.prototype.updateInitialUtteranceSuggestions=function(t){return void 0===t&&(t=this.inputBox),(0,c.__awaiter)(this,void 0,void 0,function(){var s=this;return(0,c.__generator)(this,function(l){switch(l.label){case 0:return[4,this.getInitialSuggestions(t.qnaSupportedScopes)];case 1:return l.sent().pipe((0,Ee.R)(this.destroy$)).subscribe(function(v){null!=v?.result&&(t.initialSuggestions=_.map(v.result.utterances,function(w){return w.text})),s.updateInputBoxVM(t),s.updateLoadingShell(!1)}),[2]}})})},r.prototype.getInitialSuggestions=function(t){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(s){switch(s.label){case 0:return[4,this.lazyProvider.get("@powerbi/Qna/qnadesktop.module#QnaDesktopModule","InterpretServiceModern")];case 1:return[2,s.sent().getSuggestedDefineCalculationQuestions(t)]}})})},r.prototype.saveNewMeasure=function(t,i){var s,l;return(0,c.__awaiter)(this,void 0,void 0,function(){var v,w,G,ue,fe,De,ge=this;return(0,c.__generator)(this,function(Ce){switch(Ce.label){case 0:return[4,this.lazyScoped.get("quickMeasures")];case 1:return w=Ce.sent(),D.fF.assertValue(w,"quickMeasuresService"),_.isEmpty(this.result)?[3,4]:(D.fF.assert(function(){return null!=i&&i>=0&&i<ge.result.length},"suggestedDaxIndex must be defined and within bounds"),(G=(0,c.__assign)({},this.result[i])).expression=t,(ue=null!==(s=G.homeTable)&&void 0!==s?s:w.inputArgs.nlToDax.targetEntityName)?[3,3]:[4,this.conceptualSchemaProxy.get(this.dataSources.get())]);case 2:fe=Ce.sent(),De=_.find(fe.schemas,function(E){return!E.isExtensionSchema}),ue=null===(l=_.find(De.entities,function(E){return 0===E.visibility&&!E.errorMessage&&!E.isDateTable}))||void 0===l?void 0:l.name,Ce.label=3;case 3:v={measureName:"Measure",measureExpression:G.expression,originType:"NlToDax",originalExpression:w.inputArgs.originalExpr,targetEntityName:ue,visualContainerContext:w.inputArgs.visualContainerContext,formatString:G.format},Ce.label=4;case 4:return v?[4,this.quickMeasurePreserver.saveNewMeasure(v,this.parentEvent)]:[2];case 5:return Ce.sent(),[2]}})})},r.prototype.updateFormulaContext=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.intellisenseService.updateFormulaContextAsync()];case 1:return t.sent(),[2]}})})},r.prototype.interpret=function(t,i){this.setLoadingContent(),i.inputBox.interpretUtterance({utterance:t,suppressSuggestions:!0,incomingTags:["Committed"],isCommitInCommitQuestionOnDemandMode:!0})},r.prototype.tryEnableNlToDax=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var t;return(0,c.__generator)(this,function(i){switch(i.label){case 0:return[4,this.lazyScoped.get("nlToDaxSupportability")];case 1:return t=i.sent(),D.fF.assertValue(t,"nlToDaxSupportability"),this.setIsLoginButtonDisabled(!0),[4,t.tryEnableNlToDax()];case 2:return i.sent(),this.setIsLoginButtonDisabled(!1),[2]}})})},r.prototype.initializeInputBox=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var t,i,s;return(0,c.__generator)(this,function(l){return t=_.find(this.dataSources.get(),function(v){return v.type===h.nKy}),s=this.interpretListenerFactory.createInterpretListener({canShowDidYouMean:!1,canShowPods:!1,canShowVisuals:!1,forTrainingTermBinding:!1,models:i=[{vsName:t.dsr.vsName,dbName:t.dsr.dbName,qnaSupported:!0,id:t.id}]}),this.setupInterpretObservables(s),[2,{entryPoint:"NlToDax",initialSuggestions:[],configs:{autoFocusOnInit:!0,showCorrectedUtterance:!1,showQuestionIcon:!1,customPlaceholderText:this.localizationService.get("NlToDax_Input_Placeholder"),showLoadingIcon:!1,calculation:{language:"DAX",isCommitted:!1},considerDroppedSpans:!1,considerErrorSpans:!1,considerWarningSpans:!1,commitOnDemandForcedMode:"AlwaysOn",commitOnDemandConfigs:{hideCommitActionUI:!0,noCommitOnDropdownSelection:!0,noCommitOnInitialUtterance:!0}},presentationArgs:{withBorder:!0,height:96,allowContentHorizontalScroll:!0,useShellTheme:!0},interpretListener:s,qnaSupportedScopes:_.map(i,function(v){return{model:v}})}]})})},r.prototype.setupInterpretObservables=function(t){var i=this;t.getObservable().pipe((0,Ee.R)(this.destroy$),(0,Se.h)(function(s){return!!s&&1!==s.resultType})).subscribe(function(s){return(0,c.__awaiter)(i,void 0,void 0,function(){var l;return(0,c.__generator)(this,function(v){switch(v.label){case 0:return(l=s.request)&&l.isCommitted&&this.utterance===this.committedUtterance?3!==s.resultType?[3,1]:(this.processErrorResult(l.utterance),[3,3]):[2];case 1:return 2!==s.resultType?[3,3]:[4,this.processSuccessResult(s)];case 2:v.sent(),v.label=3;case 3:return[2]}})})})},r.prototype.processErrorResult=function(t){this.setErrorContent();var i=_.includes(this.inputBox.initialSuggestions,t);this.resolveSubmittedUtteranceEvent(!1,0,0,i)},r.prototype.processSuccessResult=function(t){return(0,c.__awaiter)(this,void 0,void 0,function(){var i,s,l,v,w,G,fe=this;return(0,c.__generator)(this,function(De){for(s=[],l=0,v=i=t.calculations;l<v.length;l++)G=(0,Y.PB)("dax",(w=v[l]).expression,3,void 0,void 0,w.format),s.push(this.adhocQueryRunner.getValues([G],{executionOptions:{allowResultFromClientCache:!0}}));return(0,ne.D)(_.map(s,function(ge){return(0,me.D)(ge).pipe((0,q.K)(function(Ce){return(0,ve.of)(void 0)}))})).pipe((0,d.q)(1)).subscribe(function(ge){for(var Ce,E,te={type:ye.Success,cards:[]},ae=[],Pe=0;Pe<i.length;Pe++)if(null!==(Ce=ge[Pe])&&void 0!==Ce&&Ce.result){var Ge=ge[Pe].result[0][0],qe=fe.convertDotNetFormatStringToVBA(i[Pe].format,Ge);ae.push((0,c.__assign)((0,c.__assign)({},i[Pe]),{format:qe}));var Le=(0,oe.WU)(Ge,i[Pe].format);if(te.cards.push({daxDisplay:{daxExpression:i[Pe].expression,formattedValue:Le},restatement:i[Pe].restatement,isExpanded:0===Pe}),3===te.cards.length)break}fe.setValidCalculations(ae),_.some(te.cards,function(et){var je;return _.isEmpty(null===(je=et.restatement)||void 0===je?void 0:je.trim())})&&_.forEach(te.cards,function(et,je){return et.restatement=fe.localizationService.format("NlToDax_SuggestionCount",je+1)});var ut=_.size(te.cards);0===ut?fe.setErrorContent():fe.setSuccessContent(te);var Vn=_.includes(fe.inputBox.initialSuggestions,null===(E=t.request)||void 0===E?void 0:E.utterance);fe.resolveSubmittedUtteranceEvent(!1,i.length,ut,Vn)}),[2]})})},r.prototype.resolveSubmittedUtteranceEvent=function(t,i,s,l){this.utteranceSubmittedEvent&&(this.quickMeasureTelemetryService.resolveUtteranceSubmittedEvent(this.utteranceSubmittedEvent,{cancelled:t,numberOfResults:i,numberOfResultsShown:s,usesInitialSuggestion:l}),this.utteranceSubmittedEvent=void 0)},r.prototype.convertDotNetFormatStringToVBA=function(t,i){if(t){var s="Custom";return i instanceof Date?s="DateTimeGeneralPattern":"number"==typeof i?s="General":"boolean"==typeof i?s="Boolean":"string"==typeof i&&(s="Text"),this.formatStringConverter.DotNetToVBAWithFormat(s,t)}},r.\u0275fac=function(i){return new(i||r)(e.\u0275\u0275inject(C.w),e.\u0275\u0275inject(T.i),e.\u0275\u0275inject(x.D),e.\u0275\u0275inject(j.z),e.\u0275\u0275inject(S.y),e.\u0275\u0275inject(N.H),e.\u0275\u0275inject(M.o),e.\u0275\u0275inject(m.e),e.\u0275\u0275inject(Ie),e.\u0275\u0275inject(k.E),e.\u0275\u0275inject(Fe.vZ),e.\u0275\u0275inject(pe))},r.\u0275prov=e.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(W.m1),Je=a(8590),He=a(73221),Ze=a(11494),n=a(77476),u=a(59968),f=a(44581),b=a(86663),O=a(24326),ee=a(73360),he=a(74913),se=a(1685),Te=a(35510),ze=a(30794),we=a(59017),Ve=a(698),Be=a(86425),Qe=a(85102),Ye=["learnMoreLink"];function ct(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"pbi-spinner"),e.\u0275\u0275elementContainerEnd())}function dt(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(s.onToggleDaxExpansion())}),e.\u0275\u0275element(1,"span",18)(2,"i",19),e.\u0275\u0275elementEnd()}}function pt(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(s.onToggleDaxExpansion())}),e.\u0275\u0275element(1,"span",20)(2,"i",21),e.\u0275\u0275elementEnd()}}function ft(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,dt,3,0,"button",15),e.\u0275\u0275template(2,pt,3,0,"ng-template",null,16,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&o){var t=e.\u0275\u0275reference(3),i=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.isExpanded)("ngIfElse",t)}}var mt=function(r){return{display:r}};function vt(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",7),e.\u0275\u0275listener("on-resize",function(v){e.\u0275\u0275restoreView(t);var w=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(w.onPaneResize(v))}),e.\u0275\u0275template(1,ct,2,0,"ng-container",8),e.\u0275\u0275elementStart(2,"div",4)(3,"div",9),e.\u0275\u0275element(4,"h3",10),e.\u0275\u0275elementStart(5,"a",11,12),e.\u0275\u0275element(7,"i",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"monaco-editor-host",14),e.\u0275\u0275listener("initialized",function(){e.\u0275\u0275restoreView(t);var v=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(v.onMonacoInitialized.next())})("on-focus-enter",function(v){e.\u0275\u0275restoreView(t);var w=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(w.onFocusEnterMonacoEditor(v))})("onContentChanged",function(v){e.\u0275\u0275restoreView(t);var w=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(w.onContentChanged(v))})("onContentHeightChanged",function(v){e.\u0275\u0275restoreView(t);var w=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(w.onContentHeightChanged(v))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,ft,4,2,"div",8),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()}if(2&o){var i=r.ngIf,s=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.isLoading),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(9,mt,i.isLoading?"none":"inherit")),e.\u0275\u0275advance(6),e.\u0275\u0275property("selection",s.selection)("formulaText",s.formulaText)("customCreationOptions",s.monacoCreationOptions)("defaultMonacoProviderConfig",s.monacoProviderConfig),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(10,7,s.displayHeightToggle$))}}var gt=function(r){return{"margin-top":r}},tt="Measure = ",nt=function(o){function r(){var t=o.call(this)||this;return t.onAdd=new e.EventEmitter,t.monacoVm$=new Te.X({isExpanded:!1,isLoading:!0,height:117,width:284,contentHeight:void 0}),t.displayHeightToggle$=t.monacoVm$.pipe((0,le.U)(function(i){return i.contentHeight>117}),(0,Me.x)()),t.monacoCreationOptions={overviewRulerLanes:0,selectionHighlight:!1,occurrencesHighlight:!1,matchBrackets:"never",lineDecorationsWidth:0,lineNumbersMinChars:0,lineNumbers:"off",glyphMargin:!1,mouseWheelZoom:!1,scrollbar:{verticalScrollbarSize:0,handleMouseWheel:!1},guides:{highlightActiveBracketPair:!1,highlightActiveIndentation:!1,indentation:!1},renderLineHighlight:"none",selectOnLineNumbers:!1},t.selection={startPosition:0,length:0},t.monacoProviderConfig={formatting:{enabled:!0}},t.onMonacoInitialized=new ze.xQ,t.monacoDimensions$=t.monacoVm$.pipe((0,le.U)(function(i){return{width:i.width,height:i.height}}),(0,Me.x)(function(i,s){return i.height===s.height&&i.width===s.width})),t}return(0,c.__extends)(r,o),r.prototype.ngOnInit=function(){var t=this;this.formulaText=tt+this.suggestedDax.daxExpression,this.lifecycleSubscriptions.add((0,we.aj)([this.onMonacoInitialized,this.monacoDimensions$]).subscribe(function(i){var l=i[1];t.monacoEditorHost.layout(l.width,l.height)}))},r.prototype.onFocusEnterMonacoEditor=function(t){var i=this;"program"===t.origin&&setTimeout(function(){return i.learnMoreElement.nativeElement.focus()},1)},r.prototype.onToggleDaxExpansion=function(){var t=!this.monacoVm$.value.isExpanded,i=this.monacoVm$.value.contentHeight;D.fF.assertValue(i,"daxContentHeight");var s=t?i:117;this.monacoVm$.next((0,c.__assign)((0,c.__assign)({},this.monacoVm$.value),{isExpanded:t,height:s}))},r.prototype.onPaneResize=function(t){return(0,c.__awaiter)(this,void 0,void 0,function(){var v;return(0,c.__generator)(this,function(w){switch(w.label){case 0:return v=Math.max(t.width-24-24,0),this.monacoVm$.next((0,c.__assign)((0,c.__assign)({},this.monacoVm$.value),{width:v})),[4,this.monacoEditorHost.format()];case 1:return w.sent(),[2]}})})},r.prototype.onContentChanged=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.monacoEditorHost.format()];case 1:return t.sent(),this.monacoVm$.next((0,c.__assign)((0,c.__assign)({},this.monacoVm$.value),{isLoading:!1})),[2]}})})},r.prototype.onContentHeightChanged=function(t){var s;s=this.monacoVm$.value.isExpanded?t:t>117?117:t,this.monacoVm$.next((0,c.__assign)((0,c.__assign)({},this.monacoVm$.value),{contentHeight:t,height:s}))},r.prototype.onAddClick=function(){var t,i=null===(t=this.monacoEditorHost.textEditor.getModel())||void 0===t?void 0:t.getValue();D.fF.assertValue(i,"formula");var s=i?i.substring(_.size(tt)):this.suggestedDax.daxExpression;this.onAdd.emit(s)},r.prototype.ngOnDestroy=function(){return o.prototype.ngOnDestroy.call(this)},r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["suggested-dax-card"]],viewQuery:function(i,s){if(1&i&&(e.\u0275\u0275viewQuery(se.C,5),e.\u0275\u0275viewQuery(Ye,5)),2&i){var l=void 0;e.\u0275\u0275queryRefresh(l=e.\u0275\u0275loadQuery())&&(s.monacoEditorHost=l.first),e.\u0275\u0275queryRefresh(l=e.\u0275\u0275loadQuery())&&(s.learnMoreElement=l.first)}},inputs:{suggestedDax:"suggestedDax"},outputs:{onAdd:"onAdd"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:13,vars:17,consts:[[1,"preview-container"],["localize","NlToDax_PreviewValue",1,"subtitle"],[1,"preview-value","pbi-font-32-reg",3,"title"],["class","dax-container",3,"on-resize",4,"ngIf"],[3,"ngStyle"],[1,"footer"],["type","button","localize","ItemAction_Add",1,"pbi-fluent-button","primary",3,"click"],[1,"dax-container",3,"on-resize"],[4,"ngIf"],[1,"subtitle-container"],["localize","NlToDax_DaxSubtitle",1,"subtitle"],["target","_blank","rel","noreferrer noopener","href","https://go.microsoft.com/fwlink/?linkid=2174931",1,"pbi-internal-link"],["learnMoreLink",""],[1,"glyphicon","pbi-glyph-help","glyph-small"],["tabindex","1","mode","dax","theme","dax",3,"selection","formulaText","customCreationOptions","defaultMonacoProviderConfig","initialized","on-focus-enter","onContentChanged","onContentHeightChanged"],["class","pbi-icon-button pbi-with-text height-toggle-button",3,"click",4,"ngIf","ngIfElse"],["showMoreButton",""],[1,"pbi-icon-button","pbi-with-text","height-toggle-button",3,"click"],["localize","ShowLess",1,"text"],[1,"glyphicon","pbi-glyph-chevronupsmall","glyph-mini"],["localize","ShowMore",1,"text"],[1,"glyphicon","pbi-glyph-chevrondownsmall","glyph-mini"]],template:function(i,s){1&i&&(e.\u0275\u0275elementStart(0,"section",0),e.\u0275\u0275element(1,"h3",1),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275elementStart(3,"h2",2),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(5,"hr"),e.\u0275\u0275template(6,vt,11,11,"section",3),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275element(8,"hr",4),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementStart(10,"section",5)(11,"button",6),e.\u0275\u0275listener("click",function(){return s.onAddClick()}),e.\u0275\u0275pipe(12,"localize"),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(2,7,"NlToDax_PreviewValue")),e.\u0275\u0275advance(2),e.\u0275\u0275property("title",s.suggestedDax.formattedValue),e.\u0275\u0275attribute("aria-label",s.suggestedDax.formattedValue),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(s.suggestedDax.formattedValue),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,9,s.monacoVm$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(15,gt,e.\u0275\u0275pipeBind1(9,11,s.displayHeightToggle$)?"0px":"12px")),e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(12,13,"ItemAction_Add")))},dependencies:[n.NgIf,n.NgStyle,Ve.O,u.X,se.C,Be.v,O.k,n.AsyncPipe,Qe.F],styles:['[_nghost-%COMP%]{padding:12px;display:flex;flex-direction:column;background-color:var(--colorNeutralBackground1);color:var(--colorNeutralForeground1);box-shadow:0 0 2px var(--colorNeutralShadowAmbient),0 4px 8px var(--colorNeutralShadowKey)}[_nghost-%COMP%]   .preview-container[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .preview-container[_ngcontent-%COMP%]   .preview-value[_ngcontent-%COMP%]{text-align:center;width:100%;line-height:42px;margin-top:16px;margin-bottom:20px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}[_nghost-%COMP%]   .dax-container[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .dax-container[_ngcontent-%COMP%]   .subtitle-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:flex-end;padding:12px 0}[_nghost-%COMP%]   .dax-container[_ngcontent-%COMP%]   .subtitle-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .dax-container[_ngcontent-%COMP%]   .subtitle-container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:none}[_nghost-%COMP%]   .dax-container[_ngcontent-%COMP%]   .height-toggle-button[_ngcontent-%COMP%]{background-color:var(--colorNeutralBackground1);color:var(--colorBrandForeground1)}[_nghost-%COMP%]   .dax-container[_ngcontent-%COMP%]   .height-toggle-button[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:var(--sm-font-size, 12px)}[_nghost-%COMP%]   hr[_ngcontent-%COMP%]{background-color:var(--colorNeutralStroke3);height:1px;width:100%;border:none;margin:0}[_nghost-%COMP%]   .footer[_ngcontent-%COMP%]{margin-top:8px;display:flex;flex-direction:row;justify-content:flex-end}[_nghost-%COMP%]   h3.subtitle[_ngcontent-%COMP%]{text-align:start;font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--md-font-size, 14px);font-weight:var(--font-weight-semi-bold, 600)}[_nghost-%COMP%]   .pbi-fluent-button[_ngcontent-%COMP%]{padding:6px 16px}html:not([dir="rtl"])   [_nghost-%COMP%]   .glyphicon[_ngcontent-%COMP%]{margin-left:4px}html[dir="rtl"]   [_nghost-%COMP%]   .glyphicon[_ngcontent-%COMP%]{margin-right:4px}[_nghost-%COMP%]     monaco-editor-host .monacor-editor{background-color:var(--colorNeutralBackground1)}[_nghost-%COMP%]     monaco-editor-host .scrollbar.vertical{display:none}[_nghost-%COMP%]     monaco-editor-host .lines-content .view-lines{cursor:default}[_nghost-%COMP%]     monaco-editor-host .lines-content .view-lines .view-line{pointer-events:none}[_nghost-%COMP%]     monaco-editor-host .decorationsOverviewRuler{display:none}[_nghost-%COMP%]     monaco-editor-host .cursors-layer .cursor{display:none!important}']}),r}(He.w),yt=["qnaInputV2LazyComponent"];function Ct(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",4),e.\u0275\u0275element(2,"pbi-icon",5)(3,"p",6),e.\u0275\u0275elementStart(4,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(l.onEnableNlToDax())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&o){var i=e.\u0275\u0275nextContext(2).ngIf;e.\u0275\u0275advance(4),e.\u0275\u0275property("disabled",i.isLoginButtonDisabled)}}function St(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"qna-input-v2-lazy",15,16),e.\u0275\u0275listener("inputBoxInitialized",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(l.onInputBoxInitialized())})("enterKeyPressed",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(l.getDAXResults())}),e.\u0275\u0275elementEnd()}if(2&o){var i=e.\u0275\u0275nextContext(3).ngIf;e.\u0275\u0275property("entryPoint",i.inputBox.entryPoint)("configs",i.inputBox.configs)("initialUtterance",i.utterance)("interpretListener",i.inputBox.interpretListener)("presentationArgs",i.inputBox.presentationArgs)("qnaSupportedScopes",i.inputBox.qnaSupportedScopes)("utteranceSuggestions",i.inputBox.initialSuggestions)}}function Mt(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",19),e.\u0275\u0275element(2,"tri-svg-icon",20)(3,"span",21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd())}function bt(o,r){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",22),e.\u0275\u0275element(2,"pbi-spinner",23)(3,"span",24),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd())}function Et(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"suggested-dax-card",31),e.\u0275\u0275listener("onAdd",function(l){e.\u0275\u0275restoreView(t);var v=e.\u0275\u0275nextContext().index,w=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(w.onAddDax(l,v))}),e.\u0275\u0275elementEnd()}if(2&o){var i=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("suggestedDax",i.daxDisplay)}}var Tt=function(r){return{expanded:r}},Pt=function(r,t){return{"pbi-glyph-chevronupsmall":r,"pbi-glyph-chevrondownsmall":t}};function It(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",27)(1,"div",28),e.\u0275\u0275listener("accessible-click",function(){var v=e.\u0275\u0275restoreView(t).$implicit,w=e.\u0275\u0275nextContext(6);return e.\u0275\u0275resetView(w.toggleCardExpansion(v))}),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"i",29),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Et,1,1,"suggested-dax-card",30),e.\u0275\u0275elementEnd()}if(2&o){var i=r.$implicit;e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,Tt,i.isExpanded)),e.\u0275\u0275advance(1),e.\u0275\u0275attribute("aria-expanded",i.isExpanded),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(i.restatement),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction2(7,Pt,i.isExpanded,!i.isExpanded)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.isExpanded)}}function Dt(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",25),e.\u0275\u0275template(2,It,6,10,"div",26),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&o){var t=e.\u0275\u0275nextContext(4).ngIf;e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.content.cards)}}function Ot(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",32),e.\u0275\u0275element(2,"pbi-icon",33),e.\u0275\u0275elementStart(3,"div",34),e.\u0275\u0275element(4,"span",35)(5,"a",36),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",37),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(s.onSelectACalculation())}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}}function Nt(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0,17),e.\u0275\u0275template(1,Mt,4,0,"ng-container",18),e.\u0275\u0275template(2,bt,4,0,"ng-container",18),e.\u0275\u0275template(3,Dt,3,1,"ng-container",18),e.\u0275\u0275template(4,Ot,7,0,"ng-container",18),e.\u0275\u0275elementContainerEnd()),2&o){var t=e.\u0275\u0275nextContext(3).ngIf,i=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngSwitch",t.content.type),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",i.NlToDaxContentType.Initial),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",i.NlToDaxContentType.Loading),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",i.NlToDaxContentType.Success),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",i.NlToDaxContentType.Error)}}function wt(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",8),e.\u0275\u0275template(1,St,2,7,"qna-input-v2-lazy",9),e.\u0275\u0275elementStart(2,"div",10)(3,"button",11),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(l.getDAXResults())}),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(4,"section",12),e.\u0275\u0275element(5,"p",13),e.\u0275\u0275template(6,Nt,5,5,"ng-container",14),e.\u0275\u0275elementEnd()}if(2&o){var i=e.\u0275\u0275nextContext(2).ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!!i.inputBox),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",i.isGenerateDaxDisabled),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!!i.content)}}function Ft(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Ct,5,1,"ng-container",1),e.\u0275\u0275template(2,wt,7,3,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd()),2&o){var t=e.\u0275\u0275reference(3),i=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.activationRequired)("ngIfElse",t)}}function Rt(o,r){1&o&&e.\u0275\u0275element(0,"pbi-spinner")}function Vt(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"section"),e.\u0275\u0275template(1,Ft,4,2,"ng-container",1),e.\u0275\u0275template(2,Rt,1,0,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&o){var t=r.ngIf,i=e.\u0275\u0275reference(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!!t&&!t.loading)("ngIfElse",i)}}var it=function(o){function r(t,i,s){var l=o.call(this)||this;return l.eventBridge=t,l.nlToDaxStoreService=i,l.featureSwitchService=s,l.onSwitchToCalculation=new e.EventEmitter,l.viewModel$=l.nlToDaxStoreService.viewModel$,l.NlToDaxContentType=ye,l.subscriptionManager=l.eventBridge.createChannelSubscriptionManager().subscribe(Je.CCe,function(v,w){var G,ue,fe,De,ge=w.result.changes,Ce=null===(G=_.find(ge,function(Le){return Le.newMeasureCreated}))||void 0===G?void 0:G.newMeasureCreated,E=null===(ue=_.find(ge,function(Le){return Le.setJsonExtendedMetadata}))||void 0===ue?void 0:ue.setJsonExtendedMetadata,te=null===(fe=_.find(ge,function(Le){return Le.newCalculatedColumnCreated}))||void 0===fe?void 0:fe.newCalculatedColumnCreated,ae=null===(De=_.find(ge,function(Le){return Le.setFormatString}))||void 0===De?void 0:De.setFormatString,Pe=!1,qe=null!=ae&&ae.modelObject===l.newMeasureModelObject;null!=Ce&&null!=E?(Pe=!0,l.newMeasureModelObject=E.modelObject):qe?(Pe=!0,l.newMeasureModelObject=void 0):null!=l.newMeasureModelObject?l.newMeasureModelObject=void 0:null!=te&&(Pe=!0),Pe||l.onModelChanged()}),l}return(0,c.__extends)(r,o),r.prototype.ngOnInit=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var t,i=this;return(0,c.__generator)(this,function(s){switch(s.label){case 0:return[4,this.nlToDaxStoreService.initializeState(this.mode,this.parentEvent)];case 1:return s.sent(),this.changes$("mode").pipe((0,Ee.R)(this.onDestroy$)).subscribe(function(l){1===l&&i.onSwitchToCalculation.emit()}),t=this.changes$("mode").pipe((0,le.U)(function(l){return 2===l}),(0,Me.x)()),this.nlToDaxStoreService.setActivationRequired(t),[2]}})})},r.prototype.ngOnDestroy=function(){this.subscriptionManager.unsubscribeAll(),o.prototype.ngOnDestroy.call(this)},r.prototype.onInputBoxInitialized=function(){this.nlToDaxStoreService.setupUtteranceListener(this.qnaInputV2LazyComponent.inputBox.distinctDisplayedUtterance$)},r.prototype.getDAXResults=function(){this.nlToDaxStoreService.getDAXResults(this.qnaInputV2LazyComponent)},r.prototype.onAddDax=function(t,i){this.nlToDaxStoreService.saveNewMeasure(t,i)},r.prototype.onEnableNlToDax=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.nlToDaxStoreService.tryEnableNlToDax()];case 1:return t.sent(),[2]}})})},r.prototype.onSelectACalculation=function(){this.onSwitchToCalculation.emit()},r.prototype.toggleCardExpansion=function(t){t.isExpanded=!t.isExpanded},r.prototype.onModelChanged=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(i){switch(i.label){case 0:return[4,this.featureSwitchService.getFeatureSwitches()];case 1:return i.sent().quickMeasureInitialSuggestions&&this.nlToDaxStoreService.updateInitialUtteranceSuggestions(),this.nlToDaxStoreService.reInterpretCommittedUtterance(this.qnaInputV2LazyComponent),[4,this.nlToDaxStoreService.updateFormulaContext()];case 2:return i.sent(),[2]}})})},r.\u0275fac=function(i){return new(i||r)(e.\u0275\u0275directiveInject(Ze.J),e.\u0275\u0275directiveInject(Ke),e.\u0275\u0275directiveInject(Fe.vZ))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["nl-to-dax"]],viewQuery:function(i,s){var l;(1&i&&e.\u0275\u0275viewQuery(yt,5),2&i)&&(e.\u0275\u0275queryRefresh(l=e.\u0275\u0275loadQuery())&&(s.qnaInputV2LazyComponent=l.first))},inputs:{parentEvent:"parentEvent",mode:"mode"},outputs:{onSwitchToCalculation:"onSwitchToCalculation"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["loadingTemplate",""],["readyTemplate",""],[1,"activation-container"],["name","signin","size","large"],["localize","NlToDax_Disabled"],["localize","NlToDax_Enable_Action",1,"pbi-fluent-button","primary",3,"disabled","click"],[1,"input-container"],["aria-required","true","drag-resize-disabled","true","tabindex","-1",3,"entryPoint","configs","initialUtterance","interpretListener","presentationArgs","qnaSupportedScopes","utteranceSuggestions","inputBoxInitialized","enterKeyPressed",4,"ngIf"],[1,"input-button-container"],["type","button","localize","Generate",1,"pbi-fluent-button","primary",3,"disabled","click"],[1,"content-container"],["localize","NlToDax_SuggestedMeasures",1,"fluentTheme-lg-semiBold"],[3,"ngSwitch",4,"ngIf"],["aria-required","true","drag-resize-disabled","true","tabindex","-1",3,"entryPoint","configs","initialUtterance","interpretListener","presentationArgs","qnaSupportedScopes","utteranceSuggestions","inputBoxInitialized","enterKeyPressed"],["qnaInputV2LazyComponent",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"initial-content"],["name","sparkles_32_filled","sprite","copilot-icons",1,"initial-icon"],["localize","NlToDax_Initial"],[1,"loading-content"],[1,"pbi-spinner-large"],["localize","NlToDax_Loading"],[1,"success-content"],["class","daxCard",3,"ngClass",4,"ngFor","ngForOf"],[1,"daxCard",3,"ngClass"],["role","button","tabindex","0",1,"cardRestatement",3,"accessible-click"],[1,"glyphicon","glyph-mini",3,"ngClass"],[3,"suggestedDax","onAdd",4,"ngIf"],[3,"suggestedDax","onAdd"],[1,"error-content"],["name","search","size","large"],[1,"error-message"],["localize","NlToDax_Error"],["target","_blank","rel","noreferrer noopener","href","https://go.microsoft.com/fwlink/?linkid=2174611","localize","Generic_LearnMore",1,"pbi-external-link"],["localize","DaxTemplateDialog_SelectMeasurePrompt",1,"pbi-fluent-button","primary",3,"click"]],template:function(i,s){1&i&&(e.\u0275\u0275template(0,Vt,4,2,"section",0),e.\u0275\u0275pipe(1,"async")),2&i&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,s.viewModel$))},dependencies:[n.NgClass,n.NgForOf,n.NgIf,n.NgSwitch,n.NgSwitchCase,u.X,f.t,b._,O.k,ee.j,he.M,nt,n.AsyncPipe],styles:['[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:24px;display:flex;flex-direction:column}[_nghost-%COMP%]   .input-container[_ngcontent-%COMP%]   .input-button-container[_ngcontent-%COMP%]{margin-top:12px;display:flex;flex-direction:row;justify-content:flex-end}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]{color:var(--colorNeutralForeground1)}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .initial-content[_ngcontent-%COMP%], [_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%], [_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .error-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;margin:44px 12px 12px}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .initial-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], [_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-align:center;margin-top:22px}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .initial-content[_ngcontent-%COMP%]   .initial-icon[_ngcontent-%COMP%]{width:32px;height:32px}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .loading-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:12px}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .error-content[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{text-align:center;margin:22px 0}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .error-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .error-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-left:4px}html[dir="rtl"]   [_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .error-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-right:4px}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .success-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .success-content[_ngcontent-%COMP%]   .daxCard[_ngcontent-%COMP%]{margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--colorNeutralStroke1)}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .success-content[_ngcontent-%COMP%]   .daxCard[_ngcontent-%COMP%]   .cardRestatement[_ngcontent-%COMP%]{display:flex;font-size:var(--sm-font-size, 12px);justify-content:space-between;color:var(--colorBrandForeground1);line-height:16px;cursor:pointer;font-weight:var(--font-weight-semi-bold, 600)}html:not([dir="rtl"])   [_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .success-content[_ngcontent-%COMP%]   .daxCard[_ngcontent-%COMP%]   .cardRestatement[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:12px}html[dir="rtl"]   [_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .success-content[_ngcontent-%COMP%]   .daxCard[_ngcontent-%COMP%]   .cardRestatement[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .content-container[_ngcontent-%COMP%]   .success-content[_ngcontent-%COMP%]   .daxCard.expanded[_ngcontent-%COMP%]   .cardRestatement[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .activation-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:80px 0}[_nghost-%COMP%]   .pbi-fluent-button[_ngcontent-%COMP%]{padding:6px 16px}[_nghost-%COMP%]   .pbi-fluent-button[disabled][_ngcontent-%COMP%]{cursor:not-allowed}']}),r}(He.w),rt=a(92630),Lt=a(34103),Ut=a(12846),Bt=a(96899),Ae=function(o){return o[o.DaxTemplate=0]="DaxTemplate",o[o.NlToDax=1]="NlToDax",o}({}),at=function(o){function r(t,i,s){var l=o.call(this,{loading:!0,pivots:void 0,selectedPivot:void 0,nlToDaxMode:void 0})||this;return l.daxTemplateTelemetry=t,l.quickMeasurePreserver=i,l.lazyScoped=s,l.viewModel$=l.state$,l.updateSelectedPivot=l.updater(function(v,w){return _.find(v.pivots,function(ue){return ue.type===w}).type===Ae.NlToDax&&1===v.nlToDaxMode?(D.fF.assertFail("nlToDax pivot is disabled"),(0,c.__assign)({},v)):(0,c.__assign)((0,c.__assign)({},v),{selectedPivot:w})}),l.updateNlToDaxMode=l.updater(function(v,w){return(0,c.__assign)((0,c.__assign)({},v),{nlToDaxMode:w})}),l}return(0,c.__extends)(r,o),r.prototype.initializeState=function(t){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(i){switch(i.label){case 0:return this.parentEvent=t,[4,this.setNlToDaxModeObservable()];case 1:return i.sent(),this.setState({pivots:[{name:"Calculations",type:Ae.DaxTemplate},{name:"NlToDax_Copilot_Suggestions",type:Ae.NlToDax}],selectedPivot:Ae.DaxTemplate,loading:!1,nlToDaxMode:0}),[2]}})})},r.prototype.saveDaxTemplateMeasure=function(t,i,s,l){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(v){switch(v.label){case 0:return D.fF.assertValue(t,"new daxTemplate measure result"),t?(this.daxTemplateTelemetry.resolveTemplateSelectedEvent(!0),[4,this.quickMeasurePreserver.saveNewMeasure({originType:"DaxTemplate",result:t,originalExpression:i,schemaName:s,visualContainerContext:l},this.parentEvent)]):[2];case 1:return v.sent(),[2]}})})},r.prototype.setNlToDaxModeObservable=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var i,s;return(0,c.__generator)(this,function(l){switch(l.label){case 0:return[4,this.lazyScoped.get("nlToDaxSupportability")];case 1:return[4,l.sent().isNlToDaxSupported()];case 2:return i=l.sent(),s=i.pipe((0,le.U)(function(v){if(!v)return 1;if(!v.isAllowed){var w=v.disallowedReason;return D.fF.assertValue(w,"nlToDaxSupportability error code missing"),"userSignedOut"===w||"qnaNotEnabled"===w?2:1}return 0})),this.updateNlToDaxMode(s),[2]}})})},r.\u0275fac=function(i){return new(i||r)(e.\u0275\u0275inject(Bt.W),e.\u0275\u0275inject(Ie),e.\u0275\u0275inject(N.H))},r.\u0275prov=e.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(W.m1),At=a(22844),zt=a(21023),Qt=a(24548),ot=["*"],Wt=function(){function o(){}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["pbi-pivot"]],ngContentSelectors:ot,decls:2,vars:0,consts:[["role","tablist",1,"pbi-pivot","themeableElement"]],template:function(t,i){1&t&&(e.\u0275\u0275projectionDef(),e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275projection(1),e.\u0275\u0275elementEnd())},styles:['[_nghost-%COMP%]{display:flex}[_nghost-%COMP%]   .pbi-pivot[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]     pbi-pivot-item button{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--md-font-size, 14px);font-weight:var(--font-weight-regular, 400)}[_nghost-%COMP%]     .pbi-pivot-item-selected button{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--md-font-size, 14px);font-weight:var(--font-weight-semi-bold, 600)}[_nghost-%COMP%]     .pbi-pivot-item-selected button .inner-button:after{bottom:-12px}.pbi-pivot-small[_nghost-%COMP%]     pbi-pivot-item button{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--md-font-size, 14px);font-weight:var(--font-weight-regular, 400)}.pbi-pivot-small[_nghost-%COMP%]     .pbi-pivot-item-selected button{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--md-font-size, 14px);font-weight:var(--font-weight-semi-bold, 600)}.pbi-pivot-small[_nghost-%COMP%]     .pbi-pivot-item-selected button .inner-button:after{bottom:-12px}.pbi-pivot-large[_nghost-%COMP%]     pbi-pivot-item button{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--lg-font-size, 16px);font-weight:var(--font-weight-regular, 400)}.pbi-pivot-large[_nghost-%COMP%]     .pbi-pivot-item-selected button{font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:var(--lg-font-size, 16px);font-weight:var(--font-weight-semi-bold, 600)}.pbi-pivot-large[_nghost-%COMP%]     .pbi-pivot-item-selected button .inner-button:after{bottom:-11px}']}),o}(),kt=function(){function o(){this.disabled=!1,this.select=new e.EventEmitter}return o.prototype.onPivotClick=function(){this.disabled||this.select.emit()},o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["pbi-pivot-item"]],hostVars:2,hostBindings:function(t,i){2&t&&e.\u0275\u0275classProp("pbi-pivot-item-selected",i.selected)},inputs:{selected:"selected",disabled:"disabled"},outputs:{select:"select"},ngContentSelectors:ot,decls:3,vars:4,consts:[["role","tab","data-testid","pivot-item-list-btn",1,"pbi-focus-outline-inset",3,"click"],[1,"inner-button"]],template:function(t,i){1&t&&(e.\u0275\u0275projectionDef(),e.\u0275\u0275elementStart(0,"button",0),e.\u0275\u0275listener("click",function(){return i.onPivotClick()}),e.\u0275\u0275elementStart(1,"div",1),e.\u0275\u0275projection(2),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275classProp("disabled",i.disabled),e.\u0275\u0275attribute("aria-disabled",i.disabled)("aria-selected",i.selected))},styles:['[_nghost-%COMP%]{--colorFieldDisabled: var(--gray-90);--colorBackgroundDisabled: var(--gray-20);--colorBackgroundHover: auto;--colorBackgroundSelected: var(--fluent-theme-primary-color);--colorForeground: auto;display:inline-flex}[data-legacy-theming=false]   [_nghost-%COMP%]{--colorFieldDisabled: var(--colorNeutralBackgroundDisabled);--colorBackgroundDisabled: auto;--colorBackgroundHover: var(--colorNeutralSubtleBackgroundHover);--colorBackgroundSelected: var(--colorNeutralForeground3BrandSelected);--colorForeground: var(--colorNeutralForeground1)}button[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative;border:none;height:44px;padding:11px 8px;color:var(--colorForeground)}button[_ngcontent-%COMP%]:not(:hover){background:none}button[_ngcontent-%COMP%]:hover{background-color:var(--colorBackgroundHover)}button[_ngcontent-%COMP%]:hover   .inner-button[_ngcontent-%COMP%]{position:initial}button[_ngcontent-%COMP%]:hover   .inner-button[_ngcontent-%COMP%]:after{bottom:0;left:0;right:0}button[_ngcontent-%COMP%]:focus   .inner-button[_ngcontent-%COMP%]{position:initial}button[_ngcontent-%COMP%]:focus   .inner-button[_ngcontent-%COMP%]:after{bottom:0;left:0;right:0}button.disabled[_ngcontent-%COMP%]{forced-color-adjust:none;color:var(--colorFieldDisabled, #A19F9D);background-color:var(--colorBackgroundDisabled, #F3F2F1)}button[_ngcontent-%COMP%]   .inner-button[_ngcontent-%COMP%]{display:flex;align-items:center;margin:0 10px;position:relative}.pbi-pivot-item-selected[_nghost-%COMP%]   .inner-button[_ngcontent-%COMP%]:after{content:"";position:absolute;display:block;left:0;right:0;height:4px;background:var(--colorBackgroundSelected, #F2C811)}@media (forced-colors: active){.pbi-pivot-item-selected[_nghost-%COMP%]   .inner-button[_ngcontent-%COMP%]:after{background-color:var(--globalColorhcHighlight)!important}}']}),o}(),jt=a(36858),$t=a(39161);function Kt(o,r){1&o&&e.\u0275\u0275element(0,"tri-svg-icon",18)}var Ht=function(){return{"aria-label":"NlToDax_NotSupported"}};function Gt(o,r){1&o&&e.\u0275\u0275element(0,"i",19),2&o&&e.\u0275\u0275property("localizeAttr",e.\u0275\u0275pureFunction0(1,Ht))}function Xt(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"pbi-pivot-item",14),e.\u0275\u0275listener("select",function(){var G=e.\u0275\u0275restoreView(t).$implicit,ue=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(ue.onPivotSelected(G.type))}),e.\u0275\u0275elementStart(1,"div",15),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275template(3,Kt,1,0,"tri-svg-icon",16),e.\u0275\u0275elementStart(4,"span"),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"localize"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Gt,1,2,"i",17),e.\u0275\u0275elementEnd()()}if(2&o){var i=r.$implicit,s=e.\u0275\u0275nextContext(3).ngIf,l=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("selected",s.selectedPivot===i.type)("disabled",l.isNlToDaxPivotDisabled(i.type,s.nlToDaxMode)),e.\u0275\u0275advance(1),e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(2,7,"NlToDax_NotSupported"))("pbiTooltipDisabled",!l.isNlToDaxPivotDisabled(i.type,s.nlToDaxMode)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.type===l.QuickMeasuresPivotType.NlToDax),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,9,i.name)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",l.isNlToDaxPivotDisabled(i.type,s.nlToDaxMode))}}function Jt(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",20),e.\u0275\u0275element(1,"quick-measures-template-lazy",21),e.\u0275\u0275elementStart(2,"section",22)(3,"button",23),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var l=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(l.onDaxTemplateCommit())}),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd()()()}if(2&o){var i=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("showFieldList",!1),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(4,2,i.disableCommit$))}}function Zt(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"nl-to-dax",24),e.\u0275\u0275listener("onSwitchToCalculation",function(){e.\u0275\u0275restoreView(t);var v=e.\u0275\u0275nextContext(5);return e.\u0275\u0275resetView(v.onPivotSelected(v.QuickMeasuresPivotType.DaxTemplate))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&o){var i=e.\u0275\u0275nextContext(3).ngIf,s=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("mode",i.nlToDaxMode)("parentEvent",s.openPaneEvent)}}function Yt(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"pbi-pivot",8),e.\u0275\u0275template(2,Xt,8,11,"pbi-pivot-item",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",10),e.\u0275\u0275elementContainerStart(4,11),e.\u0275\u0275template(5,Jt,5,4,"section",12),e.\u0275\u0275template(6,Zt,2,2,"ng-container",13),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&o){var t=e.\u0275\u0275nextContext(2).ngIf,i=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.pivots),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngSwitch",t.selectedPivot),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",i.QuickMeasuresPivotType.DaxTemplate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",i.QuickMeasuresPivotType.NlToDax)}}function qt(o,r){1&o&&e.\u0275\u0275element(0,"pbi-spinner")}function en(o,r){if(1&o&&(e.\u0275\u0275elementStart(0,"div",4)(1,"section"),e.\u0275\u0275element(2,"p",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Yt,7,4,"ng-container",6),e.\u0275\u0275template(4,qt,1,0,"ng-template",null,7,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&o){var t=e.\u0275\u0275reference(5),i=e.\u0275\u0275nextContext().ngIf,s=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275property("hidden",!s.isPaneExpanded),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!i.loading)("ngIfElse",t)}}function tn(o,r){if(1&o){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"pbi-pane",2),e.\u0275\u0275listener("onToggle",function(){e.\u0275\u0275restoreView(t);var v=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(v.onPaneToggled())})("onCollapse",function(){e.\u0275\u0275restoreView(t);var v=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(v.onPaneCollapsed())}),e.\u0275\u0275elementStart(1,"pbi-pane-section"),e.\u0275\u0275template(2,en,6,3,"div",3),e.\u0275\u0275elementEnd()()}if(2&o){var i=e.\u0275\u0275nextContext().ngIf,s=e.\u0275\u0275nextContext();e.\u0275\u0275property("expanded",i.isPaneExpanded)("title",i.title)("allowToggle",!s.isPaneSwitcherSupported)("optionsSetting",i.optionsSetting)("showCollapse",s.isPaneSwitcherSupported),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.isPaneVisible)}}function nn(o,r){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,tn,3,6,"pbi-pane",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&o){var t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,1,t.viewModel$))}}var st=function(){function o(r,t,i,s,l){this.daxTemplateStore=r,this.lazyScoped=t,this.panesVisibilityService=i,this.quickMeasuresPaneStore=s,this.quickMeasureTelemetry=l,this.viewModel$=this.quickMeasuresPaneStore.viewModel$,this.QuickMeasuresPivotType=Ae,this.disableCommit$=this.daxTemplateStore.validation$.pipe((0,le.U)(function(v){var G=v.allParametersSet;return!_.isEmpty(v.result.errors)||!G})),this.paneViewModel$=this.panesVisibilityService.getPanes$().pipe((0,le.U)(function(v){return v.quickMeasures}))}return o.prototype.ngOnInit=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var r;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.lazyScoped.get("quickMeasures")];case 1:return r=t.sent(),D.fF.assertValue(r,"quickMeasuresService"),this.quickMeasureInputs=r.inputArgs,D.fF.assertValue(this.quickMeasureInputs.daxTemplate,"quickMeasuresService daxTemplateArgs"),D.fF.assertValue(this.quickMeasureInputs.nlToDax,"quickMeasuresService nlToDaxArgs"),this.openPaneEvent=this.quickMeasureTelemetry.logOpenPaneEvent(this.quickMeasureInputs.entryPoint),[4,this.quickMeasuresPaneStore.initializeState(this.openPaneEvent)];case 2:return t.sent(),[4,this.daxTemplateStore.initialize(this.quickMeasureInputs.daxTemplate)];case 3:return t.sent(),[2]}})})},Object.defineProperty(o.prototype,"isPaneSwitcherSupported",{get:function(){return this.panesVisibilityService.isPaneSwitcherSupported()},enumerable:!1,configurable:!0}),o.prototype.onDaxTemplateCommit=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var r,l;return(0,c.__generator)(this,function(v){switch(v.label){case 0:return[4,this.daxTemplateStore.getNewMeasureResult()];case 1:return r=v.sent(),[4,this.quickMeasuresPaneStore.saveDaxTemplateMeasure(r,(l=this.quickMeasureInputs).originalExpr,l.daxTemplate.schemaName,l.visualContainerContext)];case 2:return v.sent(),[2]}})})},o.prototype.onPivotSelected=function(r){this.quickMeasureTelemetry.logPivotSelectedEvent(this.openPaneEvent,r===Ae.DaxTemplate?"DaxTemplate":"NlToDax"),this.quickMeasuresPaneStore.updateSelectedPivot(r)},o.prototype.onPaneToggled=function(){this.panesVisibilityService.togglePaneExpansion("quickMeasures")},o.prototype.onPaneCollapsed=function(){this.panesVisibilityService.setPaneExpansion("quickMeasures",!1)},o.prototype.isNlToDaxPivotDisabled=function(r,t){return r===Ae.NlToDax&&1===t},o.prototype.ngOnDestroy=function(){this.daxTemplateStore.destroy()},o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(rt.Xy),e.\u0275\u0275directiveInject(N.H),e.\u0275\u0275directiveInject(F.r),e.\u0275\u0275directiveInject(at),e.\u0275\u0275directiveInject(pe))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["quick-measures-pane"]],features:[e.\u0275\u0275ProvidersFeature([rt.Xy,Lt.TH,m.e,Ut.p,S.y,Ke,Ie,at])],decls:2,vars:3,consts:[[4,"ngIf"],[3,"expanded","title","allowToggle","optionsSetting","showCollapse","onToggle","onCollapse",4,"ngIf"],[3,"expanded","title","allowToggle","optionsSetting","showCollapse","onToggle","onCollapse"],["class","pane-contents",3,"hidden",4,"ngIf"],[1,"pane-contents",3,"hidden"],["localize","QuickMeasuresPane_Description"],[4,"ngIf","ngIfElse"],["loadingTemplate",""],[1,"pbi-pivot-small"],[3,"selected","disabled","select",4,"ngFor","ngForOf"],[1,"pivot-contents"],[3,"ngSwitch"],["class","dax-template-container",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"selected","disabled","select"],["pbiTooltipPosition","below",1,"pivot-tab",3,"pbiTooltip","pbiTooltipDisabled"],["class","pivot-icon","name","sparkles_28_filled","sprite","copilot-icons",4,"ngIf"],["tabindex","0","aria-disabled","true","class","glyphicon pbi-glyph-info glyph-small",3,"localizeAttr",4,"ngIf"],["name","sparkles_28_filled","sprite","copilot-icons",1,"pivot-icon"],["tabindex","0","aria-disabled","true",1,"glyphicon","pbi-glyph-info","glyph-small",3,"localizeAttr"],[1,"dax-template-container"],[3,"showFieldList"],[1,"dax-template-footer"],["type","button","localize","ItemAction_Add",1,"pbi-fluent-button","primary",3,"disabled","click"],[3,"mode","parentEvent","onSwitchToCalculation"]],template:function(t,i){1&t&&(e.\u0275\u0275template(0,nn,3,3,"ng-container",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,i.paneViewModel$))},dependencies:[n.NgForOf,n.NgIf,n.NgSwitch,n.NgSwitchCase,u.X,At.b,zt.VO,Qt.i,Wt,kt,O.k,jt.V,he.M,$t.w,it,n.AsyncPipe,Qe.F],styles:['[_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;flex:1 0 0}[_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]   .pivot-tab[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]   .pivot-tab[_ngcontent-%COMP%]   .glyphicon[_ngcontent-%COMP%]{color:var(--gray-180, #252423);align-self:flex-end}html:not([dir="rtl"])   [_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]   .pivot-tab[_ngcontent-%COMP%]   .glyphicon[_ngcontent-%COMP%]{margin-left:4px}html[dir="rtl"]   [_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]   .pivot-tab[_ngcontent-%COMP%]   .glyphicon[_ngcontent-%COMP%]{margin-right:4px}[_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]   .pivot-tab[_ngcontent-%COMP%]   .pivot-icon[_ngcontent-%COMP%]{width:20px;height:20px}html:not([dir="rtl"])   [_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]   .pivot-tab[_ngcontent-%COMP%]   .pivot-icon[_ngcontent-%COMP%]{margin-right:8px}html[dir="rtl"]   [_nghost-%COMP%]   .pane-contents[_ngcontent-%COMP%]   .pivot-tab[_ngcontent-%COMP%]   .pivot-icon[_ngcontent-%COMP%]{margin-left:8px}[_nghost-%COMP%]   .pivot-contents[_ngcontent-%COMP%]{height:100%;padding:12px 4px 0}[_nghost-%COMP%]   .pivot-contents[_ngcontent-%COMP%]   .dax-template-container[_ngcontent-%COMP%]{height:100%;display:grid;grid-template-rows:1fr auto;grid-template-areas:"form" "footer"}[_nghost-%COMP%]   .pivot-contents[_ngcontent-%COMP%]   quick-measures-template-lazy[_ngcontent-%COMP%]{grid-area:form}[_nghost-%COMP%]   .pivot-contents[_ngcontent-%COMP%]   .dax-template-footer[_ngcontent-%COMP%]{height:52px;grid-area:footer;display:flex;flex-direction:row;align-items:center;justify-content:flex-end}[_nghost-%COMP%]   .pivot-contents[_ngcontent-%COMP%]   .pbi-fluent-button[_ngcontent-%COMP%]{padding:6px 16px}[_nghost-%COMP%]     quick-measures-template mat-select{background-color:var(--fluent-theme-white-color, #FFF)}[_nghost-%COMP%]     quick-measures-template .label label{font-size:var(--md-font-size, 14px)!important}[_nghost-%COMP%]     quick-measures-template .slicer-dropdown-menu{background-color:var(--fluent-theme-white-color, #FFF)}[_nghost-%COMP%]     pbi-pane-section{height:100%}']}),o}(),rn=a(5944),an=a(48145),on=a(12123),lt=a(91592),sn=a(22318),ln=a(81905),cn={provide:"nlToDaxSupportability",useFactory:function(o,r,t,i,s,l){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(v){return[2,new dn(o,r,t,i,s,l)]})})},deps:[rn.B,T.i,x.D,an.U,k.E,on.n]},dn=function(){function o(r,t,i,s,l,v){this.accountService=r,this.conceptualSchemaProxy=t,this.dataSources=i,this.explorationCapabilities=s,this.lazyProvider=l,this.qnaProxyPath=v}return o.prototype.isNlToDaxSupported=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var r,t=this;return(0,c.__generator)(this,function(i){switch(i.label){case 0:return[4,this.lazyProvider.get(this.qnaProxyPath||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaSupportabilityService")];case 1:return r=i.sent(),D.fF.assertValue(r,"qnaSupportability"),r?[2,(0,me.D)(r?.qnaSettingsChanged$).pipe((0,sn.O)(!0),(0,ln.w)(function(){return t.getNlToDaxAllowedInfo(r)}))]:[2,(0,ve.of)(void 0)]}})})},o.prototype.tryEnableNlToDax=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var r,t,i,s,l;return(0,c.__generator)(this,function(v){switch(v.label){case 0:return[4,this.accountService.isSignedInAsync()];case 1:return(r=v.sent())?[3,3]:[4,this.accountService.trySignInAsync("SignInForNLToDax")];case 2:r=v.sent(),v.label=3;case 3:return r?[4,this.lazyProvider.get(this.qnaProxyPath||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaSupportabilityService")]:[3,7];case 4:return t=v.sent(),D.fF.assertValue(t,"qnaSupportability"),t?(i=this.explorationCapabilities.getCapabilities(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())]):[2];case 5:return s=v.sent(),!(l=(0,lt.H)(i,s,t)).isAllowed&&"qnaNotEnabled"===l.disallowedReason&&t.canAnyUserEnableQna()?[4,t.enableQna()]:[3,7];case 6:v.sent(),v.label=7;case 7:return[2]}})})},o.prototype.getNlToDaxAllowedInfo=function(r){return(0,c.__awaiter)(this,void 0,void 0,function(){var t,i,s;return(0,c.__generator)(this,function(v){switch(v.label){case 0:return t=this.explorationCapabilities.getCapabilities(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 1:return i=v.sent(),(s=(0,lt.H)(t,i,r)).isAllowed?[4,this.accountService.isSignedInAsync()]:(D.fF.assertValue(s.disallowedReason,"qna disallowedReason not defined"),[2,{isAllowed:!1,disallowedReason:s.disallowedReason}]);case 2:return v.sent()?r.modelSupportsNlToDax()?"Enabled"!==r.getNlToDaxStatus()?[2,{isAllowed:!1,disallowedReason:"dataGeoLocked"}]:[2,{isAllowed:!0}]:[2,{isAllowed:!1,disallowedReason:"notSupported"}]:[2,{isAllowed:!1,disallowedReason:"userSignedOut"}]}})})},o.\u0275fac=function(t){e.\u0275\u0275invalidFactory()},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),fn={provide:"quickMeasures",useFactory:function(o,r,t){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(i){return[2,new mn(o,r,t)]})})},deps:[Fe.vZ,N.H,F.r]},mn=function(){function o(r,t,i){this.featureSwitchService=r,this.lazyScoped=t,this.panesVisibilityService=i,this._inputArgs={nlToDax:void 0,daxTemplate:void 0,entryPoint:void 0,originalExpr:void 0,visualContainerContext:void 0}}return Object.defineProperty(o.prototype,"inputArgs",{get:function(){return this._inputArgs},enumerable:!1,configurable:!0}),o.prototype.launchQuickMeasures=function(r,t,i,s){return(0,c.__awaiter)(this,void 0,void 0,function(){var l,v,w=this;return(0,c.__generator)(this,function(G){switch(G.label){case 0:return[4,this.lazyScoped.get("quickCalcModern")];case 1:return[4,(l=G.sent()).buildDaxTemplateArgs(r,t,s)];case 2:return v=G.sent(),this._inputArgs.daxTemplate=v,this._inputArgs.originalExpr=r,this._inputArgs.visualContainerContext=s,this._inputArgs.nlToDax={targetEntityName:i},this._inputArgs.entryPoint=t,this.featureSwitchService.featureSwitches$.pipe((0,d.q)(1)).subscribe(function(ue){return(0,c.__awaiter)(w,void 0,void 0,function(){return(0,c.__generator)(this,function(fe){return ue.NlToDax?[2,this.launchQuickMeasuresPane(t)]:[2,l.launchDaxTemplateDialog(r,this.inputArgs.daxTemplate,s)]})})}),[2]}})})},o.prototype.launchQuickMeasuresPane=function(r){this.panesVisibilityService.isPaneVisible("quickMeasures")&&"Ribbon"!==r||this.panesVisibilityService.togglePaneVisibility("quickMeasures")},o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(Fe.vZ),e.\u0275\u0275inject(N.H),e.\u0275\u0275inject(F.r))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o}(),vn=a(20914),gn=a(52910),hn=a(31109),_n=a(22346),xn=a(76521),yn=a(82156),Cn=a(79061),Sn=a(68101),Mn=a(1931),bn=a(93855),En=a(90938),Tn=a(93367),Pn=a(13254),In=function(){function o(){}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({imports:[n.CommonModule]}),o}(),Dn=a(16748),On=a(16095),Nn=a(17177),wn=a(89200),Fn=[{type:st,componentId:"QuickMeasuresPaneComponentId"}],Rn=function(){function o(){}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({providers:[fn,cn,pe],imports:[n.CommonModule,$,gn.O,hn.F,_n.J,xn.A3,yn.N.withManifests(Fn),Cn.v,Sn.B,vn._,Tn.U,Pn.x,In,Dn.H,On.Z,Mn.T,bn.m,P.e3,Nn.T6,En.g,wn.W]}),o}()}}]);