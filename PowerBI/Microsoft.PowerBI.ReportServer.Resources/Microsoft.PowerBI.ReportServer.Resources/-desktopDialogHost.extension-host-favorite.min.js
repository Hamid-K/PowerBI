"use strict";(self.webpackChunkdesktopDialogHost=self.webpackChunkdesktopDialogHost||[]).push([["extension-host-favorite"],{51218:function(ft,V,e){e.r(V),e.d(V,{ExtensionHostFavoriteModule:function(){return tt}});var G=e(77476),m=e(60756),c=e(85732),f=e(11547),y=e(82762),D=e(11105),A=e(81905),$=e(42195),S=e(59822),l=e(14172),N=e(77526),W=e(6663),L=e(17653),z=e(48787),a=e(73471),X=e(60397),h=e(17899),j=e(43419),F=e(15114),T=(0,c.PH)("[Extension Host Item FavoriteState Change] Subscribe Item Favorite Change",(0,c.Ky)()),M=(0,c.PH)("[Extension Host Item FavoriteState Change] Unsubscribe Item Favorite Change",(0,c.Ky)()),U=e(81337),Z=e(25082),Q=e(8894),R="extensionHostItemFavoriteChange",C=(0,Q.H)({selectId:function(s){return s.subscriptionId}}),Y={itemFavoriteChangeSubscriptions:C.getInitialState()},J=(0,c.ZF)(R),k=(0,c.P1)(J,function(t){return C.getSelectors().selectAll(t.itemFavoriteChangeSubscriptions)}),w=(0,c.P1)(Z.rT,F.L1,function(t,s){var o;return t?null===(o=Object.keys(t))||void 0===o?void 0:o.map(function(v){return(0,U.__assign)((0,U.__assign)({},t[v]||{}),s[v]||{})}):[]}),I=e(50423),g=function(t){return t.unChanged="UnChanged",t.removedFromFavorites="RemovedFromFavorites",t.addedToFavorites="AddedToFavorites",t}({}),q=function(){function t(s,o,v,u){var r=this;this.actions$=s,this.messageBroker=o,this.store=v,this.httpservice=u,this.onFavoriteItemReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.favoriteItem,function(i){return r.getItemFavoriteId(i.itemObjectId).pipe((0,A.w)(function(n){return r.isFavoriteId(n)?(0,f.of)(a.Vm.favoriteItem.resolve({})):(0,y.D)(r.httpservice.addFavoriteByObjectId(F.nW.Artifact,i.itemObjectId,void 0)).pipe((0,$.zg)(function(d){return r.store.dispatch(j.nm({objectId:i.itemObjectId,favoriteId:d.id})),(0,f.of)(a.Vm.favoriteItem.resolve({}))}),(0,S.K)(function(d){return r.store.dispatch(j.V2({objectId:i.itemObjectId})),(0,f.of)(a.Vm.favoriteItem.reject({error:d}))}))}))}),this.onUnFavoriteItemReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.unFavoriteItem,function(i){return r.getItemFavoriteId(i.itemObjectId).pipe((0,A.w)(function(n){return r.isFavoriteId(n)?(0,y.D)(r.httpservice.deleteFavorite({favoriteType:F.nW.Artifact,id:n},void 0)).pipe((0,$.zg)(function(){return r.store.dispatch(j.rg({objectId:i.itemObjectId})),(0,f.of)(a.Vm.unFavoriteItem.resolve({}))}),(0,S.K)(function(d){return r.store.dispatch(j.MC({objectId:i.itemObjectId,favoriteId:n,error:d})),(0,f.of)(a.Vm.unFavoriteItem.reject({error:d}))})):(0,f.of)(a.Vm.unFavoriteItem.resolve({}))}))}),this.onGetFavoriteStateReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.getItemFavoriteState,function(i){return r.getItemFavoriteId(i.itemObjectId).pipe((0,l.U)(function(n){var d=r.isFavoriteId(n);return a.Vm.getItemFavoriteState.resolve({favorited:d})}),(0,S.K)(function(n){return(0,f.of)(a.Vm.getItemFavoriteState.reject({error:n}))}))}),this.pushItemChange$=(0,m.GW)(function(){return r.store.select(w).pipe((0,N.x)(),(0,W.G)(),(0,m.IC)(function(){return r.store.select(k)}),(0,l.U)(function(i){for(var n=i[0],d=n[0],b=n[1],P=[],it=function(st,at,vt){var H=[];d&&b&&b.forEach(function(p){if(p.objectId===vt){var x=d.find(function(ct){return ct.objectId===p.objectId});if(void 0!==x&&r.isFavoriteStateChanged(x.favoriteId,p.favoriteId)!==g.unChanged){var dt=r.isFavoriteStateChanged(x.favoriteId,p.favoriteId)===g.addedToFavorites;H.push({itemObjectId:p.objectId,favorited:dt})}}}),H.length>0&&P.push(a.Vm.onItemFavoriteStateChange({subscriptionId:st,changes:H})(at))},E=0,K=i[1];E<K.length;E++){var O=K[E];it(O.subscriptionId,O.iframeId,O.itemObjectId)}return P}),(0,L.b)(function(i){i.forEach(function(n){r.messageBroker.send(n)})}))},{dispatch:!1}),this.onSubscribeItemFavoriteChangeReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.subscribeItemFavoriteStateChange,function(i){var n=i.iframeId,d=i.itemObjectId,b=(0,D.Z)();return r.store.dispatch(T({subscriptionId:b,iframeId:n,itemObjectId:d})),a.Vm.subscribeItemFavoriteStateChange.resolve({subscriptionId:b})}),this.onUnsubscribeItemChangeReceived$=(0,m.GW)(function(){return r.actions$.pipe((0,h.pR)(a.Vm.unSubscribeItemFavoriteStateChange),(0,l.U)(function(i){return M({subscriptionId:i.subscriptionId})}))})}return t.prototype.getItemFavoriteId=function(s){return this.store.select(F.L1).pipe((0,z.q)(1),(0,l.U)(function(o){var v,u=null===(v=o[s])||void 0===v?void 0:v.favoriteId;return void 0===u?-1:u}))},t.prototype.isFavoriteStateChanged=function(s,o){return!this.isFavoriteId(s)&&this.isFavoriteId(o)?g.addedToFavorites:this.isFavoriteId(s)&&!this.isFavoriteId(o)?g.removedFromFavorites:g.unChanged},t.prototype.isFavoriteId=function(s){return void 0!==s&&-1!==s},t.\u0275fac=function(o){return new(o||t)(I.\u0275\u0275inject(m.eX),I.\u0275\u0275inject(X.u),I.\u0275\u0275inject(c.yh),I.\u0275\u0275inject(F.HP))},t.\u0275prov=I.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),B=e(36012);function _(t,s){return(0,c.Lq)(Y,(0,B.P)(T,function(o,v){o.itemFavoriteChangeSubscriptions=C.upsertOne({subscriptionId:v.subscriptionId,iframeId:v.iframeId,itemObjectId:v.itemObjectId},o.itemFavoriteChangeSubscriptions)}),(0,B.P)(M,function(o,v){o.itemFavoriteChangeSubscriptions=C.removeOne(v.subscriptionId,o.itemFavoriteChangeSubscriptions)}))(t,s)}var tt=function(){function t(){}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=I.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=I.\u0275\u0275defineInjector({imports:[G.CommonModule,c.Aw.forFeature(R,_),m.sQ.forFeature([q])]}),t}()}}]);