"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["personalize-visual"],{54807:function(oe,O,l){l.r(O),l.d(O,{PersonalizeVisualModule:function(){return It}});var N=l(91280),h=l(81337),L=l(83839),y=l(41114),b="PBI.PersonalizeVisual.TypePaneInteraction",G=y.cx[b]=(0,y.b1)(b),M="PBI.PersonalizeVisual.FieldPaneInteraction",S=y.cx[M]=(0,y.b1)(M),k="PBI.PersonalizeVisual.FieldContextMenuInteraction",P=y.cx[k]=(0,y.b1)(k),Q="PBI.PersonalizeVisual.ResetVisual",o=(y.cx[Q]=(0,y.b1)(Q),"PBI.PersonalizeVisual.DiscardChanges"),v=y.cx[o]=(0,y.b1)(o),x="PBI.PersonalizeVisual.DragAndDropProperty",w=y.cx[x]=(0,y.b1)(x),V="PBI.PersonalizeVisual.BookmarkTutorial",B=y.cx[V]=(0,y.b1)(V),z="PBI.EX.PersonalizeVisual.LoadFieldList",j=y.cx[z]=(0,y.b1)(z),e=l(50423),X=l(59694),T=l(4633),A=l(86286),U=l(37196),J=l(82762),W=l(11547),H=l(14172),Pe=l(73805),Ve=l(59822),Y=l(65181),le=l(83008),ze=l(39503),Te=l(9380),Se=l(19789),E=l(77476),ie=l(59968),Ee=l(65005),se=l(68070),q=l(85102);function Ie(r,i){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",8),e.\u0275\u0275element(2,"span",9),e.\u0275\u0275elementStart(3,"p",10),e.\u0275\u0275element(4,"span",11),e.\u0275\u0275elementStart(5,"span",12),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"span",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&r){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.perspectiveDisplayName)}}function De(r,i){if(1&r&&(e.\u0275\u0275element(0,"span",14),e.\u0275\u0275elementStart(1,"p",10),e.\u0275\u0275element(2,"span",11),e.\u0275\u0275elementStart(3,"span",12),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()),2&r){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(t.perspectiveDisplayName)}}function Fe(r,i){if(1&r&&(e.\u0275\u0275elementStart(0,"div",6),e.\u0275\u0275template(1,Ie,8,1,"ng-container",2),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,De,5,1,"ng-template",null,7,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&r){var t=e.\u0275\u0275reference(4),n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,2,n.hasCubeNameError$))("ngIfElse",t)}}function Le(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"pbi-field-list",4),e.\u0275\u0275listener("onNodeClick",function(s){e.\u0275\u0275restoreView(t);var p=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(p.onClickFieldListTreeNode(s))}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Fe,5,4,"div",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&r){var n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("fieldListTree",e.\u0275\u0275pipeBind1(2,4,n.fieldListTree$))("options",n.fieldListOptions)("scrollSelectedItemIntoViewOnInit",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.perspectiveDisplayName&&n.perspectiveDisplayName!==n.defaultPerspective)}}function Me(r,i){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",8),e.\u0275\u0275element(2,"span",9),e.\u0275\u0275elementStart(3,"p",10),e.\u0275\u0275element(4,"span",11),e.\u0275\u0275elementStart(5,"span",12),e.\u0275\u0275text(6),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(7,"span",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&r){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(t.perspectiveDisplayName)}}function ke(r,i){if(1&r&&(e.\u0275\u0275element(0,"span",14),e.\u0275\u0275elementStart(1,"p",10),e.\u0275\u0275element(2,"span",11),e.\u0275\u0275elementStart(3,"span",12),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()),2&r){var t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(t.perspectiveDisplayName)}}function we(r,i){if(1&r&&(e.\u0275\u0275elementStart(0,"div",6),e.\u0275\u0275template(1,Me,8,1,"ng-container",2),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,ke,5,1,"ng-template",null,18,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&r){var t=e.\u0275\u0275reference(4),n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,2,n.hasCubeNameError$))("ngIfElse",t)}}function Re(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"pbi-tree",19,20),e.\u0275\u0275listener("onNodeClick",function(c){e.\u0275\u0275restoreView(t);var d=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(d.onClickFieldListTreeNode(c))})("onFirstRender",function(){e.\u0275\u0275restoreView(t);var c=e.\u0275\u0275reference(1);return e.\u0275\u0275resetView(c.scrollToFirstSelectedNode())}),e.\u0275\u0275elementEnd()}if(2&r){var n=i.ngIf;e.\u0275\u0275nextContext();var a=e.\u0275\u0275reference(2),s=e.\u0275\u0275nextContext();e.\u0275\u0275property("tree",n)("options",s.fieldListOptions)("search",a.value)}}function Oe(r,i){if(1&r&&(e.\u0275\u0275elementStart(0,"pbi-search-box")(1,"input",15,16),e.\u0275\u0275listener("keyup",function(){return null}),e.\u0275\u0275pipe(3,"localize"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,we,5,4,"div",5),e.\u0275\u0275template(5,Re,2,3,"pbi-tree",17),e.\u0275\u0275pipe(6,"async")),2&r){var t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(3,3,"SearchBox_Text")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.perspectiveDisplayName&&t.perspectiveDisplayName!==t.defaultPerspective),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,5,t.fieldListTree$))}}var pe=function(){function r(i){this.localizationService=i,this.tooltipCaretSize="small"}return r.prototype.getTooltip=function(i){var t=i.flatNode;if(t.node.data.entity){var n=t.node.data.entity.contract.displayName;return(0,X.W)(this.localizationService.get("Field_Tooltip"),n,t.node.displayName)}return t.node.displayName},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275inject(Y.o))},r.\u0275prov=e.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(),ce=function(){function r(i,t,n,a,s,p,c){var d=this;this.dataSourcesService=i,this.explorationNavigationService=t,this.featureSwitchService=n,this.fieldListData=a,this.fieldListService=s,this.telemetryService=p,this.tooltipStrategy=c,this.onSelectProperty=new e.EventEmitter,this.fieldListTree$=(0,J.D)(this.fieldListService.getViewModel(this.getDataSources())).pipe((0,H.U)(function(m){return m.schema.entities.sort(function(f,g){return f.displayName.localeCompare(g.displayName)}),d.convertFieldListToPbiTree(m)})),this.CubeNameErrorCode="CubeNameDoesNotExist",this.hasCubeNameError$=this.fieldListTree$.pipe((0,Pe.h)(!1),(0,Ve.K)(function(m){return(0,W.of)(m.serviceError.errorCode===d.CubeNameErrorCode)})),this.perspectiveDisplayName=this.getPerspectiveRef(),this.defaultPerspective="",this.fieldListOptions={tooltip:this.tooltipStrategy}}return r.prototype.onClickFieldListTreeNode=function(i){i.expandable||this.onSelectProperty.emit(i.node.data)},r.prototype.convertFieldListToPbiTree=function(i){var t,n=this.fieldListData.selectedProperty;if(n){var a=n.hierarchyLevels,s=a&&a.length?a.reduce(function(c,d){return(0,h.__spreadArray)((0,h.__spreadArray)([],c||[],!0),i.schema.findItems(d.expr)||[],!0)},[]):n.expr?i.schema.findItems(n.expr):[],p=new Set(s);t=function(d){return!(d.children&&d.children.length)&&p.has(d)}}return(0,L.hF)(i,{fieldSelectionPredicate:t,showTooltips:!0})},r.prototype.getPerspectiveRef=function(){var i,t,n,a=this.explorationNavigationService.getCurrentExploration(),s=a.sections[a.activeSectionIndex];return null===(n=null===(t=null===(i=s?.evaluatedObjects)||void 0===i?void 0:i.personalizeVisual)||void 0===t?void 0:t.perspectiveRef)||void 0===n?void 0:n.toString()},r.prototype.getDataSources=function(){var i=(0,h.__spreadArray)([],this.dataSourcesService.get(),!0),t=!1,n=this.getPerspectiveRef();if(n&&n!==this.defaultPerspective){var a=i.findIndex(function(c){return"dsr"===c.type}),s=i[a];if(t=!0,s){var p=(0,h.__assign)((0,h.__assign)({},s),{perspectiveId:n});i[a]=p}}return this.telemetryService.logEvent(j,{hasPerspective:t}),i},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(le.D),e.\u0275\u0275directiveInject(ze.z),e.\u0275\u0275directiveInject(Te.vZ),e.\u0275\u0275directiveInject(A.M),e.\u0275\u0275directiveInject(Se.x),e.\u0275\u0275directiveInject(T.y0),e.\u0275\u0275directiveInject(pe))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["personalize-visual-field-list"]],viewQuery:function(t,n){var a;(1&t&&e.\u0275\u0275viewQuery(U.u,5),2&t)&&(e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.fieldListTree=a.first))},outputs:{onSelectProperty:"onSelectProperty"},features:[e.\u0275\u0275ProvidersFeature([pe])],decls:6,vars:3,consts:[[1,"pbi-depth-2","themeableElement"],[1,"fluentTheme-vlg-semibold"],[4,"ngIf","ngIfElse"],["originalFieldList",""],[3,"fieldListTree","options","scrollSelectedItemIntoViewOnInit","onNodeClick"],["class","pbi-field-list-perspective-header",4,"ngIf"],[1,"pbi-field-list-perspective-header"],["noCubeNameError",""],[1,"perspective-error"],["role","presentation",1,"glyphicon","glyph-small","pbi-glyph-error"],[1,"fluentTheme-sm-reg"],["localize","PersonalizeVisual_PerspectiveDescription"],[1,"fluentTheme-sm-semiBold"],["localize","PersonalizeVisual_PerspectiveDescription_Extensions_CubeNameError"],["role","presentation",1,"glyphicon","glyph-small","pbi-glyph-info"],["pbiSearchInput","",1,"pbi-focus-outline",3,"placeholder","keyup"],["searchInput",""],[3,"tree","options","search","onNodeClick","onFirstRender",4,"ngIf"],["noCubeNameErrorOriginalFieldList",""],[3,"tree","options","search","onNodeClick","onFirstRender"],["pbiTree",""]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"section",0)(1,"header",1),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Le,4,6,"ng-container",2),e.\u0275\u0275template(4,Oe,7,7,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&t){var a=e.\u0275\u0275reference(5);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",n.fieldListData.bucket.displayName," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.featureSwitchService.featureSwitches.personalizeVisualUnifiedFieldList)("ngIfElse",a)}},dependencies:[E.NgIf,ie.X,Ee.l,se.a,se.p,U.u,E.AsyncPipe,q.F],styles:[".pbi-overlay-caret-large.pbi-overlay-caret[_nghost-%COMP%]:after{background:var(--gray-20, #F3F2F1)}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:383px;width:260px;padding:12px 24px 17px;border-radius:2px;background:var(--fluent-theme-neutral-lighter-color, #F3F2F1);box-sizing:border-box}header[_ngcontent-%COMP%]{color:var(--fluent-theme-neutral-dark-alt-color, #333333);margin-bottom:16px}.pbi-field-list-perspective-header[_ngcontent-%COMP%]{display:flex;margin:12px 0 3px}.pbi-field-list-perspective-header[_ngcontent-%COMP%]   .pbi-glyph-error[_ngcontent-%COMP%]{color:var(--fluent-theme-error-dark-color, #A80000)}.pbi-field-list-perspective-header[_ngcontent-%COMP%]   .glyphicon[_ngcontent-%COMP%]{margin:3px 8px 0 0}.pbi-field-list-perspective-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--gray-160, #323130)}.pbi-field-list-perspective-header[_ngcontent-%COMP%]   .perspective-error[_ngcontent-%COMP%]{background-color:var(--fluent-theme-error-background-color, #FDE7E9);display:flex;padding:8px}pbi-tree[_ngcontent-%COMP%]{margin-top:9px;height:100%;display:block;overflow:hidden}"],changeDetection:0}),r}(),ne=l(93437),ue=l(48144),de=l(21728),ve=l(19008),Ne=l(80366),Be=l(76001),I=l(25512),ee=l(86940),je=l(33554),Ae=l(35510),te=l(48787),Z=l(83317),$e=l(26898),Ue=l(72262),He=l(23983),me=l(76072),Ke=l(28894),he=l(66890),re=l(36858),Ge=l(96883),Qe=l(80357);function We(r,i){if(1&r&&e.\u0275\u0275element(0,"i"),2&r){var t=e.\u0275\u0275nextContext();e.\u0275\u0275classMapInterpolate1("field-glyph glyphicon glyph-mini ng-scope ",t.icon,"")}}function Ze(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",5),e.\u0275\u0275listener("pbiMenuButtonClick",function(s){e.\u0275\u0275restoreView(t);var p=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(p.onMenuItemClicked.emit(s))})("pbiMenuOpen",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(s.onMenuOpen())}),e.\u0275\u0275pipe(1,"localize"),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275elementEnd()}if(2&r){var n=e.\u0275\u0275nextContext();e.\u0275\u0275attributeInterpolate3("aria-labelledby","",n.contextMenuLabel," ",n.bucketLabel," ",n.propertyLabel,""),e.\u0275\u0275property("pbiMenu",n.pbiMenuViewModel)("title",e.\u0275\u0275pipeBind1(2,8,"FieldListProperty_Context_Menu")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(1,6,"FieldListProperty_Context_Menu"))}}var fe=new Set([128,1]),ge=new Set([4,2]),Xe=new Set((0,h.__spreadArray)((0,h.__spreadArray)([],Array.from(fe)||[],!0),Array.from(ge)||[],!0)),Je=function(){function r(i){var t=this;this.telemetryService=i,this.onOpenFieldMenu=new e.EventEmitter,this.onMenuItemClicked=new e.EventEmitter,this.pbiMenuViewModel=function(){return t.getContextMenuModel(t.menuViewModel)}}return r.prototype.getContextMenuModel=function(i){var t=i.items.filter(function(p){return!!p.key&&Xe.has(p.key.action)}),n=t.filter(function(p){return fe.has(p.key.action)}),a=t.filter(function(p){return ge.has(p.key.action)}),s=(0,h.__spreadArray)((0,h.__spreadArray)([],n||[],!0),a.length?[{type:1}].concat(a):[],!0);return(0,Ge.m)({items:s})},r.prototype.onMenuOpen=function(){this.telemetryService.logChildEvent(this.rootTelemetryEvent,ne.l,{overlayType:"FieldContextMenu"})},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(T.y0))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["personalize-visual-visual-data-role"]],inputs:{rootTelemetryEvent:"rootTelemetryEvent",displayName:"displayName",bucketLabel:"bucketLabel",propertyLabel:"propertyLabel",fieldMenuLabel:"fieldMenuLabel",contextMenuLabel:"contextMenuLabel",tooltip:"tooltip",icon:"icon",showContextMenu:"showContextMenu",interactive:"interactive",menuViewModel:"menuViewModel"},outputs:{onOpenFieldMenu:"onOpenFieldMenu",onMenuItemClicked:"onMenuItemClicked"},decls:6,vars:13,consts:[[1,"fluentTheme-md-reg","field"],["pbiTooltipCaretSize","small","aria-haspopup","listbox",1,"field-menu","pbi-focus-outline",3,"id","pbiTooltip","pbiTooltipDisabled","pbiTooltipShowDelay","click"],["propertyButton",""],[3,"class",4,"ngIf"],["class","glyphicon glyph-small pbi-glyph-more field-context-menu pbi-focus-outline","aria-haspopup","listbox",3,"pbiMenu","title","pbiMenuButtonClick","pbiMenuOpen",4,"ngIf"],["aria-haspopup","listbox",1,"glyphicon","glyph-small","pbi-glyph-more","field-context-menu","pbi-focus-outline",3,"pbiMenu","title","pbiMenuButtonClick","pbiMenuOpen"]],template:function(t,n){if(1&t){var a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",0)(1,"button",1,2),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(a);var p=e.\u0275\u0275reference(2);return e.\u0275\u0275resetView(n.onOpenFieldMenu.emit(p))}),e.\u0275\u0275template(3,We,1,3,"i",3),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Ze,3,10,"button",4),e.\u0275\u0275elementEnd()}2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275classProp("field-menu-noninteractive",!n.interactive),e.\u0275\u0275attributeInterpolate3("aria-labelledby","",n.fieldMenuLabel," ",n.bucketLabel," ",n.propertyLabel,""),e.\u0275\u0275property("id",n.propertyLabel)("pbiTooltip",n.tooltip)("pbiTooltipDisabled",!n.showContextMenu)("pbiTooltipShowDelay",1500),e.\u0275\u0275attribute("aria-disabled",!n.interactive),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.icon),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.displayName,""),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.showContextMenu))},dependencies:[E.NgIf,Qe.l8,re.V,q.F],styles:['personalize-visual-visual-data-role .field{position:relative}personalize-visual-visual-data-role .field .field-menu{background:var(--fluent-theme-white-color, #FFF);border:1px solid var(--gray-110, #8A8886);box-sizing:border-box;border-radius:2px;height:24px;color:var(--fluent-theme-neutral-dark-color, #201F1E);line-height:14px;width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;margin-top:4px;padding:2px 44px 2px 6px;position:relative;text-align:left;cursor:pointer}personalize-visual-visual-data-role .field .field-menu:after{font-family:PowrMDL2;content:"\\e972";position:absolute;top:5px;right:5px;height:12px;transform:rotate(-90deg);width:12px;font-size:var(--sm-font-size, 12px)}html[dir=rtl] personalize-visual-visual-data-role .field .field-menu{padding-left:44px;padding-right:6px;text-align:right}html[dir=rtl] personalize-visual-visual-data-role .field .field-menu:after{transform:rotate(90deg);left:5px;right:initial}personalize-visual-visual-data-role .field .field-menu-noninteractive{cursor:default}personalize-visual-visual-data-role .field .field-menu-noninteractive:after{display:none}personalize-visual-visual-data-role .field .field-context-menu{position:absolute;height:20px;width:20px;right:21px;top:6px;padding:0;border:0;background-color:var(--fluent-theme-white-color, #FFF)}html[dir=rtl] personalize-visual-visual-data-role .field .field-context-menu{left:21px;right:initial}personalize-visual-visual-data-role .field .drop-target{border-top:2px solid var(--fluent-theme-neutral-primary-color, #323130)}\n'],encapsulation:2,changeDetection:0}),r}();function Ye(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",12,13),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275nextContext().$implicit,p=e.\u0275\u0275reference(9),c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.enableEditMode(s,p))}),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275elementEnd()}if(2&r){var n=e.\u0275\u0275nextContext().index;e.\u0275\u0275attributeInterpolate1("aria-labelledby","inline-explore-bucket-label-",n," inline-explore-add-new-field"),e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(2,2,"InlineExplore_AddNewField"))}}function qe(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"personalize-visual-visual-data-role",19),e.\u0275\u0275listener("onOpenFieldMenu",function(m){var f=e.\u0275\u0275restoreView(t),g=f.$implicit,C=f.index,D=e.\u0275\u0275nextContext(2).$implicit,F=e.\u0275\u0275nextContext(2).$implicit,K=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(K.openChangeFieldMenu(F,m,D,g,C))})("onMenuItemClicked",function(m){e.\u0275\u0275restoreView(t);var f=e.\u0275\u0275nextContext(2).$implicit,g=e.\u0275\u0275nextContext(2).$implicit,C=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(C.handlePbiMenuClick(m,g,f))}),e.\u0275\u0275elementEnd()}if(2&r){var n=i.$implicit,a=i.index,s=e.\u0275\u0275nextContext(2).$implicit,p=e.\u0275\u0275nextContext(2).index,c=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate1("bucketLabel","inline-explore-bucket-label-",p,""),e.\u0275\u0275propertyInterpolate3("propertyLabel","inline-explore-bucket-property-",p,"-",s.startIndex,"-",a,""),e.\u0275\u0275property("rootTelemetryEvent",c.rootTelemetryEvent)("menuViewModel",s.interactivityOptions.dropDownItems)("displayName",c.formatHierarchyLevel(s.displayOptions.displayName,n.displayName))("tooltip",s.displayOptions.tooltipTitle)("icon",s.displayOptions.glyph)("interactive",s.interactivityOptions.isRemovableField)("showContextMenu",s.interactivityOptions.dropDownItems)}}function et(r,i){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,qe,1,11,"personalize-visual-visual-data-role",18),e.\u0275\u0275elementContainerEnd()),2&r){var t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.hierarchyLevels)}}function tt(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"personalize-visual-visual-data-role",19),e.\u0275\u0275listener("onOpenFieldMenu",function(c){e.\u0275\u0275restoreView(t);var d=e.\u0275\u0275nextContext().$implicit,m=e.\u0275\u0275nextContext(2).$implicit,f=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(f.openChangeFieldMenu(m,c,d))})("onMenuItemClicked",function(c){e.\u0275\u0275restoreView(t);var d=e.\u0275\u0275nextContext().$implicit,m=e.\u0275\u0275nextContext(2).$implicit,f=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(f.handlePbiMenuClick(c,m,d))}),e.\u0275\u0275elementEnd()}if(2&r){var n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(2).index,s=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate1("bucketLabel","inline-explore-bucket-label-",a,""),e.\u0275\u0275propertyInterpolate2("propertyLabel","inline-explore-bucket-property-",a,"-",n.startIndex,""),e.\u0275\u0275property("rootTelemetryEvent",s.rootTelemetryEvent)("menuViewModel",n.interactivityOptions.dropDownItems)("displayName",n.displayOptions.displayName)("tooltip",n.displayOptions.tooltipTitle)("icon",n.displayOptions.glyph)("interactive",n.interactivityOptions.isRemovableField)("showContextMenu",n.interactivityOptions.dropDownItems)}}function it(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",15),e.\u0275\u0275listener("drop",function(p){var d=e.\u0275\u0275restoreView(t).index,m=e.\u0275\u0275nextContext(2).index,f=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(f.handleDrop(p,d,m))})("dragend",function(p){e.\u0275\u0275restoreView(t);var c=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(c.handleDragEnd(p))})("dragleave",function(p){e.\u0275\u0275restoreView(t);var c=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(c.handleDragLeave(p))})("dragstart",function(){var c=e.\u0275\u0275restoreView(t).index,d=e.\u0275\u0275nextContext(2).index,m=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(m.handleDragStart(c,d))})("dragover",function(p){var d=e.\u0275\u0275restoreView(t).index,m=e.\u0275\u0275nextContext(2).index,f=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(f.handleDragOver(p,d,m))}),e.\u0275\u0275template(2,et,2,1,"ng-container",16),e.\u0275\u0275template(3,tt,1,10,"ng-template",null,17,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&r){var n=i.$implicit,a=e.\u0275\u0275reference(4);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null==n||null==n.hierarchyLevels?null:n.hierarchyLevels.length)("ngIfElse",a)}}function nt(r,i){if(1&r&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,it,5,2,"ng-container",14),e.\u0275\u0275elementContainerEnd()),2&r){var t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.properties)}}function rt(r,i){if(1&r){var t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",20,21),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);var s=e.\u0275\u0275reference(1),p=e.\u0275\u0275nextContext().$implicit,c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.openNewFieldMenu(p,s))})("drop",function(s){e.\u0275\u0275restoreView(t);var p=e.\u0275\u0275nextContext().index,c=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(c.handleDrop(s,0,p))})("dragleave",function(s){e.\u0275\u0275restoreView(t);var p=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(p.handleDragLeave(s))})("dragover",function(s){e.\u0275\u0275restoreView(t);var p=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(p.handleDragOver(s,-1,-1))}),e.\u0275\u0275elementEnd()}if(2&r){var n=e.\u0275\u0275nextContext().index;e.\u0275\u0275attributeInterpolate1("aria-labelledby","inline-explore-bucket-label-",n," inline-explore-add-new-field")}}function at(r,i){if(1&r&&(e.\u0275\u0275elementStart(0,"li",5)(1,"fieldset")(2,"div",6)(3,"legend",7),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Ye,3,4,"button",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(6,nt,2,1,"ng-container",3),e.\u0275\u0275template(7,rt,2,1,"button",9),e.\u0275\u0275element(8,"button",10,11),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()),2&r){var t=i.$implicit,n=i.index,a=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate1("id","inline-explore-bucket-label-",n,""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.displayName," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.supportsMultipleItems&&(null==t.properties?null:t.properties.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t.properties?null:t.properties.length),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null!=t.properties&&t.properties.length)),e.\u0275\u0275advance(1),e.\u0275\u0275attributeInterpolate1("aria-labelledby","inline-explore-bucket-label-",n," inline-explore-add-new-field"),e.\u0275\u0275property("hidden",e.\u0275\u0275pipeBind1(10,7,a.editableBucket$)!==t)}}function ot(r,i){if(1&r&&(e.\u0275\u0275elementStart(0,"ul"),e.\u0275\u0275template(1,at,11,9,"li",4),e.\u0275\u0275elementEnd()),2&r){var t=i.ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t)}}var lt=function(){function r(i,t,n,a,s,p,c,d,m,f,g,C,D,F){this.elementRef=i,this.conceptualSchemaProxy=t,this.dataSources=n,this.groupingDesignStateService=a,this.injector=s,this.lazyProvider=p,this.lazyScoped=c,this.localizationService=d,this.overlay=m,this.overlayRef=f,this.renderer=g,this.selection=C,this.telemetryService=D,this.visualAuthoring=F,this.onLoad=new e.EventEmitter,this.buckets$=new je.t(1),this.editableBucket$=new Ae.X(null),this.includeVariationSourceDisplayName=this.localizationService.get("IncludeVariationSourceDisplayName"),this.dropTargetClass="drop-target"}return r.prototype.ngOnInit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var i,t,n=this;return(0,h.__generator)(this,function(a){switch(a.label){case 0:return i=this,[4,this.lazyScoped.get("fieldWellModernService")];case 1:return i.fieldWellModernService=a.sent(),t=function(p){return n.buckets$.next(p.buckets)},this.core=this.fieldWellModernService.createFieldWellCore($(this.elementRef.nativeElement),!0,t),[4,this.core.onInit()];case 2:return a.sent(),this.onLoad.emit(),[2]}})})},r.prototype.enableEditMode=function(i,t){this.editableBucket$.next(i),this.openNewFieldMenu(i,t)},r.prototype.openChangeFieldMenu=function(i,t,n,a,s){n.interactivityOptions.isRemovableField&&this.openFieldListOverlay({bucket:i,selectedProperty:a||n},t,n,a,s)},r.prototype.openNewFieldMenu=function(i,t){this.openFieldListOverlay({bucket:i},t)},r.prototype.formatHierarchyLevel=function(i,t){return(0,X.W)(this.includeVariationSourceDisplayName,i,t)},r.prototype.openFieldListOverlay=function(i,t,n,a,s){return(0,h.__awaiter)(this,void 0,void 0,function(){var p,c,d,m,f=this;return(0,h.__generator)(this,function(g){switch(g.label){case 0:return p=this.telemetryService.startChildEvent(this.rootTelemetryEvent,ne.l,{overlayType:"FieldSelection"}),c=this.overlay.position().flexibleConnectedTo(t).withPositions([(0,I.v3)(4,0),(0,I.xe)(0,-4),(0,I.Zc)(0,4),(0,I.q6)(-4,0)]).withFlexibleDimensions(!0).withPush(!0).withGrowAfterOpen(!0),[4,this.lazyProvider.getModule("./lazy-modules/personalize-visual/personalize-visual.module#PersonalizeVisualModule")];case 1:return d=g.sent().componentFactoryResolver,(m=this.overlay.open({component:ce,data:i,options:{positionStrategy:c,hasBackdrop:!0,backdropClass:ee.L},closeOnBackdropClick:!0,hasCaret:!0,parent:this.overlayRef,closeWithParent:!0,injector:this.injector,componentFactoryResolver:d})).onClose.pipe((0,te.q)(1)).subscribe(function(){f.editableBucket$.next(null),p.resolve()}),m.componentRef.instance.onSelectProperty.pipe((0,Z.R)(m.onClose)).subscribe(function(C){return f.onSelectProperty(C,i.bucket.role,m,n,a,s)}),[2]}})})},r.prototype.onSelectProperty=function(i,t,n,a,s,p){return(0,h.__awaiter)(this,void 0,void 0,function(){var c,d,m,f,g,C,D,K;return(0,h.__generator)(this,function(R){switch(R.label){case 0:return(c=de.UP.getSelectedVisual(this.selection))?(d=this.dataSources.get(),f=!0,(m=!!a)?[4,this.conceptualSchemaProxy.get(d)]:[3,3]):[2];case 1:return g=R.sent(),[4,this.visualAuthoring.removeFieldFromRole({role:t,projOptions:{fieldIndex:a.startIndex+(p||0)},count:s?1:a.hierarchyLevels&&a.hierarchyLevels.length||1},g)];case 2:f=R.sent(),R.label=3;case 3:return C=(0,ue.y)((0,ue.R)(i.fieldType),this.groupingDesignStateService),D=C.fieldExpr(i),[4,this.visualAuthoring.addFieldInRole(D,t,d,c,a&&a.startIndex+(p||0),void 0,!0)];case 4:return K=R.sent(),this.telemetryService.logChildEvent(this.rootTelemetryEvent,S,{interactionType:m?"Replace":"Add",success:f&&K}),n.close(),[2]}})})},r.prototype.handlePbiMenuClick=function(i,t,n){var a=de.UP.getSelectedVisual(this.selection);this.handleContextMenuClick(i.data,t,n,this.dataSources,this.conceptualSchemaProxy,a)},r.prototype.handleContextMenuClick=function(i,t,n,a,s,p){return(0,h.__awaiter)(this,void 0,void 0,function(){var c,d,f;return(0,h.__generator)(this,function(g){switch(g.label){case 0:switch(c=p.config.singleVisual.visualType,d=a.get(),i.action){case 1:return[3,1];case 2:return[3,3];case 4:return[3,5];case 128:return[3,7]}return[3,9];case 1:return[4,s.get(d)];case 2:return f=g.sent(),this.removeField(t.role,n.startIndex,f,c),[3,10];case 3:return[4,this.removeAggregate(t.role,n.startIndex,p,d,c)];case 4:case 6:case 8:return g.sent(),[3,10];case 5:return[4,this.setAggregate(t.role,n.startIndex,(0,Ne._L)((0,Be.Q)(n.expr)),i.aggregate,p,d,c)];case 7:return[4,this.setVariation(t.role,n.startIndex,i.variationExpr,p,d,c)];case 9:return[3,10];case 10:return[2]}})})},r.prototype.removeField=function(i,t,n,a){return(0,h.__awaiter)(this,void 0,void 0,function(){var s;return(0,h.__generator)(this,function(p){switch(p.label){case 0:return[4,this.visualAuthoring.removeFieldFromRole({role:i,projOptions:{fieldIndex:t}},n)];case 1:return s=p.sent(),this.telemetryService.logChildEvent(this.rootTelemetryEvent,P,{interactionType:"RemoveField",visualType:a,role:i,success:s}),[2]}})})},r.prototype.removeAggregate=function(i,t,n,a,s){return(0,h.__awaiter)(this,void 0,void 0,function(){var p;return(0,h.__generator)(this,function(c){switch(c.label){case 0:return[4,this.visualAuthoring.removeAggregate(i,t,n,a)];case 1:return p=c.sent(),this.telemetryService.logChildEvent(this.rootTelemetryEvent,P,{interactionType:"RemoveAggregate",visualType:s,role:i,success:p}),[2]}})})},r.prototype.setAggregate=function(i,t,n,a,s,p,c){return(0,h.__awaiter)(this,void 0,void 0,function(){var d;return(0,h.__generator)(this,function(m){switch(m.label){case 0:return[4,this.visualAuthoring.setAggregate(i,t,a,s,p)];case 1:return d=m.sent(),this.telemetryService.logChildEvent(this.rootTelemetryEvent,P,{interactionType:"SetAggregate",visualType:c,role:i,oldValue:(0,ve.b)(n),newValue:(0,ve.b)(a),success:d}),[2]}})})},r.prototype.setVariation=function(i,t,n,a,s,p){return(0,h.__awaiter)(this,void 0,void 0,function(){var c;return(0,h.__generator)(this,function(d){switch(d.label){case 0:return[4,this.visualAuthoring.setVariation(s,a,n,i,t)];case 1:return c=d.sent(),this.telemetryService.logChildEvent(this.rootTelemetryEvent,P,{interactionType:"SetVariation",visualType:p,role:i,success:c}),[2]}})})},r.prototype.handleDrop=function(i,t,n){return(0,h.__awaiter)(this,void 0,void 0,function(){var a,s,c;return(0,h.__generator)(this,function(d){switch(d.label){case 0:return this.dragDropPayload?(a=this.core.viewModel.buckets,s=this.dataSources.get(),n!==this.dragDropPayload.sourceBucketIndex||t!==this.dragDropPayload.sourcePropertyIndex?((n===this.dragDropPayload.sourceBucketIndex?t>this.dragDropPayload.sourcePropertyIndex:n>this.dragDropPayload.sourceBucketIndex)&&(t=0===t?0:t-1),[4,this.visualAuthoring.moveField(a[this.dragDropPayload.sourceBucketIndex].role,a[n].role,this.dragDropPayload.sourcePropertyIndex,t,1,s,!1)]):[3,2]):[3,3];case 1:c=d.sent(),this.telemetryService.logChildEvent(this.rootTelemetryEvent,w,{success:c,sourceBucketIndex:this.dragDropPayload.sourceBucketIndex,targetBucketIndex:n,sourcePropertyIndex:this.dragDropPayload.sourcePropertyIndex,targetPropertyIndex:t}),d.label=2;case 2:i.preventDefault(),this.renderer.removeClass(i.target,this.dropTargetClass),d.label=3;case 3:return[2]}})})},r.prototype.handleDragOver=function(i,t,n){this.dragDropPayload&&(this.dragDropPayload.sourcePropertyIndex!==t||n!==this.dragDropPayload.sourceBucketIndex)&&(this.renderer.addClass(i.target,this.dropTargetClass),i.preventDefault())},r.prototype.handleDragStart=function(i,t){this.dragDropPayload={sourcePropertyIndex:i,sourceBucketIndex:t}},r.prototype.handleDragLeave=function(i){this.dragDropPayload&&(this.renderer.removeClass(i.target,this.dropTargetClass),i.preventDefault())},r.prototype.handleDragEnd=function(i){this.dragDropPayload=void 0,this.renderer.removeClass(i.target,this.dropTargetClass)},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject($e.i),e.\u0275\u0275directiveInject(le.D),e.\u0275\u0275directiveInject(He.AA),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(me.E),e.\u0275\u0275directiveInject(Ke.H),e.\u0275\u0275directiveInject(Y.o),e.\u0275\u0275directiveInject(ee._),e.\u0275\u0275directiveInject(A.w),e.\u0275\u0275directiveInject(e.Renderer2),e.\u0275\u0275directiveInject(Ue.z),e.\u0275\u0275directiveInject(T.y0),e.\u0275\u0275directiveInject(he.$8))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["personalize-visual-visual-data-role-list"]],inputs:{rootTelemetryEvent:"rootTelemetryEvent"},outputs:{onLoad:"onLoad"},decls:5,vars:3,consts:[["id","inline-explore-property-label","role","none","localize","InlineExplore_ChangeField",1,"cdk-visually-hidden"],["id","inline-explore-context-menu-label","role","none","localize","PersonalizeVisual_FieldContextMenuLabel",1,"cdk-visually-hidden"],["id","inline-explore-add-new-field","role","none","localize","InlineExplore_AddNewField",1,"cdk-visually-hidden"],[4,"ngIf"],["class","bucket",4,"ngFor","ngForOf"],[1,"bucket"],[1,"header"],[1,"fluentTheme-md-reg",3,"id"],["pbiTooltipCaretSize","small","class","glyphicon pbi-glyph-add add-property pbi-focus-outline",3,"pbiTooltip","click",4,"ngIf"],["class","fluentTheme-md-reg pill add-new-field pbi-focus-outline","aria-haspopup","listbox","localize","InlineExplore_AddNewField",3,"click","drop","dragleave","dragover",4,"ngIf"],["disabled","","aria-haspopup","listbox","localize","InlineExplore_AddNewField",1,"fluentTheme-md-reg","pill","add-new-field",3,"hidden"],["addNewFieldButtonPlaceholder",""],["pbiTooltipCaretSize","small",1,"glyphicon","pbi-glyph-add","add-property","pbi-focus-outline",3,"pbiTooltip","click"],["addNewPropertyButton",""],[4,"ngFor","ngForOf"],["draggable","true",1,"projection",3,"drop","dragend","dragleave","dragstart","dragover"],[4,"ngIf","ngIfElse"],["notHierarchyLevel",""],["fieldMenuLabel","inline-explore-property-label","contextMenuLabel","inline-explore-context-menu-label",3,"bucketLabel","propertyLabel","rootTelemetryEvent","menuViewModel","displayName","tooltip","icon","interactive","showContextMenu","onOpenFieldMenu","onMenuItemClicked",4,"ngFor","ngForOf"],["fieldMenuLabel","inline-explore-property-label","contextMenuLabel","inline-explore-context-menu-label",3,"bucketLabel","propertyLabel","rootTelemetryEvent","menuViewModel","displayName","tooltip","icon","interactive","showContextMenu","onOpenFieldMenu","onMenuItemClicked"],["aria-haspopup","listbox","localize","InlineExplore_AddNewField",1,"fluentTheme-md-reg","pill","add-new-field","pbi-focus-outline",3,"click","drop","dragleave","dragover"],["addNewFieldButton",""]],template:function(t,n){1&t&&(e.\u0275\u0275element(0,"p",0)(1,"p",1)(2,"p",2),e.\u0275\u0275template(3,ot,2,1,"ul",3),e.\u0275\u0275pipe(4,"async")),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,1,n.buckets$)))},dependencies:[E.NgForOf,E.NgIf,ie.X,re.V,Je,E.AsyncPipe,q.F],styles:["ul[_ngcontent-%COMP%]{list-style:none;padding:0}fieldset[_ngcontent-%COMP%]{min-width:100%;padding:0;margin:0;border:0}.bucket[_ngcontent-%COMP%]:not(:last-child){margin-bottom:20px}.bucket[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:var(--fluent-theme-neutral-primary-color, #323130)}.bucket[_ngcontent-%COMP%]   button.pill[_ngcontent-%COMP%]{background:var(--fluent-theme-white-color, #FFF);border:1px solid var(--gray-110, #8A8886);box-sizing:border-box;border-radius:2px;height:24px;color:var(--fluent-theme-neutral-dark-color, #201F1E);line-height:14px;width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding:2px;margin-top:4px}.bucket[_ngcontent-%COMP%]   button.add-new-field[_ngcontent-%COMP%]{text-align:center}.bucket[_ngcontent-%COMP%]   button.drop-target[_ngcontent-%COMP%]{border:2px solid var(--fluent-theme-neutral-primary-color, #323130)}.bucket[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.bucket[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .add-property[_ngcontent-%COMP%]{font-size:12px;background:none;border:none;padding:0;color:var(--gray-190, #201F1E);margin-right:6px}"],changeDetection:0}),r}(),st=l(89961),ye=function(){function r(){}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["ng-component"]],decls:1,vars:2,consts:[["role","listbox",1,"compact-container",3,"disableMoreOptionsIcon","disableContextMenu"]],template:function(t,n){1&t&&e.\u0275\u0275element(0,"visual-types-container-modern",0),2&t&&e.\u0275\u0275property("disableMoreOptionsIcon",!0)("disableContextMenu",!0)},dependencies:[st.r],styles:[".pbi-overlay-caret-large.pbi-overlay-caret[_nghost-%COMP%]:after{background:var(--gray-20, #F3F2F1)}[_nghost-%COMP%]{width:168px;min-height:144px;background:var(--gray-20, #F3F2F1);border-radius:2px;box-shadow:0 0 2px var(--colorNeutralShadowAmbient),0 4px 8px var(--colorNeutralShadowKey);padding:12px}"]}),r}(),xe=l(9398),_e=l(8590),pt=l(20590),be=l(59973),ct=l(17653),ut=l(22318),dt=l(77526),vt=l(18353),Ce=l(81905),mt=l(11494),ht=function(){function r(i){this.localizationService=i,this.BookmarkTutorialModelKey="BookmarkTutorial"}return r.prototype.createBookmarkTutorialModel=function(){var i="#bookmarkButton";return{itemKeys:[this.BookmarkTutorialModelKey],items:{BookmarkTutorial:{title:this.localizationService.get("TutorialPopup_BookmarkTitle"),text:this.localizationService.get("TutorialPopup_BookmarkContent"),buttonLabel:this.localizationService.get("TutorialPopup_GotIt"),customClass:"tutorial-bookmarks-container",dataStoreKey:this.BookmarkTutorialModelKey,canShow:function(){return!!$(i)},attachTo:function(){return $(i)},offset:{top:-15,left:0},telemetryEventArgs:[B],telemetryLogTutorialDismiss:!0,preferredOrientation:"top",learnMoreText:this.localizationService.get("LearnMore"),learnMoreUrl:"https://go.microsoft.com/fwlink/?linkid=2141051"}}}},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275inject(Y.o))},r.\u0275prov=e.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac,providedIn:"root"}),r}(),ft=l(69071),gt=l(29866),yt=l(56083),ae=function(){function r(i,t,n,a,s,p,c,d,m,f,g,C,D,F,K,R){this.personalizeVisualData=i,this.eventBridge=t,this.changeDetectorRef=n,this.lazyProvider=a,this.localizationService=s,this.ngZone=p,this.overlay=c,this.tutorialService=d,this.router=m,this.telemetryService=f,this.trustedVisualService=g,this.injector=C,this.visualPluginService=D,this.tutorialPopupService=F,this.overlayRef=K,this.visualAuthoringService=R,this.isSessionDirty=!1,this.rootTelemetryEvent=this.personalizeVisualData.rootEvent,this.originalVisualConfig=_.cloneDeep(this.personalizeVisualData.visual.config)}return r.prototype.ngOnInit=function(){var i=this,t=this.eventBridge.on(_e.jCS).pipe((0,be.h)(function(n){return n.affectContainer(i.personalizeVisualData.visual)}));this.visualTypes$=t.pipe((0,ct.b)(function(){return i.checkDirtyState()}),(0,H.U)(function(){return i.personalizeVisualData.visual.config.singleVisual.visualType}),(0,ut.O)(this.personalizeVisualData.visual.config.singleVisual.visualType),(0,dt.x)()),this.visualDisplayName$=this.visualTypes$.pipe((0,H.U)(function(n){return i.getVisualDisplayName(n)})),this.visualTypes$.pipe((0,vt.R)(function(n,a){return i.logVisualTypeChange(n,a),a}),(0,Z.R)(this.overlayRef.onClose)).subscribe(),this.router.events.pipe((0,be.h)(function(n){return n instanceof xe.m2}),(0,te.q)(1)).subscribe(function(){return i.overlayRef.close()}),t.pipe((0,Z.R)(this.overlayRef.onClose),(0,Ce.w)(function(){return i.ngZone.onStable})).subscribe(function(){return i.updateOverlayPosition()}),this.overlayRef.onClose.pipe((0,te.q)(1)).subscribe(function(){i.isSessionDirty&&i.tutorialPopupService.startTutorial(i.tutorialService.createBookmarkTutorialModel())})},r.prototype.onClickVisualTypes=function(i){return(0,h.__awaiter)(this,void 0,void 0,function(){var t,n,a,s,p=this;return(0,h.__generator)(this,function(c){switch(c.label){case 0:return t=this.overlay.position().flexibleConnectedTo(i).withPositions([(0,I.v3)(4,0),(0,I.xe)(0,-4),(0,I.Zc)(0,4),(0,I.q6)(-4,0)]).withFlexibleDimensions(!0).withPush(!0).withGrowAfterOpen(!0),n=this.telemetryService.startChildEvent(this.rootTelemetryEvent,ne.l,{overlayType:"VisualTypeSelection"}),[4,this.lazyProvider.getModule("./lazy-modules/personalize-visual/personalize-visual.module#PersonalizeVisualModule")];case 1:return a=c.sent().componentFactoryResolver,(s=this.overlay.open({component:ye,options:{positionStrategy:t,hasBackdrop:!0,backdropClass:ee.L},closeOnBackdropClick:!0,hasCaret:!0,parent:this.overlayRef,closeWithParent:!0,injector:this.injector,componentFactoryResolver:a})).onClose.pipe((0,Z.R)(this.overlayRef.onClose),(0,te.q)(1)).subscribe(function(){return n.resolve()}),this.visualTypes$.pipe((0,Z.R)(s.onClose),(0,Ce.w)(function(){return p.ngZone.onStable})).subscribe(function(){return t.apply()}),[2]}})})},r.prototype.getDiscardChangesTooltipText=function(){return this.localizationService.get(this.isSessionDirty?"PersonalizeVisual_DiscardChanges":"PersonalizeVisual_DiscardChanges_Disabled")},r.prototype.discardChanges=function(){var i=this.personalizeVisualData.visual;i.config=_.cloneDeep(this.originalVisualConfig),this.eventBridge.publishToChannel(_e.jCS,{affectContainer:function(n){return n.name===i.name}}),this.telemetryService.logChildEvent(this.rootTelemetryEvent,v,{})},r.prototype.updateOverlayPosition=function(){this.changeDetectorRef.detectChanges(),this.overlayRef.overlayRef.updatePosition()},r.prototype.logVisualTypeChange=function(i,t){this.telemetryService.logChildEvent(this.rootTelemetryEvent,G,{oldVisualType:i,newVisualType:t})},r.prototype.getVisualDisplayName=function(i){var t=this.visualPluginService.getPlugin(i),n=this.trustedVisualService.isTrustedVisual(i),a=n&&this.trustedVisualService.getVisualTypeOptions(i);return t.custom?t.displayName:n?a&&a.titleKey?this.localizationService.get(a.titleKey):t.displayName||t.name:(0,pt.Gf)(t.titleKey,this.localizationService)},r.prototype.checkDirtyState=function(){var i=this.originalVisualConfig.singleVisual,t=this.personalizeVisualData.visual.config.singleVisual;this.isSessionDirty=i.visualType!==t.visualType||!_.isEqual(i.query,t.query),(this.isSessionDirty||i.presentationChangesApplied)&&this.visualAuthoringService.setPresentationChangesApplied(!0)},r.\u0275fac=function(t){return new(t||r)(e.\u0275\u0275directiveInject(A.M),e.\u0275\u0275directiveInject(mt.J),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(me.E),e.\u0275\u0275directiveInject(Y.o),e.\u0275\u0275directiveInject(e.NgZone),e.\u0275\u0275directiveInject(ee._),e.\u0275\u0275directiveInject(ht),e.\u0275\u0275directiveInject(xe.F0),e.\u0275\u0275directiveInject(T.y0),e.\u0275\u0275directiveInject(ft.t),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(gt.D),e.\u0275\u0275directiveInject(yt.yU),e.\u0275\u0275directiveInject(A.w),e.\u0275\u0275directiveInject(he.$8))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["personalize-visual"]],decls:16,vars:9,consts:[[1,"pbi-depth-2"],[1,"personalize-visual-container"],["localize","PersonalizeVisual_MainMenuLabel",1,"fluentTheme-vlg-semibold"],[1,"header-actions"],["pbiTooltipCaretSize","small",1,"glyphicon","glyph-small","pbi-glyph-eraser","pbi-focus-outline",3,"disabled","pbiTooltip","click"],["pbiTooltipCaretSize","small",1,"glyphicon","glyph-small","pbi-glyph-close","pbi-focus-outline",3,"pbiTooltip","click"],[1,"scrollable-content"],[1,"visual-types-picker"],["id","inline-explore-visual-type-picker-label","localize","PersonalizeVisual_VisualType",1,"fluentTheme-md-reg"],["id","inline-explore-visual-type-picker","aria-haspopup","listbox","aria-labelledby","inline-explore-visual-type-picker-label inline-explore-visual-type-picker",1,"fluentTheme-md-reg","pbi-focus-outline",3,"click"],["visualTypeOrigin",""],[3,"rootTelemetryEvent","onLoad"]],template:function(t,n){if(1&t){var a=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"section",0)(1,"div",1)(2,"header"),e.\u0275\u0275element(3,"div",2),e.\u0275\u0275elementStart(4,"span",3)(5,"button",4),e.\u0275\u0275listener("click",function(){return n.discardChanges()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",5),e.\u0275\u0275listener("click",function(){return n.overlayRef.close()}),e.\u0275\u0275pipe(7,"localize"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",6)(9,"div",7),e.\u0275\u0275element(10,"label",8),e.\u0275\u0275elementStart(11,"button",9,10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(a);var p=e.\u0275\u0275reference(12);return e.\u0275\u0275resetView(n.onClickVisualTypes(p))}),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(15,"personalize-visual-visual-data-role-list",11),e.\u0275\u0275listener("onLoad",function(){return n.updateOverlayPosition()}),e.\u0275\u0275elementEnd()()()()}2&t&&(e.\u0275\u0275advance(5),e.\u0275\u0275property("disabled",!n.isSessionDirty)("pbiTooltip",n.getDiscardChangesTooltipText()),e.\u0275\u0275advance(1),e.\u0275\u0275property("pbiTooltip",e.\u0275\u0275pipeBind1(7,5,"PBI_Button_Label_Close")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(14,7,n.visualDisplayName$)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("rootTelemetryEvent",n.rootTelemetryEvent))},styles:['personalize-visual{height:100%;max-height:100vh;display:block}personalize-visual section{width:240px;height:100%;max-height:100vh;background:var(--fluent-theme-neutral-lighter-color, #F3F2F1);border-radius:2px;box-sizing:border-box;display:flex;flex-direction:column}personalize-visual section .personalize-visual-container{margin:12px 24px 0;height:100%;max-height:100vh;display:flex;flex-direction:column}personalize-visual section .personalize-visual-container .scrollable-content{height:calc(100% - 40px);overflow:auto;padding:0 1px}personalize-visual section .personalize-visual-container .scrollable-content personalize-visual-visual-data-role-list{display:block;margin-bottom:24px}personalize-visual header{display:flex;justify-content:space-between;color:var(--fluent-theme-neutral-dark-alt-color, #333333);height:24px;margin-bottom:16px}personalize-visual header .header-actions{display:flex}personalize-visual header .header-actions button{padding:0;border:0;background:transparent;margin-left:12px;color:var(--gray-190, #201F1E)}personalize-visual header .header-actions button.pbi-glyph-close{font-size:14px}personalize-visual header .header-actions button[disabled]{opacity:.5}personalize-visual .visual-types-picker{margin-bottom:20px}personalize-visual .visual-types-picker label{color:var(--fluent-theme-neutral-primary-color, #323130)}personalize-visual .visual-types-picker button{background:var(--fluent-theme-white-color, #FFF);border:1px solid var(--gray-110, #8A8886);box-sizing:border-box;border-radius:2px;height:24px;padding:2px 18px 2px 6px;color:var(--fluent-theme-neutral-dark-color, #201F1E);line-height:var(--md-font-size, 14px);position:relative;width:100%;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-align:left;margin-top:4px}personalize-visual .visual-types-picker button:after{font-family:PowrMDL2;content:"\\e972";position:absolute;top:5px;right:5px;height:var(--sm-font-size, 12px);transform:rotate(-90deg);width:var(--sm-font-size, 12px);font-size:var(--sm-font-size, 12px)}html[dir=rtl] personalize-visual .visual-types-picker button{padding-left:18px;padding-right:6px;text-align:right}html[dir=rtl] personalize-visual .visual-types-picker button:after{transform:rotate(90deg);left:5px;right:initial}\n'],encapsulation:2,changeDetection:0}),r}(),xt=l(82156),_t=l(79061),bt=l(69310),Ct=l(63654),Pt=l(94841),Vt=l(66972),zt=l(39433),Tt=l(16095),St=l(35284),Et=[{type:ae,componentId:"PersonalizeVisualComponentId"}],It=function(){function r(){}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.\u0275\u0275defineNgModule({type:r}),r.\u0275inj=e.\u0275\u0275defineInjector({imports:[E.CommonModule,xt.N.withManifests(Et),_t.v,Pt.b,Ct.X,Vt.N,zt.t,Tt.Z,St.J,bt.R,N.Q]}),r}();e.\u0275\u0275setComponentScope(ae,[ie.X,re.V,lt],[E.AsyncPipe,q.F])},48144:function(oe,O,l){l.d(O,{R:function(){return G},y:function(){return M}});var N=l(42233),h=l(69843),L=l(94419),y=l(76001),b=l(80366);function G(u){switch(u){case 2:return 1;case 3:return 2;case 0:default:return 0;case 6:return 3}}function M(u,o){switch(u){case 1:return new P;case 2:return new Q;case 3:return new S;default:return new k(o)}}var S=function(){function u(){}return u.prototype.fieldExpr=function(o){var v=(0,L.nw)(o.schema.name,o.contract.name);return(0,L.m_)(v,2)},u}(),k=function(){function u(o){this.groupingDesignStateService=o}return u.prototype.fieldExpr=function(o){if(void 0!==o.kind){if(0===o.kind){if((0,N.RV)(o.entity.name,o.contract,this.groupingDesignStateService)){var v=(0,L.nw)(o.entity.contractSchema.name,o.entity.name),x=(0,N.ZP)(o.contract.column.groupingMetadata,v);return(0,b.og)({groupingColumn:{schema:o.schema.name,entity:o.entity.name,name:o.name,groupedColumns:_.isEmpty(x)?void 0:_.map(x,function(w){return(0,y.Q)(w)})}})}return(0,b.og)({column:{schema:o.schema.name,entity:o.originalEntity?o.originalEntity.name:o.entity.name,name:o.name}})}if(1===o.kind)return(0,b.og)({measure:{schema:o.schema.name,entity:o.entity.name,name:o.name}})}},u}(),P=function(){function u(){}return u.prototype.fieldExpr=function(o){if(o.variation&&o.originalEntity){var v=o.parent;return(0,b.og)({columnHierarchyVariation:{source:{name:v.name,schema:v.entity.contractSchema.name,entity:v.entity.name},hierarchy:{schema:o.entity.contractSchema.name,entity:o.originalEntity.name,name:o.contract.name},variationName:o.variation}})}return(0,b.og)({hierarchy:{name:o.name,schema:o.entity.contractSchema.name,entity:o.originalEntity?o.originalEntity.name:o.entity.name}})},u}(),Q=function(){function u(){}return u.prototype.fieldExpr=function(o){if(o.variation&&o.parent instanceof h.Jg){var v=o.parent,x=v.parent;return(0,b.og)({columnHierarchyLevelVariation:{source:{name:x.name,schema:x.entity.contractSchema.name,entity:x.entity.name},level:{schema:x.entity.contractSchema.name,entity:o.originalEntity.name,name:v.contract.name,level:o.name},variationName:o.variation}})}return(0,b.og)({hierarchyLevel:{schema:o.entity.contractSchema.name,entity:o.entity.name,name:o.parent.name,level:o.name}})},u}()},83839:function(oe,O,l){l.d(O,{hF:function(){return b},iq:function(){return P}});var N=l(69843),h={type:1,sheet:"fieldListPaneIcons",symbolId:"fieldListCheckmark"},L="fieldListPaneIcons_paneColorRefresh",y="fieldListPaneIcons_paneColorRefresh";function b(u,o){return{nodes:u.schema.entities.filter(function(v){return(!v.hidden||v.showHidden||o&&o.fieldHiddenPredicate&&!o.fieldHiddenPredicate(v))&&v.userEntity}).map(function(v){return function(u,o){for(var v={type:1,sheet:L,symbolId:"".concat(u.iconClassName||"fieldListEntity","_paneColorRefresh")},x={data:u,displayName:u.displayName,icon:v,tooltip:o&&o.showTooltips,ariaLabel:u.displayName},w=x.children=[],V=0,B=u.properties;V<B.length;V++){var z=B[V],j=o&&o.fieldHiddenPredicate&&o.fieldHiddenPredicate(z);z.visible&&(!z.hidden||void 0!==j&&!j)&&w.push(M(x,z,o))}return x}(v,o)})}}function M(u,o,v){var x=(0,N.Wx)(o,!0,!0),w="none"!==x?{type:1,sheet:y,symbolId:x}:void 0,V=v&&v.fieldSelectionPredicate&&v.fieldSelectionPredicate(o),B=V,z=v&&v.fieldIdPredicate&&v.fieldIdPredicate(o),j=v&&v.fieldCheckablePredicate&&v.fieldCheckablePredicate(o),e=v&&v.fieldDraggablePredicate&&v.fieldDraggablePredicate(o),X=v&&v.fieldHasMenuPredicate&&v.fieldHasMenuPredicate(o),T={data:o,displayName:o.displayName,draggable:e,id:z,parent:u,checkable:j,checked:B,selected:V,icon:w,tooltip:v&&v.showTooltips,menu:X,ariaLabel:o.displayName};if(V&&S(T,v?.showAncestorsBadge),o.children)for(var A=T.children=[],U=0,J=o.children;U<J.length;U++){var W=J[U],H=v&&v.fieldHiddenPredicate&&v.fieldHiddenPredicate(W);(!W.hidden||void 0!==H&&!H)&&A.push(M(T,W,v))}return T}function S(u,o){u.expanded=!0,u.parent&&(o?(k(u),S(u.parent,!0)):S(u.parent))}function k(u){u.parent.badge=h,null==u.parent.badgedChildren&&(u.parent.badgedChildren=[]),_.find(u.parent.badgedChildren,u)||u.parent.badgedChildren.push(u)}function P(u){u.parent&&(u.checked||u.badge?k(u):(_.remove(u.parent.badgedChildren,function(o){return o.displayName===u.displayName}),u.parent.badge=_.isEmpty(u.parent.badgedChildren)?void 0:h),P(u.parent))}}}]);