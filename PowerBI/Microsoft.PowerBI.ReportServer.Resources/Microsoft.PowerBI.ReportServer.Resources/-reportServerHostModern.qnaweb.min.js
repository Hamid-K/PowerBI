"use strict";(self.webpackChunkreportServerHostModern=self.webpackChunkreportServerHostModern||[]).push([["qnaweb"],{65947:function(j,w,l){l.d(w,{z:function(){return y}});var y=new(l(50423).InjectionToken)("QnaModelUtilsPath")},12123:function(j,w,l){l.d(w,{n:function(){return y}});var y=new(l(50423).InjectionToken)("QnaProxyPath")},70940:function(j,w,l){l.d(w,{s:function(){return N}});var c=l(47508),y=l(45034),b=new y.o(function(){var u={};return u[3]=c.L.card,u[13]=c.L.lineClusteredColumnComboChart,u[29]=c.L.multiRowCard,u[7]=c.L.clusteredBarChart,u[10]=c.L.clusteredColumnChart,u[20]=c.L.donutChart,u[16]=c.L.funnel,u[30]=c.L.gauge,u[22]=c.L.heatMap,u[9]=c.L.hundredPercentStackedBarChart,u[12]=c.L.hundredPercentStackedColumnChart,u[4]=c.L.lineChart,u[1]=c.L.map,u[19]=c.L.filledMap,u[2]=c.L.pivotTable,u[5]=c.L.pieChart,u[6]=c.L.scatterChart,u[8]=c.L.barChart,u[11]=c.L.columnChart,u[0]=c.L.tableEx,u[17]=c.L.treemap,u[23]=c.L.waterfallChart,u[26]=c.L.stackedAreaChart,u[27]=c.L.hundredPercentStackedAreaChart,u[32]=c.L.areaChart,u[33]=c.L.ribbonChart,u[34]=c.L.kpi,u[35]=c.L.decompositionTreeVisual,u});function N(u){return b.getValue()[u]}new y.o(function(){var u={};return u[c.L.card.name]=3,u[c.L.lineClusteredColumnComboChart.name]=13,u[c.L.multiRowCard.name]=29,u[c.L.clusteredBarChart.name]=7,u[c.L.clusteredColumnChart.name]=10,u[c.L.donutChart.name]=20,u[c.L.funnel.name]=16,u[c.L.gauge.name]=30,u[c.L.heatMap.name]=22,u[c.L.hundredPercentStackedBarChart.name]=9,u[c.L.hundredPercentStackedColumnChart.name]=12,u[c.L.lineChart.name]=4,u[c.L.map.name]=1,u[c.L.filledMap.name]=19,u[c.L.matrix.name]=2,u[c.L.pivotTable.name]=2,u[c.L.pieChart.name]=5,u[c.L.scatterChart.name]=6,u[c.L.barChart.name]=8,u[c.L.columnChart.name]=11,u[c.L.table.name]=0,u[c.L.tableEx.name]=0,u[c.L.treemap.name]=17,u[c.L.waterfallChart.name]=23,u[c.L.stackedAreaChart.name]=26,u[c.L.hundredPercentStackedAreaChart.name]=27,u[c.L.areaChart.name]=32,u[c.L.ribbonChart.name]=33,u[c.L.kpi.name]=34,u[c.L.decompositionTreeVisual.name]=35,u})},1931:function(j,w,l){l.d(w,{T:function(){return ie}});var c=l(77476),y=l(52910),b=l(29513),v=l(31109),N=l(22824),m=l(76521),u=l(40516),F=l(84497),V=l(79061),I=l(98665),C=l(94785),U=l(47231),z=l(50423),ie=function(){function B(){}return B.\u0275fac=function(X){return new(X||B)},B.\u0275mod=z.\u0275\u0275defineNgModule({type:B}),B.\u0275inj=z.\u0275\u0275defineInjector({imports:[c.CommonModule,y.O,b.T,v.F,N.J,m.A3,u.h,F.L,V.v,I.e3,C.g,U.c]}),B}()},15671:function(j,w,l){l.r(w),l.d(w,{QnaWebModule:function(){return ht}});var c=l(1931),y=l(50423),b=function(){function n(){}return n.prototype.improveLinguisticSchema=function(t){throw new Error("Method not implemented.")},n.prototype.cancelImproveLinguisticSchema=function(){throw new Error("Method not implemented.")},n.\u0275prov=y.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac=function(r){return new(r||n)}}),n}(),v=l(62458),m=function(){function n(){this.cache=new Map,this.expirationInMilliseconds=6e4}return n.prototype.initialize=function(t){null!=t&&(this.expirationInMilliseconds=t)},n.prototype.getInterpretResponse=function(t){v.fF.assertValue(t,"Expect the given request to be defined");var r=u(t),s=this.getCacheResult(r,this.cache);return s?{response:s.response,requestId:s.requestId}:void 0},n.prototype.setInterpretResponse=function(t,r,s){v.fF.assertValue(t,"Expect the given request to be defined"),v.fF.assertValue(r,"Expect the given response to be defined");var a=u(t);this.cache.set(a,{response:r,requestId:s,expiration:Date.now()+this.expirationInMilliseconds}),this.removeExpiredEntriesAfterTimeout()},n.prototype.clear=function(){this.cache.clear()},n.prototype.removeExpiredEntriesAfterTimeout=function(){var t=this;this.removeExpiredEntriesTimeout||(this.removeExpiredEntriesTimeout=setTimeout(function(){clearTimeout(t.removeExpiredEntriesTimeout);var r=Date.now(),s=!1;for(var a in t.cache)t.cache[a].expiration<r?delete t.cache[a]:s=!0;s&&t.removeExpiredEntriesAfterTimeout()},this.expirationInMilliseconds))},n.prototype.getCacheResult=function(t,r){var s=r.get(t);if(s){if(!(s.expiration<Date.now()))return s;this.cache.delete(t)}},n.\u0275prov=y.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac=function(r){return new(r||n)}}),n}();function u(n){return[n.Utterance,F(n.Options),V(n.Context),n.Version].join("::")}function F(n){var t="";if(!_.isEmpty(n)){var r=[],s=[];for(var a in n){var p=n[a];!0===p?r.push(a):!1===p&&s.push(a)}_.isEmpty(r)||(t+="+"+r.join(",")),_.isEmpty(s)||(t+="-"+s.join(","))}return"Options:"+(_.isEmpty(t)?"-":t)}function V(n){var t="";return _.isEmpty(n)||(t+=_.isEmpty(n.ModelScopes)?"":JSON.stringify(n.ModelScopes),t+=n.ImpersonatedUserPrincipalName,_.isEmpty(n.ImpersonatedRoles)||(t+=JSON.stringify(n.ImpersonatedRoles))),"Context:"+(_.isEmpty(t)?"-":t)}var I=l(35988),C=l(8590),U=l(11547),z=l(14172),re=l(59822),ie=l(70032),B=l(81905),ce=l(73875),X=l(46381),pe=l(11494),fe="/explore/qna/interpret/",ve=function(){function n(t,r,s,a){var p=this;this.httpService=t,this.impersonationService=r,this.eventBridge=s,this.interpretCache=a,this.retryId=0,this.eventBridge.createChannelSubscriptionManager().subscribe(C.uff,function(){p.interpretCache.clear()}).subscribe(C.CCe,function(){p.interpretCache.clear()})}return n.prototype.convertToWireInterpretRequest=function(t){return(0,U.of)(I.fL(t))},n.prototype.getOverwriteResponseModelInfo=function(t){},n.prototype.probe=function(t){v.fF.assertValue(!_.isEmpty(t),"Expect the given modelScopes is not empty");var r=this.httpService.powerbiRequestOptions(void 0,"InterpretProbe");r.timeout=6e4;var s={Utterance:"",Version:"3.3.0",Context:{ModelScopes:t},Options:{SupportPodQueries:!0}};return this.addImpersonationToRequest(s),this.httpService.post(fe,s,r).pipe((0,z.U)(function(a){return a.error?{error:oe(a.error,a.requestId)}:I.Cb(a.data)}),(0,re.K)(function(a){var p=ge(a);return(0,U.of)({error:p})}))},n.prototype.interpret=function(t,r,s){var a=this;v.fF.assertValue(t,"Expect the given wireRequest to be defined");var p=function(n){var t;return!(k(n)||!_.isEmpty(n.Spans)||!_.isEmpty(n.LinguisticSchemaJson)||!_.isEmpty(n.InferredTermBinding)||_.some(null===(t=n.Context)||void 0===t?void 0:t.Tags,function(r){return _.indexOf(["AskToAdd","Committed","Paused"],r)>=0}))}(t)?this.interpretCache.getInterpretResponse(t):void 0;if(p)return this.createResponse(!0,t,p.response,p.requestId);var h=this.httpService.powerbiRequestOptions(void 0,"Interpret");return h.timeout=25e3,this.addImpersonationToRequest(t),this.httpService.post(fe,t,h).pipe((0,ie.g)(this.retryId>0?1e3:0),(0,B.w)(function(g){if(g.error){var R=oe(g.error,g.requestId);return k(t)?(0,U.of)({error:R}):(0,U.of)({utterance:t.Utterance,error:R})}var T=I.oA(g.data);if(r){var x=I.pk(T);if(x&&a.retryId<=8)return a.retryId++,s&&s.reportLoading({warning:x}),a.interpret(t,r,s)}return a.retryId=0,function(n,t){return!(k(n)||!t||_.some(t.Results,function(r){return _.some(r.DiagnosticMessages,function(s){return 0!==s.Severity})}))}(t,T)&&a.interpretCache.setInterpretResponse(t,T,g.requestId),a.createResponse(!1,t,T,g.requestId)}),(0,re.K)(function(g){return(0,U.of)(function(n,t){var r=ge(t);return k(n)?{error:r}:{utterance:n.Utterance,error:r}}(t,g))}))},n.prototype.createResponse=function(t,r,s,a){return k(r)?function(n){return v.fF.assertValue(n,"Expect the given wireResponse to be defined"),(0,U.of)(I.B4(n))}(s):function(n,t,r,s){v.fF.assertValue(t,"Expect the given wireResponse to be defined");var a=I.R1(n.Utterance,n.DesiredSuggestedUtteranceCount,s,t);return a.fromCache=r,(0,U.of)(a)}(r,s,t,a)},n.prototype.addImpersonationToRequest=function(t){if(t&&this.impersonationService&&this.impersonationService.impersonating){v.fF.assertValue(t.Context,"interpretRequest.Context should be defined");var r=this.impersonationService.getImpersonationState();t.Context.ImpersonatedRoles=r.impersonatedRoles,t.Context.ImpersonatedUserPrincipalName=r.impersonatedUserPrincipalName}},n.\u0275fac=function(r){return new(r||n)(y.\u0275\u0275inject(ce.O),y.\u0275\u0275inject(X.h),y.\u0275\u0275inject(pe.J),y.\u0275\u0275inject(m))},n.\u0275prov=y.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}();function k(n){var t;return v.fF.assertValue(n,"Expect the given wireRequest to be defined."),null===(t=n?.Options)||void 0===t?void 0:t.SuggestedUtterances}function ge(n){return oe(n?.error,n?.requestId)}function oe(n,t){var r,s,a,p,h=n?.["pbi.error"];return"NetworkConnectionIssue"===(null!==(r=n?.code)&&void 0!==r?r:h?.code)&&(a="NetworkConnectionIssue",p="User"),null==p&&(p=1===h?.exceptionCulprit?"User":"PowerBI"),null==a&&(a="GenericRequestFailure"),{errorCode:a,source:p,message:n?.message,stackTrace:null===(s=n?.innererror)||void 0===s?void 0:s.trace,requestId:t}}var L=l(81337),Ye=l(35510),Pe=l(83342),me=l(5708),J=l(43286),Y=l(65181),Fe=new y.InjectionToken("QnaInterpretProxyService"),$=l(98665),Ae=l(5894),Ne={en:{resStringSuffix:"_English"},es:{resStringSuffix:"_Spanish",preview:!0}};function Ue(n,t){var r=function(n){var t;if(_.isEmpty(n))return t;for(var r=0,s=n;r<s.length;r++){var a=s[r];if(t&&a.language!==t){t=void 0;break}t=a.language}return t}(t);return function(n,t){var r="";if(n){var s=!1,a=q(t.currentLanguageLocale);n=q(n);var p=Ne[n];p&&(r=p.resStringSuffix,s=p.preview),!s&&n===a&&(r="")}return t.get("Qna_Input_Placeholder"+r)}(r,n)}function q(n){if(n)return n.split("-")[0].toLowerCase()}function Ee(n,t,r,s){return new Oe(n,t,r,s)}var Oe=function(){function n(t,r,s,a){this.featureSwitchService=t,this.localizationService=r,this.telemetryService=s,this.interpretProxy=a,this.answeredQuestionDataLoggerFactory=new ze(this.telemetryService,3e3)}return n.prototype.sendFeedback=function(t,r,s,a){return(0,L.mG)(this,void 0,void 0,function(){var p,h;return(0,L.Jh)(this,function(g){switch(g.label){case 0:return p=this.constructInterpretRequest(r,void 0,s,void 0,{tags:a},void 0,t),[4,this.interpretProxy.convertToWireInterpretRequest(p).toPromise()];case 1:return h=g.sent(),this.interpretProxy.interpret(h,!1),[2]}})})},n.prototype.interpret=function(t,r,s,a,p,h,g,R){var T=this;if(v.fF.assertValue(p,"interpretListener"),_.isEmpty(r))return(0,U.of)(void 0);var x=Date.now(),D=this.answeredQuestionDataLoggerFactory.startLogger(),Q={contentProviderType:"Unknown",entryPoint:s,tags:_.isEmpty(g?.tags)?void 0:g.tags.join(",")};g?.isQuestionNotCommitted||p.onInterpretIssued();var H=this.generateRequestOptions(h),O=this.constructInterpretRequest(r,H,a,t,g,R),le={reportLoading:function(Re){T.notifyInterpretListenerRetry(p,Re.warning)}},de=this.interpretProxy.getOverwriteResponseModelInfo(O);return this.interpretProxy.convertToWireInterpretRequest(O).pipe((0,B.w)(function(ne){return T.interpretProxy.interpret(ne,!0,le).pipe((0,z.U)(function(Re){var je,Je,et=Date.now();be(Re);var P=Re;if(T.checkToOverwriteResponseModelInfo(P,de),T.notifyInterpretListenerResult(p,P,!!g?.isQuestionNotCommitted,O),Q.fromCache=!!P.fromCache,P.error?T.logAnsweredQuestionDataOnError(D,x,et,P?.requestId,null===(Je=null===(je=P?.error)||void 0===je?void 0:je.errorCode)||void 0===Je?void 0:Je.toString(),Q):T.logAnsweredQuestionDataWithInterpretResult(D,x,et,P?.requestId,O.scopes,P,Q),P?.warnings){var gt=(0,I.vr)(P.warnings);_.remove(P.warnings,function(mt){return _.find(gt,function(yt){return yt.warning===mt})}),Q.warnings=P.warnings.join("|")}return P}))}))},n.prototype.sendTags=function(t,r,s,a,p){var h,g;return(0,L.mG)(this,void 0,void 0,function(){var R,T,x,D,Q,H,O,le,de,W;return(0,L.Jh)(this,function(ne){switch(ne.label){case 0:return v.fF.assertNonEmpty(t,"Expect this be called only when tags is not empty"),_.isEmpty(t)?[2]:(R=Date.now(),T=this.answeredQuestionDataLoggerFactory.startLogger(),x={contentProviderType:"Unknown",entryPoint:s,tags:_.isEmpty(t)?void 0:t.join(","),fromCache:!1},D=this.generateRequestOptions(p),Q=this.constructInterpretRequest(r,D,a,void 0,{tags:t}),H=this.interpretProxy.getOverwriteResponseModelInfo(Q),[4,this.interpretProxy.convertToWireInterpretRequest(Q).toPromise()]);case 1:return O=ne.sent(),[4,this.interpretProxy.interpret(O,!1).toPromise()];case 2:return le=ne.sent(),de=Date.now(),be(le),this.checkToOverwriteResponseModelInfo(W=le,H),W.error?this.logAnsweredQuestionDataOnError(T,R,de,W?.requestId,null===(g=null===(h=W?.error)||void 0===h?void 0:h.errorCode)||void 0===g?void 0:g.toString(),x):this.logAnsweredQuestionDataWithInterpretResult(T,R,de,W?.requestId,Q.scopes,W,x),[2]}})})},n.prototype.getSuggestedQuestions=function(t){var r=this,a=this.constructInterpretRequest("",2048,t);return this.interpretProxy.convertToWireInterpretRequest(a).pipe((0,B.w)(function(h){return r.interpretProxy.interpret(h,!0).pipe((0,z.U)(function(g){return function(n){v.fF.assert(function(){return!n.hasOwnProperty("utterance")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "utterance".'),v.fF.assert(function(){return!n.hasOwnProperty("requestId")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "requestId".'),v.fF.assert(function(){return!n.hasOwnProperty("fromCache")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "fromCache".');var t=n;t.result&&v.fF.assert(function(){return t.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(g),g}))}))},n.prototype.getSuggestedDefineCalculationQuestions=function(t){var r=this,a=this.constructInterpretRequest("",16384,t);return this.interpretProxy.convertToWireInterpretRequest(a).pipe((0,B.w)(function(h){return r.interpretProxy.interpret(h,!0).pipe((0,z.U)(function(g){return function(n){var t=n;t.result&&v.fF.assert(function(){return t.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(g),g}))}))},n.prototype.getPlaceholderText=function(t){var r=this,s=_.filter(t,function(a){return r.isSupportedScope(a)});return this.interpretProxy.probe((0,I.C2)(s)).pipe((0,z.U)(function(a){return{result:a.results?Ue(r.localizationService,a.results):void 0,error:a.error}}))},n.prototype.constructInterpretRequest=function(t,r,s,a,p,h,g){var R=this,x={version:2,utterance:t,scopes:_.filter(s,function(Q){return R.isSupportedScope(Q)}),skipCompletion:!0,spans:p?.specifiedSpans,linguisticSchemaJson:p?.linguisticSchemaJson,inferredTermBinding:p?.inferredTermBinding,isCommitted:!p?.isQuestionNotCommitted,tags:p?.tags,feedback:g,reportMetadata:h};if(this.featureSwitchService.featureSwitches.interpretRequestGroupIdEnabled&&(x.groupId=a?.groupId,x.groupSequenceNumber=a?.groupSequenceNumber),r&&(x.options=r,(0,J.yE)(x.options,256))){var D=p.calculation;v.fF.assertValue(D,"requestParams calculation should be defined"),x.intent={defineCalculation:{language:D.language}},x.isCommitted=D.isCommitted,x.desiredInterpretationsCount=5}return x},n.prototype.isSupportedScope=function(t){return t&&t.model&&(0,me.KZ)(t.model)&&!_.isEmpty(t.model.vsName)&&!_.isEmpty(t.model.dbName)},n.prototype.generateRequestOptions=function(t){var r=66;return t&&(t.supportsInsightsQueries&&(r|=512),t.supportsPodQueries&&(r|=8),t.inferUnknownModelTerms&&(r|=4096),t.singleAnswerBias&&(r|=8192),t.supportsCalculation&&(r|=256),t.includeRelevantSchemaElements&&(r|=32),t.useLlmParser&&(r|=65536)),r},n.prototype.notifyInterpretListenerResult=function(t,r,s,a){v.fF.assertValue(r,"Expect response to be defined"),v.fF.assertValue(t,"Expect interpretListener to be defined"),!s&&t.onInterpretResult(a,r)},n.prototype.notifyInterpretListenerRetry=function(t,r){v.fF.assertValue(t,"Expect interpretListener to be defined."),t.onInterpretRetry&&t.onInterpretRetry(r)},n.prototype.logAnsweredQuestionDataOnError=function(t,r,s,a,p,h){h.isResponseEmpty=!0,h.isError=!0,h.interpretRequestId=a,h.error=p,t.log(r,s,h)},n.prototype.logAnsweredQuestionDataWithInterpretResult=function(t,r,s,a,p,h,g){v.fF.assertValue(h,"Expect response to be defined"),g.interpretRequestId=a,function(n,t,r){var s;v.fF.assertValue(n,"answeredQuestionData"),v.fF.assertValue(t,"Expect response to be defined");var a=_.first(t.results);n.isError=!!t.error,n.isResponseEmpty=!a?.command;var p=function(n,t){v.fF.assertValue(n,"Expect interpretResponse to be defined");var r=_.first(n.results);if(r)return _.find(t,function(s){return s.model.vsName.toLowerCase()===r.virtualServerName.toLowerCase()&&s.model.dbName.toLowerCase()===r.databaseName.toLowerCase()})}(t,r);if(p&&(n.ownerType=function(n){var t,r=null===(t=n?.model)||void 0===t?void 0:t.permissions;return r?(0,J.yE)(r,7)?"Owner":"Shared":"Unknown"}(p)),n.interpretationState="No Result",a){n.language=a.language,n.modelLanguage=a.modelLanguage;var h=null===(s=a.correctionInfo)||void 0===s?void 0:s.state;if(null==h)n.interpretationState="Understood";else switch(h){case 1:n.interpretationState="Did you mean";break;case 2:n.interpretationState="Showing results for";break;case 0:n.interpretationState="No Result";break;default:v.fF.assertFail("Unhandled case: "+h)}}}(g,h,p),t.log(r,s,g)},n.prototype.checkToOverwriteResponseModelInfo=function(t,r){var s=t.results;if(!_.isEmpty(s)&&r)for(var a=0,p=s;a<p.length;a++){var h=p[a];h.virtualServerName=r.vsName,h.databaseName=r.dbName}},(0,L.gn)([(0,L.fM)(3,(0,y.Inject)(Fe)),(0,L.w6)("design:paramtypes",[Pe.vZ,Y.o,$.y0,Object])],n)}();function be(n){v.fF.assertValue(n.utterance,'proxyResponse is expected to be in type InterpretResponse here, it should contain property "utterance" which is not null.');var r=n;r.results&&v.fF.assert(function(){return!r.results.hasOwnProperty("utterances")},'Expect proxyResponse in type InterpretResponse, proxyResponse.result should not contain "utterances" property.')}var ze=function(){function n(t,r){this.telemetryService=t,this.logDebounceTimeInMilliseconds=r}return n.prototype.startLogger=function(){var t=this,r=new Me(this.telemetryService);return null!=this.logAnsweredDataDebounceHandler&&(clearTimeout(this.logAnsweredDataDebounceHandler),this.logAnsweredDataDebounceHandler=null),this.logAnsweredDataDebounceHandler=setTimeout(function(){t.logAnsweredDataDebounceHandler=null,r.setReadyToLogData()},this.logDebounceTimeInMilliseconds),r},n}(),Me=function(){function n(t){this.telemetryService=t,this.eventInfo$=new Ye.X(void 0)}return n.prototype.log=function(t,r,s){this.eventInfo$.next({start:t,end:r,data:s})},n.prototype.setReadyToLogData=function(){var t=this;this.eventInfo$.subscribe(function(r){r&&t.logData(r)})},n.prototype.logData=function(t){var r=t.start,s=t.end,a=t.data;v.fF.assert(function(){return-1!==r},"startTime value should be set"),v.fF.assert(function(){return-1!==s},"endTime value should be set"),a.wasCancelled&&(a.isError=!1),this.telemetryService.logEvent(function(g,R,T,x){return void 0===R&&(R=!1),void 0===T&&(T=void 0),void 0===x&&(x=void 0),Ae.yP({EventsKitEventName:"FireActivityCompletionSummaryEvent",howEnded:a.isError?"3":"1",isResponseEmpty:a.isResponseEmpty,fromCache:a.fromCache,contentProviderType:a.contentProviderType,ownerType:a.ownerType,duration:s-r,probeDuration:-1,wasCancelled:a.wasCancelled,interpretRequestId:a.interpretRequestId,entryPoint:a.entryPoint,linguisticSchemaLanguage:a.language,modelLanguage:a.modelLanguage,withContextPresent:!1,usedContext:!1,tags:a.tags,interpretationState:a.interpretationState,parentId:g,isError:a.isError,errorSource:T,errorCode:x,warnings:a.warnings,responseError:a.error})})},n}(),se=l(91592),Ke=l(41887),He=l(47508),Ge=l(88255);function e(n,t,r,s,a,p,h,g,R,T,x,D,Q,H){return new i(n,t,r,s,a,p,h,g,R,T,x,D,Q,H)}var i=function(){function n(t,r,s,a,p,h,g,R,T,x,D,Q,H,O){this.conceptualSchemaProxy=t,this.dataSources=r,this.dialogService=s,this.errorService=a,this.explorationCapabilitiesService=p,this.explorationNavigation=h,this.formFactorProvider=g,this.layoutAuthoring=R,this.lazyProvider=T,this.localizationService=x,this.telemetryService=D,this.viewModeState=Q,this.visualAuthoring=H,this.qnaProxyPathToken=O}return n.prototype.reportConfigAllowsQna=function(t){return 0===this.formFactorProvider.getCurrentLayout()&&!(0===this.viewModeState.getMode()&&!t.allowInViewMode)},n.prototype.tryAddQnaContainerToCanvas=function(t,r){return(0,L.mG)(this,void 0,void 0,function(){var s,a,p,h,g,R,T;return(0,L.Jh)(this,function(D){switch(D.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!1})?[4,this.ensureQnaSupportabilityService()]:[2,!1];case 1:return D.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return s=D.sent(),a=this.explorationCapabilitiesService.getCapabilities(),!(p=(0,se.H)(a,s,this.qnaSupportabilityService)).isAllowed&&"featureDisabledInApp"===p.disallowedReason||!p.isAllowed&&!a.allowEnableQnaPrompts?[2,!1]:(g={width:t.contract.size.width,height:t.contract.size.height},(h=r&&r.pointOfInterest)&&(R=this.layoutAuthoring.getLayoutForNewVisualContainer(t.contract.visualContainers,h,g)),T=this.explorationNavigation.getAllSections(),[4,(0,Ke.lN)({telemetrySource:r.creationSource,position:R,visualType:He.L.qnaVisual.name},T,t,this.dataSources.get(),this.visualAuthoring,this.telemetryService)]);case 3:return D.sent(),[2,!0]}})})},n.prototype.tryShowQnaPopout=function(t,r){return(0,L.mG)(this,void 0,void 0,function(){var a,p,h,g,R,D=this;return(0,L.Jh)(this,function(Q){switch(Q.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!0})?[4,this.ensureQnaSupportabilityService()]:[2];case 1:return Q.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return a=Q.sent(),p=this.explorationCapabilitiesService.getCapabilities(),(h=(0,se.H)(p,a,this.qnaSupportabilityService)).isAllowed?[4,this.lazyProvider.get("@powerbi/QnaReportContainer/module#QnaReportContainerModule","qnaPopoutBuilderModern")]:[3,5];case 3:return g=Q.sent(),R={anchorElement:t,dataSources:this.dataSources.get(),explorationCapabilities:p,sourceExploration:this.explorationNavigation.getCurrentExploration(),sourceFilters:r.sourceFilters,viewMode:this.viewModeState.getMode(),close:function(){D.explorationNavigation.hideExplorationMask()}},[4,g.show(R)];case 4:return Q.sent(),this.explorationNavigation.showExplorationMask(),[3,6];case 5:switch(h.disallowedReason){case"featureDisabledInIE":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupportedInIE_Title"),this.localizationService.get("Qna_NotSupportedInIE_Subtitle"));break;case"featureDisabledInApp":v.fF.assertFail("Expect the code of showing qna popout never be called if app doesn't allow qna feature");break;case"noModel":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.localizationService.get("Qna_NotAllowedForReport_WithoutModel"));break;case"qnaNotSupported":this.errorService.infoCustom(this.localizationService.get("VisualContainer_QnaVisual_NotSupportedTitle"),this.localizationService.get("VisualContainer_QnaVisual_NotSupportedMessage"));break;case"qnaNotEnabled":this.qnaSupportabilityService.canAnyUserEnableQna()?this.dialogService.showConfirmationDialog({title:this.localizationService.get("Qna_NotSupported_Title"),message:this.qnaSupportabilityService.modelHasQnaDisabledMessage,okButtonText:this.localizationService.get("Qna_MessageDialog_EnableQnaButtonText"),cancelButtonText:this.localizationService.get("Cancel_ButtonText")},{maxWidth:500}).afterClosed().pipe((0,Ge.P)()).subscribe(function(H){return(0,L.mG)(D,void 0,void 0,function(){return(0,L.Jh)(this,function(O){switch(O.label){case 0:return 1!==H?[3,3]:[4,this.qnaSupportabilityService.enableQna()];case 1:return O.sent(),[4,this.tryShowQnaPopout(t,r)];case 2:O.sent(),O.label=3;case 3:return[2]}})})}):this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.qnaSupportabilityService.modelHasQnaDisabledMessage);break;default:v.fF.assertNever(h.disallowedReason)}Q.label=6;case 6:return[2]}})})},n.prototype.ensureQnaSupportabilityService=function(){return(0,L.mG)(this,void 0,void 0,function(){var t;return(0,L.Jh)(this,function(r){switch(r.label){case 0:return this.qnaSupportabilityService?[3,2]:(t=this,[4,this.lazyProvider.get(this.qnaProxyPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaSupportabilityService")]);case 1:t.qnaSupportabilityService=r.sent(),r.label=2;case 2:return[2]}})})},n}(),o=l(50911),d=function(){function n(t){this.datasetStore=t}return n.prototype.isDQOrLiveConnectToOnPrem=function(t){return(0,L.mG)(this,void 0,void 0,function(){var r;return(0,L.Jh)(this,function(s){switch(s.label){case 0:return t?[4,this.datasetStore.findDatasetById(t.datasetId)]:[2,Promise.resolve(!1)];case 1:return r=s.sent(),v.fF.assertValue(r,"Model with database id "+t.datasetId+"should exist"),r?[2,Promise.resolve((0,me.t6)(r))]:[2,Promise.resolve(!1)]}})})},n.\u0275fac=function(r){return new(r||n)(y.\u0275\u0275inject(o.s))},n.\u0275prov=y.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),f=l(30794),S=l(73058),M=function(){function n(t,r){this.localizationService=t,this.datasetStore=r,this.qnaSettingsChanged=new f.xQ}return n.prototype.ngOnDestroy=function(){this.qnaSettingsChanged.complete()},n.prototype.appShouldHideQnaFeature=function(){return!1},n.prototype.modelSupportsQna=function(t,r){return!!r?.qna&&_.some(t.schemas,function(s){var a;return!s.isExtensionSchema&&(null===(a=s.capabilities)||void 0===a?void 0:a.supportsQna)})},n.prototype.modelHasQnaEnabled=function(t,r){return!!r?.qna&&_.some(t.schemas,function(s){var a;return!s.isExtensionSchema&&(null===(a=s.capabilities)||void 0===a?void 0:a.isQnaEnabled)})},n.prototype.modelSupportsNlToDax=function(){return!1},n.prototype.getNlToDaxStatus=function(){return"Disabled"},n.prototype.canAnyUserEnableQna=function(){return!1},n.prototype.canCurrentUserEnableQna=function(t){return(0,L.mG)(this,void 0,void 0,function(){var r,s;return(0,L.Jh)(this,function(a){switch(a.label){case 0:return null==(r=_.find(t,function(p){return p.type===S.nKy}))?[2,!1]:[4,this.datasetStore.findDatasetById(r.id)];case 1:return s=a.sent(),[2,s?.permissions&&(0,J.yE)(s.permissions,2)]}})})},n.prototype.enableQna=function(){throw new Error("Method not implemented.")},Object.defineProperty(n.prototype,"qnaSettingsChanged$",{get:function(){return this.qnaSettingsChanged},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelHasQnaDisabledMessage",{get:function(){return this.localizationService.get("Visual_Qna_IsNotEnabled_Service")},enumerable:!1,configurable:!0}),n.prototype.allowsLinguisticSchemaEdit=function(){return!1},n.\u0275fac=function(r){return new(r||n)(y.\u0275\u0275inject(Y.o),y.\u0275\u0275inject(o.s))},n.\u0275prov=y.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),E=l(77476),A=l(26898),te=l(18950),K=l(29513),G=l(39503),Z=l(83008),ue=l(48145),ke=l(17328),tt=l(63387),nt=l(77200),rt=l(10861),it=l(76521),ot=new y.InjectionToken("ImproveLsdlProxy"),at=l(65947),qe=l(12123),st=l(76072),ut=l(82156),lt=l(79061),dt=l(58938),ct=l(94785),pt=l(66972),ft=l(62345),vt=function(){function n(t){this.certifiedEventsService=t}return n.prototype.logInterpretWithCopilotEvent=function(t,r,s){this.certifiedEventsService.logStandardizedFeatureEvent({featureName:(0,ft.mN)("Downstream","Qna-Query"),activityStatus:"Succeeded",activityName:"Qna-Query",resultCode:"",correlationId:"",activityAttributes:{IsSignedIn:r,Location:"service"===t?"Service":"Desktop",ContentMode:0===s?"View":"Edit"}})},n.\u0275fac=function(r){return new(r||n)(y.\u0275\u0275inject($.ly))},n.\u0275prov=y.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),ht=function(){function n(){}return n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=y.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=y.\u0275\u0275defineInjector({providers:[pe.J,m,ve,{provide:qe.n,useValue:"@powerbi/Qna/qnaweb.module#QnaWebModule"},{provide:at.z,useValue:"@powerbi/Qna/qnaweb.module#QnaWebModule"},M,d,{provide:"InterpretServiceModern",useFactory:Ee,deps:[Pe.vZ,Y.o,$.y0,ve]},{provide:"qnaLaunchService",useFactory:e,deps:[A.i,Z.D,dt.x,te.T,ue.U,G.z,ke.F,tt.U,st.E,Y.o,$.y0,nt.kc,rt.$8,qe.n]},{provide:"qnaSupportabilityService",useClass:M},{provide:"qnaModelUtilsService",useClass:d},{provide:ot,useClass:b},{provide:"interpretCopilotTelemetryService",useClass:vt},{provide:"qnaSupportabilitytUtilsModern",useFactory:se.G}],imports:[E.CommonModule,K.T,it.A3,ut.N,lt.v,pt.N,$.e3,ct.g,c.T]}),n}()},5894:function(j,w,l){l.d(w,{WW:function(){return b},dN:function(){return N},v5:function(){return V},yP:function(){return u}});var c=l(41114),y="PBI.QnaVisual.SuggestionCardClicked",b=c.cx[y]=(0,c.b1)(y),v="PBI.QnaVisual.VisualConverted",N=c.cx[v]=(0,c.b1)(v),m="PBI.QnA.INAQ",u=c.cx[m]=(0,c.b1)(m,{logExpAssignment:!0}),F="PBI.QnA.Feedback",V=c.cx[F]=(0,c.b1)(F),I="PBI.QnA.UpdateLsdlSharingPermission",U=(c.cx[I]=(0,c.b1)(I),"PBI.QnaTooling.ImproveLsdlRequest");c.cx[U]=(0,c.b1)(U)},91592:function(j,w,l){l.d(w,{G:function(){return b},H:function(){return y}});var c=l(16808);function y(v,N,m){return(0,c.rO)()?{isAllowed:!1,disallowedReason:"featureDisabledInIE"}:m.appShouldHideQnaFeature()?{isAllowed:!1,disallowedReason:"featureDisabledInApp"}:_.some(N?.schemas,function(V){return!V.isExtensionSchema&&!_.isEmpty(V.entities)})?m.modelSupportsQna(N,v)?m.modelHasQnaEnabled(N,v)?{isAllowed:!0}:{isAllowed:!1,disallowedReason:"qnaNotEnabled"}:{isAllowed:!1,disallowedReason:"qnaNotSupported"}:{isAllowed:!1,disallowedReason:"noModel"}}function b(){return{getIsQnaAllowedInfo:y}}},35988:function(j,w,l){l.d(w,{AU:function(){return Ue},B4:function(){return Le},C2:function(){return $},Cb:function(){return ve},R1:function(){return De},Tm:function(){return Ne},fL:function(){return me},oA:function(){return ge},pk:function(){return k},vr:function(){return Ae}});var m,u,F,V,I,C,c=l(70940),y=l(3468),b=l(62458),v=l(43286),N=l(80777),U=((m={}).GeneratedLinguisticSchema=0,m.DataIndexBuildingCancelled=16,m.DataIndexMissingStatistics=17,m.DataIndexNotReady=8,m.DataIndexSizeLimitReached=15,m.DataIndexUpdateFailure=10,m.DomainModelNotReady=2,m.DomainModelPartialLoad=3,m.DomainModelUpdateFailure=9,m.EmptyLinguisticSchema=1,m.InterpretationSemanticError=4,m.InterpretationSemanticWarning=5,m.InterpretCancelled=18,m.InvalidTextualEntity=6,m.LinguisticSchemaTruncated=14,m.MissingOrInvalidPodParameters=13,m.QueryAggregateNotSupported=19,m.QueryMedianNotSupported=20,m.QueryPercentileNotSupported=21,m.QueryScopedEvalNotSupported=22,m.QuerySubqueryRegroupingNotSupported=23,m.StaleDataIndex=12,m.StaleDomainModel=11,m.RequiresNewerVersion=7,m.DataIndexVersionIsOld=24,m.QueryGroupByTableNotSupported=25,m.QueryNotSupported=26,m.NextBestInterpretation=27,m),z=((u={}).ActivationFailure="ActivationFailure",u.CloudRlsModelAccessDenied="CloudRlsModelAccessDenied",u.DataIndexBuildFailure="DataIndexBuildFailure",u.DomainModelLoadFailure="DomainModelLoadFailure",u.ExternalModelAccessDenied="ExternalModelAccessDenied",u.GenericRequestFailure="GenericRequestFailure",u.LinguisticSchemaLoadFailure="LinguisticSchemaLoadFailure",u.ModelNotFound="ModelNotFound",u.ModelQnaNotEnabled="ModelQnaNotEnabled",u.ModelQnaNotSupported="ModelQnaNotSupported",u.RequiresNewerVersion="RequiresNewerVersion",u.SchemaLanguageNotSupported="SchemaLanguageNotSupported",u.MissingRuntimeModule="MissingRuntimeModule",u.VerifyRuntimeFailure="VerifyRuntimeFailure",u.DataIndexMissingAllStatistics="DataIndexMissingAllStatistics",u),re=((F={})[16]="Qna_Warning_DataIndexIncomplete_Desktop",F[15]="Qna_Warning_DataIndexIncomplete_Desktop",F[14]="Qna_Warning_LinguisticSchemaTruncated_Desktop",F),ie=((V={})[16]="Qna_Warning_DataIndexIncomplete_Service",V[15]="Qna_Warning_DataIndexIncomplete_Service",V[14]="Qna_Warning_LinguisticSchemaTruncated_Service",V),ce=[2,8],X=((I={})[1]="Qna_NotAllowedForReport_WithoutModel",I[2]="Qna_Explore_WarningBuildingLanguageModel",I[7]="Qna_Warning_RequiresNewerVersion",I[8]="Qna_Explore_WarningIndexing",I[9]="Qna_Warning_ModelUpdateFailure",I[10]="Qna_Warning_DataIndexUpdateFailure",I[11]="Qna_Warning_StaleModel",I[12]="Qna_Warning_StaleIndex",I[17]="Qna_Warning_DataIndexMissingStatistics",I[19]="Qna_Warning_UnsupportedFunction",I[20]="Qna_Warning_UnsupportedFunction",I[21]="Qna_Warning_UnsupportedFunction",I[22]="Qna_Warning_UnsupportedFunction",I[23]="Qna_Warning_UnsupportedFunction",I[25]="Qna_Warning_QueryGroupByTableNotSupported",I[26]="Qna_Warning_QueryNotSupported",I[27]="Qna_Warning_NextBestInterpretation",I),pe=((C={}).FeatureNotAvailable="Qna_Error_GenericRequestFailure",C.NetworkConnectionIssue="Qna_Error_NetworkIssue",C.RequiresNewerVersion="Qna_Error_RequiresNewerVersion",C.ModelNotFound="Qna_Error_ModelNotFound",C.ModelQnaNotEnabled="Qna_Error_ModelQnaNotEnabled",C.ModelQnaNotSupported="Qna_Error_ModelQnaNotSupported",C.MissingRuntimeModule="Qna_Explore_MissingBinaries",C.VerifyRuntimeFailure="Qna_Explore_MissingBinaries",C.SchemaLanguageNotSupported="Qna_NotAllowedForReport_QnaNotSupported",C.SessionIsInactive="Qna_Error_GenericRequestFailure",C.GenericRequestFailure="Qna_Error_GenericRequestFailure",C.DataIndexBuildFailure="Qna_Explore_WarningFailedIndexing",C.CloudRlsModelAccessDenied="Tile_RLS_NoAccess",C.ExternalModelAccessDenied="Qna_Explore_ModelAccessDenied_WithoutSpecifyOwner",C.DataIndexMissingAllStatistics="Qna_Error_DataIndexMissingAllStatistics",C),Qe=[19,20,22,21,23,25,26];function Le(e){b.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=ae(e);if(i)return{error:i};var o=_.first(e.Results),d=_.first(o?.Interpretations);return{result:{utterances:_.map(d?.SuggestedUtterances,function(f){return{text:f.Text,source:f.Source}}),warnings:q(o?.DiagnosticMessages)}}}function De(e,i,o,d){b.fF.assertValue(d,"Expect the given wireV3Response to be defined");var S,M,f=ae(d);if(!f){var E=_.first(d.Results);M=q(E?.DiagnosticMessages);var A=i??1,te=_.take(E?.Interpretations,A);_.isEmpty(te)||(S=_.map(te,function(K){var G,Z,ue;return{restatement:K.Restatement,databaseName:null===(G=E.Context)||void 0===G?void 0:G.DatabaseName,virtualServerName:null===(Z=E.Context)||void 0===Z?void 0:Z.VirtualServerName,command:We(K.Command),correctionInfo:Ke(K),spans:oe(e,K.Spans),language:E.Language,modelLanguage:E.ModelLanguage,modelOwner:null===(ue=E.Context)||void 0===ue?void 0:ue.ModelOwner,usedAgents:_.map(K.UsedAgents,function(ke){return ke}),score:K.Score,relevantSchemaElements:fe(E.RelevantSchemaElements)}}))}return{utterance:e,requestId:o,error:f,results:S,warnings:M}}function fe(e){if(null!=e&&(null!=e.Entities||null!=e.Relationships)){var i=function(d){return{description:d.Description,score:d.Score}};return{entities:_.map(e.Entities,i),relationships:_.map(e.Relationships,i)}}}function ve(e){b.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=ae(e);if(i)return{error:i};var o=_.first(e.Results);return{results:_.map(o?.Interpretations,function(f){return{language:o.Language}})}}function k(e){b.fF.assertValue(e,"Expect the given wireResponse to be defined");var i=function(e){b.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=_.first(e.Results);return q(i?.DiagnosticMessages)}(e);return _.find(ce,function(o){return _.includes(i,o)})}function ge(e){var i=_.cloneDeep(e);return i.Results=i.Results.sort(function(o,d){var f,S;return(null===(f=_.maxBy(d.Interpretations,function(A){return A.Score}))||void 0===f?void 0:f.Score)-(null===(S=_.maxBy(o.Interpretations,function(A){return A.Score}))||void 0===S?void 0:S.Score)}),i}function oe(e,i){if(b.fF.assertValue(e,"utterance"),b.fF.assertAnyValue(i,"wireSpans"),i){_.isEmpty(e)&&b.fF.assert(function(){return _.every(i,function(f){return 0===f.Length})},"utterance is empty, every span should have zero length");var o=[],d=[];return _.forEach(i,function(f){5!==f.Resolution||f.Binding?o.push(new ye(e,f,!1)):d.push(new ye(e,f,!0))}),_.isEmpty(d)||_.forEach(d,function(f){_.forEach(o,function(S){if(function(e,i){return i.startIndex<=e.startIndex&&i.endExcludingIndex>e.startIndex||i.startIndex<e.endExcludingIndex&&i.endExcludingIndex>e.endExcludingIndex||e.startIndex<=i.startIndex&&e.endExcludingIndex>=i.endExcludingIndex||i.startIndex<=e.startIndex&&i.endExcludingIndex>=e.endExcludingIndex}(S,f))S.overlapSpans.push(f);else if(f.endExcludingIndex<S.startIndex)return})}),o}}function _e(e){return _.map(e,function(i){return{startIndex:i.StartIndex,endExcludingIndex:i.StartIndex+i.Length}})}function me(e){b.fF.assertValue(e,"The given request must be defined");var i=function(e){return e?{Version:"3.3.0",Utterance:e.utterance,Spans:_.map(e.spans,function(i){var o={StartIndex:i.startIndex,Length:i.endExcludingIndex-i.startIndex};return i.inferredTerm&&(o.Binding={InferredTerm:Me(i.inferredTerm)}),o}),Options:Fe(e),LinguisticSchemaJson:e.linguisticSchemaJson,InferredTermBinding:Me(e.inferredTermBinding),Intent:Y(e.intent),IsCommitted:e.isCommitted,DesiredInterpretationsCount:e.desiredInterpretationsCount,GroupId:e.groupId,GroupSequenceNumber:e.groupSequenceNumber}:{Version:"3.3.0",Utterance:""}}(e);return i.Context={ModelScopes:_.map(e.scopes,function(o){return{VirtualServerName:o.model.vsName,DatabaseName:o.model.dbName,ReportIds:o.reportIds}}),Tags:e.tags,ImpersonatedUserPrincipalName:e.impersonatedUserPrincipalName,ImpersonatedRoles:e.impersonatedRoles,Feedback:Ce(e.feedback)},i}function Y(e){if(e?.defineCalculation)return{DefineCalculation:{Language:e.defineCalculation.language,Options:e.defineCalculation.options}}}function Fe(e){return null==e?.options?{}:{QueryMetadata:(0,v.yE)(e.options,2),VisualConfiguration:(0,v.yE)(e.options,4),SupportPodQueries:(0,v.yE)(e.options,8),IncludeRelevantSchemaElements:(0,v.yE)(e.options,32),Spans:(0,v.yE)(e.options,64),Diagnostics:(0,v.yE)(e.options,128),FrameTree:!1,AllowFollowUpQuestion:!1,AllowInsightQueries:(0,v.yE)(e.options,512),InferUnknownModelTerms:(0,v.yE)(e.options,4096),AllowPlaceholderSuggestions:!1,SuggestFollowUp:!1,SuggestedUtterances:(0,v.yE)(e.options,2048),SkipCompletion:e.skipCompletion,SingleAnswerBias:(0,v.yE)(e.options,8192),SuggestedDefineCalculationUtterances:(0,v.yE)(e.options,16384),UseLlmParser:(0,v.yE)(e.options,65536)}}function $(e){return _.map(e,function(i){var o,d;return{VirtualServerName:null===(o=i.model)||void 0===o?void 0:o.vsName,DatabaseName:null===(d=i.model)||void 0===d?void 0:d.dbName,ReportIds:i.reportIds}})}function Ae(e){if(_.indexOf(e,27)>=0)return[];var i=_.intersection(e,Qe);return _.map(i,function(o){return{warning:o,messageKey:X[o]}})}function Ne(e,i){if(!_.isEmpty(e)){b.fF.assert(function(){return!_.isEmpty(i)},"Must provide a valid qnaProxyPath");for(var o=[],d="@powerbi/Qna/qnadesktop.module#QnaDesktopModule"===i?re:ie,f=0,S=e;f<S.length;f++){var M=S[f];if(d){var E=d[M];if(E){o.push(E);continue}}var A=X[M];A&&o.push(A)}return _.uniq(o)}}function Ue(e,i){return i.get(pe[e]||"Qna_Error_GenericRequestFailure")}function ae(e){var i,o;if(b.fF.assertValue(e,"Expect the given wireV3Response to be defined"),"3.3.0"!==e.Version)i="RequiresNewerVersion";else{var d=_.first(e.Results);if(!d)return;o=_.find(d.DiagnosticMessages,function(M){return 1===M.Severity}),i=o?.Code}if(null!=i){var f=function(e){var i=z[e];return b.fF.assert(function(){return null!=i},"InterpretDiagnosticCodeToQnaErrorCodeMappings should contain key "+e),i||(i="NoClientHandling"),i}(i),S={errorCode:f,source:"GenericRequestFailure"===f?"PowerBI":"User",message:o?.Message,stackTrace:o?.StackTrace};return"NoClientHandling"===S.errorCode&&(S.message=_.isEmpty(S.message)?i+".":i+". "+S.message),S}}function q(e){if(!_.isEmpty(e)){for(var i=[],d=function(A){b.fF.assert(function(){return null!=U[A.Code]},'unknown mapping to convert InterpretDiagnosticMessage "'+A.Code+'" to client interpret warning code'),U[A.Code]&&i.push(U[A.Code])},f=0,S=e.filter(function(E){return 2===E.Severity});f<S.length;f++)d(S[f]);return i}}var ye=function(){return function(i,o,d){this.utterance=i,this.wireSpan=o,this.isOverlappingSpan=d,this.startIndex=o.StartIndex,this.endExcludingIndex=o.StartIndex+o.Length,this.text=i.substr(o.StartIndex,o.Length),this.correctedStartIndex=o.CorrectedStartIndex,this.correctedEndExcludingIndex=null!=o.CorrectedStartIndex?o.CorrectedStartIndex+o.CorrectedLength:void 0,this.resolution=o.Resolution,this.isOverlapping=d,this.tokens=function(e,i,o){return _.map(o,function(d){var f=d.StartIndex-i;return b.fF.assert(function(){return _.inRange(f,0,_.size(e))},"Expect each token.StartIndex is a valid index with the given spanText and spanStartIndex"),b.fF.assert(function(){return!_.isEmpty(_.trim(e.substr(f,d.Length)))},"Expect no WireToken being pure space"),{startIndex:d.StartIndex,endExcludingIndex:d.StartIndex+d.Length,text:e.substr(f,d.Length)}})}(this.text,this.startIndex,o.Tokens);var f=Te(this.text,o.Binding);this.binding=f&&f.bindingInfo,this.isCorrected=!(!this.binding||!f.isCorrected);var S=ee(this.text,o.AlternateBindings),M=ee(this.text,o.PhraseCompletions),E=ee(this.text,o.PhraseExtensions),A=ee(this.text,o.SuggestedReplacements);(!_.isEmpty(S)||!_.isEmpty(M)||!_.isEmpty(E)||!_.isEmpty(A))&&(this.replacementBindings={alternates:S,phraseCompletions:M,phraseExtensions:E,suggestedReplacements:A}),this.inferredTermBindings=_.map(o.InferredTermBindings,function(Z){return{inferredBindingType:(e=Z.InferredTerm).Type,definitionPrompt:e.DefinitionPrompt,definitionText:e.DefinitionText,prefixText:e.PrefixText,suffixText:e.SuffixText,hintText:e.HintText,alternateDefinitionTexts:e.AlternateDefinitionTexts,linguisticSchemaItems:e.LinguisticSchemaItems,definedTerm:e.DefinedTerm,targetRole:e.TargetRole,metadata:e.Metadata};var e}),this.inferredTermBindingsUnsupported=o.InferredTermBindingsUnsupported,this.hasBinding=null!=this.binding||null!=this.replacementBindings||!_.isEmpty(this.inferredTermBindings),this.isWhiteSpace=!_.isEmpty(this.text)&&_.isEmpty(_.trim(this.text)),this.isUsed=!this.isOverlapping&&(null==this.resolution||0===this.resolution||4===this.resolution),this.isUnknown=3===this.resolution,this.isInferred=4===this.resolution,this.overlapSpans=[];var e,K=!((e=this).isOverlapping||_.isEmpty(e.text)||Ie(e)||Ee(e)||xe(e))&&e.hasBinding&&e.isUsed,G=xe(this);b.fF.assert(function(){return!(K&&G)},"A span can not be definedWithOptions and undefinedWithOptions at the same time."),this.state=K?"accepted":G&&this.isUsed?"warning":G?"error":"none"}}();function We(e){if(e){var i=e.Query?y.ib.deserializeQuery(e.Query):void 0;return{query:i,queryMetadata:Se(i,e.QueryMetadata),data:e.Data,binding:e.Binding,visualConfigurations:_.map(e.VisualConfigurations,function(d){var f=d.Query?y.ib.deserializeQuery(d.Query):void 0;return{visualizationType:d.VisualizationType,dataShapeBinding:d.DataShapeBinding,visualElements:d.VisualElements,query:f,queryMetadata:Se(i,d.QueryMetadata)}}),suggestedVisualTypes:_.map(e.SuggestedVisualizations,function(d){return(0,c.s)(d.VisualizationType).name}),linguisticSchemaJson:e.LinguisticSchemaJson,linguisticSchemaItems:e.LinguisticSchemaItems,inferredTermMetadata:e.InferredTermMetadata,defineCalculation:Ve(e.DefineCalculation)}}}function Ve(e){if(e)return{expression:e.Expression,homeTable:e.HomeTable,format:e.Format}}function Se(e,i){if(e&&i){var o=_.filter(i.Filters,function(f){return!!f}),d=_.filter(i.Select,function(f){return!!f});return{filters:_.map(o,function(f){return{Restatement:f.Restatement,type:void 0}}),selects:_.map(d,function(f){return{restatement:f.Restatement,valueType:He(f.DefaultLabel?f.DefaultLabel.SemanticType:f.SemanticType),isGroup:f.IsGroup,defaultLabel:f.DefaultLabel?Ge(f.DefaultLabel.Expression,e):void 0,isExplicitSortBy:f.IsExplicitSortBy}})}}}function Ie(e){var i,o;return 7===(null===(i=e.binding)||void 0===i?void 0:i.type)&&!e.isCorrected&&_.isEmpty(null===(o=e.replacementBindings)||void 0===o?void 0:o.suggestedReplacements)&&_.isEmpty(e.inferredTermBindings)}function Ee(e){var i,o;return 8===(null===(i=e.binding)||void 0===i?void 0:i.type)&&!e.isCorrected&&2===e.resolution&&_.isEmpty(null===(o=e.replacementBindings)||void 0===o?void 0:o.suggestedReplacements)&&_.isEmpty(e.inferredTermBindings)}function xe(e){return!(e.isOverlapping||_.isEmpty(e.text)||Ie(e)||Ee(e)||!(e.isCorrected||3===e.resolution||e.hasBinding&&!e.isUsed))}function Te(e,i){if(i&&!i.InferredTerm){var o,d;if(i.Table)o=i.Table,d=0;else if(i.Pod)o=i.Pod,d=1;else if(i.Property)o=i.Property,d=2;else if(i.Value)o=i.Value,d=3;else if(i.Range)o=i.Range,d=4;else if(i.VisType)o=i.VisType,d=5;else if(i.Composite)o=i.Composite,d=6;else if(i.Core)o=i.Core,d=7;else if(i.Phrasing)o=i.Phrasing,d=8;else if(i.TextualEntity)o=i.TextualEntity,d=9;else{if(!i.AnyEntity){var f=i;return void b.fF.assert(function(){return!!f.Literal},"Has binding type that is unhandled by client right now. Known unhandled types are: [Literal] and this is not a known type. Check to either update the known unhandled type list, or handle it on the client side.")}o=i.AnyEntity,d=10}return{bindingInfo:{type:d,text:o.Text,textSegmentsWithMatchInfo:be(e,o.Text,o.MatchedSegments),matchType:o.MatchType,score:o.Score},isCorrected:o.Corrected}}}function be(e,i,o){if(_.isEmpty(e)||_.isEmpty(o))return[{text:i,isMatched:!1}];for(var d=[],f=0,S=0,M=o;S<M.length;S++){var E=M[S];f<E.StartIndex&&d.push({text:i.substring(f,E.StartIndex),isMatched:!1}),d.push({text:i.substr(E.StartIndex,E.Length),isMatched:!0}),f=E.StartIndex+E.Length}return f<_.size(i)&&d.push({text:i.substring(f),isMatched:!1}),d}function ee(e,i){if(i){for(var o=[],d=0,f=i;d<f.length;d++){var M=Te(e,f[d]);M&&o.push(M.bindingInfo)}return o}}function Ce(e){return e?{Sentiment:e.sentiment,Reason:e.reason,Comment:e.comment}:void 0}function Me(e){return null==e?void 0:{Type:e.inferredBindingType,DefinitionPrompt:e.definitionPrompt,DefinitionText:e.definitionText,PrefixText:e.prefixText,SuffixText:e.suffixText,HintText:e.hintText,AlternateDefinitionTexts:e.alternateDefinitionTexts,LinguisticSchemaItems:e.linguisticSchemaItems,DefinedTerm:e.definedTerm,TargetRole:e.targetRole,Metadata:e.metadata}}function Ke(e){b.fF.assertValue(e,"result");var i=e.CorrectedUtterance;if(!_.isEmpty(i)){var d=e.ReplacementUtterance,f=2;return!!e.Command||(e.ConfidenceLevel<=5?f=0:e.ConfidenceLevel<=20&&(f=1)),_.isEmpty(e.CorrectedUtteranceTextSegments)?{correctedUtterance:i,replacementUtterance:d||i,state:f}:{correctedUtterance:i,correctedTextSegments:_e(e.CorrectedUtteranceTextSegments),state:f}}}function He(e){switch(e){case 0:case 1:case 2:case 3:return;case 4:return N.Ge.fromExtendedType(7078913);case 5:return N.Ge.fromDescriptor({dateTime:!0});case 6:return N.Ge.fromDescriptor({numeric:!0})}}function Ge(e,i){var o=y.ib.serializeQuery(i);o.Select.push(e);var d=y.ib.deserializeQuery(o);return _.last(d.select()).expr}}}]);