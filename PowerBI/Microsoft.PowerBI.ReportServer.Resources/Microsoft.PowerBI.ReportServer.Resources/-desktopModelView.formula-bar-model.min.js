"use strict";(self.webpackChunkdesktopModelView=self.webpackChunkdesktopModelView||[]).push([["formula-bar-model"],{90156:function(Pl,lr,M){M.r(lr),M.d(lr,{FormulaBarModelModule:function(){return Sl}});var dr,L,Fe=M(77476),Wt=M(17174),qi=M(26960),cr=M(97178),Yi=M(8948),h=M(81337),f=M(50423),Xi=M(46033),se=M(62458),R=M(68816),ft=function(){function n(){var e=this;this.modelToProviderConfig=new Map,R.editor.onWillDisposeModel(function(t){return e.disposeModel(t)})}return n.getInstance=function(){return this._instance||(this._instance=new n)},n.prototype.getProviderConfig=function(e){return this.modelToProviderConfig.get(e)},n.prototype.createMonacoModelWithConfig=function(e,t,r){var i,o,a=R.editor.createModel(e,t);return this.modelToProviderConfig.set(a.id,r),void 0!==(null===(i=r.modelOptions)||void 0===i?void 0:i.endOfLineStyle)&&a.setEOL(r.modelOptions.endOfLineStyle),void 0!==(null===(o=r.modelOptions)||void 0===o?void 0:o.textModelUpdateOptions)&&a.updateOptions(r.modelOptions.textModelUpdateOptions),a},n.prototype.disposeModel=function(e){this.modelToProviderConfig.delete(e.id)},n}(),ne=M(13500);function V(n,e){se.fF.isDisabled()||!0!==n&&Je(e||"condition: ".concat(n))}function Y(n,e){se.fF.isDisabled()||null==n&&Je(e||"condition: "+n)}function Je(n){if(!se.fF.isDisabled())throw(dr||alert)("Debug Assert failed: ".concat(n)),new Error(n)}function Se(n){return Je(n)}!function(n){function i(o){return null==o?"":_.isString(o)?o:_.isNumber(o)||_.isDate(o)?o.toLocaleString():_.isObject(o)?null!=o.toLocaleString?o.toLocaleString():o.toString():""}n.localizedStrings={incompleteNumber:"Invalid number.",invalidTupleLocation:"Unexpected tuple.",invalidParameter:"Parameter is not the correct type.",missingParameters:"Expected additional parameters.",incorrectOrderByParam:"The OrderBy parameter only accepts the ORDERBY function.",incorrectPartitionByParam:"The PartitionBy parameter only accepts the PARTITIONBY function.",incorrectMatchByParam:"The MatchBy parameter only accepts the MATCHBY function.",grammaticalError:"Unexpected expression {0}",functionCallOnNonFunction:"'{0}' is not a function.",rightArgumentToInOperatorNotValidTable:"{0} is not a valid table.",tooManyParameters:"Unexepected parameter '{0}'",invalidNameCharacter:"'{0}' is not a valid name character.",invalidIdentifier:"Cannot find name '{0}'",unrecognizedIdentifier:"Cannot find name '{0}'",variableNameReserved:"'{0}' is a reserved word",rowsDescription:"Calculate vertically across rows.",columnsDescription:"Calculate horizontally across columns.",rowsColumnsDescription:"Calculate vertically across rows, continuing column by column.",columnsRowsDescription:"Calculate horizontally across columns, continuing row by row.",duplicateMeasureName:"This measure's name has already been used in another table"},n.setLocalizedDaxStrings=function(o){n.localizedStrings=o},n.format=function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];_.isArray(a[0])&&(V(1===a.length,"expected single argument to format if called with an array"),a=a[0]);var c=o;if(c)for(var l=a.length;l--;)c=c.replace(new RegExp("\\{"+l+"\\}","gm"),i(a[l]));return c}}(L||(L={}));var P,xe,j,n,Qt=M(13877),ce=function(){function n(){}return Object.defineProperty(n,"featureSwitches",{get:function(){return n._featureSwitches},enumerable:!1,configurable:!0}),n.setFeatureSwitches=function(e){n._featureSwitches=(0,h.__assign)((0,h.__assign)({},this._featureSwitches),e)},n._featureSwitches={useSkippableParams:!1,suggestKeywords:!0,includeUndefinedOptionalFunctionParameters:!1,resetSuggestWidgetStateBeforeCompletion:!0,addTriviaToParseNodeMetadata:!0,useParseTreeFormatting:!1,customCalendars:!1},n}(),ee=function(n){return n[n.Yum=0]="Yum",n[n.NotHungry=1]="NotHungry",n[n.Yuck=2]="Yuck",n}({}),fr=function(){function n(){}return n.initialize=function(e){n._tryParseColumnReference=e},Object.defineProperty(n,"tryParseColumnReference",{get:function(){if(!this._tryParseColumnReference)throw new Error("NodeUtilities has not been initialized! Ensure DaxParserUtils.initialize has been called first");return n._tryParseColumnReference},enumerable:!1,configurable:!0}),n}();function N(n,e){return n instanceof e?n:void 0}function mn(n,e){return n?n.equals?n.equals(e):n===e:e?e.equals?e.equals(n):e===n:n===e}(P||(P={})).hasFlag=function(t,r){return void 0===t&&(t=0),void 0===r&&(r=0),(t&r)===r},(n=xe||(xe={})).union=function(o,a,s){return o.concat(_.filter(a,function(c){return!_.some(o,function(l){return s(c,l)})}))},n.distinct=function(o,a){for(var s=[],c=function(b){_.some(s,function(C){return a(b,C)})||s.push(b)},l=0,d=o;l<d.length;l++)c(d[l]);return s},n.ofType=function(o,a){return _.filter(o,function(s){return s instanceof a})},n.skipWhile=function(o,a){for(var s=0;s<o.length&&a(o[s]);)s++;return o.slice(s)},function(n){function r(l,d){for(var p=0;p<l.length&&_.includes(d,l[p]);p++);return l.substr(p)}function i(l,d){for(var p=l.length-1;p>=0&&_.includes(d,l[p]);p--);return l.substr(0,p+1)}n.compare=function(l,d,p){return l===d?0:null==l||null==d?-1:(p&&(l=l.toUpperCase(),d=d.toUpperCase()),l===d?0:l<d?-1:1)},n.trim=function(l,d){return r(i(l,d),d)},n.trimStart=r,n.trimEnd=i,n.indexOfAny=function(l,d,p){for(var v,b=0,C=d;b<C.length;b++){var O=l.indexOf(C[b],p);-1!==O&&(null==v||O<v)&&(v=O)}return void 0!==v?v:-1},n.equalIgnoreCase=function(l,d){return Y(l,"first string in comparison must be defined"),Y(d,"second string in comparison must be defined"),l.toUpperCase()===d.toUpperCase()},n.isNullOrEmpty=function(l){return!l},n.startsWithIgnoreCase=function(l,d){return Y(l,"str"),_.startsWith(l.toUpperCase(),d.toUpperCase())}}(j||(j={}));var D,qt,u,pt,Zi=function(){function n(){this.items=[]}return n.prototype.enqueue=function(e){this.items.push(e)},n.prototype.dequeue=function(){return this.items.pop()},Object.defineProperty(n.prototype,"length",{get:function(){return this.items.length},enumerable:!1,configurable:!0}),n}(),hr=function(){function n(){this.table=new ht}return n.prototype.add=function(e){var t=this.table.get(e);return!(t&&_.some(t,function(r){return mn(r,e)})||(this.table.add(e,[e]),0))},n.prototype.remove=function(e){var t=this.table.get(e);if(!t)return!1;for(var r=0;r<t.length;r++)if(mn(t[r],e))return t.splice(r,1),!0;return!1},n.prototype.contains=function(e){var t=this.table.get(e);return!!t&&_.some(t,function(r){return mn(r,e)})},n.prototype.values=function(){for(var e=[],t=0,r=this.table.values();t<r.length;t++)e.push.apply(e,r[t]);return e},n}(),ht=function(){function n(){this.hashMap={}}return Object.defineProperty(n.prototype,"keys",{get:function(){var t=[];for(var r in this.hashMap)t.push.apply(t,this.hashMap[r].map(function(o){return o.key}));return t},enumerable:!1,configurable:!0}),n.prototype.add=function(e,t){var r=n.getHashCode(e),i=this.getBucket(e);if(i){if(this.containsKey(e))throw new Error("Cannot add duplicate value to dictionary");i.push({key:e,value:t})}else this.hashMap[r]=[{key:e,value:t}]},n.prototype.update=function(e,t){var r=this.getEntry(e);r?r.value=t:this.add(e,t)},n.prototype.get=function(e){var t=this.getEntry(e);return t&&t.value},n.prototype.values=function(){var e=[];for(var t in this.hashMap)e.push.apply(e,_.map(this.hashMap[t],function(i){return i.value}));return e},n.prototype.containsKey=function(e){return!!this.getEntry(e)},n.prototype.getBucket=function(e){var t=n.getHashCode(e);return this.hashMap.hasOwnProperty(t)?this.hashMap[t]:void 0},n.prototype.getEntry=function(e){var t=this.getBucket(e);if(t)return _.find(t,function(r){return n.equals(r.key,e)})},n.getHashCode=function(e){var t=e;return _.isFunction(t.getHashCode)?t.getHashCode():0},n.equals=function(e,t){if(Y(e,"a"),Y(t,"b"),e.constructor!==t.constructor)return!1;var r=e;return _.isFunction(r.equals)?r.equals(t):e===t},n}();!function(n){var e=/[a-zA-Z_][a-zA-Z_0-9]*/;function r(O,x){return _.isFunction(x)?i(O,x):i(O,function(g){return x.isReservedWord(g)})}function i(O,x){var g=e.exec(O);return!g||g[0].length!==O.length||x(O)}function o(O){return O&&a(O)+"'"}function a(O){return"'"+O.replace(/'/g,"''")}function c(O){return O.substr(1).replace(/''/g,"'")}function v(O){return"["+O.replace(/\]/g,"]]")}function C(O){return O.substr(1).replace(/\]\]/g,"]")}n.quoteIfNeeded=function(O,x){return r(O,x)?o(O):O},n.quoteNeeded=r,n.quote=o,n.quotePartial=a,n.unquote=function(O){return c(O.substr(0,O.length-1))},n.unquotePartial=c,n.doubleQuote=function(O){return'"'.concat(O.replace(/"/g,'""'),'"')},n.unDoubleQuote=function(O){return O.substr(1,O.length-2).replace(/""/g,'"')},n.bracket=function(O){return v(O)+"]"},n.bracketPartial=v,n.unbracket=function(O){return C(O.substr(0,O.length-1))},n.unbracketPartial=C,n.hasValidAxesReferences=function(O){return!_.isEmpty(O)&&!_.some(O,function(x){return _.isEmpty(x)})}}(D||(D={})),function(n){n.getAllExploredStates=function(t){for(var r=[],i=[],o=0,a=t;o<a.length;o++){var s=a[o];s.iterate(),r=(0,h.__spreadArray)((0,h.__spreadArray)([],r,!0),s.completedStates,!0),i=(0,h.__spreadArray)((0,h.__spreadArray)([],i,!0),s.incompleteStates,!0)}return{completedStates:r,incompleteStates:i}}}(qt||(qt={})),function(n){function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var i=n.None,o=0,a=t;o<a.length;o++){var s=a[o];i={additionalBehaviors:i.additionalBehaviors|s.additionalBehaviors,argumentAction:i.argumentAction|s.argumentAction,argumentContextAction:i.argumentContextAction|s.argumentContextAction,columnReferenceScope:i.columnReferenceScope|s.columnReferenceScope,type:i.type|s.type,dataType:i.dataType|s.dataType}}return i}n.None={},n.InvalidParam={type:262144},n.TableExpr={type:524290,argumentAction:4},n.TableExprAddToRet={type:524290,argumentAction:5},n.TableRef={type:65540,argumentAction:4},n.TableRefAddToRet={type:65540,argumentAction:5},n.AnyColRef={type:24,columnReferenceScope:49},n.QualifiedColRef={type:8,columnReferenceScope:16},n.CalendarRef={type:1048576,argumentAction:4},n.QualifiedColRefAddToRet=e(n.QualifiedColRef,{argumentAction:1}),n.RelatedColRef={type:8,columnReferenceScope:4},n.HomeOrQualifiedColRef={type:8,columnReferenceScope:48},n.EarlierColRef={type:24,columnReferenceScope:3,argumentContextAction:6},n.EarliestColRef={type:24,columnReferenceScope:3,argumentContextAction:7},n.ColFromParentContext={type:24,additionalBehaviors:4},n.ColFromCurTable={type:24,columnReferenceScope:3},n.ColFromExtractedTable=e(n.ColFromCurTable,{argumentContextAction:4}),n.ColFromExtractedTableOrRel=e(n.ColFromCurTable,{columnReferenceScope:4,argumentContextAction:4}),n.ColFromExtractedTableOrRelAddToRet=e(n.ColFromExtractedTableOrRel,{columnReferenceScope:8,argumentAction:1}),n.NewCol={type:32,argumentAction:1},n.ExprOverTable={argumentContextAction:1},n.EnumValue={type:64},n.Dates=e(n.TableExpr,n.QualifiedColRef),n.DatesAddToRet=e(n.Dates,{argumentAction:1}),n.DatesCalendars=e(n.Dates,n.CalendarRef),n.DatesCalendarsAddToRet=e(n.DatesCalendars,{argumentAction:1}),n.Filter={type:1,additionalBehaviors:2},n.OrderByParam={type:16384,argumentContextAction:1},n.PartitionByParam={type:32768},n.MatchByParam={type:131072},n.AxisExpr={type:524288},n.EnumOrIntValue=e(n.EnumValue,{type:1}),n.or=e}(u||(u={})),function(n){n.getTypes=function(r,i){var o=r.type;if(P.hasFlag(r.additionalBehaviors,4))for(var a=0,s=i.ephemeralContexts;a<s.length;a++)o|=24&s[a].allowedTypes;return!_.isEmpty(i.matchObjects.transparentTables)&&P.hasFlag(o,8)&&(o|=16),o},n.transformRole=function(r,i){if(!_.isEmpty(i.matchObjects.transparentTables)&&P.hasFlag(r.type,8)){var o=r.type?16|r.type:16;return(0,h.__assign)((0,h.__assign)({},r),{type:o})}return r}}(pt||(pt={}));var et,pr=function(){function n(e){this._parent=e,null!=this.parent&&this.parent.addChild(this),this._state=0,this.children=[]}return Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"childCount",{get:function(){return this.children.length},enumerable:!1,configurable:!0}),n.prototype.addChild=function(e){return!_.includes(this.children,e)&&(this.children.push(e),!0)},n.prototype.removeChild=function(e){var t=_.indexOf(this.children,e);-1!==t&&this.children.splice(t,1)},n.prototype.reinitialize=function(){this._state=0,this.children=[]},n.prototype.markUnsuccessful=function(){for(var e=this;;){e._state=2;var t=e.parent;if(!t||(t.removeChild(e),t.childCount>0))break;e=t}},n.prototype.consolidatePath=function(){var e,t;for(e=this,t=this.parent;null!=t&&t.childCount<=1;e=t,t=t.parent)V(1===t.childCount,"Must have at least one child, since it is our parent"),e._state=1,t.removeChild(e);return e},Object.defineProperty(n.prototype,"isValid",{get:function(){for(var t=this;;t=t.parent){if(V(null!=t,"There must be an ongoing ParsePath at the root of the tree of ParsePaths"),0===t.state)return!0;if(2===t.state)return!1}},enumerable:!1,configurable:!0}),n}(),gr={listSeparator:",",numberDecimalSeparator:"."},mr=gr;function Be(){return mr}!function(n){n.alwaysRebuildContext=!1,n.debugging=!0}(et||(et={}));var tt=function(){function n(e,t,r){Y(e,"Segment expression cannot be null"),V(t>=0&&t<=e.length,"Invalid startPos"),V(r>=0&&t+r<=e.length,"Invalid length"),this._expression=e,this._startPosition=t,this._length=r}return n.fromTokens=function(e,t){return new n(t.expression,e.startPosition,t.startPosition+t.length-e.startPosition)},Object.defineProperty(n.prototype,"startPosition",{get:function(){return this._startPosition},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"expression",{get:function(){return this._expression},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"text",{get:function(){return this.expression.substr(this.startPosition,this.length)},enumerable:!1,configurable:!0}),n.prototype.equals=function(e){return this.startPosition===e.startPosition&&this.length===e.length},n}(),vr={CALENDAR:{columns:["Date"]},CALENDARAUTO:{columns:["Date"]},COLUMNSTATISTICS:{columns:["Table Name","Column Name","Min","Max","Cardinality","Max Length"]},GENERATESERIES:{columns:["Value"]},"INFO.ALTERNATEOFDEFINITIONS":{columns:["ID","ColumnID","BaseColumnID","BaseTableID","Summarization"]},"INFO.ANNOTATIONS":{columns:["ID","ObjectID","ObjectType","Name","Value","ModifiedTime"]},"INFO.ATTRIBUTEHIERARCHIES":{columns:["ID","ColumnID","State","AttributeHierarchyStorageID","ModifiedTime","RefreshedTime"]},"INFO.ATTRIBUTEHIERARCHYSTORAGES":{columns:["ID","AttributeHierarchyID","SortOrder","OptimizationLevel","MaterializationType","ColumnPositionToData","ColumnDataToPosition","DistinctDataCount","DataVersion","StorageFileID","SystemTableID","HasStatistics","MinValue","MaxValue","StringValueMaxLength"]},"INFO.CALCDEPENDENCY":{columns:["DATABASE_NAME","OBJECT_TYPE","TABLE","OBJECT","EXPRESSION","REFERENCED_OBJECT_TYPE","REFERENCED_TABLE","REFERENCED_OBJECT","REFERENCED_EXPRESSION","QUERY"]},"INFO.CALCULATIONGROUPS":{columns:["ID","TableID","Description","ModifiedTime","Precedence"]},"INFO.CALCULATIONITEMS":{columns:["ID","CalculationGroupID","FormatStringDefinitionID","Name","Description","ModifiedTime","State","ErrorMessage","Expression","Ordinal"]},"INFO.CATALOGS":{columns:["CATALOG_NAME","DESCRIPTION","ROLES","DATE_MODIFIED","COMPATIBILITY_LEVEL","TYPE","VERSION","DATABASE_ID","DATABASE_GUID","DATE_QUERIED","CURRENTLY_USED","POPULARITY","WEIGHTEDPOPULARITY","CLIENTCACHEREFRESHPOLICY","ENCRYPTION_LEVEL"]},"INFO.CHANGEDPROPERTIES":{columns:["ID","ObjectID","ObjectType","Property"]},"INFO.COLUMNPARTITIONSTORAGES":{columns:["ID","ColumnStorageID","PartitionStorageID","DataVersion","State","SegmentStorageID","StorageFileID"]},"INFO.COLUMNPERMISSIONS":{columns:["ID","TablePermissionID","ColumnID","ModifiedTime","MetadataPermission"]},"INFO.COLUMNS":{columns:["ID","TableID","ExplicitName","InferredName","ExplicitDataType","InferredDataType","DataCategory","Description","IsHidden","State","IsUnique","IsKey","IsNullable","Alignment","TableDetailPosition","IsDefaultLabel","IsDefaultImage","SummarizeBy","ColumnStorageID","Type","SourceColumn","ColumnOriginID","Expression","FormatString","IsAvailableInMDX","SortByColumnID","AttributeHierarchyID","ModifiedTime","StructureModifiedTime","RefreshedTime","SystemFlags","KeepUniqueRows","DisplayOrdinal","ErrorMessage","SourceProviderType","DisplayFolder","EncodingHint","RelatedColumnDetailsID","AlternateOfID","LineageTag","SourceLineageTag"]},"INFO.COLUMNSTORAGES":{columns:["ID","ColumnID","Name","StoragePosition","DictionaryStorageID","Settings","ColumnFlags","Collation","OrderByColumn","Locale","BinaryCharacters","Statistics_DistinctStates","Statistics_MinDataID","Statistics_MaxDataID","Statistics_OriginalMinSegmentDataID","Statistics_RLESortOrder","Statistics_RowCount","Statistics_HasNulls","Statistics_RLERuns","Statistics_OthersRLERuns","Statistics_Usage","Statistics_DBType","Statistics_XMType","Statistics_CompressionType","Statistics_CompressionParam","Statistics_EncodingHint","IsDeltaPartitionColumn","DeltaColumnMappingPhysicalName","DeltaColumnMappingId","FramedSourceColumn"]},"INFO.CULTURES":{columns:["ID","ModelID","Name","LinguisticMetadataID","ModifiedTime","StructureModifiedTime"]},"INFO.DATASOURCES":{columns:["ID","ModelID","Name","Description","Type","ConnectionString","ImpersonationMode","Account","Password","MaxConnections","Isolation","Timeout","Provider","ModifiedTime","ConnectionDetails","Options","Credential","ContextExpression"]},"INFO.DELTATABLEMETADATASTORAGES":{columns:["ID","PartitionStorageID","TableName","RootLocation","CurrentVersion","TableObjectID","DatamartObjectID","FramedSchemaName","FallbackReason"]},"INFO.DETAILROWSDEFINITIONS":{columns:["ID","ObjectID","ObjectType","Expression","ModifiedTime","State","ErrorMessage"]},"INFO.DICTIONARYSTORAGES":{columns:["ID","ColumnStorageID","Type","DataType","DataVersion","BaseId","Magnitude","LastId","IsNullable","IsUnique","IsOperatingOn32","DictionaryFlags","StorageFileID","Size"]},"INFO.EXCLUDEDARTIFACTS":{columns:["ID","ObjectID","ObjectType","ArtifactType","Reference"]},"INFO.EXPRESSIONS":{columns:["ID","ModelID","Name","Description","Kind","Expression","ModifiedTime","QueryGroupID","ParameterValuesColumnID","MAttributes","LineageTag","SourceLineageTag"]},"INFO.EXTENDEDPROPERTIES":{columns:["ID","ObjectID","ObjectType","Name","Type","Value","ModifiedTime"]},"INFO.FORMATSTRINGDEFINITIONS":{columns:["ID","ObjectID","ObjectType","Expression","ModifiedTime","State","ErrorMessage"]},"INFO.FUNCTIONS":{columns:["FUNCTION_NAME","DESCRIPTION","PARAMETER_LIST","RETURN_TYPE","ORIGIN","INTERFACE_NAME","LIBRARY_NAME","DLL_NAME","HELP_FILE","HELP_CONTEXT","OBJECT","CAPTION","PARAMETERINFO","DIRECTQUERY_PUSHABLE","VISUAL_CALCULATIONS_INFO"]},"INFO.GENERALSEGMENTMAPSEGMENTMETADATASTORAGES":{columns:["ID","SegmentMapStorageID","RecordCount","Ordinal"]},"INFO.GROUPBYCOLUMNS":{columns:["ID","RelatedColumnDetailsID","GroupingColumnID","ModifiedTime"]},"INFO.HIERARCHIES":{columns:["ID","TableID","Name","Description","IsHidden","State","HierarchyStorageID","ModifiedTime","StructureModifiedTime","RefreshedTime","DisplayFolder","HideMembers","LineageTag","SourceLineageTag"]},"INFO.HIERARCHYSTORAGES":{columns:["ID","HierarchyID","Name","LevelDefinition","MaterializationType","StructureType","SystemTableID"]},"INFO.KPIS":{columns:["ID","MeasureID","Description","TargetDescription","TargetExpression","TargetFormatString","StatusGraphic","StatusDescription","StatusExpression","TrendGraphic","TrendDescription","TrendExpression","ModifiedTime"]},"INFO.LEVELS":{columns:["ID","HierarchyID","Ordinal","Name","Description","ColumnID","ModifiedTime","LineageTag","SourceLineageTag"]},"INFO.LINGUISTICMETADATA":{columns:["ID","CultureID","Content","ModifiedTime","ContentType"]},"INFO.MEASURES":{columns:["ID","TableID","Name","Description","DataType","Expression","FormatString","IsHidden","State","ModifiedTime","StructureModifiedTime","KPIID","IsSimpleMeasure","ErrorMessage","DisplayFolder","DetailRowsDefinitionID","DataCategory","LineageTag","SourceLineageTag"]},"INFO.MODEL":{columns:["ID","Name","Description","StorageLocation","DefaultMode","DefaultDataView","Culture","Collation","ModifiedTime","StructureModifiedTime","Version","DataAccessOptions","DefaultMeasureID","DefaultPowerBIDataSourceVersion","ForceUniqueNames","DiscourageImplicitMeasures","DataSourceVariablesOverrideBehavior","DataSourceDefaultMaxConnections","SourceQueryCulture","MAttributes"]},"INFO.OBJECTTRANSLATIONS":{columns:["ID","CultureID","ObjectID","ObjectType","Property","Value","ModifiedTime"]},"INFO.PARQUETFILESTORAGES":{columns:["ID","DeltaTableMetadataStorageID","Size","Location","CreatedVersion","DeletedVersion","RowgroupCount","Ordinal","ETag","DeletionVectorFileLocation","DeletionVectorBitmapOffset","DeletionVectorBitmapSize","DeletionVectorFileETag"]},"INFO.PARTITIONS":{columns:["ID","TableID","Name","Description","DataSourceID","QueryDefinition","State","Type","PartitionStorageID","Mode","DataView","ModifiedTime","RefreshedTime","SystemFlags","ErrorMessage","RetainDataTillForceCalculate","RangeStart","RangeEnd","RangeGranularity","RefreshBookmark","QueryGroupID","ExpressionSourceID","MAttributes"]},"INFO.PARTITIONSTORAGES":{columns:["ID","PartitionID","Name","StoragePosition","SegmentMapStorageID","DataObjectId","StorageFolderID"]},"INFO.PERSPECTIVECOLUMNS":{columns:["ID","PerspectiveTableID","ColumnID","ModifiedTime"]},"INFO.PERSPECTIVEHIERARCHIES":{columns:["ID","PerspectiveTableID","HierarchyID","ModifiedTime"]},"INFO.PERSPECTIVEMEASURES":{columns:["ID","PerspectiveTableID","MeasureID","ModifiedTime"]},"INFO.PERSPECTIVES":{columns:["ID","ModelID","Name","Description","ModifiedTime"]},"INFO.PERSPECTIVETABLES":{columns:["ID","PerspectiveID","TableID","IncludeAll","ModifiedTime"]},"INFO.PROPERTIES":{columns:["PropertyName","PropertyDescription","PropertyType","PropertyAccessType","IsRequired","Value"]},"INFO.QUERYGROUPS":{columns:["ID","ModelID","Folder","Description"]},"INFO.REFRESHPOLICIES":{columns:["ID","TableID","PolicyType","RollingWindowGranularity","RollingWindowPeriods","IncrementalGranularity","IncrementalPeriods","IncrementalPeriodsOffset","PollingExpression","SourceExpression"]},"INFO.RELATEDCOLUMNDETAILS":{columns:["ID","ColumnID","ModifiedTime"]},"INFO.RELATIONSHIPINDEXSTORAGES":{columns:["ID","RelationshipStorageID","IndexType","Flags","RecordCount","SecondaryRecordCount","StorageFolderID","StorageFileID","SystemTableID","SecondarySystemTableID"]},"INFO.RELATIONSHIPS":{columns:["ID","ModelID","Name","IsActive","Type","CrossFilteringBehavior","JoinOnDateBehavior","RelyOnReferentialIntegrity","FromTableID","FromColumnID","FromCardinality","ToTableID","ToColumnID","ToCardinality","State","RelationshipStorageID","RelationshipStorage2ID","ModifiedTime","RefreshedTime","SecurityFilteringBehavior"]},"INFO.RELATIONSHIPSTORAGES":{columns:["ID","RelationshipID","Name","DefinitionType","Cardinality","Flags","RelationshipIndexStorageID"]},"INFO.ROLEMEMBERSHIPS":{columns:["ID","RoleID","MemberName","MemberID","IdentityProvider","MemberType","ModifiedTime"]},"INFO.ROLES":{columns:["ID","ModelID","Name","Description","ModelPermission","ModifiedTime"]},"INFO.SEGMENTMAPSTORAGES":{columns:["ID","PartitionStorageID","Type","RecordCount","SegmentCount","RecordsPerSegment"]},"INFO.SEGMENTSTORAGES":{columns:["ID","ColumnPartitionStorageID","SegmentCount","StorageFileID"]},"INFO.STORAGEFILES":{columns:["ID","OwnerID","OwnerType","StorageFolderID","FileName"]},"INFO.STORAGEFOLDERS":{columns:["ID","OwnerID","OwnerType","Path"]},"INFO.STORAGETABLECOLUMNS":{columns:["DATABASE_NAME","CUBE_NAME","MEASURE_GROUP_NAME","DIMENSION_NAME","ATTRIBUTE_NAME","TABLE_ID","COLUMN_ID","COLUMN_TYPE","COLUMN_ENCODING","DATATYPE","ISKEY","ISUNIQUE","ISNULLABLE","ISROWNUMBER","DICTIONARY_SIZE","DICTIONARY_ISPAGEABLE","DICTIONARY_ISRESIDENT","DICTIONARY_TEMPERATURE","DICTIONARY_LAST_ACCESSED"]},"INFO.STORAGETABLECOLUMNSEGMENTS":{columns:["DATABASE_NAME","CUBE_NAME","MEASURE_GROUP_NAME","PARTITION_NAME","DIMENSION_NAME","TABLE_ID","COLUMN_ID","SEGMENT_NUMBER","TABLE_PARTITION_NUMBER","RECORDS_COUNT","ALLOCATED_SIZE","USED_SIZE","COMPRESSION_TYPE","BITS_COUNT","BOOKMARK_BITS_COUNT","VERTIPAQ_STATE","ISPAGEABLE","ISRESIDENT","TEMPERATURE","LAST_ACCESSED"]},"INFO.STORAGETABLES":{columns:["DATABASE_NAME","CUBE_NAME","MEASURE_GROUP_NAME","DIMENSION_NAME","TABLE_ID","TABLE_PARTITIONS_COUNT","HINT_TABLE_TYPE","ROWS_COUNT","RIVIOLATION_COUNT"]},"INFO.TABLEPERMISSIONS":{columns:["ID","RoleID","TableID","FilterExpression","ModifiedTime","State","ErrorMessage","MetadataPermission"]},"INFO.TABLES":{columns:["ID","ModelID","Name","DataCategory","Description","IsHidden","TableStorageID","ModifiedTime","StructureModifiedTime","SystemFlags","ShowAsVariationsOnly","IsPrivate","DefaultDetailRowsDefinitionID","AlternateSourcePrecedence","RefreshPolicyID","CalculationGroupID","ExcludeFromModelRefresh","LineageTag","SourceLineageTag"]},"INFO.TABLESTORAGES":{columns:["ID","TableID","Name","Version","Settings","RIViolationCount","StorageFolderID"]},"INFO.VARIATIONS":{columns:["ID","ColumnID","Name","Description","RelationshipID","DefaultHierarchyID","DefaultColumnID","IsDefault"]}},te=function(){function n(e,t){this.inlineVariables=[],this._parameterContexts=[];var r=function(n){return!!n.matchObjects}(e)?e.matchObjects:e;if(this._homeContext=this,this._matchObjects=r,this.inlineVariables=[],this.filterExpressionState=0,this._parameterContexts=[],this._ephemeralContexts=[],!(e instanceof br)){var i=e;this._previousContext=i,this._homeContext=i.homeContext,this._earliestContext=i.earliestContext,this._earlierContext=i.earlierContext,this.currentTable=i.currentTable,this.groupByCurrentTable=i.groupByCurrentTable,this.inlineVariables=this.inlineVariables.concat(i.inlineVariables),this.filterExpressionState=i.filterExpressionState,t&&i.parameterContexts&&(this._parameterContexts=this._parameterContexts.concat(i.parameterContexts))}}return Object.defineProperty(n.prototype,"matchObjects",{get:function(){return this._matchObjects},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"homeContext",{get:function(){return this._homeContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"earlierContext",{get:function(){return this._earlierContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"earliestContext",{get:function(){return this._earliestContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ephemeralContexts",{get:function(){return this._ephemeralContexts},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parameterContexts",{get:function(){return this._parameterContexts},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"variables",{get:function(){return xe.union(this.matchObjects.variables,this.inlineVariables,Cr)},enumerable:!1,configurable:!0}),n.prototype.getTablesInScopeForQualifiedColRefs=function(){return this.getTablesInScopeForQualifiedColRefsEx(void 0,u.None.columnReferenceScope)},n.prototype.getAllTablesInScopeForQualifiedColRefs=function(){return _.union(this.getTablesInScopeForQualifiedColRefs(),_.flatten(_.map(this.ephemeralContexts,function(e){return e.getTablesInScopeForQualifiedColRefs()})))},n.prototype.getSimpleColumnRefsInScope=function(){return this.getSimpleColumnRefsInScopeEx(void 0,u.None.columnReferenceScope)},n.prototype.getAllSimpleColRefsInScope=function(){return this.getSimpleColumnRefsInScope().concat(_.flatten(_.map(this.ephemeralContexts,function(e){return e.getSimpleColumnRefsInScope()})))},n.prototype.getAllTables=function(){var e=this.matchObjects.tables;return this.currentTable&&(e=e.concat(this.currentTable.constructedTables)),e.concat(_.chain(this.ephemeralContexts).filter(function(t){return!!t.currentTable}).map(function(t){return t.currentTable.constructedTables}).flatten().value())},n.prototype.getTablesInScopeForQualifiedColRefsEx=function(e,t){if(e||(e=this.currentTable),t===u.None.columnReferenceScope)switch(this.filterExpressionState){case 1:t=18;break;case 0:case 2:t=3}var r=[];if(P.hasFlag(t,16))r=_.union(r,this.matchObjects.tables);else{if(P.hasFlag(t,1)&&null!=e&&(r=_.union(r,e.immediateTables)),P.hasFlag(t,32)){var i=this.homeContext.currentTable;null!=i&&(r=_.union(r,i.immediateTables))}P.hasFlag(t,4)&&null!=e&&(r=_.union(r,e.relatedTables))}return P.hasFlag(t,2)&&null!=e&&(r=_.union(r,_.filter(e.constructedTables,function(o){return!j.isNullOrEmpty(o.name)}))),r},n.prototype.getSimpleColumnRefsInScopeEx=function(e,t){var r=t;if(e||(e=this.currentTable),t===u.None.columnReferenceScope||64===t)switch(this.filterExpressionState){case 1:case 2:t=18;break;case 0:t=3}var i=[];if(P.hasFlag(t,1)&&null!=e)for(var o=0,a=e.immediateTables;o<a.length;o++)i=i.concat(a[o].columns);if(P.hasFlag(t,32)){var c=this.homeContext.currentTable;if(null!=c)for(var l=0,d=c.immediateTables;l<d.length;l++)i=i.concat(d[l].columns)}if(P.hasFlag(t,8)&&null!=e)for(var p=0,v=e.relatedTables;p<v.length;p++)i=i.concat(v[p].columns);if(P.hasFlag(t,2)&&null!=e)for(var b=0,C=e.constructedTables;b<C.length;b++)i=i.concat(C[b].columns);if(!P.hasFlag(r,64))for(var y=0,O=this.matchObjects.transparentTables;y<O.length;y++)i=i.concat(O[y].columns);return i},n.prototype.isReservedWord=function(e){return n.isReservedWord(e,this.matchObjects.reservedWords,this.matchObjects.functions)},n.isReservedWord=function(e,t,r){return!(!e||!_.has(t,e.toUpperCase())&&!_.find(r,function(i){return j.equalIgnoreCase(i.name,e)}))},n.prototype.newTableScan=function(){for(this._earlierContext=this._previousContext,this._earliestContext=this.earlierContext;null!=this.earliestContext.earlierContext;this._earliestContext=this.earliestContext.earlierContext);},n.prototype.mergeInlineVariables=function(e){_.remove(this.inlineVariables,function(t){return _.some(e,function(r){return j.equalIgnoreCase(r.name,t.name)})}),this.inlineVariables=this.inlineVariables.concat(e)},n}(),ze=function(){function n(e,t,r,i){this.context=e,this._currentTable=t,this._role=r,this._enumValues=i}return Object.defineProperty(n.prototype,"enumValues",{get:function(){return this._enumValues},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"role",{get:function(){return this._role},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"allowedTypes",{get:function(){return this.role.type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentTable",{get:function(){return this._currentTable},enumerable:!1,configurable:!0}),n.prototype.getTablesInScopeForQualifiedColRefs=function(){return this.context.getTablesInScopeForQualifiedColRefsEx(this.currentTable,this.role.columnReferenceScope)},n.prototype.getSimpleColumnRefsInScope=function(){return this.context.getSimpleColumnRefsInScopeEx(this.currentTable,this.role.columnReferenceScope)},n}(),br=function(){function n(e,t,r,i,o,a,s,c){this._tables=e,this._columns=t,this._measures=r,this._calendars=i,this.reservedWords=a,this.transparentTables=s,this.visibleColumnMap={},this.visibleTableMap={},this.definedVarMap={},this.visibleMeasureMap={},this.definedMeasureMap={},this.functionMap={},this.axisMap={},this.calendarMap={},this.unhideAll();for(var l=0,d=o;l<d.length;l++){var p=d[l];this.functionMap[pe.getMatchObjectKey(p.name)]=p}for(var v=0,b=c;v<b.length;v++){var C=b[v];this.axisMap[Pe.getMatchObjectKey(C.name)]=C}for(var y=0,O=this._calendars;y<O.length;y++){var x=O[y];this.calendarMap[x.matchObjectKey]=x}}return Object.defineProperty(n.prototype,"axes",{get:function(){return Object.values(this.axisMap)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tables",{get:function(){return Object.values(this.visibleTableMap)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"columns",{get:function(){return Object.values(this.visibleColumnMap)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functions",{get:function(){return Object.values(this.functionMap)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"measures",{get:function(){return Object.values((0,h.__assign)((0,h.__assign)({},this.definedMeasureMap),this.visibleMeasureMap))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"variables",{get:function(){return Object.values(this.definedVarMap)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"calendars",{get:function(){return Object.values(this.calendarMap)},enumerable:!1,configurable:!0}),n.prototype.hideTable=function(e){delete this.visibleTableMap[e.matchObjectKey];for(var t=0,r=Object.entries(this.visibleColumnMap);t<r.length;t++){var i=r[t],o=i[0];i[1].table===e&&delete this.visibleColumnMap[o]}for(var s=0,c=Object.entries(this.visibleMeasureMap);s<c.length;s++){var l=c[s];o=l[0],l[1].table===e&&delete this.visibleMeasureMap[o]}},n.prototype.hideColumn=function(e){delete this.visibleColumnMap[e.matchObjectKey]},n.prototype.hideMeasure=function(e){delete this.visibleMeasureMap[e.matchObjectKey]},n.prototype.unhideAll=function(){for(var e=0,t=this._tables;e<t.length;e++){var r=t[e];this.visibleTableMap[r.matchObjectKey]=r}for(var i=0,o=this._columns;i<o.length;i++){var a=o[i];this.visibleColumnMap[a.matchObjectKey]=a}for(var s=0,c=this._measures;s<c.length;s++){var l=c[s];this.visibleMeasureMap[l.matchObjectKey]=l}for(var d=0,p=this._tables;d<p.length;d++)p[d].unhideAll()},n.prototype.clearDefinedMeasures=function(){this.definedMeasureMap={};for(var e=0,t=this.tables;e<t.length;e++)t[e].clearDefinedMeasures()},n.prototype.clearDefinedVariables=function(){this.definedVarMap={}},n.prototype.chooseFunctions=function(e){for(var t=0,r=Object.entries(this.functionMap);t<r.length;t++){var i=r[t],o=i[0];e(i[1])||delete this.functionMap[o]}},n.prototype.mergeMeasures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.definedMeasureMap[i.matchObjectKey]||(this.definedMeasureMap[i.matchObjectKey]=i)}},n.prototype.removeDefinedMeasure=function(e,t){var r=Xt.getMatchObjectKey(t,e);delete this.definedMeasureMap[r]},n.prototype.mergeVariables=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.definedVarMap[i.matchObjectKey]||(this.definedVarMap[i.matchObjectKey]=i)}},n.prototype.removeDefinedVariable=function(e){var t=Me.getMatchObjectKey(e,!0);delete this.definedVarMap[t]},n.prototype.findAxis=function(e){return this.axisMap[Pe.getMatchObjectKey(e)]},n.prototype.findTable=function(e){return this.visibleTableMap[de.getMatchObjectKey(e)]},n.prototype.findFunction=function(e){return this.functionMap[pe.getMatchObjectKey(e)]},n.prototype.findVariable=function(e){var t=Me.getMatchObjectKey(e,!0);return this.definedVarMap[t]},n.prototype.findCalendar=function(e){return this.calendarMap[gt.getMatchObjectKey(e)]},n}(),Ge=function(){function n(e,t){this._name=e,this._description=t}return Object.defineProperty(n.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),n.prototype.toString=function(){return this.name},n.prototype.getHashCode=function(){return this.name},n}(),nt=function(){return function(){this.constructedTables=[],this.immediateTables=[],this.relatedTables=[]}}(),Ke=function(n){function e(t){return n.call(this,t,void 0)||this}return(0,h.__extends)(e,n),e}(Ge),Pe=function(n){function e(t){var r=n.call(this,t,void 0)||this;return r.matchObjectKey=e.getMatchObjectKey(t),r}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t){return t.toLowerCase()},Object.defineProperty(e.prototype,"description",{get:function(){return"rows"===this.name.toLowerCase()?L.localizedStrings.rowsDescription:"columns"===this.name.toLowerCase()?L.localizedStrings.columnsDescription:"rows columns"===this.name.toLowerCase()?L.localizedStrings.rowsColumnsDescription:"columns rows"===this.name.toLowerCase()?L.localizedStrings.columnsRowsDescription:""},enumerable:!1,configurable:!0}),e}(Ge),gt=function(n){function e(t,r){var i=n.call(this,t,void 0)||this;return i._table=r,i.matchObjectKey=e.getMatchObjectKey(t),i}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t){return t.toLowerCase()},Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e}(Ge),Me=function(n){function e(t,r,i){void 0===i&&(i=!1);var o=n.call(this,t,void 0)||this;return o.variableNode=r,o._isQueryScoped=i,o.matchObjectKey=e.getMatchObjectKey(t,i),o}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t,r){return"".concat(t.toLowerCase(),":").concat(r)},Object.defineProperty(e.prototype,"value",{get:function(){return this.variableNode&&this.variableNode.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isQueryScoped",{get:function(){return this._isQueryScoped},enumerable:!1,configurable:!0}),e}(Ge);function Cr(n,e){return n===e||j.equalIgnoreCase(n.name,e.name)}function to(n,e){return n===e||j.equalIgnoreCase(n.name,e.name)}var de=function(n){function e(t,r,i,o,a,s){void 0===o&&(o=t),void 0===a&&(a=!1),void 0===s&&(s=!0);var c=n.call(this,t,r)||this;return c.visibleColumnMap={},c.visibleMeasureMap={},c.definedMeasureMap={},c._uberTable=new nt,c._uberTable.immediateTables.push(c),c._quoteNeeded=i,c._tableId=o,c._columnMap={},c._measureMap={},c._calendarMap={},c._isTransparent=a,c._isUserTable=s,c.matchObjectKey=e.getMatchObjectKey(t),c.unhideAll(),c}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t){return t.toLowerCase()},Object.defineProperty(e.prototype,"isTransparent",{get:function(){return this._isTransparent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quoteNeeded",{get:function(){return this._quoteNeeded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uberTable",{get:function(){return this._uberTable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableId",{get:function(){return this._tableId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this.visibleColumns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"measures",{get:function(){return Object.values((0,h.__assign)((0,h.__assign)({},this.definedMeasureMap),this.visibleMeasureMap))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"calendars",{get:function(){return Object.values((0,h.__assign)({},this._calendarMap))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUserTable",{get:function(){return this._isUserTable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibleColumns",{get:function(){return Object.values(this.visibleColumnMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibleMeasures",{get:function(){return Object.values(this.visibleMeasureMap)},enumerable:!1,configurable:!0}),e.prototype.addColumn=function(t){this._columnMap[t.matchObjectKey]=t,this.visibleColumnMap[t.matchObjectKey]=t},e.prototype.addMeasure=function(t){this._measureMap[t.matchObjectKey]=t,this.visibleMeasureMap[t.matchObjectKey]=t},e.prototype.addCalendar=function(t){this._calendarMap[t.matchObjectKey]=t},e.prototype.hideColumn=function(t){delete this.visibleColumnMap[t.matchObjectKey]},e.prototype.hideMeasure=function(t){delete this.visibleMeasureMap[t.matchObjectKey]},e.prototype.unhideAll=function(){this.visibleColumnMap=(0,h.__assign)({},this._columnMap),this.visibleMeasureMap=(0,h.__assign)({},this._measureMap)},e.prototype.getAutoCompleteName=function(t){return t||this.quoteNeeded?D.quote(this.name):this.name},e.prototype.clearDefinedMeasures=function(){this.definedMeasureMap={}},e.prototype.mergeDefinedMeasure=function(t){V(t.isQueryScoped,"Should only be merging defined measures"),this.definedMeasureMap[t.matchObjectKey]||(this.definedMeasureMap[t.matchObjectKey]=t)},e.prototype.removeDefinedMeasure=function(t){var r=Xt.getMatchObjectKey(this.name,t);delete this.definedMeasureMap[r]},e.prototype.findColumn=function(t){var r=ue.getMatchObjectKey(this.name,t);return this.visibleColumnMap[r]},e.prototype.findMeasure=function(t){var r=Xt.getMatchObjectKey(this.name,t),i=ye.getMatchObjectKey(this.name,t);return this.definedMeasureMap[r]||this.visibleMeasureMap[i]},e}(Ge),ue=function(n){function e(t,r,i){var o=n.call(this,t,r)||this;return o._table=i,o.matchObjectKey=e.getMatchObjectKey(i.name,t),o}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t,r){return"".concat(t.toLowerCase(),":").concat(r.toLowerCase())},Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e}(Ge),rt=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),e}(Ge),Cn=function(){function n(e,t,r,i,o,a,s,c){this._name=e,this._type=t,this._repeatable=r,this._optional=i,this._repeatGroup=r?o:-1,this._role=a,this._skippable=s,this._enumValues=c}return Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"optional",{get:function(){return this._optional},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"repeatable",{get:function(){return this._repeatable},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"repeatGroup",{get:function(){return this._repeatGroup},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"role",{get:function(){return this._role},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"skippable",{get:function(){return this._skippable},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"enumValues",{get:function(){return this._enumValues},enumerable:!1,configurable:!0}),n.prototype.getNameForPrototype=function(e){void 0===e&&(e=0);var t=this.optional,r=this.name;return this.repeatable&&(r+=e,e>1&&(t=!0)),t&&(r="[".concat(r,"]")),r},n}(),wt=function(n){function e(t,r,i,o,a){void 0===a&&(a=[]);var s=n.call(this,t,r)||this;return s._returnType=i,s._role=o,s._signatures=a,s}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"role",{get:function(){return this._role},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"signatures",{get:function(){return this._signatures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"returnType",{get:function(){return this._returnType},enumerable:!1,configurable:!0}),e.prototype.getParamCount=function(t){return t?t.getParameterCount():0},e.prototype.getTableReturnValue=function(t,r){var i;switch(this.role){case 2:case 8194:if(r){i=new nt;for(var o=this.getParamCount(r),a=0,s=this.signatures;a<s.length;a++)new oo(t,s[a],r,o,i).iterate()}break;case 4:case 4096:case 12:case 16384:V(!!vr[this.name],"Function ".concat(this.name," does not have a schema defined.")),i=new nt;var l=new de("",void 0,!1);vr[this.name].columns.forEach(function(d){l.addColumn(new ue(d,void 0,l))}),i.immediateTables.push(l);break;case 8:i=t.groupByCurrentTable}return i},e.prototype.getContextForParam=function(t,r,i){for(var o,a=this.signatures.map(function(q){return new ro(t,q,r,i)}),c=qt.getAllExploredStates(a).completedStates.filter(function(q){return q.prototypeParam<q.prototypeSignature.length}),l=new te(t,!1),d=r.getParameter(i),p=!1,v=!1,b=0,C=c;b<C.length;b++){var x=(y=C[b]).prototypeSignature[y.prototypeParam],g=x.role,S=pt.getTypes(g,t),T=!0;if(S!==u.None.type&&(d.couldBeType({type:S})||(T=!1,p=!0)),T){y.paramContext.prototypeParam=y.prototypeParam,y.paramContext.skippedParameters=y.skippedParameters,l.parameterContexts.push(y.paramContext);var I=void 0,w=g.argumentContextAction;if(3===w||1===w||2===w){var A=l.currentTable,F=l.currentTable;(2===w||3===w)&&y.extractedColumns.length>0?((F=new nt).constructedTables=F.constructedTables.concat(y.extractedColumns),null!=A&&(F.immediateTables=F.immediateTables.concat(A.immediateTables),F.relatedTables=F.relatedTables.concat(A.relatedTables),F.constructedTables=F.constructedTables.concat(A.constructedTables))):(1===w||3===w)&&null!=y.extractedTable&&(A?((F=new nt).immediateTables=F.immediateTables.concat(A.immediateTables.concat(y.extractedTable.immediateTables)),F.relatedTables=F.relatedTables.concat(A.relatedTables.concat(y.extractedTable.relatedTables)),F.constructedTables=F.constructedTables.concat(A.constructedTables.concat(y.extractedTable.constructedTables))):F=y.extractedTable),F!==A&&(l.currentTable=F,l.newTableScan())}else 4===w?I=y.extractedTable:5===w?l.currentTable=void 0:6===w?l.currentTable=l.earlierContext?l.earlierContext.currentTable:void 0:7===w&&(l.currentTable=l.earliestContext?l.earliestContext.currentTable:void 0);if(P.hasFlag(g.additionalBehaviors,1)&&(l.groupByCurrentTable=y.extractedTable),P.hasFlag(g.additionalBehaviors,2)?l.filterExpressionState=1:!_.isEqual(g,u.None)&&!P.hasFlag(g.type,1)&&(l.filterExpressionState=0),P.hasFlag(g.additionalBehaviors,4)&&(o=l.ephemeralContexts).push.apply(o,_.chain(t.ephemeralContexts).filter(function(q){return!!(24&q.allowedTypes)}).map(function(q){return new ze(l,q.currentTable,(0,h.__assign)((0,h.__assign)({},q.role),{type:24}),q.enumValues)}).value()),S!==u.None.type){var B=pt.transformRole(g,t);l.ephemeralContexts.push(new ze(l,I,B,P.hasFlag(B.type,64)?x.enumValues:void 0))}else v=!0}}if(0===l.parameterContexts.length)for(var W=0,J=c;W<J.length;W++){var y;(y=J[W]).paramContext.prototypeParam=y.prototypeParam,l.parameterContexts.push(y.paramContext)}return p&&0===l.ephemeralContexts.length&&l.ephemeralContexts.push(new ze(l,void 0,ce.featureSwitches.useSkippableParams&&!v?u.InvalidParam:u.None,void 0)),l},e.prototype.getDefaultPrototype=function(){for(var r="",i=0,o=this.getPrototype(void 0);i<o.length;i++){var a=o[i];r+=a.text+a.separator}return r},e.prototype.getPrototype=function(t){var r=[];r.push({text:this.name+"(",separator:"",bold:!1});for(var o=t?t.prototypeSignature:this.signatures[0],a=t?t.prototypeParam:-1,s=o.length,c=0,l=0;l<s;){var d=o[l];if(d.repeatable){var p=void 0;for(p=l+1;p<s&&((v=o[p]).repeatable&&v.repeatGroup===d.repeatGroup);p++);var b=0;t&&c<t.repeatCounts.length&&(b=t.repeatCounts[c]),c++;var C=a<p;if(C&&b++,b>0){if(b>1){for(var y=l;y<p;y++){var v=o[y];Yt(t?.skippedParameters,y,0)||r.push({text:v.getNameForPrototype(1)+Be().listSeparator,separator:" ",bold:!1})}b>2&&r.push({text:"..."+Be().listSeparator,separator:" ",bold:!1})}for(;l<p;l++)d=o[l],!Yt(t?.skippedParameters,l,b-1)&&r.push({text:d.getNameForPrototype(b)+Be().listSeparator,separator:" ",bold:l===a});C&&r.push({text:"..."+Be().listSeparator,separator:" ",bold:!1})}else l=p}else Yt(t?.skippedParameters,l,0)||r.push({text:d.getNameForPrototype()+Be().listSeparator,separator:" ",bold:l===a}),l++}if(r.length>1){var O=_.last(r);r[r.length-1]={text:O.text.substr(0,O.text.length-Be().listSeparator.length),separator:"",bold:O.bold}}return r.push({text:")",separator:"",bold:!1}),r},e}(Ge),no=function(){function n(){this.success=!1,this.badParam=-1,this.firstExtraParam=-1,this.incomplete=!1,this.associatedSignature=[]}return n.prototype.assessStatus=function(e,t,r,i){if(e<t)r<i.length?(this.badParam=Math.max(this.badParam,e),this.associatedSignature=i):this.firstExtraParam=Math.max(this.firstExtraParam,e);else{for(;r<i.length&&i[r].optional;r++);r<i.length?this.incomplete=!0:this.success=!0}},n.prototype.markSuccess=function(){this.success=!0},n}(),yr=function(){function n(e,t){this.paramNumber=e,this.repeatCount=t}return n.prototype.equals=function(e){return!(this.paramNumber!==e.paramNumber||this.repeatCount!==e.repeatCount)},n}();function Yt(n,e,t){return!(!ce.featureSwitches.useSkippableParams||!n?.find(function(r){return r.equals(new yr(e,t))}))}var Sn,Le,yn=function(){function n(e){this.prototypeSignature=[],this.prototypeParam=e?e.prototypeParam:0,this.skippedParameters=e?_.toArray(e.skippedParameters):[],this._repeatCounts=e?_.toArray(e.repeatCounts):[]}return Object.defineProperty(n.prototype,"repeatCounts",{get:function(){return this._repeatCounts},enumerable:!1,configurable:!0}),n.prototype.equals=function(e){if(this.prototypeParam!==e.prototypeParam||this.repeatCounts.length!==e.repeatCounts.length)return!1;for(var t=0;t<this.repeatCounts.length;t++)if(this.repeatCounts[t]!==e.repeatCounts[t])return!1;if(ce.featureSwitches.useSkippableParams){if(this.skippedParameters.length!==e.skippedParameters.length)return!1;for(t=0;t<this.skippedParameters.length;t++)if(!this.skippedParameters[t].equals(e.skippedParameters[t]))return!1}return!0},n}(),pe=function(n){function e(t,r,i,o,a,s,c){var l=n.call(this,t,r,a,s,c)||this;return l._category=i,l._pushableToDirectQuery=o,l.matchObjectKey=e.getMatchObjectKey(t),l}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t){return t.toLowerCase()},Object.defineProperty(e.prototype,"pushableToDirectQuery",{get:function(){return this._pushableToDirectQuery},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"category",{get:function(){return this._category},enumerable:!1,configurable:!0}),e.FUNCTIONS_SPECIAL_CALCULATE_FUNCTION_NAME="CALCULATE",e}(wt),ye=function(n){function e(t,r,i,o,a){void 0===a&&(a=!1);var s=n.call(this,t,r,o.returnType,o.role,e.removeFirstParam(o.signatures))||this;return s._table=i,s._isQueryScoped=a,s.matchObjectKey=e.getMatchObjectKey(i.name,t),s}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t,r){return"".concat(t.toLowerCase(),":").concat(r.toLowerCase())},Object.defineProperty(e.prototype,"isQueryScoped",{get:function(){return this._isQueryScoped},enumerable:!1,configurable:!0}),e.removeFirstParam=function(t){Y(1===t.length,"Expected exactly one parameter prototype");var r=_.toArray(t[0]);return r.shift(),[r]},Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e}(wt),Xt=function(n){function e(t,r,i,o,a){var s=n.call(this,t,r,i,o,!0)||this;return s._measureExpressionNode=a,s.matchObjectKey=e.getMatchObjectKey(i.name,t),s}return(0,h.__extends)(e,n),e.getMatchObjectKey=function(t,r){return"".concat(t.toLowerCase(),":").concat(r.toLowerCase())},Object.defineProperty(e.prototype,"measureExpressionNode",{get:function(){return this._measureExpressionNode},enumerable:!1,configurable:!0}),e}(ye),En=function(){function n(e,t){this.leadingTrivia=[],this.trailingTrivia=[],this._parent=e,this.cachedContext=t}return Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fullSpan",{get:function(){return tt.fromTokens(this.firstDescendent.token,this.lastDescendent.token)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tableValue",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tableRef",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"qualifiedColumnRef",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"filterColumnRef",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"simpleColumnRef",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isDataTable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"string",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tupleCardinality",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"axesRef",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isValidAxisValue",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isValidEnumValue",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"calendarRef",{get:function(){},enumerable:!1,configurable:!0}),n.prototype.getRolledUpColumns=function(e){},n.prototype.getChildFunctionName=function(){},n.prototype.couldBeType=function(e){return!1},Object.defineProperty(n.prototype,"context",{get:function(){return(!this.cachedContext||et.alwaysRebuildContext)&&this.parent&&(this.cachedContext=this.parent.getContextForChild(this)),this.cachedContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"segment",{get:function(){return tt.fromTokens(this.firstDescendent.token,this.lastDescendent.token)},enumerable:!1,configurable:!0}),n.prototype.onParseComplete=function(){},n.prototype.onParseIncomplete=function(){},Object.defineProperty(n.prototype,"selfDescription",{get:function(){if(et.debugging){var t=this.constructor.name.toString();return _.endsWith(t,"Node")&&(t=t.substr(0,t.length-4)),t}},enumerable:!1,configurable:!0}),n.prototype.clearContext=function(){this.cachedContext=void 0},n.prototype.printSelf=function(e){},n.prototype.printSelfAndChildren=function(e){et.debugging&&(this.printSelf(e),this.printChildren(e+2))},n.prototype.printChildren=function(e){},n}(),mt=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableValue",{get:function(){return this.getFromOnlyChild(function(r){return r.tableValue})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableRef",{get:function(){return this.getFromOnlyChild(function(r){return r.tableRef})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"qualifiedColumnRef",{get:function(){return this.getFromOnlyChild(function(r){return r.qualifiedColumnRef})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"simpleColumnRef",{get:function(){return this.getFromOnlyChild(function(r){return r.simpleColumnRef})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"string",{get:function(){return this.getFromOnlyChild(function(r){return r.string})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDataTable",{get:function(){return this.getFromOnlyChild(function(r){return r.isDataTable})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tupleCardinality",{get:function(){return this.getFromOnlyChild(function(r){return r.tupleCardinality})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"axesRef",{get:function(){return this.getFromOnlyChild(function(r){return r.axesRef})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isValidAxisValue",{get:function(){return this.getFromOnlyChild(function(r){return r.isValidAxisValue})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isValidEnumValue",{get:function(){return this.getFromOnlyChild(function(r){return r.isValidEnumValue})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"calendarRef",{get:function(){return this.getFromOnlyChild(function(r){return r.calendarRef})},enumerable:!1,configurable:!0}),e.prototype.getRolledUpColumns=function(t){return this.getFromOnlyChild(function(r){return r.getRolledUpColumns(t)})},e.prototype.getChildFunctionName=function(){return this.getFromOnlyChild(function(t){return t.getChildFunctionName()})},e.prototype.couldBeType=function(t){return this.getFromOnlyChild(function(r){return r.couldBeType(t)})},e}(En),k=function(n){function e(t,r,i){var o=n.call(this,t,i)||this;return o.types=_.isArray(r)?r:[r],o}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"leafPosition",{get:function(){return this._leafPosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"token",{get:function(){return this._leafPosition.token},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstDescendent",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastDescendent",{get:function(){return this},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"valid",{get:function(){return!this.path||this.path.isValid},enumerable:!1,configurable:!0}),e.prototype.eatToken=function(t,r){if(this.leafPosition)return ee.NotHungry;for(var i=t.token,o=!1,a=0,s=this.types;a<s.length;a++)if(i.matchesType(s[a])){o=!0;break}return o||this.otherwiseMatchesToken(i)?(this._path=new pr(r),this._leafPosition=t,this._leafPosition.addNode(this),ee.Yum):ee.Yuck},Object.defineProperty(e.prototype,"isValidEnumValue",{get:function(){var r=this,i=_.flatMap(this.context.ephemeralContexts,function(o){return o.enumValues}).filter(function(o){return!!o});return!_.isEmpty(i)&&_.some(i,function(o){return j.equalIgnoreCase(o.name,r.token.getString())})},enumerable:!1,configurable:!0}),e.prototype.consolidatePath=function(){this._path=this.path.consolidatePath()},e.prototype.otherwiseMatchesToken=function(t){return!1},e}(En),Tn=function(){function n(e){this._nodes=[],this._token=e}return Object.defineProperty(n.prototype,"nodes",{get:function(){return this._nodes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"validNodes",{get:function(){return _.filter(this.nodes,function(t){return t.valid})},enumerable:!1,configurable:!0}),n.prototype.addNode=function(e){this.nodes.push(e)},n.prototype.rebindToken=function(e){this._token=e},Object.defineProperty(n.prototype,"isInParseTree",{get:function(){return _.some(this.nodes,function(t){return t.parent})},enumerable:!1,configurable:!0}),n}(),$t=function(){function n(e,t,r,i,o){this.parentContext=e,this._prototypeSignature=t,this._actualParameters=r,this._actualParamMax=i,this._useMismatchedState=o,this._useMismatchedState=o,this._completedStates=[],this._incompleteStates=[]}return Object.defineProperty(n.prototype,"completedStates",{get:function(){return this._completedStates},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"incompleteStates",{get:function(){return this._incompleteStates},enumerable:!1,configurable:!0}),n.prototype.iterate=function(){var e=[],t=[];for(e.push(this.newIteration());;){var r=void 0;if(e.length>0)r=e.shift();else if(this._useMismatchedState&&0===this.completedStates.length){for(var i=void 0,o=!1,a=0,s=t;a<s.length;a++){var c=s[a];!i||c.actualParam>i.actualParam?(i=c,o=!1):c.actualParam===i.actualParam&&(o=!0)}t.length=0,i&&!o&&(r=i).advanceParameter()}if(!r)break;r.iterate(e,t)?this.completedStates.push(r):this.incompleteStates.push(r)}},n.prototype.newIteration=function(){return new On(this)},n}(),On=function(){function n(e){this._actualParam=0,this._prototypeParam=0,this._skippedParameters=[],this._prototypeSignature=[],this.repeatStart=-1,this._repeated=!1,this.repeatGroup=-1,this.repeatCount=0,e instanceof n?(this.paramIter=e.paramIter,this._actualParam=e.actualParam,this._prototypeParam=e.prototypeParam,this._skippedParameters=e.skippedParameters?_.toArray(e.skippedParameters):[],this._prototypeSignature=e._prototypeSignature,this.repeatStart=e.repeatStart,this._repeated=e.repeated,this.repeatGroup=e.repeatGroup,this.repeatCount=e.repeatCount):(this.paramIter=e,this._prototypeSignature=e._prototypeSignature)}return Object.defineProperty(n.prototype,"actualParam",{get:function(){return this._actualParam},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"prototypeParam",{get:function(){return this._prototypeParam},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"skippedParameters",{get:function(){return this._skippedParameters},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"prototypeSignature",{get:function(){return this._prototypeSignature},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"repeated",{get:function(){return this._repeated},enumerable:!1,configurable:!0}),n.prototype.advanceParameter=function(){this._prototypeParam++,this._actualParam++},n.prototype.skipCurrentParameter=function(){this._skippedParameters.push(new yr(this.prototypeParam,this.repeatCount)),this._prototypeParam++},n.prototype.iterate=function(e,t){for(var i,o,a,r=this;;){if(this.repeatStart>-1&&(this.prototypeParam>=this.paramIter._prototypeSignature.length||this.paramIter._prototypeSignature[this.prototypeParam].repeatGroup!==this.repeatGroup)){if(this.repeat(),ce.featureSwitches.useSkippableParams){if(this.skippedParameters.filter(function(He){return He.repeatCount===r.repeatCount}).length===this.paramIter._prototypeSignature.filter(function(He){return He.repeatGroup===r.repeatGroup}).length)return!1;this.repeatCount++}var s=this.clone();s.repeatStart=-1,s._repeated=!1,s.repeatCount=0,e.push(s),this._repeated=!0,this._prototypeParam=this.repeatStart}if(this.prototypeParam>=this.paramIter._prototypeSignature.length)return this.actualParam===this.paramIter._actualParamMax;var c=this.paramIter._prototypeSignature[this.prototypeParam],l=c.role,d=pt.getTypes(l,this.paramIter.parentContext);if(-1===this.repeatStart){if(c.optional&&c.repeatable){var p;for((p=this.clone())._prototypeParam++;p.prototypeParam<this.paramIter._prototypeSignature.length&&this.paramIter._prototypeSignature[p.prototypeParam].repeatGroup===c.repeatGroup;)p._prototypeParam++;p.newRepeatGroup(),e.push(p)}c.repeatable&&(this.repeatStart=this.prototypeParam,this.repeatGroup=c.repeatGroup,this.newRepeatGroup())}if(ce.featureSwitches.useSkippableParams&&c.skippable&&((p=this.clone()).skipCurrentParameter(),e.push(p)),this.actualParam===this.paramIter._actualParamMax)return!0;var v=!1,b=this.paramIter._actualParameters.getParameter(this.actualParam);if(null==b)v=c.optional;else{var C=void 0;if(!v&&P.hasFlag(d,2)){var y=b.getTableValue();(v=null!=y)&&(this.handleTableValue(l,y),C=2)}if(!v&&P.hasFlag(d,4)){var O=b.getTableRef();(v=null!=O)&&(this.handleTableRef(l,O),C=4)}var x=!1,g=void 0,S=void 0,T=void 0;if(this.prototypeParam>0&&(g=Yt(this.skippedParameters,this.prototypeParam-1,this.repeatCount),T=pt.getTypes((S=this.paramIter._prototypeSignature[this.prototypeParam-1]).role,this.paramIter.parentContext),g&&P.hasFlag(T,32)&&(d=24,x=!0)),!v&&P.hasFlag(d,8)){var I=b.getQualifiedColumnRef();(v=!!I)&&(x&&this.handleNewCol(S.role,I.table.name,I.name,I.table.quoteNeeded),this.handleQualifiedColRef(l,I),C=8)}if(!v&&P.hasFlag(d,16)){var w=b.getSimpleColumnRef();(v=null!=w)&&(x&&this.handleNewCol(S.role,w.table.name,w.name,w.table.quoteNeeded),this.handleSimpleColRef(l,w),C=16)}if(!v&&P.hasFlag(d,32)){var A=b.getString();if(v=!!A){var F=void 0,B={table:void 0,column:void 0};fr.tryParseColumnReference(A,B)?F=D.quoteNeeded(B.table,this.paramIter.parentContext):(B.column=A,B.table="",F=!1),this.handleNewCol(l,B.table,B.column,F),C=32}}if(!v&&P.hasFlag(d,2048)&&(v=null!=b.getString(),C=2048),!v&&1920&d){var W=b.getRolledUpColumns({type:d});if(v=null!=W)for(var J=0,q=W;J<q.length;J++)this.handleSimpleColRef(l,q[J]);C=1920&d}!v&&P.hasFlag(d,16384)&&(v="ORDERBY"===(null===(i=b.getChildFunctionName())||void 0===i?void 0:i.toUpperCase()))&&(C=16384),!v&&P.hasFlag(d,32768)&&(v="PARTITIONBY"===(null===(o=b.getChildFunctionName())||void 0===o?void 0:o.toUpperCase()))&&(C=32768),!v&&P.hasFlag(d,524288)&&(v=b.hasValidAxisValue())&&(C=524288),!v&&P.hasFlag(d,65536)&&(v=b.hasValidAxisRef())&&(C=65536),!v&&P.hasFlag(d,131072)&&(v="MATCHBY"===(null===(a=b.getChildFunctionName())||void 0===a?void 0:a.toUpperCase()))&&(C=131072),b.isDataTable?!v&&P.hasFlag(d,4096)&&(v=!0,C=4096):(!v&&P.hasFlag(d,64)&&(v=b.hasValidEnumValue())&&(C=64),!v&&P.hasFlag(d,1)&&(v=!0,C=1),!v&&P.hasFlag(d,1048576)&&(v=null!=b.getCalendarRef())&&(C=1048576),d===u.None.type&&(v=!0)),v&&b.storeMatchedType({type:C})}if(!v)return this.paramIter._useMismatchedState&&t.push(this),!1;this.advanceParameter()}},n.prototype.repeat=function(){},n.prototype.newRepeatGroup=function(){},n.prototype.clone=function(){return new n(this)},n.prototype.handleTableValue=function(e,t){},n.prototype.handleTableRef=function(e,t){},n.prototype.handleQualifiedColRef=function(e,t){},n.prototype.handleSimpleColRef=function(e,t){},n.prototype.handleNewCol=function(e,t,r,i){},n}(),ro=function(n){function e(t,r,i,o){return n.call(this,t,r,i,o,!0)||this}return(0,h.__extends)(e,n),e.prototype.newIteration=function(){return new io(this)},e}($t),io=function(n){function e(t){var r=this;return t instanceof $t?((r=n.call(this,t)||this)._paramContext=new yn,r._extractedColumns=[]):((r=n.call(this,t)||this)._paramContext=new yn(t.paramContext),r._extractedTable=t.extractedTable,r._extractedColumns=t.extractedColumns.slice()),r._paramContext.prototypeSignature=r.prototypeSignature,r}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"extractedColumns",{get:function(){return this._extractedColumns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paramContext",{get:function(){return this._paramContext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extractedTable",{get:function(){return this._extractedTable},enumerable:!1,configurable:!0}),e.prototype.repeat=function(){this.paramContext.repeatCounts[this.paramContext.repeatCounts.length-1]++},e.prototype.newRepeatGroup=function(){this.paramContext.repeatCounts.push(0)},e.prototype.clone=function(){return new e(this)},e.prototype.handleTableValue=function(t,r){this.checkExtractTable(t,r)},e.prototype.handleTableRef=function(t,r){this.checkExtractTable(t,r)},e.prototype.handleQualifiedColRef=function(t,r){this.checkExtractTable(t,r.table.uberTable),this.checkExtractColumn(t,function(){return vt.isolatedClone(r)})},e.prototype.handleSimpleColRef=function(t,r){this.checkExtractColumn(t,function(){return vt.isolatedClone(r)})},e.prototype.handleNewCol=function(t,r,i,o){this.checkExtractColumn(t,function(){return vt.buildIsolatedColumn(i,r,o)})},e.prototype.checkExtractTable=function(t,r){P.hasFlag(t.argumentAction,4)&&(this._extractedTable=r)},e.prototype.checkExtractColumn=function(t,r){P.hasFlag(t.argumentAction,8)&&this._extractedColumns.push(r().table)},e}(On),oo=function(n){function e(t,r,i,o,a){var s=n.call(this,t,r,i,o,!1)||this;return s.resultTable=a,s}return(0,h.__extends)(e,n),e.prototype.newIteration=function(){return new ao(this,this.resultTable)},e}($t),ao=function(n){function e(t,r){var i=this;return(i=n.call(this,t)||this)._resultTable=t instanceof e?t.resultTable:r,i}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"resultTable",{get:function(){return this._resultTable},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e(this)},e.prototype.handleTableValue=function(t,r){this.checkAddUberTableToResult(t,r)},e.prototype.handleTableRef=function(t,r){this.checkAddUberTableToResult(t,r)},e.prototype.handleQualifiedColRef=function(t,r){this.checkAddConstructedTableToResult(t,function(){return vt.isolatedClone(r)})},e.prototype.handleSimpleColRef=function(t,r){this.checkAddConstructedTableToResult(t,function(){return vt.isolatedClone(r)})},e.prototype.handleNewCol=function(t,r,i,o){this.checkAddConstructedTableToResult(t,function(){return vt.buildIsolatedColumn(i,r,o)})},e.prototype.checkAddUberTableToResult=function(t,r){P.hasFlag(t.argumentAction,1)&&(!P.hasFlag(t.argumentAction,2)||!this.repeated)&&(this.resultTable.immediateTables=this.resultTable.immediateTables.concat(r.immediateTables),this.resultTable.relatedTables=this.resultTable.relatedTables.concat(r.relatedTables),this.resultTable.constructedTables=this.resultTable.constructedTables.concat(r.constructedTables))},e.prototype.checkAddConstructedTableToResult=function(t,r){P.hasFlag(t.argumentAction,1)&&(!P.hasFlag(t.argumentAction,2)||!this.repeated)&&this.resultTable.constructedTables.push(r().table)},e}(On),vt=function(){function n(){}return n.buildIsolatedColumn=function(e,t,r){var i=new de(t,void 0,r),o=new ue(e,void 0,i);return i.addColumn(o),o},n.isolatedClone=function(e){var t=this.isolatedCloneCore(e);if(e.table.variationSource){var r=this.isolatedCloneCore(e.table.variationSource);t.table.variationSource=r,r.variationTable=t.table}return t},n.isolatedCloneCore=function(e){return this.buildIsolatedColumn(e.name,e.table.name,e.table.quoteNeeded)},n}();!function(n){n.buildAnonymousExpression=function(r,i,o){return new t(r,i,o).buildAnonymousExpression()};var t=function(){function r(i,o,a){this.tokenization=i,this.context=o,this.delimitIdentifier=a,this.matchObjectReplacements=new ht,this.unmatchedObjectReplacements={},this.tableIndex=0,this.columnIndex=0,this.measureIndex=0,this.variableIndex=0,this.unmatchedIndex=0}return r.prototype.buildAnonymousExpression=function(){for(var i="",o=0,a=this.tokenization.tokens;o<a.length;o++){var s=a[o],c=void 0;switch(s.type){case 29:case 2:case 3:case 4:case 5:case 6:case 7:c=" ";break;case 10:case 11:case 12:case 13:case 14:case 9:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 40:c=s.getString();break;case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 51:case 52:case 53:case 54:case 49:case 50:case 55:c=s.getString().toUpperCase();break;case 30:case 31:c='"String"';break;case 36:case 37:c="0";break;case 32:case 33:case 34:case 35:case 58:case 57:c=this.anonymizeIdentifier(s);break;case 59:c="?";break;case 38:case 39:c='DT""';break;default:Je("Unexpected token type"),c=""}i+=c}return i},r.prototype.anonymizeIdentifier=function(i){var a,o=i.matchObject;if(o instanceof rt||o instanceof pe||o instanceof Ke)return i.getString().toUpperCase();if(o instanceof ue||o instanceof ye||o instanceof de||o instanceof Me)(a=this.matchObjectReplacements.get(o))||(a=o instanceof ue?"Column"+ ++this.columnIndex:o instanceof ye?"Measure"+ ++this.measureIndex:o instanceof de?"Table"+ ++this.tableIndex:"Variable"+ ++this.variableIndex,this.matchObjectReplacements.add(o,a));else{var s=i.getIdentifier();(a=this.unmatchedObjectReplacements[s])||(a="Unmatched"+ ++this.unmatchedIndex,this.unmatchedObjectReplacements[s]=a)}return this.delimitIdentifier(i.type,a,this.context)},r}()}(Sn||(Sn={})),function(n){function t(s,c,l){for(var d=c.name,v=new de(d,c.description,D.quoteNeeded(d,function(S){return a(S,s)}),c.name,c.isTransparent,c.isUserTable),b=0,C=c.columns;b<C.length;b++){var y=C[b],O=y.description,x=void 0;l&&y.variationTable&&(x=t(s,y.variationTable,!1));var g=new ue(y.name,O,v);v.addColumn(g),null!=x&&(g.variationTable=x,x.variationSource=g)}return v}function a(s,c){return te.isReservedWord(s,c.reservedWords,c.functions)}n.populateAll=function(s,c,l){var d={daxTables:[],daxColumns:[],transparentDaxTables:[]};!function(s,c,l){var d={},p={};l.daxTables=[],l.daxColumns=[],l.transparentDaxTables=[];for(var v=0,b=s.tables;v<b.length;v++){var C=b[v];(y=t(c,C,!0)).isTransparent?l.transparentDaxTables.push(y):l.daxTables.push(y),d[y.name]=y,p[C.name]=C,l.daxColumns=l.daxColumns.concat(y.columns)}for(var O=s.relationshipGraph,x=0,g=l.daxTables;x<g.length;x++)for(var y,S=(y=g[x]).uberTable,T=0,I=O.getRelatedTables(p[y.name]);T<I.length;T++){var A=d[I[T].name];A&&S.relatedTables.push(A)}}(s,c,d);var p={measures:[]};!function(s,c,l,d){d.measures=[];for(var p=function(O){if(!_.some(O.measures))return"continue";var x=_.find(l.daxTables,function(w){return w.name===O.name});Y(x,"daxTable");for(var g=0,S=O.measures;g<S.length;g++){var T=S[g],I=new ye(T.name,T.description,x,c);x.addMeasure(I),d.measures.push(I)}},v=0,b=s.tables;v<b.length;v++)p(b[v])}(s,c.fnCalculate,d,p);var v={calendars:[]};(function(s,c,l){l.calendars=[];for(var d=function(y){if(!_.some(y.calendars))return"continue";var O=_.find(c.daxTables,function(I){return I.name===y.name});Y(O,"daxTable");for(var x=0,g=y.calendars;x<g.length;x++){var T=new gt(g[x].name,O);O.addCalendar(T),l.calendars.push(T)}},p=0,v=s.tables;p<v.length;p++)d(v[p])})(s,d,v),l.matchObjects=new br(d.daxTables,d.daxColumns,p.measures,v.calendars,c.functions,c.reservedWords,d.transparentDaxTables,c.axes)},n.isReservedWord=a}(Le||(Le={}));var Er=function(){return function(){this.valid=!1,this.cParensNeeded=0}}(),K=function(n){function e(t,r){var i=n.call(this,t,r)||this;return i._children=[],i}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"filterColumnRef",{get:function(){if(1===this.context.filterExpressionState)for(var r=0,i=this._children;r<i.length;r++){var a=i[r].filterColumnRef;if(a)return a}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"valid",{get:function(){return this._children[0].valid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstDescendent",{get:function(){return this._children[0].firstDescendent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastDescendent",{get:function(){var r=_.last(this._children);if(r)return r.lastDescendent},enumerable:!1,configurable:!0}),e.prototype.eatToken=function(t,r){for(var i=0,o=this.getPotentialNextChildren();i<o.length;i++){var a=o[i];if(a.eatToken(t,r)===ee.Yum)return this._children.push(a),ee.Yum}return this.isComplete?ee.NotHungry:ee.Yuck},e.prototype.getFromOnlyChild=function(t){return 1===this._children.length?t(this._children[0]):void 0},Object.defineProperty(e.prototype,"lastChild",{get:function(){return _.last(this._children)},enumerable:!1,configurable:!0}),e.prototype.getFromFirstChild=function(t){if(1===this._children.length)return t(this._children[0])},e.prototype.getContextForChild=function(t){var r=this.context,i=r;if(0!==i.ephemeralContexts.length&&t!==this.childWhichReceivesEphemeralContexts&&(i=new te(i,!0)),1===i.filterExpressionState)for(var o=0,a=this._children;o<a.length;o++){var s=a[o];if(s===t)break;s.filterColumnRef&&(i===r&&(i=new te(i,!0)),i.filterExpressionState=2,i.currentTable=s.filterColumnRef.table.uberTable,i.newTableScan())}return i},Object.defineProperty(e.prototype,"childWhichReceivesEphemeralContexts",{get:function(){return this._children[0]},enumerable:!1,configurable:!0}),e.prototype.isFirstChild=function(t){return t===_.head(this._children)},e.prototype.isOnlyChild=function(t){return 1===this._children.length&&this.isFirstChild(t)},e.prototype.removeLaterChildren=function(t){for(var r=this._children.length-1;this._children[r]!==t;r--)V(r>0,"iChild > 0"),this._children.splice(r,1)},e.prototype.printEarlierNodes=function(t){var r;r=this.parent?this.parent.printEarlierNodes(this):0,this.printSelf(r),r+=2;for(var i=0,o=this._children;i<o.length;i++){var a=o[i];if(a===t)break;a.printSelfAndChildren(r)}return r},e.prototype.printChildren=function(t){for(var r=0,i=this._children;r<i.length;r++)i[r].printSelfAndChildren(t)},e}(mt),fe=function(n){function e(){var t=null!==n&&n.apply(this,arguments)||this;return t.prospectiveChildren=[],t}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"filterColumnRef",{get:function(){return this.getFromOnlyChild(function(r){return r.filterColumnRef})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstDescendent",{get:function(){return _.head(this.validChildren).firstDescendent},enumerable:!1,configurable:!0}),e.prototype.getFromOnlyChild=function(t){return this.child?t(this.child):void 0},Object.defineProperty(e.prototype,"children",{get:function(){return this.validChildren},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastDescendent",{get:function(){return _.head(this.validChildren).lastDescendent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"valid",{get:function(){return _.some(this.validChildren)},enumerable:!1,configurable:!0}),e.prototype.setChild=function(t){V(!this.child,"expected no existing child"),this.child=t},e.prototype.eatToken=function(t,r){if(V(null==this.child,"child == null"),_.some(this.prospectiveChildren))return ee.NotHungry;for(var i=0,o=this.getPotentialChildren();i<o.length;i++){var a=o[i];a.eatToken(t,r)===ee.Yum&&this.prospectiveChildren.push(a)}return this.prospectiveChildren.length>0?ee.Yum:ee.Yuck},Object.defineProperty(e.prototype,"validChildren",{get:function(){return this.child?[this.child]:_.filter(this.prospectiveChildren,function(r){return r.valid})},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return _.some(this.validChildren,function(r){return r.couldBeType(t)})},e.prototype.getContextForChild=function(t){return this.context},e.prototype.printEarlierNodes=function(t){var r;return r=this.parent?this.parent.printEarlierNodes(this):0,this.printSelf(r),r+2},e.prototype.printChildren=function(t){this.child&&this.child.printSelfAndChildren(t)},e.prototype.removeLaterChildren=function(t){this.child=void 0},e.prototype.isFirstChild=function(t){return!0},e.prototype.isOnlyChild=function(t){return!0},e}(mt),xn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialNextChildren=function(){var t;switch(this._children.length){case 0:t=new wr(this);break;case 1:t=new ge(this);break;case 2:t=new nn(this);break;case 3:t=new ie(this);break;default:return[]}return[t]},Object.defineProperty(e.prototype,"isComplete",{get:function(){return 4===this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this._children.length>1?N(this._children[1],ge):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._children.length>3?this._children[3]:void 0},enumerable:!1,configurable:!0}),e}(K),It=function(n){function e(t,r){var i=n.call(this,t)||this;return i._index=r,i}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),e.prototype.getPotentialChildren=function(){return[new ie(this)]},e.prototype.getTableValue=function(){return this.tableValue},e.prototype.getTableRef=function(){return this.tableRef},e.prototype.getQualifiedColumnRef=function(){return this.qualifiedColumnRef},e.prototype.getSimpleColumnRef=function(){return this.simpleColumnRef},e.prototype.getString=function(){return this.string},e.prototype.hasValidAxisRef=function(){return D.hasValidAxesReferences(this.axesRef)},e.prototype.hasValidAxisValue=function(){return this.isValidAxisValue},e.prototype.hasValidEnumValue=function(){return this.isValidEnumValue},e.prototype.couldBeType=function(t){return!(!P.hasFlag(t.type,64)&&!P.hasFlag(t.type,1))||n.prototype.couldBeType.call(this,t)},e.prototype.storeMatchedType=function(t){this.firstDescendent.token.matchedType=t},e.prototype.getCalendarRef=function(){return this.calendarRef},e}(fe),it=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getContextForChild=function(t){return this.parent.getContextForParam(this,this.getParamIndex(t))},Object.defineProperty(e.prototype,"isComplete",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parameterCount",{get:function(){return V(this._children.length>0,"children.length > 0"),this.getParamIndex(this.lastChild)+1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){for(var r=[],i=0;i<this.parameterCount;i++){var o=this.getParameterByIndex(i);o&&r.push(o)}return r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"allParametersIncludingUndefined",{get:function(){for(var r=[],i=0;i<this.parameterCount;i++){var o=this.getParameterByIndex(i);r.push(o)}return r},enumerable:!1,configurable:!0}),e.prototype.getParamIndex=function(t){return this.getParamIndexAndIsParameter(t).index},e.prototype.getSeparatorByIndex=function(t){var r=_.filter(this._children,function(i){return i instanceof X&&i.index===t});if(r.length>1)throw new Error("expected at most one parameter at index "+t);return N(r[0],X)},e.prototype.getParameterByIndex=function(t){var r=_.filter(this._children,function(i){return i instanceof It&&i.index===t});if(r.length>1)throw new Error("expected at most one parameter at index "+t);return N(r[0],It)},e.prototype.getParameterCount=function(){return this.parameterCount},e.prototype.getParameter=function(t){return this.getParameterByIndex(t)},e.prototype.getPotentialNextChildren=function(){var t=!1,r=0;if(this._children.length>0){var i=this.getParamIndexAndIsParameter(this.lastChild);r=i.index,t=i.isParameter}return t?[new X(this,r+1)]:[this.newParameterNode(r),new X(this,r+1)]},e.prototype.newParameterNode=function(t){return new It(this,t)},e.prototype.getParamIndexAndIsParameter=function(t){var r=N(t,It);return r?{index:r.index,isParameter:!0}:{index:t.index,isParameter:!1}},e}(K),We=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialNextChildren=function(){return[this._children.length%2==0?this.getOperand():this.getOperator()]},Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._children.length%2==1},enumerable:!1,configurable:!0}),e}(K),we=function(n){function e(t){return n.call(this,t,34)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"simpleColumnRef",{get:function(){var r=this.token;if(35!==r.type)return N(r.matchObject,ue)},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return P.hasFlag(t.type,16)},e}(k),Tr=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new we(this),new me(this)]},Object.defineProperty(e.prototype,"bracketedIdentifier",{get:function(){var r=N(this.child,we);if(!r){var i=N(this.child,me);null!=i&&(r=i.bracketedIdentifier)}return r},enumerable:!1,configurable:!0}),e}(fe),Zt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getOperand=function(){return new Rt(this)},e.prototype.getOperator=function(){return new k(this,[9,10,11,12,15,16,17])},e}(We),Pn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new Et(this),new Lt(this),new Nr(this),new rn(this)]},e}(fe),Or=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new ge(this),new Et(this),new Lt(this),new Nr(this),new Co(this),new rn(this)]},e}(fe),Sr=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof Re},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){if(!_.some(this._children))return[new st(this)];var t=this.lastChild;return t instanceof st||t instanceof X?[new Or(this),new X(this,0),new Re(this)]:t instanceof Or?[new X(this,0),new Re(this)]:[]},e}(K),Mt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e}(xn),bt=function(n){function e(t){var r=n.call(this,t)||this;return r.query=t,r}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._children.length>=2},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){return 0===this._children.length?[new ho(this)]:[new ot(this),new Mt(this)]},e.prototype.getContextForChild=function(t){var r=this.addDefinedMeasuresToMatchObjects();this.context.matchObjects.mergeMeasures(r);var i=this.createDefinedVariables();return this.context.matchObjects.mergeVariables(i),this.context},e.prototype.removeLaterChildren=function(t){var r=this.removeDefinedMeasuresFromMatchObjectsAfter(t),i=this.removeDefinedVariablesAfter(t);(r||i)&&(this.query.isInvalidated=!0),this.isComplete||(this.query.isInvalidated=!0),n.prototype.removeLaterChildren.call(this,t)},e.prototype.removeDefinedVariablesAfter=function(t){for(var r=!1,i=xe.skipWhile(this._children,function(c){return c!==t}).slice(1),o=0,a=xe.ofType(i,Mt);o<a.length;o++){var s=a[o];s.identifier&&(this.context.matchObjects.removeDefinedVariable(s.identifier.token.getString()),r=!0)}return r},e.prototype.removeDefinedMeasuresFromMatchObjectsAfter=function(t){for(var r=!1,i=xe.skipWhile(this._children,function(l){return l!==t}).slice(1),o=0,a=xe.ofType(i,ot);o<a.length;o++){var s=a[o];if(s.measureDef){var c=this.context.matchObjects.findTable(s.measureDef.tableName);null!=c&&(c.removeDefinedMeasure(s.measureDef.identifier),this.context.matchObjects.removeDefinedMeasure(s.measureDef.identifier,s.measureDef.tableName),r=!0)}}return r},e.prototype.createDefinedVariables=function(){var t=_.chain(xe.ofType(this._children,Mt)).filter(function(r){return r.identifier}).map(this.createVariable).value();return _.some(t)&&(this.query.isInvalidated=!0),t},e.prototype.createVariable=function(t){return new Me(t.identifier.token.getString(),t,!0)},e.prototype.addDefinedMeasuresToMatchObjects=function(){for(var t=[],r=0,i=_.filter(xe.ofType(this._children,ot),function(s){return s.isComplete});r<i.length;r++){var o=i[r],a=this.context.matchObjects.findTable(o.measureDef.tableName);a&&t.push(this.createMeasure(o,a))}return _.some(t)&&(this.query.isInvalidated=!0),t},e.prototype.createMeasure=function(t,r){var i=new Xt(t.measureDef.identifier,t.measureDef.identifier,r,this.context.matchObjects.findFunction("CALCULATE"),t);return r.mergeDefinedMeasure(i),i},e}(K),so=function(n){function e(t){return n.call(this,t,[40,60])||this}return(0,h.__extends)(e,n),e}(k),At=function(n){function e(t,r){var i=n.call(this,void 0,0,r)||this;return i._leafPosition=t,i}return(0,h.__extends)(e,n),e}(k),Ae=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new ie(this)]},e}(fe),Ct=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableValue",{get:function(){var r=this.daxFunctionBase;return r&&r.getTableReturnValue(this.context,this.parameterList)},enumerable:!1,configurable:!0}),e.prototype.getRolledUpColumns=function(t){var r=this;if(this.functionMatchesType(t.type)&&this.parameterList)return _.chain(this.parameterList.parameters).map(function(i){var o=i.getRolledUpColumns({type:1920});if(o)return o;var a=i.qualifiedColumnRef||i.simpleColumnRef;if(a)return[a];if((r.functionMatchesType(256)||r.functionMatchesType(512))&&i.couldBeType({type:32})){var s=new de("",void 0,!1);return[new ue(i.string,"",s)]}return[]}).flatten().value()},e.prototype.couldBeType=function(t){return this.functionMatchesType(t.type)},e.prototype.functionMatchesType=function(t){var r=this.daxFunctionBase;return!!r&&(16===r.role&&P.hasFlag(t,128)||32===r.role&&P.hasFlag(t,256)||64===r.role&&P.hasFlag(t,512)||128===r.role&&P.hasFlag(t,1024)||512===r.role&&P.hasFlag(t,16384)||12===r.role&&P.hasFlag(t,2)||4===r.role&&P.hasFlag(t,2)||4096===r.role&&P.hasFlag(t,2)||16384===r.role&&P.hasFlag(t,2)||2===r.role&&P.hasFlag(t,2)||P.hasFlag(r.role,8192)&&P.hasFlag(t,524288)||256===r.role&&(P.hasFlag(t,4)||P.hasFlag(t,2)||P.hasFlag(t,1)||P.hasFlag(t,2048)))},e.prototype.getPotentialNextChildren=function(){if(!_.some(this._children))return[this.getPotentialFirstChild()];if(1===this._children.length)return[new ut(this)];var t=this.lastChild;return t instanceof ut?[this.newParamList(),new _e(this)]:t instanceof it?[new _e(this)]:[]},e.prototype.newParamList=function(){return new it(this)},Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof _e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftParen",{get:function(){return this._children.length>1?N(this._children[1],ut):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parameterList",{get:function(){return this._children.length>2?N(this._children[2],it):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightParen",{get:function(){var r=this._children.length>3?N(this._children[3],_e):void 0;return r||(r=this._children.length>2?N(this._children[2],_e):void 0),r},enumerable:!1,configurable:!0}),e.prototype.getChildFunctionName=function(){var t;return null===(t=this.functionNode)||void 0===t?void 0:t.segment.text},Object.defineProperty(e.prototype,"daxFunctionBase",{get:function(){var r=this.functionNode;if(r)return N(r.token.matchObject,wt)},enumerable:!1,configurable:!0}),e.prototype.getContextForParam=function(t,r){var i=this.daxFunctionBase;return i?i.getContextForParam(this.context,t,r):this.context},Object.defineProperty(e.prototype,"isValidAxisValue",{get:function(){var r=this.daxFunctionBase;return!!r&&P.hasFlag(r.role,8192)},enumerable:!1,configurable:!0}),e}(K),Nt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"functionNode",{get:function(){return N(this._children[0],k)},enumerable:!1,configurable:!0}),e.prototype.getPotentialFirstChild=function(){return new ge(this)},e}(Ct),uo=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableValue",{get:function(){var r,i;return null===(i=null===(r=this.parameterList)||void 0===r?void 0:r.parameters[0])||void 0===i?void 0:i.tableValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableRef",{get:function(){var r,i;return null===(i=null===(r=this.parameterList)||void 0===r?void 0:r.parameters[0])||void 0===i?void 0:i.tableRef},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"string",{get:function(){var r,i;return null===(i=null===(r=this.parameterList)||void 0===r?void 0:r.parameters[0])||void 0===i?void 0:i.string},enumerable:!1,configurable:!0}),e.prototype.getPotentialFirstChild=function(){return new yo(this)},e.prototype.getContextForParam=function(t,r){var i=this.daxFunctionBase;if(i&&0!==r)return i.getContextForParam(this.context,t,r);for(var o=new te(this.context,!1),a=0,s=this.context.ephemeralContexts;a<s.length;a++){var c=s[a];o.ephemeralContexts.push(new ze(o,c.currentTable,(0,h.__assign)((0,h.__assign)({},c.role),{type:7&c.role.type}),c.enumValues))}return o},e}(Nt),lo=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"functionNode",{get:function(){return N(_.head(this._children),k)},enumerable:!1,configurable:!0}),e.prototype.getPotentialFirstChild=function(){return new po(this)},e.prototype.newParamList=function(){return new fo(this)},e}(Ct),co=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof Re},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDataTable",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return P.hasFlag(t.type,4096)},e.prototype.getPotentialNextChildren=function(){if(!_.some(this._children))return[new st(this)];var t=this.lastChild;return t instanceof st||t instanceof X?[new Sr(this)]:t instanceof Sr?[new X(this,0),new Re(this)]:[]},e}(K),xr=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new Et(this),new ge(this),new co(this)]},e}(It),fo=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.newParameterNode=function(t){return new xr(this,t)},e}(it),ge=function(n){function e(t){return n.call(this,t,58)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableValue",{get:function(){if(this.token){var r=this.token.matchObject,i=N(r,de);if(i)return i.uberTable;var o=N(r,Me);if(o&&o.value)return o.value.tableValue}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableRef",{get:function(){return this.tableValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"axesRef",{get:function(){if(this.token){var r=N(this.token.matchObject,Pe);if(r)return[r]}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"calendarRef",{get:function(){if(this.token){var r=N(this.token.matchObject,gt);if(r)return r}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isValidAxisValue",{get:function(){return D.hasValidAxesReferences(this.axesRef)},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return!!(P.hasFlag(t.type,2)||P.hasFlag(t.type,4)||P.hasFlag(t.type,8)||P.hasFlag(t.type,16)||P.hasFlag(t.type,16384)||P.hasFlag(t.type,32768)||P.hasFlag(t.type,65536)||P.hasFlag(t.type,524288)||P.hasFlag(t.type,131072)||60===this.token.type&&(P.hasFlag(t.type,32)||P.hasFlag(t.type,2048)||P.hasFlag(t.type,4096)))},e.prototype.otherwiseMatchesToken=function(t){return t.isKeyword&&t.activelyEdited},e}(k),Pr=function(n){function e(t,r){var i=n.call(this,void 0,0,r)||this;return i._leafPosition=t,i}return(0,h.__extends)(e,n),e}(k),Rt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"firstChildCouldBeTuple",{get:function(){return this._children.length>=2||!this.parseComplete},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"invalidRightArgument",{get:function(){if(!(this._children.length<3)&&this.parseComplete){var r=this._children[2];if(!r.tableValue)return r}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isComplete",{get:function(){return 1===this._children.length||3===this._children.length},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new Bn(this)];case 1:return[new Nn(this)];case 2:return[new e(this)];default:return[]}},e.prototype.onParseComplete=function(){this.parseComplete=!0},e.prototype.onParseIncomplete=function(){this.parseComplete=!1},e}(K),le=function(n){function e(t,r,i){var o=n.call(this,t,r)||this;return o.keyword=i,o}return(0,h.__extends)(e,n),e.prototype.otherwiseMatchesToken=function(t){return t.isIdentifierOrKeyword&&t.activelyEdited&&j.startsWithIgnoreCase(this.keyword,t.getString())},e}(k),wn=function(n){function e(t){return n.call(this,t,52,"at")||this}return(0,h.__extends)(e,n),e}(le),ho=function(n){function e(t){return n.call(this,t,53,"define")||this}return(0,h.__extends)(e,n),e}(le),In=function(n){function e(t){return n.call(this,t,54,"measure")||this}return(0,h.__extends)(e,n),e}(le),wr=function(n){function e(t){return n.call(this,t,42,"var")||this}return(0,h.__extends)(e,n),e}(le),Mn=function(n){function e(t){return n.call(this,t,43,"return")||this}return(0,h.__extends)(e,n),e}(le),Ir=function(n){function e(t){return n.call(this,t,44,"not")||this}return(0,h.__extends)(e,n),e}(le),An=function(n){function e(t){return n.call(this,t,45,"evaluate")||this}return(0,h.__extends)(e,n),e}(le),po=function(n){function e(t){return n.call(this,t,46,"datatable")||this}return(0,h.__extends)(e,n),e}(le),go=function(n){function e(t){return n.call(this,t,47,"order")||this}return(0,h.__extends)(e,n),e}(le),Mr=function(n){function e(t){return n.call(this,t,48,"by")||this}return(0,h.__extends)(e,n),e}(le),_t=function(n){function e(t){return n.call(this,t,49,"asc")||this}return(0,h.__extends)(e,n),e}(le),Dt=function(n){function e(t){return n.call(this,t,50,"desc")||this}return(0,h.__extends)(e,n),e}(le),Nn=function(n){function e(t){return n.call(this,t,55,"in")||this}return(0,h.__extends)(e,n),e}(le),Ar=function(n){function e(t){return n.call(this,t,51,"start")||this}return(0,h.__extends)(e,n),e}(le),X=function(n){function e(t,r){var i=n.call(this,t,27)||this;return i._index=r,i}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!1,configurable:!0}),e}(k),Rn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new _t(this),new Dt(this)]},Object.defineProperty(e.prototype,"isValidEnumValue",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(fe),ie=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),e.prototype.getOperand=function(){return new sn(this)},e.prototype.getOperator=function(){return new k(this,[13,14])},e}(We),Jt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return 2===this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){if(!(this._children.length<2)){var r=N(this._children[1],we);return r?r.token.getIdentifier():void Je("Unexpected node type: "+this._children[1].constructor)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableRefNode",{get:function(){return this._children.length>0?N(this._children[0],kt):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableName",{get:function(){if(this.tableRefNode)return this.tableRefNode.tableNode.token.getIdentifier()},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new kt(this)];case 1:return[new we(this)]}return[]},e}(K),ot=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new In(this)];case 1:return[new Jt(this)];case 2:return[new nn(this)];case 3:return[new Ae(this)]}return[]},Object.defineProperty(e.prototype,"isComplete",{get:function(){return 4===this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"measureDef",{get:function(){if(this._children.length>1)return N(this._children[1],Jt)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"expressionNode",{get:function(){if(this._children.length>2)return N(this._children[3],Ae)},enumerable:!1,configurable:!0}),e.prototype.getContextForChild=function(t){var r=this;if(t instanceof Ae){var i=new te(this.context.matchObjects),o=_.find(i.matchObjects.tables,function(s){return s.name===r.measureDef.tableName});if(o){i.currentTable=o.uberTable;var a=new te(i,!1);return a.currentTable=void 0,a}}return n.prototype.getContextForChild.call(this,t)},e}(K),mo=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"functionNode",{get:function(){return this._children[0].bracketedIdentifier},enumerable:!1,configurable:!0}),e.prototype.getPotentialFirstChild=function(){return new vo(this)},e}(Ct),vo=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"bracketedIdentifier",{get:function(){var r=N(this.child,we);if(!r){var i=N(this.child,me);i&&(r=i.bracketedIdentifier)}return r},enumerable:!1,configurable:!0}),e.prototype.getPotentialChildren=function(){return[new we(this),new me(this)]},e}(fe),Ne=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._children.length>1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstIdentifier",{get:function(){return N(this._children[0],k)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastIdentifier",{get:function(){return N(this.lastChild,k)},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return P.hasFlag(t.type,2)||P.hasFlag(t.type,4)||P.hasFlag(t.type,8)||P.hasFlag(t.type,65536)||P.hasFlag(t.type,524288)||P.hasFlag(t.type,64)},e.prototype.getIdentifier=function(t){return N(this._children[t],k)},e.prototype.getPotentialNextChildren=function(){return[new ge(this),new _t(this),new Dt(this)]},Object.defineProperty(e.prototype,"axesRef",{get:function(){return this._children.map(function(r){var i;return null!==(i=r.axesRef)&&void 0!==i&&i.length?r.axesRef[0]:void 0})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isValidAxisValue",{get:function(){return D.hasValidAxesReferences(this.axesRef)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"matchingMultiEnumValue",{get:function(){var r=_.find(this.context.ephemeralContexts,function(o){return o.enumValues});if(r){V(_.every(this.children,function(o){return!!N(o,k)}),"Unexpected child type");var i=_.join(_.map(this.children,function(o){return N(o,k).token.getString()})," ");return _.find(r.enumValues,function(o){return j.equalIgnoreCase(o.name,i)})}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isValidEnumValue",{get:function(){return!!this.matchingMultiEnumValue},enumerable:!1,configurable:!0}),e}(K),bo=function(n){function e(t,r){var i=n.call(this,void 0,0,t)||this;return i._path=new pr(void 0),i.newRootNode=r,i}return(0,h.__extends)(e,n),e.prototype.eatToken=function(t,r){return this.newRootNode().eatToken(t,r)},e}(k),en=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new ge(this),new Rn(this),new tn(this),new we(this),new me(this),new Tt(this),new Et(this),new Lt(this),new rn(this),new Nt(this),new mo(this),new lo(this),new _n(this),new jn(this),new Ne(this),new on(this),new an(this),new uo(this)]},e}(fe),Ft=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof yt||this.lastChild instanceof lt},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new go(this)];case 1:return[new Mr(this)];default:var t=this.lastChild;if(t instanceof X||t instanceof Mr)return[new yt(this)];if(t instanceof yt)return[new X(this,0),new lt(this)]}return[]},e}(K),_n=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getFromOnlyChild=function(t){if(this._children.length>=2)return t(this._children[1])},Object.defineProperty(e.prototype,"isComplete",{get:function(){return 3===this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childWhichReceivesEphemeralContexts",{get:function(){if(this._children.length>=2)return this._children[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftParen",{get:function(){return N(this._children[0],k)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightParen",{get:function(){if(this._children.length>2)return N(this._children[2],k)},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new k(this,23)];case 1:return[new ie(this)];case 2:return[new k(this,24)];default:return[]}},e}(K),Dn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getOperand=function(){return new Ln(this)},e.prototype.getOperator=function(){return new k(this,[19,20])},e}(We),Fn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getOperand=function(){return new kn(this)},e.prototype.getOperator=function(){return new k(this,[18])},e}(We),Bt=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._children.length>=1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"queries",{get:function(){return _.filter(this._children,function(r){return r instanceof at})},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){return[new at(this,this.context)]},e}(K),at=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.hasDefineMeasure?this._children.length>=3:this._children.length>=2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasDefineMeasure",{get:function(){return this._children.length>0&&this._children[0]instanceof bt},enumerable:!1,configurable:!0}),e.prototype.getContextForChild=function(t){var r=this.context;if(t instanceof Ae)(r=new te(r,!1)).ephemeralContexts.push(new ze(r,void 0,u.TableExpr,void 0));else if(t instanceof Ft){var o=_.find(this._children,function(a){return a instanceof Ae}).tableValue;(r=new te(r,!1)).currentTable=o}return r},e.prototype.getPotentialNextChildren=function(){if(0===this._children.length)return[new An(this),new bt(this)];var r;switch(this.hasDefineMeasure?this._children.length-1:this._children.length){case 0:r=new An(this);break;case 1:r=new Ae(this);break;case 2:r=new Ft(this);break;default:return[]}return[r]},e}(K),tn=function(n){function e(t){return n.call(this,t,32)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableValue",{get:function(){if(this.token){var r=N(this.token.matchObject,de);if(r)return r.uberTable}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableRef",{get:function(){return this.tableValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"calendarRef",{get:function(){if(this.token){var r=N(this.token.matchObject,gt);if(r)return r}},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return P.hasFlag(t.type,2)||P.hasFlag(t.type,4)||P.hasFlag(t.type,8)||P.hasFlag(t.type,16)},e}(k),Nr=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return 2===this._children.length},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new Rr(this)];case 1:return[new Lt(this)];default:return[]}},e}(K),Co=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return 3===this._children.length},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new ge(this)];case 1:return[new ut(this)];case 2:return[new _e(this)];default:return[]}},e}(K),Re=function(n){function e(t){return n.call(this,t,26)||this}return(0,h.__extends)(e,n),e}(k),_e=function(n){function e(t){return n.call(this,t,24)||this}return(0,h.__extends)(e,n),e}(k),nn=function(n){function e(t){return n.call(this,t,17)||this}return(0,h.__extends)(e,n),e}(k),Lt=function(n){function e(t){return n.call(this,t,36)||this}return(0,h.__extends)(e,n),e}(k),st=function(n){function e(t){return n.call(this,t,25)||this}return(0,h.__extends)(e,n),e}(k),ut=function(n){function e(t){return n.call(this,t,23)||this}return(0,h.__extends)(e,n),e}(k),Rr=function(n){function e(t){return n.call(this,t,[19,20])||this}return(0,h.__extends)(e,n),e}(k),rn=function(n){function e(t){return n.call(this,t,38)||this}return(0,h.__extends)(e,n),e}(k),yo=function(n){function e(t){return n.call(this,t,57)||this}return(0,h.__extends)(e,n),e}(k),yt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._children.length>=1},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new Ae(this)];case 1:return[new _r(this)];default:return[]}},e}(K),_r=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialChildren=function(){return[new _t(this),new Dt(this)]},e}(fe),lt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getPotentialNextChildren=function(){var t;switch(this._children.length){case 0:t=new Ar(this);break;case 1:t=new wn(this);break;default:var r=this.lastChild;r instanceof X||r instanceof wn?t=new Pn(this):(V(r instanceof Pn,"Unexpected node type "+r.constructor),t=new X(this,0))}return[t]},Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof Pn},enumerable:!1,configurable:!0}),e}(K),Et=function(n){function e(t){return n.call(this,t,30)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"string",{get:function(){var r=this.token;if(30===r.type)return D.unDoubleQuote(r.getString())},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return P.hasFlag(t.type,32)||P.hasFlag(t.type,2048)},e}(k),Bn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getOperand=function(){return new Dn(this)},e.prototype.getOperator=function(){return new k(this,[28])},e}(We),me=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"bracketedIdentifier",{get:function(){return this._children.length>1?N(this._children[1],we):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"qualifiedColumnRef",{get:function(){var r=this.bracketedIdentifier;if(r)return r.simpleColumnRef},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filterColumnRef",{get:function(){if(1===this.context.filterExpressionState)return this.qualifiedColumnRef},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isComplete",{get:function(){return 2===this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableRefNode",{get:function(){if(_.some(this._children))return N(_.head(this._children),kt)},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){if(P.hasFlag(t.type,2)||P.hasFlag(t.type,2)){var r=this.bracketedIdentifier;if(!r||60===r.token.type)return!0}return P.hasFlag(t.type,8)},e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new kt(this)];case 1:return[new we(this)];default:return[]}},e.prototype.tryGetTableAndColumnNames=function(t){if(!this.bracketedIdentifier||34!==this.bracketedIdentifier.token.type)return t.table=void 0,t.column=void 0,!1;var r=this.firstDescendent,o=r.token.getString();return r instanceof tn&&(o=D.unquote(o)),t.table=o,t.column=D.unbracket(this.bracketedIdentifier.token.getString()),!0},e}(K),on=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableValue",{get:function(){var r=new nt,i=new de("",void 0,!1);r.constructedTables.push(i);var o=_.head(xe.ofType(this._children,ie));if(o)if(o.tupleCardinality>1)for(var a=0;a<o.tupleCardinality;a++)i.addColumn(new ue("Value".concat(a+1),void 0,i));else i.addColumn(new ue("Value",void 0,i));return r},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return P.hasFlag(t.type,2)},Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof Re},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){if(!_.some(this._children))return[new st(this)];var t=this.lastChild;return t instanceof st?[new ie(this),new Re(this)]:t instanceof X?[new ie(this)]:t instanceof ie?[new X(this,0),new Re(this)]:[]},e}(K),kt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableNode",{get:function(){return N(this.child,k)},enumerable:!1,configurable:!0}),e.prototype.getPotentialChildren=function(){return[new ge(this),new tn(this)]},e}(fe),Ln=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e.prototype.getOperand=function(){return new Fn(this)},e.prototype.getOperator=function(){return new k(this,[21,22])},e}(We),an=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof _e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tupleCardinality",{get:function(){return this.nextSeparatorIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInValidLocation",{get:function(){for(var r=this,i=r.parent;i;r=i,i=i.parent){if(i instanceof on)return!0;var o=N(i,Rt);if(o&&o.firstChildCouldBeTuple)return!0;if(!i.isOnlyChild(r))break}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextSeparatorIndex",{get:function(){for(var r=this._children.length-1;r>0;r--){var i=N(this._children[r],X);if(i)return i.index+1}return 1},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){if(!_.some(this._children))return[new ut(this)];var t=this.lastChild;if(t instanceof ut)return[new ie(this),new X(this,1)];if(t instanceof ie||t instanceof X){var r=this.nextSeparatorIndex,i=[new X(this,r)];return t instanceof X&&i.push(new ie(this)),r>1&&i.push(new _e(this)),i}return[]},e}(K),sn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof Zt},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){return this.isComplete?[]:[new Ir(this),new Zt(this)]},e}(K),kn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof en},enumerable:!1,configurable:!0}),e.prototype.getPotentialNextChildren=function(){return this.isComplete?[]:[new Rr(this),new en(this)]},e}(K),ke=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),e}(xn),Tt=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"simpleColumnRef",{get:function(){if(this._children[0].simpleColumnRef&&!(this._children.length<3))return this._children[2].simpleColumnRef},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"qualifiedColumnRef",{get:function(){if(this._children[0].qualifiedColumnRef&&!(this._children.length<3))return this._children[2].simpleColumnRef},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isComplete",{get:function(){return 3===this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dotNode",{get:function(){return this._children[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"variationSource",{get:function(){return this._children[0].bracketedIdentifier},enumerable:!1,configurable:!0}),e.prototype.couldBeType=function(t){return this._children[0].couldBeType(t)},e.prototype.getContextForChild=function(t){var r=this.context;if(t===this._children[0])return r;var o=N(this.variationSource.token.matchObject,ue),a=o&&o.variationTable?o.variationTable.uberTable:new nt,s=new te(r,!0);return s.ephemeralContexts.push(new ze(s,a,{type:8192,columnReferenceScope:64},void 0)),s},e.prototype.getPotentialNextChildren=function(){switch(this._children.length){case 0:return[new Tr(this)];case 1:return[new so(this)];case 2:return[new we(this)];default:return[]}},e}(K),jn=function(n){function e(t){return n.call(this,t)||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"tableValue",{get:function(){var r=this.returnedExpression;if(r)return r.tableValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"returnedExpression",{get:function(){return N(this.lastChild,ie)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isComplete",{get:function(){return this.lastChild instanceof ie},enumerable:!1,configurable:!0}),e.prototype.getEarlierVariables=function(t){for(var r=[],i=0,o=this._children;i<o.length;i++){var a=o[i];if(a===t)break;a instanceof ke&&r.push(a)}return r},e.prototype.couldBeType=function(t){return P.hasFlag(t.type,2)},e.prototype.getContextForChild=function(t){for(var r=[],i=0,o=this._children;i<o.length;i++){var a=o[i];if(a===t)break;var s=N(a,ke);s&&r.push(s.identifier.token.matchObject)}var c=this.context;return(t!==this._children[0]&&_.some(c.ephemeralContexts)||_.some(r))&&(c=new te(c,!0)).mergeInlineVariables(r),c},e.prototype.getPotentialNextChildren=function(){var t=this.lastChild;return t?t instanceof ke?[new ke(this),new Mn(this)]:t instanceof Mn?[new ie(this)]:[]:[new ke(this)]},e}(K),H=function(n){return n[n.CantSeparateFormulaNameAndExpression=0]="CantSeparateFormulaNameAndExpression",n[n.DuplicateMeasureName=1]="DuplicateMeasureName",n[n.FunctionCallOnNonFunction=2]="FunctionCallOnNonFunction",n[n.Gramatical=3]="Gramatical",n[n.IncompleteNumber=4]="IncompleteNumber",n[n.IncorrectOrderByParam=5]="IncorrectOrderByParam",n[n.IncorrectPartitionByParam=6]="IncorrectPartitionByParam",n[n.IncorrectMatchByParam=7]="IncorrectMatchByParam",n[n.InvalidIdentifier=8]="InvalidIdentifier",n[n.InvalidNameCharacter=9]="InvalidNameCharacter",n[n.InvalidTupleLocation=10]="InvalidTupleLocation",n[n.InvalidParameter=11]="InvalidParameter",n[n.MissingParameters=12]="MissingParameters",n[n.RightArgumentToInOperatorNotValidTable=13]="RightArgumentToInOperatorNotValidTable",n[n.TooManyParameters=14]="TooManyParameters",n[n.UnrecognizedIdentifier=15]="UnrecognizedIdentifier",n[n.VariableNameReserved=16]="VariableNameReserved",n}({}),Ee=function(){function n(e,t){this.segment=e,this.errorCode=t,this.message=n.getMessage(e,t)}return n.prototype.equals=function(e){return this.segment.equals(e.segment)&&this.errorCode===e.errorCode},n.prototype.toString=function(){return"".concat(this.errorCode,": ").concat(this.segment.text)},n.getMessage=function(e,t){switch(t){case H.CantSeparateFormulaNameAndExpression:return L.format(L.localizedStrings.invalidIdentifier,e.text);case H.FunctionCallOnNonFunction:return L.format(L.localizedStrings.functionCallOnNonFunction,e.text);case H.Gramatical:return L.format(L.localizedStrings.grammaticalError,e.text);case H.IncompleteNumber:return L.format(L.localizedStrings.incompleteNumber);case H.IncorrectOrderByParam:return L.format(L.localizedStrings.incorrectOrderByParam);case H.IncorrectPartitionByParam:return L.format(L.localizedStrings.incorrectPartitionByParam);case H.IncorrectMatchByParam:return L.format(L.localizedStrings.incorrectMatchByParam);case H.InvalidIdentifier:return L.format(L.localizedStrings.invalidIdentifier,e.text);case H.InvalidNameCharacter:return L.format(L.localizedStrings.invalidNameCharacter,e.text);case H.InvalidTupleLocation:return L.format(L.localizedStrings.invalidTupleLocation);case H.InvalidParameter:return L.format(L.localizedStrings.invalidParameter);case H.MissingParameters:return L.format(L.localizedStrings.missingParameters);case H.RightArgumentToInOperatorNotValidTable:return L.format(L.localizedStrings.rightArgumentToInOperatorNotValidTable,e.text);case H.TooManyParameters:return L.format(L.localizedStrings.tooManyParameters,e.text);case H.UnrecognizedIdentifier:return L.format(L.localizedStrings.unrecognizedIdentifier,e.text);case H.VariableNameReserved:return L.format(L.localizedStrings.variableNameReserved,e.text);case H.DuplicateMeasureName:return L.format(L.localizedStrings.duplicateMeasureName)}Se("unexpected error code ".concat(t))},n}(),Un=function(){function n(e,t,r,i){void 0===e&&(e=""),void 0===t&&(t=0),this._expression=e,this._cursorActivity=t,this._cursorPosition=r,this._selectionStart=i,this.semiselectable=!1,this.suggestions=[],this.replaceStart=-1,this.replaceEnd=-1,this.afterOParen=-1,this.afterCParen=-1,this.bestMatch=-1,this._prototypeParamContexts=[],this.prototypePosition=-1,this.boldLeftParen=-1,this.boldRightParen=-1,this._errors=[],this._comments=[],this._functions=[],this._references=[],this._tableReferences=[],this._columnReferences=[],this._measureReferences=[],this._strings=[],this._variables=[],this._unrecognizedIdentifiers=[]}return Object.defineProperty(n.prototype,"expression",{get:function(){return this._expression},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cursorActivity",{get:function(){return this._cursorActivity},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cursorPosition",{get:function(){return this._cursorPosition},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectionStart",{get:function(){return this._selectionStart},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"prototypeParamContexts",{get:function(){return this._prototypeParamContexts},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"errors",{get:function(){return this._errors},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"comments",{get:function(){return this._comments},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functions",{get:function(){return this._functions},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"references",{get:function(){return this._references},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"measureReferences",{get:function(){return this._measureReferences},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tableReferences",{get:function(){return this._tableReferences},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"columnReferences",{get:function(){return this._columnReferences},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"strings",{get:function(){return this._strings},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"variables",{get:function(){return this._variables},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"unrecognizedIdentifiers",{get:function(){return this._unrecognizedIdentifiers},enumerable:!1,configurable:!0}),n}(),Vn=function(){function n(e,t,r,i){this._expression=e,this._cursorActivity=t,this._cursorPosition=r,this._selectionStart=i,this._tokens=[],this.parseTokenCount=-1}return Object.defineProperty(n.prototype,"activeCursor",{get:function(){return this.cursorActivity>=3},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cursorActivity",{get:function(){return this._cursorActivity},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cursorPosition",{get:function(){return this._cursorPosition},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"expression",{get:function(){return this._expression},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectionStart",{get:function(){return this._selectionStart},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tokens",{get:function(){return this._tokens},enumerable:!1,configurable:!0}),n.prototype.updateExpression=function(e){this._expression=e},n.prototype.nextNonIgnorable=function(e,t){for(void 0===t&&(t={iTokenNext:void 0}),t.iTokenNext=e+1;t.iTokenNext<this.tokens.length;t.iTokenNext++){var r=this.tokens[t.iTokenNext];if(!r.ignorable)return r}},n}(),je=function(){function n(e,t,r,i,o,a,s,c,l){void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===l&&(l=u.None),this._type=e,this._expression=t,this._startPosition=r,this._length=i,this._ignorable=o,this._secondHalf=a,this.activelyEdited=s,this.matchObject=c,this.matchedType=l}return n.prototype.debuggerDisplay=function(){return V(et.debugging,"cannot use debuggerDisplay unless debugging"),"".concat(this.type," ").concat(this.getString()," (").concat(this.startPosition,", ").concat(this.length,")")},n.prototype.toString=function(){return this.debuggerDisplay()},Object.defineProperty(n.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"expression",{get:function(){return this._expression},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"startPosition",{get:function(){return this._startPosition},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"endPosition",{get:function(){return this.startPosition+this.length},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ignorable",{get:function(){return this._ignorable},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"secondHalf",{get:function(){return this._secondHalf},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isComment",{get:function(){return Fr(this.type)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isKeyword",{get:function(){return Hn(this.type)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isIdentifierOrKeyword",{get:function(){return function(n){return 58===n||Hn(n)}(this.type)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isAnyKindOfIdentifier",{get:function(){return function(n){return 58===n||32===n||34===n}(this.type)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isComplete",{get:function(){return function(n){if(Hn(n))return!1;switch(n){case 3:case 5:case 7:case 31:case 33:case 35:case 36:case 37:case 39:case 58:return!1}return!0}(this.type)},enumerable:!1,configurable:!0}),n.prototype.getSegment=function(){return new tt(this.expression,this.startPosition,this.length)},n.prototype.getString=function(){return this.expression.substr(this.startPosition,this.length)},n.prototype.getIdentifier=function(){var e=this.getString();if(this.isIdentifierOrKeyword)return e;switch(this.type){case 32:return D.unquote(e);case 33:return D.unquotePartial(e);case 34:return D.unbracket(e);case 35:return D.unbracketPartial(e)}return""},n.prototype.matchesType=function(e){return!!Dr(this.type,e)||60===this.type&&(58===e||32===e||34===e||ce.featureSwitches.suggestKeywords&&48===e)},n.prototype.markAsSecondHalf=function(e){this._length=this._startPosition+this._length-e,this._startPosition=e,this._secondHalf=!0},n.prototype.cloneForReuse=function(e,t,r,i){return new n(this.type,e,t,r,this.ignorable,i,!1,this.matchObject,i?u.None:this.matchedType)},n.prototype.attachToNewExpression=function(e){this._expression=e},n.prototype.offsetPosition=function(e){this._startPosition+=e},n}();function Dr(n,e){if(n===e)return!0;switch(n){case 31:return 30===e;case 30:return 31===e;case 33:return 32===e;case 32:return 33===e;case 35:return 34===e;case 34:return 35===e;case 37:return 36===e;case 36:return 37===e;case 38:return 39===e;case 39:return 38===e}return!1}function Fr(n){return n>1&&n<8}function Hn(n){return n>41&&n<56}var un,Br=function(){function n(e,t){var r=this;this.newExpressionNode=new bo(e,function(){return r._rootNode=t(),r._rootNode}),this._context=e,this._leafPositions=[],this.tokenization=new Vn("",0,void 0,void 0)}return Object.defineProperty(n.prototype,"rootNode",{get:function(){return this._rootNode},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"context",{get:function(){return this._context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"leafPositions",{get:function(){return this._leafPositions},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"anyErrors",{get:function(){return _.some(this._leafPositions,function(t){return _.some(t.validNodes,function(r){return r instanceof At})})},enumerable:!1,configurable:!0}),n.prototype.getValidLeafNodesAtPosition=function(e){return this._leafPositions[e].validNodes},n.prototype.update=function(e){var t={iToken:void 0,currentNodes:void 0};this.reuseExistingParseTree(e,t),this.completeParseTree(e,t.iToken,t.currentNodes),this.tokenization=e},n.prototype.tryAddClosingParens=function(e,t){var r={result:!1,countParensAdded:-1},i={iToken:void 0,currentNodes:void 0};this.reuseExistingParseTree(this.tokenization,i),V(i.iToken===this.tokenization.parseTokenCount,"expected iToken to be parseTokenCount");var o=t.expression;for(r.countParensAdded=0;;){var a=new je(24,o+=")",o.length-1,1),s=new Tn(a);switch(this.tryEatToken(a,new Tn(a),i)){case ee.Yum:r.countParensAdded++,e&&(t.expression=o,this.tokenization.updateExpression(t.expression),this.tokenization.tokens.push(a),this.tokenization.parseTokenCount++,this.leafPositions.push(s));break;case ee.Yuck:return r.result=!1,r;case ee.NotHungry:return r.result=!0,r}}},n.prototype.reuseExistingParseTree=function(e,t){var r=Math.min(this.tokenization.parseTokenCount,e.parseTokenCount);for(t.iToken=0;t.iToken<r;t.iToken++){var i=this.tokenization.tokens[t.iToken],o=e.tokens[t.iToken];if(i.activelyEdited||o.activelyEdited||!Dr(o.type,i.type))break;this.leafPositions[t.iToken].rebindToken(o)}t.iToken<this.leafPositions.length&&this.leafPositions.splice(t.iToken,this.leafPositions.length-t.iToken);for(var a=t.iToken-1;a>=0;a--){var s=this.leafPositions[a];if(s.isInParseTree)return t.currentNodes=s.nodes,void this.refreshParsePaths(t.currentNodes)}t.currentNodes=[this.newExpressionNode]},n.prototype.refreshParsePaths=function(e){this.removeLaterNodes(e),this.reinitializeParsePaths(e)},n.prototype.removeLaterNodes=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];i.onParseIncomplete();for(var o=void 0,a=i;o=a.parent;a=o)o.removeLaterChildren(a),o.onParseIncomplete()}},n.prototype.reinitializeParsePaths=function(e){for(var t=0,r=e;t<r.length;t++)for(var o=r[t].path;o;o=o.parent)o.reinitialize();for(var a=0,s=e;a<s.length;a++)for(var c=(o=s[a].path).parent;c&&c.addChild(o);o=c,c=c.parent);},n.prototype.completeParseTree=function(e,t,r){for(var i={currentNodes:r},o=[],a=!0,s=[],c=function(){var p=e.tokens[t],v=new Tn(p);if(V(l.leafPositions.length===t,"iToken to be the end of the leaf positions"),l.leafPositions.push(v),l.tryEatToken(p,v,i),!ce.featureSwitches.addTriviaToParseNodeMetadata)return"continue";if(p.ignorable)return o.push(p),"continue";if(60===p.type)return"continue";if(a&&i.currentNodes.length)a=!1,i.currentNodes.map(function(y){return y.leadingTrivia=o}),o=[];else if(s.length&&i.currentNodes.length){var b=o.findIndex(function(y){return y.getString().includes("\n")}),C=-1===b?o.length:b+1;s.map(function(y){return y.trailingTrivia=o.slice(0,C)}),i.currentNodes.map(function(y){return y.leadingTrivia=o.slice(C)}),o=[]}s=i.currentNodes},l=this;t<e.parseTokenCount;t++)c();ce.featureSwitches.addTriviaToParseNodeMetadata&&o.length>0&&s.length&&s.map(function(d){return d.trailingTrivia=o})},n.prototype.tryEatToken=function(e,t,r){if(e.ignorable)return t.addNode(new Pr(t,this.context)),ee.Yum;for(var i=!1,o=0,a=r.currentNodes;o<a.length;o++)for(var s=a[o],c=[],l=s;;l=l.parent){var d=l.eatToken(t,s.path);if(d===ee.Yum){for(var p=0,v=c;p<v.length;p++){var b=v[p];b.parentNode.setChild(b.parseNode)}if(60!==t.token.type)for(var C=s;C!==l;C=C.parent)C.onParseComplete();break}if(d===ee.Yuck){s.path.markUnsuccessful();break}if(V(d===ee.NotHungry,"expected ".concat(d," to be EatResult.NotHungry (").concat(ee.NotHungry,")")),!l.parent){i=!0,s.path.markUnsuccessful();break}var y=l.parent instanceof fe?l.parent:null;y&&c.push({parseNode:l,parentNode:y})}return _.some(t.nodes)?(r.currentNodes=t.nodes,r.currentNodes.forEach(function(O){return O.consolidatePath()}),ee.Yum):(60!==e.type&&t.addNode(new At(t,this.context)),this.reinitializeParsePaths(r.currentNodes),i?ee.NotHungry:ee.Yuck)},n.prototype.clearAllContexts=function(){for(var e=[this.rootNode];e.length>0;){var r=e.pop();r.parent&&r.clearContext(),r instanceof mt&&(r instanceof fe?r.prospectiveChildren:r.children).forEach(function(i){return e.push(i)})}},n}();!function(n){n.couldBeOperand=function(t){for(var r=t.parent;null!=r&&r.isFirstChild(t);t=r,r=r.parent)if(r instanceof ie||r instanceof sn||r instanceof Zt||r instanceof Bn||r instanceof Dn||r instanceof Ln||r instanceof Fn||r instanceof kn||r instanceof en||r instanceof xr)return!0;return!1}}(un||(un={}));var re=function(){function n(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];this._matchObject=e,this._suggestionText=t,_.some(r)||(r=[e]),this._segments=_.map(r,function(o){return o.name})}return Object.defineProperty(n.prototype,"complete",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"matchObject",{get:function(){return this._matchObject},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"suggestionText",{get:function(){return this._suggestionText},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"segments",{get:function(){return this._segments},enumerable:!1,configurable:!0}),n.prototype.prependSuggestionText=function(e){this._suggestionText=e+this._suggestionText},n}(),jt=function(n){function e(t,r){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];return n.apply(this,(0,h.__spreadArray)([t,r],i,!1))||this}return(0,h.__extends)(e,n),Object.defineProperty(e.prototype,"complete",{get:function(){return!1},enumerable:!1,configurable:!0}),e}(re);function So(n,e){for(var t=0;;t++){if(t>=n.segments.length&&t>=e.segments.length)return 0;if(t>=n.segments.length)return-1;if(t>=e.segments.length)return 1;var r=j.compare(n.segments[t],e.segments[t],!0);if(0!==r)return r}}var xo=function(){function n(){}return n.equals=function(e,t){return typeof e.matchObject==typeof t.matchObject&&j.equalIgnoreCase(e.suggestionText,t.suggestionText)},n}(),Po=function(){function n(e,t,r,i){this.tokenization=e,this.parseTree=t,this.iNewToken=r,this.iTokenLeft=i,this.suggestionContexts=[],this._suggestions=[],this._replaceStart=-1,this._replaceEnd=-1,this._afterOParen=-1,this._afterCParen=-1,this._bestMatch=-1}return Object.defineProperty(n.prototype,"bestMatch",{get:function(){return this._bestMatch},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"afterCParen",{get:function(){return this._afterCParen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"afterOParen",{get:function(){return this._afterOParen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"replaceStart",{get:function(){return this._replaceStart},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"replaceEnd",{get:function(){return this._replaceEnd},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"suggestions",{get:function(){return this._suggestions},enumerable:!1,configurable:!0}),n.prototype.buildSuggestions=function(){this.addSuggestions(),this.removeDuplicateSuggestionsForSameObject(),this.removeDuplicateSuggestionsBySuggestionText(),this.sortSuggestions(),this.findBestMatch()},n.prototype.addSuggestions=function(e,t){if(e)this.suggestionContexts=this.suggestionContexts.concat(_.map(e,function(I){return new Lr(I,t)}));else if(this._replaceStart=this.tokenization.cursorPosition||0,this._replaceEnd=this.tokenization.cursorPosition||0,this.tokenization.activeCursor&&3!==this.tokenization.cursorActivity){var r=this.iNewToken;if(-1===r&&(r=this.iTokenLeft),-1!==r){for(var i=this.tokenization.tokens[r],o=0,a=this.parseTree.getValidLeafNodesAtPosition(r);o<a.length;o++){var s=a[o];if(s instanceof At)return;var c=s.parent,l=void 0;if((c instanceof me||c instanceof Ne||c instanceof Tt)&&(l=c.firstDescendent.token)!==i){for(var d=void 0,p=r-1;(d=this.tokenization.tokens[p])!==l;p--)if(29!==d.type&&_.some(this.parseTree.getValidLeafNodesAtPosition(p),function(I){return I instanceof Pr||I instanceof At}))return;var v=N(c,Tt);if(v){this.addSuggestionsBasedOnPartialVariation(i.getIdentifier(),s.context,v.dotNode.token.startPosition);var b=v.variationSource;N(b.parent,me)?this.addSuggestionsBasedOnTableColumnAndPartialVariation(l.getIdentifier(),b.token.getIdentifier(),i.getIdentifier(),l.matchesType(32),v.context,l.startPosition):this.addSuggestionsBasedOnColumnAndPartialVariation(b.token.getIdentifier(),i.getIdentifier(),v.context,l.startPosition)}else c instanceof Ne?this.addSuggestionsBasedOnPartialIdentifier(this.tokenization.expression.substr(l.startPosition,i.endPosition-l.startPosition),c.context,l.startPosition):this.addSuggestionsBasedOnTableAndPartialColumnOrMeasure(l.getIdentifier(),i.getIdentifier(),l.matchesType(32),c.context,l.startPosition)}else{var y=s.context;if(ce.featureSwitches.suggestKeywords&&s instanceof le&&!(s.parent instanceof Rn)&&this.addSuggestionsBasedOnPartialKeywordValue(i.getString(),s.keyword,i.startPosition),33===i.type)this.addSuggestionsBasedOnPartialTable(i.getIdentifier(),y,i.startPosition),this.addSuggestionsBasedOnPartialCalendarCore(i.getIdentifier(),!0,new Ue(y),i.startPosition);else if(35===i.type)this.addSuggestionsBasedOnPartialColumnOrMeasure(i.getIdentifier(),y,i.startPosition);else if(i.isIdentifierOrKeyword&&un.couldBeOperand(s))this.addSuggestionsBasedOnPartialIdentifier(i.getIdentifier(),y,i.startPosition);else if(36===i.type)this.addSuggestionsBasedOnPartialEnumValue(i.getString(),y,i.startPosition);else if(60===i.type){var O=this.tokenization.nextNonIgnorable(r);this.addSuggestionsBasedOnNewToken(y,(O?O.matchedType:u.None).type,i.startPosition,4===this.tokenization.cursorActivity)}}}this.setReplaceStartAndPadSuggestions(),this._replaceEnd=i.endPosition;var S={iTokenNext:-1},T=this.tokenization.nextNonIgnorable(r,S);T&&(T.secondHalf&&(T.matchObject||1===T.length)&&(33===i.type&&32===T.type||35===i.type&&34===T.type||i.isIdentifierOrKeyword&&T.isIdentifierOrKeyword)&&(V(this.replaceEnd===T.startPosition,"expected replaceEnd to equal startPosition"),this._replaceEnd=T.endPosition,T=this.tokenization.nextNonIgnorable(S.iTokenNext,S)),T&&23===T.type&&(this._afterOParen=T.endPosition,(T=this.tokenization.nextNonIgnorable(S.iTokenNext,S))&&24===T.type&&(this._afterCParen=T.endPosition)))}}},n.prototype.addSuggestion=function(e,t){this.suggestionContexts.push(new Lr(e,t))},n.prototype.setReplaceStartAndPadSuggestions=function(){var e=this;this.suggestionContexts.length>0&&(this._replaceStart=_.min(_.map(this.suggestionContexts,function(t){return t.replaceStart})),this._suggestions=this._suggestions.concat(_.map(this.suggestionContexts,function(t){return e.replaceStart<t.replaceStart&&t.suggestion.prependSuggestionText(e.tokenization.expression.substr(e.replaceStart,t.replaceStart-e.replaceStart)),t.suggestion})))},n.prototype.addSuggestionsBasedOnPartialTableCore=function(e,t,r,i){this.addSuggestions(_.chain(r.tables).filter(function(C){return n.isMatch(C.name,e)}).map(function(C){return new re(C,C.getAutoCompleteName(t))}).value(),i);for(var o=function(y){var O=n.tableToSuggest(y),x=O.getAutoCompleteName(t),g=n.isMatch(O.name,e);g&&e!==x&&a.addSuggestion(new jt(O,x),i),a.addSuggestions(_.chain(y.columns).filter(function(S){return g||n.isColumnMatch(S,e)}).map(function(S){return n.buildTableColumnSuggestion(S,t,!0)}).value(),i)},a=this,s=0,c=r.tablesForQualifiedColumnRefs;s<c.length;s++)o(c[s]);for(var d=function(y){var O=y.getAutoCompleteName(t);p.addSuggestions(_.map(y.measures,function(x){return new re(x,O+D.bracket(x.name),y,x)}),i)},p=this,v=0,b=_.filter(r.tablesForMeasures,function(C){return n.isMatch(C.name,e)});v<b.length;v++)d(b[v])},n.prototype.addSuggestionsBasedOnPartialTable=function(e,t,r){this.addSuggestionsBasedOnPartialTableCore(e,!0,new Ue(t),r),this.userInput=e},n.prototype.addSuggestionsBasedOnPartialColumnOrMeasureCore=function(e,t,r){this.addSuggestions(_.chain(t.simpleColumnRefs).filter(function(i){return n.isColumnMatch(i,e)}).map(function(i){return n.buildColumnSuggestion(i)}).value(),r),this.addSuggestions(_.chain(t.measures).filter(function(i){return n.isMatch(i.name,e)}).map(function(i){return new re(i,D.bracket(i.name))}).value(),r)},n.prototype.addSuggestionsBasedOnPartialColumnOrMeasure=function(e,t,r){this.addSuggestionsBasedOnPartialColumnOrMeasureCore(e,new Ue(t),r),this.userInput=e},n.prototype.addSuggestionsBasedOnColumnAndPartialVariation=function(e,t,r,i){var o=new Ue(r);this.addSuggestions(_.chain(o.simpleColumnRefs).filter(function(a){return a.table.variationSource&&j.equalIgnoreCase(a.table.variationSource.name,e)&&n.isMatch(a.name,t)}).map(function(a){return new re(a,D.bracket(a.table.variationSource.name)+"."+D.bracket(a.name),a)}).value(),i),this.userInput=t},n.prototype.addSuggestionsBasedOnPartialEnumValueCore=function(e,t,r){this.addSuggestions(_.chain(t.enumValues).filter(function(i){return n.isMatch(i.name,e)}).map(function(i){return new re(i,i.name)}).value(),r)},n.prototype.addSuggestionsBasedOnPartialCalendarCore=function(e,t,r,i){this.addSuggestions(_.chain(r.calendars).filter(function(o){return n.isMatch(o.name,e)}).map(function(o){if(t)return new re(o,D.quote(o.name));var a=o.name.trim().indexOf(" ")>=0;return new re(o,a?D.quote(o.name):o.name)}).value(),i)},n.prototype.addSuggestionsBasedOnPartialEnumValue=function(e,t,r){this.addSuggestionsBasedOnPartialEnumValueCore(e,new Ue(t),r),this.userInput=e},n.prototype.addSuggestionsBasedOnPartialKeywordValue=function(e,t,r){n.isMatch(t,e)&&this.addSuggestions([new re(new Ke(t),t.toUpperCase())],r),this.userInput=e},n.prototype.addSuggestionBasedOnParitialAxis=function(e,t,r){var i=t.axes.map(function(a){return a.name}),o=i;i.length>=2&&(o=(0,h.__spreadArray)((0,h.__spreadArray)([],i,!0),["".concat(i[0]," ").concat(i[1]),"".concat(i[1]," ").concat(i[0])],!1)),this.addSuggestions(_.chain(o).filter(function(a){return n.startsWith(a,e)}).map(function(a){return new re(new Pe(a),a)}).value(),r)},n.prototype.addSuggestionsBasedOnPartialIdentifier=function(e,t,r){var i=new Ue(t);this.addSuggestionsBasedOnPartialTableCore(e,!1,i,r),this.addSuggestionsBasedOnPartialColumnOrMeasureCore(e,i,r),this.addSuggestionsBasedOnPartialEnumValueCore(e,i,r),this.addSuggestionBasedOnParitialAxis(e,i,r),this.addSuggestionsBasedOnPartialCalendarCore(e,!1,i,r),this.addSuggestions(_.chain(i.functions).filter(function(o){return n.isMatch(o.name,e)}).map(function(o){return new re(o,o.name)}).value(),r),this.addSuggestions(_.chain(i.variables).filter(function(o){return n.isMatch(o.name,e)}).map(function(o){return new re(o,o.name)}).value(),r),this.userInput=e},n.prototype.addSuggestionsBasedOnNewToken=function(e,t,r,i){_.some(e.ephemeralContexts)?t!==u.None.type&&_.some(e.ephemeralContexts,function(a){return P.hasFlag(a.allowedTypes,t)})||this.addSuggestionsBasedOnPartialIdentifier("",e,r):i&&this.addSuggestionsBasedOnPartialIdentifier("",e,r)},n.prototype.addSuggestionsBasedOnTableAndPartialColumnOrMeasure=function(e,t,r,i,o){for(var a=new Ue(i),s=0,c=a.tablesForQualifiedColumnRefs;s<c.length;s++){var l=c[s],d=n.tableToSuggest(l);j.equalIgnoreCase(d.name,e)&&this.addSuggestions(l.columns.filter(function(b){return n.isColumnMatch(b,t)}).map(function(b){return n.buildTableColumnSuggestion(b,r,!1)}),o)}var p=_.find(a.tablesForMeasures,function(b){return j.equalIgnoreCase(b.name,e)});if(p){var v=p.getAutoCompleteName(r);this.addSuggestions(p.measures.filter(function(b){return n.isMatch(b.name,t)}).map(function(b){return new re(b,v+D.bracket(b.name),b)}),o)}this.userInput=t},n.prototype.addSuggestionsBasedOnTableColumnAndPartialVariation=function(e,t,r,i,o,a){for(var s=new Ue(o),c=function(C){var O=C.variationSource.table.getAutoCompleteName(i);l.addSuggestions(C.columns.filter(function(x){return n.isMatch(x.name,r)}).map(function(x){return new re(x,O+D.bracket(C.variationSource.name)+"."+D.bracket(x.name),x)}),a)},l=this,d=0,p=_.filter(s.tablesForQualifiedColumnRefs,function(b){return b.variationSource&&j.equalIgnoreCase(b.variationSource.table.name,e)&&j.equalIgnoreCase(b.variationSource.name,t)});d<p.length;d++)c(p[d]);this.userInput=r},n.prototype.addSuggestionsBasedOnPartialVariation=function(e,t,r){var i=new Ue(t),o=_.chain(i.newVariations).filter(function(a){return n.isMatch(a.name,e)}).map(function(a){return new re(a,"."+D.bracket(a.name))}).value();_.some(o)&&(this.addSuggestions(o,r),this.userInput=e)},n.prototype.removeDuplicateSuggestionsForSameObject=function(){for(var e=new ht,t=0,r=this.suggestions;t<r.length;t++){var i=r[t],o=i.matchObject;e.containsKey(o)?i.segments.length>e.get(o).segments.length&&e.update(o,i):e.add(o,i)}this._suggestions=e.values()},n.prototype.removeDuplicateSuggestionsBySuggestionText=function(){this._suggestions=xe.distinct(this.suggestions,xo.equals)},n.prototype.sortSuggestions=function(){this.suggestions.sort(So)},n.prototype.findBestMatch=function(){var e=this;if(this._bestMatch=-1,_.some(this.suggestions)){for(var t=void 0,r=function(c){if(t=_.find(i.suggestions,function(l){return l.segments.length>c&&_.startsWith(l.segments[c].toUpperCase(),e.userInput.toUpperCase())}))return"break"},i=this,o=0;o<3&&"break"!==r(o);o++);this._bestMatch=0,t&&(this._bestMatch=this.suggestions.indexOf(t))}},n.buildColumnSuggestion=function(e){var t=D.bracket(e.name),r=[e],i=e.table.variationSource;return i&&(t=D.bracket(i.name)+"."+t,r.splice(0,0,i)),e.variationTable?new(jt.bind.apply(jt,(0,h.__spreadArray)([void 0,e,t],r,!1))):new(re.bind.apply(re,(0,h.__spreadArray)([void 0,e,t],r,!1)))},n.tableToSuggest=function(e){return e.variationSource?e.variationSource.table:e},n.buildTableColumnSuggestion=function(e,t,r){var i=e.table,o=D.bracket(e.name),a=[e],s=i.variationSource;return s&&(o=D.bracket(s.name)+"."+o,a.splice(0,0,s),i=s.table),o=i.getAutoCompleteName(t)+o,r&&a.splice(0,0,i),e.variationTable?new(jt.bind.apply(jt,(0,h.__spreadArray)([void 0,e,o],a,!1))):new(re.bind.apply(re,(0,h.__spreadArray)([void 0,e,o],a,!1)))},n.isColumnMatch=function(e,t){if(n.isMatch(e.name,t))return!0;var r=e.table.variationSource;return!(!r||!n.isMatch(r.name,t))},n.isMatch=function(e,t){return!!(n.startsWith(e,t)||t.length>=2&&e.toUpperCase().indexOf(t.toUpperCase())>=0)},n.startsWith=function(e,t){return _.startsWith(e.toUpperCase(),t.toUpperCase())},n}(),Ue=function(){function n(e){this._tables=[],this._tablesForMeasures=[],this._measures=[],this._newVariations=[],this._axes=[],this._calendars=[];var t=!1,r=[],i=[],o=[],a=[],s=0;if(_.some(e.ephemeralContexts))for(var c=0,l=e.ephemeralContexts;c<l.length;c++){var d=l[c],p=d.allowedTypes;(P.hasFlag(p,1)||ce.featureSwitches.useSkippableParams&&void 0===p)&&(t=!0),(P.hasFlag(p,2)||P.hasFlag(p,4))&&(this._tables=e.matchObjects.tables.filter(function(v){return v.isUserTable}),s|=256),P.hasFlag(p,8)&&(r=r.concat(d.getTablesInScopeForQualifiedColRefs())),P.hasFlag(p,16)&&(i=i.concat(d.getSimpleColumnRefsInScope())),P.hasFlag(p,64)&&(o=o.concat(d.enumValues)),P.hasFlag(p,2)&&(s|=20494,a=a.concat(_.filter(e.variables,function(v){return v.value&&v.value.tableValue}))),P.hasFlag(p,128)&&(s|=16),P.hasFlag(p,256)&&(s|=32),P.hasFlag(p,512)&&(s|=64),P.hasFlag(p,1024)&&(s|=128),P.hasFlag(p,16384)&&(s|=512),P.hasFlag(p,32768)&&(s|=1024),P.hasFlag(p,131072)&&(s|=2048),P.hasFlag(p,8192)&&(this._newVariations=d.getSimpleColumnRefsInScope()),(P.hasFlag(p,524288)||P.hasFlag(p,65536))&&(this._axes=e.matchObjects.axes),P.hasFlag(p,524288)&&(s|=8192),P.hasFlag(p,1048576)&&(this._calendars=e.matchObjects.calendars)}else t=!0;t&&(r=r.concat(e.getTablesInScopeForQualifiedColRefs()),i=i.concat(e.getSimpleColumnRefsInScope()),a=a.concat(e.variables),this._tablesForMeasures=e.matchObjects.tables.filter(function(v){return v.isUserTable}),this._measures=e.matchObjects.measures,s|=20495,s|=256),e.groupByCurrentTable||(s&=-9),this._tablesForQualifiedColumnRefs=r.filter(function(v){return v.isUserTable}),this._simpleColumnRefs=i,this._enumValues=o,this._variables=a,this._functions=_.filter(e.matchObjects.functions,function(v){return!!(v.role&s)})}return Object.defineProperty(n.prototype,"tables",{get:function(){return this._tables},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tablesForMeasures",{get:function(){return this._tablesForMeasures},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"tablesForQualifiedColumnRefs",{get:function(){return this._tablesForQualifiedColumnRefs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"simpleColumnRefs",{get:function(){return this._simpleColumnRefs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"enumValues",{get:function(){return this._enumValues},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"variables",{get:function(){return this._variables},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"measures",{get:function(){return this._measures},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functions",{get:function(){return this._functions},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"newVariations",{get:function(){return this._newVariations},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"axes",{get:function(){return this._axes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"calendars",{get:function(){return this._calendars},enumerable:!1,configurable:!0}),n}(),Lr=function(){return function(e,t){this.suggestion=e,this.replaceStart=t}}(),wo=_.memoize(function(n,e){return new zn(n,e)}),zn=function(){function n(e,t){this.initializeRules(e,t)}return n.prototype.isTokenComplete=function(e){var t=_.find(this.rules,function(r){return r.tokenType===e.type});return!(!t||t.canBeExtendedByIdentifier)},n.prototype.nextToken=function(e,t,r){this.uberRegExp.lastIndex=t;var i=this.uberRegExp.exec(e.substr(0,r));if(!i)return new je(59,e,t,e.length-t);if(i.index>t)return new je(59,e,t,i.index-t);for(var a,o=i[0],s=0,c=this.rules;s<c.length;s++){var l=c[s],d=l.regExp.exec(o);if(d&&0===d.index&&d[0].length===o.length){a=new je(l.tokenType,e,t,o.length,l.isIgnorable);break}}switch(Y(a,"Given that the uber-regexp found a match, one of the token rules must also match"),a.type){case 3:a=this.adjustMLCommentToken(a,r);break;case 58:a=this.adjustIdentifierToken(a)}return a},n.prototype.adjustIdentifierToken=function(e){var t=e.getString(),r=_.find(this.keywordRules,function(o){return j.equalIgnoreCase(o.keyword,t)}),i=r?r.tokenType:0;return 0!==i?new je(i,e.expression,e.startPosition,e.length,e.ignorable):e},n.prototype.adjustMLCommentToken=function(e,t){for(var r=1,i=e.expression,o=e.endPosition;o<t;){var a=i[o++];switch(a){case"*":if(o<t&&"/"===(a=i[o++])&&0==--r)return new je(2,i,e.startPosition,o-e.startPosition,e.ignorable);break;case"/":o<t&&"*"===(a=i[o++])&&++r}}return new je(3,i,e.startPosition,o-e.startPosition,e.ignorable)},n.prototype.initializeRules=function(e,t){this.rules=[],this.addRule(3,"/\\*",!0,!0),this.addRule(4,"//.*\\n",!1,!0),this.addRule(5,"//.*",!0,!0),this.addRule(6,"--.*\\n",!1,!0),this.addRule(7,"--.*",!0,!0),this.addOperatorRule(9,"=="),this.addOperatorRule(10,"<>"),this.addOperatorRule(11,"<="),this.addOperatorRule(12,">="),this.addOperatorRule(13,"&&"),this.addOperatorRule(14,"\\|\\|"),this.addOperatorRule(15,"<"),this.addOperatorRule(16,">"),this.addOperatorRule(17,"="),this.addOperatorRule(18,"\\^"),this.addOperatorRule(28,"&"),this.addOperatorRule(19,"\\+"),this.addOperatorRule(20,"-"),this.addOperatorRule(21,"\\*"),this.addOperatorRule(22,"/"),this.addOperatorRule(23,"\\("),this.addOperatorRule(24,"\\)"),this.addOperatorRule(25,"\\{"),this.addOperatorRule(26,"}"),this.addOperatorRule(27,e),this.addRule(29,"[\\s\\t\\r\\n]+",!1,!0),this.addDelimitedIdentifierRule(30,31,'"','"'),this.addDelimitedIdentifierRule(32,33,"'","'"),this.addDelimitedIdentifierRule(34,35,"[","]");var r=_.escapeRegExp(t),i="(([0-9]+"+r+"[0-9]*)|([0-9]*"+r+"[0-9]+)|([0-9]+))";this.addRule(38,'[dD][tT]"[^"]+"',!1,!1),this.addRule(39,'[dD][tT]"[^"]*',!1,!1),this.addRuleWithUberPattern(36,i+"([eE][+\\-]?[0-9]+)?",!1,!1,i+"([eE][+\\-]?[0-9]*)?"),this.addRuleWithUberPattern(37,i+"([eE][+\\-]?)",!1,!1,void 0),this.addOperatorRule(40,"\\."),this.addRule(57,"evaluateandlog",!1,!1,!0),this.addRule(58,"[a-zA-Z_][a-zA-Z_0-9.]*",!0,!1),this.keywordRules=[],this.keywordRules.push({keyword:"var",tokenType:42}),this.keywordRules.push({keyword:"return",tokenType:43}),this.keywordRules.push({keyword:"not",tokenType:44}),this.keywordRules.push({keyword:"evaluate",tokenType:45}),this.keywordRules.push({keyword:"datatable",tokenType:46}),this.keywordRules.push({keyword:"order",tokenType:47}),this.keywordRules.push({keyword:"by",tokenType:48}),this.keywordRules.push({keyword:"start",tokenType:51}),this.keywordRules.push({keyword:"at",tokenType:52}),this.keywordRules.push({keyword:"asc",tokenType:49}),this.keywordRules.push({keyword:"desc",tokenType:50}),this.keywordRules.push({keyword:"define",tokenType:53}),this.keywordRules.push({keyword:"measure",tokenType:54}),this.keywordRules.push({keyword:"in",tokenType:55}),this.buildUberPattern()},n.prototype.buildUberPattern=function(){for(var e="",t=!0,r=0,i=this.rules;r<i.length;r++){var o=i[r];o.uberPattern&&(t||(e+="|"),e+="("+(o.uberPattern||o.regExp.source)+")",t=!1)}this.uberRegExp=new RegExp(e,"g")},n.prototype.addDelimitedIdentifierRule=function(e,t,r,i){this.addRuleWithUberPattern(e,n.delimitedIdentifier(r,i),!1,!1,n.delimitedIdentifierStartOrComplete(r,i)),this.addRuleWithUberPattern(t,n.delimitedIdentifierStart(r,i),!0,!1,void 0)},n.prototype.addOperatorRule=function(e,t){this.addRule(e,t,!1,!1)},n.prototype.addRule=function(e,t,r,i,o){void 0===o&&(o=!1),this.addRuleWithUberPattern(e,t,r,i,t,o)},n.prototype.addRuleWithUberPattern=function(e,t,r,i,o,a){void 0===a&&(a=!1),this.rules.push({tokenType:e,regExp:new RegExp(t,a?"i":""),canBeExtendedByIdentifier:r,isIgnorable:i,uberPattern:o})},n.delimitedIdentifierStartOrComplete=function(e,t){return n.delimitedIdentifier(e,t)+"?"},n.delimitedIdentifier=function(e,t){return n.delimitedIdentifierStart(e,t)+"("+_.escapeRegExp(t)+")"},n.delimitedIdentifierStart=function(e,t){return e=_.escapeRegExp(e),t=_.escapeRegExp(t),"(".concat(e,")([^").concat(t,"]|(").concat(t).concat(t,"))*")},n}(),Io=zn.delimitedIdentifier("[","]"),Mo=zn.delimitedIdentifierStart("[","]");function ln(n,e,t,r,i,o,a){var s,c=o?Be():gr,l=wo(c.listSeparator,c.numberDecimalSeparator),d=new Vn(n,e,t,r),p=0,v=n.length,b=d.activeCursor;b&&V(null!=t,"cursorPosition must have value if the cursor is active");var C=[],y={stopPosition:v},O=i&&cn(d,i,!1,C,y);if(O||(O=a&&cn(d,a,!1,C,y)),O||(O=i&&cn(d,i,!0,C,y)),O||(O=a&&cn(d,a,!0,C,y)),v=y.stopPosition,i){var x=v;i.activeCursor&&(x=Math.min(x,i.cursorPosition||0)),b&&(x=Math.min(x,t||0));for(var g=0,S=i.tokens;g<S.length;g++){V(i.expression.length>=(T=S[g]).startPosition+T.length,"expected token to be within the bounds of the expression");var I=T.startPosition+T.length;if(x<=I||i.expression.length<=I||n[I]!==i.expression[I]||!j.equalIgnoreCase(n.substr(T.startPosition,T.length),i.expression.substr(T.startPosition,T.length)))break;V(60!==T.type,"cannot reuse NewToken"),d.tokens.push(T)}if(d.tokens.length>0){var w=d.tokens[d.tokens.length-1];p=w.startPosition+w.length}}for(;p<v;){var T=l.nextToken(n,p,v);if(b&&T.startPosition<t&&T.startPosition+T.length>t){for(;p<t;){var A=l.nextToken(n,p,t);d.tokens.push(A),p+=A.length}T.markAsSecondHalf(t)}b&&(T.startPosition===t?(Gn(0,n,d.tokens),d.parseTokenCount=d.tokens.length):T.endPosition===t&&(T.activelyEdited=!0)),d.tokens.push(T),p+=T.length}if(b)p===t&&Gn(0,n,d.tokens),-1===d.parseTokenCount&&(d.parseTokenCount=d.tokens.length),(s=d.tokens).push.apply(s,C);else{if(0!==d.cursorActivity&&t>=0){var F=!1;V(p>=t,"currentPosition >= cursorPosition");for(var B=p,W=d.tokens.length;;){if(B===t){F=!0;break}if(V(B>t,"effectiveEndPosition > cursorPosition"),V(W>0,"iToken > 0"),W--,(B=(T=d.tokens[W]).startPosition)<t){F=29===T.type;break}if(!T.ignorable)break}F&&Gn(0,n,d.tokens)}d.parseTokenCount=d.tokens.length}return d}function Gn(n,e,t){var r=!0,i=0;if(_.some(t)){var o=_.last(t);(r=o.isComplete)&&(i=o.startPosition+o.length)}r&&t.push(new je(60,e,i,0))}function cn(n,e,t,r,i){if(0===e.expression.length)return!1;if(n.activeCursor){var o=e.expression,a=n.expression,s=0===e.cursorActivity?0:Math.max(0,e.cursorPosition||0),c=Math.max(0,n.cursorPosition||0),l=o.length-s,d=a.length-c,p=t?Math.min(l,d):d,v=o.substr(o.length-p),b=a.substr(a.length-p);if(l>=p&&j.equalIgnoreCase(v,b)){for(var C=a.length-o.length,y=p,O=e.tokens.length-1;O>=0&&y>0;O--){var x=e.tokens[O];if(60!==x.type){var g=x.startPosition+C,S=x.length,T=x.secondHalf;S>y&&(g+=S-y,S=y,T=!0),r.unshift(x.cloneForReuse(a,g,S,T)),y-=S}else V(0===x.length,"token.length === 0")}return d>p&&r.unshift(new je(61,a,c,d-p)),i.stopPosition=c,!0}}return!1}fr.initialize(function(n,e){var t=n.trimEnd();if("]"!==t[t.length-1])return!1;var r=ln(n,0,void 0,void 0,void 0,!0),i=new me(void 0),o=new Br(void 0,function(){return i});return o.update(r),o.anyErrors?(e.table=void 0,e.column=void 0,!1):i.tryGetTableAndColumnNames(e)});var ct=function(n){return n[n.LegacyDefaultBehavior=0]="LegacyDefaultBehavior",n[n.AddMissingParens=1]="AddMissingParens",n[n.ConvertToEngine=2]="ConvertToEngine",n[n.Anonymize=4]="Anonymize",n}({}),Qe=function(n){return n[n.Expression=0]="Expression",n[n.Query=1]="Query",n[n.MultipleQueries=2]="MultipleQueries",n[n.MaskExpressionType=3]="MaskExpressionType",n}({}),Ve=function(){function n(e){void 0===e&&(e=Qe.Expression),this.options=e,this.clearParseState()}return Object.defineProperty(n.prototype,"parseTree",{get:function(){return this._parseTree},enumerable:!1,configurable:!0}),n.findCursorTokens=function(e){var t={iToken:-1,iNewToken:-1,iTokenLeft:-1,iTokenRight:-1,iTokenPrev:-1,iTokenSelection:-1};if(0!==e.cursorActivity){for(var r=e.cursorPosition||0,i=e.parseTokenCount-1;i>=0;i--)if(!(o=e.tokens[i]).ignorable&&(o.startPosition===r?o.length>0?t.iTokenRight=i:(V(60===o.type,"expected newToken"),t.iNewToken=i):o.startPosition+o.length===r&&(t.iTokenLeft=i),o.startPosition<r)){t.iTokenPrev=i;break}var a=e.selectionStart||0;if(a>=0)for(i=e.parseTokenCount-1;i>=0;i--){var o;if(!((o=e.tokens[i]).startPosition>=a)){o.startPosition+o.length>a&&29!==o.type&&(t.iTokenSelection=-1);break}o.ignorable||(t.iTokenSelection=i)}}return t},n.isUnrecognizedIdentifier=function(e){var t=e.token;return V(t.isAnyKindOfIdentifier,"Expected IsUnrecognizedIdentifier to be called with an identifier node"),!t.matchObject&&!(e.parent instanceof Ne||e.parent instanceof Jt)},n.checkSemiselectability=function(e,t,r,i){-1!==r&&(i.semiselectable=_.some(t.getValidLeafNodesAtPosition(r),un.couldBeOperand))},n.updateSuggestions=function(e,t,r,i,o){var a=new Po(e,t,r,i);a.buildSuggestions(),o.suggestions=a.suggestions,o.replaceStart=a.replaceStart,o.replaceEnd=a.replaceEnd,o.afterOParen=a.afterOParen,o.afterCParen=a.afterCParen,o.bestMatch=a.bestMatch},n.checkBoldParens=function(e,t,r,i,o){var a;if(-1!==r&&24===e.tokens[r].type?a=_.map(t.getValidLeafNodesAtPosition(r),function(C){return C.parent}):-1!==i&&23===e.tokens[i].type&&(a=_.map(t.getValidLeafNodesAtPosition(i),function(C){return C.parent})),a){for(var s,c,l=0,d=a;l<d.length;l++){var p=d[l],v=N(p,_n);if(v){s=v.leftParen,c=v.rightParen;break}var b=p instanceof Ct?p:null;if(b){s=b.leftParen,c=b.rightParen;break}}s&&c&&(o.boldLeftParen=s.token.startPosition,o.boldRightParen=c.token.startPosition)}},n.checkPrototype=function(e,t,r){var i,o;if(-1!==t)for(var a=0,s=e.getValidLeafNodesAtPosition(t);a<s.length;a++){var l=void 0,d=void 0;for(d=(l=s[a]).parent;d;l=d,d=d.parent){var p=void 0,v=void 0,b=void 0;if(p=N(d,it)){var C=p.getParamIndex(l);(y=p.getParameterByIndex(C))&&(i=r.prototypeParamContexts).push.apply(i,y.context.parameterContexts)}else if((v=d instanceof Ct?d:void 0)&&(b=v.functionNode)&&l!==v.rightParen){var O=v.leftParen,x=b.token;if(r.prototypeFunctionBase=N(x.matchObject,wt),r.prototypePosition=x.startPosition,l===O){var y=void 0;(p=v.parameterList)&&(y=p.getParameterByIndex(0)),y?(o=r.prototypeParamContexts).push.apply(o,y.context.parameterContexts):r.prototypeParamContexts.push(new yn)}if(l!==b)break}}if(r.prototypeFunctionBase)break}},n.userEditingNode=function(e,t){if(!e.activeCursor)return!1;for(var r=t.token,i=r,o=t.parent;o instanceof kt||o instanceof me||o instanceof Tr||o instanceof Tt||o instanceof Ne;o=o.parent)r=o.firstDescendent.token,i=o.lastDescendent.token;var a=e.cursorPosition||0;return r.startPosition<=a&&a<=i.endPosition},n.updateSyntaxHighlighting=function(e,t){for(var r,i=0;i<e.tokens.length;i++){var o=e.tokens[i];o.isComment?t.comments.push(o.getSegment()):o.isKeyword?t.functions.push(o.getSegment()):30===o.type||31===o.type?t.strings.push(o.getSegment()):33===o.type||35===o.type||39===o.type?t.unrecognizedIdentifiers.push(o.getSegment()):o.isAnyKindOfIdentifier&&(o.matchObject instanceof pe||o.matchObject instanceof Ke||o.matchObject instanceof rt||o.matchObject instanceof Pe?t.functions.push(o.getSegment()):o.matchObject instanceof de?t.tableReferences.push(o.getSegment()):o.matchObject instanceof ue?t.columnReferences.push(o.getSegment()):o.matchObject instanceof ye?t.measureReferences.push(o.getSegment()):o.matchObject instanceof Me?t.variables.push(o.getSegment()):i<e.parseTokenCount&&t.unrecognizedIdentifiers.push(o.getSegment()))}(r=t.references).push.apply(r,(0,h.__spreadArray)((0,h.__spreadArray)((0,h.__spreadArray)([],t.tableReferences,!1),t.columnReferences,!1),t.measureReferences,!1))},n.detectErrors=function(e,t,r){for(var i,o=0,a=t.leafPositions;o<a.length;o++){for(var c=void 0,l=0,d=a[o].validNodes;l<d.length;l++){var v=n.errorsAtNode(e,d[l],t.context);(!c||v.length<c.length)&&(c=v)}c&&(i=r.errors).push.apply(i,c)}},n.errorsAtNode=function(e,t,r){var i=[],o=t.token;if(t instanceof At){if(n.userEditingNode(e,t))switch(o.type){case 60:case 40:return i}return i.push(new Ee(o.getSegment(),H.Gramatical)),i}if(n.userEditingNode(e,t)||!t.parent)return i;if(t instanceof ut){var a=N(t.parent,an);a&&!a.isInValidLocation&&i.push(new Ee(a.fullSpan,H.InvalidTupleLocation))}if(t instanceof Nn){var c=N(t.parent,Rt).invalidRightArgument;c&&i.push(new Ee(c.fullSpan,H.RightArgumentToInOperatorNotValidTable))}if(t instanceof In&&t.parent instanceof ot){var l=t.parent.measureDef;if(l?.isComplete){var d=l.tableName,p=l.identifier,v=r.matchObjects.measures.find(function(Oe){return!Oe.isQueryScoped&&Oe.name.toLowerCase()===p?.toLowerCase()});v&&v.table.name.toLowerCase()!==d?.toLowerCase()&&i.push(new Ee(l.fullSpan,H.DuplicateMeasureName))}}if(o.isAnyKindOfIdentifier&&(t.parent instanceof xn&&_.some(Object.keys(t.context.matchObjects.reservedWords),function(Oe){return j.equalIgnoreCase(Oe,o.getString())})&&i.push(new Ee(o.getSegment(),H.VariableNameReserved)),n.isUnrecognizedIdentifier(t)&&i.push(new Ee(o.getSegment(),H.UnrecognizedIdentifier))),37===o.type&&i.push(new Ee(o.getSegment(),H.IncompleteNumber)),o.isIdentifierOrKeyword){var b=t.parent instanceof Ct?t.parent:null;if(b){var C=N(o.matchObject,wt);if(C){var y=b.parameterList,O=function(n,e,t){for(var r=new no,i=n.getParamCount(t),o=n.signatures.map(function(v){return new $t(e,v,t,i,!1)}),a=qt.getAllExploredStates(o),l=0,d=a.completedStates.concat(a.incompleteStates);l<d.length;l++){var p=d[l];r.assessStatus(p.actualParam,i,p.prototypeParam,p.prototypeSignature)}return r}(C,b.context,y),x=H.InvalidParameter;if(!O.success){var g=b.rightParen,S=void 0,T=void 0;if(O.incomplete)g&&(S=T=g.token,x=H.MissingParameters);else if(O.badParam>-1){if(O.badParam!==y.parameterCount-1||g){var I=y.getParameterByIndex(O.badParam);if(I){S=I.firstDescendent.token,T=I.lastDescendent.token;var w=O.associatedSignature;O.badParam<w.length&&(w[O.badParam].role===u.OrderByParam&&(x=H.IncorrectOrderByParam),w[O.badParam].role===u.PartitionByParam&&(x=H.IncorrectPartitionByParam),w[O.badParam].role===u.MatchByParam&&(x=H.IncorrectMatchByParam))}else{var A=y.getSeparatorByIndex(O.badParam+1);A||(A=g),S=T=A.token}}}else O.firstExtraParam>-1&&(x=H.TooManyParameters,S=(0===O.firstExtraParam?y.firstDescendent:y.getSeparatorByIndex(O.firstExtraParam)).token,T=y.lastDescendent.token);S&&i.push(new Ee(tt.fromTokens(S,T),x))}}else i.push(new Ee(o.getSegment(),H.FunctionCallOnNonFunction))}var B=N(t.parent,Ne);if(B)if(D.hasValidAxesReferences(B.axesRef)||B.isValidEnumValue||t!==B.firstIdentifier){if(D.hasValidAxesReferences(B.axesRef)&&t===B.firstIdentifier){var J=B.axesRef,q=B.firstIdentifier.token,Ze=B.lastIdentifier.token;_.uniqWith(J,to).length!==J.length&&i.push(new Ee(tt.fromTokens(q,Ze),H.InvalidParameter))}}else for(var W=1;W<B.children.length;W++)i.push(new Ee(B.getIdentifier(W).token.getSegment(),H.InvalidIdentifier))}return i},n.getResult=function(e,t,r){r=r||{};var i=new Un(e.expression,e.cursorActivity,e.cursorPosition,e.selectionStart);if(!r.disableAll){var o=n.findCursorTokens(e);n.checkSemiselectability(e,t,o.iTokenSelection,i),r.disableSuggestions||n.updateSuggestions(e,t,o.iNewToken,o.iTokenLeft,i),n.checkBoldParens(e,t,o.iTokenLeft,o.iTokenRight,i),n.checkPrototype(t,o.iTokenPrev,i),r.disableSyntaxHighlighting||n.updateSyntaxHighlighting(e,i),r.disableErrorDetection||n.detectErrors(e,t,i)}return i},n.prototype.tryBindQualifiedReference=function(e,t){V(34===e.type,"expected BracketedIdentifier"),V(t.token===e,"expected BracketedIdentifier");var r=N(t.parent,me);if(r){var a=r.tableRefNode.tableNode.token,s=a.getString();32===a.type&&(s=n.unquote(s));for(var c=n.unbracket(e.getString()),l=0,d=_.filter(r.context.getAllTablesInScopeForQualifiedColRefs(),function(y){return qe(y.name,s)});l<d.length;l++){var p=d[l],v=p.findColumn(c);if(v)return a.matchObject=p,e.matchObject=v,!0}var b=r.context.matchObjects.findTable(s),C=b?.findMeasure(c);return C&&(a.matchObject=b,e.matchObject=C),!0}return!1},n.prototype.tryBindVariation=function(e,t){V(34===e.type,"expected brackedIdentifierToken"),V(t.token===e,"expected brackedIdentifierToken");var r=N(t.parent,Tt);if(r){var i=n.unbracket(e.getString()),o=r.variationSource,a=o.token,s=a.matchObject;if(s&&s.variationTable&&(e.matchObject=s.variationTable.findColumn(i)),!e.matchObject){var l,c=void 0;o.parent instanceof me&&(l=(c=o.parent.tableRefNode.tableNode.token).getIdentifier());var d=a.getIdentifier(),p=_.find(r.context.getAllSimpleColRefsInScope(),function(v){return!!v.table.variationSource&&qe(v.name,i)&&qe(v.table.variationSource.name,d)&&(!l||qe(v.table.variationSource.table.name,l))});p&&(c&&(c.matchObject=p.table.variationSource.table),a.matchObject=p.table.variationSource,e.matchObject=p)}return!0}return!1},n.prototype.bindTokens=function(e,t){for(var r=e.tokens,i=0;i<e.parseTokenCount;i++)this.bindToken(r[i],this._parseTree.getValidLeafNodesAtPosition(i),t)},n.prototype.bindToken=function(e,t,r){if(!e.matchObject)for(var i=function(p){switch(e.type){case 58:var v=p.parent;if(v instanceof Ne){if(o.tryBindMultiAxisReference(e,N(v,Ne))||o.tryBindMultiEnumValue(e,N(v,Ne)))return{value:void 0};break}var b=e.getString();if(e.matchObject=r.findAxis(b))return e.matchObject=new Pe(b),{value:void 0};var C=N(v,ke);if(C&&C.identifier===p)return e.matchObject=new Me(b,C),{value:void 0};if(e.matchObject=r.findFunction(b))return{value:void 0};if(_.includes(Object.keys(r.reservedWords),b))return e.matchObject=new Ke(b),{value:void 0};if(e.matchObject=r.findTable(b))return{value:void 0};if(e.matchObject=_.find(p.context.variables,function(g){return qe(g.name,b)}))return{value:void 0};var y=_.flatMap(p.context.ephemeralContexts,function(g){return g.enumValues}).filter(function(g){return!!g});if(!_.isEmpty(y)&&(e.matchObject=_.find(y,function(g){return qe(g.name,b)})))return{value:void 0};if(e.matchObject=r.findCalendar(b))return{value:void 0};break;case 57:case 46:e.matchObject=r.findFunction(e.getString());break;case 32:var O=n.unquote(e.getString());if(e.matchObject=r.findTable(O))return{value:void 0};if(e.matchObject=r.findCalendar(O))return{value:void 0};break;case 34:if(o.tryBindQualifiedReference(e,p)||o.tryBindVariation(e,p))return{value:void 0};var x=n.unbracket(e.getString());if(e.matchObject=_.find(p.context.getAllSimpleColRefsInScope(),function(g){return qe(g.name,x)}))return{value:void 0};if(e.matchObject=_.find(r.measures,function(g){return qe(g.name,x)}))return{value:void 0};break;case 49:case 50:return e.matchObject=new Ke(e.getString()),{value:void 0}}},o=this,a=0,s=t;a<s.length;a++){var l=i(s[a]);if("object"==typeof l)return l.value}},n.prototype.tryBindMultiAxisReference=function(e,t){var r=e.getString();return!!(e.matchObject=t.context.matchObjects.findAxis(r))&&(e.matchObject=new Pe(r),!0)},n.prototype.tryBindMultiEnumValue=function(e,t){var r=e.getString();return!!t.isValidEnumValue&&(e.matchObject=new rt(r,void 0),!0)},n.prototype.doParse=function(e,t,r,i,o,a){if(void 0===r&&(r=0),void 0===i&&(i=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),t!==this.context&&(this.context=t,this.clearParseState()),e===this.tokenization.expression&&r===this.tokenization.cursorActivity&&i===this.tokenization.cursorPosition&&o===this.tokenization.selectionStart)return a&&(a.tokensMatch=!0),!1;var s=ln(e,r,i,o,this.tokenization,!0,this.penultimateTokenization);return this._parseTree.update(s),this.hasInvalidatedQueries()&&this.doQueryInvalidations(t,s),this.bindTokens(s,t.matchObjects),a&&(a.tokensMatch=s.tokens.length===this.tokenization.tokens.length&&_.isEqual(_.map(s.tokens,function(c){return c.type}),_.map(this.tokenization.tokens,function(c){return c.type}))),this.penultimateTokenization=this.tokenization,this.tokenization=s,!0},n.prototype.hasInvalidatedQueries=function(){var e=N(this._parseTree.rootNode,at);if(e)return e.isInvalidated;if(this._parseTree.rootNode instanceof Bt)for(var r=0,i=this._parseTree.rootNode.queries;r<i.length;r++)if(i[r].isInvalidated)return!0;return!1},n.prototype.doQueryInvalidations=function(e,t){this._parseTree.clearAllContexts(),t.tokens.forEach(function(r){return r.matchObject=void 0}),e.matchObjects.clearDefinedMeasures(),e.matchObjects.clearDefinedVariables()},n.prototype.buildParseTree=function(e,t,r,i){void 0===t&&(t=0),void 0===r&&(r=void 0),void 0===i&&(i=void 0),this.context=void 0,this.clearParseState();var o=ln(e,t,r,i,this.tokenization,!0,this.penultimateTokenization);return this._parseTree.update(o),this._parseTree},n.prototype.parse=function(e,t,r,i,o,a,s){if(0===t)r=void 0,i=void 0;else{if(null==r)throw new Error("cursorPosition is null");if(null==i)throw new Error("selectionStart is null")}if(this.doParse(e,o,t,r,i,s))try{a.result=n.getResult(this.tokenization,this._parseTree)}catch(c){throw c.DaxParserTokenList="["+_.map(this.tokenization.tokens,function(l){return l.type}).join()+"]",c}},n.prototype.tryParse=function(e,t,r,i,o,a,s){if(void 0===r&&(r=void 0),void 0===i&&(i=void 0),void 0===o&&(o=0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),0===o)a=void 0,s=void 0;else{if(null==a)throw new Error("cursorPosition is null");if(null==s)throw new Error("selectionStart is null")}if(this.doParse(e,t,o,a,s)){if(!r)return!0;try{return r.result=n.getResult(this.tokenization,this._parseTree,i),!0}catch(c){throw c.DaxParserTokenList="["+_.map(this.tokenization.tokens,function(l){return l.type}).join()+"]",c}}return!1},n.prototype.getDescription=function(e){for(var t=0,r=this.tokenization.tokens;t<r.length;t++){var i=r[t];if(i.matchObject&&i.startPosition<=e&&i.endPosition>=e)return i.matchObject.description}},n.prototype.getMeasureReferences=function(e,t,r){if(this.clearParseState(),!this.doParse(e,t))return r.unrecognizedMeasures=!0,[];var i={};r.unrecognizedMeasures=!1;for(var o=0;o<this.tokenization.tokens.length;o++){var a=this.tokenization.tokens[o],s=N(a.matchObject,ye);if(s)i[s.name]=s;else if(34===a.type){var c=this._parseTree.getValidLeafNodesAtPosition(o);_.every(c,function(l){return n.isUnrecognizedIdentifier(l)})&&(r.unrecognizedMeasures=!0)}}return _.values(i)},n.prototype.renameReferences=function(e,t,r,i,o){if(this.clearParseState(),!this.doParse(t,r))return t;for(var a="",s=0,c=this.tokenization.tokens;s<c.length;s++){var l=c[s],d=void 0;switch(e){case"column":d=N(l.matchObject,ue);break;case"measure":d=N(l.matchObject,ye);break;case"table":d=N(l.matchObject,de)}d&&j.equalIgnoreCase(d.name,i)?a+=n.delimitIdentifier(l.type,o,r):a+=l.getString()}return a},n.prototype.renameMovedMeasureTableReference=function(e,t,r,i,o){if(this.clearParseState(),!this.doParse(e,t))return e;for(var a=0,s=0;s<this.tokenization.tokens.length;s++){var l=N(this.tokenization.tokens[s].matchObject,ye);if(l&&j.equalIgnoreCase(l.name,r))for(var p=0,v=this._parseTree.getValidLeafNodesAtPosition(s);p<v.length;p++){var C=N(v[p].parent,me);if(C){var y=C.tableRefNode.tableNode.token,O=y.getSegment(),x=n.delimitIdentifier(y.type,o,t);e=e.substr(0,a+O.startPosition)+x+e.substr(a+O.startPosition+O.length),a+=x.length-O.length;break}}}return e},n.prototype.finalParse=function(e,t,r,i){if(void 0===i&&(i=ct.LegacyDefaultBehavior),this.doParse(e,t),r.finalResult=new Er,this._parseTree.anyErrors)r.finalResult.valid=!1;else{var o={expression:e},a=this._parseTree.tryAddClosingParens(!!(i&ct.AddMissingParens),o);r.finalResult.valid=a.result,e=o.expression,r.finalResult.cParensNeeded=a.countParensAdded}i&ct.ConvertToEngine&&(e=n.convertFormatCore(e,this.tokenization,!1)),r.finalResult.updatedExpression=e,i&ct.Anonymize&&(r.finalResult.anonymizedExpression=Sn.buildAnonymousExpression(this.tokenization,t,n.delimitIdentifier)),this.clearParseState()},n.prototype.clearParseState=function(){var t,e=this;switch(this.penultimateTokenization=void 0,this.tokenization=new Vn("",0),this.options&Qe.MaskExpressionType){case Qe.Query:t=function(){return new at(void 0,e.context)};break;case Qe.Expression:t=function(){return new ie(void 0,e.context)};break;case Qe.MultipleQueries:t=function(){return new Bt(void 0,e.context)};break;default:Je("Unknown expression type in option value: "+JSON.stringify(this.options)),t=function(){return new ie(void 0,e.context)}}this._parseTree=new Br(this.context,t)},Object.defineProperty(n,"listSeparator",{get:function(){return Be().listSeparator},enumerable:!1,configurable:!0}),Object.defineProperty(n,"decimalSeparator",{get:function(){return Be().numberDecimalSeparator},enumerable:!1,configurable:!0}),n.quoteIfNeeded=function(e,t){return n.quoteNeeded(e,t)?n.quote(e):e},n.quoteNeeded=function(e,t){return D.quoteNeeded(e,t instanceof te?t:function(){return Le.isReservedWord(e,t)})},n.quote=function(e){return n.quotePartial(e)+"'"},n.quotePartial=function(e){return"'"+e.replace(/'/g,"''")},n.unquote=function(e){return n.unquotePartial(e.substr(0,e.length-1))},n.unquotePartial=function(e){return e.substr(1).replace(/''/g,"'")},n.DoubleQuote=function(e){return'"'.concat(e.replace(/"/g,'""'),'"')},n.unDoubleQuote=function(e){return e.substr(1,e.length-2).replace(/""/g,'"')},n.bracket=function(e){return n.bracketPartial(e)+"]"},n.bracketPartial=function(e){return"["+e.replace(/\]/g,"]]")},n.delimitIdentifier=function(e,t,r){return n.delimitIdentifierInternal(e,t,function(){return n.quoteIfNeeded(t,r)})},n.delimitIdentifierInternal=function(e,t,r){switch(e){case 32:return n.quote(t);case 33:return n.quotePartial(t);case 34:return n.bracket(t);case 35:return n.bracketPartial(t);default:return V(58===e,"expected identifier type"),r()}},n.unbracket=function(e){return n.unbracketPartial(e.substr(0,e.length-1))},n.unbracketPartial=function(e){return e.substr(1).replace(/\]\]/g,"]")},n.isFormulaTranslationNeeded=function(){return"."!==n.decimalSeparator||","!==n.listSeparator},n.convertFormat=function(e,t){return n.convertFormatCore(e,void 0,t)},n.convertFormatCore=function(e,t,r){var i=","!==n.listSeparator,o="."!==n.decimalSeparator,s=!r&&-1!==e.indexOf("\xa0");if(i||o||s){var c="";t||(t=ln(e,0,void 0,void 0,void 0,!r));var l=void 0,d=void 0,p=void 0;r?(l=n.listSeparator,d=".",p=n.decimalSeparator):(l=",",d=n.decimalSeparator,p=".");for(var v=0,b=0,C=t.tokens;b<C.length;b++){var y=C[b],O=y.getString(),x=O;switch(y.offsetPosition(v),y.type){case 27:i&&(x=l);break;case 36:o&&(x=O.replace(d,p));break;case 29:s&&(x=O.replace("\xa0"," "))}v+=x.length-O.length,c+=x}e=c,t.tokens.forEach(function(g){return g.attachToNewExpression(e)})}return e},n.convertToUI=function(e){return n.convertFormat(e,!0)},n.convertToEngine=function(e){return n.convertFormat(e,!1)},n}();function qe(n,e){return j.equalIgnoreCase(n,e)}var U=function(){function n(){}return n.prototype.toTraceString=function(){return this.toString(!0)},n.prototype.toString=function(e){void 0===e&&(e=!1);try{var t=new Xr(e);return this.accept(t)}catch(r){if(e)return r.ToString()}},n.Comparer={equals:function(t,r){return t.toLowerCase()===r.toLowerCase()}},n}(),Ut=function(n){function e(t,r){var i=n.call(this)||this;return i.left=t,i.right=r,Y(t,"left expression should not be null"),Y(r,"right expression should not be null"),i}return(0,h.__extends)(e,n),e.prototype.equals=function(t){return null!=t&&t instanceof e&&this.left.equals(t.left)&&this.right.equals(t.right)&&this.equalsCore(t)},e}(U),kr=function(n){function e(t,r,i){var o=n.call(this,r,i)||this;return o.comparison=t,o}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitComparison(this,r)},e.prototype.equalsCore=function(t){return t instanceof e&&this.comparison===t.comparison},e}(Ut),jr=function(n){function e(t,r,i){var o=n.call(this,r,i)||this;return o.operator=t,o}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitLogicalOperation(this,r)},e.prototype.equalsCore=function(t){return t instanceof e&&this.operator===t.operator},e}(Ut),Ur=function(n){function e(t,r,i){var o=n.call(this,r,i)||this;return o.operation=t,o}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitArithmetic(this,r)},e.prototype.equalsCore=function(t){return t instanceof e&&this.operation===t.operation},e}(Ut),Ro=function(n){function e(t){var r=n.call(this)||this;return r.value=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitDateTimeLiteral(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.value===t.value},e}(U),Kn=function(n){function e(t,r){var i=n.call(this)||this;return i.value=t,i.type=r,i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitConstantScalar(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.value===t.value&&this.type===t.type},e}(U),Vr=function(n){function e(t){var r=n.call(this)||this;return r.expression=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitNot(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.expression.equals(t.expression)},e}(U),Wn=function(n){function e(t){var r=n.call(this)||this;return r.expression=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitNegation(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.expression.equals(t.expression)},e}(U),Hr=function(n){function e(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=n.call(this)||this;return o.functionName=t,o.parameters=r,o}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitFunction(this,r)},e.prototype.equals=function(t){if(!(t instanceof e&&U.Comparer.equals(this.functionName,t.functionName)&&this.parameters.length===t.parameters.length))return!1;for(var r=0;r<this.parameters.length;r++)if(!this.parameters[r].equals(t.parameters[r]))return!1;return!0},e}(U),Qn=function(n){function e(t){var r=n.call(this)||this;return r.tableName=t,r}return(0,h.__extends)(e,n),e}(U),_o=function(n){function e(t){var r=n.call(this,t)||this;return r.tableName=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitTableReference(this,r)},e.prototype.equals=function(t){return t instanceof e&&U.Comparer.equals(this.tableName,t.tableName)},e}(Qn),zr=function(n){function e(t,r){var i=n.call(this,t)||this;return i.tableName=t,i.propertyName=r,i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitColumnReference(this,r)},e.prototype.equals=function(t){return t instanceof e&&U.Comparer.equals(this.tableName,t.tableName)&&U.Comparer.equals(this.propertyName,t.propertyName)},e}(Qn),Do=function(n){function e(t,r){var i=n.call(this,t)||this;return i.propertyName=r,i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitMeasureReference(this,r)},e.prototype.equals=function(t){return t instanceof e&&U.Comparer.equals(this.tableName,t.tableName)&&U.Comparer.equals(this.propertyName,t.propertyName)},e}(Qn),Gr=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitTextConcatenation(this,r)},e.prototype.equalsCore=function(t){return t instanceof e},e}(Ut),Kr=function(n){function e(t,r){return n.call(this,t,r)||this}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitIn(this,r)},e.prototype.equalsCore=function(t){return t instanceof e},e}(Ut),qn=function(n){function e(t){var r=n.call(this)||this;return r.items=t,Y(r.items,"items should not be null"),r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitRowConstructor(this,r)},e.prototype.equals=function(t){if(!(t instanceof e)||this.items.length!==t.items.length)return!1;for(var r=0;r<this.items.length;r++)if(!this.items[r].equals(t.items[r]))return!1;return!0},e}(U),Wr=function(n){function e(t){var r=n.call(this)||this;return r.rows=t,Y(r.rows,"rows should not be null"),r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitTableConstructor(this,r)},e.prototype.equals=function(t){if(!(t instanceof e)||this.rows.length!==t.rows.length)return!1;for(var r=0;r<this.rows.length;r++)if(!this.rows[r].equals(t.rows[r]))return!1;return!0},e.empty=new e([]),e}(U),Fo=function(n){function e(t,r){var i=n.call(this)||this;return i.name=t,i.definition=r,i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitMeasureExpression(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.name.equals(t.name)&&this.definition.equals(t.definition)},e}(U),Ye=function(n){return n.Asc="ASC",n.Desc="DESC",n.True="TRUE",n.False="FALSE",n}({}),Xe=function(n){function e(t){var r=n.call(this)||this;return r.value=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitKeyword(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.value===t.value},e.Asc=new e(Ye.Asc),e.Desc=new e(Ye.Desc),e.True=new e(Ye.True),e.False=new e(Ye.False),e}(U),Bo=function(n){function e(t){var r=n.call(this)||this;return r.axis=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitAxis(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.axis===t.axis},e}(U),Lo=function(n){function e(t){var r=n.call(this)||this;return r.expressions=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitMultiIdentifier(this,r)},e.prototype.equals=function(t){if(!(t instanceof e)||this.expressions.length!==t.expressions.length)return!1;for(var r=this.expressions.length,i=0;i<r;i++)if(!this.expressions[i].equals(t.expressions[i]))return!1;return!0},e}(U),ko=function(n){function e(t){var r=n.call(this)||this;return r.value=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitEnum(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.value===t.value},e}(U),jo=function(n){function e(){return n.call(this)||this}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitOmittedArgument(this,r)},e.prototype.equals=function(t){return this===t},e.instance=new e,e}(U),G=function(n){function e(t){var r=n.call(this)||this;return Y(t,"nodeOrExpressionText should be defined"),r.expressionText=t instanceof En?t.fullSpan.text:t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitUnknown(this,r)},e.prototype.equals=function(t){return t instanceof e&&U.Comparer.equals(this.expressionText,t.expressionText)},e}(U),Uo=function(n){function e(t,r){var i=n.call(this)||this;return i.name=t,i.definition=r,V(!j.isNullOrEmpty(t),"name should not be null or empty"),Y(r,"definition should not be null"),i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitVariableDefinition(this,r)},e.prototype.equals=function(t){return t instanceof e&&U.Comparer.equals(this.name,t.name)&&this.definition.equals(t.definition)},e}(U),Vo=function(n){function e(t,r){var i=n.call(this)||this;return i.variables=t,i.returnExpression=r,Y(t,"variables should not be null"),Y(r,"returnExpression should not be null"),i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitVarReturn(this,r)},e.prototype.equals=function(t){if(!(t instanceof e&&this.variables.length===t.variables.length&&this.returnExpression.equals(t.returnExpression)))return!1;for(var r=0;r<this.variables.length;r++)if(!this.variables[r].equals(t.variables[r]))return!1;return!0},e}(U),Ho=function(n){function e(t){var r=n.call(this)||this;return r.name=t,V(!j.isNullOrEmpty(t),"name should not be null or empty"),r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitVariableReference(this,r)},e.prototype.equals=function(t){return t instanceof e&&U.Comparer.equals(this.name,t.name)},e}(U),Qr=function(n){function e(t,r,i){var o=n.call(this)||this;return o.tableName=t,o.variationSourceName=r,o.targetPropertyName=i,Y(r,"variationSourceName should not be null"),Y(i,"targetPropertyName should not be null"),o}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitVariationColumnReference(this,r)},e.prototype.equals=function(t){return t instanceof e&&U.Comparer.equals(this.tableName,t.tableName)&&U.Comparer.equals(this.variationSourceName,t.variationSourceName)&&U.Comparer.equals(this.targetPropertyName,t.targetPropertyName)},e}(U),zo=function(n){function e(t){var r=n.call(this)||this;return r.values=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitStartAt(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.values.length===t.values.length&&this.values.every(function(r,i){return r.equals(t.values[i])})},e}(U),Go=function(n){function e(t,r){var i=n.call(this)||this;return i.clause=t,i.direction=r,i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitSort(this,r)},e.prototype.equals=function(t){return!!(t instanceof e&&this.clause.equals(t.clause))&&(!this.direction||!!t.direction&&this.direction.equals(t.direction))},e}(U),Ko=function(n){function e(t,r){var i=n.call(this)||this;return i.sortClauses=t,i.startAt=r,i}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitOrderBy(this,r)},e.prototype.equals=function(t){if(!(t instanceof e)||this.sortClauses.length!==t.sortClauses.length)return!1;for(var r=0;r<this.sortClauses.length;r++)if(!this.sortClauses[r].equals(t.sortClauses[r]))return!1;return!this.startAt||!!t.startAt&&this.startAt.equals(t.startAt)},e}(U),qr=function(n){function e(t,r,i){var o=n.call(this)||this;return o.definitions=t,o.evaluate=r,o.orderBy=i,o}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitQuery(this,r)},e.prototype.equals=function(t){var r,i;if(!(t instanceof e)||(null===(r=this.definitions)||void 0===r?void 0:r.length)!==(null===(i=t.definitions)||void 0===i?void 0:i.length))return!1;for(var o=0;o<this.definitions.length;o++)if(!this.definitions[o].equals(t.definitions[o]))return!1;return!!this.evaluate.equals(t.evaluate)&&(!this.orderBy||!!t.orderBy&&this.orderBy.equals(t.orderBy))},e}(U),Wo=function(n){function e(t){var r=n.call(this)||this;return r.queries=t,r}return(0,h.__extends)(e,n),e.prototype.accept=function(t,r){return t.visitQueries(this,r)},e.prototype.equals=function(t){return t instanceof e&&this.queries.length===t.queries.length&&this.queries.every(function(r,i){return r.equals(t.queries[i])})},e}(U),he=function(n){return n[n.Add=0]="Add",n[n.Subtract=1]="Subtract",n[n.Multiply=2]="Multiply",n[n.Divide=3]="Divide",n[n.Power=4]="Power",n}({}),ve=function(n){return n[n.EqualTo=0]="EqualTo",n[n.StrictEqualTo=1]="StrictEqualTo",n[n.GreaterThan=2]="GreaterThan",n[n.LessThan=3]="LessThan",n[n.GreaterThanEqualTo=4]="GreaterThanEqualTo",n[n.LessThanEqualTo=5]="LessThanEqualTo",n[n.NotEqualTo=6]="NotEqualTo",n}({}),Ot=function(n){return n[n.And=0]="And",n[n.Or=1]="Or",n}({}),St=function(n){return n[n.String=0]="String",n[n.Number=1]="Number",n}({});function Yr(n){switch(n){case St.Number:return"Number";case St.String:return"String"}return Se("uexpected ConstantDataType ".concat(n))}var Yn,Xr=function(){function n(e){this.traceString=e}return n.prototype.visitStartAt=function(e,t){var r=this,i="";return e.values.length>0&&(i="START AT ",i+=e.values.map(function(o){return o.accept(r,t)}).join(", ")),i},n.prototype.visitSort=function(e,t){return"".concat(e.clause.accept(this,t)).concat(e.direction?" "+e.direction.accept(this,t):"")},n.prototype.visitOrderBy=function(e,t){var r=this,i="";return e.sortClauses.length>0&&(i="ORDER BY\n",i+="    "+e.sortClauses.map(function(o){return o.accept(r,t)}).join(", "),e.startAt&&(i+="\n"+e.startAt.accept(this,t))),i},n.prototype.visitMeasureExpression=function(e,t){return"MEASURE ".concat(e.name," = ").concat(e.definition.accept(this,t))},n.prototype.visitVariableDefinition=function(e,t){return"VAR ".concat(e.name," = ").concat(e.definition.accept(this,t))},n.prototype.visitQuery=function(e,t){var r=this,i="";e.definitions.length>0&&(i="DEFINE\n",i+=e.definitions.map(function(s){return"    "+s.accept(r,t)}).join("\n"),i+="\n");var o="EVALUATE ".concat(e.evaluate.accept(this,t),"\n"),a=e.orderBy?"".concat(e.orderBy.accept(this,t),"\n"):"";return"".concat(i).concat(o).concat(a)},n.prototype.visitQueries=function(e,t){var r=this;return e.queries.map(function(i){return i.accept(r,t)}).join("\n\n")},n.prototype.visitAxis=function(e,t){return e.axis},n.prototype.visitMultiIdentifier=function(e,t){for(var r="",i=0,o=e.expressions;i<o.length;i++)r+=this.visitExpression(o[i]);return r},n.prototype.visitEnum=function(e,t){return e.value},n.prototype.visitArithmetic=function(e){return this.visitBinaryExpression(e,function(n){switch(n){case he.Add:return"+";case he.Divide:return"/";case he.Multiply:return"*";case he.Power:return"^";case he.Subtract:return"-"}return Se("unexpected operator ".concat(n))}(e.operation))},n.prototype.visitConstantScalar=function(e){if(this.traceString)return"{".concat(Yr(e.type),"}");switch(e.type){case St.String:return D.doubleQuote(e.value);case St.Number:return e.value;default:Je("Unsupported node of type ".concat(Yr(e.type)))}},n.prototype.visitDateTimeLiteral=function(e,t){return e.value},n.prototype.visitComparison=function(e){return this.visitBinaryExpression(e,function(n){switch(n){case ve.EqualTo:return"=";case ve.StrictEqualTo:return"==";case ve.NotEqualTo:return"<>";case ve.GreaterThan:return">";case ve.GreaterThanEqualTo:return">=";case ve.LessThan:return"<";case ve.LessThanEqualTo:return"<="}return Se("unexpected comparison operator ".concat(n))}(e.comparison))},n.prototype.visitNegation=function(e){return"-".concat(this.visitExpression(e.expression))},n.prototype.visitNot=function(e){return"NOT(".concat(e.expression.toString(this.traceString),")")},n.prototype.visitFunction=function(e){var t=this,r=e.parameters.map(function(i){return t.visitExpression(i)}).join(", ");return"".concat(e.functionName,"(").concat(r,")")},n.prototype.visitTableReference=function(e){return this.traceString?"Table":D.quote(e.tableName)},n.prototype.visitColumnReference=function(e){return this.traceString?"Table[Column]":"".concat(D.quote(e.tableName)).concat(D.bracket(e.propertyName))},n.prototype.visitMeasureReference=function(e){return this.traceString?"[Measure]":"".concat(D.quote(e.tableName)).concat(D.bracket(e.propertyName))},n.prototype.visitLogicalOperation=function(e){return this.visitBinaryExpression(e,function(n){switch(n){case Ot.And:return"&&";case Ot.Or:return"||"}return Se("unexpected logical operator ".concat(n))}(e.operator))},n.prototype.visitIn=function(e){return this.visitBinaryExpression(e,"IN")},n.prototype.visitTextConcatenation=function(e){return this.visitBinaryExpression(e,"&")},n.prototype.visitRowConstructor=function(e){var t=this,r=e.items.map(function(i){return i.toString(t.traceString)}).join(", ");return"(".concat(r,")")},n.prototype.visitTableConstructor=function(e){var t=this,r=e.rows.map(function(i){return i.toString(t.traceString)}).join(", ");return"{".concat(r,"}")},n.prototype.visitKeyword=function(e){return e.value.toString().toUpperCase()},n.prototype.visitOmittedArgument=function(e){return""},n.prototype.visitUnknown=function(e){return this.traceString?"{Unknown}":e.expressionText},n.prototype.visitVarReturn=function(e){var t=this,r=e.variables.map(function(i){return"VAR ".concat(t.traceString?"__X":i.name," = ").concat(t.visitExpression(i.definition))}).join(" ");return"".concat(r," RETURN ").concat(this.visitExpression(e.returnExpression))},n.prototype.visitVariableReference=function(e){return this.traceString?"__X":e.name},n.prototype.visitVariationColumnReference=function(e){return this.traceString?"Table[VariationSource].[Column]":"".concat(D.quote(e.tableName)).concat(D.bracket(e.variationSourceName),".").concat(D.bracket(e.targetPropertyName))},n.prototype.visitBinaryExpression=function(e,t){var r=this.getExpressionType(e),i=this.getExpressionType(e.left),o=this.getExpressionType(e.right),a=!1,s=!1;0===i&&(a=!0),0===o&&(s=!0);var c=this.getPrecedence(r);if(a||13===i||c<this.getPrecedence(i)&&(a=!0),!s&&13!==o){var d=this.getPrecedence(o);(c<d||c===d&&!this.canCombine(r,o))&&(s=!0)}return"".concat(this.visitExpression(e.left,a)," ").concat(t," ").concat(this.visitExpression(e.right,s))},n.prototype.visitExpression=function(e,t){void 0===t&&(t=!1);var r="";return t&&(r+="("),r+=e.accept(this),t&&(r+=")"),r},n.prototype.getPrecedence=function(e){switch(e){case 1:return 0;case 2:return 1;case 3:case 4:return 2;case 6:case 7:return 3;case 8:return 4;case 12:case 9:return 5;case 5:return 6;case 10:return 7;case 11:return 8;default:Se("Unsuppored expression type ".concat(e))}},n.prototype.getExpressionType=function(e){if(e instanceof G)return 0;if(e instanceof Wn)return 2;if(e instanceof Vr)return 5;if(e instanceof Gr)return 8;if(e instanceof Kr)return 12;if(e instanceof Ur)switch(e.operation){case he.Power:return 1;case he.Multiply:return 3;case he.Divide:return 4;case he.Add:return 6;case he.Subtract:return 7;default:Se("Unsupported arithmetic operation ".concat(e.operation))}if(e instanceof kr)return 9;if(e instanceof jr)switch(e.operator){case Ot.And:return 10;case Ot.Or:return 11;default:Se("Unsupported binary logical operator ".concat(e.operator))}return 13},n.prototype.canCombine=function(e,t){return 6===e&&6===t||3===e&&3===t||10===e&&10===t||11===e&&11===t},n}();function $r(n){return P.hasFlag(n,1)}!function(n){var e;function r(g){var S=g,T=function(g){for(;null!=g&&1===g.children.length&&g instanceof K;){if(!(g.isComplete&&g.children[0]instanceof mt)){g=void 0;break}g=g.children[0]}return g}(S);if(null==T)return new G(S);if(1===S.children.length&&S instanceof fe){if(S.valid){var w=S.children[0];return w.valid?w instanceof K||w instanceof fe?r(w):i(w):new G(T)}return new G(T)}if(null!=T&&T instanceof en){for(var F=0,B=T.children;F<B.length;F++){var W=B[F];if(!(W instanceof K)||W.isComplete)return i(W)}return new G(T)}return i(T)}function i(g){if($r(e)&&g instanceof sn){if(g.children.length>=2){for(var S=!1,T=0;T<g.children.length-1;T++)44===g.children[0].token.type&&(S=!S);var w=r(g.children[g.children.length-1]);return S?new Vr(w):w}return new G(g)}if(g instanceof _t)return Xe.Asc;if(g instanceof Dt)return Xe.Desc;if(g instanceof We){var A=g.children.length;if(A>=3){if(g instanceof Ln||g instanceof Dn||g instanceof Fn)return o(g.children,A-1,ta);if(function(n){return P.hasFlag(n,2)}(e)&&g instanceof Zt)return o(g.children,A-1,na);if(function(n){return P.hasFlag(n,4)}(e)&&g instanceof ie)return o(g.children,A-1,ra);if(function(n){return P.hasFlag(n,16)}(e)&&g instanceof Bn)return o(g.children,A-1,ia)}return new G(g)}if(g instanceof kn){if(g.children.length>=2){var F=1;for(T=0;T<g.children.length-1;T++)20===g.children[T].token.type&&(F*=-1);return l(w=r(g.children[g.children.length-1]),F)}return new G(g)}if(g instanceof _n)return 3===g.children.length?r(g.children[1]):new G(g);if(g instanceof Nt){if(g.children.length>=3){var W=g.children[0].token.getString(),J=[];if(g.children[2]instanceof it){var q=g.children[2];if(q.parameterCount>0){J=new Array(q.parameterCount);var Oe=ce.featureSwitches.includeUndefinedOptionalFunctionParameters?q.allParametersIncludingUndefined:q.parameters;for(T=0;T<q.parameterCount;T++)J[T]=null!=Oe[T]?r(Oe[T]):jo.instance}}return new(Hr.bind.apply(Hr,(0,h.__spreadArray)([void 0,W],J,!1)))}return new G(g)}if(g instanceof me){var He=g;return He.qualifiedColumnRef?new zr(He.qualifiedColumnRef.table.name,g.qualifiedColumnRef.name):He.bracketedIdentifier&&He.tableRefNode?O(He):new G(g)}if(g instanceof Tt){var gn=g.variationSource;if(null!=gn&&null!=gn.simpleColumnRef){var zi=gn.simpleColumnRef.table.name,Gi=gn.simpleColumnRef.name;if(null!=g.qualifiedColumnRef)return new Qr(zi,Gi,g.qualifiedColumnRef.name);if(null!=g.simpleColumnRef)return new Qr(zi,Gi,g.simpleColumnRef.name)}return new G(g)}if(g instanceof ge||g instanceof tn||g instanceof we)return O(g);if(g instanceof Ne)return function(g){for(var S=[],T=0,I=g.children;T<I.length;T++){var A=O(I[T]);A&&S.push(A)}return new Lo(S)}(g);if(g instanceof rn)return new Ro(g.token.getString());if(g instanceof Lt)return new Kn(g.token.getString(),St.Number);if(g instanceof Et)return new Kn(g.string,St.String);if($r(e)&&g instanceof jn)return function(g){var S=g.children.length;if(!g.isComplete||S<3||!(g.children[S-2]instanceof Mn))return new G(g);for(var T=new Array(S-2),I=0;I<S-2;I++){var w=g.children[I];if(null==w)return new G(g);var A=s(w);if(!A)return new G(g);T[I]=A}return new Vo(T,r(g.children[S-1]))}(g);if(function(n){return P.hasFlag(n,8)}(e)){if(g instanceof Rt)return g.children.length>=3&&g.children[1]instanceof Nn?o(g.children,g.children.length-1,oa):new G(g);if(g instanceof an){var sr=g.children,Ki=[];for(T=1;T<sr.length-1;T++)sr[T]instanceof X||Ki.push(r(sr[T]));return new qn(Ki)}if(g instanceof on){var ur=function(g){var S=g.children,T=S.length;if(!(T<2)&&S[0]instanceof st&&S[T-1]instanceof Re){if(2===T)return Wr.empty;for(var I=[],w=1;w<T-1;w++)if(!(S[w]instanceof X)){var A=r(S[w]);I.push(A instanceof qn?A:new qn([A]))}return new Wr(I)}}(g);return ur??new G(g)}}if(function(n){return P.hasFlag(n,32)}(e)&&g instanceof Rn&&1===g.children.length){var Wi=g.children[0];if(Wi instanceof _t)return Xe.Asc;if(Wi instanceof Dt)return Xe.Desc}if(g instanceof Ae)return r(g.children[0]);if(g instanceof yt){var xl=r(g.children[0]),Qi=void 0;return g.children[1]instanceof _r&&(Qi=r(g.children[1])),new Go(xl,Qi)}return new G(g)}function o(g,S,T){if(S<0)return new G(g[0]);if(0===S)return r(g[S]);var I=o(g,S-2,T);return T(g[S-1],I,r(g[S]))}function s(g){if(g.isComplete&&!(g.children.length<4)&&g.children[0]instanceof wr&&g.children[2]instanceof nn){var T=g.children[1];if(T instanceof ge){var I=T.token.matchObject;if(I instanceof Me)return new Uo(I.name,r(g.children[3]))}}}function l(g,S){return g instanceof Wn?l(g.expression,-1*S):S<0?new Wn(g):g}function v(g){var S=g.children;if(g.isComplete&&!(S.length<4)&&S[0]instanceof In&&S[1]instanceof Jt&&S[2]instanceof nn&&S[3]instanceof Ae){var I=O(S[1]),w=r(S[3]);return new Fo(I,w)}}function b(g){if(!g.isComplete)return new G(g);var I,w,S=g.children,T=[],A=0;if(S[A]instanceof bt){for(var B=0,W=S[A].children;B<W.length;B++){var J=W[B];if(J instanceof ot){var q=v(J);if(!q)return new G(g);T.push(q)}else if(J instanceof Mt){var Ze=s(J);if(!Ze)return new G(g);T.push(Ze)}}A++}return S[A]instanceof An&&S[++A]instanceof Ae?(I=r(S[A]),S[++A]instanceof Ft&&!(w=function(g){var S=g.children,T=S.length;if(!(T<3)){for(var A,I=[],w=2;w<T&&!(S[w]instanceof lt);)S[w]instanceof yt&&I.push(r(S[w])),w++;if(!(S[w]instanceof lt)||(A=function(g){var S=g.children,T=S.length;if(!(T<3)&&S[0]instanceof Ar&&S[1]instanceof wn){for(var I=[],w=2;w<T;w++)S[w]instanceof X||I.push(r(S[w]));return new zo(I)}}(S[w]),A))return new Ko(I,A)}}(S[A]))?new G(g):new qr(T,I,w)):new G(g)}function O(g){var S=g instanceof me?g.bracketedIdentifier:g;if(!(S instanceof k))return new G(g);var T=S.token;if(T.matchObject instanceof de)return new _o(T.matchObject.name);if(T.matchObject instanceof ye)return new Do(T.matchObject.table.name,T.matchObject.name);if(T.matchObject instanceof ue)return new zr(T.matchObject.table.name,T.matchObject.name);if(T.matchObject instanceof Me)return new Ho(T.matchObject.name);if(T.matchObject instanceof pe){if(T.matchObject.name===Ye.True)return Xe.True;if(T.matchObject.name===Ye.False)return Xe.False}if(T.matchObject instanceof Pe)return new Bo(T.matchObject.name);if(T.matchObject instanceof rt)return new ko(T.matchObject.name);if(T.matchObject instanceof Ke){if(T.matchObject.name===Ye.Asc)return Xe.Asc;if(T.matchObject.name===Ye.Desc)return Xe.Desc}return new G(g)}n.build=function(g,S){return e=S,g instanceof Bt?function(g){if(!g.isComplete)return new G(g);for(var S=[],T=0,I=g.children;T<I.length;T++){var w=I[T];if(!(w instanceof at))return new G(w);var A=b(w);if(!(A instanceof qr))return new G(w);S.push(A)}return new Wo(S)}(g):r(g)}}(Yn||(Yn={}));var ta=function(e,t,r){return new Ur(function(n){if(n instanceof k)switch(n.token.type){case 21:return he.Multiply;case 22:return he.Divide;case 19:return he.Add;case 20:return he.Subtract;case 18:return he.Power}return Se("Not a SingleTokenNode arithmetic Operator ".concat(JSON.stringify(n)))}(e),t,r)},na=function(e,t,r){return new kr(function(n){if(n instanceof k)switch(n.token.type){case 15:return ve.LessThan;case 11:return ve.LessThanEqualTo;case 17:return ve.EqualTo;case 9:return ve.StrictEqualTo;case 12:return ve.GreaterThanEqualTo;case 16:return ve.GreaterThan;case 10:return ve.NotEqualTo}return Se("Not a SingleTokenNode ComparisonOperator ".concat(n.token.type))}(e),t,r)},ra=function(e,t,r){return new jr(function(n){switch(n.token.type){case 13:return Ot.And;case 14:return Ot.Or}return Se("Not a SingleTokenNode LogicalOperator ".concat(n.token.type))}(e),t,r)},ia=function(e,t,r){return new Gr(t,r)},oa=function(e,t,r){return new Kr(t,r)},xt=function(){return function(e,t,r,i,o){this.name=e,this.optional=t,this.repeatable=r,this.repeatGroup=i,this.skippable=o}}(),ca=function(){return function(e,t,r,i,o,a){this.name=e,this.description=t,this.category=r,this.pushableToDQ=i,this.parameters=o,this.VisualCalculationsInfo=a}}(),E=function(){return function(e,t,r){this.param=e,this.value=t,this.description=r}}(),m=function(){return function(e,t,r,i,o){void 0===o&&(o=1023),this.name=e,this.role=t,this.signatureRole=r,this.enumValues=i,this.returnType=o}}(),da=function(){function n(e,t,r){this._reservedWords={},this._functions=[],this._daxAxes=r?r.map(function(d){return new Pe(d)}):[];for(var i=0,o=e;i<o.length;i++)this._reservedWords[o[i].toUpperCase()]=!0;for(var s=0,c=t;s<c.length;s++){var l=c[s];("ROLLUPADDISSUBTOTAL"===l.name||"ROLLUPISSUBTOTAL"===l.name)&&4===l.parameters.length&&(l.parameters[0].skippable=!0,l.parameters[0].repeatGroup=1,l.parameters[0].repeatable=!0,l.parameters[1].repeatGroup=2,l.parameters[2].repeatGroup=2,l.parameters[3].repeatGroup=2,l.parameters[3].skippable=!0),this.addFunction(l)}this.ensureSpecialFunctions()}return Object.defineProperty(n.prototype,"functions",{get:function(){return this._functions},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"reservedWords",{get:function(){return this._reservedWords},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fnCalculate",{get:function(){return this._fnCalculate},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"axes",{get:function(){return this._daxAxes},enumerable:!1,configurable:!0}),n.loadHardcodedCalculateSignature=function(){return new pe(pe.FUNCTIONS_SPECIAL_CALCULATE_FUNCTION_NAME,"",4,3,1023,1,[[new Cn("expression",1023,!1,!1,0,u.None,!1,void 0),new Cn("filter",1023,!0,!0,0,u.Filter,!1,void 0)]])},n.prototype.addFunction=function(e){Y(e.name,"functionDataFromEngine.name");var t=(0,h.__spreadArray)((0,h.__spreadArray)([],n.builtinFunctionData,!0),n.builtinVisualCalcFunctionData,!0);ce.featureSwitches.customCalendars&&t.forEach(function(d){d.signatureRole[0]===u.DatesAddToRet&&(d.signatureRole[0]=u.DatesCalendarsAddToRet)});var i,r=_.find(t,function(d){return j.equalIgnoreCase(d.name,e.name)});i=null==r||"EXPAND"!==r.name&&"COLLAPSE"!==r.name?[e.parameters]:this.createHardCodedSignaturesForExpandCollapseFunctions(e);for(var o=[],a=function(p){for(var b=0,C=[],y=0,O=i[p];y<O.length;y++){var x=O[y],g=u.None;if(null!=r?.signatureRole){var S;S=_.isArray(r.signatureRole[0])?r.signatureRole[p]:r.signatureRole,b<S.length&&(g=S[b])}var T=[];P.hasFlag(g.type,64)&&(T=_.chain(r.enumValues).filter(function(I){return I.param===b}).map(function(I){return new rt(I.value,I.description)}).value()),C.push(new Cn(x.name,g.dataType,x.repeatable,x.optional,x.repeatGroup,g,x.skippable,T)),b++}o.push(C)},s=0;s<i.length;s++)a(s);var c=1,l=0;r&&(c=r.role,l=r.returnType),this._functions.push(new pe(e.name,e.description,e.category,e.pushableToDQ,l,c,o))},n.prototype.createHardCodedSignaturesForExpandCollapseFunctions=function(e){var t=4===e.parameters.length;if(Y(t,"expecting 4 parameters"),!t)return[];var r="Expression"===e.parameters[0].name,i="Axis"===e.parameters[1].name,o="Column"===e.parameters[2].name,a="N"===e.parameters[3].name;if(Y(r,"1st parameter should be Expression"),Y(i,"2nd parameter should be Axis"),Y(o,"3rd parameter should be Column"),Y(a,"4th parameter should be N"),!(r&&i&&o&&a))return[];var d=e.parameters[1],p=e.parameters[2],v=e.parameters[3],b=new xt(e.parameters[0].name,!0,!1,-1,!0),C=new xt(v.name,!0,!1,-1,!0);return[[b,new xt(d.name,!1,!1,-1,!1),C],[b,new xt(p.name,!1,!0,0,!1)]]},n.prototype.ensureSpecialFunctions=function(){this._fnCalculate=_.find(this.functions,function(e){return e.name===pe.FUNCTIONS_SPECIAL_CALCULATE_FUNCTION_NAME}),this._fnCalculate||(this._fnCalculate=n.hardcodedFnCalculate,this._functions.push(this._fnCalculate))},n.hardcodedFnCalculate=n.loadHardcodedCalculateSignature(),n.builtinFunctionData=[new m("ADDCOLUMNS",2,[u.TableExprAddToRet,u.NewCol,u.ExprOverTable],void 0),new m("ADDMISSINGITEMS",2,[u.QualifiedColRef,u.TableExprAddToRet,u.or(u.ColFromExtractedTable,{type:512}),u.TableExpr],void 0),new m("ALLCROSSFILTERED",1,[u.TableRef],void 0),new m("ALL",8194,[u.or(u.TableRefAddToRet,u.QualifiedColRefAddToRet),u.QualifiedColRefAddToRet],void 0),new m("ALLEXCEPT",2,[u.TableRefAddToRet,{type:12,columnReferenceScope:5,argumentContextAction:4}],void 0),new m("ALLNOBLANKROW",8194,[u.or(u.TableRefAddToRet,u.QualifiedColRefAddToRet),u.QualifiedColRefAddToRet],void 0),new m("ALLSELECTED",8194,[u.or(u.TableRefAddToRet,u.QualifiedColRefAddToRet),u.QualifiedColRefAddToRet],void 0),new m("APPROXIMATEDISTINCTCOUNT",1,[u.AnyColRef],void 0),new m("AVERAGE",1,[u.AnyColRef],void 0),new m("AVERAGEA",1,[u.AnyColRef],void 0),new m("AVERAGEX",1,[u.TableExpr,u.ExprOverTable],void 0),new m("CALCULATE",1,[{dataType:1087,argumentContextAction:5},(0,h.__assign)({dataType:264},u.Filter)],void 0,1024),new m("CALCULATETABLE",2,[u.or(u.TableExprAddToRet,{argumentContextAction:5}),u.Filter],void 0),new m("CALENDAR",4,[u.None,u.None],void 0),new m("CALENDARAUTO",4,[u.None],void 0),new m("CLOSINGBALANCEMONTH",1,[{argumentContextAction:5},u.Dates,u.Filter],void 0),new m("CLOSINGBALANCEQUARTER",1,[{argumentContextAction:5},u.Dates,u.Filter],void 0),new m("CLOSINGBALANCEYEAR",1,[{argumentContextAction:5},u.Dates,u.Filter,{type:2048}],void 0),new m("COLUMNSTATISTICS",4096,[],void 0),new m("CONCATENATEX",1,[u.TableExpr,u.ExprOverTable,u.None,u.ExprOverTable,u.EnumValue],[new E(4,"ASC"),new E(4,"DESC")]),new m("CONTAINS",1,[u.TableExpr,u.ColFromExtractedTableOrRel,u.None],void 0),new m("CONVERT",1,[u.None,u.EnumValue],[new E(1,"BOOLEAN"),new E(1,"DOUBLE"),new E(1,"INTEGER"),new E(1,"DATETIME"),new E(1,"CURRENCY"),new E(1,"STRING")]),new m("CONVERTTOCSV",1,[u.TableExpr,u.None,u.None,u.None],void 0),new m("COUNT",1,[u.AnyColRef],void 0),new m("COUNTA",1,[u.AnyColRef],void 0),new m("COUNTAX",1,[u.TableExpr,u.ExprOverTable],void 0),new m("COUNTBLANK",1,[u.AnyColRef],void 0),new m("COUNTX",1,[u.TableExpr,u.ExprOverTable],void 0),new m("COUNTROWS",1,[u.TableExpr],void 0),new m("CROSSFILTER",1,[u.QualifiedColRef,u.QualifiedColRef,u.EnumValue],[new E(2,"None"),new E(2,"OneWay"),new E(2,"Both"),new E(2,"OneWay_LeftFiltersRight"),new E(2,"OneWay_RightFiltersLeft")]),new m("CROSSJOIN",2,[u.TableExprAddToRet],void 0),new m("CURRENTGROUP",8,[],void 0),new m("DATATABLE",2,[u.NewCol,u.EnumValue,{type:4096}],[new E(1,"BOOLEAN"),new E(1,"DOUBLE"),new E(1,"INTEGER"),new E(1,"DATETIME"),new E(1,"CURRENCY"),new E(1,"STRING")]),new m("DATE",1,[(0,h.__assign)({dataType:1},u.None),(0,h.__assign)({dataType:1},u.None),(0,h.__assign)({dataType:1},u.None)],void 0,16),new m("DATEADD",2,[u.DatesAddToRet,u.None,u.EnumValue],[new E(2,"DAY"),new E(2,"MONTH"),new E(2,"QUARTER"),new E(2,"YEAR")]),new m("DATEDIFF",1,[u.None,u.None,u.EnumValue],[new E(2,"DAY"),new E(2,"WEEK"),new E(2,"MONTH"),new E(2,"QUARTER"),new E(2,"YEAR"),new E(2,"HOUR"),new E(2,"MINUTE"),new E(2,"SECOND")]),new m("DATESBETWEEN",2,[u.DatesAddToRet,u.None,u.None],void 0),new m("DATESINPERIOD",2,[u.DatesAddToRet,u.None,u.None,u.EnumValue],[new E(3,"DAY"),new E(3,"MONTH"),new E(3,"QUARTER"),new E(3,"YEAR")]),new m("DATESMTD",2,[u.DatesAddToRet],void 0),new m("DATESQTD",2,[u.DatesAddToRet],void 0),new m("DATESYTD",2,[u.DatesAddToRet,{type:2048}],void 0),new m("DISTINCT",8194,[u.or(u.QualifiedColRefAddToRet,u.TableExprAddToRet)],void 0),new m("DISTINCTCOUNT",1,[u.AnyColRef],void 0),new m("DISTINCTCOUNTNOBLANK",1,[u.AnyColRef],void 0),new m("EARLIER",1,[u.EarlierColRef],void 0),new m("EARLIEST",1,[u.EarliestColRef],void 0),new m("ENDOFMONTH",2,[u.DatesAddToRet],void 0),new m("ENDOFQUARTER",2,[u.DatesAddToRet],void 0),new m("ENDOFYEAR",2,[u.DatesAddToRet],void 0),new m("EVALUATEANDLOG",256,[u.or({type:1},u.TableExpr,u.TableExprAddToRet,u.TableRef,u.TableRefAddToRet),u.None,u.None],void 0),new m("EXCEPT",2,[u.TableExprAddToRet,u.TableExpr],void 0),new m("EXTERNALMEASURE",1,[{type:2048},u.EnumValue,{type:2048}],[new E(1,"BOOLEAN"),new E(1,"DOUBLE"),new E(1,"INTEGER"),new E(1,"DATETIME"),new E(1,"CURRENCY"),new E(1,"STRING"),new E(1,"VARIANT")]),new m("FILTER",2,[(0,h.__assign)({dataType:256},u.TableExprAddToRet),(0,h.__assign)({dataType:8},u.ExprOverTable)],void 0,256),new m("FILTERS",2,[u.or(u.HomeOrQualifiedColRef,{argumentAction:1})],void 0),new m("FIRSTDATE",2,[u.DatesAddToRet],void 0),new m("FIRSTNONBLANK",2,[u.or(u.QualifiedColRefAddToRet,{argumentAction:8},u.TableExprAddToRet),{argumentContextAction:3}],void 0),new m("FIRSTNONBLANKVALUE",2,[u.or(u.QualifiedColRefAddToRet,{argumentAction:8},u.TableExprAddToRet),{argumentContextAction:3}],void 0),new m("FULLOUTERJOIN",2,[u.TableExprAddToRet,u.TableExprAddToRet],void 0),new m("GENERATE",2,[u.TableExprAddToRet,u.or(u.TableExprAddToRet,{argumentContextAction:1})],void 0),new m("GENERATEALL",2,[u.TableExprAddToRet,u.or(u.TableExprAddToRet,{argumentContextAction:1})],void 0),new m("GENERATESERIES",12,[u.None,u.None,u.None],void 0),new m("GEOMEAN",1,[u.AnyColRef],void 0),new m("GEOMEANX",1,[u.TableExpr,u.ExprOverTable],void 0),new m("GROUPBY",2,[u.TableExpr,u.ColFromExtractedTableOrRelAddToRet,u.NewCol,{additionalBehaviors:1}],void 0),new m("HASONEVALUE",1,[u.QualifiedColRef],void 0),new m("HASONEFILTER",1,[u.HomeOrQualifiedColRef],void 0),new m("KEEPFILTERS",2,[u.or(u.TableExprAddToRet,{type:1})],void 0),new m("IF",1,[(0,h.__assign)((0,h.__assign)({},u.None),{dataType:59}),(0,h.__assign)({dataType:1087},u.None),(0,h.__assign)({dataType:1087},u.None)],void 0,1024),new m("INFO.ALTERNATEOFDEFINITIONS",16384,[]),new m("INFO.ANNOTATIONS",16384,[]),new m("INFO.ATTRIBUTEHIERARCHIES",16384,[]),new m("INFO.ATTRIBUTEHIERARCHYSTORAGES",16384,[]),new m("INFO.CALCDEPENDENCY",16384,[]),new m("INFO.CALCULATIONGROUPS",16384,[]),new m("INFO.CALCULATIONITEMS",16384,[]),new m("INFO.CATALOGS",16384,[]),new m("INFO.CHANGEDPROPERTIES",16384,[]),new m("INFO.COLUMNPARTITIONSTORAGES",16384,[]),new m("INFO.COLUMNPERMISSIONS",16384,[]),new m("INFO.COLUMNS",16384,[]),new m("INFO.COLUMNSTORAGES",16384,[]),new m("INFO.CULTURES",16384,[]),new m("INFO.DATACOVERAGEDEFINITIONS",16384,[]),new m("INFO.DATASOURCES",16384,[]),new m("INFO.DELTATABLEMETADATASTORAGES",16384,[]),new m("INFO.DETAILROWSDEFINITIONS",16384,[]),new m("INFO.DICTIONARYSTORAGES",16384,[]),new m("INFO.EXCLUDEDARTIFACTS",16384,[]),new m("INFO.EXPRESSIONS",16384,[]),new m("INFO.EXTENDEDPROPERTIES",16384,[]),new m("INFO.FORMATSTRINGDEFINITIONS",16384,[]),new m("INFO.FUNCTIONS",16384,[]),new m("INFO.GENERALSEGMENTMAPSEGMENTMETADATASTORAGES",16384,[]),new m("INFO.GROUPBYCOLUMNS",16384,[]),new m("INFO.HIERARCHIES",16384,[]),new m("INFO.HIERARCHYSTORAGES",16384,[]),new m("INFO.KPIS",16384,[]),new m("INFO.LEVELS",16384,[]),new m("INFO.LINGUISTICMETADATA",16384,[]),new m("INFO.MEASURES",16384,[]),new m("INFO.MODEL",16384,[]),new m("INFO.OBJECTTRANSLATIONS",16384,[]),new m("INFO.PARQUETFILESTORAGES",16384,[]),new m("INFO.PARTITIONS",16384,[]),new m("INFO.PARTITIONSTORAGES",16384,[]),new m("INFO.PERSPECTIVECOLUMNS",16384,[]),new m("INFO.PERSPECTIVEHIERARCHIES",16384,[]),new m("INFO.PERSPECTIVEMEASURES",16384,[]),new m("INFO.PERSPECTIVES",16384,[]),new m("INFO.PERSPECTIVETABLES",16384,[]),new m("INFO.PROPERTIES",16384,[]),new m("INFO.QUERYGROUPS",16384,[]),new m("INFO.REFRESHPOLICIES",16384,[]),new m("INFO.RELATEDCOLUMNDETAILS",16384,[]),new m("INFO.RELATIONSHIPINDEXSTORAGES",16384,[]),new m("INFO.RELATIONSHIPS",16384,[]),new m("INFO.RELATIONSHIPSTORAGES",16384,[]),new m("INFO.ROLEMEMBERSHIPS",16384,[]),new m("INFO.ROLES",16384,[]),new m("INFO.SEGMENTMAPSTORAGES",16384,[]),new m("INFO.SEGMENTSTORAGES",16384,[]),new m("INFO.STORAGEFILES",16384,[]),new m("INFO.STORAGEFOLDERS",16384,[]),new m("INFO.STORAGETABLECOLUMNS",16384,[]),new m("INFO.STORAGETABLECOLUMNSEGMENTS",16384,[]),new m("INFO.STORAGETABLES",16384,[]),new m("INFO.TABLEPERMISSIONS",16384,[]),new m("INFO.TABLES",16384,[]),new m("INFO.TABLESTORAGES",16384,[]),new m("INFO.VARIATIONS",16384,[]),new m("INTERSECT",2,[u.TableExprAddToRet,u.TableExpr],void 0),new m("ISAFTER",1,[u.None,u.None,u.EnumValue],[new E(2,"ASC"),new E(2,"DESC")]),new m("ISCROSSFILTERED",1,[u.or(u.TableRef,u.HomeOrQualifiedColRef)],void 0),new m("ISEMPTY",1,[u.TableExpr],void 0),new m("ISFILTERED",1,[u.or(u.TableRef,u.HomeOrQualifiedColRef)],void 0),new m("INDEX",2,[u.None,u.TableExprAddToRet,u.OrderByParam,u.EnumValue,u.PartitionByParam,u.MatchByParam,u.EnumOrIntValue],[new E(3,"DEFAULT"),new E(6,"NONE"),new E(6,"LOWESTPARENT"),new E(6,"HIGHESTPARENT")],256),new m("ISINSCOPE",1,[u.HomeOrQualifiedColRef],void 0),new m("ISONORAFTER",1,[u.None,u.None,u.EnumValue],[new E(2,"ASC"),new E(2,"DESC")]),new m("ISSUBTOTAL",1,[u.ColFromCurTable],void 0),new m("LASTDATE",2,[u.DatesAddToRet],void 0),new m("LASTNONBLANK",2,[u.or(u.QualifiedColRefAddToRet,{argumentAction:8},u.TableExprAddToRet),{argumentContextAction:3}],void 0),new m("LASTNONBLANKVALUE",2,[u.or(u.QualifiedColRefAddToRet,{argumentAction:8},u.TableExprAddToRet),{argumentContextAction:3}],void 0),new m("LINEST",2,[u.AnyColRef,u.AnyColRef,u.EnumValue],[new E(2,"TRUE"),new E(2,"FALSE")],256),new m("LINESTX",2,[u.TableExpr,u.ExprOverTable,u.ExprOverTable,u.EnumValue],[new E(3,"TRUE"),new E(3,"FALSE")],256),new m("LOOKUPVALUE",1,[u.or(u.HomeOrQualifiedColRef,{argumentAction:4}),u.ColFromExtractedTableOrRel,u.None],void 0),new m("MATCHBY",2048,[u.AnyColRef],void 0),new m("MAX",1,[u.or(u.AnyColRef,{type:1})],void 0),new m("MAXA",1,[u.AnyColRef],void 0),new m("MAXX",1,[u.TableExpr,u.ExprOverTable,u.EnumValue],[new E(2,"TRUE"),new E(2,"FALSE")],void 0),new m("MEDIAN",1,[u.AnyColRef],void 0),new m("MEDIANX",1,[u.TableExpr,u.ExprOverTable],void 0),new m("MIN",1,[u.or(u.AnyColRef,{type:1})],void 0),new m("MINA",1,[u.AnyColRef],void 0),new m("MINX",1,[u.TableExpr,u.ExprOverTable,u.EnumValue],[new E(2,"TRUE"),new E(2,"FALSE")],void 0),new m("NAMEOF",1,[u.or(u.AnyColRef,{type:1})],void 0),new m("NATURALINNERJOIN",2,[u.TableExprAddToRet,u.TableExprAddToRet],void 0),new m("NATURALLEFTOUTERJOIN",2,[u.TableExprAddToRet,u.TableExprAddToRet],void 0),new m("NETWORKDAYS",1,[u.None,u.None,u.None,u.TableExpr],void 0,63),new m("NEXTDAY",2,[u.DatesAddToRet],void 0),new m("NEXTMONTH",2,[u.DatesAddToRet],void 0),new m("NEXTQUARTER",2,[u.DatesAddToRet],void 0),new m("NEXTYEAR",2,[u.DatesAddToRet,{type:2048}],void 0),new m("NONVISUAL",2,[u.TableExprAddToRet],void 0),new m("OFFSET",2,[u.None,u.TableExprAddToRet,u.OrderByParam,u.EnumValue,u.PartitionByParam,u.MatchByParam,u.EnumOrIntValue],[new E(3,"DEFAULT"),new E(6,"NONE"),new E(6,"LOWESTPARENT"),new E(6,"HIGHESTPARENT")],256),new m("OPENINGBALANCEMONTH",1,[{argumentContextAction:5},u.Dates,u.Filter],void 0),new m("OPENINGBALANCEQUARTER",1,[{argumentContextAction:5},u.Dates,u.Filter],void 0),new m("OPENINGBALANCEYEAR",1,[{argumentContextAction:5},u.Dates,u.Filter,{type:2048}],void 0),new m("ORDERBY",512,[u.or(u.ColFromCurTable,{type:1}),u.EnumValue],[new E(1,"ASC"),new E(1,"DESC"),new E(1,"ASC BLANKS DEFAULT"),new E(1,"ASC BLANKS FIRST"),new E(1,"ASC BLANKS LAST"),new E(1,"DESC BLANKS DEFAULT"),new E(1,"DESC BLANKS FIRST"),new E(1,"DESC BLANKS LAST")]),new m("PARALLELPERIOD",2,[u.DatesAddToRet,u.None,u.EnumValue],[new E(2,"MONTH"),new E(2,"QUARTER"),new E(2,"YEAR")]),new m("PARTITIONBY",1024,[u.AnyColRef],void 0),new m("PATH",1,[u.HomeOrQualifiedColRef,u.HomeOrQualifiedColRef],void 0),new m("PATHITEM",1,[u.None,u.None,u.EnumValue],[new E(2,"TEXT","Function returns a string"),new E(2,"INTEGER","Function returns an integer")]),new m("PATHITEMREVERSE",1,[u.None,u.None,u.EnumValue],[new E(2,"TEXT","Function returns a string"),new E(2,"INTEGER","Function returns an integer")]),new m("PERCENTILE.EXC",1,[u.AnyColRef,u.None],void 0),new m("PERCENTILE.INC",1,[u.AnyColRef,u.None],void 0),new m("PERCENTILEX.EXC",1,[u.TableExpr,u.ExprOverTable,u.None],void 0),new m("PERCENTILEX.INC",1,[u.TableExpr,u.ExprOverTable,u.None],void 0),new m("PREVIOUSDAY",2,[u.DatesAddToRet],void 0),new m("PREVIOUSMONTH",2,[u.DatesAddToRet],void 0),new m("PREVIOUSQUARTER",2,[u.DatesAddToRet],void 0),new m("PREVIOUSYEAR",2,[u.DatesAddToRet,{type:2048}],void 0),new m("PRODUCT",1,[u.AnyColRef],void 0),new m("PRODUCTX",1,[u.TableExpr,u.ExprOverTable],void 0),new m("RANK",1,[u.EnumValue,u.TableExpr,u.OrderByParam,u.EnumValue,u.PartitionByParam,u.MatchByParam,u.EnumOrIntValue],[new E(0,"DENSE"),new E(0,"SKIP"),new E(3,"DEFAULT"),new E(3,"FIRST"),new E(3,"LAST"),new E(6,"NONE"),new E(6,"LOWESTPARENT"),new E(6,"HIGHESTPARENT")]),new m("RANK.EQ",1,[u.None,u.AnyColRef,u.EnumValue],[new E(2,"ASC"),new E(2,"DESC")]),new m("RANKX",1,[u.TableExpr,u.ExprOverTable,u.None,u.EnumValue,u.EnumValue],[new E(3,"ASC"),new E(3,"DESC"),new E(4,"Skip"),new E(4,"Dense")]),new m("RELATED",1,[u.RelatedColRef],void 0),new m("RELATEDTABLE",2,[u.or(u.TableRefAddToRet,{argumentContextAction:5})],void 0),new m("REMOVEFILTERS",1,[u.or(u.TableRef,u.QualifiedColRef),u.QualifiedColRef],void 0),new m("ROLLUP",16,[{type:1024,additionalBehaviors:4}],void 0),new m("ROLLUPGROUP",128,[{additionalBehaviors:4}],void 0),new m("ROLLUPADDISSUBTOTAL",32,[u.TableExpr,u.or(u.ColFromParentContext,{type:1024,additionalBehaviors:4}),u.NewCol,u.TableExpr],void 0),new m("ROLLUPISSUBTOTAL",64,[u.TableExpr,u.or(u.ColFromParentContext,{type:1024,additionalBehaviors:4}),u.ColFromParentContext,u.TableExpr],void 0),new m("ROW",2,[u.NewCol,u.None],void 0),new m("ROWNUMBER",1,[u.TableExpr,u.OrderByParam,u.EnumValue,u.PartitionByParam,u.MatchByParam,u.EnumOrIntValue],[new E(2,"DEFAULT"),new E(2,"FIRST"),new E(2,"LAST"),new E(5,"NONE"),new E(5,"LOWESTPARENT"),new E(5,"HIGHESTPARENT")]),new m("SAMEPERIODLASTYEAR",2,[u.DatesAddToRet],void 0),new m("SAMPLE",2,[u.None,u.TableExprAddToRet,u.ExprOverTable,u.EnumValue],[new E(3,"ASC"),new E(3,"DESC")]),new m("SELECTCOLUMNS",2,[u.TableExpr,u.NewCol,u.ExprOverTable],void 0),new m("SELECTEDVALUE",1,[(0,h.__assign)({dataType:1024},u.QualifiedColRef)],void 0,1024),new m("STARTOFMONTH",2,[u.DatesAddToRet],void 0),new m("STARTOFQUARTER",2,[u.DatesAddToRet],void 0),new m("STARTOFYEAR",2,[u.DatesAddToRet],void 0),new m("STDEV.P",1,[u.AnyColRef],void 0),new m("STDEV.S",1,[u.AnyColRef],void 0),new m("STDEVX.P",1,[u.TableExpr,u.ExprOverTable],void 0),new m("STDEVX.S",1,[u.TableExpr,u.ExprOverTable],void 0),new m("SUBSTITUTEWITHINDEX",2,[{type:2,argumentAction:1},u.NewCol,u.TableExpr,u.ExprOverTable,u.EnumValue],[new E(4,"ASC"),new E(4,"DESC")]),new m("SUMMARIZE",2,[u.TableExpr,u.or(u.ColFromExtractedTableOrRelAddToRet,{type:1152,argumentAction:8}),u.NewCol,{argumentContextAction:2}],void 0),new m("SUMMARIZECOLUMNS",2,[u.or(u.QualifiedColRefAddToRet,{type:256}),u.TableExpr,u.NewCol,u.None],void 0),new m("SUM",1,[(0,h.__assign)((0,h.__assign)({},u.AnyColRef),{dataType:1083})],void 0,1024),new m("SUMX",1,[u.TableExpr,u.ExprOverTable],void 0,1024),new m("TOCSV",1,[u.TableExpr,u.None,u.None,u.None],void 0,4),new m("TODAY",1,[],void 0,16),new m("TOJSON",1,[u.TableExpr,u.None],void 0,4),new m("TOPN",2,[u.None,u.TableExprAddToRet,u.ExprOverTable,u.EnumValue],[new E(3,"ASC"),new E(3,"DESC"),new E(3,"0"),new E(3,"1"),new E(3,"TRUE"),new E(3,"FALSE")]),new m("TOPNSKIP",2,[u.None,u.None,u.TableExprAddToRet,u.ExprOverTable,u.EnumValue],[new E(4,"ASC"),new E(4,"DESC"),new E(4,"0"),new E(4,"1"),new E(4,"TRUE"),new E(4,"FALSE")]),new m("TOTALMTD",1,[{argumentContextAction:5},u.Dates,u.Filter],void 0),new m("TOTALQTD",1,[{argumentContextAction:5},u.Dates,u.Filter],void 0),new m("TOTALYTD",1,[{argumentContextAction:5},u.Dates,u.Filter,{type:2048}],void 0),new m("TREATAS",2,[{type:2},u.QualifiedColRefAddToRet],void 0),new m("UNION",2,[u.or(u.TableExprAddToRet,{argumentAction:2})],void 0),new m("USERELATIONSHIP",1,[u.QualifiedColRef,u.QualifiedColRef],void 0),new m("VALUES",8194,[u.or(u.TableRefAddToRet,u.QualifiedColRefAddToRet)],void 0),new m("VAR.P",1,[u.AnyColRef],void 0),new m("VAR.S",1,[u.AnyColRef],void 0),new m("VARX.P",1,[u.TableExpr,u.ExprOverTable],void 0),new m("VARX.S",1,[u.TableExpr,u.ExprOverTable],void 0),new m("WINDOW",2,[u.None,u.EnumValue,u.None,u.EnumValue,u.TableExprAddToRet,u.OrderByParam,u.EnumValue,u.PartitionByParam,u.MatchByParam,u.EnumOrIntValue],[new E(1,"ABS"),new E(1,"REL"),new E(3,"ABS"),new E(3,"REL"),new E(6,"DEFAULT"),new E(9,"NONE"),new E(9,"LOWESTPARENT"),new E(9,"HIGHESTPARENT")],256),new m("WEEKDAY",1,[u.None,u.EnumValue],[new E(1,"1","Sunday=1 through Saturday=7"),new E(1,"2","Monday=1 through Sunday=7"),new E(1,"3","Monday=0 through Sunday=6")]),new m("WEEKNUM",1,[u.None,u.EnumValue],[new E(1,"1","Week begins on Sunday"),new E(1,"2","Week begins on Monday"),new E(1,"11","Week begins on Monday"),new E(1,"12","Week begins on Tuesday"),new E(1,"13","Week begins on Wednesday"),new E(1,"14","Week begins on Thursday"),new E(1,"15","Week begins on Friday"),new E(1,"16","Week begins on Saturday"),new E(1,"17","Week begins on Sunday"),new E(1,"21","Based on the European week numbering system, the week begins on Monday")]),new m("XIRR",1,[u.TableExpr,u.ExprOverTable,u.ExprOverTable,u.None],void 0),new m("XNPV",1,[u.TableExpr,u.ExprOverTable,u.ExprOverTable,u.None],void 0),new m("YEARFRAC",1,[u.None,u.None,u.EnumValue],[new E(2,"0","US (NASD) 30/360"),new E(2,"1","Actual/actual"),new E(2,"2","Actual/360"),new E(2,"3","Actual/365"),new E(2,"4","European 30/360")])],n.builtinVisualCalcFunctionData=[new m("FIRST",1,[u.or(u.AnyColRef,{type:1}),u.AxisExpr,u.EnumValue,u.EnumOrIntValue],[new E(2,"DEFAULT"),new E(2,"FIRST"),new E(2,"LAST"),new E(3,"NONE"),new E(3,"LOWESTPARENT"),new E(3,"HIGHESTPARENT")]),new m("LAST",1,[u.or(u.AnyColRef,{type:1}),u.AxisExpr,u.EnumValue,u.EnumOrIntValue],[new E(2,"DEFAULT"),new E(2,"FIRST"),new E(2,"LAST"),new E(3,"NONE"),new E(3,"LOWESTPARENT"),new E(3,"HIGHESTPARENT")]),new m("NEXT",1,[u.or(u.AnyColRef,{type:1}),u.None,u.AxisExpr,u.EnumValue,u.EnumOrIntValue],[new E(3,"DEFAULT"),new E(3,"FIRST"),new E(3,"LAST"),new E(4,"NONE"),new E(4,"LOWESTPARENT"),new E(4,"HIGHESTPARENT")]),new m("PREVIOUS",1,[u.or(u.AnyColRef,{type:1}),u.None,u.AxisExpr,u.EnumValue,u.EnumOrIntValue],[new E(3,"DEFAULT"),new E(3,"FIRST"),new E(3,"LAST"),new E(4,"NONE"),new E(4,"LOWESTPARENT"),new E(4,"HIGHESTPARENT")]),new m("LOOKUP",1,[u.AnyColRef,u.Filter],void 0),new m("RUNNINGSUM",1,[u.or(u.AnyColRef,{type:1}),u.AxisExpr,u.EnumValue,u.EnumOrIntValue],[new E(2,"DEFAULT"),new E(2,"FIRST"),new E(2,"LAST"),new E(3,"NONE"),new E(3,"LOWESTPARENT"),new E(3,"HIGHESTPARENT")]),new m("MOVINGAVERAGE",1,[u.or(u.AnyColRef,{type:1}),u.None,u.EnumValue,u.AxisExpr,u.EnumValue,u.EnumOrIntValue],[new E(2,"TRUE"),new E(2,"FALSE"),new E(4,"DEFAULT"),new E(4,"FIRST"),new E(4,"LAST"),new E(5,"NONE"),new E(5,"LOWESTPARENT"),new E(5,"HIGHESTPARENT")]),new m("EXPAND",1,[[u.or(u.AnyColRef,{type:1}),u.AxisExpr,u.None],[u.or(u.AnyColRef,{type:1}),u.AnyColRef]],void 0),new m("COLLAPSE",1,[[u.or(u.AnyColRef,{type:1}),u.AxisExpr,u.None],[u.or(u.AnyColRef,{type:1}),u.AnyColRef]],void 0),new m("EXPANDALL",1,[u.or(u.AnyColRef,{type:1}),u.AxisExpr],void 0),new m("COLLAPSEALL",1,[u.or(u.AnyColRef,{type:1}),u.AxisExpr],void 0),new m("RANGE",2,[u.None,u.EnumValue,u.AxisExpr,u.EnumValue,u.EnumOrIntValue],[new E(1,"TRUE"),new E(1,"FALSE"),new E(3,"DEFAULT"),new E(3,"FIRST"),new E(3,"LAST"),new E(4,"NONE"),new E(4,"LOWESTPARENT"),new E(4,"HIGHESTPARENT")]),new m("ISATLEVEL",1,[u.AnyColRef],void 0)],n}();var ma=function(){function n(e){this.tables=[];for(var t=0,r=e.tables;t<r.length;t++)this.tables.push(new ya(r[t]));for(var o=0,a=this.tables;o<a.length;o++)for(var c=0,l=a[o].columns;c<l.length;c++)l[c].bindVariationTable(this.tables);this.relationshipGraph=new Ea(this,e.relationships)}return n.prototype.findTable=function(e){return _.find(this.tables,function(t){return t.name===e})},n}(),va=function(){function n(e,t){this.table=e,this.name=t.name,this.description=t.description,this.variationTableName=t.variationTable}return Object.defineProperty(n.prototype,"variationTable",{get:function(){return this._variationTable},enumerable:!1,configurable:!0}),n.prototype.bindVariationTable=function(e){var t=this;this.variationTableName&&(this._variationTable=_.find(e,function(r){return r.name===t.variationTableName}))},n}(),ba=function(){return function(e,t){this.table=e,this.name=t.name,this.description=t.description,this.expression=t.expression,this.isExternal=t.isExternal}}(),Ca=function(){return function(e,t){this.table=e,this.name=t.name}}(),ya=function(){function n(e){var r,t=this;this.name=e.name,this.description=e.description,this.measures=e.measures.map(function(o){return new ba(t,o)});var i=e.columns.filter(function(o){return o.isUserColumn});this.columns=i.map(function(o){return new va(t,o)}),this.calendars=null===(r=e.calendars)||void 0===r?void 0:r.map(function(o){return new Ca(t,o)}),this.isTransparent=e.isTransparent,this.isUserTable=e.isUserTable}return n.prototype.getHashCode=function(){return this.name},n.prototype.equals=function(e){return this.name===e.name},n}(),Ea=function(){function n(e,t){this.reachableTables=new ht,this.reachableTables=n.buildReachableTables(e,t)}return n.prototype.getRelatedTables=function(e){var t=this.reachableTables.get(e);return t?t.values():[]},n.buildReachableTables=function(e,t){for(var r=new ht,i=0,o=_.filter(t,function(T){return T.active});i<o.length;i++){var a=o[i],s=e.findTable(a.from.table),c=e.findTable(a.to.table);n.addRelatedTable(r,s,c),"one"===a.from.cardinality&&"one"===a.to.cardinality&&n.addRelatedTable(r,c,s)}for(var l=new ht,d=0,p=r.keys;d<p.length;d++){var v=p[d],b=new hr,C=new Zi;for(b.add(v),C.enqueue(v);C.length>0;){var y=C.dequeue(),O=r.get(y);if(O)for(var x=0,g=O.values();x<g.length;x++){var S=g[x];b.add(S)&&C.enqueue(S)}}b.remove(v),l.update(v,b)}return l},n.addRelatedTable=function(e,t,r){var i=e.get(t);i||(i=new hr,e.add(t,i)),i.add(r)},n}(),Jr=/=|:=/,Oa=new RegExp("^"+Mo+"$"),Sa=new RegExp("^"+Io),xa=new RegExp("^:$"),$n=["]","["],Pa=/\t|\n|\r/g,dn=[" ","\t","\n","\r"],ei=[" ","\t"];function ti(n,e){return ni(n,!1,e)}function ni(n,e,t,r){var i={name:null,formula:null,formulaStart:-1,errors:[]};try{var o=j.trimStart(n=n||"",dn),a=Zn(o,Oa);if(a&&a[0].length===o.length)return i.name=t?a[0]:D.unbracketPartial(a[0]),i;var s=Zn(o,Sa);s&&(i.name=t?s[0]:D.unbracket(s[0]),o=j.trimStart(o.substr(s[0].length),dn));var c=Jr.exec(o);if(null==c&&r)return i.name="",i.formula=e?j.trimStart(n,ei):n,i.formulaStart=0,i;var l=j.trimEnd(c?o.substr(0,c.index):o,dn);if(null==i.name){var d=j.indexOfAny(l,$n);if(-1===d)i.name=l;else{i.name=l.substr(0,d);var p=n.length-o.length;do{i.errors.push(new Ee(new tt(n,p+d,1),H.InvalidNameCharacter)),d=j.indexOfAny(l,$n,d+1)}while(-1!==d)}}else if(!j.isNullOrEmpty(l)){var v=Zn(l,xa);!c&&v&&v[0].length===l.length||i.errors.push(new Ee(new tt(n,n.length-o.length,l.length),H.CantSeparateFormulaNameAndExpression))}if(!c)return i;o=o.substr(c.index+c[0].length),e&&(o=j.trimStart(o,ei)),i.formula=o,i.formulaStart=n.length-o.length}finally{i.name=i.name.replace(Pa,"")}return i}function Zn(n,e){var t=e.exec(n);if(t&&0===t.index)return t}var Ba=M(47164),La=function(n){function e(t){var r=n.call(this,t)||this;return r.message=t,r.name="DaxConfigError",r}return(0,h.__extends)(e,n),e}(Error),ka=function(n){function e(t){var r=n.call(this,t.message)||this;return r.originalError=t,Object.setPrototypeOf(r,e.prototype),r.name="MonacoError",r}return(0,h.__extends)(e,n),e}(Error),ri=M(85386),be=function(n){return n[n.Column=0]="Column",n[n.Measure=1]="Measure",n[n.Table=2]="Table",n[n.Role=3]="Role",n[n.VisualCalculation=4]="VisualCalculation",n[n.CalculationItem=5]="CalculationItem",n}({}),Ie=function(n){return n[n.Formula=0]="Formula",n[n.Expression=1]="Expression",n[n.Query=2]="Query",n}({}),$e=function(n){return n.ModelChange="ModelChange",n.CodeAction="CodeAction",n.CodeLens="CodeLens",n.Completions="Completions",n.Formatting="Formatting",n.Hover="Hover",n.SemanticTokens="SemanticTokens",n.SignatureHelp="SignatureHelp",n.Validation="Validation",n.Unknown="Unknown",n}({}),Ua=function(){function n(e){this.daxParserManager=e,this.signatureHelpTriggerCharacters=["(",","],this.signatureHelpRetriggerCharacters=[","]}return n.prototype.provideSignatureHelp=function(e,t,r,i){var o=this.daxParserManager.getParseResult(e,e.getOffsetAt(t),void 0,!0,$e.SignatureHelp);if(!o)return Promise.resolve(void 0);var a=o.parseResult&&o.parseResult.prototypeFunctionBase;if(!a)return Promise.resolve(void 0);var s=[],c={currentParameter:-1};if(o.parseResult.prototypeParamContexts.length)for(var l=0,d=o.parseResult.prototypeParamContexts;l<d.length;l++)s.push(this.buildSignature(a,d[l],c));else s.push(this.buildSignature(a,void 0,c));return Promise.resolve({value:{signatures:s,activeParameter:c.currentParameter,activeSignature:0},dispose:function(){}})},n.prototype.buildSignature=function(e,t,r){var i={documentation:e.description,label:void 0,parameters:[],activeParameter:void 0};if(r.currentParameter=-1,!t)return i.label=e.getDefaultPrototype(),i;var p,a="",s=e.getPrototype(t);a+=s[0].text+s[0].separator;for(var c=1;c<s.length-1;c++){var l=s[c];i.parameters.push({documentation:"",label:(p=l.text,p.endsWith(Ve.listSeparator)&&(p=p.substr(0,p.length-Ve.listSeparator.length)),p)}),a+=l.text,a+=l.separator,l.bold&&(r.currentParameter=c-1)}return i.label="".concat(a+=s[s.length-1].text+s[s.length-1].separator),i.activeParameter=r.currentParameter,i},n}(),Vt=M(35510),Ce=function(){function n(){}return n.configureModel=function(e,t,r,i,o){this.config=new Va(e,function(n,e){return new da(n.reservedWords,n.functionDataFromEngine.map(function(t){return function(n){return new ca(n.name,n.description,n.category,n.pushableToDQ,n.parameters.map(function(e){return function(n){return new xt(n.name,n.optional,n.repeatable,n.repeatGroup,n.skippable)}(e)}),n.visualCalculationsInfo)}(t)}),e)}(t,o),r,i),this.newConfig$.next()},n.newConfigNotification=function(){return this.newConfig$.asObservable()},n.getConfig=function(){return n.config},n.getModel=function(){return n.config&&n.config.daxModel},n.getMonacoModel=function(){return n.config&&n.config.wireModel},n.getDataSourceInfo=function(){return n.config&&n.config.dataSourceInfo},n.getContext=function(){return n.config&&n.config.daxContext},n.config=void 0,n.newConfig$=new Vt.X(void 0),n}(),Va=function(){function n(e,t,r,i){this.wireModel=e,this.dataSourceInfo=t,this.calculation=r,this.restrictedDirectQuery=i}return Object.defineProperty(n.prototype,"syntaxType",{get:function(){var t,r;return null!==(r=null===(t=this.calculation)||void 0===t?void 0:t.syntaxType)&&void 0!==r?r:Ie.Formula},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"daxModel",{get:function(){return this._daxModel||(this._daxModel=function(n){return new ma(n)}(this.wireModel)),this._daxModel},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"daxContext",{get:function(){if(!this._daxContext){var t={matchObjects:null};Le.populateAll(this.daxModel,this.dataSourceInfo,t);var r=this.calculation;if(!r||r.syntaxType===Ie.Query)return this._daxContext=new te(t.matchObjects),this._daxContext;var i=_.find(this.daxModel.tables,function(s){return s.name===r.tableName});switch(r.type){case be.Column:var o=_.find(i.columns,function(s){return s.name===r.calculationName});this._daxContext=function(n,e,t,r){var i={matchObjects:null};Le.populateAll(n,e,i);var o=i.matchObjects;r&&o.chooseFunctions(function(l){return P.hasFlag(l.pushableToDirectQuery,2)});var a=new te(i.matchObjects),s=o.findTable(t.table.name);if(s){var c=s.findColumn(t.name);c&&(o.hideColumn(c),s.hideColumn(c)),a.currentTable=s.uberTable}return a}(this.daxModel,this.dataSourceInfo,o,this.restrictedDirectQuery);break;case be.Measure:var a=_.find(i.measures,function(s){return s.name===r.calculationName});this._daxContext=r.syntaxType===Ie.Expression?function(n,e,t,r){var i={matchObjects:null};Le.populateAll(n,e,i);var o=i.matchObjects;r&&o.chooseFunctions(function(l){return P.hasFlag(l.pushableToDirectQuery,1)});var a=new te(o),s=o.findTable(t.table.name);s&&(a.currentTable=s.uberTable);var c=new te(a,!1);return c.currentTable=null,c}(this.daxModel,this.dataSourceInfo,a,this.restrictedDirectQuery):function(n,e,t,r){var i={matchObjects:null};Le.populateAll(n,e,i);var o=i.matchObjects;r&&o.chooseFunctions(function(d){return P.hasFlag(d.pushableToDirectQuery,1)});var a=new te(o),s=o.findTable(t.table.name);if(s){var c=s.findMeasure(t.name);c&&(o.hideMeasure(c),s.hideMeasure(c)),a.currentTable=s.uberTable}var l=new te(a,!1);return l.currentTable=null,l}(this.daxModel,this.dataSourceInfo,a,this.restrictedDirectQuery);break;case be.Table:this._daxContext=function(n,e,t){var r={matchObjects:null};Le.populateAll(n,e,r);var i=r.matchObjects,o=new te(i);o.ephemeralContexts.push(new ze(o,null,{type:2},null));var a=i.findTable(t.name);return a&&i.hideTable(a),o}(this.daxModel,this.dataSourceInfo,i);break;case be.Role:this._daxContext=function(n,e,t){var r={matchObjects:null};Le.populateAll(n,e,r);var i=r.matchObjects,o=new te(i),a=i.findTable(t.name);return a&&(o.currentTable=a.uberTable),o}(this.daxModel,this.dataSourceInfo,i);break;default:this._daxContext=new te(t.matchObjects)}}return this._daxContext},enumerable:!1,configurable:!0}),n.prototype.onWireModelUpdated=function(){this._daxModel=null,this._daxContext=null},n}(),Ht=M(87180),Ha=function(){function n(e){this.daxParserManager=e,this.triggerCharacters=[",","[","(","]","'"],function(){var n=Ht.n.prototype.triggerSuggest;Ht.n.prototype.triggerSuggest=function(e,t){return n.apply(this,[e,!0])}}()}return n.prototype.provideCompletionItems=function(e,t,r,i){if(""===e.getValue())return Promise.resolve(function(){var n,e=new R.Range(1,1,1,1);return{suggestions:(null===(n=Ce.getConfig())||void 0===n?void 0:n.syntaxType)===Ie.Query?[{label:"DEFINE",insertText:"DEFINE",range:e,kind:R.languages.CompletionItemKind.Keyword},{label:"EVALUATE",insertText:"EVALUATE",range:e,kind:R.languages.CompletionItemKind.Keyword}]:[]}}());var o=this.daxParserManager.getParseResult(e,e.getOffsetAt(t),5,void 0,$e.Completions);if(!o||!o.parseResult)return Promise.resolve(void 0);var a=o.parseResult,s=a.suggestions.map(function(c,l){var p,d=c.suggestionText;if(c.matchObject instanceof pe){var v=c.matchObject;d+="(",(0===v.signatures.length||1===v.signatures.length&&0===v.signatures[0].length)&&(d+=")"),p={id:"editor.action.triggerSuggest",title:"TriggerSuggestion"}}c.complete||(p={id:"editor.action.triggerSuggest",title:"TriggerSuggestion"});var b=function(n,e,t,r){var i=e.replaceEnd;if(n.matchObject instanceof pe){e.afterOParen===i+1&&(i=e.afterOParen);var o=n.matchObject;(0===o.signatures.length||1===o.signatures.length&&0===o.signatures[0].length)&&e.afterCParen===i+1&&(i=e.afterCParen)}var a=r.getPositionAt(e.replaceStart+t.formulaBreakup.formulaStart),s=r.getPositionAt(i+t.formulaBreakup.formulaStart);return{startLineNumber:a.lineNumber,startColumn:a.column,endLineNumber:s.lineNumber,endColumn:s.column}}(c,a,o,e);return{label:c.suggestionText,command:p,range:b,preselect:l===a.bestMatch,insertText:d,documentation:c.matchObject.description||"",kind:Ga(c),filterText:e.getValueInRange(b)}});return Promise.resolve({suggestions:s})},n.prototype.resolveCompletionItem=function(e,t){return Promise.resolve(e)},n}();function Ga(n){if(n.matchObject instanceof pe)return R.languages.CompletionItemKind.Function;if(n.matchObject instanceof Ke)return R.languages.CompletionItemKind.Keyword;if(n.matchObject instanceof de)return R.languages.CompletionItemKind.Class;if(n.matchObject instanceof ue)return R.languages.CompletionItemKind.Property;if(n.matchObject instanceof ye)return R.languages.CompletionItemKind.Method;if(n.matchObject instanceof rt)return R.languages.CompletionItemKind.Enum;if(n.matchObject instanceof gt)return R.languages.CompletionItemKind.Event;if(n.matchObject instanceof Pe){var e=n.matchObject;if("rows"===e.name.toLowerCase())return R.languages.CompletionItemKind.Struct;if("columns"===e.name.toLowerCase())return R.languages.CompletionItemKind.Interface;if("rows columns"===e.name.toLowerCase())return R.languages.CompletionItemKind.Constructor;if("columns rows"===e.name.toLowerCase())return R.languages.CompletionItemKind.Module}return R.languages.CompletionItemKind.Folder}var Qa=function(){function n(e){this.daxParserManager=e,this.maxCharactersInLine={},this.modelToEditorDictionary={},this.disposables=[],this.daxParser=new Ve(Qe.MultipleQueries)}return n.prototype.initialize=function(){var e=this;this.disposables.push(R.editor.onDidCreateEditor(function(t){var r,i=t.getId(),o=null===(r=t.getModel())||void 0===r?void 0:r.uri.toString();o&&(e.modelToEditorDictionary[o]&&e.modelToEditorDictionary[o]!==i&&(0,Qt.sr)("The formatting provider currently doesn't support using the same model on multiple editors"),e.modelToEditorDictionary[o]=i),e.maxCharactersInLine[i]||(e.maxCharactersInLine[i]=200),e.disposables.push(t.onDidChangeModel(function(a){var s,c=null===(s=a.newModelUrl)||void 0===s?void 0:s.toString();c&&e.modelToEditorDictionary[c]&&e.modelToEditorDictionary[c]!==i&&(0,Qt.sr)("The formatting provider currently doesn't support using the same model on multiple editors"),a.oldModelUrl&&(e.modelToEditorDictionary[a.oldModelUrl.toString()]=void 0),e.modelToEditorDictionary[c]=i})),e.disposables.push(t.onDidLayoutChange(function(a){e.maxCharactersInLine[i]=a.viewportColumn}))}))},n.prototype.dispose=function(){for(var e=0,t=this.disposables;e<t.length;e++)t[e].dispose()},n.prototype.provideDocumentFormattingEdits=function(e,t,r){var i,o,a,s=ft.getInstance().getProviderConfig(e.id);if(null!==(i=s?.formatting)&&void 0!==i&&i.enabled){var c=null!==(a=null===(o=s.formatting)||void 0===o?void 0:o.formattingOptions)&&void 0!==a?a:(0,h.__assign)((0,h.__assign)({},t),{addSpaceBetweenFunctionArguments:!1,contextualLineBreaksAndIndentation:!1,functionAndKeywordCase:"uppercase",lineStyle:"editorWidth",maxCharactersInLine:this.maxCharactersInLine[this.modelToEditorDictionary[e.uri.toString()]],removeUnnecessaryRowParenthesis:!1,spaceBetweenFunctionNameAndParenthesis:!1});return this.provideDocumentFormattingEditsCore(e,c,r)}},n.prototype.formatDaxText=function(e,t,r,i){var o;if(!r||!r.isCancellationRequested){var a=this.daxParser.buildParseTree(e);if(!a.anyErrors){t=t??{tabSize:4,insertSpaces:!1,functionAndKeywordCase:"uppercase",lineStyle:"short",addSpaceBetweenFunctionArguments:!0,contextualLineBreaksAndIndentation:!0,removeUnnecessaryRowParenthesis:!0,spaceBetweenFunctionNameAndParenthesis:!1};var l=((null===(o=Ce.getConfig())||void 0===o?void 0:o.syntaxType)===Ie.Formula?ti(e):{errors:[],formula:void 0,formulaStart:0,name:null}).name,p=new qa(t).format(a.rootNode),v=l?"".concat(l," ="):"";return _.isEmpty(v)?p:i&&v.length+p.length+1<=this.maxCharactersInLine[this.modelToEditorDictionary[i]]?"".concat(v," ").concat(p):"".concat(v,"\n").concat(p)}}},n.prototype.provideDocumentFormattingEditsCore=function(e,t,r){return ce.featureSwitches.useParseTreeFormatting?this.provideDocumentFormattingEditsUsingParseTree(e,t,r):this.provideDocumentFormattingEditsUsingExpressionTree(e,t,r)},n.prototype.provideDocumentFormattingEditsUsingParseTree=function(e,t,r){if(this.modelToEditorDictionary[e.uri.toString()]){var i=this.formatDaxText(e.getValue(),t,r,e.uri.toString());if(i)return[{text:i,range:e.getFullModelRange()}]}},n.prototype.provideDocumentFormattingEditsUsingExpressionTree=function(e,t,r){if(this.modelToEditorDictionary[e.uri.toString()]&&!r.isCancellationRequested){var i=this.daxParserManager.getParseResult(e,e.getValueLength(),void 0,!0,$e.Formatting);if(i&&i.formulaBreakup&&null!==i.parser.parseTree.rootNode&&!(i.parseResult.errors.length>0)){var o=i.formulaBreakup.name,s=Yn.build(i.parser.parseTree.rootNode,127).accept(new Ya(t)),c=o?"".concat(o," ="):"",l="";l=_.isEmpty(c)?s:c.length+s.length+1<=this.maxCharactersInLine[this.modelToEditorDictionary[e.uri.toString()]]?"".concat(c," ").concat(s):"".concat(c,"\n").concat(s);var d=this.getPositionMetadataOfEachLeaf(i.parser._parseTree.leafPositions,e.getValue()),p=this.findCommentsFromLeaves(d);return 0===p.length||(l=this.addCommentsToText(l,p)),[{text:l,range:e.getFullModelRange()}]}}},n.prototype.getPositionMetadataOfEachLeaf=function(e,t){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i];if(60!==a.token.type){if(a.token.ignorable){r.push({leaf:a,instance:0});continue}for(var s=a.token.getString(),c=0,l=t.indexOf(s);-1!==l;){if(a.token.startPosition===l){r.push({leaf:a,instance:c});break}c++,l=t.indexOf(s,l+1)}}}return r},n.prototype.findCommentsFromLeaves=function(e){for(var t=[],r=0;r<e.length;r++)if(Fr(e[r].leaf.token.type)){var o=e[r].leaf.token.getString(),a=this.getLeavesUntillTheNextNonIgnorableLeaf(e,r-1,"Decrement"),s=this.getLeavesUntillTheNextNonIgnorableLeaf(e,r+1,"Increment"),c=a.some(function(x){return x&&x.leaf.token.isComment}),l=s.some(function(x){return x&&x.leaf.token.isComment}),d=!this.isThereAnyTextBeforeTheNewLine(a,!0)&&(!this.isThereAnyTextBeforeTheNewLine(s,!1)||o.endsWith("\n")),p=this.getNumberOfNewLinesInLeaves(a),v=this.getNumberOfNewLinesInLeaves(s)+(o.endsWith("\n")?1:0),b=0!==a.length&&!a[a.length-1].leaf.token.ignorable,C=0!==s.length&&!s[s.length-1].leaf.token.ignorable,y=!c&&!b,O=!l&&!C;t.push({text:o,type:d&&C&&(v<=p||y)?"Above":d&&b&&(p<=v||O)?"Below":d||!p&&!y||v&&!l?d||p&&l||!v&&!O?"Between":"Behind":"Front",leavesBeforeComment:a,leavesAfterComment:s})}return t},n.prototype.getLeavesUntillTheNextNonIgnorableLeaf=function(e,t,r){for(var i=[];t>=0&&t<e.length&&e[t].leaf.token.ignorable;)i.push(e[t]),t="Increment"===r?t+1:t-1;return t>=0&&t<e.length&&i.push(e[t]),i},n.prototype.isThereAnyTextBeforeTheNewLine=function(e,t){void 0===t&&(t=!1);for(var r=0,i=e;r<i.length;r++){var o=i[r],a=t?o.leaf.token.getString().split("").reverse().join(""):o.leaf.token.getString(),s=a.search(/\S/),c=a.search(/\n/);if(-1!==s||-1!==c)return!(-1===s&&-1!==c||-1!==s&&-1!==c&&c<s)}return!1},n.prototype.getNumberOfNewLinesInLeaves=function(e){return e.reduce(function(t,r){return t+(r.leaf.token.getString().split("\n").length-1)},0)},n.prototype.addCommentsToText=function(e,t){for(var r,i=0,o=0,a=t;o<a.length;o++)e=(r=this.addCommentToText(e,a[o],i))[0],i=r[1];return e},n.prototype.addCommentToText=function(e,t,r){var i,o,a,s,c;void 0===r&&(r=0);var l=t.leavesBeforeComment[t.leavesBeforeComment.length-1],d=t.leavesAfterComment[t.leavesAfterComment.length-1],p=null!==(i=l?.leaf.token.getString().toLowerCase())&&void 0!==i?i:void 0,v=null!==(o=d?.leaf.token.getString().toLowerCase())&&void 0!==o?o:void 0,b=this.getStartPositionsThatMatchTheSubstring(e.toLowerCase(),p),C=this.getStartPositionsThatMatchTheSubstring(e.toLowerCase(),v),y=b[null!==(a=l?.instance)&&void 0!==a?a:-1],O=C[null!==(s=d?.instance)&&void 0!==s?s:-1],x=0;void 0!==y&&(x=y+(null!==(c=p?.length)&&void 0!==c?c:0)),void 0===y&&void 0!==O&&(x=O-e.slice(0,O).split("").reverse().join().search(/\S/)),void 0===O&&(O=e.slice(x).search(/\S/)+x);var S=this.formatComment(e,t,r,O,x,d),T=S[0],I=S[1],w=S[2],A=S[3];return[e=e.slice(0,A)+I+T.text+w+e.slice(A),r=A+t.text.length+I.length+w.length]},n.prototype.formatComment=function(e,t,r,i,o,a){var s="",c="",l=0;switch(t.type){case"Above":l=i,t.text.endsWith("\n")||(c="\n"),c+=(e.slice(0,l).match(/[ \t]*$/)||[""])[0];break;case"Below":l=o,r>=o&&(l=r),e.slice(0,l).endsWith("\n")||(s="\n");var d=e.slice(0,l).lastIndexOf("\n")+1;s+=(e.slice(d,l).match(/^[ \t]*/)||[""])[0],t.text.endsWith("\n")&&(t.text=t.text.slice(0,-1));break;case"Front":!e.slice(l=i).startsWith(" ")&&!t.text.endsWith("\n")&&(c=" ");break;case"Between":l=i;break;case"Behind":l=o,r>=o&&(l=r),e.slice(0,l).endsWith(" ")||(s=" "),t.text.endsWith("\n")&&e.slice(l,i).includes("\n")?t.text=t.text.slice(0,-1):!t.text.endsWith("\n")&&!e.slice(l,i).includes("\n")&&void 0!==a&&(t.text=t.text+"\n")}return[t,s,c,l]},n.prototype.getStartPositionsThatMatchTheSubstring=function(e,t){if(void 0===t)return[];for(var r=[],i=e.indexOf(t);-1!==i;)r.push(i),i=e.indexOf(t,i+1);return r},n}(),qa=function(){function n(e){var t=this;this.options=e,this.functionWithNoShortLineBreaks=["DATE"],this.functionWithLineFollowedByPairs=["SWITCH"],this.functionWithJustPairs=["ROW"],this.functionWithNameAndExpressionPairs=["SUMMARIZE","SUMMARIZECOLUMNS","ADDCOLUMNS","SELECTCOLUMNS"],this.identifersThatChangeCase=["true","false"],this.indentLevel=0,this.indentPadding="",this.addIndentation=function(){return _.repeat(t.indentPadding,t.indentLevel)},this.indentPadding=this.options.insertSpaces?_.repeat(" ",this.options.tabSize):"\t"}return n.prototype.format=function(e){var t=this.formatCore(e);return(t=t.replace(/(?<=\n)[ \t]+(?=\n)/g,"")).replace(/(\n?[\t ]*)+$/,"")},n.prototype.addSpacesBetweenArgsIfNone=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=[],i=0;i<e.length;i++)e[i-1]&&!this.doesEndWithWhitespace(e[i-1])&&r.push(" "),r.push(e[i]);return r.join("")},n.prototype.doesEndWithWhitespace=function(e){return/\s$/.test(e)},n.prototype.formatCore=function(e,t){var r,i;void 0===t&&(t=!1);var o="";if(void 0===e)return o;if(o+=this.formatTrivia(null!==(r=e.leadingTrivia)&&void 0!==r?r:[],!0),e instanceof We)o+=this.formatBinaryOperation(e);else if(e instanceof bt)o+=this.formatDefinitions(e);else if(e instanceof Nt)o+=this.formatFunctionCall(e);else if(e instanceof ge&&e.parent instanceof Nt)o+=this.formatIdentifier(e,!0);else if(e instanceof ge&&this.identifersThatChangeCase.includes(e.token.getString().toLowerCase()))o+=this.formatIdentifier(e,!0);else if(e instanceof ge)o+=this.formatIdentifier(e);else if(e instanceof Rt)o+=this.formatInOperation(e);else if(e instanceof le)o+=this.formatKeyword(e);else if(e instanceof ot)o+=this.formatMeasureExpression(e);else if(e instanceof Ft)o+=this.formatOrderBy(e);else if(e instanceof Bt)o+=this.formatQueries(e);else if(e instanceof at)o+=this.formatQuery(e);else if(e instanceof lt)o+=this.formatStartAt(e);else if(e instanceof yt)o+=this.formatSortClause(e);else if(e instanceof on)o+=this.formatTableConstructor(e);else if(e instanceof an)o+=this.formatTuple(e);else if(e instanceof sn)o+=this.formatUnaryLogicalOperation(e);else if(e instanceof Mt||e instanceof ke)o+=this.formatVariable(e);else if(e instanceof jn)o+=this.formatVarStatementNode(e);else if(e instanceof k)o+=e.token.getString();else if(e instanceof fe&&e.children.length>1)for(var s=0,c=this.getAllDescendents(e.children[0]);s<c.length;s++)o+=this.formatCore(c[s],t);else if(e instanceof mt)for(var d=0,p=e.children;d<p.length;d++)o+=this.formatCore(p[d],t);return o+=this.formatTrivia(null!==(i=e.trailingTrivia)&&void 0!==i?i:[],!1),t?o.replace(/(\n[\t ]*$)/,""):o},n.prototype.formatBinaryOperation=function(e){return this.formatBinaryOperationCore(e.children)},n.prototype.formatBinaryOperationCore=function(e){var t;if(1===e.length)return this.formatCore(e[0]);var r=this.formatBinaryOperationCore(e.slice(0,e.length-2)),i=this.formatCore(e[e.length-2]),o=this.formatCore(e[e.length-1]);return"editorWidth"===this.options.lineStyle&&r.length+o.length+2+this.indentLevel*this.options.tabSize<=(null!==(t=this.options.maxCharactersInLine)&&void 0!==t?t:200)||"long"===this.options.lineStyle||"short"===this.options.lineStyle?this.addSpacesBetweenArgsIfNone(r,i,o):"".concat(r,"\n").concat(this.addIndentation()).concat(this.addSpacesBetweenArgsIfNone(i,o))},n.prototype.formatDefinitions=function(e){var t="";t+=this.formatCore(e.children[0],!0),this.options.contextualLineBreaksAndIndentation&&this.indentLevel++;for(var r=1;r<e.children.length;r++)t+="\n".concat(this.addIndentation()).concat(this.formatCore(e.children[r],!0));return this.options.contextualLineBreaksAndIndentation&&this.indentLevel--,t},n.prototype.formatFunctionCall=function(e){var t,r,i,o=this.formatCore(e.children[0]),a=null!==(r=null===(t=e.getChildFunctionName())||void 0===t?void 0:t.toUpperCase())&&void 0!==r?r:"",s=this.formatCore(e.children[1],!0),c=e.children[e.children.length-1]instanceof _e?this.formatCore(e.children[e.children.length-1]):"",l=this.functionWithNoShortLineBreaks.includes(a),d=this.functionWithLineFollowedByPairs.includes(a),p=this.functionWithJustPairs.includes(a),v=this.functionWithNameAndExpressionPairs.includes(a);l||this.indentLevel++;var b=void 0;e.children[2]instanceof it&&(b=e.children[2]);var C=this.options.spaceBetweenFunctionNameAndParenthesis?" ":"",y=this.options.addSpaceBetweenFunctionArguments?" ":"";if("long"===this.options.lineStyle||"editorWidth"===this.options.lineStyle&&o.length+(b?b.fullSpan.length:0)+this.indentLevel*this.options.tabSize+s.length+c.length<=(null!==(i=this.options.maxCharactersInLine)&&void 0!==i?i:200)||"short"===this.options.lineStyle&&b&&b.children.length<=1||!b||"short"===this.options.lineStyle&&l){l||this.indentLevel--;var x="";if(b)for(var g=0,S=b.children;g<S.length;g++)x+=this.formatCore(T=S[g]),T instanceof X&&!this.doesEndWithWhitespace(x)&&(x+=y);return C=this.doesEndWithWhitespace(o)?"":C,"".concat(o).concat(C).concat(s).concat(x).concat(c)}var I="";I+="".concat(o).concat(C).concat(s,"\n");for(var w=!1,A="\n",F=this.addIndentation(),B=0,W=0;b&&W<b.children.length;W++){var T,J=this.formatCore(T=b.children[W],!0);if(T instanceof X)b.children[W-1]&&b.children[W-1]instanceof X&&(I+=F),I+="".concat(J).concat(A);else{if(F=this.addIndentation(),A="\n",d)F=0!==B&&B%2==0?"":this.addIndentation(),A=B%2!=0?" ":"\n";else if(p)F=B%2==0?this.addIndentation():" ",A=B%2==0?"":"\n";else if(v){var q=this.getAllDescendents(T);1===q.length&&q[0]instanceof Et&&!w?(A=" ",w=!0):w&&(F="",w=!1)}I+="".concat(F).concat(J),B++}}return I+="\n",l||this.indentLevel--,I+"".concat(this.addIndentation()).concat(c)},n.prototype.formatIdentifier=function(e,t){void 0===t&&(t=!1);var r=e.token.getIdentifier();return t&&(r="uppercase"===this.options.functionAndKeywordCase?r.toUpperCase():r.toLowerCase()),r},n.prototype.formatInOperation=function(e){return 1===e.children.length?this.formatCore(e.children[0]):this.addSpacesBetweenArgsIfNone(this.formatCore(e.children[0]),this.formatCore(e.children[1]),this.formatCore(e.children[2]))},n.prototype.formatKeyword=function(e){return"uppercase"===this.options.functionAndKeywordCase?e.keyword.toUpperCase():e.keyword.toLowerCase()},n.prototype.formatMeasureExpression=function(e){this.indentLevel++;var t=this.formatCore(e.children[0]),r=this.formatCore(e.children[1]),i=this.formatCore(e.children[2]),o=this.formatCore(e.children[3]);return this.indentLevel--,this.addSpacesBetweenArgsIfNone(t,r,i,o)},n.prototype.formatOrderBy=function(e){var t="",r="".concat(this.addIndentation()),i="\n".concat(this.addIndentation());this.indentLevel++;var o="\n".concat(this.addIndentation()),a=" ";this.options.contextualLineBreaksAndIndentation&&(o=e.children.length<=4?" ":o,a="\n".concat(this.addIndentation())),this.indentLevel--;var s=this.formatCore(e.children[0]),c=this.formatCore(e.children[1],!0);t+="".concat(r).concat(this.addSpacesBetweenArgsIfNone(s,c)).concat(o);for(var l=2;l<e.children.length&&!(e.children[l]instanceof lt);l++){var d=this.formatCore(e.children[l],!0);l%2!=0&&(d+=a),t+=d}return e.children[e.children.length-1]instanceof lt&&(t+="".concat(i).concat(this.formatCore(e.children[e.children.length-1]))),t},n.prototype.formatQueries=function(e){for(var t="",r=0;r<e.children.length;r++){var i=r!==e.children.length-1;t+=this.formatCore(e.children[r],i),t+=i?"\n":""}return t},n.prototype.formatQuery=function(e){var r,i,o,a,t=e.children,s=0;t[s]instanceof bt&&(r=t[s],s++),i=t[s],o=t[++s],t[++s]instanceof Ft&&(a=t[s]);var c=r?"".concat(this.formatCore(r),"\n"):"",l=this.formatCore(i,!0),d=" ";this.options.contextualLineBreaksAndIndentation&&(this.indentLevel++,d="\n".concat(this.addIndentation()));var p=void 0!==a;l+="".concat(d).concat(this.formatCore(o,p));var v=a?"\n".concat(this.formatCore(a)):"";return this.options.contextualLineBreaksAndIndentation&&this.indentLevel--,"".concat(c).concat(l).concat(v)},n.prototype.formatSortClause=function(e){var t="";return t+=this.formatCore(e.children[0]),e.children[1]&&(/\n\s*$/.test(t)&&(this.indentLevel++,t+=this.addIndentation(),this.indentLevel--),t+=this.doesEndWithWhitespace(t)?"":" ",t+=this.formatCore(e.children[1])),t},n.prototype.formatStartAt=function(e){var t="",r=" ",i=" ",o=this.formatCore(e.children[0]),a=this.formatCore(e.children[1],!0);"short"===this.options.lineStyle&&e.children.length>3&&(this.indentLevel++,r="\n".concat(this.addIndentation()),i="\n".concat(this.addIndentation()),this.indentLevel--),t+="".concat(this.addSpacesBetweenArgsIfNone(o,a)).concat(r);for(var s=2;s<e.children.length;s++)t+=this.formatCore(e.children[s],!0),s%2!=0&&(t+=i);return t},n.prototype.formatTableConstructor=function(e){var t=[],r=" ",i="",o="",a=0,s=this.formatCore(e.children[a],!0);for(a++,"short"===this.options.lineStyle&&(this.indentLevel++,r="\n".concat(this.addIndentation()),i="\n".concat(this.addIndentation()));a<e.children.length&&!(e.children[a]instanceof Re);a++)t.push(this.formatCore(e.children[a],!0));"short"===this.options.lineStyle&&(this.indentLevel--,o=e.children[a]?"\n".concat(this.addIndentation()):"");for(var c=this.formatCore(e.children[a]),l="",d=0;d<t.length;d++)l+=d%2?"".concat(t[d]).concat(r):t[d];return"".concat(s).concat(i).concat(l).concat(o).concat(c)},n.prototype.formatTuple=function(e){var t=this.options.contextualLineBreaksAndIndentation?" ":"\n".concat(this.addIndentation()),r=0,i=this.formatCore(e.children[r]);r++;for(var o="";r<e.children.length&&!(e.children[r]instanceof _e);r++)o+=this.formatCore(e.children[r],!0),o+=r%2?"":t;var a=this.formatCore(e.children[r]);return"".concat(i).concat(o).concat(a)},n.prototype.formatTrivia=function(e,t){for(var r="",i=0;i<e.length;i++)if(!e[i].isComment&&e[i].getString().includes("\n")){var o=e[i].getString().split("\n").length-1;r+="\n".repeat(o<0?0:o),r+=this.addIndentation()}else if(!e[i].isComment&&(e[i-1]&&e[i-1].isComment&&!e[i-1].getString().endsWith("\n")&&e[i+1]&&e[i+1].isComment||t&&e.length-1===i&&e[i-1]&&e[i-1].isComment&&!e[i-1].getString().endsWith("\n")||!t&&0===i&&e[i+1]&&e[i+1].isComment))r+=" ";else{if(!e[i].isComment)continue;if(e[i].isComment&&e[i].getString().endsWith("\n"))r+="".concat(e[i].getString()).concat(this.addIndentation());else if(e[i].isComment&&e[i].getString().includes("\n")){var a=e[i].getString().match(/\/\*([ ]*)(?=[^\s\n])/),c=" ".repeat(a&&a[1]?a[1].length+2:2);(r+=e[i].getString().replace(/(\n)[ \t]+/g,"\n").replace(/\n/g,"\n".concat(this.addIndentation()).concat(c))).endsWith("\n".concat(this.addIndentation()).concat(c,"*/"))&&(r=r.slice(0,r.length-c.length-2),r+="*/")}else r+=e[i].getString()}return r},n.prototype.formatUnaryLogicalOperation=function(e){for(var t="",r=0,i=e.children;r<i.length;r++){var o=i[r];o instanceof Ir?(t+=this.formatCore(o),t+=this.doesEndWithWhitespace(t)?"":" "):t+=this.formatCore(o)}return t},n.prototype.formatVariable=function(e){var t=this.formatCore(e.children[0]),r=this.formatCore(e.children[1]),i=this.formatCore(e.children[2]),o=this.formatCore(e.children[3]);return this.addSpacesBetweenArgsIfNone(t,r,i,o)},n.prototype.formatVarStatementNode=function(e){for(var t="",r=0;r<e.children.length&&e.children[r]instanceof ke;r++)t+=0===r?"":this.addIndentation(),t+=this.formatCore(e.children[r],!0),e.children[r+1]instanceof ke&&(t+="\n");return t+="\n".concat(this.addIndentation()).concat(this.formatCore(e.children[r],!0)),r++,this.indentLevel++,t+="\n".concat(this.addIndentation()).concat(this.formatCore(e.children[r])),this.indentLevel--,t},n.prototype.getAllDescendents=function(e){if(e instanceof mt){for(var t=[],r=0,i=e.children;r<i.length;r++)t.push.apply(t,this.getAllDescendents(i[r]));return t}return[e]},n}(),Ya=function(n){function e(t){var r=n.call(this,!1)||this;return r.options=t,r.functionWithNoShortLineBreaks=["DATE"],r.functionWithLineFollowedByPairs=["SWITCH","ADDCOLUMNS"],r.functionWithJustPairs=["ROW"],r.functionWithNameAndExpressionPairs=["SUMMARIZE","SUMMARIZECOLUMNS"],r.indentLevel=0,r.indentPadding="",r.addIndentation=function(){return _.repeat(r.indentPadding,r.indentLevel)},r.indentPadding=r.options.insertSpaces?_.repeat(" ",r.options.tabSize):"\t",r}return(0,h.__extends)(e,n),e.prototype.visitStartAt=function(t,r){var i=this,o="uppercase"===this.options.functionAndKeywordCase?"START AT":"start at",a=" ",s=", ";"short"===this.options.lineStyle&&t.values.length>1&&(this.indentLevel++,a="\n".concat(this.addIndentation()),s=",\n".concat(this.addIndentation()),this.indentLevel--);var c="";return t.values.length>0&&(c="".concat(this.addIndentation()).concat(o).concat(a),c+=t.values.map(function(l){return l.accept(i,r)}).join(s)),c},e.prototype.visitOrderBy=function(t,r){var i=this,o="uppercase"===this.options.functionAndKeywordCase?"ORDER BY":"order by";this.indentLevel++;var a="\n".concat(this.addIndentation()),s=", ";this.options.contextualLineBreaksAndIndentation&&(a=1===t.sortClauses.length?" ":a,s=",\n".concat(this.addIndentation())),this.indentLevel--;var c="";return t.sortClauses.length>0&&(c="".concat(this.addIndentation()).concat(o),c+=a+t.sortClauses.map(function(l){return l.accept(i,r)}).join(s),t.startAt&&(this.indentLevel++,c+="\n"+t.startAt.accept(this,r),this.indentLevel--)),c},e.prototype.visitMeasureExpression=function(t,r){return this.lowercaseKeywordsIfNeeded(n.prototype.visitMeasureExpression.call(this,t,r),"MEASURE")},e.prototype.visitMeasureReference=function(t){return"".concat(D.bracket(t.propertyName))},e.prototype.visitVariableDefinition=function(t,r){return this.lowercaseKeywordsIfNeeded(n.prototype.visitVariableDefinition.call(this,t,r),"VAR")},e.prototype.visitQuery=function(t,r){var i=this,a="uppercase"===this.options.functionAndKeywordCase?"EVALUATE":"evaluate",s="";t.definitions.length>0&&(s="".concat("uppercase"===this.options.functionAndKeywordCase?"DEFINE":"define","\n"),this.indentLevel++,s+=t.definitions.map(function(v){return i.addIndentation()+v.accept(i,r)}).join("\n"),this.indentLevel--,s+="\n",s+=this.options.contextualLineBreaksAndIndentation?"\n":"");var c=" ";this.options.contextualLineBreaksAndIndentation&&(this.indentLevel++,c="\n".concat(this.addIndentation()));var l="".concat(a).concat(c).concat(t.evaluate.accept(this,r)),d=t.orderBy?"\n".concat(t.orderBy.accept(this,r)):"",p="".concat(s).concat(l).concat(d);return this.options.contextualLineBreaksAndIndentation&&this.indentLevel--,p},e.prototype.visitNegation=function(t){return this.visitUnaryExpression(t,"-","")},e.prototype.visitNot=function(t){return this.visitUnaryExpression(t,"NOT"," ")},e.prototype.visitFunction=function(t){var i,r=this,o="uppercase"===this.options.functionAndKeywordCase?t.functionName.toUpperCase():t.functionName.toLowerCase(),a=this.functionWithNoShortLineBreaks.includes(o.toUpperCase()),s=this.functionWithLineFollowedByPairs.includes(o.toUpperCase()),c=this.functionWithJustPairs.includes(o.toUpperCase()),l=this.functionWithNameAndExpressionPairs.includes(o.toUpperCase()),d=this.options.spaceBetweenFunctionNameAndParenthesis?" ":"",p=this.options.addSpaceBetweenFunctionArguments?", ":",";a||this.indentLevel++;var v=t.parameters.map(function(O){return n.prototype.visitExpression.call(r,O)}),b=o.length+_.sum(_.map(v,function(O){return O.length}))+this.indentLevel*this.options.tabSize+2+_.size(v)-1;if("long"===this.options.lineStyle||"editorWidth"===this.options.lineStyle&&b<=(null!==(i=this.options.maxCharactersInLine)&&void 0!==i?i:200)||"short"===this.options.lineStyle&&v.length<=1||"short"===this.options.lineStyle&&a)return a||this.indentLevel--,"".concat(o).concat(d,"(").concat(v.join(p),")");var C="";C+="".concat(o).concat(d,"(\n");var y=!1;return _.forEach(t.parameters,function(O,x){var g=v[x],S=r.addIndentation(),T="\n";s?(S=0!==x&&x%2==0?"":r.addIndentation(),T=x%2!=0?" ":"\n"):c?(S=x%2==0?r.addIndentation():" ",T=x%2==0?"":"\n"):l&&(O instanceof Kn&&!y?(T=" ",y=!0):y&&(S="",y=!1)),C+=S,C+=x===v.length-1?"".concat(g,"\n"):"".concat(g,",").concat(T)}),a||this.indentLevel--,C+=this.addIndentation(),C+=")"},e.prototype.visitKeyword=function(t){return"uppercase"===this.options.functionAndKeywordCase?n.prototype.visitKeyword.call(this,t):n.prototype.visitKeyword.call(this,t).toLowerCase()},e.prototype.visitRowConstructor=function(t){var r=this,i=this.options.contextualLineBreaksAndIndentation?", ":",\n".concat(this.addIndentation()),o=t.items.map(function(a){return a.accept(r)}).join(i);return this.options.removeUnnecessaryRowParenthesis&&1===t.items.length?o:"(".concat(o,")")},e.prototype.visitTableConstructor=function(t){var r=this,i=", ",o="{",a="}";"short"===this.options.lineStyle&&(this.indentLevel++,i=",\n".concat(this.addIndentation()),o="{\n".concat(this.addIndentation()),this.indentLevel--,a="\n".concat(this.addIndentation(),"}"));var s=t.rows.map(function(c){return c.accept(r)}).join(i);return"".concat(o).concat(s).concat(a)},e.prototype.visitVarReturn=function(t){var r=this,i="uppercase"===this.options.functionAndKeywordCase?"VAR":"var",o="uppercase"===this.options.functionAndKeywordCase?"RETURN":"return",a="",s=t.variables.map(function(c){var l=c.name;return"".concat(i," ").concat(l," = ").concat(r.visitExpression(c.definition))}).join("\n".concat(this.addIndentation()));return a+="".concat(s,"\n").concat(this.addIndentation()).concat(o,"\n"),this.indentLevel++,a+=this.addIndentation(),a+=this.visitExpression(t.returnExpression),this.indentLevel--,a},e.prototype.visitBinaryExpression=function(t,r){var i,o="uppercase"===this.options.functionAndKeywordCase?r.toUpperCase():r.toLowerCase(),a=this.getExpressionType(t),s=this.getExpressionType(t.left),c=this.getExpressionType(t.right),l=!1,d=!1;0===s&&(l=!0),0===c&&(d=!0);var p=this.getPrecedence(a);if(l||13===s||p<this.getPrecedence(s)&&(l=!0),!d&&13!==c){var b=this.getPrecedence(c);(p<b||p===b&&!this.canCombine(a,c))&&(d=!0)}var C=this.visitExpression(t.left,l),y=this.visitExpression(t.right,d);return"editorWidth"===this.options.lineStyle&&C.length+y.length+2+this.indentLevel*this.options.tabSize<=(null!==(i=this.options.maxCharactersInLine)&&void 0!==i?i:200)||"long"===this.options.lineStyle||"short"===this.options.lineStyle?"".concat(C," ").concat(o," ").concat(y):"".concat(C,"\n").concat(this.addIndentation()).concat(o," ").concat(y)},e.prototype.visitUnaryExpression=function(t,r,i){var o="uppercase"===this.options.functionAndKeywordCase?r.toUpperCase():r.toLowerCase(),a=this.getExpressionType(t),s=this.getExpressionType(t.expression),c=!1;0===s&&(c=!0);var l=this.getPrecedence(a);c||13===s||l<this.getPrecedence(s)&&(c=!0);var p=this.visitExpression(t.expression,c);return"".concat(o).concat(i).concat(p)},e.prototype.lowercaseKeywordsIfNeeded=function(t,r){return"lowercase"===this.options.functionAndKeywordCase&&(t=t.replace(r,r.toLowerCase())),t},e}(Xr),Xa=function(){function n(){}return n.triggerValidation=function(e,t){var r,i=t.getModel();if(i){var o=e.getParseResult(i,void 0,void 0,void 0,$e.Validation);if(!o)return;var a=this.getMarkerDataFromErrors(o.formulaBreakup.errors,i,0),s=this.getMarkerDataFromErrors((null===(r=o.parseResult)||void 0===r?void 0:r.errors)||[],i,o.formulaBreakup.formulaStart);this.decorationsByEditor[t.getId()]?this.decorationsByEditor[t.getId()].set((0,h.__spreadArray)((0,h.__spreadArray)([],a,!0),s,!0)):this.decorationsByEditor[t.getId()]=t.createDecorationsCollection((0,h.__spreadArray)((0,h.__spreadArray)([],a,!0),s,!0))}},n.getMarkerDataFromErrors=function(e,t,r){for(var i=[],o=0,a=e;o<a.length;o++){var s=a[o],c=t.getPositionAt(r+s.segment.startPosition),l=t.getPositionAt(r+s.segment.startPosition+s.segment.length);i.push({range:new R.Range(c.lineNumber,c.column,l.lineNumber,l.column),options:{className:"squiggly-error",overviewRuler:{color:{id:"editorOverviewRuler.errorForeground"},position:R.editor.OverviewRulerLane.Right},stickiness:R.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,zIndex:30,hoverMessage:{value:s.message,isTrusted:!1}}})}return i},n.decorationsByEditor={},n}(),$a=function(){function n(){this.daxParserCache={},this.deleteKeyDown={},this.suspendCursorPositionChange={},this.forceRetokenizeEmitter=new R.Emitter,this.disposables=[],this.subscriptions=[]}return Object.defineProperty(n.prototype,"forceRetokenize",{get:function(){return this.forceRetokenizeEmitter.event},enumerable:!1,configurable:!0}),n.prototype.clearCursorPositionChange=function(e){this.suspendCursorPositionChange[e]=!1},n.prototype.initialize=function(e){var t=this;this.subscriptions.push(Ce.newConfigNotification().subscribe(function(){t.clearParserCache();for(var i=0,o=R.editor.getEditors();i<o.length;i++)t.handleModelChange(o[i],"clearParserCache")})),this.disposables.push(R.editor.onDidCreateEditor(function(r){var i;t.disposables.push(r.onDidChangeCursorPosition(function(o){i=o.position,t.suspendCursorPositionChange[r.getModel().id]||t.handleModelChange(r,o.source)})),t.listenForSpecialKeys(r),t.disposables.push(r.onDidChangeModelContent(function(o){var a;t.isModelRegistered(r.getModel().id)&&(ce.featureSwitches.resetSuggestWidgetStateBeforeCompletion&&(null===(a=Ht.n.get(r))||void 0===a||a.cancelSuggestWidget()),!i||_.some(o.changes,function(s){return!R.Range.containsPosition(s.range,i)})?(t.clearParserCache(r.getModel().id),t.handleModelChange(r,"reset"),t.forceRetokenizeEmitter.fire()):t.deleteKeyDown[r.getModel().id]&&t.handleModelChange(r,"delete"))})),t.disposables.push(r.onDidChangeModel(function(o){var a=o.newModelUrl;if(a){var s=R.editor.getModel(a);s&&t.registerModel(s,e)}}))})),this.disposables.push(R.editor.onDidCreateModel(function(r){t.registerModel(r,e)}))},n.prototype.dispose=function(){for(var e=0,t=this.subscriptions;e<t.length;e++)t[e].unsubscribe();for(var i=0,o=this.disposables;i<o.length;i++)o[i].dispose()},n.prototype.getParseResult=function(e,t,r,i,o){var a=e.getValue();if(this.isModelRegistered(e.id)){if(this.suspendCursorPositionChange[e.id])return i?this.daxParserCache[e.id].getParseResult():void 0;switch(this.daxParserCache[e.id].doesKeyMatch(a,r,t)){case Te.FullMatch:return this.daxParserCache[e.id].getParseResult();case Te.MouseCursorChange:case Te.DifferentCursorActivity:return this.parseModelExpression(e,t,r,o,!1);case Te.CacheCleared:return this.parseModelExpression(e,t||a.length,1,o);default:return this.daxParserCache[e.id].clear(),this.parseModelExpression(e,t||a.length,5,o)}}},n.prototype.handleModelChange=function(e,t){var r=e.getModel();if(r&&this.isModelRegistered(r.id)&&Ce.getConfig()){var i=r.getOffsetAt(e.getPosition()),o=this.getNewCursorActivity(r,i);if(this.daxParserCache[r.id].doesKeyMatch(r.getValue(),o,i)!==Te.FullMatch){var a=1===o&&5===this.daxParserCache[r.id].parseResultKey.cursorActivity;this.parseModelExpression(r,i,o,$e.ModelChange),Xa.triggerValidation(this,e),5===o&&"snippet"!==t&&"modelChange"!==t&&e.trigger("HandleModelChangedChangeTriggeredSuggest","editor.action.triggerSuggest",{auto:!0}),a&&this.forceRetokenizeEmitter.fire()}}},n.prototype.parseModelExpression=function(e,t,r,i,o){void 0===i&&(i=$e.Unknown),void 0===o&&(o=!0);var a=performance.now(),s=e.getValue(),c=Ce.getConfig();if(!c)throw new La("DaxMode resource config is not defined");var b,d=c.syntaxType===Ie.Formula?ti(s):{errors:[],formula:s,formulaStart:0,name:null},p={result:null},v=this.daxParserCache[e.id].getDaxParser();if(d.formula){var C=this.daxParserCache[e.id].getParseResult();if(C&&C.formulaBreakup&&d.name!==C.formulaBreakup.name&&d.formula===C.formulaBreakup.formula)b={parseResult:C.parseResult,formulaBreakup:d,parser:v};else{if(!v.tryParse(d.formula,Ce.getContext(),p,void 0,r,t-d.formulaStart,t-d.formulaStart)&&(v.clearParseState(),!v.tryParse(d.formula,Ce.getContext(),p,void 0,r,t-d.formulaStart,t-d.formulaStart)))return C;b={parseResult:p.result,formulaBreakup:d,parser:v}}}var y=performance.now();return o&&this.daxParserCache[e.id].setParseResult(s,t,b,r),this.logParseEvent(e.id,a,y,t,s,i),b},n.prototype.registerModel=function(e,t){var i,r=this;if(!this.isModelRegistered(e.id)&&e.getLanguageId()===t){var o=null===(i=Ce.getConfig())||void 0===i?void 0:i.syntaxType;this.daxParserCache[e.id]=new Za(o),this.disposables.push(e.onWillDispose(function(){r.disposeModel(e.id)}))}},n.prototype.isModelRegistered=function(e){return e in this.daxParserCache},n.prototype.disposeModel=function(e){this.daxParserCache=_.pickBy(this.daxParserCache,function(t,r){return r!==e}),this.deleteKeyDown=_.pickBy(this.deleteKeyDown,function(t,r){return r!==e}),this.suspendCursorPositionChange=_.pickBy(this.suspendCursorPositionChange,function(t,r){return r!==e})},n.prototype.clearParserCache=function(e){void 0===e&&(e=void 0);for(var r=0,i=e?[e]:Object.keys(this.daxParserCache);r<i.length;r++)this.daxParserCache[i[r]].clear()},n.prototype.listenForSpecialKeys=function(e){var t=this;this.disposables.push(e.onKeyDown(function(r){r.keyCode===R.KeyCode.Delete?t.deleteKeyDown[e.getModel().id]=!0:(r.keyCode===R.KeyCode.PageDown||r.keyCode===R.KeyCode.PageUp||r.keyCode===R.KeyCode.LeftArrow||r.keyCode===R.KeyCode.RightArrow||r.keyCode===R.KeyCode.UpArrow||r.keyCode===R.KeyCode.DownArrow||r.ctrlKey&&(r.keyCode===R.KeyCode.KeyZ||r.keyCode===R.KeyCode.KeyY))&&(t.suspendCursorPositionChange[e.getModel().id]=!0)})),this.disposables.push(e.onMouseDown(function(r){t.suspendCursorPositionChange[e.getModel().id]=!0})),this.disposables.push(e.onKeyUp(function(r){r.keyCode===R.KeyCode.Delete?t.deleteKeyDown[e.getModel().id]=!1:r.keyCode===R.KeyCode.PageDown||r.keyCode===R.KeyCode.PageUp||r.keyCode===R.KeyCode.LeftArrow||r.keyCode===R.KeyCode.RightArrow||r.keyCode===R.KeyCode.UpArrow||r.keyCode===R.KeyCode.DownArrow?(t.suspendCursorPositionChange[e.getModel().id]=!1,t.handleModelChange(e,"keyup")):r.ctrlKey&&(r.keyCode===R.KeyCode.KeyZ||r.keyCode===R.KeyCode.KeyY)&&(t.suspendCursorPositionChange[e.getModel().id]=!1,t.clearParserCache(e.getModel().id),t.handleModelChange(e,"undoRedo"))})),this.disposables.push(e.onMouseUp(function(r){t.suspendCursorPositionChange[e.getModel().id]=!1,t.handleModelChange(e,"mouseClick")}))},n.prototype.getNewCursorActivity=function(e,t){var r=this.daxParserCache[e.id].parseResultKey,i=this.daxParserCache[e.id].doesKeyMatch(e.getValue(),void 0,t);return i===Te.FullMatch?r.cursorActivity:i===Te.CacheCleared||r.expression===e.getValue()?1:5},n.prototype.logParseEvent=function(e,t,r,i,o,a){return(0,h.__awaiter)(this,void 0,void 0,function(){var s;return(0,h.__generator)(this,function(c){return s=ft.getInstance().getProviderConfig(e),s?.logger&&s.logger.logDaxEvent({startTime:t,endTime:r,expressionLength:o.length,cursorPosition:i,parseTriggerSource:a}),[2]})})},n}(),Te=function(n){return n[n.FullMatch=0]="FullMatch",n[n.NoMatch=1]="NoMatch",n[n.DifferentCursorActivity=2]="DifferentCursorActivity",n[n.CacheCleared=3]="CacheCleared",n[n.MouseCursorChange=4]="MouseCursorChange",n}({}),Za=function(){function n(e){this.parseResult=void 0,this._parseResultKey={expression:void 0,cursorPosition:void 0,cursorActivity:void 0},this.daxParser=new Ve(e===Ie.Query?Qe.MultipleQueries:Qe.Expression)}return Object.defineProperty(n.prototype,"parseResultKey",{get:function(){return this._parseResultKey},enumerable:!1,configurable:!0}),n.prototype.getDaxParser=function(){return this.daxParser},n.prototype.getParseResult=function(){return this.parseResult},n.prototype.setParseResult=function(e,t,r,i){this._parseResultKey={expression:e,cursorPosition:t,cursorActivity:i},this.parseResult=r},n.prototype.doesKeyMatch=function(e,t,r){return void 0===this.parseResultKey.expression&&void 0===this.parseResultKey.cursorPosition&&void 0===this.parseResultKey.cursorActivity?Te.CacheCleared:e===this.parseResultKey.expression&&2===t?Te.MouseCursorChange:r&&r!==this.parseResultKey.cursorPosition||e!==this.parseResultKey.expression?Te.NoMatch:t&&t!==this.parseResultKey.cursorActivity?Te.DifferentCursorActivity:Te.FullMatch},n.prototype.clear=function(){this.daxParser.clearParseState(),this.parseResult=void 0,this._parseResultKey={expression:void 0,cursorPosition:void 0,cursorActivity:void 0}},n}(),es=function(){function n(e){this.daxParserManager=e,this.onDidChangeEmitter=new R.Emitter,this.disposables=[]}return n.prototype.initialize=function(){var e=this;this.disposables.push(this.daxParserManager.forceRetokenize(function(){return e.onDidChangeEmitter.fire()}))},n.prototype.dispose=function(){for(var e=0,t=this.disposables;e<t.length;e++)t[e].dispose()},Object.defineProperty(n.prototype,"onDidChange",{get:function(){return this.onDidChangeEmitter.event},enumerable:!1,configurable:!0}),n.prototype.getLegend=function(){return{tokenTypes:["comment","function","identifier","keyword","axis","number","string","variable","measureReference","unrecognizedIdentifier","name"],tokenModifiers:["declaration"]}},n.prototype.provideDocumentSemanticTokens=function(e,t,r){if(""===e.getValue())return{data:new Uint32Array([]),resultId:null};var o=this.daxParserManager.getParseResult(e,void 0,void 0,void 0,$e.SemanticTokens);if(!o)return{data:new Uint32Array([]),resultId:null};for(var a=o.parser.tokenization.tokens,s=[0],c=1;c<e.getLineCount();c++)s.push(s[c-1]+e.getLineLength(c));var l=[],d=0,p=0,v=o.formulaBreakup.formulaStart;v>0&&l.push(0,0,v,10,0);for(var b=0,C=a;b<C.length;b++){var y=C[b],O=ts(y);if(11!==O){var x=d,g=y.startPosition+v;for(c=d;c<s.length&&g-c>=s[c];c++)x=c;g-=x,g-=s[x],l.push(x-d,x===d?g-p:g,y.length,O,0),d=x,p=g}}return{data:new Uint32Array(l),resultId:null}},n.prototype.releaseDocumentSemanticTokens=function(e){},n}();function ts(n){return n.isComment?0:n.isKeyword?3:n.matchObject instanceof Pe?4:30===n.type||31===n.type?6:36===n.type||37===n.type?5:33===n.type||35===n.type||39===n.type?11:n.isAnyKindOfIdentifier?n.matchObject instanceof pe||n.matchObject instanceof Ke||n.matchObject instanceof rt?1:n.matchObject instanceof Me?7:n.matchObject instanceof ye?8:n.matchObject instanceof de||n.matchObject instanceof ue||n.matchObject instanceof gt?2:9:11}var ns=function(){function n(e,t){this.daxParserManager=e,this.localizationService=t}return n.prototype.provideHover=function(e,t,r){var i,o=ft.getInstance().getProviderConfig(e.id);if(null!==(i=o?.hover)&&void 0!==i&&i.enabled)return o.hover.provideHover?o.hover.provideHover(e,t,r,{daxParserManager:this.daxParserManager}):this.defaultProvideHover(e,t,r)},n.prototype.defaultProvideHover=function(e,t,r){var i,o=Ce.getModel(),a=Ce.getContext();if(o&&a){var s=e.getOffsetAt(t),c=this.daxParserManager.getParseResult(e,s,2,void 0,$e.Hover);if(c?.parseResult){var l=null===(i=c.parser.tokenization)||void 0===i?void 0:i.tokens.find(function(C){return C.startPosition<=s&&s<C.startPosition+C.length});if(l){var d=l.getSegment(),p=l.matchObject,v=e.getPositionAt(d.startPosition),b=e.getPositionAt(d.startPosition+d.length);if(p instanceof pe)return this.getFunctionDetails(p,v,b);if(p instanceof ye)return this.getMeasureDetails(p,v,b,c.parser.parseTree)}}}},n.prototype.getFunctionDetails=function(e,t,r){var i=e.description||"",o=e.getDefaultPrototype();return{range:R.Range.fromPositions(t,r),contents:[{value:"**".concat(this.localizationService.get("Function"),"** ").concat(o)},{value:i}]}},n.prototype.getMeasureDetails=function(e,t,r,i){var o=e.name,a=function(n,e){for(var r,i=function(d){if(r=_.find(d.measures,function(p){return p.name.toLocaleLowerCase()===n.toLocaleLowerCase()&&(!e||e.toLowerCase()===d.name.toLowerCase())}))return"break"},o=0,a=Ce.getModel().tables;o<a.length&&"break"!==i(a[o]);o++);return r}(e.name,e.table.name),s=a?.description,c=a&&!_.isNil(a.expression),l=this.getDefinedMeasure(e.table.name,e.name,i);if(a||l){var d=a?.isExternal,p=l?l.expressionNode.segment.text:void 0,v=a&&l&&p!==a?.expression,b=l?p:c&&!d?a.expression:void 0;return{range:R.Range.fromPositions(t,r),contents:[{value:"**".concat(this.localizationService.get("Measure"),"** ").concat(o).concat(s?" \u2013 ":"").concat(s??"")},{value:b?"```dax\n"+b+"\n```":"*".concat(this.localizationService.get("Dax_Formula_Unavailable"),"*")},{value:v?"*".concat(this.localizationService.get("Dax_Query_View_Inactive_Measure"),"*\n").concat(a.expression&&!d?"```dax\n"+a.expression+"\n```":"\n*".concat(this.localizationService.get("Dax_Formula_Unavailable"),"*")):""}]}}},n.prototype.getDefinedMeasure=function(e,t,r){return this.getDefinedMeasures(r.rootNode).find(function(a){return t===a.measureDef.identifier&&e===a.measureDef.tableName})},n.prototype.getDefinedMeasures=function(e){if(!(e instanceof Bt))return[];for(var t=[],r=0,i=e.children;r<i.length;r++){var o=i[r];if(o instanceof at&&o.children[0]instanceof bt){var a=o.children[0].children.filter(function(s){return s instanceof ot&&s.isComplete});t=(0,h.__spreadArray)((0,h.__spreadArray)([],t,!0),a,!0)}}return t},n}(),rs=function(){function n(e){this.daxParserManager=e}return n.prototype.provideCodeLenses=function(e,t){var r,i=ft.getInstance().getProviderConfig(e.id);if(null!==(r=i?.codeLens)&&void 0!==r&&r.provideCodeLenses)return i.codeLens.provideCodeLenses(e,t,{daxParserManager:this.daxParserManager})},n}(),is=function(){function n(e){this.daxParserManager=e}return n.prototype.provideCodeActions=function(e,t,r,i){var o,a,s=ft.getInstance().getProviderConfig(e.id);if(null!==(o=s?.codeAction)&&void 0!==o&&o.enabled&&null!==(a=s?.codeAction)&&void 0!==a&&a.provideCodeActions)return s.codeAction.provideCodeActions(e,t,r,i,{daxParserManager:this.daxParserManager})},n}(),os={rules:[{token:"comment",foreground:"008000"},{token:"function",foreground:"3165BB"},{token:"identifier",foreground:"001080"},{token:"keyword",foreground:"0000FF"},{token:"axis",foreground:"0000FF"},{token:"number",foreground:"098658"},{token:"string",foreground:"A31515"},{token:"variable",foreground:"008080"},{token:"measureReference",foreground:"68349C"},{token:"unrecognizedIdentifier",foreground:"5F5F5F5F"},{token:"name",foreground:"000000"}],colors:{"editor.background":"#FFFFFF","minimap.background":"#FFFFFF","editorSuggestWidget.selectedBackground":"#CFE4FA","editorSuggestWidget.selectedForeground":"#242424","editorSuggestWidget.highlightForeground":"#115EA3","editorSuggestWidget.focusHighlightForeground":"#115EA3"}},as={rules:[{token:"comment",foreground:"6A9955"},{token:"function",foreground:"569CD6"},{token:"identifier",foreground:"9CDCFE"},{token:"keyword",foreground:"4FC1FF"},{token:"axis",foreground:"4FC1FF"},{token:"number",foreground:"B5CEA8"},{token:"string",foreground:"D16989"},{token:"variable",foreground:"4EC9B0"},{token:"measureReference",foreground:"C586C0"},{token:"unrecognizedIdentifier",foreground:"C8C8C8"},{token:"name",foreground:"FFFFFF"}],colors:{"editor.background":"#292929","minimap.background":"#292929","editorSuggestWidget.selectedBackground":"#0C3B5E","editorSuggestWidget.selectedForeground":"#FFFFFF","editorSuggestWidget.highlightForeground":"#479EF5","editorSuggestWidget.focusHighlightForeground":"#479EF5"}},oe="dax",ss=["var","return","not","evaluate","datatable","order","by","start","at","asc","desc","define","measure","in"],oi=function(){function n(){}return n.registerLanguageContributions=function(e,t,r){if(e===oe)return void 0===this.initializedCount&&(this.initializedCount=0,n.registerDaxContributions(t,r)),this.initializedCount++,1===this.initializedCount&&n.initializeDaxContributions(),ce.setFeatureSwitches({useSkippableParams:t.useSkippableParams,includeUndefinedOptionalFunctionParameters:t.includeUndefinedOptionalFunctionParameters,addTriviaToParseNodeMetadata:t.addTriviaToParseNodeMetadata,useParseTreeFormatting:t.useParseTreeFormatting}),this.daxContributions;(0,Qt.sr)("Only DAX language is implemented with Monaco Contributions so far")},n.disposeLanguageContributions=function(e){if(e===oe&&void 0!==this.initializedCount&&(this.initializedCount--,0===this.initializedCount)){this.daxContributions.daxParserManager.dispose(),this.daxContributions.semanticTokensProvider.dispose(),this.daxContributions.formattingEditProvider.dispose();for(var t=0,r=this.disposables;t<r.length;t++)r[t].dispose()}},n.registerDaxContributions=function(e,t){Ba.Po.unexpectedErrorHandler=function(n){setTimeout(function(){throw new ka(n)})};var r=new $a;n.overrideIntellisenseWidgetPositioningStrategy(r),ne.languages.register({id:oe,aliases:["DAX"],extensions:["dax","DAX"]});var i=function(n,e){var t="(".concat(n.join("|"),")");return{ignoreCase:!0,keywords:e,functions:n,tokenizer:{root:[{include:"@expression"}],expression:[[new RegExp("/\\*"),"comment","@comment"],[new RegExp("(//.*)"),"comment"],[new RegExp("--.*"),"comment"],[new RegExp('"'),"string","@string"],[new RegExp("[0-9"+Ve.decimalSeparator+"]e?"),"number"],[new RegExp(t+"(\\s*\\()"),["function","function-parenthesis"]],[new RegExp("\\["),"bracketed-identifier","@bracketedIdentifier"],[new RegExp("\\'"),"quoted-identifier","@quotedIdentifier"],[new RegExp("[a-z_$][a-zA-Z0-9_$]*"),{cases:{"@keywords":"keyword"}}]],comment:[[new RegExp("[^/*]+"),"comment"],[new RegExp("/\\*"),"comment","@push"],[new RegExp("\\*/"),"comment","@pop"],[new RegExp("[/*]"),"comment"]],string:[[new RegExp('[^"]+'),"string"],[new RegExp('"'),"string","@pop"]],bracketedIdentifier:[[new RegExp("[^\\]]+"),"bracketed-identifier"],[new RegExp("]"),"bracketed-identifier","@pop"]],quotedIdentifier:[[new RegExp("[^\\']+"),"quoted-identifier"],[new RegExp("'"),"quoted-identifier","@pop"]]}}}(e.functionNames,ss);ne.languages.setMonarchTokensProvider(oe,i);var o=new es(r);ne.languages.registerDocumentSemanticTokensProvider(oe,o);var a=new Ua(r);ne.languages.registerSignatureHelpProvider(oe,a);var s=new Ha(r);ne.languages.registerCompletionItemProvider(oe,s);var c=new Qa(r);ne.languages.registerDocumentFormattingEditProvider(oe,c);var l=new ns(r,t);ne.languages.registerHoverProvider(oe,l);var d=new rs(r);ne.languages.registerCodeLensProvider(oe,d);var p=new is(r);ne.languages.registerCodeActionProvider(oe,p),this.daxContributions={daxParserManager:r,monarchTokensProvider:i,semanticTokensProvider:o,signatureHelpProvider:a,completionItemProvider:s,formattingEditProvider:c,hoverProvider:l,codeLensProvider:d,codeActionProvider:p},ne.editor.defineTheme(oe,(0,h.__assign)({base:"vs",inherit:!0},os)),ne.editor.defineTheme("".concat(oe,"-dark"),(0,h.__assign)({base:"vs-dark",inherit:!0},as)),L.setLocalizedDaxStrings({incompleteNumber:t.get("DaxError_IncompleteNumber"),invalidTupleLocation:t.get("DaxError_InvalidTupleLocation"),invalidParameter:t.get("DaxError_InvalidParameter"),missingParameters:t.get("DaxError_MissingParameters"),incorrectOrderByParam:t.get("DaxError_IncorrectOrderByParam"),incorrectPartitionByParam:t.get("DaxError_IncorrectPartitionByParam"),incorrectMatchByParam:t.get("DaxError_IncorrectMatchByParam"),grammaticalError:t.get("DaxError_GrammaticalError"),functionCallOnNonFunction:t.get("DaxError_FunctionCallOnNonFunction"),rightArgumentToInOperatorNotValidTable:t.get("DaxError_RightArgumentToInOperatorNotValidTable"),tooManyParameters:t.get("DaxError_TooManyParameters"),invalidNameCharacter:t.get("DaxError_InvalidNameCharacter"),invalidIdentifier:t.get("DaxError_UnrecognizedIdentifier"),unrecognizedIdentifier:t.get("DaxError_UnrecognizedIdentifier"),variableNameReserved:t.get("DaxError_VariableNameReserved"),rowsDescription:t.get("DaxDescription_Rows"),columnsDescription:t.get("DaxDescription_Columns"),rowsColumnsDescription:t.get("DaxDescription_RowsColumns"),columnsRowsDescription:t.get("DaxDescription_ColumnsRows"),duplicateMeasureName:t.get("DaxError_DuplicateMeasure")})},n.initializeDaxContributions=function(){var e=this;this.disposables.push(ne.languages.setLanguageConfiguration(oe,{brackets:[["{","}"],["(",")"],["[","]"]],comments:{lineComment:"//",blockComment:["/*","*/"]}})),this.disposables.push(ne.editor.onDidCreateEditor(function(t){e.disposables.push(t.onDidChangeCursorSelection(function(r){if("snippet"===r.source){var i=t.getModel();if(!i)return;var o=t.getPosition();if(o&&o.equals(r.selection.getPosition())){var a=i.getPositionAt(i.getOffsetAt(r.selection.getPosition())-1),s=i.getValueInRange(ne.Range.fromPositions(a,o));e.daxContributions.signatureHelpProvider.signatureHelpTriggerCharacters.some(function(c){return c===s})&&t.trigger("ModelChangeTriggeredParameterHints","editor.action.triggerParameterHints",null)}}}))})),this.daxContributions.daxParserManager.initialize(oe),this.daxContributions.semanticTokensProvider.initialize(),this.daxContributions.formattingEditProvider.initialize()},n.overrideIntellisenseWidgetPositioningStrategy=function(e){var t=ri.j.prototype.getPosition;ri.j.prototype.getPosition=function(){try{var r=this.editor.getModel();if(!r)return null;var i=t.apply(this);if(r.getLanguageId()!==oe||!i)return i;var o=e.getParseResult(r,r.getOffsetAt(this.editor.getPosition()),void 0,!0);return o?{position:r.getPositionAt(o.formulaBreakup.formulaStart+o.parseResult.prototypePosition),preference:[ne.editor.ContentWidgetPositionPreference.ABOVE,ne.editor.ContentWidgetPositionPreference.BELOW]}:i}catch(s){return t.apply(this)}}},n.disposables=[],n}(),fn="tmdl",ai=function(){function n(){}return n.registerLanguageContributions=function(e){e===fn?(0===this.initializedCount&&R.languages.register({id:fn,aliases:["TMDL"],extensions:["tmdl"]}),this.initializedCount++):(0,Qt.sr)('Trying to register TMDL language while provided language is not "'.concat(e,'".'))},n.disposeLanguageContributions=function(e){e===fn&&this.initializedCount--},n.initializedCount=0,n}(),us=["ADD","ALL","ALTER","AND","ANY","AS","ASC","AUTHORIZATION","BACKUP","BEGIN","BETWEEN","BREAK","BROWSE","BULK","BY","CASCADE","CASE","CHECK","CHECKPOINT","CLOSE","CLUSTERED","COLLATE","COLUMN","COMMIT","COMPUTE","CONSTRAINT","CONTAINS","CONTAINSTABLE","CONTINUE","CONVERT","CREATE","CROSS","CURRENT","CURSOR","DATABASE","DBCC","DEALLOCATE","DECLARE","DEFAULT","DELETE","DENY","DESC","DISK","DISTINCT","DISTRIBUTED","DOUBLE","DROP","DUMP","ELSE","END","ERRLVL","ESCAPE","EXCEPT","EXEC","EXECUTE","EXISTS","EXIT","EXTERNAL","FETCH","FILE","FILLFACTOR","FOR","FOREIGN","FREETEXT","FREETEXTTABLE","FROM","FULL","FUNCTION","GOTO","GRANT","GROUP","HAVING","HOLDLOCK","IDENTITY","IDENTITYCOL","IDENTITY_INSERT","IF","IN","INDEX","INNER","INSERT","INTERSECT","INTO","IS","JOIN","KEY","KILL","LEFT","LIKE","LINENO","LOAD","MERGE","NATIONAL","NOCHECK","NONCLUSTERED","NOT","NULL","OF","OFF","OFFSETS","ON","OPEN","OPENDATASOURCE","OPENQUERY","OPENROWSET","OPENXML","OPTION","OR","ORDER","OUTER","OVER","PERCENT","PIVOT","PLAN","PRECISION","PRIMARY","PRINT","PROC","PROCEDURE","PUBLIC","RAISERROR","READ","READTEXT","RECONFIGURE","REFERENCES","REPLICATION","RESTORE","RESTRICT","RETURN","REVERT","REVOKE","RIGHT","ROLLBACK","ROWCOUNT","ROWGUIDCOL","RULE","SAVE","SCHEMA","SECURITYAUDIT","SELECT","SEMANTICKEYPHRASETABLE","SEMANTICSIMILARITYDETAILSTABLE","SEMANTICSIMILARITYTABLE","SET","SETUSER","SHUTDOWN","SOME","STATISTICS","TABLE","TABLESAMPLE","TEXTSIZE","THEN","TO","TOP","TRAN","TRANSACTION","TRIGGER","TRUNCATE","TRY_CONVERT","TSEQUAL","UNION","UNIQUE","UNPIVOT","UPDATE","UPDATETEXT","USE","USER","VALUES","VARYING","VIEW","WAITFOR","WHEN","WHERE","WHILE","WITH","WITHIN","WRITETEXT"],ls=["ABSOLUTE","ACTION","ADA","ADD","ALLOCATE","ARE","ASSERTION","AT","BIT","BOTH","CASCADED","CAST","CATALOG","CHAR","CHARACTER","CHARACTER_LENGTH","CHAR_LENGTH","COLLATION","CONNECT","CONNECTION","CONSTRAINTS","CORRESPONDING","DATE","DEC","DECIMAL","DEFERRABLE","DEFERRED","DESCRIBE","DESCRIPTOR","DIAGNOSTICS","DISCONNECT","DOMAIN","END-EXEC","EXCEPTION","EXTRACT","FALSE","FIRST","FLOAT","FORTRAN","FOUND","GET","GLOBAL","GO","IMMEDIATE","INCLUDE","INDICATOR","INITIALLY","INSENSITIVE","INT","INTEGER","INTERVAL","ISOLATION","LANGUAGE","LAST","LEADING","LEVEL","LOCAL","MATCH","MAX","MIN","MODULE","NAMES","NATURAL","NCHAR","NEXT","NO","NONE","NUMERIC","ONLY","OVERLAPS","PAD","PARTIAL","PASCAL","POSITION","PREPARE","PRESERVE","PRIOR","PRIVILEGES","REAL","RELATIVE","ROWS","SCROLL","SECTION","SESSION","SIZE","SMALLINT","SQL","SQLCA","SQLCODE","SQLERROR","SQLSTATE","SQLWARNING","TEMPORARY","TIME","TIMESTAMP","TIMEZONE_HOUR","TIMEZONE_MINUTE","TRAILING","TRANSLATE","TRANSLATION","TRIM","TRUE","UNKNOWN","USAGE","USING","VALUE","VARCHAR","WHENEVER","WORK","WRITE","ZONE"],cs=["ADMIN","AFTER","AGGREGATE","ALIAS","ARRAY","ASENSITIVE","ASYMMETRIC","ATOMIC","BEFORE","BINARY","BLOB","BOOLEAN","BREADTH","CALL","CALLED","CARDINALITY","CLASS","CLOB","COLLECT","COMPLETION","CONDITION","CONSTRUCTOR","CORR","COVAR_POP","COVAR_SAMP","CUBE","CURRENT_CATALOG","CURRENT_DEFAULT_TRANSFORM_GROUP","CURRENT_PATH","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TRANSFORM_GROUP_FOR_TYPE","CYCLE","DATA","DEPTH","DEREF","DESTROY","DESTRUCTOR","DETERMINISTIC","DICTIONARY","DYNAMIC","EACH","ELEMENT","EQUALS","EVERY","FILTER","FREE","FULLTEXTTABLE","FUSION","GENERAL","HOLD","HOST","IGNORE","INITIALIZE","INOUT","INPUT","INTERSECTION","ITERATE","LARGE","LATERAL","LESS","LIKE_REGEX","LIMIT","LN","LOCALTIME","LOCALTIMESTAMP","LOCATOR","MAP","MEMBER","METHOD","MOD","MODIFIES","MODIFY","MULTISET","NCLOB","NEW","NORMALIZE","OBJECT","OCCURRENCES_REGEX","OLD","OPERATION","ORDINALITY","OUT","OUTPUT","OVERLAY","PARAMETER","PARAMETERS","PARTITION","PATH","POSITION_REGEX","POSTFIX","PREFIX","PREORDER","RANGE","READS","RECURSIVE","REF","REFERENCING","REGR_AVGX","REGR_AVGY","REGR_COUNT","REGR_INTERCEPT","REGR_R2","REGR_SLOPE","REGR_SXX","REGR_SXY","REGR_SYY","RELEASE","RESULT","RETURNS","ROLE","ROLLUP","ROUTINE","ROW","SAVEPOINT","SCOPE","SEARCH","SENSITIVE","SEQUENCE","SETS","SIMILAR","SPECIFIC","SPECIFICTYPE","SQLEXCEPTION","START","STATE","STATEMENT","STATIC","STDDEV_POP","STDDEV_SAMP","STRUCTURE","SUBMULTISET","SUBSTRING_REGEX","SYMMETRIC","SYSTEM","TERMINATE","THAN","TRANSLATE_REGEX","TREAT","UESCAPE","UNDER","UNNEST","VARIABLE","VAR_POP","VAR_SAMP","WIDTH_BUCKET","WINDOW","WITHOUT","XMLAGG","XMLATTRIBUTES","XMLBINARY","XMLCAST","XMLCOMMENT","XMLCONCAT","XMLDOCUMENT","XMLELEMENT","XMLEXISTS","XMLFOREST","XMLITERATE","XMLNAMESPACES","XMLPARSE","XMLPI","XMLQUERY","XMLSERIALIZE","XMLTABLE","XMLTEXT","XMLVALIDATE"],ds=["APPLY","MATCHED"],fs=["ABS","ACOS","APPROX_COUNT_DISTINCT","ASCII","ASIN","ATAN","ATN2","AVG","BINARY_CHECKSUM","BIT_LENGTH","CEILING","CHARINDEX","CHECKSUM","COALESCE","COLLATIONPROPERTY","COL_NAME","CONCAT","COS","COT","COUNT","COUNT_BIG","CUME_DIST","CURDATE","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURTIME","DATABASEPROPERTYEX","DATALENGTH","DATEADD","DATEDIFF","DATEFROMPARTS","DATENAME","DATEPART","DATETIME2FROMPARTS","DATETIMEFROMPARTS","DATETIMEOFFSETFROMPARTS","DAY","DAYNAME","DAYOFMONTH","DAYOFWEEK","DB_ID","DB_NAME","DEGREES","DENSE_RANK","DIFFERENCE","EOMONTH","ERROR_MESSAGE","ERROR_NUMBER","ERROR_PROCEDURE","ERROR_SEVERITY","ERROR_STATE","EXP","FIRST_VALUE","FLOOR","GETDATE","GETUTCDATE","GROUPING","HASHBYTES","HAS_DBACCESS","HOUR","INDEXPROPERTY","ISDATE","ISNULL","ISNUMERIC","LAG","LAST_VALUE","LEAD","LEN","LOG10","LOWER","LTRIM","MINUTE","MONTH","MONTHNAME","NTILE","NULLIF","OBJECTPROPERTY","OBJECTPROPERTYEX","OBJECT_ID","OBJECT_NAME","OCTET_LENGTH","PARSENAME","PATINDEX","PERCENTILE_CONT","PERCENTILE_DISC","PERCENT_RANK","PI","POWER","QUARTER","QUOTENAME","RADIANS","RAND","RANK","REPLACE","REVERSE","ROUND","ROW_NUMBER","RTRIM","SCHEMA_ID","SCHEMA_NAME","SECOND","SERVERPROPERTY","SESSION_USER","SIGN","SIN","SMALLDATETIMEFROMPARTS","SOUNDEX","SPACE","SQL_VARIANT_PROPERTY","SQRT","SQUARE","STATS_DATE","STDEV","STDEVP","STR","STRING_AGG","STUFF","SUBSTRING","SUM","SUSER_SNAME","SWITCHOFFSET","SYSDATETIME","SYSDATETIMEOFFSET","SYSTEM_USER","SYSUTCDATETIME","TAN","TERTIARY_WEIGHTS","TIMEFROMPARTS","TODATETIMEOFFSET","TYPEPROPERTY","TYPE_ID","TYPE_NAME","UNICODE","UPPER","USER_NAME","VAR","VARP","WEEK","XACT_STATE","YEAR"],hs=function(){function n(){!function(){var n=Ht.n.prototype.triggerSuggest;Ht.n.prototype.triggerSuggest=function(e,t){return n.apply(this,[e,!0])}}()}return n.prototype.provideCompletionItems=function(e,t,r,i){var o=e.getWordUntilPosition(t),a={startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:o.startColumn,endColumn:o.endColumn},s={id:"editor.action.triggerSuggest",title:"TriggerSuggestion"},c=us.map(function(C){return{label:C,kind:R.languages.CompletionItemKind.Keyword,detail:"",insertText:C,range:a,command:s}}).filter(function(C){var y;return C.label.toString().startsWith(null===(y=o.word)||void 0===y?void 0:y.toLocaleUpperCase())}),l=ls.map(function(C){return{label:C,kind:R.languages.CompletionItemKind.Keyword,detail:"",insertText:C,range:a,command:s}}).filter(function(C){var y;return C.label.toString().startsWith(null===(y=o.word)||void 0===y?void 0:y.toLocaleUpperCase())}),d=cs.map(function(C){return{label:C,kind:R.languages.CompletionItemKind.Keyword,detail:"",insertText:C,range:a,command:s}}).filter(function(C){var y;return C.label.toString().startsWith(null===(y=o.word)||void 0===y?void 0:y.toLocaleUpperCase())}),p=ds.map(function(C){return{label:C,kind:R.languages.CompletionItemKind.Operator,detail:"",insertText:C,range:a,command:s}}).filter(function(C){var y;return C.label.toString().startsWith(null===(y=o.word)||void 0===y?void 0:y.toLocaleUpperCase())}),v=fs.map(function(C){return{label:C,kind:R.languages.CompletionItemKind.Function,detail:"",insertText:C,range:a,command:s}}).filter(function(C){var y;return C.label.toString().startsWith(null===(y=o.word)||void 0===y?void 0:y.toLocaleUpperCase())}),b=(0,h.__spreadArray)((0,h.__spreadArray)((0,h.__spreadArray)((0,h.__spreadArray)((0,h.__spreadArray)([],c,!0),l,!0),d,!0),p,!0),v,!0);return Promise.resolve({suggestions:b})},n.prototype.resolveCompletionItem=function(e,t){return Promise.resolve(e)},n}(),gs=function(){function n(){this.disposables=[]}return n.prototype.initialize=function(e){var t=this;this.disposables.push(R.editor.onDidCreateEditor(function(r){t.disposables.push(r.onDidChangeModelContent(function(i){t.handleModelChange(r,"reset")}))}))},n.prototype.dispose=function(){for(var e=0,t=this.disposables;e<t.length;e++)t[e].dispose()},n.prototype.handleModelChange=function(e,t){e.trigger("TriggerSuggestion","editor.action.triggerSuggest",{auto:!0,completionOptions:{providerFilter:void 0,kindFilter:void 0}})},n}(),dt="sql",si=function(){function n(){}return n.registerLanguageContributions=function(e){return e===dt?(0===this.initializedCount&&(this.initializedCount=1,n.registerSqlContributions()),1===this.initializedCount&&n.initializeSqlContributions(),this.sqlContributions):this.sqlContributions},n.disposeLanguageContributions=function(e){if(e===dt&&(this.initializedCount--,this.initializedCount<=0)){this.sqlContributions.sqlParserManager.dispose();for(var t=0,r=this.disposables;t<r.length;t++)r[t].dispose()}},n.registerSqlContributions=function(){ne.languages.register({id:dt,aliases:["sql"],extensions:["sql"]});var e=new gs,t=new hs;this.disposables.push(ne.languages.registerCompletionItemProvider(dt,t)),this.sqlContributions={sqlParserManager:e,completionItemProvider:t}},n.initializeSqlContributions=function(){this.disposables.push(ne.languages.setLanguageConfiguration(dt,{comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}]})),this.sqlContributions.sqlParserManager.initialize(dt)},n.initializedCount=0,n.disposables=[],n}(),ms=M(65966),vs=M(32238),z=function(n){return n[n.AltEnter=0]="AltEnter",n[n.AltF1=1]="AltF1",n[n.Ctrl0=2]="Ctrl0",n[n.CtrlEnter=3]="CtrlEnter",n[n.CtrlEqual=4]="CtrlEqual",n[n.CtrlF=5]="CtrlF",n[n.CtrlF3=6]="CtrlF3",n[n.CtrlH=7]="CtrlH",n[n.CtrlJ=8]="CtrlJ",n[n.CtrlMinus=9]="CtrlMinus",n[n.Enter=10]="Enter",n[n.Escape=11]="Escape",n[n.F1=12]="F1",n[n.F3=13]="F3",n[n.F8=14]="F8",n[n.ShiftEnter=15]="ShiftEnter",n}({}),ui="accessibilityWidgetVisible",li="suggestWidgetVisible",Es={scrollbar:{vertical:"visible"}},Ts={scrollbar:{vertical:"hidden"}},ci=function(){function n(e){this.editor=e}return n.prototype.insertNewLine=function(){var e=this.editor.getPosition().lineNumber;this.editor.trigger("MonacoEditorUtility.insertNewLine","lineBreakInsert",{}),this.editor.setPosition({lineNumber:e+1,column:this.editor.getModel().getLineIndentColumn(e+1)}),this.updateEditorScrollbar(),this.editor.trigger("InsertNewLineTriggeredSuggest","editor.action.triggerSuggest",{auto:!0})},n.prototype.getSelections=function(){return this.editor.getSelections()},n.prototype.setSelection=function(e){if(e){var t=this.editor.getModel();if(!(e.startPosition+e.length>this.getModelText(t).length)){var r=t.getPositionAt(e.startPosition),i=t.getPositionAt(e.startPosition+e.length);this.editor.setSelection({startLineNumber:r.lineNumber,startColumn:r.column,endLineNumber:i.lineNumber,endColumn:i.column})}}},n.prototype.setIsReadOnly=function(e){this.editor.updateOptions({readOnly:e})},n.prototype.getModelText=function(e){return e?e.getValue():""},n.prototype.getEditorText=function(){return this.getModelText(this.editor.getModel())},n.prototype.getCursorPosition=function(){var e=this.editor.getModel(),t=this.getModelText(e),r=this.editor.getSelection(),i=this.getAbsolutePositionInModel(e,r.getEndPosition(),t);return{position:i,selectionStart:r.isEmpty()?i:this.getAbsolutePositionInModel(e,r.getStartPosition(),t)}},n.prototype.getAbsolutePositionInModel=function(e,t,r){var i=e.getLinesContent();if(t.lineNumber>i.length)return r.length;for(var o=t.lineNumber-1,s=t.column>i[o].length?i[o].length:t.column-1;--o>=0;)s+=i[o].length+1;return s},n.prototype.updateEditorScrollbar=function(){var e=this.editor.getLayoutInfo();this.editor.getContentHeight()>e.height?this.editor.updateOptions(Es):this.editor.updateOptions(Ts)},n.prototype.executeCopy=function(){this.executeCommandForSelection("copy")},n.prototype.executeCut=function(){this.executeCommandForSelection("cut")},n.prototype.executeFormat=function(){var e;return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(t){switch(t.label){case 0:return[4,null===(e=this.editor.getAction("editor.action.formatDocument"))||void 0===e?void 0:e.run()];case 1:return t.sent(),[2]}})})},n.prototype.executeCommandForSelection=function(e){this.editor.getSelection().isEmpty()||document.execCommand(e)},n}(),di=M(64647),Gt=M(65181),fi=M(9380),Os=["editorContainer"],Ss=["accessibilityContent"];function xs(n,e){if(1&n){var t=f.\u0275\u0275getCurrentView();f.\u0275\u0275elementStart(0,"div",3),f.\u0275\u0275listener("keydown",function(o){f.\u0275\u0275restoreView(t);var a=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(a.onAccessibilityWidgetKeypress(o))}),f.\u0275\u0275elementStart(1,"div",4,5),f.\u0275\u0275listener("blur",function(){f.\u0275\u0275restoreView(t);var o=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(o.onAccessibilityWidgetBlur())}),f.\u0275\u0275text(3),f.\u0275\u0275element(4,"br")(5,"br"),f.\u0275\u0275text(6),f.\u0275\u0275element(7,"br")(8,"br"),f.\u0275\u0275text(9),f.\u0275\u0275element(10,"br")(11,"br"),f.\u0275\u0275text(12),f.\u0275\u0275element(13,"br")(14,"br"),f.\u0275\u0275text(15),f.\u0275\u0275elementEnd()()}if(2&n){var r=f.\u0275\u0275nextContext();f.\u0275\u0275property("ngStyle",r.accessibilityWidgetStyle),f.\u0275\u0275attribute("aria-hidden",!r.accessibilityWidgetVisible),f.\u0275\u0275advance(1),f.\u0275\u0275attribute("aria-label",r.accessibilityWidgetAria),f.\u0275\u0275advance(2),f.\u0275\u0275textInterpolate1(" ",r.accessibilityWidgetMessages.cursor," "),f.\u0275\u0275advance(3),f.\u0275\u0275textInterpolate1("- ",r.accessibilityWidgetMessages.optimized," "),f.\u0275\u0275advance(3),f.\u0275\u0275textInterpolate1("- ",r.accessibilityWidgetMessages.tabbing," "),f.\u0275\u0275advance(3),f.\u0275\u0275textInterpolate1("- ",r.accessibilityWidgetMessages.documentation," "),f.\u0275\u0275advance(3),f.\u0275\u0275textInterpolate1("",r.accessibilityWidgetMessages.dismiss," ")}}var hn=function(){function n(e,t,r,i,o,a,s){this.themeManager=e,this.element=t,this.highContrastCssGenerationService=r,this.accessibilityService=i,this.localizationService=o,this.featureSwitchService=a,this.ref=s,this.defaultMonacoProviderConfig={modelOptions:{endOfLineStyle:ne.editor.EndOfLineSequence.LF}},this.initialized=new f.EventEmitter,this.onFocus=new f.EventEmitter,this.onBlur=new f.EventEmitter,this.tabFocusMode=new f.EventEmitter,this.onContentChanged=new f.EventEmitter,this.onContentHeightChanged=new f.EventEmitter,this.onZoomLevelChanged=new f.EventEmitter,this.subscriptions=[],this.isInHighContrast=!1,this.toUnhooks=[],this.initializationTask=new ms.B}return Object.defineProperty(n.prototype,"monacoKeybindingsMap",{get:function(){return this._monacoKeybindingsMap},enumerable:!1,configurable:!0}),n.prototype.ngOnInit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var e,r,o,a,s,c,l,d=this;return(0,h.__generator)(this,function(p){switch(p.label){case 0:return[4,Promise.all([Promise.resolve().then(M.bind(M,68816)),Promise.resolve().then(M.bind(M,94124))])];case 1:return c=p.sent(),this.monacoApi={monaco:e=c[0],EditorZoom:c[1].EditorZoom},this._monacoKeybindingsMap=((l={})[z.AltEnter]=e.KeyMod.Alt|e.KeyCode.Enter,l[z.AltF1]=e.KeyMod.Alt|e.KeyCode.F1,l[z.Ctrl0]=e.KeyMod.CtrlCmd|e.KeyCode.Numpad0,l[z.CtrlEnter]=e.KeyMod.CtrlCmd|e.KeyCode.Enter,l[z.CtrlEqual]=e.KeyMod.CtrlCmd|e.KeyCode.Equal,l[z.CtrlF]=e.KeyMod.CtrlCmd|e.KeyCode.KeyF,l[z.CtrlF3]=e.KeyMod.CtrlCmd|e.KeyCode.F3,l[z.CtrlH]=e.KeyMod.CtrlCmd|e.KeyCode.KeyH,l[z.CtrlJ]=e.KeyMod.CtrlCmd|e.KeyCode.KeyJ,l[z.CtrlMinus]=e.KeyMod.CtrlCmd|e.KeyCode.Minus,l[z.Enter]=e.KeyCode.Enter,l[z.Escape]=e.KeyCode.Escape,l[z.F1]=e.KeyCode.F1,l[z.F3]=e.KeyCode.F3,l[z.F8]=e.KeyCode.F8,l[z.ShiftEnter]=e.KeyMod.Shift|e.KeyCode.Enter,l),this.mode===dt?si.registerLanguageContributions(this.mode):this.mode===oe?(r=[],this.languageOptions&&(r=this.languageOptions.Functions.map(function(v){return v.Name})),this.contributions=oi.registerLanguageContributions(this.mode,{functionNames:r,useSkippableParams:!0,includeUndefinedOptionalFunctionParameters:!0,addTriviaToParseNodeMetadata:!0,useParseTreeFormatting:!0},this.localizationService)):this.mode===fn&&ai.registerLanguageContributions(this.mode),o={automaticLayout:!1,autoClosingBrackets:"never",codeLens:!1,contextmenu:!1,folding:!1,fontSize:12,language:this.mode,lineHeight:18,lineNumbersMinChars:1,minimap:{enabled:!1},mouseWheelZoom:!0,quickSuggestions:!1,renderLineHighlight:"none",roundedSelection:!1,scrollbar:{useShadows:!1,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,selectionHighlight:!1,suggestSelection:"first",wordBasedSuggestions:!1,acceptSuggestionOnEnter:"on",wordWrap:"on",value:"","semanticHighlighting.enabled":!0,unicodeHighlight:{nonBasicASCII:!1,ambiguousCharacters:!1,invisibleCharacters:!1}},this.isReadOnly&&(o.overviewRulerBorder=!1,o.hideCursorInOverviewRuler=!0,o.lineNumbers="off"),a=null!=this.customCreationOptions?(0,h.__assign)((0,h.__assign)({},o),this.customCreationOptions):o,s=ft.getInstance().createMonacoModelWithConfig("",this.mode,this.defaultMonacoProviderConfig),this.textEditor=this.monacoApi.monaco.editor.create(this.editorContainer.nativeElement,(0,h.__assign)({model:s},a)),$(this.textEditor.getDomNode()).find("textarea.inputarea").addClass("cdk-visually-hidden"),this.monacoEditorUtility=new ci(this.textEditor),this.initializeMonacoEvents(),this.initializeHighContrastSettings(),this.initializationTask.resolve(),this.initialized.next(this),this.subscriptions.push(this.themeManager.theme$.subscribe(function(v){var b=d.resolveThemeName(v);d.theme=b,d.isInHighContrast||d.monacoApi.monaco.editor.setTheme(b)})),[2]}})})},n.prototype.ngOnChanges=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(t){switch(t.label){case 0:return[4,this.initializationTask.promise];case 1:return t.sent(),e.formulaText&&this.setText(e.formulaText.currentValue),e.isReadOnly&&!e.isReadOnly.isFirstChange()&&this.setIsReadOnly(e.isReadOnly.currentValue),e.selection&&this.monacoEditorUtility.setSelection(e.selection.currentValue),[2]}})})},n.prototype.ngOnDestroy=function(){for(var e=0,t=this.toUnhooks;e<t.length;e++)t[e].dispose();if(this.subscriptions)for(var i=0,o=this.subscriptions;i<o.length;i++)o[i].unsubscribe();this.textEditor&&this.textEditor.dispose(),oi.disposeLanguageContributions(this.mode),si.disposeLanguageContributions(this.mode),ai.disposeLanguageContributions(this.mode)},Object.defineProperty(n.prototype,"accessibilityWidgetAria",{get:function(){if(this.accessibilityWidgetMessages)return"".concat(this.accessibilityWidgetMessages.cursor," ").concat(this.accessibilityWidgetMessages.optimized," ").concat(this.accessibilityWidgetMessages.tabbing," ").concat(this.accessibilityWidgetMessages.documentation," ").concat(this.accessibilityWidgetMessages.dismiss)},enumerable:!1,configurable:!0}),n.prototype.focus=function(){this.textEditor&&this.textEditor.focus()},n.prototype.scrollTop=function(){this.textEditor.setScrollPosition({scrollTop:0})},n.prototype.copy=function(){this.monacoEditorUtility.executeCopy()},n.prototype.cut=function(){this.monacoEditorUtility.executeCut()},n.prototype.paste=function(e){for(var r=[],i=0,o=this.monacoEditorUtility.getSelections();i<o.length;i++)r.push({text:e,range:o[i],forceMoveMarkers:!0});this.textEditor.executeEdits(e,r)},n.prototype.getText=function(){return this.monacoEditorUtility.getEditorText()},n.prototype.resetModelTokens=function(e){var t;this.monacoEditorUtility.getEditorText()!==e?this.textEditor.getModel().setValue(e):null===(t=this.textModelInternal().tokenization)||void 0===t||t.resetTokenization()},n.prototype.textModelInternal=function(){return this.textEditor.getModel()},n.prototype.format=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(e){switch(e.label){case 0:return[4,this.monacoEditorUtility.executeFormat()];case 1:return e.sent(),[2]}})})},n.prototype.onAccessibilityWidgetBlur=function(){this.accessibilityWidgetVisible=!1,this.accessibilityWidgetContextKey.set(!1),this.textEditor.focus()},n.prototype.onAccessibilityWidgetKeypress=function(e){var t=!1;switch(e.code){case"KeyE":e.ctrlKey&&(t=!0,this.textEditor.updateOptions({accessibilitySupport:this.textEditor.getRawOptions().accessibilitySupport}));break;case"KeyH":e.ctrlKey&&(t=!0,window.open("https://go.microsoft.com/fwlink?linkid=2028689"));break;case"KeyM":e.ctrlKey&&(t=!0,this.toggleTabMovesFocus());break;case"Escape":t=!0,this.onAccessibilityWidgetBlur()}t&&(event.stopPropagation(),event.preventDefault())},n.prototype.layout=function(e,t){if(se.fF.assert(function(){return void 0!==e||void 0!==t},"At least one of the width/height values should be specified."),this.textEditor){var r=this.textEditor.getLayoutInfo(),i=e||r.width,o=t||r.height;this.textEditor.layout({width:i,height:o}),$(this.editorContainer).width(i).height(o)}},n.prototype.toggleTabMovesFocus=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(e){switch(e.label){case 0:return[4,this.initializationTask];case 1:return e.sent(),this.textEditor.getAction("editor.action.toggleTabFocusMode").run(),[2]}})})},n.prototype.registerActions=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){var t,r,i,o;return(0,h.__generator)(this,function(a){switch(a.label){case 0:return[4,this.initializationTask.promise];case 1:for(a.sent(),t=0,r=e;t<r.length;t++)o=(i=r[t]).keybindingContext?"".concat(this.editorContextId,"&&").concat(i.keybindingContext):this.editorContextId,i.keybindingContext=o,this.textEditor.addAction(i);return[2]}})})},n.prototype.setValue=function(e){this.textEditor.setValue(e)},n.prototype.insertTextAtCurrentCursor=function(e){this.textEditor.trigger("keyboard","paste",{text:e})},n.prototype.getHighlightedText=function(){var e=this.textEditor.getSelection();return null==e?"":this.textEditor.getModel().getValueInRange(e)},n.prototype.updateZoomLevel=function(e){se.fF.assert(function(){return e>=-5&&e<=20},"zoomLevel should be between -5 to 20"),this.monacoApi.EditorZoom.setZoomLevel(e)},n.prototype.getZoomLevel=function(){return this.monacoApi.EditorZoom.getZoomLevel()},n.prototype.showAccessibilityWidget=function(){if(!this.accessibilityWidgetVisible){this.updateAccessibilityMessage();var e=this.textEditor.getLayoutInfo();this.accessibilityWidgetStyle={top:"30px","max-width":"".concat(e.width,"px"),"max-height":"".concat(e.height-38,"px")},this.accessibilityWidgetVisible=!0,this.accessibilityWidgetContextKey.set(!0),this.ref.detectChanges(),this.accessibilityContent.nativeElement.focus()}},n.prototype.updateAccessibilityMessage=function(){var e=this.textEditor.getPosition();this.accessibilityWidgetMessages={cursor:this.localizationService.format("MonacoEditorAccessibilityMessageCursor",[e.lineNumber,e.column]),optimized:this.localizationService.get(this.textEditor.getOption(this.monacoApi.monaco.editor.EditorOption.accessibilitySupport)?"MonacoEditorAccessibilityOn":"MonacoEditorAccessibilityOff"),tabbing:this.localizationService.get(this.textEditor.getOption(this.monacoApi.monaco.editor.EditorOption.tabFocusMode)?"MonacoEditorAccessibilityTabMovesFocusOn":"MonacoEditorAccessibilityTabMovesFocusOff"),documentation:this.localizationService.get("MonacoEditorAccessibilityMessageDocumentation"),dismiss:this.localizationService.get("MonacoEditorAccessibilityMessageDismiss")}},n.prototype.initializeHighContrastSettings=function(){var e=this;this.subscriptions.push(this.accessibilityService.highContrastThemeChanged$.subscribe(function(t){return e.setHighContrastTheme(t)})),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor.hc-black .view-overlays .selected-text","{ background-color: @selectedBackgroundColor !important; border-color: @selectedBackgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor.hc-black .cursor","{ color: @foregroundColor !important; background-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .hc-black .monaco-scrollable-element > .scrollbar > .slider","{ border-color: @selectedBackgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor.hc-black .view-line span.inline-selected-text","{ color: @selectedForegroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-widget > .tree","{ background-color: @backgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-widget .details","{ background-color: @backgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-widget .suggest-icon::before","{ color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-widget .suggest-icon.codicon-symbol-struct::before","{ background-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-widget .suggest-icon.codicon-symbol-interface::before","{ background-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-widget .suggest-icon.codicon-symbol-constructor::before","{ background-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-widget .suggest-icon.codicon-symbol-module::before","{ background-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .parameter-hints-widget","{ background-color: @backgroundColor !important; }"),this.highContrastCssGenerationService.addRule(".themeableElement .monaco-editor .suggest-details","{ background-color: @backgroundColor !important; }"),this.setHighContrastTheme(this.accessibilityService.getHighContrastTheme())},n.prototype.setIsReadOnly=function(e){this.monacoEditorUtility.setIsReadOnly(e),this.textEditor.updateOptions({overviewRulerBorder:!e&&void 0,hideCursorInOverviewRuler:!!e||void 0,lineNumbers:e?"off":void 0})},n.prototype.setText=function(e){var t=this.textEditor.getModel();this.monacoEditorUtility.getEditorText()!==e&&t.applyEdits([{text:e||"",range:t.getFullModelRange()}]);var r=e?t.getPositionAt(e.length):{lineNumber:1,column:1};this.textEditor.setPosition(r)},n.prototype.setHighContrastTheme=function(e){if(!e)return this.isInHighContrast=!1,void this.monacoApi.monaco.editor.setTheme(this.theme);this.isInHighContrast=!0;var t=function(i){return"#"===i[0]?i.substr(1):i};this.monacoApi.monaco.editor.defineTheme("highContrast",{base:"hc-black",inherit:!1,rules:[{background:t(e.background),foreground:t(e.foreground),token:""}],colors:{"editor.background":e.background,"editor.foreground":e.foreground,"editorCursor.foreground":e.foreground,"editor.selectionBackground":e.selectedBackground,"editor.selectionForeground":e.selectedText,"editor.selectionHighlight":e.selected}}),this.monacoApi.monaco.editor.setTheme("highContrast")},n.prototype.initializeMonacoEvents=function(){var e=this;this.editorContextId="MonacoEditorHost".concat(this.textEditor.getId(),".focused");var t=this.textEditor.createContextKey(this.editorContextId,!1);this.toUnhooks.push(this.textEditor.onDidFocusEditorText(function(){t.set(!0),e.onFocus.emit()})),this.toUnhooks.push(this.textEditor.onDidBlurEditorText(function(){t.set(!1),e.onBlur.emit()})),this.accessibilityWidgetContextKey=this.textEditor.createContextKey(ui,!1),this.configureDefaultKeybindings(),this.toUnhooks.push(this.textEditor.onDidChangeConfiguration(function(){e.tabFocusMode.next(e.textEditor.getOption(e.monacoApi.monaco.editor.EditorOption.tabFocusMode)),e.textEditor.getModel()&&e.updateAccessibilityMessage()})),this.toUnhooks.push(this.textEditor.onDidChangeModelContent(function(r){e.onContentChanged.next(r.changes)})),this.toUnhooks.push(this.textEditor.onDidContentSizeChange(function(r){r.contentHeightChanged&&e.onContentHeightChanged.next(r.contentHeight)})),this.toUnhooks.push(this.monacoApi.EditorZoom.onDidChangeZoomLevel(function(r){e.onZoomLevelChanged.next(r),e.hideSuggestWidget()}))},n.prototype.configureDefaultKeybindings=function(){var e=this,t=[{id:"editor.action.fontZoomIn",label:this.localizationService.get("DaxEditor_CommandLabel_ZoomIn"),keybindings:[this.monacoKeybindingsMap[z.CtrlEqual]],run:function(){e.monacoApi.EditorZoom.setZoomLevel(e.monacoApi.EditorZoom.getZoomLevel()+1),e.hideSuggestWidget()}},{id:"editor.action.fontZoomOut",label:this.localizationService.get("DaxEditor_CommandLabel_ZoomOut"),keybindings:[this.monacoKeybindingsMap[z.CtrlMinus]],run:function(){e.monacoApi.EditorZoom.setZoomLevel(e.monacoApi.EditorZoom.getZoomLevel()-1),e.hideSuggestWidget()}},{id:"editor.action.fontZoomReset",label:this.localizationService.get("DaxEditor_CommandLabel_ZoomReset"),keybindings:[this.monacoKeybindingsMap[z.Ctrl0]],run:function(){e.monacoApi.EditorZoom.setZoomLevel(0),e.hideSuggestWidget()}},{id:"editor.action.showAccessibilityWidget",label:"Show Accessibility Widget",keybindings:[this.monacoKeybindingsMap[z.AltF1]],run:function(){e.showAccessibilityWidget()}},{id:"editor.action.newLineAltEnter",label:this.localizationService.get("New_Line_AltEnter"),keybindings:[this.monacoKeybindingsMap[z.AltEnter]],run:function(){return e.monacoEditorUtility.insertNewLine()}},{id:"editor.action.newLineShiftEnter",label:this.localizationService.get("New_Line_ShiftEnter"),keybindings:[this.monacoKeybindingsMap[z.ShiftEnter]],run:function(){return e.monacoEditorUtility.insertNewLine()}}];this.registerActions(t),this.textEditor.addCommand(this.monacoKeybindingsMap[z.F1],_.noop)},n.prototype.hideSuggestWidget=function(){this.textEditor.trigger(null,"hideSuggestWidget",null)},n.prototype.resolveThemeName=function(e){return this.mode===oe?"dark"===e?"dax-dark":"dax":"dark"===e?"vs-dark":"vs"},n.\u0275fac=function(t){return new(t||n)(f.\u0275\u0275directiveInject(vs.Ve),f.\u0275\u0275directiveInject(f.ElementRef),f.\u0275\u0275directiveInject(di.g),f.\u0275\u0275directiveInject(Xi.B),f.\u0275\u0275directiveInject(Gt.o),f.\u0275\u0275directiveInject(fi.vZ),f.\u0275\u0275directiveInject(f.ChangeDetectorRef))},n.\u0275cmp=f.\u0275\u0275defineComponent({type:n,selectors:[["monaco-editor-host"]],viewQuery:function(t,r){if(1&t&&(f.\u0275\u0275viewQuery(Os,7,f.ElementRef),f.\u0275\u0275viewQuery(Ss,5)),2&t){var i=void 0;f.\u0275\u0275queryRefresh(i=f.\u0275\u0275loadQuery())&&(r.editorContainer=i.first),f.\u0275\u0275queryRefresh(i=f.\u0275\u0275loadQuery())&&(r.accessibilityContent=i.first)}},inputs:{formulaText:"formulaText",isReadOnly:"isReadOnly",mode:"mode",theme:"theme",selection:"selection",customCreationOptions:"customCreationOptions",languageOptions:"languageOptions",defaultMonacoProviderConfig:"defaultMonacoProviderConfig"},outputs:{initialized:"initialized",onFocus:"onFocus",onBlur:"onBlur",tabFocusMode:"tabFocusMode",onContentChanged:"onContentChanged",onContentHeightChanged:"onContentHeightChanged",onZoomLevelChanged:"onZoomLevelChanged"},features:[f.\u0275\u0275NgOnChangesFeature],decls:3,vars:3,consts:[["focus-nav-mode","Browser",1,"monacoEditorContainer"],["editorContainer",""],["class","customAccessibilityHelpWidget","role","dialog",3,"ngStyle","keydown",4,"ngIf"],["role","dialog",1,"customAccessibilityHelpWidget",3,"ngStyle","keydown"],["role","document","tabindex","0",1,"content",3,"blur"],["accessibilityContent",""]],template:function(t,r){1&t&&(f.\u0275\u0275element(0,"div",0,1),f.\u0275\u0275template(2,xs,16,8,"div",2)),2&t&&(f.\u0275\u0275classProp("readonly",r.isReadOnly),f.\u0275\u0275advance(2),f.\u0275\u0275property("ngIf",r.accessibilityWidgetVisible))},dependencies:[Fe.NgIf,Fe.NgStyle],styles:['[_nghost-%COMP%]   .customAccessibilityHelpWidget[_ngcontent-%COMP%]{position:absolute;width:500px;height:300px;padding:4px;overflow:auto;border:1px solid var(--fluent-theme-neutral-secondary-color, #605E5C);background-color:var(--fluent-theme-neutral-light-color, #EDEBE9);z-index:1}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]{box-sizing:border-box;height:100%}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .cursors-layer[_ngcontent-%COMP%], [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .view-lines[_ngcontent-%COMP%]{cursor:inherit}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .cursors-layer[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .view-lines[_ngcontent-%COMP%]:hover{cursor:text}[_nghost-%COMP%]   .monacoEditorContainer.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%], [_nghost-%COMP%]   .monacoEditorContainer.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .inputarea[_ngcontent-%COMP%], [_nghost-%COMP%]   .monacoEditorContainer.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .monaco-editor-background[_ngcontent-%COMP%], [_nghost-%COMP%]   .monacoEditorContainer.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .margin[_ngcontent-%COMP%]{background-color:var(--fluent-theme-primary-color, #F2C811)}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .wordHighlight{background-color:transparent}@media (forced-colors: active){[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .quick-input-widget{background-color:canvas!important}}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-function:before{background-image:none;content:"\\f305";font-family:PowrMDL2;color:var(--fluent-theme-black-color, #000);font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-function:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-function:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-class:before{background-image:none;content:"\\ed86";font-family:PowrMDL2;color:var(--fluent-theme-black-color, #000);font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-class:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-class:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-property:before{background-image:none;content:"\\e4bd";font-family:PowrMDL2;color:var(--fluent-theme-black-color, #000);font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-property:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-property:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-method:before{background-image:none;content:"\\e8ef";font-family:PowrMDL2;color:var(--fluent-theme-black-color, #000);font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-method:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-method:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-enum:before{background-image:none;content:"\\f37c";font-family:PowrMDL2;color:var(--fluent-theme-black-color, #000);font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-enum:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-enum:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-folder:before{background-image:none;content:"\\f86d";font-family:PowrMDL2;color:var(--fluent-theme-black-color, #000);font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-folder:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-folder:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-event:before{background-image:none;content:"\\e787";font-family:PowrMDL2;color:var(--fluent-theme-black-color, #000);font-size:var(--sm-font-size, 12px)}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-event:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-event:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-struct:before{background-color:var(--colorNeutralForeground1);width:12px;height:12px;display:inline-block;mask:url(/minerva/images/Modeling/DaxAxisRows.svg) no-repeat 50% 50%;-webkit-mask-size:cover;mask-size:cover}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-struct:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-struct:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-interface:before{background-color:var(--colorNeutralForeground1);width:12px;height:12px;display:inline-block;mask:url(/minerva/images/Modeling/DaxAxisColumns.svg) no-repeat 50% 50%;-webkit-mask-size:cover;mask-size:cover}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-interface:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-interface:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-constructor:before{background-color:var(--colorNeutralForeground1);width:12px;height:12px;display:inline-block;mask:url(/minerva/images/Modeling/DaxAxisRowsColumns.svg) no-repeat 50% 50%;-webkit-mask-size:cover;mask-size:cover}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-constructor:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-constructor:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-module:before{background-color:var(--colorNeutralForeground1);width:12px;height:12px;display:inline-block;mask:url(/minerva/images/Modeling/DaxAxisColumnsRows.svg) no-repeat 50% 50%;-webkit-mask-size:cover;mask-size:cover}html:not([dir="rtl"])   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-module:before{padding-left:2px;padding-right:4px}html[dir="rtl"]   [_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row .suggest-icon.codicon-symbol-module:before{padding-left:4px;padding-right:2px}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused.string-label .codicon-suggest-more-info{visibility:visible;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .suggest-widget .monaco-list .monaco-list-row.focused{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}@media (forced-colors: active){[_nghost-%COMP%]   .monacoEditorContainer[_ngcontent-%COMP%]     .monaco-editor .scrollbar .slider{background-color:highlight!important}}'],changeDetection:0}),n}(),hi=M(28084),pi=M(17177),Jn=M(74913),Is=M(50057),er=M(85102),gi=function(){function n(){this.iconName="copilot_24_multicolor",this.sprite="copilot-icons"}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=f.\u0275\u0275defineComponent({type:n,selectors:[["copilot-gutter-button"]],inputs:{iconName:"iconName",sprite:"sprite"},decls:3,vars:5,consts:[["tri-button","","appearance","subtle","localize-tooltip","Ribbon_Dax_Copilot_Tooltip",1,"icon-button"],["tri-svg-icon-16","",3,"name","sprite"]],template:function(t,r){1&t&&(f.\u0275\u0275elementStart(0,"button",0),f.\u0275\u0275pipe(1,"localize"),f.\u0275\u0275element(2,"tri-svg-icon",1),f.\u0275\u0275elementEnd()),2&t&&(f.\u0275\u0275attribute("aria-label",f.\u0275\u0275pipeBind1(1,3,"Ribbon_Dax_Copilot_Tooltip")),f.\u0275\u0275advance(2),f.\u0275\u0275property("name",r.iconName)("sprite",r.sprite))},dependencies:[Jn.M,Is.r,er.F],styles:["tri-svg-icon[_ngcontent-%COMP%]{fill:var(--colorBrandForeground2);width:100%;height:100%}"]}),n}(),Ms={buttonHeightOffset:-7,rightOffset:0,onButtonClick:function(){}},As=function(){function n(){this.isInitialized=!1,this.gutterContainerSelector=".margin-view-overlays",this.currentLineSelector=".current-line",this.activeLineNumberSelector=".active-line-number"}return n.prototype.initialize=function(e,t,r){this.isInitialized||(this.isInitialized=!0,this.initializeButton(t,r),this.initializeObserver(e))},n.prototype.initializeButton=function(e,t){t=(0,h.__assign)((0,h.__assign)({},Ms),t);var r=e.createComponent(gi);this.button=r.location.nativeElement,this.button.style.right="".concat(t.rightOffset,"px"),this.button.style.position="absolute",this.button.style.top="".concat(t.buttonHeightOffset,"px"),this.button.style.cursor="pointer",this.button.addEventListener("click",t.onButtonClick)},n.prototype.initializeObserver=function(e){var t=this;e.textEditor.onDidChangeModelDecorations(function(){t.showButtonOnInit(e);var r=document.querySelector(t.gutterContainerSelector);r.childNodes.length>0&&t.observeGutterContainer(r,e)})},n.prototype.showButtonOnInit=function(e){var t=document.querySelector(this.activeLineNumberSelector),r=t?.parentElement;r&&window.getComputedStyle(r).position&&this.handleCurrentLine(t.parentElement,e)},n.prototype.observeGutterContainer=function(e,t){var r=this;this.mutationObserver&&this.mutationObserver.disconnect(),this.mutationObserver=new MutationObserver(function(i){for(var o=0,a=i;o<a.length;o++){var s=a[o];s.addedNodes.length&&r.handleAddedNodes(s.addedNodes,t)}}),this.mutationObserver.observe(e,{childList:!0})},n.prototype.handleAddedNodes=function(e,t){var r=this;e.forEach(function(i){i.querySelector(r.currentLineSelector)&&r.handleCurrentLine(i,t)})},n.prototype.handleCurrentLine=function(e,t){var r=e.querySelector(this.activeLineNumberSelector),i=r?parseInt(r.textContent,10):null,o=t.textEditor.getModel();"number"!=typeof i||i>o.getLineCount()||o.getLineContent(i).trim().length||e.appendChild(this.button)},n.\u0275prov=f.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac=function(t){return new(t||n)}}),n}(),Ns=[{type:hn,componentId:"MonacoEditorHostComponentId"}],Rs=function(){function n(){}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=f.\u0275\u0275defineInjector({providers:[As],imports:[Fe.CommonModule,hi.N.withManifests(Ns),pi.T6,cr.v]}),n}(),_s=M(93367),Ds=M(57010),Fs=M(79725),Bs=M(16095),Ls=M(53772),ks=M(44913),js=function(){function n(){}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=f.\u0275\u0275defineInjector({imports:[Fe.CommonModule,Wt.u5,_s.U,cr.v,Rs,Ds.b,Bs.Z,Fs.j,Ls.w,Yi.y,qi._,ks.lK,pi.T6]}),n}(),mi=new f.InjectionToken("IntellisenseModelService"),vi=new f.InjectionToken("FormulaBarBehaviorService"),Us=new f.InjectionToken("FormulaBarZoomService");function zs(n){switch(n){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9}}function Gs(n){var e=0;return 1===n?e=1:2===n?e=2:3===n&&(e=3),e}function Ks(n){return n?n.map(function(e){return function(n){return new xt(n.Name,n.Optional,n.Repeatable,n.RepeatGroup,n.Skippable)}(e)}):[]}var bi=M(74249),Qs=M(26112),qs=M(59694),Ci=M(34103),Ys=[" ","\t"],tr=function(){function n(e,t,r,i){this.localizationService=e,this.intellisenseHostService=t,this.intellisenseModelService=r,this.daxCapabilitiesService=i}return n.prototype.onClientViewLoaded=function(e){this.intellisenseHostService.onClientViewLoaded(e)},n.prototype.onContentChanged=function(e,t,r,i,o){this.intellisenseHostService.onContentChanged(e,t,r,i,o)},n.prototype.setUICulture=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var e,t;return(0,h.__generator)(this,function(r){switch(r.label){case 0:return[4,this.intellisenseHostService.getCultureInfo()];case 1:return e=r.sent(),function(n){mr=n}({listSeparator:(t=(0,Qs.K)(e)).listSeparator,numberDecimalSeparator:t.decimalSeparator}),[2]}})})},n.prototype.onEditorFocus=function(){this.intellisenseHostService.onEditorFocus()},n.prototype.endIntellisenseSession=function(){this.intellisenseModelService.reset(),this.intellisenseHostService.endIntellisenseSession()},n.prototype.startIntellisenseSession=function(e,t,r,i){this.intellisenseModelService.init({entityName:e,propertyName:t,schemaName:r,calculationEditMode:i}),this.intellisenseHostService.startIntellisenseSession(e,t,r,i)},n.prototype.getCalculationInfo=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){var t;return(0,h.__generator)(this,function(r){return(t=this.intellisenseModelService.findCalculationObject(e))&&null!=t.expression?[2,Promise.resolve({isNew:t.isNew,alertMessage:t.expressionErrorMessage?t.expressionErrorMessage:void 0,formulaText:this.getCalculationExpression(t)})]:(se.fF.assertFail((0,qs.W)("Cannot find editable Calculation: schema:{0} entity:{1} property:{2}",e?.schemaName,e?.entityName,e?.propertyName)),[2,Promise.resolve(void 0)])})})},n.prototype.getCalculationExpression=function(e){if(e.formulaOverride)return e.formulaOverride.formula;var t=Ve.convertToUI(e.expression);return e.calculationSyntaxType===Ie.Expression?t:function(n,e){return function(n){return j.trim(n,dn)!==n||-1!==j.indexOfAny(n,$n)||!!Jr.exec(n)}(n)&&(n=D.bracket(n)),"".concat(n," = ").concat(e)}(e.name,t)},n.prototype.updateFormulaContextAsync=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var e;return(0,h.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getDataSourceInfo()];case 1:return e=t.sent(),[4,this.updateDaxContext(e)];case 2:return t.sent(),[2]}})})},n.prototype.updateDaxContext=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){var s;return(0,h.__generator)(this,function(c){switch(c.label){case 0:return[4,this.intellisenseModelService.getDaxModeConfigInputs(e)];case 1:return s=c.sent(),Ce.configureModel(s.serializableModel,s.wireDataSourceInfo,s.daxCalculation,s.isRestrictedMode,s.axes),[2]}})})},n.prototype.getDataSourceInfo=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var e,r,o;return(0,h.__generator)(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.daxCapabilitiesService.getReservedWords(),this.daxCapabilitiesService.getCapabilities()])];case 1:return o=a.sent(),e=o[0],r=function(n){return n.map(function(e){return function(n){return{name:n.Name,description:n.Description,category:zs(n.Category),pushableToDQ:Gs(n.PushableToDirectQuery),parameters:Ks(n.Parameters),visualCalculationsInfo:n.VisualCalculationsInfo}}(e)})}(o[1].Functions),[2,{reservedWords:e,functionDataFromEngine:r}]}})})},n.prototype.analyzeFinalFormulaCommitInfo=function(e,t,r){var i=this.intellisenseModelService.getCalculationObject(),o={name:void 0,expression:void 0,invalidFormula:void 0,anonymizedExpression:void 0,parseResult:void 0},a=function(n,e,t,r){if(!r)return e.name=void 0,e.expression=void 0,e.invalidFormula=void 0,e.anonymizedExpression=void 0,!1;!function(n,e,t,r){var i=!1,o={name:void 0,expression:void 0};if((i=r.calculationSyntaxType===Ie.Expression)?o.expression=j.trimStart(n,Ys):i=function(n,e,t){var r=function(n,e){var t=ni(n,!0,!1,e),r={name:t.name,formula:t.formula,invalidFormula:void 0};return t.errors.length>0||null==t.formula?(r.formula="",r.invalidFormula=n):r.invalidFormula=null,r}(n,t);return e.name=r.name,e.expression=r.formula,null==r.invalidFormula}(n,o,r.calculationType===be.VisualCalculation),!i)return e.name=r.name||"",e.name&&!n?e.expression="":(e.invalidFormula=n,e.expression=r.expression||""),null;if(e.name=o.name,e.expression=o.expression,o.expression)if(t){(a=Ce.getContext())||se.fF.assertFail("Context should be defined");var s=new Ve,c=new Er,l={finalResult:c};s.finalParse(o.expression,a,l,ct.AddMissingParens|ct.Anonymize|ct.ConvertToEngine),e.expression=l.finalResult.updatedExpression,e.anonymizedExpression=l.finalResult.anonymizedExpression,e.parseResult=c}else{s=new Ve;var a=Ce.getContext(),p={result:new Un};s.parse(o.expression,0,void 0,void 0,a,p,void 0),e.expression=Ve.convertToEngine(o.expression),e.parseResult=p.result}}(n,e,t,r);var i,o=r.formulaOverride;return o&&(i=o.formula),r.name!==e.name||r.expression!==e.expression||i!==e.invalidFormula}(e,o,r,i);!a&&t&&i&&(a=!!i.expressionErrorMessage&&!!i.expressionOverride&&!i.formulaOverride);var l,d,p=new Map;if(a&&o.invalidFormula)switch(l={expression:null,formula:o.invalidFormula},i.calculationType){case be.Column:d=this.localizationService.get("ReportModelInvalidColumnNameMessage");break;case be.Table:d=this.localizationService.get("ReportModelInvalidCalculatedTableNameMessage");break;case be.Measure:d=this.localizationService.get("ReportModelInvalidMeasureNameMessage");break;case be.CalculationItem:d=this.localizationService.get("ReportModelInvalidCalcItemNameMessage");break;case be.VisualCalculation:break;default:se.fF.assertFail("Unknown type "+i.calculationType)}return o.parseResult instanceof Un&&o.parseResult.errors.length&&o.parseResult.errors.forEach(function(v){return p.set(v.errorCode,v.message)}),{doCommit:a,newName:o.name,newExpression:o.expression,newInvalidFormula:o.invalidFormula,anonymizedExpression:o.anonymizedExpression,expressionOverride:l,errorMessage:d,parseErrorMessages:p}},n.\u0275fac=function(t){return new(t||n)(f.\u0275\u0275inject(Gt.o),f.\u0275\u0275inject(Ci.TH),f.\u0275\u0275inject(mi),f.\u0275\u0275inject(bi.r))},n.\u0275prov=f.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n}(),yi=M(83309),Ei=function(){function n(e,t,r,i){this.intellisenseService=e,this.screenReaderService=t,this.zone=r,this.behaviorService=i,this.suspendParseCount=0}return n.prototype.setUICulture=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(e){switch(e.label){case 0:return[4,this.intellisenseService.setUICulture()];case 1:return e.sent(),[2]}})})},n.prototype.ngOnDestroy=function(){this.behaviorService.ngOnDestroy()},Object.defineProperty(n.prototype,"mode",{get:function(){return"dax"},enumerable:!1,configurable:!0}),n.prototype.registerFormulaBarControl=function(e){this.formulaBarControl=e,this.behaviorService.registerFormulaBarControl(e),this.intellisenseService.onClientViewLoaded(this)},n.prototype.onContentChanged=function(e,t,r,i){var o=this,a=this.intellisenseService.analyzeFinalFormulaCommitInfo(e,!1,!1);this.behaviorService.contentChanged||(this.behaviorService.contentChanged=a.doCommit),a.parseErrorMessages.size&&a.parseErrorMessages.forEach(function(s,c){o.screenReaderService.alertWithDebounce("dax-error"+c,s)}),this.intellisenseService.onContentChanged(e,t,r,0!==this.suspendParseCount,i.length>1),this.behaviorService.onContentChanged(a)},n.prototype.onEditorFocus=function(){this.intellisenseService.onEditorFocus()},n.prototype.hasUnsavedChanges=function(e){return this.behaviorService.hasUnsavedChanges(e)},n.prototype.onBlur=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(t){switch(t.label){case 0:return[4,this.behaviorService.commitOrDeletePendingCalculation(e)];case 1:return[2,t.sent()]}})})},n.prototype.onSubmit=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){var t;return(0,h.__generator)(this,function(r){switch(r.label){case 0:return t=this.intellisenseService.analyzeFinalFormulaCommitInfo(e,!0,!0),[4,this.behaviorService.commitCalculationUpdate(t)];case 1:return r.sent(),[2]}})})},n.prototype.onCancel=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(t){return this.behaviorService.cancel(e),[2]})})},n.prototype.onTemplateSelection=function(e){return this.behaviorService.onTemplateSelection(e)},n.prototype.setCommittedFormulaBarText=function(e){this.formulaBarControl.setCommittedFormulaBarText(e)},n.prototype.hostServiceCalculationCommitedOrDeleted=function(){this.formulaBarControl.endFormulaEdit(),this.behaviorService.contentChanged=!1},n.\u0275fac=function(t){return new(t||n)(f.\u0275\u0275inject(tr),f.\u0275\u0275inject(yi.g),f.\u0275\u0275inject(f.NgZone),f.\u0275\u0275inject(vi))},n.\u0275prov=f.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),(0,h.__decorate)([function(n,e,t){var r=t.value;t.value=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=this;this.zone.run(function(){return r.apply(a,i)})}},(0,h.__metadata)("design:type",Function),(0,h.__metadata)("design:paramtypes",[]),(0,h.__metadata)("design:returntype",void 0)],n.prototype,"hostServiceCalculationCommitedOrDeleted",null),n}(),eu=function(){function n(e,t,r){this.uiBlockingService=e,this.localizationService=t,this.intellisenseService=r}return n.prototype.registerFormulaBarControl=function(e){this.formulaBarControl=e,e.setEditModeOptions([])},n.prototype.focusWhenNotBlocked=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(e){switch(e.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return e.sent(),this.formulaBarControl.focus(),[2]}})})},n.prototype.updateReadOnlyState=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(t){switch(t.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return t.sent(),this.formulaBarControl.setReadOnly(e),[2]}})})},n.prototype.updateContents=function(e,t){return(0,h.__awaiter)(this,void 0,void 0,function(){var r;return(0,h.__generator)(this,function(i){switch(i.label){case 0:return[4,this.intellisenseService.getDataSourceInfo()];case 1:return r=i.sent(),(_.isEmpty(r.functionDataFromEngine)||_.isEmpty(r.reservedWords))&&!t&&(t=this.localizationService.get("DaxEditor_ErrorMessageToGetIntellisense")),[4,this.updateFormulaText(e,r)];case 2:return i.sent(),this.updateAlertText(t),[2]}})})},n.prototype.updateFormulaText=function(e,t){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(r){switch(r.label){case 0:return[4,this.intellisenseService.updateDaxContext(t)];case 1:return r.sent(),this.formulaBarControl.setCommittedFormulaBarText(e||null),this.contentChanged=!1,[2]}})})},n.prototype.updateAlertText=function(e){e?this.formulaBarControl.showAlertMessage(e):this.formulaBarControl.hideAlert()},n.\u0275fac=function(t){f.\u0275\u0275invalidFactory()},n.\u0275prov=f.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),Pt=M(41114),Ti="PBI.FormulaBar.EditFormulaBarObject",tu=Pt.cx[Ti]=(0,Pt.b1)(Ti),Oi="PBI.FormulaBar.SubmitDynamicFormatString",Si=Pt.cx[Oi]=(0,Pt.b1)(Oi),xi="PBI.FormulaBar.SelectTemplate",nu=Pt.cx[xi]=(0,Pt.b1)(xi),Q=M(70863),ae=function(){function n(){}return n.areSameItem=function(e,t){return _.isNil(e)&&_.isNil(t)||!!(e&&t&&e.urn===t.urn&&Q.pb(e.schemaName,t.schemaName))},n.getEntityName=function(e){return Q.wb(e)?e.name:Q.t3(e)||Q.kb(e)?e.table.name:Q.RF(e)?e.calculationGroup.table.name:void 0},n.getPropertyName=function(e){return Q.wb(e)?void 0:e.name},n.getEditableSchemaItem=function(e,t){if(t){if(Q.wb(e))return this.getTableCalculationItem(t,e.name);if(Q.kb(e))return this.getMeasureCalculationItem(t,e.schemaName,e.table.name,e.name);if(Q.t3(e))return this.getColumnCalculationItem(t,e.schemaName,e.table.name,e.name);if(Q.ez(e)){var r=Q.xu(t,e.schemaName,e.hierarchy.table.name,e.hierarchy.name,e.name),i=r&&r.column;return i&&this.getColumnCalculationItem(t,i.schemaName,i.table.name,i.name)}if(Q.RF(e))return this.getCalculationItem(t,e.schemaName,e.calculationGroup.table.name,e.name)}},n.getTableCalculationItem=function(e,t){var r=Q.AG(e,t);return r&&r.canEdit&&r.isCalculatedTable?r:void 0},n.getColumnCalculationItem=function(e,t,r,i){var o=Q.Gz(e,t,r,i);if(o){if(o.canEdit&&o.isCalculated&&!o.isGrouping)return o;if(o.table.canEdit&&o.table.isCalculatedTable)return o.table}},n.getMeasureCalculationItem=function(e,t,r,i){var o=Q.yo(e,t,r,i);return o&&o.canEditExpression?o:void 0},n.getCalculationItem=function(e,t,r,i){return Q.om(e,t,r,i)},n}(),ru=[{displayName:"Measure",key:1},{displayName:"Format",key:2}],iu=[{displayName:"Item",key:1},{displayName:"Format",key:2}],Pi=M(68082),au=M(53439),su=M(16601),uu=M(73027),lu=M(9738),cu=M(34145),De=M(95867),wi=M(58707),Ii=M(30794),du=M(63057),pn=M(14172),nr=M(83317),fu=M(24874),hu=M(59822),pu=M(10233),gu=M(91069),mu=function(n){function e(t,r,i,o,a,s,c,l,d,p,v,b){var C=n.call(this,i,c,l)||this;return C.modelingSelectionService=t,C.modelService=r,C.dataModelService=o,C.modelAuthoring=a,C.standardizedEventsService=s,C.calculationService=d,C.telemetryService=p,C.deleteModelingService=v,C.featureSwitchService=b,C.destroy$=new Ii.xQ,C.isNewCalcItem=!1,C.onModelOrSelectionChanged=function(y){var O=y[0],x=y[1],g=y[2];return(0,h.__awaiter)(C,void 0,void 0,function(){var S;return(0,h.__generator)(this,function(T){switch(T.label){case 0:return O?[4,this.onModelChanged(O)]:[3,2];case 1:return T.sent(),[3,6];case 2:return g?[4,this.onCalculationEditModeChanged(g)]:[3,4];case 3:return T.sent(),[3,6];case 4:return x?(S=_.isEmpty(x)||1!==x.length?void 0:x[0],ae.areSameItem(this.calculation,S)?[3,6]:[4,this.onActiveItemChanged(S)]):[3,6];case 5:T.sent(),T.label=6;case 6:return[2]}})})},C.onActiveItemChanged=function(y){return(0,h.__awaiter)(C,void 0,void 0,function(){var O,g;return(0,h.__generator)(this,function(S){switch(S.label){case 0:if(!this.formulaBarControl||!this.formulaBarControl.isFormulaBarActive())return[2,this.updateDynamicallyFormattedMeasureStatus()];if(!y)return[3,14];O=ae.getEditableSchemaItem(y,this.modelService.model),S.label=1;case 1:return S.trys.push([1,12,,13]),O?(O.calculationEditMode=1,[4,this.showCalculation(O)]):[3,9];case 2:switch(S.sent(),O.modelObjectType){case"Measure":return[3,3];case"CalculationItem":return[3,5]}return[3,7];case 3:return this.formulaBarControl.setEditModeOptions(ru),this.formulaBarControl.setEditMode(1),[4,this.updateDynamicallyFormattedMeasureStatus()];case 4:return S.sent(),[3,8];case 5:return this.formulaBarControl.setEditModeOptions(iu),this.formulaBarControl.setEditMode(1),[4,this.updateDynamicallyFormattedCalculationItemStatus()];case 6:return S.sent(),[3,8];case 7:this.formulaBarControl.showEditModeSelector(!1),this.formulaBarControl.setEditModeOptions([]),S.label=8;case 8:return[3,11];case 9:return[4,this.setCalculation(void 0)];case 10:S.sent(),this.formulaBarControl.setEditModeOptions([]),S.label=11;case 11:return[3,13];case 12:if((g=S.sent()).name!==Mi.name)throw g;return[3,13];case 13:return[3,16];case 14:return[4,this.setCalculation(void 0)];case 15:S.sent(),S.label=16;case 16:return[2]}})})},C.onCalculationEditModeChanged=function(y){return(0,h.__awaiter)(C,void 0,void 0,function(){return(0,h.__generator)(this,function(O){switch(O.label){case 0:return this.calculation&&y&&y!==this.calculation.calculationEditMode?[4,this.updateCalculationEditMode(y)]:[2];case 1:return O.sent(),this.formulaBarControl.focus(),[2]}})})},C.onModelChanged=function(y){return(0,h.__awaiter)(C,void 0,void 0,function(){var O,x,g,S;return(0,h.__generator)(this,function(T){switch(T.label){case 0:return this.isNewCalcItem=!!_.find(y.appliedChanges,"newCalculationItem"),this.calculation?(this.tryToUpdateCalculation(x=y.appliedChanges,O=y.model),g=ae.getEditableSchemaItem(this.calculation,O),ae.areSameItem(this.calculation,g)?[4,this.getCalculationInfo(this.calculation)]:[2,this.setCalculation(void 0)]):[2];case 1:return(S=T.sent())?(this.calculation.isNew=S.isNew,[4,this.updateContents(S.formulaText,S.alertMessage)]):[2,this.setCalculation(void 0)];case 2:return T.sent(),this.formulaBarControl.resetModelTokens(S.formulaText),this.getMeasureSelection()?[4,this.updateDynamicallyFormattedMeasureStatus()]:[3,4];case 3:T.sent(),x?.find(function(I){var w;return"Dynamic"===(null===(w=I.setFormatting)||void 0===w?void 0:w.format)})&&(this.formulaBarControl.setEditMode(2),this.formulaBarControl.focus()),T.label=4;case 4:return this.getCalculationItemSelection()?[4,this.updateDynamicallyFormattedCalculationItemStatus()]:[3,6];case 5:T.sent(),2!==this.calculation.calculationEditMode&&x?.find(function(I){var w;return'""'===(null===(w=I.setFormatString)||void 0===w?void 0:w.formatStringExpression)})&&(this.formulaBarControl.setEditMode(2),this.formulaBarControl.focus()),T.label=6;case 6:return[2]}})})},C.standardizedTelemetryFeatureNames=["DynamicFormatString"],C}return(0,h.__extends)(e,n),e.prototype.registerFormulaBarControl=function(t){var r=this;n.prototype.registerFormulaBarControl.call(this,t),(0,du.T)(this.modelService.modelChange$.pipe((0,pn.U)(function(i){return[i,void 0,void 0]})),this.modelingSelectionService.selectionChanged.pipe((0,pn.U)(function(i){return[void 0,i,void 0]})),this.formulaBarControl.editMode$.pipe((0,pn.U)(function(i){return[void 0,void 0,i]}))).pipe((0,nr.R)(this.destroy$),(0,fu.b)(this.onModelOrSelectionChanged),(0,hu.K)(function(i){return(0,h.__awaiter)(r,void 0,void 0,function(){return(0,h.__generator)(this,function(o){return[2,se.fF.assertFail(i)]})})})).subscribe(function(i){})},e.prototype.onContentChanged=function(t){},e.prototype.onTemplateSelection=function(t){},e.prototype.hasUnsavedChanges=function(t){return!!this.calculation&&(this.intellisenseService.analyzeFinalFormulaCommitInfo(t,!1,!0).doCommit||this.calculation.isNew)},e.prototype.commitOrDeletePendingCalculation=function(t){return(0,h.__awaiter)(this,void 0,void 0,function(){var r;return(0,h.__generator)(this,function(i){switch(i.label){case 0:return this.calculation?(r=this.intellisenseService.analyzeFinalFormulaCommitInfo(t,!1,!0)).doCommit?[4,this.commitCalculationUpdate(r)]:[3,2]:[3,4];case 1:case 3:return i.sent(),[2,!0];case 2:return this.calculation.isNew?[4,this.deleteCalculation()]:[3,4];case 4:return[2,!1]}})})},e.prototype.commitCalculationUpdate=function(t){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(r){switch(r.label){case 0:return se.fF.assertValue(this.calculation,"we expect this.calculation is neither undefined nor null now."),t.doCommit?(this.contentChanged=!1,2!==this.calculation.calculationEditMode?[3,2]:[4,this.updateCalculationWithFormatString(this.calculation.urn,t.newExpression,t.anonymizedExpression)]):[2];case 1:return r.sent(),[3,4];case 2:return[4,this.calculationService.updateCalculation(this.calculation.urn,t.newName,t.newExpression,t.anonymizedExpression,t.expressionOverride,t.errorMessage)];case 3:r.sent(),r.label=4;case 4:return this.telemetryService.logEvent(tu),[2]}})})},e.prototype.updateCalculationWithFormatString=function(t,r,i){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(c){switch(c.label){case 0:return se.fF.assertValue(r,"expression cannot be undefined or null"),[4,this.modelAuthoring.apply({changes:[{setFormatString:{formatString:void 0,modelObject:t,formatStringExpression:r||'""',anonymizedExpression:i}}]},!0)];case 1:return c.sent(),this.standardizedEventsService?this.standardizedEventsService.logEvent(this.telemetryService.logEvent(Si),this.standardizedTelemetryFeatureNames,!0,{ObjectType:1}):this.telemetryService.logEvent(Si),[2]}})})},e.prototype.cancel=function(t){return(0,h.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,h.__generator)(this,function(o){switch(o.label){case 0:return this.calculation?this.calculation.isNew?[4,this.deleteCalculation()]:[3,2]:[3,6];case 1:return o.sent(),[3,6];case 2:return r=this.calculation,[4,this.setCalculation(void 0)];case 3:return o.sent(),[4,this.getCalculationInfo(r)];case 4:return i=o.sent(),[4,this.setCalculation(r,t,i.alertMessage)];case 5:o.sent(),o.label=6;case 6:return[2]}})})},e.prototype.deleteCalculation=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var t,r,i;return(0,h.__generator)(this,function(o){switch(o.label){case 0:return se.fF.assertValue(this.calculation,"we expect this.calculation is neither undefined nor null now."),t=this.calculation,(r=this.calculation).isDeleted?[2]:(r.isDeleted=!0,(i=this.modelService.model)&&ae.getEditableSchemaItem(t,i)?(this.deleteModelingService.deleteModelItem([{schema:t.schemaName,tableName:ae.getEntityName(t),itemName:ae.getPropertyName(t),objectType:t.modelObjectType}],!1),this.contentChanged=!1,[4,this.setCalculation(void 0)]):[3,2]);case 1:o.sent(),o.label=2;case 2:return[2]}})})},e.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},e.prototype.updateCalculationEditMode=function(t){return(0,h.__awaiter)(this,void 0,void 0,function(){var r;return(0,h.__generator)(this,function(i){switch(i.label){case 0:return se.fF.assertValue(t,"Calculation edit mode must be defined"),se.fF.assertValue(this.calculation,"we expect this.calculation not null/undefined now."),(r=_.cloneDeep(this.calculation)).calculationEditMode=t,[4,this.showCalculation(r)];case 1:return i.sent(),[2]}})})},e.prototype.showCalculation=function(t){return(0,h.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,h.__generator)(this,function(o){switch(o.label){case 0:return[4,this.getCalculationInfo(t)];case 1:return(r=o.sent())?((i=_.cloneDeep(t)).isNew=r.isNew,[4,this.setCalculation(i,r.formulaText,r.alertMessage)]):[2,this.setCalculation(void 0)];case 2:return o.sent(),ae.areSameItem(this.calculation,i)?(this.formulaBarControl.scrollTop(),this.formulaBarControl.show(),r&&r.isNew||this.isNewCalcItem?(this.isNewCalcItem=!1,this.formulaBarControl.setSelection({startPosition:0,length:r.formulaText.length}),[4,this.focusWhenNotBlocked()]):[3,4]):[2,Promise.reject(new Mi)];case 3:o.sent(),o.label=4;case 4:return[2]}})})},e.prototype.setCalculation=function(t,r,i){var o;return void 0===r&&(r=null),void 0===i&&(i=null),(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(a){switch(a.label){case 0:return ae.areSameItem(t,this.calculation)&&t?.calculationEditMode===(null===(o=this.calculation)||void 0===o?void 0:o.calculationEditMode)?[2]:(this.calculation=t,this.calculation?this.refreshIntellisenseSession():(this.intellisenseService.endIntellisenseSession(),this.formulaBarControl.clear()),[4,this.updateReadOnlyState(!this.calculation)]);case 1:return a.sent(),[4,this.updateContents(r,i)];case 2:return a.sent(),[2]}})})},e.prototype.tryToUpdateCalculation=function(t,r){se.fF.assertValue(this.calculation,"we expect this.calculation not null/undefined now.");var i=!1;if(t){for(var o=0,a=t;o<a.length;o++){var s=a[o],c=s.entityRename;if(c&&Q.wb(this.calculation)&&Q.pb(c.schema,this.calculation.schemaName)&&c.before===this.calculation.name&&c.after!==this.calculation.name){if(!(l=_.cloneDeep(Q.AG(r,c.after))))throw new Kt("Cannot find object from model for calculation after rename entity");l.isNew=this.calculation.isNew,l.calculationEditMode=this.calculation.calculationEditMode,this.calculation=l,i=!0;break}var d=s.propertyRename;if(d&&!Q.wb(this.calculation)&&d.objectType===this.calculation.modelObjectType&&Q.pb(d.schema,this.calculation.schemaName)&&d.entity===ae.getEntityName(this.calculation)&&d.before===this.calculation.name&&d.after!==this.calculation.name){var l=void 0;if("Column"===d.objectType){if(!(l=_.cloneDeep(Q.Gz(r,d.schema,d.entity,d.after))))throw new Kt("Cannot find object from model for calculation after rename column")}else if("Measure"===d.objectType){if(!(l=_.cloneDeep(Q.yo(r,d.schema,d.entity,d.after))))throw new Kt("Cannot find object from model for calculation after rename measure")}else if("CalculationItem"===d.objectType&&!(l=_.cloneDeep(Q.om(r,d.schema,d.entity,d.after))))throw new Kt("Cannot find object from model for calculation after rename calculation item");l.isNew=this.calculation.isNew,l.calculationEditMode=this.calculation.calculationEditMode,this.calculation=l,i=!0;break}var p=s.measureMove;if(p&&Q.kb(this.calculation)&&Q.pb(p.schema,this.calculation.schemaName)&&p.source===this.calculation.table.name&&p.property===this.calculation.name&&p.destination!==this.calculation.table.name){if(!(l=_.cloneDeep(Q.yo(r,p.schema,p.destination,p.property))))throw new Kt("Cannot find object from model for calculation after move measure");l.isNew=this.calculation.isNew,l.calculationEditMode=this.calculation.calculationEditMode,this.calculation=l,i=!0;break}}i&&this.refreshIntellisenseSession()}},e.prototype.getCalculationInfo=function(t){return(0,h.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,h.__generator)(this,function(a){return r=ae.getEntityName(t),i=ae.getPropertyName(t),[2,this.intellisenseService.getCalculationInfo({entityName:r,propertyName:i,schemaName:t.schemaName,calculationEditMode:t.calculationEditMode})]})})},e.prototype.updateDynamicallyFormattedMeasureStatus=function(){var t,r,i;return(0,h.__awaiter)(this,void 0,void 0,function(){var o,a;return(0,h.__generator)(this,function(s){switch(s.label){case 0:return o=this.getMeasureSelection(),a="Dynamic"===(null===(t=o?.formatInformation)||void 0===t?void 0:t.format),null===(r=this.formulaBarControl)||void 0===r||r.showEditModeSelector(a&&this.featureSwitchService.featureSwitches.dynamicFormatString),this.calculation&&1!==this.calculation.calculationEditMode&&!a?o?[4,this.updateCalculationEditMode(1)]:[3,2]:[3,5];case 1:return s.sent(),[3,4];case 2:return[4,this.setCalculation(void 0)];case 3:s.sent(),s.label=4;case 4:null===(i=this.formulaBarControl)||void 0===i||i.setEditMode(1),s.label=5;case 5:return[2]}})})},e.prototype.getMeasureSelection=function(){return this.calculation?(0,De.yo)(this.dataModelService.getDataModel(),this.calculation.schemaName,ae.getEntityName(this.calculation),ae.getPropertyName(this.calculation)):void 0},e.prototype.updateDynamicallyFormattedCalculationItemStatus=function(){var t,r;return(0,h.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,h.__generator)(this,function(a){switch(a.label){case 0:return i=this.getCalculationItemSelection(),o=!!i.formatStringDefinition,null===(t=this.formulaBarControl)||void 0===t||t.showEditModeSelector(i&&o),this.calculation&&1!==this.calculation.calculationEditMode&&!o?i?[4,this.updateCalculationEditMode(1)]:[3,2]:[3,5];case 1:return a.sent(),[3,4];case 2:return[4,this.setCalculation(void 0)];case 3:a.sent(),a.label=4;case 4:null===(r=this.formulaBarControl)||void 0===r||r.setEditMode(1),a.label=5;case 5:return[2]}})})},e.prototype.getCalculationItemSelection=function(){return this.calculation?(0,De.om)(this.dataModelService.getDataModel(),ae.getEntityName(this.calculation),ae.getPropertyName(this.calculation)):void 0},e.prototype.refreshIntellisenseSession=function(){this.intellisenseService.endIntellisenseSession();var t=ae.getEntityName(this.calculation),r=ae.getPropertyName(this.calculation);this.intellisenseService.startIntellisenseSession(t,r,this.calculation.schemaName,this.calculation.calculationEditMode)},e.\u0275fac=function(r){return new(r||e)(f.\u0275\u0275inject(lu.W6),f.\u0275\u0275inject(cu.q),f.\u0275\u0275inject(uu.D),f.\u0275\u0275inject(Pi.n),f.\u0275\u0275inject(au.S),f.\u0275\u0275inject(su.S,8),f.\u0275\u0275inject(Gt.o),f.\u0275\u0275inject(tr),f.\u0275\u0275inject(pu.H),f.\u0275\u0275inject(wi.y0),f.\u0275\u0275inject(gu.c),f.\u0275\u0275inject(fi.vZ))},e.\u0275prov=f.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e}(eu),Mi=function(n){function e(){var t=n.call(this,"The active item was updated before the formula bar could finish initializing the editor for the previous selection")||this;return t.name="CalculationChangedDuringShowFlow",t}return(0,h.__extends)(e,n),e}(Error),Kt=function(n){function e(t){var r=n.call(this,t)||this;return r.name="CalculationNotFoundError",r}return(0,h.__extends)(e,n),e}(Error),vu={provide:vi,useClass:mu},rr=M(5207);function Cu(n){return n.tables.filter(function(e){return e.schemaName!==rr._.DataWarehouseSchema})}function yu(n){return n.relationships.filter(function(e){return e.fromTable.schemaName!==rr._.DataWarehouseSchema&&e.toTable.schemaName!==rr._.DataWarehouseSchema})}function Ou(n){if(n.variations&&n.variations.length>0)return n.variations[0].relationship.toTable.name}function Ai(n){switch(n){case"Many":case"None":return"many";case"One":return"one"}}var wu=function(){function n(e){this.dataModelService=e}return n.prototype.init=function(e){this.calculationObjectInfo=(0,h.__assign)({},e)},n.prototype.reset=function(){this.calculationObjectInfo=void 0},n.prototype.getDaxModeConfigInputs=function(e){var t=function(n){return{tables:Cu(n).map(function(e){return function(n){return{name:n.name,isUserTable:(0,De.$i)(n),description:n.description,columns:n.columns?n.columns.map(function(e){return function(n){return{name:n.name,isUserColumn:(0,De.rh)(n),description:n.description,variationTable:Ou(n)}}(e)}):[],measures:n.measures?n.measures.map(function(e){return function(n){return{name:n.name,description:n.description,expression:n.expression,isExternal:!!n.sourceLineageTag}}(e)}):[],calendars:n.calendars?n.calendars.map(function(e){return function(n){return{name:n.name}}(e)}):[]}}(e)}),relationships:n.relationships?yu(n).map(function(e){return function(n){return{active:n.isActive,from:{table:n.fromTable.name,column:n.fromColumn?n.fromColumn.name:void 0,cardinality:Ai(n.fromCardinality)},to:{table:n.toTable.name,column:n.toColumn?n.toColumn.name:void 0,cardinality:Ai(n.toCardinality)}}}(e)}):[]}}(this.dataModelService.getDataModel()),r=this.isFunctionRestrictedMode(),i=this.getDaxCalculation(),o=this.filterWireDataSourceInfo(e);return Promise.resolve({serializableModel:t,wireDataSourceInfo:o,daxCalculation:i,isRestrictedMode:r})},n.prototype.getCalculationObject=function(){return this.calculationObjectInfo&&this.findCalculationObject({entityName:this.calculationObjectInfo.entityName,propertyName:this.calculationObjectInfo.propertyName,schemaName:this.calculationObjectInfo.schemaName,calculationEditMode:this.calculationObjectInfo.calculationEditMode})},n.prototype.findCalculationObject=function(e){var t,r=e.schemaName,i=e.entityName,o=e.propertyName,a=e.calculationEditMode;if(i){var s=(0,De.Lc)(this.dataModelService.getDataModel(),r,i,o);if(!s)return;var c=s.expression,l=s.expressionErrorMessage;if(2===a){var d=s.formatStringDefinition;c=null!==(t=d?.expression)&&void 0!==t?t:"",l=d?.errorMessage}var p={name:s.name,expression:c,schemaName:s.schemaName,calculationType:this.getCalculationType(s),calculationSyntaxType:n.getCalculationSyntaxType(a),expressionErrorMessage:l};return _.isEmpty(s.annotations)||(p=(0,h.__assign)((0,h.__assign)({},p),{expressionOverride:(0,De.MZ)(s),formulaOverride:(0,De.CE)(s),isNew:(0,De.e_)(s)})),p}},n.prototype.getDaxCalculation=function(){var e,t=this.calculationObjectInfo;if(t){var r=(e=this.calculationObjectInfo).schemaName,i=e.entityName,o=e.propertyName,a=(0,De.Lc)(this.dataModelService.getDataModel(),r,i,o);if(a){var s=this.getCalculationType(a),c=n.getCalculationSyntaxType(t.calculationEditMode);return{tableName:t.entityName,calculationName:t.propertyName,type:s,syntaxType:c}}}},n.prototype.isFunctionRestrictedMode=function(){if(!this.calculationObjectInfo)return!1;var t=this.calculationObjectInfo.entityName,r=(0,De.AG)(this.dataModelService.getDataModel(),t);return!!r&&r.capabilities.requirePushableToDirectQueryDax},n.prototype.getCalculationType=function(e){if(e)switch(e.objectType){case"Column":return be.Column;case"Table":return be.Table;case"Measure":return be.Measure;case"CalculationItem":return be.CalculationItem;default:return}},n.prototype.filterWireDataSourceInfo=function(e){return{functionDataFromEngine:e.functionDataFromEngine.filter(function(i){return!i.visualCalculationsInfo||0===i.visualCalculationsInfo}),reservedWords:e.reservedWords}},n.getCalculationSyntaxType=function(e){return 2===e?Ie.Expression:Ie.Formula},n.\u0275fac=function(t){return new(t||n)(f.\u0275\u0275inject(Pi.n))},n.\u0275prov=f.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),Iu={provide:mi,useClass:wu},Mu="padding-left",Au="padding-right",Nu="padding-top",Ru="padding-bottom",_u="margin-left",Du="margin-right",Fu="margin-top",Bu="margin-bottom",Lu="border-left-width",ku="border-right-width",ju="border-top-width",Uu="border-bottom-width";function Ni(n,e){return 1===e?parseInt(n.css(Mu),10)+parseInt(n.css(Au),10):parseInt(n.css(Nu),10)+parseInt(n.css(Ru),10)}function ir(n,e){return 1===e?parseInt(n.css(_u),10)+parseInt(n.css(Du),10):parseInt(n.css(Fu),10)+parseInt(n.css(Bu),10)}function Ri(n,e){return 1===e?parseInt(n.css(Lu),10)+parseInt(n.css(ku),10):parseInt(n.css(ju),10)+parseInt(n.css(Uu),10)}function _i(n){return parseInt(n.css("minWidth"),10)}function Di(n,e,t){for(var r=ir(n,t),i=$("html")[0],o=n.parent();o.length>0&&o[0]!==i&&o[0]!==e[0];)r=r+Ni(o,t)+Ri(o,t)+ir(o,t),o=o.parent();return o[0]===e[0]?r=r+Ni(o,t)+Ri(o,t):0}var Z=M(26124),Wu=M(82762),Qu=M(59017),qu=M(77526),Yu=M(85270),Xu=M(59968),Fi=M(36858),$u=M(18378),Zu=M(698),Ju=M(35756),Bi=M(20551),el=M(64716),tl=M(85721),Li=M(21571),nl=M(73221),ki=M(64560),rl=M(25512),il=M(48787),ol=M(68291);function al(n,e){if(1&n){var t=f.\u0275\u0275getCurrentView();f.\u0275\u0275elementStart(0,"button",1),f.\u0275\u0275listener("click",function(i){f.\u0275\u0275restoreView(t);var o=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(o.showTemplatesMenu(i))}),f.\u0275\u0275pipe(1,"localize"),f.\u0275\u0275element(2,"tri-svg-icon",2),f.\u0275\u0275elementEnd()}2&n&&f.\u0275\u0275property("pbiTooltip",f.\u0275\u0275pipeBind1(1,1,"Visual_Calculation_Template_Button_Tooltip"))}var sl=function(n){function e(t,r,i,o){var a=n.call(this)||this;return a.elementRef=t,a.pbiMenuService=r,a.localizationService=i,a.telemetryService=o,a.selectedTemplate=new f.EventEmitter,a.showButton$=new Vt.X(!1),a}return(0,h.__extends)(e,n),e.prototype.ngOnInit=function(){var t=this;this.changes$("daxTemplates").pipe((0,nr.R)(this.onDestroy$)).subscribe(function(r){t.createTemplateMenu(r)})},e.prototype.showTemplatesMenu=function(t){var r=this;t.preventDefault();var i=this.templatingMenu;null!=i&&0!==i.items.length&&this.pbiMenuService.open({menu:i,origin:this.elementRef.nativeElement,flexibleConnectedPositions:[(0,rl.Oq)(0,0)],closeOnButtonClick:!0,menuMode:ki.Kb.Compact}).onButtonClick$.pipe((0,il.q)(1)).subscribe(function(a){var s=a.data;r.selectedTemplate.emit(s),r.telemetryService.logEvent(nu,{templateName:s.capabilities.name})})},e.prototype.createTemplateMenu=function(t){var r=this,i=_.map(t,function(o){var a=o.capabilities;return{type:ki.iB.Button,id:a.name,text:(0,Li.G)(a.displayName,r.localizationService),tooltip:(0,Li.G)(a.description,r.localizationService),data:o}});this.templatingMenu={items:i},this.showButton$.next(i.length>0)},e.\u0275fac=function(r){return new(r||e)(f.\u0275\u0275directiveInject(f.ElementRef),f.\u0275\u0275directiveInject(ol.o),f.\u0275\u0275directiveInject(Gt.o),f.\u0275\u0275directiveInject(wi.y0))},e.\u0275cmp=f.\u0275\u0275defineComponent({type:e,selectors:[["template-button"]],inputs:{daxTemplates:"daxTemplates"},outputs:{selectedTemplate:"selectedTemplate"},features:[f.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","templateButton","tabindex","0",3,"pbiTooltip","click",4,"ngIf"],["tabindex","0",1,"templateButton",3,"pbiTooltip","click"],["tri-svg-icon-24","","name","math_formula_20_regular","sprite","visual-calc-icons"]],template:function(r,i){1&r&&(f.\u0275\u0275template(0,al,3,3,"button",0),f.\u0275\u0275pipe(1,"async")),2&r&&f.\u0275\u0275property("ngIf",f.\u0275\u0275pipeBind1(1,1,i.showButton$))},dependencies:[Fe.NgIf,Fi.V,Jn.M,Fe.AsyncPipe,er.F],styles:[".templateButton[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:24px;background-color:transparent}.templateButton[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2)}.templateButton[_ngcontent-%COMP%]:hover{background:var(--colorNeutralBackground1Hover)}.templateButton[_ngcontent-%COMP%]:hover   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Hover)}.templateButton[_ngcontent-%COMP%]:active   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Pressed)}"]}),e}(nl.w),ul=["monacoEditorHostContainer"];function ll(n,e){if(1&n){var t=f.\u0275\u0275getCurrentView();f.\u0275\u0275elementStart(0,"monaco-editor-host",21),f.\u0275\u0275listener("initialized",function(){f.\u0275\u0275restoreView(t);var a=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(a.onMonacoEditorInitialized())})("tabFocusMode",function(a){f.\u0275\u0275restoreView(t);var s=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(s.onTabFocusModeChanged(a))})("onContentChanged",function(a){f.\u0275\u0275restoreView(t);var s=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(s.onContentChanged(a))})("onContentHeightChanged",function(a){f.\u0275\u0275restoreView(t);var s=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(s.onContentHeightChanged(a))})("onFocus",function(){f.\u0275\u0275restoreView(t);var a=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(a.onEditorFocus())}),f.\u0275\u0275elementEnd()}if(2&n){var r=e.ngIf,i=f.\u0275\u0275nextContext();f.\u0275\u0275property("selection",i.editorHost.selection)("isReadOnly",i.isReadOnly)("formulaText",i.editorHost.text)("languageOptions",r)("hidden",!i.isEditorEnabled)}}function cl(n,e){if(1&n){var t=f.\u0275\u0275getCurrentView();f.\u0275\u0275elementStart(0,"button",22),f.\u0275\u0275listener("click",function(){f.\u0275\u0275restoreView(t);var i=f.\u0275\u0275nextContext();return f.\u0275\u0275resetView(i.toggleTabMovesFocus())}),f.\u0275\u0275pipe(1,"localize"),f.\u0275\u0275elementEnd()}2&n&&f.\u0275\u0275property("pbiTooltip",f.\u0275\u0275pipeBind1(1,1,"Tab_Moves_Focus_Toggle"))}function dl(n,e){if(1&n&&(f.\u0275\u0275elementStart(0,"div",23),f.\u0275\u0275element(1,"pbi-svg-use-symbol",24)(2,"tri-svg-icon",25)(3,"textarea",26),f.\u0275\u0275elementEnd()),2&n){var t=f.\u0275\u0275nextContext();f.\u0275\u0275advance(3),f.\u0275\u0275property("pbiTooltip",t.alertText)("ngModel",t.alertText),f.\u0275\u0275attribute("aria-label",t.alertText)}}function fl(n,e){if(1&n&&(f.\u0275\u0275elementStart(0,"tri-dropdown-trigger"),f.\u0275\u0275text(1),f.\u0275\u0275pipe(2,"localize"),f.\u0275\u0275pipe(3,"async"),f.\u0275\u0275elementEnd()),2&n){var t=f.\u0275\u0275nextContext();f.\u0275\u0275advance(1),f.\u0275\u0275textInterpolate1(" ",f.\u0275\u0275pipeBind1(2,1,f.\u0275\u0275pipeBind1(3,3,t.selectedEditModeOption$).displayName)," ")}}function hl(n,e){if(1&n&&(f.\u0275\u0275elementStart(0,"tri-dropdown-item",27),f.\u0275\u0275text(1),f.\u0275\u0275pipe(2,"localize"),f.\u0275\u0275elementEnd()),2&n){var t=e.$implicit;f.\u0275\u0275property("value",t),f.\u0275\u0275advance(1),f.\u0275\u0275textInterpolate1(" ",f.\u0275\u0275pipeBind1(2,2,t.displayName)," ")}}var ji="monaco-editor-host",Ui=".formulaBarButtons",Vi=".formulaBarController",Cl=[".formulaBarEditorContainer",Ui,"ribbon [data-unique-id='clipboardGroupMlr'], ribbon [data-unique-id='clipboardGroupSlr'], .ms-Callout #FlyoutMenuId","ribbon [data-automation-type='RibbonTab'][data-unique-id='home']"],yl=function(){function n(e,t,r,i,o,a,s,c,l){var d=this;this.element=e,this.highContrastCssGenerationService=t,this.formulaBarService=r,this.localizationService=i,this.screenReaderService=o,this.formulaBarInteractionService=a,this.cdr=s,this.daxCapabilitiesService=c,this.formulaBarZoomService=l,this.catchOutsideClickEventCallBack=function(p){return!1},this.implicitEndEditingOnBlur=!0,this.navMode="Group",this.daxTemplates=[],this.beginEdit=new f.EventEmitter,this.endEdit=new f.EventEmitter,this.templateSelected=new f.EventEmitter,this.editorHost={},this.formulaBarDropdownConfigurations=[],this.destroy$=new Ii.xQ,this._dropdownOptions$=new Vt.X(void 0),this._dropdownVisible$=new Vt.X(!1),this._selectedEditModeOption$=new Vt.X(void 0),this.onDocumentMouseDownCapture=function(p){d.lastCapturedMousedownEvent=p,or(p.target)||d.formulaBarService.hasUnsavedChanges(d.getCurrentEditorText())&&p.stopImmediatePropagation()},this.onDocumentClickCapture=function(p){var v=d.lastCapturedMousedownEvent&&d.lastCapturedMousedownEvent.target;d.lastCapturedMousedownEvent=void 0;var b=!v||or(v),C=or(p.target);b||C||d.catchOutsideClickEventCallBack(p)||(d.formulaBarService.hasUnsavedChanges(d.getCurrentEditorText())&&(p.stopPropagation(),p.preventDefault()),d.onBlur())},this.triDropdownOptions={panelClass:"formulaBarDropdownPanel"},this.expandedState=1,this.languageOptions$=(0,Wu.D)(this.daxCapabilitiesService.getCapabilities())}return Object.defineProperty(n.prototype,"selectedEditModeOption$",{get:function(){return this._selectedEditModeOption$},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"editMode$",{get:function(){return this._selectedEditModeOption$.pipe((0,qu.x)(),(0,pn.U)(function(t){return t?.key}))},enumerable:!1,configurable:!0}),n.prototype.setEditMode=function(e){var t=this.formulaBarDropdownConfigurations.findIndex(function(r){return r.key===e});V(t>-1,"Invalid calculation edit mode"),this._selectedEditModeOption$.next(this.formulaBarDropdownConfigurations[t])},Object.defineProperty(n.prototype,"editModeOptions$",{get:function(){return this._dropdownOptions$.asObservable()},enumerable:!1,configurable:!0}),n.prototype.setEditModeOptions=function(e){this._dropdownOptions$.next(e),this._selectedEditModeOption$.next(void 0)},Object.defineProperty(n.prototype,"showEditModeSelector$",{get:function(){return this._dropdownVisible$.asObservable()},enumerable:!1,configurable:!0}),n.prototype.showEditModeSelector=function(e){this._dropdownVisible$.next(e)},n.prototype.ngOnInit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var e=this;return(0,h.__generator)(this,function(t){switch(t.label){case 0:return this.initializeHighContrastRules(),this.isHidden=this.autoHide,this.setReadOnly(!0),(0,Qu.aj)([this._dropdownOptions$,this._dropdownVisible$]).pipe((0,nr.R)(this.destroy$)).subscribe(function(r){var o=r[1];e.formulaBarDropdownConfigurations=r[0],e.formulaDropdownWidth=o?_i($(".dropdownContainer")):0,e.recalculateOffset(),e.onResize()}),[4,this.formulaBarService.setUICulture()];case 1:return t.sent(),[2]}})})},n.prototype.ngAfterViewInit=function(){var e=this;this.formulaBarService.registerFormulaBarControl(this),this.formulaBarInteractionService.registerFormulaBarInteractionControl(this),this.resizeObserver=new ResizeObserver(function(){window.requestAnimationFrame(function(){e.onResize()})}),this.resizeObserver.observe(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass))},n.prototype.ngOnDestroy=function(){$(this.element.nativeElement).off(Vi),$(this.monacoEditorHostContainer.nativeElement).off(Vi),this.destroy$.next(),this.destroy$.complete(),this.resizeObserver&&(this.resizeObserver.unobserve(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass)),this.resizeObserver.disconnect())},n.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert, formula-bar .formulaBar .formulaBarAlert .messageAlert","{ background-color: @backgroundColor !important; color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert","{ border: 1px solid @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarEditorContainer","{ background-color: @backgroundColor !important; }")},Object.defineProperty(n.prototype,"willCollapse",{get:function(){return 0===this.nextExpandCollapseState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isEditorEnabled",{get:function(){return!!this.lastCommittedFormulaText||this.isEditing},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"formulaBarExpanderTooltip",{get:function(){var t,r="Formula_Bar_ExpandToFull";switch(this.nextExpandCollapseState){case 0:r="Formula_Bar_CollapseToSingleLine";break;case 1:r="Formula_Bar_ExpandToFit";break;case 2:r=null!==(t=this.expandCollapseConfig.fullyExpandedTooltip)&&void 0!==t?t:"Formula_Bar_ExpandToFull"}return this.localizationService.get(r)},enumerable:!1,configurable:!0}),n.prototype.setReadOnly=function(e){this.isReadOnly=e},n.prototype.onMonacoEditorInitialized=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var e,t,r;return(0,h.__generator)(this,function(i){switch(i.label){case 0:return this.monacoEditorInitialized=!0,e=$(this.element.nativeElement),t=function(n){return parseInt(n.css("min-height"),10)}(e),r=function(n){return parseInt(n.css("max-height"),10)}(e),this.monacoEditorUtility=new ci(this.textEditorHost.textEditor),[4,this.textEditorHost.registerActions(this.getKeyboardActions())];case 1:return i.sent(),this.textEditorHeightOffset=this.calculateTextEditorHeightOffset(),this.recalculateOffset(),this.textEditorFullExpandHeight=r-this.textEditorHeightOffset,this.textEditorCollapsedHeight=t-this.textEditorHeightOffset,this.targetEditorHeight=this.textEditorCollapsedHeight,this.onContentHeightChanged(this.textEditorHost.textEditor.getContentHeight()),this.onResize(),this.focusOnInitialized&&this.focus(),[2]}})})},n.prototype.calculateTextEditorHeightOffset=function(){var e=$(this.element.nativeElement);return Di(e.find(ji),e,0)},n.prototype.onTabFocusModeChanged=function(e){this.tabMovesFocus=e},n.prototype.updateEditorExpandedHeight=function(){var e,t,r=this.alertText?20:0,i=this.expandCollapseConfig.formulaBarParentClass,o=null!==(e=this.expandCollapseConfig.expandScaleFactor)&&void 0!==e?e:1,a=null!==(t=this.expandCollapseConfig.expandOffet)&&void 0!==t?t:-80,s=o*$(this.element.nativeElement).closest(i).height()+a;this.textEditorFullExpandHeight=s-this.textEditorHeightOffset-r},n.prototype.updateFormulaBarMaxHeight=function(){var e=this.alertText?20:0,t=1e7;0===this.expandedState?t=this.textEditorCollapsedHeight+this.textEditorHeightOffset+e:1===this.expandedState&&(t=this.targetEditorHeight+this.textEditorHeightOffset+e),se.fF.assertValue(t,"maxHeight"),$(this.element.nativeElement).css("max-height",t)},n.prototype.show=function(){this.isHidden&&(this.isHidden=!1,this.cdr.detectChanges())},n.prototype.hide=function(){this.isHidden||(this.isHidden=!0)},n.prototype.clear=function(){this.setCommittedFormulaBarText(""),this.autoHide&&this.hide()},n.prototype.setSelection=function(e){this.editorHost.selection=e,this.cdr.detectChanges()},n.prototype.showAlertMessage=function(e){e=e.replace(/\n/g,""),this.alertText=e,this.screenReaderService.alert(this.localizationService.format("Formula_Bar_Warning_Aria",e)),this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},n.prototype.toggleTabMovesFocus=function(){this.textEditorHost.toggleTabMovesFocus(),this.textEditorHost.focus()},n.prototype.hideAlert=function(){this.alertText=void 0,this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},n.prototype.setCommittedFormulaBarText=function(e){this.lastCommittedFormulaText=e,this.editorHost.text=e,this.cdr.detectChanges()},n.prototype.focus=function(){this.monacoEditorInitialized?(this.textEditorHost.focus(),this.cdr.detectChanges()):this.focusOnInitialized=!0},n.prototype.scrollTop=function(){this.monacoEditorInitialized&&this.textEditorHost.scrollTop()},n.prototype.copy=function(){this.textEditorHost.copy()},n.prototype.cut=function(){this.textEditorHost.cut()},n.prototype.paste=function(e){this.textEditorHost.paste(e)},n.prototype.resetModelTokens=function(e){this.textEditorHost.resetModelTokens(e)},n.prototype.isFormulaBarActive=function(){return this.isActive},n.prototype.onToggleExpandCollapse=function(){this.setExpandCollapseState(this.nextExpandCollapseState)},n.prototype.setExpandCollapseState=function(e){switch(e){case 0:this.collapse();break;case 1:this.fitToContent();break;case 2:this.fullExpand()}this.calculateNextExpandCollapseState()},n.prototype.calculateNextExpandCollapseState=function(){switch(this.expandedState){case 0:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?2:1;break;case 1:this.nextExpandCollapseState=this.editorContentHeight>=this.textEditorFullExpandHeight?0:this.editorContentHeight<=this.textEditorCollapsedHeight||this.isEditing?2:0;break;case 2:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?1:0;break;default:se.fF.assertNever(this.expandedState)}},n.prototype.fullExpand=function(){this.expandedState=2,this.updateEditorExpandedHeight(),this.layout(void 0,this.textEditorFullExpandHeight)},n.prototype.fitToContent=function(){this.expandedState=1,this.updateEditorExpandedHeight(),this.targetEditorHeight=Math.max(this.textEditorCollapsedHeight,Math.min(this.textEditorFullExpandHeight,this.editorContentHeight)),this.layout(void 0,this.targetEditorHeight)},n.prototype.collapse=function(){this.expandedState=0,this.layout(void 0,this.textEditorCollapsedHeight)},n.prototype.layout=function(e,t){this.updateFormulaBarMaxHeight(),this.monacoEditorInitialized&&this.textEditorHost.layout(e,t)},n.prototype.recalculateOffset=function(){var e,t=$(Ui),r=$(this.element.nativeElement),i=r.find(ji);this.textEditorWidthOffset=Di(i,r,1)+_i(t)+ir(t,1)+(null!==(e=this.formulaDropdownWidth)&&void 0!==e?e:0)},n.prototype.commitFormulaBarEdit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var e;return(0,h.__generator)(this,function(t){switch(t.label){case 0:return this.endFormulaEdit(),(e=this.getCurrentEditorText())===this.lastCommittedFormulaText?[3,2]:(this.lastCommittedFormulaText=e,[4,this.formulaBarService.onSubmit(e)]);case 1:return t.sent(),[3,4];case 2:return[4,this.formulaBarService.onSubmit(e)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},n.prototype.onBlur=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(e){switch(e.label){case 0:return this.implicitEndEditingOnBlur?this.endFormulaEdit():(this.removeFocus(),this.removeCatchClickOutsideFormulaBar()),this.lastCommittedFormulaText=this.monacoEditorInitialized?this.getCurrentEditorText():"",[4,this.formulaBarService.onBlur(this.lastCommittedFormulaText)];case 1:return[2,e.sent()]}})})},n.prototype.removeFocus=function(){$(document.activeElement).blur(),$(document.body).focus()},n.prototype.onContentChanged=function(e){var t=this.monacoEditorUtility.getCursorPosition();this.formulaBarService.onContentChanged(this.monacoEditorUtility.getEditorText(),t.position,t.selectionStart,e)},n.prototype.onContentHeightChanged=function(e){this.editorContentHeight=e+2,(1===this.expandedState||0===this.expandedState&&this.isEditing)&&this.fitToContent(),this.calculateNextExpandCollapseState()},n.prototype.submit=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(e){switch(e.label){case 0:return[4,this.commitFormulaBarEdit()];case 1:return e.sent(),[2]}})})},n.prototype.cancel=function(){this.endFormulaEdit(),this.formulaBarService.onCancel(this.lastCommittedFormulaText),this.autoHide&&this.hide()},n.prototype.onEditorFocus=function(){this.isEditorEnabled&&(this.isReadOnly||this.isEditing?this.implicitEndEditingOnBlur||this.catchClickOutsideFormulaBar():this.beginFormulaEdit(),this.formulaBarService.onEditorFocus())},n.prototype.catchClickOutsideFormulaBar=function(){document.body.addEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.addEventListener("click",this.onDocumentClickCapture,!0),document.body.addEventListener("contextmenu",this.onDocumentClickCapture,!0)},n.prototype.removeCatchClickOutsideFormulaBar=function(){document.body.removeEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.removeEventListener("click",this.onDocumentClickCapture,!0),document.body.removeEventListener("contextmenu",this.onDocumentClickCapture,!0)},n.prototype.endFormulaEdit=function(){this.isEditing=!1,this.removeFocus(),this.removeCatchClickOutsideFormulaBar(),this.endEdit.emit()},n.prototype.beginFormulaEdit=function(){this.isEditing=!0,this.catchClickOutsideFormulaBar(),this.beginEdit.emit()},n.prototype.onResize=function(){var e,t;if(this.monacoEditorInitialized){var r;2===this.expandedState?(this.updateEditorExpandedHeight(),r=this.textEditorFullExpandHeight):1===this.expandedState&&(this.updateEditorExpandedHeight(),r=Math.min(this.textEditorFullExpandHeight,this.targetEditorHeight));var i=this.element.nativeElement.getBoundingClientRect().width||1e3,o=null!==(t=null===(e=this.formulaBarZoomService)||void 0===e?void 0:e.getZoomLevel())&&void 0!==t?t:1;this.layout(i/o-this.textEditorWidthOffset,r)}},n.prototype.selectTemplate=function(e){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(t){switch(t.label){case 0:return[4,this.formulaBarService.onTemplateSelection(e)];case 1:return t.sent(),this.templateSelected.emit(),[2]}})})},n.prototype.insertTextAtCurrentCursor=function(e){this.textEditorHost.insertTextAtCurrentCursor(e)},n.prototype.getCurrentEditorText=function(){return this.textEditorHost.getText()},n.prototype.getHighlightedText=function(){return this.textEditorHost.getHighlightedText()},n.prototype.getKeyboardActions=function(){var e=this;return[{id:"formulaBar.find",label:"Find",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.CtrlF]],run:_.noop},{id:"formulaBar.findNext",label:"Find next",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.F3]],run:_.noop},{id:"formulaBar.findPrevious",label:"Find previous",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.CtrlF3]],run:_.noop},{id:"formulaBar.replace",label:"Replace",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.CtrlH]],run:_.noop},{id:"formulaBar.errorNavigator",label:"Error navigator",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.F8]],run:_.noop},{id:"formulaBar.escape",label:"Escape",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.Escape]],run:function(){var r=e.textEditorHost.textEditor.getSelections();r.length<=1?e.cancel():e.textEditorHost.textEditor.setSelection(r[0])},keybindingContext:"!".concat(ui,"&&!").concat(li,"&&!").concat("parameterHintsVisible")},{id:"formulaBar.submit",label:"Submit",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.CtrlEnter]],run:function(){e.submit()}},{id:"formulaBar.enter",label:"Enter",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.Enter]],run:function(){e.submit()},keybindingContext:"!".concat(li)},{id:"formulaBar.toggleExpandCollapse",label:"Toggle expand collapse",keybindings:[this.textEditorHost.monacoKeybindingsMap[z.CtrlJ]],run:function(){e.onToggleExpandCollapse()}}]},n.\u0275fac=function(t){return new(t||n)(f.\u0275\u0275directiveInject(f.ElementRef),f.\u0275\u0275directiveInject(di.g),f.\u0275\u0275directiveInject(Ei),f.\u0275\u0275directiveInject(Gt.o),f.\u0275\u0275directiveInject(yi.g),f.\u0275\u0275directiveInject(Yu.l),f.\u0275\u0275directiveInject(f.ChangeDetectorRef),f.\u0275\u0275directiveInject(bi.r),f.\u0275\u0275directiveInject(Us,8))},n.\u0275cmp=f.\u0275\u0275defineComponent({type:n,selectors:[["formula-bar"]],viewQuery:function(t,r){if(1&t&&(f.\u0275\u0275viewQuery(ul,7,f.ElementRef),f.\u0275\u0275viewQuery(hn,5)),2&t){var i=void 0;f.\u0275\u0275queryRefresh(i=f.\u0275\u0275loadQuery())&&(r.monacoEditorHostContainer=i.first),f.\u0275\u0275queryRefresh(i=f.\u0275\u0275loadQuery())&&(r.textEditorHost=i.first)}},hostVars:1,hostBindings:function(t,r){1&t&&f.\u0275\u0275listener("desktopUIResizeFormulaBar",function(){return r.onResize()}),2&t&&f.\u0275\u0275hostProperty("hidden",r.isHidden)},inputs:{autoHide:"autoHide",isActive:"isActive",catchOutsideClickEventCallBack:"catchOutsideClickEventCallBack",expandCollapseConfig:"expandCollapseConfig",implicitEndEditingOnBlur:"implicitEndEditingOnBlur",navMode:"navMode",shouldAlwaysEnableCancelButton:"shouldAlwaysEnableCancelButton",daxTemplates:"daxTemplates"},outputs:{beginEdit:"beginEdit",endEdit:"endEdit",templateSelected:"templateSelected"},decls:29,vars:42,consts:[["keyboard-shortcuts","ctrl-F6","focus-priority","11",1,"formulaBar",3,"hidden","on-resize"],[1,"formulaBarEditorContainer"],[1,"formulaBarEditor"],["tabindex","0",1,"formulaBarEditorMain",3,"keydown.enter"],["monacoEditorHostContainer",""],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus",4,"ngIf"],["data-unique-id","formula-bar-chevron",1,"formulaBarExpander",3,"disabled","pbiTooltip","click"],["tri-svg-icon-16","","name","chevron_down_16_regular"],[1,"accessibililtyMessages"],["class","message","localize","Tab_Moves_Focus",3,"pbiTooltip","click",4,"ngIf"],["class","formulaBarAlert",4,"ngIf"],[1,"formulaBarDropdown"],[1,"dropdownContainer",3,"compact","options","isDisabled","value","valueChange"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"formulaBarButtons"],["data-unique-id","formula-bar-cancel",1,"formulaBarCancel",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","dismiss_20_regular"],["data-unique-id","formula-bar-commit",1,"formulaBarCommit",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","checkmark_20_regular"],["data-unique-id","formula-bar-template-button",3,"daxTemplates","selectedTemplate"],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus"],["localize","Tab_Moves_Focus",1,"message",3,"pbiTooltip","click"],[1,"formulaBarAlert"],["symbolId","alert","sheet","filterPaneIcons",1,"imageAlert"],["tri-svg-icon-16","","name","dismiss_circle_16_filled"],["data-unique-id","formula-bar-alert","row","1","cols","1","readonly","","pbiTooltipPosition","below",1,"messageAlert",3,"pbiTooltip","ngModel"],[3,"value"]],template:function(t,r){1&t&&(f.\u0275\u0275elementStart(0,"div",0),f.\u0275\u0275listener("on-resize",function(){return r.onResize()}),f.\u0275\u0275pipe(1,"localize"),f.\u0275\u0275elementStart(2,"div",1)(3,"div",2)(4,"div",3,4),f.\u0275\u0275listener("keydown.enter",function(){return r.focus()}),f.\u0275\u0275template(6,ll,1,5,"monaco-editor-host",5),f.\u0275\u0275pipe(7,"async"),f.\u0275\u0275elementEnd(),f.\u0275\u0275elementStart(8,"button",6),f.\u0275\u0275listener("click",function(){return r.onToggleExpandCollapse()}),f.\u0275\u0275element(9,"tri-svg-icon",7),f.\u0275\u0275elementEnd()(),f.\u0275\u0275elementStart(10,"div",8),f.\u0275\u0275template(11,cl,2,3,"button",9),f.\u0275\u0275elementEnd(),f.\u0275\u0275template(12,dl,4,3,"div",10),f.\u0275\u0275elementEnd(),f.\u0275\u0275elementStart(13,"div",11),f.\u0275\u0275pipe(14,"async"),f.\u0275\u0275elementStart(15,"tri-dropdown",12),f.\u0275\u0275listener("valueChange",function(o){return r.setEditMode(o.key)}),f.\u0275\u0275pipe(16,"async"),f.\u0275\u0275template(17,fl,4,5,"tri-dropdown-trigger",13),f.\u0275\u0275pipe(18,"async"),f.\u0275\u0275template(19,hl,3,4,"tri-dropdown-item",14),f.\u0275\u0275pipe(20,"async"),f.\u0275\u0275elementEnd()(),f.\u0275\u0275elementStart(21,"div",15)(22,"button",16),f.\u0275\u0275listener("click",function(){return r.cancel()}),f.\u0275\u0275pipe(23,"localize"),f.\u0275\u0275element(24,"tri-svg-icon",17),f.\u0275\u0275elementEnd(),f.\u0275\u0275elementStart(25,"button",18),f.\u0275\u0275listener("click",function(){return r.submit()}),f.\u0275\u0275pipe(26,"localize"),f.\u0275\u0275element(27,"tri-svg-icon",19),f.\u0275\u0275elementEnd(),f.\u0275\u0275elementStart(28,"template-button",20),f.\u0275\u0275listener("selectedTemplate",function(o){return r.selectTemplate(o)}),f.\u0275\u0275elementEnd()()()),2&t&&(f.\u0275\u0275classProp("readonly",r.isReadOnly),f.\u0275\u0275property("hidden",r.isHidden||!r.monacoEditorInitialized),f.\u0275\u0275attribute("focus-nav-mode",r.navMode)("aria-label",f.\u0275\u0275pipeBind1(1,26,"Formula_Bar")),f.\u0275\u0275advance(2),f.\u0275\u0275classProp("hasAlert",r.alertText),f.\u0275\u0275advance(4),f.\u0275\u0275property("ngIf",f.\u0275\u0275pipeBind1(7,28,r.languageOptions$)),f.\u0275\u0275advance(2),f.\u0275\u0275property("disabled",!r.monacoEditorInitialized||!r.isEditorEnabled)("pbiTooltip",r.formulaBarExpanderTooltip),f.\u0275\u0275advance(1),f.\u0275\u0275property("@chevron",r.nextExpandCollapseState),f.\u0275\u0275advance(2),f.\u0275\u0275property("ngIf",r.tabMovesFocus&&!r.isReadOnly&&r.isEditorEnabled),f.\u0275\u0275advance(1),f.\u0275\u0275property("ngIf",!!r.alertText),f.\u0275\u0275advance(1),f.\u0275\u0275classProp("hideFormulaBarDropdown",!f.\u0275\u0275pipeBind1(14,30,r.showEditModeSelector$)),f.\u0275\u0275advance(2),f.\u0275\u0275property("compact",!0)("options",r.triDropdownOptions)("isDisabled",r.isReadOnly)("value",f.\u0275\u0275pipeBind1(16,32,r.selectedEditModeOption$)),f.\u0275\u0275advance(2),f.\u0275\u0275property("ngIf",f.\u0275\u0275pipeBind1(18,34,r.selectedEditModeOption$)),f.\u0275\u0275advance(2),f.\u0275\u0275property("ngForOf",f.\u0275\u0275pipeBind1(20,36,r.editModeOptions$)),f.\u0275\u0275advance(3),f.\u0275\u0275property("pbiTooltip",f.\u0275\u0275pipeBind1(23,38,"Cancel_ButtonText"))("disabled",r.shouldAlwaysEnableCancelButton?!r.monacoEditorInitialized:!r.isEditing||!r.monacoEditorInitialized),f.\u0275\u0275advance(3),f.\u0275\u0275property("pbiTooltip",f.\u0275\u0275pipeBind1(26,40,"Commit_ButtonText"))("disabled",!r.isEditing||!r.monacoEditorInitialized),f.\u0275\u0275advance(3),f.\u0275\u0275property("daxTemplates",r.daxTemplates))},dependencies:[Fe.NgForOf,Fe.NgIf,Wt.Fj,Wt.JJ,Wt.On,Xu.X,hn,Fi.V,$u.R,Zu.O,Ju.q,Bi.M3,el.l,tl.q,Bi.ii,Jn.M,sl,Fe.AsyncPipe,er.F],styles:['[_nghost-%COMP%]{--read-only-button-foreground: var(--fluent-theme-neutral-secondary-alt-color);--read-only-background: var(--fluent-theme-neutral-tertiary-color);--read-only-border-color: var(--fluent-theme-neutral-tertiary-color);--button-background: transparent;--button-foreground: var(--gray-180);--editor-container-border-color: var(--fluent-theme-neutral-tertia-color);--editor-container-background: var(--fluent-theme-white-color);--expander-foreground-hover: var(--fluent-theme-black-color);--accessibility-message-background: var(--fluent-theme-neutral-primary-color);--accessibility-message-foreground: var(--fluent-theme-white-color);--accessibility-message-background-focus: var(--fluent-theme-neutral-tertiary-alt-color);--alert-foreground: var(--fluent-theme-black-color);--alert-background: var(--fluent-theme-warning-background-color);--alert-border: none;--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--fluent-theme-neutral-tertiary-alt-color);--submit-cancel-buttons-background: var(--fluent-theme-white-color);--cancel-button-foreground: var(--fluent-theme-error-dark-color);--commit-button-foreground: var(--fluent-theme-success-icon-color);--gray-host-background: var(--gray-20);--gray-border-color: var(--gray-60);--gray-read-only-background: var(--gray-20);--gray-read-only-border: var(--gray-40);position:relative;padding:4px;min-height:36px;max-height:36px;width:100%;box-sizing:border-box;display:flex;flex-direction:column}[data-legacy-theming=false]   [_nghost-%COMP%]{--read-only-button-foreground: var(--colorNeutralForegroundDisabled);--read-only-background: var(--colorNeutralBackgroundDisabled);--read-only-border-color: var(--colorNeutralStrokeDisabled);--button-background: transparent;--button-foreground: var(--colorNeutralForeground1);--editor-container-border-color: var(--colorNeutralStroke1);--editor-container-background: var(--colorNeutralBackground1);--expander-foreground-hover: var(--colorNeutralStrokeFocus2);--accessibility-message-background: var(--colorCompoundBrandBackground);--accessibility-message-foreground: var(--colorNeutralForegroundOnBrand);--accessibility-message-background-focus: var(--colorCompoundBrandBackgroundHover);--alert-foreground: var(--colorNeutralForeground1);--alert-background: var(--colorDangerBackground1);--alert-border: 1px solid var(--colorDangerBorder1);--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--colorNeutralStroke1);--submit-cancel-buttons-background: var(--colorNeutralBackground1);--cancel-button-foreground: var(--colorDangerForeground1);--commit-button-foreground: var(--colorSuccessForeground1);--gray-host-background: var(--colorNeutralBackground3);--gray-border-color: var(--colorNeutralStroke2);--gray-read-only-background: var(--colorNeutralBackground3);--gray-read-only-border: var(--colorNeutralStrokeDisabled)}[hidden][_nghost-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]{flex-grow:1;cursor:default;box-sizing:border-box;display:flex}[_nghost-%COMP%]   .formulaBar[hidden][_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--read-only-button-foreground)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-color:var(--read-only-border-color);background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]{background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--button-background);color:var(--button-foreground)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:currentcolor}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   [disabled][_ngcontent-%COMP%]{opacity:.4}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{order:1;flex-grow:1;height:100%;display:flex;flex-direction:column;margin-left:3px;min-height:28px;box-sizing:border-box;border:1px solid var(--editor-container-border-color);background-color:var(--editor-container-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer.hasAlert[_ngcontent-%COMP%]{min-height:48px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;padding-top:2px;padding-right:21px;display:flex;flex-direction:column;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;background-color:transparent;-webkit-user-select:none}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;width:16px;height:16px;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus:not(:disabled){color:var(--expander-foreground-hover)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-left:2px;padding:2px;background-color:var(--accessibility-message-background);color:var(--accessibility-message-foreground);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:focus{background-color:var(--accessibility-message-background-focus)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]{width:100%;height:20px;box-sizing:border-box;color:var(--alert-foreground);background-color:var(--alert-background);outline:var(--alert-border);display:flex;padding-left:2px;align-items:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--alert-icon)}[data-legacy-theming=true]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{width:16px;height:16px}[data-legacy-theming=false]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .messageAlert[_ngcontent-%COMP%]{cursor:default;flex-grow:1;height:100%;box-sizing:border-box;border:none;padding-top:2px;padding-left:4px;background-color:var(--alert-background);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:11px;resize:none;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]{margin-right:3px;font-size:14px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown.hideFormulaBarDropdown[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]{min-width:100px;height:28px;box-sizing:border-box}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]     button{min-width:inherit;height:inherit}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]{min-width:76px;flex:0;height:28px;box-sizing:border-box;border:1px solid var(--submit-cancel-buttons-border);display:flex;align-items:center;justify-content:space-evenly;background-color:var(--submit-cancel-buttons-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-content:center;justify-content:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--colorNeutralForegroundDisabled)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus:not(:disabled){background:var(--colorNeutralBackground1Hover)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--cancel-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--commit-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:none}.gray-theme   [_nghost-%COMP%]{background-color:var(--gray-host-background)}.gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-radius:2px;border-color:var(--gray-border-color)}.gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{background-color:var(--gray-read-only-background);border-color:var(--gray-read-only-border)}@media print{formula-bar[_ngcontent-%COMP%]   .formulaBar[_ngcontent-%COMP%]{display:none}}'],data:{animation:[(0,Z.X$)("chevron",[(0,Z.SB)("".concat(0),(0,Z.oB)({transform:"rotate(180deg)"})),(0,Z.SB)("".concat(2),(0,Z.oB)({transform:"rotate(0deg)"})),(0,Z.SB)("".concat(1),(0,Z.oB)({transform:"rotate(0deg)"})),(0,Z.eR)("".concat(1," => ").concat(2,", ").concat(2," => ").concat(1),[(0,Z.jt)(150,(0,Z.F4)([(0,Z.oB)({transform:"rotate(0deg)",offset:0}),(0,Z.oB)({transform:"rotate(45deg)",offset:.5}),(0,Z.oB)({transform:"rotate(0deg)",offset:1})]))]),(0,Z.eR)("* => ".concat(0),[(0,Z.jt)(150,(0,Z.F4)([(0,Z.oB)({transform:"rotate(0deg)",offset:0}),(0,Z.oB)({transform:"rotate(180deg)",offset:1})]))]),(0,Z.eR)("".concat(0," => *"),[(0,Z.jt)(150,(0,Z.F4)([(0,Z.oB)({transform:"rotate(180deg)",offset:0}),(0,Z.oB)({transform:"rotate(0deg)",offset:1})]))])])]}}),n}();function or(n){return _.some(Cl,function(e){var t=$(n),r=$(e);return r.is(t)||!!r.find(t).length})}var El=function(){function n(){this.catchOutsideClickEventCallBack=function(e){return!1},this.beginEdit=new f.EventEmitter,this.endEdit=new f.EventEmitter}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=f.\u0275\u0275defineComponent({type:n,selectors:[["formula-bar-model"]],inputs:{isActive:"isActive",autoHide:"autoHide",catchOutsideClickEventCallBack:"catchOutsideClickEventCallBack",expandCollapseConfig:"expandCollapseConfig",shouldAlwaysEnableCancelButton:"shouldAlwaysEnableCancelButton"},outputs:{beginEdit:"beginEdit",endEdit:"endEdit"},features:[f.\u0275\u0275ProvidersFeature([Ei,tr,Ci.Dz,vu,Iu])],decls:1,vars:4,consts:[[3,"autoHide","isActive","expandCollapseConfig","shouldAlwaysEnableCancelButton","catchOutsideClickEventCallBack","beginEdit","endEdit"]],template:function(t,r){1&t&&(f.\u0275\u0275elementStart(0,"formula-bar",0),f.\u0275\u0275listener("catchOutsideClickEventCallBack",function(){return r.catchOutsideClickEventCallBack})("beginEdit",function(){return r.beginEdit})("endEdit",function(){return r.endEdit}),f.\u0275\u0275elementEnd()),2&t&&f.\u0275\u0275property("autoHide",r.autoHide)("isActive",r.isActive)("expandCollapseConfig",r.expandCollapseConfig)("shouldAlwaysEnableCancelButton",r.shouldAlwaysEnableCancelButton)},dependencies:[yl],encapsulation:2}),n}(),Ol=[{componentId:M(81343).ro,type:El}],Sl=function(){function n(){}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=f.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=f.\u0275\u0275defineInjector({imports:[hi.N.withManifests(Ol),js]}),n}()}}]);