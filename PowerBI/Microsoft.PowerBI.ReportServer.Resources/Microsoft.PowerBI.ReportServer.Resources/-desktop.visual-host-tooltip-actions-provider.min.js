"use strict";

(self.webpackChunkdesktop = self.webpackChunkdesktop || []).push([ [ "visual-host-tooltip-actions-provider" ], {
    22005: function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {
        __webpack_require__.r(__webpack_exports__), __webpack_require__.d(__webpack_exports__, {
            VisualHostTooltipActionsProviderModule: function() {
                return VisualHostTooltipActionsProviderModule;
            }
        });
        var tslib_es6 = __webpack_require__(81337), exploration_capabilities_service = __webpack_require__(48145), exploration_extensibility_service = __webpack_require__(91120), view_mode_state_service = __webpack_require__(77200), visual_authoring_service = __webpack_require__(66890), context_activity_service = __webpack_require__(22292), conceptual_schema_proxy_service = __webpack_require__(26898), drill_service = __webpack_require__(13363), data_sources_service = __webpack_require__(83008), event_bridge_service = __webpack_require__(11494), exploration_navigation_service = __webpack_require__(39503), visual_plugin_operations_service = __webpack_require__(66977), running_visual_service = __webpack_require__(8082), lazy_scoped_provider = __webpack_require__(28894), visualContainerContextMenuCommands = __webpack_require__(24921), debug = __webpack_require__(62458), Telemetry = __webpack_require__(21617), core = __webpack_require__(50423), VisualHostTooltipActionsProvider = function() {
            function VisualHostTooltipActionsProvider(conceptualSchemaProxy, contextActivityService, drill, dataSources, eventBridge, explorationCapabilities, explorationExtensibility, explorationNavigation, lazyScoped, pluginOps, telemetryService, viewModeState, visualAuthoring, runningVisualService) {
                this.conceptualSchemaProxy = conceptualSchemaProxy, this.contextActivityService = contextActivityService, 
                this.drill = drill, this.dataSources = dataSources, this.eventBridge = eventBridge, 
                this.explorationCapabilities = explorationCapabilities, this.explorationExtensibility = explorationExtensibility, 
                this.explorationNavigation = explorationNavigation, this.lazyScoped = lazyScoped, 
                this.pluginOps = pluginOps, this.telemetryService = telemetryService, this.viewModeState = viewModeState, 
                this.visualAuthoring = visualAuthoring, this.runningVisualService = runningVisualService;
            }
            return VisualHostTooltipActionsProvider.prototype.createTooltipCommands = function(args, visualContainer, queryHandler) {
                return (0, tslib_es6.__awaiter)(this, void 0, void 0, function() {
                    var runningVisual, tooltipCommands, visualCommandsDisplayOverrides, insightsCommands, identities, drillUpCommand, drillDownCommand, drillDownEnabled, drillUpEnabled, drillthroughCommand, _a;
                    return (0, tslib_es6.__generator)(this, function(_b) {
                        switch (_b.label) {
                          case 0:
                            return runningVisual = this.runningVisualService.getVisual(visualContainer), tooltipCommands = [], 
                            this.viewModeState.getConfig().displayOptions.enableMobileInsights ? (visualCommandsDisplayOverrides = this.explorationExtensibility.getCommandsDisplayOptions(visualContainer.name), 
                            [ 4, this.getInsights(args, visualContainer, queryHandler, visualCommandsDisplayOverrides, "ExplainAnomalies") ]) : [ 3, 2 ];

                          case 1:
                            insightsCommands = _b.sent(), this.fillAnomaly(insightsCommands, tooltipCommands), 
                            _b.label = 2;

                          case 2:
                            return identities = args.identities && args.identities.filter(function(tooltipSelectorsByColumn) {
                                var _a;
                                return !(null === (_a = tooltipSelectorsByColumn.exclude) || void 0 === _a ? void 0 : _a[1]);
                            }), drillUpCommand = new visualContainerContextMenuCommands.Ue(visualContainer, identities, args.roles, this.drill, this.visualAuthoring, runningVisual, this.contextActivityService, {
                                source: "Tooltip"
                            }, "DrillUp"), [ 4, (drillDownCommand = new visualContainerContextMenuCommands.ab(visualContainer, identities, args.roles, this.dataSources, this.drill, this.visualAuthoring, runningVisual, this.contextActivityService, {
                                source: "Tooltip"
                            }, "DrillDown")).isVisible() ];

                          case 3:
                            return drillDownEnabled = _b.sent(), [ 4, drillUpCommand.isVisible() ];

                          case 4:
                            return drillUpEnabled = _b.sent(), (drillDownEnabled || drillUpEnabled) && (tooltipCommands.push({
                                command: drillUpCommand,
                                enabled: drillUpEnabled
                            }), tooltipCommands.push({
                                command: drillDownCommand,
                                enabled: drillDownEnabled
                            })), drillthroughCommand = queryHandler ? new visualContainerContextMenuCommands.dl(visualContainer, identities, "TooltipActions", this.drill, this.explorationNavigation, this.lazyScoped, this.pluginOps, queryHandler, this.telemetryService, this.contextActivityService, {
                                source: "Tooltip"
                            }, "Drillthrough") : void 0, (_a = drillthroughCommand) ? [ 4, this.isDrillthroughEnabled(drillthroughCommand) ] : [ 3, 6 ];

                          case 5:
                            _a = _b.sent(), _b.label = 6;

                          case 6:
                            return _a && tooltipCommands.push({
                                command: drillthroughCommand,
                                enabled: !0
                            }), this.commands = tooltipCommands, [ 2 ];
                        }
                    });
                });
            }, VisualHostTooltipActionsProvider.prototype.resetTooltipActions = function() {
                this.commands = [];
            }, VisualHostTooltipActionsProvider.prototype.getInsights = function(args, visualContainer, queryHandler, visualCommandsDisplayOverrides, analysisType) {
                return (0, tslib_es6.__awaiter)(this, void 0, void 0, function() {
                    var insights, point, insightsCommands, visualContainerCommands;
                    return (0, tslib_es6.__generator)(this, function(_a) {
                        switch (_a.label) {
                          case 0:
                            return insights = [], queryHandler ? (_.size(args.coordinates) > 1 && (point = {
                                x: args.coordinates[0],
                                y: args.coordinates[1]
                            }), [ 4, (insightsCommands = new visualContainerContextMenuCommands.Ys(visualContainer, args.identities, point, this.conceptualSchemaProxy, this.dataSources, this.eventBridge, this.explorationCapabilities, this.explorationNavigation, this.lazyScoped, this.viewModeState, queryHandler, analysisType, this.contextActivityService, {
                                source: "Tooltip"
                            }, visualCommandsDisplayOverrides)).isVisible() ]) : [ 2, insights ];

                          case 1:
                            return _a.sent() ? [ 4, insightsCommands.getChildren() ] : [ 3, 3 ];

                          case 2:
                            visualContainerCommands = _a.sent(), insights = visualContainerCommands, _a.label = 3;

                          case 3:
                            return [ 2, insights ];
                        }
                    });
                });
            }, VisualHostTooltipActionsProvider.prototype.fillAnomaly = function(anomalyCommands, tooltipCommands) {
                if (!_.isEmpty(anomalyCommands)) {
                    debug.fF.assert(function() {
                        return 1 === anomalyCommands.length;
                    }, "Only 1 anomaly allowed");
                    var anomalyCommand = _.first(anomalyCommands);
                    anomalyCommand.glyph = "pbi-glyph-anomaly", anomalyCommand.defaultTitleKey = "ExplainAnomaly", 
                    tooltipCommands.push({
                        command: anomalyCommand,
                        enabled: !0
                    });
                }
            }, VisualHostTooltipActionsProvider.prototype.isDrillthroughEnabled = function(drillthroughCommand) {
                return (0, tslib_es6.__awaiter)(this, void 0, void 0, function() {
                    return (0, tslib_es6.__generator)(this, function(_a) {
                        switch (_a.label) {
                          case 0:
                            return [ 4, drillthroughCommand.isVisible() ];

                          case 1:
                            return [ 2, _a.sent() ];
                        }
                    });
                });
            }, VisualHostTooltipActionsProvider.prototype.updateAndGetTooltipCommands = function() {
                return this.commands;
            }, VisualHostTooltipActionsProvider.\u0275fac = function(t) {
                return new (t || VisualHostTooltipActionsProvider)(core["\u0275\u0275inject"](conceptual_schema_proxy_service.i), core["\u0275\u0275inject"](context_activity_service.r), core["\u0275\u0275inject"](drill_service.s), core["\u0275\u0275inject"](data_sources_service.D), core["\u0275\u0275inject"](event_bridge_service.J), core["\u0275\u0275inject"](exploration_capabilities_service.U), core["\u0275\u0275inject"](exploration_extensibility_service.W), core["\u0275\u0275inject"](exploration_navigation_service.z), core["\u0275\u0275inject"](lazy_scoped_provider.H), core["\u0275\u0275inject"](visual_plugin_operations_service.f), core["\u0275\u0275inject"](Telemetry.y0), core["\u0275\u0275inject"](view_mode_state_service.kc), core["\u0275\u0275inject"](visual_authoring_service.$8), core["\u0275\u0275inject"](running_visual_service.s));
            }, VisualHostTooltipActionsProvider.\u0275prov = core["\u0275\u0275defineInjectable"]({
                token: VisualHostTooltipActionsProvider,
                factory: VisualHostTooltipActionsProvider.\u0275fac
            }), VisualHostTooltipActionsProvider;
        }(), VisualHostTooltipActionsLazyProvider = {
            provide: "visualHostTooltipActionsProvider",
            useFactory: function(conceptualSchemaProxy, contextActivityService, drill, dataSources, eventBridge, explorationCapabilities, explorationExtensibility, explorationNavigation, lazyScoped, pluginOps, telemetryService, viewModeState, visualAuthoring, runningVisualService) {
                return new Promise(function(resolve) {
                    resolve(new VisualHostTooltipActionsProvider(conceptualSchemaProxy, contextActivityService, drill, dataSources, eventBridge, explorationCapabilities, explorationExtensibility, explorationNavigation, lazyScoped, pluginOps, telemetryService, viewModeState, visualAuthoring, runningVisualService));
                });
            },
            deps: [ conceptual_schema_proxy_service.i, context_activity_service.r, drill_service.s, data_sources_service.D, event_bridge_service.J, exploration_capabilities_service.U, exploration_extensibility_service.W, exploration_navigation_service.z, lazy_scoped_provider.H, visual_plugin_operations_service.f, Telemetry.y0, view_mode_state_service.kc, visual_authoring_service.$8, running_visual_service.s ]
        }, common = __webpack_require__(77476), Data_module = __webpack_require__(52910), lazy_load_module = __webpack_require__(82156), VisualHostTooltipActionsProviderModule = function() {
            function VisualHostTooltipActionsProviderModule() {}
            return VisualHostTooltipActionsProviderModule.\u0275fac = function(t) {
                return new (t || VisualHostTooltipActionsProviderModule);
            }, VisualHostTooltipActionsProviderModule.\u0275mod = core["\u0275\u0275defineNgModule"]({
                type: VisualHostTooltipActionsProviderModule
            }), VisualHostTooltipActionsProviderModule.\u0275inj = core["\u0275\u0275defineInjector"]({
                providers: [ VisualHostTooltipActionsLazyProvider ],
                imports: [ common.CommonModule, Data_module.O, lazy_load_module.N ]
            }), VisualHostTooltipActionsProviderModule;
        }();
    }
} ]);