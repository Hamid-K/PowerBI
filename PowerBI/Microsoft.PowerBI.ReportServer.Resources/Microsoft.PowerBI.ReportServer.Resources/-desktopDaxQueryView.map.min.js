"use strict";(self.webpackChunkdesktopDaxQueryView=self.webpackChunkdesktopDaxQueryView||[]).push([["map"],{74591:function(Jt,gt,M){M.r(gt),M.d(gt,{Map:function(){return Je},callSafely:function(){return se},mapsModule:function(){return rt},timeoutWrapped:function(){return Zt},unwrap:function(){return $e},wrap:function(){return Fe},wrappedSetInterval:function(){return Xt},wrappedSetTimeout:function(){return Ut}});var I=M(81337),A=M(61160),w=M(98755),St=M(32554),x=M(90120),u=M(56707),y=M(54522),m=M(21181),S=M(18664),h=M(5962),F=M(11745),P=M(86108),c=M(33024),f=M(51129),E=M(79811),B=M(86727),H=M(77686),Q=M(70569),tt=M(72902),at=M(40739),it=M(11305),ft=M(34002),st=M(74988),be=M(56919),xt=M(90700),Qt=M(45296),yt=M(64067),Ve=M(44783),Ie=M(38308),et=M(62458),Be=M(15621),Ge=M(88987),$t=M(12913),ze=M(58778),X=M(56578),Oe=M(38078),Me=M(38958),O=M(82755),mt=M(72489),re=M(26543),bt=M(60066),qt=M(5381),Ce=M(49203),Ze=M(63972),Dt=M(92379),jt=M(32041),ne=M(59107),oe=M(10389),Ae=M(66232),ke=M(57952),He=M(79154),Se=function(){function n(t,e,a){void 0===a&&(a=!0),this.mapControl=t,this.tooltipService=e,this.inertia=new ke.r(null,a),this.inertia.callback=function(i,r){return(0,h.M_)(t,i,r)}}return n.prototype.onMouseDown=function(t){var e=this,i=this.getMousePosition(),r=d3.select(t),o=!1,s=0,l=this.inertia;l.hasStarted()&&l.stop();var d=d3.select(window).on(n.Events.mouseMove,function(){var p,g=e.getMousePosition(),b=(p=n.getDelta(i,g))[0],D=p[1];o||(s+=Math.abs(b)+Math.abs(D))>n.DragPixelThreshold&&(o=!0,r.classed(n.DraggingCSS.class,!0),e.tooltipService.hide()),l.addPoint(g[0],g[1]),(0,h.M_)(e.mapControl,b,D),i=g}).on(n.Events.mouseup,function(){if(d.on(n.Events.mouseMove,null).on(n.Events.mouseup,null),o){var p=e.getMousePosition();l.addPoint(p[0],p[1]),r.classed(n.DraggingCSS.class,!1);var g=d3.event;g.target===r.node()&&r.on(n.Events.click,function(){(0,Ae.n)(g),r.on(n.Events.click,null)}),l.start()}})},n.prototype.getMousePosition=function(){var t=n.BodyNode=n.BodyNode||d3.select("body").node();return d3.mouse(t)},n.getDelta=function(t,e){return[e[0]-t[0],e[1]-t[1]]},n.DragPixelThreshold=5,n.Events={mouseDown:"mousedown.mapDrag",mouseMove:"mousemove.mapDrag",mouseup:"mouseup.mapDrag",click:"click.mapDrag"},n.DraggingCSS=(0,He.CH)("dragging-cursor"),n}(),We=function(){function n(t){this.navigationStrategy=tt.jN.CategoryFirst,this.tooltipsEnabled=t}return n.prototype.init=function(t,e,a,i,r,o,s,l){this.host=s,this.mapControl=t,this.eventManager=l,this.pointLabelText=this.host.getLocalizedString("Generic_Point");var d=this.root=d3.select(e[0]);d.attr("drag-resize-disabled","true").style("display","inline-block").attr("tabindex",-1).attr("focusable",!1);var p=ne.M.isInternetExplorerOrEdge(),g=this.svg=d.append("svg").style("position","absolute").style("pointer-events","none").classed(h.nv,!p);o&&g.attr("tabindex",0).attr("focusable",!0).attr("aria-label",s.getLocalizedString("Visual_Plot")).attr("focus-nav-mode","Hierarchy").attr("aria-multiselectable","true").attr("role","listbox").classed(bt.Pg,!p),a&&(this.clearCapture=d),this.bubbleGraphicsContext=g.append("g").classed("mapBubbles",!0),this.sliceGraphicsContext=g.append("g").classed("mapSlices",!0),this.labelBackgroundGraphicsContext=g.append("g").classed(u.u9.class,!0),this.labelGraphicsContext=g.append("g").classed(u.ZL.class,!0),this.sliceLayout=d3.pie().value(function(b){return b.value}),this.arc=d3.arc(),this.style=r,this.clearMaxDataPointRadius(),this.dataLabelsSettings=(0,h.BP)(this.style),this.tooltipService=i},n.prototype.clearHeatMap=function(){this.mapControl&&this.mapControl.layers.clear(),this.heatMapLayer&&(this.heatMapLayer.clear(),this.heatMapLayer.dispose(),this.heatMapLayer=void 0)},n.prototype.setData=function(t){this.mapData=t},n.prototype.clearDataPoints=function(){this.style&&(this.mapData=(0,h.IG)(this.style),this.clearHeatMap())},n.prototype.hideDataPoints=function(){this.svg.style("display","none")},n.prototype.showDataPoints=function(){this.svg.style("display","")},n.prototype.getDataPointCount=function(){return this.mapData?_.filter(this.mapData.dataPoints,function(t){return!!t.location}).length:0},n.prototype.getDataPointPadding=function(){return 2*this.maxDataPointRadius},n.prototype.clearMaxDataPointRadius=function(){this.maxDataPointRadius=0},n.prototype.setMaxDataPointRadius=function(t){this.maxDataPointRadius=Math.max(t,this.maxDataPointRadius)},n.prototype.converter=function(t,e,a,i){void 0===i&&(i=!0);var r=this.mapControl,o=t.width/2,s=t.height/2;this.dataLabelsSettings=e;var d=Math.min(t.width,t.height)/384;this.clearMaxDataPointRadius();var p=[],g=[],b=this.mapData?this.mapData.dataPoints:[],D=this.mapData&&this.mapData.hasSize;this.navigableDataPoints=void 0;for(var C=0,N=b.length;C<N;C++){var Z=b[C],W=Z.categoryValue,R=Z.location;if(R){if((0,h.N2)(R,!0))continue;var U=r.tryLocationToPixel(new Microsoft.Maps.Location(R.latitude,R.longitude));if(!U){et.fF.assertFail("tryLocationToPixel failed with the following location: "+JSON.stringify(R));continue}var T=U.x+o,G=U.y+s,v=Z.radius*d;this.setMaxDataPointRadius(v);var z=Z.subDataPoints,lt=z.length;if(1===lt)p.push({x:T,y:G,labeltext:W,radius:v,fill:(k=z[0]).fill,stroke:k.stroke,strokeWidth:1,tooltipInfo:k.tooltipInfo,identity:k.identity,selected:!1,labelFill:e.fontProperties.color,categoryIndex:C,seriesIndex:k.seriesIndex});else{for(var nt=[],ot=0;ot<lt;ot++){var k;et.fF.assertValue(k=z[ot],"Map's subdataPoint array should not be sparse."),nt.push({x:T,y:G,labeltext:W,radius:v,fill:k.fill,stroke:k.stroke,strokeWidth:1,value:D?k.value:1,tooltipInfo:k.tooltipInfo,identity:k.identity,selected:!1,labelFill:e.fontProperties.color,categoryIndex:C,seriesIndex:k.seriesIndex})}a&&a.applySelectionStateToData(nt),g.push(nt)}}}return a&&a.applySelectionStateToData(p),{bubbleData:p,sliceData:g}},n.prototype.updateInternal=function(t,e,a,i,r,o){return et.fF.assertValue(e,"viewport"),this.mapRendererData=t,this.svg&&this.svg.style("width",e.width.toString()+"px").style("height",e.height.toString()+"px"),this.mapData&&this.mapData.properties.showHeatMap?this.renderHeatMapLayer(t):this.render(t,e,a,i,r)},n.getHeatMapLocations=function(t,e){var a=[],i=!1,r=_.filter(t,function(N){return null!=N.value});if(!_.isEmpty(r)){var o=_.map(r,function(N){return N.value}),s=_.min(o),d=_.max(o)-s;if(d>0){e.intensity=.1;for(var p=_.map(r,function(N){return Math.round((N.value-s)/d*9+1)}),g=0;g<r.length;g++)for(var b=r[g],D=p[g],C=0;C<D;C++)a.push(new Microsoft.Maps.Location(b.location.latitude,b.location.longitude));i=!0}}return i||(a=_.map(t,function(N){return new Microsoft.Maps.Location(N.location.latitude,N.location.longitude)})),a},n.prototype.getPlotAreaLassoSurface=function(){return this.svg},n.prototype.renderHeatMapLayer=function(t){var a,e=this;this.hideDataPoints(),this.mapData.properties.heatMapOptions&&((a=_.clone(this.mapData.properties.heatMapOptions)).intensity=.5);var i=_.filter(this.mapData.dataPoints,function(s){return null!=s.location}),r=n.getHeatMapLocations(i,a);return Microsoft.Maps.loadModule("Microsoft.Maps.HeatMap",function(){e.heatMapLayer?(e.heatMapLayer.clear(),e.heatMapLayer.setLocations(r),e.heatMapLayer.setOptions(a)):(e.heatMapLayer=new Microsoft.Maps.HeatMapLayer(r,a),e.mapControl.layers.insert(e.heatMapLayer))}),{bubbleEventGroup:this.bubbleGraphicsContext,sliceEventGroup:this.sliceGraphicsContext,bubbles:null,slices:null,clearCapture:this.clearCapture,dataPoints:null,root:this.root,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,eventManager:this.eventManager,hostServices:this.host}},n.prototype.render=function(t,e,a,i,r){var o=this.arc,s=i&&i.hasSelection(),l=ne.M.isInternetExplorerOrEdge();this.heatMapLayer&&this.heatMapLayer.clear(),this.showDataPoints();var d=this.bubbleGraphicsContext.selectAll(".bubble").data(t.bubbleData,function(v){return v.identity.getKey()}),p=new Se(this.mapControl,this.tooltipService),g=d.enter().append("circle").classed("bubble",!0).merge(d);g.classed(bt.Pg,!l&&!!i).attr("cx",function(v){return v.x}).attr("cy",function(v){return v.y}).attr("r",function(v){return v.radius}).attr("tabindex",i?0:null).attr("focusable",!!i).attr("aria-selected",function(v){return v.selected}).attr("role","option").attr("aria-label",this.pointLabelText).style("fill",function(v){return v.fill}).style("stroke",function(v){return v.stroke}).style("fill-opacity",function(v){return(0,bt.eR)(v.selected,!1,s,!1)}).style("strokeWidth",function(v){return v.strokeWidth}).style("stroke-opacity",function(v){return(0,bt.eR)(v.selected,!1,s,!1)}).on("mousedown.drag",function(){return p.onMouseDown(d3.event.target)}),d.exit().remove(),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.bubbleGraphicsContext,function(v){return et.fF.assertValue(v.data,"Bubble map data for tooltip"),v.data&&v.data.tooltipInfo},function(v){return v.data&&v.data.identity&&[v.data.identity]}),g.style("pointer-events","all"));var b=t.sliceData,D=this.sliceGraphicsContext.selectAll(".sliceContainer").data(b),C=D.enter().append("g").classed("sliceContainer",!0).merge(D);D.exit().remove();var N=this.sliceLayout,Z=C.selectAll(".slice").data(function(v){return N(v)},function(v){return v.data.identity.getKey()}),W=Z.enter().append("path").classed("slice",!0).merge(Z);W.classed(bt.Pg,!l&&!!i).style("fill",function(v){return v.data.fill}).style("fill-opacity",function(v){return(0,bt.eR)(v.data.selected,!1,s,!1)}).style("stroke",function(v){return v.data.stroke}).style("strokeWidth",function(v){return v.data.strokeWidth}).style("stroke-opacity",function(v){return(0,bt.eR)(v.data.selected,!1,s,!1)}).style("cursor","default").attr("transform",function(v){return(0,oe.Iu)(v.data.x,v.data.y)}).attr("d",function(v){return o.innerRadius(0).outerRadius(function(z){return z.data.radius})(v)}).attr("tabindex",i?0:null).attr("focusable",!!i).on("mousedown.drag",function(){return p.onMouseDown(d3.event.target)}),Z.exit().remove(),this.updateInternalDataLabels(e,r),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.sliceGraphicsContext,function(v){return et.fF.assertValue(v.data,"Bubble map slice data for tooltip"),v.data&&v.data.data&&v.data.data.tooltipInfo},function(v){return v.data&&v.data.data&&[v.data.data.identity]}),W.style("pointer-events","all"));for(var R=t.bubbleData.slice(),U=0,T=b.length;U<T;U++)R.push.apply(R,b[U]);return{root:this.root,bubbleEventGroup:this.bubbleGraphicsContext,sliceEventGroup:this.sliceGraphicsContext,bubbles:_.isEmpty(t.bubbleData)?null:g,slices:_.isEmpty(t.sliceData)?null:W,clearCapture:this.clearCapture,dataPoints:R,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,hitTester:new je({dataPoints:R}),eventManager:this.eventManager,hostServices:this.host}},n.prototype.updateInternalDataLabels=function(t,e){var a=this.dataLabelsSettings,i=[];if(a&&(a.show||a.showCategory)){var r=this.createLabelDataPoints();i=new Ze.nu({maximumOffset:u.wh,startingOffset:u.ki}).layout([{labelDataPoints:r,maxNumberOfLabels:r.length}],{width:t.width,height:t.height})}(0,qt.gm)({labelContext:this.labelGraphicsContext,dataLabels:i,backgroundContext:this.labelBackgroundGraphicsContext,numeric:!1,formatMode:!1,onObject:!1})},n.prototype.createLabelDataPoints=function(){var t=this.mapRendererData,e=[],a=t.bubbleData;a=a.concat(_.map(t.sliceData,function(C){return C[0]}));for(var i=this.dataLabelsSettings,r=x.v.getThemeColor(this.style,u.pl),o=0,s=a;o<s.length;o++){var l=s[o];et.fF.assertValue(l,"dataPoint should never be null/undefined");var d=l.labeltext,p=i.fontProperties,g=(0,S.qk)(p,d),b=jt.b.measureSvgTextWidth(g),D=jt.b.estimateSvgTextHeight(g);e.push({isPreferred:!0,text:d,textSize:{width:b,height:D},outsideFill:p.color?p.color:r,insideFill:p.color?p.color:r,parentType:0,parentShape:{point:{x:l.x,y:l.y},radius:l.radius,validPositions:n.validLabelPositions},fontProperties:p,identity:void 0,hasBackground:i.enableBackground,backgroundColor:i.backgroundColor,backgroundTransparency:i.backgroundTransparency})}return e},n.prototype.getNavigationOptions=function(){return{helper:this,navigationStrategy:this.navigationStrategy}},n.prototype.getFirstElement=function(){this.navigableDataPoints=this.flattenViewModel();var t=_.find(this.navigableDataPoints,function(e){return!!e});return{element:this.getHtmlElementFromDataPoint(t)}},n.prototype.getNextDataPoint=function(t,e,a){_.isEmpty(this.navigableDataPoints)&&(this.navigableDataPoints=this.flattenViewModel());var i=(0,Ce.R)(this.navigableDataPoints,t,e,tt.jN.CategoryFirst,a);return{element:this.getHtmlElementFromDataPoint(i)}},n.prototype.flattenViewModel=function(){var t=[];if(this.mapRendererData.bubbleData&&!_.isEmpty(this.mapRendererData.bubbleData)){for(var e=0,a=this.mapRendererData.bubbleData;e<a.length;e++){var i=a[e];t.push({categoryIndex:i.categoryIndex,seriesIndex:i.seriesIndex})}return t}if(this.mapRendererData.sliceData&&!_.isEmpty(this.mapRendererData.sliceData)){for(var r=0,o=this.mapRendererData.sliceData;r<o.length;r++)for(var l=0,d=o[r];l<d.length;l++){var p=d[l];t.push({categoryIndex:p.categoryIndex,seriesIndex:p.seriesIndex})}return t}},n.prototype.getHtmlElementFromDataPoint=function(t){return this.bubbleGraphicsContext.selectAll(".bubble").filter(function(o){return o.seriesIndex===t.seriesIndex&&o.categoryIndex===t.categoryIndex}).node()||this.sliceGraphicsContext.selectAll(".slice").filter(function(o){return o.data.seriesIndex===t.seriesIndex&&o.data.categoryIndex===t.categoryIndex}).node()||(et.fF.assertFail("An html element couldn't be found for the given data point in MapBubbleDataPointRenderer.getHtmlElementFromDataPoint()."),null)},n.validLabelPositions=[1,2,4,8],n}(),je=function(){function n(t){this.dataPoints=t.dataPoints}return n.prototype.queryRegion=function(t){return _.filter(this.dataPoints,function(e){return Dt.m.circleRectangleOverlap(t,{x:e.x,y:e.y},e.radius)})},n}(),Ue=M(65673),Xe=M(72494),De=M(47316);function Pe(n,t,e,a){et.fF.assert(function(){return 8===e.length},"Array length should be 8 to match a rectangular shape"),et.fF.assert(function(){return!a||8===a.length},"Array length should be 8 to match a rectangular shape");for(var i=!0,r=[n.left,n.right],o=[n.top,n.bottom],l=0;l<r.length;l++)for(var d=0;d<o.length;d++)t(r[l],o[(C=l,N=d,0===C?N:1-N)],4*l+2*d,e,a)||(i=!1);var C,N;return i}function we(n){var t=new Float64Array(8);return Pe(n,function(i,r,o,s){return s[o]=i,s[o+1]=r,!0},t),new Dt.m(t)}var xe=function(){function n(t,e){this.navigationStrategy=tt.jN.CategoryFirst,this.filledMapDataLabelsEnabled=t,this.tooltipsEnabled=e}return n.buildPaths=function(t){var e=[];if(!_.isEmpty(t))for(var a=0,i=t;a<i.length;a++){var r=i[a],o=r.geographic;o&&o.length>2&&e.push(r)}return e},n.prototype.init=function(t,e,a,i,r,o,s,l){this.host=s,this.mapControl=t,this.polygonInfo=new h.n9;var d=ne.M.isInternetExplorerOrEdge();this.eventManager=l,this.pointLabelText=this.host.getLocalizedString("Generic_Point");var p=this.root=d3.select(e[0]);p.attr("drag-resize-disabled","true").attr("tabindex",-1).attr("focusable",!1);var g=this.svg=p.append("svg").style("position","absolute").style("pointer-events","none").classed(h.nv,!d);o&&g.attr("tabindex",0).attr("focusable",!0).attr("aria-label",s.getLocalizedString("Visual_Plot")).attr("focus-nav-mode","Hierarchy").attr("aria-multiselectable","true").attr("role","listbox").classed(bt.Pg,!d),a&&(this.clearCapture=p),this.shapeGraphicsContext=g.append("g").classed("mapShapes",!0),this.labelGraphicsContext=g.append("g").classed(u.ZL.class,!0),this.style=r,this.clearMaxShapeDimension(),this.dataLabelsSettings=(0,h.BP)(this.style),this.tooltipService=i},n.prototype.setData=function(t){this.mapData=t},n.prototype.clearDataPoints=function(){this.style&&(this.mapData=(0,h.IG)(this.style))},n.prototype.hideDataPoints=function(){this.svg.style("display","none")},n.prototype.showDataPoints=function(){this.svg.style("display","")},n.prototype.getDataPointCount=function(){return this.mapData?_.filter(this.mapData.dataPoints,function(t){return!!t.paths}).length:0},n.prototype.converter=function(t,e,a,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),!r&&this.mapRendererData)return this.mapRendererData;this.navigableDataPoints=void 0,this.clearMaxShapeDimension(),this.dataLabelsSettings=e;for(var s=[],l=this.mapData?this.mapData.dataPoints:[],d=0,p=l.length;d<p;d++){var g=l[d],b=g.subDataPoints[0],D=g.paths;if(!_.isEmpty(D)){for(var C=g.value,N=g.categoryValue,Z=b.identity,W=Z.getKey(),R=void 0,U=void 0,T=D.length;T-- >0;){var G=D[T];if(G&&G.absoluteBounds){this.setMaxShapeDimension(G.absoluteBounds.width,G.absoluteBounds.height);var v={left:G.absoluteBounds.left,top:G.absoluteBounds.top,right:G.absoluteBounds.left+G.absoluteBounds.width,bottom:G.absoluteBounds.top+G.absoluteBounds.height};R?(v.left<R.left&&(R.left=v.left),v.top<R.top&&(R.top=v.top),v.right>R.right&&(R.right=v.right),v.bottom>R.bottom&&(R.bottom=v.bottom)):(R={left:v.left,top:v.top,right:v.right,bottom:v.bottom},U=[]),U.push({boundingRect:v,path:G.absolute})}else et.fF.assertFail("MapShapeRenderer.converter encountered an invalid path"),D.splice(T,1)}if(_.isEmpty(D))continue;var z=D[n.getIndexOfLargestShape(D)].absolute,lt=_.map(D,function(K){return(0,oe.Ay)(K.absolute)}).join(" "),k=void 0;this.mapData.properties.showStroke&&(k=_.map(D,function(K){return(0,oe.fg)(K.absolute,n.ReducedPathScale)}).join(" ")),s.push({mainShapePointArray:z,path:lt,reducedPath:k,fill:b.fill,stroke:b.stroke,strokeWidth:1,tooltipInfo:b.tooltipInfo,identity:Z,selected:!1,key:JSON.stringify({id:W}),labeltext:N,catagoryLabeltext:C?.toString(),categoryIndex:d,seriesIndex:b.seriesIndex,absoluteCenter:{x:(R.left+R.right)/2,y:(R.top+R.bottom)/2},globalBoundingRect:R,pathsWithBounds:U})}}return a&&a.applySelectionStateToData(s),{shapeData:s}},n.prototype.useReducedPaths=function(t){return this.mapData.properties.showStroke&&t<n.ReducedPathScaleLimit},n.prototype.updateInternal=function(t,e,a,i,r,o){et.fF.assertValue(e,"viewport"),this.mapRendererData=t,this.svg&&this.svg.style("width",e.width.toString()+"px").style("height",e.height.toString()+"px"),this.polygonInfo.reCalc(this.mapControl,e.width,e.height);var s=this.polygonInfo.scale,l=this.polygonInfo.transform,d=(0,h.oT)(),p=l,g=d,b=this.useReducedPaths(s);if(b){var D=_.clone(p.matrix);D.m00=D.m11=s/n.ReducedPathScale,p=new Ue.wx(D),g=(0,h.x6)(n.ReducedPathZoomLevel)}this.shapeGraphicsContext.attr("transform",this.polygonInfo.transformToString(p));var C=function(j,dt,ht){return j?-ht:dt?ht:0},N=e.width/2,Z=function(j,dt,ht){var Pt=l.applyToPoint(j.absoluteCenter),wt=l.applyToPoint({x:j.absoluteCenter.x-dt,y:j.absoluteCenter.y}),Mt=l.applyToPoint({x:j.absoluteCenter.x+dt,y:j.absoluteCenter.y}),Lt=Math.abs(Pt.x-N),Ft=Math.abs(wt.x-N),Ct=Math.abs(Mt.x-N);return C(Ft<Lt,Ct<Lt,ht)},W=this.shapeGraphicsContext.selectAll("path").data(t.shapeData,function(V){return V.key}).style("transform",function(V){return"translateX(".concat(Z(V,d,g),"px)")}),R=b?function(V){return V.reducedPath}:function(V){return V.path},U=new Se(this.mapControl,this.tooltipService),T=W.enter().append("path").classed("shape",!0).attr("aria-selected",function(V){return V.selected}).attr("role","option").attr("aria-label",this.pointLabelText).attr("d",R).on("mousedown.drag",function(){return U.onMouseDown(d3.event.target)}).merge(W),G=b?s/n.ReducedPathScale:this.polygonInfo.scale,v=i&&i.hasSelection();T.classed(bt.Pg,!!i).attr("tabindex",i?0:null).attr("focusable",!!i).style("fill",function(V){return V.fill}).style("fill-opacity",function(V){return(0,bt.eR)(V.selected,!1,v,!1)}).style("outline-width","".concat(1/G,"px"));var k,K,z=this.mapData.properties.strokeColor,lt=this.mapData.properties.strokeWidth;this.style.isHighContrast?(k=function(j){return j.stroke},K=function(j){return j.strokeWidth/G}):this.mapData.properties.showStroke?(k=function(j){return z||j.stroke},K=function(j){return(lt||j.strokeWidth)/G}):(k=null,K=null),T.style("stroke",k).style("stroke-width",K),(a||this.lastRenderUsedReducedPaths!==b)&&T.attr("d",R),this.lastRenderUsedReducedPaths=b,W.exit().remove(),this.updateInternalDataLabels(e,r);var ot=new Ye({absMapSize:d,applyOffset:C,dataPoints:t.shapeData,mapControl:this.mapControl,offset:g,transform:p,translateX:Z,viewport:e});if(a)return this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.shapeGraphicsContext,function(V){return et.fF.assertValue(V.data,"Filled map data for tooltip"),V.data&&V.data.tooltipInfo},function(V){return V.data&&V.data.identity&&[V.data.identity]}),T.style("pointer-events","all")),{root:this.root,shapeEventGroup:this.shapeGraphicsContext,shapes:T,clearCapture:this.clearCapture,dataPoints:t.shapeData,navigationEntry:this.clearCapture&&this.clearCapture[0]?this.clearCapture[0][0]:null,visualInstanceId:this.host.instanceId,hitTester:ot,eventManager:this.eventManager,hostServices:this.host,widthDivisor:G};o&&o.bindHitTester(ot)},n.prototype.getDataPointPadding=function(){return 12},n.prototype.getEnclosingBounds=function(){var t,e=this.mapData&&this.mapData.dataPoints;if(!_.isEmpty(e))for(var a=0,i=e;a<i.length;a++){var o=i[a].paths;if(!_.isEmpty(o))for(var s=0,l=o;s<l.length;s++){var d=l[s];d.geographic&&(t=(0,h.wu)(t,d.adjustedBounds))}}return t},n.getIndexOfLargestShape=function(t){for(var e=0,a=0,i=0,r=t.length;i<r;i++){var s=new Dt.m(t[i].absolute),l=Math.abs(Dt.m.calculateAbsolutePolygonArea(s.polygonPoints));l>a&&(e=i,a=l)}return e},n.prototype.updateInternalDataLabels=function(t,e){var a=this.dataLabelsSettings,i=[];if(a&&(a.show||a.showCategory)){var r=this.createLabelDataPoints();void 0===this.labelLayout&&(this.labelLayout=new Xe.Q),i=this.labelLayout.layout(r,{width:t.width,height:t.height},this.polygonInfo.transform,e)}this.drawLabelStems(this.labelGraphicsContext,i),(0,qt.ng)({context:this.labelGraphicsContext,dataLabels:i,onObject:!1}),(0,qt.x5)({labelContext:this.labelGraphicsContext,dataLabels:i,twoRows:a.show&&a.showCategory,formatMode:!1,onObject:!1})},n.prototype.getPlotAreaLassoSurface=function(){return this.svg},n.prototype.clearMaxShapeDimension=function(){this.maxShapeDimension=0},n.prototype.setMaxShapeDimension=function(t,e){this.maxShapeDimension=Math.max(t,this.maxShapeDimension),this.maxShapeDimension=Math.max(e,this.maxShapeDimension)},n.prototype.createLabelDataPoints=function(){var e=[];if(this.filledMapDataLabelsEnabled)for(var i=this.dataLabelsSettings,r=0,o=this.mapRendererData.shapeData;r<o.length;r++){var s=o[r],l=void 0,d=void 0,p=0,g=!1;if(this.dataLabelsSettings.show&&!this.dataLabelsSettings.showCategory){if(void 0===(l=s.catagoryLabeltext))continue}else if(this.dataLabelsSettings.showCategory&&!this.dataLabelsSettings.show){if(void 0===(l=s.labeltext))continue}else if(this.dataLabelsSettings.showCategory&&this.dataLabelsSettings.show){if(d=s.labeltext,void 0===(l=s.catagoryLabeltext)&&void 0===d)continue;g=!0}var b=(0,m.bT)({style:this.style,textClassName:"smallLightLabel",noColor:!0}).fontProperties;if(g){var D=(0,S.qk)(b,d);p=jt.b.measureSvgTextWidth(D)}var C=(0,S.qk)(b,l),N=jt.b.measureSvgTextWidth(C),Z=jt.b.estimateSvgTextHeight(C);d&&void 0!==s.labeltext&&void 0!==s.catagoryLabeltext&&(Z*=2);var W=x.v.getThemeColor(this.style,u.pl),R={parentType:2,parentShape:{polygon:new Dt.m(s.mainShapePointArray),validPositions:n.validLabelPolygonPositions},text:l,secondRowText:d,textSize:{width:Math.max(N,p),height:Z},insideFill:i.fontProperties.color,outsideFill:i.fontProperties.color?i.fontProperties.color:W,isPreferred:!1,identity:void 0,hasBackground:!0,fontProperties:i.fontProperties};e.push(R)}return e},n.prototype.drawLabelStems=function(t,e){var i=x.v.getThemeColor(this.style,h.jj);e.map(function(r){r.leaderLine={strokeShow:!0,strokeColor:i,strokeWidth:1,strokeTransparency:50,strokePattern:De.Dv.solid,strokeAutoScale:!1,strokeDashCap:De.qH.none,strokeDashArray:null}}),(0,qt.z8)(t,e,function(o,s){return o.identity?o.identity.getKeyWithoutHighlight():s})},n.prototype.getNavigationOptions=function(){return{helper:this,navigationStrategy:this.navigationStrategy}},n.prototype.getFirstElement=function(){this.navigableDataPoints=this.flattenViewModel();var t=_.find(this.navigableDataPoints,function(e){return!!e});return{element:this.getHtmlElementFromDataPoint(t)}},n.prototype.getNextDataPoint=function(t,e,a){_.isEmpty(this.navigableDataPoints)&&(this.navigableDataPoints=this.flattenViewModel());var i=(0,Ce.R)(this.navigableDataPoints,t,e,tt.jN.CategoryFirst,a);return{element:this.getHtmlElementFromDataPoint(i)}},n.prototype.flattenViewModel=function(){var t=[];if(this.mapRendererData.shapeData)for(var e=0,a=this.mapRendererData.shapeData;e<a.length;e++){var i=a[e];t.push({categoryIndex:i.categoryIndex,seriesIndex:i.seriesIndex})}return t},n.prototype.getHtmlElementFromDataPoint=function(t){return this.shapeGraphicsContext.selectAll(".shape").filter(function(i){return i.categoryIndex===t.categoryIndex&&i.seriesIndex===t.seriesIndex}).node()||(et.fF.assertFail("An html element couldn't be found for the given data point in MapShapeDataPointRenderer.getHtmlElementFromDataPoint()."),null)},n.validLabelPolygonPositions=[256,2,1,8,4,16,32,64,128],n.ReducedPathScale=.0078125,n.ReducedPathScaleLimit=.03125,n.ReducedPathZoomLevel=4,n}(),Ye=function(){function n(t){this.absMapSize=t.absMapSize,this.applyOffset=t.applyOffset,this.lazyCalculateTranslations=!1,this.mapControl=t.mapControl,this.offset=t.offset,this.originalDataPoints=t.dataPoints,this.transform=t.transform,this.translateX=t.translateX,this.viewport=t.viewport}return n.prototype.queryRegion=function(t){var e=this.transformAndTranslateSelectionRectangle(t);if(!e)return[];this.lazyCalculateTranslations||(this.dataPoints=this.calculateTranslations(this.originalDataPoints),this.lazyCalculateTranslations=!0);for(var a=[],i=0,r=this.dataPoints;i<r.length;i++){var o=r[i],s=Dt.m.translateX(e,-o.translation);if(Dt.m.polygonBoundsOverlap(s,we(o.mapShape.globalBoundingRect)))for(var l=0,d=o.mapShape.pathsWithBounds;l<d.length;l++){var p=d[l];if(Dt.m.polygonBoundsOverlap(s,we(p.boundingRect))&&s.overlapPath(p.path)){a.push(o.mapShape);break}}}return a},n.prototype.transformAndTranslateSelectionRectangle=function(t){var e=this,a=new Float64Array(8),i=new Float64Array(8),r={x:0,y:0},o=this.transform.applyToPoint(r).x;r.x+=this.absMapSize;var s=this.transform.applyToPoint(r).x;if(!Pe(t,function(b,D,C,N,Z){var U=new Microsoft.Maps.Point(b-e.viewport.width/2,D-e.viewport.height/2),T=e.mapControl.tryPixelToLocation(U,Microsoft.Maps.PixelReference.viewport);if(!T)return!1;a[C]=T.latitude,a[C+1]=T.longitude;var G=e.applyOffset(b<o,b>s,e.offset);return Z[C]=G,Z[C+1]=0,!0},a,i))return null;for(var d=(0,h.Sc)(a,this.absMapSize),p=0;p<d.length;p++)d[p]+=i[p];return new Dt.m(d)},n.prototype.calculateTranslations=function(t){for(var e=[],a=0,i=t;a<i.length;a++){var r=i[a];e.push({mapShape:r,translation:this.translateX(r,this.absMapSize,this.offset)})}return e},n}(),Ot=Oe.b$.parseNumber,Je=function(){function n(t){this.isDestroyed=!1,this.warnings=[],this.maxLevelOfDetail=h.Ch,this.minLevelOfDetail=h.z8,t.filledMap?(this.dataPointRenderer=new xe(t.filledMapDataLabelsEnabled,t.tooltipsEnabled),this.filledMapDataLabelsEnabled=t.filledMapDataLabelsEnabled,this.isFilledMap=!0):(this.dataPointRenderer=new We(t.tooltipsEnabled),this.isFilledMap=!1),this.mapCredentials=h.Zr.BingKey,this.mapControlFactory=t.mapControlFactory,this.behavior=t.behavior,this.tooltipsEnabled=t.tooltipsEnabled,this.disableZooming=t.disableZooming,this.disablePanning=t.disablePanning,this.isLegendScrollable=!!t.behavior,this.viewChangeThrottleInterval=t.viewChangeThrottleInterval,this.boundsHaveBeenUpdated=!1,this.rescaleMap=t.rescaleMap,this.shouldSetSavedLocation=!0,this.dataPointLassoSelect=t.dataPointLassoSelect}return n.prototype.init=function(t){et.fF.assertValue(t,"options");var e=this.element=t.element;this.pendingGeocodingRender=0,this.eventManager=new ze.B(d3.select(e.get(0))),this.featureSwitches=t.featureSwitches,this.currentViewport=t.viewport,this.currentViewport.scale=this.currentViewport.scale||1,t.style||$t.f.assertFail("Map style is missing"),this.style=t.style,this.host=t.host,this.behavior&&(this.interactivityService=(0,tt.ub)(this.host,this.featureSwitches)),this.legend=(0,Q.OG)(e,!1,this.interactivityService,this.isLegendScrollable,void 0,this.style,this.host),this.geoTaggingAnalyzerService=(0,Be.P)().create(t.host.getLocalizedString.bind(t.host)),this.tooltipService=(0,at.r)(this.host),this.host.locale&&(this.locale=this.host.locale()),this.geocoder=this.host.geocoder(),this.promiseFactory=this.host.promiseFactory(),this.mapTheme=ft.uH,this.resetBounds(),this.isDestroyed=!1},n.prototype.destroy=function(){this.isDestroyed=!0;var t=this.mapControl;t&&(this.mapControl=void 0,setTimeout(function(){return t.dispose()},n.MapControlDisposeDelay)),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null)},n.prototype.addDataPoint=function(t,e){if(t===this.geocodingContext){var a;if(--t.dataPointsRemaining,!_.isEmpty(e.paths))for(var i=0,r=e.paths;i<r.length;i++)a=(0,h.wu)(a,r[i].adjustedBounds);if(!a){var s=e.location;a={west:s.longitude,east:s.longitude,north:s.latitude,south:s.latitude}}this.updateBounds(a),this.scheduleRedraw()}},n.prototype.geocodingFailed=function(t){!this.isDestroyed&&t===this.geocodingContext&&--t.dataPointsRemaining<=0&&this.scheduleRedraw()},n.prototype.scheduleRedraw=function(){var t=this;et.fF.assert(function(){return t.geocodingContext.dataPointsRemaining>=0},"geocodingContext.dataPointsRemaining underflow"),this.pendingGeocodingRender&&this.geocodingContext.dataPointsRemaining<=0&&(clearTimeout(this.pendingGeocodingRender),this.pendingGeocodingRender=0),!this.pendingGeocodingRender&&this.mapControl&&(this.pendingGeocodingRender=setTimeout(function(){t.updateInternal(!0,!0),t.pendingGeocodingRender=0},this.geocodingContext.dataPointsRemaining<=0?0:n.ScheduleRedrawInterval))},n.prototype.enqueueGeoCode=function(t,e,a){var i=this,r=function(s){i.completeGeoCode(t,e,s)};this.geocoder.tryGeocodeImmediate(e.queryLocation,0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(o){i.initiateGeocoding(o,r,e,t,a)},function(o){i.initiateGeocoding(void 0,r,e,t,a)})},n.prototype.completeGeoCode=function(t,e,a){e.location=a,this.addDataPoint(t,e)},n.prototype.enqueueGeoCodeAndGeoShape=function(t,e,a,i){var r=this,o=function(l){r.completeGeoCodeAndGeoShape(t,e,a,l)};this.geocoder.tryGeocodeImmediate(e.queryLocation,0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(s){r.initiateGeocoding(s,o,e,t,i)},function(s){r.initiateGeocoding(void 0,o,e,t,i)})},n.prototype.completeGeoCodeAndGeoShape=function(t,e,a,i){e.location=i,this.enqueueGeoShape(t,e,a)},n.prototype.initiateGeocoding=function(t,e,a,i,r){var o=this;t?void 0===t.latitude||void 0===t.longitude?this.geocodingFailed(i):e(t):this.geocoder.geocode(a.queryLocation,0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB(),{timeout:i.timeout.promise,credentials:this.mapCredentials}).then(function(s){!o.isDestroyed&&i===o.geocodingContext&&((0,h.N2)(s,!0)?(o.warningsSet&&!r.invalidLatLongCoordinatesFound&&(o.warnings.push(new Qt.zI),o.host.setWarnings(o.warnings)),r.invalidLatLongCoordinatesFound=!0,o.geocodingFailed(i)):e(s))},function(s){return o.geocodingFailed(i)})},n.prototype.enqueueGeoShape=function(t,e,a){var i=this;et.fF.assertValue(e.location,"cachedLocation"),this.geocoder.tryGeocodeBoundaryImmediate({latitude:e.location.latitude,longitude:e.location.longitude,category:this.geocodingCategory,levelOfDetail:a.level,maxGeoData:a.maxPolygons,entityType:e.location.entityType},0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(r){i.initiateGeoboundary(r,e,t,a)},function(r){i.initiateGeoboundary(void 0,e,t,a)})},n.prototype.initiateGeoboundary=function(t,e,a,i){var r=this;t?this.completeGeoShape(a,e,i,t):this.geocoder.geocodeBoundary({latitude:e.location.latitude,longitude:e.location.longitude,category:this.geocodingCategory,levelOfDetail:i.level,maxGeoData:i.maxPolygons,entityType:e.location.entityType},0,!!this.featureSwitches.bingGeocoderIndexedDB,this.host.geocoderIndexedDB(),{timeout:a.timeout.promise,credentials:this.mapCredentials}).then(function(o){!r.isDestroyed&&o&&a===r.geocodingContext&&r.completeGeoShape(a,e,i,o)},function(o){return r.geocodingFailed(a)})},n.prototype.completeGeoShape=function(t,e,a,i){(0,h.Yb)(i.locations),e.paths=xe.buildPaths(i.locations),this.addDataPoint(t,e)},n.prototype.getOptimumLevelOfDetail=function(t,e,a){var i=this.dataPointRenderer.getDataPointCount();if(0===i)return this.minLevelOfDetail;var r=this.dataPointRenderer.getDataPointPadding(),o=this.dataPointRenderer.getEnclosingBounds&&this.dataPointRenderer.getEnclosingBounds();if(o)o.west=a.west,o.east=a.east;else if(1===i){var s;switch(this.geocodingCategory){case h.yV.Continent:s=130;break;case h.yV.CountryRegion:s=90;break;case h.yV.StateOrProvince:s=25;break;case h.yV.County:s=3;break;case h.yV.City:s=.7;break;case h.yV.PostalCode:s=.3;break;case h.yV.Place:s=.1;break;default:s=.04}o={west:a.west-s/2,north:this.maxLatitude,east:a.east+s/2,south:this.minLatitude}}else o={west:a.west,north:this.maxLatitude,east:a.east,south:this.minLatitude};for(var l=h.Ch;l>=h.z8;l--){var d=(0,h.Jy)(o.north,o.west,l,{unconstrained:!0}),p=(0,h.Jy)(o.south,o.east,l,{unconstrained:!0});if(Math.abs(p.x-d.x)+r<=t&&Math.abs(d.y-p.y)+r<=e)return l}return this.minLevelOfDetail},n.prototype.getMapView=function(t,e){var a=this.getSmallestEnclosingLongitudeRange(),i=(0,h.q1)((a.west+a.east)/2),r=this.getOptimumLevelOfDetail(t,e,a);r<=h.z8&&(i=0);var o=(0,h.Jy)(this.maxLatitude,i,r),s=(0,h.Jy)(this.minLatitude,i,r);return{center:(0,h.n8)((o.x+s.x)/2,(s.y+o.y)/2,r),levelOfDetail:r}},n.prototype.getSmallestEnclosingLongitudeRange=function(){var t=this.longitudes;if(_.isEmpty(t))return{west:0,east:0};if(1===t.length)return{west:t[0].west,east:t[0].east};t.sort(function(d,p){return d.west-p.west});var e=t[0].west,a=_.maxBy(t,function(d){return d.east}).east;if(a-e<=180)return{west:e,east:a};for(var i=e,r=a,o=r-i,s=1;s<t.length;++s){e=t[s].west;var l=(a=Math.max(a,t[s-1].east+360))-e;l<o&&(i=e,r=a,o=l)}return{west:i,east:r}},n.prototype.resetBounds=function(){this.boundsHaveBeenUpdated=!1,this.minLatitude=h.w6,this.maxLatitude=h.jv,this.longitudes=[]},n.prototype.updateBounds=function(t){var e=t.west,a=t.east,i=t.south,r=t.north,o=a-e;e=(0,h.q1)(e),this.longitudes.push({west:e,east:a=e+o}),this.boundsHaveBeenUpdated=!0,i<this.minLatitude&&(this.minLatitude=i),r>this.maxLatitude&&(this.maxLatitude=r)},n.prototype.renderLegend=function(t){this.legend.setPosition(t.position),this.legend.drawLegend({data:t,parentViewport:this.currentViewport})},n.calculateGroupSizes=function(t,e,a,i,r){for(var s=e.length,l=0,d=t.values[0].values.length;l<d;++l){var p=null;if(i>=0)for(var g=0;g<s;++g){var b=e[g].values[i].values[l];b&&(null===p?p=b:p+=b)}a.push(p),p&&(r?(r.min=Math.min(r.min,p),r.max=Math.max(r.max,p)):r={min:p,max:p})}return r},n.calculateRadius=function(t,e,a,i){var r,o;if(void 0===i&&(i=1),null==t||null==e)return i*n.MarkerRadiusDefault;var l=a===xt.Dl.deprecated?n.MarkerRadiusDefault:n.MarkerRadiusMin;a===xt.Dl.auto&&(a=e.min>=0||e.max<=0?xt.Dl.magnitude:xt.Dl.dataRange),a===xt.Dl.magnitude&&(t&&(t=Math.abs(t)),e={min:0,max:Math.max(null!==(r=Math.abs(e.max))&&void 0!==r?r:0,null!==(o=Math.abs(e.min))&&void 0!==o?o:0)});var p=((t=Math.min(Math.max(t,e.min),e.max))-e.min)/(e.max-e.min||1);return et.fF.assert(function(){return p>=0&&p<=1},"valueRatio must be between 0 and 1"),i*((n.MarkerRadiusMax-l)*Math.sqrt(p)+l)},n.getGeocodingCategory=function(t,e){var a;if(a=e.getFieldTypeFromDescriptor(t.type))return a;if(a=e.getFieldType(t.displayName))return a;var o=t.roles;if(o)for(var s=Object.keys(o),l=0,d=s.length;l<d;++l){var p=e.getFieldType(s[l]);if(p)return p}},n.hasSizeField=function(t,e){if(_.isEmpty(t))return!1;for(var a=0,i=t.length;a<i;a++){var r=t[a].source.roles;if(!r&&a===e&&t[a].source.type.numeric)return!0;if(r)for(var o=Object.keys(r),s=0,l=o.length;s<l;s++)if("Size"===o[s])return!0}return!1},n.shouldEnumerateDataPoints=function(t,e,a){var i=(0,Me.c5)(t,"Series"),o=(0,Me.c5)(t,e?"Size":"Gradient");return(i||!o)&&!(a&&a.showHeatMap)},n.shouldEnumerateHeatMap=function(t,e){return!(t&&t.dataPoints&&t.dataPoints.length>1||e)},n.shouldEnumerateCategoryLabels=function(t,e,a){return(!t||e)&&!(a&&a.showHeatMap)},n.prototype.getMapSettingsCard=function(t,e){var a=this,o=w.jM.mapStyles,s=(0,I.__assign)((0,I.__assign)({},w.jM.mapControls),o),l=new X.CQ(new X.lg("mapSettings"),"Visual_AzureMapsMapSettings",s,function(p){return t.getLocalizedString(p)});return l.addGroup("style",function(d){d.withDisplayName("Style"),d.addSimpleSlice("style",new X.uY({descriptor:s.mapTheme,value:e.mapTheme}).build(),function(p){return p.withCustomDisplayName("Style")}).addSimpleSlice("showLabels",new X.bd({descriptor:s.showLabels,value:e.showLabels}).build())}),l.addGroup("controls",function(d){d.withDisplayName("Controls"),d.addSimpleSlice("autoZoom",new X.bd({descriptor:s.autoZoom,value:e.autoZoomEnabled}).build()).addSimpleSlice("showZoomButtons",new X.bd({descriptor:s.showZoomButtons,value:e.showZoomButtons}).build());var p=n.shouldEnumerateHeatMap(a.data&&a.data.legendData,a.isFilledMap);a.plotLassoManager&&(!p||!e.showHeatMap)&&d.addSimpleSlice("showLassoButton",new X.bd({descriptor:s.showLassoButton,value:e.showLassoButton}).build()),d.addSimpleSlice("geocodingCulture",new X.uY({descriptor:s.geocodingCulture,value:e.geocodingCulture||be.gA}).build())}),l.build()},n.prototype.getLegendCard=function(t,e,a,i){return(0,B.ZF)({legendData:e},t,i,!a)},n.prototype.getBubblesCard=function(t){var e=this,a=function(d){return e.host.getLocalizedString(d)},i=w.jM.bubbles,r=w.jM.dataPoint,o=[r.fill,r.showAllDataPoints,r.defaultColor,i.bubbleSize,i.markerRangeType],s=new X.CQ(new X.lg("bubbles"),"Visual_Bubbles",o,a);return s.withDescription("Visual_BubblesDescription"),t&&!t.showHeatMap&&s.addGroup("size",function(l){var d;l.withDisplayName("Role_DisplayName_Size");var p={get:function(C){return e.host.getLocalizedString(C)},getOptional:function(C){return e.host.getLocalizedString(C)},format:function(C){return e.host.getLocalizedString(C)}},g=_.map(xt.Yu,function(D){return(0,I.__assign)((0,I.__assign)({},D),{displayName:D.displayName(p)})}),b=null!==(d=g.find(function(D){return D.value===t.markerRangeType}))&&void 0!==d?d:{value:xt.Dl.deprecated,displayName:e.host.getLocalizedString("Visual_MarkerRangeType_Deprecated")};l.addSimpleSlice("markerRangeType",new X.uY({descriptor:i.markerRangeType,items:g,value:b}).build(),function(D){var C;return D.withDisabled(!(null!==(C=e.data)&&void 0!==C&&C.hasSize))}),l.addSimpleSlice("size",new X.JN({descriptor:i.bubbleSize,value:(0,P.yn)(t.bubbleSizeMultiplier),localize:a,options:{minValue:{type:0,value:P.Ad.min},maxValue:{type:1,value:P.Ad.max}}}).build())}),this.addDataPointsDetails(t,s,a),s.build()},n.prototype.getFillColorsCard=function(t){var e=this,a=function(l){return e.host.getLocalizedString(l)},i=w.jM.dataPoint,r=[i.fill,i.showAllDataPoints,i.defaultColor],o=new X.CQ(new X.lg("fillcolors"),"Visual_FillColors",r,a);return this.addDataPointsDetails(t,o,a),o.build()},n.prototype.addDataPointsDetails=function(t,e,a){var i=this,r=this.data;!r||!n.shouldEnumerateDataPoints(this.dataView,this.isFilledMap,t)||e.addGroup("colors",function(o){if(o.withDisplayName("Visual_Colors"),r.hasSeries){var s={groupBuilder:o,dataPoints:(0,B.l3)(r.legendData),seriesColorProps:w.jM.dataPoint,localize:a,featureSwitches:i.featureSwitches};return(0,St.y0)(s)}var l={groupBuilder:o,colorProps:w.jM.dataPoint,featureSwitches:i.featureSwitches,hostService:i.host,options:{dataView:i.dataView,style:i.style,categories:_.map(r.dataPoints,function(d){var p=d.subDataPoints[0];return{color:(0,yt.ci)(p.fill),displayName:d.categoryValue,identity:p.identity}}),fillInstanceKind:3}};(0,St.jN)(l)})},n.prototype.getCategoryLabelCard=function(t,e,a,i){if(n.shouldEnumerateCategoryLabels(this.isFilledMap,this.filledMapDataLabelsEnabled,a)){var r=w.jM.categoryLabels;return(0,m.Zu)({cardName:"Visual_CategoryLabels",dataLabelSettings:e,isShowCategory:!1,localize:function(l){return t.getLocalizedString(l)},props:r,revertToDefaultProps:r,showBackground:!0,showValueColor:!0,style:i})}},n.prototype.getHeatMapCard=function(){var e,t=this;if(this.data&&n.shouldEnumerateHeatMap(this.data.legendData,this.isFilledMap)&&(!this.data.legendData||_.isEmpty(this.data.legendData.dataPoints))){var i=this.data.properties,r=function(p){return t.host.getLocalizedString(p)},o=w.jM.heatMap,s=new X.CQ(new X.lg("heatmap"),"Visual_HeatMap",o,r),l=st.XT;return!(null===(e=i.heatMapOptions)||void 0===e)&&e.unit&&i.heatMapOptions.unit===st.zH&&(l=st.dw),s.addTopLevelToggle("show",function(){return new X.bd({descriptor:(0,I.__assign)((0,I.__assign)({},o.show),{selector:null}),value:i.showHeatMap}).build()}).addGroup("colors",function(d){var p,g,b;d.withDisplayName("Visual_Colors").addSimpleSlice("color0",new X.BT({descriptor:(0,I.__assign)((0,I.__assign)({},o.color0),{selector:null,instanceKind:1}),value:{value:null===(p=i.heatMapOptions)||void 0===p?void 0:p.colorGradient["0.20"]}}).build()).addSimpleSlice("color50",new X.BT({descriptor:(0,I.__assign)((0,I.__assign)({},o.color50),{selector:null,instanceKind:1}),value:{value:null===(g=i.heatMapOptions)||void 0===g?void 0:g.colorGradient[.65]}}).build()).addSimpleSlice("color100",new X.BT({descriptor:(0,I.__assign)((0,I.__assign)({},o.color100),{selector:null,instanceKind:1}),value:{value:null===(b=i.heatMapOptions)||void 0===b?void 0:b.colorGradient["1.00"]}}).build())}).addGroup("options",function(d){var p,g;d.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice("radius",new X.JN({descriptor:(0,I.__assign)((0,I.__assign)({},o.filterRadius),{selector:null}),value:null===(p=i.heatMapOptions)||void 0===p?void 0:p.radius,localize:r,options:{minValue:{type:0,value:1},maxValue:{type:1,value:l},unitSymbol:c.e_}}).build()).addSimpleSlice("displayUnits",new X.uY({descriptor:(0,I.__assign)((0,I.__assign)({},o.unit),{selector:null}),value:null===(g=i.heatMapOptions)||void 0===g?void 0:g.unit}).build(),function(b){return b.withCustomDisplayName("Visual_DisplayUnits").withAliasName("Decimal")}).addSimpleSlice("transparency",X.JN.getTransparencySliderBuilder({descriptor:(0,I.__assign)((0,I.__assign)({},o.transparency),{selector:null}),value:i.heatMapOptions&&Math.round(100*(1-i.heatMapOptions.opacity)),localize:r}).build())}),s.build()}},n.prototype.getFormattingModel=function(){var t=this,e=this.data?this.data.dataLabelSettings:(0,h.BP)(this.style),a=this.data?this.data.properties:(0,h.IG)(this.style).properties;return new X.Nq(function(){return t.getMapSettingsCard(t.host,a)},function(){return t.getLegendCard(t.host,t.data&&t.data.legendData,t.hasSeries,t.featureSwitches)},function(){return t.isFilledMap?t.getFillColorsCard(a):t.getBubblesCard(a)},function(){return t.getCategoryLabelCard(t.host,e,a,t.style)},function(){return t.getHeatMapCard()}).build()},n.prototype.update=function(t){return(0,I.__awaiter)(this,void 0,void 0,function(){return(0,I.__generator)(this,function(e){switch(e.label){case 0:return null==t.resizeMode?[3,1]:(this.onResizingInternal(t),[3,3]);case 1:return[4,this.onDataChangedInternal(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},n.prototype.onDataChangedInternal=function(t,e){return void 0===e&&(e=!0),(0,I.__awaiter)(this,void 0,void 0,function(){var a,i,r,o,s,l,p,g,b,D,C,N,Z=this;return(0,I.__generator)(this,function(W){switch(W.label){case 0:return et.fF.assertValue(t,"options"),this.viewMode=t&&t.viewMode,this.resetBounds(),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null),this.geocodingContext={timeout:this.promiseFactory.defer(),dataPointsRemaining:0},a=this.geocodingContext,this.behavior&&this.behavior.resetZoomPan(),i=this.dataView=t&&t.dataViews&&t.dataViews[0],r=this.isFilledMap,this.warnings=[],this.warningsSet=!1,o=(0,h.IG)(this.style),i?(o=this.data=n.converter({dataView:i,geoTaggingAnalyzerService:this.geoTaggingAnalyzerService,isFilledMap:r,style:this.style,warnings:this.warnings}),this.dataPointRenderer.setData(o),this.hasSeries=o.hasSeries,[4,this.ensureMap()]):[3,2];case 1:if(W.sent(),this.isDestroyed)return[2];if(this.mapControl){if((s=o.properties.mapTheme)!==this.mapTheme&&(this.mapControl.setMapType((0,h.N0)(s)),this.mapTheme=s),(l=this.mapControl.getOptions()).showZoomButtons!==o.properties.showZoomButtons||o.properties.minZoom&&l.minZoom!==o.properties.minZoom||o.properties.maxZoom&&l.maxZoom!==o.properties.maxZoom)return p=this.mapControl,this.mapControl=void 0,this.dataPointRenderer.clearDataPoints(),p.dispose(),setTimeout(function(){Z.root.empty(),Z.initializeMapControl(),e&&setTimeout(function(){return Z.onDataChangedInternal(t,!1)},250)},n.MapControlDisposeDelay),[2];if(o.properties.autoZoomEnabled&&!this.autoZoomWasEnabled?(o.properties.savedLatitude=void 0,o.properties.savedLongitude=void 0,o.properties.savedZoomLevel=void 0,this.persistZoomPanState(!0)):!o.properties.autoZoomEnabled&&this.autoZoomWasEnabled&&(this.updateZoomPanStateFromControl(),this.persistZoomPanState(!0)),this.autoZoomWasEnabled=o.properties.autoZoomEnabled,this.renderLegend(this.data.legendData),this.geocodingCategory=o.geocodingCategory,this.isDestroyed||a!==this.geocodingContext)return[2];for(g=void 0,r&&(g=(0,h.o)(this.geocodingCategory,o.dataPoints.length)),a.dataPointsRemaining=o.dataPoints.length,b=0,D=o.dataPoints;b<D.length;b++)(C=D[b]).location?r&&!C.paths?this.enqueueGeoShape(a,C,g):this.addDataPoint(a,C):null!=(N=C.categoryValue)&&""!==N?r?this.enqueueGeoCodeAndGeoShape(a,C,g,o):this.enqueueGeoCode(a,C,o):this.geocodingFailed(a);this.updateInternal(!0,!0)}return r&&(!this.geocodingCategory||!this.geoTaggingAnalyzerService.isGeoshapable(this.geocodingCategory))&&this.warnings.push(new Qt.Gh),o.invalidLatLongCoordinatesFound&&this.warnings.push(new Qt.zI),[3,3];case 2:this.clearDataPoints(),this.renderLegend((0,E.Fe)(this.style)),this.dataPointRenderer.setData(o),this.updateInternal(!0,!0),W.label=3;case 3:return this.host.setWarnings(this.warnings),this.warningsSet=!0,[2]}})})},n.converter=function(t){if(n.isMatrixCase(t.dataView))return n.convertMatrix(t);var e=t.style,a=w.jM.general.formatString,i=(0,f.G)(t.dataView,{colorOptions:{valueRole:"Size",visualStyle:e},formatStringProp:a}),r=i.data,o=i.objects,s=[],l=r.hasSeries(),d=r.hasValues("Size"),p=null,g=i.objects.getStaticObjects(),b=(100-(0,O.NA)(g,w.jM.dataPoint.transparency,100*(1-n.innerGeometryAlpha)))/100,D=t.isFilledMap,C=!1,N=n.getMapPropertiesFromObjects(g,e,!l,t);if(r.hasCategories()){var Z=[],W=void 0;if(d){for(var R=void 0,U=void 0,T=0,G=r.getCategoryCount();T<G;T++){for(var v=void 0,z=0,lt=r.getSeriesCount();z<lt;z++){var k=r.getValue("Size",T,z);null==v&&null!=k&&(v=0),null!=v&&(v+=k)}Z.push(v),null!=v&&((void 0===R||v<R)&&(R=v),(void 0===U||v>U)&&(U=v))}W=void 0!==R&&void 0!==U?{max:U,min:R}:void 0}var K=r.hasCompositeCategories()&&r.hasCategoryWithRole("X")&&r.hasCategoryWithRole("Y"),nt=r.hasCategoryWithRole("Category");if(nt&&(p=n.getGeocodingCategory(_.last(t.dataView.categorical.categories).source,t.geoTaggingAnalyzerService)),K||nt)for(T=0,G=r.getCategoryCount();T<G;T++){var ot={components:[],culture:N.geocodingCulture},ut=void 0,V=void 0,j=[],dt=void 0,ht=void 0,Pt=void 0,wt=void 0,Mt=void 0;if(nt){for(var Lt=r.getAllCategoryDisplayNamesForRole("Category"),Ft=r.getAllCategoryValuesForRole("Category",T),Ct=o.getAllCategoryFormatStringsForRole("Category"),At=_.map(t.dataView.categorical.categories,function(ie){return n.getGeocodingCategory(ie.source,t.geoTaggingAnalyzerService)}),kt=[],Et=0;Et<Ft.length;++Et){var It=Lt[Et],Rt=Ft[Et],Tt=At[Et],q=(0,mt.WU)(Rt,Ct[Et]);kt.unshift(q),ot.components.push({query:Rt&&q,category:Tt}),j.push({displayName:It,value:q})}if(ut=kt.join(", "),r.hasValues("Y")&&r.hasValues("X")){var J=Ot(r.getFirstNonNullValueForCategory("Y",T)),pt=Ot(r.getFirstNonNullValueForCategory("X",T));null!=J&&_.isFinite(J)&&null!=pt&&_.isFinite(pt)&&(V={latitude:J,longitude:pt}),dt={displayName:r.getValueDisplayName("Y"),value:(0,mt.WU)(J,o.getValueFormatString("Y"))},ht={displayName:r.getValueDisplayName("X"),value:(0,mt.WU)(pt,o.getValueFormatString("X"))}}}else{J=Ot(r.getCategoryValue("Y",T));var vt=(0,mt.WU)(J,o.getCategoryFormatString("Y")),ee=(pt=Ot(r.getCategoryValue("X",T)),(0,mt.WU)(pt,o.getCategoryFormatString("X")));Le(J,pt)&&(ut=vt+", "+ee,V={latitude:J,longitude:pt},dt={displayName:r.getCategoryDisplayName("Y"),value:vt},ht={displayName:r.getCategoryDisplayName("X"),value:ee})}var Ht=d?Z[T]:void 0;if((0,h.N2)(V,K))C=!0;else{var Wt=[];for(lt=r.getSeriesCount(),!d&&!l&&(lt=1),z=0;z<lt;z++){var le=l?r.getSeriesName(z):void 0;if(!l||d||!n.hasNoValuesAtInteresection(i,["Tooltips","X","Y"],T,z)){var Yt=i.colors.createBySeries(z,T),Bt=(0,yt.WV)(Yt);Bt||(Yt=i.colors.createBySeries(z,T,void 0,!0),Bt=(0,yt.WV)(Yt));var Nt=n.getSubDataPointStrokeColor(Bt,e),ue=(0,yt.U8)(n.adjustSubDataPointFillColor(Bt,e,b));l&&(Pt={displayName:r.getSeriesDisplayName(),value:(0,mt.WU)(le,o.getSeriesFormatString())});var Gt=void 0;if(d){Gt=r.getValue("Size",T,z);var de=r.getFormatString("Size",T,z)||i.objects.getValueFormatString("Size");wt={displayName:r.getValueDisplayName("Size"),value:(0,mt.WU)(Gt,de)}}if(r.hasValues("Gradient")){var he=r.getValue("Gradient",T,z),Kt=i.objects.getValueFormatString("Gradient");Mt={displayName:r.getValueDisplayName("Gradient"),value:(0,mt.WU)(he,Kt)}}var Y=[];_.isEmpty(j)||Y.push.apply(Y,j||[]),Pt&&Y.push(Pt),dt&&Y.push(dt),ht&&Y.push(ht),wt&&Y.push(wt),Mt&&Y.push(Mt),(0,it.VT)(i,Y,T,z,a);var ae=i.identities.createForDataPoint(T,z,d?["Size"]:void 0);(Gt||!d||0===Gt&&D)&&Wt.push({value:Gt,fill:ue,stroke:Nt,identity:ae,tooltipInfo:Y,seriesIndex:z})}}(Ht||!d||0===Ht&&D)&&Wt.length>0&&s.push({queryLocation:ot,value:Ht,categoryValue:ut,subDataPoints:Wt,radius:n.calculateRadius(Ht,W,N.markerRangeType,N.bubbleSizeMultiplier),location:V})}}}var ct={dataPoints:s,geocodingCategory:p,hasSeries:l,hasSize:d,properties:N,dataLabelSettings:n.calculateDataLabelSettings(t.dataView,D,e),legendData:(0,E.pq)({dataView:t.dataView,style:e,showByDefault:!0}),invalidLatLongCoordinatesFound:C},pe=x.v.getDataColorByIndex(e,0),Vt=(0,yt.X6)(pe,.33);return ct.properties.heatMapOptions={opacity:1-(0,O.NA)(g,w.jM.heatMap.transparency,0)/100,radius:(0,O.NA)(g,w.jM.heatMap.filterRadius,10),unit:(0,O.NA)(g,w.jM.heatMap.unit,st.aA),colorGradient:{"0.20":(0,O.W7)(g,w.jM.heatMap.color0,Vt(0)),.65:(0,O.W7)(g,w.jM.heatMap.color50,Vt(.5)),"1.00":(0,O.W7)(g,w.jM.heatMap.color100,Vt(1))}},ct.properties.heatMapOptions.radius="meters"===ct.properties.heatMapOptions.unit?Math.min(ct.properties.heatMapOptions.radius,st.dw):Math.min(ct.properties.heatMapOptions.radius,st.XT),ct},n.getMapPropertiesFromObjects=function(t,e,a,i){var r={bubbleSizeMultiplier:(0,P.HN)((0,O.NA)(t,w.jM.bubbles.bubbleSize,1)),markerRangeType:(0,O.NA)(t,w.jM.bubbles.markerRangeType,xt.Dl.deprecated),autoZoomEnabled:(0,O.NA)(t,w.jM.mapControls.autoZoom,!0),savedLatitude:(0,O.NA)(t,w.jM.mapControls.centerLatitude),savedLongitude:(0,O.NA)(t,w.jM.mapControls.centerLongitude),savedZoomLevel:(0,O.NA)(t,w.jM.mapControls.zoomLevel),defaultDataPointColor:(0,O.W7)(t,w.jM.dataPoint.defaultColor,e.colorPalette.dataColors.getColorByIndex(0).value),fill:(0,O.W7)(t,w.jM.dataPoint.fill,e.colorPalette.dataColors.getColorByIndex(0).value),mapTheme:n.getMapThemeFromObjects(t,e),showHeatMap:a&&(0,O.NA)(t,w.jM.heatMap.show),showZoomButtons:(0,O.NA)(t,w.jM.mapControls.showZoomButtons,!1),showLassoButton:(0,O.NA)(t,w.jM.mapControls.showLassoButton,!1),minZoom:(0,O.NA)(t,w.jM.mapControls.minZoom,void 0),maxZoom:(0,O.NA)(t,w.jM.mapControls.maxZoom,void 0),showLabels:(0,O.NA)(t,w.jM.mapStyles.showLabels,!0),showStroke:(0,O.NA)(t,A.Vh.stroke.show,!1),strokeColor:(0,O.W7)(t,A.Vh.stroke.color,void 0),strokeWidth:(0,O.NA)(t,A.Vh.stroke.width,void 0),geocodingCulture:(0,O.NA)(t,w.jM.mapControls.geocodingCulture,void 0)};return r.geocodingCulture&&!(0,be._h)(r.geocodingCulture)&&(r.geocodingCulture=void 0,i.warnings.push(new Qt.aV)),r},n.convertMatrix=function(t){var e=t.dataView.metadata.objects,a=t.dataView.matrix,i=t.style,r=[],o=a.rows.root.children;if(!o)return(0,h.IG)(i);var R,s=(100-(0,O.NA)(e,w.jM.dataPoint.transparency,100*(1-n.innerGeometryAlpha)))/100,l=o.length,d={},p=0,g=a.rows.root.childIdentityFields,b=a.rows.levels[0].sources[0],D=w.jM.general.formatString,C=x.v.create(i,w.jM.dataPoint.fill),N=!1,Z=n.getMapPropertiesFromObjects(e,i,!1,t),W=n.calculateRadius(void 0,void 0,Z.markerRangeType,Z.bubbleSizeMultiplier);if(!_.isEmpty(a.valueSources)){R=[];for(var U=0;U<a.valueSources.length;++U){var T=a.valueSources[U];T.roles.Tooltips&&R.push({displayName:T.displayName,valueIndex:U})}}var G,v,z,lt,k,K=a.rows.levels[1];if(null!=K&&!_.isEmpty(K.sources)&&(G=K.sources,K.sources.length>=2)){var nt=K.sources[0],ot=K.sources[1];nt&&nt.roles.X?(v=nt,lt=0):nt&&nt.roles.Y&&(z=nt,k=0),ot&&ot.roles.X?(v=ot,lt=1):ot&&ot.roles.Y&&(z=ot,k=1)}for(var ut,V=0;V<l;V++){var j=o[V],dt=j.children,ht=j.value,Pt=(0,y.xq)(ht,b,w.jM.general.formatString),wt=C.getColorForSeriesValue(j.objects,g,ht),Mt=(0,yt.WV)(wt);Mt||(wt=C.getColorForSeriesValue(j.objects,g,ht,void 0,!0),Mt=(0,yt.WV)(wt));var Lt=n.getSubDataPointStrokeColor(Mt,i),Ft=(0,yt.U8)(n.adjustSubDataPointFillColor(Mt,i,s)),Ct={displayName:b.displayName,value:Pt};if(G&&G[0].roles.Category){var At=G[G.length-1];ut=n.getGeocodingCategory(At,t.geoTaggingAnalyzerService);for(var kt=0,Et=dt.length;kt<Et;kt++){var It=dt[kt],te=(Rt=(new re.dw).withColumnIdentity(It.identity,At.queryName)).createSelectionId().getKey(),Tt=Rt.withColumnIdentity(j.identity,b.queryName).createSelectionId();null==(q=d[te])&&(q=p++,d[te]=q);var J=[],pt={components:[],culture:Z.geocodingCulture},vt=void 0;if(It.levelValues&&1!==It.levelValues.length){for(var Ht=_.map(G,function(zt){return zt.displayName}),Wt=_.map(It.levelValues,function(zt){return zt.value}),le=_.map(G,function(zt){return(0,O.NA)(zt.objects,{objectName:"general",propertyName:"formatString"})}),Yt=_.map(G,function(zt){return n.getGeocodingCategory(zt,t.geoTaggingAnalyzerService)}),Bt=[],Nt=0;Nt<Wt.length;++Nt){var ue=Ht[Nt],he=Yt[Nt],Kt=(0,mt.WU)(Wt[Nt],le[Nt]);Bt.unshift(Kt),pt.components.push({query:Kt,category:he}),J.push({displayName:ue,value:Kt})}vt=Bt.join(", ")}else vt=(0,y.xq)(It.value,At,D),J.push({displayName:At.displayName,value:vt}),pt.components.push({query:vt,category:ut});(Y=r[q])||(r[q]=Y={categoryValue:vt,queryLocation:pt,radius:W,subDataPoints:[],value:void 0}),Ct&&J.push(Ct),Y.subDataPoints.push({fill:Ft,stroke:Lt,identity:Tt,value:void 0,tooltipInfo:J,seriesIndex:V})}}else if(b&&b.roles.Category&&b.roles.Series){ut=n.getGeocodingCategory(b,t.geoTaggingAnalyzerService);var ae=(Tt=(new re.dw).withColumnIdentity(j.identity,b.queryName).createSelectionId()).getKey();null==(q=d[ae])&&(q=p++,d[ae]=q),(Y=r[q])||(r[q]=Y={categoryValue:Pt,queryLocation:{components:[{query:Pt,category:ut}]},radius:W,subDataPoints:[],value:void 0}),J=[],Ct&&J.push(Ct),Y.subDataPoints.push({fill:Ft,stroke:Lt,identity:Tt,value:void 0,tooltipInfo:J,seriesIndex:V})}else{if(!(v&&v.roles.X&&z&&z.roles.Y))return(0,h.IG)(i);for(var ct=0,pe=dt.length;ct<pe;ct++){var Vt=dt[ct],fe=Ot(Vt.levelValues[lt].value),ve=Ot(Vt.levelValues[k].value);if(Le(ve,fe)){var ce,ge,ye,Rt,q,Y,Ee=(0,y.xq)(fe,v,D),ie=(0,y.xq)(ve,z,D),Re=(J=[],vt=ie+", "+Ee,(Rt=(new re.dw).withColumnIdentity(Vt.identity,z.queryName)).createSelectionId().getKey());if(Tt=Rt.withColumnIdentity(j.identity,b.queryName).createSelectionId(),(0,h.N2)(ye={latitude:ve,longitude:fe},!0)){N=!0;continue}if(ce={displayName:z.displayName,value:ie},ge={displayName:v.displayName,value:Ee},null==(q=d[Re])&&(q=p++,d[Re]=q),(Y=r[q])||(r[q]=Y={categoryValue:vt,queryLocation:{components:[{query:vt,category:ut}]},radius:W,subDataPoints:[],value:void 0,location:ye}),Ct&&J.push(Ct),ce&&J.push(ce),ge&&J.push(ge),!_.isEmpty(R))for(var me=0,Te=R;me<Te.length;me++){var Ne=Te[me];J.push({displayName:Ne.displayName,value:(0,mt.WU)(Vt.values[Ne.valueIndex].value)})}Y.subDataPoints.push({fill:Ft,stroke:Lt,identity:Tt,value:void 0,tooltipInfo:J,seriesIndex:V})}}}}return{dataPoints:r,hasSeries:!0,geocodingCategory:ut,hasSize:!1,properties:Z,dataLabelSettings:n.calculateDataLabelSettings(t.dataView,t.isFilledMap,i),legendData:(0,E.PP)({dataView:t.dataView,colorHelper:C,style:i,formatStringProp:D,showByDefault:!0}),invalidLatLongCoordinatesFound:N}},n.getMapThemeFromObjects=function(t,e){return e.isHighContrast?ft.IZ:(0,O.NA)(t,w.jM.mapStyles.mapTheme,ft.uH)},n.adjustSubDataPointFillColor=function(t,e,a){return void 0===a&&(a=n.innerGeometryAlpha),t.A=e.isHighContrast?void 0:a,t},n.getSubDataPointStrokeColor=function(t,e){return e.isHighContrast?x.v.getThemeColor(e,Ve.fA):(0,yt.Bx)((0,yt._j)(t,n.StrokeDarkenColorValue))},n.isMatrixCase=function(t){return t.matrix&&!t.categorical},n.calculateDataLabelSettings=function(t,e,a){var i=(0,h.BP)(a),r=t.metadata&&t.metadata.objects;if(!r)return i;if(i.showCategory=(0,O.NA)(r,A.Vh.categoryLabels.show,i.showCategory),e){i.precision=(0,O.NA)(r,A.Vh.labels.labelPrecision,i.precision),i.precision=i.precision!==u.NZ&&i.precision<0?0:i.precision,i.displayUnits=(0,O.NA)(r,A.Vh.labels.labelDisplayUnits,i.displayUnits);var o=r.labels;o&&(i.show=void 0!==o.show?o.show:i.show,void 0!==o.color&&(i.fontProperties=(0,S.ED)(i.fontProperties,{color:o.color.solid.color})))}else{var s=r.categoryLabels;s&&(0,m.ww)(s,i,void 0,a)}var l=x.v.create(a);return i.enableBackground=(0,O.NA)(r,w.jM.categoryLabels.enableBackground,!0),i.backgroundColor=l.getColorForProperty(r,w.jM.categoryLabels.backgroundColor,u.lp),i.backgroundTransparency=(0,O.NA)(r,w.jM.categoryLabels.backgroundTransparency,100*h.Bz)/100,i},n.hasNoValuesAtInteresection=function(t,e,a,i){for(var r=!1,o=0,s=e;o<s.length;o++){var l=s[o];if(t.data.hasValues(l)&&(r=!0,!_.every(t.data.getAllValuesForRole(l,a,i),function(d){return null==d})))return!1}return r},n.prototype.swapLogoContainerChildElement=function(){var t=this.element.find(".LogoContainer");if(t){var e=t.find("a");if(null==e)return;var a=$("<div>");e.children().clone().appendTo(a),e.remove(),a.appendTo(t)}},n.prototype.onResizingInternal=function(t){var e=t.viewport;e.scale=e.scale||1,(this.currentViewport.width!==e.width||this.currentViewport.height!==e.height||this.currentViewport.scale!==e.scale)&&(this.currentViewport=e,this.data&&this.data.legendData&&this.mapControl&&(this.renderLegend(this.data.legendData),this.updateInternal(!1,!1),(0,h.ml)(this.mapControl)))},n.prototype.ensureMap=function(){var t=this;return this.ensuringMap?this.ensuringMap.promise:(this.ensuringMap=(0,Ge.p)().defer(),this.mapControlFactory||(this.mapControlFactory=(0,h.$f)(this.promiseFactory,this.host.loader())),this.mapControlFactory.ensureMap(this.locale).then(function(){t.isDestroyed||(Fe(),t.initializeMapControl())}))},n.prototype.createMapControl=function(t,e){var a={credentials:h.Zr.BingKey,mapTypeId:(0,h.N0)(this.mapTheme),disableZooming:this.disableZooming,disablePanning:this.disablePanning,enableClickableLogo:!1,showDashboard:!0,showMapTypeSelector:!1,showLocateMeButton:!1,showZoomButtons:!1,showScalebar:!1,showTrafficButton:!1,allowHidingLabelsOfRoad:!0,enableInertia:!1};e&&(a=(0,I.__assign)((0,I.__assign)({},a),e));var i=this.mapControlFactory.createMapControl(t,a),r=i.getZoomRange();return r&&(null!=r.min&&r.min>this.minLevelOfDetail&&(this.minLevelOfDetail=r.min),null!=r.max&&r.max<this.maxLevelOfDetail&&(this.maxLevelOfDetail=r.max)),i},n.prototype.initializeMapControl=function(){var e,t=this,a=null===(e=this.data)||void 0===e?void 0:e.properties,i=this.data?{showZoomButtons:a.showZoomButtons,mapTypeId:(0,h.N0)(a.mapTheme),minZoom:a.minZoom,maxZoom:a.maxZoom}:null;if(!this.root&&(this.root=(0,Ie.hi)().addClass(n.MapContainer.cssClass).css("position","absolute").appendTo(this.element[0]),!this.disableZooming)){var o,r=!1,l=function(){r&&(t.mapControl.setOptions({disableZooming:!1}),r=!1)},d=this.root[0];d.addEventListener("mouseup",function(C){0!==t.viewMode&&C.target.classList.contains("MicrosoftMap")&&(t.mapControl.setOptions({disableZooming:!0}),r=!0,o||(o=setTimeout(function(){o=void 0,l()})))},!0),d.addEventListener("mouseup",l,!1)}var p=this.root,g=this.createMapControl(p[0],i);if(this.data&&a.mapTheme&&(this.mapTheme=a.mapTheme),this.data&&null!=a.autoZoomEnabled&&(this.autoZoomWasEnabled=a.autoZoomEnabled),this.mapControl=g,this.streetsideManager=new Qe(g,function(C){if(C)t.dataPointRenderer.hideDataPoints();else{t.updateInternal(!0,!0),t.dataPointRenderer.showDataPoints(),t.updateZoomPanStateFromControl();var N=t.data.properties;N&&t.updateMapView(new Microsoft.Maps.Location(N.savedLatitude,N.savedLongitude),N.savedZoomLevel)}}),this.dataPointRenderer.init(g,p,!!this.behavior,this.tooltipService,this.style,this.interactivityService,this.host,this.eventManager),this.behavior&&this.dataPointLassoSelect&&this.dataPointRenderer.getPlotAreaLassoSurface){var b=this.dataPointRenderer.getPlotAreaLassoSurface(),D=d3.select(p[0]);this.plotLassoManager=new F.oW(!0),this.plotLassoManager.init([b,D],b,this.host,this.featureSwitches),this.lassoSelectionBehavior=new F.lk(this.behavior),this.plotLassoManager.behaviors.push(this.lassoSelectionBehavior),this.plotLassoManager.setUiScale(this.currentViewport.scale)}this.updateMapView(new Microsoft.Maps.Location(25,0),this.minLevelOfDetail),void 0!==this.viewChangeThrottleInterval?Microsoft.Maps.Events.addThrottledHandler(g,"viewchange",function(){t.onViewChanged()},this.viewChangeThrottleInterval):Microsoft.Maps.Events.addHandler(g,"viewchange",function(){t.onViewChanged()}),Microsoft.Maps.Events.addHandler(g,"viewchangeend",function(){t.onViewChangeEnded()}),this.streetsideManager.start(),this.pendingGeocodingRender||this.updateInternal(!0,!0),this.ensuringMap.resolve()},n.prototype.onViewChanged=function(){!this.mapControl||this.streetsideManager.InStreetsideMode||this.data&&this.data.properties.showHeatMap||(this.updateOffsets(!1,!1),this.behavior&&this.behavior.viewChanged(),this.swapLogoContainerChildElement())},n.prototype.onViewChangeEnded=function(){!this.mapControl||this.streetsideManager.InStreetsideMode||(this.onViewChanged(),this.data&&!1===this.data.properties.autoZoomEnabled&&(this.updateZoomPanStateFromControl(),this.persistZoomPanState(!1)),this.dataPointRenderer.updateInternalDataLabels(this.currentViewport,!0))},n.prototype.getMapViewPort=function(){var t=this.currentViewport,e=this.legend.getMargins();if(this.rescaleMap){var i=this.currentViewport.scale;if(i)return{width:(t.width-e.width)*i,height:(t.height-e.height)*i}}return{width:t.width-e.width,height:t.height-e.height}},n.prototype.updateInternal=function(t,e){var a,i=this.data&&this.data.properties;if(this.mapControl&&i){var r=this.element.children(n.MapContainer.selector),o=this.getMapViewPort();if(r.height(o.height),r.width(o.width),this.rescaleMap&&(r.css("transform","scale("+1/this.currentViewport.scale+")"),r.css("transform-origin","left top")),this.updateOffsets(t,e),this.behavior&&this.behavior.mapKeyboardAccessibility(this.host,this.data.properties.showZoomButtons),!this.behavior||!this.behavior.hasReceivedZoomOrPanEvent())if(this.shouldSetSavedLocation&&!1===i.autoZoomEnabled&&null!=i.savedLatitude&&null!=i.savedLongitude&&null!=i.savedZoomLevel)this.updateMapView(new Microsoft.Maps.Location(i.savedLatitude,i.savedLongitude),i.savedZoomLevel),this.shouldSetSavedLocation=!1;else if(this.boundsHaveBeenUpdated&&!0===i.autoZoomEnabled){var s=(a=this.getMapView(o.width,o.height)).center;this.updateMapView(s,a.levelOfDetail),this.shouldSetSavedLocation=!0}}},n.prototype.updateMapView=function(t,e){this.mapControl&&(e=Math.min(Math.max(e,this.minLevelOfDetail),this.maxLevelOfDetail),this.mapControl.setView({center:t,zoom:e,animate:!0,labelOverlay:this.data.properties.showLabels?Microsoft.Maps.LabelOverlay.visible:Microsoft.Maps.LabelOverlay.hidden}))},n.prototype.updateMapViewOnFocus=function(){var t,e=this.getMapViewPort(),a=(t=this.getMapView(e.width,e.height)).center;this.updateMapView(a,t.levelOfDetail)},n.prototype.updateOffsets=function(t,e){var a=this;if(!this.streetsideManager.InStreetsideMode){var r,i=this.dataView,o=this.getMapViewPort();r=i?this.dataPointRenderer.converter(o,this.data.dataLabelSettings,this.interactivityService,this.tooltipsEnabled,t):{bubbleData:[],shapeData:[],sliceData:[]};var s=this.dataPointRenderer.updateInternal(r,o,t,this.interactivityService,e,this.behavior);if(this.plotLassoManager&&(this.plotLassoManager.setUiScale(this.currentViewport.scale),this.syncLassoButton()),s&&(s.focusCallback=function(){a.updateMapViewOnFocus()}),(0,H.xz)(d3.select(this.root[0]),this.legend),this.interactivityService&&s){var l=this.dataPointRenderer.getNavigationOptions();this.interactivityService.bind(s.dataPoints,this.behavior,s,{navigationOptions:l,pointSourceKey:"map"})}}},n.prototype.onClearSelection=function(){this.interactivityService.clearSelection(),this.updateOffsets(!1,!1)},n.prototype.onRestoreSelection=function(t){return!!this.interactivityService&&this.interactivityService.restoreSelection(t.selection)},n.prototype.clearDataPoints=function(){this.dataPointRenderer.clearDataPoints(),this.legend.drawLegend({data:(0,E.Fe)(this.style),parentViewport:this.currentViewport})},n.prototype.updateZoomPanStateFromControl=function(){var t=this.data&&this.data.properties;if(t){var e=this.mapControl.getCenter();t.savedLatitude=e.latitude,t.savedLongitude=e.longitude,t.savedZoomLevel=this.mapControl.getZoom()}},n.prototype.persistZoomPanState=function(t){var e=this.data&&this.data.properties,a=e&&e.autoZoomEnabled,i=e&&e.showZoomButtons,r=e&&e.showLassoButton;et.fF.assert(function(){return null!=a},"autoZoom state should be resolved"),e&&0!==this.viewMode&&(a||et.fF.assert(function(){return _.isFinite(e.savedLatitude)&&_.isFinite(e.savedLongitude)&&_.isFinite(e.savedZoomLevel)},"valid zoom/pan values"),this.host.persistProperties({replace:[{objectName:"mapControls",selector:null,properties:a?{autoZoom:!0,showZoomButtons:i,showLassoButton:r}:{autoZoom:!1,showZoomButtons:i,centerLatitude:e.savedLatitude,centerLongitude:e.savedLongitude,zoomLevel:e.savedZoomLevel,showLassoButton:r}}]},t))},n.prototype.syncLassoButton=function(){var t=this,a=d3.select(this.root[0]).select(h.PN);if(!a.empty()){var i=[];this.lassoButtonShouldExist()&&i.push(1);var r=a.selectAll(h.Kq).data(i),o=r.enter().append("a").classed(h.mS,!0).classed(h.Gs,!0).attr("id",h.eP).attr("title",this.host.getLocalizedString(h.TM)).attr("role","button").attr("aria-label",this.host.getLocalizedString(h.TM)).on("click",function(){t.plotLassoManager.setForceLasso(!0),d3.event.stopPropagation()});o.append("div").classed(h.RR,!0).classed(h.tE,this.style.isHighContrast),o.merge(r).classed(h.tE,this.style.isHighContrast||this.data&&(0,ft.VW)(this.data.properties.mapTheme)),r.exit().remove()}},n.prototype.lassoButtonShouldExist=function(){var t,e=null===(t=this.data)||void 0===t?void 0:t.properties;return this.data&&!e.showHeatMap&&e.showLassoButton},n.MapContainer={cssClass:"mapControl",selector:".mapControl"},n.innerGeometryAlpha=.6,n.StrokeDarkenColorValue=63.75,n.ScheduleRedrawInterval=3e3,n.MapControlDisposeDelay=1e3,n.MarkerRadiusMin=2,n.MarkerRadiusDefault=6,n.MarkerRadiusMax=20,n}();function Le(n,t){return null!=n&&_.isFinite(n)&&null!=t&&_.isFinite(t)}var Zt,rt,Ut,Xt,Qe=function(){function n(t,e){this.mapControl=t,this.changedMode=e,this.InStreetsideMode=this.mapControl.getMapTypeId()===Microsoft.Maps.MapTypeId.streetside}return n.prototype.start=function(){var t=this;Microsoft.Maps.Events.addHandler(this.mapControl,"maptypechanged",function(e){return t.mapTypeChanged(e)})},n.prototype.mapTypeChanged=function(t){if(t.newMapTypeId===Microsoft.Maps.MapTypeId.streetside){if(this.InStreetsideMode)return;this.changeMode(!0)}else{if(!this.InStreetsideMode)return;this.startTransitionToRoadTimeout()}},n.prototype.cancelTransitionToRoadTimeout=function(){this.transitionToRoadTimeout&&(clearInterval(this.transitionToRoadTimeout),this.transitionToRoadTimeout=void 0)},n.prototype.startTransitionToRoadTimeout=function(){var t=this;this.transitionToRoadTimeout||(this.transitionToRoadTimeout=setInterval(function(){t.mapControl.getMapTypeId()!==Microsoft.Maps.MapTypeId.streetside?null!=t.mapControl.tryLocationToPixel(new Microsoft.Maps.Location(0,0))&&t.changeMode(!1):t.cancelTransitionToRoadTimeout()},h.h$))},n.prototype.changeMode=function(t){this.InStreetsideMode=t,this.cancelTransitionToRoadTimeout(),this.changedMode(t)},n}();function $e(){Zt&&(rt.setTimeout=Ut,rt.setInterval=Xt,rt=void 0,Zt=void 0)}function Fe(){if(void 0===Zt){Zt=!1,rt=Microsoft.Maps;var n=_.isFunction(rt&&rt.setTimeout),t=_.isFunction(rt&&rt.setInterval);if(rt&&n&&t)try{Ut=rt.setTimeout,Xt=rt.setInterval,rt.setTimeout=function(e,a){return Ut.apply(this,[function(){return se(e)},a])},rt.setInterval=function(e,a){return Xt.apply(this,[function(){return se(e)},a])},Zt=!0}catch(e){rt.setTimeout=Ut,rt.setInterval=Xt,$t.f.error("Unable to wrap Microsoft.Maps.setTimeout",!1,void 0,{error:e&&e.stack||JSON.stringify(e)})}else $t.f.error("Unable to wrap Microsoft.Maps.setTimeout",!1,void 0,{gotMapsModule:!!rt,setTimeoutIsFunction:n,setIntervalIsFunction:t})}}function se(n){try{return n.apply(null)}catch(t){$t.f.error("Exception in Microsoft.Maps timeout callback",!1,void 0,{error:t&&t.stack||JSON.stringify(t)})}}},58778:function(Jt,gt,M){M.d(gt,{B:function(){return x}});var I=M(62458),A=M(38078),w="BubblingEventListeners",St="BubblingEventManager",x=function(){function P(c){this.root=c,this.registeredBubblingEvents={},this.registeredCapturedEvents={},this.rootNode=c.node(),(0,A.aT)(this.rootNode,St,this)}return P.prototype.ensureEventRegistered=function(c,f){var E=this,B=f?this.registeredCapturedEvents:this.registeredBubblingEvents;if(!B[c]){B[c]=!0;var H=f?h:F,Q="".concat(c,".").concat(St);f&&(Q+="Capture"),this.root.on(Q,function(){H(E.root)},f)}},P.prototype.on=function(c,f,E,B){var H=function(P){var c=P.indexOf(".");return-1===c?P:P.substr(0,c)}(f);this.ensureEventRegistered(H,!!B);var Q=y(c,!0);if(Q){var tt=Q[H];tt||(Q[H]=tt={bubbling:{},captured:{}}),(B?tt.captured:tt.bubbling)[f]=E}},P}();function y(P,c){var f=(0,A.aT)(P,w);if(!f){if(!c)return;(0,A.aT)(P,w,f={})}return f}function m(P){for(var c in P){var f=P[c];f&&f()}}function S(P,c){for(var f=P.node(),E=d3.event,B=E.target;B;){var H=y(B,!1);if(H){var Q=H[E.type];Q&&c(Q)}if(B===f)break;I.fF.assert(function(){return!(0,A.aT)(B,St)},"BubblingEventManagers cannot overlap"),B=B.parentElement}}function h(P){var c=[];S(P,function(E){var B=E.captured;B&&c.push(B)});for(var f=c.length;f-- >0;)m(c[f])}function F(P){S(P,function(c){var f=c.bubbling;f&&m(f)})}},79476:function(Jt,gt,M){M.d(gt,{ao:function(){return P},fS:function(){return w},oY:function(){return F}});var I=M(19377);function w(c,f){return null!=c&&null!=f&&c.x===f.x&&c.y===f.y}function F(c,f,E){var B=(f.y-c.y)*(E.x-f.x)-(f.x-c.x)*(E.y-f.y);return 0===B?I.i.Colinear:B>0?I.i.Clockwise:I.i.Counterclockwise}function P(c,f,E){return E.x<=Math.max(c.x,f.x)&&E.x>=Math.min(c.x,f.x)&&E.y<=Math.max(c.y,f.y)&&E.y>=Math.min(c.y,f.y)}},92379:function(Jt,gt,M){M.d(gt,{m:function(){return St}});var I=M(19377),A=M(79476),w=M(80758),St=function(){function x(u){u&&(this.polygonPoints=this.convertArrayPathToPoints(u))}return x.fromPolygonPoints=function(u){var y=new x(null);return y.polygonPoints=u,y},x.prototype.absoluteCentroid=function(){return null==this._absoluteCentroid&&(this._absoluteCentroid=this.calculatePolygonCentroid()),this._absoluteCentroid},x.prototype.absoluteBoundingRect=function(){return null==this._absoluteBoundingRect&&(this._absoluteBoundingRect=this.calculateBoundingRect()),this._absoluteBoundingRect},x.prototype.contains=function(u){var m={x:u.left+u.width,y:u.top},S={x:u.left,y:u.top+u.height},h={x:u.left+u.width,y:u.top+u.height};return this.inside({x:u.left,y:u.top})&&this.inside(m)&&this.inside(S)&&this.inside(h)},x.prototype.conflicts=function(u){if(!this.isConflictWithBoundingBox(u))return!1;var m={x:u.left+u.width/2,y:u.top},S={x:u.left+u.width,y:u.top},h={x:u.left,y:u.top+u.height},F={x:u.left+u.width/2,y:u.top+u.height},P={x:u.left+u.width,y:u.top+u.height},c={x:u.left,y:u.top+u.height/2},f={x:u.left+u.width,y:u.top+u.height/2};return this.inside({x:u.left,y:u.top})||this.inside(m)||this.inside(S)||this.inside(h)||this.inside(F)||this.inside(P)||this.inside(c)||this.inside(f)},x.prototype.lineIntersectionPoint=function(u,y){for(var m=0;m<this.polygonPoints.length;m++){var F=this.getLineIntersection(u,y,this.polygonPoints[m],m===this.polygonPoints.length-1?this.polygonPoints[0]:this.polygonPoints[m+1]);if(null!==F)return F}return null},x.calculateAbsolutePolygonArea=function(u){var y,m=1,S=0;for(y=0;y<u.length;y++)S+=u[y].x*u[m].y-u[m].x*u[y].y,m=(m+1)%u.length;return.5*S},x.prototype.overlapPath=function(u){if(this.inside({x:u[0],y:u[1]}))return!0;var y=new x(u);if(y.inside(this.polygonPoints[0]))return!0;for(var m=0;m<this.polygonPoints.length;m++)if(y.lineIntersectionPoint(this.polygonPoints[m],this.polygonPoints[(m+1)%this.polygonPoints.length]))return!0;return!1},x.prototype.inside=function(u){for(var y=u.x,m=u.y,S=!1,h=0,F=this.polygonPoints.length-1;h<this.polygonPoints.length;F=h++){var P=this.polygonPoints[h].x,c=this.polygonPoints[h].y,E=this.polygonPoints[F].y;c>m!=E>m&&y<(this.polygonPoints[F].x-P)*(m-c)/(E-c)+P&&(S=!S)}return S},x.translateX=function(u,y){for(var m=new Float64Array(2*u.polygonPoints.length),S=0;S<u.polygonPoints.length;S++)m[2*S]=u.polygonPoints[S].x+y,m[2*S+1]=u.polygonPoints[S].y;return new x(m)},x.polygonBoundsOverlap=function(u,y){var m=(0,w.WN)(x.getPolyBoundLeft(u),x.getPolyBoundRight(u),x.getPolyBoundLeft(y),x.getPolyBoundRight(y)),S=(0,w.WN)(x.getPolyBoundLower(u),x.getPolyBoundUpper(u),x.getPolyBoundLower(y),x.getPolyBoundUpper(y));return m&&S},x.circleRectangleOverlap=function(u,y,m){var S=Math.max(u.left,Math.min(y.x,u.right)),h=Math.min(u.bottom,Math.max(y.y,u.top)),F=S-y.x,P=h-y.y;return F*F+P*P<=m*m},x.linesIntersect=function(u,y,m,S,h){void 0===h&&(h=!0);var F=(0,A.oY)(u,y,m),P=(0,A.oY)(u,y,S),c=(0,A.oY)(m,S,u),f=(0,A.oY)(m,S,y);return F!==P&&c!==f||!!h&&!!(F===I.i.Colinear&&(0,A.ao)(u,y,m)||P===I.i.Colinear&&(0,A.ao)(u,y,S)||c===I.i.Colinear&&(0,A.ao)(m,S,u)||f===I.i.Colinear&&(0,A.ao)(m,S,y))},x.resize=function(u,y){if(0===y)return u;for(var m=x.calculateAbsolutePolygonArea(u.polygonPoints)>0,h=_.clone(y>0&&!0===m||y<0&&!1===m?u.polygonPoints.reverse():u.polygonPoints),F=u.absoluteCentroid(),P=[],c=0;c<h.length;c++){var f=h[c],E=h[(c+1)%h.length],B=E.y-f.y,H=void 0;0!==B&&(H=-(E.x-f.x)/B);var Q=0;_.isUndefined(H)||(Q=(f.y<E.y?-1:1)*Math.sqrt(y*y/(1+H*H)));var tt=0;0===Q?tt=(f.x>E.x?-1:1)*y:_.isUndefined(H)||(tt=H*Q);var at={x:f.x+Q,y:f.y+tt},it={x:0,y:0};0===H?(it.x=at.x,it.y=at.y+10):_.isUndefined(H)||(it.x=at.x+10,it.y=at.y-10/H);var ft=(at.x-it.x)*(F.y-f.y)-(at.y-it.y)*(F.x-f.x);if(0!==ft){var st={x:((at.x*it.y-at.y*it.x)*(F.x-f.x)-(at.x-it.x)*(F.x*f.y-F.y*f.x))/ft,y:((at.x*it.y-at.y*it.x)*(F.y-f.y)-(at.y-it.y)*(F.x*f.y-F.y*f.x))/ft};isFinite(st.x)&&isFinite(st.y)&&P.push(st)}}return x.fromPolygonPoints(P)},x.getPolyBoundLeft=function(u){var y;return null===(y=_.minBy(u.polygonPoints,function(m){return m.x}))||void 0===y?void 0:y.x},x.getPolyBoundRight=function(u){var y;return null===(y=_.maxBy(u.polygonPoints,function(m){return m.x}))||void 0===y?void 0:y.x},x.getPolyBoundUpper=function(u){var y;return null===(y=_.maxBy(u.polygonPoints,function(m){return m.y}))||void 0===y?void 0:y.y},x.getPolyBoundLower=function(u){var y;return null===(y=_.minBy(u.polygonPoints,function(m){return m.y}))||void 0===y?void 0:y.y},x.prototype.isConflictWithBoundingBox=function(u){return(0,w.HL)(this.absoluteBoundingRect(),u)},x.prototype.calculatePolygonCentroid=function(){var u,y,m,S,h,F;for(u=x.calculateAbsolutePolygonArea(this.polygonPoints),m=S=0,F=1,h=0;h<this.polygonPoints.length;h++)m+=(this.polygonPoints[h].x+this.polygonPoints[F].x)*(y=this.polygonPoints[h].x*this.polygonPoints[F].y-this.polygonPoints[F].x*this.polygonPoints[h].y),S+=(this.polygonPoints[h].y+this.polygonPoints[F].y)*y,F=(F+1)%this.polygonPoints.length;return{x:m/=6*u,y:S/=6*u}},x.prototype.calculateBoundingRect=function(){for(var u=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,S=Number.NEGATIVE_INFINITY,h=0,F=this.polygonPoints;h<F.length;h++){var P=F[h];P.x<u?u=P.x:P.x>m&&(m=P.x),P.y<y?y=P.y:P.y>S&&(S=P.y)}return{left:u,top:y,width:m-u,height:S-y}},x.prototype.getLineIntersection=function(u,y,m,S){var h=u.x,F=u.y,f=m.x,E=m.y,Q=y.x-h,tt=y.y-F,at=S.x-f,it=S.y-E,ft=(-tt*(h-f)+Q*(F-E))/(-at*tt+Q*it),st=(at*(F-E)-it*(h-f))/(-at*tt+Q*it);return ft>=0&&ft<=1&&st>=0&&st<=1?{x:h+st*Q,y:F+st*tt}:null},x.prototype.convertArrayPathToPoints=function(u){for(var y=[],m=0;m<u.length;m+=2)y.push({x:u[m],y:u[m+1]});return y},x}()},19377:function(Jt,gt,M){M.d(gt,{i:function(){return I}});var I=function(A){return A[A.Clockwise=0]="Clockwise",A[A.Counterclockwise=1]="Counterclockwise",A[A.Colinear=2]="Colinear",A}({})}}]);