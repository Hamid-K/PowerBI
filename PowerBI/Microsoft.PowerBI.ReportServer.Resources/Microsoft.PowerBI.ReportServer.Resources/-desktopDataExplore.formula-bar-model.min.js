"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["formula-bar-model"],{48563:function(ut,U,n){n.d(U,{w:function(){return R}});var f=n(17819);function R(b){return b.map(function(p){return function(b){return{name:b.Name,description:b.Description,category:S(b.Category),pushableToDQ:h(b.PushableToDirectQuery),parameters:w(b.Parameters),visualCalculationsInfo:b.VisualCalculationsInfo}}(p)})}function S(b){switch(b){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9}}function h(b){var p=0;return 1===b?p=1:2===b?p=2:3===b&&(p=3),p}function w(b){return b?b.map(function(p){return function(b){return new f.Hw(b.Name,b.Optional,b.Repeatable,b.RepeatGroup,b.Skippable)}(p)}):[]}},64018:function(ut,U,n){n.d(U,{L:function(){return Zt}});var f=n(81337),R=n(15903),E=n(81892),S="padding-left",h="padding-right",w="padding-top",k="padding-bottom",b="margin-left",p="margin-right",v="margin-top",T="margin-bottom",W="border-left-width",Y="border-right-width",X="border-top-width",q="border-bottom-width";function P(r,o){return 1===o?parseInt(r.css(S),10)+parseInt(r.css(h),10):parseInt(r.css(w),10)+parseInt(r.css(k),10)}function e(r,o){return 1===o?parseInt(r.css(b),10)+parseInt(r.css(p),10):parseInt(r.css(v),10)+parseInt(r.css(T),10)}function u(r,o){return 1===o?parseInt(r.css(W),10)+parseInt(r.css(Y),10):parseInt(r.css(X),10)+parseInt(r.css(q),10)}function C(r){return parseInt(r.css("minWidth"),10)}function z(r,o,a){for(var i=e(r,a),B=$("html")[0],O=r.parent();O.length>0&&O[0]!==B&&O[0]!==o[0];)i=i+P(O,a)+u(O,a)+e(O,a),O=O.parent();return O[0]===o[0]?i=i+P(O,a)+u(O,a):0}var m=n(26124),t=n(50423),tt=n(47786),Z=n(74249),at=n(62458),ht=n(2951),nt=n(25261),mt=n(1685),Bt=n(30794),pt=n(35510),Mt=n(82762),yt=n(59017),Et=n(77526),bt=n(14172),vt=n(83317),_t=n(64647),x=n(83309),c=n(15783),s=n(65181),l=n(85270),d=n(77476),g=n(17174),N=n(59968),G=n(36858),ot=n(45916),A=n(698),j=n(35756),et=n(20551),Ot=n(64716),xt=n(85721),H=n(74913),Q=n(4715),L=n(21571),K=n(73221),it=n(4633),I=n(64560),J=n(25512),gt=n(48787),ct=n(5467),Ft=n(85102);function Nt(r,o){if(1&r){var a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",1),t.\u0275\u0275listener("click",function(B){t.\u0275\u0275restoreView(a);var O=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(O.showTemplatesMenu(B))}),t.\u0275\u0275pipe(1,"localize"),t.\u0275\u0275element(2,"tri-svg-icon",2),t.\u0275\u0275elementEnd()}2&r&&t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(1,1,"Visual_Calculation_Template_Button_Tooltip"))}var Ht=function(r){function o(a,i,B,O){var F=r.call(this)||this;return F.elementRef=a,F.pbiMenuService=i,F.localizationService=B,F.telemetryService=O,F.selectedTemplate=new t.EventEmitter,F.showButton$=new pt.X(!1),F}return(0,f.__extends)(o,r),o.prototype.ngOnInit=function(){var a=this;this.changes$("daxTemplates").pipe((0,vt.R)(this.onDestroy$)).subscribe(function(i){a.createTemplateMenu(i)})},o.prototype.showTemplatesMenu=function(a){var i=this;a.preventDefault();var B=this.templatingMenu;null!=B&&0!==B.items.length&&this.pbiMenuService.open({menu:B,origin:this.elementRef.nativeElement,flexibleConnectedPositions:[(0,J.Oq)(0,0)],closeOnButtonClick:!0,menuMode:I.Kb.Compact}).onButtonClick$.pipe((0,gt.q)(1)).subscribe(function(F){var rt=F.data;i.selectedTemplate.emit(rt),i.telemetryService.logEvent(Q.Zs,{templateName:rt.capabilities.name})})},o.prototype.createTemplateMenu=function(a){var i=this,B=_.map(a,function(O){var F=O.capabilities;return{type:I.iB.Button,id:F.name,text:(0,L.G)(F.displayName,i.localizationService),tooltip:(0,L.G)(F.description,i.localizationService),data:O}});this.templatingMenu={items:B},this.showButton$.next(B.length>0)},o.\u0275fac=function(i){return new(i||o)(t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(ct.o),t.\u0275\u0275directiveInject(s.o),t.\u0275\u0275directiveInject(it.y0))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["template-button"]],inputs:{daxTemplates:"daxTemplates"},outputs:{selectedTemplate:"selectedTemplate"},features:[t.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","templateButton","tabindex","0",3,"pbiTooltip","click",4,"ngIf"],["tabindex","0",1,"templateButton",3,"pbiTooltip","click"],["tri-svg-icon-24","","name","math_formula_20_regular","sprite","visual-calc-icons"]],template:function(i,B){1&i&&(t.\u0275\u0275template(0,Nt,3,3,"button",0),t.\u0275\u0275pipe(1,"async")),2&i&&t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(1,1,B.showButton$))},dependencies:[d.NgIf,G.V,H.M,d.AsyncPipe,Ft.F],styles:[".templateButton[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:24px;background-color:transparent}.templateButton[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2)}.templateButton[_ngcontent-%COMP%]:hover{background:var(--colorNeutralBackground1Hover)}.templateButton[_ngcontent-%COMP%]:hover   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Hover)}.templateButton[_ngcontent-%COMP%]:active   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Pressed)}"]}),o}(K.w),kt=["monacoEditorHostContainer"];function zt(r,o){if(1&r){var a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"monaco-editor-host",21),t.\u0275\u0275listener("initialized",function(){t.\u0275\u0275restoreView(a);var F=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(F.onMonacoEditorInitialized())})("tabFocusMode",function(F){t.\u0275\u0275restoreView(a);var rt=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(rt.onTabFocusModeChanged(F))})("onContentChanged",function(F){t.\u0275\u0275restoreView(a);var rt=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(rt.onContentChanged(F))})("onContentHeightChanged",function(F){t.\u0275\u0275restoreView(a);var rt=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(rt.onContentHeightChanged(F))})("onFocus",function(){t.\u0275\u0275restoreView(a);var F=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(F.onEditorFocus())}),t.\u0275\u0275elementEnd()}if(2&r){var i=o.ngIf,B=t.\u0275\u0275nextContext();t.\u0275\u0275property("selection",B.editorHost.selection)("isReadOnly",B.isReadOnly)("formulaText",B.editorHost.text)("languageOptions",i)("hidden",!B.isEditorEnabled)}}function At(r,o){if(1&r){var a=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",22),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(a);var B=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(B.toggleTabMovesFocus())}),t.\u0275\u0275pipe(1,"localize"),t.\u0275\u0275elementEnd()}2&r&&t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(1,1,"Tab_Moves_Focus_Toggle"))}function jt(r,o){if(1&r&&(t.\u0275\u0275elementStart(0,"div",23),t.\u0275\u0275element(1,"pbi-svg-use-symbol",24)(2,"tri-svg-icon",25)(3,"textarea",26),t.\u0275\u0275elementEnd()),2&r){var a=t.\u0275\u0275nextContext();t.\u0275\u0275advance(3),t.\u0275\u0275property("pbiTooltip",a.alertText)("ngModel",a.alertText),t.\u0275\u0275attribute("aria-label",a.alertText)}}function Rt(r,o){if(1&r&&(t.\u0275\u0275elementStart(0,"tri-dropdown-trigger"),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"localize"),t.\u0275\u0275pipe(3,"async"),t.\u0275\u0275elementEnd()),2&r){var a=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(2,1,t.\u0275\u0275pipeBind1(3,3,a.selectedEditModeOption$).displayName)," ")}}function Ut(r,o){if(1&r&&(t.\u0275\u0275elementStart(0,"tri-dropdown-item",27),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"localize"),t.\u0275\u0275elementEnd()),2&r){var a=o.$implicit;t.\u0275\u0275property("value",a),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(2,2,a.displayName)," ")}}var wt="monaco-editor-host",Tt=".formulaBarButtons",It=".formulaBarController",Gt=[".formulaBarEditorContainer",Tt,"ribbon [data-unique-id='clipboardGroupMlr'], ribbon [data-unique-id='clipboardGroupSlr'], .ms-Callout #FlyoutMenuId","ribbon [data-automation-type='RibbonTab'][data-unique-id='home']"],Zt=function(){function r(o,a,i,B,O,F,rt,Qt,Xt){var lt=this;this.element=o,this.highContrastCssGenerationService=a,this.formulaBarService=i,this.localizationService=B,this.screenReaderService=O,this.formulaBarInteractionService=F,this.cdr=rt,this.daxCapabilitiesService=Qt,this.formulaBarZoomService=Xt,this.catchOutsideClickEventCallBack=function(dt){return!1},this.implicitEndEditingOnBlur=!0,this.navMode="Group",this.daxTemplates=[],this.beginEdit=new t.EventEmitter,this.endEdit=new t.EventEmitter,this.templateSelected=new t.EventEmitter,this.editorHost={},this.formulaBarDropdownConfigurations=[],this.destroy$=new Bt.xQ,this._dropdownOptions$=new pt.X(void 0),this._dropdownVisible$=new pt.X(!1),this._selectedEditModeOption$=new pt.X(void 0),this.onDocumentMouseDownCapture=function(dt){lt.lastCapturedMousedownEvent=dt,Pt(dt.target)||lt.formulaBarService.hasUnsavedChanges(lt.getCurrentEditorText())&&dt.stopImmediatePropagation()},this.onDocumentClickCapture=function(dt){var Ct=lt.lastCapturedMousedownEvent&&lt.lastCapturedMousedownEvent.target;lt.lastCapturedMousedownEvent=void 0;var St=!Ct||Pt(Ct),Jt=Pt(dt.target);St||Jt||lt.catchOutsideClickEventCallBack(dt)||(lt.formulaBarService.hasUnsavedChanges(lt.getCurrentEditorText())&&(dt.stopPropagation(),dt.preventDefault()),lt.onBlur())},this.triDropdownOptions={panelClass:E.Uu},this.expandedState=1,this.languageOptions$=(0,Mt.D)(this.daxCapabilitiesService.getCapabilities())}return Object.defineProperty(r.prototype,"selectedEditModeOption$",{get:function(){return this._selectedEditModeOption$},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"editMode$",{get:function(){return this._selectedEditModeOption$.pipe((0,Et.x)(),(0,bt.U)(function(a){return a?.key}))},enumerable:!1,configurable:!0}),r.prototype.setEditMode=function(o){var a=this.formulaBarDropdownConfigurations.findIndex(function(i){return i.key===o});(0,tt.hu)(a>-1,"Invalid calculation edit mode"),this._selectedEditModeOption$.next(this.formulaBarDropdownConfigurations[a])},Object.defineProperty(r.prototype,"editModeOptions$",{get:function(){return this._dropdownOptions$.asObservable()},enumerable:!1,configurable:!0}),r.prototype.setEditModeOptions=function(o){this._dropdownOptions$.next(o),this._selectedEditModeOption$.next(void 0)},Object.defineProperty(r.prototype,"showEditModeSelector$",{get:function(){return this._dropdownVisible$.asObservable()},enumerable:!1,configurable:!0}),r.prototype.showEditModeSelector=function(o){this._dropdownVisible$.next(o)},r.prototype.ngOnInit=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var o=this;return(0,f.__generator)(this,function(a){switch(a.label){case 0:return this.initializeHighContrastRules(),this.isHidden=this.autoHide,this.setReadOnly(!0),(0,yt.aj)([this._dropdownOptions$,this._dropdownVisible$]).pipe((0,vt.R)(this.destroy$)).subscribe(function(i){var O=i[1];o.formulaBarDropdownConfigurations=i[0],o.formulaDropdownWidth=O?C($(".dropdownContainer")):0,o.recalculateOffset(),o.onResize()}),[4,this.formulaBarService.setUICulture()];case 1:return a.sent(),[2]}})})},r.prototype.ngAfterViewInit=function(){var o=this;this.formulaBarService.registerFormulaBarControl(this),this.formulaBarInteractionService.registerFormulaBarInteractionControl(this),this.resizeObserver=new ResizeObserver(function(){window.requestAnimationFrame(function(){o.onResize()})}),this.resizeObserver.observe(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass))},r.prototype.ngOnDestroy=function(){$(this.element.nativeElement).off(It),$(this.monacoEditorHostContainer.nativeElement).off(It),this.destroy$.next(),this.destroy$.complete(),this.resizeObserver&&(this.resizeObserver.unobserve(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass)),this.resizeObserver.disconnect())},r.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert, formula-bar .formulaBar .formulaBarAlert .messageAlert","{ background-color: @backgroundColor !important; color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert","{ border: 1px solid @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarEditorContainer","{ background-color: @backgroundColor !important; }")},Object.defineProperty(r.prototype,"willCollapse",{get:function(){return 0===this.nextExpandCollapseState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEditorEnabled",{get:function(){return!!this.lastCommittedFormulaText||this.isEditing},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"formulaBarExpanderTooltip",{get:function(){var a,i="Formula_Bar_ExpandToFull";switch(this.nextExpandCollapseState){case 0:i="Formula_Bar_CollapseToSingleLine";break;case 1:i="Formula_Bar_ExpandToFit";break;case 2:i=null!==(a=this.expandCollapseConfig.fullyExpandedTooltip)&&void 0!==a?a:"Formula_Bar_ExpandToFull"}return this.localizationService.get(i)},enumerable:!1,configurable:!0}),r.prototype.setReadOnly=function(o){this.isReadOnly=o},r.prototype.onMonacoEditorInitialized=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var o,a,i;return(0,f.__generator)(this,function(B){switch(B.label){case 0:return this.monacoEditorInitialized=!0,o=$(this.element.nativeElement),a=function(r){return parseInt(r.css("min-height"),10)}(o),i=function(r){return parseInt(r.css("max-height"),10)}(o),this.monacoEditorUtility=new ht.j0(this.textEditorHost.textEditor),[4,this.textEditorHost.registerActions(this.getKeyboardActions())];case 1:return B.sent(),this.textEditorHeightOffset=this.calculateTextEditorHeightOffset(),this.recalculateOffset(),this.textEditorFullExpandHeight=i-this.textEditorHeightOffset,this.textEditorCollapsedHeight=a-this.textEditorHeightOffset,this.targetEditorHeight=this.textEditorCollapsedHeight,this.onContentHeightChanged(this.textEditorHost.textEditor.getContentHeight()),this.onResize(),this.focusOnInitialized&&this.focus(),[2]}})})},r.prototype.calculateTextEditorHeightOffset=function(){var o=$(this.element.nativeElement);return z(o.find(wt),o,0)},r.prototype.onTabFocusModeChanged=function(o){this.tabMovesFocus=o},r.prototype.updateEditorExpandedHeight=function(){var o,a,i=this.alertText?20:0,B=this.expandCollapseConfig.formulaBarParentClass,O=null!==(o=this.expandCollapseConfig.expandScaleFactor)&&void 0!==o?o:1,F=null!==(a=this.expandCollapseConfig.expandOffet)&&void 0!==a?a:-80,rt=O*$(this.element.nativeElement).closest(B).height()+F;this.textEditorFullExpandHeight=rt-this.textEditorHeightOffset-i},r.prototype.updateFormulaBarMaxHeight=function(){var o=this.alertText?20:0,a=1e7;0===this.expandedState?a=this.textEditorCollapsedHeight+this.textEditorHeightOffset+o:1===this.expandedState&&(a=this.targetEditorHeight+this.textEditorHeightOffset+o),at.fF.assertValue(a,"maxHeight"),$(this.element.nativeElement).css("max-height",a)},r.prototype.show=function(){this.isHidden&&(this.isHidden=!1,this.cdr.detectChanges())},r.prototype.hide=function(){this.isHidden||(this.isHidden=!0)},r.prototype.clear=function(){this.setCommittedFormulaBarText(""),this.autoHide&&this.hide()},r.prototype.setSelection=function(o){this.editorHost.selection=o,this.cdr.detectChanges()},r.prototype.showAlertMessage=function(o){o=o.replace(/\n/g,""),this.alertText=o,this.screenReaderService.alert(this.localizationService.format("Formula_Bar_Warning_Aria",o)),this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},r.prototype.toggleTabMovesFocus=function(){this.textEditorHost.toggleTabMovesFocus(),this.textEditorHost.focus()},r.prototype.hideAlert=function(){this.alertText=void 0,this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},r.prototype.setCommittedFormulaBarText=function(o){this.lastCommittedFormulaText=o,this.editorHost.text=o,this.cdr.detectChanges()},r.prototype.focus=function(){this.monacoEditorInitialized?(this.textEditorHost.focus(),this.cdr.detectChanges()):this.focusOnInitialized=!0},r.prototype.scrollTop=function(){this.monacoEditorInitialized&&this.textEditorHost.scrollTop()},r.prototype.copy=function(){this.textEditorHost.copy()},r.prototype.cut=function(){this.textEditorHost.cut()},r.prototype.paste=function(o){this.textEditorHost.paste(o)},r.prototype.resetModelTokens=function(o){this.textEditorHost.resetModelTokens(o)},r.prototype.isFormulaBarActive=function(){return this.isActive},r.prototype.onToggleExpandCollapse=function(){this.setExpandCollapseState(this.nextExpandCollapseState)},r.prototype.setExpandCollapseState=function(o){switch(o){case 0:this.collapse();break;case 1:this.fitToContent();break;case 2:this.fullExpand()}this.calculateNextExpandCollapseState()},r.prototype.calculateNextExpandCollapseState=function(){switch(this.expandedState){case 0:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?2:1;break;case 1:this.nextExpandCollapseState=this.editorContentHeight>=this.textEditorFullExpandHeight?0:this.editorContentHeight<=this.textEditorCollapsedHeight||this.isEditing?2:0;break;case 2:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?1:0;break;default:at.fF.assertNever(this.expandedState)}},r.prototype.fullExpand=function(){this.expandedState=2,this.updateEditorExpandedHeight(),this.layout(void 0,this.textEditorFullExpandHeight)},r.prototype.fitToContent=function(){this.expandedState=1,this.updateEditorExpandedHeight(),this.targetEditorHeight=Math.max(this.textEditorCollapsedHeight,Math.min(this.textEditorFullExpandHeight,this.editorContentHeight)),this.layout(void 0,this.targetEditorHeight)},r.prototype.collapse=function(){this.expandedState=0,this.layout(void 0,this.textEditorCollapsedHeight)},r.prototype.layout=function(o,a){this.updateFormulaBarMaxHeight(),this.monacoEditorInitialized&&this.textEditorHost.layout(o,a)},r.prototype.recalculateOffset=function(){var o,a=$(Tt),i=$(this.element.nativeElement),B=i.find(wt);this.textEditorWidthOffset=z(B,i,1)+C(a)+e(a,1)+(null!==(o=this.formulaDropdownWidth)&&void 0!==o?o:0)},r.prototype.commitFormulaBarEdit=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var o;return(0,f.__generator)(this,function(a){switch(a.label){case 0:return this.endFormulaEdit(),(o=this.getCurrentEditorText())===this.lastCommittedFormulaText?[3,2]:(this.lastCommittedFormulaText=o,[4,this.formulaBarService.onSubmit(o)]);case 1:return a.sent(),[3,4];case 2:return[4,this.formulaBarService.onSubmit(o)];case 3:a.sent(),a.label=4;case 4:return[2]}})})},r.prototype.onBlur=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(o){switch(o.label){case 0:return this.implicitEndEditingOnBlur?this.endFormulaEdit():(this.removeFocus(),this.removeCatchClickOutsideFormulaBar()),this.lastCommittedFormulaText=this.monacoEditorInitialized?this.getCurrentEditorText():"",[4,this.formulaBarService.onBlur(this.lastCommittedFormulaText)];case 1:return[2,o.sent()]}})})},r.prototype.removeFocus=function(){$(document.activeElement).blur(),$(document.body).focus()},r.prototype.onContentChanged=function(o){var a=this.monacoEditorUtility.getCursorPosition();this.formulaBarService.onContentChanged(this.monacoEditorUtility.getEditorText(),a.position,a.selectionStart,o)},r.prototype.onContentHeightChanged=function(o){this.editorContentHeight=o+2,(1===this.expandedState||0===this.expandedState&&this.isEditing)&&this.fitToContent(),this.calculateNextExpandCollapseState()},r.prototype.submit=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(o){switch(o.label){case 0:return[4,this.commitFormulaBarEdit()];case 1:return o.sent(),[2]}})})},r.prototype.cancel=function(){this.endFormulaEdit(),this.formulaBarService.onCancel(this.lastCommittedFormulaText),this.autoHide&&this.hide()},r.prototype.onEditorFocus=function(){this.isEditorEnabled&&(this.isReadOnly||this.isEditing?this.implicitEndEditingOnBlur||this.catchClickOutsideFormulaBar():this.beginFormulaEdit(),this.formulaBarService.onEditorFocus())},r.prototype.catchClickOutsideFormulaBar=function(){document.body.addEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.addEventListener("click",this.onDocumentClickCapture,!0),document.body.addEventListener("contextmenu",this.onDocumentClickCapture,!0)},r.prototype.removeCatchClickOutsideFormulaBar=function(){document.body.removeEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.removeEventListener("click",this.onDocumentClickCapture,!0),document.body.removeEventListener("contextmenu",this.onDocumentClickCapture,!0)},r.prototype.endFormulaEdit=function(){this.isEditing=!1,this.removeFocus(),this.removeCatchClickOutsideFormulaBar(),this.endEdit.emit()},r.prototype.beginFormulaEdit=function(){this.isEditing=!0,this.catchClickOutsideFormulaBar(),this.beginEdit.emit()},r.prototype.onResize=function(){var o,a;if(this.monacoEditorInitialized){var i;2===this.expandedState?(this.updateEditorExpandedHeight(),i=this.textEditorFullExpandHeight):1===this.expandedState&&(this.updateEditorExpandedHeight(),i=Math.min(this.textEditorFullExpandHeight,this.targetEditorHeight));var B=this.element.nativeElement.getBoundingClientRect().width||1e3,O=null!==(a=null===(o=this.formulaBarZoomService)||void 0===o?void 0:o.getZoomLevel())&&void 0!==a?a:1;this.layout(B/O-this.textEditorWidthOffset,i)}},r.prototype.selectTemplate=function(o){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(a){switch(a.label){case 0:return[4,this.formulaBarService.onTemplateSelection(o)];case 1:return a.sent(),this.templateSelected.emit(),[2]}})})},r.prototype.insertTextAtCurrentCursor=function(o){this.textEditorHost.insertTextAtCurrentCursor(o)},r.prototype.getCurrentEditorText=function(){return this.textEditorHost.getText()},r.prototype.getHighlightedText=function(){return this.textEditorHost.getHighlightedText()},r.prototype.getKeyboardActions=function(){var o=this;return[{id:"formulaBar.find",label:"Find",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.CtrlF]],run:_.noop},{id:"formulaBar.findNext",label:"Find next",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.F3]],run:_.noop},{id:"formulaBar.findPrevious",label:"Find previous",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.CtrlF3]],run:_.noop},{id:"formulaBar.replace",label:"Replace",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.CtrlH]],run:_.noop},{id:"formulaBar.errorNavigator",label:"Error navigator",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.F8]],run:_.noop},{id:"formulaBar.escape",label:"Escape",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.Escape]],run:function(){var i=o.textEditorHost.textEditor.getSelections();i.length<=1?o.cancel():o.textEditorHost.textEditor.setSelection(i[0])},keybindingContext:"!".concat(ht.B6,"&&!").concat(ht.HW,"&&!").concat(ht.s1)},{id:"formulaBar.submit",label:"Submit",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.CtrlEnter]],run:function(){o.submit()}},{id:"formulaBar.enter",label:"Enter",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.Enter]],run:function(){o.submit()},keybindingContext:"!".concat(ht.HW)},{id:"formulaBar.toggleExpandCollapse",label:"Toggle expand collapse",keybindings:[this.textEditorHost.monacoKeybindingsMap[nt.f.CtrlJ]],run:function(){o.onToggleExpandCollapse()}}]},r.\u0275fac=function(a){return new(a||r)(t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(_t.g),t.\u0275\u0275directiveInject(c.B),t.\u0275\u0275directiveInject(s.o),t.\u0275\u0275directiveInject(x.g),t.\u0275\u0275directiveInject(l.l),t.\u0275\u0275directiveInject(t.ChangeDetectorRef),t.\u0275\u0275directiveInject(Z.r),t.\u0275\u0275directiveInject(R.$d,8))},r.\u0275cmp=t.\u0275\u0275defineComponent({type:r,selectors:[["formula-bar"]],viewQuery:function(a,i){if(1&a&&(t.\u0275\u0275viewQuery(kt,7,t.ElementRef),t.\u0275\u0275viewQuery(mt.C,5)),2&a){var B=void 0;t.\u0275\u0275queryRefresh(B=t.\u0275\u0275loadQuery())&&(i.monacoEditorHostContainer=B.first),t.\u0275\u0275queryRefresh(B=t.\u0275\u0275loadQuery())&&(i.textEditorHost=B.first)}},hostVars:1,hostBindings:function(a,i){1&a&&t.\u0275\u0275listener("desktopUIResizeFormulaBar",function(){return i.onResize()}),2&a&&t.\u0275\u0275hostProperty("hidden",i.isHidden)},inputs:{autoHide:"autoHide",isActive:"isActive",catchOutsideClickEventCallBack:"catchOutsideClickEventCallBack",expandCollapseConfig:"expandCollapseConfig",implicitEndEditingOnBlur:"implicitEndEditingOnBlur",navMode:"navMode",shouldAlwaysEnableCancelButton:"shouldAlwaysEnableCancelButton",daxTemplates:"daxTemplates"},outputs:{beginEdit:"beginEdit",endEdit:"endEdit",templateSelected:"templateSelected"},decls:29,vars:42,consts:[["keyboard-shortcuts","ctrl-F6","focus-priority","11",1,"formulaBar",3,"hidden","on-resize"],[1,"formulaBarEditorContainer"],[1,"formulaBarEditor"],["tabindex","0",1,"formulaBarEditorMain",3,"keydown.enter"],["monacoEditorHostContainer",""],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus",4,"ngIf"],["data-unique-id","formula-bar-chevron",1,"formulaBarExpander",3,"disabled","pbiTooltip","click"],["tri-svg-icon-16","","name","chevron_down_16_regular"],[1,"accessibililtyMessages"],["class","message","localize","Tab_Moves_Focus",3,"pbiTooltip","click",4,"ngIf"],["class","formulaBarAlert",4,"ngIf"],[1,"formulaBarDropdown"],[1,"dropdownContainer",3,"compact","options","isDisabled","value","valueChange"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"formulaBarButtons"],["data-unique-id","formula-bar-cancel",1,"formulaBarCancel",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","dismiss_20_regular"],["data-unique-id","formula-bar-commit",1,"formulaBarCommit",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","checkmark_20_regular"],["data-unique-id","formula-bar-template-button",3,"daxTemplates","selectedTemplate"],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus"],["localize","Tab_Moves_Focus",1,"message",3,"pbiTooltip","click"],[1,"formulaBarAlert"],["symbolId","alert","sheet","filterPaneIcons",1,"imageAlert"],["tri-svg-icon-16","","name","dismiss_circle_16_filled"],["data-unique-id","formula-bar-alert","row","1","cols","1","readonly","","pbiTooltipPosition","below",1,"messageAlert",3,"pbiTooltip","ngModel"],[3,"value"]],template:function(a,i){1&a&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275listener("on-resize",function(){return i.onResize()}),t.\u0275\u0275pipe(1,"localize"),t.\u0275\u0275elementStart(2,"div",1)(3,"div",2)(4,"div",3,4),t.\u0275\u0275listener("keydown.enter",function(){return i.focus()}),t.\u0275\u0275template(6,zt,1,5,"monaco-editor-host",5),t.\u0275\u0275pipe(7,"async"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(8,"button",6),t.\u0275\u0275listener("click",function(){return i.onToggleExpandCollapse()}),t.\u0275\u0275element(9,"tri-svg-icon",7),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(10,"div",8),t.\u0275\u0275template(11,At,2,3,"button",9),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(12,jt,4,3,"div",10),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(13,"div",11),t.\u0275\u0275pipe(14,"async"),t.\u0275\u0275elementStart(15,"tri-dropdown",12),t.\u0275\u0275listener("valueChange",function(O){return i.setEditMode(O.key)}),t.\u0275\u0275pipe(16,"async"),t.\u0275\u0275template(17,Rt,4,5,"tri-dropdown-trigger",13),t.\u0275\u0275pipe(18,"async"),t.\u0275\u0275template(19,Ut,3,4,"tri-dropdown-item",14),t.\u0275\u0275pipe(20,"async"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(21,"div",15)(22,"button",16),t.\u0275\u0275listener("click",function(){return i.cancel()}),t.\u0275\u0275pipe(23,"localize"),t.\u0275\u0275element(24,"tri-svg-icon",17),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(25,"button",18),t.\u0275\u0275listener("click",function(){return i.submit()}),t.\u0275\u0275pipe(26,"localize"),t.\u0275\u0275element(27,"tri-svg-icon",19),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(28,"template-button",20),t.\u0275\u0275listener("selectedTemplate",function(O){return i.selectTemplate(O)}),t.\u0275\u0275elementEnd()()()),2&a&&(t.\u0275\u0275classProp("readonly",i.isReadOnly),t.\u0275\u0275property("hidden",i.isHidden||!i.monacoEditorInitialized),t.\u0275\u0275attribute("focus-nav-mode",i.navMode)("aria-label",t.\u0275\u0275pipeBind1(1,26,"Formula_Bar")),t.\u0275\u0275advance(2),t.\u0275\u0275classProp("hasAlert",i.alertText),t.\u0275\u0275advance(4),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(7,28,i.languageOptions$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("disabled",!i.monacoEditorInitialized||!i.isEditorEnabled)("pbiTooltip",i.formulaBarExpanderTooltip),t.\u0275\u0275advance(1),t.\u0275\u0275property("@chevron",i.nextExpandCollapseState),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",i.tabMovesFocus&&!i.isReadOnly&&i.isEditorEnabled),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!!i.alertText),t.\u0275\u0275advance(1),t.\u0275\u0275classProp("hideFormulaBarDropdown",!t.\u0275\u0275pipeBind1(14,30,i.showEditModeSelector$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("compact",!0)("options",i.triDropdownOptions)("isDisabled",i.isReadOnly)("value",t.\u0275\u0275pipeBind1(16,32,i.selectedEditModeOption$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(18,34,i.selectedEditModeOption$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngForOf",t.\u0275\u0275pipeBind1(20,36,i.editModeOptions$)),t.\u0275\u0275advance(3),t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(23,38,"Cancel_ButtonText"))("disabled",i.shouldAlwaysEnableCancelButton?!i.monacoEditorInitialized:!i.isEditing||!i.monacoEditorInitialized),t.\u0275\u0275advance(3),t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(26,40,"Commit_ButtonText"))("disabled",!i.isEditing||!i.monacoEditorInitialized),t.\u0275\u0275advance(3),t.\u0275\u0275property("daxTemplates",i.daxTemplates))},dependencies:[d.NgForOf,d.NgIf,g.Fj,g.JJ,g.On,N.X,mt.C,G.V,ot.R,A.O,j.q,et.M3,Ot.l,xt.q,et.ii,H.M,Ht,d.AsyncPipe,Ft.F],styles:['[_nghost-%COMP%]{--read-only-button-foreground: var(--fluent-theme-neutral-secondary-alt-color);--read-only-background: var(--fluent-theme-neutral-tertiary-color);--read-only-border-color: var(--fluent-theme-neutral-tertiary-color);--button-background: transparent;--button-foreground: var(--gray-180);--editor-container-border-color: var(--fluent-theme-neutral-tertia-color);--editor-container-background: var(--fluent-theme-white-color);--expander-foreground-hover: var(--fluent-theme-black-color);--accessibility-message-background: var(--fluent-theme-neutral-primary-color);--accessibility-message-foreground: var(--fluent-theme-white-color);--accessibility-message-background-focus: var(--fluent-theme-neutral-tertiary-alt-color);--alert-foreground: var(--fluent-theme-black-color);--alert-background: var(--fluent-theme-warning-background-color);--alert-border: none;--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--fluent-theme-neutral-tertiary-alt-color);--submit-cancel-buttons-background: var(--fluent-theme-white-color);--cancel-button-foreground: var(--fluent-theme-error-dark-color);--commit-button-foreground: var(--fluent-theme-success-icon-color);--gray-host-background: var(--gray-20);--gray-border-color: var(--gray-60);--gray-read-only-background: var(--gray-20);--gray-read-only-border: var(--gray-40);position:relative;padding:4px;min-height:36px;max-height:36px;width:100%;box-sizing:border-box;display:flex;flex-direction:column}[data-legacy-theming=false]   [_nghost-%COMP%]{--read-only-button-foreground: var(--colorNeutralForegroundDisabled);--read-only-background: var(--colorNeutralBackgroundDisabled);--read-only-border-color: var(--colorNeutralStrokeDisabled);--button-background: transparent;--button-foreground: var(--colorNeutralForeground1);--editor-container-border-color: var(--colorNeutralStroke1);--editor-container-background: var(--colorNeutralBackground1);--expander-foreground-hover: var(--colorNeutralStrokeFocus2);--accessibility-message-background: var(--colorCompoundBrandBackground);--accessibility-message-foreground: var(--colorNeutralForegroundOnBrand);--accessibility-message-background-focus: var(--colorCompoundBrandBackgroundHover);--alert-foreground: var(--colorNeutralForeground1);--alert-background: var(--colorDangerBackground1);--alert-border: 1px solid var(--colorDangerBorder1);--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--colorNeutralStroke1);--submit-cancel-buttons-background: var(--colorNeutralBackground1);--cancel-button-foreground: var(--colorDangerForeground1);--commit-button-foreground: var(--colorSuccessForeground1);--gray-host-background: var(--colorNeutralBackground3);--gray-border-color: var(--colorNeutralStroke2);--gray-read-only-background: var(--colorNeutralBackground3);--gray-read-only-border: var(--colorNeutralStrokeDisabled)}[hidden][_nghost-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]{flex-grow:1;cursor:default;box-sizing:border-box;display:flex}[_nghost-%COMP%]   .formulaBar[hidden][_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--read-only-button-foreground)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-color:var(--read-only-border-color);background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]{background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--button-background);color:var(--button-foreground)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:currentcolor}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   [disabled][_ngcontent-%COMP%]{opacity:.4}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{order:1;flex-grow:1;height:100%;display:flex;flex-direction:column;margin-left:3px;min-height:28px;box-sizing:border-box;border:1px solid var(--editor-container-border-color);background-color:var(--editor-container-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer.hasAlert[_ngcontent-%COMP%]{min-height:48px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;padding-top:2px;padding-right:21px;display:flex;flex-direction:column;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;background-color:transparent;-webkit-user-select:none}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;width:16px;height:16px;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus:not(:disabled){color:var(--expander-foreground-hover)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-left:2px;padding:2px;background-color:var(--accessibility-message-background);color:var(--accessibility-message-foreground);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:focus{background-color:var(--accessibility-message-background-focus)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]{width:100%;height:20px;box-sizing:border-box;color:var(--alert-foreground);background-color:var(--alert-background);outline:var(--alert-border);display:flex;padding-left:2px;align-items:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--alert-icon)}[data-legacy-theming=true]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{width:16px;height:16px}[data-legacy-theming=false]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .messageAlert[_ngcontent-%COMP%]{cursor:default;flex-grow:1;height:100%;box-sizing:border-box;border:none;padding-top:2px;padding-left:4px;background-color:var(--alert-background);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:11px;resize:none;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]{margin-right:3px;font-size:14px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown.hideFormulaBarDropdown[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]{min-width:100px;height:28px;box-sizing:border-box}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]     button{min-width:inherit;height:inherit}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]{min-width:76px;flex:0;height:28px;box-sizing:border-box;border:1px solid var(--submit-cancel-buttons-border);display:flex;align-items:center;justify-content:space-evenly;background-color:var(--submit-cancel-buttons-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-content:center;justify-content:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--colorNeutralForegroundDisabled)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus:not(:disabled){background:var(--colorNeutralBackground1Hover)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--cancel-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--commit-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:none}.gray-theme   [_nghost-%COMP%]{background-color:var(--gray-host-background)}.gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-radius:2px;border-color:var(--gray-border-color)}.gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{background-color:var(--gray-read-only-background);border-color:var(--gray-read-only-border)}@media print{formula-bar[_ngcontent-%COMP%]   .formulaBar[_ngcontent-%COMP%]{display:none}}'],data:{animation:[(0,m.X$)("chevron",[(0,m.SB)("".concat(0),(0,m.oB)({transform:"rotate(180deg)"})),(0,m.SB)("".concat(2),(0,m.oB)({transform:"rotate(0deg)"})),(0,m.SB)("".concat(1),(0,m.oB)({transform:"rotate(0deg)"})),(0,m.eR)("".concat(1," => ").concat(2,", ").concat(2," => ").concat(1),[(0,m.jt)(150,(0,m.F4)([(0,m.oB)({transform:"rotate(0deg)",offset:0}),(0,m.oB)({transform:"rotate(45deg)",offset:.5}),(0,m.oB)({transform:"rotate(0deg)",offset:1})]))]),(0,m.eR)("* => ".concat(0),[(0,m.jt)(150,(0,m.F4)([(0,m.oB)({transform:"rotate(0deg)",offset:0}),(0,m.oB)({transform:"rotate(180deg)",offset:1})]))]),(0,m.eR)("".concat(0," => *"),[(0,m.jt)(150,(0,m.F4)([(0,m.oB)({transform:"rotate(180deg)",offset:0}),(0,m.oB)({transform:"rotate(0deg)",offset:1})]))])])]}}),r}();function Pt(r){return _.some(Gt,function(o){var a=$(r),i=$(o);return i.is(a)||!!i.find(a).length})}},97415:function(ut,U,n){n.r(U),n.d(U,{FormulaBarModelModule:function(){return _t}});var f=n(17848),R=n(15783),E=n(34103),S=n(72080),h=n(81337),w=n(15903),k=n(98361),b=n(4715),p=n(70863),v=function(){function x(){}return x.areSameItem=function(c,s){return _.isNil(c)&&_.isNil(s)||!!(c&&s&&c.urn===s.urn&&p.pb(c.schemaName,s.schemaName))},x.getEntityName=function(c){return p.wb(c)?c.name:p.t3(c)||p.kb(c)?c.table.name:p.RF(c)?c.calculationGroup.table.name:void 0},x.getPropertyName=function(c){return p.wb(c)?void 0:c.name},x.getEditableSchemaItem=function(c,s){if(s){if(p.wb(c))return this.getTableCalculationItem(s,c.name);if(p.kb(c))return this.getMeasureCalculationItem(s,c.schemaName,c.table.name,c.name);if(p.t3(c))return this.getColumnCalculationItem(s,c.schemaName,c.table.name,c.name);if(p.ez(c)){var l=p.xu(s,c.schemaName,c.hierarchy.table.name,c.hierarchy.name,c.name),d=l&&l.column;return d&&this.getColumnCalculationItem(s,d.schemaName,d.table.name,d.name)}if(p.RF(c))return this.getCalculationItem(s,c.schemaName,c.calculationGroup.table.name,c.name)}},x.getTableCalculationItem=function(c,s){var l=p.AG(c,s);return l&&l.canEdit&&l.isCalculatedTable?l:void 0},x.getColumnCalculationItem=function(c,s,l,d){var g=p.Gz(c,s,l,d);if(g){if(g.canEdit&&g.isCalculated&&!g.isGrouping)return g;if(g.table.canEdit&&g.table.isCalculatedTable)return g.table}},x.getMeasureCalculationItem=function(c,s,l,d){var g=p.yo(c,s,l,d);return g&&g.canEditExpression?g:void 0},x.getCalculationItem=function(c,s,l,d){return p.om(c,s,l,d)},x}(),T=n(81892),W=n(68082),Y=n(53439),X=n(16601),q=n(73027),V=n(62458),st=n(9738),ft=n(34145),P=n(95867),e=n(4633),u=n(30794),C=n(63057),y=n(14172),M=n(83317),D=n(24874),z=n(59822),m=n(50423),t=n(65181),tt=n(10233),Z=n(33565),at=n(9380),ht=function(x){function c(s,l,d,g,N,G,ot,A,j,et,Ot,xt){var H=x.call(this,d,ot,A)||this;return H.modelingSelectionService=s,H.modelService=l,H.dataModelService=g,H.modelAuthoring=N,H.standardizedEventsService=G,H.calculationService=j,H.telemetryService=et,H.deleteModelingService=Ot,H.featureSwitchService=xt,H.destroy$=new u.xQ,H.isNewCalcItem=!1,H.onModelOrSelectionChanged=function(Q){var L=Q[0],K=Q[1],it=Q[2];return(0,h.__awaiter)(H,void 0,void 0,function(){var I;return(0,h.__generator)(this,function(J){switch(J.label){case 0:return L?[4,this.onModelChanged(L)]:[3,2];case 1:return J.sent(),[3,6];case 2:return it?[4,this.onCalculationEditModeChanged(it)]:[3,4];case 3:return J.sent(),[3,6];case 4:return K?(I=_.isEmpty(K)||1!==K.length?void 0:K[0],v.areSameItem(this.calculation,I)?[3,6]:[4,this.onActiveItemChanged(I)]):[3,6];case 5:J.sent(),J.label=6;case 6:return[2]}})})},H.onActiveItemChanged=function(Q){return(0,h.__awaiter)(H,void 0,void 0,function(){var L,it;return(0,h.__generator)(this,function(I){switch(I.label){case 0:if(!this.formulaBarControl||!this.formulaBarControl.isFormulaBarActive())return[2,this.updateDynamicallyFormattedMeasureStatus()];if(!Q)return[3,14];L=v.getEditableSchemaItem(Q,this.modelService.model),I.label=1;case 1:return I.trys.push([1,12,,13]),L?(L.calculationEditMode=1,[4,this.showCalculation(L)]):[3,9];case 2:switch(I.sent(),L.modelObjectType){case"Measure":return[3,3];case"CalculationItem":return[3,5]}return[3,7];case 3:return this.formulaBarControl.setEditModeOptions(T.ZI),this.formulaBarControl.setEditMode(1),[4,this.updateDynamicallyFormattedMeasureStatus()];case 4:return I.sent(),[3,8];case 5:return this.formulaBarControl.setEditModeOptions(T.dO),this.formulaBarControl.setEditMode(1),[4,this.updateDynamicallyFormattedCalculationItemStatus()];case 6:return I.sent(),[3,8];case 7:this.formulaBarControl.showEditModeSelector(!1),this.formulaBarControl.setEditModeOptions([]),I.label=8;case 8:return[3,11];case 9:return[4,this.setCalculation(void 0)];case 10:I.sent(),this.formulaBarControl.setEditModeOptions([]),I.label=11;case 11:return[3,13];case 12:if((it=I.sent()).name!==nt.name)throw it;return[3,13];case 13:return[3,16];case 14:return[4,this.setCalculation(void 0)];case 15:I.sent(),I.label=16;case 16:return[2]}})})},H.onCalculationEditModeChanged=function(Q){return(0,h.__awaiter)(H,void 0,void 0,function(){return(0,h.__generator)(this,function(L){switch(L.label){case 0:return this.calculation&&Q&&Q!==this.calculation.calculationEditMode?[4,this.updateCalculationEditMode(Q)]:[2];case 1:return L.sent(),this.formulaBarControl.focus(),[2]}})})},H.onModelChanged=function(Q){return(0,h.__awaiter)(H,void 0,void 0,function(){var L,K,it,I;return(0,h.__generator)(this,function(J){switch(J.label){case 0:return this.isNewCalcItem=!!_.find(Q.appliedChanges,"newCalculationItem"),this.calculation?(this.tryToUpdateCalculation(K=Q.appliedChanges,L=Q.model),it=v.getEditableSchemaItem(this.calculation,L),v.areSameItem(this.calculation,it)?[4,this.getCalculationInfo(this.calculation)]:[2,this.setCalculation(void 0)]):[2];case 1:return(I=J.sent())?(this.calculation.isNew=I.isNew,[4,this.updateContents(I.formulaText,I.alertMessage)]):[2,this.setCalculation(void 0)];case 2:return J.sent(),this.formulaBarControl.resetModelTokens(I.formulaText),this.getMeasureSelection()?[4,this.updateDynamicallyFormattedMeasureStatus()]:[3,4];case 3:J.sent(),K?.find(function(gt){var ct;return"Dynamic"===(null===(ct=gt.setFormatting)||void 0===ct?void 0:ct.format)})&&(this.formulaBarControl.setEditMode(2),this.formulaBarControl.focus()),J.label=4;case 4:return this.getCalculationItemSelection()?[4,this.updateDynamicallyFormattedCalculationItemStatus()]:[3,6];case 5:J.sent(),2!==this.calculation.calculationEditMode&&K?.find(function(gt){var ct;return'""'===(null===(ct=gt.setFormatString)||void 0===ct?void 0:ct.formatStringExpression)})&&(this.formulaBarControl.setEditMode(2),this.formulaBarControl.focus()),J.label=6;case 6:return[2]}})})},H.standardizedTelemetryFeatureNames=["DynamicFormatString"],H}return(0,h.__extends)(c,x),c.prototype.registerFormulaBarControl=function(s){var l=this;x.prototype.registerFormulaBarControl.call(this,s),(0,C.T)(this.modelService.modelChange$.pipe((0,y.U)(function(d){return[d,void 0,void 0]})),this.modelingSelectionService.selectionChanged.pipe((0,y.U)(function(d){return[void 0,d,void 0]})),this.formulaBarControl.editMode$.pipe((0,y.U)(function(d){return[void 0,void 0,d]}))).pipe((0,M.R)(this.destroy$),(0,D.b)(this.onModelOrSelectionChanged),(0,z.K)(function(d){return(0,h.__awaiter)(l,void 0,void 0,function(){return(0,h.__generator)(this,function(g){return[2,V.fF.assertFail(d)]})})})).subscribe(function(d){})},c.prototype.onContentChanged=function(s){},c.prototype.onTemplateSelection=function(s){},c.prototype.hasUnsavedChanges=function(s){return!!this.calculation&&(this.intellisenseService.analyzeFinalFormulaCommitInfo(s,!1,!0).doCommit||this.calculation.isNew)},c.prototype.commitOrDeletePendingCalculation=function(s){return(0,h.__awaiter)(this,void 0,void 0,function(){var l;return(0,h.__generator)(this,function(d){switch(d.label){case 0:return this.calculation?(l=this.intellisenseService.analyzeFinalFormulaCommitInfo(s,!1,!0)).doCommit?[4,this.commitCalculationUpdate(l)]:[3,2]:[3,4];case 1:case 3:return d.sent(),[2,!0];case 2:return this.calculation.isNew?[4,this.deleteCalculation()]:[3,4];case 4:return[2,!1]}})})},c.prototype.commitCalculationUpdate=function(s){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(l){switch(l.label){case 0:return V.fF.assertValue(this.calculation,"we expect this.calculation is neither undefined nor null now."),s.doCommit?(this.contentChanged=!1,2!==this.calculation.calculationEditMode?[3,2]:[4,this.updateCalculationWithFormatString(this.calculation.urn,s.newExpression,s.anonymizedExpression)]):[2];case 1:return l.sent(),[3,4];case 2:return[4,this.calculationService.updateCalculation(this.calculation.urn,s.newName,s.newExpression,s.anonymizedExpression,s.expressionOverride,s.errorMessage)];case 3:l.sent(),l.label=4;case 4:return this.telemetryService.logEvent(b.H2),[2]}})})},c.prototype.updateCalculationWithFormatString=function(s,l,d){return(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(ot){switch(ot.label){case 0:return V.fF.assertValue(l,"expression cannot be undefined or null"),[4,this.modelAuthoring.apply({changes:[{setFormatString:{formatString:void 0,modelObject:s,formatStringExpression:l||'""',anonymizedExpression:d}}]},!0)];case 1:return ot.sent(),this.standardizedEventsService?this.standardizedEventsService.logEvent(this.telemetryService.logEvent(b.gV),this.standardizedTelemetryFeatureNames,!0,{ObjectType:1}):this.telemetryService.logEvent(b.gV),[2]}})})},c.prototype.cancel=function(s){return(0,h.__awaiter)(this,void 0,void 0,function(){var l,d;return(0,h.__generator)(this,function(g){switch(g.label){case 0:return this.calculation?this.calculation.isNew?[4,this.deleteCalculation()]:[3,2]:[3,6];case 1:return g.sent(),[3,6];case 2:return l=this.calculation,[4,this.setCalculation(void 0)];case 3:return g.sent(),[4,this.getCalculationInfo(l)];case 4:return d=g.sent(),[4,this.setCalculation(l,s,d.alertMessage)];case 5:g.sent(),g.label=6;case 6:return[2]}})})},c.prototype.deleteCalculation=function(){return(0,h.__awaiter)(this,void 0,void 0,function(){var s,l,d;return(0,h.__generator)(this,function(g){switch(g.label){case 0:return V.fF.assertValue(this.calculation,"we expect this.calculation is neither undefined nor null now."),s=this.calculation,(l=this.calculation).isDeleted?[2]:(l.isDeleted=!0,(d=this.modelService.model)&&v.getEditableSchemaItem(s,d)?(this.deleteModelingService.deleteModelItem([{schema:s.schemaName,tableName:v.getEntityName(s),itemName:v.getPropertyName(s),objectType:s.modelObjectType}],!1),this.contentChanged=!1,[4,this.setCalculation(void 0)]):[3,2]);case 1:g.sent(),g.label=2;case 2:return[2]}})})},c.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},c.prototype.updateCalculationEditMode=function(s){return(0,h.__awaiter)(this,void 0,void 0,function(){var l;return(0,h.__generator)(this,function(d){switch(d.label){case 0:return V.fF.assertValue(s,"Calculation edit mode must be defined"),V.fF.assertValue(this.calculation,"we expect this.calculation not null/undefined now."),(l=_.cloneDeep(this.calculation)).calculationEditMode=s,[4,this.showCalculation(l)];case 1:return d.sent(),[2]}})})},c.prototype.showCalculation=function(s){return(0,h.__awaiter)(this,void 0,void 0,function(){var l,d;return(0,h.__generator)(this,function(g){switch(g.label){case 0:return[4,this.getCalculationInfo(s)];case 1:return(l=g.sent())?((d=_.cloneDeep(s)).isNew=l.isNew,[4,this.setCalculation(d,l.formulaText,l.alertMessage)]):[2,this.setCalculation(void 0)];case 2:return g.sent(),v.areSameItem(this.calculation,d)?(this.formulaBarControl.scrollTop(),this.formulaBarControl.show(),l&&l.isNew||this.isNewCalcItem?(this.isNewCalcItem=!1,this.formulaBarControl.setSelection({startPosition:0,length:l.formulaText.length}),[4,this.focusWhenNotBlocked()]):[3,4]):[2,Promise.reject(new nt)];case 3:g.sent(),g.label=4;case 4:return[2]}})})},c.prototype.setCalculation=function(s,l,d){var g;return void 0===l&&(l=null),void 0===d&&(d=null),(0,h.__awaiter)(this,void 0,void 0,function(){return(0,h.__generator)(this,function(N){switch(N.label){case 0:return v.areSameItem(s,this.calculation)&&s?.calculationEditMode===(null===(g=this.calculation)||void 0===g?void 0:g.calculationEditMode)?[2]:(this.calculation=s,this.calculation?this.refreshIntellisenseSession():(this.intellisenseService.endIntellisenseSession(),this.formulaBarControl.clear()),[4,this.updateReadOnlyState(!this.calculation)]);case 1:return N.sent(),[4,this.updateContents(l,d)];case 2:return N.sent(),[2]}})})},c.prototype.tryToUpdateCalculation=function(s,l){V.fF.assertValue(this.calculation,"we expect this.calculation not null/undefined now.");var d=!1;if(s){for(var g=0,N=s;g<N.length;g++){var G=N[g],ot=G.entityRename;if(ot&&p.wb(this.calculation)&&p.pb(ot.schema,this.calculation.schemaName)&&ot.before===this.calculation.name&&ot.after!==this.calculation.name){if(!(A=_.cloneDeep(p.AG(l,ot.after))))throw new mt("Cannot find object from model for calculation after rename entity");A.isNew=this.calculation.isNew,A.calculationEditMode=this.calculation.calculationEditMode,this.calculation=A,d=!0;break}var j=G.propertyRename;if(j&&!p.wb(this.calculation)&&j.objectType===this.calculation.modelObjectType&&p.pb(j.schema,this.calculation.schemaName)&&j.entity===v.getEntityName(this.calculation)&&j.before===this.calculation.name&&j.after!==this.calculation.name){var A=void 0;if("Column"===j.objectType){if(!(A=_.cloneDeep(p.Gz(l,j.schema,j.entity,j.after))))throw new mt("Cannot find object from model for calculation after rename column")}else if("Measure"===j.objectType){if(!(A=_.cloneDeep(p.yo(l,j.schema,j.entity,j.after))))throw new mt("Cannot find object from model for calculation after rename measure")}else if("CalculationItem"===j.objectType&&!(A=_.cloneDeep(p.om(l,j.schema,j.entity,j.after))))throw new mt("Cannot find object from model for calculation after rename calculation item");A.isNew=this.calculation.isNew,A.calculationEditMode=this.calculation.calculationEditMode,this.calculation=A,d=!0;break}var et=G.measureMove;if(et&&p.kb(this.calculation)&&p.pb(et.schema,this.calculation.schemaName)&&et.source===this.calculation.table.name&&et.property===this.calculation.name&&et.destination!==this.calculation.table.name){if(!(A=_.cloneDeep(p.yo(l,et.schema,et.destination,et.property))))throw new mt("Cannot find object from model for calculation after move measure");A.isNew=this.calculation.isNew,A.calculationEditMode=this.calculation.calculationEditMode,this.calculation=A,d=!0;break}}d&&this.refreshIntellisenseSession()}},c.prototype.getCalculationInfo=function(s){return(0,h.__awaiter)(this,void 0,void 0,function(){var l,d;return(0,h.__generator)(this,function(N){return l=v.getEntityName(s),d=v.getPropertyName(s),[2,this.intellisenseService.getCalculationInfo({entityName:l,propertyName:d,schemaName:s.schemaName,calculationEditMode:s.calculationEditMode})]})})},c.prototype.updateDynamicallyFormattedMeasureStatus=function(){var s,l,d;return(0,h.__awaiter)(this,void 0,void 0,function(){var g,N;return(0,h.__generator)(this,function(G){switch(G.label){case 0:return g=this.getMeasureSelection(),N="Dynamic"===(null===(s=g?.formatInformation)||void 0===s?void 0:s.format),null===(l=this.formulaBarControl)||void 0===l||l.showEditModeSelector(N&&this.featureSwitchService.featureSwitches.dynamicFormatString),this.calculation&&1!==this.calculation.calculationEditMode&&!N?g?[4,this.updateCalculationEditMode(1)]:[3,2]:[3,5];case 1:return G.sent(),[3,4];case 2:return[4,this.setCalculation(void 0)];case 3:G.sent(),G.label=4;case 4:null===(d=this.formulaBarControl)||void 0===d||d.setEditMode(1),G.label=5;case 5:return[2]}})})},c.prototype.getMeasureSelection=function(){return this.calculation?(0,P.yo)(this.dataModelService.getDataModel(),this.calculation.schemaName,v.getEntityName(this.calculation),v.getPropertyName(this.calculation)):void 0},c.prototype.updateDynamicallyFormattedCalculationItemStatus=function(){var s,l;return(0,h.__awaiter)(this,void 0,void 0,function(){var d,g;return(0,h.__generator)(this,function(N){switch(N.label){case 0:return d=this.getCalculationItemSelection(),g=!!d.formatStringDefinition,null===(s=this.formulaBarControl)||void 0===s||s.showEditModeSelector(d&&g),this.calculation&&1!==this.calculation.calculationEditMode&&!g?d?[4,this.updateCalculationEditMode(1)]:[3,2]:[3,5];case 1:return N.sent(),[3,4];case 2:return[4,this.setCalculation(void 0)];case 3:N.sent(),N.label=4;case 4:null===(l=this.formulaBarControl)||void 0===l||l.setEditMode(1),N.label=5;case 5:return[2]}})})},c.prototype.getCalculationItemSelection=function(){return this.calculation?(0,P.om)(this.dataModelService.getDataModel(),v.getEntityName(this.calculation),v.getPropertyName(this.calculation)):void 0},c.prototype.refreshIntellisenseSession=function(){this.intellisenseService.endIntellisenseSession();var s=v.getEntityName(this.calculation),l=v.getPropertyName(this.calculation);this.intellisenseService.startIntellisenseSession(s,l,this.calculation.schemaName,this.calculation.calculationEditMode)},c.\u0275fac=function(l){return new(l||c)(m.\u0275\u0275inject(st.W6),m.\u0275\u0275inject(ft.q),m.\u0275\u0275inject(q.D),m.\u0275\u0275inject(W.n),m.\u0275\u0275inject(Y.S),m.\u0275\u0275inject(X.S,8),m.\u0275\u0275inject(t.o),m.\u0275\u0275inject(S.e),m.\u0275\u0275inject(tt.H),m.\u0275\u0275inject(e.y0),m.\u0275\u0275inject(Z.c),m.\u0275\u0275inject(at.vZ))},c.\u0275prov=m.\u0275\u0275defineInjectable({token:c,factory:c.\u0275fac}),c}(k.e),nt=function(x){function c(){var s=x.call(this,"The active item was updated before the formula bar could finish initializing the editor for the previous selection")||this;return s.name="CalculationChangedDuringShowFlow",s}return(0,h.__extends)(c,x),c}(Error),mt=function(x){function c(s){var l=x.call(this,s)||this;return l.name="CalculationNotFoundError",l}return(0,h.__extends)(c,x),c}(Error),Bt={provide:w.n9,useClass:ht},pt=n(12846),Mt=n(64018),yt=function(){function x(){this.catchOutsideClickEventCallBack=function(c){return!1},this.beginEdit=new m.EventEmitter,this.endEdit=new m.EventEmitter}return x.\u0275fac=function(s){return new(s||x)},x.\u0275cmp=m.\u0275\u0275defineComponent({type:x,selectors:[["formula-bar-model"]],inputs:{isActive:"isActive",autoHide:"autoHide",catchOutsideClickEventCallBack:"catchOutsideClickEventCallBack",expandCollapseConfig:"expandCollapseConfig",shouldAlwaysEnableCancelButton:"shouldAlwaysEnableCancelButton"},outputs:{beginEdit:"beginEdit",endEdit:"endEdit"},features:[m.\u0275\u0275ProvidersFeature([R.B,S.e,E.Dz,Bt,pt.p])],decls:1,vars:4,consts:[[3,"autoHide","isActive","expandCollapseConfig","shouldAlwaysEnableCancelButton","catchOutsideClickEventCallBack","beginEdit","endEdit"]],template:function(s,l){1&s&&(m.\u0275\u0275elementStart(0,"formula-bar",0),m.\u0275\u0275listener("catchOutsideClickEventCallBack",function(){return l.catchOutsideClickEventCallBack})("beginEdit",function(){return l.beginEdit})("endEdit",function(){return l.endEdit}),m.\u0275\u0275elementEnd()),2&s&&m.\u0275\u0275property("autoHide",l.autoHide)("isActive",l.isActive)("expandCollapseConfig",l.expandCollapseConfig)("shouldAlwaysEnableCancelButton",l.shouldAlwaysEnableCancelButton)},dependencies:[Mt.L],encapsulation:2}),x}(),Et=n(81343),bt=n(82156),vt=[{componentId:Et.ro,type:yt}],_t=function(){function x(){}return x.\u0275fac=function(s){return new(s||x)},x.\u0275mod=m.\u0275\u0275defineNgModule({type:x}),x.\u0275inj=m.\u0275\u0275defineInjector({imports:[bt.N.withManifests(vt),f.p]}),x}()},12846:function(ut,U,n){n.d(U,{p:function(){return P}});var f=n(81337),R=n(15903),E=n(95867),S=n(5207);function w(e){return e.tables.filter(function(u){return u.schemaName!==S._.DataWarehouseSchema})}function k(e){return e.relationships.filter(function(u){return u.fromTable.schemaName!==S._.DataWarehouseSchema&&u.toTable.schemaName!==S._.DataWarehouseSchema})}function v(e){if(e.variations&&e.variations.length>0)return e.variations[0].relationship.toTable.name}function X(e){switch(e){case"Many":case"None":return"many";case"One":return"one"}}var q=n(68082),V=n(63708),st=n(50423),P={provide:R.Pm,useClass:function(){function e(u){this.dataModelService=u}return e.prototype.init=function(u){this.calculationObjectInfo=(0,f.__assign)({},u)},e.prototype.reset=function(){this.calculationObjectInfo=void 0},e.prototype.getDaxModeConfigInputs=function(u){var C=function(e){return{tables:w(e).map(function(u){return function(e){return{name:e.name,isUserTable:(0,E.$i)(e),description:e.description,columns:e.columns?e.columns.map(function(u){return function(e){return{name:e.name,isUserColumn:(0,E.rh)(e),description:e.description,variationTable:v(e)}}(u)}):[],measures:e.measures?e.measures.map(function(u){return function(e){return{name:e.name,description:e.description,expression:e.expression,isExternal:!!e.sourceLineageTag}}(u)}):[],calendars:e.calendars?e.calendars.map(function(u){return function(e){return{name:e.name}}(u)}):[]}}(u)}),relationships:e.relationships?k(e).map(function(u){return function(e){return{active:e.isActive,from:{table:e.fromTable.name,column:e.fromColumn?e.fromColumn.name:void 0,cardinality:X(e.fromCardinality)},to:{table:e.toTable.name,column:e.toColumn?e.toColumn.name:void 0,cardinality:X(e.toCardinality)}}}(u)}):[]}}(this.dataModelService.getDataModel()),y=this.isFunctionRestrictedMode(),M=this.getDaxCalculation(),D=this.filterWireDataSourceInfo(u);return Promise.resolve({serializableModel:C,wireDataSourceInfo:D,daxCalculation:M,isRestrictedMode:y})},e.prototype.getCalculationObject=function(){return this.calculationObjectInfo&&this.findCalculationObject({entityName:this.calculationObjectInfo.entityName,propertyName:this.calculationObjectInfo.propertyName,schemaName:this.calculationObjectInfo.schemaName,calculationEditMode:this.calculationObjectInfo.calculationEditMode})},e.prototype.findCalculationObject=function(u){var C,y=u.schemaName,M=u.entityName,D=u.propertyName,z=u.calculationEditMode;if(M){var m=(0,E.Lc)(this.dataModelService.getDataModel(),y,M,D);if(!m)return;var t=m.expression,tt=m.expressionErrorMessage;if(2===z){var Z=m.formatStringDefinition;t=null!==(C=Z?.expression)&&void 0!==C?C:"",tt=Z?.errorMessage}var at={name:m.name,expression:t,schemaName:m.schemaName,calculationType:this.getCalculationType(m),calculationSyntaxType:e.getCalculationSyntaxType(z),expressionErrorMessage:tt};return _.isEmpty(m.annotations)||(at=(0,f.__assign)((0,f.__assign)({},at),{expressionOverride:(0,E.MZ)(m),formulaOverride:(0,E.CE)(m),isNew:(0,E.e_)(m)})),at}},e.prototype.getDaxCalculation=function(){var u,C=this.calculationObjectInfo;if(C){var y=(u=this.calculationObjectInfo).schemaName,M=u.entityName,D=u.propertyName,z=(0,E.Lc)(this.dataModelService.getDataModel(),y,M,D);if(z){var m=this.getCalculationType(z),t=e.getCalculationSyntaxType(C.calculationEditMode);return{tableName:C.entityName,calculationName:C.propertyName,type:m,syntaxType:t}}}},e.prototype.isFunctionRestrictedMode=function(){if(!this.calculationObjectInfo)return!1;var C=this.calculationObjectInfo.entityName,y=(0,E.AG)(this.dataModelService.getDataModel(),C);return!!y&&y.capabilities.requirePushableToDirectQueryDax},e.prototype.getCalculationType=function(u){if(u)switch(u.objectType){case"Column":return V.eN.Column;case"Table":return V.eN.Table;case"Measure":return V.eN.Measure;case"CalculationItem":return V.eN.CalculationItem;default:return}},e.prototype.filterWireDataSourceInfo=function(u){return{functionDataFromEngine:u.functionDataFromEngine.filter(function(M){return!M.visualCalculationsInfo||0===M.visualCalculationsInfo}),reservedWords:u.reservedWords}},e.getCalculationSyntaxType=function(u){return 2===u?V.Up.Expression:V.Up.Formula},e.\u0275fac=function(C){return new(C||e)(st.\u0275\u0275inject(q.n))},e.\u0275prov=st.\u0275\u0275defineInjectable({token:e,factory:e.\u0275fac}),e}()}},15903:function(ut,U,n){n.d(U,{$d:function(){return S},Pm:function(){return R},n9:function(){return E}});var f=n(50423),R=new f.InjectionToken("IntellisenseModelService"),E=new f.InjectionToken("FormulaBarBehaviorService"),S=new f.InjectionToken("FormulaBarZoomService")},98361:function(ut,U,n){n.d(U,{e:function(){return E}});var f=n(81337),R=n(50423),E=function(){function S(h,w,k){this.uiBlockingService=h,this.localizationService=w,this.intellisenseService=k}return S.prototype.registerFormulaBarControl=function(h){this.formulaBarControl=h,h.setEditModeOptions([])},S.prototype.focusWhenNotBlocked=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(h){switch(h.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return h.sent(),this.formulaBarControl.focus(),[2]}})})},S.prototype.updateReadOnlyState=function(h){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(w){switch(w.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return w.sent(),this.formulaBarControl.setReadOnly(h),[2]}})})},S.prototype.updateContents=function(h,w){return(0,f.__awaiter)(this,void 0,void 0,function(){var k;return(0,f.__generator)(this,function(b){switch(b.label){case 0:return[4,this.intellisenseService.getDataSourceInfo()];case 1:return k=b.sent(),(_.isEmpty(k.functionDataFromEngine)||_.isEmpty(k.reservedWords))&&!w&&(w=this.localizationService.get("DaxEditor_ErrorMessageToGetIntellisense")),[4,this.updateFormulaText(h,k)];case 2:return b.sent(),this.updateAlertText(w),[2]}})})},S.prototype.updateFormulaText=function(h,w){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(k){switch(k.label){case 0:return[4,this.intellisenseService.updateDaxContext(w)];case 1:return k.sent(),this.formulaBarControl.setCommittedFormulaBarText(h||null),this.contentChanged=!1,[2]}})})},S.prototype.updateAlertText=function(h){h?this.formulaBarControl.showAlertMessage(h):this.formulaBarControl.hideAlert()},S.\u0275fac=function(w){R.\u0275\u0275invalidFactory()},S.\u0275prov=R.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac}),S}()},15783:function(ut,U,n){n.d(U,{B:function(){return b}});var f=n(81337),R=n(15903),E=n(50423),S=n(72080),h=n(83309),b=function(){function p(v,T,W,Y){this.intellisenseService=v,this.screenReaderService=T,this.zone=W,this.behaviorService=Y,this.suspendParseCount=0}return p.prototype.setUICulture=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(v){switch(v.label){case 0:return[4,this.intellisenseService.setUICulture()];case 1:return v.sent(),[2]}})})},p.prototype.ngOnDestroy=function(){this.behaviorService.ngOnDestroy()},Object.defineProperty(p.prototype,"mode",{get:function(){return"dax"},enumerable:!1,configurable:!0}),p.prototype.registerFormulaBarControl=function(v){this.formulaBarControl=v,this.behaviorService.registerFormulaBarControl(v),this.intellisenseService.onClientViewLoaded(this)},p.prototype.onContentChanged=function(v,T,W,Y){var X=this,q=this.intellisenseService.analyzeFinalFormulaCommitInfo(v,!1,!1);this.behaviorService.contentChanged||(this.behaviorService.contentChanged=q.doCommit),q.parseErrorMessages.size&&q.parseErrorMessages.forEach(function(V,st){X.screenReaderService.alertWithDebounce("dax-error"+st,V)}),this.intellisenseService.onContentChanged(v,T,W,0!==this.suspendParseCount,Y.length>1),this.behaviorService.onContentChanged(q)},p.prototype.onEditorFocus=function(){this.intellisenseService.onEditorFocus()},p.prototype.hasUnsavedChanges=function(v){return this.behaviorService.hasUnsavedChanges(v)},p.prototype.onBlur=function(v){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(T){switch(T.label){case 0:return[4,this.behaviorService.commitOrDeletePendingCalculation(v)];case 1:return[2,T.sent()]}})})},p.prototype.onSubmit=function(v){return(0,f.__awaiter)(this,void 0,void 0,function(){var T;return(0,f.__generator)(this,function(W){switch(W.label){case 0:return T=this.intellisenseService.analyzeFinalFormulaCommitInfo(v,!0,!0),[4,this.behaviorService.commitCalculationUpdate(T)];case 1:return W.sent(),[2]}})})},p.prototype.onCancel=function(v){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(T){return this.behaviorService.cancel(v),[2]})})},p.prototype.onTemplateSelection=function(v){return this.behaviorService.onTemplateSelection(v)},p.prototype.setCommittedFormulaBarText=function(v){this.formulaBarControl.setCommittedFormulaBarText(v)},p.prototype.hostServiceCalculationCommitedOrDeleted=function(){this.formulaBarControl.endFormulaEdit(),this.behaviorService.contentChanged=!1},p.\u0275fac=function(T){return new(T||p)(E.\u0275\u0275inject(S.e),E.\u0275\u0275inject(h.g),E.\u0275\u0275inject(E.NgZone),E.\u0275\u0275inject(R.n9))},p.\u0275prov=E.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac}),(0,f.__decorate)([function(p,v,T){var W=T.value;T.value=function(){for(var Y=[],X=0;X<arguments.length;X++)Y[X]=arguments[X];var q=this;this.zone.run(function(){return W.apply(q,Y)})}},(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",void 0)],p.prototype,"hostServiceCalculationCommitedOrDeleted",null),p}()},72080:function(ut,U,n){n.d(U,{e:function(){return V}});var f=n(81337),R=n(15903),E=n(17819),S=n(63513),h=n(48563),w=n(74249),k=n(26112),b=n(62458),p=n(59694),v=n(63708),T=n(49088),W=n(50423),Y=n(65181),X=n(34103),q=[" ","\t"],V=function(){function P(e,u,C,y){this.localizationService=e,this.intellisenseHostService=u,this.intellisenseModelService=C,this.daxCapabilitiesService=y}return P.prototype.onClientViewLoaded=function(e){this.intellisenseHostService.onClientViewLoaded(e)},P.prototype.onContentChanged=function(e,u,C,y,M){this.intellisenseHostService.onContentChanged(e,u,C,y,M)},P.prototype.setUICulture=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var e,u;return(0,f.__generator)(this,function(C){switch(C.label){case 0:return[4,this.intellisenseHostService.getCultureInfo()];case 1:return e=C.sent(),u=(0,k.K)(e),(0,E.g5)({listSeparator:u.listSeparator,numberDecimalSeparator:u.decimalSeparator}),[2]}})})},P.prototype.onEditorFocus=function(){this.intellisenseHostService.onEditorFocus()},P.prototype.endIntellisenseSession=function(){this.intellisenseModelService.reset(),this.intellisenseHostService.endIntellisenseSession()},P.prototype.startIntellisenseSession=function(e,u,C,y){this.intellisenseModelService.init({entityName:e,propertyName:u,schemaName:C,calculationEditMode:y}),this.intellisenseHostService.startIntellisenseSession(e,u,C,y)},P.prototype.getCalculationInfo=function(e){return(0,f.__awaiter)(this,void 0,void 0,function(){var u;return(0,f.__generator)(this,function(C){return(u=this.intellisenseModelService.findCalculationObject(e))&&null!=u.expression?[2,Promise.resolve({isNew:u.isNew,alertMessage:u.expressionErrorMessage?u.expressionErrorMessage:void 0,formulaText:this.getCalculationExpression(u)})]:(b.fF.assertFail((0,p.W)("Cannot find editable Calculation: schema:{0} entity:{1} property:{2}",e?.schemaName,e?.entityName,e?.propertyName)),[2,Promise.resolve(void 0)])})})},P.prototype.getCalculationExpression=function(e){if(e.formulaOverride)return e.formulaOverride.formula;var u=E.w_.convertToUI(e.expression);return e.calculationSyntaxType===v.Up.Expression?u:(0,E.Mk)(e.name,u)},P.prototype.updateFormulaContextAsync=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var e;return(0,f.__generator)(this,function(u){switch(u.label){case 0:return[4,this.getDataSourceInfo()];case 1:return e=u.sent(),[4,this.updateDaxContext(e)];case 2:return u.sent(),[2]}})})},P.prototype.updateDaxContext=function(e){return(0,f.__awaiter)(this,void 0,void 0,function(){var z;return(0,f.__generator)(this,function(m){switch(m.label){case 0:return[4,this.intellisenseModelService.getDaxModeConfigInputs(e)];case 1:return z=m.sent(),T._.configureModel(z.serializableModel,z.wireDataSourceInfo,z.daxCalculation,z.isRestrictedMode,z.axes),[2]}})})},P.prototype.getDataSourceInfo=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var e,C,M;return(0,f.__generator)(this,function(D){switch(D.label){case 0:return[4,Promise.all([this.daxCapabilitiesService.getReservedWords(),this.daxCapabilitiesService.getCapabilities()])];case 1:return M=D.sent(),e=M[0],C=(0,h.w)(M[1].Functions),[2,{reservedWords:e,functionDataFromEngine:C}]}})})},P.prototype.analyzeFinalFormulaCommitInfo=function(e,u,C){var y=this.intellisenseModelService.getCalculationObject(),M={name:void 0,expression:void 0,invalidFormula:void 0,anonymizedExpression:void 0,parseResult:void 0},D=function(P,e,u,C){if(!C)return e.name=void 0,e.expression=void 0,e.invalidFormula=void 0,e.anonymizedExpression=void 0,!1;!function(P,e,u,C){var y=!1,M={name:void 0,expression:void 0};if((y=C.calculationSyntaxType===v.Up.Expression)?M.expression=S.uI.trimStart(P,q):y=(0,E.Mn)(P,M,C.calculationType===v.eN.VisualCalculation),!y)return e.name=C.name||"",e.name&&!P?e.expression="":(e.invalidFormula=P,e.expression=C.expression||""),null;if(e.name=M.name,e.expression=M.expression,M.expression)if(u){(D=T._.getContext())||b.fF.assertFail("Context should be defined");var z=new E.w_,m=new E.ss,t={finalResult:m};z.finalParse(M.expression,D,t,E.MX.AddMissingParens|E.MX.Anonymize|E.MX.ConvertToEngine),e.expression=t.finalResult.updatedExpression,e.anonymizedExpression=t.finalResult.anonymizedExpression,e.parseResult=m}else{z=new E.w_;var D=T._.getContext(),Z={result:new E.bp};z.parse(M.expression,0,void 0,void 0,D,Z,void 0),e.expression=E.w_.convertToEngine(M.expression),e.parseResult=Z.result}}(P,e,u,C);var y,M=C.formulaOverride;return M&&(y=M.formula),C.name!==e.name||C.expression!==e.expression||y!==e.invalidFormula}(e,M,C,y);!D&&u&&y&&(D=!!y.expressionErrorMessage&&!!y.expressionOverride&&!y.formulaOverride);var t,tt,Z=new Map;if(D&&M.invalidFormula)switch(t={expression:null,formula:M.invalidFormula},y.calculationType){case v.eN.Column:tt=this.localizationService.get("ReportModelInvalidColumnNameMessage");break;case v.eN.Table:tt=this.localizationService.get("ReportModelInvalidCalculatedTableNameMessage");break;case v.eN.Measure:tt=this.localizationService.get("ReportModelInvalidMeasureNameMessage");break;case v.eN.CalculationItem:tt=this.localizationService.get("ReportModelInvalidCalcItemNameMessage");break;case v.eN.VisualCalculation:break;default:b.fF.assertFail("Unknown type "+y.calculationType)}return M.parseResult instanceof E.bp&&M.parseResult.errors.length&&M.parseResult.errors.forEach(function(at){return Z.set(at.errorCode,at.message)}),{doCommit:D,newName:M.name,newExpression:M.expression,newInvalidFormula:M.invalidFormula,anonymizedExpression:M.anonymizedExpression,expressionOverride:t,errorMessage:tt,parseErrorMessages:Z}},P.\u0275fac=function(u){return new(u||P)(W.\u0275\u0275inject(Y.o),W.\u0275\u0275inject(X.TH),W.\u0275\u0275inject(R.Pm),W.\u0275\u0275inject(w.r))},P.\u0275prov=W.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"}),P}()},4715:function(ut,U,n){n.d(U,{H2:function(){return E},Zs:function(){return k},gV:function(){return h}});var f=n(41114),R="PBI.FormulaBar.EditFormulaBarObject",E=f.cx[R]=(0,f.b1)(R),S="PBI.FormulaBar.SubmitDynamicFormatString",h=f.cx[S]=(0,f.b1)(S),w="PBI.FormulaBar.SelectTemplate",k=f.cx[w]=(0,f.b1)(w)},81892:function(ut,U,n){n.d(U,{Uu:function(){return E},ZI:function(){return f},dO:function(){return R}});var f=[{displayName:"Measure",key:1},{displayName:"Format",key:2}],R=[{displayName:"Item",key:1},{displayName:"Format",key:2}],E="formulaBarDropdownPanel"}}]);