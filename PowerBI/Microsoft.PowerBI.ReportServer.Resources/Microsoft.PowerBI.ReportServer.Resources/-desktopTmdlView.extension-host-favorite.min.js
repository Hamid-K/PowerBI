"use strict";(self.webpackChunkdesktopTmdlView=self.webpackChunkdesktopTmdlView||[]).push([["extension-host-favorite"],{51218:function(ft,H,e){e.r(H),e.d(H,{ExtensionHostFavoriteModule:function(){return tt}});var G=e(77476),m=e(60756),c=e(85732),f=e(11547),y=e(82762),N=e(11105),A=e(81905),T=e(42195),S=e(59822),l=e(14172),W=e(77526),L=e(6663),z=e(17653),D=e(48787),a=e(73471),X=e(60397),h=e(17899),j=e(43419),F=e(1662),$=(0,c.PH)("[Extension Host Item FavoriteState Change] Subscribe Item Favorite Change",(0,c.Ky)()),M=(0,c.PH)("[Extension Host Item FavoriteState Change] Unsubscribe Item Favorite Change",(0,c.Ky)()),U=e(81337),Z=e(25082),Q=e(8894),R="extensionHostItemFavoriteChange",C=(0,Q.H)({selectId:function(s){return s.subscriptionId}}),Y={itemFavoriteChangeSubscriptions:C.getInitialState()},J=(0,c.ZF)(R),k=(0,c.P1)(J,function(t){return C.getSelectors().selectAll(t.itemFavoriteChangeSubscriptions)}),w=(0,c.P1)(Z.rT,F.L1,function(t,s){var n;return t?null===(n=Object.keys(t))||void 0===n?void 0:n.map(function(v){return(0,U.__assign)((0,U.__assign)({},t[v]||{}),s[v]||{})}):[]}),I=e(50423),g=function(t){return t.unChanged="UnChanged",t.removedFromFavorites="RemovedFromFavorites",t.addedToFavorites="AddedToFavorites",t}({}),q=function(){function t(s,n,v,u){var r=this;this.actions$=s,this.messageBroker=n,this.store=v,this.httpservice=u,this.onFavoriteItemReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.favoriteItem,function(i){return r.getItemFavoriteId(i.itemObjectId).pipe((0,A.w)(function(o){return r.isFavoriteId(o)?(0,f.of)(a.Vm.favoriteItem.resolve({})):(0,y.D)(r.httpservice.addFavoriteByObjectId(F.nW.Artifact,i.itemObjectId,void 0)).pipe((0,T.zg)(function(d){return r.store.dispatch(j.nm({objectId:i.itemObjectId,favoriteId:d.id})),(0,f.of)(a.Vm.favoriteItem.resolve({}))}),(0,S.K)(function(d){return r.store.dispatch(j.V2({objectId:i.itemObjectId})),(0,f.of)(a.Vm.favoriteItem.reject({error:d}))}))}))}),this.onUnFavoriteItemReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.unFavoriteItem,function(i){return r.getItemFavoriteId(i.itemObjectId).pipe((0,A.w)(function(o){return r.isFavoriteId(o)?(0,y.D)(r.httpservice.deleteFavorite({favoriteType:F.nW.Artifact,id:o},void 0)).pipe((0,T.zg)(function(){return r.store.dispatch(j.rg({objectId:i.itemObjectId})),(0,f.of)(a.Vm.unFavoriteItem.resolve({}))}),(0,S.K)(function(d){return r.store.dispatch(j.MC({objectId:i.itemObjectId,favoriteId:o,error:d})),(0,f.of)(a.Vm.unFavoriteItem.reject({error:d}))})):(0,f.of)(a.Vm.unFavoriteItem.resolve({}))}))}),this.onGetFavoriteStateReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.getItemFavoriteState,function(i){return r.getItemFavoriteId(i.itemObjectId).pipe((0,l.U)(function(o){var d=r.isFavoriteId(o);return a.Vm.getItemFavoriteState.resolve({favorited:d})}),(0,S.K)(function(o){return(0,f.of)(a.Vm.getItemFavoriteState.reject({error:o}))}))}),this.pushItemChange$=(0,m.GW)(function(){return r.store.select(w).pipe((0,W.x)(),(0,L.G)(),(0,m.IC)(function(){return r.store.select(k)}),(0,l.U)(function(i){for(var o=i[0],d=o[0],b=o[1],P=[],it=function(st,at,vt){var V=[];d&&b&&b.forEach(function(p){if(p.objectId===vt){var x=d.find(function(ct){return ct.objectId===p.objectId});if(void 0!==x&&r.isFavoriteStateChanged(x.favoriteId,p.favoriteId)!==g.unChanged){var dt=r.isFavoriteStateChanged(x.favoriteId,p.favoriteId)===g.addedToFavorites;V.push({itemObjectId:p.objectId,favorited:dt})}}}),V.length>0&&P.push(a.Vm.onItemFavoriteStateChange({subscriptionId:st,changes:V})(at))},E=0,K=i[1];E<K.length;E++){var O=K[E];it(O.subscriptionId,O.iframeId,O.itemObjectId)}return P}),(0,z.b)(function(i){i.forEach(function(o){r.messageBroker.send(o)})}))},{dispatch:!1}),this.onSubscribeItemFavoriteChangeReceived$=(0,h.Av)(this.actions$,this.messageBroker,a.Vm.subscribeItemFavoriteStateChange,function(i){var o=i.iframeId,d=i.itemObjectId,b=(0,N.Z)();return r.store.dispatch($({subscriptionId:b,iframeId:o,itemObjectId:d})),a.Vm.subscribeItemFavoriteStateChange.resolve({subscriptionId:b})}),this.onUnsubscribeItemChangeReceived$=(0,m.GW)(function(){return r.actions$.pipe((0,h.pR)(a.Vm.unSubscribeItemFavoriteStateChange),(0,l.U)(function(i){return M({subscriptionId:i.subscriptionId})}))})}return t.prototype.getItemFavoriteId=function(s){return this.store.select(F.L1).pipe((0,D.q)(1),(0,l.U)(function(n){var v,u=null===(v=n[s])||void 0===v?void 0:v.favoriteId;return void 0===u?-1:u}))},t.prototype.isFavoriteStateChanged=function(s,n){return!this.isFavoriteId(s)&&this.isFavoriteId(n)?g.addedToFavorites:this.isFavoriteId(s)&&!this.isFavoriteId(n)?g.removedFromFavorites:g.unChanged},t.prototype.isFavoriteId=function(s){return void 0!==s&&-1!==s},t.\u0275fac=function(n){return new(n||t)(I.\u0275\u0275inject(m.eX),I.\u0275\u0275inject(X.u),I.\u0275\u0275inject(c.yh),I.\u0275\u0275inject(F.HP))},t.\u0275prov=I.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),B=e(36012);function _(t,s){return(0,c.Lq)(Y,(0,B.P)($,function(n,v){n.itemFavoriteChangeSubscriptions=C.upsertOne({subscriptionId:v.subscriptionId,iframeId:v.iframeId,itemObjectId:v.itemObjectId},n.itemFavoriteChangeSubscriptions)}),(0,B.P)(M,function(n,v){n.itemFavoriteChangeSubscriptions=C.removeOne(v.subscriptionId,n.itemFavoriteChangeSubscriptions)}))(t,s)}var tt=function(){function t(){}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=I.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=I.\u0275\u0275defineInjector({imports:[G.CommonModule,c.Aw.forFeature(R,_),m.sQ.forFeature([q])]}),t}()}}]);