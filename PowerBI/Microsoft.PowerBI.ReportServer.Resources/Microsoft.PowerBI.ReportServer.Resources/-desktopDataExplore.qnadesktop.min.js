"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["qnadesktop"],{70940:function(X,O,u){u.d(O,{s:function(){return A}});var c=u(47508),F=u(45034),m=new F.o(function(){var a={};return a[3]=c.L.card,a[13]=c.L.lineClusteredColumnComboChart,a[29]=c.L.multiRowCard,a[7]=c.L.clusteredBarChart,a[10]=c.L.clusteredColumnChart,a[20]=c.L.donutChart,a[16]=c.L.funnel,a[30]=c.L.gauge,a[22]=c.L.heatMap,a[9]=c.L.hundredPercentStackedBarChart,a[12]=c.L.hundredPercentStackedColumnChart,a[4]=c.L.lineChart,a[1]=c.L.map,a[19]=c.L.filledMap,a[2]=c.L.pivotTable,a[5]=c.L.pieChart,a[6]=c.L.scatterChart,a[8]=c.L.barChart,a[11]=c.L.columnChart,a[0]=c.L.tableEx,a[17]=c.L.treemap,a[23]=c.L.waterfallChart,a[26]=c.L.stackedAreaChart,a[27]=c.L.hundredPercentStackedAreaChart,a[32]=c.L.areaChart,a[33]=c.L.ribbonChart,a[34]=c.L.kpi,a[35]=c.L.decompositionTreeVisual,a});function A(a){return m.getValue()[a]}new F.o(function(){var a={};return a[c.L.card.name]=3,a[c.L.lineClusteredColumnComboChart.name]=13,a[c.L.multiRowCard.name]=29,a[c.L.clusteredBarChart.name]=7,a[c.L.clusteredColumnChart.name]=10,a[c.L.donutChart.name]=20,a[c.L.funnel.name]=16,a[c.L.gauge.name]=30,a[c.L.heatMap.name]=22,a[c.L.hundredPercentStackedBarChart.name]=9,a[c.L.hundredPercentStackedColumnChart.name]=12,a[c.L.lineChart.name]=4,a[c.L.map.name]=1,a[c.L.filledMap.name]=19,a[c.L.matrix.name]=2,a[c.L.pivotTable.name]=2,a[c.L.pieChart.name]=5,a[c.L.scatterChart.name]=6,a[c.L.barChart.name]=8,a[c.L.columnChart.name]=11,a[c.L.table.name]=0,a[c.L.tableEx.name]=0,a[c.L.treemap.name]=17,a[c.L.waterfallChart.name]=23,a[c.L.stackedAreaChart.name]=26,a[c.L.hundredPercentStackedAreaChart.name]=27,a[c.L.areaChart.name]=32,a[c.L.ribbonChart.name]=33,a[c.L.kpi.name]=34,a[c.L.decompositionTreeVisual.name]=35,a})},1931:function(X,O,u){u.d(O,{T:function(){return G}});var c=u(77476),F=u(52910),m=u(13052),T=u(31109),A=u(22346),f=u(76521),a=u(40516),g=u(84497),N=u(79061),L=u(4633),C=u(90938),Q=u(47231),W=u(50423),G=function(){function k(){}return k.\u0275fac=function(J){return new(J||k)},k.\u0275mod=W.\u0275\u0275defineNgModule({type:k}),k.\u0275inj=W.\u0275\u0275defineInjector({imports:[c.CommonModule,F.O,m.T,T.F,A.J,f.A3,a.h,g.L,N.v,L.e3,C.g,Q.c]}),k}()},93840:function(X,O,u){u.r(O),u.d(O,{QnaDesktopModule:function(){return gt}});var c=u(1931),F=u(98875),m=u(50423),T=u(51832),A=function(){function n(t,r){this.desktopQnaService=t,this.promiseStore=r}return n.prototype.improveLinguisticSchema=function(t){return this.pendingRequestPromise=this.promiseStore.create(),this.desktopQnaService.improveLinguisticSchema(t,this.pendingRequestPromise)},n.prototype.cancelImproveLinguisticSchema=function(){null!=this.pendingRequestPromise&&(this.promiseStore.cancelPromise(this.pendingRequestPromise.handle),this.pendingRequestPromise=void 0)},n.\u0275fac=function(r){return new(r||n)(m.\u0275\u0275inject(T.r),m.\u0275\u0275inject(F.K))},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),f=u(81337),a=u(4633),g=u(62458),N=new m.InjectionToken("ImproveLsdlProxy"),L=u(26112),C=u(35510),Q=u(14172),W=function(){function n(){this.blockingTask=new C.X(void 0),this.isBlocked$=this.blockingTask.pipe((0,Q.U)(function(t){return null!=t}))}return n.prototype.startBlockingTask=function(t){var r=this;g.fF.assertValue(t,"taskType"),g.fF.assert(function(){return null==r.blockingTask.value},"lsdl ui is already blocked due to a pending task"),this.blockingTask.next(t)},n.prototype.endBlockingTask=function(){this.blockingTask.next(void 0)},n.prototype.getBlockingTaskType=function(){return this.blockingTask.value},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac=function(r){return new(r||n)},providedIn:"root"}),n}(),K=u(94759),G=u(38078),k=u(29804),re=function(){function n(t){this.certifiedEventsService=t}return n.prototype.startImproveLsdlWithCopilotEvent=function(){this.improveLsdlCopilotEventStartTime=(0,k.z)()},n.prototype.stopImproveLsdlWithCopilotEvent=function(t){g.fF.assertValue(this.improveLsdlCopilotEventStartTime,"improveLsdlCopilotEventStartTime"),this.certifiedEventsService.logTimedStandardizedFeatureEvent({correlationId:G.b$.generateGuid(),originatingService:K.F1,activityName:"Qna-Setup",resultCode:"",featureName:(0,K.mN)("Usage","Qna-Setup"),activityStatus:t,operationStartTime:this.improveLsdlCopilotEventStartTime,operationEndTime:(0,k.z)(),activityAttributes:{IsSignedIn:!0,Location:"Desktop",ContentMode:"Edit"}}),this.improveLsdlCopilotEventStartTime=void 0},n.\u0275fac=function(r){return new(r||n)(m.\u0275\u0275inject(a.ly))},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n}(),J=u(5894),ie=u(34100),Me={provide:"improveLsdlService",useFactory:function(n,t,r,l,s){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(v){return[2,new Pe(s,t,r,l,n)]})})},deps:[N,a.ly,a.y0,re,W]},Pe=function(){function n(t,r,l,s,v){this.lsdlUiBlockerService=t,this.certifiedEventsService=r,this.telemetryService=l,this.improveLsdlCopilotTelemetry=s,this.improveLsdlProxy=v}return n.prototype.improveLinguisticSchema=function(t){var r,l;return(0,f.__awaiter)(this,void 0,void 0,function(){var s,v,y,h,D,x,E;return(0,f.__generator)(this,function(R){switch(R.label){case 0:if(g.fF.assertValue(t,"improveLsdlRequest"),g.fF.assertNonEmpty(t.requestedAgents,"requestedAgents should not be empty"),(0,ie.J_)(t.requestedAgents)&&_.isEmpty(t.copilotWorkspaceId))return g.fF.assertFail("copilotWorkspaceId should be defined for copilot agents"),[2];s={LsdlJson:t.lsdlJson,RequestedVersion:"4.0.0",Priority:t.requestPriority,RequestedAgents:_.map(t.requestedAgents,function(b){return b.toString()}),CopilotWorkspaceId:t.copilotWorkspaceId},_.includes(t.requestedAgents,"PowerBI.AzureOpenAIPhrasings")?this.lsdlUiBlockerService.startBlockingTask("improvePhrasings"):this.lsdlUiBlockerService.startBlockingTask("improveSynonyms"),this.startTelemetryEvent(t.requestedAgents),R.label=1;case 1:return R.trys.push([1,3,4,5]),[4,this.improveLsdlProxy.improveLinguisticSchema(s)];case 2:return y=R.sent(),h=(0,L.K)(y),v=function(n){return"1.0.0"===n.Version}(h)?{version:h.Version,errors:_.map(h.DiagnosticInfo,function(b){return{category:"powerbi",code:b.DiagnosticCode,agent:ce(b.Agent),diagnosticMessage:b.DiagnosticMessage}}),result:h.LsdlObject?{lsdlObject:h.LsdlObject}:void 0}:{version:h.Version,errors:[{category:"powerbi",code:"RequiresNewerVersion"}]},[3,5];case 3:return D=R.sent(),x=null!==(r=D.hostError)&&void 0!==r?r:D,E=function(n){return"BadGateway"===n||"ConnectFailure"===n||"ConnectionClosed"===n||"GatewayTimeout"===n||"KeepAliveFailure"===n||"NameResolutionFailure"===n||"NetworkUnavailable"===n||"ProxyAuthenticationRequired"===n||"ProxyNameResolutionFailure"===n||"RequestTimeout"===n||"ServiceUnvailable"===n||"Timeout"===n||"AccessDenied"===n?"NetworkConnectionIssue":"FeatureNotAvailableError"===n?"FeatureNotAvailable":"System.OperationCanceledException"===n?"OperationCancelled":"GenericFailure"}(null!==(l=x.errorCode)&&void 0!==l?l:x.type),v={version:"1.0.0",errors:[{category:"host",code:E}]},[3,5];case 4:return this.endTelemetryEvent(!!v.result,v.errors,t.requestedAgents),this.lsdlUiBlockerService.endBlockingTask(),[7];case 5:return[2,v]}})})},n.prototype.cancelImproveLinguisticSchema=function(){this.improveLsdlProxy.cancelImproveLinguisticSchema(),this.improveLsdlTelemetryEvent&&(this.improveLsdlTelemetryEvent.event.info.isCancelled=!0),this.improveLsdlRunningEvent&&this.improveLsdlRunningEvent.setAttribute("isCancelled",!0)},n.prototype.startTelemetryEvent=function(t){this.improveLsdlTelemetryEvent=this.telemetryService.startEvent(J.yp,{requestedAgents:t}),this.improveLsdlRunningEvent=this.certifiedEventsService.startTimedStandardizedFeatureEvent("Qna - Improve LSDL Feature",J.Nt),this.improveLsdlRunningEvent.setAttribute("requestedAgents",_.toString(t)),(0,ie.J_)(t)&&this.improveLsdlCopilotTelemetry.startImproveLsdlWithCopilotEvent()},n.prototype.endTelemetryEvent=function(t,r,l){if(g.fF.assertValue(this.improveLsdlTelemetryEvent,"improveLsdlTelemetryEvent"),g.fF.assertValue(this.improveLsdlRunningEvent,"improveLsdlRunningEvent"),!_.isEmpty(r)){var s=_.map(r,function(h){return h.code});this.improveLsdlTelemetryEvent.event.info.errorCodes=s,this.improveLsdlRunningEvent.setAttribute("errorCodes",_.toString(s))}this.improveLsdlTelemetryEvent.resolve();var y=t&&!_.isEmpty(r)?"SucceededWithErrors":t?"Succeeded":"Failed";this.improveLsdlRunningEvent.complete(y),(0,ie.J_)(l)&&this.improveLsdlCopilotTelemetry.stopImproveLsdlWithCopilotEvent(y),this.improveLsdlTelemetryEvent=void 0,this.improveLsdlRunningEvent=void 0},n.\u0275fac=function(r){return new(r||n)(m.\u0275\u0275inject(W),m.\u0275\u0275inject(a.ly),m.\u0275\u0275inject(a.y0),m.\u0275\u0275inject(re),m.\u0275\u0275inject(N))},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}();function ce(n){if(null!=n)switch(n){case"PowerBI.OrganizationLsdlSharing":return"PowerBI.OrganizationLsdlSharing";case"PowerBI.AzureOpenAISynonyms":return"PowerBI.AzureOpenAISynonyms";case"PowerBI.AzureOpenAIPhrasings":return"PowerBI.AzureOpenAIPhrasings";default:g.fF.assertFail("Unknown agent name ".concat(n))}}var B=u(35988),Ne=u(82762),oe=u(11547),$=u(81905),pe=u(59822),we=u(70032),ve=function(){function n(t){this.qnaHostService=t,this.retryId=0}return n.prototype.getOverwriteResponseModelInfo=function(t){g.fF.assert(function(){return 1===_.size(t?.scopes)},"Expect to have 1 and only one scope in the request for desktop");var r=t.scopes[0].model;return{vsName:r.vsName,dbName:r.dbName}},n.prototype.convertToWireInterpretRequest=function(t){return(0,Ne.D)(this.qnaHostService.getServiceModelInfo()).pipe((0,Q.U)(function(l){return l?B.tc(t,l.VirtualServerName,l.DatabaseName):B.NG(t)}))},n.prototype.probe=function(t){var r=this;return g.fF.assertAnyValue(t,"modelScopes can be any value"),this.convertToWireInterpretRequest(void 0).pipe((0,$.w)(function(l){return r.sendRequest(l).pipe((0,Q.U)(function(s){return B.Cb(s)}))}),(0,pe.K)(function(l){return(0,oe.of)({error:fe(l)})}))},n.prototype.interpret=function(t,r,l){return g.fF.assertValue(t,"Expect the given wireInterpretRequest to be defined"),this.sendRequest(t,r,l).pipe((0,Q.U)(function(s){return function(n,t){return g.fF.assertValue(t,"Expect the given wireResponse to be defined"),Y(n)?B.B4(t):B.R1(n.Utterance,n.DesiredInterpretationsCount,void 0,t)}(t,s)}),(0,pe.K)(function(s){return(0,oe.of)(function(n,t){g.fF.assert(function(){return!t.HostError},"Expect hostError being a IHostServiceError, not hostError.HostError");var r=fe(t);return Y(n)?{result:void 0,error:r}:{utterance:n.Utterance,results:void 0,error:r}}(t,s))}))},n.prototype.sendRequest=function(t,r,l){var s=this;return g.fF.assertValue(t,"The given wireInterpretRequest must be defined"),this.qnaHostService.interpretAsObservable(JSON.stringify(t)).pipe((0,we.g)(this.retryId>0?1e3:0),(0,$.w)(function(y){var h=(0,L.K)(y);if(r&&s.retryId<=8){var D=function(n){var t=n?.Context;return 1===_.size(t?.ModelScopes)&&!_.isEmpty(t.ModelScopes[0].VirtualServerName)&&!_.isEmpty(t.ModelScopes[0].DatabaseName)}(t)?B.qV(h):B.Fm(h);if(null!=D)return s.retryId++,l&&l.reportLoading({warning:D}),s.sendRequest(t,r,l)}return s.retryId=0,(0,oe.of)(h)}))},n.\u0275fac=function(r){return new(r||n)(m.\u0275\u0275inject(T.r))},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}();function Y(n){var t,r;return g.fF.assertValue(n,"Expect the given interpretRequest to be defined."),!(null===(t=n.Options)||void 0===t||!t.SuggestedUtterances)||!(null===(r=n.Options)||void 0===r||!r.SuggestedDefineCalculationUtterances)}function fe(n){g.fF.assertValue(n,"Expect the given hostError to be defined");var t=B.hj(n.errorCode);return g.fF.assertValue(null!=t,"Expect qnaErrorCode not null here"),{errorCode:t,source:"GenericRequestFailure"!==t?"User":"PowerBI",message:n.message,stackTrace:n.stackTrace}}var ge=u(9380),We=u(5708),he=u(43286),q=u(65181),ae=new m.InjectionToken("QnaInterpretProxyService"),Be={en:{resStringSuffix:"_English"},es:{resStringSuffix:"_Spanish",preview:!0}};function se(n,t){var r=function(n){var t;if(_.isEmpty(n))return t;for(var r=0,l=n;r<l.length;r++){var s=l[r];if(t&&s.language!==t){t=void 0;break}t=s.language}return t}(t);return function(n,t){var r="";if(n){var l=!1,s=ye(t.currentLanguageLocale);n=ye(n);var v=Be[n];v&&(r=v.resStringSuffix,l=v.preview),!l&&n===s&&(r="")}return t.get("Qna_Input_Placeholder"+r)}(r,n)}function ye(n){if(n)return n.split("-")[0].toLowerCase()}function Te(n,t,r,l){return new je(n,t,r,l)}var je=function(){function n(t,r,l,s){this.featureSwitchService=t,this.localizationService=r,this.telemetryService=l,this.interpretProxy=s,this.answeredQuestionDataLoggerFactory=new Ge(this.telemetryService,3e3)}return n.prototype.sendFeedback=function(t,r,l,s){return(0,f.__awaiter)(this,void 0,void 0,function(){var v,y;return(0,f.__generator)(this,function(h){switch(h.label){case 0:return v=this.constructInterpretRequest(r,void 0,l,void 0,{tags:s},void 0,t),[4,this.interpretProxy.convertToWireInterpretRequest(v).toPromise()];case 1:return y=h.sent(),this.interpretProxy.interpret(y,!1),[2]}})})},n.prototype.interpret=function(t,r,l,s,v,y,h,D){var x=this;if(g.fF.assertValue(v,"interpretListener"),_.isEmpty(r))return(0,oe.of)(void 0);var E=Date.now(),R=this.answeredQuestionDataLoggerFactory.startLogger(),b={contentProviderType:"Unknown",entryPoint:l,tags:_.isEmpty(h?.tags)?void 0:h.tags.join(",")};h?.isQuestionNotCommitted||v.onInterpretIssued();var j=this.generateRequestOptions(y),V=this.constructInterpretRequest(r,j,s,t,h,D),le={reportLoading:function(_e){x.notifyInterpretListenerRetry(v,_e.warning)}},de=this.interpretProxy.getOverwriteResponseModelInfo(V);return this.interpretProxy.convertToWireInterpretRequest(V).pipe((0,$.w)(function(ne){return x.interpretProxy.interpret(ne,!0,le).pipe((0,Q.U)(function(_e){var Ze,Xe,et=Date.now();be(_e);var P=_e;if(x.checkToOverwriteResponseModelInfo(P,de),x.notifyInterpretListenerResult(v,P,!!h?.isQuestionNotCommitted,V),b.fromCache=!!P.fromCache,P.error?x.logAnsweredQuestionDataOnError(R,E,et,P?.requestId,null===(Xe=null===(Ze=P?.error)||void 0===Ze?void 0:Ze.errorCode)||void 0===Xe?void 0:Xe.toString(),b):x.logAnsweredQuestionDataWithInterpretResult(R,E,et,P?.requestId,V.scopes,P,b),P?.warnings){var ht=(0,B.vr)(P.warnings);_.remove(P.warnings,function(mt){return _.find(ht,function(yt){return yt.warning===mt})}),b.warnings=P.warnings.join("|")}return P}))}))},n.prototype.sendTags=function(t,r,l,s,v){var y,h;return(0,f.__awaiter)(this,void 0,void 0,function(){var D,x,E,R,b,j,V,le,de,U;return(0,f.__generator)(this,function(ne){switch(ne.label){case 0:return g.fF.assertNonEmpty(t,"Expect this be called only when tags is not empty"),_.isEmpty(t)?[2]:(D=Date.now(),x=this.answeredQuestionDataLoggerFactory.startLogger(),E={contentProviderType:"Unknown",entryPoint:l,tags:_.isEmpty(t)?void 0:t.join(","),fromCache:!1},R=this.generateRequestOptions(v),b=this.constructInterpretRequest(r,R,s,void 0,{tags:t}),j=this.interpretProxy.getOverwriteResponseModelInfo(b),[4,this.interpretProxy.convertToWireInterpretRequest(b).toPromise()]);case 1:return V=ne.sent(),[4,this.interpretProxy.interpret(V,!1).toPromise()];case 2:return le=ne.sent(),de=Date.now(),be(le),this.checkToOverwriteResponseModelInfo(U=le,j),U.error?this.logAnsweredQuestionDataOnError(x,D,de,U?.requestId,null===(h=null===(y=U?.error)||void 0===y?void 0:y.errorCode)||void 0===h?void 0:h.toString(),E):this.logAnsweredQuestionDataWithInterpretResult(x,D,de,U?.requestId,b.scopes,U,E),[2]}})})},n.prototype.getSuggestedQuestions=function(t){var r=this,s=this.constructInterpretRequest("",2048,t);return this.interpretProxy.convertToWireInterpretRequest(s).pipe((0,$.w)(function(y){return r.interpretProxy.interpret(y,!0).pipe((0,Q.U)(function(h){return function(n){g.fF.assert(function(){return!n.hasOwnProperty("utterance")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "utterance".'),g.fF.assert(function(){return!n.hasOwnProperty("requestId")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "requestId".'),g.fF.assert(function(){return!n.hasOwnProperty("fromCache")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "fromCache".');var t=n;t.result&&g.fF.assert(function(){return t.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(h),h}))}))},n.prototype.getSuggestedDefineCalculationQuestions=function(t){var r=this,s=this.constructInterpretRequest("",16384,t);return this.interpretProxy.convertToWireInterpretRequest(s).pipe((0,$.w)(function(y){return r.interpretProxy.interpret(y,!0).pipe((0,Q.U)(function(h){return function(n){var t=n;t.result&&g.fF.assert(function(){return t.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(h),h}))}))},n.prototype.getPlaceholderText=function(t){var r=this,l=_.filter(t,function(s){return r.isSupportedScope(s)});return this.interpretProxy.probe((0,B.C2)(l)).pipe((0,Q.U)(function(s){return{result:s.results?se(r.localizationService,s.results):void 0,error:s.error}}))},n.prototype.constructInterpretRequest=function(t,r,l,s,v,y,h){var D=this,E={version:2,utterance:t,scopes:_.filter(l,function(b){return D.isSupportedScope(b)}),skipCompletion:!0,spans:v?.specifiedSpans,linguisticSchemaJson:v?.linguisticSchemaJson,inferredTermBinding:v?.inferredTermBinding,isCommitted:!v?.isQuestionNotCommitted,tags:v?.tags,feedback:h,reportMetadata:y};if(this.featureSwitchService.featureSwitches.interpretRequestGroupIdEnabled&&(E.groupId=s?.groupId,E.groupSequenceNumber=s?.groupSequenceNumber),r&&(E.options=r,(0,he.yE)(E.options,256))){var R=v.calculation;g.fF.assertValue(R,"requestParams calculation should be defined"),E.intent={defineCalculation:{language:R.language}},E.isCommitted=R.isCommitted,E.desiredInterpretationsCount=5}return E},n.prototype.isSupportedScope=function(t){return t&&t.model&&(0,We.KZ)(t.model)&&!_.isEmpty(t.model.vsName)&&!_.isEmpty(t.model.dbName)},n.prototype.generateRequestOptions=function(t){var r=66;return t&&(t.supportsInsightsQueries&&(r|=512),t.supportsPodQueries&&(r|=8),t.inferUnknownModelTerms&&(r|=4096),t.singleAnswerBias&&(r|=8192),t.supportsCalculation&&(r|=256),t.includeRelevantSchemaElements&&(r|=32),t.useLlmParser&&(r|=65536)),r},n.prototype.notifyInterpretListenerResult=function(t,r,l,s){g.fF.assertValue(r,"Expect response to be defined"),g.fF.assertValue(t,"Expect interpretListener to be defined"),!l&&t.onInterpretResult(s,r)},n.prototype.notifyInterpretListenerRetry=function(t,r){g.fF.assertValue(t,"Expect interpretListener to be defined."),t.onInterpretRetry&&t.onInterpretRetry(r)},n.prototype.logAnsweredQuestionDataOnError=function(t,r,l,s,v,y){y.isResponseEmpty=!0,y.isError=!0,y.interpretRequestId=s,y.error=v,t.log(r,l,y)},n.prototype.logAnsweredQuestionDataWithInterpretResult=function(t,r,l,s,v,y,h){g.fF.assertValue(y,"Expect response to be defined"),h.interpretRequestId=s,function(n,t,r){var l;g.fF.assertValue(n,"answeredQuestionData"),g.fF.assertValue(t,"Expect response to be defined");var s=_.first(t.results);n.isError=!!t.error,n.isResponseEmpty=!s?.command;var v=function(n,t){g.fF.assertValue(n,"Expect interpretResponse to be defined");var r=_.first(n.results);if(r)return _.find(t,function(l){return l.model.vsName.toLowerCase()===r.virtualServerName.toLowerCase()&&l.model.dbName.toLowerCase()===r.databaseName.toLowerCase()})}(t,r);if(v&&(n.ownerType=function(n){var t,r=null===(t=n?.model)||void 0===t?void 0:t.permissions;return r?(0,he.yE)(r,7)?"Owner":"Shared":"Unknown"}(v)),n.interpretationState="No Result",s){n.language=s.language,n.modelLanguage=s.modelLanguage;var y=null===(l=s.correctionInfo)||void 0===l?void 0:l.state;if(null==y)n.interpretationState="Understood";else switch(y){case 1:n.interpretationState="Did you mean";break;case 2:n.interpretationState="Showing results for";break;case 0:n.interpretationState="No Result";break;default:g.fF.assertFail("Unhandled case: "+y)}}}(h,y,v),t.log(r,l,h)},n.prototype.checkToOverwriteResponseModelInfo=function(t,r){var l=t.results;if(!_.isEmpty(l)&&r)for(var s=0,v=l;s<v.length;s++){var y=v[s];y.virtualServerName=r.vsName,y.databaseName=r.dbName}},(0,f.__decorate)([(0,f.__param)(3,(0,m.Inject)(ae)),(0,f.__metadata)("design:paramtypes",[ge.vZ,q.o,a.y0,Object])],n)}();function be(n){g.fF.assertValue(n.utterance,'proxyResponse is expected to be in type InterpretResponse here, it should contain property "utterance" which is not null.');var r=n;r.results&&g.fF.assert(function(){return!r.results.hasOwnProperty("utterances")},'Expect proxyResponse in type InterpretResponse, proxyResponse.result should not contain "utterances" property.')}var Ge=function(){function n(t,r){this.telemetryService=t,this.logDebounceTimeInMilliseconds=r}return n.prototype.startLogger=function(){var t=this,r=new Je(this.telemetryService);return null!=this.logAnsweredDataDebounceHandler&&(clearTimeout(this.logAnsweredDataDebounceHandler),this.logAnsweredDataDebounceHandler=null),this.logAnsweredDataDebounceHandler=setTimeout(function(){t.logAnsweredDataDebounceHandler=null,r.setReadyToLogData()},this.logDebounceTimeInMilliseconds),r},n}(),Je=function(){function n(t){this.telemetryService=t,this.eventInfo$=new C.X(void 0)}return n.prototype.log=function(t,r,l){this.eventInfo$.next({start:t,end:r,data:l})},n.prototype.setReadyToLogData=function(){var t=this;this.eventInfo$.subscribe(function(r){r&&t.logData(r)})},n.prototype.logData=function(t){var r=t.start,l=t.end,s=t.data;g.fF.assert(function(){return-1!==r},"startTime value should be set"),g.fF.assert(function(){return-1!==l},"endTime value should be set"),s.wasCancelled&&(s.isError=!1),this.telemetryService.logEvent(function(h,D,x,E){return void 0===D&&(D=!1),void 0===x&&(x=void 0),void 0===E&&(E=void 0),J.yP({EventsKitEventName:"FireActivityCompletionSummaryEvent",howEnded:s.isError?"3":"1",isResponseEmpty:s.isResponseEmpty,fromCache:s.fromCache,contentProviderType:s.contentProviderType,ownerType:s.ownerType,duration:l-r,probeDuration:-1,wasCancelled:s.wasCancelled,interpretRequestId:s.interpretRequestId,entryPoint:s.entryPoint,linguisticSchemaLanguage:s.language,modelLanguage:s.modelLanguage,withContextPresent:!1,usedContext:!1,tags:s.tags,interpretationState:s.interpretationState,parentId:h,isError:s.isError,errorSource:x,errorCode:E,warnings:s.warnings,responseError:s.error})})},n}(),De=u(91592),e=u(41887),i=u(47508),o=u(88255);function d(n,t,r,l,s,v,y,h,D,x,E,R,b,j){return new p(n,t,r,l,s,v,y,h,D,x,E,R,b,j)}var p=function(){function n(t,r,l,s,v,y,h,D,x,E,R,b,j,V){this.conceptualSchemaProxy=t,this.dataSources=r,this.dialogService=l,this.errorService=s,this.explorationCapabilitiesService=v,this.explorationNavigation=y,this.formFactorProvider=h,this.layoutAuthoring=D,this.lazyProvider=x,this.localizationService=E,this.telemetryService=R,this.viewModeState=b,this.visualAuthoring=j,this.qnaProxyPathToken=V}return n.prototype.reportConfigAllowsQna=function(t){return 0===this.formFactorProvider.getCurrentLayout()&&!(0===this.viewModeState.getMode()&&!t.allowInViewMode)},n.prototype.tryAddQnaContainerToCanvas=function(t,r){return(0,f.__awaiter)(this,void 0,void 0,function(){var l,s,v,y,h,D,x;return(0,f.__generator)(this,function(R){switch(R.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!1})?[4,this.ensureQnaSupportabilityService()]:[2,!1];case 1:return R.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return l=R.sent(),s=this.explorationCapabilitiesService.getCapabilities(),!(v=(0,De.H)(s,l,this.qnaSupportabilityService)).isAllowed&&"featureDisabledInApp"===v.disallowedReason||!v.isAllowed&&!s.allowEnableQnaPrompts?[2,!1]:(h={width:t.contract.size.width,height:t.contract.size.height},(y=r&&r.pointOfInterest)&&(D=this.layoutAuthoring.getLayoutForNewVisualContainer(t.contract.visualContainers,y,h)),x=this.explorationNavigation.getAllSections(),[4,(0,e.lN)({telemetrySource:r.creationSource,position:D,visualType:i.L.qnaVisual.name},x,t,this.dataSources.get(),this.visualAuthoring,this.telemetryService)]);case 3:return R.sent(),[2,!0]}})})},n.prototype.tryShowQnaPopout=function(t,r){return(0,f.__awaiter)(this,void 0,void 0,function(){var s,v,y,h,D,R=this;return(0,f.__generator)(this,function(b){switch(b.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!0})?[4,this.ensureQnaSupportabilityService()]:[2];case 1:return b.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return s=b.sent(),v=this.explorationCapabilitiesService.getCapabilities(),(y=(0,De.H)(v,s,this.qnaSupportabilityService)).isAllowed?[4,this.lazyProvider.get("@powerbi/QnaReportContainer/module#QnaReportContainerModule","qnaPopoutBuilderModern")]:[3,5];case 3:return h=b.sent(),D={anchorElement:t,dataSources:this.dataSources.get(),explorationCapabilities:v,sourceExploration:this.explorationNavigation.getCurrentExploration(),sourceFilters:r.sourceFilters,viewMode:this.viewModeState.getMode(),close:function(){R.explorationNavigation.hideExplorationMask()}},[4,h.show(D)];case 4:return b.sent(),this.explorationNavigation.showExplorationMask(),[3,6];case 5:switch(y.disallowedReason){case"featureDisabledInIE":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupportedInIE_Title"),this.localizationService.get("Qna_NotSupportedInIE_Subtitle"));break;case"featureDisabledInApp":g.fF.assertFail("Expect the code of showing qna popout never be called if app doesn't allow qna feature");break;case"noModel":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.localizationService.get("Qna_NotAllowedForReport_WithoutModel"));break;case"qnaNotSupported":this.errorService.infoCustom(this.localizationService.get("VisualContainer_QnaVisual_NotSupportedTitle"),this.localizationService.get("VisualContainer_QnaVisual_NotSupportedMessage"));break;case"qnaNotEnabled":this.qnaSupportabilityService.canAnyUserEnableQna()?this.dialogService.showConfirmationDialog({title:this.localizationService.get("Qna_NotSupported_Title"),message:this.qnaSupportabilityService.modelHasQnaDisabledMessage,okButtonText:this.localizationService.get("Qna_MessageDialog_EnableQnaButtonText"),cancelButtonText:this.localizationService.get("Cancel_ButtonText")},{maxWidth:500}).afterClosed().pipe((0,o.P)()).subscribe(function(j){return(0,f.__awaiter)(R,void 0,void 0,function(){return(0,f.__generator)(this,function(V){switch(V.label){case 0:return 1!==j?[3,3]:[4,this.qnaSupportabilityService.enableQna()];case 1:return V.sent(),[4,this.tryShowQnaPopout(t,r)];case 2:V.sent(),V.label=3;case 3:return[2]}})})}):this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.qnaSupportabilityService.modelHasQnaDisabledMessage);break;default:g.fF.assertNever(y.disallowedReason)}b.label=6;case 6:return[2]}})})},n.prototype.ensureQnaSupportabilityService=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var t;return(0,f.__generator)(this,function(r){switch(r.label){case 0:return this.qnaSupportabilityService?[3,2]:(t=this,[4,this.lazyProvider.get(this.qnaProxyPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaSupportabilityService")]);case 1:t.qnaSupportabilityService=r.sent(),r.label=2;case 2:return[2]}})})},n}(),S=function(){function n(t){this.qnaHostService=t}return n.prototype.isDQOrLiveConnectToOnPrem=function(t){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(r){return[2,Promise.resolve(this.qnaHostService.requiresConsentToQnaForLiveConnect())]})})},n.\u0275fac=function(r){return new(r||n)(m.\u0275\u0275inject(T.r))},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),M=u(30794),I=function(){function n(t,r){var l=this;this.qnaService=t,this.localizationService=r,this.qnaSettingsChangedInternal=new M.xQ,this.settingsChangedSubscription=this.qnaService.settingsChanged$.subscribe(function(){return l.qnaSettingsChangedInternal.next(!0)})}return n.prototype.ngOnDestroy=function(){this.qnaSettingsChangedInternal.complete(),this.settingsChangedSubscription.unsubscribe()},n.prototype.appShouldHideQnaFeature=function(){return this.qnaService.appShouldHideQnaFeature()},n.prototype.modelSupportsQna=function(t,r){return this.qnaService.modelSupportsQna()},n.prototype.modelHasQnaEnabled=function(t,r){return this.qnaService.modelHasQnaEnabled()},n.prototype.modelSupportsNlToDax=function(){return this.qnaService.modelSupportsNlToDax()},n.prototype.getNlToDaxStatus=function(){return this.qnaService.getNlToDaxStatus()},n.prototype.canAnyUserEnableQna=function(){return!0},n.prototype.canCurrentUserEnableQna=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(t){return[2,Promise.resolve(!0)]})})},n.prototype.enableQna=function(){return this.qnaService.setQnaEnabledForReport(!0)},Object.defineProperty(n.prototype,"qnaSettingsChanged$",{get:function(){return this.qnaSettingsChangedInternal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelHasQnaDisabledMessage",{get:function(){return this.localizationService.get("Visual_Qna_IsNotEnabled_Desktop")},enumerable:!1,configurable:!0}),n.prototype.allowsLinguisticSchemaEdit=function(){return this.qnaService.allowsLinguisticSchemaEdit()},n.\u0275fac=function(r){return new(r||n)(m.\u0275\u0275inject(T.r),m.\u0275\u0275inject(q.o))},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),w=u(77476),te=u(26898),z=u(81213),H=u(13052),Z=u(39503),ue=u(11494),$e=u(83008),tt=u(48145),nt=u(17328),rt=u(63387),it=u(77200),ot=u(66890),at=u(76521),st=u(65947),qe=u(12123),ut=u(76072),lt=u(82156),dt=u(79061),ct=u(58938),pt=u(90938),vt=u(66972),ft=function(){function n(t){this.certifiedEventsService=t}return n.prototype.logInterpretWithCopilotEvent=function(t,r,l){this.certifiedEventsService.logStandardizedFeatureEvent({featureName:(0,K.mN)("Downstream","Qna-Query"),activityStatus:"Succeeded",activityName:"Qna-Query",resultCode:"",correlationId:"",activityAttributes:{IsSignedIn:r,Location:"service"===t?"Service":"Desktop",ContentMode:0===l?"View":"Edit"}})},n.\u0275fac=function(r){return new(r||n)(m.\u0275\u0275inject(a.ly))},n.\u0275prov=m.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),gt=function(){function n(){}return n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=m.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=m.\u0275\u0275defineInjector({providers:[ue.J,ve,{provide:qe.n,useValue:"@powerbi/Qna/qnadesktop.module#QnaDesktopModule"},{provide:st.z,useValue:"@powerbi/Qna/qnadesktop.module#QnaDesktopModule"},I,S,{provide:"InterpretServiceModern",useFactory:Te,deps:[ge.vZ,q.o,a.y0,ve]},{provide:"qnaLaunchService",useFactory:d,deps:[te.i,$e.D,ct.x,z.T,tt.U,Z.z,nt.F,rt.U,ut.E,q.o,a.y0,it.kc,ot.$8,qe.n]},{provide:"qnaSupportabilityService",useClass:I},{provide:"qnaModelUtilsService",useClass:S},{provide:"interpretCopilotTelemetryService",useClass:ft},{provide:N,useClass:A},Me],imports:[w.CommonModule,H.T,at.A3,lt.N,dt.v,vt.N,a.e3,pt.g,c.T]}),n}()},5894:function(X,O,u){u.d(O,{Nt:function(){return Q},WW:function(){return m},dN:function(){return A},v5:function(){return N},yP:function(){return a},yp:function(){return W}});var c=u(41114),F="PBI.QnaVisual.SuggestionCardClicked",m=c.cx[F]=(0,c.b1)(F),T="PBI.QnaVisual.VisualConverted",A=c.cx[T]=(0,c.b1)(T),f="PBI.QnA.INAQ",a=c.cx[f]=(0,c.b1)(f,{logExpAssignment:!0}),g="PBI.QnA.Feedback",N=c.cx[g]=(0,c.b1)(g),L="PBI.QnA.UpdateLsdlSharingPermission",Q=(c.cx[L]=(0,c.b1)(L),"PBI.QnaTooling.ImproveLsdlRequest"),W=c.cx[Q]=(0,c.b1)(Q)},34100:function(X,O,u){u.d(O,{J8:function(){return A},J_:function(){return T},NP:function(){return m}});var c=u(81337),F=u(91592);function m(f,a,g,N,L){var C;return(0,c.__awaiter)(this,void 0,void 0,function(){var Q,W;return(0,c.__generator)(this,function(G){switch(G.label){case 0:return[4,f.get(a.get())];case 1:return Q=G.sent(),W=g.getCapabilities(),(0,F.H)(W,Q,N).isAllowed&&N.allowsLinguisticSchemaEdit()&&"None"!==(null===(C=L.DynamicImprovement)||void 0===C?void 0:C.Schema)?[2,!0]:[2,!1]}})})}function T(f){return _.includes(f,"PowerBI.AzureOpenAISynonyms")||_.includes(f,"PowerBI.AzureOpenAIPhrasings")}function A(f){return f.qnaImproveLsdlCopilot&&f.qnaSupportCommitQuestionOnDemandForAll&&f.qnaFuzzyMatch}},91592:function(X,O,u){u.d(O,{H:function(){return F}});var c=u(16808);function F(T,A,f){return(0,c.rO)()?{isAllowed:!1,disallowedReason:"featureDisabledInIE"}:f.appShouldHideQnaFeature()?{isAllowed:!1,disallowedReason:"featureDisabledInApp"}:_.some(A?.schemas,function(N){return!N.isExtensionSchema&&!_.isEmpty(N.entities)})?f.modelSupportsQna(A,T)?f.modelHasQnaEnabled(A,T)?{isAllowed:!0}:{isAllowed:!1,disallowedReason:"qnaNotEnabled"}:{isAllowed:!1,disallowedReason:"qnaNotSupported"}:{isAllowed:!1,disallowedReason:"noModel"}}},35988:function(X,O,u){u.d(O,{AU:function(){return q},B4:function(){return Me},C2:function(){return ge},Cb:function(){return Fe},Fm:function(){return Ae},NG:function(){return ve},R1:function(){return Qe},Tm:function(){return he},hj:function(){return pe},qV:function(){return B},tc:function(){return Oe},vr:function(){return We}});var f,a,g,N,L,C,c=u(70940),F=u(54834),m=u(62458),T=u(43286),A=u(80777),Q=((f={}).GeneratedLinguisticSchema=0,f.DataIndexBuildingCancelled=16,f.DataIndexMissingStatistics=17,f.DataIndexNotReady=8,f.DataIndexSizeLimitReached=15,f.DataIndexUpdateFailure=10,f.DomainModelNotReady=2,f.DomainModelPartialLoad=3,f.DomainModelUpdateFailure=9,f.EmptyLinguisticSchema=1,f.InterpretationSemanticError=4,f.InterpretationSemanticWarning=5,f.InterpretCancelled=18,f.InvalidTextualEntity=6,f.LinguisticSchemaTruncated=14,f.MissingOrInvalidPodParameters=13,f.QueryAggregateNotSupported=19,f.QueryMedianNotSupported=20,f.QueryPercentileNotSupported=21,f.QueryScopedEvalNotSupported=22,f.QuerySubqueryRegroupingNotSupported=23,f.StaleDataIndex=12,f.StaleDomainModel=11,f.RequiresNewerVersion=7,f.DataIndexVersionIsOld=24,f.QueryGroupByTableNotSupported=25,f.QueryNotSupported=26,f.NextBestInterpretation=27,f),W=((a={}).ActivationFailure="ActivationFailure",a.CloudRlsModelAccessDenied="CloudRlsModelAccessDenied",a.DataIndexBuildFailure="DataIndexBuildFailure",a.DomainModelLoadFailure="DomainModelLoadFailure",a.ExternalModelAccessDenied="ExternalModelAccessDenied",a.GenericRequestFailure="GenericRequestFailure",a.LinguisticSchemaLoadFailure="LinguisticSchemaLoadFailure",a.ModelNotFound="ModelNotFound",a.ModelQnaNotEnabled="ModelQnaNotEnabled",a.ModelQnaNotSupported="ModelQnaNotSupported",a.RequiresNewerVersion="RequiresNewerVersion",a.SchemaLanguageNotSupported="SchemaLanguageNotSupported",a.MissingRuntimeModule="MissingRuntimeModule",a.VerifyRuntimeFailure="VerifyRuntimeFailure",a.DataIndexMissingAllStatistics="DataIndexMissingAllStatistics",a),K=((g={})[16]="Qna_Warning_DataIndexIncomplete_Desktop",g[15]="Qna_Warning_DataIndexIncomplete_Desktop",g[14]="Qna_Warning_LinguisticSchemaTruncated_Desktop",g),G=((N={})[16]="Qna_Warning_DataIndexIncomplete_Service",N[15]="Qna_Warning_DataIndexIncomplete_Service",N[14]="Qna_Warning_LinguisticSchemaTruncated_Service",N),k=[2,8,11,12,24],re=[2,8],J=((L={})[1]="Qna_NotAllowedForReport_WithoutModel",L[2]="Qna_Explore_WarningBuildingLanguageModel",L[7]="Qna_Warning_RequiresNewerVersion",L[8]="Qna_Explore_WarningIndexing",L[9]="Qna_Warning_ModelUpdateFailure",L[10]="Qna_Warning_DataIndexUpdateFailure",L[11]="Qna_Warning_StaleModel",L[12]="Qna_Warning_StaleIndex",L[17]="Qna_Warning_DataIndexMissingStatistics",L[19]="Qna_Warning_UnsupportedFunction",L[20]="Qna_Warning_UnsupportedFunction",L[21]="Qna_Warning_UnsupportedFunction",L[22]="Qna_Warning_UnsupportedFunction",L[23]="Qna_Warning_UnsupportedFunction",L[25]="Qna_Warning_QueryGroupByTableNotSupported",L[26]="Qna_Warning_QueryNotSupported",L[27]="Qna_Warning_NextBestInterpretation",L),ie=((C={}).FeatureNotAvailable="Qna_Error_GenericRequestFailure",C.NetworkConnectionIssue="Qna_Error_NetworkIssue",C.RequiresNewerVersion="Qna_Error_RequiresNewerVersion",C.ModelNotFound="Qna_Error_ModelNotFound",C.ModelQnaNotEnabled="Qna_Error_ModelQnaNotEnabled",C.ModelQnaNotSupported="Qna_Error_ModelQnaNotSupported",C.MissingRuntimeModule="Qna_Explore_MissingBinaries",C.VerifyRuntimeFailure="Qna_Explore_MissingBinaries",C.SchemaLanguageNotSupported="Qna_NotAllowedForReport_QnaNotSupported",C.SessionIsInactive="Qna_Error_GenericRequestFailure",C.GenericRequestFailure="Qna_Error_GenericRequestFailure",C.DataIndexBuildFailure="Qna_Explore_WarningFailedIndexing",C.CloudRlsModelAccessDenied="Tile_RLS_NoAccess",C.ExternalModelAccessDenied="Qna_Explore_ModelAccessDenied_WithoutSpecifyOwner",C.DataIndexMissingAllStatistics="Qna_Error_DataIndexMissingAllStatistics",C),Re=[19,20,22,21,23,25,26];function Me(e){m.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=ae(e);if(i)return{error:i};var o=_.first(e.Results),d=_.first(o?.Interpretations);return{result:{utterances:_.map(d?.SuggestedUtterances,function(p){return{text:p.Text,source:p.Source}}),warnings:se(o?.DiagnosticMessages)}}}function Qe(e,i,o,d){m.fF.assertValue(d,"Expect the given wireV3Response to be defined");var S,M,p=ae(d);if(!p){var I=_.first(d.Results);M=se(I?.DiagnosticMessages);var w=i??1,te=_.take(I?.Interpretations,w);_.isEmpty(te)||(S=_.map(te,function(z){var H,Z,ue;return{restatement:z.Restatement,databaseName:null===(H=I.Context)||void 0===H?void 0:H.DatabaseName,virtualServerName:null===(Z=I.Context)||void 0===Z?void 0:Z.VirtualServerName,command:ke(z.Command),correctionInfo:Ge(z),spans:$(e,z.Spans),language:I.Language,modelLanguage:I.ModelLanguage,modelOwner:null===(ue=I.Context)||void 0===ue?void 0:ue.ModelOwner,usedAgents:_.map(z.UsedAgents,function($e){return $e}),score:z.Score,relevantSchemaElements:Pe(I.RelevantSchemaElements)}}))}return{utterance:e,requestId:o,error:p,results:S,warnings:M}}function Pe(e){if(null!=e&&(null!=e.Entities||null!=e.Relationships)){var i=function(d){return{description:d.Description,score:d.Score}};return{entities:_.map(e.Entities,i),relationships:_.map(e.Relationships,i)}}}function Fe(e){m.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=ae(e);if(i)return{error:i};var o=_.first(e.Results);return{results:_.map(o?.Interpretations,function(p){return{language:o.Language}})}}function ce(e){m.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=_.first(e.Results);return se(i?.DiagnosticMessages)}function Ae(e){m.fF.assertValue(e,"Expect the given wireResponse to be defined");var i=ce(e);return _.find(k,function(o){return _.includes(i,o)})}function B(e){return m.fF.assertValue(e,"Expect the given wireResponse to be defined"),function(e){m.fF.assertValue(e,"Expect the given wireResponse to be defined");var i=ce(e);return _.find(re,function(o){return _.includes(i,o)})}(e)}function $(e,i){if(m.fF.assertValue(e,"utterance"),m.fF.assertAnyValue(i,"wireSpans"),i){_.isEmpty(e)&&m.fF.assert(function(){return _.every(i,function(p){return 0===p.Length})},"utterance is empty, every span should have zero length");var o=[],d=[];return _.forEach(i,function(p){5!==p.Resolution||p.Binding?o.push(new me(e,p,!1)):d.push(new me(e,p,!0))}),_.isEmpty(d)||_.forEach(d,function(p){_.forEach(o,function(S){if(function(e,i){return i.startIndex<=e.startIndex&&i.endExcludingIndex>e.startIndex||i.startIndex<e.endExcludingIndex&&i.endExcludingIndex>e.endExcludingIndex||e.startIndex<=i.startIndex&&e.endExcludingIndex>=i.endExcludingIndex||i.startIndex<=e.startIndex&&i.endExcludingIndex>=e.endExcludingIndex}(S,p))S.overlapSpans.push(p);else if(p.endExcludingIndex<S.startIndex)return})}),o}}function pe(e){return"BadGateway"===e||"ConnectFailure"===e||"ConnectionClosed"===e||"GatewayTimeout"===e||"KeepAliveFailure"===e||"NameResolutionFailure"===e||"NetworkUnavailable"===e||"ProxyAuthenticationRequired"===e||"ProxyNameResolutionFailure"===e||"RequestTimeout"===e||"ServiceUnvailable"===e||"Timeout"===e||"AccessDenied"===e?"NetworkConnectionIssue":"FeatureNotAvailableError"===e?"FeatureNotAvailable":"GenericRequestFailure"}function we(e){return _.map(e,function(i){return{startIndex:i.StartIndex,endExcludingIndex:i.StartIndex+i.Length}})}function ve(e){var i=Y(e);return e&&(i.Context={ReportMetadata:be(e.reportMetadata)}),i}function Oe(e,i,o){var d=Y(e);return d.Context={ModelScopes:[{VirtualServerName:i,DatabaseName:o}],Tags:e?.tags,ImpersonatedUserPrincipalName:e?.impersonatedUserPrincipalName,ImpersonatedRoles:e?.impersonatedRoles,Feedback:Le(e?.feedback)},d.Options||(d.Options={}),d}function Y(e){return e?{Version:"3.3.0",Utterance:e.utterance,Spans:_.map(e.spans,function(i){var o={StartIndex:i.startIndex,Length:i.endExcludingIndex-i.startIndex};return i.inferredTerm&&(o.Binding={InferredTerm:Ce(i.inferredTerm)}),o}),Options:fe(e),LinguisticSchemaJson:e.linguisticSchemaJson,InferredTermBinding:Ce(e.inferredTermBinding),Intent:Ve(e.intent),IsCommitted:e.isCommitted,DesiredInterpretationsCount:e.desiredInterpretationsCount,GroupId:e.groupId,GroupSequenceNumber:e.groupSequenceNumber}:{Version:"3.3.0",Utterance:""}}function Ve(e){if(e?.defineCalculation)return{DefineCalculation:{Language:e.defineCalculation.language,Options:e.defineCalculation.options}}}function fe(e){return null==e?.options?{}:{QueryMetadata:(0,T.yE)(e.options,2),VisualConfiguration:(0,T.yE)(e.options,4),SupportPodQueries:(0,T.yE)(e.options,8),IncludeRelevantSchemaElements:(0,T.yE)(e.options,32),Spans:(0,T.yE)(e.options,64),Diagnostics:(0,T.yE)(e.options,128),FrameTree:!1,AllowFollowUpQuestion:!1,AllowInsightQueries:(0,T.yE)(e.options,512),InferUnknownModelTerms:(0,T.yE)(e.options,4096),AllowPlaceholderSuggestions:!1,SuggestFollowUp:!1,SuggestedUtterances:(0,T.yE)(e.options,2048),SkipCompletion:e.skipCompletion,SingleAnswerBias:(0,T.yE)(e.options,8192),SuggestedDefineCalculationUtterances:(0,T.yE)(e.options,16384),UseLlmParser:(0,T.yE)(e.options,65536)}}function ge(e){return _.map(e,function(i){var o,d;return{VirtualServerName:null===(o=i.model)||void 0===o?void 0:o.vsName,DatabaseName:null===(d=i.model)||void 0===d?void 0:d.dbName,ReportIds:i.reportIds}})}function We(e){if(_.indexOf(e,27)>=0)return[];var i=_.intersection(e,Re);return _.map(i,function(o){return{warning:o,messageKey:J[o]}})}function he(e,i){if(!_.isEmpty(e)){m.fF.assert(function(){return!_.isEmpty(i)},"Must provide a valid qnaProxyPath");for(var o=[],d="@powerbi/Qna/qnadesktop.module#QnaDesktopModule"===i?K:G,p=0,S=e;p<S.length;p++){var M=S[p];if(d){var I=d[M];if(I){o.push(I);continue}}var w=J[M];w&&o.push(w)}return _.uniq(o)}}function q(e,i){return i.get(ie[e]||"Qna_Error_GenericRequestFailure")}function ae(e){var i,o;if(m.fF.assertValue(e,"Expect the given wireV3Response to be defined"),"3.3.0"!==e.Version)i="RequiresNewerVersion";else{var d=_.first(e.Results);if(!d)return;o=_.find(d.DiagnosticMessages,function(M){return 1===M.Severity}),i=o?.Code}if(null!=i){var p=function(e){var i=W[e];return m.fF.assert(function(){return null!=i},"InterpretDiagnosticCodeToQnaErrorCodeMappings should contain key "+e),i||(i="NoClientHandling"),i}(i),S={errorCode:p,source:"GenericRequestFailure"===p?"PowerBI":"User",message:o?.Message,stackTrace:o?.StackTrace};return"NoClientHandling"===S.errorCode&&(S.message=_.isEmpty(S.message)?i+".":i+". "+S.message),S}}function se(e){if(!_.isEmpty(e)){for(var i=[],d=function(w){m.fF.assert(function(){return null!=Q[w.Code]},'unknown mapping to convert InterpretDiagnosticMessage "'+w.Code+'" to client interpret warning code'),Q[w.Code]&&i.push(Q[w.Code])},p=0,S=e.filter(function(I){return 2===I.Severity});p<S.length;p++)d(S[p]);return i}}var me=function(){return function(i,o,d){this.utterance=i,this.wireSpan=o,this.isOverlappingSpan=d,this.startIndex=o.StartIndex,this.endExcludingIndex=o.StartIndex+o.Length,this.text=i.substr(o.StartIndex,o.Length),this.correctedStartIndex=o.CorrectedStartIndex,this.correctedEndExcludingIndex=null!=o.CorrectedStartIndex?o.CorrectedStartIndex+o.CorrectedLength:void 0,this.resolution=o.Resolution,this.isOverlapping=d,this.tokens=function(e,i,o){return _.map(o,function(d){var p=d.StartIndex-i;return m.fF.assert(function(){return _.inRange(p,0,_.size(e))},"Expect each token.StartIndex is a valid index with the given spanText and spanStartIndex"),m.fF.assert(function(){return!_.isEmpty(_.trim(e.substr(p,d.Length)))},"Expect no WireToken being pure space"),{startIndex:d.StartIndex,endExcludingIndex:d.StartIndex+d.Length,text:e.substr(p,d.Length)}})}(this.text,this.startIndex,o.Tokens);var p=Te(this.text,o.Binding);this.binding=p&&p.bindingInfo,this.isCorrected=!(!this.binding||!p.isCorrected);var S=ee(this.text,o.AlternateBindings),M=ee(this.text,o.PhraseCompletions),I=ee(this.text,o.PhraseExtensions),w=ee(this.text,o.SuggestedReplacements);(!_.isEmpty(S)||!_.isEmpty(M)||!_.isEmpty(I)||!_.isEmpty(w))&&(this.replacementBindings={alternates:S,phraseCompletions:M,phraseExtensions:I,suggestedReplacements:w}),this.inferredTermBindings=_.map(o.InferredTermBindings,function(Z){return{inferredBindingType:(e=Z.InferredTerm).Type,definitionPrompt:e.DefinitionPrompt,definitionText:e.DefinitionText,prefixText:e.PrefixText,suffixText:e.SuffixText,hintText:e.HintText,alternateDefinitionTexts:e.AlternateDefinitionTexts,linguisticSchemaItems:e.LinguisticSchemaItems,definedTerm:e.DefinedTerm,targetRole:e.TargetRole,metadata:e.Metadata};var e}),this.inferredTermBindingsUnsupported=o.InferredTermBindingsUnsupported,this.hasBinding=null!=this.binding||null!=this.replacementBindings||!_.isEmpty(this.inferredTermBindings),this.isWhiteSpace=!_.isEmpty(this.text)&&_.isEmpty(_.trim(this.text)),this.isUsed=!this.isOverlapping&&(null==this.resolution||0===this.resolution||4===this.resolution),this.isUnknown=3===this.resolution,this.isInferred=4===this.resolution,this.overlapSpans=[];var e,z=!((e=this).isOverlapping||_.isEmpty(e.text)||Ie(e)||Ee(e)||xe(e))&&e.hasBinding&&e.isUsed,H=xe(this);m.fF.assert(function(){return!(z&&H)},"A span can not be definedWithOptions and undefinedWithOptions at the same time."),this.state=z?"accepted":H&&this.isUsed?"warning":H?"error":"none"}}();function ke(e){if(e){var i=e.Query?F.ib.deserializeQuery(e.Query):void 0;return{query:i,queryMetadata:Se(i,e.QueryMetadata),data:e.Data,binding:e.Binding,visualConfigurations:_.map(e.VisualConfigurations,function(d){var p=d.Query?F.ib.deserializeQuery(d.Query):void 0;return{visualizationType:d.VisualizationType,dataShapeBinding:d.DataShapeBinding,visualElements:d.VisualElements,query:p,queryMetadata:Se(i,d.QueryMetadata)}}),suggestedVisualTypes:_.map(e.SuggestedVisualizations,function(d){return(0,c.s)(d.VisualizationType).name}),linguisticSchemaJson:e.LinguisticSchemaJson,linguisticSchemaItems:e.LinguisticSchemaItems,inferredTermMetadata:e.InferredTermMetadata,defineCalculation:ye(e.DefineCalculation)}}}function ye(e){if(e)return{expression:e.Expression,homeTable:e.HomeTable,format:e.Format}}function Se(e,i){if(e&&i){var o=_.filter(i.Filters,function(p){return!!p}),d=_.filter(i.Select,function(p){return!!p});return{filters:_.map(o,function(p){return{Restatement:p.Restatement,type:void 0}}),selects:_.map(d,function(p){return{restatement:p.Restatement,valueType:Je(p.DefaultLabel?p.DefaultLabel.SemanticType:p.SemanticType),isGroup:p.IsGroup,defaultLabel:p.DefaultLabel?De(p.DefaultLabel.Expression,e):void 0,isExplicitSortBy:p.IsExplicitSortBy}})}}}function Ie(e){var i,o;return 7===(null===(i=e.binding)||void 0===i?void 0:i.type)&&!e.isCorrected&&_.isEmpty(null===(o=e.replacementBindings)||void 0===o?void 0:o.suggestedReplacements)&&_.isEmpty(e.inferredTermBindings)}function Ee(e){var i,o;return 8===(null===(i=e.binding)||void 0===i?void 0:i.type)&&!e.isCorrected&&2===e.resolution&&_.isEmpty(null===(o=e.replacementBindings)||void 0===o?void 0:o.suggestedReplacements)&&_.isEmpty(e.inferredTermBindings)}function xe(e){return!(e.isOverlapping||_.isEmpty(e.text)||Ie(e)||Ee(e)||!(e.isCorrected||3===e.resolution||e.hasBinding&&!e.isUsed))}function Te(e,i){if(i&&!i.InferredTerm){var o,d;if(i.Table)o=i.Table,d=0;else if(i.Pod)o=i.Pod,d=1;else if(i.Property)o=i.Property,d=2;else if(i.Value)o=i.Value,d=3;else if(i.Range)o=i.Range,d=4;else if(i.VisType)o=i.VisType,d=5;else if(i.Composite)o=i.Composite,d=6;else if(i.Core)o=i.Core,d=7;else if(i.Phrasing)o=i.Phrasing,d=8;else if(i.TextualEntity)o=i.TextualEntity,d=9;else{if(!i.AnyEntity){var p=i;return void m.fF.assert(function(){return!!p.Literal},"Has binding type that is unhandled by client right now. Known unhandled types are: [Literal] and this is not a known type. Check to either update the known unhandled type list, or handle it on the client side.")}o=i.AnyEntity,d=10}return{bindingInfo:{type:d,text:o.Text,textSegmentsWithMatchInfo:Ke(e,o.Text,o.MatchedSegments),matchType:o.MatchType,score:o.Score},isCorrected:o.Corrected}}}function Ke(e,i,o){if(_.isEmpty(e)||_.isEmpty(o))return[{text:i,isMatched:!1}];for(var d=[],p=0,S=0,M=o;S<M.length;S++){var I=M[S];p<I.StartIndex&&d.push({text:i.substring(p,I.StartIndex),isMatched:!1}),d.push({text:i.substr(I.StartIndex,I.Length),isMatched:!0}),p=I.StartIndex+I.Length}return p<_.size(i)&&d.push({text:i.substring(p),isMatched:!1}),d}function ee(e,i){if(i){for(var o=[],d=0,p=i;d<p.length;d++){var M=Te(e,p[d]);M&&o.push(M.bindingInfo)}return o}}function Le(e){return e?{Sentiment:e.sentiment,Reason:e.reason,Comment:e.comment}:void 0}function be(e){return e?{LinguisticSchema:e.linguisticSchema,Pods:_.map(e.pods,function(i){return{Name:i.name,CortanaEnabled:i.cortanaEnabled,Parameters:_.map(i.parameters,function(o){return{Name:o.name,TargetColumn:o.targetColumn,TargetEntity:o.targetEntity}})}})}:void 0}function Ce(e){return null==e?void 0:{Type:e.inferredBindingType,DefinitionPrompt:e.definitionPrompt,DefinitionText:e.definitionText,PrefixText:e.prefixText,SuffixText:e.suffixText,HintText:e.hintText,AlternateDefinitionTexts:e.alternateDefinitionTexts,LinguisticSchemaItems:e.linguisticSchemaItems,DefinedTerm:e.definedTerm,TargetRole:e.targetRole,Metadata:e.metadata}}function Ge(e){m.fF.assertValue(e,"result");var i=e.CorrectedUtterance;if(!_.isEmpty(i)){var d=e.ReplacementUtterance,p=2;return!!e.Command||(e.ConfidenceLevel<=5?p=0:e.ConfidenceLevel<=20&&(p=1)),_.isEmpty(e.CorrectedUtteranceTextSegments)?{correctedUtterance:i,replacementUtterance:d||i,state:p}:{correctedUtterance:i,correctedTextSegments:we(e.CorrectedUtteranceTextSegments),state:p}}}function Je(e){switch(e){case 0:case 1:case 2:case 3:return;case 4:return A.Ge.fromExtendedType(7078913);case 5:return A.Ge.fromDescriptor({dateTime:!0});case 6:return A.Ge.fromDescriptor({numeric:!0})}}function De(e,i){var o=F.ib.serializeQuery(i);o.Select.push(e);var d=F.ib.deserializeQuery(o);return _.last(d.select()).expr}}}]);