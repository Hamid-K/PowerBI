"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["formatting-telemetry"],{83606:function(q,y,a){a.r(y),a.d(y,{FormattingTelemetryModule:function(){return Y}});var N=a(40702),x=a(9215),j=a(3579),T=a(60661),w=a(9500),g=a(62458),O=["Visual Container Deselection","Visual Container Selection"],P=["areaChart","barChart","clusteredColumnChart","clusteredBarChart","columnChart","hundredPercentStackedColumnChart","hundredPercentStackedBarChart","lineChart","lineClusteredColumnComboChart","lineStackedColumnComboChart","ribbonChart","scatterChart","stackedAreaChart","waterfallChart"],C=function(){function n(e,t,r,i,s,o,c){this.isActive=e,this.sessionId=t,this.visualUid=r,this.telemetryService=i,this.certifiedTelemetryService=s,this.featureSwitchService=o,this.canvasItem=c,this.events=[]}return n.createSession=function(e,t,r,i,s,o,c){return new n(e,t,r,i,s,o,c)},n.prototype.addEvent=function(e){var t=this.getVisualProperties(),r={name:e.name,end:e.end,start:e.start,data:e.data,visualProperties:t};if(this.events.push(r),this.featureSwitchService.featureSwitches.certifiedVisualTelemetry&&!O.includes(e.name)){var i=r.data,s={eventName:e.name,onObjectEnabled:!!this.featureSwitchService.featureSwitches.onObject};switch(s.source=i?.source,i?.source){case"ContextMenu":s.contextMenuType=i.contextMenuType;break;case"KeyboardShortcut":s.shortcutType=i.shortcutType;break;case"InFocus":case"Skittle":s.skittleType=i.skittleType;break;case"Pane":s.paneType=i.paneType;break;case"MouseAction":s.mouseActionType=i.mouseActionType;break;case"Selection":case"DirectEdit":case"Popout":case"MiniToolbar":case"No Telemetry":case"Ribbon":case"Tooltip":case"VisualErrorOut":case"VisualHeader":break;default:g.fF.assertNever(i)}switch(e.name){case"Automatically expand field well section":s.closed=i.closed;break;case"ChangeAutoVisual":s.initialAutoVisualValue=i.initialAutoVisualValue;break;case"Change Format":s.isCartesian=P.includes(i.visualType);break;case"ChangeShowFieldAs":s.operationType=i.operationType;break;case"ChangeVisualType":s.sourceVisualType=i.sourceVisualType,s.targetVisualType=i.targetVisualType;break;case"VisualAction":case"PaneAction":s.action=i.action;break;case"Revert To Default":s.objectName=i.objectName;break;case"UpdateField":s.fieldType=i.fieldType,s.operationType=i.operationType;break;case"ChangeAggregation":case"EndDirectEdit":case"ExecuteNavigateShortcut":case"OpenSkittle":case"SelectVisualRecommendation":case"StartDirectEdit":case"Switch From Format Mode":case"Switch From Matrix View":case"Switch To Format Mode":case"Switch To Matrix View":case"Visual Container Deselection":case"Visual Container Selection":break;default:g.fF.assertNever(e.name)}this.certifiedTelemetryService.logTimedStandardizedFeatureEvent({resultCode:null,correlationId:this.sessionId,activityName:e.name,activityAttributes:s,featureName:"OnObject",activityStatus:"Succeeded",operationEndTime:e.end,operationStartTime:e.start})}this.isAtCapacity()&&(this.logTelemetry(),this.events=[])},n.prototype.closeSession=function(){this.isActive=!1,this.logTelemetry()},n.prototype.getEvents=function(){return this.events},n.prototype.logTelemetry=function(){this.telemetryService.logEvent(N._Z,{sessionId:this.sessionId,visualName:this.visualUid,data:JSON.stringify(this.events),isOnObject:!!this.featureSwitchService.featureSwitches.onObject})},n.prototype.isAtCapacity=function(){return!1},n.prototype.getVisualProperties=function(){var e,t,r;if(null!=this.canvasItem&&!(0,x.q4)(this.canvasItem))return{visualType:(0,j.s)(this.canvasItem),isAutoVisual:(0,T.II)(this.canvasItem),fieldKinds:_.map(null===(r=null===(t=null===(e=(0,T.Xf)(this.canvasItem))||void 0===e?void 0:e.defn)||void 0===t?void 0:t.select)||void 0===r?void 0:r.call(t),function(i){return(0,w.QR)(i.expr)})}},n}(),U=a(60756),m=a(91401),p=a(54952),V=a(72262),E=a(59142),A=a(77200),k=a(97128),F=a(9380),z=a(14463),f=a(29804),d=a(46544),R=a(63057),Z=a(59973),S=a(14172),$=a(23558),I=a(11105),l=a(50423),L=["ChangeAggregation","ChangeAutoVisual","Change Format","ChangeShowFieldAs","ChangeVisualType","EndDirectEdit","Revert To Default","Visual Container Deselection","Visual Container Selection","UpdateField","OpenSkittle","SelectVisualRecommendation","StartDirectEdit","Switch From Format Mode","Switch To Format Mode","VisualAction","ExecuteNavigateShortcut","PaneAction"],G=function(){function n(e,t,r,i,s,o,c){this.contextActivity=e,this.exploreNavigationService=t,this.viewModeState=r,this.selectionService=i,this.telemetryService=s,this.certifiedTelemetryService=o,this.featureSwitchService=c,this.sessions={}}return n.prototype.start=function(){var e=this,t=this.contextActivity.getActivityStream().pipe((0,U.l4)(m.Gb,m.xq,m.TH),(0,Z.h)(function(s){return L.includes(s.properties.name)})),r=this.selectionService.selectedElements$,i=this.viewModeState.getMode$();this.serviceSub=(0,R.T)(r.pipe((0,S.U)(function(s){return{source:"selection",data:s}})),i.pipe((0,S.U)(function(s){return{source:"viewMode",data:s}})),t.pipe((0,S.U)(function(s){return{source:"contextActivity",data:s}}))).pipe((0,$.M)(i)).subscribe(function(s){var o=s[0],v=o.data,u=s[1];switch(o.source){case"selection":1===u&&e.handleSessions(v);break;case"viewMode":e.handleViewMode(v);break;case"contextActivity":e.routeEvent(v.properties)}})},n.prototype.routeEvent=function(e){var t=e;if(!t.visualName)return["Switch To Format Mode","Switch From Format Mode"].includes(t.name)?void _.forEach(this.sessions,function(i){return i.addEvent(t)}):void(this.canvasSession&&this.canvasSession.addEvent(t));this.logEvent(e)},n.prototype.logEvent=function(e){var t=e,r=this.getVisualUid(this.exploreNavigationService.getCurrentSection().name,t.visualName),i=this.sessions[r];i&&i.addEvent(t)},n.prototype.handleViewMode=function(e){0===e&&this.clean()},n.prototype.clean=function(){this.closeAllSessions(),this.serviceSub.unsubscribe()},n.prototype.handleSessions=function(e){var r,t=this;if(this.timeoutId&&clearTimeout(this.timeoutId),0===e.length){var i=null===(r=this.exploreNavigationService.getCurrentSection())||void 0===r?void 0:r.name;return this.canvasSession=C.createSession(!0,(0,I.Z)(),i,this.telemetryService,this.certifiedTelemetryService,this.featureSwitchService,void 0),void(this.timeoutId=setTimeout(function(){t.closeAllSessions(),t.timeoutId=null},1e3))}this.canvasSession&&(this.canvasSession.closeSession(),this.canvasSession=void 0),Object.keys(this.sessions).forEach(function(h){return t.sessions[h].isActive=!1});for(var s=0,o=e;s<o.length;s++){var c=o[s],v=c.canvasItem.name,u=this.getVisualUid(this.exploreNavigationService.getCurrentSection().name,v),M=(0,f.z)();if(this.sessions[u])this.sessions[u].isActive=!0;else{var D=(0,I.Z)();this.sessions[u]=C.createSession(!0,D,u,this.telemetryService,this.certifiedTelemetryService,this.featureSwitchService,c.canvasItem),this.sessions[u].addEvent({name:"Visual Container Selection",end:M,start:M,data:{source:"Selection"},visualName:u})}}Object.keys(this.sessions).forEach(function(h){if(!1===t.sessions[h].isActive){var b=(0,f.z)();t.sessions[h].addEvent({name:"Visual Container Deselection",end:b,start:b,data:{source:"Selection"},visualName:t.sessions[h].visualUid}),t.sessions[h].closeSession(),delete t.sessions[h]}})},n.prototype.getVisualUid=function(e,t){return"".concat(e,"_").concat(t)},n.prototype.closeAllSessions=function(){_.forEach(this.sessions,function(e){var t=(0,f.z)();e.addEvent({name:"Visual Container Deselection",end:t,start:t,data:{source:"Selection"},visualName:e.visualUid}),e.closeSession()}),this.sessions={}},n.\u0275fac=function(t){return new(t||n)(l.\u0275\u0275inject(p.r),l.\u0275\u0275inject(E.I),l.\u0275\u0275inject(A.kc),l.\u0275\u0275inject(V.z),l.\u0275\u0275inject(d.y0),l.\u0275\u0275inject(d.ly),l.\u0275\u0275inject(F.vZ))},n.\u0275prov=l.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),X={provide:k.F,useFactory:function(n,e,t,r,i,s,o,c){var v=new G(e,t,i,r,s,o,c);return n.resolve(v)},deps:[z.t,p.r,E.I,V.z,A.kc,d.y0,d.ly,F.vZ]},Q=a(77476),W=a(77906),Y=function(){function n(){}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=l.\u0275\u0275defineInjector({providers:[X],imports:[Q.CommonModule,W.N]}),n}()}}]);