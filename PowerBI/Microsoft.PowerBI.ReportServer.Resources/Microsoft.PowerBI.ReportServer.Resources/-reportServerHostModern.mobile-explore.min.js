"use strict";(self.webpackChunkreportServerHostModern=self.webpackChunkreportServerHostModern||[]).push([["mobile-explore"],{93623:function(J,V,h){h.r(V),h.d(V,{MobileExploreModule:function(){return it}});var b,D=h(81337),C=h(84376),F=h(71901),g=h(98665),d=h(50423),S=h(11494),w=h(39503),p=h(83342),E=new d.InjectionToken("MobileReportConsumptionInjectionToken"),P=h(8590),f=h(59107),u=h(62458),v=h(5265),y=h(17774),M=Reflect.get,N=((b={}).sections=!0,b.visualContainers=!0,b.config=!0,b.singleVisual=!0,b),H=function(e){return!isNaN(e)};function O(s,e){e&&u.fF.assertFail("MobileObjectsProxy - ".concat(s))}var U=function(){function s(e,t,i,r,n){this.path=e,this.parentProp=t,this.state=i,this.services=r,this.cache=n}return s.prototype.get=function(e,t){var i,r,n,a;if("isJsProxy"===t)return!0;if("vcObjects"!==t&&"objects"!==t&&!e.hasOwnProperty(t))return e[t];var l=N[t]||N[this.parentProp]&&H(t),c=this.path;if(l&&this.path.endsWith(t)||(c=this.path+"."+t),!this.state.enabled)return O("ExplorationHandler: access ".concat(t," on ").concat(c),this.state.showWarnings),e[t];if(this.cache.has(c))return this.cache.get(c);if("singleVisual"===this.parentProp){if("vcObjects"===t){var j=null!==(i=e[t])&&void 0!==i?i:{};(o=e).mobileVcObjects=null!==(r=o.mobileVcObjects)&&void 0!==r?r:{};var x=(0,v.d9)(o.mobileVcObjects);(0,v.l7)(x,j,!1);var W=o?.visualType,m=new Proxy(x,new I(c,j,o.mobileVcObjects,this.state,this.services,new Map,W));return this.cache.set(c,m),m}if("objects"===t||"mobileTransformsObjects"===t){var o,B=null!==(n=e[t])&&void 0!==n?n:{};(o=e).mobileObjects=null!==(a=o.mobileObjects)&&void 0!==a?a:{};var L=(0,v.d9)(o.mobileObjects);return(0,v.l7)(L,B,!1),W=o?.visualType,m=new Proxy(L,new I(c,B,o.mobileObjects,this.state,this.services,new Map,W)),this.cache.set(c,m),m}}return l?(m=new Proxy(e[t],new s(c,t,this.state,this.services,new Map)),this.cache.set(c,m),m):e[t]},s.prototype.set=function(e,t,i){return!(!this.state.enabled||"vcObjects"!==t&&"objects"!==t)||(this.state.enabled||O("ExplorationHandler: setting ".concat(t," for ").concat(this.path),this.state.showWarnings),e[t]=i,(N[t]||N[this.parentProp]&&H(t))&&this.cache.clear(),!0)},s}(),I=function(){function s(e,t,i,r,n,a,l){this.path=e,this.masterObjects=t,this.mobileObjects=i,this.state=r,this.services=n,this.cache=a,this.visualType=l}return s.prototype.ownKeys=function(e){return this.state.enabled?Object.keys(e):this.masterObjects?Object.keys(this.masterObjects):[]},s.prototype.has=function(e,t){return this.state.enabled?t in e:t in this.masterObjects},s.prototype.get=function(e,t){if(!e.hasOwnProperty(t))return e[t];var i=this.path+"."+t;return this.state.enabled?(this.cache.has(i)||this.cache.set(i,new Proxy(e[t],new K(i,t,this.masterObjects,this.mobileObjects,this.state,this.services,new Map,this.visualType))),this.cache.get(i)):(O("DataViewObjectDefinitionsHandler: access ".concat(t," on ").concat(i),this.state.showWarnings),this.masterObjects&&this.masterObjects[t])},s.prototype.set=function(e,t,i){return this.state.enabled?(_.isArray(i)||O("unknown value type ".concat(i),this.state.showWarnings),this.mobileObjects[t]=(0,v.dn)(i),e[t]=i,this.cache.clear(),!0):(O("DataViewObjectDefinitionsHandler: setting ".concat(t," for ").concat(this.path),this.state.showWarnings),this.masterObjects[t]=i,e[t]=i,!0)},s.prototype.deleteProperty=function(e,t){var i;return this.state.enabled?(this.mobileObjects[t]&&delete this.mobileObjects[t],delete e[t],!(null===(i=this.masterObjects)||void 0===i)&&i[t]&&(e[t]=(0,v.dn)(this.masterObjects[t])),this.cache.clear(),!0):(O("DataViewObjectDefinitionsHandler: deleteProperty ".concat(t," for ").concat(this.path),this.state.showWarnings),!0)},s}(),K=function(){function s(e,t,i,r,n,a,l,c){this.path=e,this.cardName=t,this.masterObjects=i,this.mobileObjects=r,this.state=n,this.services=a,this.cache=l,this.visualType=c}return s.prototype.get=function(e,t){if(!_.isArray(e))return O("unknown target type ".concat(typeof e),this.state.showWarnings),e[t];if(!this.state.enabled){O("DataViewObjectDefinitionArrayHandler: access ".concat(t.toString()," on ").concat(this.path),this.state.showWarnings);var i=this.masterObjects&&this.masterObjects[this.cardName];return i&&i[t]}if(Array.prototype.hasOwnProperty(t)){if("toString"===t||!_.isFunction(e[t]))return e[t];if("constructor"===t){var r=this;return function(l){var c=new Array(l);return new Proxy(c,new s(r.path,t,r.masterObjects,r.mobileObjects,r.state,r.services,new Map,r.visualType))}.bind(this)}this.mobileObjects[this.cardName]||(this.mobileObjects[this.cardName]=[]);var n=new Z(e,this.mobileObjects[this.cardName],t);return M(n,"invoke")}if(!e.hasOwnProperty(t))return e[t];if(H(t)){var a=this.path+"."+t;return this.cache.has(a)||this.cache.set(a,new Proxy(e[t],new G(a,this.cardName,t,this.masterObjects,this.mobileObjects,this.state,this.services,new Map,this.visualType))),this.cache.get(a)}return e[t]},s}(),k={find:!0,filter:!0,some:!0},Z=function(){function s(e,t,i){this.target=e,this.copy=t,this.prop=i,this.invoke=this.invoke.bind(this)}return s.prototype.invoke=function(e){var t;if(this.target!==this.copy&&!k[this.prop]){var i=e&&(null===(t=(0,v.dn)([e]))||void 0===t?void 0:t[0]);this.copy[this.prop](i)}return this.target[this.prop](e)},s}(),G=function(){function s(e,t,i,r,n,a,l,c,o){this.path=e,this.cardName=t,this.index=i,this.masterObjects=r,this.mobileObjects=n,this.state=a,this.services=l,this.cache=c,this.visualType=o,this.visualPropertyFilter=new y.pI(a,t,n,l,o)}return s.prototype.get=function(e,t){if("isJsProxy"===t)return!0;if(!e.hasOwnProperty(t))return e[t];var i=this.path+"."+t;if(!this.state.enabled){O("DataViewObjectDefinitionHandler: access ".concat(t," on ").concat(i),this.state.showWarnings);var r=this.masterObjects&&this.masterObjects[this.cardName],n=r&&r[this.index];return n&&n[t]}return"properties"===t&&this.cardName?(this.cache.has(i)||this.cache.set(i,new Proxy(e[t],new Q(i,this.cardName,this.index,this.mobileObjects,this.masterObjects,e.selector,this.state,this.services,this.visualType))),this.cache.get(i)):e[t]},s.prototype.set=function(e,t,i){if("properties"===t&&this.cardName){if(!this.state.enabled||this.state.viewMode)return this.state.enabled||O("DataViewObjectDefinitionHandler: setting ".concat(t),this.state.showWarnings),(0,v.zx)(this.masterObjects,this.cardName,e.selector)[t]=i,e[t]=i,this.cache.clear(),!0;this.visualPropertyFilter.setMobileObjectsValue(t,i,e,e.selector),this.cache.clear()}return e[t]=i,!0},s}(),Q=function(){function s(e,t,i,r,n,a,l,c,o){this.path=e,this.cardName=t,this.index=i,this.mobileObjects=r,this.masterObjects=n,this.selector=a,this.state=l,this.services=c,this.visualType=o,this.visualPropertyFilter=new y.pI(l,t,r,c,o)}return s.prototype.has=function(e,t){var i,r,n;return this.state.enabled?t in e:t in(null===(n=null===(r=null===(i=this.masterObjects)||void 0===i?void 0:i[this.cardName])||void 0===r?void 0:r[this.index])||void 0===n?void 0:n.properties)},s.prototype.get=function(e,t){if(!e.hasOwnProperty(t))return e[t];var i=this.path+"."+t;if(!this.state.enabled){O("DataViewObjectPropertyDefinitionHandler: access ".concat(t," on ").concat(i),this.state.showWarnings);var r=this.masterObjects&&this.masterObjects[this.cardName],n=r&&r[this.index],a=n&&n.properties;return a&&a[t]}return e[t]},s.prototype.set=function(e,t,i){return!this.state.enabled||this.state.viewMode?(this.state.enabled||O("DataViewObjectPropertyDefinitionHandler: setting ".concat(t),this.state.showWarnings),(0,v.zx)(this.masterObjects,this.cardName,this.selector).properties[t]=i,e[t]=i,!0):(this.visualPropertyFilter.setMobileObjectsPropertiesValue(t,i,this.selector),e[t]=i,!0)},s.prototype.deleteProperty=function(e,t){var i,r,n,a,l,c,o,j;if(!this.state.enabled)return O("DataViewObjectPropertyDefinitionHandler: deleteProperty ".concat(t," for ").concat(this.path),this.state.showWarnings),!0;if(delete e[t],this.state.viewMode)return null===(a=null===(n=null===(r=null===(i=this.masterObjects)||void 0===i?void 0:i[this.cardName])||void 0===r?void 0:r[this.index])||void 0===n?void 0:n.properties)||void 0===a||delete a[t],!0;var x=(0,y.cH)(this.masterObjects,this.cardName,t,this.selector);return x&&this.visualPropertyFilter.shouldSetFilteringProps(t)&&(e[t]=_.clone(x).properties[t]),null===(j=null===(o=null===(c=null===(l=this.mobileObjects)||void 0===l?void 0:l[this.cardName])||void 0===c?void 0:c[this.index])||void 0===o?void 0:o.properties)||void 0===j||delete j[t],!0},s}(),T=h(29866),X={provide:"visualFilterProperties",useFactory:function(s){return new A(s)},deps:[T.D]},A=function(){function s(e){this.visualPlugin=e,this.filterPropertiesCache=new Map}return s.prototype.ngOnDestroy=function(){this.filterPropertiesCache.clear()},s.prototype.getProperties=function(e,t){var i;if(this.filterPropertiesCache.has(e))return this.filterPropertiesCache.get(e);var r=null===(i=this.visualPlugin)||void 0===i?void 0:i.capabilities(e),n=new Set;return _.forEach(r?.objects,function(a){a?.properties&&Object.entries(a.properties).forEach(function(l){var c=l[0],o=l[1],j=o?.type;!t?.has(c)&&(o?.filterState||j?.filter)&&n.add(c)})}),this.filterPropertiesCache.set(e,n),n},s.\u0275fac=function(t){return new(t||s)(d.\u0275\u0275inject(T.D))},s.\u0275prov=d.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac}),s}(),q={provide:"mobileVcObjectsProxy",useFactory:function(s,e,t,i,r){return new Promise(function(n){n(new z(s,e,t,i,r))})},deps:[S.J,w.z,p.vZ,"visualFilterProperties",[new d.Optional,E]]},z=function(){function s(e,t,i,r,n){var a=this;this.explorationNavigation=t,this.featureSwitches=i,this.visualFilterProperties=r,this.state={enabled:!0,ignoreFilteringProps:!1,showWarnings:!0,viewMode:!0},this.state.viewMode=!!n,this.services={visualFilterProperties:r},i.featureSwitches.mobileVcObjectsProxyFormFactorChange&&(this.state.enabled=!1,this.subscriptionManager=e.createChannelSubscriptionManager().subscribe(P.aco,function(l,c){setTimeout(function(){return a.state.showWarnings=1!==c.layout})})),i.featureSwitches.interactiveMobileCanvas&&(this.state.ignoreFilteringProps=!0)}return s.prototype.ngOnDestroy=function(){this.subscriptionManager.unsubscribeAll()},s.prototype.wrap=function(e,t){if(void 0===t&&(t=!0),this.isSupported()){if(this.isProxy(e))return e;this.state.enabled=!0,this.masterContract=e;var i=new Proxy(e,new U("[root]","",this.state,this.services,new Map));return t&&this.resetNavigationService(i),i}u.fF.assertFail("Can not wrap in IE")},s.prototype.unwrap=function(e){if(void 0===e&&(e=!0),this.masterContract){var t=this.masterContract;return this.masterContract=void 0,e&&this.resetNavigationService(t),this.featureSwitches.featureSwitches.mobileVcObjectsProxyFormFactorChange&&(this.state.enabled=!1),t}},s.prototype.isSupported=function(){var e;return this._isSupported=null!==(e=this._isSupported)&&void 0!==e?e:this.state.viewMode||!f.M.isInternetExplorerOrEdge(),this._isSupported},s.prototype.resetNavigationService=function(e){this.explorationNavigation.loadExploration(e)},s.prototype.isProxy=function(e){return!!e.isJsProxy},s.\u0275fac=function(t){return new(t||s)(d.\u0275\u0275inject(S.J),d.\u0275\u0275inject(w.z),d.\u0275\u0275inject(p.vZ),d.\u0275\u0275inject(A),d.\u0275\u0275inject(E,8))},s.\u0275prov=d.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac}),s}(),et={provide:"mobileStateConsumptionService",useFactory:function(s,e){return(0,D.mG)(this,void 0,void 0,function(){var t,i;return(0,D.Jh)(this,function(r){switch(r.label){case 0:return t=R.bind,i=[void 0,s],[4,e];case 1:return[2,new(t.apply(R,i.concat([r.sent()])))]}})})},deps:[g.y0,"mobileVcObjectsProxy"]},R=function(){function s(e,t){this.telemetryService=e,this.mobileVcObjectsProxy=t}return s.prototype.apply=function(e,t,i){var r;if(i.bookmark||!_.isEmpty(i.visualPositions))return(0,F.zi)(t,null===(r=i.bookmark)||void 0===r?void 0:r.explorationState,i.visualPositions,this.telemetryService.startEvent(C.Y8)),this.changeLayout(e,t,!1)},s.prototype.changeLayout=function(e,t,i){return void 0===i&&(i=!0),1===e?this.mobileVcObjectsProxy.wrap(t,i):this.mobileVcObjectsProxy.unwrap(i)},s.\u0275fac=function(t){return new(t||s)(d.\u0275\u0275inject(g.y0),d.\u0275\u0275inject(z))},s.\u0275prov=d.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac}),s}(),it=function(){function s(){}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=d.\u0275\u0275defineNgModule({type:s}),s.\u0275inj=d.\u0275\u0275defineInjector({providers:[q,et,X]}),s}()},17774:function(J,V,h){h.d(V,{cH:function(){return d},pI:function(){return E}});var D=h(9434),C=h(32379),F=h(5265),g=h(45413);function d(P,f,u,v){var y;return null===(y=P?.[f])||void 0===y?void 0:y.find(function(b){var M;return(null===(M=b?.properties)||void 0===M?void 0:M[u])&&(0,C.fS)(b?.selector,v)})}var w=D.gO.data.mode.propertyName,p=new Set([w]),E=function(){function P(f,u,v,y,b){this.state=f,this.cardName=u,this.defns=v,this.services=y,this.visualType=b}return P.prototype.setMobileObjectsValue=function(f,u,v,y){this.state.ignoreFilteringProps&&(!this.state.ignoreFilteringProps||this.propExistsInDefn(u)||this.slicerModePersistWithoutChange(u,v[f]))||((0,F.zx)(this.defns,this.cardName,y)[f]=u)},P.prototype.setMobileObjectsPropertiesValue=function(f,u,v){this.shouldSetFilteringProps(f)&&((0,F.zx)(this.defns,this.cardName,v).properties[f]=u)},P.prototype.shouldSetFilteringProps=function(f){return!this.state.ignoreFilteringProps||!this.services.visualFilterProperties.getProperties(this.visualType,p).has(f)},P.prototype.propExistsInDefn=function(f){return function(P,f){for(var u=P.values(),v=u.next();!v.done;){if(f.hasOwnProperty(v.value))return!0;v=u.next()}return!1}(this.services.visualFilterProperties.getProperties(this.visualType,p),f)},P.prototype.slicerModePersistWithoutChange=function(f,u){if(f.hasOwnProperty(w)&&(0,g.fS)(u?.[w],f[w]))return!0},P}()}}]);