"use strict";(self.webpackChunkreportServerHostModern=self.webpackChunkreportServerHostModern||[]).push([["contract-validator"],{73566:function(z,S,o){o.d(S,{E:function(){return i}});var P=o(77476),R=o(9398),N=o(82156),E=o(8483),V=o(50423),i=function(){function c(){}return c.\u0275fac=function(y){return new(y||c)},c.\u0275mod=V.\u0275\u0275defineNgModule({type:c}),c.\u0275inj=V.\u0275\u0275defineInjector({imports:[P.CommonModule,N.N,R.Bz.forChild(E.Vc)]}),c}()},8483:function(z,S,o){o.d(S,{Vc:function(){return V},yO:function(){return N}});var P=o(50423),R=o(76072),N=new P.InjectionToken("JsonSchemaValidationService"),E={loadChildren:function(){return o.e("json-schema-validation-lazy").then(o.bind(o,98909)).then(function(c){return c.JsonSchemaValidationLazyModule})}};R.E.addLazyLoadForLegacyMapping("@powerbi/JsonSchemaValidation/lazy/json-schema-validation-lazy-module#JsonSchemaValidationLazyModule",E.loadChildren);var V=[{path:"dummy-json-schema-validation-lazy",loadChildren:E.loadChildren}]},35924:function(z,S,o){o.r(S),o.d(S,{ReportDefinitionContractValidatorModule:function(){return U}});var P=o(77476),R=o(73566),N=o(82156),E=o(9215),V=o(68859),i=o(38504);function y(n,a,t,e){void 0===e&&(e=50);var r=[];return(null==n||0===n.length||n.length>e)&&r.push({type:i.sw,level:i.qB.Error,code:a??i.GS.GenericHasInvalidName,localizationArgs:t}),r}var D=o(81337);function h(n,a,t){if(null==n)return[];for(var e=[],r=new Set,l=new Set,s=0,d=n;s<d.length;s++){var u=d[s];if(void 0!==u){if(r.has(u)&&!l.has(u)){e.push({type:i.sw,level:i.qB.Error,code:a??i.GS.GenericHasDuplicateNames,localizationArgs:(0,D.pi)({fieldName:u},t)}),l.add(u);continue}r.add(u)}}return e}var O=o(60661),M=o(50423),J=o(29866),T=function(){function n(a){this.visualPluginService=a}return n.prototype.validate=function(a,t,e){void 0===t&&(t=!0);var r=e?.createChildActivity({name:"ReportContractValidationStep"}),l=[];if(l.push.apply(l,function(n,a){return void 0===a&&(a=!0),null==n.activeSectionIndex||n.activeSectionIndex<0||n.activeSectionIndex>=n.sections.length?(a&&(n.activeSectionIndex=0),[{type:i.sw,level:i.qB.Warning,code:i.GS.ReportHasInvalidActiveSectionIndex}]):[]}(a)),l.push.apply(l,function(n){var a=[];return _.isEmpty(n)&&a.push({type:i.sw,level:i.qB.Error,code:i.GS.ReportHasNoPages}),a}(a.sections)),!_.isEmpty(a.filters)){for(var s=0,d=a.filters;s<d.length;s++){var u=d[s];l.push.apply(l,y(u.name,i.GS.ReportHasInvalidFilterName,{fieldName:u.name}))}l.push.apply(l,h(_.map(a.filters,function(f){return f.name}),i.GS.ReportHasDuplicateFilterNames))}l.push.apply(l,h(_.map(a.pods,function(f){return f.name}),i.GS.ReportHasDuplicatePageBindingNames)),l.push.apply(l,h(_.map(a.sections,function(f){return f.name}),i.GS.ReportHasDuplicateSectionNames));for(var v=0,m=a.sections;v<m.length;v++){var p=this.validatePage(m[v],t);null!=p&&l.push.apply(l,p)}if(r?.setProperty("errorCodes",_.map(l,function(f){return f.code})),r?.resolve(),0!==l.length)return l},n.prototype.validatePage=function(a,t){void 0===t&&(t=!0);var e=[];if(e.push.apply(e,y(a.name,i.GS.PageHasInvalidName,{pageName:a.name})),!_.isEmpty(a.filters)){for(var r=0,l=a.filters;r<l.length;r++){var s=l[r];e.push.apply(e,y(s.name,i.GS.PageHasInvalidFilterName,{fieldName:s.name,pageName:a.name}))}e.push.apply(e,h(_.map(a.filters,function(p){return p.name}),i.GS.PageHasDuplicateFilterNames,{pageName:a.name}))}e.push.apply(e,function(n){if(null==n.relationships)return[];for(var a=[],t=new Set,e=new Set,r=0,l=n.visualContainers;r<l.length;r++)e.add(l[r].name);for(var d=0,u=n.relationships;d<u.length;d++){var v=u[d];!t.has(v.source.name)&&!e.has(v.source.name)&&(t.add(v.source.name),a.push({type:i.sw,level:i.qB.Warning,code:i.GS.PageHasInvalidVisualInteractions,localizationArgs:{fieldName:v.source.name,pageName:n.name}})),!t.has(v.target.name)&&!e.has(v.target.name)&&(t.add(v.target.name),a.push({type:i.sw,level:i.qB.Warning,code:i.GS.PageHasInvalidVisualInteractions,localizationArgs:{fieldName:v.target.name,pageName:n.name}}))}return a}(a)),e.push.apply(e,function(n){return 0===n.size.displayOption?[]:null==n.size.height||null==n.size.width?[{type:i.sw,level:i.qB.Error,code:i.GS.PageHasInvalidPageDisplayOption,localizationArgs:{pageName:n.name}}]:[]}(a));var d=(0,V.qH)(a);e.push.apply(e,h(_.map(d,function(p){return p.name}),i.GS.PageHasDuplicateVisualNames,{pageName:a.name}));for(var u=0,v=d;u<v.length;u++){var g=this.validateCanvasItem(v[u],a.name);null!=g&&e.push.apply(e,g)}if(0!==e.length)return e},n.prototype.validateCanvasItem=function(a,t){var e=[];if(e.push.apply(e,y(a.name,i.GS.VisualHasInvalidName,{visualName:a.name,pageName:t})),(0,E.Vz)(a)){if(!_.isEmpty(a.filters)){for(var r=0,l=a.filters;r<l.length;r++){var s=l[r];e.push.apply(e,y(s.name,i.GS.VisualHasInvalidFilterName,{fieldName:s.name,visualName:a.name,pageName:t}))}e.push.apply(e,h(_.map(a.filters,function(d){return d.name}),i.GS.VisualHasDuplicateFilterNames,{pageName:t,visualName:a.name}))}e.push.apply(e,function(n,a){var t=(0,O.oJ)(n);if(_.isEmpty(t))return[];var e=_.map(t,function(r){return r.name});return a.visualName=n.name,h(e,i.GS.VisualHasDuplicateQueryRefs,a)}(a,{pageName:t})),e.push.apply(e,function(n,a,t){var e,r,l,s=[];if(null==(null===(e=a.config.singleVisual.query)||void 0===e?void 0:e.expansionStates))return s;var d=n.capabilities(a.config.singleVisual.visualType);if(null==d)return s;for(var u=0,v=null===(r=a.config.singleVisual.query)||void 0===r?void 0:r.expansionStates;u<v.length;u++)for(var p=function(G){null==(null===(l=d.dataRoles)||void 0===l?void 0:l.find(function(w){return w.name===G}))&&s.push({type:i.sw,level:i.qB.Error,code:i.GS.VisualHasInvalidExpansionStateRole,localizationArgs:(0,D.pi)({fieldName:G,visualName:a.name},t)})},f=0,H=v[u].roles;f<H.length;f++)p(H[f]);return s}(this.visualPluginService,a,{pageName:t})),e.push.apply(e,function(n,a){var t,e,r=[];if(null==(null===(t=n.config.singleVisual.query)||void 0===t?void 0:t.expansionStates))return r;var l=[];for(var s in n.config.singleVisual.query.projections)l.push.apply(l,null!==(e=n.config.singleVisual.query.projections[s].getQueryRefs())&&void 0!==e?e:[]);for(var d=0,u=n.config.singleVisual.query.expansionStates;d<u.length;d++)for(var m=0,g=u[d].levels;m<g.length;m++){var p=g[m];l.includes(p.queryRefs[0])||r.push({type:i.sw,level:i.qB.Error,code:i.GS.VisualHasInvalidExpansionStateField,localizationArgs:(0,D.pi)({fieldName:p.queryRefs[0],visualName:n.name},a)})}return r}(a,{pageName:t}))}if(0!==e.length)return e},n.prototype.isContractValidationResult=function(a){return a.type===i.sw},n.\u0275fac=function(t){return new(t||n)(M.\u0275\u0275inject(J.D))},n.\u0275prov=M.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n}(),W=o(61032),U=function(){function n(){}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=M.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=M.\u0275\u0275defineInjector({providers:[N.N.withLazyService(W.ig,T)],imports:[P.CommonModule,N.N,R.E]}),n}()}}]);