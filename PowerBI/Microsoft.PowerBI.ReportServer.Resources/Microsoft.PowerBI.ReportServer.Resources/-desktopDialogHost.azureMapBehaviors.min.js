"use strict";(self.webpackChunkdesktopDialogHost=self.webpackChunkdesktopDialogHost||[]).push([["azureMapBehaviors"],{2379:function(W,F,D){D.d(F,{b:function(){return A}});var M=D(81337),x=D(92379),A=function(){function P(){}return P.createMultiPolygonCoordinatesFromPaths=function(v,m){var y=[];if(v.filter(function(n){return n.geographic}).forEach(function(n){var c,s=[];n.geographic.forEach(function(e,t){t%2==0?c=e:s.push([e,c])}),y.push(s)}),0===y.length)return[];for(var p=[[y[0]]],d=1;d<y.length;d++){var u=p[p.length-1],g=y[d];this.isPointInsidePolygon(g[0],u[0])?u.push(g):p.push([g])}return this.combineMultiPolygonCoordinatesAtAntimeridian(m,p)},P.combineMultiPolygonCoordinatesAtAntimeridian=function(v,m){return this.shouldCheckAntimeridianCrossing(v)?this.checkAndMergePolygonsAtAntimeridian(m):m},P.shouldCheckAntimeridianCrossing=function(v){var m=new atlas.data.BoundingBox([19.8,41.2,-169.6,81.45]);return v.longitude>175||v.longitude<-175||!!atlas.data.BoundingBox.containsPosition(m,[v.longitude,v.latitude])},P.checkAndMergePolygonsAtAntimeridian=function(v){for(var m=v.map(function(o){return atlas.data.BoundingBox.fromPositions(o[0])}),y=[],p=[],d=[],u=0;u<m.length;u++){var g=atlas.data.BoundingBox.getEast(m[u]),l=atlas.data.BoundingBox.getWest(m[u]),n=_.cloneDeep(v[u]),s=m[u];180===g||-180===g?(y.push({polygon:n,boundingBox:s}),d.push(y.length-1)):180===l||-180===l?p.push({polygon:n,boundingBox:s}):y.push({polygon:n,boundingBox:s})}for(var c=0,r=d;c<r.length;c++)for(var t=y[r[c]],a=0;a<p.length;a++)if(this.matchAndMerge(t.polygon,p[a].polygon)){p.splice(a,1);break}return y.map(function(o){return o.polygon})},P.matchAndMerge=function(v,m){for(var y=this,p=(0,M.__spreadArray)([],v[0],!0),d=(0,M.__spreadArray)([],m[0],!0),g=0;Math.abs(p[0][0]-180)<this.floatPrecision&&g<3;)p.push(p.shift()),g+=1;for(g=0;Math.abs(d[0][0]+180)<this.floatPrecision&&g<3;)d.push(d.shift()),g+=1;var l=_.findIndex(p,function(S){return Math.abs(S[0]-180)<y.floatPrecision}),n=_.findLastIndex(p,function(S){return Math.abs(S[0]-180)<y.floatPrecision}),s=_.findIndex(d,function(S){return Math.abs(S[0]+180)<y.floatPrecision}),c=_.findLastIndex(d,function(S){return Math.abs(S[0]+180)<y.floatPrecision});if(-1===l||n===l||-1===s||c===s)return!1;var r=p[l][1],e=p[n][1],t=d[s][1],a=d[c][1],i=Math.max(e,t)-Math.min(r,a),o=Math.min(e,t)-Math.max(r,a);if(i>0&&o/i>.9){var f=p.slice(0,l+1),h=p.slice(n);d.forEach(function(S){return S[0]+=360});var b=d.slice(0,s+1),C=d.slice(c);return v[0]=f.concat(C,b,h),v.push.apply(v,m.slice(1)),!0}return!1},P.isPointInsidePolygon=function(v,m){for(var y=0,p=0,d=m.length-1;p<m.length;d=p++)this.isRayCrossEdgeUpward(v,m[p],m[d])&&y++;return y%2==1},P.isRayCrossEdgeUpward=function(v,m,y){var p=v[0],d=v[1],u=m[0],g=m[1],l=y[0],n=y[1];return Math.abs(l-u)>180&&(p>0?(u<0&&(u+=360),l<0&&(l+=360)):(u>0&&(u-=360),l>0&&(l-=360))),u>p!=l>p&&d<(n-g)*(p-u)/(l-u)+g},P.shapesWithinPolygon=function(v,m){var y=[];if(v&&m){var u,p={},d=[],g=v instanceof atlas.source.DataSource?v.getShapes():v;_.forEach(g,function(n){u=n.getId(),p[u]=n,d.push({id:u,coordinates:n.getProperties().coordinates})}),y=P.pointsWithinPolygon(d,m).map(function(n){return p[n.id]})}return y},P.pointsWithinPolygon=function(v,m){if(v&&m){var y=P.getPolygon(m),p=P.getPowerBIShapePolygon(y);return v.filter(function(u){return p.inside(P.getPowerBIShapePoint(u.coordinates))})}return[]},P.getPowerBIShapePoint=function(v){return{x:v[0],y:v[1]}},P.getPowerBIShapePolygon=function(v){var y=[].concat.apply([],v.coordinates).map(function(p){return{x:atlas.math.normalizeLongitude(p[0]),y:atlas.math.normalizeLatitude(p[1])}});return x.m.fromPolygonPoints(y)},P.getPolygon=function(v){var m;if(v instanceof atlas.Shape)v.isCircle()?m=new atlas.data.Polygon([v.getCircleCoordinates()]):v.getType().indexOf("Polygon")>-1&&(m=v.toJson().geometry);else{var y=v;"Feature"===y.type&&("Point"===y.geometry.type&&"Circle"===y.properties.subType&&"number"==typeof y.properties.radius?m=new atlas.data.Polygon(atlas.math.getRegularPolygonPath(y.geometry.coordinates,y.properties.radius,72,"meters")):y.geometry.type.indexOf("Polygon")>-1&&(m=y.geometry)),-1!==y.type.indexOf("Polygon")&&(m=v)}return m},P.floatPrecision=1e-4,P}()},49988:function(W,F,D){D.d(F,{t:function(){return g}});var M=D(81337),x=D(65363),A=function(n,s,c,r,e,t,a,i,o){var f=n,h=Math.PI,b="";i&&(b=' mask="url(#'.concat(i,'"'));var C=void 0!==n.selectionPieIndexes&&void 0===n.selectionPieIndexes.filter(function(T){return T===o})[0]?n.deselectedPieOpacity:1,S=n.gaussianBlurStandardDeviation?'filter="url(#f1)"':"";if(t>2*h*.99)return'<circle r="'.concat(r,'" cx="').concat(s,'" cy="').concat(c,'" ').concat(S,' style="opacity:').concat(C,";stroke-opacity:").concat(f.strokeOpacity,";fill:").concat(a,";stroke:").concat(f.strokeColor,";stroke-width:").concat(f.strokeWidth,'px;"').concat(b,"></circle>");var O=Math.sin,B=Math.cos,I=s+r*O(e),L=c-r*B(e),E=s+r*O(e+t),z=c-r*B(e+t),k=0;return t>h&&(k=1),'<path d="M'.concat(s," ").concat(c," L ").concat(I," ").concat(L," A ").concat(r,",").concat(r," 0 ").concat(k," 1 ").concat(E," ").concat(z,'z" ').concat(S,' style="opacity:').concat(C,";stroke-opacity:").concat(f.strokeOpacity,";fill:").concat(a,";stroke:").concat(f.strokeColor,";stroke-width:").concat(f.strokeWidth,'px;"').concat(b,"></path>")},v=function(n,s,c){return function(n){var o,s=n.values,c=n.radius,r=0,e=0,t=c+n.strokeWidth,a=['<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(2*t,'px" height="').concat(2*t,'px" opacity="').concat(void 0!==n.opacity||null!==n.opacity?n.opacity:1,'">')],i='<filter id="f1" x="0" y="0"><feGaussianBlur in="SourceGraphic" stdDeviation="'.concat(n.gaussianBlurStandardDeviation,'" /></filter>');a.push("\n        <defs>".concat(n.gaussianBlurStandardDeviation?i:"","</defs>\n    ")),n.innerRadius>0&&n.innerRadius<=n.radius&&(o="piechart-innercircle-"+Math.round(1e7*Math.random()),a.push('<defs><mask id="'.concat(o,'"><rect width="100%" height="100%" fill="white"/><circle r="').concat(n.innerRadius,'" cx="').concat(t,'" cy="').concat(t,'" fill="black"/></mask></defs>\n            <circle r="').concat(n.innerRadius,'" cx="').concat(t,'" cy="').concat(t,'" style="fill:').concat(n.fillColor,";stroke:").concat(n.strokeColor,";stroke-width:").concat(2*n.strokeWidth,'px;"/>')));var f=s.reduce(function(I,L){return I+L.count},0);if(f>0)for(var h=2*Math.PI/f,b=0;b<s.length;b++)a.push(A(n,t,t,c,r,e=h*s[b].count,s[b].fill,o,b)),r+=e;var S=n.text;return S&&a.push('<text x="'.concat(t,'" y="').concat(t+7,'" style="font-size:').concat(16,'px;font-family:arial;fill:#000;font-weight:bold;" class="').concat(n.textClassName||"",'" text-anchor="middle">').concat(S,"</text>")),a.push("</svg>"),a.join("")}(m(n,s,c))},m=function(n,s,c){return{values:n.subDataPoints.map(function(r){return{count:Math.max(r.size,0),fill:r.color}}),radius:n.bubbleRadius,pixelOffset:[0,0],innerRadius:0,colors:[],fillColor:"transparent",gaussianBlurStandardDeviation:s.blur,strokeWidth:s.strokeWidth,strokeColor:s.strokeColor,strokeOpacity:1-s.strokeTransparency/100,textClassName:void 0,opacity:1-s.transparency/100,selectionPieIndexes:c||n.subDataPoints.map(function(r,e){return e}),deselectedPieOpacity:.1}},p=function l(n,s){return s?l(s,n%s):n},g=function(){function l(n){this.cache={},this.imageSprite=n}return l.prototype.clearAll=function(){this.imageSprite.clear(),this.cache={}},l.hash=function(n,s,c){return function(n){var s=n.values.map(function(t){return t.count}),c=function(n,s){for(var c=n[0],r=1;r<s;r++)if(1===(c=p(n[r],c)))return 1;return c}(s,s.length);return function(n){var c,e,s=0;if(0===n.length)return s;var t=n.toLowerCase();for(c=0,e=t.length;c<e;c++)s=(s<<5)-s+t.charCodeAt(c),s|=0;return s}(Object.keys(n).filter(function(t){return"values"!==t&&(void 0!==n[t]||null!==n[t])}).map(function(t){return{key:t,value:n[t]}}).concat([{key:"values",value:n.values.map(function(t){return["fill=".concat(t.fill),"count=".concat(t.count/c)].join(",")}).join(";")}]).map(function(t){var a=t.key,i=t.value,o=i instanceof Array?i.join(","):"".concat(i);return"".concat(a,"=").concat(o)}).join(";"))}(m(n,s,c))},l.prototype.svgContent=function(n,s,c,r){void 0===c&&(c=!1);var e=c?(0,M.__assign)((0,M.__assign)({},s),{transparency:100}):s,t=l.hash(n,e,r),a=this.cache[t];if(void 0!==a)return a.svgContent;var i=v(n,e,r);return this.cache[t]={svgContent:i},i},l.prototype.objectUrl=function(n,s,c){var r=l.hash(n,s,c),e=this.cache[r];if(void 0!==e&&e.objectUrl)return e.objectUrl;if(void 0!==e){var t=new Blob([e.svgContent],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(t);return e.objectUrl=a,this.cache[r].objectUrl=a,a}var i=v(n,s,c),o=(t=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),URL.createObjectURL(t));return this.cache[r]={objectUrl:o,svgContent:i},o},l.prototype.loadIcon=function(n,s,c,r){var e=r??l.hash(n,s,c);if(this.cache[e]&&this.cache[e].objectUrl||this.imageSprite.hasImage(e.toString()))return(0,x.DR)(void 0);var t=this.objectUrl(n,s,c);return this.imageSprite.add(e.toString(),t)},l}()},35824:function(W,F,D){D.r(F),D.d(F,{AzureMapBehavior:function(){return c}});var M=D(81337),x=D(66232),A=D(30237),P=D(38400),v=D(64067),m=D(62458),y=D(59107),p=D(70508),d=D(72118),u=D(81293),g=D(19076),l=D(49988);function n(r){var e;return r&&!0===(null===(e=r.properties)||void 0===e?void 0:e.cluster)}function s(r){return r&&void 0!==r.getProperties}var c=function(){function r(){var e=this;this.hasSelection=!1,this.visualHasSelection=function(){return e.hasSelection},this.featureMouseover=function(t){var a;if(e.formatMode){e.mapControl.getCanvasContainer().style.cursor="pointer";var i=e.findSubDataPointByMouseEvent(t);if(i){var o=e.createVisualSubSelection(t,i,!0),f=null===(a=_.first(o.visualObjects))||void 0===a?void 0:a.objectName,h=e.subSelectionHelper.getRegionOutline(f);(!h||0===h.visibility)&&(e.subSelectionHelper.updateCustomOutlinesFromSubSelections([o],1),e.subSelectionHelper.renderOutlines())}}},this.featureMousemove=function(t,a){if(!e.formatMode){var i=e.findSubDataPointByMouseEvent(t);if(i){e.mapControl.getCanvasContainer().style.cursor="pointer";var o=t.originalEvent;i?.tooltipInfo&&a([o.x,o.y],i)}}},this.featureMouseout=function(t,a){if(e.mapControl.getCanvasContainer().style.cursor="grab",e.formatMode){var i=t.originalEvent;(0,x.n)(i),i.preventDefault(),e.subSelectionHelper.clearHoveredOutline()}else a()},this.mapClicked=function(t){y.M.isCtrlOrMeta(t.originalEvent)||e.selectionHandler.handleClearSelection()},this.featureClicked=function(t){if(t){var a=_.filter(t.shapes,s),i=u.l.findDataPointsByShapes(e.selectableDataPoints,a);if(e.formatMode){var o=t.originalEvent;(0,x.n)(o),o.preventDefault();var f=_.last(i);if(f){var h=u.l.findFirstDataPointByKey(e.selectableDataPoints,f.identity.getKey()),b=e.createVisualSubSelection(t,h,!1);e.subSelectionHelper.subSelect(b)}}else e.handleSelection(t.originalEvent,i)}},this.featureContextClicked=function(t){if(t){var a=t.originalEvent;if(!y.M.isCtrlOrMeta(a)){var i=_.find(t.shapes,s);if(i){var o=u.l.getFirstIdentityKey(i),f=u.l.findFirstDataPointByKey(e.selectableDataPoints,o);if((0,x.n)(a),a.preventDefault(),e.formatMode){if(f){for(var h=void 0,b=f.identity.getKey(),C=0,S=e.data.dataPoints;C<S.length&&!(h=u.l.findFirstDataPointByKey(S[C].subDataPoints,b));C++);var B=e.createVisualSubSelection(t,h,!0);e.subSelectionHelper.subSelect(B)}}else f&&e.selectionHandler.handleContextMenu(f,{x:a.clientX,y:a.clientY})}}}},this.handleContextMenu=function(t,a){!t||y.M.isCtrlOrMeta(t)||((0,x.n)(t),t.preventDefault(),e.formatMode)||e.selectionHandler.handleContextMenu(a,{x:t.clientX,y:t.clientY})},this.createFocusInCallback=function(t,a,i,o,f){return function(h){y.M.isCtrlOrMeta(h)&&72===h.keyCode&&(f()?o():i(t,a),h.preventDefault())}},this.featureFocusIn=function(t,a,i,o){var f;if(!e.formatMode&&t.shape&&(e.setFeatureFocusedState(t,!0),(f=n(t.shape)?e.findSubDataPointByClusterFeature(t.shape):e.findSubDataPointByShape(t.shape))&&f.tooltipInfo)){var h=e.mapControl.getCanvasContainer().getBoundingClientRect(),S=t.pixel;e.focusInCallback=e.createFocusInCallback([S[0]+h.x,S[1]+h.y],f,a,i,o),t.target.addEventListener("keydown",e.focusInCallback),t.target.setAttribute("aria-label",n(t.shape)?f.tooltipInfo[0].header:(0,P.X)(f.tooltipInfo))}},this.featureFocusOut=function(t,a){e.formatMode||(e.setFeatureFocusedState(t,!1),t.target.removeEventListener("keydown",e.focusInCallback),a())},this.setFeatureFocusedState=function(t,a){var i=t.shape,o=n(i)?i.id.toString():i.getId().toString();e.mapControl.sources.setFeatureState(o,p.oy,{focused:a})},this.createVisualSubSelection=function(t,a,i){var o=t.originalEvent,f=_.find(t.shapes,function(I){return I&&I.getProperties});m.fF.assertValue(f,"azureMap ".concat(t.type,": expected to find the shape"));var B,h=g.E.getSubSelectableRegionFromLayerId(t.layerId),b=f.getProperties().seriesIndex,S="".concat(h)+(void 0===b?"":"-series-".concat(b)),O={x:o.clientX,y:o.clientY};return e.data.hasSeries&&a&&!_.isUndefined(a.seriesIndex)&&(B=e.data.series[a.seriesIndex]),g.E.createAzureMapSubSelection(S,i,e.hostServices,O,B)},this.dataSelected=function(t){if(!e.formatMode){var a=u.l.findDataPointsByShapes(e.selectableDataPoints,t);e.handleSelection(void 0,a,1)}},this.handleSelection=function(t,a,i){void 0!==i?(0,A.tn)(a,i,e.selectionHandler):(0,A.ct)(t,a,e.selectionHandler)},this.clusterClicked=function(t,a){var i=_.find(t.shapes,n);i&&a.getClusterExpansionZoom(i.properties.cluster_id).then(function(o){e.mapControl.setCamera({center:i.geometry.coordinates,zoom:o,type:"ease",duration:200})}).catch(function(o){})},this.updateDataSourceWithSelection=function(){return(0,M.__awaiter)(e,void 0,void 0,function(){var t,a,i,o,f,h,b,C,S,O,I=this;return(0,M.__generator)(this,function(L){if((this.bubbleDataSource||this.heatMapDataSource||this.filledMapDataSource||this.barChart3DDataSource||this.referenceDataSource)&&(t=(0,M.__spreadArray)((0,M.__spreadArray)((0,M.__spreadArray)((0,M.__spreadArray)((0,M.__spreadArray)([],this.bubbleDataSource.getShapes(),!0),this.heatMapDataSource.getShapes(),!0),this.filledMapDataSource.getShapes(),!0),this.barChart3DDataSource.getShapes(),!0),this.referenceDataSource.getShapes(),!0),this.hasSelection?(a=_.filter(this.selectableDataPoints,function(E){return E.selected}),i=_.map(a,function(E){return E.identity.getKey()}),t.forEach(function(E){var z=E.getProperties(),T=i.indexOf(z.identityKeys[0])>-1;E.addProperty("selected",T)})):t.forEach(function(E){E.addProperty("selected",!0)}),this.showPieChart)){for(o=[],f=[],h=0,b=t.filter(function(E){return E&&E.getProperties().showPie});h<b.length;h++)S=(C=b[h]).getId(),O=C.getProperties(),o.push(this.loadIcon(S,O.identityKeys[0],f));Promise.allSettled(o).then(function(){I.composeAndUpdatePieExpression(f)})}return[2]})})},this.loadIcon=function(t,a,i){return(0,M.__awaiter)(e,void 0,void 0,function(){var o,f,h,b;return(0,M.__generator)(this,function(C){switch(C.label){case 0:if(o=[],f=_.find(this.dataPoints,function(S){return S?.location&&S?.subDataPoints.length>0&&S.subDataPoints[0].identity.getKey()===a}),this.shouldUseLegacyFormat&&d.J.LEGACY_appendPieRadiusToDataPoints([f],this.data),!f)return[3,2];for(h=0;h<f.subDataPoints.length;h++)this.hasSelection?f.subDataPoints[h].selected&&o.push(h):o.push(h);return b=l.t.hash(f,this.data.properties.bubble,o),[4,this.pieChartFactory.loadIcon(f,this.data.properties.bubble,o,b)];case 1:C.sent(),o.length>0&&i.push({dataPoint:f,hash:b,markerShapeId:t,selectedIndexes:o}),C.label=2;case 2:return[2]}})})},this.composeAndUpdatePieExpression=function(t){for(var a=["literal",[]],i=[],o=0,f=t;o<f.length;o++){var h=f[o],b=h.dataPoint,C=h.hash,S=h.markerShapeId,O=h.selectedIndexes;a[1].push(S),b.subDataPoints.length!==O.length&&i.push(["==",["get","_azureMapsShapeId"],S],"".concat(C))}var B=i.length>0?(0,M.__spreadArray)((0,M.__spreadArray)(["case"],i,!0),[["get","iconId"]],!1):["get","iconId"],I=["case",["in",["get","_azureMapsShapeId"],a],(0,v.TD)(e.data.properties.bubble.transparency),(0,v.TD)(e.data.properties.commonDataOptions.unselectedTransparency)];e.pieChartSymbolLayer.setOptions({iconOptions:{image:B,opacity:I}})}}return Object.defineProperty(r.prototype,"bubbleDataSource",{get:function(){return this.mapControl.sources.getById(p.oy)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"heatMapDataSource",{get:function(){return this.mapControl.sources.getById(p.Ol)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"filledMapDataSource",{get:function(){return this.mapControl.sources.getById(p.HC)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"barChart3DDataSource",{get:function(){return this.mapControl.sources.getById(p.zD)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"referenceDataSource",{get:function(){return this.mapControl.sources.getById(p.uL)},enumerable:!1,configurable:!0}),r.prototype.bindEvents=function(e,t,a){this.mapControl=e.mapControl,this.selectableDataPoints=e.selectableDataPoints,this.selectionHandler=t,this.data=e.data,this.dataPoints=e.dataPoints,this.hostServices=e.hostServices},r.prototype.setFormatMode=function(e){this.formatMode=e},r.prototype.setSubSelectionHelper=function(e){this.subSelectionHelper=e},r.prototype.renderSelection=function(e){this.hasSelection=e,this.updateDataSourceWithSelection()},r.prototype.setPieChartBehavior=function(e,t,a,i){void 0===i&&(i=!0),this.showPieChart=e,this.pieChartFactory=t,this.pieChartSymbolLayer=a,this.shouldUseLegacyFormat=i},r.prototype.findSubDataPointByMouseEvent=function(e){if(e){var t=_.find(e.shapes,n);if(t)return this.findSubDataPointByClusterFeature(t);var a=_.find(e.shapes,s);if(a)return this.findSubDataPointByShape(a)}},r.prototype.findSubDataPointByShape=function(e){for(var t=u.l.getFirstIdentityKey(e),a=void 0,i=0,o=this.data.dataPoints;i<o.length&&!(a=o[i].subDataPoints.find(function(h){return h.identity.getKey()===t}));i++);return a},r.prototype.findSubDataPointByClusterFeature=function(e){var t=e.properties,a={header:this.hostServices.getLocalizedString("Visual_AzureMapsCluster_TooltipInfo",t.point_count),displayName:""};return{size:t.size,color:"",selected:!1,identity:null,tooltipInfo:[a]}},r}()},70508:function(W,F,D){D.d(F,{Bc:function(){return n},C_:function(){return Q},Co:function(){return L},Dy:function(){return t},Dz:function(){return I},Fw:function(){return d},HC:function(){return V},I9:function(){return l},Ix:function(){return P},JX:function(){return v},Jp:function(){return q},NI:function(){return O},NR:function(){return r},Ng:function(){return p},Nq:function(){return T},OH:function(){return S},Ol:function(){return j},Qv:function(){return s},TJ:function(){return J},U1:function(){return w},W5:function(){return h},W8:function(){return et},WL:function(){return M},Wv:function(){return X},Y4:function(){return H},Yd:function(){return m},Yi:function(){return U},Yl:function(){return A},Z$:function(){return e},Z3:function(){return i},_0:function(){return C},_O:function(){return a},_u:function(){return tt},a_:function(){return x},c8:function(){return b},fI:function(){return y},fN:function(){return k},fQ:function(){return z},hW:function(){return R},nB:function(){return c},nv:function(){return E},oy:function(){return K},p5:function(){return N},pi:function(){return g},rn:function(){return u},t:function(){return o},uL:function(){return Y},x6:function(){return B},yl:function(){return G},z$:function(){return f},z8:function(){return $},zD:function(){return Z}});var M=0,x=60,A=0,P=360,v=0,m=22,y=10,p=1,d=1,u=50,g=1,l=10,n=0,s=20,c=0,r=1,e=60,t="backgroundDark",a=.5,i=0,o=5,f=0,h=5,b="pixels",C=1,S=200,O=4e6,B=0,I=5,L=5e3,E=128,z=100,k=0,T=-180,U=180,w=-90,R=90,H=Math.pow(2,53)-1,K="bubbleDataSource",j="heatMapDataSource",V="filledMapDataSource",Z="barChart3DDataSource",Y="referenceDataSource",G="bubbleLayer",N="heatMapLayer",X="barChart3DLayer",J="unselectedBarChart3DLayer",Q="filledMapFillLayer",$="filledMapOutlineLayer",q="clusterBubbleLayer",tt="clusterSymbolLayer",et={bubbleStrokeOpacity:1,bubbleStrokeWidth:2}},72118:function(W,F,D){D.d(F,{J:function(){return c}});var M=D(81337),x=D(64067),A=function(){function r(e,t,a,i){this.epsilon=1e-5,this.cx1=0,this.cx2=0,this.cx3=0,this.cy1=0,this.cy2=0,this.cy3=0,this.computeCoefficient(e,t,a,i)}return r.prototype.computeCoefficient=function(e,t,a,i){this.cx3=1+3*e-3*a,this.cx2=3*a-6*e,this.cx1=3*e,this.cy3=1+3*t-3*i,this.cy2=3*i-6*t,this.cy1=3*t},r.prototype.getXByT=function(e){return this.cx3*Math.pow(e,3)+this.cx2*Math.pow(e,2)+this.cx1*e},r.prototype.getYByT=function(e){return this.cy3*Math.pow(e,3)+this.cy2*Math.pow(e,2)+this.cy1*e},r.prototype.estimateTByX=function(e,t){void 0===t&&(t=.01);for(var a=0,i=1,o=e;a<i;){var f=this.getXByT(o);if(Math.abs(e-f)<=t)return o;f<e?a=o:i=o,o=.5*(a+i)}return e},r.prototype.scale=function(e){if(e<this.epsilon)return 0;if(1-e<this.epsilon)return 1;var t=this.estimateTByX(e);return this.getYByT(t)},r}(),P=D(1521),v=D(70508),m=function(r){return r.bubble="showBubble",r.pie="showPie",r.barChart3D="showBarChart3D",r.filledMap="showFilledMap",r.heatMap="showHeatMap",r}({}),n=512/40075e3,s=n*Math.pow(2,24),c=function(){function r(){}var e;return r.getBubbleDisplayOptions=function(t,a,i,o,f,h){var b=i?r.LEGACY_getRadiusExpression(t,a,o,f,h):r.getRadiusExpression(t.radius,o,f,h),C=["get","color"],S=r.getStrokeColor(t.autoStrokeColor,t.strokeColor,C),O=["case",r.getSelectionFilter(!0),(0,x.TD)(t.transparency),(0,x.TD)(a.unselectedTransparency)],I=t.strokeWidth<v.W8.bubbleStrokeWidth?["case",["boolean",["feature-state","focused"],!1],v.W8.bubbleStrokeWidth,t.strokeWidth]:t.strokeWidth,L=["case",["boolean",["feature-state","focused"],!1],v.W8.bubbleStrokeOpacity,r.getSelectionFilter(!0),(0,x.TD)(t.strokeTransparency),(0,x.TD)(a.unselectedTransparency)],E=i?r.LEGACY_getBubbleFilter(!0,o?a:void 0):r.bubbleLayerFilter;return{bubbleOptions:{radius:b,strokeColor:S,strokeWidth:I,strokeOpacity:L,blur:t.blur/100,pitchAlignment:t.pitchAlignment,minZoom:t.minZoom,maxZoom:t.maxZoom,color:C,filter:E,opacity:O,visible:!0}}},r.getBubbleClusterDisplayOptions=function(t,a){var o=a.clusteredBubbleStrokeWidth<v.W8.bubbleStrokeWidth?["case",["boolean",["feature-state","focused"],!1],v.W8.bubbleStrokeWidth,a.clusteredBubbleStrokeWidth]:a.clusteredBubbleStrokeWidth;return{clusterBubbleOptions:(0,M.__assign)((0,M.__assign)({},t),{radius:a.clusteredBubbleRadius,color:a.clusteredBubbleFillColor,strokeColor:a.clusteredBubbleStrokeColor,strokeWidth:o,filter:r.clusteredDataFilter}),clusterSymbolOptions:{visible:!0,textOptions:{color:a.clusteredBubbleFontColor,size:a.clusteredBubbleFontSize}}}},r.getPieChartDisplayOptions=function(t){return{pieChartOptions:{minZoom:t.minZoom,maxZoom:t.maxZoom,iconOptions:{pitchAlignment:"viewport",anchor:"center"},visible:!0}}},r.getHeatMapDisplayOptions=function(t,a){var i=["interpolate",["linear"],["heatmap-density"],0,(0,P.cD)(t.heatMapColorLow,0),.1,t.heatMapColorLow,.5,t.heatMapColorCenter,1,t.heatMapColorHigh],o="pixels"===t.heatMapRadiusUnit?t.heatMapRadius:["interpolate",["exponential",2],["zoom"],0,["*",t.heatMapRadius,n],24,["*",t.heatMapRadius,s]],f=a&&t.heatMapUseSize?["get","size"]:1;return{heatMapOptions:{color:i,intensity:t.heatMapIntensity,opacity:(0,x.TD)(t.heatMapTransparency),radius:o,weight:f,minZoom:t.minZoom,maxZoom:t.maxZoom,visible:!0}}},r.getBarChartDisplayOptions=function(t,a,i,o,f){var b=t.height/i,C=["get","size"],S=["*",C,100*b];t.scaleHeightOnZoom&&(S=["interpolate",["exponential",.5],["zoom"],0,["*",C,2e6*b],22,["*",C,20*b]]);var B={minZoom:t.minZoom,maxZoom:t.maxZoom,fillColor:["get","color"],visible:!0};return{selectedOptions:(0,M.__assign)((0,M.__assign)({},B),{height:S,fillOpacity:(0,x.TD)(t.transparency),filter:o?r.LEGACY_getBarChart3DFilter(!0,f?a:void 0):r.getSelectionFilter(!0)}),unselectedOptions:(0,M.__assign)((0,M.__assign)({},B),{height:0,fillOpacity:(0,x.TD)(a.unselectedTransparency),filter:o?r.LEGACY_getBarChart3DFilter(!1,f?a:void 0):r.getSelectionFilter(!1)})}},r.getFilledMapDisplayOptions=function(t,a,i,o){var h=["case",r.getSelectionFilter(!0),(0,x.TD)(t.transparency),(0,x.TD)(a.unselectedTransparency)],b=["case",r.getSelectionFilter(!0),(0,x.TD)(t.strokeTransparency),(0,x.TD)(a.unselectedTransparency)],C=i?r.LEGACY_getFilledMapFilter(!0,o?a:void 0):void 0;return{polygonOptions:{minZoom:t.minZoom,maxZoom:t.maxZoom,fillColor:["get","color"],fillOpacity:h,filter:C,visible:!0},lineOptions:{minZoom:t.minZoom,maxZoom:t.maxZoom,strokeColor:t.strokeColor,strokeOpacity:b,strokeWidth:t.strokeWidth,filter:C,visible:!0}}},r.getSelectionFilter=function(t){return t?["get","selected"]:["!",["get","selected"]]},r.LEGACY_getBubbleFilter=function(t,a){var i=this.LEGACY_getLayerFilter(t,a)||["all"];return i.push(["==",["get","showBubble"],!0]),i.push(["!",this.clusteredDataFilter]),i},r.LEGACY_getBarChart3DFilter=function(t,a){return this.LEGACY_getLayerFilter(t,a,!0)},r.LEGACY_getFilledMapFilter=function(t,a){return this.LEGACY_getLayerFilter(t,a)},r.LEGACY_getLayerFilter=function(t,a,i){void 0===i&&(i=!1);var o=[];if(i&&o.push(this.getSelectionFilter(t)),_.isEmpty(a)||(a.showZeros||o.push(["!=",["get","size"],0]),a.showNegatives||o.push(["!",["<",["get","size"],0]])),0!==o.length)return 1===o.length?o[0]:(0,M.__spreadArray)(["all"],o,!0)},r.getRadiusExpression=function(t,a,i,o){return a&&i!==o?["get","size"]:t},r.LEGACY_getRadiusExpression=function(t,a,i,o,f){var C,h=i?t.minRadius:t.radius,b=t.zoomScaleFactor;if(i){var O=t.radiusScalingMethod,E=["linear"];if(1===O?E=["exponential",t.logScale]:2===O&&(E=["cubic-bezier",t.x1,t.y1,t.x2,t.y2]),o===f)C=["interpolate",E,["zoom"],12,h,20,h*b];else{var R=["get","size"];a.showNegatives&&(R=["abs",R]),C=["interpolate",E,R,o,h,f,t.maxRadius],1!==b&&(C=["let","radiusSize",C,["interpolate",["linear"],["zoom"],12,["var","radiusSize"],20,["*",b,["var","radiusSize"]]]])}}else C=1!==b?["interpolate",["linear"],["zoom"],12,h,20,h*b]:h;return C},r.LEGACY_evaluateRadiusExpression=function(t,a,i){if("number"==typeof t)return t;if(Array.isArray(t))if("interpolate"===t[0]){var o=t[1],h=t[3],b=t[4],C=t[5],S=t[6],O=_.isEqual(t[2],["zoom"]);O&&(!_.isFinite(a)||a<0)&&(a=1);var L=(_.clamp(O?a:i,h,C)-h)/(C-h);if("linear"===o[0])return L*(S-b)+b;if("exponential"===o[0]){var E=o[1];return(1===E?L:(Math.pow(E,L)-1)/(E-1))*(S-b)+b}if("cubic-bezier"===o[0])return new A(o[1],o[2],o[3],o[4]).scale(L)*(S-b)+b}else if("let"===t[0]&&"radiusSize"===t[1]){var H=this.LEGACY_evaluateRadiusExpression(t[2],a,i),K=_.cloneDeep(t[3]);return K[4]=H,K[6]=H*K[6][1],this.LEGACY_evaluateRadiusExpression(K,a,i)}return 0},r.LEGACY_appendPieRadiusToDataPoints=function(t,a){var i=r.LEGACY_getRadiusExpression(a.properties.bubble,a.properties.commonDataOptions,a.hasSize,a.minDataValue,a.maxDataValue);t.forEach(function(o){var f=o.subDataPoints.reduce(function(b,C){return b+C.size},0),h=r.LEGACY_evaluateRadiusExpression(i,void 0,f);o.bubbleRadius=h})},e=r,r.getStrokeColor=function(t,a,i){var o=a;if(t){var f=["var","fillColor"];o=["let","fillColor",["to-rgba",["to-color",i]],["case",[">",["sqrt",["+",["*",.299,["^",["at",0,f],2]],["*",.587,["^",["at",1,f],2]],["*",.114,["^",["at",2,f],2]]]],127],["to-color",["rgb",["*",.5,["at",0,f]],["*",.5,["at",1,f]],["*",.5,["at",2,f]]]],["to-color",["rgb",["max",127,["min",255,["*",1.5,["at",0,f]]]],["max",127,["min",255,["*",1.5,["at",1,f]]]],["max",127,["min",255,["*",1.5,["at",2,f]]]]]]]]}return o},r.clusteredDataFilter=["has","point_count"],r.bubbleLayerFilter=["all",["==",["get",m.bubble],!0],["!",e.clusteredDataFilter]],r.pieLayerFilter=["all",["==",["get",m.pie],!0],["!",e.clusteredDataFilter]],r}()},81293:function(W,F,D){D.d(F,{l:function(){return p}});var M=D(81337),x=D(2379),A=D(49988),P=.0174532925,v=1e-4,p=function(){function d(){}return d.getPointFeatures=function(u,g,l,n,s,c){var r=this,e=l&&n;return u.filter(function(t){return t.location&&t.subDataPoints&&t.subDataPoints.length>0}).map(function(t){return new atlas.data.Feature(new atlas.data.Point(new atlas.data.Position(t.location.longitude,t.location.latitude)),(0,M.__assign)((0,M.__assign)({coordinates:[t.location.longitude,t.location.latitude],size:c?t.subDataPoints[0].size||0:t.bubbleRadius||0,color:t.subDataPoints[0].color,identityKeys:t.subDataPoints.map(function(a){return a.identity.getKey()}),selected:!g||t.subDataPoints[0].selected},(l||n)&&{showBubble:r.bubbleVisibility(t,e,l),showPie:r.pieVisibility(t,e,n)}),{iconId:n?A.t.hash(t,s):void 0,seriesIndex:t.subDataPoints[0].seriesIndex}))})},d.bubbleVisibility=function(u,g,l){return!!(!g&&l||g&&1===u.subDataPoints.length)},d.pieVisibility=function(u,g,l){return!!(!g&&l||g&&u.subDataPoints.length>1)},d.getReferenceLayerFeature=function(u,g){if(!u)return[];var l=u.getShapes(),n=[];return l.forEach(function(s){var c=u.getDataPointFromShape(s);n.push(c?new atlas.data.Feature(s.geometry,(0,M.__assign)({coordinates:c.location?[c.location.longitude,c.location.latitude]:[],identityKeys:c.subDataPoints.map(function(r){var e;return null===(e=r.identity)||void 0===e?void 0:e.getKey()}),selected:!g||c.subDataPoints[0].selected},s.properties)):new atlas.data.Feature(s.geometry,(0,M.__assign)({identityKeys:[]},s.properties)))}),n},d.getPolygonFeature=function(u,g,l,n){var s=this;return u.filter(function(c){return c.location}).map(function(c){return new atlas.data.Feature(1===l?s.getCirclePolygon(c,g):s.getSquarePolygon(c,g),{coordinates:[c.location.longitude,c.location.latitude],size:c.subDataPoints[0].size||0,color:c.subDataPoints[0].color,identityKeys:c.subDataPoints.map(function(r){return r.identity.getKey()}),selected:!n||c.subDataPoints[0].selected})})},d.getFilledMapMultiPolygonFeature=function(u,g){return u.filter(function(l){return l.geojsonPolygons}).map(function(l){return new atlas.data.Feature(new atlas.data.MultiPolygon(x.b.combineMultiPolygonCoordinatesAtAntimeridian(l.location,l.geojsonPolygons.map(function(n){return n.coordinates}))),{coordinates:[l.location.longitude,l.location.latitude],size:l.subDataPoints[0].size||0,color:l.subDataPoints[0].color,identityKeys:l.subDataPoints.map(function(n){return n.identity.getKey()}),selected:!g||l.subDataPoints[0].selected})})},d.getCirclePolygon=function(u,g){for(var l=v*g,n=Math.cos(u.location.latitude*P),c=[],r=0;r<18;r++)c.push([u.location.longitude+l*Math.cos(20*r*P),u.location.latitude+l*n*Math.sin(20*r*P)]);return c.push([u.location.longitude+l,u.location.latitude]),new atlas.data.Polygon([c])},d.getSquarePolygon=function(u,g){var l=v*g,n=l*Math.cos(u.location.latitude*P);return new atlas.data.Polygon([[[u.location.longitude+l,u.location.latitude+n],[u.location.longitude-l,u.location.latitude+n],[u.location.longitude-l,u.location.latitude-n],[u.location.longitude+l,u.location.latitude-n],[u.location.longitude+l,u.location.latitude+n]]])},d.getIdentityKeys=function(u){return u.getProperties().identityKeys},d.getFirstIdentityKey=function(u){return this.getIdentityKeys(u)[0]},d.findFirstDataPointByKey=function(u,g){return u.find(function(l){return g===l.identity.getKey()})},d.findDataPointsByKeys=function(u,g){var l=[];if(g.length===u.length)return u;for(var n=0,s=u;n<s.length;n++){var c=s[n],r=c.identity.getKey();if(g.indexOf(r)>=0&&(l.push(c),l.length===g.length))break}return l},d.findDataPointsByShapes=function(u,g){for(var l=[],n=0,s=g;n<s.length;n++)l.push.apply(l,this.getIdentityKeys(s[n]));return this.findDataPointsByKeys(u,l)},d}()},19076:function(W,F,D){D.d(F,{E:function(){return y}});var M=D(81337),x=D(60637),A=D(32379),P=D(96915),v=D(70508),m={dataMap:{allData:[(0,P.Ue)(1)]}},y=function(){function p(){}return p.getSubSelectableRegionFromLayerId=function(d){return d===v.yl?"bubbles":"map"},p.createAzureMapSubSelection=function(d,u,g,l,n){var s="",c={};return"bubbles"===d.split("-")[0]&&(n?(s=g.getLocalizedString("MiniToolbar_Bubbles",n.value),c=n.identity.getSelectorsByColumn()):(s=g.getLocalizedString("Visual_Bubbles"),c=m)),{visualObjects:[{objectName:d,selectorsByColumn:c}],showUI:u,displayName:s,subSelectionType:3,selectionOrigin:l}},p.getAllSubSelectables=function(d,u,g,l){var n=g.getAllSubSelectables(l);return d?.properties.bubble&&d.properties.bubble.showBubbleLayer&&d.hasSeries&&!_.isEmpty(d.series)&&n.push.apply(n,d.series.map(function(s,c){return p.createAzureMapSubSelection("".concat("bubbles","-series-").concat(c),!1,u,void 0,s)})),n},p.getNextSubSelectable=function(d,u,g,l,n){var s=p.getAllSubSelectables(d,u,g);if(s.length){var c;if(!l)return n?_.last(s):_.first(s);var r=_.findIndex(s,function(t){return _.isEqual(l,t)});if(r>-1){var e=n?r-1:r+1;e>-1&&e<s.length&&(c=s[e])}return c}},p.getBubblesSubSelectionStyles=function(d,u){return void 0===u&&(u={}),{type:3,fill:{reference:(0,M.__assign)((0,M.__assign)({},x.MC.dataPoint.fill),{selector:(0,A.fd)((0,A.tV)(u))}),label:d.getLocalizedString("Visual_Fill")},stroke:{reference:x.MC.bubbleLayer.strokeColor,label:d.getLocalizedString("Visual_Border")}}},p.getBubblesSubSelectionShortcuts=function(d){return[{type:0,relatedResetFormattingIds:[x.MC.dataPoint.fill,x.MC.bubbleLayer.strokeColor,x.MC.bubbleLayer.layerPosition]},(0,M.__assign)((0,M.__assign)({type:3},x.MC.bubbleLayer.layerPosition),{label:d.getLocalizedString("Visual_AzureMapsLayerPosition")}),{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat(v.yl),groupUid:"".concat(v.yl,"-size")},label:d.getLocalizedString("Format_Bubbles")}]},p}()}}]);