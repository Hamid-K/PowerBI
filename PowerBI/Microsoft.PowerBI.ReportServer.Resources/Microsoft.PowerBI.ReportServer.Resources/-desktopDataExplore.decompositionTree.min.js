"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["decompositionTree"],{51402:function(me,K,F){F.r(K),F.d(K,{DecompositionTree:function(){return fe}});var D=F(81337),s=F(1409),$=F(29324),ee=F(56707),te=F(28579),ie=F(33024),R=F(13536),re=F(45296),g=F(79154),y=F(62458),b=F(56578),j=F(43286),G=F(46135),ae=F(32379),oe=F(74711),B=F(82755),ne=F(96915),le=F(74981),A=F(90120),H=F(18664),I=F(32105),se=F(64067),P=F(38265),Z=F(32041),Y=F(38400),ue=F(59107),c=function(){function n(){}return n.mainContainer=(0,g.CH)("mainContainer"),n.treeContainer=(0,g.CH)("treeContainer"),n.treeButtonsContainer=(0,g.CH)("treeButtonsContainer"),n.treeNode=(0,g.CH)("treeNode"),n.link=(0,g.CH)("link"),n.expandButton=(0,g.CH)("expandButton"),n.dataBar=(0,g.CH)("dataBar"),n.iconOverlay=(0,g.CH)("iconOverlay"),n.nodeOverlay=(0,g.CH)("nodeOverlay"),n.valueDataBar=(0,g.CH)("valueDataBar"),n.highlightDataBar=(0,g.CH)("highlightDataBar"),n.dataBarBackground=(0,g.CH)("dataBarBackground"),n.dataBarSeparator=(0,g.CH)("dataBarSeparator"),n.label=(0,g.CH)("label"),n.value=(0,g.CH)("value"),n.headerContainer=(0,g.CH)("headerContainer"),n.levelHeader=(0,g.CH)("levelHeader"),n.headerBackground=(0,g.CH)("headerBackground"),n.levelTitle=(0,g.CH)("levelTitle"),n.levelTitleUnderline=(0,g.CH)("levelTitleUnderline"),n.levelSubtitle=(0,g.CH)("levelSubtitle"),n.aiLevel=(0,g.CH)("aiLevel"),n.lockedLevel=(0,g.CH)("lockedLevel"),n.removeLevel=(0,g.CH)("removeLevel"),n.background=(0,g.CH)("background"),n.loadMore=(0,g.CH)("loadMore"),n.recenterButton=(0,g.CH)("recenterButton"),n.svgBackground=(0,g.CH)("svgBackground"),n.exiting=(0,g.CH)("exiting"),n}(),ce=function(){function n(e){var t=this;this.stringResourceProvider=e;var i=this;this.registeredStates=[{selector:c.mainContainer,onKeyDown:function(r){return(38===r||9===r)&&t.handleMainContainer()},onSelect:function(){return t.tryRender(c.treeNode,0,0)},getAriaLabel:function(){return t.stringResourceProvider.get("Visual_Plot")}},{selector:c.headerContainer,onKeyDown:function(r){return(40===r||9===r)&&t.tryRender(c.mainContainer)},onSelect:function(){return t.tryRender(c.levelHeader,1)},getAriaLabel:function(){return t.stringResourceProvider.get("DecompositionTree_Screen_Reader_Level_Headers")}},{selector:c.treeNode,onKeyDown:function(r,o,l){return t.handleNode(r,o)},onSelect:function(r,o){r.nodeClicked.emit({node:o.data,point:i.getCenter(this)})},onCancel:function(){return t.tryRender(c.mainContainer)},getAriaLabel:function(r){return t.getTreeNodeAriaLabel(r)}},{selector:c.levelHeader,onKeyDown:function(r,o,l){return t.handleLevelHeader(r,o,l)},onSelect:function(r,o){return t.tryRender(c.levelTitle,o.level)},onCancel:function(){return t.tryRender(c.headerContainer)},getAriaLabel:function(r){return t.stringResourceProvider.format("DecompositionTree_Screen_Reader_Level_Header",r.level)}},{selector:c.levelTitle,onKeyDown:function(r,o,l){return t.handleLevelTitle(r,o,l)},onSelect:function(r,o){r.levelClicked.emit({element:this,level:o})},onCancel:function(r){return t.tryRender(c.levelHeader,r.level)}},{selector:c.removeLevel,onKeyDown:function(r,o,l){return t.handleRemoveLevel(r,o,l)},onSelect:function(r,o){return r.removeLevelButtonClicked.emit(o)},onCancel:function(r){return t.tryRender(c.levelHeader,r.level)},getAriaLabel:function(){return t.stringResourceProvider.get("DecompositionTree_RemoveLevel_Tooltip")}},{selector:c.iconOverlay,onKeyDown:function(r,o,l){return t.handleIconOverlay(r,o,l)},onSelect:function(r,o){return r.levelIconClicked.emit(o)},onCancel:function(r){return t.tryRender(c.levelHeader,r.level)},getAriaLabel:function(r){return r.tooltipData}},{selector:c.expandButton,onKeyDown:function(r,o){return t.handleExpandButton(r,o)},onSelect:function(r,o){r.expandButtonClicked.emit({node:o.data,point:i.getCenter(this)})},onCancel:function(){return t.tryRender(c.mainContainer)},getAriaLabel:function(){return t.stringResourceProvider.get("DecompositionTree_Screen_Reader_Expand_Level")}},{selector:c.loadMore,onKeyDown:function(r,o){return t.handleLoadMore(r,o)},onSelect:function(r,o){r.loadMoreClicked.emit(o.data)},onCancel:function(){return t.tryRender(c.mainContainer)},getAriaLabel:function(r){return t.stringResourceProvider.get(1===r.data.restartKind?"DecompositionTree_ScrollLevelUp_Tooltip":"DecompositionTree_ScrollLevelDown_Tooltip")}},{selector:c.recenterButton,onKeyDown:function(r,o){return t.handleRecenterButton(r,o)},onSelect:function(r,o){r.loadMoreClicked.emit(o.data)},onCancel:function(){return t.tryRender(c.mainContainer)},getAriaLabel:function(){return t.stringResourceProvider.get("DecompositionTree_RecenterButton_Tooltip")}}]}return n.prototype.bindEvents=function(e,t){var i=this;this.rootSelection=e,this.renderer=t,e.on("keydown",function(){var d=d3.event;i.onKeydown(d.keyCode,t,!!d.shiftKey)});for(var a=function(u){var v=e.selectAll(u.selector.selector).attr("tabindex",0).attr("focusable",!0).classed("setFocusRing",!0);u.getAriaLabel&&v.attr("aria-label",function(f){return u.getAriaLabel(f)})},r=0,o=this.registeredStates;r<o.length;r++)a(o[r])},n.prototype.getCenter=function(e){var t=e.getBoundingClientRect();return{x:t.left+t.width/2,y:t.top+t.height/2}},n.prototype.onKeydown=function(e,t,i){var a=d3.event,r=d3.select(a.target);if(r&&r.node()){for(var o,l=0,d=this.registeredStates;l<d.length;l++){var u=d[l];if(r.classed(u.selector.class)){o=u;break}}if(o){var v=!1;!o.onSelect||13!==e&&32!==e?o.onCancel&&27===e&&(o.onCancel(r.datum()),v=!0):(o.onSelect.bind(r.node())(t,r.datum()),v=!0),o.onKeyDown&&(v=o.onKeyDown(e,r.datum(),i)),v&&(a.preventDefault(),a.stopPropagation())}}},n.prototype.tryRender=function(e,t,i,a){void 0===t&&(t=0),void 0===i&&(i=0);var r=this.getSelectedElement(e,t,i,a);return!(!r||!r.node()||"none"===r.style("display")||(this.renderer.ensureElementVisible(r),this.render(r),0))},n.prototype.handleUnhandledArrowKeys=function(e){return 37===e||39===e||38===e||40===e},n.prototype.handleMainContainer=function(){return this.rootSelection.selectAll(c.levelHeader.selector).size()>1&&this.tryRender(c.headerContainer),!0},n.prototype.handleIconOverlay=function(e,t,i){return 37===e||9===e&&i?(this.tryRender(c.removeLevel,t.level)||this.tryRender(c.levelTitle,t.level),!0):39===e||9===e?(this.tryRender(c.levelTitle,t.level),!0):this.handleUnhandledArrowKeys(e)},n.prototype.handleExpandButton=function(e,t){return 37===e?(this.tryRender(c.treeNode,t.data.level,t.data.position),!0):this.handleUnhandledArrowKeys(e)},n.prototype.handleRemoveLevel=function(e,t,i){return 37===e||9===e&&i?(this.tryRender(c.levelTitle,t.level),!0):39===e||9===e?(this.tryRender(c.iconOverlay,t.level),!0):this.handleUnhandledArrowKeys(e)},n.prototype.handleNode=function(e,t){switch(e){case 39:var i=_.find(t.children,function(o){return o.data.expanded});return(!i||!this.tryRender(c.treeNode,t.data.level+1,i.data.position))&&(this.tryRender(c.treeNode,t.data.level+1,0)||this.tryRender(c.expandButton,t.data.level,t.data.position)),!0;case 37:return(!t.parent||!this.tryRender(c.treeNode,t.data.level-1,t.parent.data.position))&&this.tryRender(c.treeNode,t.data.level-1,0),!0;case 38:var a=1===t.data.position?0:t.parent&&t.data.position===_.last(t.parent.children).data.position?t.data.position:1/0;return!this.tryRender(c.recenterButton,t.data.level,a)&&!this.tryRender(c.treeNode,t.data.level,t.data.position-1)&&!this.tryRender(c.loadMore,t.data.level,t.data.position,1)&&this.tryRender(c.levelHeader,t.data.level,t.data.position),!0;case 40:var r=0===t.data.position?0:t.parent&&t.data.position===_.last(t.parent.children).data.position-1?t.data.position+1:1/0;return!this.tryRender(c.recenterButton,t.data.level,r)&&!this.tryRender(c.treeNode,t.data.level,t.data.position+1)&&this.tryRender(c.loadMore,t.data.level,t.data.position,2),!0}return this.handleUnhandledArrowKeys(e)},n.prototype.handleLevelHeader=function(e,t,i){if(37===e||9===e&&i){if(!this.tryRender(c.levelHeader,t.level-1)){var a=this.rootSelection.selectAll(c.levelHeader.selector).size();this.tryRender(c.levelHeader,a-1)}return!0}return 39===e||9===e?(this.tryRender(c.levelHeader,t.level+1)||this.tryRender(c.levelHeader,1),!0):40===e?(this.tryRender(c.loadMore,t.level,0,1)||this.tryRender(c.treeNode,t.level,0),!0):this.handleUnhandledArrowKeys(e)},n.prototype.handleLoadMore=function(e,t){return 40===e&&1===t.data.restartKind?(this.tryRender(c.treeNode,t.data.level,0),!0):38===e&&2===t.data.restartKind?(this.tryRender(c.treeNode,t.data.level,_.last(t.parent.children).data.position),!0):38===e?(this.tryRender(c.levelHeader,t.data.level),!0):this.handleUnhandledArrowKeys(e)},n.prototype.handleRecenterButton=function(e,t){switch(e){case 40:return this.tryRender(c.treeNode,t.data.level,Math.min(_.last(t.parent.children).data.position,t.data.position+1)),!0;case 38:return this.tryRender(c.treeNode,t.data.level,Math.max(t.data.position-1,0)),!0}return this.handleUnhandledArrowKeys(e)},n.prototype.handleLevelTitle=function(e,t,i){return 37===e||9===e&&i?(this.tryRender(c.iconOverlay,t.level),!0):39===e||9===e?(this.tryRender(c.removeLevel,t.level)||this.tryRender(c.iconOverlay,t.level),!0):this.handleUnhandledArrowKeys(e)},n.prototype.render=function(e){ue.M.focus(e.node())},n.prototype.getSelectedElement=function(e,t,i,a){if(e){var r=this.rootSelection.selectAll(e.selector);switch(e.class){case c.expandButton.class:case c.treeNode.class:case c.recenterButton.class:return r.filter(function(o){return o.data.level===t&&o.data.position===i});case c.levelHeader.class:case c.levelTitle.class:case c.iconOverlay.class:case c.removeLevel.class:return r.filter(function(o){return t>0&&o.level===t});case c.loadMore.class:return r.filter(function(o){return o.data.level===t&&o.data.restartKind===a});case void 0:break;default:return r}}},n.prototype.getTreeNodeAriaLabel=function(e){return e.data.expanded?this.stringResourceProvider.format("DecompositionTree_Screen_Reader_Expanded_Tree_Node",(0,Y.X)(e.data.tooltips)):(0,Y.X)(e.data.tooltips)},n}(),q=function(){function n(){var e=this;this.p2Ratio=.5,this.p1Ratio=.5,this.path=function(t){var i=t.source,a=t.target,r=t.target.x-t.source.x,o={x:i.x+r*e.p1Ratio,y:i.y},l={x:a.x-r*e.p2Ratio,y:a.y};return"M".concat(i.x,",").concat(i.y," C").concat(o.x,",").concat(o.y," ").concat(l.x,",").concat(l.y," ").concat(a.x,",").concat(a.y)}}return n.prototype.p1=function(e){return this.p1Ratio=e,this},n.prototype.p2=function(e){return this.p2Ratio=e,this},n}(),z=function(){function n(){}return n.visitSubTree=function(e,t,i){if(void 0===i&&(i=null),!e)return i;if(i=t(e,i),!_.isEmpty(e.children))for(var a=0,r=e.children;a<r.length;a++)n.visitSubTree(r[a],t,i);return i},n}(),de=function(){function n(){}return n.applyLayoutConstraints=function(e,t,i){n.recalculateLayout(e,t,0,null,0),i?(n.recalculateLayout(e,t,1,i,0),n.recalculateLayout(e,t,0,i,2)):(n.recalculateLayout(e,t,0,null,1),n.recalculateLayout(e,t,0,null,0))},n.recalculateLayout=function(e,t,i,a,r){y.fF.assertValue(e,"Nodes should be defined");var o=0;e=e.sort(function(S,m){return S.depth===m.depth?S.y-m.y:S.depth-m.depth});var l=_.chain(e).map(function(S,m){return e[m-1]&&S.depth===e[m-1].depth?void 0:m}).filter(function(S){return void 0!==S}).value();l.push(e.length);for(var d=_.first(e),u=0;u<l.length-1;u++){var v=e[l[u]];1===r&&(v=e[l[u+1]-1]);var f=v;if(a){for(var h=l[u];h<l[u+1];h++)if(a(e[h])){f=e[h];break}2===r&&(v=f)}for((2===r||0===r)&&v.y+o<d.y-t?o=d.y-t-v.y:(2===r||1===r)&&v.y+o>d.y+t&&(o=d.y+t-v.y),1===i&&(d=f),h=l[u];h<l[u+1];h++)e[h].y=e[h].y+o}},n}();function E(){var n=this.textContent;if(n&&0!==n.length){var e=parseFloat(this.getAttribute("width"));if(_.isFinite(e)){if(!this.getComputedTextLength)return void y.fF.assertFail("Element is not of type SVGTextContentElement");for(;this.getComputedTextLength()>e&&"\u2026"!==this.textContent;)n=n.slice(0,-1),this.textContent=n+"\u2026"}}}var X=function(){return function(e,t){this.dataBarDefaultWidth=130,this.dataBarHeight=10,this.dataBarSeparatorHeight=14,this.dataBarSeparatorThickness=1,this.hoverOpacity=.75,this.highlightDataBarHeightRatio=.4,this.highlightDataBarOpacity=.4,this.labelLeftMargin=5,this.loadMoreYOffsetBefore=-20,this.recenterButtonBeforeYOffset=-10,this.minZoom=.5,this.defaultZoom=1,this.maxZoom=1,this.defaultLayoutDensityFactor=1,this.denseLayoutDensityFactor=.8,this.sparseLayoutDensityFactor=1.2,this.minHorizontalLayoutDensityFactor=.9,this.maxHorizontalLayoutDensityFactor=1.5,this.treeLayoutFixedMargin=40,this.panningHorizontalLimit=25,this.panningVerticalLimit=25,this.linkCurvature=.5,this.linkHighlightedStrokeThickness=1.5,this.linkDefaultStrokeThickness=1,this.expandFontFamily="'Segoe UI','wf_segoe-ui_normal', helvetica, arial, sans-serif",this.expandFontSize="20px",this.expandLeftMargin=5,this.expandTopMargin=0,this.marginTop=25,this.marginLeft=25,this.headerHeight=55,this.underlineYOffset=5,this.underlineHeight=2,this.removeLevelFontFamily="'Segoe UI','wf_segoe-ui_normal', helvetica, arial, sans-serif",this.removeLevelFontSize="20px",this.removeLevelYOffset=2,this.removeLevelWidth=11,this.glyphIconFamily="PowrMDL2",this.iconFontSize="14px",this.iconOverlayYOffset=-12,this.iconOverlayWidth=16,this.iconOverlayHeight=36,this.aiIconYOffset=3,this.aiIconXOffset=-18,this.crossFilterOpacity=.4;var i=function(r){var o=(0,H.qk)(r);return Z.b.estimateSvgTextHeight(o)-Z.b.estimateSvgTextBaselineDelta(o)};this.subtitleHeight=i(e.levelSubtitleFont)+9,this.headerHeight=(t?this.subtitleHeight:5)+35,this.categoryLabelHeight=i(e.labelFont)+1,this.valueLabelHeight=i(e.valueFont)+1,this.dataBarWidth=e.dataBarWidthPercent*this.dataBarDefaultWidth/100,this.layoutNodeHorizontalSpacing=this.dataBarWidth+50,this.layoutNodeVerticalSpacing=this.dataBarHeight+this.categoryLabelHeight+this.valueLabelHeight+22,this.loadMoreYOffsetAfter=this.layoutNodeVerticalSpacing+5,this.loadMoreXOffset=this.dataBarWidth/2-10,this.recenterButtonAfterYOffset=this.layoutNodeVerticalSpacing-10}}();function Q(n,e){void 0===e&&(e={});var t=A.v.create(n),i=function(l,d){return{objectName:l,propertyName:d}},a=t.getColorForPropertyWithDefaultColor(e,i(s.I8.tree,s.hq.accentColor),n.colorPalette.dataColors.getColorByIndex(0).value),r=(0,se.ok)(n.colorPalette.foreground.value,.08,n.colorPalette.background.value);return{backgroundColor:n.colorPalette.background.value,headerBackgroundColor:t.getColorForPropertyWithDefaultColor(e,i(s.I8.levelHeader,s.hq.levelHeaderBackgroundColor),n.colorPalette.background.value),dataBarBackgroundColor:t.getColorForPropertyWithDefaultColor(e,i(s.I8.dataBars,s.hq.dataBarBackgroundColor),r),dataBarHighlightedStrokeColor:n.colorPalette.backgroundNeutral.value,positiveBarColor:t.getColorForPropertyWithDefaultColor(e,i(s.I8.dataBars,s.hq.positiveBarColor),n.colorPalette.dataColors.getColorByIndex(0).value),negativeBarColor:t.getColorForPropertyWithDefaultColor(e,i(s.I8.dataBars,s.hq.negativeBarColor),n.colorPalette.dataColors.getColorByIndex(1).value),dataBarSeparatorFillColor:n.colorPalette.foregroundNeutralSecondaryAlt.value,linkStrokeColor:t.getColorForPropertyWithDefaultColor(e,i(s.I8.tree,s.hq.connectorDefaultColor),r),linkHighlightedStrokeColor:a,accentColor:a,disabledColor:d3.hsl(0,0,d3.hsl(a).l).toString(),hoverColor:n.colorPalette.foregroundNeutralSecondary.value,iconColor:n.colorPalette.foregroundNeutralTertiary.value,labelFont:(0,H.Zi)(e.categoryLabels,{family:s.hq.categoryLabelFontFamily,size:s.hq.categoryLabelFontSize,color:s.hq.categoryLabelFontColor,bold:s.hq.categoryLabelBold,italic:s.hq.categoryLabelItalic,underline:s.hq.categoryLabelUnderline},t,n,"foreground","smallLabel",{color:A.v.getThemeColor(n,"foreground"),size:I.B.createFromPt(9),family:P.Wn.regular.family,weight:g.AI,style:g.AI,textDecoration:g.zu}),boldLabelFont:(0,H.Zi)(e.categoryLabels,{family:s.hq.categoryLabelFontFamily,size:s.hq.categoryLabelFontSize,color:s.hq.categoryLabelFontColor},t,n,"foreground","boldLabel",{color:A.v.getThemeColor(n,"foreground"),size:I.B.createFromPt(10),weight:"700",family:P.Wn.regular.family}),valueFont:(0,H.Zi)(e.dataLabels,{family:s.hq.dataLabelFontFamily,size:s.hq.dataLabelFontSize,color:s.hq.dataLabelFontColor,bold:s.hq.dataLabelBold,italic:s.hq.dataLabelItalic,underline:s.hq.dataLabelUnderline},t,n,"foreground","smallLightLabel",{color:A.v.getThemeColor(n,"foregroundNeutralSecondary"),size:I.B.createFromPt(9),family:P.Wn.regular.family,weight:g.AI,style:g.AI,textDecoration:g.zu}),levelTitleFont:(0,H.Zi)(e.levelHeader,{family:s.hq.levelTitleFontFamily,size:s.hq.levelTitleFontSize,color:s.hq.levelTitleFontColor,bold:s.hq.levelTitleBold,italic:s.hq.levelTitleItalic,underline:s.hq.levelTitleUnderline},t,n,"foreground","title",{color:A.v.getThemeColor(n,"foreground"),size:I.B.createFromPt(12),family:P.Wn.regularSecondary.family,weight:g.AI,style:g.AI,textDecoration:g.zu}),levelSubtitleFont:(0,H.Zi)(e.levelHeader,{family:s.hq.levelSubtitleFontFamily,size:s.hq.levelSubtitleFontSize,color:s.hq.levelSubtitleFontColor,bold:s.hq.levelSubtitleBold,italic:s.hq.levelSubtitleItalic,underline:s.hq.levelSubtitleUnderline},t,n,"foreground","smallLightLabel",{color:A.v.getThemeColor(n,"foregroundNeutralSecondary"),size:I.B.createFromPt(9),family:P.Wn.regular.family,weight:g.AI,style:g.AI,textDecoration:g.zu}),dataBarWidthPercent:(0,B.NA)(e,{objectName:s.I8.dataBars,propertyName:s.hq.dataBarWidthPercent},100),isHighContrast:n.isHighContrast}}var k=function(){function n(){}return n.prototype.subscribe=function(e){var t=this;y.fF.assert(function(){return!t.handler},"Only one subscriber allowed"),this.handler=e},n.prototype.emit=function(e){this.handler&&this.handler(e)},n}(),he=function(){function n(e,t,i){this.stringResourceProvider=e,this.tooltipService=t,this.isTouchEvent=i,this.allowLocking=!0,this.showSubtitles=!0,this.useLegacyLayout=!1,this.responsiveLayout=!1,this.isVisualReadOnly=!1,this.nodeClicked=new k,this.nodeContextMenu=new k,this.expandButtonClicked=new k,this.canvasClicked=new k,this.levelClicked=new k,this.removeLevelButtonClicked=new k,this.loadMoreClicked=new k,this.levelIconClicked=new k,this.enableTransitions=!0,this.isPanning=!1,this.viewport={height:0,width:0},this.layoutDensityFactor=1,this.density="default",this.linkType="curve",y.fF.assertAnyValue(t,"Tooltip service might be undefined on dashboard"),this.keyboardNavigation=new ce(e)}return Object.defineProperty(n.prototype,"layoutDensity",{get:function(){return this.density},set:function(t){if(t!==this.density){switch(this.density=t,this.density){case"default":this.layoutDensityFactor=this.treeVisualConfig.defaultLayoutDensityFactor;break;case"dense":this.layoutDensityFactor=this.treeVisualConfig.denseLayoutDensityFactor;break;case"sparse":this.layoutDensityFactor=this.treeVisualConfig.sparseLayoutDensityFactor}this.levelPositionScale.rangeRound([0,this.treeVisualConfig.layoutNodeHorizontalSpacing*this.horizontalDensityFactor]),this.applyLayoutTransform(!0),this.render(this.viewModel)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectorType",{get:function(){return this.linkType},set:function(t){if(t!==this.linkType){switch(this.linkType=t,this.linkType){case"curve":this.linkGenerator=(new q).p1(this.treeVisualConfig.linkCurvature).p2(this.treeVisualConfig.linkCurvature).path;break;case"round":this.linkGenerator=(new q).p1(0).p2(this.treeVisualConfig.linkCurvature).path}this.render(this.viewModel)}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxVisibleNodesPerLevel",{get:function(){if(this.viewport){var t=Math.floor(this.usableViewportHeight/this.nodeVerticalSpacing);return Math.max(s.bR.minValue,Math.min(s.bR.maxValue,t))}},enumerable:!1,configurable:!0}),n.prototype.init=function(e,t){var i=this;y.fF.assertValue(e,"A container element must be provided"),y.fF.assertValue(t,"Visual style must be defined"),this.visualStyle=t,this.treeVisualConfig=new X(t,this.showSubtitles),this.treeLayoutGenerator=d3.tree().nodeSize([this.treeVisualConfig.layoutNodeVerticalSpacing,this.treeVisualConfig.layoutNodeHorizontalSpacing]),this.dataBarScale=d3.scaleLinear().domain([0,1]).range([0,this.treeVisualConfig.dataBarWidth]).clamp(!0),this.levelPositionScale=d3.scaleLinear().domain([0,1]).rangeRound([0,this.treeVisualConfig.layoutNodeHorizontalSpacing*this.horizontalDensityFactor]),this.linkGenerator=(new q).p2(this.treeVisualConfig.linkCurvature).path,this.svgElement=d3.select(e).append("svg").on("click",function(){i.isPanning?d3.event.stopPropagation():i.canvasClicked.emit()}),this.svgBackground=this.svgElement.append("rect").attr("class",c.svgBackground.class).style("opacity",0).attr("drag-resize-disabled","true"),this.svgRootGroup=this.svgElement.append("g").attr("class",c.mainContainer.class).attr("transform","scale(".concat(this.treeVisualConfig.defaultZoom,")")).attr("drag-resize-disabled","true").on("mouseover",function(){return i.hideUnlockIcons()}),this.svgRootGroup.append("g").attr("class",c.treeContainer.class),this.svgRootGroup.append("g").attr("class",c.treeButtonsContainer.class),this.svgElement.append("rect").attr("class",c.headerBackground.class).style("fill",this.visualStyle.headerBackgroundColor).on("mouseout",function(){return i.hideUnlockIcons()}).on("mousedown",function(){return d3.event.stopPropagation()}),this.svgHeaderGroup=this.svgElement.append("g").attr("class",c.headerContainer.class).attr("transform","scale(".concat(this.treeVisualConfig.defaultZoom,")")).on("mousedown",function(){return d3.event.stopPropagation()}),this.enablePanAndZoom(this.svgElement),this.resetView()},n.prototype.render=function(e){var t=this;if(e&&e.root){if(!this.visualStyle)return void y.fF.assertFail("Visual style must be set before rendering");if(!this.viewport)return void y.fF.assertFail("Viewport must be set before rendering");if(!this.svgElement)return void y.fF.assertFail("Cannot render visual before initialization");this.viewModel=e,this.treeVisualConfig=new X(this.visualStyle,this.showSubtitles),this.svgElement.select(c.headerBackground.selector).style("fill",this.visualStyle.headerBackgroundColor).attr("height",this.treeVisualConfig.headerHeight),this.treeLayoutGenerator.nodeSize([this.treeVisualConfig.layoutNodeVerticalSpacing,this.treeVisualConfig.layoutNodeHorizontalSpacing]),this.dataBarScale.range([0,this.treeVisualConfig.dataBarWidth]),this.levelPositionScale.rangeRound([0,this.treeVisualConfig.layoutNodeHorizontalSpacing*this.horizontalDensityFactor]);var i=[];if((0,this.treeLayoutGenerator)(d3.hierarchy(e.root)).each(function(p){var L=p.x;p.x=p.y*t.horizontalDensityFactor,p.y=L*t.layoutDensityFactor+t.baseline,i.push(p)}),de.applyLayoutConstraints(i,this.maxTreeHeight,this.useLegacyLayout?function(p){return p&&(t.isHighlightedNode(p)||t.lastClickedNode&&p.data.key===t.lastClickedNode.key)}:null),this.treeBounds=this.getBounds(i),this.useLegacyLayout&&this.lastClickedNode){var d=_.find(i,function(p){return p.data.key===t.lastClickedNode.key});d&&this.ensureNodeVisible(d)}this.applyLayoutTransform(!1);var u=this.svgRootGroup.select(c.treeContainer.selector);this.renderNodes(u,i,e),this.renderLinks(u,i);var v=this.svgRootGroup.select(c.treeButtonsContainer.selector),f=e.levels.length-1,h=this.isVisualReadOnly||_.isEmpty(e.unpinnedDimensions)?[]:i.filter(function(p){return p.data.level===f});this.renderExpandButtons(v,h);var S=this.isVisualReadOnly?[]:_.filter(i,function(p){return!!p.parent&&(2===p.parent.children.length?0===p.data.position&&1===p.data.restartKind||p.data.position===p.parent.children.length-1&&2===p.data.restartKind:p.data.position<=1&&1===p.data.restartKind||p.data.position>=p.parent.children.length-2&&2===p.data.restartKind)});this.renderLoadMoreButtons(v,S);var m=this.isVisualReadOnly?[]:_.filter(i,function(p){return!(!p.data.expanded||!p.parent||(0!==p.data.position||2!==p.data.restartKind&&3!==p.data.restartKind)&&(p.data.position!==p.parent.children.length-1||1!==p.data.restartKind&&3!==p.data.restartKind))});this.renderRecenterButtons(v,m),this.renderLevels(this.svgHeaderGroup,e.levels),this.keyboardNavigation.bindEvents(this.svgElement,this)}},n.prototype.resetView=function(){this.setZoomTransform([this.treeVisualConfig.marginLeft,0],this.treeVisualConfig.defaultZoom),this.svgHeaderGroup.attr("visibility",null),this.applyLayoutTransform(!0),this.viewModel&&this.render(this.viewModel)},n.prototype.resize=function(e){y.fF.assertValue(e,"Viewport must be defined"),this.viewport=e,this.svgElement.attr("width",e.width).attr("height",e.height).attr("viewBox","0 0 ".concat(e.width," ").concat(e.height)),this.svgBackground.attr("width",e.width).attr("height",e.height),this.svgElement.select(c.headerBackground.selector).attr("width",e.width).attr("height",this.treeVisualConfig.headerHeight),this.svgElement.select(c.background.selector).attr("width",e.width).attr("height",e.height),this.applyLayoutTransform(!1)},Object.defineProperty(n.prototype,"usableViewportHeight",{get:function(){return Math.max(0,this.viewport.height-this.treeVisualConfig.headerHeight-2*this.treeVisualConfig.marginTop)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxTreeHeight",{get:function(){return this.responsiveLayout?(this.maxVisibleNodesPerLevel-1)/2*this.nodeVerticalSpacing:Math.max(0,this.usableViewportHeight/2-this.treeVisualConfig.treeLayoutFixedMargin)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"baseline",{get:function(){return this.responsiveLayout?Math.max(s.bR.minValue/2*this.nodeVerticalSpacing+this.treeVisualConfig.marginTop+this.treeVisualConfig.headerHeight,(this.viewport.height+this.treeVisualConfig.headerHeight+this.treeVisualConfig.marginTop-this.treeVisualConfig.layoutNodeVerticalSpacing)/2):this.viewport.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nodeVerticalSpacing",{get:function(){return this.treeVisualConfig.layoutNodeVerticalSpacing*this.layoutDensityFactor},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canTreeFitViewport",{get:function(){var t=d3.zoomTransform(this.svgElement.node()).k;return this.treeBounds&&this.viewport&&(this.treeBounds.y[1]-this.treeBounds.y[0])*t<this.usableViewportHeight},enumerable:!1,configurable:!0}),n.prototype.applyLayoutTransform=function(e){var t=this.getZoomTransform(),i=t.translate,a=t.scale;y.fF.assertValue(i,"applyLayoutTransform() missing translation value"),y.fF.assertValue(a,"applyLayoutTransform() missing scale value");var r=this.treeVisualConfig.panningHorizontalLimit,o=this.treeVisualConfig.panningVerticalLimit;if(this.treeBounds){var l=r,d=Math.max(this.treeBounds.x[1],this.levelPositionScale(_.size(this.viewModel.levels))),u=this.viewport.width-r-d*a;i[0]=Math.max(Math.min(l,u),i[0]),i[0]=Math.min(Math.max(l,u),i[0]);var v=this.treeVisualConfig.headerHeight+this.treeVisualConfig.marginTop+o-this.treeBounds.y[0]*a,f=this.viewport.height-o-this.treeBounds.y[1]*a;i[1]=Math.max(Math.min(v,f),i[1]),i[1]=Math.min(Math.max(v,f),i[1]),this.viewport.height<this.treeVisualConfig.headerHeight+o&&(i[1]=Math.max(this.viewport.height-o-this.treeBounds.y[0]*a,i[1]))}this.responsiveLayout?(this.zoom.scaleExtent([this.treeVisualConfig.defaultZoom,this.treeVisualConfig.defaultZoom]),a=this.treeVisualConfig.defaultZoom,this.canTreeFitViewport&&(i[1]=0)):this.zoom.scaleExtent([this.treeVisualConfig.minZoom,this.treeVisualConfig.maxZoom]),(e?this.svgRootGroup.transition():this.svgRootGroup).attr("transform","translate(".concat(i,")scale(").concat(a,")")),(e?this.svgHeaderGroup.transition():this.svgHeaderGroup).attr("transform","translate(".concat(i[0],", 0)scale(").concat(a,")")),e&&this.setZoomTransform(i,a)},n.prototype.ensureNodeVisible=function(e){var t=this.getZoomTransform(),i=t.translate,a=t.scale,r=[(e.x+i[0])*a,(e.y+i[1])*a];(r[1]<0||r[1]>this.viewport.height)&&(this.setZoomTransform([i[0],0],a),this.applyLayoutTransform(!0))},n.prototype.ensureElementVisible=function(e){e.classed(c.treeNode.class)||e.classed(c.loadMore.class)||e.classed(c.expandButton.class)||e.classed(c.recenterButton.class)?this.moveElementToVisible(e,this.treeVisualConfig.headerHeight+this.treeVisualConfig.panningVerticalLimit):(e.classed(c.levelHeader.class)||e.classed(c.levelTitle.class)||e.classed(c.iconOverlay.class)||e.classed(c.removeLevel.class))&&this.moveElementToVisible(e)},n.prototype.moveElementToVisible=function(e,t){var i;void 0===t&&(t=0);var a=e.node(),r=a.getBBox();if(r&&e.attr("transform")){var l=null===(i=a.transform)||void 0===i?void 0:i.baseVal.consolidate().matrix;if(l){var d=[l.e,l.f];if(d){var u={left:d[0],top:d[1],width:r.width,height:r.height},v=this.getZoomTransform(),f=v.translate,h=v.scale,S={left:u.left*h+f[0],top:u.top*h+f[1],right:(u.left+u.width)*h+f[0],bottom:(u.top+u.height)*h+f[1]},m=f[0];S.left<0?m=-u.left*h+this.treeVisualConfig.marginLeft:S.right>this.viewport.width&&(m=this.viewport.width-(u.left+u.width)*h-this.treeVisualConfig.marginLeft);var p=f[1];S.top<t?p=-u.top*h+t+this.treeVisualConfig.marginTop:S.bottom>this.viewport.height&&(p=this.viewport.height-(u.top+u.height)*h-this.treeVisualConfig.marginTop),(m!==f[0]||p!==f[1])&&(this.setZoomTransform([m,p],h),this.applyLayoutTransform(!0))}}}},n.prototype.getZoomTransform=function(){var e=d3.zoomTransform(this.svgElement.node());return{translate:[e.x,e.y],scale:e.k}},n.prototype.setZoomTransform=function(e,t){var i;this.svgElement.call(this.zoom.transform,(i=d3.zoomIdentity).translate.apply(i,e).scale(t))},n.prototype.renderNodes=function(e,t,i){var a=e.selectAll("g"+c.treeNode.selector).filter(function(){return!d3.select(this).classed(c.exiting.class)}).data(t,function(l){return l.data.key}),o=this.createNodes(a.enter()).merge(a);return this.updateNodes(o,i.levels),this.removeNodes(a.exit()),o},n.prototype.createNodes=function(e){var t=this,i=e.append("g").attr("class",c.treeNode.class).attr("transform",function(l){return"translate(".concat(l.x,", ").concat(l.y-t.treeVisualConfig.dataBarHeight/2,")")}).attr("opacity",0),a=i.append("g").attr("class",c.dataBar.class);a.append("rect").attr("class",c.dataBarBackground.class).attr("width",this.treeVisualConfig.dataBarWidth).attr("height",this.treeVisualConfig.dataBarHeight),a.append("rect").attr("class",c.valueDataBar.class).attr("width",0).attr("height",this.treeVisualConfig.dataBarHeight),a.append("rect").attr("class",c.highlightDataBar.class).attr("width",0).attr("height",this.treeVisualConfig.dataBarHeight),a.append("rect").attr("class",c.dataBarSeparator.class).attr("width",this.treeVisualConfig.dataBarSeparatorThickness).attr("height",this.treeVisualConfig.dataBarSeparatorHeight).attr("y",(this.treeVisualConfig.dataBarHeight-this.treeVisualConfig.dataBarSeparatorHeight)/2).attr("x",this.treeVisualConfig.dataBarWidth/2).attr("visibility","hidden").attr("fill",this.visualStyle.dataBarSeparatorFillColor);var r=i.append("text").attr("y",this.treeVisualConfig.dataBarHeight+this.treeVisualConfig.categoryLabelHeight);r.append("tspan").attr("class",c.label.class).attr("width",this.treeVisualConfig.dataBarWidth).attr("x",this.treeVisualConfig.labelLeftMargin).text(function(l){return l.data.name}).each(E),r.append("tspan").filter(function(l){return!!l}).attr("class",c.value.class).attr("width",this.treeVisualConfig.dataBarWidth).attr("x",this.treeVisualConfig.labelLeftMargin).attr("dy",this.treeVisualConfig.valueLabelHeight);var o=this;return i.append("rect").attr("class",c.nodeOverlay.class).attr("width",this.treeVisualConfig.dataBarWidth).attr("height",this.treeVisualConfig.dataBarHeight+this.treeVisualConfig.valueLabelHeight+this.treeVisualConfig.categoryLabelHeight).style("fill","none").style("pointer-events","visible").on("click",function(l){var d=d3.event;t.isPanning||t.nodeClicked.emit({node:l.data,point:{x:d.clientX,y:d.clientY}}),d.stopPropagation()}).on("contextmenu",function(l){var d=d3.event;t.nodeContextMenu.emit({node:l.data,point:{x:d.clientX,y:d.clientY}}),d.preventDefault(),d.stopPropagation()}).on("mousemove",function(){var l=d3.select(this).datum().data,d=d3.event;o.tooltipService&&o.tooltipService.show({coordinates:[d.clientX,d.clientY],identities:[l.selector],dataItems:l.tooltips,isTouchEvent:o.isTouchEvent})}).on("mouseover",function(){d3.select(this.parentElement).style("opacity",o.treeVisualConfig.hoverOpacity)}).on("mouseout",function(){o.tooltipService&&o.tooltipService.hide({immediately:!0,isTouchEvent:o.isTouchEvent}),d3.select(this.parentElement).style("opacity",null)}),i},n.prototype.updateNodes=function(e,t){var i=this,a=this.enableTransitions?e.transition():e;a.attr("opacity",function(u){return!i.selectedNode||i.isSelectedNodeAncestor(u)||i.isSelectedNode(u)?1:i.treeVisualConfig.crossFilterOpacity}).attr("transform",function(u){return"translate(".concat(u.x,", ").concat(u.y-i.treeVisualConfig.dataBarHeight/2,")")}),e.select("text").attr("y",this.treeVisualConfig.dataBarHeight+this.treeVisualConfig.categoryLabelHeight);var r=function(v){return t[v.data.level]&&t[v.data.level].highlight||0},o=function(v){var f=t[v.data.level];return f&&f.scale?i.dataBarScale(Math.abs(f.scale.range()[0])):0},l=function(v,f){var h=function(w){var x=f?w.data.highlight:w.value;return _.isFinite(x)?x:0},m=function(w){return 2===r(w)?i.treeVisualConfig.highlightDataBarHeightRatio:1},L=function(w){var x=t[w.data.level];return x&&x.scale?i.dataBarScale(Math.abs(x.scale(h(w)))):0},N=e.select(v);N.filter(function(C){return!(d3.select(this).property("_previousValue_")*h(C)>=0)}).attr("x",function(C){return o(C)}).attr("width",0),N.style("display","block").style("fill",function(C){return h(w=C)>=0?w.data.barColor?w.data.barColor:i.visualStyle.positiveBarColor:w.data.barColor?w.data.barColor:i.visualStyle.negativeBarColor;var w}).property("_previousValue_",function(C){return h(C)}),a.select(v).filter(function(C){return!f||0!==r(C)}).attr("x",function(C){return o(C)-(C.value<0?L(C):0)}).attr("width",function(C){return L(C)}).attr("y",function(C){return f?i.treeVisualConfig.dataBarHeight*(1-m(C))/2:0}).attr("height",function(C){return i.treeVisualConfig.dataBarHeight*(f?m(C):1)}).attr("opacity",function(C){return f||0===r(C)?1:i.treeVisualConfig.highlightDataBarOpacity}),f&&N.filter(function(C){return 0===r(C)}).style("display","none")};l(c.valueDataBar.selector,!1),l(c.highlightDataBar.selector,!0),e.select(c.dataBarSeparator.selector).attr("x",function(u){return o(u)}).attr("visibility",function(u){return o(u)>0?null:"hidden"}),e.select(c.dataBarBackground.selector).attr("width",this.treeVisualConfig.dataBarWidth).style("stroke",function(u){return i.isHighlightedNode(u)?i.visualStyle.dataBarHighlightedStrokeColor:""}).style("fill",this.visualStyle.dataBarBackgroundColor);var d=function(v){return i.isHighlightedNode(v)?i.visualStyle.boldLabelFont:i.visualStyle.labelFont};e.select(c.label.selector).classed("pathNode",function(u){return i.isHighlightedNode(u)}).attr("width",this.treeVisualConfig.dataBarWidth).style("font-family",function(u){return d(u).family}).style("font-size",this.visualStyle.labelFont.size.px+"px").style("font-style",this.visualStyle.labelFont.style).style("text-decoration",this.visualStyle.labelFont.textDecoration).style("font-weight",function(u){return d(u).weight}).style("fill",function(u){return d(u).color}).text(function(u){return u.data.name}).each(E),e.select(c.value.selector).styles((0,H.E_)(this.visualStyle.valueFont)).attr("width",this.treeVisualConfig.dataBarWidth).attr("dy",this.treeVisualConfig.valueLabelHeight).text(function(u){return 0===r(u)?u.data.formattedValue:u.data.formattedHighlightValue}).each(E),e.select(c.nodeOverlay.selector).attr("width",this.treeVisualConfig.dataBarWidth).attr("height",this.treeVisualConfig.dataBarHeight+this.treeVisualConfig.valueLabelHeight+this.treeVisualConfig.categoryLabelHeight)},n.prototype.removeNodes=function(e){var t=this;e.classed(c.exiting.class,!0),(this.enableTransitions&&!this.visualStyle.isHighContrast?e.transition():e).style("opacity",0).attr("transform",function(a){return"translate(".concat(a.x,", ").concat(t.isCollapsing(a)?a.parent.y:a.y-t.treeVisualConfig.dataBarHeight/2,")")}).remove()},n.prototype.isCollapsing=function(e){return!this.viewModel.levels[e.data.level-1]||e.parent&&!this.viewModel.levels[e.data.level-1].expandedNode},n.prototype.renderLinks=function(e,t){var a,i=this,r=null===(a=_.first(t))||void 0===a?void 0:a.links(),o=e.selectAll("path"+c.link.selector).filter(function(){return!d3.select(this).classed(c.exiting.class)}).data(r,function(h){return h.target.data.key}),d=o.enter().insert("path","g").attr("class",c.link.class).style("fill","none").style("vector-effect","non-scaling-stroke").attr("d",function(h){return i.linkGenerator({source:{x:h.source.x+i.treeVisualConfig.dataBarWidth-1,y:h.source.y},target:h.target})}).merge(o);(this.enableTransitions?d.transition():d).attr("d",function(h){return i.linkGenerator({source:{x:h.source.x+i.treeVisualConfig.dataBarWidth-1,y:h.source.y},target:h.target})}),d.attr("opacity",function(h){return!i.selectedNode||i.isSelectedNodeAncestor(h.target)||i.isSelectedNode(h.target)?1:i.treeVisualConfig.crossFilterOpacity}).style("stroke-dasharray",function(h){return h.target.data.isAIHighlighted?2:void 0}),d.filter(function(h){return i.isHighlightedNode(h.target)}).style("stroke",this.visualStyle.linkHighlightedStrokeColor).style("stroke-width",function(h){return i.treeVisualConfig.linkHighlightedStrokeThickness}),d.filter(function(h){return!i.isHighlightedNode(h.target)}).style("stroke",this.visualStyle.linkStrokeColor).style("stroke-width",function(h){return i.treeVisualConfig.linkDefaultStrokeThickness});var v=o.exit();return v.classed(c.exiting.class,!0),(this.enableTransitions?v.transition():v).style("stroke",this.visualStyle.linkStrokeColor).style("opacity",0).attr("d",function(h){return i.linkGenerator({source:{x:h.source.x+i.treeVisualConfig.dataBarWidth-1,y:h.source.y},target:{x:h.target.x,y:i.isCollapsing(h.target)?h.target.parent.y:h.target.y}})}).remove(),d},n.prototype.renderExpandButtons=function(e,t){var i=this,a=this,r=e.selectAll("text"+c.expandButton.selector).data(t,function(u){return u.data.key}),o=r.enter().append("text").attr("class",c.expandButton.class).style("font-family",this.treeVisualConfig.expandFontFamily).style("font-size",this.treeVisualConfig.expandFontSize).style("cursor","pointer").attr("transform",function(u){return"translate(".concat(u.x+i.treeVisualConfig.dataBarWidth+i.treeVisualConfig.expandLeftMargin/2,", ").concat(u.y+i.treeVisualConfig.dataBarHeight/2+i.treeVisualConfig.expandTopMargin,")")}).attr("opacity",0).text("+").on("mouseover",function(){d3.select(this).style("fill",a.visualStyle.hoverColor)}).on("mouseout",function(){d3.select(this).style("fill",a.visualStyle.iconColor)});o.append("title").text(this.stringResourceProvider.get("DecompositionTree_ExpandButton_Tooltip"));var l=o.merge(r),d=this.enableTransitions?l.transition():l;l.style("fill",this.visualStyle.iconColor).on("click",function(u){var v=d3.event;if(a.isPanning)v.stopPropagation();else{var f=this.getBoundingClientRect();a.expandButtonClicked.emit({point:{x:f.left+f.width/2,y:f.top+f.height/2},node:u.data}),v.stopPropagation()}}),d.attr("opacity",1).attr("transform",function(u){return"translate(".concat(u.x+i.treeVisualConfig.dataBarWidth+i.treeVisualConfig.expandLeftMargin,", ").concat(u.y+i.treeVisualConfig.dataBarHeight/2+i.treeVisualConfig.expandTopMargin,")")}),r.exit().remove()},n.prototype.renderLoadMoreButtons=function(e,t){var i=this,a=e.selectAll("text"+c.loadMore.selector).data(t,function(v){return"".concat(v.data.level,"-").concat(v.data.restartKind)}),o=this,d=a.enter().append("text").attr("class",c.loadMore.class).attr("transform",function(v){return"translate(".concat(v.x+i.treeVisualConfig.loadMoreXOffset,", ").concat(v.y,")")}).attr("opacity",0).style("font-family",this.treeVisualConfig.glyphIconFamily).style("font-size",this.treeVisualConfig.iconFontSize).style("font-weight",900).style("cursor","pointer").on("click",function(v){i.isPanning||i.loadMoreClicked.emit(v.data),d3.event.stopPropagation()}).on("mouseover",function(){d3.select(this).style("fill",o.visualStyle.hoverColor)}).on("mouseout",function(){d3.select(this).style("fill",o.visualStyle.iconColor)}).merge(a);return d.style("fill",this.visualStyle.iconColor).text(function(v){return 1===v.data.restartKind?"\ue70e":"\ue70d"}).append("title").text(function(v){return i.stringResourceProvider.get(1===v.data.restartKind?"DecompositionTree_ScrollLevelUp_Tooltip":"DecompositionTree_ScrollLevelDown_Tooltip")}),(this.enableTransitions&&!this.responsiveLayout?d.transition():d).attr("opacity",1).attr("transform",function(v){return"translate(".concat(v.x+i.treeVisualConfig.loadMoreXOffset,", ").concat(1===(f=v).data.restartKind?f.parent.children[0].y+i.treeVisualConfig.loadMoreYOffsetBefore:_.last(f.parent.children).y+i.treeVisualConfig.loadMoreYOffsetAfter,")");var f}),a.exit().remove(),d},n.prototype.renderRecenterButtons=function(e,t){var i=this,a=this,r=e.selectAll("text"+c.recenterButton.selector).data(t,function(v){return"".concat(v.data.level,"-").concat(v.data.restartKind)}),l=r.enter().append("text").attr("class",c.recenterButton.class).attr("transform",function(v){return"translate(".concat(v.x+i.treeVisualConfig.loadMoreXOffset,", ").concat(v.y,")")}).attr("opacity",0).style("font-family",this.treeVisualConfig.glyphIconFamily).style("font-size",this.treeVisualConfig.iconFontSize).style("font-weight",900).style("cursor","pointer").on("click",function(v){i.isPanning||i.loadMoreClicked.emit(v.data),d3.event.stopPropagation()}).on("mouseover",function(){d3.select(this).style("fill",a.visualStyle.hoverColor)}).on("mouseout",function(){d3.select(this).style("fill",a.visualStyle.iconColor)}).merge(r);return l.style("fill",this.visualStyle.iconColor).attr("opacity",1).text("\ue712").append("title").text(this.stringResourceProvider.get("DecompositionTree_RecenterButton_Tooltip")),(this.enableTransitions&&!this.responsiveLayout?l.transition():l).attr("transform",function(v){return"translate(".concat(v.x+i.treeVisualConfig.loadMoreXOffset,", ").concat((f=v).data.position>0?f.y+i.treeVisualConfig.recenterButtonBeforeYOffset*i.layoutDensityFactor:f.y+i.treeVisualConfig.recenterButtonAfterYOffset*i.layoutDensityFactor,")");var f}),r.exit().remove(),l},n.prototype.showUnlockIcons=function(e){e&&e.isAILevel||!this.allowLocking||this.isVisualReadOnly||this.svgHeaderGroup.selectAll(c.lockedLevel.selector).filter(function(t){return!t.isAILevel&&!t.isLocked&&t.level<=e.level}).text("\ue785").style("display","block")},n.prototype.hideUnlockIcons=function(){this.svgHeaderGroup.selectAll(c.lockedLevel.selector).filter(function(e){return!e.isLocked}).style("display","none")},n.prototype.renderLevels=function(e,t){var i=e.selectAll("g"+c.levelHeader.selector).data(t),r=this.createLevelHeaders(i.enter()).merge(i);return this.updateLevelHeaders(r),this.removeLevelHeaders(i.exit()),r},n.prototype.createLevelHeaders=function(e){var t=this,i=e.append("g").attr("class",c.levelHeader.class).attr("role","heading").attr("aria-level",function(l,d){return d+1}).attr("transform",function(l,d){return"translate(".concat(t.levelPositionScale(d),", ").concat(t.treeVisualConfig.marginTop,")")}),a=i.filter(function(l){return l.level>0}).on("focus",function(l){o.hideUnlockIcons(),o.showUnlockIcons(l)}),r=a.append("text"),o=this;return r.append("tspan").attr("class",c.aiLevel.class).attr("x",this.treeVisualConfig.aiIconXOffset).attr("y",this.treeVisualConfig.aiIconYOffset).style("font-family",this.treeVisualConfig.glyphIconFamily).style("font-size",this.treeVisualConfig.iconFontSize).style("display","none").text("\uea80"),r.append("tspan").attr("class",c.lockedLevel.class).attr("x",this.treeVisualConfig.aiIconXOffset).attr("y",this.treeVisualConfig.aiIconYOffset).style("font-family",this.treeVisualConfig.glyphIconFamily).style("font-size",this.treeVisualConfig.iconFontSize).style("display","none").text("\ue72e"),a.append("rect").attr("class",c.iconOverlay.class).attr("x",this.treeVisualConfig.aiIconXOffset).attr("y",this.treeVisualConfig.iconOverlayYOffset).attr("width",this.treeVisualConfig.iconOverlayWidth).attr("height",this.treeVisualConfig.iconOverlayHeight).style("opacity",0).append("title").text(function(l){return l.tooltipData}),r.append("tspan").attr("class",c.levelTitle.class).attr("width",this.treeVisualConfig.dataBarWidth-this.treeVisualConfig.removeLevelWidth).attr("x",0).attr("y",0).style("cursor","pointer").on("click",function(l){var d=d3.event;if(o.isPanning)d.stopPropagation();else{var u=this;if(this.parentNode&&this.parentNode.parentNode){var v=d3.select(u.parentNode.parentElement).select(c.levelTitleUnderline.selector).node();v&&(u=v)}o.levelClicked.emit({element:u,level:l}),d.stopPropagation()}}).on("mouseover",function(l){d3.select(this).style("fill",o.visualStyle.hoverColor),o.showUnlockIcons(l)}).on("mouseout",function(){d3.select(this).style("fill",o.visualStyle.levelTitleFont.color)}),r.filter(function(l){return 0!==l.level&&!t.isVisualReadOnly}).append("tspan").attr("class",c.removeLevel.class).attr("x",this.treeVisualConfig.dataBarWidth-this.treeVisualConfig.removeLevelWidth).attr("y",this.treeVisualConfig.removeLevelYOffset).style("font-family",this.treeVisualConfig.removeLevelFontFamily).style("font-size",this.treeVisualConfig.removeLevelFontSize).style("display","block").style("cursor","pointer").text("\xd7").on("click",function(l){o.isPanning||t.removeLevelButtonClicked.emit(l),d3.event.stopPropagation()}).on("mouseover",function(l){d3.select(this).style("fill",o.visualStyle.hoverColor),o.showUnlockIcons(l)}).on("mouseout",function(){d3.select(this).style("fill",o.visualStyle.iconColor)}).append("title").text(this.stringResourceProvider.get("DecompositionTree_RemoveLevel_Tooltip")),r.append("tspan").attr("class",c.levelSubtitle.class).attr("width",this.treeVisualConfig.dataBarWidth).style("display",this.showSubtitles?null:"none").attr("x",0).attr("y",this.treeVisualConfig.subtitleHeight).on("mouseover",function(l){return t.showUnlockIcons(l)}),a.append("rect").attr("class",c.levelTitleUnderline.class).attr("y",this.treeVisualConfig.underlineYOffset).attr("height",this.treeVisualConfig.underlineHeight).attr("width",this.treeVisualConfig.dataBarWidth).style("fill",this.visualStyle.accentColor).on("mouseover",function(l){return t.showUnlockIcons(l)}),i},n.prototype.updateLevelHeaders=function(e){var t=this,i=this.enableTransitions?e.transition():e,a=this,r=(0,H.E_)(this.visualStyle.levelTitleFont);i.attr("transform",function(o,l){return"translate(".concat(t.levelPositionScale(l),", ").concat(t.treeVisualConfig.marginTop,")")}),e.select("tspan"+c.lockedLevel.selector).style("fill",this.visualStyle.accentColor).style("display",function(o){return o.isLocked?"block":"none"}).text("\ue72e"),e.select(c.aiLevel.selector).style("display",function(o){return o.isAILevel?"block":"none"}).style("fill",function(o){return o.isAILevel?o.aiResult.disabled?t.visualStyle.disabledColor:t.visualStyle.accentColor:null}),e.select("rect"+c.iconOverlay.selector).style("cursor",function(o){if((t.allowLocking||o.isAILevel)&&!t.isVisualReadOnly)return"pointer"}).on("mouseover",function(o){a.showUnlockIcons(o),e.select("rect"+c.iconOverlay.selector).select("title").text(o.tooltipData)}).on("click",function(o){a.isPanning||t.levelIconClicked.emit(o),d3.event.stopPropagation()}),e.select(c.levelTitle.selector).styles(r).style("font-style",function(o){return o.isAILevel&&o.isEmpty?"italic":r["font-style"]}).attr("width",this.treeVisualConfig.dataBarWidth-this.treeVisualConfig.removeLevelWidth).text(function(o){return o.displayName}).each(E).append("title").text(function(o){return o.displayName}),e.select(c.removeLevel.selector).style("fill",this.visualStyle.iconColor).style("display",function(o){return o.isLocked?"none":"block"}).attr("x",this.treeVisualConfig.dataBarWidth-this.treeVisualConfig.removeLevelWidth),e.select(c.levelSubtitle.selector).styles((0,H.E_)(this.visualStyle.levelSubtitleFont)).style("display",this.showSubtitles?null:"none").attr("width",this.treeVisualConfig.dataBarWidth).attr("y",this.treeVisualConfig.subtitleHeight).text(function(o){return o.pathNodeName?o.pathNodeName:""}).each(E).append("title").text(function(o){return o.pathNodeName}),e.select(c.levelTitleUnderline.selector).style("fill",this.visualStyle.accentColor).attr("width",this.treeVisualConfig.dataBarWidth)},n.prototype.removeLevelHeaders=function(e){e.remove()},Object.defineProperty(n.prototype,"horizontalDensityFactor",{get:function(){return Math.max(this.treeVisualConfig.minHorizontalLayoutDensityFactor,Math.min(this.treeVisualConfig.maxHorizontalLayoutDensityFactor,this.layoutDensityFactor))},enumerable:!1,configurable:!0}),n.prototype.isHighlightedNode=function(e){return e.data.expanded||this.isSelectedNodeAncestor(e)||this.isSelectedNode(e)||e.data.isAIHighlighted},n.prototype.isSelectedNode=function(e){return this.selectedNode&&e.data.key===this.selectedNode.key},n.prototype.isSelectedNodeAncestor=function(e){return this.selectedNode&&e.data.expanded&&e.data.level<this.selectedNode.level},n.prototype.enablePanAndZoom=function(e){var i,t=this,a=this;this.zoom=d3.zoom().scaleExtent([this.treeVisualConfig.minZoom,this.treeVisualConfig.maxZoom]).on("start",function(){var r=d3.zoomTransform(this);i=[r.x,r.y]}).on("zoom",function(){a.applyLayoutTransform(!1);var r=d3.zoomTransform(this);i&&!_.isEqual(i,[r.x,r.y])&&(a.isPanning=!0)}).on("end",function(){setTimeout(function(){return t.isPanning=!1})}),y.fF.assert(function(){return 1===e.size()},"d3.zoom() only works to apply zoomBehavior on a single node)"),e.call(this.zoom).on("dblclick.zoom",null)},n.prototype.getBounds=function(e){var t=this;return _.reduce(e,function(o,l){return o.x[0]=Math.min(o.x[0],l.x),o.x[1]=Math.max(o.x[1],l.x+t.treeVisualConfig.dataBarWidth),o.y[0]=Math.min(o.y[0],l.y),o.y[1]=Math.max(o.y[1],l.y+t.nodeVerticalSpacing),o},{x:[1/0,-1/0],y:[1/0,-1/0]})},n}(),U=F(38958),O=F(72489),ve=function(){function n(e){this.stringResourceProvider=e,this.rootLabel=this.stringResourceProvider.get("TableTotalLabel")}return n.prototype.buildViewModel=function(e,t,i,a,r,o,l,d,u){var v=this;y.fF.assertValue(e,"dataView must be defined");var f=e.matrix;y.fF.assertValue(f,"dataView.matrix must be defined"),y.fF.assertValue(f.rows,"dataView.matrix.rows must be defined");var h=this.getRolesMap(f.valueSources,a,r);if(h.analyze){var S=_.size(f.valueSources),p=z.visitSubTree(f.rows.root,function(x,V){return v.matrixNodeToDecompositionTreeNode(x,f,h,V,S)});y.fF.assertValue(p,"invalid data view");var L=this.getLevels(p,f,o),N=_.first(f.rows.expansionStates),C={root:p,levels:L,unpinnedDimensions:this.getAvailableDimensions(L,e.metadata.columns),roleInfoMap:h};return this.updateLevelsScale(C,i,d,u),this.updateAILevels(C,N,_.size(e.matrix.rows.levels)+1,t,l),C}},n.prototype.updateLevelsScale=function(e,t,i,a){y.fF.assertValue(e,"viewModel is not defined");for(var r=Math.abs(e.root.value),o=0,l=e.levels;o<l.length;o++){var d=l[o],u=void 0;if(0===d.level)u=e.root.value>0?[0,e.root.value]:[e.root.value,0];else switch(t){case"topNode":u=d.minNodeValue<0?[-1*r,r]:[0,r];break;case"parentNode":var v=Math.abs(d.parentValue);u=d.minNodeValue<0?[-1*v,v]:[0,v];break;case"levelMaximum":var f=Math.max(Math.abs(d.maxNodeValue),Math.abs(d.minNodeValue));u=d.minNodeValue<0?[-f,f]:[0,f];break;default:return void y.fF.assertFail("Invalid data bar scaling type")}var h=i??u[0],S=a??u[1];h<S&&(u=[h,S]);var m=[0,0];if(u[1]!==u[0]){var p=Math.max(u[1],0)-Math.min(u[0],0)||1;m=[Math.min(u[0],0)/p,Math.max(u[1],0)/p]}d.scale=d3.scaleLinear().domain(u).range(m).clamp(!0)}},n.prototype.matrixNodeToDecompositionTreeNode=function(e,t,i,a,r){if(void 0===a&&(a=null),e){var o=!a;if(o||e.identity&&!e.isSubtotal){var f,h,S,m,l=this.getNodeValues(e,r),d=i.analyze,u=d.metadataColumn.displayName,v=d.valueSourceIndex;_.isEmpty(l)||(m=l[v],_.isNumber(m.value)&&(h=m.value),null===m.highlight?S=null:_.isNumber(m.highlight)&&(S=m.highlight));var p=o?void 0:_.first(t.rows.levels[e.level].sources);if(o){f=u||this.rootLabel;var L=t.valueSources[v];L.aggregates&&_.isNumber(L.aggregates.subtotal)&&(h=L.aggregates.subtotal)}else{var N=_.find(e.levelValues,function(ye){return 0===ye.levelSourceIndex});y.fF.assertValue(N,"Level value must be defined"),N&&(f=(0,O.WU)(N.value,p?.format))}var w,C=d.formatter.format(h,m?.objects),x=p?[{displayName:p.displayName,value:f}]:[];x.push({displayName:u,value:C}),void 0!==S&&(w=d.formatter.format(S,m?.highlightObjects),x.push({displayName:this.stringResourceProvider.get("Tooltip_HighlightedValueDisplayName"),value:w}));var V=i.tooltips;if(!_.isEmpty(V))for(var M=0,T=V;M<T.length;M++){var W=T[M];x.push({displayName:W.metadataColumn.displayName,value:W.formatter.format(l[W.valueSourceIndex].value,m?.objects)})}var ge=o?0:e.level+1,J={children:[],expanded:!1,formattedValue:C,isAIHighlighted:(0,B.NA)(e.objects,{objectName:s.I8.insights,propertyName:s.hq.isAINode},!1),name:f,level:ge,parent:a,value:h,highlight:S,formattedHighlightValue:w,key:o?n.RootKey:e.identity.key,selector:this.getNodeSelector(e.identity,a,p&&p.queryName),restartKind:e.restartKind?e.restartKind:0,restartValues:e.restartValues,tooltips:x,position:a?_.size(a.children):0,barColor:this.getColorFromObjects(e,v)};return o||(a.children.push(J),a.expanded=!0),J}}},n.prototype.getRolesMap=function(e,t,i){for(var a,r,o=_.uniq(e),l={objectName:"general",propertyName:"formatString"},d=0;d<_.size(o);d++){var u=o[d];(0,U.nu)(u,s.Fw.analyze)&&(a={valueSourceIndex:d,metadataColumn:u,formatter:new O.g({column:u,formatStringPropId:l,nullsAreBlank:!1,displayUnit:t,precision:i,trailingZeroes:!0})}),(0,U.nu)(u,s.Fw.tooltips)&&(r||(r=[]),r.push({valueSourceIndex:d,metadataColumn:u,formatter:new O.g({column:u,formatStringPropId:l,nullsAreBlank:!1,displayUnit:t,precision:i,trailingZeroes:!0})}))}return{analyze:a,tooltips:r}},n.prototype.getLevels=function(e,t,i){y.fF.assertValue(e,"node must be defined"),y.fF.assertValue(t,"dataViewMatrix must be defined");var a=t.rows.levels;y.fF.assertValue(a,"dataViewHierarchyLevels must be defined");var r=[{level:0,maxNodeValue:-1/0,minNodeValue:1/0,highlight:void 0!==e.highlight?1:0}],o=_.first(t.rows.expansionStates);if(!o||!o.levels)return r;var l=_.findLastIndex(o.levels,function(x){return x.isPinned});y.fF.assert(function(){return l+1>=_.size(a)},"pinnedLevelsCount < levels");var d=Math.max(l+1,_.size(a));y.fF.assert(function(){return d<=o.levels.length},"Count of pinned levels is greater than the number of dimensions");for(var u=Math.min(d,o.levels.length),v=0;v<u;v++){var f=_.first(o.levels[v].sources);y.fF.assertValue(f,"Expansion state level sources should not be empty.");var h=o.levels[v].isLocked,S=void 0;i&&(S=this.stringResourceProvider.get(h?"DecompositionTree_LevelLocked_Tooltip":"DecompositionTree_LockLevel_Tooltip")),r.push({queryRef:f.queryName,displayName:f.displayName,level:v+1,maxNodeValue:-1/0,minNodeValue:1/0,isLocked:h,highlight:0,tooltipData:S})}var m=this.getExpansionPath(o);y.fF.assert(function(){return m.length<=u},"Expansion path length is greater than the count of pinned levels");for(var p=Math.min(m.length,u),L=(v=0,1);v<p;v++,L++){var N=m[v];r[L]=(0,D.__assign)((0,D.__assign)({},r[L]),{pathNodeName:(0,O.WU)(_.first(N))})}var C=!1;return z.visitSubTree(e,function(V,M){if(M[V.level]){var T=M[V.level];return V.parent&&(T.parentValue=V.parent.value),_.isFinite(V.value)&&(T.maxNodeValue=Math.max(T.maxNodeValue,V.value),T.minNodeValue=Math.min(T.minNodeValue,V.value),V.value>0&&V.highlight>V.value||V.value<0&&V.highlight<V.value?T.highlight=2:void 0!==V.highlight&&2!==T.highlight&&(T.highlight=1)),_.isFinite(V.highlight)&&(T.maxNodeValue=Math.max(T.maxNodeValue,V.highlight),T.minNodeValue=Math.min(T.minNodeValue,V.highlight)),_.isEmpty(V.children)||(T.expandedNode=V),M}C=!0},r),y.fF.assert(function(){return!C},"Tree depth is greater than the count of pinned levels"),this.populateScopeAggregates(t,r),r},n.prototype.getExpansionPath=function(e){var t=[];if(!e||!e.root||!e.root.children)return t;for(var a=_.find(e.root.children,function(r){return r.isExpanded});a;)t.push(a.values),a=_.find(a.children,function(r){return r.isExpanded});return t},n.prototype.populateScopeAggregates=function(e,t){var i=this;y.fF.assertValue(e,"dataViewMatrix"),y.fF.assertNonEmpty(t,"levels");var a=e.valueSources;if(_.size(a)<1)y.fF.assertFail("Expected one value source");else{var r=a[0].scopedAggregates;r&&(y.fF.assert(function(){return 1===r.length},"Decomposition tree expects only one global scope aggregate."),this.setScopeAggregateValueToLevel(r[0].values,t[1])),z.visitSubTree(e.rows.root,function(d,u){if(d.isSubtotal){var v=d.aggregateValues;if(v){y.fF.assert(function(){return 1===v.length},"Decomposition tree node expects only one scope aggregate");var f=v[0],h=u[d.level+1];y.fF.assertValue(h,"Tree depth is greater than the count of pinned levels"),i.setScopeAggregateValueToLevel(f.values,h),i.setScopeAggregateValueToLevel(f.highlight,h)}}return u},t)}},n.prototype.setScopeAggregateValueToLevel=function(e,t){!e||!t||(e.max&&_.isFinite(e.max)&&(t.maxNodeValue=Math.max(t.maxNodeValue,e.max)),e.min&&_.isFinite(e.min)&&(t.minNodeValue=Math.min(t.minNodeValue,e.min)))},n.prototype.updateAILevels=function(e,t,i,a,r){y.fF.assertValue(e,"View model must be defined");var o=e.levels,l=[];if(t){var d=_.map(t.levels,function(L){return L.AIInformation}),u=_.findIndex(d,function(L){return L}),v=_.findLastIndex(d,function(L){return L});l=_.slice(d,u,v+1),_.forEach(l,function(L){return y.fF.assertValue(L,"AI levels must be contiguous")}),l=_.takeWhile(l,function(L){return L})}var f=_.size(l);if(y.fF.assert(function(){return _.size(o)>f},"Count of AI levels > number of levels"),0===f||r)z.visitSubTree(e.root,function(L){L.isAIHighlighted=!1});else{var h=_.findIndex(l,function(L){return!L.disabled});h=-1===h?f:h;for(var S=Math.max(_.size(o)-f,0),m=0;m<f;m++)(p=o[S+m]).isAILevel=!0,p.isEmpty=S+m>=i,p.aiResult={method:l[m].method,disabled:m<h};for(z.visitSubTree(e.root,function(L){var N=o[L.level];L.isAIHighlighted=L.isAIHighlighted&&!!N.aiResult&&!N.aiResult.disabled,L.isAIHighlighted&&(N.aiRecommendedNode=L)}),m=0;m<f;m++){var p;(p=o[S+m]).tooltipData=this.getAITTooltipDescription(p,e.root.name,a)}}},n.prototype.getAITTooltipDescription=function(e,t,i){if(e.isAILevel){if(!e.aiRecommendedNode){var a="";switch(e.aiResult.method){case"MaxSplit":a=this.stringResourceProvider.get("DecompositionTree_AnalysisMethod_HighValue");break;case"MinSplit":a=this.stringResourceProvider.get("DecompositionTree_AnalysisMethod_LowValue");break;case"BestSplit":return void y.fF.assertFail("".concat(e.aiResult.method," is not supported"));default:y.fF.assertNever(e.aiResult.method)}return this.stringResourceProvider.format(e.isEmpty?"DecompositionTree_Recommendation_Unexpanded":"DecompositionTree_Recommendation_Unselected",a.toLowerCase())}if("absolute"===i)switch(e.aiResult.method){case"MaxSplit":return this.stringResourceProvider.format("DecompositionTree_AnalysisTooltipDescription_MaxSplit",t,e.displayName,e.aiRecommendedNode.name);case"MinSplit":return this.stringResourceProvider.format("DecompositionTree_AnalysisTooltipDescription_MinSplit",t,e.displayName,e.aiRecommendedNode.name);case"BestSplit":return void y.fF.assertFail("".concat(e.aiResult.method," is not supported"));default:y.fF.assertNever(e.aiResult.method)}else switch(e.aiResult.method){case"MaxSplit":return this.stringResourceProvider.format("DecompositionTree_AnalysisTooltipDescription_RelativeMaxSplit",t,e.displayName,e.aiRecommendedNode.name);case"MinSplit":return this.stringResourceProvider.format("DecompositionTree_AnalysisTooltipDescription_RelativeMinSplit",t,e.displayName,e.aiRecommendedNode.name);case"BestSplit":return void y.fF.assertFail("".concat(e.aiResult.method," is not supported"));default:y.fF.assertNever(e.aiResult.method)}}},n.prototype.getNodeValues=function(e,t){var i=_.find(e.children,function(l){return l.isSubtotal});i||(i=_.first(e.children)),i||(i=e);var a=[];if(_.isEmpty(i.values))return a;for(var r=0;r<t;r++)i.values[r]&&a.push(i.values[r]);return a},n.prototype.getNodeSelector=function(e,t,i){if(!e)return{dataMap:{}};y.fF.assertValue(t,"Node parent must be defined");var a={metadata:[i],dataMap:{}};if(t.selector)for(var r in t.selector.dataMap)a.dataMap[r]=t.selector.dataMap[r];return a.dataMap[i]=[e],a},n.prototype.getAvailableDimensions=function(e,t){var i=_.filter(t,function(r){return(0,U.nu)(r,s.Fw.explainBy)});if(_.isEmpty(i))return[];var a=_.filter(i,function(r){return!_.some(e,function(o){return o.queryRef===r.queryName})});return _.map(a,function(r){return{displayName:r.displayName,queryRef:r.queryName}})},n.prototype.getColorFromObjects=function(e,t){y.fF.assertValue(e,"matrixNode"),y.fF.assert(function(){return t>=0},"targetValueIndex should not be negative.");var i=_.find(e.children,function(o){return o.isSubtotal});if(_.some(e.values)&&(i=e),i&&!_.isEmpty(i.values)){var a=(0,B.NA)(i.values[t].objects,{objectName:s.I8.dataBars,propertyName:s.hq.dataBarColor},void 0);if(a)return a&&a.solid&&a.solid.color}},n.RootKey="root",n}(),fe=function(){function n(e){void 0===e&&(e={}),this.contextMenuYOffset=2,this.aiMode="absolute",this.barsPerLevel=s.bR.defaultValue,this.dataLabelDisplayUnits=0,this.dataLabelPrecision=void 0,this.defaultClickAction="select",this.isAIEnabled=!0,this.scalingType="levelMaximum",this.supportsDecompositionAnalysis=!0,this.isTouchEvent=!0===e.isTouchEvent}return n.prototype.init=function(e){var t=this;y.fF.assertValue(e,"options"),this.featureSwitches=e.featureSwitches,this.host=e.host,this.decompositionAuthoringService=this.host.decompositionService(),this.stringResourceProvider={get:function(r){return t.host.getLocalizedString(r)},getOptional:function(r){return t.host.getLocalizedString(r)},format:function(r){for(var o=[],l=1;l<arguments.length;l++)o[l-1]=arguments[l];return t.host.getLocalizedString(r,o)}},this.viewModelService=new ve(this.stringResourceProvider),this.renderingService=new he(this.stringResourceProvider,this.host.tooltips(),this.isTouchEvent),this.renderingService.isVisualReadOnly=!this.decompositionAuthoringService,this.visualStyle=e.style;var i=Q(this.visualStyle);this.renderingService.init(e.element.get(0),i),this.decompositionAuthoringService&&(this.renderingService.nodeClicked.subscribe(function(a){return t.nodeClicked(a.node,a.point)}),this.renderingService.nodeContextMenu.subscribe(function(a){return t.onNodeContextMenu(a.node,a.point)}),this.renderingService.expandButtonClicked.subscribe(function(a){return t.showExpandContextMenu(a.node,a.point)}),this.renderingService.canvasClicked.subscribe(function(){return t.clearSelection()}),this.renderingService.levelClicked.subscribe(function(a){return t.showUpdateLevelContextMenu(a.element,a.level)}),this.renderingService.removeLevelButtonClicked.subscribe(function(a){t.decompositionAuthoringService.removeLevel(a.queryRef),t.clearSelection()}),this.renderingService.loadMoreClicked.subscribe(function(a){return(0,D.__awaiter)(t,void 0,void 0,function(){return(0,D.__generator)(this,function(r){switch(r.label){case 0:return[4,this.loadMoreClicked(a)];case 1:return[2,r.sent()]}})})}),this.renderingService.levelIconClicked.subscribe(function(a){a.isAILevel?t.decompositionAuthoringService.clearAILevels(a.queryRef):t.renderingService.allowLocking&&t.decompositionAuthoringService.toggleLockedLevels(a.queryRef)})),this.renderingService.resize(e.viewport)},n.prototype.update=function(e){return(0,D.__awaiter)(this,void 0,void 0,function(){var t,i,a,r,o,l;return(0,D.__generator)(this,function(d){switch(d.label){case 0:return this.renderingService.allowLocking=1===this.host.getViewMode(),((0,j.yE)(e.type,G.EP.Resize)||null!=e.resizeMode)&&(this.resize(e.viewport),2===e.resizeMode&&this.resized()),(t=_.first(e.dataViews))?(i=t.metadata&&t.metadata.objects,(0,j.yE)(e.type,G.EP.Data)?(a=this,(r=!!this.decompositionAuthoringService)?[4,this.decompositionAuthoringService.isDecompositionAnalysisSupported()]:[3,2]):[3,5]):[2];case 1:r=d.sent(),d.label=2;case 2:return a.supportsDecompositionAnalysis=r,this.renderingService.visualStyle=Q(this.visualStyle,i),this.dataBarScalingType=this.getDataBarScalingType(i),this.axisStart=this.getAxisStart(i),this.axisEnd=this.getAxisEnd(i),this.dataLabelDisplayUnits=this.getDataLabelDisplayUnits(i),this.dataLabelPrecision=this.getDataLabelPrecision(i),this.renderingService.connectorType=this.getConnectorType(i),this.renderingService.layoutDensity=this.getVisualDensity(i),this.renderingService.showSubtitles=this.getShowSubtitles(i),this.isAIEnabled=this.supportsDecompositionAnalysis&&this.getIsAIEnabled(i),this.aiMode=this.getAIMode(i),this.barsPerLevel=this.getBarsPerLevel(i),this.defaultClickAction=this.getDefaultClickAction(i),o=this.renderingService,(l=this.decompositionAuthoringService)?[4,this.decompositionAuthoringService.isTopNPerLevelSupported()]:[3,4];case 3:l=!d.sent(),d.label=4;case 4:o.useLegacyLayout=l,this.renderingService.responsiveLayout=this.getResponsiveLayout(i),this.windowExpansionState=(0,le.x9)(t),this.render(t),_.some(this.pendingSelection)&&!this.restoreSelection(this.pendingSelection)&&this.host.setWarnings([new re.zC]),this.pendingSelection=null,this.renderingService.responsiveLayout&&this.updateNodesPerLevel(),d.label=5;case 5:return[2]}})})},n.prototype.onClearSelection=function(){this.pendingSelection=null,this.renderingService.selectedNode=null,this.renderingService.render(this.viewModel)},n.prototype.onRestoreSelection=function(e){return this.pendingSelection=null,this.restoreSelection(e.selection)||(this.pendingSelection=e.selection),!0},n.prototype.restoreSelection=function(e){var t=_.first(e);if(t&&this.viewModel){y.fF.assert(function(){return 1===_.size(t.metadata)},"Composite groups are not supported");var i=_.first(t.metadata),a=_.first(t.dataMap&&t.dataMap[i]),r=this.findNode(this.viewModel.root,function(o){if(a&&o.key!==a.key)return!1;var l=_.keys(o.selector.dataMap);if(_.size(l)!==_.size(_.keys(t.dataMap)))return!1;var d=function(h){var S=t.dataMap[h],m=o.selector.dataMap[h];if(_.size(S)!==_.size(m)||_.some(m,function(p,L){return p.key!==S[L].key}))return{value:!1}};for(var u in l){var v=d(u);if("object"==typeof v)return v.value}return!0});if(r)return this.renderingService.selectedNode=r,this.renderingService.render(this.viewModel),!0}return this.onClearSelection(),!1},n.prototype.findNode=function(e,t){if(t(e))return e;if(e&&e.children)for(var i=0,a=e.children;i<a.length;i++){var o=this.findNode(a[i],t);if(o)return o}},n.prototype.render=function(e){this.viewModel=this.viewModelService.buildViewModel(e,this.aiMode,this.scalingType,this.dataLabelDisplayUnits,this.dataLabelPrecision,this.renderingService.allowLocking,this.renderingService.isVisualReadOnly,this.axisStart,this.axisEnd),this.renderingService.render(this.viewModel)},n.prototype.resize=function(e){this.renderingService.resize(e)},n.prototype.resized=function(){this.updateNodesPerLevel(),this.renderingService.render(this.viewModel)},n.prototype.updateNodesPerLevel=function(){var e;this.renderingService.responsiveLayout&&this.barsPerLevel!==this.renderingService.maxVisibleNodesPerLevel&&!this.isUpdateReentrant?(this.isUpdateReentrant=!0,this.host.persistProperties({merge:[{objectName:s.I8.tree,properties:(e={},e[s.hq.effectiveBarsPerLevel]=this.renderingService.maxVisibleNodesPerLevel,e),selector:void 0}]},!0)):this.isUpdateReentrant=!1},n.prototype.enumerateObjectInstances=function(e){var t,i,a,r,o,l,d,u,v,f=new te.G,h=this.renderingService;switch(e.objectName){case s.I8.analysis:this.supportsDecompositionAnalysis&&f.pushInstance({selector:null,objectName:e.objectName,properties:(t={},t[s.hq.aiEnabled]=this.isAIEnabled,t[s.hq.aiMode]=this.aiMode,t)});break;case s.I8.tree:var S={selector:null,objectName:e.objectName,properties:(i={},i[s.hq.density]=h.layoutDensity,i[s.hq.accentColor]=h.visualStyle.accentColor,i[s.hq.connectorDefaultColor]=h.visualStyle.linkStrokeColor,i[s.hq.connectorType]=h.connectorType,i[s.hq.defaultClickAction]=this.defaultClickAction,i)};this.renderingService.useLegacyLayout||(S.properties[s.hq.responsiveLayout]=this.renderingService.responsiveLayout,this.renderingService.responsiveLayout||(S.properties[s.hq.barsPerLevel]=this.barsPerLevel,S.validValues=((a={})[s.hq.barsPerLevel]={numberRange:{min:s.bR.minValue,max:s.bR.maxValue}},a))),f.pushInstance(S);break;case s.I8.dataBars:var m={selector:null,objectName:e.objectName,properties:(r={},r[s.hq.positiveBarColor]=h.visualStyle.positiveBarColor,r[s.hq.negativeBarColor]=h.visualStyle.negativeBarColor,r[s.hq.dataBarBackgroundColor]=h.visualStyle.dataBarBackgroundColor,r[s.hq.dataBarWidthPercent]=h.visualStyle.dataBarWidthPercent,r[s.hq.dataBarScalingType]=this.scalingType,r),propertyTypes:{}};m.properties[s.hq.axisStart]=this.axisStart,m.properties[s.hq.axisEnd]=this.axisEnd,m.propertyTypes[s.hq.axisStart]={numeric:!0},m.propertyTypes[s.hq.axisEnd]={numeric:!0},f.pushInstance(m);break;case s.I8.levelHeader:f.pushInstance({selector:null,objectName:e.objectName,properties:(o={},o[s.hq.levelHeaderBackgroundColor]=h.visualStyle.headerBackgroundColor,o[s.hq.levelTitleFontFamily]=h.visualStyle.levelTitleFont.family,o[s.hq.levelTitleFontSize]=h.visualStyle.levelTitleFont.size.pt,o[s.hq.levelTitleBold]=h.visualStyle.levelTitleFont.weight===g.en,o[s.hq.levelTitleItalic]=h.visualStyle.levelTitleFont.style===g.BF,o[s.hq.levelTitleUnderline]=h.visualStyle.levelTitleFont.textDecoration===g.f0,o[s.hq.levelTitleFontColor]=h.visualStyle.levelTitleFont.color,o[s.hq.showSubtitles]=h.showSubtitles,o)}),h.showSubtitles&&f.pushInstance({selector:null,objectName:e.objectName,properties:(l={},l[s.hq.levelSubtitleFontFamily]=h.visualStyle.levelSubtitleFont.family,l[s.hq.levelSubtitleFontSize]=h.visualStyle.levelSubtitleFont.size.pt,l[s.hq.levelSubtitleBold]=h.visualStyle.levelSubtitleFont.weight===g.en,l[s.hq.levelSubtitleItalic]=h.visualStyle.levelSubtitleFont.style===g.BF,l[s.hq.levelSubtitleUnderline]=h.visualStyle.levelSubtitleFont.textDecoration===g.f0,l[s.hq.levelSubtitleFontColor]=h.visualStyle.levelSubtitleFont.color,l)});break;case s.I8.categoryLabels:f.pushInstance({selector:null,objectName:e.objectName,properties:(d={},d[s.hq.categoryLabelFontFamily]=h.visualStyle.labelFont.family,d[s.hq.categoryLabelFontSize]=h.visualStyle.labelFont.size.pt,d[s.hq.categoryLabelBold]=h.visualStyle.labelFont.weight===g.en,d[s.hq.categoryLabelItalic]=h.visualStyle.labelFont.style===g.BF,d[s.hq.categoryLabelUnderline]=h.visualStyle.labelFont.textDecoration===g.f0,d[s.hq.categoryLabelFontColor]=h.visualStyle.labelFont.color,d)});break;case s.I8.dataLabels:f.pushInstance({selector:null,objectName:e.objectName,properties:(u={},u[s.hq.dataLabelFontFamily]=h.visualStyle.valueFont.family,u[s.hq.dataLabelFontSize]=h.visualStyle.valueFont.size.pt,u[s.hq.dataLabelBold]=h.visualStyle.valueFont.weight===g.en,u[s.hq.dataLabelItalic]=h.visualStyle.valueFont.style===g.BF,u[s.hq.dataLabelUnderline]=h.visualStyle.valueFont.textDecoration===g.f0,u[s.hq.dataLabelFontColor]=h.visualStyle.valueFont.color,u[s.hq.dataLabelDisplayUnits]=this.dataLabelDisplayUnits,u[s.hq.dataLabelPrecision]=this.dataLabelPrecision,u),validValues:(v={},v[s.hq.dataLabelPrecision]={numberRange:{min:0,max:ee.vo}},v)})}return f.complete()},n.prototype.enumerateObjectRepetition=function(){var e,t=[];if(!this.viewModel)return t;var i=this.viewModel.roleInfoMap;if(i&&i.analyze&&i.analyze.metadataColumn){var a=i.analyze.metadataColumn;if(a.isMeasure&&a.type.numeric){var r={containerName:a.displayName,selector:{data:[(0,ne.Ue)(0)],metadata:a.queryName},objects:(e={},e[s.I8.dataBars]={formattingProperties:[s.hq.dataBarColor]},e),allowOverrideSubtotalMatching:!0};t.push(r)}}return t},n.prototype.getFormattingModel=function(){var e=this;return new b.Nq(function(){return e.buildAnalysisCard()},function(){return e.buildTreeCard()},function(){return e.buildDataBarsCard()},function(){return e.buildCategoryLabelsCard()},function(){return e.buildDataLabelsCard()},function(){return e.buildTreeHeaderCard()},function(){return e.buildConditionalFormattingCard(e.host)}).build()},n.prototype.buildAnalysisCard=function(){var e=this,i=(0,b.wZ)(R.D.decompositionTree.objects),a=new b.CQ(new b.lg("analysis"),"Analysis",[i.analysis.aiEnabled,i.analysis.aiMode],function(o){return e.host.getLocalizedString(o)});return a.addGroup("analysis",function(r){r.addSimpleSlice("aiEnabled",new b.bd({descriptor:i.analysis.aiEnabled,value:e.isAIEnabled}).build()).addSimpleSlice("aiMode",new b.uY({descriptor:i.analysis.aiMode,value:e.aiMode}).build())}),a.build()},n.prototype.buildTreeCard=function(){var e=this,t=function(o){return e.host.getLocalizedString(o)},i=(0,b.wZ)(R.D.decompositionTree.objects),a=new b.CQ(new b.lg("tree"),"DecompositionTree_Formatting_Tree",[i.tree.density,i.tree.accentColor,i.tree.connectorDefaultColor,i.tree.connectorType,i.tree.defaultClickAction,i.tree.responsiveLayout,i.tree.barsPerLevel],t);return a.addGroup("tree",function(r){r.withCollapsible(!0).withDisplayName("DecompositionTree_Formatting_Tree_Settings"),r.addSimpleSlice("density",new b.uY({descriptor:i.tree.density,value:e.renderingService.layoutDensity}).build()).addSimpleSlice("defaultClickAction",new b.uY({descriptor:i.tree.defaultClickAction,value:e.defaultClickAction}).build()),e.renderingService.useLegacyLayout||(r.addSimpleSlice("responsiveLayout",new b.bd({descriptor:i.tree.responsiveLayout,value:e.renderingService.responsiveLayout}).build()),e.renderingService.responsiveLayout||r.addSimpleSlice("barsPerLevel",new b.JN({descriptor:i.tree.barsPerLevel,localize:t,options:{maxValue:{type:1,value:s.bR.maxValue},minValue:{type:0,value:s.bR.minValue}},value:e.barsPerLevel}).build()))}),a.addGroup("Connectors",function(r){r.withCollapsible(!0).withDisplayName("DecompositionTree_Formatting_Connectors"),r.addSimpleSlice("connectorType",new b.uY({descriptor:i.tree.connectorType,value:e.renderingService.connectorType}).build()).addSimpleSlice("accentColor",new b.BT({descriptor:i.tree.accentColor,value:{value:e.renderingService.visualStyle.accentColor}}).build()).addSimpleSlice("connectorDefaultColor",new b.BT({descriptor:i.tree.connectorDefaultColor,value:{value:e.renderingService.visualStyle.linkStrokeColor}}).build())}),a.build()},n.prototype.buildDataBarsCard=function(){var e=this,t=function(o){return e.host.getLocalizedString(o)},i=(0,b.wZ)(R.D.decompositionTree.objects),a=new b.CQ(new b.lg("dataBars"),"Visual_Bars_Title",[i.dataBars.positiveBarColor,i.dataBars.negativeBarColor,i.dataBars.dataBarBackgroundColor,i.dataBars.dataBarWidthPercent,i.dataBars.dataBarScalingType,i.dataBars.axisStart,i.dataBars.axisEnd],t);return a.addGroup("Options",function(r){r.withCollapsible(!0).withDisplayName("Desktop_FileMenu_Options"),r.addSimpleSlice("dataBarScalingType",new b.uY({descriptor:i.dataBars.dataBarScalingType,value:e.scalingType}).build()).addSimpleSlice("dataBarWidthPercent",new b.JN({descriptor:i.dataBars.dataBarWidthPercent,localize:t,options:{maxValue:{type:1,value:150},minValue:{type:0,value:50},unitSymbol:ie.t2},value:e.renderingService.visualStyle.dataBarWidthPercent}).build()).addSimpleSlice("axisStart",new b.mu({descriptor:(0,D.__assign)((0,D.__assign)({},i.dataBars.axisStart),{propertyTypes:{numeric:!0}}),placeholderText:t("Visual_Auto"),value:e.axisStart}).build()).addSimpleSlice("axisEnd",new b.mu({descriptor:(0,D.__assign)((0,D.__assign)({},i.dataBars.axisEnd),{propertyTypes:{numeric:!0}}),placeholderText:t("Visual_Auto"),value:e.axisEnd}).build())}),a.addGroup("Color",function(r){r.withCollapsible(!0).withDisplayName("Visual_Colors"),r.addSimpleSlice("positiveBarColor",new b.BT({descriptor:i.dataBars.positiveBarColor,value:{value:e.renderingService.visualStyle.positiveBarColor}}).build()).addSimpleSlice("negativeBarColor",new b.BT({descriptor:i.dataBars.negativeBarColor,value:{value:e.renderingService.visualStyle.negativeBarColor}}).build()).addSimpleSlice("dataBarBackgroundColor",new b.BT({descriptor:i.dataBars.dataBarBackgroundColor,value:{value:e.renderingService.visualStyle.dataBarBackgroundColor}}).build())}),a.build()},n.prototype.buildCategoryLabelsCard=function(){var e=this,i=(0,b.wZ)(R.D.decompositionTree.objects),a=new b.CQ(new b.lg("categoryLabels"),"Visual_CategoryLabels",[i.categoryLabels.categoryLabelFontColor,i.categoryLabels.categoryLabelFontSize,i.categoryLabels.categoryLabelFontFamily,i.categoryLabels.categoryLabelBold,i.categoryLabels.categoryLabelItalic,i.categoryLabels.categoryLabelUnderline],function(o){return e.host.getLocalizedString(o)});return a.addGroup("categoryLabels",function(r){r.withDisplayName("Visual_Tablix_Values").withCollapsible(!1).addCompositeSlice("font","Font",e.getCategoryLabelsFontControl(i)).addSimpleSlice("categoryLabelFontColor",new b.BT({descriptor:i.categoryLabels.categoryLabelFontColor,value:{value:e.renderingService.visualStyle.labelFont.color}}).build())}),a.build()},n.prototype.buildDataLabelsCard=function(){var e=this,t=function(o){return e.host.getLocalizedString(o)},i=(0,b.wZ)(R.D.decompositionTree.objects),a=new b.CQ(new b.lg("dataLabels"),"Visual_Tablix_Values",[i.dataLabels.dataLabelFontFamily,i.dataLabels.dataLabelFontSize,i.dataLabels.dataLabelBold,i.dataLabels.dataLabelItalic,i.dataLabels.dataLabelUnderline,i.dataLabels.dataLabelFontColor,i.dataLabels.dataLabelDisplayUnits,i.dataLabels.dataLabelPrecision],t);return a.addGroup("dataLabels",function(r){r.addCompositeSlice("font","Font",e.getDataLabelsFontControl(i)).addSimpleSlice("dataLabelFontColor",new b.BT({descriptor:i.dataLabels.dataLabelFontColor,value:{value:e.renderingService.visualStyle.valueFont.color}}).build()).addSimpleSlice("dataLabelDisplayUnits",new b.uY({descriptor:i.dataLabels.dataLabelDisplayUnits,value:e.dataLabelDisplayUnits}).build()).addSimpleSlice("dataLabelPrecision",new b.mu({descriptor:i.dataLabels.dataLabelPrecision,placeholderText:t("Visual_Auto"),value:e.dataLabelPrecision}).build())}),a.build()},n.prototype.buildTreeHeaderCard=function(){var e=this,i=(0,b.wZ)(R.D.decompositionTree.objects),a=new b.CQ(new b.lg("levelHeader"),"Header_Plural",[i.levelHeader.levelHeaderBackgroundColor,i.levelHeader.levelTitleFontFamily,i.levelHeader.levelTitleFontSize,i.levelHeader.levelTitleBold,i.levelHeader.levelTitleItalic,i.levelHeader.levelTitleUnderline,i.levelHeader.levelTitleFontColor,i.levelHeader.showSubtitles,i.levelHeader.levelSubtitleFontFamily,i.levelHeader.levelSubtitleFontSize,i.levelHeader.levelSubtitleBold,i.levelHeader.levelSubtitleItalic,i.levelHeader.levelSubtitleUnderline,i.levelHeader.levelSubtitleFontColor],function(o){return e.host.getLocalizedString(o)});return a.addGroup("title",function(r){r.withCollapsible(!0).withDisplayName("Visual_Tablix_ColumnFormatting_Title").addCompositeSlice("title_font","Font",e.getLevelHeaderFontControl(i)).addSimpleSlice("levelTitleFontColor",new b.BT({descriptor:i.levelHeader.levelTitleFontColor,value:{value:e.renderingService.visualStyle.levelTitleFont.color}}).build())}),a.addGroup("subtitles",function(r){r.addTopLevelToggle("Subtitles",function(){return new b.bd({descriptor:i.levelHeader.showSubtitles,value:e.renderingService.showSubtitles}).build()}).withCollapsible(!0).withDisplayName("Subtitles"),e.renderingService.showSubtitles&&r.addCompositeSlice("subtitle_font","Font",e.getLevelSubTitleFontControl(i)).addSimpleSlice("levelSubtitleFontColor",new b.BT({descriptor:i.levelHeader.levelSubtitleFontColor,value:{value:e.renderingService.visualStyle.levelSubtitleFont.color}}).build())}),a.addGroup("background",function(r){r.withCollapsible(!0).withDisplayName("Visual_Background").addSimpleSlice("levelHeaderBackgroundColor",new b.BT({descriptor:i.levelHeader.levelHeaderBackgroundColor,value:{value:e.renderingService.visualStyle.headerBackgroundColor}}).build())}),a.build()},n.prototype.buildConditionalFormattingCard=function(e){var i=(0,s.Sd)(),a=this.enumerateObjectRepetition();return(0,$.Z)(a,function(o){return e.getLocalizedString(o)},i.objects,"FieldWell_ConditionalFormatting","Visual_Matrix_CellElements_Description")},n.prototype.nodeClicked=function(e,t){if(this.viewModel&&this.decompositionAuthoringService&&(y.fF.assertValue(e,"Node must be defined"),!this.isDrillOrSeeRecordsEnabled(e,t))){this.renderingService.lastClickedNode=e;var i=this.clearSelection();e.level>0&&(e.level===this.viewModel.levels.length-1||e.expanded&&"select"===this.defaultClickAction)?(!i||i.key!==e.key)&&this.setSelection(e):e.level<this.viewModel.levels.length-1&&this.decompositionAuthoringService.toggleNode(e.selector)}},n.prototype.onNodeContextMenu=function(e,t){!this.viewModel||!this.viewModel.roleInfoMap||(this.renderingService.selectedNode=e,_.isEmpty(e.selector.dataMap)||this.host.onContextMenu({data:[this.getSelectorForDrill(e.selector)],position:t}))},n.prototype.getSelectorForDrill=function(e){return y.fF.assertValue(e,"Selector must be defined"),y.fF.assertValue(this.viewModel,"View model is not defined"),{dataMap:e.dataMap,metadata:[this.viewModel.roleInfoMap.analyze.metadataColumn.queryName]}},n.prototype.loadMoreClicked=function(e){var t;switch(y.fF.assertValue(e,"node is not defined"),y.fF.assertValue(this.windowExpansionState,"Missing windowExpansion"),e.restartKind){case 1:t=3;break;case 2:t=4;break;case 3:t=e.position>0?3:4;break;case 0:y.fF.assertFail("Invalid restart kind");break;default:y.fF.assertNever(e.restartKind)}var i=(0,oe.tY)(this.windowExpansionState,(0,ae.tV)(e.selector),t,e.restartValues);this.host.loadWindow(i)},n.prototype.populateAIMethodsMenuOptions=function(e,t,i,a){var r=this.stringResourceProvider.get("DecompositionTree_AnalysisMethod_HighValue"),o=this.stringResourceProvider.get("DecompositionTree_AnalysisMethod_LowValue"),l=this.stringResourceProvider.get("absolute"===this.aiMode?"DecompositionTree_AnalysisDescription_HighValue":"DecompositionTree_AnalysisDescription_RelativeHighValue"),d=this.stringResourceProvider.get("absolute"===this.aiMode?"DecompositionTree_AnalysisDescription_LowValue":"DecompositionTree_AnalysisDescription_RelativeLowValue"),u=function(f){return a&&a===f};e.items.push({type:0,key:(0,D.__assign)((0,D.__assign)({},t),{method:"MaxSplit"}),text:r,tooltip:l,showIcon:i,checked:u("MaxSplit"),icon:"glyphicon pbi-glyph-insight glyph-small"}),e.items.push({type:0,key:(0,D.__assign)((0,D.__assign)({},t),{method:"MinSplit"}),text:o,tooltip:d,showIcon:i,checked:u("MinSplit"),icon:"glyphicon pbi-glyph-insight glyph-small"})},n.prototype.showExpandContextMenu=function(e,t){if(y.fF.assertValue(e,"Node must be defined"),y.fF.assertValue(t,"Position must be defined"),this.decompositionAuthoringService){if(!this.viewModel)return void y.fF.assertFail("View model must be defined");var i=_.filter(this.viewModel.unpinnedDimensions,function(d){return d.displayName}),a={items:[]};if(!_.isEmpty(i)){this.isAIEnabled&&(this.populateAIMethodsMenuOptions(a,{action:"ExpandToAiLevel",node:e},!0),a.items.push({type:1}));for(var r=0,o=i;r<o.length;r++){var l=o[r];a.items.push({type:0,key:{action:"ExpandToNewLevel",node:e,dimension:l},text:l.displayName,tooltip:l.displayName})}this.host.dropdown().showContextMenu(a,t,this.contextMenuActions.bind(this))}}},n.prototype.showUpdateLevelContextMenu=function(e,t){if(y.fF.assertValue(e,"Element must be defined"),y.fF.assertValue(t,"Level must be defined"),this.decompositionAuthoringService&&!t.isLocked){if(!this.viewModel)return void y.fF.assertFail("View model must be defined");var i={items:[]};if(t.isAILevel)this.populateAIMethodsMenuOptions(i,{action:"UpdateAiMethod",oldLevel:t},!1,t.aiResult.method);else for(var r=0,o=_.filter(this.viewModel.unpinnedDimensions,function(u){return u.displayName});r<o.length;r++){var l=o[r];l.queryRef!==t.queryRef&&i.items.push({type:0,key:{action:"UpdateLevel",oldLevel:t,newLevel:l},text:l.displayName,tooltip:l.displayName})}if(!_.isEmpty(i.items)){var d=e.getClientRects()[0];this.host.dropdown().showContextMenu(i,{x:d.left,y:d.top+this.contextMenuYOffset},this.contextMenuActions.bind(this))}}},n.prototype.contextMenuActions=function(e){if(y.fF.assertValue(e,"action must be defined"),y.fF.assertValue(this.decompositionAuthoringService,"decomposition service must be defined"),e){switch(e.action){case"ExpandToNewLevel":this.decompositionAuthoringService.addLevelAndExpandNode(e.node.selector,e.dimension.queryRef),this.host.telemetry().trace(2,"DecompositionTreeFieldSplitClicked");break;case"ExpandToAiLevel":this.decompositionAuthoringService.addAILevelAndExpandNode(e.node.selector,e.method,!e.node.isAIHighlighted),this.host.telemetry().trace(2,"DecompositionTreeAISplitClicked");break;case"UpdateLevel":this.decompositionAuthoringService.updateLevel(e.oldLevel.queryRef,e.newLevel.queryRef),this.host.telemetry().trace(2,"DecompositionTreeUpdateLevel");break;case"UpdateAiMethod":this.decompositionAuthoringService.updateAILevel(e.oldLevel.queryRef,e.method),this.host.telemetry().trace(2,"DecompositionTreeChangeAISplitClicked");break;default:y.fF.assertFail("No action mapped")}this.clearSelection()}},n.prototype.isDrillOrSeeRecordsEnabled=function(e,t){var a={type:0,position:t,visualObjects:[{objectName:"",selectorsByColumn:this.getSelectorForDrill(e.selector)}]};return this.host.onSelecting(a),0!==a.action},n.prototype.setSelection=function(e){this.renderingService.selectedNode=e,this.host.onSelect({type:0,selectionMode:0,visualObjects:[{objectName:"",selectorsByColumn:e.selector}]}),this.renderingService.render(this.viewModel)},n.prototype.clearSelection=function(){var e=this.renderingService.selectedNode;return this.renderingService.selectedNode&&(this.renderingService.selectedNode=null,this.host.onSelect({type:0,selectionMode:0,visualObjects:[]})),this.renderingService.render(this.viewModel),e},Object.defineProperty(n.prototype,"dataBarScalingType",{set:function(t){t!==this.scalingType&&(this.scalingType=t,this.viewModel&&this.viewModelService.updateLevelsScale(this.viewModel,this.scalingType,this.axisStart,this.axisEnd))},enumerable:!1,configurable:!0}),n.prototype.getAIMode=function(e){return(0,B.NA)(e,{objectName:s.I8.analysis,propertyName:s.hq.aiMode},"absolute")},n.prototype.getConnectorType=function(e){return(0,B.NA)(e,{objectName:s.I8.tree,propertyName:s.hq.connectorType},"curve")},n.prototype.getDataBarScalingType=function(e){return(0,B.NA)(e,{objectName:s.I8.dataBars,propertyName:s.hq.dataBarScalingType},"levelMaximum")},n.prototype.getAxisStart=function(e){return(0,B.NA)(e,{objectName:s.I8.dataBars,propertyName:s.hq.axisStart},void 0)},n.prototype.getAxisEnd=function(e){return(0,B.NA)(e,{objectName:s.I8.dataBars,propertyName:s.hq.axisEnd},void 0)},n.prototype.getIsAIEnabled=function(e){return(0,B.NA)(e,{objectName:s.I8.analysis,propertyName:s.hq.aiEnabled},!0)},n.prototype.getShowSubtitles=function(e){return(0,B.NA)(e,{objectName:s.I8.levelHeader,propertyName:s.hq.showSubtitles},!0)},n.prototype.getVisualDensity=function(e){return(0,B.NA)(e,{objectName:s.I8.tree,propertyName:s.hq.density},"default")},n.prototype.getDataLabelDisplayUnits=function(e){return(0,B.NA)(e,{objectName:s.I8.dataLabels,propertyName:s.hq.dataLabelDisplayUnits},0)},n.prototype.getDataLabelPrecision=function(e){return(0,B.NA)(e,{objectName:s.I8.dataLabels,propertyName:s.hq.dataLabelPrecision},void 0)},n.prototype.getBarsPerLevel=function(e){return(0,B.NA)(e,{objectName:s.I8.tree,propertyName:s.hq.barsPerLevel},10)},n.prototype.getResponsiveLayout=function(e){return(0,B.NA)(e,{objectName:s.I8.tree,propertyName:s.hq.responsiveLayout},!0)},n.prototype.getDefaultClickAction=function(e){return(0,B.NA)(e,{objectName:s.I8.tree,propertyName:s.hq.defaultClickAction},"select")},n.prototype.getCategoryLabelsFontControl=function(e){return(new b.UN).withFontFamily({descriptor:e.categoryLabels.categoryLabelFontFamily,value:this.renderingService.visualStyle.labelFont.family}).withFontSizeProperties({descriptor:e.categoryLabels.categoryLabelFontSize,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60}},value:this.renderingService.visualStyle.labelFont.size.pt}).withBold({descriptor:e.categoryLabels.categoryLabelBold,value:this.renderingService.visualStyle.labelFont.weight===g.en}).withItalic({descriptor:e.categoryLabels.categoryLabelItalic,value:this.renderingService.visualStyle.labelFont.style===g.BF}).withUnderline({descriptor:e.categoryLabels.categoryLabelUnderline,value:this.renderingService.visualStyle.labelFont.textDecoration===g.f0}).build()},n.prototype.getLevelSubTitleFontControl=function(e){return(new b.UN).withFontFamily({descriptor:e.levelHeader.levelSubtitleFontFamily,value:this.renderingService.visualStyle.levelSubtitleFont.family}).withFontSizeProperties({descriptor:e.levelHeader.levelSubtitleFontSize,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60}},value:this.renderingService.visualStyle.levelSubtitleFont.size.pt}).withBold({descriptor:e.levelHeader.levelSubtitleBold,value:this.renderingService.visualStyle.levelSubtitleFont.weight===g.en}).withItalic({descriptor:e.levelHeader.levelSubtitleItalic,value:this.renderingService.visualStyle.levelSubtitleFont.style===g.BF}).withUnderline({descriptor:e.levelHeader.levelSubtitleUnderline,value:this.renderingService.visualStyle.levelSubtitleFont.textDecoration===g.f0}).build()},n.prototype.getDataLabelsFontControl=function(e){return(new b.UN).withFontFamily({descriptor:e.dataLabels.dataLabelFontFamily,value:this.renderingService.visualStyle.valueFont.family}).withFontSizeProperties({descriptor:e.dataLabels.dataLabelFontSize,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60}},value:this.renderingService.visualStyle.valueFont.size.pt}).withBold({descriptor:e.dataLabels.dataLabelBold,value:this.renderingService.visualStyle.valueFont.weight===g.en}).withItalic({descriptor:e.dataLabels.dataLabelItalic,value:this.renderingService.visualStyle.valueFont.style===g.BF}).withUnderline({descriptor:e.dataLabels.dataLabelUnderline,value:this.renderingService.visualStyle.valueFont.textDecoration===g.f0}).build()},n.prototype.getLevelHeaderFontControl=function(e){return(new b.UN).withFontFamily({descriptor:e.levelHeader.levelTitleFontFamily,value:this.renderingService.visualStyle.levelTitleFont.family}).withFontSizeProperties({descriptor:e.levelHeader.levelTitleFontSize,options:{minValue:{type:0,value:8},maxValue:{type:1,value:60}},value:this.renderingService.visualStyle.levelTitleFont.size.pt}).withBold({descriptor:e.levelHeader.levelTitleBold,value:this.renderingService.visualStyle.levelTitleFont.weight===g.en}).withItalic({descriptor:e.levelHeader.levelTitleItalic,value:this.renderingService.visualStyle.levelTitleFont.style===g.BF}).withUnderline({descriptor:e.levelHeader.levelTitleUnderline,value:this.renderingService.visualStyle.levelTitleFont.textDecoration===g.f0}).build()},n}()}}]);