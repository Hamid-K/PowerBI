"use strict";(self.webpackChunkdesktopDaxQueryView=self.webpackChunkdesktopDaxQueryView||[]).push([["azureMap"],{88332:function(Mt,Ae,B){B.r(Ae),B.d(Ae,{AzureMap:function(){return Ca},createAzureMap:function(){return Cr},createAzureMapBehavior:function(){return br}});var y=B(81337),l=B(60637),X=B(5962),ht=B(28579),A=B(51660),m=B(86900),S=B(70569),L=B(86727),z=B(77686),O=B(72902),R=B(45296),V=B(64067),k=B(38308),x=B(79154),I=B(62458),q=B(15621),K=B(12913),v=B(56578),ne=B(46135),j=B(66232),ee=B(30237),Ie=B(38400),he=B(59107),G=22,Zt="backgroundDark",Lt=4e6,Ue=-180,ft=Math.pow(2,53)-1,xe="bubbleDataSource",$e="heatMapDataSource",Ke="filledMapDataSource",je="barChart3DDataSource",Dt="referenceDataSource",et="bubbleLayer",ta="heatMapLayer",aa="barChart3DLayer",ra="unselectedBarChart3DLayer",ia="filledMapFillLayer",oa="filledMapOutlineLayer",_a=function(){function s(e,t,a,r){this.epsilon=1e-5,this.cx1=0,this.cx2=0,this.cx3=0,this.cy1=0,this.cy2=0,this.cy3=0,this.computeCoefficient(e,t,a,r)}return s.prototype.computeCoefficient=function(e,t,a,r){this.cx3=1+3*e-3*a,this.cx2=3*a-6*e,this.cx1=3*e,this.cy3=1+3*t-3*r,this.cy2=3*r-6*t,this.cy1=3*t},s.prototype.getXByT=function(e){return this.cx3*Math.pow(e,3)+this.cx2*Math.pow(e,2)+this.cx1*e},s.prototype.getYByT=function(e){return this.cy3*Math.pow(e,3)+this.cy2*Math.pow(e,2)+this.cy1*e},s.prototype.estimateTByX=function(e,t){void 0===t&&(t=.01);for(var a=0,r=1,i=e;a<r;){var o=this.getXByT(i);if(Math.abs(e-o)<=t)return i;o<e?a=i:r=i,i=.5*(a+r)}return e},s.prototype.scale=function(e){if(e<this.epsilon)return 0;if(1-e<this.epsilon)return 1;var t=this.estimateTByX(e);return this.getYByT(t)},s}(),Va=B(1521),na=function(s){return s.bubble="showBubble",s.pie="showPie",s.barChart3D="showBarChart3D",s.filledMap="showFilledMap",s.heatMap="showHeatMap",s}({}),sa=512/40075e3,Za=sa*Math.pow(2,24),J=function(){function s(){}var e;return s.getBubbleDisplayOptions=function(t,a,r,i,o,n){var u=r?s.LEGACY_getRadiusExpression(t,a,i,o,n):s.getRadiusExpression(t.radius,i,o,n),c=["get","color"],h=s.getStrokeColor(t.autoStrokeColor,t.strokeColor,c),p=["case",s.getSelectionFilter(!0),(0,V.TD)(t.transparency),(0,V.TD)(a.unselectedTransparency)],f=t.strokeWidth<2?["case",["boolean",["feature-state","focused"],!1],2,t.strokeWidth]:t.strokeWidth,g=["case",["boolean",["feature-state","focused"],!1],1,s.getSelectionFilter(!0),(0,V.TD)(t.strokeTransparency),(0,V.TD)(a.unselectedTransparency)],b=r?s.LEGACY_getBubbleFilter(!0,i?a:void 0):s.bubbleLayerFilter;return{bubbleOptions:{radius:u,strokeColor:h,strokeWidth:f,strokeOpacity:g,blur:t.blur/100,pitchAlignment:t.pitchAlignment,minZoom:t.minZoom,maxZoom:t.maxZoom,color:c,filter:b,opacity:p,visible:!0}}},s.getBubbleClusterDisplayOptions=function(t,a){var i=a.clusteredBubbleStrokeWidth<2?["case",["boolean",["feature-state","focused"],!1],2,a.clusteredBubbleStrokeWidth]:a.clusteredBubbleStrokeWidth;return{clusterBubbleOptions:(0,y.__assign)((0,y.__assign)({},t),{radius:a.clusteredBubbleRadius,color:a.clusteredBubbleFillColor,strokeColor:a.clusteredBubbleStrokeColor,strokeWidth:i,filter:s.clusteredDataFilter}),clusterSymbolOptions:{visible:!0,textOptions:{color:a.clusteredBubbleFontColor,size:a.clusteredBubbleFontSize}}}},s.getPieChartDisplayOptions=function(t){return{pieChartOptions:{minZoom:t.minZoom,maxZoom:t.maxZoom,iconOptions:{pitchAlignment:"viewport",anchor:"center"},visible:!0}}},s.getHeatMapDisplayOptions=function(t,a){var r=["interpolate",["linear"],["heatmap-density"],0,(0,Va.cD)(t.heatMapColorLow,0),.1,t.heatMapColorLow,.5,t.heatMapColorCenter,1,t.heatMapColorHigh],i="pixels"===t.heatMapRadiusUnit?t.heatMapRadius:["interpolate",["exponential",2],["zoom"],0,["*",t.heatMapRadius,sa],24,["*",t.heatMapRadius,Za]],o=a&&t.heatMapUseSize?["get","size"]:1;return{heatMapOptions:{color:r,intensity:t.heatMapIntensity,opacity:(0,V.TD)(t.heatMapTransparency),radius:i,weight:o,minZoom:t.minZoom,maxZoom:t.maxZoom,visible:!0}}},s.getBarChartDisplayOptions=function(t,a,r,i,o){var u=t.height/r,c=["get","size"],h=["*",c,100*u];t.scaleHeightOnZoom&&(h=["interpolate",["exponential",.5],["zoom"],0,["*",c,2e6*u],22,["*",c,20*u]]);var d={minZoom:t.minZoom,maxZoom:t.maxZoom,fillColor:["get","color"],visible:!0};return{selectedOptions:(0,y.__assign)((0,y.__assign)({},d),{height:h,fillOpacity:(0,V.TD)(t.transparency),filter:i?s.LEGACY_getBarChart3DFilter(!0,o?a:void 0):s.getSelectionFilter(!0)}),unselectedOptions:(0,y.__assign)((0,y.__assign)({},d),{height:0,fillOpacity:(0,V.TD)(a.unselectedTransparency),filter:i?s.LEGACY_getBarChart3DFilter(!1,o?a:void 0):s.getSelectionFilter(!1)})}},s.getFilledMapDisplayOptions=function(t,a,r,i){var n=["case",s.getSelectionFilter(!0),(0,V.TD)(t.transparency),(0,V.TD)(a.unselectedTransparency)],u=["case",s.getSelectionFilter(!0),(0,V.TD)(t.strokeTransparency),(0,V.TD)(a.unselectedTransparency)],c=r?s.LEGACY_getFilledMapFilter(!0,i?a:void 0):void 0;return{polygonOptions:{minZoom:t.minZoom,maxZoom:t.maxZoom,fillColor:["get","color"],fillOpacity:n,filter:c,visible:!0},lineOptions:{minZoom:t.minZoom,maxZoom:t.maxZoom,strokeColor:t.strokeColor,strokeOpacity:u,strokeWidth:t.strokeWidth,filter:c,visible:!0}}},s.getSelectionFilter=function(t){return t?["get","selected"]:["!",["get","selected"]]},s.LEGACY_getBubbleFilter=function(t,a){var r=this.LEGACY_getLayerFilter(t,a)||["all"];return r.push(["==",["get","showBubble"],!0]),r.push(["!",this.clusteredDataFilter]),r},s.LEGACY_getBarChart3DFilter=function(t,a){return this.LEGACY_getLayerFilter(t,a,!0)},s.LEGACY_getFilledMapFilter=function(t,a){return this.LEGACY_getLayerFilter(t,a)},s.LEGACY_getLayerFilter=function(t,a,r){void 0===r&&(r=!1);var i=[];if(r&&i.push(this.getSelectionFilter(t)),_.isEmpty(a)||(a.showZeros||i.push(["!=",["get","size"],0]),a.showNegatives||i.push(["!",["<",["get","size"],0]])),0!==i.length)return 1===i.length?i[0]:(0,y.__spreadArray)(["all"],i,!0)},s.getRadiusExpression=function(t,a,r,i){return a&&r!==i?["get","size"]:t},s.LEGACY_getRadiusExpression=function(t,a,r,i,o){var c,n=r?t.minRadius:t.radius,u=t.zoomScaleFactor;if(r){var p=t.radiusScalingMethod,b=["linear"];if(1===p?b=["exponential",t.logScale]:2===p&&(b=["cubic-bezier",t.x1,t.y1,t.x2,t.y2]),i===o)c=["interpolate",b,["zoom"],12,n,20,n*u];else{var T=["get","size"];a.showNegatives&&(T=["abs",T]),c=["interpolate",b,T,i,n,o,t.maxRadius],1!==u&&(c=["let","radiusSize",c,["interpolate",["linear"],["zoom"],12,["var","radiusSize"],20,["*",u,["var","radiusSize"]]]])}}else c=1!==u?["interpolate",["linear"],["zoom"],12,n,20,n*u]:n;return c},s.LEGACY_evaluateRadiusExpression=function(t,a,r){if("number"==typeof t)return t;if(Array.isArray(t))if("interpolate"===t[0]){var i=t[1],n=t[3],u=t[4],c=t[5],h=t[6],p=_.isEqual(t[2],["zoom"]);p&&(!_.isFinite(a)||a<0)&&(a=1);var g=(_.clamp(p?a:r,n,c)-n)/(c-n);if("linear"===i[0])return g*(h-u)+u;if("exponential"===i[0]){var b=i[1];return(1===b?g:(Math.pow(b,g)-1)/(b-1))*(h-u)+u}if("cubic-bezier"===i[0])return new _a(i[1],i[2],i[3],i[4]).scale(g)*(h-u)+u}else if("let"===t[0]&&"radiusSize"===t[1]){var P=this.LEGACY_evaluateRadiusExpression(t[2],a,r),E=_.cloneDeep(t[3]);return E[4]=P,E[6]=P*E[6][1],this.LEGACY_evaluateRadiusExpression(E,a,r)}return 0},s.LEGACY_appendPieRadiusToDataPoints=function(t,a){var r=s.LEGACY_getRadiusExpression(a.properties.bubble,a.properties.commonDataOptions,a.hasSize,a.minDataValue,a.maxDataValue);t.forEach(function(i){var o=i.subDataPoints.reduce(function(u,c){return u+c.size},0),n=s.LEGACY_evaluateRadiusExpression(r,void 0,o);i.bubbleRadius=n})},e=s,s.getStrokeColor=function(t,a,r){var i=a;if(t){var o=["var","fillColor"];i=["let","fillColor",["to-rgba",["to-color",r]],["case",[">",["sqrt",["+",["*",.299,["^",["at",0,o],2]],["*",.587,["^",["at",1,o],2]],["*",.114,["^",["at",2,o],2]]]],127],["to-color",["rgb",["*",.5,["at",0,o]],["*",.5,["at",1,o]],["*",.5,["at",2,o]]]],["to-color",["rgb",["max",127,["min",255,["*",1.5,["at",0,o]]]],["max",127,["min",255,["*",1.5,["at",1,o]]]],["max",127,["min",255,["*",1.5,["at",2,o]]]]]]]]}return i},s.clusteredDataFilter=["has","point_count"],s.bubbleLayerFilter=["all",["==",["get",na.bubble],!0],["!",e.clusteredDataFilter]],s.pieLayerFilter=["all",["==",["get",na.pie],!0],["!",e.clusteredDataFilter]],s}(),Ga=B(92379),la=function(){function s(){}return s.createMultiPolygonCoordinatesFromPaths=function(e,t){var a=[];if(e.filter(function(c){return c.geographic}).forEach(function(c){var p,h=[];c.geographic.forEach(function(f,g){g%2==0?p=f:h.push([f,p])}),a.push(h)}),0===a.length)return[];for(var r=[[a[0]]],i=1;i<a.length;i++){var o=r[r.length-1],n=a[i];this.isPointInsidePolygon(n[0],o[0])?o.push(n):r.push([n])}return this.combineMultiPolygonCoordinatesAtAntimeridian(t,r)},s.combineMultiPolygonCoordinatesAtAntimeridian=function(e,t){return this.shouldCheckAntimeridianCrossing(e)?this.checkAndMergePolygonsAtAntimeridian(t):t},s.shouldCheckAntimeridianCrossing=function(e){var t=new atlas.data.BoundingBox([19.8,41.2,-169.6,81.45]);return e.longitude>175||e.longitude<-175||!!atlas.data.BoundingBox.containsPosition(t,[e.longitude,e.latitude])},s.checkAndMergePolygonsAtAntimeridian=function(e){for(var t=e.map(function(w){return atlas.data.BoundingBox.fromPositions(w[0])}),a=[],r=[],i=[],o=0;o<t.length;o++){var n=atlas.data.BoundingBox.getEast(t[o]),u=atlas.data.BoundingBox.getWest(t[o]),c=_.cloneDeep(e[o]),h=t[o];180===n||-180===n?(a.push({polygon:c,boundingBox:h}),i.push(a.length-1)):180===u||-180===u?r.push({polygon:c,boundingBox:h}):a.push({polygon:c,boundingBox:h})}for(var p=0,d=i;p<d.length;p++)for(var g=a[d[p]],b=0;b<r.length;b++)if(this.matchAndMerge(g.polygon,r[b].polygon)){r.splice(b,1);break}return a.map(function(w){return w.polygon})},s.matchAndMerge=function(e,t){for(var a=this,r=(0,y.__spreadArray)([],e[0],!0),i=(0,y.__spreadArray)([],t[0],!0),n=0;Math.abs(r[0][0]-180)<this.floatPrecision&&n<3;)r.push(r.shift()),n+=1;for(n=0;Math.abs(i[0][0]+180)<this.floatPrecision&&n<3;)i.push(i.shift()),n+=1;var u=_.findIndex(r,function(P){return Math.abs(P[0]-180)<a.floatPrecision}),c=_.findLastIndex(r,function(P){return Math.abs(P[0]-180)<a.floatPrecision}),h=_.findIndex(i,function(P){return Math.abs(P[0]+180)<a.floatPrecision}),p=_.findLastIndex(i,function(P){return Math.abs(P[0]+180)<a.floatPrecision});if(-1===u||c===u||-1===h||p===h)return!1;var d=r[u][1],f=r[c][1],g=i[h][1],b=i[p][1],M=Math.max(f,g)-Math.min(d,b),w=Math.min(f,g)-Math.max(d,b);if(M>0&&w/M>.9){var D=r.slice(0,u+1),N=r.slice(c);i.forEach(function(P){return P[0]+=360});var W=i.slice(0,h+1),T=i.slice(p);return e[0]=D.concat(T,W,N),e.push.apply(e,t.slice(1)),!0}return!1},s.isPointInsidePolygon=function(e,t){for(var a=0,r=0,i=t.length-1;r<t.length;i=r++)this.isRayCrossEdgeUpward(e,t[r],t[i])&&a++;return a%2==1},s.isRayCrossEdgeUpward=function(e,t,a){var r=e[0],i=e[1],o=t[0],n=t[1],u=a[0],c=a[1];return Math.abs(u-o)>180&&(r>0?(o<0&&(o+=360),u<0&&(u+=360)):(o>0&&(o-=360),u>0&&(u-=360))),o>r!=u>r&&i<(c-n)*(r-o)/(u-o)+n},s.shapesWithinPolygon=function(e,t){var a=[];if(e&&t){var o,r={},i=[],n=e instanceof atlas.source.DataSource?e.getShapes():e;_.forEach(n,function(c){o=c.getId(),r[o]=c,i.push({id:o,coordinates:c.getProperties().coordinates})}),a=s.pointsWithinPolygon(i,t).map(function(c){return r[c.id]})}return a},s.pointsWithinPolygon=function(e,t){if(e&&t){var a=s.getPolygon(t),r=s.getPowerBIShapePolygon(a);return e.filter(function(o){return r.inside(s.getPowerBIShapePoint(o.coordinates))})}return[]},s.getPowerBIShapePoint=function(e){return{x:e[0],y:e[1]}},s.getPowerBIShapePolygon=function(e){var a=[].concat.apply([],e.coordinates).map(function(r){return{x:atlas.math.normalizeLongitude(r[0]),y:atlas.math.normalizeLatitude(r[1])}});return Ga.m.fromPolygonPoints(a)},s.getPolygon=function(e){var t;if(e instanceof atlas.Shape)e.isCircle()?t=new atlas.data.Polygon([e.getCircleCoordinates()]):e.getType().indexOf("Polygon")>-1&&(t=e.toJson().geometry);else{var a=e;"Feature"===a.type&&("Point"===a.geometry.type&&"Circle"===a.properties.subType&&"number"==typeof a.properties.radius?t=new atlas.data.Polygon(atlas.math.getRegularPolygonPath(a.geometry.coordinates,a.properties.radius,72,"meters")):a.geometry.type.indexOf("Polygon")>-1&&(t=a.geometry)),-1!==a.type.indexOf("Polygon")&&(t=e)}return t},s.floatPrecision=1e-4,s}(),Ya=B(65363),Ka=function(e,t,a,r,i,o,n,u,c){var h=e,p=Math.PI,d="";u&&(d=' mask="url(#'.concat(u,'"'));var f=void 0!==e.selectionPieIndexes&&void 0===e.selectionPieIndexes.filter(function(P){return P===c})[0]?e.deselectedPieOpacity:1,g=e.gaussianBlurStandardDeviation?'filter="url(#f1)"':"";if(o>2*p*.99)return'<circle r="'.concat(r,'" cx="').concat(t,'" cy="').concat(a,'" ').concat(g,' style="opacity:').concat(f,";stroke-opacity:").concat(h.strokeOpacity,";fill:").concat(n,";stroke:").concat(h.strokeColor,";stroke-width:").concat(h.strokeWidth,'px;"').concat(d,"></circle>");var b=Math.sin,M=Math.cos,w=t+r*b(i),D=a-r*M(i),N=t+r*b(i+o),W=a-r*M(i+o),T=0;return o>p&&(T=1),'<path d="M'.concat(t," ").concat(a," L ").concat(w," ").concat(D," A ").concat(r,",").concat(r," 0 ").concat(T," 1 ").concat(N," ").concat(W,'z" ').concat(g,' style="opacity:').concat(f,";stroke-opacity:").concat(h.strokeOpacity,";fill:").concat(n,";stroke:").concat(h.strokeColor,";stroke-width:").concat(h.strokeWidth,'px;"').concat(d,"></path>")},ua=function(e,t,a){return function(e){var c,t=e.values,a=e.radius,r=0,i=0,o=a+e.strokeWidth,n=['<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(2*o,'px" height="').concat(2*o,'px" opacity="').concat(void 0!==e.opacity||null!==e.opacity?e.opacity:1,'">')],u='<filter id="f1" x="0" y="0"><feGaussianBlur in="SourceGraphic" stdDeviation="'.concat(e.gaussianBlurStandardDeviation,'" /></filter>');n.push("\n        <defs>".concat(e.gaussianBlurStandardDeviation?u:"","</defs>\n    ")),e.innerRadius>0&&e.innerRadius<=e.radius&&(c="piechart-innercircle-"+Math.round(1e7*Math.random()),n.push('<defs><mask id="'.concat(c,'"><rect width="100%" height="100%" fill="white"/><circle r="').concat(e.innerRadius,'" cx="').concat(o,'" cy="').concat(o,'" fill="black"/></mask></defs>\n            <circle r="').concat(e.innerRadius,'" cx="').concat(o,'" cy="').concat(o,'" style="fill:').concat(e.fillColor,";stroke:").concat(e.strokeColor,";stroke-width:").concat(2*e.strokeWidth,'px;"/>')));var h=t.reduce(function(w,D){return w+D.count},0);if(h>0)for(var p=2*Math.PI/h,d=0;d<t.length;d++)n.push(Ka(e,o,o,a,r,i=p*t[d].count,t[d].fill,c,d)),r+=i;var g=e.text;return g&&n.push('<text x="'.concat(o,'" y="').concat(o+7,'" style="font-size:').concat(16,'px;font-family:arial;fill:#000;font-weight:bold;" class="').concat(e.textClassName||"",'" text-anchor="middle">').concat(g,"</text>")),n.push("</svg>"),n.join("")}(ca(e,t,a))},ca=function(e,t,a){return{values:e.subDataPoints.map(function(r){return{count:Math.max(r.size,0),fill:r.color}}),radius:e.bubbleRadius,pixelOffset:[0,0],innerRadius:0,colors:[],fillColor:"transparent",gaussianBlurStandardDeviation:t.blur,strokeWidth:t.strokeWidth,strokeColor:t.strokeColor,strokeOpacity:1-t.strokeTransparency/100,textClassName:void 0,opacity:1-t.transparency/100,selectionPieIndexes:a||e.subDataPoints.map(function(r,i){return i}),deselectedPieOpacity:.1}},Qa=function s(e,t){return t?s(t,e%t):e},wt=function(){function s(e){this.cache={},this.imageSprite=e}return s.prototype.clearAll=function(){this.imageSprite.clear(),this.cache={}},s.hash=function(e,t,a){return function(e){var t=e.values.map(function(o){return o.count}),a=function(e,t){for(var a=e[0],r=1;r<t;r++)if(1===(a=Qa(e[r],a)))return 1;return a}(t,t.length);return function(e){var a,i,t=0;if(0===e.length)return t;var o=e.toLowerCase();for(a=0,i=o.length;a<i;a++)t=(t<<5)-t+o.charCodeAt(a),t|=0;return t}(Object.keys(e).filter(function(o){return"values"!==o&&(void 0!==e[o]||null!==e[o])}).map(function(o){return{key:o,value:e[o]}}).concat([{key:"values",value:e.values.map(function(o){return["fill=".concat(o.fill),"count=".concat(o.count/a)].join(",")}).join(";")}]).map(function(o){var n=o.key,u=o.value,c=u instanceof Array?u.join(","):"".concat(u);return"".concat(n,"=").concat(c)}).join(";"))}(ca(e,t,a))},s.prototype.svgContent=function(e,t,a,r){void 0===a&&(a=!1);var i=a?(0,y.__assign)((0,y.__assign)({},t),{transparency:100}):t,o=s.hash(e,i,r),n=this.cache[o];if(void 0!==n)return n.svgContent;var u=ua(e,i,r);return this.cache[o]={svgContent:u},u},s.prototype.objectUrl=function(e,t,a){var r=s.hash(e,t,a),i=this.cache[r];if(void 0!==i&&i.objectUrl)return i.objectUrl;if(void 0!==i){var o=new Blob([i.svgContent],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(o);return i.objectUrl=n,this.cache[r].objectUrl=n,n}var u=ua(e,t,a),c=(o=new Blob([u],{type:"image/svg+xml;charset=utf-8"}),URL.createObjectURL(o));return this.cache[r]={objectUrl:c,svgContent:u},c},s.prototype.loadIcon=function(e,t,a,r){var i=r??s.hash(e,t,a);if(this.cache[i]&&this.cache[i].objectUrl||this.imageSprite.hasImage(i.toString()))return(0,Ya.DR)(void 0);var o=this.objectUrl(e,t,a);return this.imageSprite.add(i.toString(),o)},s}(),yt=.0174532925,Se=function(){function s(){}return s.getPointFeatures=function(e,t,a,r,i,o){var n=this,u=a&&r;return e.filter(function(c){return c.location&&c.subDataPoints&&c.subDataPoints.length>0}).map(function(c){return new atlas.data.Feature(new atlas.data.Point(new atlas.data.Position(c.location.longitude,c.location.latitude)),(0,y.__assign)((0,y.__assign)({coordinates:[c.location.longitude,c.location.latitude],size:o?c.subDataPoints[0].size||0:c.bubbleRadius||0,color:c.subDataPoints[0].color,identityKeys:c.subDataPoints.map(function(h){return h.identity.getKey()}),selected:!t||c.subDataPoints[0].selected},(a||r)&&{showBubble:n.bubbleVisibility(c,u,a),showPie:n.pieVisibility(c,u,r)}),{iconId:r?wt.hash(c,i):void 0,seriesIndex:c.subDataPoints[0].seriesIndex}))})},s.bubbleVisibility=function(e,t,a){return!!(!t&&a||t&&1===e.subDataPoints.length)},s.pieVisibility=function(e,t,a){return!!(!t&&a||t&&e.subDataPoints.length>1)},s.getReferenceLayerFeature=function(e,t){if(!e)return[];var a=e.getShapes(),r=[];return a.forEach(function(i){var o=e.getDataPointFromShape(i);r.push(o?new atlas.data.Feature(i.geometry,(0,y.__assign)({coordinates:o.location?[o.location.longitude,o.location.latitude]:[],identityKeys:o.subDataPoints.map(function(n){var u;return null===(u=n.identity)||void 0===u?void 0:u.getKey()}),selected:!t||o.subDataPoints[0].selected},i.properties)):new atlas.data.Feature(i.geometry,(0,y.__assign)({identityKeys:[]},i.properties)))}),r},s.getPolygonFeature=function(e,t,a,r){var i=this;return e.filter(function(o){return o.location}).map(function(o){return new atlas.data.Feature(1===a?i.getCirclePolygon(o,t):i.getSquarePolygon(o,t),{coordinates:[o.location.longitude,o.location.latitude],size:o.subDataPoints[0].size||0,color:o.subDataPoints[0].color,identityKeys:o.subDataPoints.map(function(n){return n.identity.getKey()}),selected:!r||o.subDataPoints[0].selected})})},s.getFilledMapMultiPolygonFeature=function(e,t){return e.filter(function(a){return a.geojsonPolygons}).map(function(a){return new atlas.data.Feature(new atlas.data.MultiPolygon(la.combineMultiPolygonCoordinatesAtAntimeridian(a.location,a.geojsonPolygons.map(function(r){return r.coordinates}))),{coordinates:[a.location.longitude,a.location.latitude],size:a.subDataPoints[0].size||0,color:a.subDataPoints[0].color,identityKeys:a.subDataPoints.map(function(r){return r.identity.getKey()}),selected:!t||a.subDataPoints[0].selected})})},s.getCirclePolygon=function(e,t){for(var a=1e-4*t,r=Math.cos(e.location.latitude*yt),o=[],n=0;n<18;n++)o.push([e.location.longitude+a*Math.cos(20*n*yt),e.location.latitude+a*r*Math.sin(20*n*yt)]);return o.push([e.location.longitude+a,e.location.latitude]),new atlas.data.Polygon([o])},s.getSquarePolygon=function(e,t){var a=1e-4*t,r=a*Math.cos(e.location.latitude*yt);return new atlas.data.Polygon([[[e.location.longitude+a,e.location.latitude+r],[e.location.longitude-a,e.location.latitude+r],[e.location.longitude-a,e.location.latitude-r],[e.location.longitude+a,e.location.latitude-r],[e.location.longitude+a,e.location.latitude+r]]])},s.getIdentityKeys=function(e){return e.getProperties().identityKeys},s.getFirstIdentityKey=function(e){return this.getIdentityKeys(e)[0]},s.findFirstDataPointByKey=function(e,t){return e.find(function(a){return t===a.identity.getKey()})},s.findDataPointsByKeys=function(e,t){var a=[];if(t.length===e.length)return e;for(var r=0,i=e;r<i.length;r++){var o=i[r],n=o.identity.getKey();if(t.indexOf(n)>=0&&(a.push(o),a.length===t.length))break}return a},s.findDataPointsByShapes=function(e,t){for(var a=[],r=0,i=t;r<i.length;r++)a.push.apply(a,this.getIdentityKeys(i[r]));return this.findDataPointsByKeys(e,a)},s}(),Pt=B(32379),tr={dataMap:{allData:[(0,B(96915).Ue)(1)]}},Je=function(){function s(){}return s.getSubSelectableRegionFromLayerId=function(e){return e===et?"bubbles":"map"},s.createAzureMapSubSelection=function(e,t,a,r,i){var o="",n={};return"bubbles"===e.split("-")[0]&&(i?(o=a.getLocalizedString("MiniToolbar_Bubbles",i.value),n=i.identity.getSelectorsByColumn()):(o=a.getLocalizedString("Visual_Bubbles"),n=tr)),{visualObjects:[{objectName:e,selectorsByColumn:n}],showUI:t,displayName:o,subSelectionType:3,selectionOrigin:r}},s.getAllSubSelectables=function(e,t,a,r){var i=a.getAllSubSelectables(r);return e?.properties.bubble&&e.properties.bubble.showBubbleLayer&&e.hasSeries&&!_.isEmpty(e.series)&&i.push.apply(i,e.series.map(function(o,n){return s.createAzureMapSubSelection("".concat("bubbles","-series-").concat(n),!1,t,void 0,o)})),i},s.getNextSubSelectable=function(e,t,a,r,i){var o=s.getAllSubSelectables(e,t,a);if(o.length){var n;if(!r)return i?_.last(o):_.first(o);var u=_.findIndex(o,function(h){return _.isEqual(r,h)});if(u>-1){var c=i?u-1:u+1;c>-1&&c<o.length&&(n=o[c])}return n}},s.getBubblesSubSelectionStyles=function(e,t){return void 0===t&&(t={}),{type:3,fill:{reference:(0,y.__assign)((0,y.__assign)({},l.MC.dataPoint.fill),{selector:(0,Pt.fd)((0,Pt.tV)(t))}),label:e.getLocalizedString("Visual_Fill")},stroke:{reference:l.MC.bubbleLayer.strokeColor,label:e.getLocalizedString("Visual_Border")}}},s.getBubblesSubSelectionShortcuts=function(e){return[{type:0,relatedResetFormattingIds:[l.MC.dataPoint.fill,l.MC.bubbleLayer.strokeColor,l.MC.bubbleLayer.layerPosition]},(0,y.__assign)((0,y.__assign)({type:3},l.MC.bubbleLayer.layerPosition),{label:e.getLocalizedString("Visual_AzureMapsLayerPosition")}),{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat(et),groupUid:"".concat(et,"-size")},label:e.getLocalizedString("Format_Bubbles")}]},s}();function at(s){var e;return s&&!0===(null===(e=s.properties)||void 0===e?void 0:e.cluster)}function xt(s){return s&&void 0!==s.getProperties}var ar=function(){function s(){var e=this;this.hasSelection=!1,this.visualHasSelection=function(){return e.hasSelection},this.featureMouseover=function(t){var a;if(e.formatMode){e.mapControl.getCanvasContainer().style.cursor="pointer";var r=e.findSubDataPointByMouseEvent(t);if(r){var i=e.createVisualSubSelection(t,r,!0),o=null===(a=_.first(i.visualObjects))||void 0===a?void 0:a.objectName,n=e.subSelectionHelper.getRegionOutline(o);(!n||0===n.visibility)&&(e.subSelectionHelper.updateCustomOutlinesFromSubSelections([i],1),e.subSelectionHelper.renderOutlines())}}},this.featureMousemove=function(t,a){if(!e.formatMode){var r=e.findSubDataPointByMouseEvent(t);if(r){e.mapControl.getCanvasContainer().style.cursor="pointer";var i=t.originalEvent;r?.tooltipInfo&&a([i.x,i.y],r)}}},this.featureMouseout=function(t,a){if(e.mapControl.getCanvasContainer().style.cursor="grab",e.formatMode){var r=t.originalEvent;(0,j.n)(r),r.preventDefault(),e.subSelectionHelper.clearHoveredOutline()}else a()},this.mapClicked=function(t){he.M.isCtrlOrMeta(t.originalEvent)||e.selectionHandler.handleClearSelection()},this.featureClicked=function(t){if(t){var a=_.filter(t.shapes,xt),r=Se.findDataPointsByShapes(e.selectableDataPoints,a);if(e.formatMode){var i=t.originalEvent;(0,j.n)(i),i.preventDefault();var o=_.last(r);if(o){var n=Se.findFirstDataPointByKey(e.selectableDataPoints,o.identity.getKey()),u=e.createVisualSubSelection(t,n,!1);e.subSelectionHelper.subSelect(u)}}else e.handleSelection(t.originalEvent,r)}},this.featureContextClicked=function(t){if(t){var a=t.originalEvent;if(!he.M.isCtrlOrMeta(a)){var r=_.find(t.shapes,xt);if(r){var i=Se.getFirstIdentityKey(r),o=Se.findFirstDataPointByKey(e.selectableDataPoints,i);if((0,j.n)(a),a.preventDefault(),e.formatMode){if(o){for(var n=void 0,u=o.identity.getKey(),c=0,h=e.data.dataPoints;c<h.length&&!(n=Se.findFirstDataPointByKey(h[c].subDataPoints,u));c++);var d=e.createVisualSubSelection(t,n,!0);e.subSelectionHelper.subSelect(d)}}else o&&e.selectionHandler.handleContextMenu(o,{x:a.clientX,y:a.clientY})}}}},this.handleContextMenu=function(t,a){!t||he.M.isCtrlOrMeta(t)||((0,j.n)(t),t.preventDefault(),e.formatMode)||e.selectionHandler.handleContextMenu(a,{x:t.clientX,y:t.clientY})},this.createFocusInCallback=function(t,a,r,i,o){return function(n){he.M.isCtrlOrMeta(n)&&72===n.keyCode&&(o()?i():r(t,a),n.preventDefault())}},this.featureFocusIn=function(t,a,r,i){var o;if(!e.formatMode&&t.shape&&(e.setFeatureFocusedState(t,!0),(o=at(t.shape)?e.findSubDataPointByClusterFeature(t.shape):e.findSubDataPointByShape(t.shape))&&o.tooltipInfo)){var n=e.mapControl.getCanvasContainer().getBoundingClientRect(),h=t.pixel;e.focusInCallback=e.createFocusInCallback([h[0]+n.x,h[1]+n.y],o,a,r,i),t.target.addEventListener("keydown",e.focusInCallback),t.target.setAttribute("aria-label",at(t.shape)?o.tooltipInfo[0].header:(0,Ie.X)(o.tooltipInfo))}},this.featureFocusOut=function(t,a){e.formatMode||(e.setFeatureFocusedState(t,!1),t.target.removeEventListener("keydown",e.focusInCallback),a())},this.setFeatureFocusedState=function(t,a){var r=t.shape,i=at(r)?r.id.toString():r.getId().toString();e.mapControl.sources.setFeatureState(i,xe,{focused:a})},this.createVisualSubSelection=function(t,a,r){var i=t.originalEvent,o=_.find(t.shapes,function(f){return f&&f.getProperties});I.fF.assertValue(o,"azureMap ".concat(t.type,": expected to find the shape"));var d,n=Je.getSubSelectableRegionFromLayerId(t.layerId),u=o.getProperties().seriesIndex,h="".concat(n)+(void 0===u?"":"-series-".concat(u)),p={x:i.clientX,y:i.clientY};return e.data.hasSeries&&a&&!_.isUndefined(a.seriesIndex)&&(d=e.data.series[a.seriesIndex]),Je.createAzureMapSubSelection(h,r,e.hostServices,p,d)},this.dataSelected=function(t){if(!e.formatMode){var a=Se.findDataPointsByShapes(e.selectableDataPoints,t);e.handleSelection(void 0,a,1)}},this.handleSelection=function(t,a,r){void 0!==r?(0,ee.tn)(a,r,e.selectionHandler):(0,ee.ct)(t,a,e.selectionHandler)},this.clusterClicked=function(t,a){var r=_.find(t.shapes,at);r&&a.getClusterExpansionZoom(r.properties.cluster_id).then(function(i){e.mapControl.setCamera({center:r.geometry.coordinates,zoom:i,type:"ease",duration:200})}).catch(function(i){})},this.updateDataSourceWithSelection=function(){return(0,y.__awaiter)(e,void 0,void 0,function(){var t,a,r,i,o,n,u,c,h,p,f=this;return(0,y.__generator)(this,function(g){if((this.bubbleDataSource||this.heatMapDataSource||this.filledMapDataSource||this.barChart3DDataSource||this.referenceDataSource)&&(t=(0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)([],this.bubbleDataSource.getShapes(),!0),this.heatMapDataSource.getShapes(),!0),this.filledMapDataSource.getShapes(),!0),this.barChart3DDataSource.getShapes(),!0),this.referenceDataSource.getShapes(),!0),this.hasSelection?(a=_.filter(this.selectableDataPoints,function(b){return b.selected}),r=_.map(a,function(b){return b.identity.getKey()}),t.forEach(function(b){var M=b.getProperties(),D=r.indexOf(M.identityKeys[0])>-1;b.addProperty("selected",D)})):t.forEach(function(b){b.addProperty("selected",!0)}),this.showPieChart)){for(i=[],o=[],n=0,u=t.filter(function(b){return b&&b.getProperties().showPie});n<u.length;n++)h=(c=u[n]).getId(),p=c.getProperties(),i.push(this.loadIcon(h,p.identityKeys[0],o));Promise.allSettled(i).then(function(){f.composeAndUpdatePieExpression(o)})}return[2]})})},this.loadIcon=function(t,a,r){return(0,y.__awaiter)(e,void 0,void 0,function(){var i,o,n,u;return(0,y.__generator)(this,function(c){switch(c.label){case 0:if(i=[],o=_.find(this.dataPoints,function(h){return h?.location&&h?.subDataPoints.length>0&&h.subDataPoints[0].identity.getKey()===a}),this.shouldUseLegacyFormat&&J.LEGACY_appendPieRadiusToDataPoints([o],this.data),!o)return[3,2];for(n=0;n<o.subDataPoints.length;n++)this.hasSelection?o.subDataPoints[n].selected&&i.push(n):i.push(n);return u=wt.hash(o,this.data.properties.bubble,i),[4,this.pieChartFactory.loadIcon(o,this.data.properties.bubble,i,u)];case 1:c.sent(),i.length>0&&r.push({dataPoint:o,hash:u,markerShapeId:t,selectedIndexes:i}),c.label=2;case 2:return[2]}})})},this.composeAndUpdatePieExpression=function(t){for(var a=["literal",[]],r=[],i=0,o=t;i<o.length;i++){var n=o[i],u=n.dataPoint,c=n.hash,h=n.markerShapeId,p=n.selectedIndexes;a[1].push(h),u.subDataPoints.length!==p.length&&r.push(["==",["get","_azureMapsShapeId"],h],"".concat(c))}var d=r.length>0?(0,y.__spreadArray)((0,y.__spreadArray)(["case"],r,!0),[["get","iconId"]],!1):["get","iconId"],f=["case",["in",["get","_azureMapsShapeId"],a],(0,V.TD)(e.data.properties.bubble.transparency),(0,V.TD)(e.data.properties.commonDataOptions.unselectedTransparency)];e.pieChartSymbolLayer.setOptions({iconOptions:{image:d,opacity:f}})}}return Object.defineProperty(s.prototype,"bubbleDataSource",{get:function(){return this.mapControl.sources.getById(xe)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"heatMapDataSource",{get:function(){return this.mapControl.sources.getById($e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"filledMapDataSource",{get:function(){return this.mapControl.sources.getById(Ke)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"barChart3DDataSource",{get:function(){return this.mapControl.sources.getById(je)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"referenceDataSource",{get:function(){return this.mapControl.sources.getById(Dt)},enumerable:!1,configurable:!0}),s.prototype.bindEvents=function(e,t,a){this.mapControl=e.mapControl,this.selectableDataPoints=e.selectableDataPoints,this.selectionHandler=t,this.data=e.data,this.dataPoints=e.dataPoints,this.hostServices=e.hostServices},s.prototype.setFormatMode=function(e){this.formatMode=e},s.prototype.setSubSelectionHelper=function(e){this.subSelectionHelper=e},s.prototype.renderSelection=function(e){this.hasSelection=e,this.updateDataSourceWithSelection()},s.prototype.setPieChartBehavior=function(e,t,a,r){void 0===r&&(r=!0),this.showPieChart=e,this.pieChartFactory=t,this.pieChartSymbolLayer=a,this.shouldUseLegacyFormat=r},s.prototype.findSubDataPointByMouseEvent=function(e){if(e){var t=_.find(e.shapes,at);if(t)return this.findSubDataPointByClusterFeature(t);var a=_.find(e.shapes,xt);if(a)return this.findSubDataPointByShape(a)}},s.prototype.findSubDataPointByShape=function(e){for(var t=Se.getFirstIdentityKey(e),a=void 0,r=0,i=this.data.dataPoints;r<i.length&&!(a=i[r].subDataPoints.find(function(n){return n.identity.getKey()===t}));r++);return a},s.prototype.findSubDataPointByClusterFeature=function(e){var t=e.properties,a={header:this.hostServices.getLocalizedString("Visual_AzureMapsCluster_TooltipInfo",t.point_count),displayName:""};return{size:t.size,color:"",selected:!1,identity:null,tooltipInfo:[a]}},s}(),de=B(90120),pe=B(54522),kt=B(21181),pa=B(18664),gt=B(79811),Bt=B(56919),me=B(44783),rr=B(38078),ke=B(90700),Tt=B(38958),C=B(82755),Re=B(26543),ir=function(){function s(){}return s.getRadius=function(e,t){var r=t.minDataValue,i=t.maxDataValue;if(!t.hasSize||r===i)return t.properties.bubble.radius;var o=t.properties.bubble,n=o.markerRangeType;n===ke.Dl.auto&&(n=r>=0||i<=0?ke.Dl.magnitude:ke.Dl.dataRange),n===ke.Dl.magnitude&&(e=Math.abs(e),i=Math.max(Math.abs(r),Math.abs(i)),r=0);var u=o.minRadius,c=o.maxRadius,h=_.clamp(e,r,i);return Math.sqrt((h-r)/(i-r))*(c-u)+u},s.updateRadiusForDataPoints=function(e){e.dataPoints.forEach(function(t){var a=t.subDataPoints.reduce(function(i,o){return i+o.size},0),r=s.getRadius(a,e);t.bubbleRadius=r})},s}(),rt=B(56707),Qe=B(2241),fa=B(41234),it=B(47316),ya=function(){return function(){this.allowExtrusions=!0,this.visible=!0,this.bubble={strokeShow:!0,strokePattern:it.Dv.solid,strokeColor:"white",strokeWidth:2,strokeTransparency:0,fillColor:"#1A73AA",fillOpacity:1},this.line={strokeShow:!0,strokePattern:it.Dv.solid,strokeColor:"#1e90ff",strokeWidth:3,strokeTransparency:0,strokeDashCap:it.qH.round,strokeLineJoin:fa.t.round},this.polygon={strokeShow:!0,strokePattern:it.Dv.solid,strokeColor:"#1e90ff",strokeWidth:3,strokeTransparency:0,fillColor:"#1e90ff",fillOpacity:.5,strokeDashCap:it.qH.round,strokeLineJoin:fa.t.round},this.unselectedTransparency=80}}(),be=rr.b$.parseNumber,or=function(){function s(){}return s.getHeatMapGradientColorScale=function(e){var t=de.v.getDataColorByIndex(e,0);return(0,V.X6)(t)},s.converter=function(e){var t=e.dataView,a=e.geoTaggingAnalyzerService,r=e.interactivityService,i=e.style,o=e.featureSwitches,n=t.matrix,u=t.metadata.objects,c=de.v.create(i,l.MC.dataPoint.fill,(0,C.W7)(u,l.MC.dataPoint.defaultColor),(0,C.W7)(u,l.MC.dataPoint.fill));if(!n||!n.rows||!n.rows.levels||0===n.rows.levels.length)return s.getDefaultMapData(i,o);var h=[].concat.apply([],n.rows.levels.map(function(ie){return ie.sources&&ie.sources.map(function(te){return te})})||[]),p=[].concat.apply([],n.columns.levels.map(function(ie){return ie.sources&&ie.sources.map(function(te){return te})})||[]),f=s.determineDataFlags(h,p,n.valueSources),g=s.getMapControlProperties(u);g.geocodingCulture&&!(0,Bt._h)(g.geocodingCulture)&&(g.geocodingCulture=void 0,f.hasInvalidGeocodingCulture=!0);var M,w,b=null,D=[];if(f.hasCategory){var N=!_.isEmpty(n.rows.levels)&&_.last(n.rows.levels).sources;if(!f.hasSeries||f.hasSize||f.hasX||f.hasY||f.hasTooltip||f.hasPointOrder){var T=s.convertMatrixWithCategory(f,n,D,c,a,r,o,g.geocodingCulture);M=T.dataPoints,w=T.paths}else M=(W=s.convertMatrixWithOnlyCategoryAndSeries(f,n,D,c,a,o,g.geocodingCulture)).dataPoints,w=W.paths;b=s.getGeocodingCategory(_.last(N),a)}else{var W;M=(W=s.convertMatrixWithoutCategory(f,n,D,c,r,o)).dataPoints,w=W.paths}var P=s.getCommonDataLayerProperties(u,f.hasSize,M,o),E={mapControls:g,traffic:s.getTrafficProperties(u),tile:s.getTileLayerProperties(u),filledMap:s.getFilledMapProperties(u,i),bubble:s.getBubbleLayerProperties(u,i),heatMap:s.getHeatMapLayerProperties(u,i),barChart:s.getBarChartProperties(u,i),commonDataOptions:P,referenceLayer:s.getReferenceLayerProperties(u)};f.hasDuplicatedLatLong&&(E.bubble.autoStrokeColor=!1,E.bubble.blur=0,E.bubble.zoomScaleFactor=1,E.bubble.pitchAlignment="viewport"),E.heatMap.heatMapRadius="meters"===E.heatMap.heatMapRadiusUnit?Math.min(E.heatMap.heatMapRadius,Lt):Math.min(E.heatMap.heatMapRadius,200);var U=this.composeLegendData(f,e,c,i,o),re={dataPoints:M,properties:E,shouldRenderFilledMap:E.filledMap.showFilledMap&&!f.hasSize,geocodingCategory:b,hasCategory:f.hasCategory,hasSeries:f.hasSeries,hasXY:f.hasXY,hasSize:f.hasSize,hasInvalidLatLong:f.hasInvalidLatLong,hasInvalidGeocodingCulture:f.hasInvalidGeocodingCulture,hasDuplicatedLatLong:f.hasDuplicatedLatLong,hasPathID:f.hasPathID,colorHelper:c,minDataValue:f.hasSize?P.minDataValue:void 0,maxDataValue:f.hasSize?P.maxDataValue:void 0,legendData:U,dataLabelSettings:this.calculateDataLabelSettings(t,i),series:D,paths:w};return!(E.bubble.markerRangeType===ke.Dl.deprecated)&&E.bubble.showBubbleLayer&&ir.updateRadiusForDataPoints(re),re},s.composeLegendData=function(e,t,a,r,i){var o={dataView:t.dataView,colorHelper:a,style:r,formatStringProp:l.MC.general.formatString,showByDefault:!0};return e.hasSeries&&e.hasCategory&&(e.hasSize||e.hasXY||e.hasTooltip)?(0,gt.Lk)(o):e.hasSeries&&i.azureMapsPathLayer&&e.hasPathID?(0,gt.z9)(o):e.hasSeries?(0,gt.PP)(o):(0,gt.Fe)(r)},s.determineDataFlags=function(e,t,a){var r=s.HaveRole(e,l.Wx.category),i=s.HaveRole(t,l.Wx.series)||s.HaveRole(e,l.Wx.series),o=s.HaveRole(a,l.Wx.x)||s.HaveRole(e,l.Wx.x),n=s.HaveRole(a,l.Wx.y)||s.HaveRole(e,l.Wx.y);return{hasCategory:r,hasSeries:i,hasX:o,hasY:n,hasXY:o&&n,hasSize:s.HaveRole(a,l.Wx.size),hasTooltip:s.HaveRole(a,l.Wx.tooltips),hasInvalidLatLong:!1,hasInvalidGeocodingCulture:!1,hasDuplicatedLatLong:!1,hasPathID:s.HaveRole(e,l.Wx.pathID),hasPointOrder:s.HaveRole(a,l.Wx.pointOrder)}},s.convertMatrixWithOnlyCategoryAndSeries=function(e,t,a,r,i,o,n){I.fF.assertNonEmpty(t.rows.levels,"Matrix should have rows");var u=o.azureMapsPathLayer&&e.hasPathID,c=u?t.rows.root.children||[]:[{children:t.rows.root.children||[]}],h=u?1:0,p=!_.isEmpty(t.rows.levels)&&t.rows.levels[h].sources[0],d=0,f={},g=[],b=new Map,M=this.getRowBasedSeriesIdentityFields(t,e,o),w=0;return c.forEach(function(D){var N=D.children,T=o.azureMapsPathLayer&&e.hasPathID&&String(D.levelValues[0].value)||"";N.forEach(function(P){var E,U=r.getColorForSeriesValue(P.objects,M,P.value,me.fA),re=(0,pe.xq)(P.value,p,l.MC.general.formatString),fe={displayName:p.displayName,value:re},se=s.getSeriesValueDetails(o,P,p),ie=(new Re.dw).withColumnIdentity(P.identity,p.queryName,se);if(a.push({value:re,color:U,identity:ie.createSelectionId(),selected:!1}),P.children){var te=null===(E=t.rows.levels)||void 0===E?void 0:E[h+1].sources,ae=_.last(te);P.children.forEach(function(Te){var le=s.getCategoryValueDetails(o,Te,te),ue=(new Re.dw).withColumnIdentity(Te.identity,ae.queryName,le);if(T.length>0){var ye=t.rows.levels[0].sources[0],st=s.getPathIDValueDetails(o,D,ye);ue.withColumnIdentity(D.identity,ye.queryName,st)}var _e=ue.createSelectionId().getKey();ue.withColumnIdentity(P.identity,p.queryName,se);var Me=f[_e];null==Me&&(Me=d++,f[_e]=Me);for(var He={components:[],culture:n},we=[],Ve=[],ce=Te.levelValues.map(function(vt){return vt.value}),Pe=0;Pe<ce.length;++Pe){var lt=te[Pe],It=ce[Pe],Ft=s.getGeocodingCategory(lt,i),ut=(0,pe.xq)(It,lt,l.MC.general.formatString);Ve.unshift(ut),He.components.push({query:ut,category:Ft}),we.push({displayName:lt.displayName,value:ut})}var _t=Ve.join(", "),Oe=g[Me];Oe||(Oe={categoryValue:_t,queryLocation:He,subDataPoints:[]},T.length>0&&(Oe.pathID=T),g[Me]=Oe,T.length>0&&(b.has(T)?b.get(T).push(Me):b.set(T,[Me])));var Vt=(0,y.__spreadArray)((0,y.__spreadArray)([],we,!0),[fe],!1);Oe.subDataPoints.push({size:1,color:U,identity:ue.createSelectionId(),selected:!1,tooltipInfo:Vt,seriesIndex:w})})}else{var Le=P,oe=p,H=(0,pe.xq)(Le.levelValues[0].value,oe,l.MC.general.formatString),ge={components:[{query:H,category:s.getGeocodingCategory(oe,i)}],culture:n},De=s.getCategoryValueDetails(o,Le,[oe],!0),ve=(new Re.dw).withColumnIdentity(Le.identity,oe.queryName,De);g.push({categoryValue:H,queryLocation:ge,subDataPoints:[{size:1,color:U,identity:ve.createSelectionId(),selected:!1,tooltipInfo:[fe],seriesIndex:w}]}),T.length>0&&(g[g.length-1].pathID=T,b.has(T)?b.get(T).push(g.length-1):b.set(T,[g.length-1]))}w++})}),{dataPoints:g,paths:b}},s.convertMatrixWithCategory=function(e,t,a,r,i,o,n,u){var c=n.azureMapsPathLayer&&e.hasPathID,h=c?t.rows.root.children||[]:[{children:t.rows.root.children||[]}],p=t.columns.root.children||[],d=c?1:0,f=!_.isEmpty(t.rows.levels)&&t.rows.levels[d].sources,g=f?f[f.length-1]:void 0,b=!_.isEmpty(t.columns.levels)&&t.columns.levels[0].sources[0],M=t.valueSources,w=s.GetValueIndexForRole(M,l.Wx.size),D=s.GetValueIndexForRole(M,l.Wx.pointOrder),N=[],W=[],T=new Map;if(e.hasSeries)for(var P=0,E=p;P<E.length;P++){var U=E[P],re=r.getColorForSeriesValue(U.objects,t.columns.root.childIdentityFields,U.value,me.fA),fe=(0,pe.xq)(U.value,b,l.MC.general.formatString),se=s.getSeriesValueDetails(n,U,b),ie=(new Re.dw).withColumnIdentity(U.identity,b.queryName,se);a.push({value:fe,color:re,identity:ie.createSelectionId(),selected:!1,valueDetails:se})}return h.forEach(function(te){var ae=te.children,oe=n.azureMapsPathLayer&&e.hasPathID&&String(te.levelValues[0].value)||"";ae.forEach(function(F){for(var H,Y,ge=[],De={components:[],culture:u},ve=[],Te=F.levelValues.map(function(Ma){return Ma.value}),le=0;le<Te.length;++le){var ue=f[le],ye=Te[le],st=s.getGeocodingCategory(ue,i),_e=(0,pe.xq)(ye,ue,l.MC.general.formatString);ge.unshift(_e),De.components.push({query:_e,category:st}),ve.push({displayName:ue.displayName,value:_e})}var Me=ge.join(", "),He=s.getCategoryValueDetails(n,F,f),we=[];if(e.hasSeries)for(var Ve=function(Ne){var bt=M.length,Sa=-1!==w?be(F.values[Ne*bt+w].value):0;if(e.hasPointOrder&&(Y=s.getPointOrderValueFromNode(F.values[Ne*bt+D],Y)),e.hasSize&&null==Sa)return"continue";var Ct=M.map(function(Pa,Pr){return F.values[Ne*bt+Pr].value});if(Ct.every(function(Pa){return null==Pa}))return"continue";if(e.hasXY&&!H){var Mr=s.GetValueIndexForRole(M,l.Wx.x),Sr=s.GetValueIndexForRole(M,l.Wx.y),La=be(Ct[Mr]),Da=be(Ct[Sr]);null!=La&&null!=Da&&(H={longitude:be(La),latitude:be(Da)})}var Lr=p[Ne],Dr=(new Re.dw).withColumnIdentity(Lr.identity,b.queryName,a[Ne].valueDetails).withColumnIdentity(F.identity,g.queryName,He),Ot=(0,y.__spreadArray)([],ve,!0);Ot.push({displayName:b.displayName,value:a[Ne].value});for(var ct=0;ct<bt;ct++){var wa=Ct[ct];null!==wa&&Ot.push({displayName:M[ct].displayName,value:(0,pe.xq)(wa,M[ct],l.MC.general.formatString)})}we.push({size:e.hasSize?Math.min(Sa,ft):1,color:a[Ne].color,identity:Dr.createSelectionId(),selected:!1,tooltipInfo:Ot,seriesIndex:Ne})},ce=0;ce<p.length;ce++)Ve(ce);else{if(e.hasXY){var Pe=s.GetValueIndexForRole(M,l.Wx.x),lt=s.GetValueIndexForRole(M,l.Wx.y);H={longitude:be(F.values[Pe].value),latitude:be(F.values[lt].value)}}var Ft=r.getColorForMeasure(F.objects,-1!==w&&M[w].queryName,me.fA),ut=(new Re.dw).withColumnIdentity(F.identity,g.queryName,He),_t=-1!==w?be(F.values[w].value):0,Oe=(0,y.__spreadArray)([],ve,!0);if(e.hasPointOrder&&(Y=s.getPointOrderValueFromNode(F.values[D],Y)),!_.isEmpty(p))for(ce=0;ce<p.length;ce++){var vt=F.values[ce].value;null!==vt&&Oe.push({displayName:M[ce].displayName,value:(0,pe.xq)(vt,M[ce],l.MC.general.formatString)})}we.push({size:Math.min(_t,ft),color:Ft,identity:ut.createSelectionId(),selected:!1,tooltipInfo:Oe})}if(H&&s.AreLatLongInvalid(H))e.hasInvalidLatLong=!0;else if(we.length>0){var mt={queryLocation:De,location:H,subDataPoints:we,categoryValue:Me,pointOrder:Y};oe.length>0&&(mt.pathID=oe),I.fF.assertNonEmpty(mt.subDataPoints,"subDataPoints should be defined and its length > 0"),N.push(mt),oe.length>0&&(T.has(oe)?T.get(oe).push(N.length-1):T.set(oe,[N.length-1])),o&&W.push.apply(W,mt.subDataPoints)}})}),o&&W.length>0&&o.applySelectionStateToData(W),{dataPoints:N,paths:T}},s.convertMatrixWithoutCategory=function(e,t,a,r,i,o){if(!e.hasXY)return{dataPoints:[]};var n=o.azureMapsPathLayer&&e.hasPathID,u=n?t.rows.root.children||[]:[{children:t.rows.root.children||[]}],c=t.valueSources,h=s.GetValueIndexForRole(c,l.Wx.size),p=[],d=[],f=s.GetSource(t.rows.levels[0].sources,l.Wx.pathID),g=new Map,b=s.GetValueIndexForRole(c,l.Wx.pointOrder);if(e.hasSeries){var M=n?1:0,D=t.rows.levels[M+1],N=s.GetSource(t.rows.levels[M].sources,l.Wx.series),W=s.GetSource(D.sources,l.Wx.x),T=s.GetSource(D.sources,l.Wx.y),E=s.getRowBasedSeriesIdentityFields(t,e,o),U=0;u.forEach(function(te){var ae={},Le=te.children,F=o.azureMapsPathLayer&&e.hasPathID&&String(te.levelValues[0].value)||"";Le.forEach(function(H){var ve,Y=(0,pe.xq)(H.levelValues[0].value,N,l.MC.general.formatString),ge=r.getColorForSeriesValue(H.objects,E,Y,me.fA),De=s.getSeriesValueDetails(o,H,N),Te=(new Re.dw).withColumnIdentity(H.identity,N.queryName,De);a.push({value:Y,color:ge,identity:Te.createSelectionId(),selected:!1}),H.children.forEach(function(le){var ye=s.getDataPointValueFromXyNode(le,h,W,T,c,{displayName:N.displayName,value:Y});if(e.hasPointOrder&&(ve=s.getPointOrderValueFromNode(le.values[b],ve)),s.AreLatLongInvalid(ye.location))e.hasInvalidLatLong=!0;else{var st=s.getXYValueDetails(o,le,W,ye),_e=s.getXYValueDetails(o,le,T,ye),Me=(new Re.dw).withColumnIdentity(H.identity,N.queryName,De).withColumnIdentity(le.identity,W.queryName,st).withColumnIdentity(le.identity,T.queryName,_e);if(F.length>0){var He=s.getPathIDValueDetails(o,te,f);Me.withColumnIdentity(te.identity,f.queryName,He)}var we=(0,y.__assign)((0,y.__assign)({},ye.subDataPoint),{size:Math.min(ye.subDataPoint.size,ft),color:ge,identity:Me.createSelectionId(),selected:!1,seriesIndex:U}),Ve="".concat(ye.location.latitude,",").concat(ye.location.longitude),ce=o.azureMapsLatLongPieCharts;if(ce&&Ve in ae)ae[Ve].subDataPoints.push(we),e.hasDuplicatedLatLong=!0;else{var Pe={location:ye.location,categoryValue:ye.categoryValue,subDataPoints:[we],pointOrder:ve};I.fF.assertNonEmpty(Pe.subDataPoints,"subDataPoints should be defined and its length > 0"),F.length>0&&(Pe.pathID=F),p.push(Pe),F.length>0&&(g.has(F)?g.get(F).push(p.length-1):g.set(F,[p.length-1])),ce&&(ae[Ve]=Pe)}i&&d.push(we)}}),U++})})}else{var re=-1!==h&&c[h].queryName,se=s.GetSource((D=t.rows.levels[n?1:0]).sources,l.Wx.x),ie=s.GetSource(D.sources,l.Wx.y);u.forEach(function(ae){var Le=ae.children,F=o.azureMapsPathLayer&&e.hasPathID&&String(ae.levelValues[0].value)||"";Le.forEach(function(H){var Y=s.getDataPointValueFromXyNode(H,h,se,ie,c),ge=e.hasPointOrder?s.getPointOrderValueFromNode(H.values[b]):null;if(s.AreLatLongInvalid(Y.location))e.hasInvalidLatLong=!0;else{var De=r.getColorForMeasure(H.objects,re,me.fA),ve=s.getXYValueDetails(o,H,se,Y),Te=s.getXYValueDetails(o,H,ie,Y),le=(new Re.dw).withColumnIdentity(H.identity,se.queryName,ve).withColumnIdentity(H.identity,ie.queryName,Te);F.length>0&&le.withColumnIdentity(ae.identity,f.queryName,s.getPathIDValueDetails(o,ae,f));var ue={location:Y.location,categoryValue:Y.categoryValue,subDataPoints:[(0,y.__assign)((0,y.__assign)({},Y.subDataPoint),{size:Math.min(Y.subDataPoint.size,ft),color:De,identity:le.createSelectionId(),selected:!1})],pointOrder:ge};I.fF.assertNonEmpty(ue.subDataPoints,"subDataPoints should be defined and its length > 0"),F.length>0&&(ue.pathID=F),p.push(ue),F.length>0&&(g.has(F)?g.get(F).push(p.length-1):g.set(F,[p.length-1])),i&&d.push.apply(d,ue.subDataPoints)}})})}return i&&d.length>0&&i.applySelectionStateToData(d),{dataPoints:p,paths:g}},s.getRowBasedSeriesIdentityFields=function(e,t,a){if(!a.azureMapsPathLayer||!t.hasPathID)return e.rows.root.childIdentityFields;var r=new Map;return e.rows.root.children.flatMap(function(i){return i.childIdentityFields}).forEach(function(i){var o=JSON.stringify(i);r.has(o)||r.set(o,i)}),Array.from(r.values())},s.getDataPointValueFromXyNode=function(e,t,a,r,i,o){var c=be(e.levelValues[0].value),h=(0,pe.xq)(c,a,l.MC.general.formatString),p=be(e.levelValues[1].value),d=(0,pe.xq)(p,r,l.MC.general.formatString),f=-1!==t?be(e.values[t].value):1,g=[];void 0!==o&&g.push(o),g.push({displayName:r.displayName,value:d}),g.push({displayName:a.displayName,value:h});for(var b=0;b<i.length;b++){var w=e.values[b].value;null!==w&&g.push({displayName:i[b].displayName,value:(0,pe.xq)(w,i[b],l.MC.general.formatString)})}return{location:{latitude:p,longitude:c},subDataPoint:{tooltipInfo:g,size:f},categoryValue:d+", "+h,formattedLatitude:d,formattedLongitude:h}},s.getSeriesValueDetails=function(e,t,a){var r;if(e.interactivityServiceCaching){r=[];for(var i=0,o=t.levelValues;i<o.length;i++){var n=o[i];r.push({expr:a.expr,formattedValue:(0,pe.xq)(n.value,a,l.MC.general.formatString),value:n.value,identity:t.identity})}}return r},s.getCategoryValueDetails=function(e,t,a,r){var i;if(e.interactivityServiceCaching){i=[];for(var o=t.levelValues,n=0;n<o.length;n++){var u=r?a[0]:a[n];i.push({expr:u.expr,formattedValue:(0,pe.xq)(o[n].value,u,l.MC.general.formatString),value:o[n].value,identity:t.identity})}}return i},s.getXYValueDetails=function(e,t,a,r){var i;return e.interactivityServiceCaching&&(i=[{expr:a.expr,formattedValue:r.formattedLongitude,value:r.location.longitude,identity:t.identity}]),i},s.getPathIDValueDetails=function(e,t,a){var r;if(e.interactivityServiceCaching)for(var i=0,o=t.levelValues;i<o.length;i++){var n=o[i];r.push({expr:a.expr,formattedValue:(0,pe.xq)(n.value,a,l.MC.general.formatString),value:n.value,identity:t.identity})}return r},s.getGeocodingCategory=function(e,t){var a;if(a=t.getFieldTypeFromDescriptor(e.type))return a;if(a=t.getFieldType(e.displayName))return a;var o=e.roles;if(o)for(var n=Object.keys(o),u=0,c=n.length;u<c;++u){var h=t.getFieldType(n[u]);if(h)return h}},s.calculateDataLabelSettings=function(e,t){var a=this.getDefaultMapLabelSettings(t),r=e.metadata.objects;if(r){a.showCategory=(0,C.NA)(r,l.MC.categoryLabels.show,a.showCategory);var i=r.categoryLabels;i&&(0,kt.ww)(i,a,void 0,t);var o=de.v.create(t);a.enableBackground=(0,C.NA)(r,l.MC.categoryLabels.enableBackground,!0),a.backgroundColor=o.getColorForProperty(r,l.MC.categoryLabels.backgroundColor,Zt),a.backgroundTransparency=(0,C.NA)(r,l.MC.categoryLabels.backgroundTransparency,50)/100}return a},s.getDefaultMapLabelSettings=function(e){var t=de.v.getThemeColor(e,rt.pl),a=(0,kt.bT)({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,showCategory:!1,position:0,fontProperties:a=(0,pa.ED)(a,{color:t}),enableBackground:!0,backgroundColor:de.v.getThemeColor(e,Zt),backgroundTransparency:.5,bold:!1,italic:!1,underline:!1}},s.getDefaultMapData=function(e,t){return{dataPoints:[],dataLabelSettings:this.getDefaultMapLabelSettings(e),properties:{mapControls:s.getMapControlProperties(null),traffic:s.getTrafficProperties(null),tile:s.getTileLayerProperties(null),filledMap:s.getFilledMapProperties(null,e),bubble:s.getBubbleLayerProperties(null,e),heatMap:s.getHeatMapLayerProperties(null,e),barChart:s.getBarChartProperties(null,e),commonDataOptions:s.getCommonDataLayerProperties(null,!1,[],t),referenceLayer:s.getReferenceLayerProperties(null)},shouldRenderFilledMap:!1,geocodingCategory:"",hasCategory:!1,hasSeries:!1,hasXY:!1,hasSize:!1,hasInvalidLatLong:!1,hasInvalidGeocodingCulture:!1,hasDuplicatedLatLong:!1,hasPathID:!1,colorHelper:de.v.create(e,l.MC.dataPoint.fill),series:[],paths:null}},s.getMapControlProperties=function(e){return{styleProperties:{defaultStyle:(0,C.NA)(e,l.MC.mapControls.defaultStyle,l.a.grayscaleLight),showLabels:(0,C.NA)(e,l.MC.mapControls.showLabels,!0),worldWrap:(0,C.NA)(e,l.MC.mapControls.worldWrap,!0)},controlToggles:{showStylePicker:(0,C.NA)(e,l.MC.mapControls.showStylePicker,!0),showNavigationControls:(0,C.NA)(e,l.MC.mapControls.showNavigationControls,!0),showSelectionControl:(0,C.NA)(e,l.MC.mapControls.showSelectionControl,!1)},cameraProperties:{zoom:(0,C.NA)(e,l.MC.mapControls.zoom,0),centerLatitude:(0,C.NA)(e,l.MC.mapControls.centerLatitude,0),centerLongitude:(0,C.NA)(e,l.MC.mapControls.centerLongitude,0),heading:(0,C.NA)(e,l.MC.mapControls.heading,0),pitch:(0,C.NA)(e,l.MC.mapControls.pitch,0),autoZoom:(0,C.NA)(e,l.MC.mapControls.autoZoom,!0)},geocodingCulture:(0,C.NA)(e,l.MC.mapControls.geocodingCulture,Bt.gA)}},s.getTrafficProperties=function(e){return{showTraffic:(0,C.NA)(e,l.MC.traffic.showTraffic,!1),showIncidents:(0,C.NA)(e,l.MC.traffic.showIncidents,!0),showTrafficControl:(0,C.NA)(e,l.MC.traffic.showTrafficControl,!1)}},s.getTileLayerProperties=function(e){return{tileLayerUrl:(0,C.NA)(e,l.MC.tileLayer.tileLayerUrl,""),tileSize:(0,C.NA)(e,l.MC.tileLayer.tileSize,512),northBounds:(0,C.NA)(e,l.MC.tileLayer.northBounds,85.0511),southBounds:(0,C.NA)(e,l.MC.tileLayer.southBounds,-85.0511),eastBounds:(0,C.NA)(e,l.MC.tileLayer.eastBounds,180),westBounds:(0,C.NA)(e,l.MC.tileLayer.westBounds,-180),transparency:(0,C.NA)(e,l.MC.tileLayer.transparency,0),isTMS:(0,C.NA)(e,l.MC.tileLayer.isTMS,!1),minZoom:(0,C.NA)(e,l.MC.tileLayer.minZoom,0),maxZoom:(0,C.NA)(e,l.MC.tileLayer.maxZoom,G),layerPosition:(0,C.NA)(e,l.MC.tileLayer.layerPosition,"labels")}},s.getFilledMapProperties=function(e,t){return{showFilledMap:(0,C.NA)(e,l.MC.filledMap.show,!1),defaultColor:(0,C.W7)(e,l.MC.filledMap.defaultColor,t.colorPalette.dataColors.getColorByIndex(0).value),transparency:(0,C.NA)(e,l.MC.filledMap.transparency,0),strokeColor:(0,C.W7)(e,l.MC.filledMap.strokeColor,t.colorPalette.backgroundDark.value),strokeTransparency:(0,C.NA)(e,l.MC.filledMap.strokeTransparency,0),strokeWidth:(0,C.NA)(e,l.MC.filledMap.strokeWidth,1),minZoom:(0,C.NA)(e,l.MC.filledMap.minZoom,0),maxZoom:(0,C.NA)(e,l.MC.filledMap.maxZoom,G),layerPosition:(0,C.NA)(e,l.MC.filledMap.layerPosition,"labels")}},s.getBubbleLayerProperties=function(e,t){var a=(0,C.NA)(e,l.MC.bubbleLayer.radius,5),r=(0,C.W7)(e,l.MC.dataPoint.fill,de.v.getDataColorByIndex(t,0)),i=(0,C.W7)(e,l.MC.bubbleLayer.strokeColor,t.colorPalette.background.value),o=(0,C.NA)(e,l.MC.bubbleLayer.strokeWidth,2);return{showBubbleLayer:(0,C.NA)(e,l.MC.bubbleLayer.show,!0),transparency:(0,C.NA)(e,l.MC.bubbleLayer.transparency,0),radius:a,minRadius:(0,C.NA)(e,l.MC.bubbleLayer.minRadius,5),markerRangeType:(0,C.NA)(e,l.MC.bubbleLayer.markerRangeType,ke.Dl.dataRange),radiusScalingMethod:(0,C.NA)(e,l.MC.bubbleLayer.radiusScalingMethod,0),maxRadius:(0,C.NA)(e,l.MC.bubbleLayer.maxRadius,30),autoStrokeColor:(0,C.NA)(e,l.MC.bubbleLayer.autoStrokeColor,!1),strokeColor:i,strokeTransparency:(0,C.NA)(e,l.MC.bubbleLayer.strokeTransparency,0),strokeWidth:o,blur:(0,C.NA)(e,l.MC.bubbleLayer.blur,0),pitchAlignment:(0,C.NA)(e,l.MC.bubbleLayer.pitchAlignment,"viewport"),zoomScaleFactor:(0,C.NA)(e,l.MC.bubbleLayer.zoomScaleFactor,1),logScale:(0,C.NA)(e,l.MC.bubbleLayer.logScale,2),x1:(0,C.NA)(e,l.MC.bubbleLayer.x1,.15),x2:(0,C.NA)(e,l.MC.bubbleLayer.x2,.85),y1:(0,C.NA)(e,l.MC.bubbleLayer.y1,.7),y2:(0,C.NA)(e,l.MC.bubbleLayer.y2,.3),minZoom:(0,C.NA)(e,l.MC.bubbleLayer.minZoom,0),maxZoom:(0,C.NA)(e,l.MC.bubbleLayer.maxZoom,G),layerPosition:(0,C.NA)(e,l.MC.bubbleLayer.layerPosition,"labels"),clusteringEnabled:(0,C.NA)(e,l.MC.bubbleLayer.clusteringEnabled,!1),clusteredBubbleRadius:(0,C.NA)(e,l.MC.bubbleLayer.clusteredBubbleRadius,Math.max(a,12)),clusteredBubbleFillColor:t.isHighContrast?de.v.getThemeColor(t,me.fA):(0,C.W7)(e,l.MC.bubbleLayer.clusteredBubbleFillColor,r),clusteredBubbleFontColor:t.isHighContrast?de.v.getThemeColor(t,me.U):(0,C.W7)(e,l.MC.bubbleLayer.clusteredBubbleFontColor,de.v.getThemeColor(t,me.U)),clusteredBubbleFontSize:(0,C.NA)(e,l.MC.bubbleLayer.clusteredBubbleFontSize,18),clusteredBubbleStrokeColor:t.isHighContrast?de.v.getThemeColor(t,me.U):(0,C.W7)(e,l.MC.bubbleLayer.clusteredBubbleStrokeColor,i),clusteredBubbleStrokeWidth:(0,C.NA)(e,l.MC.bubbleLayer.clusteredBubbleStrokeWidth,o)}},s.getHeatMapLayerProperties=function(e,t){var a=this.getHeatMapGradientColorScale(t);return{showHeatMapLayer:(0,C.NA)(e,l.MC.heatMapLayer.show,!1),heatMapRadius:(0,C.NA)(e,l.MC.heatMapLayer.heatMapRadius,20),heatMapRadiusUnit:(0,C.NA)(e,l.MC.heatMapLayer.heatMapRadiusUnit,"pixels"),heatMapTransparency:(0,C.NA)(e,l.MC.heatMapLayer.heatMapTransparency,0),heatMapIntensity:(0,C.NA)(e,l.MC.heatMapLayer.heatMapIntensity,1),heatMapColorLow:(0,C.W7)(e,l.MC.heatMapLayer.heatMapColorLow,a(0)),heatMapColorCenter:(0,C.W7)(e,l.MC.heatMapLayer.heatMapColorCenter,a(.5)),heatMapColorHigh:(0,C.W7)(e,l.MC.heatMapLayer.heatMapColorHigh,a(1)),heatMapUseSize:(0,C.NA)(e,l.MC.heatMapLayer.heatMapUseSize,!1),minZoom:(0,C.NA)(e,l.MC.heatMapLayer.minZoom,0),maxZoom:(0,C.NA)(e,l.MC.heatMapLayer.maxZoom,G),layerPosition:(0,C.NA)(e,l.MC.heatMapLayer.layerPosition,"labels")}},s.getBarChartProperties=function(e,t){return{dataProperties:{showBarChart:(0,C.NA)(e,l.MC.barChart.show,!1),barShape:(0,C.NA)(e,l.MC.barChart.barShape,0),thickness:(0,C.NA)(e,l.MC.barChart.thickness,1),scaleThicknessOnZoom:(0,C.NA)(e,l.MC.barChart.scaleThicknessOnZoom,!0)},paintProperties:{height:(0,C.NA)(e,l.MC.barChart.height,1),scaleHeightOnZoom:(0,C.NA)(e,l.MC.barChart.scaleHeightOnZoom,!0),defaultColor:(0,C.W7)(e,l.MC.barChart.defaultColor,t.colorPalette.dataColors.getColorByIndex(0).value),transparency:(0,C.NA)(e,l.MC.barChart.transparency,0),minZoom:(0,C.NA)(e,l.MC.barChart.minZoom,0),maxZoom:(0,C.NA)(e,l.MC.barChart.maxZoom,G),layerPosition:(0,C.NA)(e,l.MC.barChart.layerPosition,"labels")}}},s.getCommonDataLayerProperties=function(e,t,a,r){for(var i={unselectedTransparency:(0,C.NA)(e,l.MC.commonDataOptions.unselectedTransparency,80)},o=[],n=0,u=a;n<u.length;n++){var h=_.sum(u[n].subDataPoints.map(function(D){return D.size}));o.push(h)}if(t){var p=(0,C.NA)(e,l.MC.commonDataOptions.showZeros,!0),d=(0,C.NA)(e,l.MC.commonDataOptions.showNegatives,!0),f=(0,C.NA)(e,l.MC.bubbleLayer.markerRangeType,void 0),g=(0,y.__spreadArray)([],o,!0);(!f||f===ke.Dl.deprecated)&&(d&&!p?g=o.map(function(D){return Math.abs(D)}).filter(function(D){return D>0}):d?g=o.map(function(D){return Math.abs(D)}):p||(g=o.filter(function(D){return D>0})));var M=Math.min.apply(Math,g),w=Math.max.apply(Math,g);i.showZeros=p,i.showNegatives=d,i.minDataValue=(0,C.NA)(e,l.MC.commonDataOptions.minDataValue,M),i.maxDataValue=(0,C.NA)(e,l.MC.commonDataOptions.maxDataValue,w)}return i},s.getReferenceLayerProperties=function(e){var t=new ya;return{additionalDatasource:(0,C.NA)(e,l.MC.referenceLayer.additionalDatasource,void 0),referenceLayerUrl:(0,C.NA)(e,l.MC.referenceLayer.referenceLayerUrl,""),datasourceType:(0,C.NA)(e,l.MC.referenceLayer.datasourceType,"file_upload"),bubble:(0,y.__assign)({fillColor:(0,C.W7)(e,l.MC.referenceLayerBubble.fillColor,t.bubble.fillColor),fillOpacity:(0,C.NA)(e,l.MC.referenceLayerBubble.fillOpacity,t.bubble.fillOpacity)},(0,Qe.QI)(e,l.MC.referenceLayerBubble,t.bubble)),line:(0,Qe.QI)(e,l.MC.referenceLayerLine,t.line),polygon:(0,y.__assign)({fillColor:(0,C.W7)(e,l.MC.referenceLayerPolygon.fillColor,t.polygon.fillColor),fillOpacity:(0,C.NA)(e,l.MC.referenceLayerPolygon.fillOpacity,t.polygon.fillOpacity)},(0,Qe.QI)(e,l.MC.referenceLayerPolygon,t.polygon))}},s.GetSource=function(e,t){return e.find(function(a){return(0,Tt.nu)(a,t)})},s.HaveRole=function(e,t){return-1!==e.findIndex(function(a){return(0,Tt.nu)(a,t)})},s.GetValueIndexForRole=function(e,t){return e.findIndex(function(a){return(0,Tt.nu)(a,t)})},s.AreLatLongInvalid=function(e){return!e||(0,X.IU)(e.latitude,e.longitude)},s.getPointOrderValueFromNode=function(e,t){var a;return t??(null!==(a=be(e.value))&&void 0!==a?a:s.parseDate(e.value))},s.parseDate=function(e){return e instanceof Date?e:"string"==typeof e?isNaN(Date.parse(e))?null:new Date(e):"number"==typeof e?new Date(e):null},s}(),Xe=B(32554),Q=B(33024),Be=B(59694),Ce=function(){function s(){}return s.getMapSettingsCard=function(e,t,a){var r=new v.CQ(new v.lg(l.Do.mapControls),"Visual_AzureMapsMapSettings",l.MC.mapControls,a).withDescription("Visual_MapControlsDescription");return r.addGroup("style",function(i){i.withDisplayName("Style").addSimpleSlice(l.MC.mapControls.defaultStyle,new v.uY({descriptor:l.MC.mapControls.defaultStyle,value:e.mapControls.styleProperties.defaultStyle}).build()),t.azureMapsShowLabels&&i.addSimpleSlice(l.MC.mapControls.showLabels,new v.bd({descriptor:l.MC.mapControls.showLabels,value:e.mapControls.styleProperties.showLabels}).build())}).addGroup("view",function(i){i.withDisplayName("View").addSimpleSlice(l.MC.mapControls.autoZoom,new v.bd({descriptor:l.MC.mapControls.autoZoom,value:e.mapControls.cameraProperties.autoZoom}).build()).addSimpleSlice(l.MC.mapControls.zoom,new v.JN({descriptor:l.MC.mapControls.zoom,value:e.mapControls.cameraProperties.zoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:a}).build(),function(o){return o.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(l.MC.mapControls.centerLatitude,new v.mu({descriptor:l.MC.mapControls.centerLatitude,value:e.mapControls.cameraProperties.centerLatitude,options:{minValue:{type:0,value:-90},maxValue:{type:1,value:90},unitSymbol:Q.g}}).build(),function(o){return o.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(l.MC.mapControls.centerLongitude,new v.mu({descriptor:l.MC.mapControls.centerLongitude,value:e.mapControls.cameraProperties.centerLongitude,options:{minValue:{type:0,value:Ue},maxValue:{type:1,value:180},unitSymbol:Q.g}}).build(),function(o){return o.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(l.MC.mapControls.heading,new v.JN({descriptor:l.MC.mapControls.heading,value:e.mapControls.cameraProperties.heading,options:{minValue:{type:0,value:0},maxValue:{type:1,value:360},unitSymbol:Q.g},localize:a}).build(),function(o){return o.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(l.MC.mapControls.pitch,new v.JN({descriptor:l.MC.mapControls.pitch,value:e.mapControls.cameraProperties.pitch,options:{minValue:{type:0,value:0},maxValue:{type:1,value:60},unitSymbol:Q.g},localize:a}).build(),function(o){return o.withDisabled(e.mapControls.cameraProperties.autoZoom)})}).addGroup("controls",function(i){i.withDisplayName("Controls").addSimpleSlice(l.MC.mapControls.worldWrap,new v.bd({descriptor:l.MC.mapControls.worldWrap,value:e.mapControls.styleProperties.worldWrap}).build()).addSimpleSlice(l.MC.mapControls.showStylePicker,new v.bd({descriptor:l.MC.mapControls.showStylePicker,value:e.mapControls.controlToggles.showStylePicker}).build()).addSimpleSlice(l.MC.mapControls.showNavigationControls,new v.bd({descriptor:l.MC.mapControls.showNavigationControls,value:e.mapControls.controlToggles.showNavigationControls}).build(),function(o){return o.withCustomDisplayName("Navigation")}).addSimpleSlice(l.MC.mapControls.showSelectionControl,new v.bd({descriptor:l.MC.mapControls.showSelectionControl,value:e.mapControls.controlToggles.showSelectionControl}).build(),function(o){return o.withCustomDisplayName("ExplorationCanvasItemsPane_Title")}),t.azureMapsGeocoding&&i.addSimpleSlice(l.MC.mapControls.geocodingCulture,new v.uY({descriptor:l.MC.mapControls.geocodingCulture,value:e.mapControls.geocodingCulture||Bt.gA}).build())}),r.build()},s.getLayerSettingsCard=function(e,t,a,r){var i=new v.CQ(new v.lg(l.Do.commonDataOptions),"Visual_AzureMapsCommonDataLayer",l.MC.commonDataOptions,r).withDescription("Visual_AzureMapsCommonDataLayerDescription");return e.hasSize&&i.addGroup("values",function(o){o.withDisplayName("Role_DisplayName_Values").addSimpleSlice(l.MC.commonDataOptions.minDataValue,new v.mu({descriptor:l.MC.commonDataOptions.minDataValue,value:t.commonDataOptions.minDataValue,options:{maxValue:{type:1,value:t.commonDataOptions.maxDataValue}}}).build(),function(n){return n.withCustomDisplayName("Aggregate_Min")}).addSimpleSlice(l.MC.commonDataOptions.maxDataValue,new v.mu({descriptor:l.MC.commonDataOptions.maxDataValue,value:t.commonDataOptions.maxDataValue,options:{minValue:{type:0,value:t.commonDataOptions.minDataValue}}}).build(),function(n){return n.withCustomDisplayName("Aggregate_Max")})}),i.addGroup("options",function(o){o.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(l.MC.commonDataOptions.unselectedTransparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.commonDataOptions.unselectedTransparency,value:t.commonDataOptions.unselectedTransparency,localize:r}).build())}),i.build()},s.getLegendCard=function(e,t,a,r){return(0,L.ZF)({legendData:t},e,a,!r.hasSeries)},s.getBubbleCard=function(e,t,a,r,i,o,n){if(e&&e.dataPoints&&0!==e.dataPoints.length&&t){var u=e.hasCategory&&e.hasSeries,c=o.azureMapsLatLongPieCharts&&e.hasDuplicatedLatLong,h=_.omit(l.MC.bubbleLayer,["clusteringEnabled","clusteredBubbleFillColor","clusteredBubbleFontColor","clusteredBubbleFontSize","clusteredBubbleRadius","clusteredBubbleStrokeColor","clusteredBubbleStrokeWidth"]),p=new v.CQ(new v.lg(l.Do.bubbleLayer),"Visual_AzureMapsBubbleLayer",(0,y.__assign)((0,y.__assign)({},h),l.MC.dataPoint),n).withDescription("Visual_BubblesDescription");return p.addTopLevelToggle("show",function(){return new v.bd({descriptor:l.MC.bubbleLayer.show,value:a.bubble.showBubbleLayer}).build()}),p.addGroup("size",function(d){var f;if(d.withDisplayName("Visual_BubbleSize"),e.hasSize){d.addSimpleSlice(l.MC.bubbleLayer.minRadius,new v.JN({descriptor:l.MC.bubbleLayer.minRadius,value:a.bubble.minRadius,options:{minValue:{type:0,value:1},maxValue:{type:1,value:Math.min(50,a.bubble.maxRadius)},unitSymbol:Q.e_},localize:n}).build(),function(w){return w.withCustomDisplayName("Aggregate_Min")}).addSimpleSlice(l.MC.bubbleLayer.maxRadius,new v.JN({descriptor:l.MC.bubbleLayer.maxRadius,value:a.bubble.maxRadius,options:{minValue:{type:0,value:Math.max(1,a.bubble.minRadius)},maxValue:{type:1,value:50},unitSymbol:Q.e_},localize:n}).build(),function(w){return w.withCustomDisplayName("Aggregate_Max")});var g={get:function(D){return n(D)},getOptional:function(D){return n(D)},format:function(D){return n(D)}},b=_.map(ke.Yu,function(w){return(0,y.__assign)((0,y.__assign)({},w),{displayName:w.displayName(g)})}),M=null!==(f=b.find(function(w){return w.value===a.bubble.markerRangeType}))&&void 0!==f?f:{value:ke.Dl.deprecated,displayName:n("Visual_MarkerRangeType_Deprecated")};d.addSimpleSlice(l.MC.bubbleLayer.markerRangeType,new v.uY({descriptor:l.MC.bubbleLayer.markerRangeType,items:b,value:M}).build(),function(w){return w.withCustomDisplayName("Visual_MarkerRangeType")})}else d.addSimpleSlice(l.MC.bubbleLayer.radius,new v.JN({descriptor:l.MC.bubbleLayer.radius,value:a.bubble.radius,options:{minValue:{type:0,value:1},maxValue:{type:1,value:50},unitSymbol:Q.e_},localize:n}).build())}).addGroup("shape",function(d){d.withDisplayName("Visual_Shape").addSimpleSlice(l.MC.bubbleLayer.transparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.bubbleLayer.transparency,value:a.bubble.transparency,localize:n}).build(),function(f){return f.withCustomDisplayName("Transparency")})}).addGroup("colors",function(d){if(d.withDisplayName("Visual_Colors"),e.hasSeries){var f=r(d);(0,Xe.y0)(f)}else{var g=i(d);(0,Xe.jN)(g)}}).addGroup("border",function(d){d.withDisplayName("Visual_Border"),u||d.addSimpleSlice(l.MC.bubbleLayer.autoStrokeColor,new v.bd({descriptor:l.MC.bubbleLayer.autoStrokeColor,value:a.bubble.autoStrokeColor}).build(),function(f){return f.withCustomDisplayName("BuiltInReportThemeHighContrast").withDisabled(c).withCustomDescriptionIf(function(){return c},"Visual_AzureMapsDisabledOptionForPieChartDescription")}),(!a.bubble.autoStrokeColor||u)&&d.addSimpleSlice(l.MC.bubbleLayer.strokeColor,new v.BT({descriptor:l.MC.bubbleLayer.strokeColor,value:{value:a.bubble.strokeColor}}).build(),function(f){return f.withCustomDisplayName("Generic_Color")}),d.addSimpleSlice(l.MC.bubbleLayer.strokeTransparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.bubbleLayer.strokeTransparency,value:a.bubble.strokeTransparency,localize:n}).build(),function(f){return f.withCustomDisplayName("Transparency")}).addSimpleSlice(l.MC.bubbleLayer.strokeWidth,new v.mu({descriptor:l.MC.bubbleLayer.strokeWidth,value:a.bubble.strokeWidth,options:{minValue:{type:0,value:0},maxValue:{type:1,value:20},unitSymbol:Q.e_}}).build(),function(f){return f.withCustomDisplayName("Visual_General_Properties_Width")}),u||d.addSimpleSlice(l.MC.bubbleLayer.blur,new v.JN({descriptor:l.MC.bubbleLayer.blur,value:a.bubble.blur,options:{minValue:{type:0,value:0},maxValue:{type:1,value:100},unitSymbol:Q.e_},localize:n}).build(),function(f){return f.withDisabled(c).withCustomDescriptionIf(function(){return c},"Visual_AzureMapsDisabledOptionForPieChartDescription")})}).addGroup("zoom",function(d){return d.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(l.MC.bubbleLayer.maxZoom,new v.JN({descriptor:l.MC.bubbleLayer.maxZoom,value:a.bubble.maxZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:n}).build(),function(f){return f.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(l.MC.bubbleLayer.minZoom,new v.JN({descriptor:l.MC.bubbleLayer.minZoom,value:a.bubble.minZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:n}).build(),function(f){return f.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(d){d.withDisplayName("Desktop_FileMenu_Options"),u||d.addSimpleSlice(l.MC.bubbleLayer.pitchAlignment,new v.uY({descriptor:l.MC.bubbleLayer.pitchAlignment,value:a.bubble.pitchAlignment}).build(),function(f){return f.withDisabled(c).withCustomDescriptionIf(function(){return c},"Visual_AzureMapsDisabledOptionForPieChartDescription")}),d.addSimpleSlice(l.MC.bubbleLayer.layerPosition,new v.uY({descriptor:l.MC.bubbleLayer.layerPosition,value:a.bubble.layerPosition}).build())}),p.build()}},s.getBubbleClusteringCard=function(e,t,a,r,i){if(r.azureMapsBubbleCluster&&e&&e.dataPoints&&0!==e.dataPoints.length&&t){var o=_.pick(l.MC.bubbleLayer,["clusteringEnabled","clusteredBubbleFillColor","clusteredBubbleFontColor","clusteredBubbleFontSize","clusteredBubbleRadius","clusteredBubbleStrokeColor","clusteredBubbleStrokeWidth"]),n=new v.CQ(new v.lg("bubbleClustering"),"Visual_AzureMapsClusterBubbles",o,i).withDescription("Visual_AzureMapsClusterBubbles_Description");return n.addTopLevelToggle("clusteringEnabled",function(){return new v.bd({descriptor:l.MC.bubbleLayer.clusteringEnabled,value:a.bubble.clusteringEnabled}).build()}).addGroup("size",function(u){u.withDisplayName("Visual_BubbleSize").addSimpleSlice(l.MC.bubbleLayer.clusteredBubbleRadius,new v.JN({descriptor:l.MC.bubbleLayer.clusteredBubbleRadius,value:a.bubble.clusteredBubbleRadius,options:{minValue:{type:0,value:1},maxValue:{type:1,value:50},unitSymbol:Q.e_},localize:i}).build())}).addGroup("colors",function(u){u.withDisplayName("Visual_Colors").addSimpleSlice(l.MC.bubbleLayer.clusteredBubbleFillColor,new v.BT({descriptor:l.MC.bubbleLayer.clusteredBubbleFillColor,value:{value:a.bubble.clusteredBubbleFillColor}}).build())}).addGroup("value",function(u){u.withDisplayName("Role_DisplayName_Values").addSimpleSlice(l.MC.bubbleLayer.clusteredBubbleFontSize,new v.mu({descriptor:l.MC.bubbleLayer.clusteredBubbleFontSize,value:a.bubble.clusteredBubbleFontSize,options:v.JJ}).build()).addSimpleSlice(l.MC.bubbleLayer.clusteredBubbleFontColor,new v.BT({descriptor:l.MC.bubbleLayer.clusteredBubbleFontColor,value:{value:a.bubble.clusteredBubbleFontColor}}).build())}).addGroup("border",function(u){u.withDisplayName("Visual_Border").addSimpleSlice(l.MC.bubbleLayer.clusteredBubbleStrokeColor,new v.BT({descriptor:l.MC.bubbleLayer.clusteredBubbleStrokeColor,value:{value:a.bubble.clusteredBubbleStrokeColor}}).build()).addSimpleSlice(l.MC.bubbleLayer.clusteredBubbleStrokeWidth,new v.mu({descriptor:l.MC.bubbleLayer.clusteredBubbleStrokeWidth,value:a.bubble.clusteredBubbleStrokeWidth,options:{minValue:{type:0,value:0},maxValue:{type:1,value:20},unitSymbol:Q.e_}}).build())}),e.properties.bubble.showBubbleLayer||n.withDisabled(!0,"Visual_AzureMaps_FormatOption_DisabledReason_ClusterBubble"),n.build()}},s.getCategoryLabelCard=function(e,t,a,r,i,o){if(i.azureMapsCategoryLabels&&e&&e.dataPoints&&0!==e.dataPoints.length){var c=l.MC.categoryLabels;return(0,kt.Zu)({cardName:"Visual_CategoryLabels",dataLabelSettings:a,isShowCategory:!1,localize:o,props:c,revertToDefaultProps:c,showBackground:!0,showValueColor:!0,style:r,disabled:!t.bubble.showBubbleLayer,disabledReason:"Visual_AzureMapsCategoryLabelsDisabledReason_BubbleLayerOff"})}},s.getHeatMapCard=function(e,t,a){if(e&&e.dataPoints&&0!==e.dataPoints.length){var r=new v.CQ(new v.lg(l.Do.heatMapLayer),"Visual_HeatMap",l.MC.heatMapLayer,a).withDescription("Visual_HeatMapDescription");return r.addTopLevelToggle("show",function(){return new v.bd({descriptor:l.MC.heatMapLayer.show,value:t.heatMap.showHeatMapLayer}).build()}).addGroup("size",function(i){var o=200;"meters"===t.heatMap.heatMapRadiusUnit&&(o=Lt),i.withDisplayName("Visual_BubbleSize").addSimpleSlice(l.MC.heatMapLayer.heatMapRadius,new v.JN({descriptor:l.MC.heatMapLayer.heatMapRadius,value:t.heatMap.heatMapRadius,options:{minValue:{type:0,value:1},maxValue:{type:1,value:o},unitSymbol:Q.e_},localize:a}).build()).addSimpleSlice(l.MC.heatMapLayer.heatMapRadiusUnit,new v.uY({descriptor:l.MC.heatMapLayer.heatMapRadiusUnit,value:t.heatMap.heatMapRadiusUnit}).build(),function(n){return n.withCustomDisplayName("Visual_DisplayUnits")}).addSimpleSlice(l.MC.heatMapLayer.heatMapIntensity,new v.JN({descriptor:l.MC.heatMapLayer.heatMapIntensity,value:t.heatMap.heatMapIntensity,options:{minValue:{type:0,value:0},maxValue:{type:1,value:5}},localize:a}).build()),e.hasSize&&i.addSimpleSlice(l.MC.heatMapLayer.heatMapUseSize,new v.bd({descriptor:l.MC.heatMapLayer.heatMapUseSize,value:t.heatMap.heatMapUseSize}).build())}).addGroup("colors",function(i){i.withDisplayName("Visual_Colors").addSimpleSlice(l.MC.heatMapLayer.heatMapColorLow,new v.BT({descriptor:l.MC.heatMapLayer.heatMapColorLow,value:{value:t.heatMap.heatMapColorLow}}).build()).addSimpleSlice(l.MC.heatMapLayer.heatMapColorCenter,new v.BT({descriptor:l.MC.heatMapLayer.heatMapColorCenter,value:{value:t.heatMap.heatMapColorCenter}}).build()).addSimpleSlice(l.MC.heatMapLayer.heatMapColorHigh,new v.BT({descriptor:l.MC.heatMapLayer.heatMapColorHigh,value:{value:t.heatMap.heatMapColorHigh}}).build())}).addGroup("zoom",function(i){i.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(l.MC.heatMapLayer.maxZoom,new v.JN({descriptor:l.MC.heatMapLayer.maxZoom,value:t.heatMap.maxZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:a}).build(),function(o){return o.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(l.MC.heatMapLayer.minZoom,new v.JN({descriptor:l.MC.heatMapLayer.minZoom,value:t.heatMap.minZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:a}).build(),function(o){return o.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(i){i.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(l.MC.heatMapLayer.heatMapTransparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.heatMapLayer.heatMapTransparency,value:t.heatMap.heatMapTransparency,localize:a}).build()).addSimpleSlice(l.MC.heatMapLayer.layerPosition,new v.uY({descriptor:l.MC.heatMapLayer.layerPosition,value:t.heatMap.layerPosition}).build())}),e.hasSeries&&r.withDisabled(!0,"Visual_AzureMapsHeatMapFormatOptionDisabledReason"),r.build()}},s.getFilledMapCard=function(e,t,a,r,i,o,n){if(r&&e&&e.dataPoints&&0!==e.dataPoints.length&&t){var u=new v.CQ(new v.lg(l.Do.filledMap),"FilledMap_ToolTip",(0,y.__assign)((0,y.__assign)({},l.MC.filledMap),l.MC.dataPoint),n).withDescription("Visual_AzureMapsFilledMapDescription");return u.addTopLevelToggle("show",function(){return new v.bd({descriptor:l.MC.filledMap.show,value:a.filledMap.showFilledMap}).build()}).addGroup("shape",function(c){c.withDisplayName("Visual_Shape").addSimpleSlice(l.MC.filledMap.transparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.filledMap.transparency,value:a.filledMap.transparency,localize:n}).build())}).addGroup("colors",function(c){if(c.withDisplayName("Visual_Colors"),e.hasSeries){var h=i(c);(0,Xe.y0)(h)}else{var p=o(c);(0,Xe.jN)(p)}}).addGroup("border",function(c){c.withDisplayName("Visual_Border").addSimpleSlice(l.MC.filledMap.strokeColor,new v.BT({descriptor:l.MC.filledMap.strokeColor,value:{value:a.filledMap.strokeColor}}).build(),function(h){return h.withCustomDisplayName("Generic_Color")}).addSimpleSlice(l.MC.filledMap.strokeTransparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.filledMap.strokeTransparency,value:a.filledMap.strokeTransparency,localize:n}).build(),function(h){return h.withCustomDisplayName("Transparency")}).addSimpleSlice(l.MC.filledMap.strokeWidth,new v.mu({descriptor:l.MC.filledMap.strokeWidth,value:a.filledMap.strokeWidth,options:{minValue:{type:0,value:0},maxValue:{type:1,value:20},unitSymbol:Q.e_}}).build(),function(h){return h.withCustomDisplayName("Visual_General_Properties_Width")})}).addGroup("zoom",function(c){c.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(l.MC.filledMap.maxZoom,new v.JN({descriptor:l.MC.filledMap.maxZoom,value:a.filledMap.maxZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:n}).build(),function(h){return h.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(l.MC.filledMap.minZoom,new v.JN({descriptor:l.MC.filledMap.minZoom,value:a.filledMap.minZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:n}).build(),function(h){return h.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(c){c.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(l.MC.filledMap.layerPosition,new v.uY({descriptor:l.MC.filledMap.layerPosition,value:a.filledMap.layerPosition}).build())}),e.hasSize&&u.withDisabled(!0,"Visual_AzureMaps_FormatOption_DisabledReason_FilledMap"),u.build()}},s.getBarChartCard=function(e,t,a,r,i,o){if(e&&e.dataPoints&&0!==e.dataPoints.length&&t){var n=new v.CQ(new v.lg(l.Do.barChart),"Visual_AzureMapsBarChartLayer",(0,y.__assign)((0,y.__assign)({},l.MC.barChart),l.MC.dataPoint),o).withDescription("Visual_AzureMapsBarChartDescription");return n.addTopLevelToggle("show",function(){return new v.bd({descriptor:l.MC.barChart.show,value:a.barChart.dataProperties.showBarChart}).build()}).addGroup("size",function(u){u.withDisplayName("Visual_BubbleSize").addSimpleSlice(l.MC.barChart.height,new v.JN({descriptor:l.MC.barChart.height,value:a.barChart.paintProperties.height,options:{minValue:{type:0,value:0},maxValue:{type:1,value:5},unitSymbol:Q.e_},localize:o}).build()).addSimpleSlice(l.MC.barChart.thickness,new v.JN({descriptor:l.MC.barChart.thickness,value:a.barChart.dataProperties.thickness,options:{minValue:{type:0,value:0},maxValue:{type:1,value:5},unitSymbol:Q.e_},localize:o}).build()).addSimpleSlice(l.MC.barChart.scaleHeightOnZoom,new v.bd({descriptor:l.MC.barChart.scaleHeightOnZoom,value:a.barChart.paintProperties.scaleHeightOnZoom}).build()).addSimpleSlice(l.MC.barChart.scaleThicknessOnZoom,new v.bd({descriptor:l.MC.barChart.scaleThicknessOnZoom,value:a.barChart.dataProperties.scaleThicknessOnZoom}).build())}).addGroup("shape",function(u){u.withDisplayName("Visual_Shape").addSimpleSlice(l.MC.barChart.barShape,new v.uY({descriptor:l.MC.barChart.barShape,value:a.barChart.dataProperties.barShape}).build(),function(c){return c.withCustomDisplayName("Style")}).addSimpleSlice(l.MC.barChart.transparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.barChart.transparency,value:a.barChart.paintProperties.transparency,localize:o}).build())}).addGroup("colors",function(u){if(u.withDisplayName("Visual_Colors"),e.hasSeries){var c=r(u);(0,Xe.y0)(c)}else{var h=i(u);(0,Xe.jN)(h)}}).addGroup("zoom",function(u){u.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(l.MC.barChart.maxZoom,new v.JN({descriptor:l.MC.barChart.maxZoom,value:a.barChart.paintProperties.maxZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:o}).build(),function(c){return c.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(l.MC.barChart.minZoom,new v.JN({descriptor:l.MC.barChart.minZoom,value:a.barChart.paintProperties.minZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:o}).build(),function(c){return c.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(u){u.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(l.MC.barChart.layerPosition,new v.uY({descriptor:l.MC.barChart.layerPosition,value:a.barChart.paintProperties.layerPosition}).build())}),n.build()}},s.getReferenceLayerCard=function(e,t,a){var r=new v.CQ(new v.lg(l.Do.referenceLayer),"Visual_AzureMapsReferenceLayer",(0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)([],Object.values(l.MC.referenceLayer),!0),Object.values(l.MC.referenceLayerLine),!0),Object.values(l.MC.referenceLayerPolygon),!0),Object.values(l.MC.referenceLayerBubble),!0),a);return r.withDescription(t.azureMapsMultiDataFormats?"Visual_AzureMapsReferenceLayerDescriptionMultiDataFormats":"Visual_AzureMapsReferenceLayerDescription"),r.addGroup(t.azureMapsCustomFormattingReferenceLayer?l.DQ.dataSource:l.Do.referenceLayer,function(o){if(t.azureMapsCustomFormattingReferenceLayer&&o.withDisplayName("Data_Source"),t.azureMapsMultiDataFormats)if(o.addSimpleSlice(l.MC.referenceLayer.datasourceType,new v.uY({descriptor:l.MC.referenceLayer.datasourceType,value:e.referenceLayer.datasourceType}).build()),"url"===e.referenceLayer.datasourceType){var n=t.azureMapsDynamicReferenceLayer?(0,y.__assign)((0,y.__assign)({},l.MC.referenceLayer.referenceLayerUrl),{instanceKind:3}):l.MC.referenceLayer.referenceLayerUrl;o.addSimpleSlice(l.MC.referenceLayer.referenceLayerUrl,new v.fq({descriptor:n,value:e.referenceLayer.referenceLayerUrl,placeholder:""}).build())}else"file_upload"===e.referenceLayer.datasourceType&&o.addSimpleSlice(l.MC.referenceLayer.additionalDatasource,new v.vX({descriptor:l.MC.referenceLayer.additionalDatasource,value:e.referenceLayer.additionalDatasource,isAzMapReferenceSelector:!0,enableMultipleDataFormats:t.azureMapsMultiDataFormats,keepIconURLs:t.azureMapsMultiDataFormatsKeepIconURLs}).build());else o.addSimpleSlice(l.MC.referenceLayer.additionalDatasource,new v.vX({descriptor:l.MC.referenceLayer.additionalDatasource,value:e.referenceLayer.additionalDatasource,isAzMapReferenceSelector:!0}).build())}),t.azureMapsCustomFormattingReferenceLayer&&r.addGroup(l.DQ.point,function(o){return o.withDisplayName("Visual_Forecast_Units_Point").withDescription("AzureMapVisual_ReferenceLayer_Style_Message").addSimpleSlice(l.MC.referenceLayerBubble.fillColor,new v.BT({descriptor:l.MC.referenceLayerBubble.fillColor,value:{value:e.referenceLayer.bubble.fillColor}}).build()).addSlices((0,Qe.Iq)({containerItemBuilder:o,descriptors:l.MC.referenceLayerBubble,strokeData:e.referenceLayer.bubble,selector:null,maxWidth:20,localize:a}).map(function(n){return n.build()}))}).addGroup(l.DQ.line,function(o){return o.withDisplayName("Visual_Lines").withDescription("AzureMapVisual_ReferenceLayer_Style_Message").addSlices((0,Qe.Iq)({containerItemBuilder:o,descriptors:l.MC.referenceLayerLine,strokeData:e.referenceLayer.line,selector:null,maxWidth:20,localize:a}).map(function(n){return n.build()}))}).addGroup(l.DQ.polygon,function(o){return o.withDisplayName("AzureMapVisual_Polygons").withDescription("AzureMapVisual_ReferenceLayer_Style_Message").addSimpleSlice(l.MC.referenceLayerPolygon.fillColor,new v.BT({descriptor:l.MC.referenceLayerPolygon.fillColor,value:{value:e.referenceLayer.polygon.fillColor}}).build()).addSlices((0,Qe.Iq)({containerItemBuilder:o,descriptors:l.MC.referenceLayerPolygon,strokeData:e.referenceLayer.polygon,selector:null,maxWidth:20,localize:a}).map(function(n){return n.build()}))}),r.build()},s.getTrafficCard=function(e,t){var a=new v.CQ(new v.lg(l.Do.traffic),"Visual_AzureMapsTrafficLayer",l.MC.traffic,t).withDescription("Visual_AzureMapsTrafficLayerDescription");return a.addTopLevelToggle("show",function(){return new v.bd({descriptor:l.MC.traffic.showTraffic,value:e.traffic.showTraffic}).build()}).addGroup(l.Do.traffic,function(r){r.addSimpleSlice(l.MC.traffic.showIncidents,new v.bd({descriptor:l.MC.traffic.showIncidents,value:e.traffic.showIncidents}).build()),r.addSimpleSlice(l.MC.traffic.showTrafficControl,new v.bd({descriptor:l.MC.traffic.showTrafficControl,value:e.traffic.showTrafficControl}).build())}),a.build()},s.getTileLayerCard=function(e,t){var a=new v.CQ(new v.lg(l.Do.tileLayer),"Visual_AzureMapsTileLayer",l.MC.tileLayer,t).withDescription("Visual_AzureMapsTileLayerDescription");return a.addGroup("tile",function(r){r.withDisplayName("Tile_Generic").addSimpleSlice(l.MC.tileLayer.tileLayerUrl,new v.fq({descriptor:l.MC.tileLayer.tileLayerUrl,value:e.tile.tileLayerUrl,placeholder:""}).build()).addSimpleSlice(l.MC.tileLayer.tileSize,new v.mu({descriptor:l.MC.tileLayer.tileSize,value:e.tile.tileSize,options:{minValue:{type:0,value:128},maxValue:{type:1,value:5e3},unitSymbol:Q.e_}}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))})}).addGroup("view",function(r){r.withDisplayName("View").addSimpleSlice(l.MC.tileLayer.northBounds,new v.mu({descriptor:l.MC.tileLayer.northBounds,value:e.tile.northBounds,options:{minValue:{type:0,value:-90},maxValue:{type:1,value:90},unitSymbol:Q.g}}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))}).addSimpleSlice(l.MC.tileLayer.southBounds,new v.mu({descriptor:l.MC.tileLayer.southBounds,value:e.tile.southBounds,options:{minValue:{type:0,value:-90},maxValue:{type:1,value:90},unitSymbol:Q.g}}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))}).addSimpleSlice(l.MC.tileLayer.eastBounds,new v.mu({descriptor:l.MC.tileLayer.eastBounds,value:e.tile.eastBounds,options:{minValue:{type:0,value:Ue},maxValue:{type:1,value:180},unitSymbol:Q.g}}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))}).addSimpleSlice(l.MC.tileLayer.westBounds,new v.mu({descriptor:l.MC.tileLayer.westBounds,value:e.tile.westBounds,options:{minValue:{type:0,value:Ue},maxValue:{type:1,value:180},unitSymbol:Q.g}}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))})}).addGroup("zoom",function(r){r.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(l.MC.tileLayer.maxZoom,new v.JN({descriptor:l.MC.tileLayer.maxZoom,value:e.tile.maxZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:t}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl)).withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(l.MC.tileLayer.minZoom,new v.JN({descriptor:l.MC.tileLayer.minZoom,value:e.tile.minZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:G}},localize:t}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl)).withCustomDisplayName("Aggregate_Min")})}).addGroup("operations",function(r){r.withDisplayName("Visual_AzureMapsOperations").addSimpleSlice(l.MC.tileLayer.transparency,v.JN.getTransparencySliderBuilder({descriptor:l.MC.tileLayer.transparency,value:e.tile.transparency,localize:t}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))}).addSimpleSlice(l.MC.tileLayer.isTMS,new v.bd({descriptor:l.MC.tileLayer.isTMS,value:e.tile.isTMS}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))}).addSimpleSlice(l.MC.tileLayer.layerPosition,new v.uY({descriptor:l.MC.tileLayer.layerPosition,value:e.tile.layerPosition}).build(),function(i){return i.withDisabled((0,Be.g)(e.tile.tileLayerUrl))})}),a.build()},s}(),nr=function(){function s(e){this.rootElement=e}return s.prototype.display=function(){null==this.container&&(this.container=jQuery('<div class="azureMapSplashDiv"><div class="azureMapsSplash" aria-live="polite"><div class="azureMapsSplashLogo"></div></div></div>'),this.rootElement.prepend(this.container))},s.prototype.remove=function(){this.container&&(this.container.remove(),this.container=null)},s}(),ga=B(5381),sr=B(63972),va=B(32041),lr=B(9795),Rt=B(52967),zt=function(){function s(e,t){this._options=new ya,this._datasource=e;var a=_.merge(_.cloneDeep(this._options),_.cloneDeep(t));this.setLayers(a),this.setOptions(a)}return s.prototype.setLayers=function(e){var a=e.style,r=e.unselectedTransparency;this._layers={bubbleLayer:new atlas.layer.BubbleLayer(this._datasource,null,(0,y.__assign)({filter:["all",["!",["has","image"]],["any",["==",["geometry-type"],"Point"],["==",["geometry-type"],"MultiPoint"]]],radius:["case",["has","size"],["*",["get","size"],4],["has","marker-size"],["match",["get","marker-size"],"small",6,"medium",8,"large",12,1],["has","scale"],["*",["get","scale"],4],4],color:s.bubbleFillColorExp(e.bubble.fillColor,a),opacity:s.getFillOpacityExp(e.bubble.fillOpacity,r)},s.getStrokeExpression(e.bubble,r,a,!0))),extrudedPolygonLayer:new atlas.layer.PolygonExtrusionLayer(this._datasource,null,{base:["case",["has","base"],["get","base"],0],fillColor:["case",["has","fillColor"],["get","fillColor"],["has","fill"],["get","fill"],"#1e90ff"],filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["all",["has","height"],["!=",["get","height"],0]]],height:["get","height"]}),polygonBorderLayer:new atlas.layer.LineLayer(this._datasource,null,(0,y.__assign)({filter:["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},s.getStrokeExpression(e.polygon,r,a))),lineLayer:new atlas.layer.LineLayer(this._datasource,null,(0,y.__assign)({filter:["any",["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"]]},s.getStrokeExpression(e.line,r,a))),polygonLayer:new atlas.layer.PolygonLayer(this._datasource,null,{fillColor:s.polygonFillColorExp(e.polygon.fillColor,a),fillOpacity:s.getFillOpacityExp(e.polygon.fillOpacity,r),filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["any",["!",["has","height"]],["==",["get","height"],0]]]}),symbolLayer:new atlas.layer.SymbolLayer(this._datasource,null,{filter:["all",["any",["==",["geometry-type"],"Point"],["==",["geometry-type"],"MultiPoint"]]],iconOptions:{allowOverlap:!0,anchor:["case",["has","anchor"],["match",["get","anchor"],["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],["get","anchor"],"bottom"],"bottom"],ignorePlacement:!0,image:["case",["has","image"],["get","image"],"none"],offset:["case",["has","offset"],["get","offset"],["literal",[0,0]]],rotation:["case",["has","rotation"],["get","rotation"],0],size:["case",["has","size"],["get","size"],["has","marker-size"],["match",["get","marker-size"],"small",.5,"medium",1,"large",2,1],1]},textOptions:{offset:["case",["has","image"],["literal",[0,1.2]],["literal",[0,2]]]}})}},s.prototype.getLayers=function(){var e=this,t=[];return Object.keys(this._layers).forEach(function(a){t.push(e._layers[a])}),t},s.prototype.setOptions=function(e){var t=this,a=e.style,r=e.unselectedTransparency;this._options.allowExtrusions!==e.allowExtrusions&&(e.allowExtrusions?(this._layers.extrudedPolygonLayer.setOptions({filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["all",["has","height"],["!=",["get","height"],0]]],visible:this._options.visible}),this._layers.polygonLayer.setOptions({filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["any",["!",["has","height"]],["==",["get","height"],0]]]})):(this._layers.extrudedPolygonLayer.setOptions({visible:!1}),this._layers.polygonLayer.setOptions({filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]]})));var i=function(n,u,c,h){var p=s.getStrokeExpression(u,r,a,h);n.strokeColor!==u.strokeColor&&c.setOptions({strokeColor:p.strokeColor}),n.strokeWidth!==u.strokeWidth&&c.setOptions({strokeWidth:p.strokeWidth}),(n.strokeTransparency!==u.strokeTransparency||t._options.unselectedTransparency!==r)&&c.setOptions({strokeOpacity:p.strokeOpacity})};i(this._options.bubble,e.bubble,this._layers.bubbleLayer,!0),i(this._options.line,e.line,this._layers.lineLayer),i(this._options.polygon,e.polygon,this._layers.polygonBorderLayer),this._options.bubble.fillColor!==e.bubble.fillColor&&this._layers.bubbleLayer.setOptions({color:s.bubbleFillColorExp(e.bubble.fillColor,a)}),this._options.polygon.fillColor!==e.polygon.fillColor&&this._layers.polygonLayer.setOptions({fillColor:s.polygonFillColorExp(e.polygon.fillColor,a)}),this._options.unselectedTransparency!==r&&(this._layers.bubbleLayer.setOptions({opacity:s.getFillOpacityExp(e.bubble.fillOpacity,r)}),this._layers.polygonLayer.setOptions({fillOpacity:s.getFillOpacityExp(e.polygon.fillOpacity,r)})),this._options.visible!==e.visible&&(this._layers.polygonBorderLayer.setOptions({visible:e.visible}),this._layers.polygonLayer.setOptions({visible:e.visible}),this._layers.lineLayer.setOptions({visible:e.visible}),this._layers.extrudedPolygonLayer.setOptions({visible:e.visible&&e.allowExtrusions}),this._layers.bubbleLayer.setOptions({visible:e.visible}),this._layers.symbolLayer.setOptions({visible:e.visible})),this._options=e},s.prototype.onAdd=function(e){e.layers.add([this._layers.polygonLayer,this._layers.polygonBorderLayer,this._layers.lineLayer,this._layers.extrudedPolygonLayer],"labels"),e.layers.add([this._layers.bubbleLayer,this._layers.symbolLayer])},s.getStrokeExpression=function(e,t,a,r){var i=a?.isHighContrast?de.v.getThemeColor(a,me.U):e.strokeColor;return{strokeColor:r?i:["case",["has","strokeColor"],["get","strokeColor"],["has","stroke"],["get","stroke"],i],strokeOpacity:["case",J.getSelectionFilter(!0),(0,V.TD)(e.strokeTransparency),J.getSelectionFilter(!1),(0,V.TD)(t),["has","strokeOpacity"],["get","strokeOpacity"],["has","stroke-opacity"],["get","stroke-opacity"],(0,V.TD)(e.strokeTransparency)],strokeWidth:["case",["has","strokeWidth"],["get","strokeWidth"],["has","stroke-width"],["get","stroke-width"],["has","stroke-thickness"],["get","stroke-thickness"],e.strokeWidth],lineCap:"none"===e.strokeDashCap?"butt":e.strokeDashCap,lineJoin:e.strokeLineJoin}},s.getFillOpacityExp=function(e,t){return["case",J.getSelectionFilter(!0),e,J.getSelectionFilter(!1),(0,V.TD)(t),["has","fillOpacity"],["get","fillOpacity"],["has","fill-opacity"],["get","fill-opacity"],e]},s.bubbleFillColorExp=function(e,t){return["case",["has","color"],["get","color"],["has","marker-color"],["get","marker-color"],e=t?.isHighContrast?de.v.getThemeColor(t,me.fA):e]},s.polygonFillColorExp=function(e,t){return["case",["has","fillColor"],["get","fillColor"],["has","fill"],["get","fill"],e=t?.isHighContrast?de.v.getThemeColor(t,me.fA):e]},s}(),ur=function(){function s(e,t){this.setShapes(e),this.setDataPoints(t),this.createShapeDataMappings()}return s.prototype.getDataPointFromShape=function(e){var t=this.getShapePropValue(e,this.shapePropName);if(t)return this.shapeToData[t]},s.prototype.getShapesFromDataPoint=function(e){var t=e.categoryValue;if(t)return this.categoryToShapes[t]},s.prototype.countShapeProps=function(e){var t={};return e.forEach(function(r){for(var i in r.properties)t.hasOwnProperty(i)?t[i]++:t[i]=1}),Object.entries(t).map(function(r){return{propName:r[0],count:r[1]}})},s.prototype.getShapePropValue=function(e,t){var a,r=null===(a=e?.properties)||void 0===a?void 0:a[t];if("string"==typeof r)return r},s.prototype.getShapes=function(){return this.shapes},s.prototype.setShapes=function(e){this.shapes=e},s.prototype.setDataPoints=function(e){this.dataPoints=e},s.prototype.clearMappings=function(){this.shapes=[],this.dataPoints=[],this.shapeToData={},this.categoryToShapes={}},s.prototype.matchShapesToDataPoints=function(e){var t=0;e:for(var a=0,r=this.shapeProps;a<r.length;a++){var i=r[a];if(t>i.count)break e;for(var o=0,n=new Map,u=new Map,c=(0,y.__spreadArray)([],this.shapes,!0),h=c.length-1;h>=0;h--){var p=c[h],d=this.getShapePropValue(p,i.propName);if(d||0===d){var f=d.toString().toLowerCase(),g=e.get(f);if(g&&(n.has(g.categoryValue)||n.set(g.categoryValue,[]),n.get(g.categoryValue).push(p),u.set(d,g),c.splice(h,1),o++),0===c.length||0===e.size){t=o,this.shapePropName=i.propName,this.shapeToData=Object.fromEntries(u),this.categoryToShapes=Object.fromEntries(n);break e}}}o>t&&(t=o,this.shapePropName=i.propName,this.shapeToData=Object.fromEntries(u),this.categoryToShapes=Object.fromEntries(n))}},s.prototype.createShapeDataMappings=function(){this.shapeProps=this.countShapeProps(this.shapes),this.shapeProps=this.shapeProps.sort(function(t,a){return a.count-t.count});var e=this.dataPoints.reduce(function(t,a){return a.categoryValue&&t.set(a.categoryValue.toLowerCase(),a),t},new Map);this.matchShapesToDataPoints(e)},s}(),ma=function(){function s(e,t,a){var r=this;this.mapStyleChanged=function(){if(_.startsWith(r.map.getStyle().style.toLowerCase(),"blank"))r.observer||(r.onBackgroundChange(),r.observer=new MutationObserver(r.onBackgroundChange),r.observer.observe(r.map.getMapContainer(),{attributes:!0,attributeFilter:["style"]}));else{r.observer&&(r.observer.disconnect(),delete r.observer);var i="light";["satellite","satellite_road_labels","grayscale_dark","night"].indexOf(r.map.getStyle().style)>-1&&(i="dark"),r.setTheme(i)}},this.onBackgroundChange=function(){var o="light";switch(r.map.getStyle().style){case"satellite":case"satellite_road_labels":case"grayscale_dark":case"night":o="dark"}r.setTheme(o)},this.container=e,this.map=t,this.style=a,"auto"===a?(this.mapStyleChanged(),this.map.events.add("styledata",this.mapStyleChanged)):e.classList.add(a)}return s.prototype.dispose=function(){var e=this;this.container&&(this.container=null),this.updateMap(null),Object.keys(this).forEach(function(t){e[t]=null})},s.prototype.updateMap=function(e){this.map&&"auto"===this.style&&this.map.events.remove("styledata",this.mapStyleChanged),this.map=e,e&&"auto"===this.style&&e.events.add("styledata",this.mapStyleChanged)},s.prototype.setTheme=function(e){this.theme!==e&&(this.container.classList.remove(this.theme),this.container.classList.add(e),this.theme=e)},s}(),cr=B(65302),ba="routeRangeDataSource";function vr(s){return"getSource"in s}var mr=function(){function s(e,t,a,r,i,o){var n=this;this.mapControl=e,this.host=t,this.featureSwitches=a,this.behavior=r,this.style=i,this.isTouchEvent=o,this.svgMarkers={},this.markerIdentityKeyLastHovered=null,this.viewportSize={width:0,height:0},this.clickPieState=null,this.mapControlMoved=function(){n.drawDataLabels()},this.shouldUseLegacyFormat=function(){return n.data.properties.bubble.markerRangeType===ke.Dl.deprecated},this.showTooltip=function(u,c){n.tooltipService&&n.tooltipService.show({coordinates:u,isTouchEvent:n.isTouchEvent,dataItems:c.tooltipInfo,identities:c.identity?[c.identity.getSelectorsByColumn()]:[]})},this.hideTooltip=function(){n.tooltipService&&n.tooltipService.hide({isTouchEvent:n.isTouchEvent,immediately:!1})},this.zoomChanged=function(){n.mapControl&&n.lastDataZoom!==Math.round(n.mapControl.getCamera().zoom)&&(n.lastDataZoom=Math.round(n.mapControl.getCamera().zoom),n.data.properties.barChart.dataProperties.showBarChart&&n.updateFeatures())},this.updateFeatures=function(){var u,c,h,p,d,f,g;n.featureSwitches.azureMapsDataBoundReferenceLayer&&n.referenceDataMatcher&&(n.referenceDataMatcher.setDataPoints(n.data.dataPoints),n.referenceDataMatcher.createShapeDataMappings());var b=n.getFeatureMapping();n.updateFeatureDataSource(n.bubbleDataSource,b.bubble),n.updateFeatureDataSource(n.barChart3DDataSource,b.barChart3D),n.updateFeatureDataSource(n.filledMapDataSource,b.filledMap),n.updateFeatureDataSource(n.heatMapDataSource,b.heatMap),n.featureSwitches.azureMapsDataBoundReferenceLayer&&n.updateFeatureDataSource(n.referenceDataSource,b.reference),n.features=(0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)((0,y.__spreadArray)([],null!==(u=b.bubble)&&void 0!==u?u:[],!0),null!==(c=b.barChart3D)&&void 0!==c?c:[],!0),null!==(h=b.filledMap)&&void 0!==h?h:[],!0),null!==(p=b.heatMap)&&void 0!==p?p:[],!0),null!==(d=b.reference)&&void 0!==d?d:[],!0),null===(g=null===(f=n.behavior)||void 0===f?void 0:f.renderSelection)||void 0===g||g.call(f,n.behavior.visualHasSelection())},this.disableControlsDefaultEvent=function(u){u.stopPropagation()},this.updateOutlinesFromSubSelections=function(u){var c=u.visualObjects[0].objectName,h=u.visualObjects[0].selectorsByColumn,p=n.data.series.findIndex(function(N){return(0,Pt.Ic)(N.identity.getSelectorsByColumn(),h)});if("bubbles"!==c.split("-")[0])return[];var f=-1!==p?n.data.dataPoints.filter(function(N){return N.subDataPoints[0].seriesIndex===p}):n.data.dataPoints,b=n.bubbleLayer.getOptions().radius,M=n.mapControl.getCamera(),w=n.shouldUseLegacyFormat(),D=n.data.properties.bubble.strokeWidth;return n.subSelectionRegionOutlineFragment={id:c,outline:{type:0,outlines:f.filter(function(N){return N.location}).map(function(N){var W=n.mapControl.getMapContainer().getBoundingClientRect(),T=W.width/n.viewportSize.width,P=(w?J.LEGACY_evaluateRadiusExpression(b,M.zoom,N.subDataPoints[0].size)+D:(N.bubbleRadius||0)+D)*T,E=n.mapControl.positionsToPixels([[N.location.longitude,N.location.latitude]])[0].map(function(U){return U*T});return{type:1,x:W.x+E[0]-P,y:W.y+E[1]-P,width:2*P,height:2*P}})}},[n.subSelectionRegionOutlineFragment]},this.clearLastHoverMarker=function(){n.markerIdentityKeyLastHovered&&n.svgMarkers[n.markerIdentityKeyLastHovered]&&n.mapControl.markers.remove(n.svgMarkers[n.markerIdentityKeyLastHovered])},this.handleMousemoveOnPie=function(u){if(n.formatMode)return n.clearLastHoverMarker(),void(n.markerIdentityKeyLastHovered=null);n.mapControl.getCanvasContainer().style.cursor="pointer";var c=u&&_.find(u.shapes,function(g){return g&&g.getProperties}),h=c&&s.getFirstIdentityKey(c);if(void 0!==h&&n.markerIdentityKeyLastHovered!==h){n.clearLastHoverMarker(),n.markerIdentityKeyLastHovered=h;var p=n.data.dataPoints.filter(function(g){return g.subDataPoints[0].identity.getKey()===h})[0],d=n.svgMarkers[h];n.mapControl.markers.add(d),d.getElement().querySelectorAll("circle, path").forEach(function(g,b){n.tooltipService&&(g.onmouseover=function(M){n.tooltipService.show({coordinates:[M.x,M.y],isTouchEvent:n.isTouchEvent,dataItems:p.subDataPoints[b].tooltipInfo,identities:p.subDataPoints[b].identity?[p.subDataPoints[b].identity.getSelectorsByColumn()]:[]})}),g.onclick=g.oncontextmenu=function(M){n.clickPieState={idx:b,dataPointHovered:p,event:M}}})}},this.tooltipService=t.tooltips(),this.pieFactory=new wt(e.imageSprite)}return Object.defineProperty(s.prototype,"bubbleDataSource",{get:function(){return this.mapControl.sources.getById(xe)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"heatMapDataSource",{get:function(){return this.mapControl.sources.getById($e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"filledMapDataSource",{get:function(){return this.mapControl.sources.getById(Ke)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"barChart3DDataSource",{get:function(){return this.mapControl.sources.getById(je)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"referenceDataSource",{get:function(){return this.mapControl.sources.getById(Dt)},enumerable:!1,configurable:!0}),s.prototype.setupMap=function(e,t){var a=this;this.createDataSource(xe,{promoteId:"_azureMapsShapeId",clusterProperties:{_azureMapsShapeId:[["slice",["concat",["accumulated"],["get","_azureMapsShapeId"]],0,72],["get","_azureMapsShapeId"]],selected:["any",["get","selected"]]}}),this.createDataSource($e),this.createDataSource(Ke,{tolerance:1}),this.createDataSource(je,{tolerance:1}),this.createDataSource(Dt,{tolerance:1}),this.trafficControl=this.createTrafficControl(),this.styleControl=new atlas.control.StyleControl({mapStyles:"all",layout:"list"}),this.pitchControl=new atlas.control.PitchControl,this.compassControl=new atlas.control.CompassControl,this.zoomControl=new atlas.control.ZoomControl,this.selectionControl=t||function(s,e){var t,r;(r=t||(t={})).circle="circle",r.rectangle="rectangle",r.polygon="polygon",r.routeRange="routeRange";var a=function(r){function i(o,n){var u=r.call(this)||this;return u.options={style:"light",selectionModes:"all",fillColor:"#F2C811",fillOpacity:.5,strokeColor:"#F2C811",strokeWidth:1,persistSearchArea:!1,routeRangeMinMapSize:[325,200],routeRangeOptions:{}},u.hasMouse=!1,u.hasFocus=!1,u.copyDrawnShape=function(c){u.rangeDataSource.setShapes([new atlas.Shape(new atlas.data.Polygon(c.getCoordinates()))])},u.displayRangePolygon=function(c){u.rangeDataSource.setShapes([c])},u.searchArea=function(c){u.clear();var h=u.options.sourceIds;if(h&&c){var p=h.reduce(function(f,g){return(0,y.__spreadArray)((0,y.__spreadArray)([],f,!0),u.map.sources.getById(g).getShapes(),!0)},[]),d=la.shapesWithinPolygon(p,c);u._invokeEvent("dataSelected",d)}u.drawingManager.setOptions({mode:atlas.drawing.DrawingMode.idle})},u.mapResized=function(){var c=u.options.routeRangeMinMapSize,h=u.map.getMapContainer().getBoundingClientRect();u.routeRangeBtn.css("display",h.width>=c[0]&&h.height>=c[1]?"":"none")},u.host=o,u.options=(0,y.__assign)((0,y.__assign)({},u.options),n||{}),u}return(0,y.__extends)(i,r),Object.defineProperty(i.prototype,"rangeDataSource",{get:function(){var n;return null===(n=this.map)||void 0===n?void 0:n.sources.getById(ba)},enumerable:!1,configurable:!0}),i.prototype.getContainer=function(){return this.container.get(0)},i.prototype.clear=function(){this.drawingManager&&this.drawingManager.getSource().clear(),this.rangeDataSource&&this.rangeDataSource.clear()},i.prototype.dispose=function(){var o=this;this.map&&this.map.controls.remove(this),this.styler&&this.styler.dispose(),Object.keys(this).forEach(function(n){o[n]=null})},i.prototype.getDrawingManager=function(){return this.drawingManager},i.prototype.getOptions=function(){return(0,y.__assign)({},this.options)},i.prototype.onAdd=function(o,n){this.position=n&&n.position?n.position:"non-fixed",this.map=o;var u=this.options,c=new atlas.drawing.DrawingManager(o);this.drawingManager=c,o.events.add("drawingcomplete",c,this.searchArea),o.events.add("drawingchanged",c,this.copyDrawnShape);var h=c.getLayers();h.polygonLayer.setOptions({fillColor:u.fillColor,fillOpacity:u.fillOpacity});var p={strokeColor:u.strokeColor,strokeWidth:u.strokeWidth};return h.polygonOutlineLayer.setOptions(p),h.lineLayer.setOptions(p),o.sources.add(new atlas.source.DataSource(ba,{buffer:512})),this.rangeLayers=[new atlas.layer.PolygonLayer(this.rangeDataSource,"polygonRangeLayer",h.polygonLayer.getOptions()),new atlas.layer.LineLayer(this.rangeDataSource,"lineRangeLayer",h.lineLayer.getOptions())],this.map.layers.add(this.rangeLayers,"transit"),this.createContainer(),this.styler&&this.styler.dispose(),this.styler=new ma(this.container.get(0),o,u.style||"light"),this.container.get(0)},i.prototype.onRemove=function(){this.clear(),this.container&&(this.container.remove(),this.container=null),this.map&&(this.rangeControl&&(this.map.events.remove("showRange",this.rangeControl,this.displayRangePolygon),this.map.events.remove("rangeCalculated",this.rangeControl,this.searchArea),this.map.controls.remove(this.rangeControl),this.rangeControl=null),this.map.events.remove("resize",this.mapResized),this.drawingManager&&this.map.events.remove("drawingchanged",this.drawingManager,this.copyDrawnShape),this.rangeLayers&&(this.map.layers.remove(this.rangeLayers),this.rangeLayers=null),this.map.sources.remove(this.rangeDataSource)),this.styler.updateMap(null),this.drawingManager&&(this.drawingManager.dispose(),this.drawingManager=null),this.map=null},i.prototype.createContainer=function(){var o=this,n=this.options,u=i.css,c="selectionControl";this.container=jQuery('<div class="azure-maps-control-container" alt="'.concat(c,'" title="').concat(c,'"></div>'));var h=jQuery('<div class="sub-container '.concat(u.hidden,'" alt="selectionModes" title="selectionModes"></div>')),p=Object.keys(t);Array.isArray(n.selectionModes)&&(p=n.selectionModes),p.forEach(function(M){var w=o.buildSelectModeBtn(M);h.append(w),"routeRange"===M&&(o.routeRangeBtn=w)}),this.container.on("mouseover",function(){o.hasMouse=!0,o.container.addClass(u.inUse),h.removeClass(u.hidden)}),this.container.on("focusin",function(){o.hasFocus=!0,o.container.addClass(u.inUse),h.removeClass(u.hidden)}),this.container.on("mouseleave",function(){o.hasMouse=!1,o.hasFocus||(o.container.removeClass(u.inUse),h.addClass(u.hidden))}),this.container.on("focusout",function(M){M.relatedTarget instanceof Node&&o.container.get(0).contains(M.relatedTarget)||(o.hasFocus=!1,o.hasMouse||(o.container.removeClass(u.inUse),h.addClass(u.hidden)))});var d=this.host.getLocalizedString("Visual_AzureMapsSelectionControlMode"),f=jQuery('<button type="button" class="'.concat(u.button,' pointer-selection" alt="').concat(d,'" title="').concat(d,'"></button>'));f.on("click",function(){o.clear()}),!n||"top-right"!==this.position&&"bottom-right"!==this.position?(this.container.append(f),this.container.append(h)):(this.container.append(h),this.container.append(f));var g={isVisible:!1,markerOptions:{color:this.options.fillColor},style:n.style||"light",collapsible:!0,calculateOnMarkerMove:!1};n.routeRangeOptions&&(n.routeRangeOptions.markerOptions&&(n.routeRangeOptions.markerOptions=(0,y.__assign)((0,y.__assign)({},g.markerOptions),n.routeRangeOptions.markerOptions)),g=(0,y.__assign)((0,y.__assign)({},g),n.routeRangeOptions));var b=function(s,e){return new(function(a){function r(i,o){var n=a.call(this)||this;return n.options={markerOptions:{color:"#F2C811",secondaryColor:"#011C2C",htmlContent:'<svg xmlns="http://www.w3.org/2000/svg" style="cursor:move" width="28px" height="39px" viewBox="-1 -1 27 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:2"/><g style="transform:scale(0.2);transform-origin: 13% 10%;"><path d="m50 38h-4v14c0 0 0 1 0 1l9 9 2-2-9-9v-13z" fill="{secondaryColor}" stroke="{secondaryColor}" stroke-width="2px"/><path d="m48 81c-15 0-28-12-28-28s12-28 28-28 28 12 28 28-12 28-28 28zm23-52 3-3c1-1 1-3-0-4-1-1-3-1-4-0l-3 3c-4-3-10-5-16-5v-4h9v-6h-24v6h9v4c-15 1-28 13-30 29s7 31 22 36 31-0 40-14 6-31-5-42z" fill="{secondaryColor}" stroke="{secondaryColor}" stroke-width="2px"/></g></svg>'},style:"light",isVisible:!0,position:"right",collapsible:!1,calculateOnMarkerMove:!0},n.markerMoveSearchDelay=600,n.arrowKeyOffset=5,n.showOptionsDelay=0,n.settings={},n.displayPropertyName="display",n.createContainer=function(){n.container=jQuery('<div aria-label="'.concat(n.resource.routeRangeDescription,'" tabindex="-1" class="azure-maps-control-container atlas-route-range-container light ').concat(n.options.position,'">')),n.container.css(n.displayPropertyName,n.options.isVisible?"":"none"),n.container.addClass("themeableElement"),n.container.on("keydown",n.onContainerKeyDown);var u=jQuery('<div class="atlas-route-range-header"/>'),c=jQuery('<div class="atlas-route-range-title">'.concat(n.resource.title,"</div>")),h=jQuery('<button aria-label="'.concat(n.resource.close,'"  class="closeIcon glyphicon pbi-glyph-close glyph-mini atlas-route-range-close-icon" alt="').concat(n.resource.closeDialog,'" title="').concat(n.resource.closeDialog,'"></button>'));h.on("click",n.onCancel),u.append(c),u.append(h),n.container.append(u);var p=jQuery('<div class="atlas-route-range-instructions">'.concat(n.resource.selectOrigin,"</div>"));n.container.append(p),n.optionSection=n.getControlOptions(),n.container.append(n.optionSection);var d=jQuery('<div class="atlas-route-range-buttons" style="display: block;"></div>'),f=jQuery("<div/>");n.container.append(d),d.append(f);var g=jQuery('<label class="atlas-route-range-outline-area"></label>'),b=jQuery('<input type="checkbox" checked="checked" alt="'.concat(n.resource.showArea,'" title="').concat(n.resource.showArea,'">'));b.on("change",function(){n.settings.showArea=b.is(":checked")}),g.append(b),g.append(n.resource.showArea),n.showArea=g;var M=n.getControlButton(n.resource.search,"pbi-fluent-button pbi-modern-button primaryBtn save atlas-route-range-searchButton");M.on("click",n.onSearch),n.searchButton=M;var w=n.getControlButton(n.resource.cancel,"pbi-fluent-button pbi-modern-button secondaryBtn cancel atlas-route-range-cancelButton");n.cancelButton=w,w.on("click",n.onCancel),n.options.collapsible||w.css(n.displayPropertyName,"none");var D=jQuery('<div style="text-align: right;"></div>');D.append(M),D.append(w),f.append([g,D]),n.map.events.add("resize",n.mapResized),n.mapResized(),n.options.isVisible&&n.setVisible(n.options.isVisible)},n.onSearch=function(){var u=atlas.math.convertDistance,c=Math.round,h=n.settings,p=new Intl.NumberFormat("en-US",{useGrouping:!1}).format,d=[];d.push("query=".concat(p(h.origin[1]),",").concat(p(h.origin[0]))),d.push("travelMode=car"),d.push("time"===h.selectionArea?"timeBudgetInSec=".concat(p(c(60*h.travelTime))):"distanceBudgetInMeters=".concat(p(c(u(h.distance,h.distanceUnits,"meters")))));var f="https://".concat(n.map.getServiceOptions().domain,"/route/range/json?api-version=1.0&").concat(d.join("&")),g=n.map.authentication.signRequest({url:f});fetch(g.url,{method:"GET",mode:"cors",headers:new Headers(g.headers)}).then(function(b){return b.json()},function(b){return n._invokeEvent("error",n.resource.error)}).then(function(b){if(b.reachableRange){var M=b.reachableRange.boundary.map(function(D){return[D.longitude,D.latitude]}),w=new atlas.data.Polygon([M]);n._invokeEvent("rangeCalculated",w),n.settings.showArea&&n._invokeEvent("showRange",w)}else n._invokeEvent("error",n.resource.error)},function(b){return n._invokeEvent("error",n.resource.error)}),n.options.collapsible&&n.setVisible(!1)},n.onCancel=function(){n.setVisible(!1);var u=n.map.getMapContainer().querySelector(".routeRange-selection");cr.IK.focus(u)},n.onMarkerDragged=function(){n.settings.origin=n.marker.getOptions().position,[n.optionSection,n.searchButton,n.cancelButton,n.showArea].forEach(function(u){return u.css(n.displayPropertyName,"")}),n.hideOptionsTimeout=null,n.options.calculateOnMarkerMove&&n.onSearch()},n.onMarkerDargStart=function(){n.hideOptionsTimeout&&(clearTimeout(n.hideOptionsTimeout),n.hideOptionsTimeout=null)},n.onContainerKeyDown=function(u){if(u.keyCode>36&&u.keyCode<=40&&u.target.classList.contains("azure-maps-control-container")){var c=n.map.getCamera().zoom,h=atlas.math.mercatorPositionsToPixels([n.marker.getOptions().position],c)[0],p=n.arrowKeyOffset;37===u.keyCode?h[0]-=p:38===u.keyCode?h[1]-=p:39===u.keyCode?h[0]+=p:40===u.keyCode&&(h[1]+=p);var d=atlas.math.mercatorPixelsToPositions([h],c)[0];n.marker.setOptions({position:d}),n.settings.origin=d,n.options.calculateOnMarkerMove&&(n.markerKeyMoveTimeout&&clearTimeout(n.markerKeyMoveTimeout),n.markerKeyMoveTimeout=setTimeout(function(){n.onSearch()},n.markerMoveSearchDelay)),u.preventDefault(),u.stopPropagation()}},n.mapResized=function(){var u=n.map.getMapContainer().getBoundingClientRect(),c=0,h=n.options.position;(u.width<750||"center"===h&&u.height<600)&&(c=5e3),n.container.removeClass(["left","right","center","left-min","right-min","center-min"]),n.container.addClass(h),n.showOptionsDelay=c},n.host=i,o.markerOptions=(0,y.__assign)((0,y.__assign)({},o.markerOptions),n.options.markerOptions),n.options=(0,y.__assign)((0,y.__assign)({},n.options),o),n.marker=new atlas.HtmlMarker((0,y.__assign)((0,y.__assign)({},n.options.markerOptions),{draggable:!0})),n}return(0,y.__extends)(r,a),r.prototype.dispose=function(){var i=this;this.map&&this.map.controls.remove(this),this.styler&&this.styler.dispose(),Object.keys(this).forEach(function(o){i[o]=null})},r.prototype.setMarkerOptions=function(i){this.options.markerOptions=(0,y.__assign)((0,y.__assign)({},this.options.markerOptions),i),this.marker.setOptions(i)},r.prototype.setVisible=function(i){var o=this;if(this.marker&&this.map){var n=this.map.getCamera(),u=n.center;this.settings.origin&&atlas.data.BoundingBox.containsPosition(n.bounds,this.settings.origin)&&(u=this.settings.origin),this.settings.origin=u,this.marker.setOptions({position:u,visible:i}),i&&this.options.calculateOnMarkerMove&&this.onSearch()}if(this.container){var c=i?"":"none";[this.optionSection,this.searchButton,this.cancelButton,this.showArea].forEach(function(h){return h.css(o.displayPropertyName,"none")}),this.container.css(this.displayPropertyName,c),i&&(this.hideOptionsTimeout=setTimeout(function(){[o.optionSection,o.searchButton,o.cancelButton,o.showArea].forEach(function(h){return h.css(o.displayPropertyName,"")}),o.hideOptionsTimeout=null},this.showOptionsDelay))}this.options.isVisible!==i&&i&&this.container&&this.container.trigger("focus"),this.options.isVisible=i},r.prototype.getOptions=function(){return(0,y.__assign)({},this.options)},r.prototype.onAdd=function(i,o){return this.resource={routeRangeDescription:this.host.getLocalizedString("Visual_AzureMapsRouteRangeControl"),cancel:this.host.getLocalizedString("Cancel_ButtonText"),close:this.host.getLocalizedString("Close"),distance:this.host.getLocalizedString("Distance"),distanceUnits:this.host.getLocalizedString("Visual_AzureMapsRouteRangeDistanceUnits"),kilometers:this.host.getLocalizedString("Visual_AzureMapsRouteRangeKilometers"),meters:this.host.getLocalizedString("Visual_MapUnitMeters"),miles:this.host.getLocalizedString("Visual_AzureMapsRouteRangeMiles"),error:this.host.getLocalizedString("Visual_AzureMapsRouteRangeError"),selection:this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelection"),search:this.host.getLocalizedString("SearchBox_Text"),selectionArea:this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelectionArea"),selectOrigin:this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelectOrigin"),showArea:this.host.getLocalizedString("Visual_AzureMapsRouteRangeShowArea"),time:this.host.getLocalizedString("DataType_Label_Time"),title:this.host.getLocalizedString("Visual_AzureMapsRouteRangeTitle"),travelTime:this.host.getLocalizedString("Visual_AzureMapsRouteRangeTravelTime"),yards:this.host.getLocalizedString("Visual_AzureMapsRouteRangeYards"),closeDialog:this.host.getLocalizedString("CloseDialog_ModalHeader")},this.map=i,this.marker.setOptions({visible:this.options.isVisible}),i.markers.add(this.marker),i.events.add("dragstart",this.marker,this.onMarkerDargStart),i.events.add("dragend",this.marker,this.onMarkerDragged),this.createContainer(),this.styler?this.styler.updateMap(i):this.styler=new ma(this.container.get(0),i,this.options.style||"light"),this.container.get(0)},r.prototype.onRemove=function(){this.container&&(this.container.off("keydown",this.onContainerKeyDown),this.container.remove(),this.container=null),this.styler.updateMap(null),this.map.events.remove("resize",this.mapResized),this.map.events.remove("dragstart",this.marker,this.onMarkerDargStart),this.map.events.remove("dragend",this.marker,this.onMarkerDragged),this.map.markers.remove(this.marker),this.map=null},r.prototype.getSelectColumn=function(i,o,n,u){var c=jQuery('<select alt="'.concat(i,'" title="').concat(i,'" class="').concat(n,'"/>'));return u&&c.on("change",function(){var h=c.val().toString();u(h)}),c.append(this.getSelectOptions(o)),c},r.prototype.getSelectOptions=function(i){var o=[];return _.forEach(i,function(n){o.push(jQuery('<option value="'.concat(n.value,'">').concat(n.title,"</option>")))}),o},r.prototype.getInputColumn=function(i,o,n){var u="";_.forEach(o,function(h){u=u.concat("".concat(h.name,'="').concat(h.value,'"'))});var c=jQuery("<input ".concat(u,' alt="').concat(i,'" title="').concat(i,'" class="atlas-route-range-col2">'));return n&&c.on("change",function(){n(c)}),c},r.prototype.getControlButton=function(i,o){return jQuery('<button alt="'.concat(i,'" title="').concat(i,'" class="').concat(o,'">').concat(i,"</button>"))},r.prototype.getControlOptions=function(){var i=this,o=jQuery('<div class="atlas-route-range-options"/>'),n=jQuery('<div class="atlas-route-range-row"/>');o.append(n),n.append(jQuery('<label class="atlas-route-range-option-title-first">'.concat(this.resource.selectionArea,"</label>")));var u=jQuery('<label class="atlas-route-range-option-title">'.concat(this.resource.distance,"</label>"));u.css(this.displayPropertyName,"none"),n.append(u);var c=jQuery('<label class="atlas-route-range-option-title">'.concat(this.resource.travelTime,"</label>"));n.append(c);var h=jQuery('<div class="atlas-route-range-row"/>');o.append(h);var d=1440,f=this.getInputColumn(this.resource.travelTime,[{name:"type",value:"number"},{name:"value",value:"15"},{name:"min",value:1..toString()},{name:"max",value:d.toString()}],function(T){var P=parseInt(T.val().toString(),10);P>d&&(P=d),P<1&&(P=1),T.val(P.toString()),i.settings.travelTime=P}),b=1e3,M=this.getInputColumn(this.resource.distance,[{name:"type",value:"number"},{name:"value",value:"5"},{name:"min",value:1..toString()},{name:"max",value:b.toString()}],function(T){var P=parseInt(T.val().toString(),10);P>b&&(P=b),P<1&&(P=1),T.val(P.toString()),i.settings.distance=P});M.css(this.displayPropertyName,"none");var D=this.getSelectColumn(this.resource.distanceUnits,[{value:"kilometers",title:this.resource.kilometers,default:!0},{value:"meters",title:this.resource.meters},{value:"miles",title:this.resource.miles},{value:"yards",title:this.resource.yards}],"atlas-route-range-col3",function(T){i.settings.distanceUnits=T.toString()});D.css(this.displayPropertyName,"none");var W=this.getSelectColumn(this.resource.selectionArea,[{value:"time",title:this.resource.time,default:!0},{value:"distance",title:this.resource.distance}],"atlas-route-range-col1",function(T){i.settings.selectionArea=T.toString();var P="time"===T,E=P?"":"none";[c,f].forEach(function(re){return re.css(i.displayPropertyName,E)});var U=P?"none":"";[u,M,D].forEach(function(re){return re.css(i.displayPropertyName,U)})});return h.append([W,M,D,f]),this.settings={selectionArea:"time",travelTime:15,distance:5,distanceUnits:atlas.math.DistanceUnits.kilometers,showArea:!0},o},r}(atlas.internal.EventEmitter))(s,e)}(this.host,g);this.map.controls.add(b,{position:atlas.ControlPosition.TopRight}),this.rangeControl=b,this.map.events.add("resize",this.mapResized),this.mapResized(),this.map.events.add("rangeCalculated",this.rangeControl,this.searchArea),this.map.events.add("showRange",this.rangeControl,this.displayRangePolygon)},i.prototype.buildSelectModeBtn=function(o){var n=this,u="";switch(o){case t.circle:u=this.host.getLocalizedString("Visual_AzureMapsCircleSelection");break;case t.polygon:u=this.host.getLocalizedString("Visual_AzureMapsPolygonSelection");break;case t.rectangle:u=this.host.getLocalizedString("Visual_AzureMapsRectangleSelection");break;case t.routeRange:u=this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelection");break;default:I.fF.assertFail('Unknown selection mode "'.concat(o))}var c=jQuery('<button type="button" alt="'.concat(u,'" title="').concat(u,'" class="').concat(i.css.button," ").concat(o,'-selection"></button>'));return c.on("click",function(){n.clear(),n.map.events.invoke("click",{originalEvent:{ctrlKey:!1,metaKey:!1}}),"routeRange"===o?(n.rangeControl.setVisible(!0),n.drawingManager.setOptions({mode:atlas.drawing.DrawingMode.idle})):n.drawingManager.setOptions({mode:"draw-"+o})}),c},i.css={button:"azure-maps-control-button",inUse:"in-use",hidden:"hidden-accessible-element"},i}(atlas.internal.EventEmitter);return new a(s,e)}(this.host,{style:"light",sourceIds:[xe,$e,Ke,je]}),this.barChart3DLayer=new atlas.layer.PolygonExtrusionLayer(je,aa,{height:["get","size"],fillColor:["get","color"],base:0,filter:J.getSelectionFilter(!0),visible:!1}),this.unselectedBarChart3DLayer=new atlas.layer.PolygonExtrusionLayer(je,ra,{height:["get","size"],fillColor:["get","color"],base:0,filter:J.getSelectionFilter(!1),visible:!1}),this.filledMapFillLayer=new atlas.layer.PolygonLayer(Ke,ia,{fillColor:["get","color"],visible:!1}),this.filledMapOutlineLayer=new atlas.layer.LineLayer(Ke,oa,{visible:!1}),this.heatMapLayer=new atlas.layer.HeatMapLayer($e,ta,{visible:!1}),this.bubbleLayer=new atlas.layer.BubbleLayer(xe,et,{color:["get","color"],filter:J.bubbleLayerFilter,visible:!1,createIndicators:!0}),this.clusterBubbleLayer=new atlas.layer.BubbleLayer(xe,"clusterBubbleLayer",{filter:J.clusteredDataFilter,visible:!1,createIndicators:!0,accessibilityIdKey:"cluster_id"}),this.clusterSymbolLayer=new atlas.layer.SymbolLayer(xe,"clusterSymbolLayer",{iconOptions:{image:""},textOptions:{textField:["get","point_count_abbreviated"],offset:[0,.4]},visible:!1,filter:J.clusteredDataFilter}),this.pieChartSymbolLayer=new atlas.layer.SymbolLayer(xe,null,{filter:J.pieLayerFilter,iconOptions:{image:["get","iconId"],size:1,allowOverlap:!0},visible:!1}),this.referenceLayer=this.featureSwitches.azureMapsCustomFormattingReferenceLayer?new zt(this.referenceDataSource):new atlas.layer.SimpleDataLayer(this.referenceDataSource,{enablePopups:!1,bubbleRadiusFactor:4});var r=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.heatMapLayer,this.bubbleLayer,this.pieChartSymbolLayer,this.clusterBubbleLayer,this.clusterSymbolLayer];if(this.featureSwitches.azureMapsCustomFormattingReferenceLayer&&this.referenceLayer instanceof zt?(this.mapControl.layers.add((0,y.__spreadArray)((0,y.__spreadArray)([],r,!0),this.referenceLayer.getLayers(),!0)),this.referenceLayer.onAdd(this.mapControl)):this.referenceLayer instanceof atlas.layer.SimpleDataLayer&&this.mapControl.layers.add((0,y.__spreadArray)((0,y.__spreadArray)([],r,!0),[this.referenceLayer],!1)),this.behavior){var i=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer,this.clusterBubbleLayer],o=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer],n=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer,this.pieChartSymbolLayer,this.clusterBubbleLayer],u=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer];this.featureSwitches.azureMapsDataBoundReferenceLayer&&this.referenceLayer instanceof zt&&(i=(0,y.__spreadArray)((0,y.__spreadArray)([],i,!0),this.referenceLayer.getLayers(),!0),o=(0,y.__spreadArray)((0,y.__spreadArray)([],o,!0),this.referenceLayer.getLayers(),!0),n=(0,y.__spreadArray)((0,y.__spreadArray)([],n,!0),this.referenceLayer.getLayers(),!0),u=(0,y.__spreadArray)((0,y.__spreadArray)([],u,!0),this.referenceLayer.getLayers(),!0)),this.mapControl.events.add("mousemove",i,function(c){return a.behavior.featureMousemove(c,a.showTooltip)}),this.mapControl.events.add("mouseover",[this.bubbleLayer],function(c){return a.behavior.featureMouseover(c)}),this.mapControl.events.add("mousemove",[this.pieChartSymbolLayer],this.handleMousemoveOnPie),this.mapControl.events.add("mouseout",n,function(c){return a.behavior.featureMouseout(c,a.hideTooltip)}),this.mapControl.events.remove("click",this.behavior.mapClicked),this.mapControl.events.remove("click",this.behavior.featureClicked),this.mapControl.events.remove("contextmenu",this.behavior.featureContextClicked),this.mapControl.events.add("click",function(c){if(a.selectionControl.clear(),a.behavior.mapClicked(c),a.clickPieState){var h=a.clickPieState;a.behavior.handleSelection(h.event,[h.dataPointHovered.subDataPoints[h.idx]]),a.clickPieState=null}else a.behavior&&a.behavior.renderSelection(a.behavior.visualHasSelection())}),this.mapControl.events.add("click",o,function(c){a.selectionControl.clear(),a.behavior.featureClicked(c)}),this.mapControl.events.add("click",[this.clusterBubbleLayer],function(c){a.behavior.clusterClicked(c,a.bubbleDataSource)}),this.mapControl.events.add("contextmenu",u,this.behavior.featureContextClicked),this.mapControl.events.add("contextmenu",[this.pieChartSymbolLayer],function(c){if(a.clickPieState){var h=a.clickPieState;a.behavior.handleContextMenu(h.event,h.dataPointHovered.subDataPoints[h.idx]),a.clickPieState=null}}),this.mapControl.events.add("focusin",[this.bubbleLayer,this.clusterBubbleLayer],function(c){return a.behavior.featureFocusIn(c,a.showTooltip,a.hideTooltip,a.tooltipService.visible.bind(a.tooltipService))}),this.mapControl.events.add("focusout",[this.bubbleLayer,this.clusterBubbleLayer],function(c){return a.behavior.featureFocusOut(c,a.hideTooltip)})}this.setupDataLabelLayer(),$(".atlas-map a").attr("tabindex",0),this.registerArrowKeyStopper(),this.waitForMapA11yContainer().then(function(){var c=a;$(".accessible-indicator-collection-container").attr("tabindex","0").attr("focus-nav-mode","Hierarchy").css({width:"100%",height:"100%",position:"absolute",pointerEvents:"none"}).on("focusin",function(h){h.target===this&&"key"===$("html").attr("data-focus-source")&&c.updateCamera([])})})},s.prototype.createDataSource=function(e,t){this.mapControl.sources.add(new atlas.source.DataSource(e,t))},s.prototype.waitForMapA11yContainer=function(){var e=this;return new Promise(function(t){e.mapControl.events.add("idle",function(){t()})})},s.prototype.registerArrowKeyStopper=function(){$(".mapControl.atlas-map").on("keydown",function(e){(0,lr.Wl)(e.keyCode)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault())})},s.prototype.destroy=function(){this.mapControl&&this.mapControl.events.remove("move",this.mapControlMoved)},s.prototype.setupDataLabelLayer=function(){var t=d3.select(this.mapControl.getMapContainer()).append("svg").style("position","absolute").style("pointer-events","none").style("width","100%").style("height","100%");this.labelBackgroundGraphicsContext=t.append("g").classed(rt.u9.class,!0),this.labelGraphicsContext=t.append("g").classed(rt.ZL.class,!0),this.mapControl.events.add("move",this.mapControlMoved)},s.prototype.handleKeyboardShortcuts=function(e){var t=this;this.mapControl.setUserInteraction({keyboardInteraction:!1}),e.on("keydown",function(a){39===a.keyCode&&he.M.isCtrlOrMeta(a)&&(t.mapControl.setUserInteraction({keyboardInteraction:!0}),e.off("keydown"))})},s.prototype.setData=function(e){this.data=e},s.prototype.updateNonDataBoundProperties=function(e,t,a){this.mapControlFactory=t;var r=e?.properties;this.updateMapControlProperties(r?.mapControls),this.updateTrafficProperties(r?.traffic),this.updateTileLayerProperties(r?.tile),this.updateReferenceLayer(r?.referenceLayer,a)},s.prototype.clearDataLabels=function(){(0,ga.gm)({dataLabels:[],labelContext:this.labelGraphicsContext,backgroundContext:this.labelBackgroundGraphicsContext,numeric:!1,formatMode:this.formatMode,onObject:this.featureSwitches.onObject})},s.prototype.drawDataLabels=function(){var e=this;if(this.data){var t=this.data.dataLabelSettings;if(!this.data.properties.bubble.showBubbleLayer||!t.show)return void this.clearDataLabels();var r=this.mapControl.getCamera(),i=this.bubbleLayer.getOptions();if(r.zoom<i.minZoom||r.zoom>i.maxZoom)return void this.clearDataLabels();var o=t.fontProperties,n=[this.viewportSize.width/2,this.viewportSize.height/2],u=r.center,c=i.radius,h=this.data.properties.bubble.strokeWidth,p="map"===i.pitchAlignment,d=(270+(p?90:0)+r.bearing)%360,f=this.shouldUseLegacyFormat(),g=this.data.dataPoints.filter(function(D){return D.location}).map(function(D){var N,W=D.subDataPoints[0].size,T=f?J.LEGACY_evaluateRadiusExpression(c,r.zoom,W)+h:(D.bubbleRadius||0)+h,E=e.mapControl.pixelsToPositions([[n[0]-T,n[1]]])[0],U=atlas.math.getDistanceTo(u,E),re=[D.location.longitude,D.location.latitude],fe=e.mapControl.positionsToPixels([re])[0],se=fe[0],ie=fe[1],te=atlas.math.getDestination(re,d,U),ae=e.mapControl.positionsToPixels([te])[0],Le=Math.abs(p?ie-ae[1]:se-ae[0]),oe=D.categoryValue,F=(0,pa.qk)(o,oe),H=va.b.measureSvgTextWidth(F),Y=va.b.estimateSvgTextHeight(F);return{isPreferred:!0,text:D.categoryValue,textSize:{width:H,height:Y},identity:null,key:"".concat(oe,":").concat(W,":").concat(D.location.longitude,":").concat(D.location.latitude),fontProperties:o,outsideFill:o.color?o.color:"#ffffff",insideFill:o.color?o.color:"#ffffff",parentType:0,parentShape:{point:{x:se,y:ie},radius:Le,validPositions:[1,2,4,8]},hasBackground:null===(N=t.enableBackground)||void 0===N||N,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency}}),w=new sr.nu({maximumOffset:rt.wh,startingOffset:rt.ki}).layout([{labelDataPoints:g,maxNumberOfLabels:g.length}],this.viewportSize);(0,ga.gm)({dataLabels:w,labelContext:this.labelGraphicsContext,backgroundContext:this.labelBackgroundGraphicsContext,numeric:!1,formatMode:!1,onObject:!1})}},s.prototype.updateViewportSize=function(e){this.viewportSize=e},s.prototype.updateDataLayers=function(e,t){this.data.hasXY||this.data.hasCategory?this.displayData(e?e.properties:void 0,t):(this.bubbleDataSource.clear(),this.heatMapDataSource.clear(),this.filledMapDataSource.clear(),this.barChart3DDataSource.clear(),this.featureSwitches.azureMapsDataBoundReferenceLayer&&this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings())},s.prototype.updateCamera=function(e){if(this.data)if(this.data.hasXY||this.data.hasCategory){var t=this.features,a=atlas.data.BoundingBox.fromData(t);this.setCamera(a,t&&1===t.length&&!this.data.properties.filledMap.showFilledMap,e)}else this.data.properties.mapControls.cameraProperties.autoZoom&&this.mapControl.setCamera({type:this.getCurrentCameraType(),zoom:0,pitch:0,bearing:0})},s.getFirstIdentityKey=function(e){return e.getProperties().identityKeys[0]},s.prototype.setFormatMode=function(e){this.formatMode!==e&&(this.formatMode=e,this.formatMode?this.attachControlsListeners():this.removeControlsListeners())},s.prototype.displayData=function(e,t){var a=this,r=this.data.properties,i=r.commonDataOptions,o=this.shouldUseLegacyFormat(),n=r.filledMap;if(this.data.shouldRenderFilledMap){var u=J.getFilledMapDisplayOptions(n,i,o,this.data.hasSize),h=u.lineOptions;this.filledMapFillLayer.setOptions(u.polygonOptions),this.filledMapOutlineLayer.setOptions(h);var p=[ia,oa],d=this.getMapControlLayerName(n.layerPosition);this.moveLayers(p,d)}else this.filledMapFillLayer.setOptions({visible:!1}),this.filledMapOutlineLayer.setOptions({visible:!1});var f=r.barChart.dataProperties,g=r.barChart.paintProperties;if(f.showBarChart){var b=J.getBarChartDisplayOptions(g,i,this.data.maxDataValue,o,this.data.hasSize),w=b.unselectedOptions;this.barChart3DLayer.setOptions(b.selectedOptions),this.unselectedBarChart3DLayer.setOptions(w),p=[aa,ra],d=this.getMapControlLayerName(g.layerPosition),this.moveLayers(p,d),this.mapControl.events.remove("zoomend",this.zoomChanged),f.scaleThicknessOnZoom&&this.mapControl.events.add("zoomend",this.zoomChanged)}else this.barChart3DLayer.setOptions({visible:!1}),this.unselectedBarChart3DLayer.setOptions({visible:!1});var D=r.heatMap;if(D.showHeatMapLayer){var N=J.getHeatMapDisplayOptions(D,this.data.hasSize).heatMapOptions;this.heatMapLayer.setOptions(N),p=[ta],d=this.getMapControlLayerName(D.layerPosition),this.moveLayers(p,d)}else this.heatMapLayer.setOptions({visible:!1});var W=this.shouldEnableBubbleLayer(r,this.data),T=this.shouldEnablePieChartLayer(r,this.data,this.featureSwitches);T?this.behavior&&this.behavior.setPieChartBehavior(T,this.pieFactory,this.pieChartSymbolLayer,o):this.behavior&&this.behavior.setPieChartBehavior(T,void 0,void 0,o);var P=r.bubble;if(P.showBubbleLayer){if(T){t&&this.pieFactory.clearAll();var E=this.data.dataPoints.filter(function(F){return F.location});o&&J.LEGACY_appendPieRadiusToDataPoints(E,this.data);var U=[];W?E.forEach(function(F){F.subDataPoints.length>1&&U.push(F)}):U.push.apply(U,E),U.forEach(function(F){return a.pieFactory.loadIcon(F,P)}),this.clearLastHoverMarker(),this.markerIdentityKeyLastHovered=null,this.svgMarkers=U.map(function(F){return[new atlas.HtmlMarker({htmlContent:a.pieFactory.svgContent(F,P,!0),position:[F.location.longitude,F.location.latitude],pixelOffset:new atlas.Pixel(0,6.5),anchor:"center"}),F]}).reduce(function(F,H,Y){var ge,De=H[0],ve=H[1];return(0,y.__assign)((0,y.__assign)({},F),((ge={})[ve.subDataPoints[0].identity.getKey()]=De,ge))},{});var re=J.getPieChartDisplayOptions(P).pieChartOptions;this.pieChartSymbolLayer.setOptions(re),p=[this.pieChartSymbolLayer.getId()],d=this.getMapControlLayerName(P.layerPosition),this.moveLayers(p,d)}else this.pieChartSymbolLayer.setOptions({visible:!1});if(W){var fe=J.getBubbleDisplayOptions(P,i,o,this.data.hasSize,this.data.minDataValue,this.data.maxDataValue).bubbleOptions;if(this.bubbleLayer.setOptions(fe),this.featureSwitches.azureMapsBubbleCluster){if(P.clusteringEnabled){var se=J.getBubbleClusterDisplayOptions(fe,P),te=se.clusterSymbolOptions;this.clusterBubbleLayer.setOptions(se.clusterBubbleOptions),this.clusterSymbolLayer.setOptions(te)}else this.clusterBubbleLayer.setOptions({visible:!1}),this.clusterSymbolLayer.setOptions({visible:!1});e?.bubble.clusteringEnabled!==this.data.properties.bubble.clusteringEnabled&&this.updateDataSourceClusterOptions(xe,{cluster:P.clusteringEnabled})}p=[et],d=this.getMapControlLayerName(P.layerPosition),this.moveLayers(p,d)}else this.bubbleLayer.setOptions({visible:!1})}else this.bubbleLayer.setOptions({visible:!1}),this.pieChartSymbolLayer.setOptions({visible:!1}),this.clusterBubbleLayer.setOptions({visible:!1}),this.clusterSymbolLayer.setOptions({visible:!1});if(this.featureSwitches.azureMapsDataBoundReferenceLayer){var ae=r.referenceLayer;this.referenceLayer.setOptions({unselectedTransparency:i.unselectedTransparency,bubble:ae.bubble,polygon:ae.polygon,line:ae.line})}(t||!_.isEqual(e?.barChart.dataProperties,f)||e.filledMap.showFilledMap!==n.showFilledMap||e.bubble.showBubbleLayer!==P.showBubbleLayer||T&&!_.isEqual(e.bubble,P)||e.heatMap.showHeatMapLayer!==D.showHeatMapLayer)&&this.updateFeatures()},s.prototype.updateDataSourceClusterOptions=function(e,t){var a=this,r=this.mapControl.sources.getById(e),i=this.mapControl.layers.getLayers().filter(vr).filter(function(n){var u=n.getSource();return("string"==typeof u?u:u?.getId())===e});i.forEach(function(n){a.mapControl.layers.remove(n)});var o=new atlas.source.DataSource(e,(0,y.__assign)((0,y.__assign)({},r.getOptions()),t));o.setShapes(r.getShapes()),r.dispose(),this.mapControl.sources.remove(r),this.mapControl.sources.add(o),i.forEach(function(n){n.setOptions({source:o})}),this.mapControl.layers.add(i)},s.prototype.getMapControlLayerName=function(e){switch(e){case"labels":return"labels";case"transit":return"roads";default:return}},s.prototype.moveLayers=function(e,t){for(var a=0,r=e;a<r.length;a++){var i=r[a];this.mapControl.layers.getLayerById(i)&&this.mapControl.layers.move(i,t)}},s.prototype.updateFeatureDataSource=function(e,t){e&&(t?e.setShapes(t):e.clear&&e.clear())},s.prototype.shouldEnableBubbleLayer=function(e,t){return e.bubble.showBubbleLayer&&!(t.hasCategory&&t.hasSeries)},s.prototype.shouldEnablePieChartLayer=function(e,t,a){return e.bubble.showBubbleLayer&&(t.hasCategory&&t.hasSeries||!!a.azureMapsLatLongPieCharts&&t.hasDuplicatedLatLong)},s.prototype.shouldEnableHeatMap=function(e,t){return e.heatMap.showHeatMapLayer&&!t.hasSeries},s.prototype.getSinglePointZoomLevel=function(){switch(this.data&&this.data.geocodingCategory){case X.yV.Continent:return 1;case X.yV.CountryRegion:return 2;case X.yV.StateOrProvince:return 3.5;case X.yV.County:return 5;case X.yV.City:return 8.5;case X.yV.PostalCode:return 10;case X.yV.Place:return 10.5;default:return 15}},s.prototype.getCurrentCameraType=function(){return this.formatMode?"jump":"fly"},s.prototype.setCamera=function(e,t,a){var r={},i=!1;t?r={zoom:this.getSinglePointZoomLevel(),center:atlas.data.BoundingBox.getCenter(e),type:this.getCurrentCameraType()}:(!_.isEmpty(e)&&e[0]>e[2]&&(e[0]=-180,e[2]=180),r={bounds:e,type:this.getCurrentCameraType()},(this.data.properties.bubble.showBubbleLayer||this.data.properties.heatMap.showHeatMapLayer)&&(i=!0)),this.data.properties.filledMap.showFilledMap&&(i=!0);var o=this.mapControl.getCanvas();i&&60<o.width&&60<o.height&&(r.padding=30);var c=this.mapControl.getCamera().pitch;60!==c&&this.data.properties.barChart.dataProperties.showBarChart?r.pitch=60:0!==c&&!this.data.properties.barChart.dataProperties.showBarChart&&(r.pitch=0);try{this.mapControl.setCamera(r)}catch(h){if(!this.isCameraBoundsError(h))throw h;a.push(new R.x8),this.host.setWarnings(a)}},s.prototype.isCameraBoundsError=function(e){return e instanceof Error&&e.message.includes("The map cannot be fit to the current canvas with the given CameraBoundsOptions.")},s.prototype.getFeatureMapping=function(){var e=this.data.dataPoints,t=this.data.properties,a=t.barChart.dataProperties,r={bubble:null,barChart3D:null,filledMap:null,heatMap:null,reference:null},i=null!=this.behavior&&this.behavior.visualHasSelection();if(this.data.shouldRenderFilledMap&&(r.filledMap=Se.getFilledMapMultiPolygonFeature(e,i)),a.showBarChart){var o=a.thickness,n=a.barShape;o=Math.max(o,.01),void 0===this.lastDataZoom&&(this.lastDataZoom=Math.round(this.mapControl.getCamera().zoom)),a.scaleThicknessOnZoom&&(o*=Math.pow(2,19-this.lastDataZoom)/20),r.barChart3D=Se.getPolygonFeature(e,o,n,i)}if(t.bubble.showBubbleLayer||t.heatMap.showHeatMapLayer){var u=this.shouldEnableBubbleLayer(t,this.data),c=this.shouldEnablePieChartLayer(t,this.data,this.featureSwitches),h=this.shouldEnableHeatMap(t,this.data),p=this.data.dataPoints.filter(function(g){return g.location}),d=this.shouldUseLegacyFormat();d&&J.LEGACY_appendPieRadiusToDataPoints(p,this.data);var f=Se.getPointFeatures(p,i,u,c,t.bubble,d);(u||c)&&(r.bubble=f),h&&(r.heatMap=f)}return this.featureSwitches.azureMapsDataBoundReferenceLayer&&(r.reference=Se.getReferenceLayerFeature(this.referenceDataMatcher,i)),r},s.prototype.updateMapControlProperties=function(e){this.updateStyles(e?.styleProperties),this.updateControls(e?.controlToggles),this.updateCameraProperties(e?.cameraProperties)},s.prototype.updateStyles=function(e){var t=this.data.properties.mapControls.styleProperties,a=t.defaultStyle,r=t.showLabels,i=t.worldWrap,o=this.mapControl.getStyle(),n={};a!==e?.defaultStyle&&a!==o.style&&(n.style=a),i!==e?.worldWrap&&i!==o.renderWorldCopies&&(n.renderWorldCopies=i),r!==e?.showLabels&&r!==o.showLabels&&(n.showLabels=r),_.isEmpty(n)||this.mapControl.setStyle(n)},s.prototype.updateControls=function(e){var t=this.data.properties.mapControls.controlToggles;_.isEqual(e,t)||(this.addRemoveControl(t.showStylePicker,this.styleControl),this.addRemoveControl(t.showNavigationControls,this.zoomControl),this.addRemoveControl(t.showNavigationControls,this.pitchControl),this.addRemoveControl(t.showNavigationControls,this.compassControl),this.addRemoveControl(t.showSelectionControl,this.selectionControl),t.showSelectionControl&&this.behavior&&(this.mapControl.events.remove("dataSelected",this.selectionControl,this.behavior.dataSelected),this.mapControl.events.add("dataSelected",this.selectionControl,this.behavior.dataSelected)))},s.prototype.updateCameraProperties=function(e){var t=this.data.properties.mapControls.cameraProperties;!t.autoZoom&&!_.isEqual(e,t)&&this.mapControl.setCamera({zoom:t.zoom,bearing:t.heading,pitch:t.pitch,center:new atlas.data.Position(t.centerLongitude,t.centerLatitude)})},s.prototype.updateTrafficProperties=function(e){var t=this.data.properties.traffic;void 0===e&&(e={}),(e.showTraffic!==t.showTraffic||e.showIncidents!==t.showIncidents)&&this.updateTraffic(t);var a=t.showTraffic&&t.showTrafficControl;e.showIncidents!==t.showIncidents&&(this.addRemoveControl(!1,this.trafficControl),this.trafficControl=this.createTrafficControl(t.showIncidents)),this.addRemoveControl(a,this.trafficControl)},s.prototype.updateTraffic=function(e){this.mapControl.setTraffic(e.showTraffic?{incidents:e.showIncidents,flow:"relative"}:{incidents:!1,flow:"none"})},s.prototype.createTrafficControl=function(e){return new atlas.control.TrafficControl({incidents:e,isActive:!0,flow:"relative"})},s.prototype.updateTileLayerProperties=function(e){var t=this.data.properties.tile;if(null==e&&(e={}),!_.isEqual(e,t)&&(void 0!==this.tileLayerId&&this.mapControl.layers.getLayerById(this.tileLayerId)&&this.mapControl.layers.remove(this.tileLayerId),t.tileLayerUrl)){var a=new atlas.layer.TileLayer({tileUrl:t.tileLayerUrl,opacity:(0,V.TD)(t.transparency),tileSize:t.tileSize,isTMS:t.isTMS,minSourceZoom:t.minZoom,maxSourceZoom:t.maxZoom,bounds:[t.westBounds,t.southBounds,t.eastBounds,t.northBounds]});this.mapControl.layers.add(a,"labels"),this.tileLayerId=a.getId();var r=[a.getId()],i=this.getMapControlLayerName(t.layerPosition);this.moveLayers(r,i)}},s.prototype.updateReferenceLayer=function(e,t){var a=this.data.properties.referenceLayer;if(!_.isEqual(e,a)){if(this.featureSwitches.azureMapsMultiDataFormats){if(a){var r="file_upload"===a.datasourceType,i="url"===a.datasourceType,o=!1,n=!1,u="url"===a.datasourceType&&_.isEmpty(a.referenceLayerUrl),c="file_upload"===a.datasourceType&&a.additionalDatasource&&a.additionalDatasource.type===Rt.c1;if(r){var p=!_.isEmpty(a.additionalDatasource)&&a.additionalDatasource.type===Rt.BD&&null!==a.additionalDatasource.content&&null!==a.additionalDatasource.name,d=e&&e.additionalDatasource,f=d&&!_.isEqual(a.additionalDatasource.content,e.additionalDatasource.content),g=d&&!_.isEqual(a.datasourceType,e.datasourceType),b=!d||f||g;o=p&&b}else if(i){var M=!_.isEmpty(a.referenceLayerUrl);f=e&&!_.isEqual(a.referenceLayerUrl,e.referenceLayerUrl),g=e&&!_.isEqual(a.datasourceType,e.datasourceType),b=!e||f||g,n=M&&b}o?a.additionalDatasource.name.endsWith(".json")||a.additionalDatasource.name.endsWith(".geojson")||this.featureSwitches.azureMapsCsvSupport&&a.additionalDatasource.name.endsWith(".csv")?this.readSpatialData(a.additionalDatasource.content,t):a.additionalDatasource.name.endsWith(".kml")?this.readKmlData(a.additionalDatasource.content,t):a.additionalDatasource.name.endsWith(".wkt")?this.readWktData(!1,a.additionalDatasource.content,t):a.additionalDatasource.name.endsWith(".zip")?this.readShpData(!1,a.additionalDatasource.content,t):(this.referenceDataSource.clear(),this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings(),this.setAzureMapsFileReadWarning("The uploaded file format is not supported",t)):n?a.referenceLayerUrl.endsWith(".json")||a.referenceLayerUrl.endsWith(".geojson")||this.featureSwitches.azureMapsCsvSupport&&a.referenceLayerUrl.endsWith(".csv")?this.readSpatialData(a.referenceLayerUrl,t):a.referenceLayerUrl.endsWith(".kml")?this.readKmlData(a.referenceLayerUrl,t):a.referenceLayerUrl.endsWith(".wkt")?this.readWktData(!0,a.referenceLayerUrl,t):a.referenceLayerUrl.endsWith(".zip")?this.readShpData(!0,a.referenceLayerUrl,t):(this.referenceDataSource.clear(),this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings(),this.setAzureMapsFileReadWarning("The uploaded CDN file format is not supported",t)):(c||u)&&(this.referenceDataSource.clear(),this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings())}}else a&&a.additionalDatasource&&a.additionalDatasource.type===Rt.BD&&null!==a.additionalDatasource.content?this.readSpatialData(a.additionalDatasource.content,t):this.referenceDataSource.clear();this.featureSwitches.azureMapsCustomFormattingReferenceLayer&&this.referenceLayer.setOptions({unselectedTransparency:this.data.properties.commonDataOptions.unselectedTransparency,bubble:a.bubble,polygon:a.polygon,line:a.line,style:this.style})}},s.prototype.updateReferenceDataMappings=function(e){this.featureSwitches.azureMapsDataBoundReferenceLayer&&(this.referenceDataMatcher?(this.referenceDataMatcher.setShapes(e),this.referenceDataMatcher.createShapeDataMappings()):this.referenceDataMatcher=new ur(e,this.data.dataPoints),this.updateFeatures())},s.prototype.setShpfileShapesToDataSource=function(e){var t=e.flatMap(function(a){return a.features});this.referenceDataSource.setShapes(t),this.updateReferenceDataMappings(t)},s.prototype.parseShpfileToGeoJSON=function(e,t,a){return(0,y.__awaiter)(this,void 0,void 0,function(){var r,i;return(0,y.__generator)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e(t)];case 1:return(r=o.sent())instanceof Array||(r=[r]),[2,r];case 2:return i=o.sent(),this.setAzureMapsFileReadWarning(i+"Failed to parse shapefile",a),[3,3];case 3:return[2,[]]}})})},s.prototype.dataUri2ArrayBuffer=function(e,t){try{for(var a=e.split(",")[1],r=atob(a),i=new ArrayBuffer(r.length),o=new Uint8Array(i),n=0;n<r.length;n++)o[n]=r.charCodeAt(n);return i}catch(u){return this.setAzureMapsFileReadWarning(u+"Failed to decode the data part of the Data URI",t),null}},s.prototype.readShpData=function(e,t,a){return(0,y.__awaiter)(this,void 0,void 0,function(){var r,i,o,n=this;return(0,y.__generator)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),I.fF.assertValue(this.mapControlFactory,"mapControlFactory"),[4,this.mapControlFactory.loadShpJs()];case 1:return r=u.sent(),i=t,e||(i=this.dataUri2ArrayBuffer(t,a)),i&&(0,y.__awaiter)(n,void 0,void 0,function(){var c;return(0,y.__generator)(this,function(h){switch(h.label){case 0:return[4,this.parseShpfileToGeoJSON(r,i,a)];case 1:return(c=h.sent())&&this.setShpfileShapesToDataSource(c),[2]}})}),[3,3];case 2:return o=u.sent(),this.setAzureMapsFileReadWarning(o+"Failed to load shpjs lib",a),[3,3];case 3:return[2]}})})},s.prototype.readKmlData=function(e,t){var a=this,r=this.mapControl;atlas.io.read(e).then(function(i){return(0,y.__awaiter)(a,void 0,void 0,function(){var o,n;return(0,y.__generator)(this,function(u){switch(u.label){case 0:return i&&i.features&&i.features.length>0?i.icons?(o=[],0===(n=Object.keys(i.icons)).length?[3,2]:(n.forEach(function(c){return o.push(r.imageSprite.add(c,i.icons[c]))}),[4,Promise.all(o)])):[3,2]:[3,3];case 1:u.sent(),u.label=2;case 2:return this.referenceDataSource.setShapes(i.features),this.updateReferenceDataMappings(i.features),[3,4];case 3:this.setAzureMapsFileReadWarning("The uploaded KML could not be converted into a SpatialDataSet object or lacks geometric data",t),u.label=4;case 4:return[2]}})})},function(i){a.setAzureMapsFileReadWarning(i+"Invalid KML format",t)})},s.prototype.readWktData=function(e,t,a){return(0,y.__awaiter)(this,void 0,void 0,function(){var r,i=this;return(0,y.__generator)(this,function(o){switch(o.label){case 0:return e?[4,fetch(t).then(function(n){return n.text()}).catch(function(n){i.setAzureMapsFileReadWarning(n+"Unable to fetch data from this URL",a)}).then(function(n){n&&(r=atlas.io.ogc.WKT.read(n))})]:[3,2];case 1:return o.sent(),[3,3];case 2:r=atlas.io.ogc.WKT.read(t),o.label=3;case 3:return r&&r.length>0?this.referenceDataSource.setShapes(r):this.setAzureMapsFileReadWarning("Invalid WKT formats",a),[2]}})})},s.prototype.readSpatialData=function(e,t){var a=this;atlas.io.read(e,{maxFeatures:3e4,maxNetworkLinks:0}).then(function(r){r&&r.features&&r.features.length>0?(a.referenceDataSource.setShapes(r.features),a.updateReferenceDataMappings(r.features)):a.setAzureMapsFileReadWarning("The uploaded file could not be converted into a SpatialDataSet object or lacks geometric data",t)},function(r){a.setAzureMapsFileReadWarning(r+"Invalid file format",t)})},s.prototype.setAzureMapsFileReadWarning=function(e,t){K.f.error(e,!0,void 0,{}),null==t&&(t=[]),t.push(new R.$B),this.host.setWarnings(t)},s.prototype.addRemoveControl=function(e,t){if(t){var a=-1!==this.mapControl.controls.getControls().indexOf(t);e&&!a&&(this.mapControl.controls.add(t,{position:atlas.ControlPosition.TopRight}),this.setControlsContainer(t)),!e&&a&&this.mapControl.controls.remove(t)}},s.prototype.setControlsContainer=function(e){var t,a,r=e;e===this.selectionControl?a=this.selectionControl.getContainer():!(null===(t=r._container)||void 0===t)&&t.classList.contains("azure-maps-control-container")&&(a=r._container),a&&(this.controlsContainer=a.parentElement,d3.select(this.controlsContainer).attr("focus-nav-mode","Hierarchy"),d3.select(this.controlsContainer).attr(A.Ez,"controls"),d3.select(this.controlsContainer).attr(A.CK,"Visual_MapControls"),d3.select(this.controlsContainer).attr(A.QZ,3),d3.select(this.controlsContainer).classed(A.cy,!0),this.formatMode&&this.attachControlsListeners())},s.prototype.attachControlsListeners=function(){!this.iscontrolsListenersAttached&&this.controlsContainer&&(this.controlsContainer.style.pointerEvents="auto",this.controlsContainer.addEventListener("mouseenter",this.disableControlsDefaultEvent,!0),this.controlsContainer.addEventListener("mouseover",this.disableControlsDefaultEvent,!0),this.controlsContainer.addEventListener("focusin",this.disableControlsDefaultEvent,!0),this.controlsContainer.addEventListener("focusout",this.disableControlsDefaultEvent,!0),this.controlsContainer.classList.add("disable-azure-maps-controls-tooltips"),this.iscontrolsListenersAttached=!0)},s.prototype.removeControlsListeners=function(){this.iscontrolsListenersAttached&&this.controlsContainer&&(this.controlsContainer.removeEventListener("mouseenter",this.disableControlsDefaultEvent,!0),this.controlsContainer.removeEventListener("mouseover",this.disableControlsDefaultEvent,!0),this.controlsContainer.removeEventListener("focusin",this.disableControlsDefaultEvent,!0),this.controlsContainer.removeEventListener("focusout",this.disableControlsDefaultEvent,!0),this.controlsContainer.classList.remove("disable-azure-maps-controls-tooltips"),this.iscontrolsListenersAttached=!1)},s}(),ze=function(){function s(){}return s.enumerateMapControlProperties=function(e,t,a){var r=a.azureMapsGeocoding,i=a.azureMapsShowLabels,o={autoZoom:t.mapControls.cameraProperties.autoZoom,worldWrap:t.mapControls.styleProperties.worldWrap,showStylePicker:t.mapControls.controlToggles.showStylePicker,showNavigationControls:t.mapControls.controlToggles.showNavigationControls,defaultStyle:t.mapControls.styleProperties.defaultStyle,showSelectionControl:t.mapControls.controlToggles.showSelectionControl};t.mapControls.cameraProperties.autoZoom||(o.zoom=t.mapControls.cameraProperties.zoom,o.centerLatitude=t.mapControls.cameraProperties.centerLatitude,o.centerLongitude=t.mapControls.cameraProperties.centerLongitude,o.heading=t.mapControls.cameraProperties.heading,o.pitch=t.mapControls.cameraProperties.pitch),r&&(o.geocodingCulture=t.mapControls.geocodingCulture),i&&(o.showLabels=t.mapControls.styleProperties.showLabels),e.pushInstance({selector:null,properties:o,validValues:{centerLatitude:{numberRange:{min:-90,max:90}},centerLongitude:{numberRange:{min:Ue,max:180}},zoom:{numberRange:{min:0,max:G}},heading:{numberRange:{min:0,max:360}},pitch:{numberRange:{min:0,max:60}}},objectName:l.Do.mapControls})},s.enumerateTrafficProperties=function(e,t){e.pushInstance({selector:null,properties:{show:t.traffic.showTraffic,showIncidents:t.traffic.showIncidents,showTrafficControl:t.traffic.showTrafficControl},objectName:l.Do.traffic})},s.enumerateTileLayerProperties=function(e,t){e.pushInstance({selector:null,properties:{tileLayerUrl:t.tile.tileLayerUrl,tileSize:t.tile.tileSize,northBounds:t.tile.northBounds,southBounds:t.tile.southBounds,eastBounds:t.tile.eastBounds,westBounds:t.tile.westBounds,mapTransparency:t.tile.transparency,isTMS:t.tile.isTMS,minZoom:t.tile.minZoom,maxZoom:t.tile.maxZoom,layerPosition:t.tile.layerPosition},validValues:{tileSize:{numberRange:{min:128,max:5e3}},northBounds:{numberRange:{min:-90,max:90}},southBounds:{numberRange:{min:-90,max:90}},eastBounds:{numberRange:{min:Ue,max:180}},westBounds:{numberRange:{min:Ue,max:180}},minZoom:{numberRange:{min:0,max:G}},maxZoom:{numberRange:{min:0,max:G}}},objectName:l.Do.tileLayer})},s.enumerateFilledMapProperties=function(e,t,a,r){!a&&r&&e.pushInstance({selector:null,properties:{show:t.filledMap.showFilledMap,mapTransparency:t.filledMap.transparency,strokeColor:t.filledMap.strokeColor,strokeTransparency:t.filledMap.strokeTransparency,strokeWidth:t.filledMap.strokeWidth,minZoom:t.filledMap.minZoom,maxZoom:t.filledMap.maxZoom,layerPosition:t.filledMap.layerPosition},validValues:{minZoom:{numberRange:{min:0,max:G}},maxZoom:{numberRange:{min:0,max:G}},strokeWidth:{numberRange:{min:0,max:20}}},objectName:l.Do.filledMap})},s.enumerateBubbleLayerProperties=function(e,t,a,r){var i={show:t.bubble.showBubbleLayer};if(a&&!r){i.minBubbleRadius=t.bubble.minRadius,i.maxRadius=t.bubble.maxRadius;var o=t.bubble.radiusScalingMethod;i.radiusScalingMethod=o,1===o&&(i.logScale=t.bubble.logScale),2===o&&(i.x1=t.bubble.x1,i.x2=t.bubble.x2,i.y1=t.bubble.y1,i.y2=t.bubble.y2)}else i.bubbleRadius=t.bubble.radius;i.mapTransparency=t.bubble.transparency,r||(i.autoStrokeColor=t.bubble.autoStrokeColor),(!t.bubble.autoStrokeColor||r)&&(i.strokeColor=t.bubble.strokeColor),i.strokeTransparency=t.bubble.strokeTransparency,i.bubbleStrokeWidth=t.bubble.strokeWidth,r||(i.pitchAlignment=t.bubble.pitchAlignment,i.blur=t.bubble.blur,i.zoomScaleFactor=t.bubble.zoomScaleFactor),i.minZoom=t.bubble.minZoom,i.maxZoom=t.bubble.maxZoom,i.layerPosition=t.bubble.layerPosition,e.pushInstance({selector:null,properties:i,validValues:{bubbleRadius:{numberRange:{min:1,max:50}},minBubbleRadius:{numberRange:{min:1,max:50}},maxRadius:{numberRange:{min:1,max:50}},minZoom:{numberRange:{min:0,max:G}},maxZoom:{numberRange:{min:0,max:G}},x1:{numberRange:{min:0,max:1}},x2:{numberRange:{min:0,max:1}},y1:{numberRange:{min:0,max:1}},y2:{numberRange:{min:0,max:1}},logScale:{numberRange:{min:1,max:10}},bubbleStrokeWidth:{numberRange:{min:0,max:20}},zoomScaleFactor:{numberRange:{min:1,max:10}}},objectName:l.Do.bubbleLayer})},s.enumerateHeatMapProperties=function(e,t,a,r){if(!r){var i={show:t.heatMap.showHeatMapLayer};i.heatMapRadius=t.heatMap.heatMapRadius,i.heatMapRadiusUnit=t.heatMap.heatMapRadiusUnit,i.mapTransparency=t.heatMap.heatMapTransparency,i.heatMapIntensity=t.heatMap.heatMapIntensity,a&&(i.heatMapUseSize=t.heatMap.heatMapUseSize),i.heatMapColorLow=t.heatMap.heatMapColorLow,i.heatMapColorCenter=t.heatMap.heatMapColorCenter,i.heatMapColorHigh=t.heatMap.heatMapColorHigh,i.minZoom=t.heatMap.minZoom,i.maxZoom=t.heatMap.maxZoom,i.layerPosition=t.heatMap.layerPosition;var o=200;"meters"===i.heatMapRadiusUnit&&(o=Lt),e.pushInstance({selector:null,properties:i,validValues:{heatMapRadius:{numberRange:{min:1,max:o}},heatMapIntensity:{numberRange:{min:0,max:5}},minZoom:{numberRange:{min:0,max:G}},maxZoom:{numberRange:{min:0,max:G}}},objectName:l.Do.heatMapLayer})}},s.enumerateBarChartProperties=function(e,t,a){if(!a){var r=t.barChart.dataProperties,i=t.barChart.paintProperties,o={show:r.showBarChart,barShape:r.barShape,barHeight:i.height,scaleHeightOnZoom:i.scaleHeightOnZoom,thickness:r.thickness,scaleThicknessOnZoom:r.scaleThicknessOnZoom};o.mapTransparency=i.transparency,o.minZoom=i.minZoom,o.maxZoom=i.maxZoom,o.layerPosition=i.layerPosition,e.pushInstance({selector:null,properties:o,validValues:{minZoom:{numberRange:{min:0,max:G}},maxZoom:{numberRange:{min:0,max:G}},barHeight:{numberRange:{min:0,max:5}},thickness:{numberRange:{min:0,max:5}}},objectName:l.Do.barChart})}},s.enumerateCommonDataLayerProperties=function(e,t,a,r){var i={unselectedTransparency:t.commonDataOptions.unselectedTransparency};a&&!r&&(i.showZeros=t.commonDataOptions.showZeros,i.showNegatives=t.commonDataOptions.showNegatives,i.minDataValue=t.commonDataOptions.minDataValue,i.maxDataValue=t.commonDataOptions.maxDataValue),e.pushInstance({selector:null,properties:i,objectName:l.Do.commonDataOptions})},s.enumerateReferenceLayerProperties=function(e,t,a){e.pushInstance(a?{selector:null,properties:{additionalDatasource:t.referenceLayer.additionalDatasource},objectName:l.Do.referenceLayer}:{selector:null,properties:{additionalDatasource:{}},objectName:l.Do.referenceLayer})},s}(),nt=function(){function s(){}return s.buildSasTokenWarning=function(e){switch(e){case"UndefinedToken":return new R.U9;case"RequestError":return new R.ij;default:return new R.Vt}},s.isSasTokenWarning=function(e){switch(e.code){case"UndefinedToken":case"UnrecognizedCode":case"RequestError":return!0;default:return!1}},s.logTelemetry=function(e,t){t&&t.trace(3,"AzureMapSasToken".concat(e)),K.f.assertFail("The Azure map SAS token generation failed with error ".concat(e))},s}(),Ca=function(){function s(e){this.isDestroyed=!1,this.warnings=[],I.fF.assertValue(e,"options"),this.featureSwitches=e.featureSwitches||{},this.mapControlFactory=e.mapControlFactory,this.behavior=e.behavior,s.MapContainer=(0,x.CH)("mapControl"),this.rescaleMap=e.rescaleMap,this.isTouchEvent=!0===e.isTouchEvent,this.mapControlFactory&&this.ensureAzureMapScripts(this.mapControlFactory,this.featureSwitches.azureMapsUseMapControlV3)}return s.prototype.init=function(e){var t=this;if(I.fF.assertValue(e,"options"),this.element=e.element,this.style=e.style,this.host=e.host,this.featureSwitches=e.featureSwitches||{},this.behavior&&(this.interactivityService=(0,O.ub)(this.host,e.featureSwitches)),this.promiseFactory=this.host.promiseFactory(),this.host.locale&&(this.locale=this.host.locale()),this.currentViewport=e.viewport,this.currentViewport.scale=this.currentViewport.scale||1,this.landingPage=new nr(this.element),this.featureSwitches.azureMapsUseMapControlV3||(this.rescaleMap=!0),this.legend=(0,S.OG)(this.element,!1,this.interactivityService,!!this.behavior,void 0,this.style,this.host),this.blockExtendedLocations=!this.featureSwitches.azureMapsRegionalDataProcessingConsentEnabled,this.geocoder=this.host.geocoder(),this.geoTaggingAnalyzerService=(0,q.P)().create(e.host.getLocalizedString.bind(e.host)),this.pendingGeocodingRender=0,this.isDestroyed=!1,this.enableFilledMap=this.featureSwitches.azureMapsFilledMap,this.featureSwitches.onObject&&this.interactivityService){var r=this.host.getSubSelectionService()??m.D.createWithDefaultHost();this.subSelectionHelper=A.O5.createHtmlSubselectionHelper({hostElement:this.element.get(0),hostServices:this.host,renderer:r,targetSource:"format",scale:function(){return t.currentViewport.scale}}),this.interactivityService.setSubSelectionHelper(this.subSelectionHelper),this.behavior&&this.behavior.setSubSelectionHelper(this.subSelectionHelper)}this.geocodeBackend=1,this.featureSwitches.azureMapsDataResidency&&this.listenForUrlChange(),this.ensureMap(!1)},s.prototype.destroy=function(){if(this.isDestroyed=!0,this.mapControl)try{this.mapControl.dispose()}catch{}if(this.mapControlHelper)try{this.mapControlHelper.destroy()}catch{}this.pendingGeocodingRender&&(clearTimeout(this.pendingGeocodingRender),this.pendingGeocodingRender=0),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null),this.urlChangeSubscription&&this.urlChangeSubscription.unsubscribe()},s.prototype.getFormattingModel=function(){var e=this;if(this.data&&!this.isDestroyed){var t=this.data.properties,a=this.data.dataLabelSettings,r=function(c){return e.host.getLocalizedString(c)},i=function(c){return{groupBuilder:c,colorProps:l.MC.dataPoint,featureSwitches:e.featureSwitches,hostService:e.host,options:{dataView:e.dataView,style:e.style,categories:_.map(e.data.dataPoints,function(h){var p=h.subDataPoints[0];return{color:(0,V.ci)(p.color),displayName:h.categoryValue,identity:p.identity}}),fillInstanceKind:3}}},o=function(c){return{groupBuilder:c,dataPoints:(0,L.l3)(e.data.legendData),seriesColorProps:l.MC.dataPoint,localize:r,featureSwitches:e.featureSwitches}};return new v.Nq(function(){return Ce.getMapSettingsCard(t,e.featureSwitches,r)},function(){return Ce.getLayerSettingsCard(e.data,t,e.featureSwitches,r)},function(){return Ce.getLegendCard(e.host,e.data.legendData,e.featureSwitches,e.data)},function(){return Ce.getFilledMapCard(e.data,e.dataView,t,e.enableFilledMap,o,i,r)},function(){return Ce.getBubbleCard(e.data,e.dataView,t,o,i,e.featureSwitches,r)},function(){return Ce.getBubbleClusteringCard(e.data,e.dataView,t,e.featureSwitches,r)},function(){return Ce.getCategoryLabelCard(e.data,t,a,e.style,e.featureSwitches,r)},function(){return Ce.getHeatMapCard(e.data,t,r)},function(){return Ce.getBarChartCard(e.data,e.dataView,t,o,i,r)},function(){return Ce.getReferenceLayerCard(t,e.featureSwitches,r)},function(){return Ce.getTrafficCard(t,r)},function(){return Ce.getTileLayerCard(t,r)}).build()}},s.prototype.enumerateObjectInstances=function(e){if(this.dataView&&this.data){var t=new ht.G,a=this.data.properties,r=this.data.hasCategory&&this.data.hasSeries;switch(e.objectName){case l.Do.mapControls:ze.enumerateMapControlProperties(t,a,this.featureSwitches);break;case l.Do.traffic:ze.enumerateTrafficProperties(t,a);break;case l.Do.tileLayer:ze.enumerateTileLayerProperties(t,a);break;case l.Do.commonDataOptions:ze.enumerateCommonDataLayerProperties(t,a,this.data.hasSize,r);break;case l.Do.filledMap:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&ze.enumerateFilledMapProperties(t,a,this.data.hasSize,this.enableFilledMap);break;case l.Do.bubbleLayer:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&ze.enumerateBubbleLayerProperties(t,a,this.data.hasSize,r);break;case l.Do.heatMapLayer:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&ze.enumerateHeatMapProperties(t,a,this.data.hasSize,this.data.hasSeries);break;case l.Do.barChart:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&ze.enumerateBarChartProperties(t,a,r);break;case l.Do.referenceLayer:ze.enumerateReferenceLayerProperties(t,a,null!==a.referenceLayer.additionalDatasource)}return t.complete()}},s.prototype.getSubSelectionStyles=function(e){var r,i,a=_.first(e).visualObjects;if(a.length>0&&!_.isEmpty(a[0])){i=(r=a[0]).selectorsByColumn;var o=r.objectName;switch(o.startsWith("bubbles")&&(o=o.split("-")[0]),o){case"legend-title":return(0,L.aJ)();case"legend-items":return(0,L.Gh)(this.host);case"bubbles":return Je.getBubblesSubSelectionStyles(this.host,i);default:return}}},s.prototype.getSubSelectionShortcuts=function(e,t){if(this.featureSwitches.onObject&&!t&&!this.isDestroyed){var r=_.first(e).visualObjects;if(!(r.length>0)||_.isEmpty(r[0]))return;var o=r[0].objectName;switch(o.startsWith("bubbles")&&(o=o.split("-")[0]),o){case"legend-title":return(0,L.tV)(this.host);case"legend-items":return(0,L.tY)({hostServices:this.host,showSort:!1});case"controls":var n="".concat("mapControls","-").concat("controls");return[{type:0,relatedResetFormattingIds:[l.MC.mapControls.worldWrap,l.MC.mapControls.showStylePicker,l.MC.mapControls.showNavigationControls,l.MC.mapControls.showSelectionControl,l.MC.mapControls.geocodingCulture]},{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("mapControls"),groupUid:n},label:this.host.getLocalizedString("Format_Controls")}];case"map":var u="".concat("mapControls","-").concat("style");return[{type:0,relatedResetFormattingIds:[l.MC.mapControls.defaultStyle]},(0,y.__assign)((0,y.__assign)({type:3},l.MC.mapControls.defaultStyle),{label:this.host.getLocalizedString("Visual_AzureMapsDefaultStyle")}),{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("mapControls"),groupUid:u},label:this.host.getLocalizedString("Format_Map")}];case"bubbles":return Je.getBubblesSubSelectionShortcuts(this.host);default:return}}},s.prototype.getSubSelectables=function(e){return Je.getAllSubSelectables(this.data,this.host,this.subSelectionHelper,e)},s.prototype.getNextSubSelectable=function(e,t){return Je.getNextSubSelectable(this.data,this.host,this.subSelectionHelper,e,t)},s.prototype.onViewModeChanged=function(e){1===e&&this.mapControlHelper&&this.mapControlHelper.handleKeyboardShortcuts(this.element)},s.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},s.prototype.update=function(e){var t,a,r;return(0,y.__awaiter)(this,void 0,void 0,function(){var i,o,u,c,h,p,d,b=this;return(0,y.__generator)(this,function(M){switch(M.label){case 0:return I.fF.assertValue(e,"options"),this.visualUpdateOptions=e,this.visualSubSelections=e.subSelections,this.featureSwitches.onObject&&this.subSelectionHelper&&this.formatMode!==(i=e.formatMode)&&(this.formatMode=i,this.subSelectionHelper.setFormatMode(i),this.interactivityService&&this.interactivityService.setFormatMode(i),this.mapControlHelper&&(this.mapControlHelper.setFormatMode(i),this.subSelectionHelper.setCustomOutlineCallback(this.mapControlHelper.updateOutlinesFromSubSelections)),this.behavior&&this.behavior.setFormatMode(i)),this.dataView=e&&e.dataViews&&e.dataViews[0],o=this.data,this.warnings=_.filter(this.warnings,function(w){return nt.isSasTokenWarning(w)}),I.fF.assert(function(){return b.warnings.length<=1},"There should be at most 1 SAS token warning - on update"),this.warnings.length>0&&this.host.setWarnings(this.warnings),this.dataView?(this.toggleLandingPage(!1),e.type&ne.EP.Resize||(this.data=or.converter({dataView:this.dataView,style:this.style,geoTaggingAnalyzerService:this.geoTaggingAnalyzerService,interactivityService:this.interactivityService,featureSwitches:this.featureSwitches})),!(null===(t=this.data)||void 0===t)&&t.hasInvalidGeocodingCulture&&(this.warnings.push(new R.aV),this.host.setWarnings(this.warnings)),!(null===(a=this.data)||void 0===a)&&a.hasInvalidLatLong&&(this.warnings.push(new R.zX),this.host.setWarnings(this.warnings)),u=!1,e.resizeMode||((e.type&ne.EP.FormattingSubSelectionChange)!==ne.EP.FormattingSubSelectionChange||!this.featureSwitches.onObject)&&(u=!0),this.updateCurrentViewport(e.viewport),u?[4,this.ensureMap(!1)]:[3,2]):[3,3];case 1:if(M.sent(),null!==(r=this.data)&&void 0!==r&&r.dataPoints){for(h=[],p=0,d=c=this.data.dataPoints;p<d.length;p++)h.push.apply(h,d[p].subDataPoints);this.interactivityService&&this.interactivityService.bind(h,this.behavior,{selectableDataPoints:h,mapControl:this.mapControl,data:this.data,dataPoints:c,hostServices:this.host},{pointSourceKey:"azure-map"})}this.isDestroyed||this.onDataChangedInternal(o),M.label=2;case 2:return this.updateMapScaleAndLegend(),this.mapControl&&s.shouldCameraBeUpdated(this.data)&&e.type!==ne.EP.FormattingSubSelectionChange&&this.mapControlHelper&&this.mapControlHelper.updateCamera(this.warnings),this.updateSubSelection(e),[3,4];case 3:1===e.viewMode&&!e.visualHasData&&this.toggleLandingPage(!0),M.label=4;case 4:return[2]}})})},s.shouldCameraBeUpdated=function(e){return e.properties.mapControls.cameraProperties.autoZoom&&(e.properties.bubble.showBubbleLayer||e.properties.filledMap.showFilledMap||e.properties.barChart.dataProperties.showBarChart||e.properties.heatMap.showHeatMapLayer)},s.prototype.listenForUrlChange=function(){var e=this,t=!0;this.urlChangeSubscription=this.host.azureMapsEndpoint().getDomainUrl$().subscribe(function(){return(0,y.__awaiter)(e,void 0,void 0,function(){return(0,y.__generator)(this,function(a){switch(a.label){case 0:return t?(t=!1,[2]):[4,this.ensureMap(!0)];case 1:return a.sent(),this.isDestroyed||this.host.triggerUpdate(),[2]}})})})},s.prototype.toggleLandingPage=function(e){var t="hidden";e?this.landingPage.display():(this.landingPage.remove(),t="visible"),this.root&&(this.root[0].style.visibility=t)},s.prototype.updateCurrentViewport=function(e){e.scale=e.scale||1,(this.currentViewport.width!==e.width||this.currentViewport.height!==e.height||this.currentViewport.scale!==e.scale)&&(this.currentViewport=e)},s.prototype.updateMapScaleAndLegend=function(){this.mapControl&&this.renderLegend();var e=this.getMapViewPort();if(this.mapControlHelper&&this.mapControlHelper.updateViewportSize(e),this.mapControl&&this.mapControl.resize(e.height,e.width),this.rescaleMap){var t=this.element.children(s.MapContainer.selector);t.css("transform","scale("+1/this.currentViewport.scale+")"),t.css("transform-origin","left top")}else{var a=(window.devicePixelRatio||1)*this.currentViewport.scale;this.mapControl&&this.mapControl._getMap().setPixelRatio(a)}},s.prototype.updateSubSelection=function(e,t){if(this.mapControlHelper&&this.subSelectionHelper&&!this.isDestroyed&&this.featureSwitches.onObject&&(e.type&ne.EP.Data||e.type&ne.EP.FormattingSubSelectionChange||e.type&ne.EP.Resize||t)){var r=e.subSelections;if(this.subSelectionHelper.updateOutlinesFromSubSelections(r,!0),this.host.alertScreenReader&&e.type&ne.EP.FormattingSubSelectionChange){var o=void 0;Array.isArray(r)&&(o=r.map(function(n){return n.displayName}).join(" ")),o&&this.host.alertScreenReader(o)}}},s.prototype.getMapViewPort=function(){var e=this.currentViewport,t=this.legend.getMargins();if(this.rescaleMap){var r=this.currentViewport.scale;if(r)return{width:(e.width-t.width)*r,height:(e.height-t.height)*r}}return{width:e.width-t.width,height:e.height-t.height}},s.prototype.onDataChangedInternal=function(e){var t=!this.data.hasCategory||this.data.hasXY&&!this.data.shouldRenderFilledMap||0===this.data.dataPoints.length;if(this.mapControl){this.mapControlHelper.setData(this.data),this.mapControlHelper.updateNonDataBoundProperties(e,this.mapControlFactory,this.warnings);var a=s.haveDataFieldsBeenUpdated(e,this.data);s.shouldDataLayersBeUpdated(e,this.data,a)&&t&&this.mapControlHelper.updateDataLayers(e,a),s.shouldRedrawDataLabel(e,this.data,a)&&this.mapControlHelper.drawDataLabels()}if(!t){var o=this.data.shouldRenderFilledMap;o&&!s.isDataRepresentableByFilledMap(this.data.hasSeries,this.data.dataPoints)&&(this.warnings.push(new R.Sm),this.host.setWarnings(this.warnings)),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null),this.geocodingContext={timeout:this.promiseFactory.defer(),dataPointsRemaining:0},this.geocodingCategory=this.data.geocodingCategory;var n=o?(0,X.o)(this.data.geocodingCategory,this.data.dataPoints.length):null;this.geocodingContext.dataPointsRemaining=this.data.dataPoints.length;for(var u=0,c=this.data.dataPoints;u<c.length;u++){var h=c[u];h.location?o&&!h.paths?this.enqueueGeoShape(this.geocodingContext,h,n):this.increaseGeocodingCountAndRedraw(this.geocodingContext):h.queryLocation?o?this.enqueueGeocodingAndGeoShape(this.geocodingContext,h,n,this.data):this.enqueueGeocoding(this.geocodingContext,h,this.data):this.geocodingFailed(this.geocodingContext)}}},s.prototype.enqueueGeocoding=function(e,t,a){var r=this,i=function(n){r.completeGeocoding(e,t,n)};this.geocoder.tryGeocodeImmediate(t.queryLocation,this.geocodeBackend,this.featureSwitches.geocoderIndexedDB,this.host.geocoderIndexedDB(),this.blockExtendedLocations).then(function(o){r.initiateGeocoding(o,i,t,e,a)},function(o){r.initiateGeocoding(void 0,i,t,e,a)})},s.prototype.enqueueGeoShape=function(e,t,a){var r=this;I.fF.assertValue(t.location,"cachedLocation"),this.geocoder.tryGeocodeBoundaryImmediate({latitude:t.location.latitude,longitude:t.location.longitude,category:this.geocodingCategory,levelOfDetail:a.level,maxGeoData:a.maxPolygons,entityType:t.location.entityType},this.geocodeBackend,this.featureSwitches.geocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(i){r.initiateGeoboundary(i,t,e,a)},function(i){r.initiateGeoboundary(void 0,t,e,a)})},s.prototype.enqueueGeocodingAndGeoShape=function(e,t,a,r){var i=this,o=function(u){i.completeGeoCodeAndGeoShape(e,t,a,u)};this.geocoder.tryGeocodeImmediate(t.queryLocation,this.geocodeBackend,this.featureSwitches.geocoderIndexedDB,this.host.geocoderIndexedDB(),this.blockExtendedLocations).then(function(n){i.initiateGeocoding(n,o,t,e,r)},function(n){i.initiateGeocoding(void 0,o,t,e,r)})},s.prototype.initiateGeocoding=function(e,t,a,r,i){var o=this;e?void 0===e.latitude||void 0===e.longitude?this.geocodingFailed(r):t(e):this.getBackendCredential().then(function(n){var u=n.credentials,c=n.credentialType;o.isDestroyed||o.geocoder.geocode(a.queryLocation,o.geocodeBackend,o.featureSwitches.geocoderIndexedDB,o.host.geocoderIndexedDB(),{timeout:r.timeout.promise,credentials:u,credentialType:c,instanceId:o.host.instanceId},o.blockExtendedLocations).then(function(h){!o.isDestroyed&&r===o.geocodingContext&&((0,X.N2)(h,!0)?(i.hasInvalidLatLong||(o.warnings.push(new R.zI),o.host.setWarnings(o.warnings)),i.hasInvalidLatLong=!0,o.geocodingFailed(r)):t(h))},function(h){return o.geocodingFailed(r)})})},s.prototype.initiateGeoboundary=function(e,t,a,r){var i=this;e?this.completeGeoShape(a,t,e):this.getBackendCredential().then(function(o){var n=o.credentials,u=o.credentialType;i.isDestroyed||i.geocoder.geocodeBoundary({latitude:t.location.latitude,longitude:t.location.longitude,category:i.geocodingCategory,levelOfDetail:r.level,maxGeoData:r.maxPolygons,entityType:t.location.entityType},i.geocodeBackend,i.featureSwitches.geocoderIndexedDB,i.host.geocoderIndexedDB(),{timeout:a.timeout.promise,credentials:n,credentialType:u}).then(function(c){!i.isDestroyed&&c&&a===i.geocodingContext&&i.completeGeoShape(a,t,c)},function(c){return i.geocodingFailed(a)})})},s.prototype.getBackendCredential=function(){var e=this;return new Promise(function(t,a){e.sasTokenCallback(t,a,null)}).then(function(t){return{credentials:t,credentialType:"sasToken"}})},s.prototype.completeGeocoding=function(e,t,a){t.location=a,this.increaseGeocodingCountAndRedraw(e)},s.prototype.completeGeoShape=function(e,t,a){if(1===this.geocodeBackend)t.geojsonPolygons=a.geoJsonPolygons;else{t.paths=[];for(var r=0,i=a.locations;r<i.length;r++){var o=i[r];o.nativeBing&&!o.geographic&&(o.geographic=(0,X.Bo)(o.nativeBing)),o.geographic&&o.geographic.length>2&&t.paths.push(o)}}this.increaseGeocodingCountAndRedraw(e)},s.prototype.completeGeoCodeAndGeoShape=function(e,t,a,r){t.location=r,this.enqueueGeoShape(e,t,a)},s.prototype.increaseGeocodingCountAndRedraw=function(e){e===this.geocodingContext&&(--e.dataPointsRemaining,this.scheduleRedraw())},s.prototype.geocodingFailed=function(e){this.isDestroyed||e!==this.geocodingContext||--e.dataPointsRemaining<=0&&this.scheduleRedraw()},s.prototype.scheduleRedraw=function(){var e=this;this.pendingGeocodingRender&&this.geocodingContext&&this.geocodingContext.dataPointsRemaining<=0&&(clearTimeout(this.pendingGeocodingRender),this.pendingGeocodingRender=0),this.pendingGeocodingRender||(this.pendingGeocodingRender=setTimeout(function(){e.mapControlHelper.updateDataLayers(null,!0),s.shouldCameraBeUpdated(e.data)&&e.mapControlHelper.updateCamera(e.warnings),e.mapControlHelper.drawDataLabels(),e.pendingGeocodingRender=0},this.geocodingContext&&this.geocodingContext.dataPointsRemaining<=0?0:s.ScheduleRedrawInterval))},s.prototype.renderLegend=function(){var e,t=null===(e=this.data)||void 0===e?void 0:e.legendData;t&&(this.legend.setPosition(t.position),this.legend.drawLegend({data:t,parentViewport:this.currentViewport,onObject:this.featureSwitches.onObject,titleSliceUid:"".concat("legend","-").concat("title","-titleText")}),(0,z.xz)(d3.select(this.element.children(s.MapContainer.selector)[0]),this.legend))},s.haveDataFieldsBeenUpdated=function(e,t){var a=this;return!(!_.isEmpty(e)&&e.dataPoints.length===t.dataPoints.length&&e.hasCategory===t.hasCategory&&e.hasSeries===t.hasSeries)||t.dataPoints.some(function(r,i){return a.isPointUpdated(e.dataPoints[i],r)})},s.isPointUpdated=function(e,t){var a=this;return t.bubbleRadius!==e.bubbleRadius||this.isLocationUpdated(e.location,t.location)||t.subDataPoints.length!==e.subDataPoints.length||t.subDataPoints.some(function(r,i){return a.isSubPointUpdated(e.subDataPoints[i],r)})},s.isSubPointUpdated=function(e,t){return t.size!==e.size||t.color!==e.color||!t.identity.equals(e.identity)},s.isLocationUpdated=function(e,t){return!(!e&&!t||e&&t&&e.latitude===t.latitude&&e.longitude===t.longitude)},s.shouldDataLayersBeUpdated=function(e,t,a){return a||!_.isEqual(e.properties.filledMap,t.properties.filledMap)||!_.isEqual(e.properties.barChart,t.properties.barChart)||!_.isEqual(e.properties.bubble,t.properties.bubble)||!_.isEqual(e.properties.heatMap,t.properties.heatMap)||!_.isEqual(e.properties.commonDataOptions,t.properties.commonDataOptions)},s.shouldRedrawDataLabel=function(e,t,a){return a||_.isEmpty(e)||!_.isEqual(e.dataLabelSettings,t.dataLabelSettings)||!_.isEqual(e.properties.bubble,t.properties.bubble)},s.prototype.ensureAzureMapScripts=function(e,t){return this.isSdkReady||(this.isSdkReady=e.loadAzureMapScripts(t)),this.isSdkReady},s.prototype.ensureMap=function(e){var t=this;return this.ensuringAzMap&&!e||(this.mapControlFactory||(this.mapControlFactory=(0,X.$f)(this.promiseFactory,this.host.loader())),this.ensuringAzMap=this.ensureAzureMapScripts(this.mapControlFactory,this.featureSwitches.azureMapsUseMapControlV3).then(function(r){return t.createMapControl()},function(r){return t.showMapLoadError()})),this.ensuringAzMap},s.prototype.showMapLoadError=function(){this.isDestroyed||(K.f.error("The Azure Map control could not be loaded",!0,void 0,{}),this.warnings.push(new R._7),this.host.setWarnings(this.warnings))},s.isDataRepresentableByFilledMap=function(e,t){if(!e)return!0;for(var a=function(c){var h=c.subDataPoints.map(function(d){return d.color});if(!h.every(function(d){return d===h[0]}))return{value:!1}},r=0,i=t;r<i.length;r++){var n=a(i[r]);if("object"==typeof n)return n.value}return!0},s.prototype.createMapControl=function(){var e,t=this,a=this.promiseFactory.defer();if(this.isDestroyed)return a.resolve(),a.promise;if(this.mapControlFactory.isAzureMapSupported()){this.root||(this.root=(0,k.hi)().addClass(s.MapContainer.class).css("position","absolute").css("width","100%").css("height","100%").appendTo(this.element[0])),this.root[0].setAttribute("visibility","visible");var i=(e=this.data&&this.data.properties&&this.data.properties.mapControls&&this.data.properties.mapControls.styleProperties||{}).defaultStyle,o=e.showLabels,n=e.worldWrap,c={element:this.root[0],locale:this.locale,sasTokenCallback:function(g,b,M){return t.sasTokenCallback(g,b,M)},azureMapsDataResidency:this.featureSwitches.azureMapsDataResidency,azureMapsEndpoint:this.host.azureMapsEndpoint(),isScreenshotWorkload:this.featureSwitches.azureMapsScreenshot&&this.host.isScreenshotWorkload(),progressiveLoading:this.featureSwitches.azureMapsProgressiveLoading,defaultStyle:i,showLabels:o,renderWorldCopies:n,preserveDrawingBufferForExport:this.featureSwitches.azureMapsPreserveDrawingBufferForExport},h=this.mapControlFactory.createAzureMapControl(c),p=h.getMapContainer();p.setAttribute("drag-resize-disabled","true"),d3.select(p).attr(A.Ez,"map"),d3.select(p).attr(A.CK,"Map_ToolTip"),d3.select(p).attr(A.QZ,3),d3.select(p).classed(A.cy,!0),d3.select(p).attr("focus-nav-mode","HierarchicalTabOrder"),$(".atlas-map-canvas").attr("focus-nav-mode","Browser");var d=this;h.events.add("ready",function(){d.mapControl=h,d.mapControlHelper=new mr(h,d.host,d.featureSwitches,d.behavior,d.style,d.isTouchEvent),d.mapControlHelper.setupMap(d.element),d.root.children(".atlas-control-container").css("z-index","1"),a.resolve()}),h.events.add("movestart",function(f){return t.updateSubSelectionOnMapInteraction([])}),h.events.add("moveend",function(f){return t.updateSubSelectionOnMapInteraction(t.visualSubSelections)})}else K.f.error("The browser is not supported by the current Azure Maps control, skipping map load",!0,void 0,{browser:window.navigator.userAgent}),this.warnings.push(new R.aj),this.host.setWarnings(this.warnings),a.reject();return a.promise},s.prototype.updateSubSelectionOnMapInteraction=function(e){this.visualUpdateOptions.subSelections=e,this.updateSubSelection(this.visualUpdateOptions,!0)},s.prototype.sasTokenCallback=function(e,t,a){var r=this;this.isDestroyed||this.host.getAzureMapToken().then(function(i){if(i&&i.accountSasToken){var o=_.remove(r.warnings,function(n){return nt.isSasTokenWarning(n)});I.fF.assert(function(){return o.length<=1},"There should be at most 1 SAS token warning - on success"),o.length>0&&r.host.setWarnings(r.warnings),e(i.accountSasToken)}else r.rejectSasTokenWithWarning(i&&i.error?i.error:"UndefinedToken",t)},function(i){r.rejectSasTokenWithWarning(i,t)})},s.prototype.rejectSasTokenWithWarning=function(e,t){var a=_.remove(this.warnings,function(i){return nt.isSasTokenWarning(i)});I.fF.assert(function(){return a.length<=1},"There should be at most 1 SAS token warning - on failure");var r=nt.buildSasTokenWarning(e);this.warnings.push(r),this.host.setWarnings(this.warnings),nt.logTelemetry(e,this.host.telemetry()),t(e)},s.prototype.setMapControl=function(e){this.mapControl=e},s.prototype.setMapControlHelper=function(e){this.mapControlHelper=e},s.ScheduleRedrawInterval=3e3,s}();function br(){return new ar}function Cr(s){return new Ca(s)}},79476:function(Mt,Ae,B){B.d(Ae,{ao:function(){return V},fS:function(){return X},oY:function(){return R}});var y=B(19377);function X(k,x){return null!=k&&null!=x&&k.x===x.x&&k.y===x.y}function R(k,x,I){var q=(x.y-k.y)*(I.x-x.x)-(x.x-k.x)*(I.y-x.y);return 0===q?y.i.Colinear:q>0?y.i.Clockwise:y.i.Counterclockwise}function V(k,x,I){return I.x<=Math.max(k.x,x.x)&&I.x>=Math.min(k.x,x.x)&&I.y<=Math.max(k.y,x.y)&&I.y>=Math.min(k.y,x.y)}},92379:function(Mt,Ae,B){B.d(Ae,{m:function(){return ht}});var y=B(19377),l=B(79476),X=B(80758),ht=function(){function A(m){m&&(this.polygonPoints=this.convertArrayPathToPoints(m))}return A.fromPolygonPoints=function(m){var S=new A(null);return S.polygonPoints=m,S},A.prototype.absoluteCentroid=function(){return null==this._absoluteCentroid&&(this._absoluteCentroid=this.calculatePolygonCentroid()),this._absoluteCentroid},A.prototype.absoluteBoundingRect=function(){return null==this._absoluteBoundingRect&&(this._absoluteBoundingRect=this.calculateBoundingRect()),this._absoluteBoundingRect},A.prototype.contains=function(m){var L={x:m.left+m.width,y:m.top},z={x:m.left,y:m.top+m.height},O={x:m.left+m.width,y:m.top+m.height};return this.inside({x:m.left,y:m.top})&&this.inside(L)&&this.inside(z)&&this.inside(O)},A.prototype.conflicts=function(m){if(!this.isConflictWithBoundingBox(m))return!1;var L={x:m.left+m.width/2,y:m.top},z={x:m.left+m.width,y:m.top},O={x:m.left,y:m.top+m.height},R={x:m.left+m.width/2,y:m.top+m.height},V={x:m.left+m.width,y:m.top+m.height},k={x:m.left,y:m.top+m.height/2},x={x:m.left+m.width,y:m.top+m.height/2};return this.inside({x:m.left,y:m.top})||this.inside(L)||this.inside(z)||this.inside(O)||this.inside(R)||this.inside(V)||this.inside(k)||this.inside(x)},A.prototype.lineIntersectionPoint=function(m,S){for(var L=0;L<this.polygonPoints.length;L++){var R=this.getLineIntersection(m,S,this.polygonPoints[L],L===this.polygonPoints.length-1?this.polygonPoints[0]:this.polygonPoints[L+1]);if(null!==R)return R}return null},A.calculateAbsolutePolygonArea=function(m){var S,L=1,z=0;for(S=0;S<m.length;S++)z+=m[S].x*m[L].y-m[L].x*m[S].y,L=(L+1)%m.length;return.5*z},A.prototype.overlapPath=function(m){if(this.inside({x:m[0],y:m[1]}))return!0;var S=new A(m);if(S.inside(this.polygonPoints[0]))return!0;for(var L=0;L<this.polygonPoints.length;L++)if(S.lineIntersectionPoint(this.polygonPoints[L],this.polygonPoints[(L+1)%this.polygonPoints.length]))return!0;return!1},A.prototype.inside=function(m){for(var S=m.x,L=m.y,z=!1,O=0,R=this.polygonPoints.length-1;O<this.polygonPoints.length;R=O++){var V=this.polygonPoints[O].x,k=this.polygonPoints[O].y,I=this.polygonPoints[R].y;k>L!=I>L&&S<(this.polygonPoints[R].x-V)*(L-k)/(I-k)+V&&(z=!z)}return z},A.translateX=function(m,S){for(var L=new Float64Array(2*m.polygonPoints.length),z=0;z<m.polygonPoints.length;z++)L[2*z]=m.polygonPoints[z].x+S,L[2*z+1]=m.polygonPoints[z].y;return new A(L)},A.polygonBoundsOverlap=function(m,S){var L=(0,X.WN)(A.getPolyBoundLeft(m),A.getPolyBoundRight(m),A.getPolyBoundLeft(S),A.getPolyBoundRight(S)),z=(0,X.WN)(A.getPolyBoundLower(m),A.getPolyBoundUpper(m),A.getPolyBoundLower(S),A.getPolyBoundUpper(S));return L&&z},A.circleRectangleOverlap=function(m,S,L){var z=Math.max(m.left,Math.min(S.x,m.right)),O=Math.min(m.bottom,Math.max(S.y,m.top)),R=z-S.x,V=O-S.y;return R*R+V*V<=L*L},A.linesIntersect=function(m,S,L,z,O){void 0===O&&(O=!0);var R=(0,l.oY)(m,S,L),V=(0,l.oY)(m,S,z),k=(0,l.oY)(L,z,m),x=(0,l.oY)(L,z,S);return R!==V&&k!==x||!!O&&!!(R===y.i.Colinear&&(0,l.ao)(m,S,L)||V===y.i.Colinear&&(0,l.ao)(m,S,z)||k===y.i.Colinear&&(0,l.ao)(L,z,m)||x===y.i.Colinear&&(0,l.ao)(L,z,S))},A.resize=function(m,S){if(0===S)return m;for(var L=A.calculateAbsolutePolygonArea(m.polygonPoints)>0,O=_.clone(S>0&&!0===L||S<0&&!1===L?m.polygonPoints.reverse():m.polygonPoints),R=m.absoluteCentroid(),V=[],k=0;k<O.length;k++){var x=O[k],I=O[(k+1)%O.length],q=I.y-x.y,K=void 0;0!==q&&(K=-(I.x-x.x)/q);var v=0;_.isUndefined(K)||(v=(x.y<I.y?-1:1)*Math.sqrt(S*S/(1+K*K)));var ne=0;0===v?ne=(x.x>I.x?-1:1)*S:_.isUndefined(K)||(ne=K*v);var j={x:x.x+v,y:x.y+ne},ee={x:0,y:0};0===K?(ee.x=j.x,ee.y=j.y+10):_.isUndefined(K)||(ee.x=j.x+10,ee.y=j.y-10/K);var Ie=(j.x-ee.x)*(R.y-x.y)-(j.y-ee.y)*(R.x-x.x);if(0!==Ie){var he={x:((j.x*ee.y-j.y*ee.x)*(R.x-x.x)-(j.x-ee.x)*(R.x*x.y-R.y*x.x))/Ie,y:((j.x*ee.y-j.y*ee.x)*(R.y-x.y)-(j.y-ee.y)*(R.x*x.y-R.y*x.x))/Ie};isFinite(he.x)&&isFinite(he.y)&&V.push(he)}}return A.fromPolygonPoints(V)},A.getPolyBoundLeft=function(m){var S;return null===(S=_.minBy(m.polygonPoints,function(L){return L.x}))||void 0===S?void 0:S.x},A.getPolyBoundRight=function(m){var S;return null===(S=_.maxBy(m.polygonPoints,function(L){return L.x}))||void 0===S?void 0:S.x},A.getPolyBoundUpper=function(m){var S;return null===(S=_.maxBy(m.polygonPoints,function(L){return L.y}))||void 0===S?void 0:S.y},A.getPolyBoundLower=function(m){var S;return null===(S=_.minBy(m.polygonPoints,function(L){return L.y}))||void 0===S?void 0:S.y},A.prototype.isConflictWithBoundingBox=function(m){return(0,X.HL)(this.absoluteBoundingRect(),m)},A.prototype.calculatePolygonCentroid=function(){var m,S,L,z,O,R;for(m=A.calculateAbsolutePolygonArea(this.polygonPoints),L=z=0,R=1,O=0;O<this.polygonPoints.length;O++)L+=(this.polygonPoints[O].x+this.polygonPoints[R].x)*(S=this.polygonPoints[O].x*this.polygonPoints[R].y-this.polygonPoints[R].x*this.polygonPoints[O].y),z+=(this.polygonPoints[O].y+this.polygonPoints[R].y)*S,R=(R+1)%this.polygonPoints.length;return{x:L/=6*m,y:z/=6*m}},A.prototype.calculateBoundingRect=function(){for(var m=Number.POSITIVE_INFINITY,S=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,z=Number.NEGATIVE_INFINITY,O=0,R=this.polygonPoints;O<R.length;O++){var V=R[O];V.x<m?m=V.x:V.x>L&&(L=V.x),V.y<S?S=V.y:V.y>z&&(z=V.y)}return{left:m,top:S,width:L-m,height:z-S}},A.prototype.getLineIntersection=function(m,S,L,z){var O=m.x,R=m.y,x=L.x,I=L.y,v=S.x-O,ne=S.y-R,j=z.x-x,ee=z.y-I,Ie=(-ne*(O-x)+v*(R-I))/(-j*ne+v*ee),he=(j*(R-I)-ee*(O-x))/(-j*ne+v*ee);return Ie>=0&&Ie<=1&&he>=0&&he<=1?{x:O+he*v,y:R+he*ne}:null},A.prototype.convertArrayPathToPoints=function(m){for(var S=[],L=0;L<m.length;L+=2)S.push({x:m[L],y:m[L+1]});return S},A}()},19377:function(Mt,Ae,B){B.d(Ae,{i:function(){return y}});var y=function(l){return l[l.Clockwise=0]="Clockwise",l[l.Counterclockwise=1]="Counterclockwise",l[l.Colinear=2]="Colinear",l}({})}}]);