"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["qnaweb"],{65947:function(F,w,a){a.d(w,{z:function(){return d}});var d=new(a(50423).InjectionToken)("QnaModelUtilsPath")},12123:function(F,w,a){a.d(w,{n:function(){return d}});var d=new(a(50423).InjectionToken)("QnaProxyPath")},1931:function(F,w,a){a.d(w,{T:function(){return K}});var f=a(77476),d=a(52910),A=a(13052),l=a(31109),b=a(32288),Q=a(76521),M=a(40516),R=a(84497),D=a(95859),E=a(46544),U=a(52950),C=a(47231),T=a(50423),K=function(){function x(){}return x.\u0275fac=function(j){return new(j||x)},x.\u0275mod=T.\u0275\u0275defineNgModule({type:x}),x.\u0275inj=T.\u0275\u0275defineInjector({imports:[f.CommonModule,d.O,A.T,l.F,b.J,Q.A3,M.h,R.L,D.v,E.e3,U.g,C.c]}),x}()},15671:function(F,w,a){a.r(w),a.d(w,{QnaWebModule:function(){return ht}});var f=a(1931),d=a(50423),A=function(){function t(){}return t.prototype.improveLinguisticSchema=function(e){throw new Error("Method not implemented.")},t.prototype.cancelImproveLinguisticSchema=function(){throw new Error("Method not implemented.")},t.\u0275prov=d.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac=function(n){return new(n||t)}}),t}(),l=a(62458),Q=function(){function t(){this.cache=new Map,this.expirationInMilliseconds=6e4}return t.prototype.initialize=function(e){null!=e&&(this.expirationInMilliseconds=e)},t.prototype.getInterpretResponse=function(e){l.fF.assertValue(e,"Expect the given request to be defined");var n=M(e),o=this.getCacheResult(n,this.cache);return o?{response:o.response,requestId:o.requestId}:void 0},t.prototype.setInterpretResponse=function(e,n,o){l.fF.assertValue(e,"Expect the given request to be defined"),l.fF.assertValue(n,"Expect the given response to be defined");var r=M(e);this.cache.set(r,{response:n,requestId:o,expiration:Date.now()+this.expirationInMilliseconds}),this.removeExpiredEntriesAfterTimeout()},t.prototype.clear=function(){this.cache.clear()},t.prototype.removeExpiredEntriesAfterTimeout=function(){var e=this;this.removeExpiredEntriesTimeout||(this.removeExpiredEntriesTimeout=setTimeout(function(){clearTimeout(e.removeExpiredEntriesTimeout);var n=Date.now(),o=!1;for(var r in e.cache)e.cache[r].expiration<n?delete e.cache[r]:o=!0;o&&e.removeExpiredEntriesAfterTimeout()},this.expirationInMilliseconds))},t.prototype.getCacheResult=function(e,n){var o=n.get(e);if(o){if(!(o.expiration<Date.now()))return o;this.cache.delete(e)}},t.\u0275prov=d.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac=function(n){return new(n||t)}}),t}();function M(t){return[t.Utterance,R(t.Options),D(t.Context),t.Version].join("::")}function R(t){var e="";if(!_.isEmpty(t)){var n=[],o=[];for(var r in t){var i=t[r];!0===i?n.push(r):!1===i&&o.push(r)}_.isEmpty(n)||(e+="+"+n.join(",")),_.isEmpty(o)||(e+="-"+o.join(","))}return"Options:"+(_.isEmpty(e)?"-":e)}function D(t){var e="";return _.isEmpty(t)||(e+=_.isEmpty(t.ModelScopes)?"":JSON.stringify(t.ModelScopes),e+=t.ImpersonatedUserPrincipalName,_.isEmpty(t.ImpersonatedRoles)||(e+=JSON.stringify(t.ImpersonatedRoles))),"Context:"+(_.isEmpty(e)?"-":e)}var E=a(35988),U=a(8590),C=a(11547),T=a(14172),H=a(59822),K=a(70032),x=a(81905),Y=a(73875),j=a(46381),k=a(11494),q="/explore/qna/interpret/",ee=function(){function t(e,n,o,r){var i=this;this.httpService=e,this.impersonationService=n,this.eventBridge=o,this.interpretCache=r,this.retryId=0,this.eventBridge.createChannelSubscriptionManager().subscribe(U.uff,function(){i.interpretCache.clear()}).subscribe(U.CCe,function(){i.interpretCache.clear()})}return t.prototype.convertToWireInterpretRequest=function(e){return(0,C.of)(E.fL(e))},t.prototype.getOverwriteResponseModelInfo=function(e){},t.prototype.probe=function(e){l.fF.assertValue(!_.isEmpty(e),"Expect the given modelScopes is not empty");var n=this.httpService.powerbiRequestOptions(void 0,"InterpretProbe");n.timeout=6e4;var o={Utterance:"",Version:"3.3.0",Context:{ModelScopes:e},Options:{SupportPodQueries:!0}};return this.addImpersonationToRequest(o),this.httpService.post(q,o,n).pipe((0,T.U)(function(r){return r.error?{error:J(r.error,r.requestId)}:E.Cb(r.data)}),(0,H.K)(function(r){var i=te(r);return(0,C.of)({error:i})}))},t.prototype.interpret=function(e,n,o){var r=this;l.fF.assertValue(e,"Expect the given wireRequest to be defined");var i=function(t){var e;return!(O(t)||!_.isEmpty(t.Spans)||!_.isEmpty(t.LinguisticSchemaJson)||!_.isEmpty(t.InferredTermBinding)||_.some(null===(e=t.Context)||void 0===e?void 0:e.Tags,function(n){return _.indexOf(["AskToAdd","Committed","Paused"],n)>=0}))}(e)?this.interpretCache.getInterpretResponse(e):void 0;if(i)return this.createResponse(!0,e,i.response,i.requestId);var s=this.httpService.powerbiRequestOptions(void 0,"Interpret");return s.timeout=25e3,this.addImpersonationToRequest(e),this.httpService.post(q,e,s).pipe((0,K.g)(this.retryId>0?1e3:0),(0,x.w)(function(u){if(u.error){var v=J(u.error,u.requestId);return O(e)?(0,C.of)({error:v}):(0,C.of)({utterance:e.Utterance,error:v})}var p=E.oA(u.data);if(n){var c=E.pk(p);if(c&&r.retryId<=8)return r.retryId++,o&&o.reportLoading({warning:c}),r.interpret(e,n,o)}return r.retryId=0,function(t,e){return!(O(t)||!e||_.some(e.Results,function(n){return _.some(n.DiagnosticMessages,function(o){return 0!==o.Severity})}))}(e,p)&&r.interpretCache.setInterpretResponse(e,p,u.requestId),r.createResponse(!1,e,p,u.requestId)}),(0,H.K)(function(u){return(0,C.of)(function(t,e){var n=te(e);return O(t)?{error:n}:{utterance:t.Utterance,error:n}}(e,u))}))},t.prototype.createResponse=function(e,n,o,r){return O(n)?function(t){return l.fF.assertValue(t,"Expect the given wireResponse to be defined"),(0,C.of)(E.B4(t))}(o):function(t,e,n,o){l.fF.assertValue(e,"Expect the given wireResponse to be defined");var r=E.R1(t.Utterance,t.DesiredSuggestedUtteranceCount,o,e);return r.fromCache=n,(0,C.of)(r)}(n,o,e,r)},t.prototype.addImpersonationToRequest=function(e){if(e&&this.impersonationService&&this.impersonationService.impersonating){l.fF.assertValue(e.Context,"interpretRequest.Context should be defined");var n=this.impersonationService.getImpersonationState();e.Context.ImpersonatedRoles=n.impersonatedRoles,e.Context.ImpersonatedUserPrincipalName=n.impersonatedUserPrincipalName}},t.\u0275fac=function(n){return new(n||t)(d.\u0275\u0275inject(Y.O),d.\u0275\u0275inject(j.h),d.\u0275\u0275inject(k.J),d.\u0275\u0275inject(Q))},t.\u0275prov=d.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}();function O(t){var e;return l.fF.assertValue(t,"Expect the given wireRequest to be defined."),null===(e=t?.Options)||void 0===e?void 0:e.SuggestedUtterances}function te(t){return J(t?.error,t?.requestId)}function J(t,e){var n,o,r,i,s=t?.["pbi.error"];return"NetworkConnectionIssue"===(null!==(n=t?.code)&&void 0!==n?n:s?.code)&&(r="NetworkConnectionIssue",i="User"),null==i&&(i=1===s?.exceptionCulprit?"User":"PowerBI"),null==r&&(r="GenericRequestFailure"),{errorCode:r,source:i,message:t?.message,stackTrace:null===(o=t?.innererror)||void 0===o?void 0:o.trace,requestId:e}}var m=a(81337),Se=a(35510),ne=a(9380),re=a(5708),G=a(43286),B=a(65181),Ie=new d.InjectionToken("QnaInterpretProxyService"),N=a(46544),Ee=a(5894),Ce={en:{resStringSuffix:"_English"},es:{resStringSuffix:"_Spanish",preview:!0}};function we(t,e){var n=function(t){var e;if(_.isEmpty(t))return e;for(var n=0,o=t;n<o.length;n++){var r=o[n];if(e&&r.language!==e){e=void 0;break}e=r.language}return e}(e);return function(t,e){var n="";if(t){var o=!1,r=oe(e.currentLanguageLocale);t=oe(t);var i=Ce[t];i&&(n=i.resStringSuffix,o=i.preview),!o&&t===r&&(n="")}return e.get("Qna_Input_Placeholder"+n)}(n,t)}function oe(t){if(t)return t.split("-")[0].toLowerCase()}function De(t,e,n,o){return new Ae(t,e,n,o)}var Ae=function(){function t(e,n,o,r){this.featureSwitchService=e,this.localizationService=n,this.telemetryService=o,this.interpretProxy=r,this.answeredQuestionDataLoggerFactory=new Ve(this.telemetryService,3e3)}return t.prototype.sendFeedback=function(e,n,o,r){return(0,m.mG)(this,void 0,void 0,function(){var i,s;return(0,m.Jh)(this,function(u){switch(u.label){case 0:return i=this.constructInterpretRequest(n,void 0,o,void 0,{tags:r},void 0,e),[4,this.interpretProxy.convertToWireInterpretRequest(i).toPromise()];case 1:return s=u.sent(),this.interpretProxy.interpret(s,!1),[2]}})})},t.prototype.interpret=function(e,n,o,r,i,s,u,v){var p=this;if(l.fF.assertValue(i,"interpretListener"),_.isEmpty(n))return(0,C.of)(void 0);var c=Date.now(),g=this.answeredQuestionDataLoggerFactory.startLogger(),h={contentProviderType:"Unknown",entryPoint:o,tags:_.isEmpty(u?.tags)?void 0:u.tags.join(",")};u?.isQuestionNotCommitted||i.onInterpretIssued();var P=this.generateRequestOptions(s),I=this.constructInterpretRequest(n,P,r,e,u,v),V={reportLoading:function(z){p.notifyInterpretListenerRetry(i,z.warning)}},W=this.interpretProxy.getOverwriteResponseModelInfo(I);return this.interpretProxy.convertToWireInterpretRequest(I).pipe((0,x.w)(function(L){return p.interpretProxy.interpret(L,!0,V).pipe((0,T.U)(function(z){var Z,X,ce=Date.now();ie(z);var y=z;if(p.checkToOverwriteResponseModelInfo(y,W),p.notifyInterpretListenerResult(i,y,!!u?.isQuestionNotCommitted,I),h.fromCache=!!y.fromCache,y.error?p.logAnsweredQuestionDataOnError(g,c,ce,y?.requestId,null===(X=null===(Z=y?.error)||void 0===Z?void 0:Z.errorCode)||void 0===X?void 0:X.toString(),h):p.logAnsweredQuestionDataWithInterpretResult(g,c,ce,y?.requestId,I.scopes,y,h),y?.warnings){var gt=(0,E.vr)(y.warnings);_.remove(y.warnings,function(yt){return _.find(gt,function(mt){return mt.warning===yt})}),h.warnings=y.warnings.join("|")}return y}))}))},t.prototype.sendTags=function(e,n,o,r,i){var s,u;return(0,m.mG)(this,void 0,void 0,function(){var v,p,c,g,h,P,I,V,W,S;return(0,m.Jh)(this,function(L){switch(L.label){case 0:return l.fF.assertNonEmpty(e,"Expect this be called only when tags is not empty"),_.isEmpty(e)?[2]:(v=Date.now(),p=this.answeredQuestionDataLoggerFactory.startLogger(),c={contentProviderType:"Unknown",entryPoint:o,tags:_.isEmpty(e)?void 0:e.join(","),fromCache:!1},g=this.generateRequestOptions(i),h=this.constructInterpretRequest(n,g,r,void 0,{tags:e}),P=this.interpretProxy.getOverwriteResponseModelInfo(h),[4,this.interpretProxy.convertToWireInterpretRequest(h).toPromise()]);case 1:return I=L.sent(),[4,this.interpretProxy.interpret(I,!1).toPromise()];case 2:return V=L.sent(),W=Date.now(),ie(V),this.checkToOverwriteResponseModelInfo(S=V,P),S.error?this.logAnsweredQuestionDataOnError(p,v,W,S?.requestId,null===(u=null===(s=S?.error)||void 0===s?void 0:s.errorCode)||void 0===u?void 0:u.toString(),c):this.logAnsweredQuestionDataWithInterpretResult(p,v,W,S?.requestId,h.scopes,S,c),[2]}})})},t.prototype.getSuggestedQuestions=function(e){var n=this,r=this.constructInterpretRequest("",2048,e);return this.interpretProxy.convertToWireInterpretRequest(r).pipe((0,x.w)(function(s){return n.interpretProxy.interpret(s,!0).pipe((0,T.U)(function(u){return function(t){l.fF.assert(function(){return!t.hasOwnProperty("utterance")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "utterance".'),l.fF.assert(function(){return!t.hasOwnProperty("requestId")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "requestId".'),l.fF.assert(function(){return!t.hasOwnProperty("fromCache")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "fromCache".');var e=t;e.result&&l.fF.assert(function(){return e.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(u),u}))}))},t.prototype.getSuggestedDefineCalculationQuestions=function(e){var n=this,r=this.constructInterpretRequest("",16384,e);return this.interpretProxy.convertToWireInterpretRequest(r).pipe((0,x.w)(function(s){return n.interpretProxy.interpret(s,!0).pipe((0,T.U)(function(u){return function(t){var e=t;e.result&&l.fF.assert(function(){return e.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(u),u}))}))},t.prototype.getPlaceholderText=function(e){var n=this,o=_.filter(e,function(r){return n.isSupportedScope(r)});return this.interpretProxy.probe((0,E.C2)(o)).pipe((0,T.U)(function(r){return{result:r.results?we(n.localizationService,r.results):void 0,error:r.error}}))},t.prototype.constructInterpretRequest=function(e,n,o,r,i,s,u){var v=this,c={version:2,utterance:e,scopes:_.filter(o,function(h){return v.isSupportedScope(h)}),skipCompletion:!0,spans:i?.specifiedSpans,linguisticSchemaJson:i?.linguisticSchemaJson,inferredTermBinding:i?.inferredTermBinding,isCommitted:!i?.isQuestionNotCommitted,tags:i?.tags,feedback:u,reportMetadata:s};if(this.featureSwitchService.featureSwitches.interpretRequestGroupIdEnabled&&(c.groupId=r?.groupId,c.groupSequenceNumber=r?.groupSequenceNumber),n&&(c.options=n,(0,G.yE)(c.options,256))){var g=i.calculation;l.fF.assertValue(g,"requestParams calculation should be defined"),c.intent={defineCalculation:{language:g.language}},c.isCommitted=g.isCommitted,c.desiredInterpretationsCount=5}return c},t.prototype.isSupportedScope=function(e){return e&&e.model&&(0,re.KZ)(e.model)&&!_.isEmpty(e.model.vsName)&&!_.isEmpty(e.model.dbName)},t.prototype.generateRequestOptions=function(e){var n=66;return e&&(e.supportsInsightsQueries&&(n|=512),e.supportsPodQueries&&(n|=8),e.inferUnknownModelTerms&&(n|=4096),e.singleAnswerBias&&(n|=8192),e.supportsCalculation&&(n|=256),e.includeRelevantSchemaElements&&(n|=32),e.useLlmParser&&(n|=65536)),n},t.prototype.notifyInterpretListenerResult=function(e,n,o,r){l.fF.assertValue(n,"Expect response to be defined"),l.fF.assertValue(e,"Expect interpretListener to be defined"),!o&&e.onInterpretResult(r,n)},t.prototype.notifyInterpretListenerRetry=function(e,n){l.fF.assertValue(e,"Expect interpretListener to be defined."),e.onInterpretRetry&&e.onInterpretRetry(n)},t.prototype.logAnsweredQuestionDataOnError=function(e,n,o,r,i,s){s.isResponseEmpty=!0,s.isError=!0,s.interpretRequestId=r,s.error=i,e.log(n,o,s)},t.prototype.logAnsweredQuestionDataWithInterpretResult=function(e,n,o,r,i,s,u){l.fF.assertValue(s,"Expect response to be defined"),u.interpretRequestId=r,function(t,e,n){var o;l.fF.assertValue(t,"answeredQuestionData"),l.fF.assertValue(e,"Expect response to be defined");var r=_.first(e.results);t.isError=!!e.error,t.isResponseEmpty=!r?.command;var i=function(t,e){l.fF.assertValue(t,"Expect interpretResponse to be defined");var n=_.first(t.results);if(n)return _.find(e,function(o){return o.model.vsName.toLowerCase()===n.virtualServerName.toLowerCase()&&o.model.dbName.toLowerCase()===n.databaseName.toLowerCase()})}(e,n);if(i&&(t.ownerType=function(t){var e,n=null===(e=t?.model)||void 0===e?void 0:e.permissions;return n?(0,G.yE)(n,7)?"Owner":"Shared":"Unknown"}(i)),t.interpretationState="No Result",r){t.language=r.language,t.modelLanguage=r.modelLanguage;var s=null===(o=r.correctionInfo)||void 0===o?void 0:o.state;if(null==s)t.interpretationState="Understood";else switch(s){case 1:t.interpretationState="Did you mean";break;case 2:t.interpretationState="Showing results for";break;case 0:t.interpretationState="No Result";break;default:l.fF.assertFail("Unhandled case: "+s)}}}(u,s,i),e.log(n,o,u)},t.prototype.checkToOverwriteResponseModelInfo=function(e,n){var o=e.results;if(!_.isEmpty(o)&&n)for(var r=0,i=o;r<i.length;r++){var s=i[r];s.virtualServerName=n.vsName,s.databaseName=n.dbName}},(0,m.gn)([(0,m.fM)(3,(0,d.Inject)(Ie)),(0,m.w6)("design:paramtypes",[ne.vZ,B.o,N.y0,Object])],t)}();function ie(t){l.fF.assertValue(t.utterance,'proxyResponse is expected to be in type InterpretResponse here, it should contain property "utterance" which is not null.');var n=t;n.results&&l.fF.assert(function(){return!n.results.hasOwnProperty("utterances")},'Expect proxyResponse in type InterpretResponse, proxyResponse.result should not contain "utterances" property.')}var Ve=function(){function t(e,n){this.telemetryService=e,this.logDebounceTimeInMilliseconds=n}return t.prototype.startLogger=function(){var e=this,n=new We(this.telemetryService);return null!=this.logAnsweredDataDebounceHandler&&(clearTimeout(this.logAnsweredDataDebounceHandler),this.logAnsweredDataDebounceHandler=null),this.logAnsweredDataDebounceHandler=setTimeout(function(){e.logAnsweredDataDebounceHandler=null,n.setReadyToLogData()},this.logDebounceTimeInMilliseconds),n},t}(),We=function(){function t(e){this.telemetryService=e,this.eventInfo$=new Se.X(void 0)}return t.prototype.log=function(e,n,o){this.eventInfo$.next({start:e,end:n,data:o})},t.prototype.setReadyToLogData=function(){var e=this;this.eventInfo$.subscribe(function(n){n&&e.logData(n)})},t.prototype.logData=function(e){var n=e.start,o=e.end,r=e.data;l.fF.assert(function(){return-1!==n},"startTime value should be set"),l.fF.assert(function(){return-1!==o},"endTime value should be set"),r.wasCancelled&&(r.isError=!1),this.telemetryService.logEvent(function(u,v,p,c){return void 0===v&&(v=!1),void 0===p&&(p=void 0),void 0===c&&(c=void 0),Ee.yP({EventsKitEventName:"FireActivityCompletionSummaryEvent",howEnded:r.isError?"3":"1",isResponseEmpty:r.isResponseEmpty,fromCache:r.fromCache,contentProviderType:r.contentProviderType,ownerType:r.ownerType,duration:o-n,probeDuration:-1,wasCancelled:r.wasCancelled,interpretRequestId:r.interpretRequestId,entryPoint:r.entryPoint,linguisticSchemaLanguage:r.language,modelLanguage:r.modelLanguage,withContextPresent:!1,usedContext:!1,tags:r.tags,interpretationState:r.interpretationState,parentId:u,isError:r.isError,errorSource:p,errorCode:c,warnings:r.warnings,responseError:r.error})})},t}(),$=a(91592),Be=a(41887),ze=a(47508),He=a(88255);function Ke(t,e,n,o,r,i,s,u,v,p,c,g,h,P){return new je(t,e,n,o,r,i,s,u,v,p,c,g,h,P)}var je=function(){function t(e,n,o,r,i,s,u,v,p,c,g,h,P,I){this.conceptualSchemaProxy=e,this.dataSources=n,this.dialogService=o,this.errorService=r,this.explorationCapabilitiesService=i,this.explorationNavigation=s,this.formFactorProvider=u,this.layoutAuthoring=v,this.lazyProvider=p,this.localizationService=c,this.telemetryService=g,this.viewModeState=h,this.visualAuthoring=P,this.qnaProxyPathToken=I}return t.prototype.reportConfigAllowsQna=function(e){return 0===this.formFactorProvider.getCurrentLayout()&&!(0===this.viewModeState.getMode()&&!e.allowInViewMode)},t.prototype.tryAddQnaContainerToCanvas=function(e,n){return(0,m.mG)(this,void 0,void 0,function(){var o,r,i,s,u,v,p;return(0,m.Jh)(this,function(g){switch(g.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!1})?[4,this.ensureQnaSupportabilityService()]:[2,!1];case 1:return g.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return o=g.sent(),r=this.explorationCapabilitiesService.getCapabilities(),!(i=(0,$.H)(r,o,this.qnaSupportabilityService)).isAllowed&&"featureDisabledInApp"===i.disallowedReason||!i.isAllowed&&!r.allowEnableQnaPrompts?[2,!1]:(u={width:e.contract.size.width,height:e.contract.size.height},(s=n&&n.pointOfInterest)&&(v=this.layoutAuthoring.getLayoutForNewVisualContainer(e.contract.visualContainers,s,u)),p=this.explorationNavigation.getAllSections(),[4,(0,Be.lN)({telemetrySource:n.creationSource,position:v,visualType:ze.L.qnaVisual.name},p,e,this.dataSources.get(),this.visualAuthoring,this.telemetryService)]);case 3:return g.sent(),[2,!0]}})})},t.prototype.tryShowQnaPopout=function(e,n){return(0,m.mG)(this,void 0,void 0,function(){var r,i,s,u,v,g=this;return(0,m.Jh)(this,function(h){switch(h.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!0})?[4,this.ensureQnaSupportabilityService()]:[2];case 1:return h.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return r=h.sent(),i=this.explorationCapabilitiesService.getCapabilities(),(s=(0,$.H)(i,r,this.qnaSupportabilityService)).isAllowed?[4,this.lazyProvider.get("@powerbi/QnaReportContainer/module#QnaReportContainerModule","qnaPopoutBuilderModern")]:[3,5];case 3:return u=h.sent(),v={anchorElement:e,dataSources:this.dataSources.get(),explorationCapabilities:i,sourceExploration:this.explorationNavigation.getCurrentExploration(),sourceFilters:n.sourceFilters,viewMode:this.viewModeState.getMode(),close:function(){g.explorationNavigation.hideExplorationMask()}},[4,u.show(v)];case 4:return h.sent(),this.explorationNavigation.showExplorationMask(),[3,6];case 5:switch(s.disallowedReason){case"featureDisabledInIE":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupportedInIE_Title"),this.localizationService.get("Qna_NotSupportedInIE_Subtitle"));break;case"featureDisabledInApp":l.fF.assertFail("Expect the code of showing qna popout never be called if app doesn't allow qna feature");break;case"noModel":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.localizationService.get("Qna_NotAllowedForReport_WithoutModel"));break;case"qnaNotSupported":this.errorService.infoCustom(this.localizationService.get("VisualContainer_QnaVisual_NotSupportedTitle"),this.localizationService.get("VisualContainer_QnaVisual_NotSupportedMessage"));break;case"qnaNotEnabled":this.qnaSupportabilityService.canAnyUserEnableQna()?this.dialogService.showConfirmationDialog({title:this.localizationService.get("Qna_NotSupported_Title"),message:this.qnaSupportabilityService.modelHasQnaDisabledMessage,okButtonText:this.localizationService.get("Qna_MessageDialog_EnableQnaButtonText"),cancelButtonText:this.localizationService.get("Cancel_ButtonText")},{maxWidth:500}).afterClosed().pipe((0,He.P)()).subscribe(function(P){return(0,m.mG)(g,void 0,void 0,function(){return(0,m.Jh)(this,function(I){switch(I.label){case 0:return 1!==P?[3,3]:[4,this.qnaSupportabilityService.enableQna()];case 1:return I.sent(),[4,this.tryShowQnaPopout(e,n)];case 2:I.sent(),I.label=3;case 3:return[2]}})})}):this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.qnaSupportabilityService.modelHasQnaDisabledMessage);break;default:l.fF.assertNever(s.disallowedReason)}h.label=6;case 6:return[2]}})})},t.prototype.ensureQnaSupportabilityService=function(){return(0,m.mG)(this,void 0,void 0,function(){var e;return(0,m.Jh)(this,function(n){switch(n.label){case 0:return this.qnaSupportabilityService?[3,2]:(e=this,[4,this.lazyProvider.get(this.qnaProxyPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaSupportabilityService")]);case 1:e.qnaSupportabilityService=n.sent(),n.label=2;case 2:return[2]}})})},t}(),ae=a(50911),se=function(){function t(e){this.datasetStore=e}return t.prototype.isDQOrLiveConnectToOnPrem=function(e){return(0,m.mG)(this,void 0,void 0,function(){var n;return(0,m.Jh)(this,function(o){switch(o.label){case 0:return e?[4,this.datasetStore.findDatasetById(e.datasetId)]:[2,Promise.resolve(!1)];case 1:return n=o.sent(),l.fF.assertValue(n,"Model with database id "+e.datasetId+"should exist"),n?[2,Promise.resolve((0,re.t6)(n))]:[2,Promise.resolve(!1)]}})})},t.\u0275fac=function(n){return new(n||t)(d.\u0275\u0275inject(ae.s))},t.\u0275prov=d.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),Je=a(30794),Ge=a(2142),ue=function(){function t(e,n){this.localizationService=e,this.datasetStore=n,this.qnaSettingsChanged=new Je.xQ}return t.prototype.ngOnDestroy=function(){this.qnaSettingsChanged.complete()},t.prototype.appShouldHideQnaFeature=function(){return!1},t.prototype.modelSupportsQna=function(e,n){return!!n?.qna&&_.some(e.schemas,function(o){var r;return!o.isExtensionSchema&&(null===(r=o.capabilities)||void 0===r?void 0:r.supportsQna)})},t.prototype.modelHasQnaEnabled=function(e,n){return!!n?.qna&&_.some(e.schemas,function(o){var r;return!o.isExtensionSchema&&(null===(r=o.capabilities)||void 0===r?void 0:r.isQnaEnabled)})},t.prototype.modelSupportsNlToDax=function(){return!1},t.prototype.getNlToDaxStatus=function(){return"Disabled"},t.prototype.canAnyUserEnableQna=function(){return!1},t.prototype.canCurrentUserEnableQna=function(e){return(0,m.mG)(this,void 0,void 0,function(){var n,o;return(0,m.Jh)(this,function(r){switch(r.label){case 0:return null==(n=_.find(e,function(i){return i.type===Ge.nKy}))?[2,!1]:[4,this.datasetStore.findDatasetById(n.id)];case 1:return o=r.sent(),[2,o?.permissions&&(0,G.yE)(o.permissions,2)]}})})},t.prototype.enableQna=function(){throw new Error("Method not implemented.")},Object.defineProperty(t.prototype,"qnaSettingsChanged$",{get:function(){return this.qnaSettingsChanged},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modelHasQnaDisabledMessage",{get:function(){return this.localizationService.get("Visual_Qna_IsNotEnabled_Service")},enumerable:!1,configurable:!0}),t.prototype.allowsLinguisticSchemaEdit=function(){return!1},t.\u0275fac=function(n){return new(n||t)(d.\u0275\u0275inject(B.o),d.\u0275\u0275inject(ae.s))},t.\u0275prov=d.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),$e=a(77476),Ze=a(26898),Xe=a(81213),Ye=a(13052),ke=a(39503),qe=a(83008),_e=a(48145),et=a(17328),tt=a(63387),nt=a(77200),rt=a(10861),ot=a(76521),it=new d.InjectionToken("ImproveLsdlProxy"),at=a(65947),le=a(12123),st=a(76072),ut=a(77906),lt=a(95859),ct=a(58938),dt=a(52950),pt=a(66972),vt=a(62345),ft=function(){function t(e){this.certifiedEventsService=e}return t.prototype.logInterpretWithCopilotEvent=function(e,n,o){this.certifiedEventsService.logStandardizedFeatureEvent({featureName:(0,vt.mN)("Downstream","Qna-Query"),activityStatus:"Succeeded",activityName:"Qna-Query",resultCode:"",correlationId:"",activityAttributes:{IsSignedIn:n,Location:"service"===e?"Service":"Desktop",ContentMode:0===o?"View":"Edit"}})},t.\u0275fac=function(n){return new(n||t)(d.\u0275\u0275inject(N.ly))},t.\u0275prov=d.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),ht=function(){function t(){}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=d.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=d.\u0275\u0275defineInjector({providers:[k.J,Q,ee,{provide:le.n,useValue:"@powerbi/Qna/qnaweb.module#QnaWebModule"},{provide:at.z,useValue:"@powerbi/Qna/qnaweb.module#QnaWebModule"},ue,se,{provide:"InterpretServiceModern",useFactory:De,deps:[ne.vZ,B.o,N.y0,ee]},{provide:"qnaLaunchService",useFactory:Ke,deps:[Ze.i,qe.D,ct.x,Xe.T,_e.U,ke.z,et.F,tt.U,st.E,B.o,N.y0,nt.kc,rt.$8,le.n]},{provide:"qnaSupportabilityService",useClass:ue},{provide:"qnaModelUtilsService",useClass:se},{provide:it,useClass:A},{provide:"interpretCopilotTelemetryService",useClass:ft},{provide:"qnaSupportabilitytUtilsModern",useFactory:$.G}],imports:[$e.CommonModule,Ye.T,ot.A3,ut.N,lt.v,pt.N,N.e3,dt.g,f.T]}),t}()},5894:function(F,w,a){a.d(w,{WW:function(){return A},dN:function(){return b},v5:function(){return D},yP:function(){return M}});var f=a(41114),d="PBI.QnaVisual.SuggestionCardClicked",A=f.cx[d]=(0,f.b1)(d),l="PBI.QnaVisual.VisualConverted",b=f.cx[l]=(0,f.b1)(l),Q="PBI.QnA.INAQ",M=f.cx[Q]=(0,f.b1)(Q,{logExpAssignment:!0}),R="PBI.QnA.Feedback",D=f.cx[R]=(0,f.b1)(R),E="PBI.QnA.UpdateLsdlSharingPermission",C=(f.cx[E]=(0,f.b1)(E),"PBI.QnaTooling.ImproveLsdlRequest");f.cx[C]=(0,f.b1)(C)},91592:function(F,w,a){a.d(w,{G:function(){return A},H:function(){return d}});var f=a(16808);function d(l,b,Q){return(0,f.rO)()?{isAllowed:!1,disallowedReason:"featureDisabledInIE"}:Q.appShouldHideQnaFeature()?{isAllowed:!1,disallowedReason:"featureDisabledInApp"}:_.some(b?.schemas,function(D){return!D.isExtensionSchema&&!_.isEmpty(D.entities)})?Q.modelSupportsQna(b,l)?Q.modelHasQnaEnabled(b,l)?{isAllowed:!0}:{isAllowed:!1,disallowedReason:"qnaNotEnabled"}:{isAllowed:!1,disallowedReason:"qnaNotSupported"}:{isAllowed:!1,disallowedReason:"noModel"}}function A(){return{getIsQnaAllowedInfo:d}}}}]);