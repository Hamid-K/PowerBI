"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["quick-measures-ui"],{64648:function(re,V,i){i.d(V,{_:function(){return M}});var M=function(S){return S[S.Number=0]="Number",S[S.Enum=1]="Enum",S[S.Boolean=2]="Boolean",S[S.Field=3]="Field",S[S.Instance=4]="Instance",S}({})},42885:function(re,V,i){i.r(V),i.d(V,{QuickMeasuresUIModule:function(){return ft}});var M=i(77476),S=i(76966),F=i(99649),L=i(22346),I=i(82156),k=i(79061),ee=i(44913),X=i(56598),Q=i(63654),te=i(14525),U=i(93367),J=i(94841),z=i(16748),oe=i(16095),Z=i(35284),b=i(81337),A=i(92630),R=i(62458),ne=i(93215),le=i(73221),se=i(67489),ce=i(14172),e=i(50423),N=i(83008),pe=i(40823),me=i(96899),ve=i(96777),fe=i(64648),W=i(96739),ge=i(45334),he=i(74082),Ce=i(80777),de=i(44529),ie=i(64560),ae=i(48787),_e=i(28199),C=i(26898),l=i(23983),d=i(65181),g=function(){function t(r,n,a,o,c,x){this.aggrOps=r,this.conceptualSchemaProxy=n,this.dataSourcesService=a,this.daxTemplateStore=o,this.groupingDesignStateService=c,this.localizationService=x,this.menuMode=ie.Kb.Compact}return t.prototype.getMenu=function(r){var n=this,a={items:[]};return this.daxTemplateStore.parameters$.pipe((0,ae.q)(1)).subscribe(function(o){var c=r.flatNode;if(!c)return a;var x=c.node.data;if(!o||!x||(o=_.pickBy(o,function(ue){return W.M.isColumnOrMeasure(ue.input)||W.M.isInstance(ue.input)}),_.isEmpty(o)))return a;if(function(t){return 0===t.fieldType}(x)||function(t){return 2===t.fieldType}(x))return(y=n.createAddToSubMenu()).menu=n.createPropertyMenu(x.contract,o),a.items=[y],a;var E=function(t){return 4===t.fieldType}(x)&&2===x.kpiType;if(E||function(t){return t.isExtension}(x)){var y=n.createAddToSubMenu(),B=_.pickBy(o,function(ye){return v(ye.input)});return y.menu={items:n.convertParametersToMenuItems(B)},a.items=[y],a}}),_.isEmpty(a.items)?void 0:a},t.prototype.menuItemClick=function(r){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,a,o,c,x,y,E;return(0,b.__generator)(this,function(B){switch(B.label){case 0:return R.fF.assertValue(n=r.menuItem.data,"AddTo menu item"),n?(o=n.parameter,c=r.flatNode.node.data,R.fF.assertValue(a=n.parameterKey,"parameter key undefined in AddTo menu item"),R.fF.assertValue(o,"parameter undefined in AddTo menu item"),R.fF.assertValue(c,"fieldItem undefined"),a&&o&&c&&(x=(0,de.Sd)(c,this.groupingDesignStateService))?(y=o.input,[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]):[2]):[2];case 1:return E=B.sent(),W.M.isColumnOrMeasure(y)?function(t,r,n){return!!r&&v(r)&&!ge.m.discourageAggregation(t,n)}(x,y,E)?y.value=this.aggrOps.createExprWithAggregate(x,E,!0,h(y.validationInfo)):(!v(y)||(0,he.kb)(x))&&(y.value=x):W.M.isInstance(y)&&(y.value.field=x),this.daxTemplateStore.updateParameters(y,a),[2]}})})},t.prototype.createPropertyMenu=function(r,n){if(r.measure||r.column){var o,a={items:[]};return r.column?o=_.pickBy(n,function(c){if(W.M.isColumnOrMeasure(c.input)&&!v(c.input)){var x=h(c.input.validationInfo);return _.isEmpty(x)||Ce.Ge.isCompatibleTo(r.type,x,!0)}return!0}):r.measure&&(o=_.pickBy(n,function(c){return v(c.input)})),a.items=this.convertParametersToMenuItems(o),a}},t.prototype.createAddToSubMenu=function(){return{text:this.localizationService.get("DaxTemplateDialog_AddToItemMenu"),type:ie.iB.SubMenu}},t.prototype.convertParametersToMenuItems=function(r){return _.map(r,function(n,a){return{text:n.displayName,type:ie.iB.Button,checked:!1,data:{parameterKey:a,parameter:n}}})},t.\u0275fac=function(n){return new(n||t)(e.\u0275\u0275inject(_e.C),e.\u0275\u0275inject(C.i),e.\u0275\u0275inject(N.D),e.\u0275\u0275inject(A.Xy),e.\u0275\u0275inject(l.AA),e.\u0275\u0275inject(d.o))},t.\u0275prov=e.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}();function v(t){var r;return!!W.M.isColumnOrMeasure(t)&&1===(null===(r=t.validationInfo.field)||void 0===r?void 0:r.kind)}function h(t){var r,n=null===(r=t?.field)||void 0===r?void 0:r.type;if(n)return n.variant||[n]}var m=i(70863),w=i(30794),T=i(83317),D=function(){function t(r){var n=this;this.daxTemplateStore=r,this.isTemplateSelected=!1,this.onDestroy$=new w.xQ,this.daxTemplateStore.isTemplateSelected$.pipe((0,T.R)(this.onDestroy$)).subscribe(function(a){return n.isTemplateSelected=a})}return t.prototype.canShowMenu=function(r){return m.t3(r)||m.kb(r)||m.ez(r)?this.isTemplateSelected:!(m.wb(r)||m.y3(r)||m.Ov(r)||m.jz(r))&&void 0},t.prototype.ngOnDestroy=function(){this.onDestroy$.next(),this.onDestroy$.complete()},t.\u0275fac=function(n){return new(n||t)(e.\u0275\u0275inject(A.Xy))},t.\u0275prov=e.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac}),t}(),K=i(54834),$=i(20598),G=i(21571),H=i(88023),Y=i(78963),q=i(75096),j=i(59725),Ie=i(59017),Ee=i(59973),be=i(29524),De=i(72525),Fe=i(67930),we=i(2839),Le=i(59968),Ne=i(60733),Me=i(20551),Ve=i(64716),ze=i(85721),$e=i(65005),je=i(86663),Be=i(24326),ke=i(85102);function Qe(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",14),e.\u0275\u0275element(1,"h4",15),e.\u0275\u0275elementEnd())}function Ue(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"label"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&t){var n=e.\u0275\u0275nextContext(2).ngIf,a=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(a.getDisplayNameFromGetter(n.selectedTemplate.capabilities.displayName))}}function Ae(t,r){1&t&&e.\u0275\u0275element(0,"label",16)}function Re(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"label",20),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&t){var n=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(n.value)}}function We(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"label",21),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&t){var n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(a.getDisplayNameFromGetter(n.value.capabilities.displayName))}}function Ke(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"tri-dropdown-item",17),e.\u0275\u0275template(1,Re,2,1,"label",18),e.\u0275\u0275template(2,We,2,1,"label",19),e.\u0275\u0275elementEnd()),2&t){var n=r.$implicit;e.\u0275\u0275property("value",n.value)("disabled","category"===n.kind),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","category"===n.kind),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","daxTemplate"===n.kind)}}function Ge(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",22)(1,"mat-error",23),e.\u0275\u0275element(2,"pbi-icon",24)(3,"span",25),e.\u0275\u0275elementEnd()()),2&t){var n=e.\u0275\u0275nextContext().ngIf,a=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(3),e.\u0275\u0275property("localize",n.result.warnings[a.selectedTemplate])}}function Xe(t,r){if(1&t&&e.\u0275\u0275element(0,"a",29),2&t){var n=e.\u0275\u0275nextContext(3).ngIf;e.\u0275\u0275property("href","https://go.microsoft.com/fwlink/?linkid="+n.selectedTemplate.capabilities.helpLink,e.\u0275\u0275sanitizeUrl)}}function He(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",26)(1,"span",27),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(3,Xe,1,1,"a",28),e.\u0275\u0275elementEnd()),2&t){var n=e.\u0275\u0275nextContext(2).ngIf,a=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",a.getDisplayNameFromGetter(n.selectedTemplate.capabilities.description)," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.selectedTemplate.capabilities.helpLink)}}function Je(t,r){if(1&t){var n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",39)(1,"input",40),e.\u0275\u0275listener("change",function(c){e.\u0275\u0275restoreView(n);var x=e.\u0275\u0275nextContext().ngIf,y=e.\u0275\u0275nextContext().$implicit,E=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(E.onNumberParameterChange(c.target.value,y.key,x.input))}),e.\u0275\u0275elementEnd()()}if(2&t){var a=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("value",null==a.input?null:a.input.value),e.\u0275\u0275attribute("aria-label",a.displayName)}}function Ze(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"tri-dropdown-item",43)(1,"label",44),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&t){var n=r.$implicit,a=e.\u0275\u0275nextContext(7);e.\u0275\u0275property("value",n),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(a.getDisplayNameFromGetter(n.displayName))}}var Te=function(){return{panelClass:"dax-template-dropdown-panel"}};function Ye(t,r){if(1&t){var n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tri-dropdown",41),e.\u0275\u0275listener("valueChange",function(x){e.\u0275\u0275restoreView(n);var y=e.\u0275\u0275nextContext().ngIf,E=e.\u0275\u0275nextContext().$implicit,B=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(B.onEnumParameterChange(x,E.key,y.input))}),e.\u0275\u0275elementStart(1,"tri-dropdown-trigger",8)(2,"label"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(4,Ze,3,2,"tri-dropdown-item",42),e.\u0275\u0275elementEnd()}if(2&t){var a=e.\u0275\u0275nextContext().ngIf,o=e.\u0275\u0275nextContext(5);e.\u0275\u0275property("value",a.input.value)("options",e.\u0275\u0275pureFunction0(4,Te)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(o.getDisplayNameFromGetter(a.input.value.displayName)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",null==a.input?null:a.input.selectionOptions)}}var Se=function(r){return{expr:r}};function qe(t,r){if(1&t){var n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"field-picker-modern-lazy",45),e.\u0275\u0275listener("onExprChange",function(c){e.\u0275\u0275restoreView(n);var x=e.\u0275\u0275nextContext().ngIf,y=e.\u0275\u0275nextContext().$implicit,E=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(E.onFieldPickerChange(null==c.newExpr?null:c.newExpr.expr,y.key,x.input))}),e.\u0275\u0275elementEnd()}if(2&t){var a=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275property("initialExpr",null!=a.input&&a.input.value?e.\u0275\u0275pureFunction1(3,Se,a.input.value):void 0)("validators",null==a.input?null:a.input.validationInfo)("withFieldList",!0)}}function et(t,r){if(1&t){var n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"instance-picker-modern",48),e.\u0275\u0275listener("modelChange",function(x){e.\u0275\u0275restoreView(n);var y=e.\u0275\u0275nextContext(2).ngIf,E=e.\u0275\u0275nextContext().$implicit,B=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(B.onInstanceValueChanged(x,E.key,y.input))}),e.\u0275\u0275elementEnd()}if(2&t){var a=e.\u0275\u0275nextContext(2).ngIf,o=e.\u0275\u0275nextContext(5);e.\u0275\u0275property("field",null==a.input||null==a.input.value?null:a.input.value.field)("selectedValue",null==a.input||null==a.input.value?null:a.input.value.filter)("mode",o.instancePickerMode)}}function tt(t,r){if(1&t){var n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"field-picker-modern-lazy",46),e.\u0275\u0275listener("onExprChange",function(c){e.\u0275\u0275restoreView(n);var x=e.\u0275\u0275nextContext().ngIf,y=e.\u0275\u0275nextContext().$implicit,E=e.\u0275\u0275nextContext(4);return e.\u0275\u0275resetView(E.onInstanceFieldChange(null==c.newExpr?null:c.newExpr.expr,y.key,x.input))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(2,et,1,3,"instance-picker-modern",47),e.\u0275\u0275elementContainerEnd()}if(2&t){var a=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275property("initialExpr",null!=a.input&&null!=a.input.value&&a.input.value.field?e.\u0275\u0275pureFunction1(4,Se,a.input.value.field):void 0)("validators",null==a.input?null:a.input.validationInfo)("withFieldList",!0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==a.input||null==a.input.value?null:a.input.value.field)}}function nt(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",22)(1,"mat-error",49),e.\u0275\u0275element(2,"pbi-icon",50)(3,"span",25),e.\u0275\u0275elementEnd()()),2&t){var n=e.\u0275\u0275nextContext(2).$implicit,a=e.\u0275\u0275nextContext(2).ngIf;e.\u0275\u0275advance(3),e.\u0275\u0275property("localize",a.result.errors[n.key])}}function it(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",22)(1,"mat-error",23),e.\u0275\u0275element(2,"pbi-icon",24)(3,"span",25),e.\u0275\u0275elementEnd()()),2&t){var n=e.\u0275\u0275nextContext(2).$implicit,a=e.\u0275\u0275nextContext(2).ngIf;e.\u0275\u0275advance(3),e.\u0275\u0275property("localize",a.result.warnings[n.key])}}function at(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",33)(1,"div",14)(2,"h4"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"pbi-icon",34),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(5,Je,2,2,"div",35),e.\u0275\u0275template(6,Ye,5,5,"tri-dropdown",36),e.\u0275\u0275template(7,qe,1,5,"field-picker-modern-lazy",37),e.\u0275\u0275template(8,tt,3,6,"ng-container",38),e.\u0275\u0275template(9,nt,4,1,"div",11),e.\u0275\u0275template(10,it,4,1,"div",11),e.\u0275\u0275elementEnd()),2&t){var n=r.ngIf,a=e.\u0275\u0275nextContext().$implicit,o=e.\u0275\u0275nextContext(2).ngIf,c=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("ngSwitch",null==n.input?null:n.input.kind),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(n.displayName),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",n.description),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",c.DaxTemplateParameterKind.Number),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",c.DaxTemplateParameterKind.Enum),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",c.DaxTemplateParameterKind.Field),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",c.DaxTemplateParameterKind.Instance),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.result.errors[a.key]&&n.hasBeenSet),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.result.warnings[a.key]&&n.hasBeenSet)}}function rt(t,r){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,at,11,9,"div",32),e.\u0275\u0275elementContainerEnd()),2&t){var n=r.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.value)}}function ot(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",30),e.\u0275\u0275template(1,rt,2,1,"ng-container",31),e.\u0275\u0275pipe(2,"keyvalue"),e.\u0275\u0275elementEnd()),2&t){var n=r.ngIf,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind2(2,1,n,a.parameterDisplayOrder))}}function lt(t,r){if(1&t){var n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div"),e.\u0275\u0275template(2,Qe,2,0,"div",6),e.\u0275\u0275elementStart(3,"tri-dropdown",7),e.\u0275\u0275listener("valueChange",function(y){e.\u0275\u0275restoreView(n);var E=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(E.onTemplateSelectionChange(y))}),e.\u0275\u0275elementStart(4,"tri-dropdown-trigger",8),e.\u0275\u0275template(5,Ue,2,1,"label",5),e.\u0275\u0275template(6,Ae,1,0,"label",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Ke,3,4,"tri-dropdown-item",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Ge,4,1,"div",11),e.\u0275\u0275template(9,He,4,2,"div",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(10,ot,3,4,"div",13),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementContainerEnd()}if(2&t){var a=r.ngIf,o=e.\u0275\u0275nextContext().ngIf,c=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",c.showFieldList),e.\u0275\u0275advance(1),e.\u0275\u0275property("value",o.selectedTemplate)("options",e.\u0275\u0275pureFunction0(11,Te)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",o.selectedTemplate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!o.selectedTemplate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",o.flattenedTemplatesAndCategory),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",a.result.warnings[o.selectedTemplate]),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",o.selectedTemplate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(11,9,null==c.daxTemplateStore?null:c.daxTemplateStore.parameters$))}}function st(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",4),e.\u0275\u0275template(1,lt,12,12,"ng-container",5),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&t){var n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,1,null==n.daxTemplateStore?null:n.daxTemplateStore.validation$))}}function ct(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",51),e.\u0275\u0275element(1,"pbi-spinner",52)(2,"span",53),e.\u0275\u0275elementEnd())}function dt(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"div",54)(1,"div",14),e.\u0275\u0275element(2,"h4",55),e.\u0275\u0275pipe(3,"localize"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(4,"pbi-field-list",56),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementEnd()),2&t){var n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(3,5,"TaskPane_Fields")),e.\u0275\u0275advance(2),e.\u0275\u0275property("fieldListTree",e.\u0275\u0275pipeBind1(5,7,n.fieldListTree$))("scrollSelectedItemIntoViewOnInit",!0)("hasHighlights",!1)("options",n.fieldListTreeOptions)}}var ut=function(r){return{"grid-template-columns":r}},pt=function(){function t(){}return t.prototype.isDraggable=function(r){return!m.wb(r)&&!m.y3(r)&&(!!(m.t3(r)||m.kb(r)||m.ez(r))||void 0)},t}(),xe=function(t){function r(n,a,o,c,x,y,E,B,ue,ye){var P=t.call(this)||this;return P.daxTemplateStore=n,P.captionSetting=a,P.draggableSetting=o,P.inlineItemsSetting=c,P.showMenuSetting=x,P.fieldListMenuStrategy=y,P.fieldListTreeService=E,P.groupingDesignStateService=B,P.localizationService=ue,P.modelService=ye,P.showFieldList=!0,P.fieldListTree$=P.fieldListTreeService.fieldListTree$,P.parameterPickerDataFormat=j.L$,P.instancePickerMode=$.j6,P.DaxTemplateParameterKind=fe._,P.parameterDisplayOrder=function(){return 0},P.fieldListTreeOptions={dragDrop:{dragStart:function(Oe){return P.dragStartHandler(Oe.sourceEvent,Oe.flatNode)}},menu:P.fieldListMenuStrategy,editLabel:null},P.pbiTreeNodeSettingOptions={captionSetting:P.captionSetting,draggableSetting:P.draggableSetting,inlineItemsSetting:P.inlineItemsSetting,showMenuSetting:P.showMenuSetting},P.fieldListTreeService.modelToPbiTreeConverterOptions=P.pbiTreeNodeSettingOptions,P}return(0,b.__extends)(r,t),r.prototype.ngOnInit=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){return(0,b.__generator)(this,function(n){switch(n.label){case 0:return this.showFieldList?[4,this.buildFieldListTree()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},r.prototype.onTemplateSelectionChange=function(n){this.daxTemplateStore.updateSelectedTemplate(n)},r.prototype.onEnumParameterChange=function(n,a,o){o.value=n,this.daxTemplateStore.updateParameters(o,a)},r.prototype.onNumberParameterChange=function(n,a,o){o.value=Number(n),Number.isNaN(o.value)&&(o.value=0),this.daxTemplateStore.updateParameters(o,a)},r.prototype.onFieldPickerChange=function(n,a,o){o.value=n,this.daxTemplateStore.updateParameters(o,a)},r.prototype.onInstanceFieldChange=function(n,a,o){o.value.field=n,this.daxTemplateStore.updateParameters(o,a)},r.prototype.onInstanceValueChanged=function(n,a,o){o.value=n,this.daxTemplateStore.updateParameters(o,a)},r.prototype.getDisplayNameFromGetter=function(n){return(0,G.G)(n,this.localizationService)},r.prototype.buildFieldListTree=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n=this;return(0,b.__generator)(this,function(a){switch(a.label){case 0:return[4,this.modelService.update([])];case 1:return a.sent(),(0,Ie.aj)([this.modelService.modelChange$,this.daxTemplateStore.isTemplateSelected$]).pipe((0,T.R)(this.onDestroy$),(0,Ee.h)(function(o){var c=o[0];return!!c?.model}),(0,ce.U)(function(o){return o[0].model})).subscribe(function(o){n.fieldListTreeService.setOrUpdateFieldListTreeModel(o,[])}),[2]}})})},r.prototype.dragStartHandler=function(n,a){var o=a.node,c=o.data?(0,de.Sd)(o.data,this.groupingDesignStateService):void 0;if(null!=c){var x={id:o.id,icon:o.icon,label:o.displayName,fieldExpr:K.ib.serializeExpr(c)};n.dataTransfer.setData(j.L$,JSON.stringify(x))}},r.prototype.ngOnDestroy=function(){return t.prototype.ngOnDestroy.call(this)},r.\u0275fac=function(a){return new(a||r)(e.\u0275\u0275directiveInject(A.Xy),e.\u0275\u0275directiveInject(be.B),e.\u0275\u0275directiveInject(H.F),e.\u0275\u0275directiveInject(De.wt),e.\u0275\u0275directiveInject(Y.W),e.\u0275\u0275directiveInject(g),e.\u0275\u0275directiveInject(q.p),e.\u0275\u0275directiveInject(l.AA),e.\u0275\u0275directiveInject(d.o),e.\u0275\u0275directiveInject(ne.b))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["quick-measures-template"]],inputs:{showFieldList:"showFieldList"},features:[e.\u0275\u0275ProvidersFeature([{provide:H.F,useClass:pt},{provide:Y.W,useClass:D},g,q.p]),e.\u0275\u0275InheritDefinitionFeature],decls:6,vars:8,consts:[[1,"container",3,"ngStyle"],["class","daxTemplateContainer",4,"ngIf","ngIfElse"],["templateLoading",""],["class","daxFieldListContainer",4,"ngIf"],[1,"daxTemplateContainer"],[4,"ngIf"],["class","label",4,"ngIf"],["id","templateSelector",1,"tri-caption1",3,"value","options","valueChange"],[1,"dropdownTrigger"],["localize","DaxTemplateDialog_SelectMeasurePrompt",4,"ngIf"],["class","dropdownItem tri-caption1",3,"value","disabled",4,"ngFor","ngForOf"],["role","alert","aria-live","polite",4,"ngIf"],["class","description",4,"ngIf"],["class","parameterContainer",4,"ngIf"],[1,"label"],["for","templateSelector","localize","DaxTemplateDialog_CalculationTitle"],["localize","DaxTemplateDialog_SelectMeasurePrompt"],[1,"dropdownItem","tri-caption1",3,"value","disabled"],["class","dropdownItemContent category",4,"ngIf"],["class","dropdownItemContent template",4,"ngIf"],[1,"dropdownItemContent","category"],[1,"dropdownItemContent","template"],["role","alert","aria-live","polite"],[1,"validation","warning","label"],["name","warning","size","mini"],[1,"text",3,"localize"],[1,"description"],["role","text"],["target","_blank","class","pbi-external-link fluentTheme-sm-reg","localize","Generic_LearnMore",3,"href",4,"ngIf"],["target","_blank","localize","Generic_LearnMore",1,"pbi-external-link","fluentTheme-sm-reg",3,"href"],[1,"parameterContainer"],[4,"ngFor","ngForOf"],[3,"ngSwitch",4,"ngIf"],[3,"ngSwitch"],["name","info","size","mini","aria-hidden","true",3,"title"],["tri-textfield","","class","tri-flex tri-flex-col",4,"ngSwitchCase"],["class","tri-caption1",3,"value","options","valueChange",4,"ngSwitchCase"],[3,"initialExpr","validators","withFieldList","onExprChange",4,"ngSwitchCase"],[4,"ngSwitchCase"],["tri-textfield","",1,"tri-flex","tri-flex-col"],["type","number",1,"numberInput",3,"value","change"],[1,"tri-caption1",3,"value","options","valueChange"],["class","dropdownItem tri-caption1",3,"value",4,"ngFor","ngForOf"],[1,"dropdownItem","tri-caption1",3,"value"],[1,"dropdownItemContent"],[3,"initialExpr","validators","withFieldList","onExprChange"],["aria-controls","instancePickerControl",3,"initialExpr","validators","withFieldList","onExprChange"],["id","instancePickerControl","aria-live","polite",3,"field","selectedValue","mode","modelChange",4,"ngIf"],["id","instancePickerControl","aria-live","polite",3,"field","selectedValue","mode","modelChange"],[1,"validation","error","label"],["name","status-error-full","size","mini","aria-hidden","true"],["aria-live","polite","role","status",1,"templateLoadingMessage"],["aria-busy","true",1,"pbi-spinner-small"],["localize","DaxTemplateDialog_TemplateLoadingMessage",1,"text"],[1,"daxFieldListContainer"],["localize","TaskPane_Fields"],[1,"fieldList",3,"fieldListTree","scrollSelectedItemIntoViewOnInit","hasHighlights","options"]],template:function(a,o){if(1&a&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,st,3,3,"div",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,ct,3,0,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(5,dt,6,9,"div",3),e.\u0275\u0275elementEnd()),2&a){var c=e.\u0275\u0275reference(4);e.\u0275\u0275property("ngStyle",e.\u0275\u0275pureFunction1(6,ut,o.showFieldList?"repeat(2, 1fr)":"1fr")),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,4,null==o.daxTemplateStore?null:o.daxTemplateStore.templatesModel$))("ngIfElse",c),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",o.showFieldList)}},dependencies:[M.NgForOf,M.NgIf,M.NgStyle,M.NgSwitch,M.NgSwitchCase,Fe.m,we.O,Le.X,Ne.TO,Me.M3,Ve.l,ze.q,Me.ii,$e.l,je._,Be.k,M.AsyncPipe,M.KeyValuePipe,ke.F],styles:['.container[_ngcontent-%COMP%]{display:grid;height:100%;width:100%;column-gap:2em;color:var(--colorNeutralForeground1);font-size:var(--sm-font-size, 12px)}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]{display:flex;flex-direction:column;row-gap:2em;height:100%;width:100%;overflow:hidden}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   tri-dropdown[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{line-height:1.2em}html:not([dir="rtl"])[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{margin:5px 0 15px}html[dir="rtl"][_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{margin:5px 0 15px}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .parameterContainer[_ngcontent-%COMP%]{display:flex;flex-direction:column;row-gap:1.8em}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .parameterContainer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .parameterContainer[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, .container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .parameterContainer[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;-moz-appearance:textfield;margin:0}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .parameterContainer[_ngcontent-%COMP%]   instance-picker-modern[_ngcontent-%COMP%]{display:block}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .validation[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;column-gap:3px;margin-top:8px}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .validation.error[_ngcontent-%COMP%]{color:var(--colorDangerForeground1)}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   .validation.warning[_ngcontent-%COMP%]{color:var(--colorWarningForeground1)}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   pbi-form-field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}.container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   pbi-form-field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button, .container[_ngcontent-%COMP%]   .daxTemplateContainer[_ngcontent-%COMP%]   pbi-form-field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.container[_ngcontent-%COMP%]   .daxFieldListContainer[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:flex;margin-bottom:5px;line-height:20px}.container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{align-self:center;font-size:var(--lg-font-size, 16px);font-weight:400;margin-top:0;margin-bottom:0}html:not([dir="rtl"])[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-left:0}html[dir="rtl"][_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-right:0}html:not([dir="rtl"])[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], html:not([dir="rtl"])   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-right:6px}html[dir="rtl"][_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], html[dir="rtl"]   [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-left:6px}.container[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   pbi-icon[_ngcontent-%COMP%]{align-self:center;height:18px}  .dax-template-dropdown-panel tri-dropdown-item label.dropdownItemContent{font-size:var(--sm-font-size);color:var(--colorNeutralForeground1)}  .dax-template-dropdown-panel tri-dropdown-item label.dropdownItemContent.template{margin:0 16px}  .dax-template-dropdown-panel tri-dropdown-item label.dropdownItemContent.category{font-weight:600}']}),r}(le.w),Pe=function(t){function r(n,a,o,c,x){var y=t.call(this)||this;return y.dataSourcesService=n,y.daxTemplateStore=a,y.daxTemplateTelemetry=o,y.templateDialogPayload=c,y.dataSourceSerializer=x,y}return(0,b.__extends)(r,t),r.prototype.ngOnInit=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,a=this;return(0,b.__generator)(this,function(o){switch(o.label){case 0:return R.fF.assertValue(this.templateDialogPayload.input,"templateDialogPayload input"),n=this.dataSourceSerializer.deserializeDataSources(this.templateDialogPayload.input.dataSources),this.dataSourcesService.set(n),[4,this.daxTemplateStore.initialize(this.templateDialogPayload.input)];case 1:return o.sent(),this.templateDialogPayload.onOkButtonClick=function(){return a.onCommit()},this.templateDialogPayload.onCancelButtonClick=function(){return a.onCancel()},this.disableCommit$=this.daxTemplateStore.validation$.pipe((0,ce.U)(function(c){var y=c.allParametersSet;return!_.isEmpty(c.result.errors)||!y})),this.lifecycleSubscriptions.add(this.disableCommit$.subscribe(function(c){return a.templateDialogPayload.setOkButtonState(c)})),[2]}})})},r.prototype.onCommit=function(){return(0,b.__awaiter)(this,void 0,void 0,function(){var n;return(0,b.__generator)(this,function(a){switch(a.label){case 0:return[4,this.daxTemplateStore.getNewMeasureResult()];case 1:return n=a.sent(),R.fF.assertValue(n,"new quick measure result"),n?(this.daxTemplateTelemetry.resolveTemplateSelectedEvent(!0),[2,n]):[2]}})})},r.prototype.onCancel=function(){return this.daxTemplateTelemetry.resolveTemplateSelectedEvent(),Promise.resolve(void 0)},r.prototype.ngOnDestroy=function(){return this.daxTemplateStore.destroy(),t.prototype.ngOnDestroy.call(this)},r.\u0275fac=function(a){return new(a||r)(e.\u0275\u0275directiveInject(N.D),e.\u0275\u0275directiveInject(A.Xy),e.\u0275\u0275directiveInject(me.W),e.\u0275\u0275directiveInject(se.x),e.\u0275\u0275directiveInject(pe._))},r.\u0275cmp=e.\u0275\u0275defineComponent({type:r,selectors:[["quick-measures-dialog"]],features:[e.\u0275\u0275ProvidersFeature([se.x,A.Xy,ne.b]),e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:1,consts:[[3,"showFieldList"]],template:function(a,o){1&a&&(e.\u0275\u0275elementStart(0,"template-dialog"),e.\u0275\u0275element(1,"quick-measures-template",0),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("showFieldList",!0))},dependencies:[ve.J,xe],styles:["quick-measures-template[_ngcontent-%COMP%]{display:block;height:592px;width:642px}"]}),r}(le.w),mt=i(22695),vt=[{type:xe,componentId:"QuickMeasuresTemplateComponentId"}],ft=function(){function t(){}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[M.CommonModule,L.J,I.N.withManifests(vt),k.v,F.LD,ee.lK,X.K,Q.X,te.g,U.U,J.b,z.H,oe.Z,Z.J,S.c.withManifest([{componentIdentifier:mt.T,componentType:Pe}])]}),t}()},92630:function(re,V,i){i.d(V,{Xy:function(){return de}});var M=i(81337),S=i(64648),F=i(96739),L=i(3011),I=function(){function C(){}return C.rewrite=function(l,d,g,s){if(l){var v=(0,L.vH)(d),h={},f=new C;for(var p in l){var u=l[p].input;h[p]=l[p],u&&(F.M.isColumnOrMeasure(u)?h[p].input=f.rewriteField(u,v,g,s):F.M.isInstance(u)&&(h[p].input=f.rewriteInstance(u,v,g,s)))}return h}},C.prototype.rewriteField=function(l,d,g,s){for(var v=l.value,h=0,f=d;h<f.length;h++){var p=f[h];v=v?.accept(p)}return _.isEmpty(v?.validate(g,s))||(v=void 0),(0,M.__assign)((0,M.__assign)({},l),{value:v})},C.prototype.rewriteInstance=function(l,d,g,s){for(var v,h,f=null===(v=l.value)||void 0===v?void 0:v.field,p=null===(h=l.value)||void 0===h?void 0:h.filter,u=0,O=d;u<O.length;u++){var m=O[u];f=f?.accept(m),p=p?.rewrite(m)}return _.isEmpty(f?.validate(g,s))||(f=void 0,p=void 0),(0,M.__assign)((0,M.__assign)({},l),{value:f?{field:f,filter:p}:void 0})},C}(),k=i(54834),ee=i(8590),X=i(62458),Q=i(21571),te=i(95462),U=i(94419),J=i(35510),z=i(30794),oe=i(82762),Z=i(22318),b=i(77526),A=i(81905),R=i(59973),ne=i(14172),le=i(73805),se=i(57243),ce=i(83317),e=i(74082),N=i(50423),pe=i(28199),me=i(26898),ve=i(83008),fe=i(11494),W=i(80435),ge=i(57151),he=i(96899),Ce=i(65181),de=function(){function C(l,d,g,s,v,h,f,p){var u=this;this.aggrOps=l,this.conceptualSchemaProxy=d,this.dataSourcesService=g,this.daxCapabilitiesService=s,this.daxTemplateService=v,this.daxTemplateTelemetry=h,this.eventBridge=f,this.localizationService=p,this.templatesModelStore$=new J.X({selectedTemplate:void 0,flattenedTemplatesAndCategory:[]}),this.parametersStore$=new J.X(void 0),this.validation$=this.parameters$.pipe((0,Z.O)(null)).pipe((0,b.x)(),(0,A.w)(function(O){return u.validateParameters(O,u.templatesModelStore$.value.selectedTemplate)})),this.selectedTemplate$=this.templatesModel$.pipe((0,R.h)(function(O){return!!O.selectedTemplate}),(0,ne.U)(function(O){return O.selectedTemplate}),(0,b.x)()),this.isTemplateSelected$=this.selectedTemplate$.pipe((0,le.h)(!0),(0,Z.O)(!1),(0,b.x)(),(0,se.d)(1)),this.subscriptionManager=this.eventBridge.createChannelSubscriptionManager().subscribe(ee.CCe,function(O,m){return u.onModelChanged(m.result)})}return Object.defineProperty(C.prototype,"templatesModel$",{get:function(){return this.templatesModelStore$.asObservable()},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"parameters$",{get:function(){return this.parametersStore$.asObservable()},enumerable:!1,configurable:!0}),C.prototype.ngOnDestroy=function(){this.subscriptionManager.unsubscribeAll()},C.prototype.initialize=function(l){var d=l.selects,g=l.schemaName,s=l.openDaxTemplateEvent,v=l.targetEntity;return(0,M.__awaiter)(this,void 0,void 0,function(){var h,f=this;return(0,M.__generator)(this,function(p){switch(p.label){case 0:return this.destroy$=new z.xQ,this.schemaName=g,this.targetEntity=v,this.sourceExpressions=_.map(d,function(u){return k.ib.deserializeExpr(u)}),[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())];case 1:return h=p.sent(),[4,this.initializeTemplates(h)];case 2:return p.sent(),s&&(this.openDaxTemplateEvent=s,this.daxTemplateTelemetry.startTemplateSelectedEvent(s,"Select a measure")),this.selectedTemplate$.pipe((0,ce.R)(this.destroy$),(0,A.w)(function(u){return(0,oe.D)(f.conceptualSchemaProxy.get(f.dataSourcesService.get())).pipe((0,ne.U)(function(O){return{template:u,schema:O}}))})).subscribe(function(u){var O=f.getParameters(u.template,f.parametersStore$.value,u.schema);f.parametersStore$.next(O)}),[2]}})})},C.prototype.updateSelectedTemplate=function(l){this.templatesModelStore$.next((0,M.__assign)((0,M.__assign)({},this.templatesModelStore$.value),{selectedTemplate:l})),this.daxTemplateTelemetry.resolveTemplateSelectedEvent(),this.daxTemplateTelemetry.startTemplateSelectedEvent(this.openDaxTemplateEvent,l.capabilities.name)},C.prototype.updateParameters=function(l,d){if(X.fF.assertValue(l,"parameterInput"),X.fF.assertValue(d,"parameterKey"),l&&d&&_.has(this.parametersStore$.value,d)){var g=_.clone(this.parametersStore$.value),s=g[d];F.M.isInstance(l)&&!l.value.field&&(l.value.filter=void 0,s.hasBeenSet=!0),s.input=l,s.hasBeenSet=s.hasBeenSet||function(C){var l;return F.M.isInstance(C)?!(null===(l=C.value)||void 0===l||!l.filter):!!C.value}(s.input),this.parametersStore$.next(g)}},C.prototype.getNewMeasureResult=function(){return(0,M.__awaiter)(this,void 0,void 0,function(){var l,d,g,s,v;return(0,M.__generator)(this,function(h){switch(h.label){case 0:return[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())];case 1:return l=h.sent(),d=this.templatesModelStore$.value.selectedTemplate,g=ae(this.parametersStore$.value,l,this.daxTemplateService.utils),[4,this.getNewMeasureMetadata(g,d,l)];case 2:return(s=h.sent())&&(v={template:d?.capabilities,parameters:_.mapValues(g,function(f){return{expression:k.ib.serializeExpr(f.expression)}}),newMeasureMetadata:s}),[2,v]}})})},C.prototype.destroy=function(){this.destroy$.next(),this.destroy$.complete()},C.prototype.updateTemplates=function(l){var d=this.flattenAndOrderTemplatesByCategory(l);this.templatesModelStore$.next({selectedTemplate:void 0,flattenedTemplatesAndCategory:d})},C.prototype.initializeTemplates=function(l){return(0,M.__awaiter)(this,void 0,void 0,function(){var d,g;return(0,M.__generator)(this,function(s){switch(s.label){case 0:return[4,this.daxCapabilitiesService.getCapabilities()];case 1:return d=s.sent(),g=this.daxTemplateService.getTemplates(l,d,this.schemaName,1),this.updateTemplates(g),[2]}})})},C.prototype.flattenAndOrderTemplatesByCategory=function(l){var d=this,g=_.groupBy(l,function(u){return(0,Q.G)(u.capabilities.category,d.localizationService)}),s=[];for(var v in g){s.push({kind:"category",value:v});for(var h=0,f=g[v];h<f.length;h++)s.push({kind:"daxTemplate",value:f[h]})}return s},C.prototype.validateParameters=function(l,d){return(0,M.__awaiter)(this,void 0,void 0,function(){var g,s,v,h,f,p;return(0,M.__generator)(this,function(u){switch(u.label){case 0:return d&&l?[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())]:[2,{result:{errors:{},warnings:{}},allParametersSet:!1}];case 1:return g=u.sent(),v=ae(l,g,s=this.daxTemplateService.utils),[4,this.daxCapabilitiesService.getCapabilities()];case 2:return h=u.sent(),f=!0,p=s.validateIfNeeded(d,g,h,{schemaName:this.schemaName,inputValues:v}),_.forEach(d.capabilities.input,function(O){var m=O.name,w=l[m],T=v[m];w?.hasBeenSet?(!s.isValidValueForInput(T,O,g)||O.instance&&T.expression&&s.isDefaultValueFilter(T.expression))&&(p.errors[m]="DaxTemplateDialog_ParameterRequired"):f=!1}),[2,{result:p,allParametersSet:f}]}})})},C.prototype.getParameters=function(l,d,g){var s=this.daxTemplateService.utils,v=ae(d,g,s),h=_.map(v,function(u){return u.expression});h.push.apply(h,this.sourceExpressions||[]);var p=function(C,l,d,g){for(var s={},h=function(m){var w=l?l[m.name]:void 0,T=void 0;w&&(T=w.expression);var D={name:m.name,displayName:(0,Q.G)(m.displayName,d),description:(0,Q.G)(m.description,d),hasBeenSet:!!T,input:void 0};if(m.column)D.input={kind:S._.Field,value:T,validationInfo:{field:{kind:0,type:m.column.type}}};else if(m.measure)D.input={kind:S._.Field,value:T,validationInfo:{field:{kind:1,type:m.measure.type}}};else if(m.instance){var K=void 0,$=void 0;T&&(0,e.Hi)(T)&&!_.isEmpty(T.args)&&(K=T.args[0],g.isDefaultValueFilter(T)||($=T)),D.input={kind:S._.Instance,value:{field:K,filter:$&&te.yl.fromSQExpr($)},validationInfo:{field:{kind:0,type:m.instance.column.type}}},D.hasBeenSet=!!$}else if(m.constant)if(m.constant.type.numeric)D.input={kind:S._.Number,value:T&&(0,e.VC)(T)&&T.value,type:m.constant.type,validationInfo:{decimal:!0,integer:!0}};else if(m.constant.type.enumeration){var G=m.constant.type.enumeration.members(),H=T&&(0,e.VC)(T)&&T.value;D.input={kind:S._.Enum,value:null!=H?_.find(G,function(Y){return Y.value===H}):void 0,type:m.constant.type,selectionOptions:G}}else m.constant.type.bool&&(D.input={kind:S._.Boolean,value:T&&(0,e.VC)(T)&&T.value});s[m.name]=D},f=0,p=C.capabilities.input;f<p.length;f++)h(p[f]);return s}(l,s.generateValuesFromExpressions(l.capabilities.input,h,g),this.localizationService,s);return p},C.prototype.getNewMeasureMetadata=function(l,d,g){var s;return(0,M.__awaiter)(this,void 0,void 0,function(){var v,h,f,p,u=this;return(0,M.__generator)(this,function(O){switch(O.label){case 0:return v=d?.capabilities,v?[4,this.daxCapabilitiesService.getCapabilities()]:[2];case 1:return h=O.sent(),f=d?.getMeasureName(g,h,{schemaName:this.schemaName,inputValues:l}),(p={measureName:f}).formatType=null===(s=v.output)||void 0===s?void 0:s.format,_.forEach(v.input,function(m){var w,T,D,K,$;if(p.formatSource&&p.entity)return!1;if(m.measure||m.column){var G=null===(w=l[m.name])||void 0===w?void 0:w.expression;X.fF.assertValue(G,"input expression should be defined");var H=(null===(T=m.measure)||void 0===T?void 0:T.shouldUseForEntitySource)||(null===(D=m.column)||void 0===D?void 0:D.shouldUseForEntitySource),Y=null===(K=m.measure)||void 0===K?void 0:K.shouldUseForFormatting;if(H){var q=(null===($=u.targetEntity)||void 0===$?void 0:$.SourceRef)&&k.ib.deserializeExpr(u.targetEntity),j=void 0;q&&(0,e.Lk)(q)&&(j=q),(j=j??G.getTargetEntity())&&(p.entity=j.entity,p.schema=u.schemaName)}Y&&null==p.formatType&&(p.formatSource=k.ib.serializeExpr(G))}}),[2,p]}})})},C.prototype.onModelChanged=function(l){return(0,M.__awaiter)(this,void 0,void 0,function(){var d,g;return(0,M.__generator)(this,function(s){switch(s.label){case 0:return[4,this.conceptualSchemaProxy.get(this.dataSourcesService.get())];case 1:return d=s.sent(),g=I.rewrite(this.parametersStore$.value,l.changes,d,this.aggrOps),this.parametersStore$.next(g),[2]}})})},C.\u0275fac=function(d){return new(d||C)(N.\u0275\u0275inject(pe.C),N.\u0275\u0275inject(me.i),N.\u0275\u0275inject(ve.D),N.\u0275\u0275inject(W.r3),N.\u0275\u0275inject(ge.c),N.\u0275\u0275inject(he.W),N.\u0275\u0275inject(fe.J),N.\u0275\u0275inject(Ce.o))},C.\u0275prov=N.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac}),C}();function ae(C,l,d){var g,s,v,h={};if(null==C)return h;for(var f in C){var p=void 0,u=null===(g=C[f])||void 0===g?void 0:g.input;if(u){if(F.M.isColumnOrMeasure(u))p=u.value;else if(F.M.isNumber(u))p=(0,U.kQ)(u.value,u.type);else if(F.M.isEnum(u))p=(0,U.kQ)(u.value.value,u.type);else if(F.M.isBoolean(u))p=(0,U.O7)(u.value);else if(F.M.isInstance(u)&&null!==(s=u.value)&&void 0!==s&&s.filter&&null!==(v=u.value)&&void 0!==v&&v.field){var O=u.value,m=O.field,w=O.filter,T=m.getTargetColumnRef(l);_.isEmpty(w.where())||(p=d.replacerRewrite(w.where()[0].condition,T,m))}p&&(h[f]={expression:p})}}return h}},96739:function(re,V,i){i.d(V,{M:function(){return F}});var M=i(64648),S=i(62458),F=function(){function L(){}return L.isNumber=function(I){return S.fF.assertValue(I,"daxTemplateParameter input"),I.kind===M._.Number},L.isEnum=function(I){return S.fF.assertValue(I,"daxTemplateParameter input"),I.kind===M._.Enum},L.isBoolean=function(I){return S.fF.assertValue(I,"daxTemplateParameter input"),I.kind===M._.Boolean},L.isColumnOrMeasure=function(I){return S.fF.assertValue(I,"daxTemplateParameter input"),I.kind===M._.Field},L.isInstance=function(I){return S.fF.assertValue(I,"daxTemplateParameter input"),I.kind===M._.Instance},L}()},56598:function(re,V,i){i.d(V,{K:function(){return J}});var M=i(20914),S=i(5806),F=i(94770),L=i(93367),I=i(94841),k=i(79725),ee=i(16095),X=i(77476),Q=i(17174),te=i(79061),U=i(50423),J=function(){function z(){}return z.\u0275fac=function(Z){return new(Z||z)},z.\u0275mod=U.\u0275\u0275defineNgModule({type:z}),z.\u0275inj=U.\u0275\u0275defineInjector({imports:[X.CommonModule,S.Y,Q.u5,te.v,M._,F.f,L.U,I.b,k.j,ee.Z,Q.UX]}),z}()}}]);