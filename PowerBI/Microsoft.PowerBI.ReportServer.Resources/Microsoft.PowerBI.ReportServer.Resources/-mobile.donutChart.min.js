"use strict";(self.webpackChunkmobile=self.webpackChunkmobile||[]).push([["donutChart"],{2375:function(Qe,be,C){C.r(be),C.d(be,{DonutChart:function(){return te},DonutChartConverter:function(){return Ze},DonutChartWebBehavior:function(){return pt},WebDonutChartAnimator:function(){return ft},animationDurationMs:function(){return We},donutChartProps:function(){return k},ease:function(){return Ee}});var F=C(81337),me=C(94478),I=C(26314),O=C(60066),Q=C(32554),B=C(90120),fe=C(54522),X=C(5381),ae=C(46769),E=C(21181),q=C(33777),$e=C(49203),qe=C(80065),oe=C(52287),_e=C(86900),et=C(38400),Me=C(33024),tt=C(51129),le=C(86727),Ce=C(79811),at=C(77686),it=C(65741),pe=C(72902),rt=C(40739),ze=C(11305),Le=C(30431),ie=C(82030),w=C(6916),He=C(45296),N=C(62458),Be=C(41640),je=C(34644),st=C(39681),xe=C(59107),j=C(56578),de=C(43286),Y=C(10389),he=C(46135),Se=C(32379),re=C(82755),T=C(72489),Oe=C(26543),W=C(56707),U=C(70188),Ye=C(18664),nt=C(63972),we=C(54086),Fe=C(32041),ee=C(79154),x={ChartClass:(0,ee.CH)("donutChart"),LegendClass:(0,ee.CH)("donutLegend"),LegendArrowClass:(0,ee.CH)("donutLegendArrow"),SliceClass:(0,ee.CH)("slice"),SliceContainerClass:(0,ee.CH)("slices"),SliceHighlightClass:(0,ee.CH)("slice-highlight"),SubSelectionSlicesClassAndSelector:(0,ee.CH)("sub-selection-slices"),SubSelectionSliceClassAndSelector:(0,ee.CH)("sub-selection-slice"),DefaultStrokeColorName:"foregroundLight",isSingleColor:function(e){if(e.length>1){var t=e.length-1;e[t].data.isLastInDonut=e[t].data.color===e[0].data.color}},UpdateCurrentArcElementFunc:function(e){this._current=e},ArcDescriptorKeyFunc:function(e){return e.data.identity.getKey()}};function De(r,e){var t=e.explode;return Math.sin(r)*t}function Pe(r,e){var t=e.explode;return-Math.cos(r)*t}function Ue(r,e,t,a,i,s,n){void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0);var l,d,h,o=.8/.9*1.025;if(a){var c=a,g=e.labelRadius;d=[Math.cos(c)*g,Math.sin(c)*g],h=[Math.cos(c)*g,Math.sin(c)*g]}else d=e.labelArc.centroid(r),h=e.labelArc.centroid(r);n?.pieChartMarginBetweenSlices&&(d[0]=d[0]-i,d[1]=d[1]-s,h[0]=h[0]-i,h[1]=h[1]-s);var v=t.x,y=W.wh/2;return l=[v+=v<0?-y:y,t.y],h[0]*=o,h[1]*=o,[h,d,l]}function Ge(r){return r&&r.length>2?[{width:Math.abs(r[1][0]-r[0][0]),height:Math.abs(r[1][1]-r[0][1])},{width:Math.abs(r[2][0]-r[1][0]),height:W.Pd}]:null}function Ne(r){return r+(r<0?-W.wh:W.wh)}function Te(r,e){return e.width/2-Math.abs(r)-W.wh}function ht(r,e,t){for(var a=t.left,i=t.left+t.width,s=t.top,n=t.top+t.height,l=0,d=[{x:a,y:s},{x:a,y:n},{x:i,y:s},{x:i,y:n}];l<d.length;l++)if(!ct(r,e,d[l]))return!1;return!0}function ct(r,e,t){var a=Math.sqrt(t.x*t.x+t.y*t.y);if(a<e.innerRadius||a>e.outerRadius)return!1;var i=function(r){if(N.fF.assertValue(r,"DonutLabelUtils.getAngleFromPoint received a null point"),r){var e=r.x,t=-r.y;N.fF.assertValue(e,"DonutLabelUtils.getAngleFromPoint received a point containing null"),N.fF.assertValue(t,"DonutLabelUtils.getAngleFromPoint received a point containing null"),N.fF.assert(function(){return 0!==e||0!==t},"DonutLabelUtils.getAngleFromPoint received the point (0,0)");var a=Math.atan2(e,t);return a<0&&(a+=2*Math.PI),a}}(t);return!(i<r.startAngle||i>r.endAngle)}var Ke=[w._q,w.f3,w.ev,w.qv],vt=[0,1,2,3,4],gt=function(){function r(e){this.donutChartProperties=e,this.center={x:e.viewport.width/2,y:e.viewport.height/2},this.labelRadius=this.donutChartProperties.labelRadius;var t=(0,Ye.qk)(e.dataLabelsSettings.fontProperties);this.additionalParenthesesWidth=Fe.b.measureSvgTextWidth(t,"()"),this.additionalSpaceWidth=Fe.b.measureSvgTextWidth(t," "),this.ellipsisWidth=Fe.b.measureSvgTextWidth(t,"\u2026")}return r.prototype.layout=function(e,t,a){for(var i=[],s=0,n=e;s<n.length;s++){var o=n[s];i.push({labelDataPoint:o,hasBeenRendered:!1,labelSize:o.textSize})}for(var l=[],d=[],g=new nt.qC([{labelDataPoints:i,maxNumberOfLabels:e.length}],this.donutChartProperties.viewport),v=i.length-1;v>=0;v--)i[v].labelDataPoint.isPreferred&&(d=i.splice(v,1).concat(d));if(d.length>0&&(l=this.positionLabels(d,g,t,a)),e.length>0){var S=this.positionLabels(i,g,t,a);l=l.concat(S)}return _.filter(l,function(f){return f.isVisible})},r.prototype.positionLabels=function(e,t,a,i){var s=this,o=[],l=!1,d=function(S){for(var f=0,D=e;f<D.length;f++){var p=D[f];if(!p.hasBeenRendered){var m=S(p,t);if(m){var b=m.label;b&&(m.overflows&&(l=!0),p.hasBeenRendered=!0,o.push(b))}}}},h=function(){d(function(S,f){return{label:s.tryOutsidePositionForDonut(S,f,a,i),overflows:!0}})},c=function(){d(function(S,f){if(_.includes(Ke,s.donutChartProperties.dataLabelsSettings.labelStyle)){var D=s.splitDonutDataPoint(S,s.donutChartProperties.dataLabelsSettings.labelStyle);return s.tryInsidePositionForDonut(D,s.donutChartProperties,f,a)}return s.tryInsidePositionForDonut(S,s.donutChartProperties,f,a)})};switch(a.position??ie.SX){case ie.SX:h();break;case ie.Od:c();break;case ie.gC:h(),c();break;case ie.UX:c(),h()}if(l&&a.enableBackgroundWithAuto===Le.d7)for(var g=0,v=o;g<v.length;g++){var y=v[g];y.outside||(y.hasBackground=!0)}return o},r.prototype.tryOutsidePositionForDonut=function(e,t,a,i){var n=e.labelDataPoint.parentShape;if(!_.isEmpty(n.validPositions)&&0!==n.validPositions[0]){var o=n.validPositions[0],l=this.tryAllOutsidePositions(e,t,o,i);if(l&&0===l.score)return this.buildLabel(l,t,!0,a);if(_.includes(Ke,this.donutChartProperties.dataLabelsSettings.labelStyle)){var d=this.splitDonutDataPoint(e,this.donutChartProperties.dataLabelsSettings.labelStyle),h=this.tryAllOutsidePositions(d,t,o,i);if(h&&(!l||h.score<l.score))return this.buildLabel(h,t,!0,a)}if(l)return this.buildLabel(l,t,!0,a)}},r.prototype.tryInsidePositionForDonut=function(e,t,a,i){var s=this.tryAllInsidePositions(e,t,a,i.overflow);if(s)return{label:this.buildLabel(s,a,!1,i),overflows:s.overflows}},r.prototype.generateCandidate=function(e,t,a,i){var s=e.labelDataPoint,n=r.generateCandidateAngleForPosition(s.donutArcDescriptor,t),o=this.getPointPositionForAngle(n),l=o.point,d=this.score(s,l),h=(s.donutArcDescriptor.startAngle+s.donutArcDescriptor.endAngle)/2,c=De(h,this.donutChartProperties),g=Pe(h,this.donutChartProperties),v=Ue(s.donutArcDescriptor,this.donutChartProperties,l,n,c,g,i),y=Ge(v),u=_.clone(s);return u.parentShape=o,u.leaderLinePoints=v,u.linesSize=y,{point:o,score:d,labelRects:r.tryPositionPoint(a,o.validPositions[0],u,this.center,this.donutChartProperties.viewport,0,i),donutLabelDataPointLayoutInfo:{labelDataPoint:u,hasBeenRendered:e.hasBeenRendered,labelSize:e.labelSize},renderLeaderLines:!0,overflows:!1}},r.prototype.tryAllOutsidePositions=function(e,t,a,i){var s=e.labelDataPoint,o=r.tryPositionPoint(t,a,s,this.center,this.donutChartProperties.viewport,this.donutChartProperties.explode,i),l=s.parentShape,d={point:l,score:this.score(s,l.point),labelRects:o,donutLabelDataPointLayoutInfo:e,renderLeaderLines:!0,overflows:!1};if(o&&o.textRect&&0===d.score)return d;var c,h=[];o&&o.textRect?(h=r.getLabelPointPositions(s.parentShape,!0),c=d):h=r.getLabelPointPositions(s.parentShape,!1);for(var g=0,v=h;g<v.length;g++){var u=this.generateCandidate(e,v[g],t,i);if(u.labelRects&&u.labelRects.textRect&&(null==c||u.score<c.score)&&0===(c=u).score)return c}return c},r.prototype.tryAllInsidePositions=function(e,t,a,i){for(var d,h,c,g,s=e.labelDataPoint.angle,n=(t.innerRadius+t.outerRadius)/2,o=De(s,t),l=Pe(s,t),v=0,y=vt;v<y.length;v++){var m,S=this.getInsidePosition(e,t,s,n,y[v]),f=this.score(e.labelDataPoint,S),D={point:S,radius:0,validPositions:[256]},p=(0,we.c)(e.labelDataPoint.textSize,D,256,0);m=0===t.explode?{left:p.left+this.center.x,top:p.top+this.center.y,width:p.width,height:p.height}:{left:p.left+this.center.x+o,top:p.top+this.center.y+l,width:p.width,height:p.height};var b=!ht(e.labelDataPoint.donutArcDescriptor,t,p);(null==c||f>c)&&!a.hasConflict(m)&&(i||!b)&&(d=D,h=m,c=f,g=b)}if(d)return{point:d,score:0,labelRects:{textRect:h,diagonalLineRect:null,horizontalLineRect:null},donutLabelDataPointLayoutInfo:e,renderLeaderLines:!1,overflows:g}},r.prototype.getInsidePosition=function(e,t,a,i,s){var o=i,d=a;switch(s){case 0:break;case 1:o=i+.25*(t.outerRadius-t.innerRadius);break;case 2:o=i-.25*(t.outerRadius-t.innerRadius);break;case 3:d=a+.25*(e.labelDataPoint.donutArcDescriptor.endAngle-e.labelDataPoint.donutArcDescriptor.startAngle);break;case 4:d=a-.25*(e.labelDataPoint.donutArcDescriptor.endAngle-e.labelDataPoint.donutArcDescriptor.startAngle);break;default:N.fF.assertNever(s)}return function(r,e){var a;return N.fF.assert(function(){return r<=2*Math.PI&&r>=0},"DonutLabelUtils got an angle that was not betweeen 0 and 2 PI in radians (inclusive)"),a=e*Math.sin(r-Math.PI/2),{x:e*Math.cos(r-Math.PI/2),y:a}}(d,o)},r.prototype.buildLabel=function(e,t,a,i){var h,s=e.labelRects.textRect,n=e.labelRects.horizontalLineRect,o=e.labelRects.diagonalLineRect,d=e.donutLabelDataPointLayoutInfo.labelDataPoint;(null!=d.categoryLabel||null!=d.dataLabel||null!=d.percentLabel)&&(h=!0),t.add(s),n&&t.add(n),o&&t.add(o);var v,c=s.top-this.center.y,g=s.left-this.center.x;switch(a&&(g<0?g+=s.width/2:g-=s.width/2),e.point.validPositions[0]){case 8:v="start";break;case 4:v="end";break;case 256:v="middle";break;default:N.fF.assertFail("DonutLabelLayout.buildLabel received a shape with an unknown valid position")}var D,p,m,b,y={left:g,top:c,height:s.height,width:s.width},u=(0,U.RC)(this.donutChartProperties.dataLabelsSettings.labelStyle),S=Te(d.parentShape.point.x,this.donutChartProperties.viewport),f=S,P=E.Gv;if(u===w.YK.categoryAndDataAndPercent?null==d.secondRowText?f=S/=3:f/=2:u===w.YK.categoryAndData?null==d.secondRowText&&(f=S/=2):(u===w.YK.categoryAndPercent||u===w.YK.dataAndPercent)&&null==d.secondRowText&&(f=S/=2),(0,de.yE)(u,w.nO)){var R=void 0;(R=u!==w.YK.categoryAndDataAndPercent&&u!==w.YK.categoryAndData||null!=d.secondRowText?f:f-this.additionalSpaceWidth)<this.ellipsisWidth&&(h=!1),D=P({label:d.dataLabel,maxWidth:R,fontProperties:d.fontProperties})}if((0,de.yE)(u,w.mA)&&(S<this.ellipsisWidth&&(h=!1),p=P({label:d.categoryLabel,maxWidth:S,fontProperties:d.fontProperties})),(0,de.yE)(u,w.tG)){switch(R=void 0,u){case w.YK.categoryAndDataAndPercent:R=f-this.additionalParenthesesWidth-this.additionalSpaceWidth;break;case w.YK.dataAndPercent:R=null==d.secondRowText?f-this.additionalParenthesesWidth-this.additionalSpaceWidth:f-this.additionalParenthesesWidth;break;case w.YK.categoryAndPercent:R=f-this.additionalSpaceWidth;break;case w.YK.percent:R=f;break;default:N.fF.assertFail("Unexpected labelStyle: "+u),R=f}R<this.ellipsisWidth&&(h=!1),m=P({label:d.percentLabel,maxWidth:R,fontProperties:d.fontProperties})}switch(D&&"\u2026"!==D||p&&"\u2026"!==p||m&&"\u2026"!==m||(h=!1),u){case w.YK.categoryAndDataAndPercent:m=m?"(".concat(m,")"):null,null==d.secondRowText?b=(0,U.Ej)([p,D,m]," "):(b=(0,U.Ej)([D,m]," "),d.secondRowText=p);break;case w.YK.categoryAndData:null==d.secondRowText?b=(0,U.Ej)([p,D]," "):(b=D,d.secondRowText=p);break;case w.YK.categoryAndPercent:null==d.secondRowText?b=(0,U.Ej)([p,m]," "):(b=m,d.secondRowText=p);break;case w.YK.dataAndPercent:m=m?"(".concat(m,")"):null,null==d.secondRowText?b=(0,U.Ej)([D,m]," "):(b=m,d.secondRowText=D);break;case w.YK.data:b=D;break;case w.YK.percent:b=m;break;case w.YK.category:b=p;break;default:N.fF.assertFail("Unexpected labelStyle: "+u),b=p}return d.textSize.width=Math.min(d.textSize.width,u===w.YK.categoryAndDataAndPercent&&null==d.secondRowText?S+f+f:u===w.YK.categoryAndData||u===w.YK.categoryAndPercent?S+f:u===w.YK.dataAndPercent?f+f:S),{boundingBox:y,text:b,tooltip:a?d.tooltip:null,isVisible:h,identity:d.identity,fontProperties:(0,Ye.ED)(d.fontProperties,{color:a?d.outsideFill:d.insideFill}),selected:!1,textAnchor:v,leaderLinePoints:e.renderLeaderLines?d.leaderLinePoints:void 0,hasBackground:!a&&i.enableBackgroundWithAuto===Le.on,secondRowText:d.secondRowText,backgroundColor:d.backgroundColor,backgroundTransparency:d.backgroundTransparency,outside:a}},r.tryPositionPoint=function(e,t,a,i,s,n,o){void 0===n&&(n=0);var d,l=a.parentShape;d=o?.pieChartMarginBetweenSlices?W.ki-n<W.ki?W.ki:W.ki-n:W.ki;var h=_.clone(a.textSize);h.width=Math.min(h.width,Te(l.point.x,s));var c=(0,we.c)(h,l,t,d),v=(0,we.c)(a.linesSize[0],{point:{x:a.leaderLinePoints[0][0],y:a.leaderLinePoints[0][1]<0?a.leaderLinePoints[1][1]:a.leaderLinePoints[0][1]},radius:0,validPositions:null},t,d),u=(0,we.c)(a.linesSize[1],{point:{x:a.leaderLinePoints[1][0],y:a.leaderLinePoints[1][1]},radius:0,validPositions:null},t,d);if(c&&v&&u){c.left+=i.x,c.top+=i.y;var S=i.x-c.width/2;if(v.left+=S,v.top+=i.y,u.left+=S,u.top+=i.y,!e.hasConflict(c)&&!e.hasConflict(v)&&!e.hasConflict(u))return{textRect:c,diagonalLineRect:v,horizontalLineRect:u}}},r.getLabelPointPositions=function(e,t){var a=e.validPositions[0];return t?e.point.y<0?8===a?[64]:[128]:8===a?[16]:[32]:4===a?[128,32]:[16,64]},r.prototype.splitDonutDataPoint=function(e,t){var n,a=e.labelDataPoint,i=a.categoryLabelSize?a.categoryLabelSize.width:0,s=a.dataLabelSize?a.dataLabelSize.width:0;n=a.percentLabelSize?t===w.qv?a.percentLabelSize.width+this.additionalParenthesesWidth:t===w._q?a.percentLabelSize.width+this.additionalParenthesesWidth+this.additionalSpaceWidth:a.percentLabelSize.width:0;var o=a.categoryLabelSize?a.categoryLabelSize.height:0,l=a.dataLabelSize?a.dataLabelSize.height:0,d=a.percentLabelSize?a.percentLabelSize.height:0,h={width:t===w.qv?Math.max(s,n):Math.max(i,s+n),height:2*Math.max(o,Math.max(l,d))},c=_.clone(a);return c.textSize=h,c.secondRowText=t===w.qv?a.dataLabel:a.categoryLabel,{labelDataPoint:c,hasBeenRendered:e.hasBeenRendered,labelSize:e.labelSize}},r.generateCandidateAngleForPosition=function(e,t){var a=e.startAngle+(e.endAngle-e.startAngle)/2;switch(t){case 64:case 32:return(e.startAngle+a-Math.PI)/2;case 128:case 16:return(a+e.endAngle-Math.PI)/2;default:N.fF.assertFail("Unsupported label position")}},r.prototype.getPointPositionForAngle=function(e){var t=Ne(Math.cos(e)*this.labelRadius);return{point:{x:t,y:Math.sin(e)*this.labelRadius},validPositions:[t<0?4:8],radius:0}},r.prototype.score=function(e,t){var i,a=Te(t.x,this.donutChartProperties.viewport),s=this.donutChartProperties.dataLabelsSettings.labelStyle,n=e.categoryLabelSize?e.categoryLabelSize.width:0,o=e.dataLabelSize?e.dataLabelSize.width:0,l=e.percentLabelSize?e.percentLabelSize.width:0;if(s===w._q){if(null!=e.secondRowText){var d=Math.max(n-a,0),h=Math.max(Math.max(o,l+this.additionalParenthesesWidth+this.additionalSpaceWidth)-a/2,0);return Math.max(d,h)}i=Math.max(n,o+this.additionalSpaceWidth,l+this.additionalParenthesesWidth+this.additionalSpaceWidth),a/=3}else s===w.f3&&null==e.secondRowText?(i=Math.max(n,o+this.additionalSpaceWidth),a/=2):s===w.ev&&null==e.secondRowText?(i=Math.max(n,l+this.additionalSpaceWidth),a/=2):s===w.qv?(i=null==e.secondRowText?Math.max(o,l+this.additionalParenthesesWidth+this.additionalSpaceWidth):Math.max(o,l+this.additionalParenthesesWidth),a/=2):i=e.textSize.width;return Math.max(i-a,0)},r}(),ft=function(r){function e(t){return r.call(this,t)||this}return(0,F.ZT)(e,r),e.prototype.animate=function(t){var a,i,n,o,s=this;if(t.viewModel.highlightsOverflow||!this.previousViewModel||this.previousViewModel.highlightsOverflow)return this.previousViewModel=t.viewModel,e.FailedResult;var l=null===(n=this.previousViewModel)||void 0===n?void 0:n.hasHighlights,d=t.viewModel.hasHighlights,h=d&&!l?0:d&&l?1:!d&&l?2:void 0;if(null==h)return this.previousViewModel=t.viewModel,e.FailedResult;var c=function(b){return b.style("fill",function(P){var R;return null!==(R=P.data.color)&&void 0!==R?R:t.colors.getNewColorScale().getColor(P.data.identity.getKey()).value}).style("stroke",B.v.getThemeColor(t.style,x.DefaultStrokeColorName)).style("stroke-width",function(P){return P.data.strokeWidth})},g=function(b,P){return b.style("fill-opacity",P).style("stroke-opacity",P)},v=function(b){return b.transition().duration(s.animationDuration)},y=function(b,P){x.isSingleColor(b);var R=t.graphicsContext.select(x.SliceContainerClass.selector).selectAll(P.selector).data(b,x.ArcDescriptorKeyFunc);return{updated:R.enter().insert("path").classed(P.class,!0).each(x.UpdateCurrentArcElementFunc).merge(R),removed:R.exit()}},u=(a=y(t.viewModel.dataPoints,x.SliceClass)).updated,S=a.removed;c(u),g(u,2===h?function(m){return(0,O.eR)(m.data.selected,!1,m.data.selected,!m.data.selected)}:function(m){return(0,O.eR)(m.data.selected,!1,!1,t.viewModel.hasHighlights)});var f=v(u).attrs(t.layout.shapeLayout.attrs).styles(t.layout.shapeLayout.styles);2===h&&g(f=f.transition().duration(0),function(m){var b;return(0,O.eR)(m.data.selected,!1,null===(b=t.interactivityService)||void 0===b?void 0:b.hasSelection(),!1)}),S.remove();var D=(i=y(t.viewModel.dataPoints.filter(function(m){return null!=m.data.highlightRatio}),x.SliceHighlightClass)).updated,p=i.removed;return 2===h?(c(p),g(p,function(){return(0,O.eR)(!1,!0,!1,!0)}),v(p).attrTween("d",t.layout.highlightShapeTween(h)).styles(null!==(o=t.interactivityService)&&void 0!==o&&o.hasSelection()?t.layout.zeroShapeLayout.styles:t.layout.shapeLayout.styles).remove()):(c(D),g(D,function(m){var b;return(0,O.eR)(m.data.selected,!0,null===(b=t.interactivityService)||void 0===b?void 0:b.hasSelection(),t.viewModel.hasHighlights)}),0===h&&D.attrs(t.layout.shapeLayout.attrs).styles(t.layout.shapeLayout.styles),v(D).attrTween("d",t.layout.highlightShapeTween(h)).styles(t.layout.highlightShapeLayout.styles),p.remove()),(0,X.gm)({labelContext:t.labelGraphicsContext,backgroundContext:t.labelBackgroundContext,dataLabels:t.labels,hasTooltip:!0,numeric:!1,twoRows:!0,formatMode:t.formatMode,onObject:t.onObject}),(0,X.z8)(t.labelGraphicsContext,t.labels),this.previousViewModel=t.viewModel,{failed:!1,shapes:u,highlightShapes:D}},e.FailedResult={failed:!0,shapes:null,highlightShapes:null},e}(me.r5),G=C(30237),pt=function(){function r(){}return r.prototype.bindEvents=function(e,t,a,i){this.root=e.root,this.slices=e.slices,this.highlightSlices=e.highlightSlices,this.hasHighlights=e.hasHighlights,this.visualInstanceId=e.visualInstanceId;var s=e.clearCatcher;if(i)(0,G.FO)(this.slices),this.highlightSlices&&(0,G.FO)(this.highlightSlices),(0,G.to)(this.root),(0,G.Jv)(this.root),(0,G.BV)(this.root),(0,G.wf)(this.slices),s.on("click",null);else{if((0,G.a0)(this.slices,t),this.highlightSlices&&(0,G.a0)(this.highlightSlices,t),a){var n=a.dataPointNavigationManager,o=a.pointSourceKey;n.isEmpty(o)||((0,G.lt)(this.root,t),(0,G.zV)(this.root,this.visualInstanceId,o),(0,G.W3)(this.root,n,o),(0,G.I8)(this.slices,n,o))}s.on("click",function(){var l=d3.event;xe.M.isCtrlOrMeta(l)||t.handleClearSelection()})}},r.prototype.renderFocus=function(e){var t="".concat(O.aY,"-").concat(this.visualInstanceId);this.root.select("#"+t).attr("id",null),e&&(e.setAttribute("id",t),xe.M.focus(e))},r.prototype.renderSelection=function(e){var t=this.hasHighlights;this.slices.style("fill-opacity",function(a){return(0,O.eR)(a.data.selected,!1,e,t)}).style("stroke-opacity",function(a){return(0,O.eR)(a.data.selected,!1,e,t)}).attr("aria-selected",function(a){return a.data.selected}),this.highlightSlices&&this.highlightSlices.style("fill-opacity",function(a){return(0,O.eR)(a.data.selected,!0,e,t)}).style("stroke-opacity",function(a){return(0,O.eR)(a.data.selected,!0,e,t)})},r}(),We=500,Ee="cubic-in-out",k={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"}},legend:{show:{objectName:"legend",propertyName:"show"},position:{objectName:"legend",propertyName:"position"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"}},slices:{innerRadiusRatio:{objectName:"slices",propertyName:"innerRadiusRatio"},startAngle:{objectName:"slices",propertyName:"startAngle"},borderWidth:{objectName:"slices",propertyName:"borderWidth"},borderColor:{objectName:"slices",propertyName:"borderColor"},explode:{objectName:"slices",propertyName:"explode"}},labels:{position:{objectName:"labels",propertyName:"position"},overflow:{objectName:"labels",propertyName:"overflow"},background:{objectName:"labels",propertyName:"background"}}},te=function(){function r(e){this.featureSwitches={},e&&(this.isDonutChart=0!==e.sliceWidthRatio,this.animator=e.animator,this.isScrollable=!!e.isScrollable&&e.isScrollable,this.disableGeometricCulling=!!e.disableGeometricCulling&&e.disableGeometricCulling,this.behavior=e.behavior,this.tooltipsEnabled=e.tooltipsEnabled,e.smallViewPortProperties&&(this.maxHeightToScaleDonutLegend=e.smallViewPortProperties.maxHeightToScaleDonutLegend))}return Object.defineProperty(r.prototype,"showPlaceholders",{get:function(){var t;return(null===(t=this.featureSwitches)||void 0===t?void 0:t.onObject)&&1===this.viewMode&&this.isSelected},enumerable:!1,configurable:!0}),r.getDefaultDonutLabelSettings=function(e){return(0,F.pi)((0,F.pi)({},r.getDefaultLabelSettings(e)),{labelStyle:w.W3,percentagePrecision:W.Qc,position:ie.SX,overflow:!0,enableBackgroundWithAuto:Le.d7,bold:!1,italic:!1,underline:!1})},r.converter=function(e,t,a,i,s,n,o,l,d){void 0===l&&(l=!0);var h=new Ze(e,t,a,l);h.convert();var y,c=h.startAngle*(Math.PI/r.OnePiRadianInDegree),g=c+2*Math.PI,v=d3.pie().startAngle(c).endAngle(g).sort(null).value(function(f){return f.percentage});o&&(y=!h.hasCategoryData&&h.hasSeriesData?pe.jN.SeriesOnly:h.hasCategoryData&&h.hasSeriesData?pe.jN.CategoryFirst:pe.jN.CategoryOnly,o.applySelectionStateToData(h.dataPoints),o.applySelectionStateToData(h.legendData.dataPoints));var S,u=!n&&s?r.cullDataByViewport(h.dataPoints,h.maxValue,s,t.isHighContrast,h.borderWidth,d):h.dataPoints;return d&&d.onObject&&i&&(S=this.getSubSelectionArcDescriptors({dataView:e,dataPoints:u,hasCategoryData:h.hasCategoryData,hasDynamicSeries:h.hasDynamicSeries,startAngle:c,endAngle:g})),{dataPointsToDeprecate:u,dataPoints:v(u),unCulledDataPoints:h.dataPoints,dataPointsToEnumerate:h.legendData.dataPoints,legendData:h.legendData,hasHighlights:h.hasHighlights,highlightsOverflow:h.highlightsOverflow,dataLabelsSettings:h.dataLabelsSettings,legendObjectProperties:h.legendObjectProperties,maxValue:h.maxValue,visibleGeometryCulled:h.dataPoints.length!==u.length,hasNegativeValues:h.hasNegativeValues,allValuesAreNegative:h.allValuesAreNegative,donutInnerRadiusRatio:h.donutInnerRadiusRatio,startAngle:h.startAngle,navigationStrategy:y,explode:h.explode,borderWidth:h.borderWidth,borderColor:h.borderColor,hasDynamicSeries:h.hasDynamicSeries,hasSeriesData:h.hasSeriesData,hasCategoryData:h.hasCategoryData,subSelectionDataPoints:S}},r.getSubSelectionArcDescriptors=function(e){for(var a=e.endAngle,i=e.hasCategoryData,s=e.hasDynamicSeries,n=e.startAngle,o={},l=0,d=e.dataPoints;l<d.length;l++){var h=d[l],c=h.categoryIndex,g=h.seriesIndex,v=h.percentage,y=i||!s,u=y?c:g,S=o[u];S||(o[u]=S={displayName:y?h.categoryLabel:h.label,percentage:0,categoryIndex:y?c:void 0,seriesIndex:y?void 0:g}),S.percentage+=v}var D=_.values(o);return d3.pie().startAngle(n).endAngle(a).sort(null).value(function(m){return m.percentage})(D)},r.prototype.getFirstElement=function(){var e=this.flattenViewModel();return _.isEmpty(e)?{element:null}:{element:this.findHTMLElement(e[0].categoryIndex,e[0].seriesIndex)}},r.prototype.getNextDataPoint=function(e,t,a){var i=this.flattenViewModel(),s=(0,$e.R)(i,e,t,this.data.navigationStrategy,a);return{element:this.findHTMLElement(s.categoryIndex,s.seriesIndex)}},r.prototype.findHTMLElement=function(e,t){return this.mainGraphicsContext.selectAll(x.SliceClass.selector).filter(function(a){return a.data.categoryIndex===e&&a.data.seriesIndex===t}).node()},r.prototype.flattenViewModel=function(){return this.data.dataPoints.map(function(e){return{categoryIndex:e.data.categoryIndex,seriesIndex:e.data.seriesIndex}})},r.prototype.getDefaultDonutData=function(){return{dataPointsToDeprecate:[],dataPointsToEnumerate:[],dataPoints:[],unCulledDataPoints:[],legendData:(0,Ce.Fe)(this.style),hasHighlights:!1,highlightsOverflow:!1,dataLabelsSettings:r.getDefaultDonutLabelSettings(this.style),hasDynamicSeries:!1,hasNegativeValues:!1,allValuesAreNegative:!1,donutInnerRadiusRatio:this.isDonutChart?r.DefaultDonutInnerRadiusRatio:0,startAngle:r.DefaultStartAngleDegrees,navigationStrategy:null,explode:r.DefaultExplode,borderWidth:r.DefaultBorderWidth,borderColor:x.DefaultStrokeColorName,hasCategoryData:!1,hasSeriesData:!1}},r.prototype.init=function(e){var a,i,t=this;this.options=e,this.featureSwitches=e.featureSwitches||{};var s=e.element;if(s.empty(),this.parentViewport=e.viewport,this.viewMode=e.host.getViewMode(),this.currentViewport={height:e.viewport.height,width:e.viewport.width,scale:e.viewport.scale},this.style=e.style,this.colors=this.style.colorPalette.dataColors,this.data=this.getDefaultDonutData(),this.radius=0,this.maxOffset=0,this.mobileInteractiveLegend=!(null===(a=e.interactivity)||void 0===a||!a.mobileTileInteractive),this.hostService=e.host,this.behavior&&(this.interactivityService=(0,pe.ub)(this.hostService,this.featureSwitches)),this.legend=(0,it.OG)(s,this.mobileInteractiveLegend,this.interactivityService,this.isScrollable,void 0,this.style,this.hostService),this.tooltipService=(0,rt.r)(this.hostService),this.mobileInteractiveLegend&&(this.legendContainer=d3.select(s.get(0)).append("div").classed(x.LegendClass.class,!0),this.interactivityState={interactiveLegend:new St(this,this.legendContainer,this.colors,e),valueToAngleFactor:0,sliceAngles:[],currentRotate:0,interactiveChosenSliceFinishedSetting:!1,lastChosenInteractiveSliceIndex:0,totalDragAngleDifference:0,currentIndexDrag:0,previousIndexDrag:0,previousDragAngle:0,donutCenter:{x:0,y:0}}),this.featureSwitches.onObject){var o=(null===(i=this.hostService)||void 0===i?void 0:i.getSubSelectionService())??_e.D.createWithDefaultHost();this.subSelectionHelper=oe.O5.createHtmlSubselectionHelper({selectorCallback:function(h){return t.getSelectorsByColumnSubSelection(h)},customOutlineCallback:function(h){return t.getCustomSubSelectionOutlines(h)},hostElement:s.get(0),hostServices:this.hostService,renderer:o,targetSource:"format",scale:function(){return t.currentViewport.scale}})}if(this.svg=d3.select(s.get(0)).append("svg").style("position","absolute").classed(x.ChartClass.class,!0),this.behavior&&(this.clearCatcher=(0,pe.EX)(this.svg)),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed(x.SliceContainerClass.class,!0),this.interactivityService){var l=xe.M.isInternetExplorerOrEdge();this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0).attr("aria-label",this.hostService.getLocalizedString("Visual_Plot")).attr("aria-multiselectable",!0).attr("role","listbox").classed(O.Pg,!l)}this.labelBackgroundGraphicsContext=this.svg.append("g").classed(W.u9.class,!0),this.labelGraphicsContext=this.svg.append("g").classed(W.ZL.class,!0),this.pie=d3.pie().sort(null).value(function(d){return d.percentage})},r.prototype.onViewModeChanged=function(e){this.ensurePlaceholders(e,this.isSelected)},r.prototype.onSelectionStateChanged=function(e){this.ensurePlaceholders(this.viewMode,e)},r.prototype.ensurePlaceholders=function(e,t){var a=this.showPlaceholders;this.isSelected=t,this.viewMode=e,a!==this.showPlaceholders&&!this.mobileInteractiveLegend&&this.data&&this.legend&&this.renderLegend(this.formatMode)},r.prototype.update=function(e){var t,a;N.fF.assertValue(e,"updateOptions");var i=e.dataViews,s=e.formatMode,n=e.subSelections,o=e.suppressAnimations,l=e.type,d=e.viewport;if(this.formatMode=s,this.parentViewport=d,this.featureSwitches.onObject&&(this.subSelectionHelper.setFormatMode(s),null===(t=this.interactivityService)||void 0===t||t.setFormatMode(s)),l===he.EP.Resize||l===he.EP.ResizeEnd||(this.dataViews=i,this.data=(null===(a=this.dataViews)||void 0===a?void 0:a.length)>0&&this.dataViews[0].categorical?r.converter(this.dataViews[0],this.style,this.isDonutChart,s,this.parentViewport,this.disableGeometricCulling,this.interactivityService,this.tooltipsEnabled,this.featureSwitches):this.getDefaultDonutData()),this.mobileInteractiveLegend||this.renderLegend(s),this.initViewportDependantProperties(),this.updateDonutProperties(),this.updateInternal(this.data,o,s),this.dataViews){var c=(0,q.b)(this.dataViews,!1,!1,!1,["Tooltips"]);this.data.allValuesAreNegative?c.push(new He.fi):this.data.hasNegativeValues&&c.push(new He.v3),this.hostService.setWarnings(c)}if(this.subSelectionHelper&&(l&he.EP.Data||l&he.EP.Resize||l&he.EP.FormattingSubSelectionChange)&&(this.subSelectionHelper.updateOutlinesFromSubSelections(n,!0),this.hostService.alertScreenReader&&l&he.EP.FormattingSubSelectionChange)){var y=this.subSelectionHelper.getLabelsFromSubSelections(n,["aria-label"]),u=y?.length&&y.join(" ");u&&this.hostService.alertScreenReader(u)}},r.prototype.getLegendCard=function(){return(0,le.ZF)({legendData:this.data.legendData},this.hostService,this.featureSwitches)},r.prototype.getSlicesCard=function(){var e=this;if(this.data){var t=I.V9.slices,a=function(l){return e.hostService.getLocalizedString(l)},i=[I.V9.dataPoint.fill,t.innerRadiusRatio,t.borderColor,t.borderWidth,t.explode],s=new j.CQ(new j.lg("slices"),"Role_DisplayName_Slices",i,a),n=(0,le.l3)(this.data.legendData);return n.length>0&&s.addGroup("colors",function(o){o.withDisplayName("Visual_Colors"),(0,Q.y0)({groupBuilder:o,dataPoints:n,seriesColorProps:I.V9.dataPoint,localize:a,featureSwitches:e.featureSwitches})}),this.featureSwitches.pieChartMarginBetweenSlices?(0!==this.maxOffset&&this.data.explode>this.maxOffset&&(this.data.explode=this.maxOffset),s.addGroup("border",function(o){o.withDisplayName("Visual_Border").addSimpleSlice("borderColor",new j.BT({descriptor:t.borderColor,value:{value:e.data.borderColor}}).build()).addSimpleSlice("borderWidth",new j.JN({descriptor:I.V9.slices.borderWidth,value:e.data.borderWidth,localize:a}).build())}),s.addGroup("spacing",function(o){o.withDisplayName("Visual_Spacing").addSimpleSlice("innerRadius",new j.JN({descriptor:t.innerRadiusRatio,value:Math.round(100*e.data.donutInnerRadiusRatio/r.OuterRadiusRatio),localize:a,options:{minValue:{type:0,value:0},maxValue:{type:1,value:99},unitSymbol:Me.t2}}).build()).addSimpleSlice("explode",new j.JN({descriptor:t.explode,value:e.data.explode,localize:a}).build())})):this.isDonutChart&&s.addGroup("spacing",function(o){o.withDisplayName("Visual_Spacing").addSimpleSlice("innerRadius",new j.JN({descriptor:t.innerRadiusRatio,value:Math.round(100*e.data.donutInnerRadiusRatio/r.OuterRadiusRatio),localize:a,options:{minValue:{type:0,value:0},maxValue:{type:1,value:99},unitSymbol:Me.t2}}).build())}),s.build()}},r.prototype.getDetailLabelsCard=function(){var t,a,e=this,i=(0,F.pi)((0,F.pi)({},(0,E.kL)("labels")),{position:I.V9.labels.position,overflow:I.V9.labels.overflow,background:I.V9.labels.background}),s=new j.CQ(new j.lg("labels"),"Visual_DetailLabels",i,function(n){return e.hostService.getLocalizedString(n)});return(0,E.XQ)({cardBuilder:s,dataLabelsProps:i,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:{dataLabelsSettings:null!==(a=null===(t=this.data)||void 0===t?void 0:t.dataLabelsSettings)&&void 0!==a?a:r.getDefaultDonutLabelSettings(this.style),show:!0,displayUnits:!0,precision:!0,percentagePrecision:!0,fontSize:!0,fontFamily:!0,labelStyle:!0,style:this.style,bold:!0,italic:!0,underline:!0},omitDescription:!0,individualSelector:this.getLabelIndividualSelector()})},r.prototype.getRotationCard=function(){var e=this;if(this.data){var t=function(i){return e.hostService.getLocalizedString(i)};return new j.CQ(new j.lg("rotation"),"Visual_BasicShape_Rotate",[I.V9.slices.startAngle],t).addGroup("default",function(a){return a.addSimpleSlice("rotation",new j.JN({descriptor:I.V9.slices.startAngle,value:e.data.startAngle,options:{minValue:{type:0,value:0},maxValue:{type:1,value:360},unitSymbol:Me.g},localize:t}).build(),function(i){return i.withCustomDisplayName("Visual_BasicShape_Rotate")})}).build()}},r.prototype.getFormattingModel=function(){var e=this;if(this.data)return new j.Nq(function(){return e.getLegendCard()},function(){return e.getSlicesCard()},function(){return e.getDetailLabelsCard()},function(){return e.getRotationCard()}).build()},r.prototype.setInteractiveChosenSlice=function(e,t){var a=this;if(0!==this.interactivityState.sliceAngles.length){this.interactivityState.lastChosenInteractiveSliceIndex=e,this.interactivityState.interactiveChosenSliceFinishedSetting=!1;var i=this.currentViewport,s=e%this.data.dataPoints.length,n=this.interactivityState.sliceAngles[s],o=this.svg.select("g");o.transition().duration(t??We).ease((0,je.Ad)(Ee)).attr("transform",(0,Y.I2)(i.width/2,i.height/2,0,0,n)).on("end",function(){a.interactivityState.interactiveChosenSliceFinishedSetting=!0}),this.interactivityState.currentRotate=n,this.interactivityState.interactiveLegend.updateLegend(s),this.svg.selectAll(x.SliceClass.selector).attr("opacity",function(l,d){return(0,O.eR)(d===s,!1,!0,!1)}),(0,Y.bL)(this.options,o)}},r.prototype.calculateRadius=function(){var e,t=this.currentViewport;if(!this.mobileInteractiveLegend&&null!==(e=this.data)&&void 0!==e&&e.dataLabelsSettings.show){var i=2+1/(1+Math.exp(-5*(t.height/t.width-1)));return Math.min(t.height,t.width)/i}return Math.min(t.height,t.width)/2},r.prototype.getScaleForLegendArrow=function(){return this.maxHeightToScaleDonutLegend&&this.currentViewport.height<this.maxHeightToScaleDonutLegend?this.currentViewport.height/this.maxHeightToScaleDonutLegend:1},r.prototype.initViewportDependantProperties=function(e){var t=this;void 0===e&&(e=0),this.currentViewport.height=this.parentViewport.height,this.currentViewport.width=this.parentViewport.width,this.currentViewport.scale=this.parentViewport.scale;var a=this.currentViewport;if(this.mobileInteractiveLegend)a.height-=r.InteractiveLegendContainerHeight;else{var i=this.legend.getMargins();a.height-=i.height,a.width-=i.width}this.svg.attr("width",a.width).attr("height",a.height),this.mobileInteractiveLegend?(this.legendContainer.style("width","100%").style("height",r.InteractiveLegendContainerHeight+"px").style("overflow","hidden").style("top",0),this.svg.style("top",r.InteractiveLegendContainerHeight)):(0,at.xz)(this.svg,this.legend),this.previousRadius=this.radius,this.radius=this.calculateRadius();var s=this.radius*r.LabelRadiusRatio;this.outerArc=d3.arc(),this.labelArc=d3.arc().innerRadius(s).outerRadius(s-this.data.explode);var n=function(l){(t.mobileInteractiveLegend?l:l.transition().duration(e)).attr("transform",(0,Y.Iu)(a.width/2,a.height/2))};n(this.mainGraphicsContext),n(this.labelGraphicsContext),n(this.labelBackgroundGraphicsContext),(0,Y.bL)(this.options,this.mainGraphicsContext,this.labelGraphicsContext,this.labelBackgroundGraphicsContext)},r.prototype.updateDonutProperties=function(){var i,e=this.radius*r.LabelRadiusRatio,t=this.radius*r.OuterRadiusRatio-this.data.explode,a=this.radius*this.data.donutInnerRadiusRatio;2*t+5<Math.min(this.currentViewport.height,this.currentViewport.width)&&(i=Math.round(this.radius*r.OuterRadiusRatio-(this.data.explode+1)),i=Math.min(50,Math.max(0,i))),(Math.round(t-a)<r.MinDonutThickness||this.radius*r.OuterRadiusRatio+this.data.explode>e)&&(this.data.explode=0),this.donutProperties={viewport:this.currentViewport,outerArc:this.outerArc.innerRadius(0).outerRadius(a),labelArc:this.labelArc,dataLabelsSettings:this.data.dataLabelsSettings,innerRadius:a,outerRadius:t,labelRadius:e,startAngle:this.data.startAngle,explode:this.data.explode,maxOffset:i}},r.prototype.mergeDatasets=function(e,t){for(var a={},i=0,s=t;i<s.length;i++){var n=s[i],o=n.identity?n.identity.getKey():n.data.identity.getKey();a[o]=null}var l=_.filter(e,function(h){return!((h.identity?h.identity.getKey():h.data.identity.getKey())in a)}),d=_.map(l,function(h){var c=(0,st.ED)(h);return void 0===c.percentage?c.data.percentage=0:c.percentage=0,c});return(0,F.ev)((0,F.ev)([],t,!0),d,!0)},r.prototype.updateInternal=function(e,t,a){var i;if(this.animator){var s=this.getDonutLayout(e),n=null!==(i=e.dataLabelsSettings)&&void 0!==i&&i.show?this.createLabels():[],o=void 0,l=void 0,d=void 0;if(t||(l=(o=this.animator.animate({viewModel:e,colors:this.colors,graphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,labelBackgroundContext:this.labelBackgroundGraphicsContext,interactivityService:this.interactivityService,layout:s,radius:this.radius,donutProperties:this.donutProperties,viewport:this.currentViewport,labels:n,style:this.style,formatMode:a,onObject:this.featureSwitches.onObject})).shapes,d=o.highlightShapes),t||o.failed){l=this.drawDefaultShapes(e,s,a),d=this.drawDefaultHighlightShapes(e,s),(0,X.gm)({labelContext:this.labelGraphicsContext,dataLabels:n,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext,twoRows:!0,hasTooltip:!0,formatMode:a,onObject:this.featureSwitches.onObject});var h=(0,ae.sW)(this.style);n.map(function(g){g.leaderLine=(0,F.pi)((0,F.pi)({},h),{strokeTransparency:50,strokeShow:!0})}),(0,X.z8)(this.labelGraphicsContext,n)}this.assignInteractions(l,d,e,a)}else{var c=(0,me.Mb)(this.animator,t);this.updateInternalToMove(e,c,this.style,a)}(0,Y.bL)(this.options)},r.prototype.createLabels=function(){return new gt(this.donutProperties).layout(this.createLabelDataPoints(),this.data.dataLabelsSettings,this.featureSwitches)},r.prototype.createLabelDataPoints=function(){var e=this.data,t=[],a=(0,E.fI)(),i=null;0===e.dataLabelsSettings.displayUnits&&(i=d3.max(e.dataPoints,function(o){return Math.abs(o.data.measure)}));for(var s=0;s<this.data.dataPoints.length;s++){var n=this.createLabelDataPoint(e.dataPoints[s],i,a,this.featureSwitches);t.push(n)}return t},r.prototype.createLabelDataPoint=function(e,t,a,i){var s,n,o,l,v,y,d=this.labelArc.centroid(e),h=(e.startAngle+e.endAngle)/2,c=De(h,this.donutProperties),g=Pe(h,this.donutProperties);i?.pieChartMarginBetweenSlices?(v=Ne(d[0])-c,y=d[1]-g):(v=Ne(d[0]),y=d[1]);var P,R,L,V,M,z,K,u=this.data.dataLabelsSettings,f={point:{x:v,y},validPositions:[v<0?4:8],radius:0},D=B.v.getThemeColor(this.style,W.uQ),p=B.v.getThemeColor(this.style,W.pl),m=null!==(n=null!==(s=e.data.detailLabelFill)&&void 0!==s?s:D)&&void 0!==n?n:u.fontProperties.color,b=null!==(l=null!==(o=e.data.insideDetailLabelFill)&&void 0!==o?o:p)&&void 0!==l?l:u.fontProperties.color,J=(0,U.RC)(u.labelStyle),H=u.fontProperties,A="",Ae=this.data.hasHighlights,ye=this.data.highlightsOverflow;if((0,de.yE)(J,w.nO)){var ce=void 0,ue=void 0;Ae&&!ye?(ce=e.data.originalHighlightValue,ue=a.getOrCreate(e.data.highlightFormat,u,t)):(ce=e.data.originalMeasure,ue=a.getOrCreate(e.data.measureFormat,u,t)),P=null!=ce?ue.format(ce):null,R=(0,E.y3)(P,H)}if((0,de.yE)(J,w.mA)&&(V=(0,E.y3)(L=e.data.label,H)),(0,de.yE)(J,w.tG)){var ve=(0,T.Z)("Percentage"),se=Ae&&!ye?e.data.highlightPercentage:e.data.percentage,ge=_.clone(u),Z=ge.percentagePrecision;if(ge.displayUnits=0,_.isFinite(Z)){var ke=a.getOrCreate(ve,ge,null,ge.percentagePrecision);M=null!=se?ke.format(se):null}else M=(0,T.WU)(se,ve);z=(0,E.y3)(M,H)}switch(J){case w.YK.categoryAndDataAndPercent:A=L,P&&(A=(0,U.Ej)([A,P]," ")),M&&(A=(0,U.Ej)([A,"(".concat(M,")")]," ")),K=(0,E.y3)(A,H);break;case w.YK.categoryAndData:A=L,P&&(A=(0,U.Ej)([A,P]," ")),K=(0,E.y3)(A,H);break;case w.YK.categoryAndPercent:A=L,M&&(A=(0,U.Ej)([A,M]," ")),K=(0,E.y3)(A,H);break;case w.YK.dataAndPercent:A=P,M&&(A=(0,U.Ej)([A,"(".concat(M,")")]," ")),K=(0,E.y3)(A,H);break;case w.YK.data:K=_.clone(R),A=P;break;case w.YK.percent:K=_.clone(z),A=M;break;case w.YK.category:K=_.clone(V),A=L;break;default:N.fF.assertFail("Unexpected labelStyle: "+J),K=_.clone(V),A=L}var ne=Ue(e,this.donutProperties,f.point,0,c,g,this.featureSwitches),Ie=Ge(ne);return{isPreferred:!0,text:"",tooltip:A,textSize:K,outsideFill:m,insideFill:b,fontProperties:H,identity:e.data.identity,parentShape:f,parentType:0,alternativeScale:t,donutArcDescriptor:e,angle:(e.endAngle+e.startAngle)/2,dataLabel:P,dataLabelSize:R,categoryLabel:L,categoryLabelSize:V,percentLabel:M,percentLabelSize:z,leaderLinePoints:ne,linesSize:Ie,backgroundColor:u.backgroundColor,backgroundTransparency:u.backgroundTransparency}},r.prototype.renderLegend=function(e){if(!this.mobileInteractiveLegend){var t=this.data.legendObjectProperties?this.data.legendData:(0,Ce.Fe)(this.style);null!=t.position&&this.legend.setPosition(t.position),this.legend.drawLegend({data:t,parentViewport:this.parentViewport,formatMode:e,onObject:this.featureSwitches.onObject,showTitlePlaceholder:this.showPlaceholders,titleSliceUid:"".concat("legend","-").concat("title","-titleText")}),this.featureSwitches.onObject&&this.subSelectionHelper.addDirectEditPlaceholderOutlines()}},r.prototype.getSelectorsByColumnSubSelection=function(e){if("slices"===d3.select(e).attr(oe.Ez)){var a=d3.select(e).datum();return this.getSelectorFromArcDescriptor(a)}return{}},r.prototype.getSelectorFromArcDescriptor=function(e){var t,a,i=(t=e.data).categoryIndex,n=(a=this.data).legendData,d=a.hasCategoryData||!a.hasDynamicSeries?i:t.seriesIndex,h=n.dataPoints;if(!_.isEmpty(h))return h[d].identity.getSelectorsByColumn()},r.prototype.getCustomSubSelectionOutlines=function(e){var t=this,i=_.reduce(e.visualObjects,function(s,n){var l;return"slices"===n.objectName&&(l=t.getSliceSubSelectionOutlines(n)),_.isEmpty(l)||s.push.apply(s,l),s},[]);return _.isEmpty(i)?void 0:i},r.prototype.getSliceSubSelectionOutlines=function(e){var t,a,i,s=this,n=e.selectorsByColumn,l=this.data.subSelectionDataPoints.find(function(M){return(0,Se.Ic)(s.getSelectorFromArcDescriptor(M),n)});if(l){var d=(t=this.donutProperties).innerRadius,c=l.startAngle,g=l.endAngle,v=(a=l.data).categoryIndex,y=a.seriesIndex,u=this.parentViewport.scale,S=d*u,f=t.outerRadius*u,L={x:(i=this.mainGraphicsContext.node().getBoundingClientRect()).left+i.width/2,y:i.top+i.height/2};return[{id:"category".concat(v??-1,"-series").concat(y??-1),outline:{type:4,center:L,innerRadius:S,outerRadius:f,startAngle:c,endAngle:g}}]}N.fF.assertFail("Unable to find data point for sub-selected slice")},r.prototype.getSubSelectionStyles=function(e){if(this.featureSwitches.onObject){var t=_.first(e),a=t.visualObjects;N.fF.assert(function(){return 1===a.length},"Expected 1 visual");var i=a[0];switch(N.fF.assert(function(){return 1===e.length||e.every(function(s){return _.isEqual(s.visualObjects,[i])},"Expected 1 sub-selection or matching objects")}),i.objectName){case"legend-title":return(0,le.aJ)();case"legend-items":return(0,le.Gh)(this.hostService);case"data-labels":return(0,qe.Jf)({hostServices:this.hostService,omitSelectorForSingleSeries:!0,individualSelector:this.getLabelIndividualSelector(),selector:void 0,repetitionSelector:void 0,subSelectionStylesOptions:{precision:{defaultPrecision:(0,T.h1)(void 0,(0,T.Z)("Percentage"))}}},{fontFamilyReference:I.V9.labels.fontFamily,fontSizeReference:I.V9.labels.fontSize,boldReference:I.V9.labels.bold,italicReference:I.V9.labels.italic,underlineReference:I.V9.labels.underline,fontColorReference:I.V9.labels.color,displayUnitsReference:I.V9.labels.labelDisplayUnits,precisionReference:I.V9.labels.labelPrecision});case"slices":return this.getSliceSubSelectionStyles(t)}}},r.prototype.getLabelIndividualSelector=function(){return(0,E.WD)({featureSwitches:this.featureSwitches,hasCategories:this.data.hasCategoryData&&null!=_.first(this.data.legendData.dataPoints),hasDynamicSeries:this.data.hasDynamicSeries,hasSeriesSelector:!1})},r.prototype.getSliceSubSelectionStyles=function(e){var t=e.visualObjects;N.fF.assert(function(){return 1===t.length},"Expected 1 visualObject");var a=(0,Se.fd)((0,Se.tV)(t[0].selectorsByColumn));return{type:3,fill:{label:this.hostService.getLocalizedString("Visual_Fill"),reference:(0,F.pi)((0,F.pi)({},I.V9.dataPoint.fill),{selector:a})}}},r.prototype.getSubSelectionShortcuts=function(e,t){if(this.featureSwitches.onObject&&!t){var i=_.first(e).visualObjects;N.fF.assert(function(){return 1===i.length},"Expected 1 visual");var s=i[0];switch(N.fF.assert(function(){return 1===e.length||e.every(function(n){return _.isEqual(n.visualObjects,[s])},"Expected 1 sub-selection or matching objects")}),s.objectName){case"legend-title":return(0,le.tV)(this.hostService);case"legend-items":return(0,le.tY)({hostServices:this.hostService,showSort:!0});case"data-labels":return this.getDetailLabelShortcuts();case"slices":return this.getSliceShortcuts(e)}}},r.prototype.getSubSelectables=function(e){return this.subSelectionHelper.getAllSubSelectables(e)},r.prototype.getNextSubSelectable=function(e,t){return this.subSelectionHelper.getNextSubSelectable(e,t)},r.prototype.getDetailLabelShortcuts=function(){var e=this,t="".concat("Visual","-").concat("labels"),a=function(s){return e.hostService.getLocalizedString(s)};return[{type:0},(0,F.pi)((0,F.pi)({type:3},I.V9.labels.labelStyle),{label:a("Visual_LabelContents")}),(0,F.pi)((0,F.pi)({type:3},I.V9.labels.position),{label:a("Visual_Position")}),{type:1,destinationInfo:{cardUid:t},label:a("Format_Detail_Labels")}]},r.prototype.getSliceShortcuts=function(e){var t=this,a="".concat("Visual","-").concat("slices"),i=function(l){return t.hostService.getLocalizedString(l)},s=_.first(e).visualObjects;N.fF.assert(function(){return 1===s.length},"Expected 1 visualObject");var n=(0,Se.fd)((0,Se.tV)(s[0].selectorsByColumn));return[{type:0,relatedResetFormattingIds:[(0,F.pi)((0,F.pi)({},I.V9.dataPoint.fill),{selector:n})]},(0,F.pi)((0,F.pi)({type:2},I.V9.labels.show),{enabledLabel:i("Format_AddDetailLabels")}),{type:1,destinationInfo:{cardUid:a},label:i("Format_Slices")}]},r.prototype.addInteractiveLegendArrow=function(){if(this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length){if(!this.interactiveLegendArrow){var a=this.svg.append("g");a.append("path").classed(x.LegendArrowClass.class,!0).attr("d","M1.5,2.6C0.65,1.15,1.85,0,3,0l27,0c1.65,0,2.35,1.15,1.5,2.6L18,26.45c-0.8,1.45-2.15,1.45-2.95,0L1.95,2.6z"),this.interactiveLegendArrow=a}var i=this.getScaleForLegendArrow();this.interactiveLegendArrow.attr("transform",(0,Y.aI)(this.currentViewport.width/2-16.5*i,(this.currentViewport.height-2*this.radius)/2+11*i,i))}},r.prototype.calculateSliceAngles=function(){var e=[],t=this.data.dataPoints;if(0===t.length)return this.interactivityState.valueToAngleFactor=0,void(this.interactivityState.sliceAngles=[]);for(var a=0,i=0,s=t.length;i<s;i++)a+=t[i].data.percentage;N.fF.assert(function(){return 0!==a},"sum of slices values cannot be zero"),this.interactivityState.valueToAngleFactor=360/a;var n=0;for(i=0,s=t.length;i<s;i++){var o=t[i].data.percentage*this.interactivityState.valueToAngleFactor;e.push(o/2-(n+=o))}this.interactivityState.sliceAngles=e},r.prototype.assignInteractions=function(e,t,a,i){if(this.mobileInteractiveLegend)this.assignInteractiveChartInteractions(e);else if(this.interactivityService){var s=a.dataPoints.map(function(d){return d.data}),n={root:this.mainGraphicsContext,clearCatcher:this.clearCatcher,slices:e,highlightSlices:t,visual:this,hasHighlights:a.hasHighlights,visualInstanceId:this.hostService.instanceId};e.attr("tabindex",0).attr("focusable",!0),this.interactivityService.bind(s,this.behavior,n,{navigationOptions:{navigationStrategy:this.data.navigationStrategy,helper:this},pointSourceKey:"donut"}),this.featureSwitches.onObject&&this.interactivityService.setFormatMode(i)}this.tooltipsEnabled&&this.addTooltips(e,t)},r.prototype.assignInteractiveChartInteractions=function(e){var t=this,a=this.svg.node().getBoundingClientRect();this.interactivityState.donutCenter={x:a.left+a.width/2,y:a.top+a.height/2},this.interactivityState.totalDragAngleDifference=0,this.interactivityState.currentRotate=0,this.interactivityState.interactiveChosenSliceFinishedSetting=!0,this.calculateSliceAngles(),e.on("click",function(s,n){d3.event.defaultPrevented||t.setInteractiveChosenSlice(n)});var i=d3.drag().on("start",this.interactiveDragStart).on("drag",this.interactiveDragMove).on("end",this.interactiveDragEnd);this.svg.style("touch-action","none").call(i)},r.prototype.getAngleFromDragEvent=function(){var t,a,e=this.interactivityState,i=d3.event.sourceEvent;if(-1!==i.type.toLowerCase().indexOf("touch")){if(1!==i.touches.length)return null;var s=i.touches[0];t=s.pageX,a=s.pageY}else t=i.pageX,a=i.pageY;var n={x:t-e.donutCenter.x,y:-a+e.donutCenter.y};return 180*Math.atan2(n.y,n.x)/Math.PI},r.prototype.interactiveDragStart=function(){this.interactivityState.totalDragAngleDifference=0,this.interactivityState.previousDragAngle=this.getAngleFromDragEvent()},r.prototype.interactiveDragMove=function(){var e=this.data.dataPoints,t=this.interactivityState;if(!0===t.interactiveChosenSliceFinishedSetting){var a=this.getAngleFromDragEvent();if(!a)return;var i=t.previousDragAngle-a;t.totalDragAngleDifference+=i,t.previousDragAngle=a,t.currentRotate+=i,this.svg.select("g").attr("transform",(0,Y.I2)(this.currentViewport.width/2,this.currentViewport.height/2,0,0,this.interactivityState.currentRotate));var s=e[0].data.percentage*t.valueToAngleFactor,n=t.currentRotate<=0?-1*t.currentRotate%360:360-t.currentRotate%360;t.currentIndexDrag=0;for(var o=e.length;t.currentIndexDrag<o&&n>s;)t.currentIndexDrag<o-1&&(s+=e[t.currentIndexDrag+1].data.percentage*t.valueToAngleFactor),t.currentIndexDrag++;t.currentIndexDrag!==t.previousIndexDrag&&(t.interactiveLegend.updateLegend(t.currentIndexDrag),this.svg.selectAll(x.SliceClass.selector).attr("opacity",function(l,d){return(0,O.eR)(d===t.currentIndexDrag,!1,!0,!1)}),t.previousIndexDrag=t.currentIndexDrag)}},r.prototype.interactiveDragEnd=function(){0!==this.interactivityState.totalDragAngleDifference&&(this.setInteractiveChosenSlice(this.interactivityState.currentIndexDrag),d3.event.sourceEvent.stopPropagation())},r.prototype.updateInternalToMove=function(e,t,a,i){var s=this.svg,n=this.pie,o=this.key,l=this.outerArc,d=this.radius,h=this.previousRadius,c=e.borderColor,g=this.donutProperties,v=this.svg.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data().map(function(L){return L.data});0===v.length&&(v=e.dataPointsToDeprecate);var y=this.mergeDatasets(v,e.dataPointsToDeprecate),u=s.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(n(e.dataPointsToDeprecate),o);u.enter().insert("path").classed(x.SliceClass.class,!0).each(x.UpdateCurrentArcElementFunc),u=s.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(n(y),o);var p,m,S=this.donutProperties.innerRadius;if(x.isSingleColor(e.dataPoints),l.innerRadius(S),a.isHighContrast||u.style("stroke-opacity",function(L){return(0,O.eR)(L.data.selected,!1,!1,e.hasHighlights)}).style("stroke-dasharray",function(L){return r.drawStrokeForDonutChart(L,g)}),u.style("fill",function(L){return L.data.color}).style("fill-opacity",function(L){return(0,O.eR)(L.data.selected,!1,!1,e.hasHighlights)}).style("stroke",c).style("stroke-width",function(L){return L.data.strokeWidth}).transition().duration(t).attrTween("d",function(L){var V=d3.interpolateObject(this._current,L),M=d3.interpolateNumber(h*r.OuterRadiusRatio,d*r.OuterRadiusRatio);return this._current=V(0),function(z){return l.outerRadius(M(z))(V(z))}}),(u=s.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(n(e.dataPointsToDeprecate),o)).exit().transition().delay(t).duration(0).remove(),!this.mobileInteractiveLegend){var f=e.dataLabelsSettings,D=[];f&&f.show&&(D=this.createLabels()),(0,X.gm)({labelContext:this.labelGraphicsContext,dataLabels:D,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext,formatMode:i,onObject:this.featureSwitches.onObject}),(0,X.z8)(this.labelGraphicsContext,D)}if(e.hasHighlights){var b=s.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceHighlightClass.selector).data(n(e.dataPointsToDeprecate),o);p=b.enter().insert("path").classed(x.SliceHighlightClass.class,!0).each(x.UpdateCurrentArcElementFunc).merge(b),x.isSingleColor(e.dataPoints),a.isHighContrast||p.style("stroke-opacity",1).style("stroke-dasharray",function(L){return r.drawStrokeForDonutChart(L,g,L.data.highlightRatio)});var P=this;p.style("fill",function(L){return L.data.color}).style("fill-opacity",1).style("stroke",c).style("stroke-width",function(L){return 0===L.data.highlightRatio?0:L.data.strokeWidth}).transition().duration(t).attrTween("d",function(L){var V=d3.interpolateObject(this._current,L),M=d3.interpolateNumber(h*r.OuterRadiusRatio,P.getHighlightRadius(L));return this._current=V(0),function(z){return l.outerRadius(M(z))(V(z))}}),m=b.exit().transition().delay(t).duration(0).remove()}else s.selectAll("path"+x.SliceHighlightClass.selector).transition().delay(t).duration(0).remove();this.assignInteractions(u,p,e,i),(0,Y.bL)(this.options,u,u.exit(),p,m),this.mobileInteractiveLegend&&(this.addInteractiveLegendArrow(),this.interactivityState.interactiveLegend.drawLegend(this.data.dataPointsToDeprecate),this.setInteractiveChosenSlice(this.interactivityState.lastChosenInteractiveSliceIndex?this.interactivityState.lastChosenInteractiveSliceIndex:0,t))},r.prototype.addTooltips=function(e,t){this.tooltipService.addTooltip(e,function(a){var i;return null===(i=a.data)||void 0===i?void 0:i.data.tooltipInfo},function(a){var i;return(null===(i=a.data)||void 0===i?void 0:i.data.identity)&&[a.data.data.identity]}),t&&this.tooltipService.addTooltip(t,function(a){var i;return null===(i=a.data)||void 0===i?void 0:i.data.tooltipInfo},function(a){var i;return(null===(i=a.data)||void 0===i?void 0:i.data.identity)&&[a.data.data.identity]})},r.prototype.drawDefaultShapes=function(e,t,a){var i,s=this.svg.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceClass.selector).data(e.dataPoints,x.ArcDescriptorKeyFunc),n=null===(i=this.interactivityService)||void 0===i?void 0:i.hasSelection(),o=s.enter().insert("path").attr("class",x.SliceClass.class).merge(s);return x.isSingleColor(e.dataPoints),this.interactivityService&&o.attr("tabindex",function(l){return null!=l.data.measure?0:null}).attr("focusable",function(l){return null!=l.data.measure||null}).attr("aria-label",function(l){return l.data.formattedTooltip}).attr("role","option").classed(O.Pg,!xe.M.isInternetExplorerOrEdge()),o.style("fill",function(l){return l.data.color}).style("fill-opacity",function(l){return(0,O.eR)(l.data.selected,!1,n,e.hasHighlights)}).style("stroke-opacity",function(l){return(0,O.eR)(l.data.selected,!1,n,e.hasHighlights)}).style("stroke",e.borderColor).style("stroke-width",function(l){return l.data.strokeWidth}).attrs(t.shapeLayout.attrs).styles(t.shapeLayout.styles),s.exit().remove(),this.featureSwitches.onObject&&r.drawSubSelectionShapes(this.mainGraphicsContext,e,t,this.hostService,a),o},r.drawSubSelectionShapes=function(e,t,a,i,s){var n,o=e.selectAll(x.SubSelectionSlicesClassAndSelector.selector).data(s&&t.subSelectionDataPoints?[{subSelectionDataPoints:t.subSelectionDataPoints}]:[]),l=o.enter().append("g").attr("class",x.SubSelectionSlicesClassAndSelector.class).merge(o);o.exit().remove();var d=l.selectAll("path".concat(x.SubSelectionSliceClassAndSelector.selector)).data(function(c){return c.subSelectionDataPoints}),h=d.enter().append("path").classed(x.SubSelectionSliceClassAndSelector.class,!0).merge(d);h.classed(oe.cy,s).style("pointer-events","all").style("fill-opacity",0).attrs((n={},n[oe.Ez]="slices",n[oe.QZ]=3,n)).attrs(a.subSelectionShapeLayout.attrs),h.each(function(c){oe.O5.setDataForElement(this,{getDisplayName:function(){return i.getLocalizedString("MiniToolbar_Slice",c.data.displayName)}})}),d.exit().remove()},r.prototype.drawDefaultHighlightShapes=function(e,t){var a=this.svg.select(x.SliceContainerClass.selector).selectAll("path"+x.SliceHighlightClass.selector).data(e.dataPoints.filter(function(s){return null!=s.data.highlightRatio}),x.ArcDescriptorKeyFunc),i=a.enter().insert("path").classed(x.SliceHighlightClass.class,!0).each(x.UpdateCurrentArcElementFunc).merge(a);return x.isSingleColor(e.dataPoints),i.style("fill",function(s){return s.data.color}).style("fill-opacity",function(s){return(0,O.eR)(s.data.selected,!0,!1,e.hasHighlights)}).style("stroke-opacity",function(s){return(0,O.eR)(s.data.selected,!0,!1,e.hasHighlights)}).style("stroke",B.v.getThemeColor(this.style,x.DefaultStrokeColorName)).style("stroke-width",function(s){return 0===s.data.highlightRatio?0:s.data.strokeWidth}).attrs(t.highlightShapeLayout.attrs).styles(t.highlightShapeLayout.styles),a.exit().remove(),i},r.drawStrokeForDonutChart=function(e,t,a){void 0===a&&(a=1);var o,l,i=t.outerRadius*a,s=t.innerRadius,n=(e.endAngle-e.startAngle)*i;if(s>0){var d=t.outerRadius-s,h=(e.endAngle-e.startAngle)*s;if(e.data.highlightRatio&&(n=(e.endAngle-e.startAngle)*(d+s)),e.data.isLastInDonut)return"0 "+n+" "+d+" "+h+" "+d;o=n+d+h,l=d}else e.data.isLastInDonut?(o=n,l=2*i):(o=n+i,l=i);return"0 "+o+" "+l},r.prototype.onClearSelection=function(){var e;null===(e=this.interactivityService)||void 0===e||e.clearSelection()},r.prototype.onRestoreSelection=function(e){var t,a;return null!==(a=null===(t=this.interactivityService)||void 0===t?void 0:t.restoreSelection(e.selection))&&void 0!==a&&a},r.prototype.getDonutLayout=function(e){var t=this,a=this.donutProperties,i=a.innerRadius,s=a.outerRadius,n=i||r.EffectiveZeroValue,o=d3.arc().innerRadius(i),l=d3.arc().innerRadius(i).outerRadius(s-e.explode),d=d3.arc().innerRadius(i).outerRadius(n),h=this;return{shapeLayout:{attrs:r.getStandardShapeLayoutAttrs(this.featureSwitches,l,a),styles:{"stroke-dasharray":this.featureSwitches.pieChartMarginBetweenSlices||this.style.isHighContrast?void 0:function(c){return r.drawStrokeForDonutChart(c,a)}}},highlightShapeLayout:{attrs:{d:function(g){return o.outerRadius(t.getHighlightRadius(g))(g)}},styles:{"stroke-dasharray":this.style.isHighContrast?void 0:function(c){return r.drawStrokeForDonutChart(c,a,c.data.highlightRatio)}}},subSelectionShapeLayout:{attrs:r.getStandardShapeLayoutAttrs(this.featureSwitches,l,a)},highlightShapeTween:function(g){return function(v){var y=0===g?s:h.getHighlightRadius(this._current),u=2===g?s:h.getHighlightRadius(v),S=d3.interpolateObject(this._current,v),f=d3.interpolateNumber(y,u);return this._current=S(0),function(D){return o.outerRadius(f(D))(S(D))}}},zeroShapeLayout:{attrs:{d:function(g){return d(g)}},styles:{"stroke-dasharray":this.style.isHighContrast?void 0:function(c){return r.drawStrokeForDonutChart(c,a,n)}}}}},r.getStandardShapeLayoutAttrs=function(e,t,a){return{d:function(s){return t(s)},transform:e.pieChartMarginBetweenSlices?function(i){var s=(i.startAngle+i.endAngle)/2;return"translate("+De(s,a)+", "+Pe(s,a)+")"}:function(){return"translate(0, 0)"}}},r.prototype.getHighlightRadius=function(e){var t,a,i=this.donutProperties.innerRadius,s=this.donutProperties.outerRadius,n=null!==(a=null===(t=e.data)||void 0===t?void 0:t.highlightRatio)&&void 0!==a?a:1;return Math.sqrt(n*(s*s-i*i)+i*i)},r.prototype.getArcArea=function(e,t){var a=this.donutProperties.innerRadius,i=t?this.getHighlightRadius(e):this.donutProperties.outerRadius;return(e.endAngle-e.startAngle)*(i*i-a*a)},r.cullDataByViewport=function(e,t,a,i,s,n){var o=2*Math.PI,d=0;if(e.length>72){var h=Math.min(a.width,a.height)/2;d=r.InvisibleArcLengthInPixels/(h*o)*t}for(var v,g=[],y=0,u=e;y<u.length;y++){var S=u[y];S.measure>d&&(s=s===r.DefaultBorderWidth?i||v===S.color?1:0:s,S.strokeWidth=n?.pieChartMarginBetweenSlices?s:i||v===S.color?1:0,v=S.color,g.push(S))}return g},r.getDefaultLabelSettings=function(e){return{show:!0,position:0,displayUnits:0,precision:W.NZ,fontProperties:(0,E.bT)({style:e,textClassName:"smallLightLabel",noColor:!0}).fontProperties,enableBackground:!0,backgroundColor:B.v.getThemeColor(e,W.lp),backgroundTransparency:.5}},r.OuterRadiusRatio=.8,r.LabelRadiusRatio=.9,r.DefaultDonutInnerRadiusRatio=.48,r.DefaultStartAngleDegrees=0,r.OnePiRadianInDegree=180,r.DefaultExplode=0,r.DefaultBorderWidth=0,r.MinDonutThickness=5,r.InvisibleArcLengthInPixels=1,r.InteractiveLegendContainerHeight=71,r.EffectiveZeroValue=1e-9,r}(),St=function(){function r(e,t,a,i){this.maxLegendItemWidth=15,this.legendContainerParent=t,this.donutChart=e,this.visualInitOptions=i,this.legendItemsPositions=[]}return r.prototype.drawLegend=function(e){var t=this;this.data=e,this.currentNumberOfLegendItems=e.length,this.currentIndex=0,this.leftMostIndex=0,this.rightMostIndex=e.length-1,this.legendContainerParent.select(r.LegendContainerSelector).empty()&&(this.legendContainer=this.legendContainerParent.append("div").classed(r.LegendContainerClassName,!0));var a=this.legendContainer.selectAll(r.LegendItemSelector).data(e),i=this.legendContainerWidth=this.legendContainer.node().getBoundingClientRect().width,s=i/2-.4*i/2+r.ItemMargin,n=s;this.currentXOffset=s,a.enter().insert("div").classed(r.LegendItemClassName,!0).each(function(l){!function(d,h){d.attr("data-legend-index",h.index).css({position:"absolute",left:n});var c=(0,T.WU)(h.label),g=(0,T.WU)(h.originalMeasure,h.measureFormat),v=(0,T.WU)(h.percentage,"0.00 %;-0.00 %;0.00 %"),y=h.color,u=r.createBasicLegendItemSpan(r.LegendItemValueClassName,g,11),S=r.createBasicLegendItemSpan(r.LegendItemCategoryClassName,c,11),f=r.createBasicLegendItemSpan(r.LegendItemPercentageClassName,v,20),D=r.spanWidth(u),p=r.spanWidth(S),m=r.spanWidth(f),b=r.legendBoxSize(D,p,m);d.css("width",b),t.maxLegendItemWidth=Math.max(t.maxLegendItemWidth,b);var P=function(z){return b-z>0?(b-z)/2:0},R=P(D),L=P(p),V=P(m);r.createLegendItemSpan(S,L),r.createLegendItemSpan(u,R),r.createLegendItemSpan(f,V).css("color",y),d.append(S),d.append(f),d.append(u),t.legendItemsPositions.push({startX:n,boxWidth:b}),n+=b+r.ItemMargin}($(this),l)}),a.exit().remove(),this.assignInteractions()},r.prototype.updateLegend=function(e){var a,i,t=this,s=this.legendContainerWidth;this.currentIndex=e,this.updateLabelBlocks(e);var n=-1*(this.legendItemsPositions[e].startX+this.legendItemsPositions[e].boxWidth/2-s/2);this.legendContainer.transition().styleTween("-webkit-transform",function(){return d3.interpolate((0,Y.O7)(t.currentXOffset,0),(0,Y.O7)(n,0))}).styleTween("transform",function(){return d3.interpolate((0,Y.O7)(t.currentXOffset,0),(0,Y.O7)(n,0))}).duration(We).ease((0,je.Ad)(Ee)).on("end",function(){t.currentXOffset=n});var o=this.legendContainer.selectAll(r.LegendItemSelector),d=o.filter(function(h){return h.index===t.currentIndex}).data()[0].formattedTooltip;d&&(null===(i=null===(a=this.visualInitOptions)||void 0===a?void 0:a.host)||void 0===i||i.alertScreenReader(d)),o.exit(),(0,Y.bL)(this.visualInitOptions,this.legendContainer)},r.prototype.assignInteractions=function(){var e=this,t=0,s=d3.drag().on("start",function(){t=0}).on("drag",function(){t+=d3.event.dx,Math.abs(t)<e.maxLegendItemWidth||(e.dragLegend(t<0),t=0)});this.legendContainer.style("touch-action","none").style("cursor","pointer").call(s)},r.prototype.dragLegend=function(e){this.currentNumberOfLegendItems>r.MinimumItemsInLegendForCycled-1?this.currentIndex=this.getCyclingCurrentIndex(e):this.shouldChangeIndexInNonCycling(e)&&(e?this.currentIndex++:this.currentIndex--),this.donutChart.setInteractiveChosenSlice(this.currentIndex)},r.prototype.shouldChangeIndexInNonCycling=function(e){return!(0===this.currentIndex&&!e||this.currentIndex===this.currentNumberOfLegendItems-1&&e)},r.prototype.getCyclingCurrentIndex=function(e){var t=this.data.length,i=(this.currentIndex+(e?1:-1))%(t||1);return i<0?i+t:i},r.prototype.updateLegendItemsBlocks=function(e,t){var a=$(this.legendContainer.node());if(e){var i=a.find("[data-legend-index="+this.leftMostIndex+"]");i.remove().insertAfter(a.find("[data-legend-index="+this.rightMostIndex+"]")),this.legendItemsPositions[this.leftMostIndex].startX=s=this.legendItemsPositions[this.rightMostIndex].startX+this.legendItemsPositions[this.rightMostIndex].boxWidth+r.ItemMargin,i.css("left",s),this.rightMostIndex=this.leftMostIndex,this.leftMostIndex=(this.leftMostIndex+1)%this.data.length}else{var s,n=a.find("[data-legend-index="+this.rightMostIndex+"]");n.remove().insertBefore(a.find("[data-legend-index="+this.leftMostIndex+"]")),this.legendItemsPositions[this.rightMostIndex].startX=s=this.legendItemsPositions[this.leftMostIndex].startX-this.legendItemsPositions[this.rightMostIndex].boxWidth-r.ItemMargin,n.css("left",s),this.leftMostIndex=this.rightMostIndex,this.rightMostIndex=this.rightMostIndex-1==-1?this.legendItemsPositions.length-1:this.rightMostIndex-1}t-1!=0&&this.updateLegendItemsBlocks(e,t-1)},r.prototype.updateLabelBlocks=function(e){this.currentNumberOfLegendItems>r.MinimumItemsInLegendForCycled?(this.rightMostIndex===e&&this.updateLegendItemsBlocks(!0,2),this.leftMostIndex===e&&this.updateLegendItemsBlocks(!1,2),(this.rightMostIndex===e+1||0===this.rightMostIndex&&e===this.currentNumberOfLegendItems-1)&&this.updateLegendItemsBlocks(!0,1),(this.leftMostIndex===e-1||this.leftMostIndex===this.currentNumberOfLegendItems-1&&0===e)&&this.updateLegendItemsBlocks(!1,1)):this.currentNumberOfLegendItems===r.MinimumItemsInLegendForCycled&&(this.rightMostIndex===e&&this.updateLegendItemsBlocks(!0,1),this.leftMostIndex===e&&this.updateLegendItemsBlocks(!1,1))},r.createBasicLegendItemSpan=function(e,t,a){return $("<span></span>").addClass(e).css({"white-space":"nowrap","font-size":a+"px"}).text(t)},r.createLegendItemSpan=function(e,t){return e.css({overflow:"hidden","text-overflow":"ellipsis",display:"inline-block",width:"100%","margin-left":t}),e},r.legendBoxSize=function(e,t,a){var i=e>t?e:t;return(i=i>a?i:a)>r.MaxLegendItemBoxSize?r.MaxLegendItemBoxSize:i+2},r.spanWidth=function(e){var t;return null!==(t=this.FakeElementSpan)&&void 0!==t||(this.FakeElementSpan=$("<span>").hide().appendTo(document.body)),this.FakeElementSpan.empty(),this.FakeElementSpan.append(e),this.FakeElementSpan.width()},r.LegendContainerClassName="legend-container",r.LegendContainerSelector=".legend-container",r.LegendItemClassName="legend-item",r.LegendItemSelector=".legend-item",r.LegendItemCategoryClassName="category",r.LegendItemPercentageClassName="percentage",r.LegendItemValueClassName="value",r.MaxLegendItemBoxSize=160,r.ItemMargin=30,r.MinimumItemsInLegendForCycled=3,r}(),Ze=function(){function r(e,t,a,i){void 0===i&&(i=!0);var s,n=this.reader=(0,tt.G)(e,{staticSeriesRoleNames:["Y"],colorOptions:{valueRole:"Y",visualStyle:t},formatStringProp:k.general.formatString}),o=n.data;this.dataView=e;var l=e.categorical;if(this.dataViewMetadata=e.metadata,this.tooltipsEnabled=i,this.maxValue=0,this.hasNegativeValues=!1,this.allValuesAreNegative=!1,this.style=t,(null===(s=l.categories)||void 0===s?void 0:s.length)>0){var d=l.categories[0];this.categoryValues=d.values,this.categoryFormatString=(0,T.EO)(d.source,k.general.formatString)}this.hasDynamicSeries=n.columns.hasDynamicSeries(),this.hasSeriesData=o.hasSeries(),this.hasCategoryData=o.hasCategories(),this.highlightsOverflow=!1,this.total=0,this.highlightTotal=0,this.dataPoints=[],this.dataLabelsSettings=null;var h=0,c=B.v.create(t);if(this.borderColor=c.getColorForProperty(n.objects.getStaticObjects(),k.slices.borderColor,x.DefaultStrokeColorName),this.explode=(0,re.NA)(n.objects.getStaticObjects(),k.slices.explode,te.DefaultExplode),this.borderWidth=(0,re.NA)(n.objects.getStaticObjects(),k.slices.borderWidth,te.DefaultBorderWidth),null==(h=(0,re.NA)(n.objects.getStaticObjects(),k.slices.innerRadiusRatio))?h=a?te.DefaultDonutInnerRadiusRatio:0:h/=100/te.OuterRadiusRatio,this.startAngle=(0,re.NA)(n.objects.getStaticObjects(),k.slices.startAngle,te.DefaultStartAngleDegrees),this.donutInnerRadiusRatio=h,o.hasValues("Y")){var g=this.seriesCount=o.getSeriesCount();this.hasHighlights=o.hasHighlights();var v=o.getCategoryCount()||1;this.allValuesAreNegative=void 0;for(var y=0;y<v;y++)for(var u=0;u<g;u++){var S=o.getValue("Y",y,u),f=void 0;this.hasHighlights&&null==(f=o.getHighlight("Y",y,u))&&(f=0),this.allValuesAreNegative=void 0===this.allValuesAreNegative?(!this.hasHighlights||f<=0)&&S<=0:this.allValuesAreNegative&&(!this.hasHighlights||f<=0)&&S<=0,this.hasNegativeValues||(this.hasNegativeValues=S<0||!!this.hasHighlights&&f<0)}for(this.allValuesAreNegative=!!this.allValuesAreNegative,y=0;y<v;y++)for(u=0;u<g;u++)S=o.getValue("Y",y,u),S=r.normalizedValue(S,this.allValuesAreNegative),this.total+=S,this.hasHighlights&&(f=o.getHighlight("Y",y,u),f=r.normalizedValue(f,this.allValuesAreNegative),this.highlightTotal+=f,!this.highlightsOverflow&&(0,Be.aP)(f,S,(0,Be.p8)(Math.min(f,S)))&&(this.highlightsOverflow=!0))}}return r.normalizedValue=function(e,t){return null==e||isNaN(e)?0:e===Number.POSITIVE_INFINITY?Number.MAX_VALUE:e===Number.NEGATIVE_INFINITY?-Number.MAX_VALUE:t?Math.abs(e):e<0?0:e},r.prototype.convert=function(){var t,a,i,s,n,o,e=this,l=this.reader,d=this.reader.data,h=0===e.total?[]:e.categoryValues?e.convertCategoricalWithSlicing():e.hasDynamicSeries?e.convertSeries():e.convertMeasures();this.dataLabelsSettings=this.convertDataLabelSettings(),null!==(t=this.dataViewMetadata)&&void 0!==t&&t.objects&&(this.legendObjectProperties=null===(a=this.dataViewMetadata)||void 0===a?void 0:a.objects.legend);var c=_.isEmpty(this.dataView.categorical.categories)?null:this.dataView.categorical.categories[0];this.dataPoints=[];for(var y,g=k.general.formatString,v=(0,T.Z)("Percentage"),u=null!==(i=this.dataLabelsSettings.fontProperties.color)&&void 0!==i?i:B.v.getThemeColor(this.style,W.uQ),S=null!==(s=this.dataLabelsSettings.fontProperties.color)&&void 0!==s?s:B.v.getThemeColor(this.style,W.pl),f=0,D=h.length;f<D;f++){var p=h[f],m=p.measure,b=r.normalizedValue(p.measure,this.allValuesAreNegative),P=p.highlightMeasure,R=r.normalizedValue(p.highlightMeasure,this.allValuesAreNegative),L=this.total>0?b/this.total:0,V=void 0,M=void 0;b>this.maxValue&&(this.maxValue=b),R>this.maxValue&&(this.maxValue=R),this.hasHighlights&&(this.highlightsOverflow?(m=P,b=R,L=this.highlightTotal>0?R/this.highlightTotal:0,V=1):V=0!==b?R/b:0,V||(V=te.EffectiveZeroValue),M=L*V);var z=p.categoryLabel,K=this.dataView.categorical,H=l.columns.getValueMetadataColumn("Y",null!=p.seriesIndex?p.seriesIndex:f),A=this.hasHighlights&&this.highlightsOverflow?P:m,Ae=p.measureFormat||(0,T.EO)(H,g),ye=this.hasHighlights&&!this.highlightsOverflow?P:void 0,ce=p.highlightMeasureFormat||(0,T.EO)(H,g),ue=(0,T.WU)(L,v),ve=void 0;null!=A&&null!=ue&&(ve=(0,T.WU)(A,Ae)+" ("+ue+")");var se=void 0;if(null!=ye&&null!=M){var ge=(0,T.WU)(M,v);se=(0,T.WU)(ye,ce)+" ("+ge+")"}var Z=void 0;this.tooltipsEnabled&&(Z=[],c&&Z.push({displayName:c.source.displayName,value:z}),this.hasDynamicSeries&&(!c||c.source!==K.values.source)&&Z.push({displayName:K.values.source.displayName,value:p.label}),null!=ve&&Z.push({displayName:H.displayName,value:ve}),null!=se&&Z.push({displayName:ze.I6.localizationOptions.highlightedValueDisplayName,value:se}),(0,ze.VT)(l,Z,this.categoryValues?p.categoryIndex:0,this.hasDynamicSeries?p.seriesIndex:void 0,g));var ke=this.style.isHighContrast||y===p.color&&L&&L>0?1:0;y=L&&L>0?p.color:y;var ne=(0,ae.t$)({defaultColor:u,categoricalDataReader:l,categoryIndex:p.categoryIndex,seriesIndex:p.seriesIndex}),Ie=(0,ae.t$)({defaultColor:S,categoricalDataReader:l,categoryIndex:p.categoryIndex,seriesIndex:p.seriesIndex}),Je=(0,ae.B8)(ne)?ne.color:void 0;Je&&(this.dataLabelsSettings.fontProperties=(0,ae.Vv)(Je,this.dataLabelsSettings.fontProperties));var Ve=this.hasHighlights&&!this.highlightsOverflow;this.dataPoints.push({identity:p.identity,measure:b,originalMeasure:m,measureFormat:null!==(n=p.measureFormat)&&void 0!==n?n:H.format,percentage:L,index:p.index,label:p.label,highlightRatio:V,highlightValue:Ve?R:void 0,originalHighlightValue:Ve?P:void 0,highlightFormat:Ve?null!==(o=p.highlightMeasureFormat)&&void 0!==o?o:H.format:void 0,highlightPercentage:Ve?M:void 0,selected:!1,tooltipInfo:Z,formattedTooltip:(0,et.X)(Z),color:p.color,strokeWidth:ke,seriesIndex:p.seriesIndex?p.seriesIndex:0,categoryIndex:p.categoryIndex?p.categoryIndex:0,detailLabelFill:ne.color?ne.color:void 0,insideDetailLabelFill:Ie.color?Ie.color:void 0,categoryLabel:p.categoryLabel})}this.legendData=d.hasCategoryWithRole("Category")?(0,Ce.xw)({dataView:this.dataView,categoryRole:"Category",style:this.style,valueRole:"Y",showByDefault:!1}):(0,Ce.pq)({dataView:this.dataView,staticSeriesRoleNames:["Y"],style:this.style,showByDefault:!1})},r.prototype.convertCategoricalWithSlicing=function(){for(var e,t,a=this.reader,i=this.reader.data,s=this.dataView.categorical,n=k.general.formatString,o=[],l=0,d=this.categoryValues.length;l<d;l++)for(var h=this.categoryValues[l],c=a.colors.createByCategory(l),g=(0,T.WU)(h,this.categoryFormatString),v=0;v<this.seriesCount;v++){var y=i.getValue("Y",l,v),u=i.getFormatString("Y",l,v),S=this.hasHighlights?i.getHighlight("Y",l,v):void 0,f=this.hasHighlights?i.getHighlightFormatString("Y",l,v):void 0;if(null!=y||null!=S){var D=a.columns.getValueColumn("Y",v),m=s.values.grouped()[v],b=g;(this.hasDynamicSeries||i.getSeriesCount()>1)&&(b=(0,fe.TO)(D.source,s.values,n));var P=D.source.queryName,R=Oe.dw.builder().withCategory([s.categories[0]],l,null===(t=null===(e=s.categories[0])||void 0===e?void 0:e.source)||void 0===t?void 0:t.queryName,!0).withSeries(s.values,this.hasDynamicSeries?m:void 0,!0).withMeasure(P,D,l).createSelectionId(),L=(0,T.EO)(D.source,n,!0);o.push({identity:R,measureFormat:u||L,measure:y,highlightMeasureFormat:f??L,highlightMeasure:S,index:o.length,label:b,categoryLabel:g,color:c,categoryIndex:l,seriesIndex:v})}}return o},r.prototype.convertMeasures=function(){for(var e=this.reader,t=[],a=k.general.formatString,i=0;i<this.seriesCount;i++){var s=e.data.getValue("Y",0,i),n=e.data.getFormatString("Y",0,i),o=this.hasHighlights?e.data.getHighlight("Y",0,i):void 0,l=this.hasHighlights?e.data.getHighlightFormatString("Y",0,i):void 0,d=e.columns.getValueColumn("Y",i),h=(0,T.EO)(d.source,a,!0),c=d.source.displayName,g=Oe.l0.createWithMeasure(d.source.queryName),v=e.colors.createBySeries(i);t.push({identity:g,measureFormat:n||h,measure:s,highlightMeasure:o,highlightMeasureFormat:l||h,index:i,label:c,categoryLabel:c,color:v,categoryIndex:i,seriesIndex:null})}return t},r.prototype.convertSeries=function(){for(var e=this.reader,t=this.dataView.categorical,a=[],i=k.general.formatString,s=0;s<this.seriesCount;s++){var n=e.data.getValue("Y",0,s),o=e.data.getFormatString("Y",0,s),l=this.hasHighlights?e.data.getHighlight("Y",0,s):void 0,d=this.hasHighlights?e.data.getHighlightFormatString("Y",0,s):void 0,h=e.columns.getValueColumn("Y",s),c=t.values.grouped()[s],g=(0,T.EO)(h.source,i,!0),v=(0,fe.TO)(h.source,t.values,i),y=(new Oe.dw).withSeries(t.values,c,!0).withMeasure(h.source.queryName,h,0).createSelectionId(),u=e.colors.createBySeries(s);a.push({identity:y,measureFormat:o||g,measure:n,highlightMeasure:l,highlightMeasureFormat:d??g,index:s,label:v,categoryLabel:v,color:u,categoryIndex:0,seriesIndex:s})}return a},r.prototype.convertDataLabelSettings=function(){var e=this.dataViewMetadata,t=te.getDefaultDonutLabelSettings(this.style);if(e){var a=e.objects;if(a){var i=a.labels;i&&(0,E.ww)(i,t,void 0,this.style)}t.position=(0,re.NA)(a,k.labels.position,ie.SX),t.overflow=(0,re.NA)(a,k.labels.overflow,!0),t.enableBackgroundWithAuto=(0,re.NA)(a,k.labels.background,Le.d7)}return t},r}()},34644:function(Qe,be,C){C.d(be,{Ad:function(){return me},LL:function(){return O},_9:function(){return I}});var F=C(62458);function me(Q){switch(Q){case"linear":return d3.easeLinear;case"cubic-in-out":return d3.easeCubicInOut;case"cubic-out":return d3.easeCubicOut;case"back":return d3.easeBack;default:F.fF.assertNever(Q)}return d3.easeCubicInOut}function I(Q){return!!Q.bandwidth}function O(Q,B){var fe=Q.selectAll(_.map(B,function(X){return X.selector}).join(", ")).nodes();fe.sort(function(X,ae){for(var E=0,q=0;q<B.length;q++)E+=+d3.select(X).classed(B[q].class)*q,E-=+d3.select(ae).classed(B[q].class)*q;return E}),d3.selectAll(fe).order()}}}]);