"use strict";(self.webpackChunkdesktopDialogHost=self.webpackChunkdesktopDialogHost||[]).push([["azureMap","azureMapBehaviors"],{2379:function(Ke,me,z){z.d(me,{b:function(){return ae}});var b=z(81337),r=z(92379),ae=function(){function j(){}return j.createMultiPolygonCoordinatesFromPaths=function(I,K){var H=[];if(I.filter(function(m){return m.geographic}).forEach(function(m){var w,k=[];m.geographic.forEach(function(p,s){s%2==0?w=p:k.push([p,w])}),H.push(k)}),0===H.length)return[];for(var F=[[H[0]]],O=1;O<H.length;O++){var T=F[F.length-1],A=H[O];this.isPointInsidePolygon(A[0],T[0])?T.push(A):F.push([A])}return this.combineMultiPolygonCoordinatesAtAntimeridian(K,F)},j.combineMultiPolygonCoordinatesAtAntimeridian=function(I,K){return this.shouldCheckAntimeridianCrossing(I)?this.checkAndMergePolygonsAtAntimeridian(K):K},j.shouldCheckAntimeridianCrossing=function(I){var K=new atlas.data.BoundingBox([19.8,41.2,-169.6,81.45]);return I.longitude>175||I.longitude<-175||!!atlas.data.BoundingBox.containsPosition(K,[I.longitude,I.latitude])},j.checkAndMergePolygonsAtAntimeridian=function(I){for(var K=I.map(function(M){return atlas.data.BoundingBox.fromPositions(M[0])}),H=[],F=[],O=[],T=0;T<K.length;T++){var A=atlas.data.BoundingBox.getEast(K[T]),P=atlas.data.BoundingBox.getWest(K[T]),m=_.cloneDeep(I[T]),k=K[T];180===A||-180===A?(H.push({polygon:m,boundingBox:k}),O.push(H.length-1)):180===P||-180===P?F.push({polygon:m,boundingBox:k}):H.push({polygon:m,boundingBox:k})}for(var w=0,g=O;w<g.length;w++)for(var s=H[g[w]],y=0;y<F.length;y++)if(this.matchAndMerge(s.polygon,F[y].polygon)){F.splice(y,1);break}return H.map(function(M){return M.polygon})},j.matchAndMerge=function(I,K){for(var H=this,F=(0,b.__spreadArray)([],I[0],!0),O=(0,b.__spreadArray)([],K[0],!0),A=0;Math.abs(F[0][0]-180)<this.floatPrecision&&A<3;)F.push(F.shift()),A+=1;for(A=0;Math.abs(O[0][0]+180)<this.floatPrecision&&A<3;)O.push(O.shift()),A+=1;var P=_.findIndex(F,function(Y){return Math.abs(Y[0]-180)<H.floatPrecision}),m=_.findLastIndex(F,function(Y){return Math.abs(Y[0]-180)<H.floatPrecision}),k=_.findIndex(O,function(Y){return Math.abs(Y[0]+180)<H.floatPrecision}),w=_.findLastIndex(O,function(Y){return Math.abs(Y[0]+180)<H.floatPrecision});if(-1===P||m===P||-1===k||w===k)return!1;var g=F[P][1],p=F[m][1],s=O[k][1],y=O[w][1],C=Math.max(p,s)-Math.min(g,y),M=Math.min(p,s)-Math.max(g,y);if(C>0&&M/C>.9){var x=F.slice(0,P+1),V=F.slice(m);O.forEach(function(Y){return Y[0]+=360});var W=O.slice(0,k+1),G=O.slice(w);return I[0]=x.concat(G,W,V),I.push.apply(I,K.slice(1)),!0}return!1},j.isPointInsidePolygon=function(I,K){for(var H=0,F=0,O=K.length-1;F<K.length;O=F++)this.isRayCrossEdgeUpward(I,K[F],K[O])&&H++;return H%2==1},j.isRayCrossEdgeUpward=function(I,K,H){var F=I[0],O=I[1],T=K[0],A=K[1],P=H[0],m=H[1];return Math.abs(P-T)>180&&(F>0?(T<0&&(T+=360),P<0&&(P+=360)):(T>0&&(T-=360),P>0&&(P-=360))),T>F!=P>F&&O<(m-A)*(F-T)/(P-T)+A},j.shapesWithinPolygon=function(I,K){var H=[];if(I&&K){var T,F={},O=[],A=I instanceof atlas.source.DataSource?I.getShapes():I;_.forEach(A,function(m){T=m.getId(),F[T]=m,O.push({id:T,coordinates:m.getProperties().coordinates})}),H=j.pointsWithinPolygon(O,K).map(function(m){return F[m.id]})}return H},j.pointsWithinPolygon=function(I,K){if(I&&K){var H=j.getPolygon(K),F=j.getPowerBIShapePolygon(H);return I.filter(function(T){return F.inside(j.getPowerBIShapePoint(T.coordinates))})}return[]},j.getPowerBIShapePoint=function(I){return{x:I[0],y:I[1]}},j.getPowerBIShapePolygon=function(I){var H=[].concat.apply([],I.coordinates).map(function(F){return{x:atlas.math.normalizeLongitude(F[0]),y:atlas.math.normalizeLatitude(F[1])}});return r.m.fromPolygonPoints(H)},j.getPolygon=function(I){var K;if(I instanceof atlas.Shape)I.isCircle()?K=new atlas.data.Polygon([I.getCircleCoordinates()]):I.getType().indexOf("Polygon")>-1&&(K=I.toJson().geometry);else{var H=I;"Feature"===H.type&&("Point"===H.geometry.type&&"Circle"===H.properties.subType&&"number"==typeof H.properties.radius?K=new atlas.data.Polygon(atlas.math.getRegularPolygonPath(H.geometry.coordinates,H.properties.radius,72,"meters")):H.geometry.type.indexOf("Polygon")>-1&&(K=H.geometry)),-1!==H.type.indexOf("Polygon")&&(K=I)}return K},j.floatPrecision=1e-4,j}()},49988:function(Ke,me,z){z.d(me,{t:function(){return A}});var b=z(81337),r=z(65363),ae=function(m,k,w,g,p,s,y,C,M){var x=m,V=Math.PI,W="";C&&(W=' mask="url(#'.concat(C,'"'));var G=void 0!==m.selectionPieIndexes&&void 0===m.selectionPieIndexes.filter(function(h){return h===M})[0]?m.deselectedPieOpacity:1,Y=m.gaussianBlurStandardDeviation?'filter="url(#f1)"':"";if(s>2*V*.99)return'<circle r="'.concat(g,'" cx="').concat(k,'" cy="').concat(w,'" ').concat(Y,' style="opacity:').concat(G,";stroke-opacity:").concat(x.strokeOpacity,";fill:").concat(y,";stroke:").concat(x.strokeColor,";stroke-width:").concat(x.strokeWidth,'px;"').concat(W,"></circle>");var Q=Math.sin,re=Math.cos,q=k+g*Q(p),ue=w-g*re(p),v=k+g*Q(p+s),he=w-g*re(p+s),ke=0;return s>V&&(ke=1),'<path d="M'.concat(k," ").concat(w," L ").concat(q," ").concat(ue," A ").concat(g,",").concat(g," 0 ").concat(ke," 1 ").concat(v," ").concat(he,'z" ').concat(Y,' style="opacity:').concat(G,";stroke-opacity:").concat(x.strokeOpacity,";fill:").concat(y,";stroke:").concat(x.strokeColor,";stroke-width:").concat(x.strokeWidth,'px;"').concat(W,"></path>")},I=function(m,k,w){return function(m){var M,k=m.values,w=m.radius,g=0,p=0,s=w+m.strokeWidth,y=['<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(2*s,'px" height="').concat(2*s,'px" opacity="').concat(void 0!==m.opacity||null!==m.opacity?m.opacity:1,'">')],C='<filter id="f1" x="0" y="0"><feGaussianBlur in="SourceGraphic" stdDeviation="'.concat(m.gaussianBlurStandardDeviation,'" /></filter>');y.push("\n        <defs>".concat(m.gaussianBlurStandardDeviation?C:"","</defs>\n    ")),m.innerRadius>0&&m.innerRadius<=m.radius&&(M="piechart-innercircle-"+Math.round(1e7*Math.random()),y.push('<defs><mask id="'.concat(M,'"><rect width="100%" height="100%" fill="white"/><circle r="').concat(m.innerRadius,'" cx="').concat(s,'" cy="').concat(s,'" fill="black"/></mask></defs>\n            <circle r="').concat(m.innerRadius,'" cx="').concat(s,'" cy="').concat(s,'" style="fill:').concat(m.fillColor,";stroke:").concat(m.strokeColor,";stroke-width:").concat(2*m.strokeWidth,'px;"/>')));var x=k.reduce(function(q,ue){return q+ue.count},0);if(x>0)for(var V=2*Math.PI/x,W=0;W<k.length;W++)y.push(ae(m,s,s,w,g,p=V*k[W].count,k[W].fill,M,W)),g+=p;var Y=m.text;return Y&&y.push('<text x="'.concat(s,'" y="').concat(s+7,'" style="font-size:').concat(16,'px;font-family:arial;fill:#000;font-weight:bold;" class="').concat(m.textClassName||"",'" text-anchor="middle">').concat(Y,"</text>")),y.push("</svg>"),y.join("")}(K(m,k,w))},K=function(m,k,w){return{values:m.subDataPoints.map(function(g){return{count:Math.max(g.size,0),fill:g.color}}),radius:m.bubbleRadius,pixelOffset:[0,0],innerRadius:0,colors:[],fillColor:"transparent",gaussianBlurStandardDeviation:k.blur,strokeWidth:k.strokeWidth,strokeColor:k.strokeColor,strokeOpacity:1-k.strokeTransparency/100,textClassName:void 0,opacity:1-k.transparency/100,selectionPieIndexes:w||m.subDataPoints.map(function(g,p){return p}),deselectedPieOpacity:.1}},F=function P(m,k){return k?P(k,m%k):m},A=function(){function P(m){this.cache={},this.imageSprite=m}return P.prototype.clearAll=function(){this.imageSprite.clear(),this.cache={}},P.hash=function(m,k,w){return function(m){var k=m.values.map(function(s){return s.count}),w=function(m,k){for(var w=m[0],g=1;g<k;g++)if(1===(w=F(m[g],w)))return 1;return w}(k,k.length);return function(m){var w,p,k=0;if(0===m.length)return k;var s=m.toLowerCase();for(w=0,p=s.length;w<p;w++)k=(k<<5)-k+s.charCodeAt(w),k|=0;return k}(Object.keys(m).filter(function(s){return"values"!==s&&(void 0!==m[s]||null!==m[s])}).map(function(s){return{key:s,value:m[s]}}).concat([{key:"values",value:m.values.map(function(s){return["fill=".concat(s.fill),"count=".concat(s.count/w)].join(",")}).join(";")}]).map(function(s){var y=s.key,C=s.value,M=C instanceof Array?C.join(","):"".concat(C);return"".concat(y,"=").concat(M)}).join(";"))}(K(m,k,w))},P.prototype.svgContent=function(m,k,w,g){void 0===w&&(w=!1);var p=w?(0,b.__assign)((0,b.__assign)({},k),{transparency:100}):k,s=P.hash(m,p,g),y=this.cache[s];if(void 0!==y)return y.svgContent;var C=I(m,p,g);return this.cache[s]={svgContent:C},C},P.prototype.objectUrl=function(m,k,w){var g=P.hash(m,k,w),p=this.cache[g];if(void 0!==p&&p.objectUrl)return p.objectUrl;if(void 0!==p){var s=new Blob([p.svgContent],{type:"image/svg+xml;charset=utf-8"}),y=URL.createObjectURL(s);return p.objectUrl=y,this.cache[g].objectUrl=y,y}var C=I(m,k,w),M=(s=new Blob([C],{type:"image/svg+xml;charset=utf-8"}),URL.createObjectURL(s));return this.cache[g]={objectUrl:M,svgContent:C},M},P.prototype.loadIcon=function(m,k,w,g){var p=g??P.hash(m,k,w);if(this.cache[p]&&this.cache[p].objectUrl||this.imageSprite.hasImage(p.toString()))return(0,r.DR)(void 0);var s=this.objectUrl(m,k,w);return this.imageSprite.add(p.toString(),s)},P}()},93816:function(Ke,me,z){z.r(me),z.d(me,{AzureMap:function(){return wt},createAzureMap:function(){return Jt},createAzureMapBehavior:function(){return Kt}});var b=z(81337),r=z(60637),ae=z(5962),j=z(28579),I=z(52287),K=z(86900),H=z(65741),F=z(86727),O=z(77686),T=z(72902),A=z(45296),P=z(64067),m=z(38308),k=z(79154),w=z(62458),g=z(15621),p=z(12913),s=z(56578),y=z(46135),C=z(35824),M=z(90120),x=z(54522),V=z(21181),W=z(18664),G=z(79811),Y=z(56919),Q=z(44783),re=z(38078),q=z(90700),ue=z(38958),v=z(82755),he=z(26543),ke=function(){function u(){}return u.getRadius=function(e,t){var n=t.minDataValue,o=t.maxDataValue;if(!t.hasSize||n===o)return t.properties.bubble.radius;var l=t.properties.bubble,i=l.markerRangeType;i===q.Dl.auto&&(i=n>=0||o<=0?q.Dl.magnitude:q.Dl.dataRange),i===q.Dl.magnitude&&(e=Math.abs(e),o=Math.max(Math.abs(n),Math.abs(o)),n=0);var c=l.minRadius,d=l.maxRadius,f=_.clamp(e,n,o);return Math.sqrt((f-n)/(o-n))*(d-c)+c},u.updateRadiusForDataPoints=function(e){e.dataPoints.forEach(function(t){var a=t.subDataPoints.reduce(function(o,l){return o+l.size},0),n=u.getRadius(a,e);t.bubbleRadius=n})},u}(),h=z(70508),Re=z(56707),Be=z(2241),Ve=z(41234),Fe=z(47316),Ne=function(){return function(){this.allowExtrusions=!0,this.visible=!0,this.bubble={strokeShow:!0,strokePattern:Fe.Dv.solid,strokeColor:"white",strokeWidth:2,strokeTransparency:0,fillColor:"#1A73AA",fillOpacity:1},this.line={strokeShow:!0,strokePattern:Fe.Dv.solid,strokeColor:"#1e90ff",strokeWidth:3,strokeTransparency:0,strokeDashCap:Fe.qH.round,strokeLineJoin:Ve.t.round},this.polygon={strokeShow:!0,strokePattern:Fe.Dv.solid,strokeColor:"#1e90ff",strokeWidth:3,strokeTransparency:0,fillColor:"#1e90ff",fillOpacity:.5,strokeDashCap:Fe.qH.round,strokeLineJoin:Ve.t.round},this.unselectedTransparency=80}}(),be=re.b$.parseNumber,ut=function(){function u(){}return u.getHeatMapGradientColorScale=function(e){var t=M.v.getDataColorByIndex(e,0);return(0,P.X6)(t)},u.converter=function(e){var t=e.dataView,a=e.geoTaggingAnalyzerService,n=e.interactivityService,o=e.style,l=e.featureSwitches,i=t.matrix,c=t.metadata.objects,d=M.v.create(o,r.MC.dataPoint.fill,(0,v.W7)(c,r.MC.dataPoint.defaultColor),(0,v.W7)(c,r.MC.dataPoint.fill));if(!i||!i.rows||!i.rows.levels||0===i.rows.levels.length)return u.getDefaultMapData(o,l);var f=[].concat.apply([],i.rows.levels.map(function(ye){return ye.sources&&ye.sources.map(function(de){return de})})||[]),S=[].concat.apply([],i.columns.levels.map(function(ye){return ye.sources&&ye.sources.map(function(de){return de})})||[]),D=u.determineDataFlags(f,S,i.valueSources),B=u.getMapControlProperties(c);B.geocodingCulture&&!(0,Y._h)(B.geocodingCulture)&&(B.geocodingCulture=void 0,D.hasInvalidGeocodingCulture=!0);var E,U,R=null,N=[];if(D.hasCategory){var ee=!_.isEmpty(i.rows.levels)&&_.last(i.rows.levels).sources;if(!D.hasSeries||D.hasSize||D.hasX||D.hasY||D.hasTooltip||D.hasPointOrder){var X=u.convertMatrixWithCategory(D,i,N,d,a,n,l,B.geocodingCulture);E=X.dataPoints,U=X.paths}else E=(oe=u.convertMatrixWithOnlyCategoryAndSeries(D,i,N,d,a,l,B.geocodingCulture)).dataPoints,U=oe.paths;R=u.getGeocodingCategory(_.last(ee),a)}else{var oe;E=(oe=u.convertMatrixWithoutCategory(D,i,N,d,n,l)).dataPoints,U=oe.paths}var Z=u.getCommonDataLayerProperties(c,D.hasSize,E,l),te={mapControls:B,traffic:u.getTrafficProperties(c),tile:u.getTileLayerProperties(c),filledMap:u.getFilledMapProperties(c,o),bubble:u.getBubbleLayerProperties(c,o),heatMap:u.getHeatMapLayerProperties(c,o),barChart:u.getBarChartProperties(c,o),commonDataOptions:Z,referenceLayer:u.getReferenceLayerProperties(c)};D.hasDuplicatedLatLong&&(te.bubble.autoStrokeColor=!1,te.bubble.blur=0,te.bubble.zoomScaleFactor=1,te.bubble.pitchAlignment="viewport"),te.heatMap.heatMapRadius="meters"===te.heatMap.heatMapRadiusUnit?Math.min(te.heatMap.heatMapRadius,h.NI):Math.min(te.heatMap.heatMapRadius,h.OH);var ne=this.composeLegendData(D,e,d,o,l),fe={dataPoints:E,properties:te,shouldRenderFilledMap:te.filledMap.showFilledMap&&!D.hasSize,geocodingCategory:R,hasCategory:D.hasCategory,hasSeries:D.hasSeries,hasXY:D.hasXY,hasSize:D.hasSize,hasInvalidLatLong:D.hasInvalidLatLong,hasInvalidGeocodingCulture:D.hasInvalidGeocodingCulture,hasDuplicatedLatLong:D.hasDuplicatedLatLong,hasPathID:D.hasPathID,colorHelper:d,minDataValue:D.hasSize?Z.minDataValue:void 0,maxDataValue:D.hasSize?Z.maxDataValue:void 0,legendData:ne,dataLabelSettings:this.calculateDataLabelSettings(t,o),series:N,paths:U};return!(te.bubble.markerRangeType===q.Dl.deprecated)&&te.bubble.showBubbleLayer&&ke.updateRadiusForDataPoints(fe),fe},u.composeLegendData=function(e,t,a,n,o){var l={dataView:t.dataView,colorHelper:a,style:n,formatStringProp:r.MC.general.formatString,showByDefault:!0};return e.hasSeries&&e.hasCategory&&(e.hasSize||e.hasXY||e.hasTooltip)?(0,G.Lk)(l):e.hasSeries&&o.azureMapsPathLayer&&e.hasPathID?(0,G.z9)(l):e.hasSeries?(0,G.PP)(l):(0,G.Fe)(n)},u.determineDataFlags=function(e,t,a){var n=u.HaveRole(e,r.Wx.category),o=u.HaveRole(t,r.Wx.series)||u.HaveRole(e,r.Wx.series),l=u.HaveRole(a,r.Wx.x)||u.HaveRole(e,r.Wx.x),i=u.HaveRole(a,r.Wx.y)||u.HaveRole(e,r.Wx.y);return{hasCategory:n,hasSeries:o,hasX:l,hasY:i,hasXY:l&&i,hasSize:u.HaveRole(a,r.Wx.size),hasTooltip:u.HaveRole(a,r.Wx.tooltips),hasInvalidLatLong:!1,hasInvalidGeocodingCulture:!1,hasDuplicatedLatLong:!1,hasPathID:u.HaveRole(e,r.Wx.pathID),hasPointOrder:u.HaveRole(a,r.Wx.pointOrder)}},u.convertMatrixWithOnlyCategoryAndSeries=function(e,t,a,n,o,l,i){w.fF.assertNonEmpty(t.rows.levels,"Matrix should have rows");var c=l.azureMapsPathLayer&&e.hasPathID,d=c?t.rows.root.children||[]:[{children:t.rows.root.children||[]}],f=c?1:0,S=!_.isEmpty(t.rows.levels)&&t.rows.levels[f].sources[0],L=0,D={},B=[],R=new Map,E=this.getRowBasedSeriesIdentityFields(t,e,l),U=0;return d.forEach(function(N){var ee=N.children,X=l.azureMapsPathLayer&&e.hasPathID&&String(N.levelValues[0].value)||"";ee.forEach(function(Z){var te,ne=n.getColorForSeriesValue(Z.objects,E,Z.value,Q.fA),fe=(0,x.xq)(Z.value,S,r.MC.general.formatString),De={displayName:S.displayName,value:fe},ve=u.getSeriesValueDetails(l,Z,S),ye=(new he.dw).withColumnIdentity(Z.identity,S.queryName,ve);if(a.push({value:fe,color:ne,identity:ye.createSelectionId(),selected:!1}),Z.children){var de=null===(te=t.rows.levels)||void 0===te?void 0:te[f+1].sources,pe=_.last(de);Z.children.forEach(function(Ee){var Ce=u.getCategoryValueDetails(l,Ee,de),Me=(new he.dw).withColumnIdentity(Ee.identity,pe.queryName,Ce);if(X.length>0){var we=t.rows.levels[0].sources[0],je=u.getPathIDValueDetails(l,N,we);Me.withColumnIdentity(N.identity,we.queryName,je)}var Ue=Me.createSelectionId().getKey();Me.withColumnIdentity(Z.identity,S.queryName,ve);var Te=D[Ue];null==Te&&(Te=L++,D[Ue]=Te);for(var Je={components:[],culture:i},Ie=[],Ze=[],Se=Ee.levelValues.map(function(ot){return ot.value}),Oe=0;Oe<Se.length;++Oe){var qe=de[Oe],yt=Se[Oe],gt=u.getGeocodingCategory(qe,o),$e=(0,x.xq)(yt,qe,r.MC.general.formatString);Ze.unshift($e),Je.components.push({query:$e,category:gt}),Ie.push({displayName:qe.displayName,value:$e})}var mt=Ze.join(", "),Ge=B[Te];Ge||(Ge={categoryValue:mt,queryLocation:Je,subDataPoints:[]},X.length>0&&(Ge.pathID=X),B[Te]=Ge,X.length>0&&(R.has(X)?R.get(X).push(Te):R.set(X,[Te])));var vt=(0,b.__spreadArray)((0,b.__spreadArray)([],Ie,!0),[De],!1);Ge.subDataPoints.push({size:1,color:ne,identity:Me.createSelectionId(),selected:!1,tooltipInfo:vt,seriesIndex:U})})}else{var Ae=Z,ge=S,ie=(0,x.xq)(Ae.levelValues[0].value,ge,r.MC.general.formatString),Pe={components:[{query:ie,category:u.getGeocodingCategory(ge,o)}],culture:i},_e=u.getCategoryValueDetails(l,Ae,[ge],!0),xe=(new he.dw).withColumnIdentity(Ae.identity,ge.queryName,_e);B.push({categoryValue:ie,queryLocation:Pe,subDataPoints:[{size:1,color:ne,identity:xe.createSelectionId(),selected:!1,tooltipInfo:[De],seriesIndex:U}]}),X.length>0&&(B[B.length-1].pathID=X,R.has(X)?R.get(X).push(B.length-1):R.set(X,[B.length-1]))}U++})}),{dataPoints:B,paths:R}},u.convertMatrixWithCategory=function(e,t,a,n,o,l,i,c){var d=i.azureMapsPathLayer&&e.hasPathID,f=d?t.rows.root.children||[]:[{children:t.rows.root.children||[]}],S=t.columns.root.children||[],L=d?1:0,D=!_.isEmpty(t.rows.levels)&&t.rows.levels[L].sources,B=D?D[D.length-1]:void 0,R=!_.isEmpty(t.columns.levels)&&t.columns.levels[0].sources[0],E=t.valueSources,U=u.GetValueIndexForRole(E,r.Wx.size),N=u.GetValueIndexForRole(E,r.Wx.pointOrder),ee=[],oe=[],X=new Map;if(e.hasSeries)for(var Z=0,te=S;Z<te.length;Z++){var ne=te[Z],fe=n.getColorForSeriesValue(ne.objects,t.columns.root.childIdentityFields,ne.value,Q.fA),De=(0,x.xq)(ne.value,R,r.MC.general.formatString),ve=u.getSeriesValueDetails(i,ne,R),ye=(new he.dw).withColumnIdentity(ne.identity,R.queryName,ve);a.push({value:De,color:fe,identity:ye.createSelectionId(),selected:!1,valueDetails:ve})}return f.forEach(function(de){var pe=de.children,ge=i.azureMapsPathLayer&&e.hasPathID&&String(de.levelValues[0].value)||"";pe.forEach(function(J){for(var ie,le,Pe=[],_e={components:[],culture:c},xe=[],Ee=J.levelValues.map(function(Pt){return Pt.value}),Ce=0;Ce<Ee.length;++Ce){var Me=D[Ce],we=Ee[Ce],je=u.getGeocodingCategory(Me,o),Ue=(0,x.xq)(we,Me,r.MC.general.formatString);Pe.unshift(Ue),_e.components.push({query:Ue,category:je}),xe.push({displayName:Me.displayName,value:Ue})}var Te=Pe.join(", "),Je=u.getCategoryValueDetails(i,J,D),Ie=[];if(e.hasSeries)for(var Ze=function(Ye){var st=E.length,xt=-1!==U?be(J.values[Ye*st+U].value):0;if(e.hasPointOrder&&(le=u.getPointOrderValueFromNode(J.values[Ye*st+N],le)),e.hasSize&&null==xt)return"continue";var lt=E.map(function(Tt,ea){return J.values[Ye*st+ea].value});if(lt.every(function(Tt){return null==Tt}))return"continue";if(e.hasXY&&!ie){var Xt=u.GetValueIndexForRole(E,r.Wx.x),Qt=u.GetValueIndexForRole(E,r.Wx.y),kt=be(lt[Xt]),Bt=be(lt[Qt]);null!=kt&&null!=Bt&&(ie={longitude:be(kt),latitude:be(Bt)})}var jt=S[Ye],qt=(new he.dw).withColumnIdentity(jt.identity,R.queryName,a[Ye].valueDetails).withColumnIdentity(J.identity,B.queryName,Je),bt=(0,b.__spreadArray)([],xe,!0);bt.push({displayName:R.displayName,value:a[Ye].value});for(var et=0;et<st;et++){var zt=lt[et];null!==zt&&bt.push({displayName:E[et].displayName,value:(0,x.xq)(zt,E[et],r.MC.general.formatString)})}Ie.push({size:e.hasSize?Math.min(xt,h.Y4):1,color:a[Ye].color,identity:qt.createSelectionId(),selected:!1,tooltipInfo:bt,seriesIndex:Ye})},Se=0;Se<S.length;Se++)Ze(Se);else{if(e.hasXY){var Oe=u.GetValueIndexForRole(E,r.Wx.x),qe=u.GetValueIndexForRole(E,r.Wx.y);ie={longitude:be(J.values[Oe].value),latitude:be(J.values[qe].value)}}var gt=n.getColorForMeasure(J.objects,-1!==U&&E[U].queryName,Q.fA),$e=(new he.dw).withColumnIdentity(J.identity,B.queryName,Je),mt=-1!==U?be(J.values[U].value):0,Ge=(0,b.__spreadArray)([],xe,!0);if(e.hasPointOrder&&(le=u.getPointOrderValueFromNode(J.values[N],le)),!_.isEmpty(S))for(Se=0;Se<S.length;Se++){var ot=J.values[Se].value;null!==ot&&Ge.push({displayName:E[Se].displayName,value:(0,x.xq)(ot,E[Se],r.MC.general.formatString)})}Ie.push({size:Math.min(mt,h.Y4),color:gt,identity:$e.createSelectionId(),selected:!1,tooltipInfo:Ge})}if(ie&&u.AreLatLongInvalid(ie))e.hasInvalidLatLong=!0;else if(Ie.length>0){var nt={queryLocation:_e,location:ie,subDataPoints:Ie,categoryValue:Te,pointOrder:le};ge.length>0&&(nt.pathID=ge),w.fF.assertNonEmpty(nt.subDataPoints,"subDataPoints should be defined and its length > 0"),ee.push(nt),ge.length>0&&(X.has(ge)?X.get(ge).push(ee.length-1):X.set(ge,[ee.length-1])),l&&oe.push.apply(oe,nt.subDataPoints)}})}),l&&oe.length>0&&l.applySelectionStateToData(oe),{dataPoints:ee,paths:X}},u.convertMatrixWithoutCategory=function(e,t,a,n,o,l){if(!e.hasXY)return{dataPoints:[]};var i=l.azureMapsPathLayer&&e.hasPathID,c=i?t.rows.root.children||[]:[{children:t.rows.root.children||[]}],d=t.valueSources,f=u.GetValueIndexForRole(d,r.Wx.size),S=[],L=[],D=u.GetSource(t.rows.levels[0].sources,r.Wx.pathID),B=new Map,R=u.GetValueIndexForRole(d,r.Wx.pointOrder);if(e.hasSeries){var E=i?1:0,N=t.rows.levels[E+1],ee=u.GetSource(t.rows.levels[E].sources,r.Wx.series),oe=u.GetSource(N.sources,r.Wx.x),X=u.GetSource(N.sources,r.Wx.y),te=u.getRowBasedSeriesIdentityFields(t,e,l),ne=0;c.forEach(function(de){var pe={},Ae=de.children,J=l.azureMapsPathLayer&&e.hasPathID&&String(de.levelValues[0].value)||"";Ae.forEach(function(ie){var xe,le=(0,x.xq)(ie.levelValues[0].value,ee,r.MC.general.formatString),Pe=n.getColorForSeriesValue(ie.objects,te,le,Q.fA),_e=u.getSeriesValueDetails(l,ie,ee),Ee=(new he.dw).withColumnIdentity(ie.identity,ee.queryName,_e);a.push({value:le,color:Pe,identity:Ee.createSelectionId(),selected:!1}),ie.children.forEach(function(Ce){var we=u.getDataPointValueFromXyNode(Ce,f,oe,X,d,{displayName:ee.displayName,value:le});if(e.hasPointOrder&&(xe=u.getPointOrderValueFromNode(Ce.values[R],xe)),u.AreLatLongInvalid(we.location))e.hasInvalidLatLong=!0;else{var je=u.getXYValueDetails(l,Ce,oe,we),Ue=u.getXYValueDetails(l,Ce,X,we),Te=(new he.dw).withColumnIdentity(ie.identity,ee.queryName,_e).withColumnIdentity(Ce.identity,oe.queryName,je).withColumnIdentity(Ce.identity,X.queryName,Ue);if(J.length>0){var Je=u.getPathIDValueDetails(l,de,D);Te.withColumnIdentity(de.identity,D.queryName,Je)}var Ie=(0,b.__assign)((0,b.__assign)({},we.subDataPoint),{size:Math.min(we.subDataPoint.size,h.Y4),color:Pe,identity:Te.createSelectionId(),selected:!1,seriesIndex:ne}),Ze="".concat(we.location.latitude,",").concat(we.location.longitude),Se=l.azureMapsLatLongPieCharts;if(Se&&Ze in pe)pe[Ze].subDataPoints.push(Ie),e.hasDuplicatedLatLong=!0;else{var Oe={location:we.location,categoryValue:we.categoryValue,subDataPoints:[Ie],pointOrder:xe};w.fF.assertNonEmpty(Oe.subDataPoints,"subDataPoints should be defined and its length > 0"),J.length>0&&(Oe.pathID=J),S.push(Oe),J.length>0&&(B.has(J)?B.get(J).push(S.length-1):B.set(J,[S.length-1])),Se&&(pe[Ze]=Oe)}o&&L.push(Ie)}}),ne++})})}else{var fe=-1!==f&&d[f].queryName,ve=u.GetSource((N=t.rows.levels[i?1:0]).sources,r.Wx.x),ye=u.GetSource(N.sources,r.Wx.y);c.forEach(function(pe){var Ae=pe.children,J=l.azureMapsPathLayer&&e.hasPathID&&String(pe.levelValues[0].value)||"";Ae.forEach(function(ie){var le=u.getDataPointValueFromXyNode(ie,f,ve,ye,d),Pe=e.hasPointOrder?u.getPointOrderValueFromNode(ie.values[R]):null;if(u.AreLatLongInvalid(le.location))e.hasInvalidLatLong=!0;else{var _e=n.getColorForMeasure(ie.objects,fe,Q.fA),xe=u.getXYValueDetails(l,ie,ve,le),Ee=u.getXYValueDetails(l,ie,ye,le),Ce=(new he.dw).withColumnIdentity(ie.identity,ve.queryName,xe).withColumnIdentity(ie.identity,ye.queryName,Ee);J.length>0&&Ce.withColumnIdentity(pe.identity,D.queryName,u.getPathIDValueDetails(l,pe,D));var Me={location:le.location,categoryValue:le.categoryValue,subDataPoints:[(0,b.__assign)((0,b.__assign)({},le.subDataPoint),{size:Math.min(le.subDataPoint.size,h.Y4),color:_e,identity:Ce.createSelectionId(),selected:!1})],pointOrder:Pe};w.fF.assertNonEmpty(Me.subDataPoints,"subDataPoints should be defined and its length > 0"),J.length>0&&(Me.pathID=J),S.push(Me),J.length>0&&(B.has(J)?B.get(J).push(S.length-1):B.set(J,[S.length-1])),o&&L.push.apply(L,Me.subDataPoints)}})})}return o&&L.length>0&&o.applySelectionStateToData(L),{dataPoints:S,paths:B}},u.getRowBasedSeriesIdentityFields=function(e,t,a){if(!a.azureMapsPathLayer||!t.hasPathID)return e.rows.root.childIdentityFields;var n=new Map;return e.rows.root.children.flatMap(function(o){return o.childIdentityFields}).forEach(function(o){var l=JSON.stringify(o);n.has(l)||n.set(l,o)}),Array.from(n.values())},u.getDataPointValueFromXyNode=function(e,t,a,n,o,l){var d=be(e.levelValues[0].value),f=(0,x.xq)(d,a,r.MC.general.formatString),S=be(e.levelValues[1].value),L=(0,x.xq)(S,n,r.MC.general.formatString),D=-1!==t?be(e.values[t].value):1,B=[];void 0!==l&&B.push(l),B.push({displayName:n.displayName,value:L}),B.push({displayName:a.displayName,value:f});for(var R=0;R<o.length;R++){var U=e.values[R].value;null!==U&&B.push({displayName:o[R].displayName,value:(0,x.xq)(U,o[R],r.MC.general.formatString)})}return{location:{latitude:S,longitude:d},subDataPoint:{tooltipInfo:B,size:D},categoryValue:L+", "+f,formattedLatitude:L,formattedLongitude:f}},u.getSeriesValueDetails=function(e,t,a){var n;if(e.interactivityServiceCaching){n=[];for(var o=0,l=t.levelValues;o<l.length;o++){var i=l[o];n.push({expr:a.expr,formattedValue:(0,x.xq)(i.value,a,r.MC.general.formatString),value:i.value,identity:t.identity})}}return n},u.getCategoryValueDetails=function(e,t,a,n){var o;if(e.interactivityServiceCaching){o=[];for(var l=t.levelValues,i=0;i<l.length;i++){var c=n?a[0]:a[i];o.push({expr:c.expr,formattedValue:(0,x.xq)(l[i].value,c,r.MC.general.formatString),value:l[i].value,identity:t.identity})}}return o},u.getXYValueDetails=function(e,t,a,n){var o;return e.interactivityServiceCaching&&(o=[{expr:a.expr,formattedValue:n.formattedLongitude,value:n.location.longitude,identity:t.identity}]),o},u.getPathIDValueDetails=function(e,t,a){var n;if(e.interactivityServiceCaching)for(var o=0,l=t.levelValues;o<l.length;o++){var i=l[o];n.push({expr:a.expr,formattedValue:(0,x.xq)(i.value,a,r.MC.general.formatString),value:i.value,identity:t.identity})}return n},u.getGeocodingCategory=function(e,t){var a;if(a=t.getFieldTypeFromDescriptor(e.type))return a;if(a=t.getFieldType(e.displayName))return a;var l=e.roles;if(l)for(var i=Object.keys(l),c=0,d=i.length;c<d;++c){var f=t.getFieldType(i[c]);if(f)return f}},u.calculateDataLabelSettings=function(e,t){var a=this.getDefaultMapLabelSettings(t),n=e.metadata.objects;if(n){a.showCategory=(0,v.NA)(n,r.MC.categoryLabels.show,a.showCategory);var o=n.categoryLabels;o&&(0,V.ww)(o,a,void 0,t);var l=M.v.create(t);a.enableBackground=(0,v.NA)(n,r.MC.categoryLabels.enableBackground,!0),a.backgroundColor=l.getColorForProperty(n,r.MC.categoryLabels.backgroundColor,h.Dy),a.backgroundTransparency=(0,v.NA)(n,r.MC.categoryLabels.backgroundTransparency,100*h._O)/100}return a},u.getDefaultMapLabelSettings=function(e){var t=M.v.getThemeColor(e,Re.pl),a=(0,V.bT)({style:e,labelColor:t,textClassName:"smallLightLabel"}).fontProperties;return{show:!1,showCategory:!1,position:0,fontProperties:a=(0,W.ED)(a,{color:t}),enableBackground:!0,backgroundColor:M.v.getThemeColor(e,h.Dy),backgroundTransparency:h._O,bold:!1,italic:!1,underline:!1}},u.getDefaultMapData=function(e,t){return{dataPoints:[],dataLabelSettings:this.getDefaultMapLabelSettings(e),properties:{mapControls:u.getMapControlProperties(null),traffic:u.getTrafficProperties(null),tile:u.getTileLayerProperties(null),filledMap:u.getFilledMapProperties(null,e),bubble:u.getBubbleLayerProperties(null,e),heatMap:u.getHeatMapLayerProperties(null,e),barChart:u.getBarChartProperties(null,e),commonDataOptions:u.getCommonDataLayerProperties(null,!1,[],t),referenceLayer:u.getReferenceLayerProperties(null)},shouldRenderFilledMap:!1,geocodingCategory:"",hasCategory:!1,hasSeries:!1,hasXY:!1,hasSize:!1,hasInvalidLatLong:!1,hasInvalidGeocodingCulture:!1,hasDuplicatedLatLong:!1,hasPathID:!1,colorHelper:M.v.create(e,r.MC.dataPoint.fill),series:[],paths:null}},u.getMapControlProperties=function(e){return{styleProperties:{defaultStyle:(0,v.NA)(e,r.MC.mapControls.defaultStyle,r.a.grayscaleLight),showLabels:(0,v.NA)(e,r.MC.mapControls.showLabels,!0),worldWrap:(0,v.NA)(e,r.MC.mapControls.worldWrap,!0)},controlToggles:{showStylePicker:(0,v.NA)(e,r.MC.mapControls.showStylePicker,!0),showNavigationControls:(0,v.NA)(e,r.MC.mapControls.showNavigationControls,!0),showSelectionControl:(0,v.NA)(e,r.MC.mapControls.showSelectionControl,!1)},cameraProperties:{zoom:(0,v.NA)(e,r.MC.mapControls.zoom,0),centerLatitude:(0,v.NA)(e,r.MC.mapControls.centerLatitude,0),centerLongitude:(0,v.NA)(e,r.MC.mapControls.centerLongitude,0),heading:(0,v.NA)(e,r.MC.mapControls.heading,0),pitch:(0,v.NA)(e,r.MC.mapControls.pitch,0),autoZoom:(0,v.NA)(e,r.MC.mapControls.autoZoom,!0)},geocodingCulture:(0,v.NA)(e,r.MC.mapControls.geocodingCulture,Y.gA)}},u.getTrafficProperties=function(e){return{showTraffic:(0,v.NA)(e,r.MC.traffic.showTraffic,!1),showIncidents:(0,v.NA)(e,r.MC.traffic.showIncidents,!0),showTrafficControl:(0,v.NA)(e,r.MC.traffic.showTrafficControl,!1)}},u.getTileLayerProperties=function(e){return{tileLayerUrl:(0,v.NA)(e,r.MC.tileLayer.tileLayerUrl,""),tileSize:(0,v.NA)(e,r.MC.tileLayer.tileSize,512),northBounds:(0,v.NA)(e,r.MC.tileLayer.northBounds,85.0511),southBounds:(0,v.NA)(e,r.MC.tileLayer.southBounds,-85.0511),eastBounds:(0,v.NA)(e,r.MC.tileLayer.eastBounds,180),westBounds:(0,v.NA)(e,r.MC.tileLayer.westBounds,-180),transparency:(0,v.NA)(e,r.MC.tileLayer.transparency,0),isTMS:(0,v.NA)(e,r.MC.tileLayer.isTMS,!1),minZoom:(0,v.NA)(e,r.MC.tileLayer.minZoom,h.JX),maxZoom:(0,v.NA)(e,r.MC.tileLayer.maxZoom,h.Yd),layerPosition:(0,v.NA)(e,r.MC.tileLayer.layerPosition,"labels")}},u.getFilledMapProperties=function(e,t){return{showFilledMap:(0,v.NA)(e,r.MC.filledMap.show,!1),defaultColor:(0,v.W7)(e,r.MC.filledMap.defaultColor,t.colorPalette.dataColors.getColorByIndex(0).value),transparency:(0,v.NA)(e,r.MC.filledMap.transparency,0),strokeColor:(0,v.W7)(e,r.MC.filledMap.strokeColor,t.colorPalette.backgroundDark.value),strokeTransparency:(0,v.NA)(e,r.MC.filledMap.strokeTransparency,0),strokeWidth:(0,v.NA)(e,r.MC.filledMap.strokeWidth,1),minZoom:(0,v.NA)(e,r.MC.filledMap.minZoom,h.JX),maxZoom:(0,v.NA)(e,r.MC.filledMap.maxZoom,h.Yd),layerPosition:(0,v.NA)(e,r.MC.filledMap.layerPosition,"labels")}},u.getBubbleLayerProperties=function(e,t){var a=(0,v.NA)(e,r.MC.bubbleLayer.radius,5),n=(0,v.W7)(e,r.MC.dataPoint.fill,M.v.getDataColorByIndex(t,0)),o=(0,v.W7)(e,r.MC.bubbleLayer.strokeColor,t.colorPalette.background.value),l=(0,v.NA)(e,r.MC.bubbleLayer.strokeWidth,2);return{showBubbleLayer:(0,v.NA)(e,r.MC.bubbleLayer.show,!0),transparency:(0,v.NA)(e,r.MC.bubbleLayer.transparency,0),radius:a,minRadius:(0,v.NA)(e,r.MC.bubbleLayer.minRadius,5),markerRangeType:(0,v.NA)(e,r.MC.bubbleLayer.markerRangeType,q.Dl.dataRange),radiusScalingMethod:(0,v.NA)(e,r.MC.bubbleLayer.radiusScalingMethod,0),maxRadius:(0,v.NA)(e,r.MC.bubbleLayer.maxRadius,30),autoStrokeColor:(0,v.NA)(e,r.MC.bubbleLayer.autoStrokeColor,!1),strokeColor:o,strokeTransparency:(0,v.NA)(e,r.MC.bubbleLayer.strokeTransparency,0),strokeWidth:l,blur:(0,v.NA)(e,r.MC.bubbleLayer.blur,0),pitchAlignment:(0,v.NA)(e,r.MC.bubbleLayer.pitchAlignment,"viewport"),zoomScaleFactor:(0,v.NA)(e,r.MC.bubbleLayer.zoomScaleFactor,1),logScale:(0,v.NA)(e,r.MC.bubbleLayer.logScale,2),x1:(0,v.NA)(e,r.MC.bubbleLayer.x1,.15),x2:(0,v.NA)(e,r.MC.bubbleLayer.x2,.85),y1:(0,v.NA)(e,r.MC.bubbleLayer.y1,.7),y2:(0,v.NA)(e,r.MC.bubbleLayer.y2,.3),minZoom:(0,v.NA)(e,r.MC.bubbleLayer.minZoom,h.JX),maxZoom:(0,v.NA)(e,r.MC.bubbleLayer.maxZoom,h.Yd),layerPosition:(0,v.NA)(e,r.MC.bubbleLayer.layerPosition,"labels"),clusteringEnabled:(0,v.NA)(e,r.MC.bubbleLayer.clusteringEnabled,!1),clusteredBubbleRadius:(0,v.NA)(e,r.MC.bubbleLayer.clusteredBubbleRadius,Math.max(a,12)),clusteredBubbleFillColor:t.isHighContrast?M.v.getThemeColor(t,Q.fA):(0,v.W7)(e,r.MC.bubbleLayer.clusteredBubbleFillColor,n),clusteredBubbleFontColor:t.isHighContrast?M.v.getThemeColor(t,Q.U):(0,v.W7)(e,r.MC.bubbleLayer.clusteredBubbleFontColor,M.v.getThemeColor(t,Q.U)),clusteredBubbleFontSize:(0,v.NA)(e,r.MC.bubbleLayer.clusteredBubbleFontSize,18),clusteredBubbleStrokeColor:t.isHighContrast?M.v.getThemeColor(t,Q.U):(0,v.W7)(e,r.MC.bubbleLayer.clusteredBubbleStrokeColor,o),clusteredBubbleStrokeWidth:(0,v.NA)(e,r.MC.bubbleLayer.clusteredBubbleStrokeWidth,l)}},u.getHeatMapLayerProperties=function(e,t){var a=this.getHeatMapGradientColorScale(t);return{showHeatMapLayer:(0,v.NA)(e,r.MC.heatMapLayer.show,!1),heatMapRadius:(0,v.NA)(e,r.MC.heatMapLayer.heatMapRadius,20),heatMapRadiusUnit:(0,v.NA)(e,r.MC.heatMapLayer.heatMapRadiusUnit,h.c8),heatMapTransparency:(0,v.NA)(e,r.MC.heatMapLayer.heatMapTransparency,0),heatMapIntensity:(0,v.NA)(e,r.MC.heatMapLayer.heatMapIntensity,1),heatMapColorLow:(0,v.W7)(e,r.MC.heatMapLayer.heatMapColorLow,a(0)),heatMapColorCenter:(0,v.W7)(e,r.MC.heatMapLayer.heatMapColorCenter,a(.5)),heatMapColorHigh:(0,v.W7)(e,r.MC.heatMapLayer.heatMapColorHigh,a(1)),heatMapUseSize:(0,v.NA)(e,r.MC.heatMapLayer.heatMapUseSize,!1),minZoom:(0,v.NA)(e,r.MC.heatMapLayer.minZoom,h.JX),maxZoom:(0,v.NA)(e,r.MC.heatMapLayer.maxZoom,h.Yd),layerPosition:(0,v.NA)(e,r.MC.heatMapLayer.layerPosition,"labels")}},u.getBarChartProperties=function(e,t){return{dataProperties:{showBarChart:(0,v.NA)(e,r.MC.barChart.show,!1),barShape:(0,v.NA)(e,r.MC.barChart.barShape,0),thickness:(0,v.NA)(e,r.MC.barChart.thickness,1),scaleThicknessOnZoom:(0,v.NA)(e,r.MC.barChart.scaleThicknessOnZoom,!0)},paintProperties:{height:(0,v.NA)(e,r.MC.barChart.height,1),scaleHeightOnZoom:(0,v.NA)(e,r.MC.barChart.scaleHeightOnZoom,!0),defaultColor:(0,v.W7)(e,r.MC.barChart.defaultColor,t.colorPalette.dataColors.getColorByIndex(0).value),transparency:(0,v.NA)(e,r.MC.barChart.transparency,0),minZoom:(0,v.NA)(e,r.MC.barChart.minZoom,h.JX),maxZoom:(0,v.NA)(e,r.MC.barChart.maxZoom,h.Yd),layerPosition:(0,v.NA)(e,r.MC.barChart.layerPosition,"labels")}}},u.getCommonDataLayerProperties=function(e,t,a,n){for(var o={unselectedTransparency:(0,v.NA)(e,r.MC.commonDataOptions.unselectedTransparency,80)},l=[],i=0,c=a;i<c.length;i++){var f=_.sum(c[i].subDataPoints.map(function(N){return N.size}));l.push(f)}if(t){var S=(0,v.NA)(e,r.MC.commonDataOptions.showZeros,!0),L=(0,v.NA)(e,r.MC.commonDataOptions.showNegatives,!0),D=(0,v.NA)(e,r.MC.bubbleLayer.markerRangeType,void 0),B=(0,b.__spreadArray)([],l,!0);(!D||D===q.Dl.deprecated)&&(L&&!S?B=l.map(function(N){return Math.abs(N)}).filter(function(N){return N>0}):L?B=l.map(function(N){return Math.abs(N)}):S||(B=l.filter(function(N){return N>0})));var E=Math.min.apply(Math,B),U=Math.max.apply(Math,B);o.showZeros=S,o.showNegatives=L,o.minDataValue=(0,v.NA)(e,r.MC.commonDataOptions.minDataValue,E),o.maxDataValue=(0,v.NA)(e,r.MC.commonDataOptions.maxDataValue,U)}return o},u.getReferenceLayerProperties=function(e){var t=new Ne;return{additionalDatasource:(0,v.NA)(e,r.MC.referenceLayer.additionalDatasource,void 0),referenceLayerUrl:(0,v.NA)(e,r.MC.referenceLayer.referenceLayerUrl,""),datasourceType:(0,v.NA)(e,r.MC.referenceLayer.datasourceType,"file_upload"),bubble:(0,b.__assign)({fillColor:(0,v.W7)(e,r.MC.referenceLayerBubble.fillColor,t.bubble.fillColor),fillOpacity:(0,v.NA)(e,r.MC.referenceLayerBubble.fillOpacity,t.bubble.fillOpacity)},(0,Be.QI)(e,r.MC.referenceLayerBubble,t.bubble)),line:(0,Be.QI)(e,r.MC.referenceLayerLine,t.line),polygon:(0,b.__assign)({fillColor:(0,v.W7)(e,r.MC.referenceLayerPolygon.fillColor,t.polygon.fillColor),fillOpacity:(0,v.NA)(e,r.MC.referenceLayerPolygon.fillOpacity,t.polygon.fillOpacity)},(0,Be.QI)(e,r.MC.referenceLayerPolygon,t.polygon))}},u.GetSource=function(e,t){return e.find(function(a){return(0,ue.nu)(a,t)})},u.HaveRole=function(e,t){return-1!==e.findIndex(function(a){return(0,ue.nu)(a,t)})},u.GetValueIndexForRole=function(e,t){return e.findIndex(function(a){return(0,ue.nu)(a,t)})},u.AreLatLongInvalid=function(e){return!e||(0,ae.IU)(e.latitude,e.longitude)},u.getPointOrderValueFromNode=function(e,t){var a;return t??(null!==(a=be(e.value))&&void 0!==a?a:u.parseDate(e.value))},u.parseDate=function(e){return e instanceof Date?e:"string"==typeof e?isNaN(Date.parse(e))?null:new Date(e):"number"==typeof e?new Date(e):null},u}(),He=z(32554),se=z(33024),ze=z(59694),Le=function(){function u(){}return u.getMapSettingsCard=function(e,t,a){var n=new s.CQ(new s.lg(r.Do.mapControls),"Visual_AzureMapsMapSettings",r.MC.mapControls,a).withDescription("Visual_MapControlsDescription");return n.addGroup("style",function(o){o.withDisplayName("Style").addSimpleSlice(r.MC.mapControls.defaultStyle,new s.uY({descriptor:r.MC.mapControls.defaultStyle,value:e.mapControls.styleProperties.defaultStyle}).build()),t.azureMapsShowLabels&&o.addSimpleSlice(r.MC.mapControls.showLabels,new s.bd({descriptor:r.MC.mapControls.showLabels,value:e.mapControls.styleProperties.showLabels}).build())}).addGroup("view",function(o){o.withDisplayName("View").addSimpleSlice(r.MC.mapControls.autoZoom,new s.bd({descriptor:r.MC.mapControls.autoZoom,value:e.mapControls.cameraProperties.autoZoom}).build()).addSimpleSlice(r.MC.mapControls.zoom,new s.JN({descriptor:r.MC.mapControls.zoom,value:e.mapControls.cameraProperties.zoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:a}).build(),function(l){return l.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(r.MC.mapControls.centerLatitude,new s.mu({descriptor:r.MC.mapControls.centerLatitude,value:e.mapControls.cameraProperties.centerLatitude,options:{minValue:{type:0,value:h.U1},maxValue:{type:1,value:h.hW},unitSymbol:se.g}}).build(),function(l){return l.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(r.MC.mapControls.centerLongitude,new s.mu({descriptor:r.MC.mapControls.centerLongitude,value:e.mapControls.cameraProperties.centerLongitude,options:{minValue:{type:0,value:h.Nq},maxValue:{type:1,value:h.Yi},unitSymbol:se.g}}).build(),function(l){return l.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(r.MC.mapControls.heading,new s.JN({descriptor:r.MC.mapControls.heading,value:e.mapControls.cameraProperties.heading,options:{minValue:{type:0,value:h.Yl},maxValue:{type:1,value:h.Ix},unitSymbol:se.g},localize:a}).build(),function(l){return l.withDisabled(e.mapControls.cameraProperties.autoZoom)}).addSimpleSlice(r.MC.mapControls.pitch,new s.JN({descriptor:r.MC.mapControls.pitch,value:e.mapControls.cameraProperties.pitch,options:{minValue:{type:0,value:h.WL},maxValue:{type:1,value:h.a_},unitSymbol:se.g},localize:a}).build(),function(l){return l.withDisabled(e.mapControls.cameraProperties.autoZoom)})}).addGroup("controls",function(o){o.withDisplayName("Controls").addSimpleSlice(r.MC.mapControls.worldWrap,new s.bd({descriptor:r.MC.mapControls.worldWrap,value:e.mapControls.styleProperties.worldWrap}).build()).addSimpleSlice(r.MC.mapControls.showStylePicker,new s.bd({descriptor:r.MC.mapControls.showStylePicker,value:e.mapControls.controlToggles.showStylePicker}).build()).addSimpleSlice(r.MC.mapControls.showNavigationControls,new s.bd({descriptor:r.MC.mapControls.showNavigationControls,value:e.mapControls.controlToggles.showNavigationControls}).build(),function(l){return l.withCustomDisplayName("Navigation")}).addSimpleSlice(r.MC.mapControls.showSelectionControl,new s.bd({descriptor:r.MC.mapControls.showSelectionControl,value:e.mapControls.controlToggles.showSelectionControl}).build(),function(l){return l.withCustomDisplayName("ExplorationCanvasItemsPane_Title")}),t.azureMapsGeocoding&&o.addSimpleSlice(r.MC.mapControls.geocodingCulture,new s.uY({descriptor:r.MC.mapControls.geocodingCulture,value:e.mapControls.geocodingCulture||Y.gA}).build())}),n.build()},u.getLayerSettingsCard=function(e,t,a,n){var o=new s.CQ(new s.lg(r.Do.commonDataOptions),"Visual_AzureMapsCommonDataLayer",r.MC.commonDataOptions,n).withDescription("Visual_AzureMapsCommonDataLayerDescription");return e.hasSize&&o.addGroup("values",function(l){l.withDisplayName("Role_DisplayName_Values").addSimpleSlice(r.MC.commonDataOptions.minDataValue,new s.mu({descriptor:r.MC.commonDataOptions.minDataValue,value:t.commonDataOptions.minDataValue,options:{maxValue:{type:1,value:t.commonDataOptions.maxDataValue}}}).build(),function(i){return i.withCustomDisplayName("Aggregate_Min")}).addSimpleSlice(r.MC.commonDataOptions.maxDataValue,new s.mu({descriptor:r.MC.commonDataOptions.maxDataValue,value:t.commonDataOptions.maxDataValue,options:{minValue:{type:0,value:t.commonDataOptions.minDataValue}}}).build(),function(i){return i.withCustomDisplayName("Aggregate_Max")})}),o.addGroup("options",function(l){l.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(r.MC.commonDataOptions.unselectedTransparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.commonDataOptions.unselectedTransparency,value:t.commonDataOptions.unselectedTransparency,localize:n}).build())}),o.build()},u.getLegendCard=function(e,t,a,n){return(0,F.ZF)({legendData:t},e,a,!n.hasSeries)},u.getBubbleCard=function(e,t,a,n,o,l,i){if(e&&e.dataPoints&&0!==e.dataPoints.length&&t){var c=e.hasCategory&&e.hasSeries,d=l.azureMapsLatLongPieCharts&&e.hasDuplicatedLatLong,f=_.omit(r.MC.bubbleLayer,["clusteringEnabled","clusteredBubbleFillColor","clusteredBubbleFontColor","clusteredBubbleFontSize","clusteredBubbleRadius","clusteredBubbleStrokeColor","clusteredBubbleStrokeWidth"]),S=new s.CQ(new s.lg(r.Do.bubbleLayer),"Visual_AzureMapsBubbleLayer",(0,b.__assign)((0,b.__assign)({},f),r.MC.dataPoint),i).withDescription("Visual_BubblesDescription");return S.addTopLevelToggle("show",function(){return new s.bd({descriptor:r.MC.bubbleLayer.show,value:a.bubble.showBubbleLayer}).build()}),S.addGroup("size",function(L){var D;if(L.withDisplayName("Visual_BubbleSize"),e.hasSize){L.addSimpleSlice(r.MC.bubbleLayer.minRadius,new s.JN({descriptor:r.MC.bubbleLayer.minRadius,value:a.bubble.minRadius,options:{minValue:{type:0,value:h.Fw},maxValue:{type:1,value:Math.min(h.rn,a.bubble.maxRadius)},unitSymbol:se.e_},localize:i}).build(),function(U){return U.withCustomDisplayName("Aggregate_Min")}).addSimpleSlice(r.MC.bubbleLayer.maxRadius,new s.JN({descriptor:r.MC.bubbleLayer.maxRadius,value:a.bubble.maxRadius,options:{minValue:{type:0,value:Math.max(h.Fw,a.bubble.minRadius)},maxValue:{type:1,value:h.rn},unitSymbol:se.e_},localize:i}).build(),function(U){return U.withCustomDisplayName("Aggregate_Max")});var B={get:function(N){return i(N)},getOptional:function(N){return i(N)},format:function(N){return i(N)}},R=_.map(q.Yu,function(U){return(0,b.__assign)((0,b.__assign)({},U),{displayName:U.displayName(B)})}),E=null!==(D=R.find(function(U){return U.value===a.bubble.markerRangeType}))&&void 0!==D?D:{value:q.Dl.deprecated,displayName:i("Visual_MarkerRangeType_Deprecated")};L.addSimpleSlice(r.MC.bubbleLayer.markerRangeType,new s.uY({descriptor:r.MC.bubbleLayer.markerRangeType,items:R,value:E}).build(),function(U){return U.withCustomDisplayName("Visual_MarkerRangeType")})}else L.addSimpleSlice(r.MC.bubbleLayer.radius,new s.JN({descriptor:r.MC.bubbleLayer.radius,value:a.bubble.radius,options:{minValue:{type:0,value:h.Fw},maxValue:{type:1,value:h.rn},unitSymbol:se.e_},localize:i}).build())}).addGroup("shape",function(L){L.withDisplayName("Visual_Shape").addSimpleSlice(r.MC.bubbleLayer.transparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.bubbleLayer.transparency,value:a.bubble.transparency,localize:i}).build(),function(D){return D.withCustomDisplayName("Transparency")})}).addGroup("colors",function(L){if(L.withDisplayName("Visual_Colors"),e.hasSeries){var D=n(L);(0,He.y0)(D)}else{var B=o(L);(0,He.jN)(B)}}).addGroup("border",function(L){L.withDisplayName("Visual_Border"),c||L.addSimpleSlice(r.MC.bubbleLayer.autoStrokeColor,new s.bd({descriptor:r.MC.bubbleLayer.autoStrokeColor,value:a.bubble.autoStrokeColor}).build(),function(D){return D.withCustomDisplayName("BuiltInReportThemeHighContrast").withDisabled(d).withCustomDescriptionIf(function(){return d},"Visual_AzureMapsDisabledOptionForPieChartDescription")}),(!a.bubble.autoStrokeColor||c)&&L.addSimpleSlice(r.MC.bubbleLayer.strokeColor,new s.BT({descriptor:r.MC.bubbleLayer.strokeColor,value:{value:a.bubble.strokeColor}}).build(),function(D){return D.withCustomDisplayName("Generic_Color")}),L.addSimpleSlice(r.MC.bubbleLayer.strokeTransparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.bubbleLayer.strokeTransparency,value:a.bubble.strokeTransparency,localize:i}).build(),function(D){return D.withCustomDisplayName("Transparency")}).addSimpleSlice(r.MC.bubbleLayer.strokeWidth,new s.mu({descriptor:r.MC.bubbleLayer.strokeWidth,value:a.bubble.strokeWidth,options:{minValue:{type:0,value:h.Bc},maxValue:{type:1,value:h.Qv},unitSymbol:se.e_}}).build(),function(D){return D.withCustomDisplayName("Visual_General_Properties_Width")}),c||L.addSimpleSlice(r.MC.bubbleLayer.blur,new s.JN({descriptor:r.MC.bubbleLayer.blur,value:a.bubble.blur,options:{minValue:{type:0,value:h.fN},maxValue:{type:1,value:h.fQ},unitSymbol:se.e_},localize:i}).build(),function(D){return D.withDisabled(d).withCustomDescriptionIf(function(){return d},"Visual_AzureMapsDisabledOptionForPieChartDescription")})}).addGroup("zoom",function(L){return L.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(r.MC.bubbleLayer.maxZoom,new s.JN({descriptor:r.MC.bubbleLayer.maxZoom,value:a.bubble.maxZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:i}).build(),function(D){return D.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(r.MC.bubbleLayer.minZoom,new s.JN({descriptor:r.MC.bubbleLayer.minZoom,value:a.bubble.minZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:i}).build(),function(D){return D.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(L){L.withDisplayName("Desktop_FileMenu_Options"),c||L.addSimpleSlice(r.MC.bubbleLayer.pitchAlignment,new s.uY({descriptor:r.MC.bubbleLayer.pitchAlignment,value:a.bubble.pitchAlignment}).build(),function(D){return D.withDisabled(d).withCustomDescriptionIf(function(){return d},"Visual_AzureMapsDisabledOptionForPieChartDescription")}),L.addSimpleSlice(r.MC.bubbleLayer.layerPosition,new s.uY({descriptor:r.MC.bubbleLayer.layerPosition,value:a.bubble.layerPosition}).build())}),S.build()}},u.getBubbleClusteringCard=function(e,t,a,n,o){if(n.azureMapsBubbleCluster&&e&&e.dataPoints&&0!==e.dataPoints.length&&t){var l=_.pick(r.MC.bubbleLayer,["clusteringEnabled","clusteredBubbleFillColor","clusteredBubbleFontColor","clusteredBubbleFontSize","clusteredBubbleRadius","clusteredBubbleStrokeColor","clusteredBubbleStrokeWidth"]),i=new s.CQ(new s.lg("bubbleClustering"),"Visual_AzureMapsClusterBubbles",l,o).withDescription("Visual_AzureMapsClusterBubbles_Description");return i.addTopLevelToggle("clusteringEnabled",function(){return new s.bd({descriptor:r.MC.bubbleLayer.clusteringEnabled,value:a.bubble.clusteringEnabled}).build()}).addGroup("size",function(c){c.withDisplayName("Visual_BubbleSize").addSimpleSlice(r.MC.bubbleLayer.clusteredBubbleRadius,new s.JN({descriptor:r.MC.bubbleLayer.clusteredBubbleRadius,value:a.bubble.clusteredBubbleRadius,options:{minValue:{type:0,value:h.Fw},maxValue:{type:1,value:h.rn},unitSymbol:se.e_},localize:o}).build())}).addGroup("colors",function(c){c.withDisplayName("Visual_Colors").addSimpleSlice(r.MC.bubbleLayer.clusteredBubbleFillColor,new s.BT({descriptor:r.MC.bubbleLayer.clusteredBubbleFillColor,value:{value:a.bubble.clusteredBubbleFillColor}}).build())}).addGroup("value",function(c){c.withDisplayName("Role_DisplayName_Values").addSimpleSlice(r.MC.bubbleLayer.clusteredBubbleFontSize,new s.mu({descriptor:r.MC.bubbleLayer.clusteredBubbleFontSize,value:a.bubble.clusteredBubbleFontSize,options:s.JJ}).build()).addSimpleSlice(r.MC.bubbleLayer.clusteredBubbleFontColor,new s.BT({descriptor:r.MC.bubbleLayer.clusteredBubbleFontColor,value:{value:a.bubble.clusteredBubbleFontColor}}).build())}).addGroup("border",function(c){c.withDisplayName("Visual_Border").addSimpleSlice(r.MC.bubbleLayer.clusteredBubbleStrokeColor,new s.BT({descriptor:r.MC.bubbleLayer.clusteredBubbleStrokeColor,value:{value:a.bubble.clusteredBubbleStrokeColor}}).build()).addSimpleSlice(r.MC.bubbleLayer.clusteredBubbleStrokeWidth,new s.mu({descriptor:r.MC.bubbleLayer.clusteredBubbleStrokeWidth,value:a.bubble.clusteredBubbleStrokeWidth,options:{minValue:{type:0,value:h.Bc},maxValue:{type:1,value:h.Qv},unitSymbol:se.e_}}).build())}),e.properties.bubble.showBubbleLayer||i.withDisabled(!0,"Visual_AzureMaps_FormatOption_DisabledReason_ClusterBubble"),i.build()}},u.getCategoryLabelCard=function(e,t,a,n,o,l){if(o.azureMapsCategoryLabels&&e&&e.dataPoints&&0!==e.dataPoints.length){var d=r.MC.categoryLabels;return(0,V.Zu)({cardName:"Visual_CategoryLabels",dataLabelSettings:a,isShowCategory:!1,localize:l,props:d,revertToDefaultProps:d,showBackground:!0,showValueColor:!0,style:n,disabled:!t.bubble.showBubbleLayer,disabledReason:"Visual_AzureMapsCategoryLabelsDisabledReason_BubbleLayerOff"})}},u.getHeatMapCard=function(e,t,a){if(e&&e.dataPoints&&0!==e.dataPoints.length){var n=new s.CQ(new s.lg(r.Do.heatMapLayer),"Visual_HeatMap",r.MC.heatMapLayer,a).withDescription("Visual_HeatMapDescription");return n.addTopLevelToggle("show",function(){return new s.bd({descriptor:r.MC.heatMapLayer.show,value:t.heatMap.showHeatMapLayer}).build()}).addGroup("size",function(o){var l=h.OH;"meters"===t.heatMap.heatMapRadiusUnit&&(l=h.NI),o.withDisplayName("Visual_BubbleSize").addSimpleSlice(r.MC.heatMapLayer.heatMapRadius,new s.JN({descriptor:r.MC.heatMapLayer.heatMapRadius,value:t.heatMap.heatMapRadius,options:{minValue:{type:0,value:h._0},maxValue:{type:1,value:l},unitSymbol:se.e_},localize:a}).build()).addSimpleSlice(r.MC.heatMapLayer.heatMapRadiusUnit,new s.uY({descriptor:r.MC.heatMapLayer.heatMapRadiusUnit,value:t.heatMap.heatMapRadiusUnit}).build(),function(i){return i.withCustomDisplayName("Visual_DisplayUnits")}).addSimpleSlice(r.MC.heatMapLayer.heatMapIntensity,new s.JN({descriptor:r.MC.heatMapLayer.heatMapIntensity,value:t.heatMap.heatMapIntensity,options:{minValue:{type:0,value:h.x6},maxValue:{type:1,value:h.Dz}},localize:a}).build()),e.hasSize&&o.addSimpleSlice(r.MC.heatMapLayer.heatMapUseSize,new s.bd({descriptor:r.MC.heatMapLayer.heatMapUseSize,value:t.heatMap.heatMapUseSize}).build())}).addGroup("colors",function(o){o.withDisplayName("Visual_Colors").addSimpleSlice(r.MC.heatMapLayer.heatMapColorLow,new s.BT({descriptor:r.MC.heatMapLayer.heatMapColorLow,value:{value:t.heatMap.heatMapColorLow}}).build()).addSimpleSlice(r.MC.heatMapLayer.heatMapColorCenter,new s.BT({descriptor:r.MC.heatMapLayer.heatMapColorCenter,value:{value:t.heatMap.heatMapColorCenter}}).build()).addSimpleSlice(r.MC.heatMapLayer.heatMapColorHigh,new s.BT({descriptor:r.MC.heatMapLayer.heatMapColorHigh,value:{value:t.heatMap.heatMapColorHigh}}).build())}).addGroup("zoom",function(o){o.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(r.MC.heatMapLayer.maxZoom,new s.JN({descriptor:r.MC.heatMapLayer.maxZoom,value:t.heatMap.maxZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:a}).build(),function(l){return l.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(r.MC.heatMapLayer.minZoom,new s.JN({descriptor:r.MC.heatMapLayer.minZoom,value:t.heatMap.minZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:a}).build(),function(l){return l.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(o){o.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(r.MC.heatMapLayer.heatMapTransparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.heatMapLayer.heatMapTransparency,value:t.heatMap.heatMapTransparency,localize:a}).build()).addSimpleSlice(r.MC.heatMapLayer.layerPosition,new s.uY({descriptor:r.MC.heatMapLayer.layerPosition,value:t.heatMap.layerPosition}).build())}),e.hasSeries&&n.withDisabled(!0,"Visual_AzureMapsHeatMapFormatOptionDisabledReason"),n.build()}},u.getFilledMapCard=function(e,t,a,n,o,l,i){if(n&&e&&e.dataPoints&&0!==e.dataPoints.length&&t){var c=new s.CQ(new s.lg(r.Do.filledMap),"FilledMap_ToolTip",(0,b.__assign)((0,b.__assign)({},r.MC.filledMap),r.MC.dataPoint),i).withDescription("Visual_AzureMapsFilledMapDescription");return c.addTopLevelToggle("show",function(){return new s.bd({descriptor:r.MC.filledMap.show,value:a.filledMap.showFilledMap}).build()}).addGroup("shape",function(d){d.withDisplayName("Visual_Shape").addSimpleSlice(r.MC.filledMap.transparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.filledMap.transparency,value:a.filledMap.transparency,localize:i}).build())}).addGroup("colors",function(d){if(d.withDisplayName("Visual_Colors"),e.hasSeries){var f=o(d);(0,He.y0)(f)}else{var S=l(d);(0,He.jN)(S)}}).addGroup("border",function(d){d.withDisplayName("Visual_Border").addSimpleSlice(r.MC.filledMap.strokeColor,new s.BT({descriptor:r.MC.filledMap.strokeColor,value:{value:a.filledMap.strokeColor}}).build(),function(f){return f.withCustomDisplayName("Generic_Color")}).addSimpleSlice(r.MC.filledMap.strokeTransparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.filledMap.strokeTransparency,value:a.filledMap.strokeTransparency,localize:i}).build(),function(f){return f.withCustomDisplayName("Transparency")}).addSimpleSlice(r.MC.filledMap.strokeWidth,new s.mu({descriptor:r.MC.filledMap.strokeWidth,value:a.filledMap.strokeWidth,options:{minValue:{type:0,value:h.Bc},maxValue:{type:1,value:h.Qv},unitSymbol:se.e_}}).build(),function(f){return f.withCustomDisplayName("Visual_General_Properties_Width")})}).addGroup("zoom",function(d){d.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(r.MC.filledMap.maxZoom,new s.JN({descriptor:r.MC.filledMap.maxZoom,value:a.filledMap.maxZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:i}).build(),function(f){return f.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(r.MC.filledMap.minZoom,new s.JN({descriptor:r.MC.filledMap.minZoom,value:a.filledMap.minZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:i}).build(),function(f){return f.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(d){d.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(r.MC.filledMap.layerPosition,new s.uY({descriptor:r.MC.filledMap.layerPosition,value:a.filledMap.layerPosition}).build())}),e.hasSize&&c.withDisabled(!0,"Visual_AzureMaps_FormatOption_DisabledReason_FilledMap"),c.build()}},u.getBarChartCard=function(e,t,a,n,o,l){if(e&&e.dataPoints&&0!==e.dataPoints.length&&t){var i=new s.CQ(new s.lg(r.Do.barChart),"Visual_AzureMapsBarChartLayer",(0,b.__assign)((0,b.__assign)({},r.MC.barChart),r.MC.dataPoint),l).withDescription("Visual_AzureMapsBarChartDescription");return i.addTopLevelToggle("show",function(){return new s.bd({descriptor:r.MC.barChart.show,value:a.barChart.dataProperties.showBarChart}).build()}).addGroup("size",function(c){c.withDisplayName("Visual_BubbleSize").addSimpleSlice(r.MC.barChart.height,new s.JN({descriptor:r.MC.barChart.height,value:a.barChart.paintProperties.height,options:{minValue:{type:0,value:h.Z3},maxValue:{type:1,value:h.t},unitSymbol:se.e_},localize:l}).build()).addSimpleSlice(r.MC.barChart.thickness,new s.JN({descriptor:r.MC.barChart.thickness,value:a.barChart.dataProperties.thickness,options:{minValue:{type:0,value:h.z$},maxValue:{type:1,value:h.W5},unitSymbol:se.e_},localize:l}).build()).addSimpleSlice(r.MC.barChart.scaleHeightOnZoom,new s.bd({descriptor:r.MC.barChart.scaleHeightOnZoom,value:a.barChart.paintProperties.scaleHeightOnZoom}).build()).addSimpleSlice(r.MC.barChart.scaleThicknessOnZoom,new s.bd({descriptor:r.MC.barChart.scaleThicknessOnZoom,value:a.barChart.dataProperties.scaleThicknessOnZoom}).build())}).addGroup("shape",function(c){c.withDisplayName("Visual_Shape").addSimpleSlice(r.MC.barChart.barShape,new s.uY({descriptor:r.MC.barChart.barShape,value:a.barChart.dataProperties.barShape}).build(),function(d){return d.withCustomDisplayName("Style")}).addSimpleSlice(r.MC.barChart.transparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.barChart.transparency,value:a.barChart.paintProperties.transparency,localize:l}).build())}).addGroup("colors",function(c){if(c.withDisplayName("Visual_Colors"),e.hasSeries){var d=n(c);(0,He.y0)(d)}else{var f=o(c);(0,He.jN)(f)}}).addGroup("zoom",function(c){c.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(r.MC.barChart.maxZoom,new s.JN({descriptor:r.MC.barChart.maxZoom,value:a.barChart.paintProperties.maxZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:l}).build(),function(d){return d.withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(r.MC.barChart.minZoom,new s.JN({descriptor:r.MC.barChart.minZoom,value:a.barChart.paintProperties.minZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:l}).build(),function(d){return d.withCustomDisplayName("Aggregate_Min")})}).addGroup("options",function(c){c.withDisplayName("Desktop_FileMenu_Options").addSimpleSlice(r.MC.barChart.layerPosition,new s.uY({descriptor:r.MC.barChart.layerPosition,value:a.barChart.paintProperties.layerPosition}).build())}),i.build()}},u.getReferenceLayerCard=function(e,t,a){var n=new s.CQ(new s.lg(r.Do.referenceLayer),"Visual_AzureMapsReferenceLayer",(0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)([],Object.values(r.MC.referenceLayer),!0),Object.values(r.MC.referenceLayerLine),!0),Object.values(r.MC.referenceLayerPolygon),!0),Object.values(r.MC.referenceLayerBubble),!0),a);return n.withDescription(t.azureMapsMultiDataFormats?"Visual_AzureMapsReferenceLayerDescriptionMultiDataFormats":"Visual_AzureMapsReferenceLayerDescription"),n.addGroup(t.azureMapsCustomFormattingReferenceLayer?r.DQ.dataSource:r.Do.referenceLayer,function(l){if(t.azureMapsCustomFormattingReferenceLayer&&l.withDisplayName("Data_Source"),t.azureMapsMultiDataFormats)if(l.addSimpleSlice(r.MC.referenceLayer.datasourceType,new s.uY({descriptor:r.MC.referenceLayer.datasourceType,value:e.referenceLayer.datasourceType}).build()),"url"===e.referenceLayer.datasourceType){var i=t.azureMapsDynamicReferenceLayer?(0,b.__assign)((0,b.__assign)({},r.MC.referenceLayer.referenceLayerUrl),{instanceKind:3}):r.MC.referenceLayer.referenceLayerUrl;l.addSimpleSlice(r.MC.referenceLayer.referenceLayerUrl,new s.fq({descriptor:i,value:e.referenceLayer.referenceLayerUrl,placeholder:""}).build())}else"file_upload"===e.referenceLayer.datasourceType&&l.addSimpleSlice(r.MC.referenceLayer.additionalDatasource,new s.vX({descriptor:r.MC.referenceLayer.additionalDatasource,value:e.referenceLayer.additionalDatasource,isAzMapReferenceSelector:!0,enableMultipleDataFormats:t.azureMapsMultiDataFormats,keepIconURLs:t.azureMapsMultiDataFormatsKeepIconURLs}).build());else l.addSimpleSlice(r.MC.referenceLayer.additionalDatasource,new s.vX({descriptor:r.MC.referenceLayer.additionalDatasource,value:e.referenceLayer.additionalDatasource,isAzMapReferenceSelector:!0}).build())}),t.azureMapsCustomFormattingReferenceLayer&&n.addGroup(r.DQ.point,function(l){return l.withDisplayName("Visual_Forecast_Units_Point").withDescription("AzureMapVisual_ReferenceLayer_Style_Message").addSimpleSlice(r.MC.referenceLayerBubble.fillColor,new s.BT({descriptor:r.MC.referenceLayerBubble.fillColor,value:{value:e.referenceLayer.bubble.fillColor}}).build()).addSlices((0,Be.Iq)({containerItemBuilder:l,descriptors:r.MC.referenceLayerBubble,strokeData:e.referenceLayer.bubble,selector:null,maxWidth:h.Qv,localize:a}).map(function(i){return i.build()}))}).addGroup(r.DQ.line,function(l){return l.withDisplayName("Visual_Lines").withDescription("AzureMapVisual_ReferenceLayer_Style_Message").addSlices((0,Be.Iq)({containerItemBuilder:l,descriptors:r.MC.referenceLayerLine,strokeData:e.referenceLayer.line,selector:null,maxWidth:h.Qv,localize:a}).map(function(i){return i.build()}))}).addGroup(r.DQ.polygon,function(l){return l.withDisplayName("AzureMapVisual_Polygons").withDescription("AzureMapVisual_ReferenceLayer_Style_Message").addSimpleSlice(r.MC.referenceLayerPolygon.fillColor,new s.BT({descriptor:r.MC.referenceLayerPolygon.fillColor,value:{value:e.referenceLayer.polygon.fillColor}}).build()).addSlices((0,Be.Iq)({containerItemBuilder:l,descriptors:r.MC.referenceLayerPolygon,strokeData:e.referenceLayer.polygon,selector:null,maxWidth:h.Qv,localize:a}).map(function(i){return i.build()}))}),n.build()},u.getTrafficCard=function(e,t){var a=new s.CQ(new s.lg(r.Do.traffic),"Visual_AzureMapsTrafficLayer",r.MC.traffic,t).withDescription("Visual_AzureMapsTrafficLayerDescription");return a.addTopLevelToggle("show",function(){return new s.bd({descriptor:r.MC.traffic.showTraffic,value:e.traffic.showTraffic}).build()}).addGroup(r.Do.traffic,function(n){n.addSimpleSlice(r.MC.traffic.showIncidents,new s.bd({descriptor:r.MC.traffic.showIncidents,value:e.traffic.showIncidents}).build()),n.addSimpleSlice(r.MC.traffic.showTrafficControl,new s.bd({descriptor:r.MC.traffic.showTrafficControl,value:e.traffic.showTrafficControl}).build())}),a.build()},u.getTileLayerCard=function(e,t){var a=new s.CQ(new s.lg(r.Do.tileLayer),"Visual_AzureMapsTileLayer",r.MC.tileLayer,t).withDescription("Visual_AzureMapsTileLayerDescription");return a.addGroup("tile",function(n){n.withDisplayName("Tile_Generic").addSimpleSlice(r.MC.tileLayer.tileLayerUrl,new s.fq({descriptor:r.MC.tileLayer.tileLayerUrl,value:e.tile.tileLayerUrl,placeholder:""}).build()).addSimpleSlice(r.MC.tileLayer.tileSize,new s.mu({descriptor:r.MC.tileLayer.tileSize,value:e.tile.tileSize,options:{minValue:{type:0,value:h.nv},maxValue:{type:1,value:h.Co},unitSymbol:se.e_}}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))})}).addGroup("view",function(n){n.withDisplayName("View").addSimpleSlice(r.MC.tileLayer.northBounds,new s.mu({descriptor:r.MC.tileLayer.northBounds,value:e.tile.northBounds,options:{minValue:{type:0,value:h.U1},maxValue:{type:1,value:h.hW},unitSymbol:se.g}}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))}).addSimpleSlice(r.MC.tileLayer.southBounds,new s.mu({descriptor:r.MC.tileLayer.southBounds,value:e.tile.southBounds,options:{minValue:{type:0,value:h.U1},maxValue:{type:1,value:h.hW},unitSymbol:se.g}}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))}).addSimpleSlice(r.MC.tileLayer.eastBounds,new s.mu({descriptor:r.MC.tileLayer.eastBounds,value:e.tile.eastBounds,options:{minValue:{type:0,value:h.Nq},maxValue:{type:1,value:h.Yi},unitSymbol:se.g}}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))}).addSimpleSlice(r.MC.tileLayer.westBounds,new s.mu({descriptor:r.MC.tileLayer.westBounds,value:e.tile.westBounds,options:{minValue:{type:0,value:h.Nq},maxValue:{type:1,value:h.Yi},unitSymbol:se.g}}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))})}).addGroup("zoom",function(n){n.withDisplayName("Visual_ShapeMap_Zoom").addSimpleSlice(r.MC.tileLayer.maxZoom,new s.JN({descriptor:r.MC.tileLayer.maxZoom,value:e.tile.maxZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:t}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl)).withCustomDisplayName("Aggregate_Max")}).addSimpleSlice(r.MC.tileLayer.minZoom,new s.JN({descriptor:r.MC.tileLayer.minZoom,value:e.tile.minZoom,options:{minValue:{type:0,value:h.JX},maxValue:{type:1,value:h.Yd}},localize:t}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl)).withCustomDisplayName("Aggregate_Min")})}).addGroup("operations",function(n){n.withDisplayName("Visual_AzureMapsOperations").addSimpleSlice(r.MC.tileLayer.transparency,s.JN.getTransparencySliderBuilder({descriptor:r.MC.tileLayer.transparency,value:e.tile.transparency,localize:t}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))}).addSimpleSlice(r.MC.tileLayer.isTMS,new s.bd({descriptor:r.MC.tileLayer.isTMS,value:e.tile.isTMS}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))}).addSimpleSlice(r.MC.tileLayer.layerPosition,new s.uY({descriptor:r.MC.tileLayer.layerPosition,value:e.tile.layerPosition}).build(),function(o){return o.withDisabled((0,ze.g)(e.tile.tileLayerUrl))})}),a.build()},u}(),ct=function(){function u(e){this.rootElement=e}return u.prototype.display=function(){null==this.container&&(this.container=jQuery('<div class="azureMapSplashDiv"><div class="azureMapsSplash" aria-live="polite"><div class="azureMapsSplashLogo"></div></div></div>'),this.rootElement.prepend(this.container))},u.prototype.remove=function(){this.container&&(this.container.remove(),this.container=null)},u}(),tt=z(5381),ht=z(63972),at=z(32041),Rt=z(59107),At=z(9795),_t=z(32379),dt=z(52967),ce=z(72118),rt=z(81293),It=z(49988),pt=function(){function u(e,t){this._options=new Ne,this._datasource=e;var a=_.merge(_.cloneDeep(this._options),_.cloneDeep(t));this.setLayers(a),this.setOptions(a)}return u.prototype.setLayers=function(e){var a=e.style,n=e.unselectedTransparency;this._layers={bubbleLayer:new atlas.layer.BubbleLayer(this._datasource,null,(0,b.__assign)({filter:["all",["!",["has","image"]],["any",["==",["geometry-type"],"Point"],["==",["geometry-type"],"MultiPoint"]]],radius:["case",["has","size"],["*",["get","size"],4],["has","marker-size"],["match",["get","marker-size"],"small",6,"medium",8,"large",12,1],["has","scale"],["*",["get","scale"],4],4],color:u.bubbleFillColorExp(e.bubble.fillColor,a),opacity:u.getFillOpacityExp(e.bubble.fillOpacity,n)},u.getStrokeExpression(e.bubble,n,a,!0))),extrudedPolygonLayer:new atlas.layer.PolygonExtrusionLayer(this._datasource,null,{base:["case",["has","base"],["get","base"],0],fillColor:["case",["has","fillColor"],["get","fillColor"],["has","fill"],["get","fill"],"#1e90ff"],filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["all",["has","height"],["!=",["get","height"],0]]],height:["get","height"]}),polygonBorderLayer:new atlas.layer.LineLayer(this._datasource,null,(0,b.__assign)({filter:["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]},u.getStrokeExpression(e.polygon,n,a))),lineLayer:new atlas.layer.LineLayer(this._datasource,null,(0,b.__assign)({filter:["any",["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"]]},u.getStrokeExpression(e.line,n,a))),polygonLayer:new atlas.layer.PolygonLayer(this._datasource,null,{fillColor:u.polygonFillColorExp(e.polygon.fillColor,a),fillOpacity:u.getFillOpacityExp(e.polygon.fillOpacity,n),filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["any",["!",["has","height"]],["==",["get","height"],0]]]}),symbolLayer:new atlas.layer.SymbolLayer(this._datasource,null,{filter:["all",["any",["==",["geometry-type"],"Point"],["==",["geometry-type"],"MultiPoint"]]],iconOptions:{allowOverlap:!0,anchor:["case",["has","anchor"],["match",["get","anchor"],["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],["get","anchor"],"bottom"],"bottom"],ignorePlacement:!0,image:["case",["has","image"],["get","image"],"none"],offset:["case",["has","offset"],["get","offset"],["literal",[0,0]]],rotation:["case",["has","rotation"],["get","rotation"],0],size:["case",["has","size"],["get","size"],["has","marker-size"],["match",["get","marker-size"],"small",.5,"medium",1,"large",2,1],1]},textOptions:{offset:["case",["has","image"],["literal",[0,1.2]],["literal",[0,2]]]}})}},u.prototype.getLayers=function(){var e=this,t=[];return Object.keys(this._layers).forEach(function(a){t.push(e._layers[a])}),t},u.prototype.setOptions=function(e){var t=this,a=e.style,n=e.unselectedTransparency;this._options.allowExtrusions!==e.allowExtrusions&&(e.allowExtrusions?(this._layers.extrudedPolygonLayer.setOptions({filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["all",["has","height"],["!=",["get","height"],0]]],visible:this._options.visible}),this._layers.polygonLayer.setOptions({filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]],["any",["!",["has","height"]],["==",["get","height"],0]]]})):(this._layers.extrudedPolygonLayer.setOptions({visible:!1}),this._layers.polygonLayer.setOptions({filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]]})));var o=function(i,c,d,f){var S=u.getStrokeExpression(c,n,a,f);i.strokeColor!==c.strokeColor&&d.setOptions({strokeColor:S.strokeColor}),i.strokeWidth!==c.strokeWidth&&d.setOptions({strokeWidth:S.strokeWidth}),(i.strokeTransparency!==c.strokeTransparency||t._options.unselectedTransparency!==n)&&d.setOptions({strokeOpacity:S.strokeOpacity})};o(this._options.bubble,e.bubble,this._layers.bubbleLayer,!0),o(this._options.line,e.line,this._layers.lineLayer),o(this._options.polygon,e.polygon,this._layers.polygonBorderLayer),this._options.bubble.fillColor!==e.bubble.fillColor&&this._layers.bubbleLayer.setOptions({color:u.bubbleFillColorExp(e.bubble.fillColor,a)}),this._options.polygon.fillColor!==e.polygon.fillColor&&this._layers.polygonLayer.setOptions({fillColor:u.polygonFillColorExp(e.polygon.fillColor,a)}),this._options.unselectedTransparency!==n&&(this._layers.bubbleLayer.setOptions({opacity:u.getFillOpacityExp(e.bubble.fillOpacity,n)}),this._layers.polygonLayer.setOptions({fillOpacity:u.getFillOpacityExp(e.polygon.fillOpacity,n)})),this._options.visible!==e.visible&&(this._layers.polygonBorderLayer.setOptions({visible:e.visible}),this._layers.polygonLayer.setOptions({visible:e.visible}),this._layers.lineLayer.setOptions({visible:e.visible}),this._layers.extrudedPolygonLayer.setOptions({visible:e.visible&&e.allowExtrusions}),this._layers.bubbleLayer.setOptions({visible:e.visible}),this._layers.symbolLayer.setOptions({visible:e.visible})),this._options=e},u.prototype.onAdd=function(e){e.layers.add([this._layers.polygonLayer,this._layers.polygonBorderLayer,this._layers.lineLayer,this._layers.extrudedPolygonLayer],"labels"),e.layers.add([this._layers.bubbleLayer,this._layers.symbolLayer])},u.getStrokeExpression=function(e,t,a,n){var o=a?.isHighContrast?M.v.getThemeColor(a,Q.U):e.strokeColor;return{strokeColor:n?o:["case",["has","strokeColor"],["get","strokeColor"],["has","stroke"],["get","stroke"],o],strokeOpacity:["case",ce.J.getSelectionFilter(!0),(0,P.TD)(e.strokeTransparency),ce.J.getSelectionFilter(!1),(0,P.TD)(t),["has","strokeOpacity"],["get","strokeOpacity"],["has","stroke-opacity"],["get","stroke-opacity"],(0,P.TD)(e.strokeTransparency)],strokeWidth:["case",["has","strokeWidth"],["get","strokeWidth"],["has","stroke-width"],["get","stroke-width"],["has","stroke-thickness"],["get","stroke-thickness"],e.strokeWidth],lineCap:"none"===e.strokeDashCap?"butt":e.strokeDashCap,lineJoin:e.strokeLineJoin}},u.getFillOpacityExp=function(e,t){return["case",ce.J.getSelectionFilter(!0),e,ce.J.getSelectionFilter(!1),(0,P.TD)(t),["has","fillOpacity"],["get","fillOpacity"],["has","fill-opacity"],["get","fill-opacity"],e]},u.bubbleFillColorExp=function(e,t){return["case",["has","color"],["get","color"],["has","marker-color"],["get","marker-color"],e=t?.isHighContrast?M.v.getThemeColor(t,Q.fA):e]},u.polygonFillColorExp=function(e,t){return["case",["has","fillColor"],["get","fillColor"],["has","fill"],["get","fill"],e=t?.isHighContrast?M.v.getThemeColor(t,Q.fA):e]},u}(),Ot=function(){function u(e,t){this.setShapes(e),this.setDataPoints(t),this.createShapeDataMappings()}return u.prototype.getDataPointFromShape=function(e){var t=this.getShapePropValue(e,this.shapePropName);if(t)return this.shapeToData[t]},u.prototype.getShapesFromDataPoint=function(e){var t=e.categoryValue;if(t)return this.categoryToShapes[t]},u.prototype.countShapeProps=function(e){var t={};return e.forEach(function(n){for(var o in n.properties)t.hasOwnProperty(o)?t[o]++:t[o]=1}),Object.entries(t).map(function(n){return{propName:n[0],count:n[1]}})},u.prototype.getShapePropValue=function(e,t){var a,n=null===(a=e?.properties)||void 0===a?void 0:a[t];if("string"==typeof n)return n},u.prototype.getShapes=function(){return this.shapes},u.prototype.setShapes=function(e){this.shapes=e},u.prototype.setDataPoints=function(e){this.dataPoints=e},u.prototype.clearMappings=function(){this.shapes=[],this.dataPoints=[],this.shapeToData={},this.categoryToShapes={}},u.prototype.matchShapesToDataPoints=function(e){var t=0;e:for(var a=0,n=this.shapeProps;a<n.length;a++){var o=n[a];if(t>o.count)break e;for(var l=0,i=new Map,c=new Map,d=(0,b.__spreadArray)([],this.shapes,!0),f=d.length-1;f>=0;f--){var S=d[f],L=this.getShapePropValue(S,o.propName);if(L||0===L){var D=L.toString().toLowerCase(),B=e.get(D);if(B&&(i.has(B.categoryValue)||i.set(B.categoryValue,[]),i.get(B.categoryValue).push(S),c.set(L,B),d.splice(f,1),l++),0===d.length||0===e.size){t=l,this.shapePropName=o.propName,this.shapeToData=Object.fromEntries(c),this.categoryToShapes=Object.fromEntries(i);break e}}}l>t&&(t=l,this.shapePropName=o.propName,this.shapeToData=Object.fromEntries(c),this.categoryToShapes=Object.fromEntries(i))}},u.prototype.createShapeDataMappings=function(){this.shapeProps=this.countShapeProps(this.shapes),this.shapeProps=this.shapeProps.sort(function(t,a){return a.count-t.count});var e=this.dataPoints.reduce(function(t,a){return a.categoryValue&&t.set(a.categoryValue.toLowerCase(),a),t},new Map);this.matchShapesToDataPoints(e)},u}(),Vt=z(2379),Lt=function(){function u(e,t,a){var n=this;this.mapStyleChanged=function(){if(_.startsWith(n.map.getStyle().style.toLowerCase(),"blank"))n.observer||(n.onBackgroundChange(),n.observer=new MutationObserver(n.onBackgroundChange),n.observer.observe(n.map.getMapContainer(),{attributes:!0,attributeFilter:["style"]}));else{n.observer&&(n.observer.disconnect(),delete n.observer);var o="light";["satellite","satellite_road_labels","grayscale_dark","night"].indexOf(n.map.getStyle().style)>-1&&(o="dark"),n.setTheme(o)}},this.onBackgroundChange=function(){var l="light";switch(n.map.getStyle().style){case"satellite":case"satellite_road_labels":case"grayscale_dark":case"night":l="dark"}n.setTheme(l)},this.container=e,this.map=t,this.style=a,"auto"===a?(this.mapStyleChanged(),this.map.events.add("styledata",this.mapStyleChanged)):e.classList.add(a)}return u.prototype.dispose=function(){var e=this;this.container&&(this.container=null),this.updateMap(null),Object.keys(this).forEach(function(t){e[t]=null})},u.prototype.updateMap=function(e){this.map&&"auto"===this.style&&this.map.events.remove("styledata",this.mapStyleChanged),this.map=e,e&&"auto"===this.style&&e.events.add("styledata",this.mapStyleChanged)},u.prototype.setTheme=function(e){this.theme!==e&&(this.container.classList.remove(this.theme),this.container.classList.add(e),this.theme=e)},u}(),Ft=z(65302),Dt="routeRangeDataSource";function Gt(u){return"getSource"in u}var Yt=function(){function u(e,t,a,n,o,l){var i=this;this.mapControl=e,this.host=t,this.featureSwitches=a,this.behavior=n,this.style=o,this.isTouchEvent=l,this.svgMarkers={},this.markerIdentityKeyLastHovered=null,this.viewportSize={width:0,height:0},this.clickPieState=null,this.mapControlMoved=function(){i.drawDataLabels()},this.shouldUseLegacyFormat=function(){return i.data.properties.bubble.markerRangeType===q.Dl.deprecated},this.showTooltip=function(c,d){i.tooltipService&&i.tooltipService.show({coordinates:c,isTouchEvent:i.isTouchEvent,dataItems:d.tooltipInfo,identities:d.identity?[d.identity.getSelectorsByColumn()]:[]})},this.hideTooltip=function(){i.tooltipService&&i.tooltipService.hide({isTouchEvent:i.isTouchEvent,immediately:!1})},this.zoomChanged=function(){i.mapControl&&i.lastDataZoom!==Math.round(i.mapControl.getCamera().zoom)&&(i.lastDataZoom=Math.round(i.mapControl.getCamera().zoom),i.data.properties.barChart.dataProperties.showBarChart&&i.updateFeatures())},this.updateFeatures=function(){var c,d,f,S,L,D,B;i.featureSwitches.azureMapsDataBoundReferenceLayer&&i.referenceDataMatcher&&(i.referenceDataMatcher.setDataPoints(i.data.dataPoints),i.referenceDataMatcher.createShapeDataMappings());var R=i.getFeatureMapping();i.updateFeatureDataSource(i.bubbleDataSource,R.bubble),i.updateFeatureDataSource(i.barChart3DDataSource,R.barChart3D),i.updateFeatureDataSource(i.filledMapDataSource,R.filledMap),i.updateFeatureDataSource(i.heatMapDataSource,R.heatMap),i.featureSwitches.azureMapsDataBoundReferenceLayer&&i.updateFeatureDataSource(i.referenceDataSource,R.reference),i.features=(0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)([],null!==(c=R.bubble)&&void 0!==c?c:[],!0),null!==(d=R.barChart3D)&&void 0!==d?d:[],!0),null!==(f=R.filledMap)&&void 0!==f?f:[],!0),null!==(S=R.heatMap)&&void 0!==S?S:[],!0),null!==(L=R.reference)&&void 0!==L?L:[],!0),null===(B=null===(D=i.behavior)||void 0===D?void 0:D.renderSelection)||void 0===B||B.call(D,i.behavior.visualHasSelection())},this.disableControlsDefaultEvent=function(c){c.stopPropagation()},this.updateOutlinesFromSubSelections=function(c){var d=c.visualObjects[0].objectName,f=c.visualObjects[0].selectorsByColumn,S=i.data.series.findIndex(function(ee){return(0,_t.Ic)(ee.identity.getSelectorsByColumn(),f)});if("bubbles"!==d.split("-")[0])return[];var D=-1!==S?i.data.dataPoints.filter(function(ee){return ee.subDataPoints[0].seriesIndex===S}):i.data.dataPoints,R=i.bubbleLayer.getOptions().radius,E=i.mapControl.getCamera(),U=i.shouldUseLegacyFormat(),N=i.data.properties.bubble.strokeWidth;return i.subSelectionRegionOutlineFragment={id:d,outline:{type:0,outlines:D.filter(function(ee){return ee.location}).map(function(ee){var oe=i.mapControl.getMapContainer().getBoundingClientRect(),X=oe.width/i.viewportSize.width,Z=(U?ce.J.LEGACY_evaluateRadiusExpression(R,E.zoom,ee.subDataPoints[0].size)+N:(ee.bubbleRadius||0)+N)*X,te=i.mapControl.positionsToPixels([[ee.location.longitude,ee.location.latitude]])[0].map(function(ne){return ne*X});return{type:1,x:oe.x+te[0]-Z,y:oe.y+te[1]-Z,width:2*Z,height:2*Z}})}},[i.subSelectionRegionOutlineFragment]},this.clearLastHoverMarker=function(){i.markerIdentityKeyLastHovered&&i.svgMarkers[i.markerIdentityKeyLastHovered]&&i.mapControl.markers.remove(i.svgMarkers[i.markerIdentityKeyLastHovered])},this.handleMousemoveOnPie=function(c){if(i.formatMode)return i.clearLastHoverMarker(),void(i.markerIdentityKeyLastHovered=null);i.mapControl.getCanvasContainer().style.cursor="pointer";var d=c&&_.find(c.shapes,function(B){return B&&B.getProperties}),f=d&&u.getFirstIdentityKey(d);if(void 0!==f&&i.markerIdentityKeyLastHovered!==f){i.clearLastHoverMarker(),i.markerIdentityKeyLastHovered=f;var S=i.data.dataPoints.filter(function(B){return B.subDataPoints[0].identity.getKey()===f})[0],L=i.svgMarkers[f];i.mapControl.markers.add(L),L.getElement().querySelectorAll("circle, path").forEach(function(B,R){i.tooltipService&&(B.onmouseover=function(E){i.tooltipService.show({coordinates:[E.x,E.y],isTouchEvent:i.isTouchEvent,dataItems:S.subDataPoints[R].tooltipInfo,identities:S.subDataPoints[R].identity?[S.subDataPoints[R].identity.getSelectorsByColumn()]:[]})}),B.onclick=B.oncontextmenu=function(E){i.clickPieState={idx:R,dataPointHovered:S,event:E}}})}},this.tooltipService=t.tooltips(),this.pieFactory=new It.t(e.imageSprite)}return Object.defineProperty(u.prototype,"bubbleDataSource",{get:function(){return this.mapControl.sources.getById(h.oy)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"heatMapDataSource",{get:function(){return this.mapControl.sources.getById(h.Ol)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"filledMapDataSource",{get:function(){return this.mapControl.sources.getById(h.HC)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"barChart3DDataSource",{get:function(){return this.mapControl.sources.getById(h.zD)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"referenceDataSource",{get:function(){return this.mapControl.sources.getById(h.uL)},enumerable:!1,configurable:!0}),u.prototype.setupMap=function(e,t){var a=this;this.createDataSource(h.oy,{promoteId:"_azureMapsShapeId",clusterProperties:{_azureMapsShapeId:[["slice",["concat",["accumulated"],["get","_azureMapsShapeId"]],0,72],["get","_azureMapsShapeId"]],selected:["any",["get","selected"]]}}),this.createDataSource(h.Ol),this.createDataSource(h.HC,{tolerance:1}),this.createDataSource(h.zD,{tolerance:1}),this.createDataSource(h.uL,{tolerance:1}),this.trafficControl=this.createTrafficControl(),this.styleControl=new atlas.control.StyleControl({mapStyles:"all",layout:"list"}),this.pitchControl=new atlas.control.PitchControl,this.compassControl=new atlas.control.CompassControl,this.zoomControl=new atlas.control.ZoomControl,this.selectionControl=t||function(u,e){var t,n;(n=t||(t={})).circle="circle",n.rectangle="rectangle",n.polygon="polygon",n.routeRange="routeRange";var a=function(n){function o(l,i){var c=n.call(this)||this;return c.options={style:"light",selectionModes:"all",fillColor:"#F2C811",fillOpacity:.5,strokeColor:"#F2C811",strokeWidth:1,persistSearchArea:!1,routeRangeMinMapSize:[325,200],routeRangeOptions:{}},c.hasMouse=!1,c.hasFocus=!1,c.copyDrawnShape=function(d){c.rangeDataSource.setShapes([new atlas.Shape(new atlas.data.Polygon(d.getCoordinates()))])},c.displayRangePolygon=function(d){c.rangeDataSource.setShapes([d])},c.searchArea=function(d){c.clear();var f=c.options.sourceIds;if(f&&d){var S=f.reduce(function(D,B){return(0,b.__spreadArray)((0,b.__spreadArray)([],D,!0),c.map.sources.getById(B).getShapes(),!0)},[]),L=Vt.b.shapesWithinPolygon(S,d);c._invokeEvent("dataSelected",L)}c.drawingManager.setOptions({mode:atlas.drawing.DrawingMode.idle})},c.mapResized=function(){var d=c.options.routeRangeMinMapSize,f=c.map.getMapContainer().getBoundingClientRect();c.routeRangeBtn.css("display",f.width>=d[0]&&f.height>=d[1]?"":"none")},c.host=l,c.options=(0,b.__assign)((0,b.__assign)({},c.options),i||{}),c}return(0,b.__extends)(o,n),Object.defineProperty(o.prototype,"rangeDataSource",{get:function(){var i;return null===(i=this.map)||void 0===i?void 0:i.sources.getById(Dt)},enumerable:!1,configurable:!0}),o.prototype.getContainer=function(){return this.container.get(0)},o.prototype.clear=function(){this.drawingManager&&this.drawingManager.getSource().clear(),this.rangeDataSource&&this.rangeDataSource.clear()},o.prototype.dispose=function(){var l=this;this.map&&this.map.controls.remove(this),this.styler&&this.styler.dispose(),Object.keys(this).forEach(function(i){l[i]=null})},o.prototype.getDrawingManager=function(){return this.drawingManager},o.prototype.getOptions=function(){return(0,b.__assign)({},this.options)},o.prototype.onAdd=function(l,i){this.position=i&&i.position?i.position:"non-fixed",this.map=l;var c=this.options,d=new atlas.drawing.DrawingManager(l);this.drawingManager=d,l.events.add("drawingcomplete",d,this.searchArea),l.events.add("drawingchanged",d,this.copyDrawnShape);var f=d.getLayers();f.polygonLayer.setOptions({fillColor:c.fillColor,fillOpacity:c.fillOpacity});var S={strokeColor:c.strokeColor,strokeWidth:c.strokeWidth};return f.polygonOutlineLayer.setOptions(S),f.lineLayer.setOptions(S),l.sources.add(new atlas.source.DataSource(Dt,{buffer:512})),this.rangeLayers=[new atlas.layer.PolygonLayer(this.rangeDataSource,"polygonRangeLayer",f.polygonLayer.getOptions()),new atlas.layer.LineLayer(this.rangeDataSource,"lineRangeLayer",f.lineLayer.getOptions())],this.map.layers.add(this.rangeLayers,"transit"),this.createContainer(),this.styler&&this.styler.dispose(),this.styler=new Lt(this.container.get(0),l,c.style||"light"),this.container.get(0)},o.prototype.onRemove=function(){this.clear(),this.container&&(this.container.remove(),this.container=null),this.map&&(this.rangeControl&&(this.map.events.remove("showRange",this.rangeControl,this.displayRangePolygon),this.map.events.remove("rangeCalculated",this.rangeControl,this.searchArea),this.map.controls.remove(this.rangeControl),this.rangeControl=null),this.map.events.remove("resize",this.mapResized),this.drawingManager&&this.map.events.remove("drawingchanged",this.drawingManager,this.copyDrawnShape),this.rangeLayers&&(this.map.layers.remove(this.rangeLayers),this.rangeLayers=null),this.map.sources.remove(this.rangeDataSource)),this.styler.updateMap(null),this.drawingManager&&(this.drawingManager.dispose(),this.drawingManager=null),this.map=null},o.prototype.createContainer=function(){var l=this,i=this.options,c=o.css,d="selectionControl";this.container=jQuery('<div class="azure-maps-control-container" alt="'.concat(d,'" title="').concat(d,'"></div>'));var f=jQuery('<div class="sub-container '.concat(c.hidden,'" alt="selectionModes" title="selectionModes"></div>')),S=Object.keys(t);Array.isArray(i.selectionModes)&&(S=i.selectionModes),S.forEach(function(E){var U=l.buildSelectModeBtn(E);f.append(U),"routeRange"===E&&(l.routeRangeBtn=U)}),this.container.on("mouseover",function(){l.hasMouse=!0,l.container.addClass(c.inUse),f.removeClass(c.hidden)}),this.container.on("focusin",function(){l.hasFocus=!0,l.container.addClass(c.inUse),f.removeClass(c.hidden)}),this.container.on("mouseleave",function(){l.hasMouse=!1,l.hasFocus||(l.container.removeClass(c.inUse),f.addClass(c.hidden))}),this.container.on("focusout",function(E){E.relatedTarget instanceof Node&&l.container.get(0).contains(E.relatedTarget)||(l.hasFocus=!1,l.hasMouse||(l.container.removeClass(c.inUse),f.addClass(c.hidden)))});var L=this.host.getLocalizedString("Visual_AzureMapsSelectionControlMode"),D=jQuery('<button type="button" class="'.concat(c.button,' pointer-selection" alt="').concat(L,'" title="').concat(L,'"></button>'));D.on("click",function(){l.clear()}),!i||"top-right"!==this.position&&"bottom-right"!==this.position?(this.container.append(D),this.container.append(f)):(this.container.append(f),this.container.append(D));var B={isVisible:!1,markerOptions:{color:this.options.fillColor},style:i.style||"light",collapsible:!0,calculateOnMarkerMove:!1};i.routeRangeOptions&&(i.routeRangeOptions.markerOptions&&(i.routeRangeOptions.markerOptions=(0,b.__assign)((0,b.__assign)({},B.markerOptions),i.routeRangeOptions.markerOptions)),B=(0,b.__assign)((0,b.__assign)({},B),i.routeRangeOptions));var R=function(u,e){return new(function(a){function n(o,l){var i=a.call(this)||this;return i.options={markerOptions:{color:"#F2C811",secondaryColor:"#011C2C",htmlContent:'<svg xmlns="http://www.w3.org/2000/svg" style="cursor:move" width="28px" height="39px" viewBox="-1 -1 27 38"><path d="M12.25.25a12.254 12.254 0 0 0-12 12.494c0 6.444 6.488 12.109 11.059 22.564.549 1.256 1.333 1.256 1.882 0C17.762 24.853 24.25 19.186 24.25 12.744A12.254 12.254 0 0 0 12.25.25Z" style="fill:{color};stroke:{secondaryColor};stroke-width:2"/><g style="transform:scale(0.2);transform-origin: 13% 10%;"><path d="m50 38h-4v14c0 0 0 1 0 1l9 9 2-2-9-9v-13z" fill="{secondaryColor}" stroke="{secondaryColor}" stroke-width="2px"/><path d="m48 81c-15 0-28-12-28-28s12-28 28-28 28 12 28 28-12 28-28 28zm23-52 3-3c1-1 1-3-0-4-1-1-3-1-4-0l-3 3c-4-3-10-5-16-5v-4h9v-6h-24v6h9v4c-15 1-28 13-30 29s7 31 22 36 31-0 40-14 6-31-5-42z" fill="{secondaryColor}" stroke="{secondaryColor}" stroke-width="2px"/></g></svg>'},style:"light",isVisible:!0,position:"right",collapsible:!1,calculateOnMarkerMove:!0},i.markerMoveSearchDelay=600,i.arrowKeyOffset=5,i.showOptionsDelay=0,i.settings={},i.displayPropertyName="display",i.createContainer=function(){i.container=jQuery('<div aria-label="'.concat(i.resource.routeRangeDescription,'" tabindex="-1" class="azure-maps-control-container atlas-route-range-container light ').concat(i.options.position,'">')),i.container.css(i.displayPropertyName,i.options.isVisible?"":"none"),i.container.addClass("themeableElement"),i.container.on("keydown",i.onContainerKeyDown);var c=jQuery('<div class="atlas-route-range-header"/>'),d=jQuery('<div class="atlas-route-range-title">'.concat(i.resource.title,"</div>")),f=jQuery('<button aria-label="'.concat(i.resource.close,'"  class="closeIcon glyphicon pbi-glyph-close glyph-mini atlas-route-range-close-icon" alt="').concat(i.resource.closeDialog,'" title="').concat(i.resource.closeDialog,'"></button>'));f.on("click",i.onCancel),c.append(d),c.append(f),i.container.append(c);var S=jQuery('<div class="atlas-route-range-instructions">'.concat(i.resource.selectOrigin,"</div>"));i.container.append(S),i.optionSection=i.getControlOptions(),i.container.append(i.optionSection);var L=jQuery('<div class="atlas-route-range-buttons" style="display: block;"></div>'),D=jQuery("<div/>");i.container.append(L),L.append(D);var B=jQuery('<label class="atlas-route-range-outline-area"></label>'),R=jQuery('<input type="checkbox" checked="checked" alt="'.concat(i.resource.showArea,'" title="').concat(i.resource.showArea,'">'));R.on("change",function(){i.settings.showArea=R.is(":checked")}),B.append(R),B.append(i.resource.showArea),i.showArea=B;var E=i.getControlButton(i.resource.search,"pbi-fluent-button pbi-modern-button primaryBtn save atlas-route-range-searchButton");E.on("click",i.onSearch),i.searchButton=E;var U=i.getControlButton(i.resource.cancel,"pbi-fluent-button pbi-modern-button secondaryBtn cancel atlas-route-range-cancelButton");i.cancelButton=U,U.on("click",i.onCancel),i.options.collapsible||U.css(i.displayPropertyName,"none");var N=jQuery('<div style="text-align: right;"></div>');N.append(E),N.append(U),D.append([B,N]),i.map.events.add("resize",i.mapResized),i.mapResized(),i.options.isVisible&&i.setVisible(i.options.isVisible)},i.onSearch=function(){var c=atlas.math.convertDistance,d=Math.round,f=i.settings,S=new Intl.NumberFormat("en-US",{useGrouping:!1}).format,L=[];L.push("query=".concat(S(f.origin[1]),",").concat(S(f.origin[0]))),L.push("travelMode=car"),L.push("time"===f.selectionArea?"timeBudgetInSec=".concat(S(d(60*f.travelTime))):"distanceBudgetInMeters=".concat(S(d(c(f.distance,f.distanceUnits,"meters")))));var D="https://".concat(i.map.getServiceOptions().domain,"/route/range/json?api-version=1.0&").concat(L.join("&")),B=i.map.authentication.signRequest({url:D});fetch(B.url,{method:"GET",mode:"cors",headers:new Headers(B.headers)}).then(function(R){return R.json()},function(R){return i._invokeEvent("error",i.resource.error)}).then(function(R){if(R.reachableRange){var E=R.reachableRange.boundary.map(function(N){return[N.longitude,N.latitude]}),U=new atlas.data.Polygon([E]);i._invokeEvent("rangeCalculated",U),i.settings.showArea&&i._invokeEvent("showRange",U)}else i._invokeEvent("error",i.resource.error)},function(R){return i._invokeEvent("error",i.resource.error)}),i.options.collapsible&&i.setVisible(!1)},i.onCancel=function(){i.setVisible(!1);var c=i.map.getMapContainer().querySelector(".routeRange-selection");Ft.IK.focus(c)},i.onMarkerDragged=function(){i.settings.origin=i.marker.getOptions().position,[i.optionSection,i.searchButton,i.cancelButton,i.showArea].forEach(function(c){return c.css(i.displayPropertyName,"")}),i.hideOptionsTimeout=null,i.options.calculateOnMarkerMove&&i.onSearch()},i.onMarkerDargStart=function(){i.hideOptionsTimeout&&(clearTimeout(i.hideOptionsTimeout),i.hideOptionsTimeout=null)},i.onContainerKeyDown=function(c){if(c.keyCode>36&&c.keyCode<=40&&c.target.classList.contains("azure-maps-control-container")){var d=i.map.getCamera().zoom,f=atlas.math.mercatorPositionsToPixels([i.marker.getOptions().position],d)[0],S=i.arrowKeyOffset;37===c.keyCode?f[0]-=S:38===c.keyCode?f[1]-=S:39===c.keyCode?f[0]+=S:40===c.keyCode&&(f[1]+=S);var L=atlas.math.mercatorPixelsToPositions([f],d)[0];i.marker.setOptions({position:L}),i.settings.origin=L,i.options.calculateOnMarkerMove&&(i.markerKeyMoveTimeout&&clearTimeout(i.markerKeyMoveTimeout),i.markerKeyMoveTimeout=setTimeout(function(){i.onSearch()},i.markerMoveSearchDelay)),c.preventDefault(),c.stopPropagation()}},i.mapResized=function(){var c=i.map.getMapContainer().getBoundingClientRect(),d=0,f=i.options.position;(c.width<750||"center"===f&&c.height<600)&&(d=5e3),i.container.removeClass(["left","right","center","left-min","right-min","center-min"]),i.container.addClass(f),i.showOptionsDelay=d},i.host=o,l.markerOptions=(0,b.__assign)((0,b.__assign)({},l.markerOptions),i.options.markerOptions),i.options=(0,b.__assign)((0,b.__assign)({},i.options),l),i.marker=new atlas.HtmlMarker((0,b.__assign)((0,b.__assign)({},i.options.markerOptions),{draggable:!0})),i}return(0,b.__extends)(n,a),n.prototype.dispose=function(){var o=this;this.map&&this.map.controls.remove(this),this.styler&&this.styler.dispose(),Object.keys(this).forEach(function(l){o[l]=null})},n.prototype.setMarkerOptions=function(o){this.options.markerOptions=(0,b.__assign)((0,b.__assign)({},this.options.markerOptions),o),this.marker.setOptions(o)},n.prototype.setVisible=function(o){var l=this;if(this.marker&&this.map){var i=this.map.getCamera(),c=i.center;this.settings.origin&&atlas.data.BoundingBox.containsPosition(i.bounds,this.settings.origin)&&(c=this.settings.origin),this.settings.origin=c,this.marker.setOptions({position:c,visible:o}),o&&this.options.calculateOnMarkerMove&&this.onSearch()}if(this.container){var d=o?"":"none";[this.optionSection,this.searchButton,this.cancelButton,this.showArea].forEach(function(f){return f.css(l.displayPropertyName,"none")}),this.container.css(this.displayPropertyName,d),o&&(this.hideOptionsTimeout=setTimeout(function(){[l.optionSection,l.searchButton,l.cancelButton,l.showArea].forEach(function(f){return f.css(l.displayPropertyName,"")}),l.hideOptionsTimeout=null},this.showOptionsDelay))}this.options.isVisible!==o&&o&&this.container&&this.container.trigger("focus"),this.options.isVisible=o},n.prototype.getOptions=function(){return(0,b.__assign)({},this.options)},n.prototype.onAdd=function(o,l){return this.resource={routeRangeDescription:this.host.getLocalizedString("Visual_AzureMapsRouteRangeControl"),cancel:this.host.getLocalizedString("Cancel_ButtonText"),close:this.host.getLocalizedString("Close"),distance:this.host.getLocalizedString("Distance"),distanceUnits:this.host.getLocalizedString("Visual_AzureMapsRouteRangeDistanceUnits"),kilometers:this.host.getLocalizedString("Visual_AzureMapsRouteRangeKilometers"),meters:this.host.getLocalizedString("Visual_MapUnitMeters"),miles:this.host.getLocalizedString("Visual_AzureMapsRouteRangeMiles"),error:this.host.getLocalizedString("Visual_AzureMapsRouteRangeError"),selection:this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelection"),search:this.host.getLocalizedString("SearchBox_Text"),selectionArea:this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelectionArea"),selectOrigin:this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelectOrigin"),showArea:this.host.getLocalizedString("Visual_AzureMapsRouteRangeShowArea"),time:this.host.getLocalizedString("DataType_Label_Time"),title:this.host.getLocalizedString("Visual_AzureMapsRouteRangeTitle"),travelTime:this.host.getLocalizedString("Visual_AzureMapsRouteRangeTravelTime"),yards:this.host.getLocalizedString("Visual_AzureMapsRouteRangeYards"),closeDialog:this.host.getLocalizedString("CloseDialog_ModalHeader")},this.map=o,this.marker.setOptions({visible:this.options.isVisible}),o.markers.add(this.marker),o.events.add("dragstart",this.marker,this.onMarkerDargStart),o.events.add("dragend",this.marker,this.onMarkerDragged),this.createContainer(),this.styler?this.styler.updateMap(o):this.styler=new Lt(this.container.get(0),o,this.options.style||"light"),this.container.get(0)},n.prototype.onRemove=function(){this.container&&(this.container.off("keydown",this.onContainerKeyDown),this.container.remove(),this.container=null),this.styler.updateMap(null),this.map.events.remove("resize",this.mapResized),this.map.events.remove("dragstart",this.marker,this.onMarkerDargStart),this.map.events.remove("dragend",this.marker,this.onMarkerDragged),this.map.markers.remove(this.marker),this.map=null},n.prototype.getSelectColumn=function(o,l,i,c){var d=jQuery('<select alt="'.concat(o,'" title="').concat(o,'" class="').concat(i,'"/>'));return c&&d.on("change",function(){var f=d.val().toString();c(f)}),d.append(this.getSelectOptions(l)),d},n.prototype.getSelectOptions=function(o){var l=[];return _.forEach(o,function(i){l.push(jQuery('<option value="'.concat(i.value,'">').concat(i.title,"</option>")))}),l},n.prototype.getInputColumn=function(o,l,i){var c="";_.forEach(l,function(f){c=c.concat("".concat(f.name,'="').concat(f.value,'"'))});var d=jQuery("<input ".concat(c,' alt="').concat(o,'" title="').concat(o,'" class="atlas-route-range-col2">'));return i&&d.on("change",function(){i(d)}),d},n.prototype.getControlButton=function(o,l){return jQuery('<button alt="'.concat(o,'" title="').concat(o,'" class="').concat(l,'">').concat(o,"</button>"))},n.prototype.getControlOptions=function(){var o=this,l=jQuery('<div class="atlas-route-range-options"/>'),i=jQuery('<div class="atlas-route-range-row"/>');l.append(i),i.append(jQuery('<label class="atlas-route-range-option-title-first">'.concat(this.resource.selectionArea,"</label>")));var c=jQuery('<label class="atlas-route-range-option-title">'.concat(this.resource.distance,"</label>"));c.css(this.displayPropertyName,"none"),i.append(c);var d=jQuery('<label class="atlas-route-range-option-title">'.concat(this.resource.travelTime,"</label>"));i.append(d);var f=jQuery('<div class="atlas-route-range-row"/>');l.append(f);var L=1440,D=this.getInputColumn(this.resource.travelTime,[{name:"type",value:"number"},{name:"value",value:"15"},{name:"min",value:1..toString()},{name:"max",value:L.toString()}],function(X){var Z=parseInt(X.val().toString(),10);Z>L&&(Z=L),Z<1&&(Z=1),X.val(Z.toString()),o.settings.travelTime=Z}),R=1e3,E=this.getInputColumn(this.resource.distance,[{name:"type",value:"number"},{name:"value",value:"5"},{name:"min",value:1..toString()},{name:"max",value:R.toString()}],function(X){var Z=parseInt(X.val().toString(),10);Z>R&&(Z=R),Z<1&&(Z=1),X.val(Z.toString()),o.settings.distance=Z});E.css(this.displayPropertyName,"none");var N=this.getSelectColumn(this.resource.distanceUnits,[{value:"kilometers",title:this.resource.kilometers,default:!0},{value:"meters",title:this.resource.meters},{value:"miles",title:this.resource.miles},{value:"yards",title:this.resource.yards}],"atlas-route-range-col3",function(X){o.settings.distanceUnits=X.toString()});N.css(this.displayPropertyName,"none");var oe=this.getSelectColumn(this.resource.selectionArea,[{value:"time",title:this.resource.time,default:!0},{value:"distance",title:this.resource.distance}],"atlas-route-range-col1",function(X){o.settings.selectionArea=X.toString();var Z="time"===X,te=Z?"":"none";[d,D].forEach(function(fe){return fe.css(o.displayPropertyName,te)});var ne=Z?"none":"";[c,E,N].forEach(function(fe){return fe.css(o.displayPropertyName,ne)})});return f.append([oe,E,N,D]),this.settings={selectionArea:"time",travelTime:15,distance:5,distanceUnits:atlas.math.DistanceUnits.kilometers,showArea:!0},l},n}(atlas.internal.EventEmitter))(u,e)}(this.host,B);this.map.controls.add(R,{position:atlas.ControlPosition.TopRight}),this.rangeControl=R,this.map.events.add("resize",this.mapResized),this.mapResized(),this.map.events.add("rangeCalculated",this.rangeControl,this.searchArea),this.map.events.add("showRange",this.rangeControl,this.displayRangePolygon)},o.prototype.buildSelectModeBtn=function(l){var i=this,c="";switch(l){case t.circle:c=this.host.getLocalizedString("Visual_AzureMapsCircleSelection");break;case t.polygon:c=this.host.getLocalizedString("Visual_AzureMapsPolygonSelection");break;case t.rectangle:c=this.host.getLocalizedString("Visual_AzureMapsRectangleSelection");break;case t.routeRange:c=this.host.getLocalizedString("Visual_AzureMapsRouteRangeSelection");break;default:w.fF.assertFail('Unknown selection mode "'.concat(l))}var d=jQuery('<button type="button" alt="'.concat(c,'" title="').concat(c,'" class="').concat(o.css.button," ").concat(l,'-selection"></button>'));return d.on("click",function(){i.clear(),i.map.events.invoke("click",{originalEvent:{ctrlKey:!1,metaKey:!1}}),"routeRange"===l?(i.rangeControl.setVisible(!0),i.drawingManager.setOptions({mode:atlas.drawing.DrawingMode.idle})):i.drawingManager.setOptions({mode:"draw-"+l})}),d},o.css={button:"azure-maps-control-button",inUse:"in-use",hidden:"hidden-accessible-element"},o}(atlas.internal.EventEmitter);return new a(u,e)}(this.host,{style:"light",sourceIds:[h.oy,h.Ol,h.HC,h.zD]}),this.barChart3DLayer=new atlas.layer.PolygonExtrusionLayer(h.zD,h.Wv,{height:["get","size"],fillColor:["get","color"],base:0,filter:ce.J.getSelectionFilter(!0),visible:!1}),this.unselectedBarChart3DLayer=new atlas.layer.PolygonExtrusionLayer(h.zD,h.TJ,{height:["get","size"],fillColor:["get","color"],base:0,filter:ce.J.getSelectionFilter(!1),visible:!1}),this.filledMapFillLayer=new atlas.layer.PolygonLayer(h.HC,h.C_,{fillColor:["get","color"],visible:!1}),this.filledMapOutlineLayer=new atlas.layer.LineLayer(h.HC,h.z8,{visible:!1}),this.heatMapLayer=new atlas.layer.HeatMapLayer(h.Ol,h.p5,{visible:!1}),this.bubbleLayer=new atlas.layer.BubbleLayer(h.oy,h.yl,{color:["get","color"],filter:ce.J.bubbleLayerFilter,visible:!1,createIndicators:!0}),this.clusterBubbleLayer=new atlas.layer.BubbleLayer(h.oy,h.Jp,{filter:ce.J.clusteredDataFilter,visible:!1,createIndicators:!0,accessibilityIdKey:"cluster_id"}),this.clusterSymbolLayer=new atlas.layer.SymbolLayer(h.oy,h._u,{iconOptions:{image:""},textOptions:{textField:["get","point_count_abbreviated"],offset:[0,.4]},visible:!1,filter:ce.J.clusteredDataFilter}),this.pieChartSymbolLayer=new atlas.layer.SymbolLayer(h.oy,null,{filter:ce.J.pieLayerFilter,iconOptions:{image:["get","iconId"],size:1,allowOverlap:!0},visible:!1}),this.referenceLayer=this.featureSwitches.azureMapsCustomFormattingReferenceLayer?new pt(this.referenceDataSource):new atlas.layer.SimpleDataLayer(this.referenceDataSource,{enablePopups:!1,bubbleRadiusFactor:4});var n=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.heatMapLayer,this.bubbleLayer,this.pieChartSymbolLayer,this.clusterBubbleLayer,this.clusterSymbolLayer];if(this.featureSwitches.azureMapsCustomFormattingReferenceLayer&&this.referenceLayer instanceof pt?(this.mapControl.layers.add((0,b.__spreadArray)((0,b.__spreadArray)([],n,!0),this.referenceLayer.getLayers(),!0)),this.referenceLayer.onAdd(this.mapControl)):this.referenceLayer instanceof atlas.layer.SimpleDataLayer&&this.mapControl.layers.add((0,b.__spreadArray)((0,b.__spreadArray)([],n,!0),[this.referenceLayer],!1)),this.behavior){var o=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer,this.clusterBubbleLayer],l=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer],i=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer,this.pieChartSymbolLayer,this.clusterBubbleLayer],c=[this.barChart3DLayer,this.unselectedBarChart3DLayer,this.filledMapFillLayer,this.filledMapOutlineLayer,this.bubbleLayer];this.featureSwitches.azureMapsDataBoundReferenceLayer&&this.referenceLayer instanceof pt&&(o=(0,b.__spreadArray)((0,b.__spreadArray)([],o,!0),this.referenceLayer.getLayers(),!0),l=(0,b.__spreadArray)((0,b.__spreadArray)([],l,!0),this.referenceLayer.getLayers(),!0),i=(0,b.__spreadArray)((0,b.__spreadArray)([],i,!0),this.referenceLayer.getLayers(),!0),c=(0,b.__spreadArray)((0,b.__spreadArray)([],c,!0),this.referenceLayer.getLayers(),!0)),this.mapControl.events.add("mousemove",o,function(d){return a.behavior.featureMousemove(d,a.showTooltip)}),this.mapControl.events.add("mouseover",[this.bubbleLayer],function(d){return a.behavior.featureMouseover(d)}),this.mapControl.events.add("mousemove",[this.pieChartSymbolLayer],this.handleMousemoveOnPie),this.mapControl.events.add("mouseout",i,function(d){return a.behavior.featureMouseout(d,a.hideTooltip)}),this.mapControl.events.remove("click",this.behavior.mapClicked),this.mapControl.events.remove("click",this.behavior.featureClicked),this.mapControl.events.remove("contextmenu",this.behavior.featureContextClicked),this.mapControl.events.add("click",function(d){if(a.selectionControl.clear(),a.behavior.mapClicked(d),a.clickPieState){var f=a.clickPieState;a.behavior.handleSelection(f.event,[f.dataPointHovered.subDataPoints[f.idx]]),a.clickPieState=null}else a.behavior&&a.behavior.renderSelection(a.behavior.visualHasSelection())}),this.mapControl.events.add("click",l,function(d){a.selectionControl.clear(),a.behavior.featureClicked(d)}),this.mapControl.events.add("click",[this.clusterBubbleLayer],function(d){a.behavior.clusterClicked(d,a.bubbleDataSource)}),this.mapControl.events.add("contextmenu",c,this.behavior.featureContextClicked),this.mapControl.events.add("contextmenu",[this.pieChartSymbolLayer],function(d){if(a.clickPieState){var f=a.clickPieState;a.behavior.handleContextMenu(f.event,f.dataPointHovered.subDataPoints[f.idx]),a.clickPieState=null}}),this.mapControl.events.add("focusin",[this.bubbleLayer,this.clusterBubbleLayer],function(d){return a.behavior.featureFocusIn(d,a.showTooltip,a.hideTooltip,a.tooltipService.visible.bind(a.tooltipService))}),this.mapControl.events.add("focusout",[this.bubbleLayer,this.clusterBubbleLayer],function(d){return a.behavior.featureFocusOut(d,a.hideTooltip)})}this.setupDataLabelLayer(),$(".atlas-map a").attr("tabindex",0),this.registerArrowKeyStopper(),this.waitForMapA11yContainer().then(function(){var d=a;$(".accessible-indicator-collection-container").attr("tabindex","0").attr("focus-nav-mode","Hierarchy").css({width:"100%",height:"100%",position:"absolute",pointerEvents:"none"}).on("focusin",function(f){f.target===this&&"key"===$("html").attr("data-focus-source")&&d.updateCamera([])})})},u.prototype.createDataSource=function(e,t){this.mapControl.sources.add(new atlas.source.DataSource(e,t))},u.prototype.waitForMapA11yContainer=function(){var e=this;return new Promise(function(t){e.mapControl.events.add("idle",function(){t()})})},u.prototype.registerArrowKeyStopper=function(){$(".mapControl.atlas-map").on("keydown",function(e){(0,At.Wl)(e.keyCode)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault())})},u.prototype.destroy=function(){this.mapControl&&this.mapControl.events.remove("move",this.mapControlMoved)},u.prototype.setupDataLabelLayer=function(){var t=d3.select(this.mapControl.getMapContainer()).append("svg").style("position","absolute").style("pointer-events","none").style("width","100%").style("height","100%");this.labelBackgroundGraphicsContext=t.append("g").classed(Re.u9.class,!0),this.labelGraphicsContext=t.append("g").classed(Re.ZL.class,!0),this.mapControl.events.add("move",this.mapControlMoved)},u.prototype.handleKeyboardShortcuts=function(e){var t=this;this.mapControl.setUserInteraction({keyboardInteraction:!1}),e.on("keydown",function(a){39===a.keyCode&&Rt.M.isCtrlOrMeta(a)&&(t.mapControl.setUserInteraction({keyboardInteraction:!0}),e.off("keydown"))})},u.prototype.setData=function(e){this.data=e},u.prototype.updateNonDataBoundProperties=function(e,t,a){this.mapControlFactory=t;var n=e?.properties;this.updateMapControlProperties(n?.mapControls),this.updateTrafficProperties(n?.traffic),this.updateTileLayerProperties(n?.tile),this.updateReferenceLayer(n?.referenceLayer,a)},u.prototype.clearDataLabels=function(){(0,tt.gm)({dataLabels:[],labelContext:this.labelGraphicsContext,backgroundContext:this.labelBackgroundGraphicsContext,numeric:!1,formatMode:this.formatMode,onObject:this.featureSwitches.onObject})},u.prototype.drawDataLabels=function(){var e=this;if(this.data){var t=this.data.dataLabelSettings;if(!this.data.properties.bubble.showBubbleLayer||!t.show)return void this.clearDataLabels();var n=this.mapControl.getCamera(),o=this.bubbleLayer.getOptions();if(n.zoom<o.minZoom||n.zoom>o.maxZoom)return void this.clearDataLabels();var l=t.fontProperties,i=[this.viewportSize.width/2,this.viewportSize.height/2],c=n.center,d=o.radius,f=this.data.properties.bubble.strokeWidth,S="map"===o.pitchAlignment,L=(270+(S?90:0)+n.bearing)%360,D=this.shouldUseLegacyFormat(),B=this.data.dataPoints.filter(function(N){return N.location}).map(function(N){var ee,oe=N.subDataPoints[0].size,X=D?ce.J.LEGACY_evaluateRadiusExpression(d,n.zoom,oe)+f:(N.bubbleRadius||0)+f,te=e.mapControl.pixelsToPositions([[i[0]-X,i[1]]])[0],ne=atlas.math.getDistanceTo(c,te),fe=[N.location.longitude,N.location.latitude],De=e.mapControl.positionsToPixels([fe])[0],ve=De[0],ye=De[1],de=atlas.math.getDestination(fe,L,ne),pe=e.mapControl.positionsToPixels([de])[0],Ae=Math.abs(S?ye-pe[1]:ve-pe[0]),ge=N.categoryValue,J=(0,W.qk)(l,ge),ie=at.b.measureSvgTextWidth(J),le=at.b.estimateSvgTextHeight(J);return{isPreferred:!0,text:N.categoryValue,textSize:{width:ie,height:le},identity:null,key:"".concat(ge,":").concat(oe,":").concat(N.location.longitude,":").concat(N.location.latitude),fontProperties:l,outsideFill:l.color?l.color:"#ffffff",insideFill:l.color?l.color:"#ffffff",parentType:0,parentShape:{point:{x:ve,y:ye},radius:Ae,validPositions:[1,2,4,8]},hasBackground:null===(ee=t.enableBackground)||void 0===ee||ee,backgroundColor:t.backgroundColor,backgroundTransparency:t.backgroundTransparency}}),U=new ht.nu({maximumOffset:Re.wh,startingOffset:Re.ki}).layout([{labelDataPoints:B,maxNumberOfLabels:B.length}],this.viewportSize);(0,tt.gm)({dataLabels:U,labelContext:this.labelGraphicsContext,backgroundContext:this.labelBackgroundGraphicsContext,numeric:!1,formatMode:!1,onObject:!1})}},u.prototype.updateViewportSize=function(e){this.viewportSize=e},u.prototype.updateDataLayers=function(e,t){this.data.hasXY||this.data.hasCategory?this.displayData(e?e.properties:void 0,t):(this.bubbleDataSource.clear(),this.heatMapDataSource.clear(),this.filledMapDataSource.clear(),this.barChart3DDataSource.clear(),this.featureSwitches.azureMapsDataBoundReferenceLayer&&this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings())},u.prototype.updateCamera=function(e){if(this.data)if(this.data.hasXY||this.data.hasCategory){var t=this.features,a=atlas.data.BoundingBox.fromData(t);this.setCamera(a,t&&1===t.length&&!this.data.properties.filledMap.showFilledMap,e)}else this.data.properties.mapControls.cameraProperties.autoZoom&&this.mapControl.setCamera({type:this.getCurrentCameraType(),zoom:0,pitch:0,bearing:0})},u.getFirstIdentityKey=function(e){return e.getProperties().identityKeys[0]},u.prototype.setFormatMode=function(e){this.formatMode!==e&&(this.formatMode=e,this.formatMode?this.attachControlsListeners():this.removeControlsListeners())},u.prototype.displayData=function(e,t){var a=this,n=this.data.properties,o=n.commonDataOptions,l=this.shouldUseLegacyFormat(),i=n.filledMap;if(this.data.shouldRenderFilledMap){var c=ce.J.getFilledMapDisplayOptions(i,o,l,this.data.hasSize),f=c.lineOptions;this.filledMapFillLayer.setOptions(c.polygonOptions),this.filledMapOutlineLayer.setOptions(f);var S=[h.C_,h.z8],L=this.getMapControlLayerName(i.layerPosition);this.moveLayers(S,L)}else this.filledMapFillLayer.setOptions({visible:!1}),this.filledMapOutlineLayer.setOptions({visible:!1});var D=n.barChart.dataProperties,B=n.barChart.paintProperties;if(D.showBarChart){var R=ce.J.getBarChartDisplayOptions(B,o,this.data.maxDataValue,l,this.data.hasSize),U=R.unselectedOptions;this.barChart3DLayer.setOptions(R.selectedOptions),this.unselectedBarChart3DLayer.setOptions(U),S=[h.Wv,h.TJ],L=this.getMapControlLayerName(B.layerPosition),this.moveLayers(S,L),this.mapControl.events.remove("zoomend",this.zoomChanged),D.scaleThicknessOnZoom&&this.mapControl.events.add("zoomend",this.zoomChanged)}else this.barChart3DLayer.setOptions({visible:!1}),this.unselectedBarChart3DLayer.setOptions({visible:!1});var N=n.heatMap;if(N.showHeatMapLayer){var ee=ce.J.getHeatMapDisplayOptions(N,this.data.hasSize).heatMapOptions;this.heatMapLayer.setOptions(ee),S=[h.p5],L=this.getMapControlLayerName(N.layerPosition),this.moveLayers(S,L)}else this.heatMapLayer.setOptions({visible:!1});var oe=this.shouldEnableBubbleLayer(n,this.data),X=this.shouldEnablePieChartLayer(n,this.data,this.featureSwitches);X?this.behavior&&this.behavior.setPieChartBehavior(X,this.pieFactory,this.pieChartSymbolLayer,l):this.behavior&&this.behavior.setPieChartBehavior(X,void 0,void 0,l);var Z=n.bubble;if(Z.showBubbleLayer){if(X){t&&this.pieFactory.clearAll();var te=this.data.dataPoints.filter(function(J){return J.location});l&&ce.J.LEGACY_appendPieRadiusToDataPoints(te,this.data);var ne=[];oe?te.forEach(function(J){J.subDataPoints.length>1&&ne.push(J)}):ne.push.apply(ne,te),ne.forEach(function(J){return a.pieFactory.loadIcon(J,Z)}),this.clearLastHoverMarker(),this.markerIdentityKeyLastHovered=null,this.svgMarkers=ne.map(function(J){return[new atlas.HtmlMarker({htmlContent:a.pieFactory.svgContent(J,Z,!0),position:[J.location.longitude,J.location.latitude],pixelOffset:new atlas.Pixel(0,6.5),anchor:"center"}),J]}).reduce(function(J,ie,le){var Pe,_e=ie[0],xe=ie[1];return(0,b.__assign)((0,b.__assign)({},J),((Pe={})[xe.subDataPoints[0].identity.getKey()]=_e,Pe))},{});var fe=ce.J.getPieChartDisplayOptions(Z).pieChartOptions;this.pieChartSymbolLayer.setOptions(fe),S=[this.pieChartSymbolLayer.getId()],L=this.getMapControlLayerName(Z.layerPosition),this.moveLayers(S,L)}else this.pieChartSymbolLayer.setOptions({visible:!1});if(oe){var De=ce.J.getBubbleDisplayOptions(Z,o,l,this.data.hasSize,this.data.minDataValue,this.data.maxDataValue).bubbleOptions;if(this.bubbleLayer.setOptions(De),this.featureSwitches.azureMapsBubbleCluster){if(Z.clusteringEnabled){var ve=ce.J.getBubbleClusterDisplayOptions(De,Z),de=ve.clusterSymbolOptions;this.clusterBubbleLayer.setOptions(ve.clusterBubbleOptions),this.clusterSymbolLayer.setOptions(de)}else this.clusterBubbleLayer.setOptions({visible:!1}),this.clusterSymbolLayer.setOptions({visible:!1});e?.bubble.clusteringEnabled!==this.data.properties.bubble.clusteringEnabled&&this.updateDataSourceClusterOptions(h.oy,{cluster:Z.clusteringEnabled})}S=[h.yl],L=this.getMapControlLayerName(Z.layerPosition),this.moveLayers(S,L)}else this.bubbleLayer.setOptions({visible:!1})}else this.bubbleLayer.setOptions({visible:!1}),this.pieChartSymbolLayer.setOptions({visible:!1}),this.clusterBubbleLayer.setOptions({visible:!1}),this.clusterSymbolLayer.setOptions({visible:!1});if(this.featureSwitches.azureMapsDataBoundReferenceLayer){var pe=n.referenceLayer;this.referenceLayer.setOptions({unselectedTransparency:o.unselectedTransparency,bubble:pe.bubble,polygon:pe.polygon,line:pe.line})}(t||!_.isEqual(e?.barChart.dataProperties,D)||e.filledMap.showFilledMap!==i.showFilledMap||e.bubble.showBubbleLayer!==Z.showBubbleLayer||X&&!_.isEqual(e.bubble,Z)||e.heatMap.showHeatMapLayer!==N.showHeatMapLayer)&&this.updateFeatures()},u.prototype.updateDataSourceClusterOptions=function(e,t){var a=this,n=this.mapControl.sources.getById(e),o=this.mapControl.layers.getLayers().filter(Gt).filter(function(i){var c=i.getSource();return("string"==typeof c?c:c?.getId())===e});o.forEach(function(i){a.mapControl.layers.remove(i)});var l=new atlas.source.DataSource(e,(0,b.__assign)((0,b.__assign)({},n.getOptions()),t));l.setShapes(n.getShapes()),n.dispose(),this.mapControl.sources.remove(n),this.mapControl.sources.add(l),o.forEach(function(i){i.setOptions({source:l})}),this.mapControl.layers.add(o)},u.prototype.getMapControlLayerName=function(e){switch(e){case"labels":return"labels";case"transit":return"roads";default:return}},u.prototype.moveLayers=function(e,t){for(var a=0,n=e;a<n.length;a++){var o=n[a];this.mapControl.layers.getLayerById(o)&&this.mapControl.layers.move(o,t)}},u.prototype.updateFeatureDataSource=function(e,t){e&&(t?e.setShapes(t):e.clear&&e.clear())},u.prototype.shouldEnableBubbleLayer=function(e,t){return e.bubble.showBubbleLayer&&!(t.hasCategory&&t.hasSeries)},u.prototype.shouldEnablePieChartLayer=function(e,t,a){return e.bubble.showBubbleLayer&&(t.hasCategory&&t.hasSeries||!!a.azureMapsLatLongPieCharts&&t.hasDuplicatedLatLong)},u.prototype.shouldEnableHeatMap=function(e,t){return e.heatMap.showHeatMapLayer&&!t.hasSeries},u.prototype.getSinglePointZoomLevel=function(){switch(this.data&&this.data.geocodingCategory){case ae.yV.Continent:return 1;case ae.yV.CountryRegion:return 2;case ae.yV.StateOrProvince:return 3.5;case ae.yV.County:return 5;case ae.yV.City:return 8.5;case ae.yV.PostalCode:return 10;case ae.yV.Place:return 10.5;default:return 15}},u.prototype.getCurrentCameraType=function(){return this.formatMode?"jump":"fly"},u.prototype.setCamera=function(e,t,a){var n={},o=!1;t?n={zoom:this.getSinglePointZoomLevel(),center:atlas.data.BoundingBox.getCenter(e),type:this.getCurrentCameraType()}:(!_.isEmpty(e)&&e[0]>e[2]&&(e[0]=-180,e[2]=180),n={bounds:e,type:this.getCurrentCameraType()},(this.data.properties.bubble.showBubbleLayer||this.data.properties.heatMap.showHeatMapLayer)&&(o=!0)),this.data.properties.filledMap.showFilledMap&&(o=!0);var l=this.mapControl.getCanvas();o&&60<l.width&&60<l.height&&(n.padding=30);var d=this.mapControl.getCamera().pitch;d!==h.Z$&&this.data.properties.barChart.dataProperties.showBarChart?n.pitch=h.Z$:0!==d&&!this.data.properties.barChart.dataProperties.showBarChart&&(n.pitch=0);try{this.mapControl.setCamera(n)}catch(f){if(!this.isCameraBoundsError(f))throw f;a.push(new A.x8),this.host.setWarnings(a)}},u.prototype.isCameraBoundsError=function(e){return e instanceof Error&&e.message.includes("The map cannot be fit to the current canvas with the given CameraBoundsOptions.")},u.prototype.getFeatureMapping=function(){var e=this.data.dataPoints,t=this.data.properties,a=t.barChart.dataProperties,n={bubble:null,barChart3D:null,filledMap:null,heatMap:null,reference:null},o=null!=this.behavior&&this.behavior.visualHasSelection();if(this.data.shouldRenderFilledMap&&(n.filledMap=rt.l.getFilledMapMultiPolygonFeature(e,o)),a.showBarChart){var l=a.thickness,i=a.barShape;l=Math.max(l,.01),void 0===this.lastDataZoom&&(this.lastDataZoom=Math.round(this.mapControl.getCamera().zoom)),a.scaleThicknessOnZoom&&(l*=Math.pow(2,19-this.lastDataZoom)/20),n.barChart3D=rt.l.getPolygonFeature(e,l,i,o)}if(t.bubble.showBubbleLayer||t.heatMap.showHeatMapLayer){var c=this.shouldEnableBubbleLayer(t,this.data),d=this.shouldEnablePieChartLayer(t,this.data,this.featureSwitches),f=this.shouldEnableHeatMap(t,this.data),S=this.data.dataPoints.filter(function(B){return B.location}),L=this.shouldUseLegacyFormat();L&&ce.J.LEGACY_appendPieRadiusToDataPoints(S,this.data);var D=rt.l.getPointFeatures(S,o,c,d,t.bubble,L);(c||d)&&(n.bubble=D),f&&(n.heatMap=D)}return this.featureSwitches.azureMapsDataBoundReferenceLayer&&(n.reference=rt.l.getReferenceLayerFeature(this.referenceDataMatcher,o)),n},u.prototype.updateMapControlProperties=function(e){this.updateStyles(e?.styleProperties),this.updateControls(e?.controlToggles),this.updateCameraProperties(e?.cameraProperties)},u.prototype.updateStyles=function(e){var t=this.data.properties.mapControls.styleProperties,a=t.defaultStyle,n=t.showLabels,o=t.worldWrap,l=this.mapControl.getStyle(),i={};a!==e?.defaultStyle&&a!==l.style&&(i.style=a),o!==e?.worldWrap&&o!==l.renderWorldCopies&&(i.renderWorldCopies=o),n!==e?.showLabels&&n!==l.showLabels&&(i.showLabels=n),_.isEmpty(i)||this.mapControl.setStyle(i)},u.prototype.updateControls=function(e){var t=this.data.properties.mapControls.controlToggles;_.isEqual(e,t)||(this.addRemoveControl(t.showStylePicker,this.styleControl),this.addRemoveControl(t.showNavigationControls,this.zoomControl),this.addRemoveControl(t.showNavigationControls,this.pitchControl),this.addRemoveControl(t.showNavigationControls,this.compassControl),this.addRemoveControl(t.showSelectionControl,this.selectionControl),t.showSelectionControl&&this.behavior&&(this.mapControl.events.remove("dataSelected",this.selectionControl,this.behavior.dataSelected),this.mapControl.events.add("dataSelected",this.selectionControl,this.behavior.dataSelected)))},u.prototype.updateCameraProperties=function(e){var t=this.data.properties.mapControls.cameraProperties;!t.autoZoom&&!_.isEqual(e,t)&&this.mapControl.setCamera({zoom:t.zoom,bearing:t.heading,pitch:t.pitch,center:new atlas.data.Position(t.centerLongitude,t.centerLatitude)})},u.prototype.updateTrafficProperties=function(e){var t=this.data.properties.traffic;void 0===e&&(e={}),(e.showTraffic!==t.showTraffic||e.showIncidents!==t.showIncidents)&&this.updateTraffic(t);var a=t.showTraffic&&t.showTrafficControl;e.showIncidents!==t.showIncidents&&(this.addRemoveControl(!1,this.trafficControl),this.trafficControl=this.createTrafficControl(t.showIncidents)),this.addRemoveControl(a,this.trafficControl)},u.prototype.updateTraffic=function(e){this.mapControl.setTraffic(e.showTraffic?{incidents:e.showIncidents,flow:"relative"}:{incidents:!1,flow:"none"})},u.prototype.createTrafficControl=function(e){return new atlas.control.TrafficControl({incidents:e,isActive:!0,flow:"relative"})},u.prototype.updateTileLayerProperties=function(e){var t=this.data.properties.tile;if(null==e&&(e={}),!_.isEqual(e,t)&&(void 0!==this.tileLayerId&&this.mapControl.layers.getLayerById(this.tileLayerId)&&this.mapControl.layers.remove(this.tileLayerId),t.tileLayerUrl)){var a=new atlas.layer.TileLayer({tileUrl:t.tileLayerUrl,opacity:(0,P.TD)(t.transparency),tileSize:t.tileSize,isTMS:t.isTMS,minSourceZoom:t.minZoom,maxSourceZoom:t.maxZoom,bounds:[t.westBounds,t.southBounds,t.eastBounds,t.northBounds]});this.mapControl.layers.add(a,"labels"),this.tileLayerId=a.getId();var n=[a.getId()],o=this.getMapControlLayerName(t.layerPosition);this.moveLayers(n,o)}},u.prototype.updateReferenceLayer=function(e,t){var a=this.data.properties.referenceLayer;if(!_.isEqual(e,a)){if(this.featureSwitches.azureMapsMultiDataFormats){if(a){var n="file_upload"===a.datasourceType,o="url"===a.datasourceType,l=!1,i=!1,c="url"===a.datasourceType&&_.isEmpty(a.referenceLayerUrl),d="file_upload"===a.datasourceType&&a.additionalDatasource&&a.additionalDatasource.type===dt.c1;if(n){var S=!_.isEmpty(a.additionalDatasource)&&a.additionalDatasource.type===dt.BD&&null!==a.additionalDatasource.content&&null!==a.additionalDatasource.name,L=e&&e.additionalDatasource,D=L&&!_.isEqual(a.additionalDatasource.content,e.additionalDatasource.content),B=L&&!_.isEqual(a.datasourceType,e.datasourceType),R=!L||D||B;l=S&&R}else if(o){var E=!_.isEmpty(a.referenceLayerUrl);D=e&&!_.isEqual(a.referenceLayerUrl,e.referenceLayerUrl),B=e&&!_.isEqual(a.datasourceType,e.datasourceType),R=!e||D||B,i=E&&R}l?a.additionalDatasource.name.endsWith(".json")||a.additionalDatasource.name.endsWith(".geojson")||this.featureSwitches.azureMapsCsvSupport&&a.additionalDatasource.name.endsWith(".csv")?this.readSpatialData(a.additionalDatasource.content,t):a.additionalDatasource.name.endsWith(".kml")?this.readKmlData(a.additionalDatasource.content,t):a.additionalDatasource.name.endsWith(".wkt")?this.readWktData(!1,a.additionalDatasource.content,t):a.additionalDatasource.name.endsWith(".zip")?this.readShpData(!1,a.additionalDatasource.content,t):(this.referenceDataSource.clear(),this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings(),this.setAzureMapsFileReadWarning("The uploaded file format is not supported",t)):i?a.referenceLayerUrl.endsWith(".json")||a.referenceLayerUrl.endsWith(".geojson")||this.featureSwitches.azureMapsCsvSupport&&a.referenceLayerUrl.endsWith(".csv")?this.readSpatialData(a.referenceLayerUrl,t):a.referenceLayerUrl.endsWith(".kml")?this.readKmlData(a.referenceLayerUrl,t):a.referenceLayerUrl.endsWith(".wkt")?this.readWktData(!0,a.referenceLayerUrl,t):a.referenceLayerUrl.endsWith(".zip")?this.readShpData(!0,a.referenceLayerUrl,t):(this.referenceDataSource.clear(),this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings(),this.setAzureMapsFileReadWarning("The uploaded CDN file format is not supported",t)):(d||c)&&(this.referenceDataSource.clear(),this.referenceDataMatcher&&this.referenceDataMatcher.clearMappings())}}else a&&a.additionalDatasource&&a.additionalDatasource.type===dt.BD&&null!==a.additionalDatasource.content?this.readSpatialData(a.additionalDatasource.content,t):this.referenceDataSource.clear();this.featureSwitches.azureMapsCustomFormattingReferenceLayer&&this.referenceLayer.setOptions({unselectedTransparency:this.data.properties.commonDataOptions.unselectedTransparency,bubble:a.bubble,polygon:a.polygon,line:a.line,style:this.style})}},u.prototype.updateReferenceDataMappings=function(e){this.featureSwitches.azureMapsDataBoundReferenceLayer&&(this.referenceDataMatcher?(this.referenceDataMatcher.setShapes(e),this.referenceDataMatcher.createShapeDataMappings()):this.referenceDataMatcher=new Ot(e,this.data.dataPoints),this.updateFeatures())},u.prototype.setShpfileShapesToDataSource=function(e){var t=e.flatMap(function(a){return a.features});this.referenceDataSource.setShapes(t),this.updateReferenceDataMappings(t)},u.prototype.parseShpfileToGeoJSON=function(e,t,a){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,o;return(0,b.__generator)(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,e(t)];case 1:return(n=l.sent())instanceof Array||(n=[n]),[2,n];case 2:return o=l.sent(),this.setAzureMapsFileReadWarning(o+"Failed to parse shapefile",a),[3,3];case 3:return[2,[]]}})})},u.prototype.dataUri2ArrayBuffer=function(e,t){try{for(var a=e.split(",")[1],n=atob(a),o=new ArrayBuffer(n.length),l=new Uint8Array(o),i=0;i<n.length;i++)l[i]=n.charCodeAt(i);return o}catch(c){return this.setAzureMapsFileReadWarning(c+"Failed to decode the data part of the Data URI",t),null}},u.prototype.readShpData=function(e,t,a){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,o,l,i=this;return(0,b.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),w.fF.assertValue(this.mapControlFactory,"mapControlFactory"),[4,this.mapControlFactory.loadShpJs()];case 1:return n=c.sent(),o=t,e||(o=this.dataUri2ArrayBuffer(t,a)),o&&(0,b.__awaiter)(i,void 0,void 0,function(){var d;return(0,b.__generator)(this,function(f){switch(f.label){case 0:return[4,this.parseShpfileToGeoJSON(n,o,a)];case 1:return(d=f.sent())&&this.setShpfileShapesToDataSource(d),[2]}})}),[3,3];case 2:return l=c.sent(),this.setAzureMapsFileReadWarning(l+"Failed to load shpjs lib",a),[3,3];case 3:return[2]}})})},u.prototype.readKmlData=function(e,t){var a=this,n=this.mapControl;atlas.io.read(e).then(function(o){return(0,b.__awaiter)(a,void 0,void 0,function(){var l,i;return(0,b.__generator)(this,function(c){switch(c.label){case 0:return o&&o.features&&o.features.length>0?o.icons?(l=[],0===(i=Object.keys(o.icons)).length?[3,2]:(i.forEach(function(d){return l.push(n.imageSprite.add(d,o.icons[d]))}),[4,Promise.all(l)])):[3,2]:[3,3];case 1:c.sent(),c.label=2;case 2:return this.referenceDataSource.setShapes(o.features),this.updateReferenceDataMappings(o.features),[3,4];case 3:this.setAzureMapsFileReadWarning("The uploaded KML could not be converted into a SpatialDataSet object or lacks geometric data",t),c.label=4;case 4:return[2]}})})},function(o){a.setAzureMapsFileReadWarning(o+"Invalid KML format",t)})},u.prototype.readWktData=function(e,t,a){return(0,b.__awaiter)(this,void 0,void 0,function(){var n,o=this;return(0,b.__generator)(this,function(l){switch(l.label){case 0:return e?[4,fetch(t).then(function(i){return i.text()}).catch(function(i){o.setAzureMapsFileReadWarning(i+"Unable to fetch data from this URL",a)}).then(function(i){i&&(n=atlas.io.ogc.WKT.read(i))})]:[3,2];case 1:return l.sent(),[3,3];case 2:n=atlas.io.ogc.WKT.read(t),l.label=3;case 3:return n&&n.length>0?this.referenceDataSource.setShapes(n):this.setAzureMapsFileReadWarning("Invalid WKT formats",a),[2]}})})},u.prototype.readSpatialData=function(e,t){var a=this;atlas.io.read(e,{maxFeatures:3e4,maxNetworkLinks:0}).then(function(n){n&&n.features&&n.features.length>0?(a.referenceDataSource.setShapes(n.features),a.updateReferenceDataMappings(n.features)):a.setAzureMapsFileReadWarning("The uploaded file could not be converted into a SpatialDataSet object or lacks geometric data",t)},function(n){a.setAzureMapsFileReadWarning(n+"Invalid file format",t)})},u.prototype.setAzureMapsFileReadWarning=function(e,t){p.f.error(e,!0,void 0,{}),null==t&&(t=[]),t.push(new A.$B),this.host.setWarnings(t)},u.prototype.addRemoveControl=function(e,t){if(t){var a=-1!==this.mapControl.controls.getControls().indexOf(t);e&&!a&&(this.mapControl.controls.add(t,{position:atlas.ControlPosition.TopRight}),this.setControlsContainer(t)),!e&&a&&this.mapControl.controls.remove(t)}},u.prototype.setControlsContainer=function(e){var t,a,n=e;e===this.selectionControl?a=this.selectionControl.getContainer():!(null===(t=n._container)||void 0===t)&&t.classList.contains("azure-maps-control-container")&&(a=n._container),a&&(this.controlsContainer=a.parentElement,d3.select(this.controlsContainer).attr("focus-nav-mode","Hierarchy"),d3.select(this.controlsContainer).attr(I.Ez,"controls"),d3.select(this.controlsContainer).attr(I.CK,"Visual_MapControls"),d3.select(this.controlsContainer).attr(I.QZ,3),d3.select(this.controlsContainer).classed(I.cy,!0),this.formatMode&&this.attachControlsListeners())},u.prototype.attachControlsListeners=function(){!this.iscontrolsListenersAttached&&this.controlsContainer&&(this.controlsContainer.style.pointerEvents="auto",this.controlsContainer.addEventListener("mouseenter",this.disableControlsDefaultEvent,!0),this.controlsContainer.addEventListener("mouseover",this.disableControlsDefaultEvent,!0),this.controlsContainer.addEventListener("focusin",this.disableControlsDefaultEvent,!0),this.controlsContainer.addEventListener("focusout",this.disableControlsDefaultEvent,!0),this.controlsContainer.classList.add("disable-azure-maps-controls-tooltips"),this.iscontrolsListenersAttached=!0)},u.prototype.removeControlsListeners=function(){this.iscontrolsListenersAttached&&this.controlsContainer&&(this.controlsContainer.removeEventListener("mouseenter",this.disableControlsDefaultEvent,!0),this.controlsContainer.removeEventListener("mouseover",this.disableControlsDefaultEvent,!0),this.controlsContainer.removeEventListener("focusin",this.disableControlsDefaultEvent,!0),this.controlsContainer.removeEventListener("focusout",this.disableControlsDefaultEvent,!0),this.controlsContainer.classList.remove("disable-azure-maps-controls-tooltips"),this.iscontrolsListenersAttached=!1)},u}(),We=function(){function u(){}return u.enumerateMapControlProperties=function(e,t,a){var n=a.azureMapsGeocoding,o=a.azureMapsShowLabels,l={autoZoom:t.mapControls.cameraProperties.autoZoom,worldWrap:t.mapControls.styleProperties.worldWrap,showStylePicker:t.mapControls.controlToggles.showStylePicker,showNavigationControls:t.mapControls.controlToggles.showNavigationControls,defaultStyle:t.mapControls.styleProperties.defaultStyle,showSelectionControl:t.mapControls.controlToggles.showSelectionControl};t.mapControls.cameraProperties.autoZoom||(l.zoom=t.mapControls.cameraProperties.zoom,l.centerLatitude=t.mapControls.cameraProperties.centerLatitude,l.centerLongitude=t.mapControls.cameraProperties.centerLongitude,l.heading=t.mapControls.cameraProperties.heading,l.pitch=t.mapControls.cameraProperties.pitch),n&&(l.geocodingCulture=t.mapControls.geocodingCulture),o&&(l.showLabels=t.mapControls.styleProperties.showLabels),e.pushInstance({selector:null,properties:l,validValues:{centerLatitude:{numberRange:{min:h.U1,max:h.hW}},centerLongitude:{numberRange:{min:h.Nq,max:h.Yi}},zoom:{numberRange:{min:h.JX,max:h.Yd}},heading:{numberRange:{min:h.Yl,max:h.Ix}},pitch:{numberRange:{min:h.WL,max:h.a_}}},objectName:r.Do.mapControls})},u.enumerateTrafficProperties=function(e,t){e.pushInstance({selector:null,properties:{show:t.traffic.showTraffic,showIncidents:t.traffic.showIncidents,showTrafficControl:t.traffic.showTrafficControl},objectName:r.Do.traffic})},u.enumerateTileLayerProperties=function(e,t){e.pushInstance({selector:null,properties:{tileLayerUrl:t.tile.tileLayerUrl,tileSize:t.tile.tileSize,northBounds:t.tile.northBounds,southBounds:t.tile.southBounds,eastBounds:t.tile.eastBounds,westBounds:t.tile.westBounds,mapTransparency:t.tile.transparency,isTMS:t.tile.isTMS,minZoom:t.tile.minZoom,maxZoom:t.tile.maxZoom,layerPosition:t.tile.layerPosition},validValues:{tileSize:{numberRange:{min:h.nv,max:h.Co}},northBounds:{numberRange:{min:h.U1,max:h.hW}},southBounds:{numberRange:{min:h.U1,max:h.hW}},eastBounds:{numberRange:{min:h.Nq,max:h.Yi}},westBounds:{numberRange:{min:h.Nq,max:h.Yi}},minZoom:{numberRange:{min:h.JX,max:h.Yd}},maxZoom:{numberRange:{min:h.JX,max:h.Yd}}},objectName:r.Do.tileLayer})},u.enumerateFilledMapProperties=function(e,t,a,n){!a&&n&&e.pushInstance({selector:null,properties:{show:t.filledMap.showFilledMap,mapTransparency:t.filledMap.transparency,strokeColor:t.filledMap.strokeColor,strokeTransparency:t.filledMap.strokeTransparency,strokeWidth:t.filledMap.strokeWidth,minZoom:t.filledMap.minZoom,maxZoom:t.filledMap.maxZoom,layerPosition:t.filledMap.layerPosition},validValues:{minZoom:{numberRange:{min:h.JX,max:h.Yd}},maxZoom:{numberRange:{min:h.JX,max:h.Yd}},strokeWidth:{numberRange:{min:h.Bc,max:h.Qv}}},objectName:r.Do.filledMap})},u.enumerateBubbleLayerProperties=function(e,t,a,n){var o={show:t.bubble.showBubbleLayer};if(a&&!n){o.minBubbleRadius=t.bubble.minRadius,o.maxRadius=t.bubble.maxRadius;var l=t.bubble.radiusScalingMethod;o.radiusScalingMethod=l,1===l&&(o.logScale=t.bubble.logScale),2===l&&(o.x1=t.bubble.x1,o.x2=t.bubble.x2,o.y1=t.bubble.y1,o.y2=t.bubble.y2)}else o.bubbleRadius=t.bubble.radius;o.mapTransparency=t.bubble.transparency,n||(o.autoStrokeColor=t.bubble.autoStrokeColor),(!t.bubble.autoStrokeColor||n)&&(o.strokeColor=t.bubble.strokeColor),o.strokeTransparency=t.bubble.strokeTransparency,o.bubbleStrokeWidth=t.bubble.strokeWidth,n||(o.pitchAlignment=t.bubble.pitchAlignment,o.blur=t.bubble.blur,o.zoomScaleFactor=t.bubble.zoomScaleFactor),o.minZoom=t.bubble.minZoom,o.maxZoom=t.bubble.maxZoom,o.layerPosition=t.bubble.layerPosition,e.pushInstance({selector:null,properties:o,validValues:{bubbleRadius:{numberRange:{min:h.Fw,max:h.rn}},minBubbleRadius:{numberRange:{min:h.Fw,max:h.rn}},maxRadius:{numberRange:{min:h.Fw,max:h.rn}},minZoom:{numberRange:{min:h.JX,max:h.Yd}},maxZoom:{numberRange:{min:h.JX,max:h.Yd}},x1:{numberRange:{min:h.nB,max:h.NR}},x2:{numberRange:{min:h.nB,max:h.NR}},y1:{numberRange:{min:h.nB,max:h.NR}},y2:{numberRange:{min:h.nB,max:h.NR}},logScale:{numberRange:{min:h.pi,max:h.I9}},bubbleStrokeWidth:{numberRange:{min:h.Bc,max:h.Qv}},zoomScaleFactor:{numberRange:{min:h.Ng,max:h.fI}}},objectName:r.Do.bubbleLayer})},u.enumerateHeatMapProperties=function(e,t,a,n){if(!n){var o={show:t.heatMap.showHeatMapLayer};o.heatMapRadius=t.heatMap.heatMapRadius,o.heatMapRadiusUnit=t.heatMap.heatMapRadiusUnit,o.mapTransparency=t.heatMap.heatMapTransparency,o.heatMapIntensity=t.heatMap.heatMapIntensity,a&&(o.heatMapUseSize=t.heatMap.heatMapUseSize),o.heatMapColorLow=t.heatMap.heatMapColorLow,o.heatMapColorCenter=t.heatMap.heatMapColorCenter,o.heatMapColorHigh=t.heatMap.heatMapColorHigh,o.minZoom=t.heatMap.minZoom,o.maxZoom=t.heatMap.maxZoom,o.layerPosition=t.heatMap.layerPosition;var l=h.OH;"meters"===o.heatMapRadiusUnit&&(l=h.NI),e.pushInstance({selector:null,properties:o,validValues:{heatMapRadius:{numberRange:{min:h._0,max:l}},heatMapIntensity:{numberRange:{min:h.x6,max:h.Dz}},minZoom:{numberRange:{min:h.JX,max:h.Yd}},maxZoom:{numberRange:{min:h.JX,max:h.Yd}}},objectName:r.Do.heatMapLayer})}},u.enumerateBarChartProperties=function(e,t,a){if(!a){var n=t.barChart.dataProperties,o=t.barChart.paintProperties,l={show:n.showBarChart,barShape:n.barShape,barHeight:o.height,scaleHeightOnZoom:o.scaleHeightOnZoom,thickness:n.thickness,scaleThicknessOnZoom:n.scaleThicknessOnZoom};l.mapTransparency=o.transparency,l.minZoom=o.minZoom,l.maxZoom=o.maxZoom,l.layerPosition=o.layerPosition,e.pushInstance({selector:null,properties:l,validValues:{minZoom:{numberRange:{min:h.JX,max:h.Yd}},maxZoom:{numberRange:{min:h.JX,max:h.Yd}},barHeight:{numberRange:{min:h.Z3,max:h.t}},thickness:{numberRange:{min:h.z$,max:h.W5}}},objectName:r.Do.barChart})}},u.enumerateCommonDataLayerProperties=function(e,t,a,n){var o={unselectedTransparency:t.commonDataOptions.unselectedTransparency};a&&!n&&(o.showZeros=t.commonDataOptions.showZeros,o.showNegatives=t.commonDataOptions.showNegatives,o.minDataValue=t.commonDataOptions.minDataValue,o.maxDataValue=t.commonDataOptions.maxDataValue),e.pushInstance({selector:null,properties:o,objectName:r.Do.commonDataOptions})},u.enumerateReferenceLayerProperties=function(e,t,a){e.pushInstance(a?{selector:null,properties:{additionalDatasource:t.referenceLayer.additionalDatasource},objectName:r.Do.referenceLayer}:{selector:null,properties:{additionalDatasource:{}},objectName:r.Do.referenceLayer})},u}(),it=z(19076),Qe=function(){function u(){}return u.buildSasTokenWarning=function(e){switch(e){case"UndefinedToken":return new A.U9;case"RequestError":return new A.ij;default:return new A.Vt}},u.isSasTokenWarning=function(e){switch(e.code){case"UndefinedToken":case"UnrecognizedCode":case"RequestError":return!0;default:return!1}},u.logTelemetry=function(e,t){t&&t.trace(3,"AzureMapSasToken".concat(e)),p.f.assertFail("The Azure map SAS token generation failed with error ".concat(e))},u}(),wt=function(){function u(e){this.isDestroyed=!1,this.warnings=[],w.fF.assertValue(e,"options"),this.featureSwitches=e.featureSwitches||{},this.mapControlFactory=e.mapControlFactory,this.behavior=e.behavior,u.MapContainer=(0,k.CH)("mapControl"),this.rescaleMap=e.rescaleMap,this.isTouchEvent=!0===e.isTouchEvent,this.mapControlFactory&&this.ensureAzureMapScripts(this.mapControlFactory,this.featureSwitches.azureMapsUseMapControlV3)}return u.prototype.init=function(e){var t=this;if(w.fF.assertValue(e,"options"),this.element=e.element,this.style=e.style,this.host=e.host,this.featureSwitches=e.featureSwitches||{},this.behavior&&(this.interactivityService=(0,T.ub)(this.host,e.featureSwitches)),this.promiseFactory=this.host.promiseFactory(),this.host.locale&&(this.locale=this.host.locale()),this.currentViewport=e.viewport,this.currentViewport.scale=this.currentViewport.scale||1,this.landingPage=new ct(this.element),this.featureSwitches.azureMapsUseMapControlV3||(this.rescaleMap=!0),this.legend=(0,H.OG)(this.element,!1,this.interactivityService,!!this.behavior,void 0,this.style,this.host),this.blockExtendedLocations=!this.featureSwitches.azureMapsRegionalDataProcessingConsentEnabled,this.geocoder=this.host.geocoder(),this.geoTaggingAnalyzerService=(0,g.P)().create(e.host.getLocalizedString.bind(e.host)),this.pendingGeocodingRender=0,this.isDestroyed=!1,this.enableFilledMap=this.featureSwitches.azureMapsFilledMap,this.featureSwitches.onObject&&this.interactivityService){var n=this.host.getSubSelectionService()??K.D.createWithDefaultHost();this.subSelectionHelper=I.O5.createHtmlSubselectionHelper({hostElement:this.element.get(0),hostServices:this.host,renderer:n,targetSource:"format",scale:function(){return t.currentViewport.scale}}),this.interactivityService.setSubSelectionHelper(this.subSelectionHelper),this.behavior&&this.behavior.setSubSelectionHelper(this.subSelectionHelper)}this.geocodeBackend=1,this.featureSwitches.azureMapsDataResidency&&this.listenForUrlChange(),this.ensureMap(!1)},u.prototype.destroy=function(){if(this.isDestroyed=!0,this.mapControl)try{this.mapControl.dispose()}catch{}if(this.mapControlHelper)try{this.mapControlHelper.destroy()}catch{}this.pendingGeocodingRender&&(clearTimeout(this.pendingGeocodingRender),this.pendingGeocodingRender=0),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null),this.urlChangeSubscription&&this.urlChangeSubscription.unsubscribe()},u.prototype.getFormattingModel=function(){var e=this;if(this.data&&!this.isDestroyed){var t=this.data.properties,a=this.data.dataLabelSettings,n=function(d){return e.host.getLocalizedString(d)},o=function(d){return{groupBuilder:d,colorProps:r.MC.dataPoint,featureSwitches:e.featureSwitches,hostService:e.host,options:{dataView:e.dataView,style:e.style,categories:_.map(e.data.dataPoints,function(f){var S=f.subDataPoints[0];return{color:(0,P.ci)(S.color),displayName:f.categoryValue,identity:S.identity}}),fillInstanceKind:3}}},l=function(d){return{groupBuilder:d,dataPoints:(0,F.l3)(e.data.legendData),seriesColorProps:r.MC.dataPoint,localize:n,featureSwitches:e.featureSwitches}};return new s.Nq(function(){return Le.getMapSettingsCard(t,e.featureSwitches,n)},function(){return Le.getLayerSettingsCard(e.data,t,e.featureSwitches,n)},function(){return Le.getLegendCard(e.host,e.data.legendData,e.featureSwitches,e.data)},function(){return Le.getFilledMapCard(e.data,e.dataView,t,e.enableFilledMap,l,o,n)},function(){return Le.getBubbleCard(e.data,e.dataView,t,l,o,e.featureSwitches,n)},function(){return Le.getBubbleClusteringCard(e.data,e.dataView,t,e.featureSwitches,n)},function(){return Le.getCategoryLabelCard(e.data,t,a,e.style,e.featureSwitches,n)},function(){return Le.getHeatMapCard(e.data,t,n)},function(){return Le.getBarChartCard(e.data,e.dataView,t,l,o,n)},function(){return Le.getReferenceLayerCard(t,e.featureSwitches,n)},function(){return Le.getTrafficCard(t,n)},function(){return Le.getTileLayerCard(t,n)}).build()}},u.prototype.enumerateObjectInstances=function(e){if(this.dataView&&this.data){var t=new j.G,a=this.data.properties,n=this.data.hasCategory&&this.data.hasSeries;switch(e.objectName){case r.Do.mapControls:We.enumerateMapControlProperties(t,a,this.featureSwitches);break;case r.Do.traffic:We.enumerateTrafficProperties(t,a);break;case r.Do.tileLayer:We.enumerateTileLayerProperties(t,a);break;case r.Do.commonDataOptions:We.enumerateCommonDataLayerProperties(t,a,this.data.hasSize,n);break;case r.Do.filledMap:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&We.enumerateFilledMapProperties(t,a,this.data.hasSize,this.enableFilledMap);break;case r.Do.bubbleLayer:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&We.enumerateBubbleLayerProperties(t,a,this.data.hasSize,n);break;case r.Do.heatMapLayer:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&We.enumerateHeatMapProperties(t,a,this.data.hasSize,this.data.hasSeries);break;case r.Do.barChart:this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&We.enumerateBarChartProperties(t,a,n);break;case r.Do.referenceLayer:We.enumerateReferenceLayerProperties(t,a,null!==a.referenceLayer.additionalDatasource)}return t.complete()}},u.prototype.getSubSelectionStyles=function(e){var n,o,a=_.first(e).visualObjects;if(a.length>0&&!_.isEmpty(a[0])){o=(n=a[0]).selectorsByColumn;var l=n.objectName;switch(l.startsWith("bubbles")&&(l=l.split("-")[0]),l){case"legend-title":return(0,F.aJ)();case"legend-items":return(0,F.Gh)(this.host);case"bubbles":return it.E.getBubblesSubSelectionStyles(this.host,o);default:return}}},u.prototype.getSubSelectionShortcuts=function(e,t){if(this.featureSwitches.onObject&&!t&&!this.isDestroyed){var n=_.first(e).visualObjects;if(!(n.length>0)||_.isEmpty(n[0]))return;var l=n[0].objectName;switch(l.startsWith("bubbles")&&(l=l.split("-")[0]),l){case"legend-title":return(0,F.tV)(this.host);case"legend-items":return(0,F.tY)({hostServices:this.host,showSort:!1});case"controls":var i="".concat("mapControls","-").concat("controls");return[{type:0,relatedResetFormattingIds:[r.MC.mapControls.worldWrap,r.MC.mapControls.showStylePicker,r.MC.mapControls.showNavigationControls,r.MC.mapControls.showSelectionControl,r.MC.mapControls.geocodingCulture]},{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("mapControls"),groupUid:i},label:this.host.getLocalizedString("Format_Controls")}];case"map":var c="".concat("mapControls","-").concat("style");return[{type:0,relatedResetFormattingIds:[r.MC.mapControls.defaultStyle]},(0,b.__assign)((0,b.__assign)({type:3},r.MC.mapControls.defaultStyle),{label:this.host.getLocalizedString("Visual_AzureMapsDefaultStyle")}),{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat("mapControls"),groupUid:c},label:this.host.getLocalizedString("Format_Map")}];case"bubbles":return it.E.getBubblesSubSelectionShortcuts(this.host);default:return}}},u.prototype.getSubSelectables=function(e){return it.E.getAllSubSelectables(this.data,this.host,this.subSelectionHelper,e)},u.prototype.getNextSubSelectable=function(e,t){return it.E.getNextSubSelectable(this.data,this.host,this.subSelectionHelper,e,t)},u.prototype.onViewModeChanged=function(e){1===e&&this.mapControlHelper&&this.mapControlHelper.handleKeyboardShortcuts(this.element)},u.prototype.onRestoreSelection=function(e){return!!this.interactivityService&&this.interactivityService.restoreSelection(e.selection)},u.prototype.update=function(e){var t,a,n;return(0,b.__awaiter)(this,void 0,void 0,function(){var o,l,c,d,f,S,L,R=this;return(0,b.__generator)(this,function(E){switch(E.label){case 0:return w.fF.assertValue(e,"options"),this.visualUpdateOptions=e,this.visualSubSelections=e.subSelections,this.featureSwitches.onObject&&this.subSelectionHelper&&this.formatMode!==(o=e.formatMode)&&(this.formatMode=o,this.subSelectionHelper.setFormatMode(o),this.interactivityService&&this.interactivityService.setFormatMode(o),this.mapControlHelper&&(this.mapControlHelper.setFormatMode(o),this.subSelectionHelper.setCustomOutlineCallback(this.mapControlHelper.updateOutlinesFromSubSelections)),this.behavior&&this.behavior.setFormatMode(o)),this.dataView=e&&e.dataViews&&e.dataViews[0],l=this.data,this.warnings=_.filter(this.warnings,function(U){return Qe.isSasTokenWarning(U)}),w.fF.assert(function(){return R.warnings.length<=1},"There should be at most 1 SAS token warning - on update"),this.warnings.length>0&&this.host.setWarnings(this.warnings),this.dataView?(this.toggleLandingPage(!1),e.type&y.EP.Resize||(this.data=ut.converter({dataView:this.dataView,style:this.style,geoTaggingAnalyzerService:this.geoTaggingAnalyzerService,interactivityService:this.interactivityService,featureSwitches:this.featureSwitches})),!(null===(t=this.data)||void 0===t)&&t.hasInvalidGeocodingCulture&&(this.warnings.push(new A.aV),this.host.setWarnings(this.warnings)),!(null===(a=this.data)||void 0===a)&&a.hasInvalidLatLong&&(this.warnings.push(new A.zX),this.host.setWarnings(this.warnings)),c=!1,e.resizeMode||((e.type&y.EP.FormattingSubSelectionChange)!==y.EP.FormattingSubSelectionChange||!this.featureSwitches.onObject)&&(c=!0),this.updateCurrentViewport(e.viewport),c?[4,this.ensureMap(!1)]:[3,2]):[3,3];case 1:if(E.sent(),null!==(n=this.data)&&void 0!==n&&n.dataPoints){for(f=[],S=0,L=d=this.data.dataPoints;S<L.length;S++)f.push.apply(f,L[S].subDataPoints);this.interactivityService&&this.interactivityService.bind(f,this.behavior,{selectableDataPoints:f,mapControl:this.mapControl,data:this.data,dataPoints:d,hostServices:this.host},{pointSourceKey:"azure-map"})}this.isDestroyed||this.onDataChangedInternal(l),E.label=2;case 2:return this.updateMapScaleAndLegend(),this.mapControl&&u.shouldCameraBeUpdated(this.data)&&e.type!==y.EP.FormattingSubSelectionChange&&this.mapControlHelper&&this.mapControlHelper.updateCamera(this.warnings),this.updateSubSelection(e),[3,4];case 3:1===e.viewMode&&!e.visualHasData&&this.toggleLandingPage(!0),E.label=4;case 4:return[2]}})})},u.shouldCameraBeUpdated=function(e){return e.properties.mapControls.cameraProperties.autoZoom&&(e.properties.bubble.showBubbleLayer||e.properties.filledMap.showFilledMap||e.properties.barChart.dataProperties.showBarChart||e.properties.heatMap.showHeatMapLayer)},u.prototype.listenForUrlChange=function(){var e=this,t=!0;this.urlChangeSubscription=this.host.azureMapsEndpoint().getDomainUrl$().subscribe(function(){return(0,b.__awaiter)(e,void 0,void 0,function(){return(0,b.__generator)(this,function(a){switch(a.label){case 0:return t?(t=!1,[2]):[4,this.ensureMap(!0)];case 1:return a.sent(),this.isDestroyed||this.host.triggerUpdate(),[2]}})})})},u.prototype.toggleLandingPage=function(e){var t="hidden";e?this.landingPage.display():(this.landingPage.remove(),t="visible"),this.root&&(this.root[0].style.visibility=t)},u.prototype.updateCurrentViewport=function(e){e.scale=e.scale||1,(this.currentViewport.width!==e.width||this.currentViewport.height!==e.height||this.currentViewport.scale!==e.scale)&&(this.currentViewport=e)},u.prototype.updateMapScaleAndLegend=function(){this.mapControl&&this.renderLegend();var e=this.getMapViewPort();if(this.mapControlHelper&&this.mapControlHelper.updateViewportSize(e),this.mapControl&&this.mapControl.resize(e.height,e.width),this.rescaleMap){var t=this.element.children(u.MapContainer.selector);t.css("transform","scale("+1/this.currentViewport.scale+")"),t.css("transform-origin","left top")}else{var a=(window.devicePixelRatio||1)*this.currentViewport.scale;this.mapControl&&this.mapControl._getMap().setPixelRatio(a)}},u.prototype.updateSubSelection=function(e,t){if(this.mapControlHelper&&this.subSelectionHelper&&!this.isDestroyed&&this.featureSwitches.onObject&&(e.type&y.EP.Data||e.type&y.EP.FormattingSubSelectionChange||e.type&y.EP.Resize||t)){var n=e.subSelections;if(this.subSelectionHelper.updateOutlinesFromSubSelections(n,!0),this.host.alertScreenReader&&e.type&y.EP.FormattingSubSelectionChange){var l=void 0;Array.isArray(n)&&(l=n.map(function(i){return i.displayName}).join(" ")),l&&this.host.alertScreenReader(l)}}},u.prototype.getMapViewPort=function(){var e=this.currentViewport,t=this.legend.getMargins();if(this.rescaleMap){var n=this.currentViewport.scale;if(n)return{width:(e.width-t.width)*n,height:(e.height-t.height)*n}}return{width:e.width-t.width,height:e.height-t.height}},u.prototype.onDataChangedInternal=function(e){var t=!this.data.hasCategory||this.data.hasXY&&!this.data.shouldRenderFilledMap||0===this.data.dataPoints.length;if(this.mapControl){this.mapControlHelper.setData(this.data),this.mapControlHelper.updateNonDataBoundProperties(e,this.mapControlFactory,this.warnings);var a=u.haveDataFieldsBeenUpdated(e,this.data);u.shouldDataLayersBeUpdated(e,this.data,a)&&t&&this.mapControlHelper.updateDataLayers(e,a),u.shouldRedrawDataLabel(e,this.data,a)&&this.mapControlHelper.drawDataLabels()}if(!t){var l=this.data.shouldRenderFilledMap;l&&!u.isDataRepresentableByFilledMap(this.data.hasSeries,this.data.dataPoints)&&(this.warnings.push(new A.Sm),this.host.setWarnings(this.warnings)),this.geocodingContext&&this.geocodingContext.timeout&&this.geocodingContext.timeout.resolve(null),this.geocodingContext={timeout:this.promiseFactory.defer(),dataPointsRemaining:0},this.geocodingCategory=this.data.geocodingCategory;var i=l?(0,ae.o)(this.data.geocodingCategory,this.data.dataPoints.length):null;this.geocodingContext.dataPointsRemaining=this.data.dataPoints.length;for(var c=0,d=this.data.dataPoints;c<d.length;c++){var f=d[c];f.location?l&&!f.paths?this.enqueueGeoShape(this.geocodingContext,f,i):this.increaseGeocodingCountAndRedraw(this.geocodingContext):f.queryLocation?l?this.enqueueGeocodingAndGeoShape(this.geocodingContext,f,i,this.data):this.enqueueGeocoding(this.geocodingContext,f,this.data):this.geocodingFailed(this.geocodingContext)}}},u.prototype.enqueueGeocoding=function(e,t,a){var n=this,o=function(i){n.completeGeocoding(e,t,i)};this.geocoder.tryGeocodeImmediate(t.queryLocation,this.geocodeBackend,this.featureSwitches.geocoderIndexedDB,this.host.geocoderIndexedDB(),this.blockExtendedLocations).then(function(l){n.initiateGeocoding(l,o,t,e,a)},function(l){n.initiateGeocoding(void 0,o,t,e,a)})},u.prototype.enqueueGeoShape=function(e,t,a){var n=this;w.fF.assertValue(t.location,"cachedLocation"),this.geocoder.tryGeocodeBoundaryImmediate({latitude:t.location.latitude,longitude:t.location.longitude,category:this.geocodingCategory,levelOfDetail:a.level,maxGeoData:a.maxPolygons,entityType:t.location.entityType},this.geocodeBackend,this.featureSwitches.geocoderIndexedDB,this.host.geocoderIndexedDB()).then(function(o){n.initiateGeoboundary(o,t,e,a)},function(o){n.initiateGeoboundary(void 0,t,e,a)})},u.prototype.enqueueGeocodingAndGeoShape=function(e,t,a,n){var o=this,l=function(c){o.completeGeoCodeAndGeoShape(e,t,a,c)};this.geocoder.tryGeocodeImmediate(t.queryLocation,this.geocodeBackend,this.featureSwitches.geocoderIndexedDB,this.host.geocoderIndexedDB(),this.blockExtendedLocations).then(function(i){o.initiateGeocoding(i,l,t,e,n)},function(i){o.initiateGeocoding(void 0,l,t,e,n)})},u.prototype.initiateGeocoding=function(e,t,a,n,o){var l=this;e?void 0===e.latitude||void 0===e.longitude?this.geocodingFailed(n):t(e):this.getBackendCredential().then(function(i){var c=i.credentials,d=i.credentialType;l.isDestroyed||l.geocoder.geocode(a.queryLocation,l.geocodeBackend,l.featureSwitches.geocoderIndexedDB,l.host.geocoderIndexedDB(),{timeout:n.timeout.promise,credentials:c,credentialType:d,instanceId:l.host.instanceId},l.blockExtendedLocations).then(function(f){!l.isDestroyed&&n===l.geocodingContext&&((0,ae.N2)(f,!0)?(o.hasInvalidLatLong||(l.warnings.push(new A.zI),l.host.setWarnings(l.warnings)),o.hasInvalidLatLong=!0,l.geocodingFailed(n)):t(f))},function(f){return l.geocodingFailed(n)})})},u.prototype.initiateGeoboundary=function(e,t,a,n){var o=this;e?this.completeGeoShape(a,t,e):this.getBackendCredential().then(function(l){var i=l.credentials,c=l.credentialType;o.isDestroyed||o.geocoder.geocodeBoundary({latitude:t.location.latitude,longitude:t.location.longitude,category:o.geocodingCategory,levelOfDetail:n.level,maxGeoData:n.maxPolygons,entityType:t.location.entityType},o.geocodeBackend,o.featureSwitches.geocoderIndexedDB,o.host.geocoderIndexedDB(),{timeout:a.timeout.promise,credentials:i,credentialType:c}).then(function(d){!o.isDestroyed&&d&&a===o.geocodingContext&&o.completeGeoShape(a,t,d)},function(d){return o.geocodingFailed(a)})})},u.prototype.getBackendCredential=function(){var e=this;return new Promise(function(t,a){e.sasTokenCallback(t,a,null)}).then(function(t){return{credentials:t,credentialType:"sasToken"}})},u.prototype.completeGeocoding=function(e,t,a){t.location=a,this.increaseGeocodingCountAndRedraw(e)},u.prototype.completeGeoShape=function(e,t,a){if(1===this.geocodeBackend)t.geojsonPolygons=a.geoJsonPolygons;else{t.paths=[];for(var n=0,o=a.locations;n<o.length;n++){var l=o[n];l.nativeBing&&!l.geographic&&(l.geographic=(0,ae.Bo)(l.nativeBing)),l.geographic&&l.geographic.length>2&&t.paths.push(l)}}this.increaseGeocodingCountAndRedraw(e)},u.prototype.completeGeoCodeAndGeoShape=function(e,t,a,n){t.location=n,this.enqueueGeoShape(e,t,a)},u.prototype.increaseGeocodingCountAndRedraw=function(e){e===this.geocodingContext&&(--e.dataPointsRemaining,this.scheduleRedraw())},u.prototype.geocodingFailed=function(e){this.isDestroyed||e!==this.geocodingContext||--e.dataPointsRemaining<=0&&this.scheduleRedraw()},u.prototype.scheduleRedraw=function(){var e=this;this.pendingGeocodingRender&&this.geocodingContext&&this.geocodingContext.dataPointsRemaining<=0&&(clearTimeout(this.pendingGeocodingRender),this.pendingGeocodingRender=0),this.pendingGeocodingRender||(this.pendingGeocodingRender=setTimeout(function(){e.mapControlHelper.updateDataLayers(null,!0),u.shouldCameraBeUpdated(e.data)&&e.mapControlHelper.updateCamera(e.warnings),e.mapControlHelper.drawDataLabels(),e.pendingGeocodingRender=0},this.geocodingContext&&this.geocodingContext.dataPointsRemaining<=0?0:u.ScheduleRedrawInterval))},u.prototype.renderLegend=function(){var e,t=null===(e=this.data)||void 0===e?void 0:e.legendData;t&&(this.legend.setPosition(t.position),this.legend.drawLegend({data:t,parentViewport:this.currentViewport,onObject:this.featureSwitches.onObject,titleSliceUid:"".concat("legend","-").concat("title","-titleText")}),(0,O.xz)(d3.select(this.element.children(u.MapContainer.selector)[0]),this.legend))},u.haveDataFieldsBeenUpdated=function(e,t){var a=this;return!(!_.isEmpty(e)&&e.dataPoints.length===t.dataPoints.length&&e.hasCategory===t.hasCategory&&e.hasSeries===t.hasSeries)||t.dataPoints.some(function(n,o){return a.isPointUpdated(e.dataPoints[o],n)})},u.isPointUpdated=function(e,t){var a=this;return t.bubbleRadius!==e.bubbleRadius||this.isLocationUpdated(e.location,t.location)||t.subDataPoints.length!==e.subDataPoints.length||t.subDataPoints.some(function(n,o){return a.isSubPointUpdated(e.subDataPoints[o],n)})},u.isSubPointUpdated=function(e,t){return t.size!==e.size||t.color!==e.color||!t.identity.equals(e.identity)},u.isLocationUpdated=function(e,t){return!(!e&&!t||e&&t&&e.latitude===t.latitude&&e.longitude===t.longitude)},u.shouldDataLayersBeUpdated=function(e,t,a){return a||!_.isEqual(e.properties.filledMap,t.properties.filledMap)||!_.isEqual(e.properties.barChart,t.properties.barChart)||!_.isEqual(e.properties.bubble,t.properties.bubble)||!_.isEqual(e.properties.heatMap,t.properties.heatMap)||!_.isEqual(e.properties.commonDataOptions,t.properties.commonDataOptions)},u.shouldRedrawDataLabel=function(e,t,a){return a||_.isEmpty(e)||!_.isEqual(e.dataLabelSettings,t.dataLabelSettings)||!_.isEqual(e.properties.bubble,t.properties.bubble)},u.prototype.ensureAzureMapScripts=function(e,t){return this.isSdkReady||(this.isSdkReady=e.loadAzureMapScripts(t)),this.isSdkReady},u.prototype.ensureMap=function(e){var t=this;return this.ensuringAzMap&&!e||(this.mapControlFactory||(this.mapControlFactory=(0,ae.$f)(this.promiseFactory,this.host.loader())),this.ensuringAzMap=this.ensureAzureMapScripts(this.mapControlFactory,this.featureSwitches.azureMapsUseMapControlV3).then(function(n){return t.createMapControl()},function(n){return t.showMapLoadError()})),this.ensuringAzMap},u.prototype.showMapLoadError=function(){this.isDestroyed||(p.f.error("The Azure Map control could not be loaded",!0,void 0,{}),this.warnings.push(new A._7),this.host.setWarnings(this.warnings))},u.isDataRepresentableByFilledMap=function(e,t){if(!e)return!0;for(var a=function(d){var f=d.subDataPoints.map(function(L){return L.color});if(!f.every(function(L){return L===f[0]}))return{value:!1}},n=0,o=t;n<o.length;n++){var i=a(o[n]);if("object"==typeof i)return i.value}return!0},u.prototype.createMapControl=function(){var e,t=this,a=this.promiseFactory.defer();if(this.isDestroyed)return a.resolve(),a.promise;if(this.mapControlFactory.isAzureMapSupported()){this.root||(this.root=(0,m.hi)().addClass(u.MapContainer.class).css("position","absolute").css("width","100%").css("height","100%").appendTo(this.element[0])),this.root[0].setAttribute("visibility","visible");var o=(e=this.data&&this.data.properties&&this.data.properties.mapControls&&this.data.properties.mapControls.styleProperties||{}).defaultStyle,l=e.showLabels,i=e.worldWrap,d={element:this.root[0],locale:this.locale,sasTokenCallback:function(B,R,E){return t.sasTokenCallback(B,R,E)},azureMapsDataResidency:this.featureSwitches.azureMapsDataResidency,azureMapsEndpoint:this.host.azureMapsEndpoint(),isScreenshotWorkload:this.featureSwitches.azureMapsScreenshot&&this.host.isScreenshotWorkload(),progressiveLoading:this.featureSwitches.azureMapsProgressiveLoading,defaultStyle:o,showLabels:l,renderWorldCopies:i,preserveDrawingBufferForExport:this.featureSwitches.azureMapsPreserveDrawingBufferForExport},f=this.mapControlFactory.createAzureMapControl(d),S=f.getMapContainer();S.setAttribute("drag-resize-disabled","true"),d3.select(S).attr(I.Ez,"map"),d3.select(S).attr(I.CK,"Map_ToolTip"),d3.select(S).attr(I.QZ,3),d3.select(S).classed(I.cy,!0),d3.select(S).attr("focus-nav-mode","HierarchicalTabOrder"),$(".atlas-map-canvas").attr("focus-nav-mode","Browser");var L=this;f.events.add("ready",function(){L.mapControl=f,L.mapControlHelper=new Yt(f,L.host,L.featureSwitches,L.behavior,L.style,L.isTouchEvent),L.mapControlHelper.setupMap(L.element),L.root.children(".atlas-control-container").css("z-index","1"),a.resolve()}),f.events.add("movestart",function(D){return t.updateSubSelectionOnMapInteraction([])}),f.events.add("moveend",function(D){return t.updateSubSelectionOnMapInteraction(t.visualSubSelections)})}else p.f.error("The browser is not supported by the current Azure Maps control, skipping map load",!0,void 0,{browser:window.navigator.userAgent}),this.warnings.push(new A.aj),this.host.setWarnings(this.warnings),a.reject();return a.promise},u.prototype.updateSubSelectionOnMapInteraction=function(e){this.visualUpdateOptions.subSelections=e,this.updateSubSelection(this.visualUpdateOptions,!0)},u.prototype.sasTokenCallback=function(e,t,a){var n=this;this.isDestroyed||this.host.getAzureMapToken().then(function(o){if(o&&o.accountSasToken){var l=_.remove(n.warnings,function(i){return Qe.isSasTokenWarning(i)});w.fF.assert(function(){return l.length<=1},"There should be at most 1 SAS token warning - on success"),l.length>0&&n.host.setWarnings(n.warnings),e(o.accountSasToken)}else n.rejectSasTokenWithWarning(o&&o.error?o.error:"UndefinedToken",t)},function(o){n.rejectSasTokenWithWarning(o,t)})},u.prototype.rejectSasTokenWithWarning=function(e,t){var a=_.remove(this.warnings,function(o){return Qe.isSasTokenWarning(o)});w.fF.assert(function(){return a.length<=1},"There should be at most 1 SAS token warning - on failure");var n=Qe.buildSasTokenWarning(e);this.warnings.push(n),this.host.setWarnings(this.warnings),Qe.logTelemetry(e,this.host.telemetry()),t(e)},u.prototype.setMapControl=function(e){this.mapControl=e},u.prototype.setMapControlHelper=function(e){this.mapControlHelper=e},u.ScheduleRedrawInterval=3e3,u}();function Kt(){return new C.AzureMapBehavior}function Jt(u){return new wt(u)}},35824:function(Ke,me,z){z.r(me),z.d(me,{AzureMapBehavior:function(){return w}});var b=z(81337),r=z(66232),ae=z(30237),j=z(38400),I=z(64067),K=z(62458),H=z(59107),F=z(70508),O=z(72118),T=z(81293),A=z(19076),P=z(49988);function m(g){var p;return g&&!0===(null===(p=g.properties)||void 0===p?void 0:p.cluster)}function k(g){return g&&void 0!==g.getProperties}var w=function(){function g(){var p=this;this.hasSelection=!1,this.visualHasSelection=function(){return p.hasSelection},this.featureMouseover=function(s){var y;if(p.formatMode){p.mapControl.getCanvasContainer().style.cursor="pointer";var C=p.findSubDataPointByMouseEvent(s);if(C){var M=p.createVisualSubSelection(s,C,!0),x=null===(y=_.first(M.visualObjects))||void 0===y?void 0:y.objectName,V=p.subSelectionHelper.getRegionOutline(x);(!V||0===V.visibility)&&(p.subSelectionHelper.updateCustomOutlinesFromSubSelections([M],1),p.subSelectionHelper.renderOutlines())}}},this.featureMousemove=function(s,y){if(!p.formatMode){var C=p.findSubDataPointByMouseEvent(s);if(C){p.mapControl.getCanvasContainer().style.cursor="pointer";var M=s.originalEvent;C?.tooltipInfo&&y([M.x,M.y],C)}}},this.featureMouseout=function(s,y){if(p.mapControl.getCanvasContainer().style.cursor="grab",p.formatMode){var C=s.originalEvent;(0,r.n)(C),C.preventDefault(),p.subSelectionHelper.clearHoveredOutline()}else y()},this.mapClicked=function(s){H.M.isCtrlOrMeta(s.originalEvent)||p.selectionHandler.handleClearSelection()},this.featureClicked=function(s){if(s){var y=_.filter(s.shapes,k),C=T.l.findDataPointsByShapes(p.selectableDataPoints,y);if(p.formatMode){var M=s.originalEvent;(0,r.n)(M),M.preventDefault();var x=_.last(C);if(x){var V=T.l.findFirstDataPointByKey(p.selectableDataPoints,x.identity.getKey()),W=p.createVisualSubSelection(s,V,!1);p.subSelectionHelper.subSelect(W)}}else p.handleSelection(s.originalEvent,C)}},this.featureContextClicked=function(s){if(s){var y=s.originalEvent;if(!H.M.isCtrlOrMeta(y)){var C=_.find(s.shapes,k);if(C){var M=T.l.getFirstIdentityKey(C),x=T.l.findFirstDataPointByKey(p.selectableDataPoints,M);if((0,r.n)(y),y.preventDefault(),p.formatMode){if(x){for(var V=void 0,W=x.identity.getKey(),G=0,Y=p.data.dataPoints;G<Y.length&&!(V=T.l.findFirstDataPointByKey(Y[G].subDataPoints,W));G++);var re=p.createVisualSubSelection(s,V,!0);p.subSelectionHelper.subSelect(re)}}else x&&p.selectionHandler.handleContextMenu(x,{x:y.clientX,y:y.clientY})}}}},this.handleContextMenu=function(s,y){!s||H.M.isCtrlOrMeta(s)||((0,r.n)(s),s.preventDefault(),p.formatMode)||p.selectionHandler.handleContextMenu(y,{x:s.clientX,y:s.clientY})},this.createFocusInCallback=function(s,y,C,M,x){return function(V){H.M.isCtrlOrMeta(V)&&72===V.keyCode&&(x()?M():C(s,y),V.preventDefault())}},this.featureFocusIn=function(s,y,C,M){var x;if(!p.formatMode&&s.shape&&(p.setFeatureFocusedState(s,!0),(x=m(s.shape)?p.findSubDataPointByClusterFeature(s.shape):p.findSubDataPointByShape(s.shape))&&x.tooltipInfo)){var V=p.mapControl.getCanvasContainer().getBoundingClientRect(),Y=s.pixel;p.focusInCallback=p.createFocusInCallback([Y[0]+V.x,Y[1]+V.y],x,y,C,M),s.target.addEventListener("keydown",p.focusInCallback),s.target.setAttribute("aria-label",m(s.shape)?x.tooltipInfo[0].header:(0,j.X)(x.tooltipInfo))}},this.featureFocusOut=function(s,y){p.formatMode||(p.setFeatureFocusedState(s,!1),s.target.removeEventListener("keydown",p.focusInCallback),y())},this.setFeatureFocusedState=function(s,y){var C=s.shape,M=m(C)?C.id.toString():C.getId().toString();p.mapControl.sources.setFeatureState(M,F.oy,{focused:y})},this.createVisualSubSelection=function(s,y,C){var M=s.originalEvent,x=_.find(s.shapes,function(q){return q&&q.getProperties});K.fF.assertValue(x,"azureMap ".concat(s.type,": expected to find the shape"));var re,V=A.E.getSubSelectableRegionFromLayerId(s.layerId),W=x.getProperties().seriesIndex,Y="".concat(V)+(void 0===W?"":"-series-".concat(W)),Q={x:M.clientX,y:M.clientY};return p.data.hasSeries&&y&&!_.isUndefined(y.seriesIndex)&&(re=p.data.series[y.seriesIndex]),A.E.createAzureMapSubSelection(Y,C,p.hostServices,Q,re)},this.dataSelected=function(s){if(!p.formatMode){var y=T.l.findDataPointsByShapes(p.selectableDataPoints,s);p.handleSelection(void 0,y,1)}},this.handleSelection=function(s,y,C){void 0!==C?(0,ae.tn)(y,C,p.selectionHandler):(0,ae.ct)(s,y,p.selectionHandler)},this.clusterClicked=function(s,y){var C=_.find(s.shapes,m);C&&y.getClusterExpansionZoom(C.properties.cluster_id).then(function(M){p.mapControl.setCamera({center:C.geometry.coordinates,zoom:M,type:"ease",duration:200})}).catch(function(M){})},this.updateDataSourceWithSelection=function(){return(0,b.__awaiter)(p,void 0,void 0,function(){var s,y,C,M,x,V,W,G,Y,Q,q=this;return(0,b.__generator)(this,function(ue){if((this.bubbleDataSource||this.heatMapDataSource||this.filledMapDataSource||this.barChart3DDataSource||this.referenceDataSource)&&(s=(0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)((0,b.__spreadArray)([],this.bubbleDataSource.getShapes(),!0),this.heatMapDataSource.getShapes(),!0),this.filledMapDataSource.getShapes(),!0),this.barChart3DDataSource.getShapes(),!0),this.referenceDataSource.getShapes(),!0),this.hasSelection?(y=_.filter(this.selectableDataPoints,function(v){return v.selected}),C=_.map(y,function(v){return v.identity.getKey()}),s.forEach(function(v){var he=v.getProperties(),h=C.indexOf(he.identityKeys[0])>-1;v.addProperty("selected",h)})):s.forEach(function(v){v.addProperty("selected",!0)}),this.showPieChart)){for(M=[],x=[],V=0,W=s.filter(function(v){return v&&v.getProperties().showPie});V<W.length;V++)Y=(G=W[V]).getId(),Q=G.getProperties(),M.push(this.loadIcon(Y,Q.identityKeys[0],x));Promise.allSettled(M).then(function(){q.composeAndUpdatePieExpression(x)})}return[2]})})},this.loadIcon=function(s,y,C){return(0,b.__awaiter)(p,void 0,void 0,function(){var M,x,V,W;return(0,b.__generator)(this,function(G){switch(G.label){case 0:if(M=[],x=_.find(this.dataPoints,function(Y){return Y?.location&&Y?.subDataPoints.length>0&&Y.subDataPoints[0].identity.getKey()===y}),this.shouldUseLegacyFormat&&O.J.LEGACY_appendPieRadiusToDataPoints([x],this.data),!x)return[3,2];for(V=0;V<x.subDataPoints.length;V++)this.hasSelection?x.subDataPoints[V].selected&&M.push(V):M.push(V);return W=P.t.hash(x,this.data.properties.bubble,M),[4,this.pieChartFactory.loadIcon(x,this.data.properties.bubble,M,W)];case 1:G.sent(),M.length>0&&C.push({dataPoint:x,hash:W,markerShapeId:s,selectedIndexes:M}),G.label=2;case 2:return[2]}})})},this.composeAndUpdatePieExpression=function(s){for(var y=["literal",[]],C=[],M=0,x=s;M<x.length;M++){var V=x[M],W=V.dataPoint,G=V.hash,Y=V.markerShapeId,Q=V.selectedIndexes;y[1].push(Y),W.subDataPoints.length!==Q.length&&C.push(["==",["get","_azureMapsShapeId"],Y],"".concat(G))}var re=C.length>0?(0,b.__spreadArray)((0,b.__spreadArray)(["case"],C,!0),[["get","iconId"]],!1):["get","iconId"],q=["case",["in",["get","_azureMapsShapeId"],y],(0,I.TD)(p.data.properties.bubble.transparency),(0,I.TD)(p.data.properties.commonDataOptions.unselectedTransparency)];p.pieChartSymbolLayer.setOptions({iconOptions:{image:re,opacity:q}})}}return Object.defineProperty(g.prototype,"bubbleDataSource",{get:function(){return this.mapControl.sources.getById(F.oy)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"heatMapDataSource",{get:function(){return this.mapControl.sources.getById(F.Ol)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"filledMapDataSource",{get:function(){return this.mapControl.sources.getById(F.HC)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"barChart3DDataSource",{get:function(){return this.mapControl.sources.getById(F.zD)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"referenceDataSource",{get:function(){return this.mapControl.sources.getById(F.uL)},enumerable:!1,configurable:!0}),g.prototype.bindEvents=function(p,s,y){this.mapControl=p.mapControl,this.selectableDataPoints=p.selectableDataPoints,this.selectionHandler=s,this.data=p.data,this.dataPoints=p.dataPoints,this.hostServices=p.hostServices},g.prototype.setFormatMode=function(p){this.formatMode=p},g.prototype.setSubSelectionHelper=function(p){this.subSelectionHelper=p},g.prototype.renderSelection=function(p){this.hasSelection=p,this.updateDataSourceWithSelection()},g.prototype.setPieChartBehavior=function(p,s,y,C){void 0===C&&(C=!0),this.showPieChart=p,this.pieChartFactory=s,this.pieChartSymbolLayer=y,this.shouldUseLegacyFormat=C},g.prototype.findSubDataPointByMouseEvent=function(p){if(p){var s=_.find(p.shapes,m);if(s)return this.findSubDataPointByClusterFeature(s);var y=_.find(p.shapes,k);if(y)return this.findSubDataPointByShape(y)}},g.prototype.findSubDataPointByShape=function(p){for(var s=T.l.getFirstIdentityKey(p),y=void 0,C=0,M=this.data.dataPoints;C<M.length&&!(y=M[C].subDataPoints.find(function(V){return V.identity.getKey()===s}));C++);return y},g.prototype.findSubDataPointByClusterFeature=function(p){var s=p.properties,y={header:this.hostServices.getLocalizedString("Visual_AzureMapsCluster_TooltipInfo",s.point_count),displayName:""};return{size:s.size,color:"",selected:!1,identity:null,tooltipInfo:[y]}},g}()},70508:function(Ke,me,z){z.d(me,{Bc:function(){return m},C_:function(){return Le},Co:function(){return ue},Dy:function(){return s},Dz:function(){return q},Fw:function(){return O},HC:function(){return Ct},I9:function(){return P},Ix:function(){return j},JX:function(){return I},Jp:function(){return tt},NI:function(){return Q},NR:function(){return g},Ng:function(){return F},Nq:function(){return h},OH:function(){return Y},Ol:function(){return be},Qv:function(){return k},TJ:function(){return ze},U1:function(){return Be},W5:function(){return V},W8:function(){return at},WL:function(){return b},Wv:function(){return se},Y4:function(){return Fe},Yd:function(){return K},Yi:function(){return Re},Yl:function(){return ae},Z$:function(){return p},Z3:function(){return C},_0:function(){return G},_O:function(){return y},_u:function(){return ht},a_:function(){return r},c8:function(){return W},fI:function(){return H},fN:function(){return ke},fQ:function(){return he},hW:function(){return Ve},nB:function(){return w},nv:function(){return v},oy:function(){return Ne},p5:function(){return He},pi:function(){return A},rn:function(){return T},t:function(){return M},uL:function(){return St},x6:function(){return re},yl:function(){return ut},z$:function(){return x},z8:function(){return ct},zD:function(){return Mt}});var b=0,r=60,ae=0,j=360,I=0,K=22,H=10,F=1,O=1,T=50,A=1,P=10,m=0,k=20,w=0,g=1,p=60,s="backgroundDark",y=.5,C=0,M=5,x=0,V=5,W="pixels",G=1,Y=200,Q=4e6,re=0,q=5,ue=5e3,v=128,he=100,ke=0,h=-180,Re=180,Be=-90,Ve=90,Fe=Math.pow(2,53)-1,Ne="bubbleDataSource",be="heatMapDataSource",Ct="filledMapDataSource",Mt="barChart3DDataSource",St="referenceDataSource",ut="bubbleLayer",He="heatMapLayer",se="barChart3DLayer",ze="unselectedBarChart3DLayer",Le="filledMapFillLayer",ct="filledMapOutlineLayer",tt="clusterBubbleLayer",ht="clusterSymbolLayer",at={bubbleStrokeOpacity:1,bubbleStrokeWidth:2}},72118:function(Ke,me,z){z.d(me,{J:function(){return w}});var b=z(81337),r=z(64067),ae=function(){function g(p,s,y,C){this.epsilon=1e-5,this.cx1=0,this.cx2=0,this.cx3=0,this.cy1=0,this.cy2=0,this.cy3=0,this.computeCoefficient(p,s,y,C)}return g.prototype.computeCoefficient=function(p,s,y,C){this.cx3=1+3*p-3*y,this.cx2=3*y-6*p,this.cx1=3*p,this.cy3=1+3*s-3*C,this.cy2=3*C-6*s,this.cy1=3*s},g.prototype.getXByT=function(p){return this.cx3*Math.pow(p,3)+this.cx2*Math.pow(p,2)+this.cx1*p},g.prototype.getYByT=function(p){return this.cy3*Math.pow(p,3)+this.cy2*Math.pow(p,2)+this.cy1*p},g.prototype.estimateTByX=function(p,s){void 0===s&&(s=.01);for(var y=0,C=1,M=p;y<C;){var x=this.getXByT(M);if(Math.abs(p-x)<=s)return M;x<p?y=M:C=M,M=.5*(y+C)}return p},g.prototype.scale=function(p){if(p<this.epsilon)return 0;if(1-p<this.epsilon)return 1;var s=this.estimateTByX(p);return this.getYByT(s)},g}(),j=z(1521),I=z(70508),K=function(g){return g.bubble="showBubble",g.pie="showPie",g.barChart3D="showBarChart3D",g.filledMap="showFilledMap",g.heatMap="showHeatMap",g}({}),m=512/40075e3,k=m*Math.pow(2,24),w=function(){function g(){}var p;return g.getBubbleDisplayOptions=function(s,y,C,M,x,V){var W=C?g.LEGACY_getRadiusExpression(s,y,M,x,V):g.getRadiusExpression(s.radius,M,x,V),G=["get","color"],Y=g.getStrokeColor(s.autoStrokeColor,s.strokeColor,G),Q=["case",g.getSelectionFilter(!0),(0,r.TD)(s.transparency),(0,r.TD)(y.unselectedTransparency)],q=s.strokeWidth<I.W8.bubbleStrokeWidth?["case",["boolean",["feature-state","focused"],!1],I.W8.bubbleStrokeWidth,s.strokeWidth]:s.strokeWidth,ue=["case",["boolean",["feature-state","focused"],!1],I.W8.bubbleStrokeOpacity,g.getSelectionFilter(!0),(0,r.TD)(s.strokeTransparency),(0,r.TD)(y.unselectedTransparency)],v=C?g.LEGACY_getBubbleFilter(!0,M?y:void 0):g.bubbleLayerFilter;return{bubbleOptions:{radius:W,strokeColor:Y,strokeWidth:q,strokeOpacity:ue,blur:s.blur/100,pitchAlignment:s.pitchAlignment,minZoom:s.minZoom,maxZoom:s.maxZoom,color:G,filter:v,opacity:Q,visible:!0}}},g.getBubbleClusterDisplayOptions=function(s,y){var M=y.clusteredBubbleStrokeWidth<I.W8.bubbleStrokeWidth?["case",["boolean",["feature-state","focused"],!1],I.W8.bubbleStrokeWidth,y.clusteredBubbleStrokeWidth]:y.clusteredBubbleStrokeWidth;return{clusterBubbleOptions:(0,b.__assign)((0,b.__assign)({},s),{radius:y.clusteredBubbleRadius,color:y.clusteredBubbleFillColor,strokeColor:y.clusteredBubbleStrokeColor,strokeWidth:M,filter:g.clusteredDataFilter}),clusterSymbolOptions:{visible:!0,textOptions:{color:y.clusteredBubbleFontColor,size:y.clusteredBubbleFontSize}}}},g.getPieChartDisplayOptions=function(s){return{pieChartOptions:{minZoom:s.minZoom,maxZoom:s.maxZoom,iconOptions:{pitchAlignment:"viewport",anchor:"center"},visible:!0}}},g.getHeatMapDisplayOptions=function(s,y){var C=["interpolate",["linear"],["heatmap-density"],0,(0,j.cD)(s.heatMapColorLow,0),.1,s.heatMapColorLow,.5,s.heatMapColorCenter,1,s.heatMapColorHigh],M="pixels"===s.heatMapRadiusUnit?s.heatMapRadius:["interpolate",["exponential",2],["zoom"],0,["*",s.heatMapRadius,m],24,["*",s.heatMapRadius,k]],x=y&&s.heatMapUseSize?["get","size"]:1;return{heatMapOptions:{color:C,intensity:s.heatMapIntensity,opacity:(0,r.TD)(s.heatMapTransparency),radius:M,weight:x,minZoom:s.minZoom,maxZoom:s.maxZoom,visible:!0}}},g.getBarChartDisplayOptions=function(s,y,C,M,x){var W=s.height/C,G=["get","size"],Y=["*",G,100*W];s.scaleHeightOnZoom&&(Y=["interpolate",["exponential",.5],["zoom"],0,["*",G,2e6*W],22,["*",G,20*W]]);var re={minZoom:s.minZoom,maxZoom:s.maxZoom,fillColor:["get","color"],visible:!0};return{selectedOptions:(0,b.__assign)((0,b.__assign)({},re),{height:Y,fillOpacity:(0,r.TD)(s.transparency),filter:M?g.LEGACY_getBarChart3DFilter(!0,x?y:void 0):g.getSelectionFilter(!0)}),unselectedOptions:(0,b.__assign)((0,b.__assign)({},re),{height:0,fillOpacity:(0,r.TD)(y.unselectedTransparency),filter:M?g.LEGACY_getBarChart3DFilter(!1,x?y:void 0):g.getSelectionFilter(!1)})}},g.getFilledMapDisplayOptions=function(s,y,C,M){var V=["case",g.getSelectionFilter(!0),(0,r.TD)(s.transparency),(0,r.TD)(y.unselectedTransparency)],W=["case",g.getSelectionFilter(!0),(0,r.TD)(s.strokeTransparency),(0,r.TD)(y.unselectedTransparency)],G=C?g.LEGACY_getFilledMapFilter(!0,M?y:void 0):void 0;return{polygonOptions:{minZoom:s.minZoom,maxZoom:s.maxZoom,fillColor:["get","color"],fillOpacity:V,filter:G,visible:!0},lineOptions:{minZoom:s.minZoom,maxZoom:s.maxZoom,strokeColor:s.strokeColor,strokeOpacity:W,strokeWidth:s.strokeWidth,filter:G,visible:!0}}},g.getSelectionFilter=function(s){return s?["get","selected"]:["!",["get","selected"]]},g.LEGACY_getBubbleFilter=function(s,y){var C=this.LEGACY_getLayerFilter(s,y)||["all"];return C.push(["==",["get","showBubble"],!0]),C.push(["!",this.clusteredDataFilter]),C},g.LEGACY_getBarChart3DFilter=function(s,y){return this.LEGACY_getLayerFilter(s,y,!0)},g.LEGACY_getFilledMapFilter=function(s,y){return this.LEGACY_getLayerFilter(s,y)},g.LEGACY_getLayerFilter=function(s,y,C){void 0===C&&(C=!1);var M=[];if(C&&M.push(this.getSelectionFilter(s)),_.isEmpty(y)||(y.showZeros||M.push(["!=",["get","size"],0]),y.showNegatives||M.push(["!",["<",["get","size"],0]])),0!==M.length)return 1===M.length?M[0]:(0,b.__spreadArray)(["all"],M,!0)},g.getRadiusExpression=function(s,y,C,M){return y&&C!==M?["get","size"]:s},g.LEGACY_getRadiusExpression=function(s,y,C,M,x){var G,V=C?s.minRadius:s.radius,W=s.zoomScaleFactor;if(C){var Q=s.radiusScalingMethod,v=["linear"];if(1===Q?v=["exponential",s.logScale]:2===Q&&(v=["cubic-bezier",s.x1,s.y1,s.x2,s.y2]),M===x)G=["interpolate",v,["zoom"],12,V,20,V*W];else{var Ve=["get","size"];y.showNegatives&&(Ve=["abs",Ve]),G=["interpolate",v,Ve,M,V,x,s.maxRadius],1!==W&&(G=["let","radiusSize",G,["interpolate",["linear"],["zoom"],12,["var","radiusSize"],20,["*",W,["var","radiusSize"]]]])}}else G=1!==W?["interpolate",["linear"],["zoom"],12,V,20,V*W]:V;return G},g.LEGACY_evaluateRadiusExpression=function(s,y,C){if("number"==typeof s)return s;if(Array.isArray(s))if("interpolate"===s[0]){var M=s[1],V=s[3],W=s[4],G=s[5],Y=s[6],Q=_.isEqual(s[2],["zoom"]);Q&&(!_.isFinite(y)||y<0)&&(y=1);var ue=(_.clamp(Q?y:C,V,G)-V)/(G-V);if("linear"===M[0])return ue*(Y-W)+W;if("exponential"===M[0]){var v=M[1];return(1===v?ue:(Math.pow(v,ue)-1)/(v-1))*(Y-W)+W}if("cubic-bezier"===M[0])return new ae(M[1],M[2],M[3],M[4]).scale(ue)*(Y-W)+W}else if("let"===s[0]&&"radiusSize"===s[1]){var Fe=this.LEGACY_evaluateRadiusExpression(s[2],y,C),Ne=_.cloneDeep(s[3]);return Ne[4]=Fe,Ne[6]=Fe*Ne[6][1],this.LEGACY_evaluateRadiusExpression(Ne,y,C)}return 0},g.LEGACY_appendPieRadiusToDataPoints=function(s,y){var C=g.LEGACY_getRadiusExpression(y.properties.bubble,y.properties.commonDataOptions,y.hasSize,y.minDataValue,y.maxDataValue);s.forEach(function(M){var x=M.subDataPoints.reduce(function(W,G){return W+G.size},0),V=g.LEGACY_evaluateRadiusExpression(C,void 0,x);M.bubbleRadius=V})},p=g,g.getStrokeColor=function(s,y,C){var M=y;if(s){var x=["var","fillColor"];M=["let","fillColor",["to-rgba",["to-color",C]],["case",[">",["sqrt",["+",["*",.299,["^",["at",0,x],2]],["*",.587,["^",["at",1,x],2]],["*",.114,["^",["at",2,x],2]]]],127],["to-color",["rgb",["*",.5,["at",0,x]],["*",.5,["at",1,x]],["*",.5,["at",2,x]]]],["to-color",["rgb",["max",127,["min",255,["*",1.5,["at",0,x]]]],["max",127,["min",255,["*",1.5,["at",1,x]]]],["max",127,["min",255,["*",1.5,["at",2,x]]]]]]]]}return M},g.clusteredDataFilter=["has","point_count"],g.bubbleLayerFilter=["all",["==",["get",K.bubble],!0],["!",p.clusteredDataFilter]],g.pieLayerFilter=["all",["==",["get",K.pie],!0],["!",p.clusteredDataFilter]],g}()},81293:function(Ke,me,z){z.d(me,{l:function(){return F}});var b=z(81337),r=z(2379),ae=z(49988),j=.0174532925,I=1e-4,F=function(){function O(){}return O.getPointFeatures=function(T,A,P,m,k,w){var g=this,p=P&&m;return T.filter(function(s){return s.location&&s.subDataPoints&&s.subDataPoints.length>0}).map(function(s){return new atlas.data.Feature(new atlas.data.Point(new atlas.data.Position(s.location.longitude,s.location.latitude)),(0,b.__assign)((0,b.__assign)({coordinates:[s.location.longitude,s.location.latitude],size:w?s.subDataPoints[0].size||0:s.bubbleRadius||0,color:s.subDataPoints[0].color,identityKeys:s.subDataPoints.map(function(y){return y.identity.getKey()}),selected:!A||s.subDataPoints[0].selected},(P||m)&&{showBubble:g.bubbleVisibility(s,p,P),showPie:g.pieVisibility(s,p,m)}),{iconId:m?ae.t.hash(s,k):void 0,seriesIndex:s.subDataPoints[0].seriesIndex}))})},O.bubbleVisibility=function(T,A,P){return!!(!A&&P||A&&1===T.subDataPoints.length)},O.pieVisibility=function(T,A,P){return!!(!A&&P||A&&T.subDataPoints.length>1)},O.getReferenceLayerFeature=function(T,A){if(!T)return[];var P=T.getShapes(),m=[];return P.forEach(function(k){var w=T.getDataPointFromShape(k);m.push(w?new atlas.data.Feature(k.geometry,(0,b.__assign)({coordinates:w.location?[w.location.longitude,w.location.latitude]:[],identityKeys:w.subDataPoints.map(function(g){var p;return null===(p=g.identity)||void 0===p?void 0:p.getKey()}),selected:!A||w.subDataPoints[0].selected},k.properties)):new atlas.data.Feature(k.geometry,(0,b.__assign)({identityKeys:[]},k.properties)))}),m},O.getPolygonFeature=function(T,A,P,m){var k=this;return T.filter(function(w){return w.location}).map(function(w){return new atlas.data.Feature(1===P?k.getCirclePolygon(w,A):k.getSquarePolygon(w,A),{coordinates:[w.location.longitude,w.location.latitude],size:w.subDataPoints[0].size||0,color:w.subDataPoints[0].color,identityKeys:w.subDataPoints.map(function(g){return g.identity.getKey()}),selected:!m||w.subDataPoints[0].selected})})},O.getFilledMapMultiPolygonFeature=function(T,A){return T.filter(function(P){return P.geojsonPolygons}).map(function(P){return new atlas.data.Feature(new atlas.data.MultiPolygon(r.b.combineMultiPolygonCoordinatesAtAntimeridian(P.location,P.geojsonPolygons.map(function(m){return m.coordinates}))),{coordinates:[P.location.longitude,P.location.latitude],size:P.subDataPoints[0].size||0,color:P.subDataPoints[0].color,identityKeys:P.subDataPoints.map(function(m){return m.identity.getKey()}),selected:!A||P.subDataPoints[0].selected})})},O.getCirclePolygon=function(T,A){for(var P=I*A,m=Math.cos(T.location.latitude*j),w=[],g=0;g<18;g++)w.push([T.location.longitude+P*Math.cos(20*g*j),T.location.latitude+P*m*Math.sin(20*g*j)]);return w.push([T.location.longitude+P,T.location.latitude]),new atlas.data.Polygon([w])},O.getSquarePolygon=function(T,A){var P=I*A,m=P*Math.cos(T.location.latitude*j);return new atlas.data.Polygon([[[T.location.longitude+P,T.location.latitude+m],[T.location.longitude-P,T.location.latitude+m],[T.location.longitude-P,T.location.latitude-m],[T.location.longitude+P,T.location.latitude-m],[T.location.longitude+P,T.location.latitude+m]]])},O.getIdentityKeys=function(T){return T.getProperties().identityKeys},O.getFirstIdentityKey=function(T){return this.getIdentityKeys(T)[0]},O.findFirstDataPointByKey=function(T,A){return T.find(function(P){return A===P.identity.getKey()})},O.findDataPointsByKeys=function(T,A){var P=[];if(A.length===T.length)return T;for(var m=0,k=T;m<k.length;m++){var w=k[m],g=w.identity.getKey();if(A.indexOf(g)>=0&&(P.push(w),P.length===A.length))break}return P},O.findDataPointsByShapes=function(T,A){for(var P=[],m=0,k=A;m<k.length;m++)P.push.apply(P,this.getIdentityKeys(k[m]));return this.findDataPointsByKeys(T,P)},O}()},19076:function(Ke,me,z){z.d(me,{E:function(){return H}});var b=z(81337),r=z(60637),ae=z(32379),j=z(96915),I=z(70508),K={dataMap:{allData:[(0,j.Ue)(1)]}},H=function(){function F(){}return F.getSubSelectableRegionFromLayerId=function(O){return O===I.yl?"bubbles":"map"},F.createAzureMapSubSelection=function(O,T,A,P,m){var k="",w={};return"bubbles"===O.split("-")[0]&&(m?(k=A.getLocalizedString("MiniToolbar_Bubbles",m.value),w=m.identity.getSelectorsByColumn()):(k=A.getLocalizedString("Visual_Bubbles"),w=K)),{visualObjects:[{objectName:O,selectorsByColumn:w}],showUI:T,displayName:k,subSelectionType:3,selectionOrigin:P}},F.getAllSubSelectables=function(O,T,A,P){var m=A.getAllSubSelectables(P);return O?.properties.bubble&&O.properties.bubble.showBubbleLayer&&O.hasSeries&&!_.isEmpty(O.series)&&m.push.apply(m,O.series.map(function(k,w){return F.createAzureMapSubSelection("".concat("bubbles","-series-").concat(w),!1,T,void 0,k)})),m},F.getNextSubSelectable=function(O,T,A,P,m){var k=F.getAllSubSelectables(O,T,A);if(k.length){var w;if(!P)return m?_.last(k):_.first(k);var g=_.findIndex(k,function(s){return _.isEqual(P,s)});if(g>-1){var p=m?g-1:g+1;p>-1&&p<k.length&&(w=k[p])}return w}},F.getBubblesSubSelectionStyles=function(O,T){return void 0===T&&(T={}),{type:3,fill:{reference:(0,b.__assign)((0,b.__assign)({},r.MC.dataPoint.fill),{selector:(0,ae.fd)((0,ae.tV)(T))}),label:O.getLocalizedString("Visual_Fill")},stroke:{reference:r.MC.bubbleLayer.strokeColor,label:O.getLocalizedString("Visual_Border")}}},F.getBubblesSubSelectionShortcuts=function(O){return[{type:0,relatedResetFormattingIds:[r.MC.dataPoint.fill,r.MC.bubbleLayer.strokeColor,r.MC.bubbleLayer.layerPosition]},(0,b.__assign)((0,b.__assign)({type:3},r.MC.bubbleLayer.layerPosition),{label:O.getLocalizedString("Visual_AzureMapsLayerPosition")}),{type:1,destinationInfo:{cardUid:"".concat("Visual","-").concat(I.yl),groupUid:"".concat(I.yl,"-size")},label:O.getLocalizedString("Format_Bubbles")}]},F}()}}]);