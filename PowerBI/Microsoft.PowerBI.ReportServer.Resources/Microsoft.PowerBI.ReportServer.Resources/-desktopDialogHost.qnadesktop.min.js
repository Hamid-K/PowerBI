"use strict";(self.webpackChunkdesktopDialogHost=self.webpackChunkdesktopDialogHost||[]).push([["qnadesktop"],{70940:function(Z,O,u){u.d(O,{s:function(){return F}});var c=u(47508),P=u(45034),h=new P.o(function(){var a={};return a[3]=c.L.card,a[13]=c.L.lineClusteredColumnComboChart,a[29]=c.L.multiRowCard,a[7]=c.L.clusteredBarChart,a[10]=c.L.clusteredColumnChart,a[20]=c.L.donutChart,a[16]=c.L.funnel,a[30]=c.L.gauge,a[22]=c.L.heatMap,a[9]=c.L.hundredPercentStackedBarChart,a[12]=c.L.hundredPercentStackedColumnChart,a[4]=c.L.lineChart,a[1]=c.L.map,a[19]=c.L.filledMap,a[2]=c.L.pivotTable,a[5]=c.L.pieChart,a[6]=c.L.scatterChart,a[8]=c.L.barChart,a[11]=c.L.columnChart,a[0]=c.L.tableEx,a[17]=c.L.treemap,a[23]=c.L.waterfallChart,a[26]=c.L.stackedAreaChart,a[27]=c.L.hundredPercentStackedAreaChart,a[32]=c.L.areaChart,a[33]=c.L.ribbonChart,a[34]=c.L.kpi,a[35]=c.L.decompositionTreeVisual,a});function F(a){return h.getValue()[a]}new P.o(function(){var a={};return a[c.L.card.name]=3,a[c.L.lineClusteredColumnComboChart.name]=13,a[c.L.multiRowCard.name]=29,a[c.L.clusteredBarChart.name]=7,a[c.L.clusteredColumnChart.name]=10,a[c.L.donutChart.name]=20,a[c.L.funnel.name]=16,a[c.L.gauge.name]=30,a[c.L.heatMap.name]=22,a[c.L.hundredPercentStackedBarChart.name]=9,a[c.L.hundredPercentStackedColumnChart.name]=12,a[c.L.lineChart.name]=4,a[c.L.map.name]=1,a[c.L.filledMap.name]=19,a[c.L.matrix.name]=2,a[c.L.pivotTable.name]=2,a[c.L.pieChart.name]=5,a[c.L.scatterChart.name]=6,a[c.L.barChart.name]=8,a[c.L.columnChart.name]=11,a[c.L.table.name]=0,a[c.L.tableEx.name]=0,a[c.L.treemap.name]=17,a[c.L.waterfallChart.name]=23,a[c.L.stackedAreaChart.name]=26,a[c.L.hundredPercentStackedAreaChart.name]=27,a[c.L.areaChart.name]=32,a[c.L.ribbonChart.name]=33,a[c.L.kpi.name]=34,a[c.L.decompositionTreeVisual.name]=35,a})},1931:function(Z,O,u){u.d(O,{T:function(){return K}});var c=u(77476),P=u(52910),h=u(13052),T=u(31109),F=u(32208),f=u(76521),a=u(40516),g=u(84497),A=u(79061),L=u(98665),b=u(56545),w=u(3176),k=u(50423),K=function(){function B(){}return B.\u0275fac=function(Y){return new(Y||B)},B.\u0275mod=k.\u0275\u0275defineNgModule({type:B}),B.\u0275inj=k.\u0275\u0275defineInjector({imports:[c.CommonModule,P.O,h.T,T.F,F.J,f.A3,a.h,g.L,A.v,L.e3,b.g,w.c]}),B}()},20327:function(Z,O,u){u.r(O),u.d(O,{QnaDesktopModule:function(){return gt}});var c=u(1931),P=u(98875),h=u(50423),T=u(96292),F=function(){function n(t,r){this.desktopQnaService=t,this.promiseStore=r}return n.prototype.improveLinguisticSchema=function(t){return this.pendingRequestPromise=this.promiseStore.create(),this.desktopQnaService.improveLinguisticSchema(t,this.pendingRequestPromise)},n.prototype.cancelImproveLinguisticSchema=function(){null!=this.pendingRequestPromise&&(this.promiseStore.cancelPromise(this.pendingRequestPromise.handle),this.pendingRequestPromise=void 0)},n.\u0275fac=function(r){return new(r||n)(h.\u0275\u0275inject(T.r),h.\u0275\u0275inject(P.K))},n.\u0275prov=h.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),f=u(81337),a=u(98665),g=u(62458),A=new h.InjectionToken("ImproveLsdlProxy"),L=u(26112),b=u(74539),w=u(94759),k=u(38078),J=u(29804),K=function(){function n(t){this.certifiedEventsService=t}return n.prototype.startImproveLsdlWithCopilotEvent=function(){this.improveLsdlCopilotEventStartTime=(0,J.z)()},n.prototype.stopImproveLsdlWithCopilotEvent=function(t){g.fF.assertValue(this.improveLsdlCopilotEventStartTime,"improveLsdlCopilotEventStartTime"),this.certifiedEventsService.logTimedStandardizedFeatureEvent({correlationId:k.b$.generateGuid(),originatingService:w.F1,activityName:"Qna-Setup",resultCode:"",featureName:(0,w.mN)("Usage","Qna-Setup"),activityStatus:t,operationStartTime:this.improveLsdlCopilotEventStartTime,operationEndTime:(0,J.z)(),activityAttributes:{IsSignedIn:!0,Location:"Desktop",ContentMode:"Edit"}}),this.improveLsdlCopilotEventStartTime=void 0},n.\u0275fac=function(r){return new(r||n)(h.\u0275\u0275inject(a.ly))},n.\u0275prov=h.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"}),n}(),B=u(5894),X=u(34100),_e={provide:"improveLsdlService",useFactory:function(n,t,r,l,s){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(v){return[2,new Me(s,t,r,l,n)]})})},deps:[A,a.ly,a.y0,K,b.D]},Me=function(){function n(t,r,l,s,v){this.lsdlUiBlockerService=t,this.certifiedEventsService=r,this.telemetryService=l,this.improveLsdlCopilotTelemetry=s,this.improveLsdlProxy=v}return n.prototype.improveLinguisticSchema=function(t){var r,l;return(0,f.__awaiter)(this,void 0,void 0,function(){var s,v,y,m,D,x,E;return(0,f.__generator)(this,function(R){switch(R.label){case 0:if(g.fF.assertValue(t,"improveLsdlRequest"),g.fF.assertNonEmpty(t.requestedAgents,"requestedAgents should not be empty"),(0,X.J_)(t.requestedAgents)&&_.isEmpty(t.copilotWorkspaceId))return g.fF.assertFail("copilotWorkspaceId should be defined for copilot agents"),[2];s={LsdlJson:t.lsdlJson,RequestedVersion:"4.0.0",Priority:t.requestPriority,RequestedAgents:_.map(t.requestedAgents,function(C){return C.toString()}),CopilotWorkspaceId:t.copilotWorkspaceId},_.includes(t.requestedAgents,"PowerBI.AzureOpenAIPhrasings")?this.lsdlUiBlockerService.startBlockingTask("improvePhrasings"):this.lsdlUiBlockerService.startBlockingTask("improveSynonyms"),this.startTelemetryEvent(t.requestedAgents),R.label=1;case 1:return R.trys.push([1,3,4,5]),[4,this.improveLsdlProxy.improveLinguisticSchema(s)];case 2:return y=R.sent(),m=(0,L.K)(y),v=function(n){return"1.0.0"===n.Version}(m)?{version:m.Version,errors:_.map(m.DiagnosticInfo,function(C){return{category:"powerbi",code:C.DiagnosticCode,agent:Pe(C.Agent),diagnosticMessage:C.DiagnosticMessage}}),result:m.LsdlObject?{lsdlObject:m.LsdlObject}:void 0}:{version:m.Version,errors:[{category:"powerbi",code:"RequiresNewerVersion"}]},[3,5];case 3:return D=R.sent(),x=null!==(r=D.hostError)&&void 0!==r?r:D,E=function(n){return"BadGateway"===n||"ConnectFailure"===n||"ConnectionClosed"===n||"GatewayTimeout"===n||"KeepAliveFailure"===n||"NameResolutionFailure"===n||"NetworkUnavailable"===n||"ProxyAuthenticationRequired"===n||"ProxyNameResolutionFailure"===n||"RequestTimeout"===n||"ServiceUnvailable"===n||"Timeout"===n||"AccessDenied"===n?"NetworkConnectionIssue":"FeatureNotAvailableError"===n?"FeatureNotAvailable":"System.OperationCanceledException"===n?"OperationCancelled":"GenericFailure"}(null!==(l=x.errorCode)&&void 0!==l?l:x.type),v={version:"1.0.0",errors:[{category:"host",code:E}]},[3,5];case 4:return this.endTelemetryEvent(!!v.result,v.errors,t.requestedAgents),this.lsdlUiBlockerService.endBlockingTask(),[7];case 5:return[2,v]}})})},n.prototype.cancelImproveLinguisticSchema=function(){this.improveLsdlProxy.cancelImproveLinguisticSchema(),this.improveLsdlTelemetryEvent&&(this.improveLsdlTelemetryEvent.event.info.isCancelled=!0),this.improveLsdlRunningEvent&&this.improveLsdlRunningEvent.setAttribute("isCancelled",!0)},n.prototype.startTelemetryEvent=function(t){this.improveLsdlTelemetryEvent=this.telemetryService.startEvent(B.yp,{requestedAgents:t}),this.improveLsdlRunningEvent=this.certifiedEventsService.startTimedStandardizedFeatureEvent("Qna - Improve LSDL Feature",B.Nt),this.improveLsdlRunningEvent.setAttribute("requestedAgents",_.toString(t)),(0,X.J_)(t)&&this.improveLsdlCopilotTelemetry.startImproveLsdlWithCopilotEvent()},n.prototype.endTelemetryEvent=function(t,r,l){if(g.fF.assertValue(this.improveLsdlTelemetryEvent,"improveLsdlTelemetryEvent"),g.fF.assertValue(this.improveLsdlRunningEvent,"improveLsdlRunningEvent"),!_.isEmpty(r)){var s=_.map(r,function(m){return m.code});this.improveLsdlTelemetryEvent.event.info.errorCodes=s,this.improveLsdlRunningEvent.setAttribute("errorCodes",_.toString(s))}this.improveLsdlTelemetryEvent.resolve();var y=t&&!_.isEmpty(r)?"SucceededWithErrors":t?"Succeeded":"Failed";this.improveLsdlRunningEvent.complete(y),(0,X.J_)(l)&&this.improveLsdlCopilotTelemetry.stopImproveLsdlWithCopilotEvent(y),this.improveLsdlTelemetryEvent=void 0,this.improveLsdlRunningEvent=void 0},n.\u0275fac=function(r){return new(r||n)(h.\u0275\u0275inject(b.D),h.\u0275\u0275inject(a.ly),h.\u0275\u0275inject(a.y0),h.\u0275\u0275inject(K),h.\u0275\u0275inject(A))},n.\u0275prov=h.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}();function Pe(n){if(null!=n)switch(n){case"PowerBI.OrganizationLsdlSharing":return"PowerBI.OrganizationLsdlSharing";case"PowerBI.AzureOpenAISynonyms":return"PowerBI.AzureOpenAISynonyms";case"PowerBI.AzureOpenAIPhrasings":return"PowerBI.AzureOpenAIPhrasings";default:g.fF.assertFail("Unknown agent name ".concat(n))}}var W=u(35988),Ae=u(82762),q=u(11547),H=u(14172),ee=u(81905),ce=u(59822),Ne=u(70032),pe=function(){function n(t){this.qnaHostService=t,this.retryId=0}return n.prototype.getOverwriteResponseModelInfo=function(t){g.fF.assert(function(){return 1===_.size(t?.scopes)},"Expect to have 1 and only one scope in the request for desktop");var r=t.scopes[0].model;return{vsName:r.vsName,dbName:r.dbName}},n.prototype.convertToWireInterpretRequest=function(t){return(0,Ae.D)(this.qnaHostService.getServiceModelInfo()).pipe((0,H.U)(function(l){return l?W.tc(t,l.VirtualServerName,l.DatabaseName):W.NG(t)}))},n.prototype.probe=function(t){var r=this;return g.fF.assertAnyValue(t,"modelScopes can be any value"),this.convertToWireInterpretRequest(void 0).pipe((0,ee.w)(function(l){return r.sendRequest(l).pipe((0,H.U)(function(s){return W.Cb(s)}))}),(0,ce.K)(function(l){return(0,q.of)({error:ve(l)})}))},n.prototype.interpret=function(t,r,l){return g.fF.assertValue(t,"Expect the given wireInterpretRequest to be defined"),this.sendRequest(t,r,l).pipe((0,H.U)(function(s){return function(n,t){return g.fF.assertValue(t,"Expect the given wireResponse to be defined"),Ve(n)?W.B4(t):W.R1(n.Utterance,n.DesiredInterpretationsCount,void 0,t)}(t,s)}),(0,ce.K)(function(s){return(0,q.of)(function(n,t){g.fF.assert(function(){return!t.HostError},"Expect hostError being a IHostServiceError, not hostError.HostError");var r=ve(t);return Ve(n)?{result:void 0,error:r}:{utterance:n.Utterance,results:void 0,error:r}}(t,s))}))},n.prototype.sendRequest=function(t,r,l){var s=this;return g.fF.assertValue(t,"The given wireInterpretRequest must be defined"),this.qnaHostService.interpretAsObservable(JSON.stringify(t)).pipe((0,Ne.g)(this.retryId>0?1e3:0),(0,ee.w)(function(y){var m=(0,L.K)(y);if(r&&s.retryId<=8){var D=function(n){var t=n?.Context;return 1===_.size(t?.ModelScopes)&&!_.isEmpty(t.ModelScopes[0].VirtualServerName)&&!_.isEmpty(t.ModelScopes[0].DatabaseName)}(t)?W.qV(m):W.Fm(m);if(null!=D)return s.retryId++,l&&l.reportLoading({warning:D}),s.sendRequest(t,r,l)}return s.retryId=0,(0,q.of)(m)}))},n.\u0275fac=function(r){return new(r||n)(h.\u0275\u0275inject(T.r))},n.\u0275prov=h.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}();function Ve(n){var t,r;return g.fF.assertValue(n,"Expect the given interpretRequest to be defined."),!(null===(t=n.Options)||void 0===t||!t.SuggestedUtterances)||!(null===(r=n.Options)||void 0===r||!r.SuggestedDefineCalculationUtterances)}function ve(n){g.fF.assertValue(n,"Expect the given hostError to be defined");var t=W.hj(n.errorCode);return g.fF.assertValue(null!=t,"Expect qnaErrorCode not null here"),{errorCode:t,source:"GenericRequestFailure"!==t?"User":"PowerBI",message:n.message,stackTrace:n.stackTrace}}var We=u(35510),fe=u(9380),Be=u(5708),ge=u(43286),te=u(65181),ae=new h.InjectionToken("QnaInterpretProxyService"),ke={en:{resStringSuffix:"_English"},es:{resStringSuffix:"_Spanish",preview:!0}};function se(n,t){var r=function(n){var t;if(_.isEmpty(n))return t;for(var r=0,l=n;r<l.length;r++){var s=l[r];if(t&&s.language!==t){t=void 0;break}t=s.language}return t}(t);return function(n,t){var r="";if(n){var l=!1,s=he(t.currentLanguageLocale);n=he(n);var v=ke[n];v&&(r=v.resStringSuffix,l=v.preview),!l&&n===s&&(r="")}return t.get("Qna_Input_Placeholder"+r)}(r,n)}function he(n){if(n)return n.split("-")[0].toLowerCase()}function xe(n,t,r,l){return new Ke(n,t,r,l)}var Ke=function(){function n(t,r,l,s){this.featureSwitchService=t,this.localizationService=r,this.telemetryService=l,this.interpretProxy=s,this.answeredQuestionDataLoggerFactory=new Je(this.telemetryService,3e3)}return n.prototype.sendFeedback=function(t,r,l,s){return(0,f.__awaiter)(this,void 0,void 0,function(){var v,y;return(0,f.__generator)(this,function(m){switch(m.label){case 0:return v=this.constructInterpretRequest(r,void 0,l,void 0,{tags:s},void 0,t),[4,this.interpretProxy.convertToWireInterpretRequest(v).toPromise()];case 1:return y=m.sent(),this.interpretProxy.interpret(y,!1),[2]}})})},n.prototype.interpret=function(t,r,l,s,v,y,m,D){var x=this;if(g.fF.assertValue(v,"interpretListener"),_.isEmpty(r))return(0,q.of)(void 0);var E=Date.now(),R=this.answeredQuestionDataLoggerFactory.startLogger(),C={contentProviderType:"Unknown",entryPoint:l,tags:_.isEmpty(m?.tags)?void 0:m.tags.join(",")};m?.isQuestionNotCommitted||v.onInterpretIssued();var j=this.generateRequestOptions(y),V=this.constructInterpretRequest(r,j,s,t,m,D),le={reportLoading:function(De){x.notifyInterpretListenerRetry(v,De.warning)}},de=this.interpretProxy.getOverwriteResponseModelInfo(V);return this.interpretProxy.convertToWireInterpretRequest(V).pipe((0,ee.w)(function(ie){return x.interpretProxy.interpret(ie,!0,le).pipe((0,H.U)(function(De){var Xe,Ye,et=Date.now();Le(De);var Q=De;if(x.checkToOverwriteResponseModelInfo(Q,de),x.notifyInterpretListenerResult(v,Q,!!m?.isQuestionNotCommitted,V),C.fromCache=!!Q.fromCache,Q.error?x.logAnsweredQuestionDataOnError(R,E,et,Q?.requestId,null===(Ye=null===(Xe=Q?.error)||void 0===Xe?void 0:Xe.errorCode)||void 0===Ye?void 0:Ye.toString(),C):x.logAnsweredQuestionDataWithInterpretResult(R,E,et,Q?.requestId,V.scopes,Q,C),Q?.warnings){var mt=(0,W.vr)(Q.warnings);_.remove(Q.warnings,function(ht){return _.find(mt,function(yt){return yt.warning===ht})}),C.warnings=Q.warnings.join("|")}return Q}))}))},n.prototype.sendTags=function(t,r,l,s,v){var y,m;return(0,f.__awaiter)(this,void 0,void 0,function(){var D,x,E,R,C,j,V,le,de,U;return(0,f.__generator)(this,function(ie){switch(ie.label){case 0:return g.fF.assertNonEmpty(t,"Expect this be called only when tags is not empty"),_.isEmpty(t)?[2]:(D=Date.now(),x=this.answeredQuestionDataLoggerFactory.startLogger(),E={contentProviderType:"Unknown",entryPoint:l,tags:_.isEmpty(t)?void 0:t.join(","),fromCache:!1},R=this.generateRequestOptions(v),C=this.constructInterpretRequest(r,R,s,void 0,{tags:t}),j=this.interpretProxy.getOverwriteResponseModelInfo(C),[4,this.interpretProxy.convertToWireInterpretRequest(C).toPromise()]);case 1:return V=ie.sent(),[4,this.interpretProxy.interpret(V,!1).toPromise()];case 2:return le=ie.sent(),de=Date.now(),Le(le),this.checkToOverwriteResponseModelInfo(U=le,j),U.error?this.logAnsweredQuestionDataOnError(x,D,de,U?.requestId,null===(m=null===(y=U?.error)||void 0===y?void 0:y.errorCode)||void 0===m?void 0:m.toString(),E):this.logAnsweredQuestionDataWithInterpretResult(x,D,de,U?.requestId,C.scopes,U,E),[2]}})})},n.prototype.getSuggestedQuestions=function(t){var r=this,s=this.constructInterpretRequest("",2048,t);return this.interpretProxy.convertToWireInterpretRequest(s).pipe((0,ee.w)(function(y){return r.interpretProxy.interpret(y,!0).pipe((0,H.U)(function(m){return function(n){g.fF.assert(function(){return!n.hasOwnProperty("utterance")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "utterance".'),g.fF.assert(function(){return!n.hasOwnProperty("requestId")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "requestId".'),g.fF.assert(function(){return!n.hasOwnProperty("fromCache")},'Expect proxyResponse in type SuggestedQuestionResponse, it should not contain property "fromCache".');var t=n;t.result&&g.fF.assert(function(){return t.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(m),m}))}))},n.prototype.getSuggestedDefineCalculationQuestions=function(t){var r=this,s=this.constructInterpretRequest("",16384,t);return this.interpretProxy.convertToWireInterpretRequest(s).pipe((0,ee.w)(function(y){return r.interpretProxy.interpret(y,!0).pipe((0,H.U)(function(m){return function(n){var t=n;t.result&&g.fF.assert(function(){return t.result.hasOwnProperty("utterances")},'Expect proxyResponse in type SuggestedQuestionResponse, proxyResponse.result should contain property "utterances".')}(m),m}))}))},n.prototype.getPlaceholderText=function(t){var r=this,l=_.filter(t,function(s){return r.isSupportedScope(s)});return this.interpretProxy.probe((0,W.C2)(l)).pipe((0,H.U)(function(s){return{result:s.results?se(r.localizationService,s.results):void 0,error:s.error}}))},n.prototype.constructInterpretRequest=function(t,r,l,s,v,y,m){var D=this,E={version:2,utterance:t,scopes:_.filter(l,function(C){return D.isSupportedScope(C)}),skipCompletion:!0,spans:v?.specifiedSpans,linguisticSchemaJson:v?.linguisticSchemaJson,inferredTermBinding:v?.inferredTermBinding,isCommitted:!v?.isQuestionNotCommitted,tags:v?.tags,feedback:m,reportMetadata:y};if(this.featureSwitchService.featureSwitches.interpretRequestGroupIdEnabled&&(E.groupId=s?.groupId,E.groupSequenceNumber=s?.groupSequenceNumber),r&&(E.options=r,(0,ge.yE)(E.options,256))){var R=v.calculation;g.fF.assertValue(R,"requestParams calculation should be defined"),E.intent={defineCalculation:{language:R.language}},E.isCommitted=R.isCommitted,E.desiredInterpretationsCount=5}return E},n.prototype.isSupportedScope=function(t){return t&&t.model&&(0,Be.KZ)(t.model)&&!_.isEmpty(t.model.vsName)&&!_.isEmpty(t.model.dbName)},n.prototype.generateRequestOptions=function(t){var r=66;return t&&(t.supportsInsightsQueries&&(r|=512),t.supportsPodQueries&&(r|=8),t.inferUnknownModelTerms&&(r|=4096),t.singleAnswerBias&&(r|=8192),t.supportsCalculation&&(r|=256),t.includeRelevantSchemaElements&&(r|=32),t.useLlmParser&&(r|=65536)),r},n.prototype.notifyInterpretListenerResult=function(t,r,l,s){g.fF.assertValue(r,"Expect response to be defined"),g.fF.assertValue(t,"Expect interpretListener to be defined"),!l&&t.onInterpretResult(s,r)},n.prototype.notifyInterpretListenerRetry=function(t,r){g.fF.assertValue(t,"Expect interpretListener to be defined."),t.onInterpretRetry&&t.onInterpretRetry(r)},n.prototype.logAnsweredQuestionDataOnError=function(t,r,l,s,v,y){y.isResponseEmpty=!0,y.isError=!0,y.interpretRequestId=s,y.error=v,t.log(r,l,y)},n.prototype.logAnsweredQuestionDataWithInterpretResult=function(t,r,l,s,v,y,m){g.fF.assertValue(y,"Expect response to be defined"),m.interpretRequestId=s,function(n,t,r){var l;g.fF.assertValue(n,"answeredQuestionData"),g.fF.assertValue(t,"Expect response to be defined");var s=_.first(t.results);n.isError=!!t.error,n.isResponseEmpty=!s?.command;var v=function(n,t){g.fF.assertValue(n,"Expect interpretResponse to be defined");var r=_.first(n.results);if(r)return _.find(t,function(l){return l.model.vsName.toLowerCase()===r.virtualServerName.toLowerCase()&&l.model.dbName.toLowerCase()===r.databaseName.toLowerCase()})}(t,r);if(v&&(n.ownerType=function(n){var t,r=null===(t=n?.model)||void 0===t?void 0:t.permissions;return r?(0,ge.yE)(r,7)?"Owner":"Shared":"Unknown"}(v)),n.interpretationState="No Result",s){n.language=s.language,n.modelLanguage=s.modelLanguage;var y=null===(l=s.correctionInfo)||void 0===l?void 0:l.state;if(null==y)n.interpretationState="Understood";else switch(y){case 1:n.interpretationState="Did you mean";break;case 2:n.interpretationState="Showing results for";break;case 0:n.interpretationState="No Result";break;default:g.fF.assertFail("Unhandled case: "+y)}}}(m,y,v),t.log(r,l,m)},n.prototype.checkToOverwriteResponseModelInfo=function(t,r){var l=t.results;if(!_.isEmpty(l)&&r)for(var s=0,v=l;s<v.length;s++){var y=v[s];y.virtualServerName=r.vsName,y.databaseName=r.dbName}},(0,f.__decorate)([(0,f.__param)(3,(0,h.Inject)(ae)),(0,f.__metadata)("design:paramtypes",[fe.vZ,te.o,a.y0,Object])],n)}();function Le(n){g.fF.assertValue(n.utterance,'proxyResponse is expected to be in type InterpretResponse here, it should contain property "utterance" which is not null.');var r=n;r.results&&g.fF.assert(function(){return!r.results.hasOwnProperty("utterances")},'Expect proxyResponse in type InterpretResponse, proxyResponse.result should not contain "utterances" property.')}var Je=function(){function n(t,r){this.telemetryService=t,this.logDebounceTimeInMilliseconds=r}return n.prototype.startLogger=function(){var t=this,r=new $e(this.telemetryService);return null!=this.logAnsweredDataDebounceHandler&&(clearTimeout(this.logAnsweredDataDebounceHandler),this.logAnsweredDataDebounceHandler=null),this.logAnsweredDataDebounceHandler=setTimeout(function(){t.logAnsweredDataDebounceHandler=null,r.setReadyToLogData()},this.logDebounceTimeInMilliseconds),r},n}(),$e=function(){function n(t){this.telemetryService=t,this.eventInfo$=new We.X(void 0)}return n.prototype.log=function(t,r,l){this.eventInfo$.next({start:t,end:r,data:l})},n.prototype.setReadyToLogData=function(){var t=this;this.eventInfo$.subscribe(function(r){r&&t.logData(r)})},n.prototype.logData=function(t){var r=t.start,l=t.end,s=t.data;g.fF.assert(function(){return-1!==r},"startTime value should be set"),g.fF.assert(function(){return-1!==l},"endTime value should be set"),s.wasCancelled&&(s.isError=!1),this.telemetryService.logEvent(function(m,D,x,E){return void 0===D&&(D=!1),void 0===x&&(x=void 0),void 0===E&&(E=void 0),B.yP({EventsKitEventName:"FireActivityCompletionSummaryEvent",howEnded:s.isError?"3":"1",isResponseEmpty:s.isResponseEmpty,fromCache:s.fromCache,contentProviderType:s.contentProviderType,ownerType:s.ownerType,duration:l-r,probeDuration:-1,wasCancelled:s.wasCancelled,interpretRequestId:s.interpretRequestId,entryPoint:s.entryPoint,linguisticSchemaLanguage:s.language,modelLanguage:s.modelLanguage,withContextPresent:!1,usedContext:!1,tags:s.tags,interpretationState:s.interpretationState,parentId:m,isError:s.isError,errorSource:x,errorCode:E,warnings:s.warnings,responseError:s.error})})},n}(),Ce=u(91592),e=u(41887),i=u(47508),o=u(88255);function d(n,t,r,l,s,v,y,m,D,x,E,R,C,j){return new p(n,t,r,l,s,v,y,m,D,x,E,R,C,j)}var p=function(){function n(t,r,l,s,v,y,m,D,x,E,R,C,j,V){this.conceptualSchemaProxy=t,this.dataSources=r,this.dialogService=l,this.errorService=s,this.explorationCapabilitiesService=v,this.explorationNavigation=y,this.formFactorProvider=m,this.layoutAuthoring=D,this.lazyProvider=x,this.localizationService=E,this.telemetryService=R,this.viewModeState=C,this.visualAuthoring=j,this.qnaProxyPathToken=V}return n.prototype.reportConfigAllowsQna=function(t){return 0===this.formFactorProvider.getCurrentLayout()&&!(0===this.viewModeState.getMode()&&!t.allowInViewMode)},n.prototype.tryAddQnaContainerToCanvas=function(t,r){return(0,f.__awaiter)(this,void 0,void 0,function(){var l,s,v,y,m,D,x;return(0,f.__generator)(this,function(R){switch(R.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!1})?[4,this.ensureQnaSupportabilityService()]:[2,!1];case 1:return R.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return l=R.sent(),s=this.explorationCapabilitiesService.getCapabilities(),!(v=(0,Ce.H)(s,l,this.qnaSupportabilityService)).isAllowed&&"featureDisabledInApp"===v.disallowedReason||!v.isAllowed&&!s.allowEnableQnaPrompts?[2,!1]:(m={width:t.contract.size.width,height:t.contract.size.height},(y=r&&r.pointOfInterest)&&(D=this.layoutAuthoring.getLayoutForNewVisualContainer(t.contract.visualContainers,y,m)),x=this.explorationNavigation.getAllSections(),[4,(0,e.lN)({telemetrySource:r.creationSource,position:D,visualType:i.L.qnaVisual.name},x,t,this.dataSources.get(),this.visualAuthoring,this.telemetryService)]);case 3:return R.sent(),[2,!0]}})})},n.prototype.tryShowQnaPopout=function(t,r){return(0,f.__awaiter)(this,void 0,void 0,function(){var s,v,y,m,D,R=this;return(0,f.__generator)(this,function(C){switch(C.label){case 0:return this.reportConfigAllowsQna({allowInViewMode:!0})?[4,this.ensureQnaSupportabilityService()]:[2];case 1:return C.sent(),[4,this.conceptualSchemaProxy.get(this.dataSources.get())];case 2:return s=C.sent(),v=this.explorationCapabilitiesService.getCapabilities(),(y=(0,Ce.H)(v,s,this.qnaSupportabilityService)).isAllowed?[4,this.lazyProvider.get("@powerbi/QnaReportContainer/module#QnaReportContainerModule","qnaPopoutBuilderModern")]:[3,5];case 3:return m=C.sent(),D={anchorElement:t,dataSources:this.dataSources.get(),explorationCapabilities:v,sourceExploration:this.explorationNavigation.getCurrentExploration(),sourceFilters:r.sourceFilters,viewMode:this.viewModeState.getMode(),close:function(){R.explorationNavigation.hideExplorationMask()}},[4,m.show(D)];case 4:return C.sent(),this.explorationNavigation.showExplorationMask(),[3,6];case 5:switch(y.disallowedReason){case"featureDisabledInIE":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupportedInIE_Title"),this.localizationService.get("Qna_NotSupportedInIE_Subtitle"));break;case"featureDisabledInApp":g.fF.assertFail("Expect the code of showing qna popout never be called if app doesn't allow qna feature");break;case"noModel":this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.localizationService.get("Qna_NotAllowedForReport_WithoutModel"));break;case"qnaNotSupported":this.errorService.infoCustom(this.localizationService.get("VisualContainer_QnaVisual_NotSupportedTitle"),this.localizationService.get("VisualContainer_QnaVisual_NotSupportedMessage"));break;case"qnaNotEnabled":this.qnaSupportabilityService.canAnyUserEnableQna()?this.dialogService.showConfirmationDialog({title:this.localizationService.get("Qna_NotSupported_Title"),message:this.qnaSupportabilityService.modelHasQnaDisabledMessage,okButtonText:this.localizationService.get("Qna_MessageDialog_EnableQnaButtonText"),cancelButtonText:this.localizationService.get("Cancel_ButtonText")},{maxWidth:500}).afterClosed().pipe((0,o.P)()).subscribe(function(j){return(0,f.__awaiter)(R,void 0,void 0,function(){return(0,f.__generator)(this,function(V){switch(V.label){case 0:return 1!==j?[3,3]:[4,this.qnaSupportabilityService.enableQna()];case 1:return V.sent(),[4,this.tryShowQnaPopout(t,r)];case 2:V.sent(),V.label=3;case 3:return[2]}})})}):this.errorService.infoCustom(this.localizationService.get("Qna_NotSupported_Title"),this.qnaSupportabilityService.modelHasQnaDisabledMessage);break;default:g.fF.assertNever(y.disallowedReason)}C.label=6;case 6:return[2]}})})},n.prototype.ensureQnaSupportabilityService=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){var t;return(0,f.__generator)(this,function(r){switch(r.label){case 0:return this.qnaSupportabilityService?[3,2]:(t=this,[4,this.lazyProvider.get(this.qnaProxyPathToken||"@powerbi/Qna/qnaweb.module#QnaWebModule","qnaSupportabilityService")]);case 1:t.qnaSupportabilityService=r.sent(),r.label=2;case 2:return[2]}})})},n}(),S=function(){function n(t){this.qnaHostService=t}return n.prototype.isDQOrLiveConnectToOnPrem=function(t){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(r){return[2,Promise.resolve(this.qnaHostService.requiresConsentToQnaForLiveConnect())]})})},n.\u0275fac=function(r){return new(r||n)(h.\u0275\u0275inject(T.r))},n.\u0275prov=h.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),M=u(30794),I=function(){function n(t,r){var l=this;this.qnaService=t,this.localizationService=r,this.qnaSettingsChangedInternal=new M.xQ,this.settingsChangedSubscription=this.qnaService.settingsChanged$.subscribe(function(){return l.qnaSettingsChangedInternal.next(!0)})}return n.prototype.ngOnDestroy=function(){this.qnaSettingsChangedInternal.complete(),this.settingsChangedSubscription.unsubscribe()},n.prototype.appShouldHideQnaFeature=function(){return this.qnaService.appShouldHideQnaFeature()},n.prototype.modelSupportsQna=function(t,r){return this.qnaService.modelSupportsQna()},n.prototype.modelHasQnaEnabled=function(t,r){return this.qnaService.modelHasQnaEnabled()},n.prototype.modelSupportsNlToDax=function(){return this.qnaService.modelSupportsNlToDax()},n.prototype.getNlToDaxStatus=function(){return this.qnaService.getNlToDaxStatus()},n.prototype.canAnyUserEnableQna=function(){return!0},n.prototype.canCurrentUserEnableQna=function(){return(0,f.__awaiter)(this,void 0,void 0,function(){return(0,f.__generator)(this,function(t){return[2,Promise.resolve(!0)]})})},n.prototype.enableQna=function(){return this.qnaService.setQnaEnabledForReport(!0)},Object.defineProperty(n.prototype,"qnaSettingsChanged$",{get:function(){return this.qnaSettingsChangedInternal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelHasQnaDisabledMessage",{get:function(){return this.localizationService.get("Visual_Qna_IsNotEnabled_Desktop")},enumerable:!1,configurable:!0}),n.prototype.allowsLinguisticSchemaEdit=function(){return this.qnaService.allowsLinguisticSchemaEdit()},n.\u0275fac=function(r){return new(r||n)(h.\u0275\u0275inject(T.r),h.\u0275\u0275inject(te.o))},n.\u0275prov=h.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),N=u(77476),re=u(26898),z=u(81213),G=u(13052),$=u(39503),ue=u(11494),Ze=u(83008),tt=u(48145),nt=u(17328),rt=u(63387),it=u(77200),ot=u(66890),at=u(76521),st=u(65947),qe=u(12123),ut=u(76072),lt=u(82156),dt=u(79061),ct=u(58938),pt=u(56545),vt=u(66972),ft=function(){function n(t){this.certifiedEventsService=t}return n.prototype.logInterpretWithCopilotEvent=function(t,r,l){this.certifiedEventsService.logStandardizedFeatureEvent({featureName:(0,w.mN)("Downstream","Qna-Query"),activityStatus:"Succeeded",activityName:"Qna-Query",resultCode:"",correlationId:"",activityAttributes:{IsSignedIn:r,Location:"service"===t?"Service":"Desktop",ContentMode:0===l?"View":"Edit"}})},n.\u0275fac=function(r){return new(r||n)(h.\u0275\u0275inject(a.ly))},n.\u0275prov=h.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac}),n}(),gt=function(){function n(){}return n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=h.\u0275\u0275defineNgModule({type:n}),n.\u0275inj=h.\u0275\u0275defineInjector({providers:[ue.J,pe,{provide:qe.n,useValue:"@powerbi/Qna/qnadesktop.module#QnaDesktopModule"},{provide:st.z,useValue:"@powerbi/Qna/qnadesktop.module#QnaDesktopModule"},I,S,{provide:"InterpretServiceModern",useFactory:xe,deps:[fe.vZ,te.o,a.y0,pe]},{provide:"qnaLaunchService",useFactory:d,deps:[re.i,Ze.D,ct.x,z.T,tt.U,$.z,nt.F,rt.U,ut.E,te.o,a.y0,it.kc,ot.$8,qe.n]},{provide:"qnaSupportabilityService",useClass:I},{provide:"qnaModelUtilsService",useClass:S},{provide:"interpretCopilotTelemetryService",useClass:ft},{provide:A,useClass:F},_e],imports:[N.CommonModule,G.T,at.A3,lt.N,dt.v,vt.N,a.e3,pt.g,c.T]}),n}()},5894:function(Z,O,u){u.d(O,{Nt:function(){return w},WW:function(){return h},dN:function(){return F},eV:function(){return b},v5:function(){return A},yP:function(){return a},yp:function(){return k}});var c=u(41114),P="PBI.QnaVisual.SuggestionCardClicked",h=c.cx[P]=(0,c.b1)(P),T="PBI.QnaVisual.VisualConverted",F=c.cx[T]=(0,c.b1)(T),f="PBI.QnA.INAQ",a=c.cx[f]=(0,c.b1)(f,{logExpAssignment:!0}),g="PBI.QnA.Feedback",A=c.cx[g]=(0,c.b1)(g),L="PBI.QnA.UpdateLsdlSharingPermission",b=c.cx[L]=(0,c.b1)(L),w="PBI.QnaTooling.ImproveLsdlRequest",k=c.cx[w]=(0,c.b1)(w)},34100:function(Z,O,u){u.d(O,{J8:function(){return F},J_:function(){return T},NP:function(){return h}});var c=u(81337),P=u(91592);function h(f,a,g,A,L){var b;return(0,c.__awaiter)(this,void 0,void 0,function(){var w,k;return(0,c.__generator)(this,function(K){switch(K.label){case 0:return[4,f.get(a.get())];case 1:return w=K.sent(),k=g.getCapabilities(),(0,P.H)(k,w,A).isAllowed&&A.allowsLinguisticSchemaEdit()&&"None"!==(null===(b=L.DynamicImprovement)||void 0===b?void 0:b.Schema)?[2,!0]:[2,!1]}})})}function T(f){return _.includes(f,"PowerBI.AzureOpenAISynonyms")||_.includes(f,"PowerBI.AzureOpenAIPhrasings")}function F(f){return f.qnaImproveLsdlCopilot&&f.qnaSupportCommitQuestionOnDemandForAll&&f.qnaFuzzyMatch}},91592:function(Z,O,u){u.d(O,{H:function(){return P}});var c=u(16808);function P(T,F,f){return(0,c.rO)()?{isAllowed:!1,disallowedReason:"featureDisabledInIE"}:f.appShouldHideQnaFeature()?{isAllowed:!1,disallowedReason:"featureDisabledInApp"}:_.some(F?.schemas,function(A){return!A.isExtensionSchema&&!_.isEmpty(A.entities)})?f.modelSupportsQna(F,T)?f.modelHasQnaEnabled(F,T)?{isAllowed:!0}:{isAllowed:!1,disallowedReason:"qnaNotEnabled"}:{isAllowed:!1,disallowedReason:"qnaNotSupported"}:{isAllowed:!1,disallowedReason:"noModel"}}},35988:function(Z,O,u){u.d(O,{AU:function(){return te},B4:function(){return Me},C2:function(){return fe},Cb:function(){return Fe},Fm:function(){return Ae},NG:function(){return Ue},R1:function(){return Qe},Tm:function(){return ge},hj:function(){return Ne},qV:function(){return q},tc:function(){return Oe},vr:function(){return Be}});var f,a,g,A,L,b,c=u(70940),P=u(54834),h=u(62458),T=u(43286),F=u(80777),w=((f={}).GeneratedLinguisticSchema=0,f.DataIndexBuildingCancelled=16,f.DataIndexMissingStatistics=17,f.DataIndexNotReady=8,f.DataIndexSizeLimitReached=15,f.DataIndexUpdateFailure=10,f.DomainModelNotReady=2,f.DomainModelPartialLoad=3,f.DomainModelUpdateFailure=9,f.EmptyLinguisticSchema=1,f.InterpretationSemanticError=4,f.InterpretationSemanticWarning=5,f.InterpretCancelled=18,f.InvalidTextualEntity=6,f.LinguisticSchemaTruncated=14,f.MissingOrInvalidPodParameters=13,f.QueryAggregateNotSupported=19,f.QueryMedianNotSupported=20,f.QueryPercentileNotSupported=21,f.QueryScopedEvalNotSupported=22,f.QuerySubqueryRegroupingNotSupported=23,f.StaleDataIndex=12,f.StaleDomainModel=11,f.RequiresNewerVersion=7,f.DataIndexVersionIsOld=24,f.QueryGroupByTableNotSupported=25,f.QueryNotSupported=26,f.NextBestInterpretation=27,f),k=((a={}).ActivationFailure="ActivationFailure",a.CloudRlsModelAccessDenied="CloudRlsModelAccessDenied",a.DataIndexBuildFailure="DataIndexBuildFailure",a.DomainModelLoadFailure="DomainModelLoadFailure",a.ExternalModelAccessDenied="ExternalModelAccessDenied",a.GenericRequestFailure="GenericRequestFailure",a.LinguisticSchemaLoadFailure="LinguisticSchemaLoadFailure",a.ModelNotFound="ModelNotFound",a.ModelQnaNotEnabled="ModelQnaNotEnabled",a.ModelQnaNotSupported="ModelQnaNotSupported",a.RequiresNewerVersion="RequiresNewerVersion",a.SchemaLanguageNotSupported="SchemaLanguageNotSupported",a.MissingRuntimeModule="MissingRuntimeModule",a.VerifyRuntimeFailure="VerifyRuntimeFailure",a.DataIndexMissingAllStatistics="DataIndexMissingAllStatistics",a),J=((g={})[16]="Qna_Warning_DataIndexIncomplete_Desktop",g[15]="Qna_Warning_DataIndexIncomplete_Desktop",g[14]="Qna_Warning_LinguisticSchemaTruncated_Desktop",g),K=((A={})[16]="Qna_Warning_DataIndexIncomplete_Service",A[15]="Qna_Warning_DataIndexIncomplete_Service",A[14]="Qna_Warning_LinguisticSchemaTruncated_Service",A),B=[2,8,11,12,24],X=[2,8],Y=((L={})[1]="Qna_NotAllowedForReport_WithoutModel",L[2]="Qna_Explore_WarningBuildingLanguageModel",L[7]="Qna_Warning_RequiresNewerVersion",L[8]="Qna_Explore_WarningIndexing",L[9]="Qna_Warning_ModelUpdateFailure",L[10]="Qna_Warning_DataIndexUpdateFailure",L[11]="Qna_Warning_StaleModel",L[12]="Qna_Warning_StaleIndex",L[17]="Qna_Warning_DataIndexMissingStatistics",L[19]="Qna_Warning_UnsupportedFunction",L[20]="Qna_Warning_UnsupportedFunction",L[21]="Qna_Warning_UnsupportedFunction",L[22]="Qna_Warning_UnsupportedFunction",L[23]="Qna_Warning_UnsupportedFunction",L[25]="Qna_Warning_QueryGroupByTableNotSupported",L[26]="Qna_Warning_QueryNotSupported",L[27]="Qna_Warning_NextBestInterpretation",L),_e=((b={}).FeatureNotAvailable="Qna_Error_GenericRequestFailure",b.NetworkConnectionIssue="Qna_Error_NetworkIssue",b.RequiresNewerVersion="Qna_Error_RequiresNewerVersion",b.ModelNotFound="Qna_Error_ModelNotFound",b.ModelQnaNotEnabled="Qna_Error_ModelQnaNotEnabled",b.ModelQnaNotSupported="Qna_Error_ModelQnaNotSupported",b.MissingRuntimeModule="Qna_Explore_MissingBinaries",b.VerifyRuntimeFailure="Qna_Explore_MissingBinaries",b.SchemaLanguageNotSupported="Qna_NotAllowedForReport_QnaNotSupported",b.SessionIsInactive="Qna_Error_GenericRequestFailure",b.GenericRequestFailure="Qna_Error_GenericRequestFailure",b.DataIndexBuildFailure="Qna_Explore_WarningFailedIndexing",b.CloudRlsModelAccessDenied="Tile_RLS_NoAccess",b.ExternalModelAccessDenied="Qna_Explore_ModelAccessDenied_WithoutSpecifyOwner",b.DataIndexMissingAllStatistics="Qna_Error_DataIndexMissingAllStatistics",b),Re=[19,20,22,21,23,25,26];function Me(e){h.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=ae(e);if(i)return{error:i};var o=_.first(e.Results),d=_.first(o?.Interpretations);return{result:{utterances:_.map(d?.SuggestedUtterances,function(p){return{text:p.Text,source:p.Source}}),warnings:se(o?.DiagnosticMessages)}}}function Qe(e,i,o,d){h.fF.assertValue(d,"Expect the given wireV3Response to be defined");var S,M,p=ae(d);if(!p){var I=_.first(d.Results);M=se(I?.DiagnosticMessages);var N=i??1,re=_.take(I?.Interpretations,N);_.isEmpty(re)||(S=_.map(re,function(z){var G,$,ue;return{restatement:z.Restatement,databaseName:null===(G=I.Context)||void 0===G?void 0:G.DatabaseName,virtualServerName:null===($=I.Context)||void 0===$?void 0:$.VirtualServerName,command:ze(z.Command),correctionInfo:Je(z),spans:ce(e,z.Spans),language:I.Language,modelLanguage:I.ModelLanguage,modelOwner:null===(ue=I.Context)||void 0===ue?void 0:ue.ModelOwner,usedAgents:_.map(z.UsedAgents,function(Ze){return Ze}),score:z.Score,relevantSchemaElements:Pe(I.RelevantSchemaElements)}}))}return{utterance:e,requestId:o,error:p,results:S,warnings:M}}function Pe(e){if(null!=e&&(null!=e.Entities||null!=e.Relationships)){var i=function(d){return{description:d.Description,score:d.Score}};return{entities:_.map(e.Entities,i),relationships:_.map(e.Relationships,i)}}}function Fe(e){h.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=ae(e);if(i)return{error:i};var o=_.first(e.Results);return{results:_.map(o?.Interpretations,function(p){return{language:o.Language}})}}function W(e){h.fF.assertValue(e,"Expect the given wireV3Response to be defined");var i=_.first(e.Results);return se(i?.DiagnosticMessages)}function Ae(e){h.fF.assertValue(e,"Expect the given wireResponse to be defined");var i=W(e);return _.find(B,function(o){return _.includes(i,o)})}function q(e){return h.fF.assertValue(e,"Expect the given wireResponse to be defined"),function(e){h.fF.assertValue(e,"Expect the given wireResponse to be defined");var i=W(e);return _.find(X,function(o){return _.includes(i,o)})}(e)}function ce(e,i){if(h.fF.assertValue(e,"utterance"),h.fF.assertAnyValue(i,"wireSpans"),i){_.isEmpty(e)&&h.fF.assert(function(){return _.every(i,function(p){return 0===p.Length})},"utterance is empty, every span should have zero length");var o=[],d=[];return _.forEach(i,function(p){5!==p.Resolution||p.Binding?o.push(new me(e,p,!1)):d.push(new me(e,p,!0))}),_.isEmpty(d)||_.forEach(d,function(p){_.forEach(o,function(S){if(function(e,i){return i.startIndex<=e.startIndex&&i.endExcludingIndex>e.startIndex||i.startIndex<e.endExcludingIndex&&i.endExcludingIndex>e.endExcludingIndex||e.startIndex<=i.startIndex&&e.endExcludingIndex>=i.endExcludingIndex||i.startIndex<=e.startIndex&&i.endExcludingIndex>=e.endExcludingIndex}(S,p))S.overlapSpans.push(p);else if(p.endExcludingIndex<S.startIndex)return})}),o}}function Ne(e){return"BadGateway"===e||"ConnectFailure"===e||"ConnectionClosed"===e||"GatewayTimeout"===e||"KeepAliveFailure"===e||"NameResolutionFailure"===e||"NetworkUnavailable"===e||"ProxyAuthenticationRequired"===e||"ProxyNameResolutionFailure"===e||"RequestTimeout"===e||"ServiceUnvailable"===e||"Timeout"===e||"AccessDenied"===e?"NetworkConnectionIssue":"FeatureNotAvailableError"===e?"FeatureNotAvailable":"GenericRequestFailure"}function we(e){return _.map(e,function(i){return{startIndex:i.StartIndex,endExcludingIndex:i.StartIndex+i.Length}})}function Ue(e){var i=oe(e);return e&&(i.Context={ReportMetadata:Le(e.reportMetadata)}),i}function Oe(e,i,o){var d=oe(e);return d.Context={ModelScopes:[{VirtualServerName:i,DatabaseName:o}],Tags:e?.tags,ImpersonatedUserPrincipalName:e?.impersonatedUserPrincipalName,ImpersonatedRoles:e?.impersonatedRoles,Feedback:Te(e?.feedback)},d.Options||(d.Options={}),d}function oe(e){return e?{Version:"3.3.0",Utterance:e.utterance,Spans:_.map(e.spans,function(i){var o={StartIndex:i.startIndex,Length:i.endExcludingIndex-i.startIndex};return i.inferredTerm&&(o.Binding={InferredTerm:be(i.inferredTerm)}),o}),Options:We(e),LinguisticSchemaJson:e.linguisticSchemaJson,InferredTermBinding:be(e.inferredTermBinding),Intent:ve(e.intent),IsCommitted:e.isCommitted,DesiredInterpretationsCount:e.desiredInterpretationsCount,GroupId:e.groupId,GroupSequenceNumber:e.groupSequenceNumber}:{Version:"3.3.0",Utterance:""}}function ve(e){if(e?.defineCalculation)return{DefineCalculation:{Language:e.defineCalculation.language,Options:e.defineCalculation.options}}}function We(e){return null==e?.options?{}:{QueryMetadata:(0,T.yE)(e.options,2),VisualConfiguration:(0,T.yE)(e.options,4),SupportPodQueries:(0,T.yE)(e.options,8),IncludeRelevantSchemaElements:(0,T.yE)(e.options,32),Spans:(0,T.yE)(e.options,64),Diagnostics:(0,T.yE)(e.options,128),FrameTree:!1,AllowFollowUpQuestion:!1,AllowInsightQueries:(0,T.yE)(e.options,512),InferUnknownModelTerms:(0,T.yE)(e.options,4096),AllowPlaceholderSuggestions:!1,SuggestFollowUp:!1,SuggestedUtterances:(0,T.yE)(e.options,2048),SkipCompletion:e.skipCompletion,SingleAnswerBias:(0,T.yE)(e.options,8192),SuggestedDefineCalculationUtterances:(0,T.yE)(e.options,16384),UseLlmParser:(0,T.yE)(e.options,65536)}}function fe(e){return _.map(e,function(i){var o,d;return{VirtualServerName:null===(o=i.model)||void 0===o?void 0:o.vsName,DatabaseName:null===(d=i.model)||void 0===d?void 0:d.dbName,ReportIds:i.reportIds}})}function Be(e){if(_.indexOf(e,27)>=0)return[];var i=_.intersection(e,Re);return _.map(i,function(o){return{warning:o,messageKey:Y[o]}})}function ge(e,i){if(!_.isEmpty(e)){h.fF.assert(function(){return!_.isEmpty(i)},"Must provide a valid qnaProxyPath");for(var o=[],d="@powerbi/Qna/qnadesktop.module#QnaDesktopModule"===i?J:K,p=0,S=e;p<S.length;p++){var M=S[p];if(d){var I=d[M];if(I){o.push(I);continue}}var N=Y[M];N&&o.push(N)}return _.uniq(o)}}function te(e,i){return i.get(_e[e]||"Qna_Error_GenericRequestFailure")}function ae(e){var i,o;if(h.fF.assertValue(e,"Expect the given wireV3Response to be defined"),"3.3.0"!==e.Version)i="RequiresNewerVersion";else{var d=_.first(e.Results);if(!d)return;o=_.find(d.DiagnosticMessages,function(M){return 1===M.Severity}),i=o?.Code}if(null!=i){var p=function(e){var i=k[e];return h.fF.assert(function(){return null!=i},"InterpretDiagnosticCodeToQnaErrorCodeMappings should contain key "+e),i||(i="NoClientHandling"),i}(i),S={errorCode:p,source:"GenericRequestFailure"===p?"PowerBI":"User",message:o?.Message,stackTrace:o?.StackTrace};return"NoClientHandling"===S.errorCode&&(S.message=_.isEmpty(S.message)?i+".":i+". "+S.message),S}}function se(e){if(!_.isEmpty(e)){for(var i=[],d=function(N){h.fF.assert(function(){return null!=w[N.Code]},'unknown mapping to convert InterpretDiagnosticMessage "'+N.Code+'" to client interpret warning code'),w[N.Code]&&i.push(w[N.Code])},p=0,S=e.filter(function(I){return 2===I.Severity});p<S.length;p++)d(S[p]);return i}}var me=function(){return function(i,o,d){this.utterance=i,this.wireSpan=o,this.isOverlappingSpan=d,this.startIndex=o.StartIndex,this.endExcludingIndex=o.StartIndex+o.Length,this.text=i.substr(o.StartIndex,o.Length),this.correctedStartIndex=o.CorrectedStartIndex,this.correctedEndExcludingIndex=null!=o.CorrectedStartIndex?o.CorrectedStartIndex+o.CorrectedLength:void 0,this.resolution=o.Resolution,this.isOverlapping=d,this.tokens=function(e,i,o){return _.map(o,function(d){var p=d.StartIndex-i;return h.fF.assert(function(){return _.inRange(p,0,_.size(e))},"Expect each token.StartIndex is a valid index with the given spanText and spanStartIndex"),h.fF.assert(function(){return!_.isEmpty(_.trim(e.substr(p,d.Length)))},"Expect no WireToken being pure space"),{startIndex:d.StartIndex,endExcludingIndex:d.StartIndex+d.Length,text:e.substr(p,d.Length)}})}(this.text,this.startIndex,o.Tokens);var p=xe(this.text,o.Binding);this.binding=p&&p.bindingInfo,this.isCorrected=!(!this.binding||!p.isCorrected);var S=ne(this.text,o.AlternateBindings),M=ne(this.text,o.PhraseCompletions),I=ne(this.text,o.PhraseExtensions),N=ne(this.text,o.SuggestedReplacements);(!_.isEmpty(S)||!_.isEmpty(M)||!_.isEmpty(I)||!_.isEmpty(N))&&(this.replacementBindings={alternates:S,phraseCompletions:M,phraseExtensions:I,suggestedReplacements:N}),this.inferredTermBindings=_.map(o.InferredTermBindings,function($){return{inferredBindingType:(e=$.InferredTerm).Type,definitionPrompt:e.DefinitionPrompt,definitionText:e.DefinitionText,prefixText:e.PrefixText,suffixText:e.SuffixText,hintText:e.HintText,alternateDefinitionTexts:e.AlternateDefinitionTexts,linguisticSchemaItems:e.LinguisticSchemaItems,definedTerm:e.DefinedTerm,targetRole:e.TargetRole,metadata:e.Metadata};var e}),this.inferredTermBindingsUnsupported=o.InferredTermBindingsUnsupported,this.hasBinding=null!=this.binding||null!=this.replacementBindings||!_.isEmpty(this.inferredTermBindings),this.isWhiteSpace=!_.isEmpty(this.text)&&_.isEmpty(_.trim(this.text)),this.isUsed=!this.isOverlapping&&(null==this.resolution||0===this.resolution||4===this.resolution),this.isUnknown=3===this.resolution,this.isInferred=4===this.resolution,this.overlapSpans=[];var e,z=!((e=this).isOverlapping||_.isEmpty(e.text)||Se(e)||Ie(e)||Ee(e))&&e.hasBinding&&e.isUsed,G=Ee(this);h.fF.assert(function(){return!(z&&G)},"A span can not be definedWithOptions and undefinedWithOptions at the same time."),this.state=z?"accepted":G&&this.isUsed?"warning":G?"error":"none"}}();function ze(e){if(e){var i=e.Query?P.ib.deserializeQuery(e.Query):void 0;return{query:i,queryMetadata:ye(i,e.QueryMetadata),data:e.Data,binding:e.Binding,visualConfigurations:_.map(e.VisualConfigurations,function(d){var p=d.Query?P.ib.deserializeQuery(d.Query):void 0;return{visualizationType:d.VisualizationType,dataShapeBinding:d.DataShapeBinding,visualElements:d.VisualElements,query:p,queryMetadata:ye(i,d.QueryMetadata)}}),suggestedVisualTypes:_.map(e.SuggestedVisualizations,function(d){return(0,c.s)(d.VisualizationType).name}),linguisticSchemaJson:e.LinguisticSchemaJson,linguisticSchemaItems:e.LinguisticSchemaItems,inferredTermMetadata:e.InferredTermMetadata,defineCalculation:he(e.DefineCalculation)}}}function he(e){if(e)return{expression:e.Expression,homeTable:e.HomeTable,format:e.Format}}function ye(e,i){if(e&&i){var o=_.filter(i.Filters,function(p){return!!p}),d=_.filter(i.Select,function(p){return!!p});return{filters:_.map(o,function(p){return{Restatement:p.Restatement,type:void 0}}),selects:_.map(d,function(p){return{restatement:p.Restatement,valueType:$e(p.DefaultLabel?p.DefaultLabel.SemanticType:p.SemanticType),isGroup:p.IsGroup,defaultLabel:p.DefaultLabel?Ce(p.DefaultLabel.Expression,e):void 0,isExplicitSortBy:p.IsExplicitSortBy}})}}}function Se(e){var i,o;return 7===(null===(i=e.binding)||void 0===i?void 0:i.type)&&!e.isCorrected&&_.isEmpty(null===(o=e.replacementBindings)||void 0===o?void 0:o.suggestedReplacements)&&_.isEmpty(e.inferredTermBindings)}function Ie(e){var i,o;return 8===(null===(i=e.binding)||void 0===i?void 0:i.type)&&!e.isCorrected&&2===e.resolution&&_.isEmpty(null===(o=e.replacementBindings)||void 0===o?void 0:o.suggestedReplacements)&&_.isEmpty(e.inferredTermBindings)}function Ee(e){return!(e.isOverlapping||_.isEmpty(e.text)||Se(e)||Ie(e)||!(e.isCorrected||3===e.resolution||e.hasBinding&&!e.isUsed))}function xe(e,i){if(i&&!i.InferredTerm){var o,d;if(i.Table)o=i.Table,d=0;else if(i.Pod)o=i.Pod,d=1;else if(i.Property)o=i.Property,d=2;else if(i.Value)o=i.Value,d=3;else if(i.Range)o=i.Range,d=4;else if(i.VisType)o=i.VisType,d=5;else if(i.Composite)o=i.Composite,d=6;else if(i.Core)o=i.Core,d=7;else if(i.Phrasing)o=i.Phrasing,d=8;else if(i.TextualEntity)o=i.TextualEntity,d=9;else{if(!i.AnyEntity){var p=i;return void h.fF.assert(function(){return!!p.Literal},"Has binding type that is unhandled by client right now. Known unhandled types are: [Literal] and this is not a known type. Check to either update the known unhandled type list, or handle it on the client side.")}o=i.AnyEntity,d=10}return{bindingInfo:{type:d,text:o.Text,textSegmentsWithMatchInfo:He(e,o.Text,o.MatchedSegments),matchType:o.MatchType,score:o.Score},isCorrected:o.Corrected}}}function He(e,i,o){if(_.isEmpty(e)||_.isEmpty(o))return[{text:i,isMatched:!1}];for(var d=[],p=0,S=0,M=o;S<M.length;S++){var I=M[S];p<I.StartIndex&&d.push({text:i.substring(p,I.StartIndex),isMatched:!1}),d.push({text:i.substr(I.StartIndex,I.Length),isMatched:!0}),p=I.StartIndex+I.Length}return p<_.size(i)&&d.push({text:i.substring(p),isMatched:!1}),d}function ne(e,i){if(i){for(var o=[],d=0,p=i;d<p.length;d++){var M=xe(e,p[d]);M&&o.push(M.bindingInfo)}return o}}function Te(e){return e?{Sentiment:e.sentiment,Reason:e.reason,Comment:e.comment}:void 0}function Le(e){return e?{LinguisticSchema:e.linguisticSchema,Pods:_.map(e.pods,function(i){return{Name:i.name,CortanaEnabled:i.cortanaEnabled,Parameters:_.map(i.parameters,function(o){return{Name:o.name,TargetColumn:o.targetColumn,TargetEntity:o.targetEntity}})}})}:void 0}function be(e){return null==e?void 0:{Type:e.inferredBindingType,DefinitionPrompt:e.definitionPrompt,DefinitionText:e.definitionText,PrefixText:e.prefixText,SuffixText:e.suffixText,HintText:e.hintText,AlternateDefinitionTexts:e.alternateDefinitionTexts,LinguisticSchemaItems:e.linguisticSchemaItems,DefinedTerm:e.definedTerm,TargetRole:e.targetRole,Metadata:e.metadata}}function Je(e){h.fF.assertValue(e,"result");var i=e.CorrectedUtterance;if(!_.isEmpty(i)){var d=e.ReplacementUtterance,p=2;return!!e.Command||(e.ConfidenceLevel<=5?p=0:e.ConfidenceLevel<=20&&(p=1)),_.isEmpty(e.CorrectedUtteranceTextSegments)?{correctedUtterance:i,replacementUtterance:d||i,state:p}:{correctedUtterance:i,correctedTextSegments:we(e.CorrectedUtteranceTextSegments),state:p}}}function $e(e){switch(e){case 0:case 1:case 2:case 3:return;case 4:return F.Ge.fromExtendedType(7078913);case 5:return F.Ge.fromDescriptor({dateTime:!0});case 6:return F.Ge.fromDescriptor({numeric:!0})}}function Ce(e,i){var o=P.ib.serializeQuery(i);o.Select.push(e);var d=P.ib.deserializeQuery(o);return _.last(d.select()).expr}}}]);