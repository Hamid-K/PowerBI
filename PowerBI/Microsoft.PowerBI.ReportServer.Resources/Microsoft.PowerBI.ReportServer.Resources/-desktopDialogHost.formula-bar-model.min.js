"use strict";(self.webpackChunkdesktopDialogHost=self.webpackChunkdesktopDialogHost||[]).push([["formula-bar-model"],{48563:function(ot,j,e){e.d(j,{w:function(){return z}});var c=e(17819);function z(M){return M.map(function(m){return function(M){return{name:M.Name,description:M.Description,category:P(M.Category),pushableToDQ:d(M.PushableToDirectQuery),parameters:b(M.Parameters),visualCalculationsInfo:M.VisualCalculationsInfo}}(m)})}function P(M){switch(M){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9}}function d(M){var m=0;return 1===M?m=1:2===M?m=2:3===M&&(m=3),m}function b(M){return M?M.map(function(m){return function(M){return new c.Hw(M.Name,M.Optional,M.Repeatable,M.RepeatGroup,M.Skippable)}(m)}):[]}},64018:function(ot,j,e){e.d(j,{L:function(){return Zt}});var c=e(81337),z=e(15903),y=e(81892),P="padding-left",d="padding-right",b="padding-top",w="padding-bottom",M="margin-left",m="margin-right",p="margin-top",H="margin-bottom",W="border-left-width",g="border-right-width",T="border-top-width",tt="border-bottom-width";function x(o,n){return 1===n?parseInt(o.css(P),10)+parseInt(o.css(d),10):parseInt(o.css(b),10)+parseInt(o.css(w),10)}function f(o,n){return 1===n?parseInt(o.css(M),10)+parseInt(o.css(m),10):parseInt(o.css(p),10)+parseInt(o.css(H),10)}function E(o,n){return 1===n?parseInt(o.css(W),10)+parseInt(o.css(g),10):parseInt(o.css(T),10)+parseInt(o.css(tt),10)}function F(o){return parseInt(o.css("minWidth"),10)}function X(o,n,i){for(var l=f(o,i),B=$("html")[0],O=o.parent();O.length>0&&O[0]!==B&&O[0]!==n[0];)l=l+x(O,i)+E(O,i)+f(O,i),O=O.parent();return O[0]===n[0]?l=l+x(O,i)+E(O,i):0}var v=e(26124),t=e(50423),rt=e(47786),st=e(74249),ht=e(62458),pt=e(2951),et=e(25261),dt=e(1685),_t=e(30794),gt=e(35510),mt=e(82762),yt=e(59017),bt=e(77526),Ot=e(14172),Ct=e(83317),xt=e(64647),Pt=e(83309),St=e(15783),Bt=e(65181),C=e(85270),r=e(77476),a=e(17174),s=e(59968),u=e(36858),h=e(45916),D=e(698),N=e(35756),G=e(20551),R=e(64716),k=e(85721),J=e(74913),Ft=e(4715),Mt=e(21571),L=e(73221),Y=e(98665),Z=e(64560),Q=e(25512),at=e(48787),U=e(5467),q=e(85102);function vt(o,n){if(1&o){var i=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",1),t.\u0275\u0275listener("click",function(B){t.\u0275\u0275restoreView(i);var O=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(O.showTemplatesMenu(B))}),t.\u0275\u0275pipe(1,"localize"),t.\u0275\u0275element(2,"tri-svg-icon",2),t.\u0275\u0275elementEnd()}2&o&&t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(1,1,"Visual_Calculation_Template_Button_Tooltip"))}var lt=function(o){function n(i,l,B,O){var A=o.call(this)||this;return A.elementRef=i,A.pbiMenuService=l,A.localizationService=B,A.telemetryService=O,A.selectedTemplate=new t.EventEmitter,A.showButton$=new gt.X(!1),A}return(0,c.__extends)(n,o),n.prototype.ngOnInit=function(){var i=this;this.changes$("daxTemplates").pipe((0,Ct.R)(this.onDestroy$)).subscribe(function(l){i.createTemplateMenu(l)})},n.prototype.showTemplatesMenu=function(i){var l=this;i.preventDefault();var B=this.templatingMenu;null!=B&&0!==B.items.length&&this.pbiMenuService.open({menu:B,origin:this.elementRef.nativeElement,flexibleConnectedPositions:[(0,Q.Oq)(0,0)],closeOnButtonClick:!0,menuMode:Z.Kb.Compact}).onButtonClick$.pipe((0,at.q)(1)).subscribe(function(A){var nt=A.data;l.selectedTemplate.emit(nt),l.telemetryService.logEvent(Ft.Zs,{templateName:nt.capabilities.name})})},n.prototype.createTemplateMenu=function(i){var l=this,B=_.map(i,function(O){var A=O.capabilities;return{type:Z.iB.Button,id:A.name,text:(0,Mt.G)(A.displayName,l.localizationService),tooltip:(0,Mt.G)(A.description,l.localizationService),data:O}});this.templatingMenu={items:B},this.showButton$.next(B.length>0)},n.\u0275fac=function(l){return new(l||n)(t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(U.o),t.\u0275\u0275directiveInject(Bt.o),t.\u0275\u0275directiveInject(Y.y0))},n.\u0275cmp=t.\u0275\u0275defineComponent({type:n,selectors:[["template-button"]],inputs:{daxTemplates:"daxTemplates"},outputs:{selectedTemplate:"selectedTemplate"},features:[t.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","templateButton","tabindex","0",3,"pbiTooltip","click",4,"ngIf"],["tabindex","0",1,"templateButton",3,"pbiTooltip","click"],["tri-svg-icon-24","","name","math_formula_20_regular","sprite","visual-calc-icons"]],template:function(l,B){1&l&&(t.\u0275\u0275template(0,vt,3,3,"button",0),t.\u0275\u0275pipe(1,"async")),2&l&&t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(1,1,B.showButton$))},dependencies:[r.NgIf,u.V,J.M,r.AsyncPipe,q.F],styles:[".templateButton[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:24px;background-color:transparent}.templateButton[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2)}.templateButton[_ngcontent-%COMP%]:hover{background:var(--colorNeutralBackground1Hover)}.templateButton[_ngcontent-%COMP%]:hover   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Hover)}.templateButton[_ngcontent-%COMP%]:active   tri-svg-icon[_ngcontent-%COMP%]{color:var(--colorNeutralForeground2Pressed)}"]}),n}(L.w),kt=["monacoEditorHostContainer"];function zt(o,n){if(1&o){var i=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"monaco-editor-host",21),t.\u0275\u0275listener("initialized",function(){t.\u0275\u0275restoreView(i);var A=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(A.onMonacoEditorInitialized())})("tabFocusMode",function(A){t.\u0275\u0275restoreView(i);var nt=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(nt.onTabFocusModeChanged(A))})("onContentChanged",function(A){t.\u0275\u0275restoreView(i);var nt=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(nt.onContentChanged(A))})("onContentHeightChanged",function(A){t.\u0275\u0275restoreView(i);var nt=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(nt.onContentHeightChanged(A))})("onFocus",function(){t.\u0275\u0275restoreView(i);var A=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(A.onEditorFocus())}),t.\u0275\u0275elementEnd()}if(2&o){var l=n.ngIf,B=t.\u0275\u0275nextContext();t.\u0275\u0275property("selection",B.editorHost.selection)("isReadOnly",B.isReadOnly)("formulaText",B.editorHost.text)("languageOptions",l)("hidden",!B.isEditorEnabled)}}function At(o,n){if(1&o){var i=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"button",22),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(i);var B=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(B.toggleTabMovesFocus())}),t.\u0275\u0275pipe(1,"localize"),t.\u0275\u0275elementEnd()}2&o&&t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(1,1,"Tab_Moves_Focus_Toggle"))}function Rt(o,n){if(1&o&&(t.\u0275\u0275elementStart(0,"div",23),t.\u0275\u0275element(1,"pbi-svg-use-symbol",24)(2,"tri-svg-icon",25)(3,"textarea",26),t.\u0275\u0275elementEnd()),2&o){var i=t.\u0275\u0275nextContext();t.\u0275\u0275advance(3),t.\u0275\u0275property("pbiTooltip",i.alertText)("ngModel",i.alertText),t.\u0275\u0275attribute("aria-label",i.alertText)}}function Ut(o,n){if(1&o&&(t.\u0275\u0275elementStart(0,"tri-dropdown-trigger"),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"localize"),t.\u0275\u0275pipe(3,"async"),t.\u0275\u0275elementEnd()),2&o){var i=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(2,1,t.\u0275\u0275pipeBind1(3,3,i.selectedEditModeOption$).displayName)," ")}}function jt(o,n){if(1&o&&(t.\u0275\u0275elementStart(0,"tri-dropdown-item",27),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"localize"),t.\u0275\u0275elementEnd()),2&o){var i=n.$implicit;t.\u0275\u0275property("value",i),t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(2,2,i.displayName)," ")}}var Tt="monaco-editor-host",Dt=".formulaBarButtons",Nt=".formulaBarController",Gt=[".formulaBarEditorContainer",Dt,"ribbon [data-unique-id='clipboardGroupMlr'], ribbon [data-unique-id='clipboardGroupSlr'], .ms-Callout #FlyoutMenuId","ribbon [data-automation-type='RibbonTab'][data-unique-id='home']"],Zt=function(){function o(n,i,l,B,O,A,nt,Qt,Xt){var it=this;this.element=n,this.highContrastCssGenerationService=i,this.formulaBarService=l,this.localizationService=B,this.screenReaderService=O,this.formulaBarInteractionService=A,this.cdr=nt,this.daxCapabilitiesService=Qt,this.formulaBarZoomService=Xt,this.catchOutsideClickEventCallBack=function(ut){return!1},this.implicitEndEditingOnBlur=!0,this.navMode="Group",this.daxTemplates=[],this.beginEdit=new t.EventEmitter,this.endEdit=new t.EventEmitter,this.templateSelected=new t.EventEmitter,this.editorHost={},this.formulaBarDropdownConfigurations=[],this.destroy$=new _t.xQ,this._dropdownOptions$=new gt.X(void 0),this._dropdownVisible$=new gt.X(!1),this._selectedEditModeOption$=new gt.X(void 0),this.onDocumentMouseDownCapture=function(ut){it.lastCapturedMousedownEvent=ut,wt(ut.target)||it.formulaBarService.hasUnsavedChanges(it.getCurrentEditorText())&&ut.stopImmediatePropagation()},this.onDocumentClickCapture=function(ut){var Et=it.lastCapturedMousedownEvent&&it.lastCapturedMousedownEvent.target;it.lastCapturedMousedownEvent=void 0;var It=!Et||wt(Et),Jt=wt(ut.target);It||Jt||it.catchOutsideClickEventCallBack(ut)||(it.formulaBarService.hasUnsavedChanges(it.getCurrentEditorText())&&(ut.stopPropagation(),ut.preventDefault()),it.onBlur())},this.triDropdownOptions={panelClass:y.Uu},this.expandedState=1,this.languageOptions$=(0,mt.D)(this.daxCapabilitiesService.getCapabilities())}return Object.defineProperty(o.prototype,"selectedEditModeOption$",{get:function(){return this._selectedEditModeOption$},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"editMode$",{get:function(){return this._selectedEditModeOption$.pipe((0,bt.x)(),(0,Ot.U)(function(i){return i?.key}))},enumerable:!1,configurable:!0}),o.prototype.setEditMode=function(n){var i=this.formulaBarDropdownConfigurations.findIndex(function(l){return l.key===n});(0,rt.hu)(i>-1,"Invalid calculation edit mode"),this._selectedEditModeOption$.next(this.formulaBarDropdownConfigurations[i])},Object.defineProperty(o.prototype,"editModeOptions$",{get:function(){return this._dropdownOptions$.asObservable()},enumerable:!1,configurable:!0}),o.prototype.setEditModeOptions=function(n){this._dropdownOptions$.next(n),this._selectedEditModeOption$.next(void 0)},Object.defineProperty(o.prototype,"showEditModeSelector$",{get:function(){return this._dropdownVisible$.asObservable()},enumerable:!1,configurable:!0}),o.prototype.showEditModeSelector=function(n){this._dropdownVisible$.next(n)},o.prototype.ngOnInit=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var n=this;return(0,c.__generator)(this,function(i){switch(i.label){case 0:return this.initializeHighContrastRules(),this.isHidden=this.autoHide,this.setReadOnly(!0),(0,yt.aj)([this._dropdownOptions$,this._dropdownVisible$]).pipe((0,Ct.R)(this.destroy$)).subscribe(function(l){var O=l[1];n.formulaBarDropdownConfigurations=l[0],n.formulaDropdownWidth=O?F($(".dropdownContainer")):0,n.recalculateOffset(),n.onResize()}),[4,this.formulaBarService.setUICulture()];case 1:return i.sent(),[2]}})})},o.prototype.ngAfterViewInit=function(){var n=this;this.formulaBarService.registerFormulaBarControl(this),this.formulaBarInteractionService.registerFormulaBarInteractionControl(this),this.resizeObserver=new ResizeObserver(function(){window.requestAnimationFrame(function(){n.onResize()})}),this.resizeObserver.observe(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass))},o.prototype.ngOnDestroy=function(){$(this.element.nativeElement).off(Nt),$(this.monacoEditorHostContainer.nativeElement).off(Nt),this.destroy$.next(),this.destroy$.complete(),this.resizeObserver&&(this.resizeObserver.unobserve(this.element.nativeElement.closest(this.expandCollapseConfig.formulaBarParentClass)),this.resizeObserver.disconnect())},o.prototype.initializeHighContrastRules=function(){this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarButtons","{ background-color: @buttonBackgroundColor !important; border-color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert, formula-bar .formulaBar .formulaBarAlert .messageAlert","{ background-color: @backgroundColor !important; color: @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarAlert","{ border: 1px solid @foregroundColor !important; }"),this.highContrastCssGenerationService.addRule("formula-bar .formulaBar .formulaBarEditorContainer","{ background-color: @backgroundColor !important; }")},Object.defineProperty(o.prototype,"willCollapse",{get:function(){return 0===this.nextExpandCollapseState},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isEditorEnabled",{get:function(){return!!this.lastCommittedFormulaText||this.isEditing},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"formulaBarExpanderTooltip",{get:function(){var i,l="Formula_Bar_ExpandToFull";switch(this.nextExpandCollapseState){case 0:l="Formula_Bar_CollapseToSingleLine";break;case 1:l="Formula_Bar_ExpandToFit";break;case 2:l=null!==(i=this.expandCollapseConfig.fullyExpandedTooltip)&&void 0!==i?i:"Formula_Bar_ExpandToFull"}return this.localizationService.get(l)},enumerable:!1,configurable:!0}),o.prototype.setReadOnly=function(n){this.isReadOnly=n},o.prototype.onMonacoEditorInitialized=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var n,i,l;return(0,c.__generator)(this,function(B){switch(B.label){case 0:return this.monacoEditorInitialized=!0,n=$(this.element.nativeElement),i=function(o){return parseInt(o.css("min-height"),10)}(n),l=function(o){return parseInt(o.css("max-height"),10)}(n),this.monacoEditorUtility=new pt.j0(this.textEditorHost.textEditor),[4,this.textEditorHost.registerActions(this.getKeyboardActions())];case 1:return B.sent(),this.textEditorHeightOffset=this.calculateTextEditorHeightOffset(),this.recalculateOffset(),this.textEditorFullExpandHeight=l-this.textEditorHeightOffset,this.textEditorCollapsedHeight=i-this.textEditorHeightOffset,this.targetEditorHeight=this.textEditorCollapsedHeight,this.onContentHeightChanged(this.textEditorHost.textEditor.getContentHeight()),this.onResize(),this.focusOnInitialized&&this.focus(),[2]}})})},o.prototype.calculateTextEditorHeightOffset=function(){var n=$(this.element.nativeElement);return X(n.find(Tt),n,0)},o.prototype.onTabFocusModeChanged=function(n){this.tabMovesFocus=n},o.prototype.updateEditorExpandedHeight=function(){var n,i,l=this.alertText?20:0,B=this.expandCollapseConfig.formulaBarParentClass,O=null!==(n=this.expandCollapseConfig.expandScaleFactor)&&void 0!==n?n:1,A=null!==(i=this.expandCollapseConfig.expandOffet)&&void 0!==i?i:-80,nt=O*$(this.element.nativeElement).closest(B).height()+A;this.textEditorFullExpandHeight=nt-this.textEditorHeightOffset-l},o.prototype.updateFormulaBarMaxHeight=function(){var n=this.alertText?20:0,i=1e7;0===this.expandedState?i=this.textEditorCollapsedHeight+this.textEditorHeightOffset+n:1===this.expandedState&&(i=this.targetEditorHeight+this.textEditorHeightOffset+n),ht.fF.assertValue(i,"maxHeight"),$(this.element.nativeElement).css("max-height",i)},o.prototype.show=function(){this.isHidden&&(this.isHidden=!1,this.cdr.detectChanges())},o.prototype.hide=function(){this.isHidden||(this.isHidden=!0)},o.prototype.clear=function(){this.setCommittedFormulaBarText(""),this.autoHide&&this.hide()},o.prototype.setSelection=function(n){this.editorHost.selection=n,this.cdr.detectChanges()},o.prototype.showAlertMessage=function(n){n=n.replace(/\n/g,""),this.alertText=n,this.screenReaderService.alert(this.localizationService.format("Formula_Bar_Warning_Aria",n)),this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},o.prototype.toggleTabMovesFocus=function(){this.textEditorHost.toggleTabMovesFocus(),this.textEditorHost.focus()},o.prototype.hideAlert=function(){this.alertText=void 0,this.updateFormulaBarMaxHeight(),this.cdr.detectChanges()},o.prototype.setCommittedFormulaBarText=function(n){this.lastCommittedFormulaText=n,this.editorHost.text=n,this.cdr.detectChanges()},o.prototype.focus=function(){this.monacoEditorInitialized?(this.textEditorHost.focus(),this.cdr.detectChanges()):this.focusOnInitialized=!0},o.prototype.scrollTop=function(){this.monacoEditorInitialized&&this.textEditorHost.scrollTop()},o.prototype.copy=function(){this.textEditorHost.copy()},o.prototype.cut=function(){this.textEditorHost.cut()},o.prototype.paste=function(n){this.textEditorHost.paste(n)},o.prototype.resetModelTokens=function(n){this.textEditorHost.resetModelTokens(n)},o.prototype.isFormulaBarActive=function(){return this.isActive},o.prototype.onToggleExpandCollapse=function(){this.setExpandCollapseState(this.nextExpandCollapseState)},o.prototype.setExpandCollapseState=function(n){switch(n){case 0:this.collapse();break;case 1:this.fitToContent();break;case 2:this.fullExpand()}this.calculateNextExpandCollapseState()},o.prototype.calculateNextExpandCollapseState=function(){switch(this.expandedState){case 0:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?2:1;break;case 1:this.nextExpandCollapseState=this.editorContentHeight>=this.textEditorFullExpandHeight?0:this.editorContentHeight<=this.textEditorCollapsedHeight||this.isEditing?2:0;break;case 2:this.nextExpandCollapseState=this.editorContentHeight<=this.textEditorCollapsedHeight?1:0;break;default:ht.fF.assertNever(this.expandedState)}},o.prototype.fullExpand=function(){this.expandedState=2,this.updateEditorExpandedHeight(),this.layout(void 0,this.textEditorFullExpandHeight)},o.prototype.fitToContent=function(){this.expandedState=1,this.updateEditorExpandedHeight(),this.targetEditorHeight=Math.max(this.textEditorCollapsedHeight,Math.min(this.textEditorFullExpandHeight,this.editorContentHeight)),this.layout(void 0,this.targetEditorHeight)},o.prototype.collapse=function(){this.expandedState=0,this.layout(void 0,this.textEditorCollapsedHeight)},o.prototype.layout=function(n,i){this.updateFormulaBarMaxHeight(),this.monacoEditorInitialized&&this.textEditorHost.layout(n,i)},o.prototype.recalculateOffset=function(){var n,i=$(Dt),l=$(this.element.nativeElement),B=l.find(Tt);this.textEditorWidthOffset=X(B,l,1)+F(i)+f(i,1)+(null!==(n=this.formulaDropdownWidth)&&void 0!==n?n:0)},o.prototype.commitFormulaBarEdit=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var n;return(0,c.__generator)(this,function(i){switch(i.label){case 0:return this.endFormulaEdit(),(n=this.getCurrentEditorText())===this.lastCommittedFormulaText?[3,2]:(this.lastCommittedFormulaText=n,[4,this.formulaBarService.onSubmit(n)]);case 1:return i.sent(),[3,4];case 2:return[4,this.formulaBarService.onSubmit(n)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},o.prototype.onBlur=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(n){switch(n.label){case 0:return this.implicitEndEditingOnBlur?this.endFormulaEdit():(this.removeFocus(),this.removeCatchClickOutsideFormulaBar()),this.lastCommittedFormulaText=this.monacoEditorInitialized?this.getCurrentEditorText():"",[4,this.formulaBarService.onBlur(this.lastCommittedFormulaText)];case 1:return[2,n.sent()]}})})},o.prototype.removeFocus=function(){$(document.activeElement).blur(),$(document.body).focus()},o.prototype.onContentChanged=function(n){var i=this.monacoEditorUtility.getCursorPosition();this.formulaBarService.onContentChanged(this.monacoEditorUtility.getEditorText(),i.position,i.selectionStart,n)},o.prototype.onContentHeightChanged=function(n){this.editorContentHeight=n+2,(1===this.expandedState||0===this.expandedState&&this.isEditing)&&this.fitToContent(),this.calculateNextExpandCollapseState()},o.prototype.submit=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(n){switch(n.label){case 0:return[4,this.commitFormulaBarEdit()];case 1:return n.sent(),[2]}})})},o.prototype.cancel=function(){this.endFormulaEdit(),this.formulaBarService.onCancel(this.lastCommittedFormulaText),this.autoHide&&this.hide()},o.prototype.onEditorFocus=function(){this.isEditorEnabled&&(this.isReadOnly||this.isEditing?this.implicitEndEditingOnBlur||this.catchClickOutsideFormulaBar():this.beginFormulaEdit(),this.formulaBarService.onEditorFocus())},o.prototype.catchClickOutsideFormulaBar=function(){document.body.addEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.addEventListener("click",this.onDocumentClickCapture,!0),document.body.addEventListener("contextmenu",this.onDocumentClickCapture,!0)},o.prototype.removeCatchClickOutsideFormulaBar=function(){document.body.removeEventListener("mousedown",this.onDocumentMouseDownCapture,!0),document.body.removeEventListener("click",this.onDocumentClickCapture,!0),document.body.removeEventListener("contextmenu",this.onDocumentClickCapture,!0)},o.prototype.endFormulaEdit=function(){this.isEditing=!1,this.removeFocus(),this.removeCatchClickOutsideFormulaBar(),this.endEdit.emit()},o.prototype.beginFormulaEdit=function(){this.isEditing=!0,this.catchClickOutsideFormulaBar(),this.beginEdit.emit()},o.prototype.onResize=function(){var n,i;if(this.monacoEditorInitialized){var l;2===this.expandedState?(this.updateEditorExpandedHeight(),l=this.textEditorFullExpandHeight):1===this.expandedState&&(this.updateEditorExpandedHeight(),l=Math.min(this.textEditorFullExpandHeight,this.targetEditorHeight));var B=this.element.nativeElement.getBoundingClientRect().width||1e3,O=null!==(i=null===(n=this.formulaBarZoomService)||void 0===n?void 0:n.getZoomLevel())&&void 0!==i?i:1;this.layout(B/O-this.textEditorWidthOffset,l)}},o.prototype.selectTemplate=function(n){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(i){switch(i.label){case 0:return[4,this.formulaBarService.onTemplateSelection(n)];case 1:return i.sent(),this.templateSelected.emit(),[2]}})})},o.prototype.insertTextAtCurrentCursor=function(n){this.textEditorHost.insertTextAtCurrentCursor(n)},o.prototype.getCurrentEditorText=function(){return this.textEditorHost.getText()},o.prototype.getHighlightedText=function(){return this.textEditorHost.getHighlightedText()},o.prototype.getKeyboardActions=function(){var n=this;return[{id:"formulaBar.find",label:"Find",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.CtrlF]],run:_.noop},{id:"formulaBar.findNext",label:"Find next",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.F3]],run:_.noop},{id:"formulaBar.findPrevious",label:"Find previous",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.CtrlF3]],run:_.noop},{id:"formulaBar.replace",label:"Replace",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.CtrlH]],run:_.noop},{id:"formulaBar.errorNavigator",label:"Error navigator",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.F8]],run:_.noop},{id:"formulaBar.escape",label:"Escape",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.Escape]],run:function(){var l=n.textEditorHost.textEditor.getSelections();l.length<=1?n.cancel():n.textEditorHost.textEditor.setSelection(l[0])},keybindingContext:"!".concat(pt.B6,"&&!").concat(pt.HW,"&&!").concat(pt.s1)},{id:"formulaBar.submit",label:"Submit",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.CtrlEnter]],run:function(){n.submit()}},{id:"formulaBar.enter",label:"Enter",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.Enter]],run:function(){n.submit()},keybindingContext:"!".concat(pt.HW)},{id:"formulaBar.toggleExpandCollapse",label:"Toggle expand collapse",keybindings:[this.textEditorHost.monacoKeybindingsMap[et.f.CtrlJ]],run:function(){n.onToggleExpandCollapse()}}]},o.\u0275fac=function(i){return new(i||o)(t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(xt.g),t.\u0275\u0275directiveInject(St.B),t.\u0275\u0275directiveInject(Bt.o),t.\u0275\u0275directiveInject(Pt.g),t.\u0275\u0275directiveInject(C.l),t.\u0275\u0275directiveInject(t.ChangeDetectorRef),t.\u0275\u0275directiveInject(st.r),t.\u0275\u0275directiveInject(z.$d,8))},o.\u0275cmp=t.\u0275\u0275defineComponent({type:o,selectors:[["formula-bar"]],viewQuery:function(i,l){if(1&i&&(t.\u0275\u0275viewQuery(kt,7,t.ElementRef),t.\u0275\u0275viewQuery(dt.C,5)),2&i){var B=void 0;t.\u0275\u0275queryRefresh(B=t.\u0275\u0275loadQuery())&&(l.monacoEditorHostContainer=B.first),t.\u0275\u0275queryRefresh(B=t.\u0275\u0275loadQuery())&&(l.textEditorHost=B.first)}},hostVars:1,hostBindings:function(i,l){1&i&&t.\u0275\u0275listener("desktopUIResizeFormulaBar",function(){return l.onResize()}),2&i&&t.\u0275\u0275hostProperty("hidden",l.isHidden)},inputs:{autoHide:"autoHide",isActive:"isActive",catchOutsideClickEventCallBack:"catchOutsideClickEventCallBack",expandCollapseConfig:"expandCollapseConfig",implicitEndEditingOnBlur:"implicitEndEditingOnBlur",navMode:"navMode",shouldAlwaysEnableCancelButton:"shouldAlwaysEnableCancelButton",daxTemplates:"daxTemplates"},outputs:{beginEdit:"beginEdit",endEdit:"endEdit",templateSelected:"templateSelected"},decls:29,vars:42,consts:[["keyboard-shortcuts","ctrl-F6","focus-priority","11",1,"formulaBar",3,"hidden","on-resize"],[1,"formulaBarEditorContainer"],[1,"formulaBarEditor"],["tabindex","0",1,"formulaBarEditorMain",3,"keydown.enter"],["monacoEditorHostContainer",""],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus",4,"ngIf"],["data-unique-id","formula-bar-chevron",1,"formulaBarExpander",3,"disabled","pbiTooltip","click"],["tri-svg-icon-16","","name","chevron_down_16_regular"],[1,"accessibililtyMessages"],["class","message","localize","Tab_Moves_Focus",3,"pbiTooltip","click",4,"ngIf"],["class","formulaBarAlert",4,"ngIf"],[1,"formulaBarDropdown"],[1,"dropdownContainer",3,"compact","options","isDisabled","value","valueChange"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"formulaBarButtons"],["data-unique-id","formula-bar-cancel",1,"formulaBarCancel",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","dismiss_20_regular"],["data-unique-id","formula-bar-commit",1,"formulaBarCommit",3,"pbiTooltip","disabled","click"],["tri-svg-icon-24","","name","checkmark_20_regular"],["data-unique-id","formula-bar-template-button",3,"daxTemplates","selectedTemplate"],["mode","dax","theme","dax",3,"selection","isReadOnly","formulaText","languageOptions","hidden","initialized","tabFocusMode","onContentChanged","onContentHeightChanged","onFocus"],["localize","Tab_Moves_Focus",1,"message",3,"pbiTooltip","click"],[1,"formulaBarAlert"],["symbolId","alert","sheet","filterPaneIcons",1,"imageAlert"],["tri-svg-icon-16","","name","dismiss_circle_16_filled"],["data-unique-id","formula-bar-alert","row","1","cols","1","readonly","","pbiTooltipPosition","below",1,"messageAlert",3,"pbiTooltip","ngModel"],[3,"value"]],template:function(i,l){1&i&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275listener("on-resize",function(){return l.onResize()}),t.\u0275\u0275pipe(1,"localize"),t.\u0275\u0275elementStart(2,"div",1)(3,"div",2)(4,"div",3,4),t.\u0275\u0275listener("keydown.enter",function(){return l.focus()}),t.\u0275\u0275template(6,zt,1,5,"monaco-editor-host",5),t.\u0275\u0275pipe(7,"async"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(8,"button",6),t.\u0275\u0275listener("click",function(){return l.onToggleExpandCollapse()}),t.\u0275\u0275element(9,"tri-svg-icon",7),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(10,"div",8),t.\u0275\u0275template(11,At,2,3,"button",9),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(12,Rt,4,3,"div",10),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(13,"div",11),t.\u0275\u0275pipe(14,"async"),t.\u0275\u0275elementStart(15,"tri-dropdown",12),t.\u0275\u0275listener("valueChange",function(O){return l.setEditMode(O.key)}),t.\u0275\u0275pipe(16,"async"),t.\u0275\u0275template(17,Ut,4,5,"tri-dropdown-trigger",13),t.\u0275\u0275pipe(18,"async"),t.\u0275\u0275template(19,jt,3,4,"tri-dropdown-item",14),t.\u0275\u0275pipe(20,"async"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(21,"div",15)(22,"button",16),t.\u0275\u0275listener("click",function(){return l.cancel()}),t.\u0275\u0275pipe(23,"localize"),t.\u0275\u0275element(24,"tri-svg-icon",17),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(25,"button",18),t.\u0275\u0275listener("click",function(){return l.submit()}),t.\u0275\u0275pipe(26,"localize"),t.\u0275\u0275element(27,"tri-svg-icon",19),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(28,"template-button",20),t.\u0275\u0275listener("selectedTemplate",function(O){return l.selectTemplate(O)}),t.\u0275\u0275elementEnd()()()),2&i&&(t.\u0275\u0275classProp("readonly",l.isReadOnly),t.\u0275\u0275property("hidden",l.isHidden||!l.monacoEditorInitialized),t.\u0275\u0275attribute("focus-nav-mode",l.navMode)("aria-label",t.\u0275\u0275pipeBind1(1,26,"Formula_Bar")),t.\u0275\u0275advance(2),t.\u0275\u0275classProp("hasAlert",l.alertText),t.\u0275\u0275advance(4),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(7,28,l.languageOptions$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("disabled",!l.monacoEditorInitialized||!l.isEditorEnabled)("pbiTooltip",l.formulaBarExpanderTooltip),t.\u0275\u0275advance(1),t.\u0275\u0275property("@chevron",l.nextExpandCollapseState),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",l.tabMovesFocus&&!l.isReadOnly&&l.isEditorEnabled),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",!!l.alertText),t.\u0275\u0275advance(1),t.\u0275\u0275classProp("hideFormulaBarDropdown",!t.\u0275\u0275pipeBind1(14,30,l.showEditModeSelector$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("compact",!0)("options",l.triDropdownOptions)("isDisabled",l.isReadOnly)("value",t.\u0275\u0275pipeBind1(16,32,l.selectedEditModeOption$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(18,34,l.selectedEditModeOption$)),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngForOf",t.\u0275\u0275pipeBind1(20,36,l.editModeOptions$)),t.\u0275\u0275advance(3),t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(23,38,"Cancel_ButtonText"))("disabled",l.shouldAlwaysEnableCancelButton?!l.monacoEditorInitialized:!l.isEditing||!l.monacoEditorInitialized),t.\u0275\u0275advance(3),t.\u0275\u0275property("pbiTooltip",t.\u0275\u0275pipeBind1(26,40,"Commit_ButtonText"))("disabled",!l.isEditing||!l.monacoEditorInitialized),t.\u0275\u0275advance(3),t.\u0275\u0275property("daxTemplates",l.daxTemplates))},dependencies:[r.NgForOf,r.NgIf,a.Fj,a.JJ,a.On,s.X,dt.C,u.V,h.R,D.O,N.q,G.M3,R.l,k.q,G.ii,J.M,lt,r.AsyncPipe,q.F],styles:['[_nghost-%COMP%]{--read-only-button-foreground: var(--fluent-theme-neutral-secondary-alt-color);--read-only-background: var(--fluent-theme-neutral-tertiary-color);--read-only-border-color: var(--fluent-theme-neutral-tertiary-color);--button-background: transparent;--button-foreground: var(--gray-180);--editor-container-border-color: var(--fluent-theme-neutral-tertia-color);--editor-container-background: var(--fluent-theme-white-color);--expander-foreground-hover: var(--fluent-theme-black-color);--accessibility-message-background: var(--fluent-theme-neutral-primary-color);--accessibility-message-foreground: var(--fluent-theme-white-color);--accessibility-message-background-focus: var(--fluent-theme-neutral-tertiary-alt-color);--alert-foreground: var(--fluent-theme-black-color);--alert-background: var(--fluent-theme-warning-background-color);--alert-border: none;--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--fluent-theme-neutral-tertiary-alt-color);--submit-cancel-buttons-background: var(--fluent-theme-white-color);--cancel-button-foreground: var(--fluent-theme-error-dark-color);--commit-button-foreground: var(--fluent-theme-success-icon-color);--gray-host-background: var(--gray-20);--gray-border-color: var(--gray-60);--gray-read-only-background: var(--gray-20);--gray-read-only-border: var(--gray-40);position:relative;padding:4px;min-height:36px;max-height:36px;width:100%;box-sizing:border-box;display:flex;flex-direction:column}[data-legacy-theming=false]   [_nghost-%COMP%]{--read-only-button-foreground: var(--colorNeutralForegroundDisabled);--read-only-background: var(--colorNeutralBackgroundDisabled);--read-only-border-color: var(--colorNeutralStrokeDisabled);--button-background: transparent;--button-foreground: var(--colorNeutralForeground1);--editor-container-border-color: var(--colorNeutralStroke1);--editor-container-background: var(--colorNeutralBackground1);--expander-foreground-hover: var(--colorNeutralStrokeFocus2);--accessibility-message-background: var(--colorCompoundBrandBackground);--accessibility-message-foreground: var(--colorNeutralForegroundOnBrand);--accessibility-message-background-focus: var(--colorCompoundBrandBackgroundHover);--alert-foreground: var(--colorNeutralForeground1);--alert-background: var(--colorDangerBackground1);--alert-border: 1px solid var(--colorDangerBorder1);--alert-icon: var(--fluent-theme-error-fill-color);--submit-cancel-buttons-border: var(--colorNeutralStroke1);--submit-cancel-buttons-background: var(--colorNeutralBackground1);--cancel-button-foreground: var(--colorDangerForeground1);--commit-button-foreground: var(--colorSuccessForeground1);--gray-host-background: var(--colorNeutralBackground3);--gray-border-color: var(--colorNeutralStroke2);--gray-read-only-background: var(--colorNeutralBackground3);--gray-read-only-border: var(--colorNeutralStrokeDisabled)}[hidden][_nghost-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]{flex-grow:1;cursor:default;box-sizing:border-box;display:flex}[_nghost-%COMP%]   .formulaBar[hidden][_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--read-only-button-foreground)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-color:var(--read-only-border-color);background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .monaco-editor[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]{background-color:var(--read-only-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--button-background);color:var(--button-foreground)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:currentcolor}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   [disabled][_ngcontent-%COMP%]{opacity:.4}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{order:1;flex-grow:1;height:100%;display:flex;flex-direction:column;margin-left:3px;min-height:28px;box-sizing:border-box;border:1px solid var(--editor-container-border-color);background-color:var(--editor-container-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer.hasAlert[_ngcontent-%COMP%]{min-height:48px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;padding-top:2px;padding-right:21px;display:flex;flex-direction:column;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]{flex-grow:1;box-sizing:border-box;background-color:transparent;-webkit-user-select:none}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarEditorMain[_ngcontent-%COMP%]:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;width:16px;height:16px;background-color:transparent}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus:not(:disabled){color:var(--expander-foreground-hover)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarEditor[_ngcontent-%COMP%]   .formulaBarExpander[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarEditorContainer .formulaBarEditor .formulaBarExpander *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-left:2px;padding:2px;background-color:var(--accessibility-message-background);color:var(--accessibility-message-foreground);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .accessibililtyMessages[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:focus{background-color:var(--accessibility-message-background-focus)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]{width:100%;height:20px;box-sizing:border-box;color:var(--alert-foreground);background-color:var(--alert-background);outline:var(--alert-border);display:flex;padding-left:2px;align-items:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--alert-icon)}[data-legacy-theming=true]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{width:16px;height:16px}[data-legacy-theming=false]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .imageAlert[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]   .formulaBarAlert[_ngcontent-%COMP%]   .messageAlert[_ngcontent-%COMP%]{cursor:default;flex-grow:1;height:100%;box-sizing:border-box;border:none;padding-top:2px;padding-left:4px;background-color:var(--alert-background);font-family:var(--fluent-font-family, "Segoe UI", "Segoe UI Web (West European)", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif);font-size:11px;resize:none;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]{margin-right:3px;font-size:14px}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown.hideFormulaBarDropdown[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]{min-width:100px;height:28px;box-sizing:border-box}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarDropdown[_ngcontent-%COMP%]   .dropdownContainer[_ngcontent-%COMP%]     button{min-width:inherit;height:inherit}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]{min-width:76px;flex:0;height:28px;box-sizing:border-box;border:1px solid var(--submit-cancel-buttons-border);display:flex;align-items:center;justify-content:space-evenly;background-color:var(--submit-cancel-buttons-background)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:24px;height:24px;display:flex;align-content:center;justify-content:center}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--colorNeutralForegroundDisabled)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled), [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus:not(:disabled){background:var(--colorNeutralBackground1Hover)}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--cancel-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCancel[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCancel *:focus{outline:none}[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   tri-svg-icon[_ngcontent-%COMP%]{fill:var(--commit-button-foreground)}html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=key]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=key] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:var(--focus-two-tone-outline-definition, auto 1px);outline-color:var(--focus-two-tone-outline-color, -webkit-focus-ring-color);outline-offset:0px}html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=mouse]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]:focus, html[data-focus-source=program]   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%]   .formulaBarCommit[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:focus     html[data-focus-source=mouse] -shadowcsshost .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=mouse] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit:focus,   html[data-focus-source=program] -shadowcsshost-no-combinator .formulaBar .formulaBarButtons .formulaBarCommit *:focus{outline:none}.gray-theme   [_nghost-%COMP%]{background-color:var(--gray-host-background)}.gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{border-radius:2px;border-color:var(--gray-border-color)}.gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarButtons[_ngcontent-%COMP%], .gray-theme[_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%], .gray-theme   [_nghost-%COMP%]   .formulaBar.readonly[_ngcontent-%COMP%]   .formulaBarEditorContainer[_ngcontent-%COMP%]{background-color:var(--gray-read-only-background);border-color:var(--gray-read-only-border)}@media print{formula-bar[_ngcontent-%COMP%]   .formulaBar[_ngcontent-%COMP%]{display:none}}'],data:{animation:[(0,v.X$)("chevron",[(0,v.SB)("".concat(0),(0,v.oB)({transform:"rotate(180deg)"})),(0,v.SB)("".concat(2),(0,v.oB)({transform:"rotate(0deg)"})),(0,v.SB)("".concat(1),(0,v.oB)({transform:"rotate(0deg)"})),(0,v.eR)("".concat(1," => ").concat(2,", ").concat(2," => ").concat(1),[(0,v.jt)(150,(0,v.F4)([(0,v.oB)({transform:"rotate(0deg)",offset:0}),(0,v.oB)({transform:"rotate(45deg)",offset:.5}),(0,v.oB)({transform:"rotate(0deg)",offset:1})]))]),(0,v.eR)("* => ".concat(0),[(0,v.jt)(150,(0,v.F4)([(0,v.oB)({transform:"rotate(0deg)",offset:0}),(0,v.oB)({transform:"rotate(180deg)",offset:1})]))]),(0,v.eR)("".concat(0," => *"),[(0,v.jt)(150,(0,v.F4)([(0,v.oB)({transform:"rotate(180deg)",offset:0}),(0,v.oB)({transform:"rotate(0deg)",offset:1})]))])])]}}),o}();function wt(o){return _.some(Gt,function(n){var i=$(o),l=$(n);return l.is(i)||!!l.find(i).length})}},50643:function(ot,j,e){e.r(j),e.d(j,{FormulaBarModelModule:function(){return Bt}});var c=e(17848),z=e(15783),y=e(34103),P=e(72080),d=e(81337),b=e(15903),w=e(98361),M=e(4715),m=e(70863),p=function(){function C(){}return C.areSameItem=function(r,a){return _.isNil(r)&&_.isNil(a)||!!(r&&a&&r.urn===a.urn&&m.pb(r.schemaName,a.schemaName))},C.getEntityName=function(r){return m.wb(r)?r.name:m.t3(r)||m.kb(r)?r.table.name:m.RF(r)?r.calculationGroup.table.name:void 0},C.getPropertyName=function(r){return m.wb(r)?void 0:r.name},C.getEditableSchemaItem=function(r,a){if(a){if(m.wb(r))return this.getTableCalculationItem(a,r.name);if(m.kb(r))return this.getMeasureCalculationItem(a,r.schemaName,r.table.name,r.name);if(m.t3(r))return this.getColumnCalculationItem(a,r.schemaName,r.table.name,r.name);if(m.ez(r)){var s=m.xu(a,r.schemaName,r.hierarchy.table.name,r.hierarchy.name,r.name),u=s&&s.column;return u&&this.getColumnCalculationItem(a,u.schemaName,u.table.name,u.name)}if(m.RF(r))return this.getCalculationItem(a,r.schemaName,r.calculationGroup.table.name,r.name)}},C.getTableCalculationItem=function(r,a){var s=m.AG(r,a);return s&&s.canEdit&&s.isCalculatedTable?s:void 0},C.getColumnCalculationItem=function(r,a,s,u){var h=m.Gz(r,a,s,u);if(h){if(h.canEdit&&h.isCalculated&&!h.isGrouping)return h;if(h.table.canEdit&&h.table.isCalculatedTable)return h.table}},C.getMeasureCalculationItem=function(r,a,s,u){var h=m.yo(r,a,s,u);return h&&h.canEditExpression?h:void 0},C.getCalculationItem=function(r,a,s,u){return m.om(r,a,s,u)},C}(),H=e(81892),W=e(68082),g=e(53439),T=e(16601),tt=e(73027),K=e(62458),ct=e(9738),ft=e(34145),x=e(95867),f=e(98665),E=e(30794),F=e(63057),I=e(14172),S=e(83317),V=e(24874),X=e(59822),v=e(50423),t=e(65181),rt=e(10233),st=e(91069),ht=e(9380),pt=function(C){function r(a,s,u,h,D,N,G,R,k,J,Ft,Mt){var L=C.call(this,u,G,R)||this;return L.modelingSelectionService=a,L.modelService=s,L.dataModelService=h,L.modelAuthoring=D,L.standardizedEventsService=N,L.calculationService=k,L.telemetryService=J,L.deleteModelingService=Ft,L.featureSwitchService=Mt,L.destroy$=new E.xQ,L.isNewCalcItem=!1,L.onModelOrSelectionChanged=function(Y){var Z=Y[0],Q=Y[1],at=Y[2];return(0,d.__awaiter)(L,void 0,void 0,function(){var U;return(0,d.__generator)(this,function(q){switch(q.label){case 0:return Z?[4,this.onModelChanged(Z)]:[3,2];case 1:return q.sent(),[3,6];case 2:return at?[4,this.onCalculationEditModeChanged(at)]:[3,4];case 3:return q.sent(),[3,6];case 4:return Q?(U=_.isEmpty(Q)||1!==Q.length?void 0:Q[0],p.areSameItem(this.calculation,U)?[3,6]:[4,this.onActiveItemChanged(U)]):[3,6];case 5:q.sent(),q.label=6;case 6:return[2]}})})},L.onActiveItemChanged=function(Y){return(0,d.__awaiter)(L,void 0,void 0,function(){var Z,at;return(0,d.__generator)(this,function(U){switch(U.label){case 0:if(!this.formulaBarControl||!this.formulaBarControl.isFormulaBarActive())return[2,this.updateDynamicallyFormattedMeasureStatus()];if(!Y)return[3,14];Z=p.getEditableSchemaItem(Y,this.modelService.model),U.label=1;case 1:return U.trys.push([1,12,,13]),Z?(Z.calculationEditMode=1,[4,this.showCalculation(Z)]):[3,9];case 2:switch(U.sent(),Z.modelObjectType){case"Measure":return[3,3];case"CalculationItem":return[3,5]}return[3,7];case 3:return this.formulaBarControl.setEditModeOptions(H.ZI),this.formulaBarControl.setEditMode(1),[4,this.updateDynamicallyFormattedMeasureStatus()];case 4:return U.sent(),[3,8];case 5:return this.formulaBarControl.setEditModeOptions(H.dO),this.formulaBarControl.setEditMode(1),[4,this.updateDynamicallyFormattedCalculationItemStatus()];case 6:return U.sent(),[3,8];case 7:this.formulaBarControl.showEditModeSelector(!1),this.formulaBarControl.setEditModeOptions([]),U.label=8;case 8:return[3,11];case 9:return[4,this.setCalculation(void 0)];case 10:U.sent(),this.formulaBarControl.setEditModeOptions([]),U.label=11;case 11:return[3,13];case 12:if((at=U.sent()).name!==et.name)throw at;return[3,13];case 13:return[3,16];case 14:return[4,this.setCalculation(void 0)];case 15:U.sent(),U.label=16;case 16:return[2]}})})},L.onCalculationEditModeChanged=function(Y){return(0,d.__awaiter)(L,void 0,void 0,function(){return(0,d.__generator)(this,function(Z){switch(Z.label){case 0:return this.calculation&&Y&&Y!==this.calculation.calculationEditMode?[4,this.updateCalculationEditMode(Y)]:[2];case 1:return Z.sent(),this.formulaBarControl.focus(),[2]}})})},L.onModelChanged=function(Y){return(0,d.__awaiter)(L,void 0,void 0,function(){var Z,Q,at,U;return(0,d.__generator)(this,function(q){switch(q.label){case 0:return this.isNewCalcItem=!!_.find(Y.appliedChanges,"newCalculationItem"),this.calculation?(this.tryToUpdateCalculation(Q=Y.appliedChanges,Z=Y.model),at=p.getEditableSchemaItem(this.calculation,Z),p.areSameItem(this.calculation,at)?[4,this.getCalculationInfo(this.calculation)]:[2,this.setCalculation(void 0)]):[2];case 1:return(U=q.sent())?(this.calculation.isNew=U.isNew,[4,this.updateContents(U.formulaText,U.alertMessage)]):[2,this.setCalculation(void 0)];case 2:return q.sent(),this.formulaBarControl.resetModelTokens(U.formulaText),this.getMeasureSelection()?[4,this.updateDynamicallyFormattedMeasureStatus()]:[3,4];case 3:q.sent(),Q?.find(function(vt){var lt;return"Dynamic"===(null===(lt=vt.setFormatting)||void 0===lt?void 0:lt.format)})&&(this.formulaBarControl.setEditMode(2),this.formulaBarControl.focus()),q.label=4;case 4:return this.getCalculationItemSelection()?[4,this.updateDynamicallyFormattedCalculationItemStatus()]:[3,6];case 5:q.sent(),2!==this.calculation.calculationEditMode&&Q?.find(function(vt){var lt;return'""'===(null===(lt=vt.setFormatString)||void 0===lt?void 0:lt.formatStringExpression)})&&(this.formulaBarControl.setEditMode(2),this.formulaBarControl.focus()),q.label=6;case 6:return[2]}})})},L.standardizedTelemetryFeatureNames=["DynamicFormatString"],L}return(0,d.__extends)(r,C),r.prototype.registerFormulaBarControl=function(a){var s=this;C.prototype.registerFormulaBarControl.call(this,a),(0,F.T)(this.modelService.modelChange$.pipe((0,I.U)(function(u){return[u,void 0,void 0]})),this.modelingSelectionService.selectionChanged.pipe((0,I.U)(function(u){return[void 0,u,void 0]})),this.formulaBarControl.editMode$.pipe((0,I.U)(function(u){return[void 0,void 0,u]}))).pipe((0,S.R)(this.destroy$),(0,V.b)(this.onModelOrSelectionChanged),(0,X.K)(function(u){return(0,d.__awaiter)(s,void 0,void 0,function(){return(0,d.__generator)(this,function(h){return[2,K.fF.assertFail(u)]})})})).subscribe(function(u){})},r.prototype.onContentChanged=function(a){},r.prototype.onTemplateSelection=function(a){},r.prototype.hasUnsavedChanges=function(a){return!!this.calculation&&(this.intellisenseService.analyzeFinalFormulaCommitInfo(a,!1,!0).doCommit||this.calculation.isNew)},r.prototype.commitOrDeletePendingCalculation=function(a){return(0,d.__awaiter)(this,void 0,void 0,function(){var s;return(0,d.__generator)(this,function(u){switch(u.label){case 0:return this.calculation?(s=this.intellisenseService.analyzeFinalFormulaCommitInfo(a,!1,!0)).doCommit?[4,this.commitCalculationUpdate(s)]:[3,2]:[3,4];case 1:case 3:return u.sent(),[2,!0];case 2:return this.calculation.isNew?[4,this.deleteCalculation()]:[3,4];case 4:return[2,!1]}})})},r.prototype.commitCalculationUpdate=function(a){return(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(s){switch(s.label){case 0:return K.fF.assertValue(this.calculation,"we expect this.calculation is neither undefined nor null now."),a.doCommit?(this.contentChanged=!1,2!==this.calculation.calculationEditMode?[3,2]:[4,this.updateCalculationWithFormatString(this.calculation.urn,a.newExpression,a.anonymizedExpression)]):[2];case 1:return s.sent(),[3,4];case 2:return[4,this.calculationService.updateCalculation(this.calculation.urn,a.newName,a.newExpression,a.anonymizedExpression,a.expressionOverride,a.errorMessage)];case 3:s.sent(),s.label=4;case 4:return this.telemetryService.logEvent(M.H2),[2]}})})},r.prototype.updateCalculationWithFormatString=function(a,s,u){return(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(G){switch(G.label){case 0:return K.fF.assertValue(s,"expression cannot be undefined or null"),[4,this.modelAuthoring.apply({changes:[{setFormatString:{formatString:void 0,modelObject:a,formatStringExpression:s||'""',anonymizedExpression:u}}]},!0)];case 1:return G.sent(),this.standardizedEventsService?this.standardizedEventsService.logEvent(this.telemetryService.logEvent(M.gV),this.standardizedTelemetryFeatureNames,!0,{ObjectType:1}):this.telemetryService.logEvent(M.gV),[2]}})})},r.prototype.cancel=function(a){return(0,d.__awaiter)(this,void 0,void 0,function(){var s,u;return(0,d.__generator)(this,function(h){switch(h.label){case 0:return this.calculation?this.calculation.isNew?[4,this.deleteCalculation()]:[3,2]:[3,6];case 1:return h.sent(),[3,6];case 2:return s=this.calculation,[4,this.setCalculation(void 0)];case 3:return h.sent(),[4,this.getCalculationInfo(s)];case 4:return u=h.sent(),[4,this.setCalculation(s,a,u.alertMessage)];case 5:h.sent(),h.label=6;case 6:return[2]}})})},r.prototype.deleteCalculation=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var a,s,u;return(0,d.__generator)(this,function(h){switch(h.label){case 0:return K.fF.assertValue(this.calculation,"we expect this.calculation is neither undefined nor null now."),a=this.calculation,(s=this.calculation).isDeleted?[2]:(s.isDeleted=!0,(u=this.modelService.model)&&p.getEditableSchemaItem(a,u)?(this.deleteModelingService.deleteModelItem([{schema:a.schemaName,tableName:p.getEntityName(a),itemName:p.getPropertyName(a),objectType:a.modelObjectType}],!1),this.contentChanged=!1,[4,this.setCalculation(void 0)]):[3,2]);case 1:h.sent(),h.label=2;case 2:return[2]}})})},r.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},r.prototype.updateCalculationEditMode=function(a){return(0,d.__awaiter)(this,void 0,void 0,function(){var s;return(0,d.__generator)(this,function(u){switch(u.label){case 0:return K.fF.assertValue(a,"Calculation edit mode must be defined"),K.fF.assertValue(this.calculation,"we expect this.calculation not null/undefined now."),(s=_.cloneDeep(this.calculation)).calculationEditMode=a,[4,this.showCalculation(s)];case 1:return u.sent(),[2]}})})},r.prototype.showCalculation=function(a){return(0,d.__awaiter)(this,void 0,void 0,function(){var s,u;return(0,d.__generator)(this,function(h){switch(h.label){case 0:return[4,this.getCalculationInfo(a)];case 1:return(s=h.sent())?((u=_.cloneDeep(a)).isNew=s.isNew,[4,this.setCalculation(u,s.formulaText,s.alertMessage)]):[2,this.setCalculation(void 0)];case 2:return h.sent(),p.areSameItem(this.calculation,u)?(this.formulaBarControl.scrollTop(),this.formulaBarControl.show(),s&&s.isNew||this.isNewCalcItem?(this.isNewCalcItem=!1,this.formulaBarControl.setSelection({startPosition:0,length:s.formulaText.length}),[4,this.focusWhenNotBlocked()]):[3,4]):[2,Promise.reject(new et)];case 3:h.sent(),h.label=4;case 4:return[2]}})})},r.prototype.setCalculation=function(a,s,u){var h;return void 0===s&&(s=null),void 0===u&&(u=null),(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(D){switch(D.label){case 0:return p.areSameItem(a,this.calculation)&&a?.calculationEditMode===(null===(h=this.calculation)||void 0===h?void 0:h.calculationEditMode)?[2]:(this.calculation=a,this.calculation?this.refreshIntellisenseSession():(this.intellisenseService.endIntellisenseSession(),this.formulaBarControl.clear()),[4,this.updateReadOnlyState(!this.calculation)]);case 1:return D.sent(),[4,this.updateContents(s,u)];case 2:return D.sent(),[2]}})})},r.prototype.tryToUpdateCalculation=function(a,s){K.fF.assertValue(this.calculation,"we expect this.calculation not null/undefined now.");var u=!1;if(a){for(var h=0,D=a;h<D.length;h++){var N=D[h],G=N.entityRename;if(G&&m.wb(this.calculation)&&m.pb(G.schema,this.calculation.schemaName)&&G.before===this.calculation.name&&G.after!==this.calculation.name){if(!(R=_.cloneDeep(m.AG(s,G.after))))throw new dt("Cannot find object from model for calculation after rename entity");R.isNew=this.calculation.isNew,R.calculationEditMode=this.calculation.calculationEditMode,this.calculation=R,u=!0;break}var k=N.propertyRename;if(k&&!m.wb(this.calculation)&&k.objectType===this.calculation.modelObjectType&&m.pb(k.schema,this.calculation.schemaName)&&k.entity===p.getEntityName(this.calculation)&&k.before===this.calculation.name&&k.after!==this.calculation.name){var R=void 0;if("Column"===k.objectType){if(!(R=_.cloneDeep(m.Gz(s,k.schema,k.entity,k.after))))throw new dt("Cannot find object from model for calculation after rename column")}else if("Measure"===k.objectType){if(!(R=_.cloneDeep(m.yo(s,k.schema,k.entity,k.after))))throw new dt("Cannot find object from model for calculation after rename measure")}else if("CalculationItem"===k.objectType&&!(R=_.cloneDeep(m.om(s,k.schema,k.entity,k.after))))throw new dt("Cannot find object from model for calculation after rename calculation item");R.isNew=this.calculation.isNew,R.calculationEditMode=this.calculation.calculationEditMode,this.calculation=R,u=!0;break}var J=N.measureMove;if(J&&m.kb(this.calculation)&&m.pb(J.schema,this.calculation.schemaName)&&J.source===this.calculation.table.name&&J.property===this.calculation.name&&J.destination!==this.calculation.table.name){if(!(R=_.cloneDeep(m.yo(s,J.schema,J.destination,J.property))))throw new dt("Cannot find object from model for calculation after move measure");R.isNew=this.calculation.isNew,R.calculationEditMode=this.calculation.calculationEditMode,this.calculation=R,u=!0;break}}u&&this.refreshIntellisenseSession()}},r.prototype.getCalculationInfo=function(a){return(0,d.__awaiter)(this,void 0,void 0,function(){var s,u;return(0,d.__generator)(this,function(D){return s=p.getEntityName(a),u=p.getPropertyName(a),[2,this.intellisenseService.getCalculationInfo({entityName:s,propertyName:u,schemaName:a.schemaName,calculationEditMode:a.calculationEditMode})]})})},r.prototype.updateDynamicallyFormattedMeasureStatus=function(){var a,s,u;return(0,d.__awaiter)(this,void 0,void 0,function(){var h,D;return(0,d.__generator)(this,function(N){switch(N.label){case 0:return h=this.getMeasureSelection(),D="Dynamic"===(null===(a=h?.formatInformation)||void 0===a?void 0:a.format),null===(s=this.formulaBarControl)||void 0===s||s.showEditModeSelector(D&&this.featureSwitchService.featureSwitches.dynamicFormatString),this.calculation&&1!==this.calculation.calculationEditMode&&!D?h?[4,this.updateCalculationEditMode(1)]:[3,2]:[3,5];case 1:return N.sent(),[3,4];case 2:return[4,this.setCalculation(void 0)];case 3:N.sent(),N.label=4;case 4:null===(u=this.formulaBarControl)||void 0===u||u.setEditMode(1),N.label=5;case 5:return[2]}})})},r.prototype.getMeasureSelection=function(){return this.calculation?(0,x.yo)(this.dataModelService.getDataModel(),this.calculation.schemaName,p.getEntityName(this.calculation),p.getPropertyName(this.calculation)):void 0},r.prototype.updateDynamicallyFormattedCalculationItemStatus=function(){var a,s;return(0,d.__awaiter)(this,void 0,void 0,function(){var u,h;return(0,d.__generator)(this,function(D){switch(D.label){case 0:return u=this.getCalculationItemSelection(),h=!!u.formatStringDefinition,null===(a=this.formulaBarControl)||void 0===a||a.showEditModeSelector(u&&h),this.calculation&&1!==this.calculation.calculationEditMode&&!h?u?[4,this.updateCalculationEditMode(1)]:[3,2]:[3,5];case 1:return D.sent(),[3,4];case 2:return[4,this.setCalculation(void 0)];case 3:D.sent(),D.label=4;case 4:null===(s=this.formulaBarControl)||void 0===s||s.setEditMode(1),D.label=5;case 5:return[2]}})})},r.prototype.getCalculationItemSelection=function(){return this.calculation?(0,x.om)(this.dataModelService.getDataModel(),p.getEntityName(this.calculation),p.getPropertyName(this.calculation)):void 0},r.prototype.refreshIntellisenseSession=function(){this.intellisenseService.endIntellisenseSession();var a=p.getEntityName(this.calculation),s=p.getPropertyName(this.calculation);this.intellisenseService.startIntellisenseSession(a,s,this.calculation.schemaName,this.calculation.calculationEditMode)},r.\u0275fac=function(s){return new(s||r)(v.\u0275\u0275inject(ct.W6),v.\u0275\u0275inject(ft.q),v.\u0275\u0275inject(tt.D),v.\u0275\u0275inject(W.n),v.\u0275\u0275inject(g.S),v.\u0275\u0275inject(T.S,8),v.\u0275\u0275inject(t.o),v.\u0275\u0275inject(P.e),v.\u0275\u0275inject(rt.H),v.\u0275\u0275inject(f.y0),v.\u0275\u0275inject(st.c),v.\u0275\u0275inject(ht.vZ))},r.\u0275prov=v.\u0275\u0275defineInjectable({token:r,factory:r.\u0275fac}),r}(w.e),et=function(C){function r(){var a=C.call(this,"The active item was updated before the formula bar could finish initializing the editor for the previous selection")||this;return a.name="CalculationChangedDuringShowFlow",a}return(0,d.__extends)(r,C),r}(Error),dt=function(C){function r(a){var s=C.call(this,a)||this;return s.name="CalculationNotFoundError",s}return(0,d.__extends)(r,C),r}(Error),_t={provide:b.n9,useClass:pt},gt=e(60353),mt=e(63708),bt={provide:b.Pm,useClass:function(){function C(r){this.dataModelService=r}return C.prototype.init=function(r){this.calculationObjectInfo=(0,d.__assign)({},r)},C.prototype.reset=function(){this.calculationObjectInfo=void 0},C.prototype.getDaxModeConfigInputs=function(r){var a=(0,gt.C)(this.dataModelService.getDataModel()),s=this.isFunctionRestrictedMode(),u=this.getDaxCalculation(),h=this.filterWireDataSourceInfo(r);return Promise.resolve({serializableModel:a,wireDataSourceInfo:h,daxCalculation:u,isRestrictedMode:s})},C.prototype.getCalculationObject=function(){return this.calculationObjectInfo&&this.findCalculationObject({entityName:this.calculationObjectInfo.entityName,propertyName:this.calculationObjectInfo.propertyName,schemaName:this.calculationObjectInfo.schemaName,calculationEditMode:this.calculationObjectInfo.calculationEditMode})},C.prototype.findCalculationObject=function(r){var a,s=r.schemaName,u=r.entityName,h=r.propertyName,D=r.calculationEditMode;if(u){var N=(0,x.Lc)(this.dataModelService.getDataModel(),s,u,h);if(!N)return;var G=N.expression,R=N.expressionErrorMessage;if(2===D){var k=N.formatStringDefinition;G=null!==(a=k?.expression)&&void 0!==a?a:"",R=k?.errorMessage}var J={name:N.name,expression:G,schemaName:N.schemaName,calculationType:this.getCalculationType(N),calculationSyntaxType:C.getCalculationSyntaxType(D),expressionErrorMessage:R};return _.isEmpty(N.annotations)||(J=(0,d.__assign)((0,d.__assign)({},J),{expressionOverride:(0,x.MZ)(N),formulaOverride:(0,x.CE)(N),isNew:(0,x.e_)(N)})),J}},C.prototype.getDaxCalculation=function(){var r,a=this.calculationObjectInfo;if(a){var s=(r=this.calculationObjectInfo).schemaName,u=r.entityName,h=r.propertyName,D=(0,x.Lc)(this.dataModelService.getDataModel(),s,u,h);if(D){var N=this.getCalculationType(D),G=C.getCalculationSyntaxType(a.calculationEditMode);return{tableName:a.entityName,calculationName:a.propertyName,type:N,syntaxType:G}}}},C.prototype.isFunctionRestrictedMode=function(){if(!this.calculationObjectInfo)return!1;var a=this.calculationObjectInfo.entityName,s=(0,x.AG)(this.dataModelService.getDataModel(),a);return!!s&&s.capabilities.requirePushableToDirectQueryDax},C.prototype.getCalculationType=function(r){if(r)switch(r.objectType){case"Column":return mt.eN.Column;case"Table":return mt.eN.Table;case"Measure":return mt.eN.Measure;case"CalculationItem":return mt.eN.CalculationItem;default:return}},C.prototype.filterWireDataSourceInfo=function(r){return{functionDataFromEngine:r.functionDataFromEngine.filter(function(u){return!u.visualCalculationsInfo||0===u.visualCalculationsInfo}),reservedWords:r.reservedWords}},C.getCalculationSyntaxType=function(r){return 2===r?mt.Up.Expression:mt.Up.Formula},C.\u0275fac=function(a){return new(a||C)(v.\u0275\u0275inject(W.n))},C.\u0275prov=v.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac}),C}()},Ot=e(64018),Ct=function(){function C(){this.catchOutsideClickEventCallBack=function(r){return!1},this.beginEdit=new v.EventEmitter,this.endEdit=new v.EventEmitter}return C.\u0275fac=function(a){return new(a||C)},C.\u0275cmp=v.\u0275\u0275defineComponent({type:C,selectors:[["formula-bar-model"]],inputs:{isActive:"isActive",autoHide:"autoHide",catchOutsideClickEventCallBack:"catchOutsideClickEventCallBack",expandCollapseConfig:"expandCollapseConfig",shouldAlwaysEnableCancelButton:"shouldAlwaysEnableCancelButton"},outputs:{beginEdit:"beginEdit",endEdit:"endEdit"},features:[v.\u0275\u0275ProvidersFeature([z.B,P.e,y.Dz,_t,bt])],decls:1,vars:4,consts:[[3,"autoHide","isActive","expandCollapseConfig","shouldAlwaysEnableCancelButton","catchOutsideClickEventCallBack","beginEdit","endEdit"]],template:function(a,s){1&a&&(v.\u0275\u0275elementStart(0,"formula-bar",0),v.\u0275\u0275listener("catchOutsideClickEventCallBack",function(){return s.catchOutsideClickEventCallBack})("beginEdit",function(){return s.beginEdit})("endEdit",function(){return s.endEdit}),v.\u0275\u0275elementEnd()),2&a&&v.\u0275\u0275property("autoHide",s.autoHide)("isActive",s.isActive)("expandCollapseConfig",s.expandCollapseConfig)("shouldAlwaysEnableCancelButton",s.shouldAlwaysEnableCancelButton)},dependencies:[Ot.L],encapsulation:2}),C}(),xt=e(81343),Pt=e(82156),St=[{componentId:xt.ro,type:Ct}],Bt=function(){function C(){}return C.\u0275fac=function(a){return new(a||C)},C.\u0275mod=v.\u0275\u0275defineNgModule({type:C}),C.\u0275inj=v.\u0275\u0275defineInjector({imports:[Pt.N.withManifests(St),c.p]}),C}()},17848:function(ot,j,e){e.d(j,{p:function(){return tt}});var c=e(77476),z=e(17174),y=e(67659),P=e(79061),d=e(20214),b=e(68101),w=e(93367),M=e(94841),m=e(79725),p=e(16095),H=e(53772),W=e(44913),g=e(17177),T=e(50423),tt=function(){function K(){}return K.\u0275fac=function(ft){return new(ft||K)},K.\u0275mod=T.\u0275\u0275defineNgModule({type:K}),K.\u0275inj=T.\u0275\u0275defineInjector({imports:[c.CommonModule,z.u5,w.U,P.v,b.B,M.b,p.Z,m.j,H.w,d.y,y._,W.lK,g.T6]}),K}()},15903:function(ot,j,e){e.d(j,{$d:function(){return P},Pm:function(){return z},n9:function(){return y}});var c=e(50423),z=new c.InjectionToken("IntellisenseModelService"),y=new c.InjectionToken("FormulaBarBehaviorService"),P=new c.InjectionToken("FormulaBarZoomService")},98361:function(ot,j,e){e.d(j,{e:function(){return y}});var c=e(81337),z=e(50423),y=function(){function P(d,b,w){this.uiBlockingService=d,this.localizationService=b,this.intellisenseService=w}return P.prototype.registerFormulaBarControl=function(d){this.formulaBarControl=d,d.setEditModeOptions([])},P.prototype.focusWhenNotBlocked=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(d){switch(d.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return d.sent(),this.formulaBarControl.focus(),[2]}})})},P.prototype.updateReadOnlyState=function(d){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(b){switch(b.label){case 0:return[4,this.uiBlockingService.waitTillUnblocked()];case 1:return b.sent(),this.formulaBarControl.setReadOnly(d),[2]}})})},P.prototype.updateContents=function(d,b){return(0,c.__awaiter)(this,void 0,void 0,function(){var w;return(0,c.__generator)(this,function(M){switch(M.label){case 0:return[4,this.intellisenseService.getDataSourceInfo()];case 1:return w=M.sent(),(_.isEmpty(w.functionDataFromEngine)||_.isEmpty(w.reservedWords))&&!b&&(b=this.localizationService.get("DaxEditor_ErrorMessageToGetIntellisense")),[4,this.updateFormulaText(d,w)];case 2:return M.sent(),this.updateAlertText(b),[2]}})})},P.prototype.updateFormulaText=function(d,b){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(w){switch(w.label){case 0:return[4,this.intellisenseService.updateDaxContext(b)];case 1:return w.sent(),this.formulaBarControl.setCommittedFormulaBarText(d||null),this.contentChanged=!1,[2]}})})},P.prototype.updateAlertText=function(d){d?this.formulaBarControl.showAlertMessage(d):this.formulaBarControl.hideAlert()},P.\u0275fac=function(b){z.\u0275\u0275invalidFactory()},P.\u0275prov=z.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac}),P}()},15783:function(ot,j,e){e.d(j,{B:function(){return M}});var c=e(81337),z=e(15903),y=e(50423),P=e(72080),d=e(83309),M=function(){function m(p,H,W,g){this.intellisenseService=p,this.screenReaderService=H,this.zone=W,this.behaviorService=g,this.suspendParseCount=0}return m.prototype.setUICulture=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(p){switch(p.label){case 0:return[4,this.intellisenseService.setUICulture()];case 1:return p.sent(),[2]}})})},m.prototype.ngOnDestroy=function(){this.behaviorService.ngOnDestroy()},Object.defineProperty(m.prototype,"mode",{get:function(){return"dax"},enumerable:!1,configurable:!0}),m.prototype.registerFormulaBarControl=function(p){this.formulaBarControl=p,this.behaviorService.registerFormulaBarControl(p),this.intellisenseService.onClientViewLoaded(this)},m.prototype.onContentChanged=function(p,H,W,g){var T=this,tt=this.intellisenseService.analyzeFinalFormulaCommitInfo(p,!1,!1);this.behaviorService.contentChanged||(this.behaviorService.contentChanged=tt.doCommit),tt.parseErrorMessages.size&&tt.parseErrorMessages.forEach(function(K,ct){T.screenReaderService.alertWithDebounce("dax-error"+ct,K)}),this.intellisenseService.onContentChanged(p,H,W,0!==this.suspendParseCount,g.length>1),this.behaviorService.onContentChanged(tt)},m.prototype.onEditorFocus=function(){this.intellisenseService.onEditorFocus()},m.prototype.hasUnsavedChanges=function(p){return this.behaviorService.hasUnsavedChanges(p)},m.prototype.onBlur=function(p){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(H){switch(H.label){case 0:return[4,this.behaviorService.commitOrDeletePendingCalculation(p)];case 1:return[2,H.sent()]}})})},m.prototype.onSubmit=function(p){return(0,c.__awaiter)(this,void 0,void 0,function(){var H;return(0,c.__generator)(this,function(W){switch(W.label){case 0:return H=this.intellisenseService.analyzeFinalFormulaCommitInfo(p,!0,!0),[4,this.behaviorService.commitCalculationUpdate(H)];case 1:return W.sent(),[2]}})})},m.prototype.onCancel=function(p){return(0,c.__awaiter)(this,void 0,void 0,function(){return(0,c.__generator)(this,function(H){return this.behaviorService.cancel(p),[2]})})},m.prototype.onTemplateSelection=function(p){return this.behaviorService.onTemplateSelection(p)},m.prototype.setCommittedFormulaBarText=function(p){this.formulaBarControl.setCommittedFormulaBarText(p)},m.prototype.hostServiceCalculationCommitedOrDeleted=function(){this.formulaBarControl.endFormulaEdit(),this.behaviorService.contentChanged=!1},m.\u0275fac=function(H){return new(H||m)(y.\u0275\u0275inject(P.e),y.\u0275\u0275inject(d.g),y.\u0275\u0275inject(y.NgZone),y.\u0275\u0275inject(z.n9))},m.\u0275prov=y.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac}),(0,c.__decorate)([function(m,p,H){var W=H.value;H.value=function(){for(var g=[],T=0;T<arguments.length;T++)g[T]=arguments[T];var tt=this;this.zone.run(function(){return W.apply(tt,g)})}},(0,c.__metadata)("design:type",Function),(0,c.__metadata)("design:paramtypes",[]),(0,c.__metadata)("design:returntype",void 0)],m.prototype,"hostServiceCalculationCommitedOrDeleted",null),m}()},34103:function(ot,j,e){e.d(j,{Dz:function(){return d},TH:function(){return P}});var c=e(50423),z=new c.InjectionToken("IntellisenseProxyServiceOverrideToken"),P=function(){function b(){}return b.prototype.onClientViewLoaded=function(w){},b.prototype.onContentChanged=function(w,M,m,p,H){},b.prototype.onEditorFocus=function(){},b.prototype.endIntellisenseSession=function(){},b.prototype.startIntellisenseSession=function(w,M,m,p){},b.prototype.getCultureInfo=function(){return Promise.resolve(JSON.stringify({decimalSeparator:".",listSeparator:","}))},b}(),d={provide:P,useFactory:function(b){var w=b.get(z,null);return w?c.Injector.create([w],b).get(P):new P},deps:[c.Injector]}},72080:function(ot,j,e){e.d(j,{e:function(){return K}});var c=e(81337),z=e(15903),y=e(17819),P=e(63513),d=e(48563),b=e(74249),w=e(26112),M=e(62458),m=e(59694),p=e(63708),H=e(49088),W=e(50423),g=e(65181),T=e(34103),tt=[" ","\t"],K=function(){function x(f,E,F,I){this.localizationService=f,this.intellisenseHostService=E,this.intellisenseModelService=F,this.daxCapabilitiesService=I}return x.prototype.onClientViewLoaded=function(f){this.intellisenseHostService.onClientViewLoaded(f)},x.prototype.onContentChanged=function(f,E,F,I,S){this.intellisenseHostService.onContentChanged(f,E,F,I,S)},x.prototype.setUICulture=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var f,E;return(0,c.__generator)(this,function(F){switch(F.label){case 0:return[4,this.intellisenseHostService.getCultureInfo()];case 1:return f=F.sent(),E=(0,w.K)(f),(0,y.g5)({listSeparator:E.listSeparator,numberDecimalSeparator:E.decimalSeparator}),[2]}})})},x.prototype.onEditorFocus=function(){this.intellisenseHostService.onEditorFocus()},x.prototype.endIntellisenseSession=function(){this.intellisenseModelService.reset(),this.intellisenseHostService.endIntellisenseSession()},x.prototype.startIntellisenseSession=function(f,E,F,I){this.intellisenseModelService.init({entityName:f,propertyName:E,schemaName:F,calculationEditMode:I}),this.intellisenseHostService.startIntellisenseSession(f,E,F,I)},x.prototype.getCalculationInfo=function(f){return(0,c.__awaiter)(this,void 0,void 0,function(){var E;return(0,c.__generator)(this,function(F){return(E=this.intellisenseModelService.findCalculationObject(f))&&null!=E.expression?[2,Promise.resolve({isNew:E.isNew,alertMessage:E.expressionErrorMessage?E.expressionErrorMessage:void 0,formulaText:this.getCalculationExpression(E)})]:(M.fF.assertFail((0,m.W)("Cannot find editable Calculation: schema:{0} entity:{1} property:{2}",f?.schemaName,f?.entityName,f?.propertyName)),[2,Promise.resolve(void 0)])})})},x.prototype.getCalculationExpression=function(f){if(f.formulaOverride)return f.formulaOverride.formula;var E=y.w_.convertToUI(f.expression);return f.calculationSyntaxType===p.Up.Expression?E:(0,y.Mk)(f.name,E)},x.prototype.updateFormulaContextAsync=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var f;return(0,c.__generator)(this,function(E){switch(E.label){case 0:return[4,this.getDataSourceInfo()];case 1:return f=E.sent(),[4,this.updateDaxContext(f)];case 2:return E.sent(),[2]}})})},x.prototype.updateDaxContext=function(f){return(0,c.__awaiter)(this,void 0,void 0,function(){var X;return(0,c.__generator)(this,function(v){switch(v.label){case 0:return[4,this.intellisenseModelService.getDaxModeConfigInputs(f)];case 1:return X=v.sent(),H._.configureModel(X.serializableModel,X.wireDataSourceInfo,X.daxCalculation,X.isRestrictedMode,X.axes),[2]}})})},x.prototype.getDataSourceInfo=function(){return(0,c.__awaiter)(this,void 0,void 0,function(){var f,F,S;return(0,c.__generator)(this,function(V){switch(V.label){case 0:return[4,Promise.all([this.daxCapabilitiesService.getReservedWords(),this.daxCapabilitiesService.getCapabilities()])];case 1:return S=V.sent(),f=S[0],F=(0,d.w)(S[1].Functions),[2,{reservedWords:f,functionDataFromEngine:F}]}})})},x.prototype.analyzeFinalFormulaCommitInfo=function(f,E,F){var I=this.intellisenseModelService.getCalculationObject(),S={name:void 0,expression:void 0,invalidFormula:void 0,anonymizedExpression:void 0,parseResult:void 0},V=function(x,f,E,F){if(!F)return f.name=void 0,f.expression=void 0,f.invalidFormula=void 0,f.anonymizedExpression=void 0,!1;!function(x,f,E,F){var I=!1,S={name:void 0,expression:void 0};if((I=F.calculationSyntaxType===p.Up.Expression)?S.expression=P.uI.trimStart(x,tt):I=(0,y.Mn)(x,S,F.calculationType===p.eN.VisualCalculation),!I)return f.name=F.name||"",f.name&&!x?f.expression="":(f.invalidFormula=x,f.expression=F.expression||""),null;if(f.name=S.name,f.expression=S.expression,S.expression)if(E){(V=H._.getContext())||M.fF.assertFail("Context should be defined");var X=new y.w_,v=new y.ss,t={finalResult:v};X.finalParse(S.expression,V,t,y.MX.AddMissingParens|y.MX.Anonymize|y.MX.ConvertToEngine),f.expression=t.finalResult.updatedExpression,f.anonymizedExpression=t.finalResult.anonymizedExpression,f.parseResult=v}else{X=new y.w_;var V=H._.getContext(),st={result:new y.bp};X.parse(S.expression,0,void 0,void 0,V,st,void 0),f.expression=y.w_.convertToEngine(S.expression),f.parseResult=st.result}}(x,f,E,F);var I,S=F.formulaOverride;return S&&(I=S.formula),F.name!==f.name||F.expression!==f.expression||I!==f.invalidFormula}(f,S,F,I);!V&&E&&I&&(V=!!I.expressionErrorMessage&&!!I.expressionOverride&&!I.formulaOverride);var t,rt,st=new Map;if(V&&S.invalidFormula)switch(t={expression:null,formula:S.invalidFormula},I.calculationType){case p.eN.Column:rt=this.localizationService.get("ReportModelInvalidColumnNameMessage");break;case p.eN.Table:rt=this.localizationService.get("ReportModelInvalidCalculatedTableNameMessage");break;case p.eN.Measure:rt=this.localizationService.get("ReportModelInvalidMeasureNameMessage");break;case p.eN.CalculationItem:rt=this.localizationService.get("ReportModelInvalidCalcItemNameMessage");break;case p.eN.VisualCalculation:break;default:M.fF.assertFail("Unknown type "+I.calculationType)}return S.parseResult instanceof y.bp&&S.parseResult.errors.length&&S.parseResult.errors.forEach(function(ht){return st.set(ht.errorCode,ht.message)}),{doCommit:V,newName:S.name,newExpression:S.expression,newInvalidFormula:S.invalidFormula,anonymizedExpression:S.anonymizedExpression,expressionOverride:t,errorMessage:rt,parseErrorMessages:st}},x.\u0275fac=function(E){return new(E||x)(W.\u0275\u0275inject(g.o),W.\u0275\u0275inject(T.TH),W.\u0275\u0275inject(z.Pm),W.\u0275\u0275inject(b.r))},x.\u0275prov=W.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"}),x}()},4715:function(ot,j,e){e.d(j,{H2:function(){return y},Zs:function(){return w},gV:function(){return d}});var c=e(41114),z="PBI.FormulaBar.EditFormulaBarObject",y=c.cx[z]=(0,c.b1)(z),P="PBI.FormulaBar.SubmitDynamicFormatString",d=c.cx[P]=(0,c.b1)(P),b="PBI.FormulaBar.SelectTemplate",w=c.cx[b]=(0,c.b1)(b)},81892:function(ot,j,e){e.d(j,{Uu:function(){return y},ZI:function(){return c},dO:function(){return z}});var c=[{displayName:"Measure",key:1},{displayName:"Format",key:2}],z=[{displayName:"Item",key:1},{displayName:"Format",key:2}],y="formulaBarDropdownPanel"},60353:function(ot,j,e){e.d(j,{C:function(){return y}});var c=e(95867),z=e(5207);function y(g){return{tables:P(g).map(function(T){return function(g){return{name:g.name,isUserTable:(0,c.$i)(g),description:g.description,columns:g.columns?g.columns.map(function(T){return function(g){return{name:g.name,isUserColumn:(0,c.rh)(g),description:g.description,variationTable:M(g)}}(T)}):[],measures:g.measures?g.measures.map(function(T){return function(g){return{name:g.name,description:g.description,expression:g.expression,isExternal:!!g.sourceLineageTag}}(T)}):[],calendars:g.calendars?g.calendars.map(function(T){return function(g){return{name:g.name}}(T)}):[]}}(T)}),relationships:g.relationships?d(g).map(function(T){return function(g){return{active:g.isActive,from:{table:g.fromTable.name,column:g.fromColumn?g.fromColumn.name:void 0,cardinality:W(g.fromCardinality)},to:{table:g.toTable.name,column:g.toColumn?g.toColumn.name:void 0,cardinality:W(g.toCardinality)}}}(T)}):[]}}function P(g){return g.tables.filter(function(T){return T.schemaName!==z._.DataWarehouseSchema})}function d(g){return g.relationships.filter(function(T){return T.fromTable.schemaName!==z._.DataWarehouseSchema&&T.toTable.schemaName!==z._.DataWarehouseSchema})}function M(g){if(g.variations&&g.variations.length>0)return g.variations[0].relationship.toTable.name}function W(g){switch(g){case"Many":case"None":return"many";case"One":return"one"}}}}]);