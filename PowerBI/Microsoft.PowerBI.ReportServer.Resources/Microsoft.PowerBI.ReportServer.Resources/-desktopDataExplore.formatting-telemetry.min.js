"use strict";(self.webpackChunkdesktopDataExplore=self.webpackChunkdesktopDataExplore||[]).push([["formatting-telemetry"],{83606:function(Pe,A,n){n.r(A),n.d(A,{FormattingTelemetryModule:function(){return j}});var e=n(40702),P=n(9215),z=n(3579),m=n(60661),G=n(9500),C=n(62458),H=["Visual Container Deselection","Visual Container Selection"],I=["areaChart","barChart","clusteredColumnChart","clusteredBarChart","columnChart","hundredPercentStackedColumnChart","hundredPercentStackedBarChart","lineChart","lineClusteredColumnComboChart","lineStackedColumnComboChart","ribbonChart","scatterChart","stackedAreaChart","waterfallChart"],y=function(){function a(t,o,s,i,r,l,c){this.isActive=t,this.sessionId=o,this.visualUid=s,this.telemetryService=i,this.certifiedTelemetryService=r,this.featureSwitchService=l,this.canvasItem=c,this.events=[]}return a.createSession=function(t,o,s,i,r,l,c){return new a(t,o,s,i,r,l,c)},a.prototype.addEvent=function(t){var o=this.getVisualProperties(),s={name:t.name,end:t.end,start:t.start,data:t.data,visualProperties:o};if(this.events.push(s),this.featureSwitchService.featureSwitches.certifiedVisualTelemetry&&!H.includes(t.name)){var i=s.data,r={eventName:t.name,onObjectEnabled:!!this.featureSwitchService.featureSwitches.onObject};switch(r.source=i?.source,i?.source){case"ContextMenu":r.contextMenuType=i.contextMenuType;break;case"KeyboardShortcut":r.shortcutType=i.shortcutType;break;case"InFocus":case"Skittle":r.skittleType=i.skittleType;break;case"Pane":r.paneType=i.paneType;break;case"MouseAction":r.mouseActionType=i.mouseActionType;break;case"Selection":case"DirectEdit":case"Popout":case"MiniToolbar":case"No Telemetry":case"Ribbon":case"Tooltip":case"VisualErrorOut":case"VisualHeader":break;default:C.fF.assertNever(i)}switch(t.name){case"Automatically expand field well section":r.closed=i.closed;break;case"ChangeAutoVisual":r.initialAutoVisualValue=i.initialAutoVisualValue;break;case"Change Format":r.isCartesian=I.includes(i.visualType);break;case"ChangeShowFieldAs":r.operationType=i.operationType;break;case"ChangeVisualType":r.sourceVisualType=i.sourceVisualType,r.targetVisualType=i.targetVisualType;break;case"VisualAction":case"PaneAction":r.action=i.action;break;case"Revert To Default":r.objectName=i.objectName;break;case"UpdateField":r.fieldType=i.fieldType,r.operationType=i.operationType;break;case"ChangeAggregation":case"EndDirectEdit":case"ExecuteNavigateShortcut":case"OpenSkittle":case"SelectVisualRecommendation":case"StartDirectEdit":case"Switch From Format Mode":case"Switch From Matrix View":case"Switch To Format Mode":case"Switch To Matrix View":case"Visual Container Deselection":case"Visual Container Selection":break;default:C.fF.assertNever(t.name)}this.certifiedTelemetryService.logTimedStandardizedFeatureEvent({resultCode:null,correlationId:this.sessionId,activityName:t.name,activityAttributes:r,featureName:"OnObject",activityStatus:"Succeeded",operationEndTime:t.end,operationStartTime:t.start})}this.isAtCapacity()&&(this.logTelemetry(),this.events=[])},a.prototype.closeSession=function(){this.isActive=!1,this.logTelemetry()},a.prototype.getEvents=function(){return this.events},a.prototype.logTelemetry=function(){this.telemetryService.logEvent(e._Z,{sessionId:this.sessionId,visualName:this.visualUid,data:JSON.stringify(this.events),isOnObject:!!this.featureSwitchService.featureSwitches.onObject})},a.prototype.isAtCapacity=function(){return!1},a.prototype.getVisualProperties=function(){var t,o,s;if(null!=this.canvasItem&&!(0,P.q4)(this.canvasItem))return{visualType:(0,z.s)(this.canvasItem),isAutoVisual:(0,m.II)(this.canvasItem),fieldKinds:_.map(null===(s=null===(o=null===(t=(0,m.Xf)(this.canvasItem))||void 0===t?void 0:t.defn)||void 0===o?void 0:o.select)||void 0===s?void 0:s.call(o),function(i){return(0,G.QR)(i.expr)})}},a}(),x=n(60756),g=n(91401),E=n(29748),R=n(72262),S=n(59142),b=n(77200),T=n(97128),V=n(9380),N=n(14463),F=n(29804),h=n(4633),K=n(63057),B=n(59973),U=n(14172),X=n(23558),Q=n(79078),u=n(50423),W=["ChangeAggregation","ChangeAutoVisual","Change Format","ChangeShowFieldAs","ChangeVisualType","EndDirectEdit","Revert To Default","Visual Container Deselection","Visual Container Selection","UpdateField","OpenSkittle","SelectVisualRecommendation","StartDirectEdit","Switch From Format Mode","Switch To Format Mode","VisualAction","ExecuteNavigateShortcut","PaneAction"],Z=function(){function a(t,o,s,i,r,l,c){this.contextActivity=t,this.exploreNavigationService=o,this.viewModeState=s,this.selectionService=i,this.telemetryService=r,this.certifiedTelemetryService=l,this.featureSwitchService=c,this.sessions={}}return a.prototype.start=function(){var t=this,o=this.contextActivity.getActivityStream().pipe((0,x.l4)(g.Gb,g.xq,g.TH),(0,B.h)(function(r){return W.includes(r.properties.name)})),s=this.selectionService.selectedElements$,i=this.viewModeState.getMode$();this.serviceSub=(0,K.T)(s.pipe((0,U.U)(function(r){return{source:"selection",data:r}})),i.pipe((0,U.U)(function(r){return{source:"viewMode",data:r}})),o.pipe((0,U.U)(function(r){return{source:"contextActivity",data:r}}))).pipe((0,X.M)(i)).subscribe(function(r){var l=r[0],d=l.data,v=r[1];switch(l.source){case"selection":1===v&&t.handleSessions(d);break;case"viewMode":t.handleViewMode(d);break;case"contextActivity":t.routeEvent(d.properties)}})},a.prototype.routeEvent=function(t){var o=t;if(!o.visualName)return["Switch To Format Mode","Switch From Format Mode"].includes(o.name)?void _.forEach(this.sessions,function(i){return i.addEvent(o)}):void(this.canvasSession&&this.canvasSession.addEvent(o));this.logEvent(t)},a.prototype.logEvent=function(t){var o=t,s=this.getVisualUid(this.exploreNavigationService.getCurrentSection().name,o.visualName),i=this.sessions[s];i&&i.addEvent(o)},a.prototype.handleViewMode=function(t){0===t&&this.clean()},a.prototype.clean=function(){this.closeAllSessions(),this.serviceSub.unsubscribe()},a.prototype.handleSessions=function(t){var s,o=this;if(this.timeoutId&&clearTimeout(this.timeoutId),0===t.length){var i=null===(s=this.exploreNavigationService.getCurrentSection())||void 0===s?void 0:s.name;return this.canvasSession=y.createSession(!0,(0,Q.Z)(),i,this.telemetryService,this.certifiedTelemetryService,this.featureSwitchService,void 0),void(this.timeoutId=setTimeout(function(){o.closeAllSessions(),o.timeoutId=null},1e3))}this.canvasSession&&(this.canvasSession.closeSession(),this.canvasSession=void 0),Object.keys(this.sessions).forEach(function(p){return o.sessions[p].isActive=!1});for(var r=0,l=t;r<l.length;r++){var c=l[r],d=c.canvasItem.name,v=this.getVisualUid(this.exploreNavigationService.getCurrentSection().name,d),D=(0,F.z)();if(this.sessions[v])this.sessions[v].isActive=!0;else{var L=(0,Q.Z)();this.sessions[v]=y.createSession(!0,L,v,this.telemetryService,this.certifiedTelemetryService,this.featureSwitchService,c.canvasItem),this.sessions[v].addEvent({name:"Visual Container Selection",end:D,start:D,data:{source:"Selection"},visualName:v})}}Object.keys(this.sessions).forEach(function(p){if(!1===o.sessions[p].isActive){var f=(0,F.z)();o.sessions[p].addEvent({name:"Visual Container Deselection",end:f,start:f,data:{source:"Selection"},visualName:o.sessions[p].visualUid}),o.sessions[p].closeSession(),delete o.sessions[p]}})},a.prototype.getVisualUid=function(t,o){return"".concat(t,"_").concat(o)},a.prototype.closeAllSessions=function(){_.forEach(this.sessions,function(t){var o=(0,F.z)();t.addEvent({name:"Visual Container Deselection",end:o,start:o,data:{source:"Selection"},visualName:t.visualUid}),t.closeSession()}),this.sessions={}},a.\u0275fac=function(o){return new(o||a)(u.\u0275\u0275inject(E.r),u.\u0275\u0275inject(S.I),u.\u0275\u0275inject(b.kc),u.\u0275\u0275inject(R.z),u.\u0275\u0275inject(h.y0),u.\u0275\u0275inject(h.ly),u.\u0275\u0275inject(V.vZ))},a.\u0275prov=u.\u0275\u0275defineInjectable({token:a,factory:a.\u0275fac}),a}(),O={provide:T.F,useFactory:function(a,t,o,s,i,r,l,c){var d=new Z(t,o,i,s,r,l,c);return a.resolve(d)},deps:[N.t,E.r,S.I,R.z,b.kc,h.y0,h.ly,V.vZ]},w=n(77476),J=n(82156),j=function(){function a(){}return a.\u0275fac=function(o){return new(o||a)},a.\u0275mod=u.\u0275\u0275defineNgModule({type:a}),a.\u0275inj=u.\u0275\u0275defineInjector({providers:[O],imports:[w.CommonModule,J.N]}),a}()},40702:function(Pe,A,n){n.d(A,{$0:function(){return g},Es:function(){return D},G5:function(){return G},Lo:function(){return l},Sd:function(){return Z},TS:function(){return $},V1:function(){return W},Y$:function(){return V},Yu:function(){return a},_Z:function(){return b},_m:function(){return Ie},cF:function(){return z},gW:function(){return ye},jG:function(){return p},lG:function(){return H},rU:function(){return y},yw:function(){return R}});var e=n(41114),P="PBI.ExploreUIAuthoring.ContextMenuButtonClicked",z=e.cx[P]=(0,e.b1)(P),m="PBI.ExploreUIAuthoring.RevertToDefaultClicked",G=e.cx[m]=(0,e.b1)(m),C="PBI.ExploreUIAuthoring.ExpansionButtonClicked",H=e.cx[C]=(0,e.b1)(C),I="PBI.ExploreUIAuthoring.FormattingPaneSearch",y=e.cx[I]=(0,e.b1)(I),x="PBI.ExploreUIAuthoring.InsertSection",g=e.cx[x]=(0,e.b1)(x),E="PBI.ExploreUIAuthoring.DeleteSection",R=e.cx[E]=(0,e.b1)(E),S="PBI.ExploreUIAuthoring.VisualSession",b=e.cx[S]=(0,e.b1)(S,{logExpAssignment:!0}),T="PBI.ExploreUIAuthoring.ReorderTabOrderByPosition",V=e.cx[T]=(0,e.b1)(T),N="PBI.ReportCreationCopilot.RunSuggestQueries",h=(e.cx[N]=(0,e.b1)(N),"PBI.AuthoringCopilotCreatePage.RunSuggestQueries"),B=(e.cx[h]=(0,e.b1)(h),"PBI.ReportCreationCopilot.PageValidation"),X=(e.cx[B]=(0,e.b1)(B),"PBI.ReportCreationCopilot.VisualValidation"),u=(e.cx[X]=(0,e.b1)(X),"PBI.EX.ChangeFieldWell"),W=e.cx[u]=(0,e.b1)(u),M="PBI.EX.ChangeAggregation",$=e.cx[M]=(0,e.b1)(M),k="PBI.EX.RemoveConditionalFormatting",Z=e.cx[k]=(0,e.b1)(k),O="PBI.EX.RemoveDataBars",w=(e.cx[O]=(0,e.b1)(O),"PBI.EX.AnalyticsPane.Open"),j=(e.cx[w]=(0,e.b1)(w),"PBI.EX.AnalyticsPane.AddInstance"),a=e.cx[j]=(0,e.b1)(j),t="PBI.EX.AnalyticsPane.RemoveInstance",s=(e.cx[t]=(0,e.b1)(t),"PBI.EX.AnalyticsPane.ForecastParameterUpdated"),r=(e.cx[s]=(0,e.b1)(s),"PBI.EX.PropertyPane.OnValueChanged"),l=e.cx[r]=(0,e.b1)(r),c="PBI.EX.DrillthroughPane.ChangeLink",v=(e.cx[c]=(0,e.b1)(c),"PBI.EX.NavigateAndSelectVisual"),D=e.cx[v]=(0,e.b1)(v),L="PBI.EX.FieldWellAbnormalRename",p=e.cx[L]=(0,e.b1)(L),f="PBI.EX.LaunchChangeDetectionDialog",Ie=e.cx[f]=(0,e.b1)(f),q="PBI.EX.PersonalizeVisual.ChangePerspective",ye=e.cx[q]=(0,e.b1)(q),ee="PBI.ReportCreationCopilot.FeedbackLoop.UserResponse",te=(e.cx[ee]=(0,e.b1)(ee),"PBI.ReportCreationCopilot.FeedbackLoop"),oe=(e.cx[te]=(0,e.b1)(te),"PBI.ReportCreationCopilot.UserResponse"),ie=(e.cx[oe]=(0,e.b1)(oe),"PBI.ReportCreationCopilot.StageCompleted"),re=(e.cx[ie]=(0,e.b1)(ie),"PBI.ReportCreationCopilot.TerminalAPIError"),ae=(e.cx[re]=(0,e.b1)(re),"PBI.ReportCreationCopilot.TerminalAgentError"),ne=(e.cx[ae]=(0,e.b1)(ae),"PBI.ReportCreationCopilot.EnsureComplete"),se=(e.cx[ne]=(0,e.b1)(ne),"PBI.CopilotReportAuthoring.Authoring"),le=(e.cx[se]=(0,e.b1)(se),"PBI.CopilotReportAuthoring.CreatePage"),ce=(e.cx[le]=(0,e.b1)(le),"PBI.Copilot.PageCreationTool"),ue=(e.cx[ce]=(0,e.b1)(ce),"PBI.CopilotReportAuthoring.SuggestTopics"),ve=(e.cx[ue]=(0,e.b1)(ue),"PBI.CopilotReportAuthoring.SummarizeDataset"),pe=(e.cx[ve]=(0,e.b1)(ve),"PBI.CopilotReportAuthoring.CloseButtonClicked"),de=(e.cx[pe]=(0,e.b1)(pe),"PBI.CopilotReportAuthoring.ValidateVisual"),he=(e.cx[de]=(0,e.b1)(de),"PBI.CopilotReportAuthoring.ValidateVisualAdHocQuery"),me=(e.cx[he]=(0,e.b1)(he),"PBI.CopilotScenario.Summary.Generated"),Ce=(e.cx[me]=(0,e.b1)(me),"PBI.CopilotScenario.Answer.Generated"),ge=(e.cx[Ce]=(0,e.b1)(Ce),"PBI.CopilotScenario.Forecast.Generated"),Ee=(e.cx[ge]=(0,e.b1)(ge),"PBI.CopilotReportAuthoring.ValidateField"),Se=(e.cx[Ee]=(0,e.b1)(Ee),"PBI.ExploreCopilot.CopilotReferenceClicked"),fe=(e.cx[Se]=(0,e.b1)(Se),"PBI.ExploreCopilot.CopilotReferenceHovered"),Ae=(e.cx[fe]=(0,e.b1)(fe),"PBI.Copilot.OpenCopilotPaneEditModeFS");e.cx[Ae]=(0,e.b1)(Ae)}}]);